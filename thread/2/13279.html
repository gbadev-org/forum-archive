<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Java: Load a class from random path - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>OffTopic > Java: Load a class from random path</h2>
<div id="posts">
<div class="post">
    <h4>#129640 - Mr Snowflake - Thu May 24, 2007 3:04 pm</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
How can I load a class, which sits in a package, when I only know the path and filename of that class? If I use a URLClassLoader I can put the path into the ClassLoader but then I can't load the class because I don't know it's package.<br/>_________________<br/><a class="postlink" href="http://www.mrsnowflake.be" target="_blank">http://www.mrsnowflake.be</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#129712 - gauauu - Fri May 25, 2007 2:38 pm</h4>
    <div class="postbody"><span class="postbody">Is it sitting in any sort of package-related directory structure at all (as in, it's in one, but you aren't sure the root of the the package)?  Then you can try to write something that uses guesses work, guessing different roots, and trying different package names from that.
<br/>
<br/>
If not, then it's gonna be tough.  For a one-time case, you can probably grab a java decompiler and find out what package it is, but I don't know for the general case if it needs to be done in code.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#129714 - naleksiev - Fri May 25, 2007 3:13 pm</h4>
    <div class="postbody"><span class="postbody">I can think about one solution. You can read the actual data in the class file so you can find what is the package. I'm sure there must be a ClassReader lib that will do this for you. Probably it's even in the J2SE standard package.
<br/>
<br/>
In case you want to do it yourself.
<br/>
The way it should work is reading just the the ClassFile structure. There are some important things you need to have not parsing the whole structure. You need to load the constant_pool and the super_class offset in the pool. And in the constant_pool[super_class] you will have the full name of the class (package + classname).
<br/>
<br/>
You can take a look at <a class="postlink" href="http://java.sun.com/docs/books/jvms/second_edition/html/ClassFile.doc.html" target="_blank">http://java.sun.com/docs/books/jvms/second_edition/html/ClassFile.doc.html</a> for more info.
<br/>
<br/>
Good luck.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#129716 - ps2aich - Fri May 25, 2007 3:41 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mr Snowflake wrote:</b></span></td> </tr> <tr> <td class="quote">Hi,
<br/>
<br/>
How can I load a class, which sits in a package, when I only know the path and filename of that class? If I use a URLClassLoader I can put the path into the ClassLoader but then I can't load the class because I don't know it's package.</td> </tr></table><span class="postbody">
<br/>
<br/>
I think we had an similar issue in an <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=12846&amp;highlight=" target="_blank">older thread </a> already (iterating through jar)
<br/>
<br/>
<br/>
Can you give a more concrete example to have an idea what you want to do?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#129816 - Mr Snowflake - Sun May 27, 2007 4:17 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ps2aich wrote:</b></span></td> </tr> <tr> <td class="quote">I think we had an similar issue in an <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=12846&amp;highlight=" target="_blank">older thread </a> already (iterating through jar)</td> </tr></table><span class="postbody">That older threat is mine ;).
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ps2aich wrote:</b></span></td> </tr> <tr> <td class="quote">Can you give a more concrete example to have an idea what you want to do?</td> </tr></table><span class="postbody">It's kinda what gauauu said. I know it's position on the disk (path name + file name). And I can assume it's inside the appropriate package dir, but I don't know its fullyquallyfied classname and I also don't know the base dir of the package.
<br/>
<br/>
Making a reader myself would work, but I don't have that much time...<br/>_________________<br/><a class="postlink" href="http://www.mrsnowflake.be" target="_blank">http://www.mrsnowflake.be</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#129830 - ps2aich - Sun May 27, 2007 8:12 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mr Snowflake wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ps2aich wrote:</b></span></td> </tr> <tr> <td class="quote">I think we had an similar issue in an <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=12846&amp;highlight=" target="_blank">older thread </a> already (iterating through jar)</td> </tr></table><span class="postbody">That older threat is mine ;).
<br/>
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Yes I know :-)
<br/>
<br/>
In theory, its only a substring problem:
<br/>
<br/>
Your path is like:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">/dir1/dir2/dir3/.../dirN/ClassX.java</td> </tr></table><span class="postbody">
<br/>
Your package is like:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">dirN-x.dirN-(x-1).dirN-(x-2)....dirN</td> </tr></table><span class="postbody">
<br/>
<br/>
So, if you convert your path into package like format, and iterate
<br/>
through the jar package (with JarFile) and build fully qualified package names,
<br/>
you have to compare the fully qualified package name with
<br/>
String.endsWith to find the package, and then search the class
<br/>
in this package.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130254 - Mr Snowflake - Fri Jun 01, 2007 3:48 pm</h4>
    <div class="postbody"><span class="postbody">That was also mine solution, but I do not believe the assistant at uni was very pleased with this. He said I should look deeper in the ClassLoader... He could be right, but I don't have that much time left anymore, so I'll go with the string solution :).<br/>_________________<br/><a class="postlink" href="http://www.mrsnowflake.be" target="_blank">http://www.mrsnowflake.be</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130256 - ps2aich - Fri Jun 01, 2007 4:21 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mr Snowflake wrote:</b></span></td> </tr> <tr> <td class="quote">That was also mine solution, but I do not believe the assistant at uni was very pleased with this. He said I should look deeper in the ClassLoader... He could be right, but I don't have that much time left anymore, so I'll go with the string solution :).</td> </tr></table><span class="postbody">
<br/>
<br/>
I don't think a standard classloader can do this, since classloading
<br/>
is done lazy (on demand) and the classloader never iterates over 
<br/>
the jar to look for all classes in there.
<br/>
<br/>
But what you can perhaps try is to make your own class loader 
<br/>
that derives from URLClassloader and override the findClass-
<br/>
Method and refactor the string matching algorithm to be implemented
<br/>
in this findClass-Method. Then you have to convert the slashes
<br/>
in the path into dots '.', and you can try a brute force finding of the
<br/>
class: instead of iterating through the jar, you simple 
<br/>
do a 'super.findClass("x.y.z")' with all substrings by cutting leading
<br/>
portions of the complete path. Not very efficient, but effectiv.
<br/>
<br/>
Example:
<br/>
Filename is "/x/y/z/a.class" or "C:\x\y\z\a.class".
<br/>
Convert it to: "x.y.z.a"
<br/>
Give this to your Classloader with loadClass("x.y.z.a")
<br/>
In the findClass implementation, you start with 
<br/>
'super.findClass("x.y.z.a")'. If a class is found, we are finished.
<br/>
If not, you do 'super.findClass("y.z.a"), and so on, until you find the 
<br/>
class or the string is empty.
<br/>
What I don't know is, wheater the next loadClass does this again,
<br/>
or if the classloader is intelligent enough to remember that
<br/>
you have found the class with loadClass("x.y.z.a").
<br/>
<br/>
And of course, the solution is not 'clean' in the sense of that
<br/>
there can exist other classes in the parent classloader (usually
<br/>
the System class loader), that really have the fully qualified
<br/>
name "x.y.z.a". In that case, you will retrieve this class,
<br/>
because the parent is always asked first (security reason, otherwise
<br/>
you could replace bootstrap/rt-classes, and this is a security hole).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130596 - Mr Snowflake - Tue Jun 05, 2007 6:38 pm</h4>
    <div class="postbody"><span class="postbody">I've implemented it, and it seems to work ok now (not using my own implementation of urlclassloader, but doesn't matter). The only problem now is that I can load, probably all classes there are, but, funny thing, not java.lang.Class.... really strange.. But i'll just throw an if test inside the code and mention it in the report, so they know, I know the problem exists, but I didn't have enough time to fix it... 
<br/>
<br/>
Thanks all.<br/>_________________<br/><a class="postlink" href="http://www.mrsnowflake.be" target="_blank">http://www.mrsnowflake.be</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130666 - ps2aich - Wed Jun 06, 2007 9:18 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mr Snowflake wrote:</b></span></td> </tr> <tr> <td class="quote">I've implemented it, and it seems to work ok now (not using my own implementation of urlclassloader, but doesn't matter). The only problem now is that I can load, probably all classes there are, but, funny thing, not java.lang.Class.... really strange.. But i'll just throw an if test inside the code and mention it in the report, so they know, I know the problem exists, but I didn't have enough time to fix it... 
<br/>
<br/>
Thanks all.</td> </tr></table><span class="postbody">
<br/>
<br/>
I think java.lang.Class is bootstraped in Java, since its a 'Meta' model of java , that means the Classloader returns your class, 
<br/>
and this is a 'java.lang.Class', so it must be known to the classloader. 
<br/>
Of cource, 'java.lang.Class' itself is a 'java.lang.Class'. I think it is normal that a Class.forName("java.lang.Class") does not make any sense.
<br/>
<br/>
Btw, I'm just curious: what kind of project/exercise/task is this you are working on?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#132233 - Mr Snowflake - Sun Jun 24, 2007 10:26 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ps2aich wrote:</b></span></td> </tr> <tr> <td class="quote">I think it is normal that a Class.forName("java.lang.Class") does not make any sense.</td> </tr></table><span class="postbody">It's a very correct statement to do Class.forName("java.lang.Class"), the problem with my code was I was filtering the extention .class but apparently i checked if the last 5 chars equalled 'class' so java.lang.Class would become java.lang, which is, obviously, a package ;).
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ps2aich wrote:</b></span></td> </tr> <tr> <td class="quote">Btw, I'm just curious: what kind of project/exercise/task is this you are working on?</td> </tr></table><span class="postbody">We were working on a Java class browser with only access to the byte code of the java classes. We needed to genereate html pages with all members of the given classes.<br/>_________________<br/><a class="postlink" href="http://www.mrsnowflake.be" target="_blank">http://www.mrsnowflake.be</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
