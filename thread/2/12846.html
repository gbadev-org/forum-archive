<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Java: Read classes from jar - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>OffTopic > Java: Read classes from jar</h2>
<div id="posts">
<div class="post">
    <h4>#123408 - Mr Snowflake - Tue Mar 27, 2007 11:22 pm</h4>
    <div class="postbody"><span class="postbody">I'm <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=12492&amp;highlight=" target="_blank">back</a> with a Java question. I need to be able to read a class from a jar file, because I need to determine it's public functions, public method, public... well everything it's interface delivers to the public :). So my sollution is: Open the jar file with a JarFile object, get the JarEntries, and if they are '.class' write them, using a OutputStream, to a File.createTempFile() and then reflection load them to discover all the public stuff. Is this the way to go, or is my way too complicated and is there an other, easier way?<br/>_________________<br/><a class="postlink" href="http://www.mrsnowflake.be" target="_blank">http://www.mrsnowflake.be</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123413 - keldon - Wed Mar 28, 2007 12:05 am</h4>
    <div class="postbody"><span class="postbody"><a href="http://www.javaworld.com/javaworld/javatips/jw-javatip49.html" target="_blank">http://www.javaworld.com/javaworld/javatips/jw-javatip49.html</a>
<br/>
<br/>
I had more links but I don't know what happened to them.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123517 - gauauu - Wed Mar 28, 2007 8:08 pm</h4>
    <div class="postbody"><span class="postbody">Can't you just add a jar file to the classpath, and java will read any classes from it like normal classes.  You still might have to read the JarEntries from the jar file to find out what classes were in it, but I don't think you're going to have to go write the classes out to temp files.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123585 - ps2aich - Thu Mar 29, 2007 9:27 am</h4>
    <div class="postbody"><span class="postbody">You could try to use a separate Classloader for this (in case you know
<br/>
the fully qualified classnames already, but you can determine them e.g. with the method pointed out by keldon)
<br/>
<br/>
Try something like that (I haven't tested this code, simply wrote it as example without syntax checking and whatsoever):
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
URL[] urls = new URL[] {"file://c:\\mypath\\myjar.jar"};
<br/>
URLClassloader classLoader = URLClassLoader.newInstance(urls);
<br/>
<br/>
Class class = classLoader.loadClass("com.myCompany.myPackage.MyClass");
<br/>
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123596 - Mr Snowflake - Thu Mar 29, 2007 1:55 pm</h4>
    <div class="postbody"><span class="postbody">Thanks you all. 
<br/>
Thanks to Keldons link I discovered how to read the classes from the jar files and the page said I should use a custom ClassLoader class to load the classes. So that's what I'm going to do.
<br/>
I could add them to the classpath, but then I should be able to edit the classpath at runtime and I still need to find out which classes are in the jar. But this method would be better as Java itself will handle the jar reading. So can I change the classpath at runtime?
<br/>
<br/>
An other question, but not very related: Can I make a jar file which contains an other jar? I have a jar file with the gnu getopt methods for java. But I need to supplie them with my project, so I would be nicer/easier to get that jar also in the main jar.
<br/>
<br/>
Edit: I didn't completely see ps2's reply, but the URL loader thingy does indeed look very easy. So gonna try that. I already saw this method on the Java tutorial/documentation site, iirc, but already forgot about it :).<br/>_________________<br/><a class="postlink" href="http://www.mrsnowflake.be" target="_blank">http://www.mrsnowflake.be</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123602 - ps2aich - Thu Mar 29, 2007 4:06 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mr Snowflake wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
An other question, but not very related: Can I make a jar file which contains an other jar? I have a jar file with the gnu getopt methods for java. But I need to supplie them with my project, so I would be nicer/easier to get that jar also in the main jar.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Hm, you could try a Jar URL  to access this jar:-) (excerpt from the java online documentation):
<br/>
But I never saw this anywhere used, so no idea if it will really work.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">JAR URL
<br/>
The syntax of a JAR URL is:
<br/>
<br/>
jar:&lt;url&gt;!/{entry}
<br/>
<br/>
for example:
<br/>
<br/>
jar:http://www.foo.com/bar/baz.jar!/COM/foo/Quux.class
<br/>
jar:file:/export/home/faculty/stansif/public_html/java/applets/image/view.jar!/image.gif
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
so, if you build an url like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">jar:file:c:/mypath/myjar.jar!/innerjar.jar</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123603 - keldon - Thu Mar 29, 2007 4:09 pm</h4>
    <div class="postbody"><span class="postbody">A jar file is an archive; so you can put anything in it. If you want you can have nested jar files inside of nested jar files, all contained within a great big jar file. But you may be required to extract the jar file before delving into the next one.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123606 - ps2aich - Thu Mar 29, 2007 4:33 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>keldon wrote:</b></span></td> </tr> <tr> <td class="quote">A jar file is an archive; so you can put anything in it. If you want you can have nested jar files inside of nested jar files, all contained within a great big jar file. But you may be required to extract the jar file before delving into the next one.</td> </tr></table><span class="postbody">
<br/>
<br/>
I aggree that it perhaps will work with a depth of one (as stated in my last post), but I assume it
<br/>
will fail further on because I don't know the inner implementation of jar file handling
<br/>
(a jar is a zip file, so the classloader will have to held the 
<br/>
jar open all the time, and so on, I really dont know the limitations.),
<br/>
so you simply have to extract it.
<br/>
<br/>
Also performance may be a problem, depending on the implementation
<br/>
of the java vm, since opening a zipstream and accessing an inner jar
<br/>
has of course some overhead if the stream is not held open, but opened
<br/>
on each access, until all classes are in memory.
<br/>
<br/>
Since 3.2, the Eclipse Framework allows plugins as jars, and they do not recommend placing additional jars into a jar-plugin, but use the older plugin format (plugin is a directory, which contains the plugin jar and any additional needed jars).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123622 - Mr Snowflake - Thu Mar 29, 2007 5:59 pm</h4>
    <div class="postbody"><span class="postbody">Thanks again.
<br/>
<br/>
Yet another problem with the URLClassLoader:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">    Enumeration&lt;JarEntry&gt; jarEntries;
<br/>
    URL[] urls = null;
<br/>
    String userDir = System.getProperty("user.dir");
<br/>
    try{
<br/>
      urls = new URL[] {new URL("file://"+userDir+"/"+args[0])};
<br/>
    }catch(MalformedURLException ex){
<br/>
      System.out.println(ex);
<br/>
      System.exit(1);
<br/>
    }
<br/>
    System.out.println(urls[0].toString());
<br/>
    URLClassLoader classLoader = new URLClassLoader(urls);//URLClassLoader.newInstance(urls);
<br/>
    Vector&lt;String&gt; entries = new Vector();
<br/>
    try{
<br/>
      //fetch alle jar entries
<br/>
      JarFile jar = new JarFile(args[0]);
<br/>
      jarEntries = jar.entries();
<br/>
      JarEntry jarEntry = null;
<br/>
      for (; jarEntries.hasMoreElements();){
<br/>
        jarEntry = (JarEntry)jarEntries.nextElement();
<br/>
        if(!jarEntry.isDirectory())
<br/>
          entries.add(jarEntry.getName());
<br/>
      }
<br/>
      if(!entries.isEmpty())
<br/>
        for(String className:entries)
<br/>
          try{
<br/>
            System.out.println(className);
<br/>
            Class classTest = classLoader.loadClass(className);
<br/>
          }catch(ClassNotFoundException ex){
<br/>
            System.out.println(ex);
<br/>
          }
<br/>
    }catch(IOException ex){
<br/>
      System.out.println(ex);
<br/>
    }
<br/>
</td> </tr></table><span class="postbody">
<br/>
This is a test program to test the URLClassLoader. But when I try to load a jar file (java-gnu...jar) and it looks like I'm able to load the jar file from the url, but when I try to load any of the classes in the jar file, they can't be found... and I don't get an error when loading the jar with URLClassLoader.<br/>_________________<br/><a class="postlink" href="http://www.mrsnowflake.be" target="_blank">http://www.mrsnowflake.be</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123695 - ps2aich - Fri Mar 30, 2007 9:48 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mr Snowflake wrote:</b></span></td> </tr> <tr> <td class="quote">Thanks again.
<br/>
<br/>
Yet another problem with the URLClassLoader:
<br/>
This is a test program to test the URLClassLoader. But when I try to load a jar file (java-gnu...jar) and it looks like I'm able to load the jar file from the url, but when I try to load any of the classes in the jar file, they can't be found... and I don't get an error when loading the jar with URLClassLoader.</td> </tr></table><span class="postbody">
<br/>
<br/>
Hm, the classnames are fully qualified ("com.mypackage.myclass")?
<br/>
Or does the JarEntry delivers "com/mypackage/myclass.class"? Then you have to convert it to the format needed by the loadClass-Method(fully qualified, packages separated by ".").
<br/>
<br/>
<br/>
Have you tried to close the Jarfile after collecting the entries, and
<br/>
then create the URLClassloader and access the classes?
<br/>
Or some basic dummy test, not to work with the JarFile at all,
<br/>
but simply load a class thats fully qualified name is nown</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123701 - Mr Snowflake - Fri Mar 30, 2007 1:39 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ps2aich wrote:</b></span></td> </tr> <tr> <td class="quote">Hm, the classnames are fully qualified ("com.mypackage.myclass")?
<br/>
Or does the JarEntry delivers "com/mypackage/myclass.class"? Then you have to convert it to the format needed by the loadClass-Method(fully qualified, packages separated by ".").</td> </tr></table><span class="postbody">This sound very logical, I knew I needed fully qualified classnames, but I was mislead by the dir structure inside the jar... Gotta try this one.
<br/>
<br/>
Edit: It works now... Such a simple mistake... Ah well, thank you all for helping. I know where to find you with more questions ;).<br/>_________________<br/><a class="postlink" href="http://www.mrsnowflake.be" target="_blank">http://www.mrsnowflake.be</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
