<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>GCC + Win32 API lib 3.14 = Window + Icon! :?D [solved] - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>OffTopic > GCC + Win32 API lib 3.14 = Window + Icon! :?D [solved]</h2>
<div id="posts">
<div class="post">
    <h4>#155878 - silent_code - Sun May 04, 2008 11:47 pm</h4>
    <div class="postbody"><span class="postbody">hi,
<br/>
<br/>
can anyone give me a hint how to make the window icon show up when using the win32 api (3.14) with gcc (3.5)? i have tried almost everything and it won't show up!
<br/>
<br/>
i did it the ms vs style, that works with vs (it's quite well documented), but it won't work with gcc (i know it's not compiler related ;^D ).
<br/>
<br/>
what can i do? has anyone a working example? any URLs?
<br/>
<br/>
thanks in advance!</span><span class="gensmall"><br/><br/>Last edited by silent_code on Tue May 06, 2008 12:21 am; edited 2 times in total</span></div>    
</div>
<div class="post">
    <h4>#155890 - kusma - Mon May 05, 2008 9:58 am</h4>
    <div class="postbody"><span class="postbody">Uhm, can't you just fill out the hIcon-member of your WNDCLASS-structure (or hIcon and hIconSm if you're using WNDCLASSEX) with a handle to a valid icon (loaded with LoadIcon or LoadImage api functions)?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#155896 - silent_code - Mon May 05, 2008 11:18 am</h4>
    <div class="postbody"><span class="postbody">thanks, but i already tried that!
<br/>
<br/>
it will always give me that little "window" icon, although the correct icon is displayed in the task bar! X^|
<br/>
i tried it all...
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">//   windowClassEx.hIcon         = LoadIcon(NULL, IDI_APPLICATION);
<br/>
//   windowClassEx.hIcon         = LoadIcon(NULL, MAKEINTRESOURCE(IDR_ICON));
<br/>
//   windowClassEx.hIcon         = (HICON__*)LoadImage(hInstance, MAKEINTRESOURCE(IDR_ICON), IMAGE_ICON, GetSystemMetrics(SM_CXICON), GetSystemMetrics(SM_CYICON), LR_DEFAULTCOLOR);
<br/>
//   windowClassEx.hIcon         = LoadIcon(hInstance, m_ClassName);
<br/>
</td> </tr></table><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">//   windowClassEx.hIconSm      = LoadIcon(NULL, IDI_APPLICATION);
<br/>
//   windowClassEx.hIconSm      = LoadIcon(NULL, MAKEINTRESOURCE(IDR_ICON));
<br/>
//   windowClassEx.hIconSm      = (HICON__*)LoadImage(hInstance, MAKEINTRESOURCE(IDR_ICON), IMAGE_ICON, GetSystemMetrics(SM_CXSMICON), GetSystemMetrics(SM_CYSMICON), LR_DEFAULTCOLOR);
<br/>
</td> </tr></table><span class="postbody">
<br/>
.rc:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">//IDR_ICON   ICON MOVEABLE PURE LOADONCALL DISCARDABLE   "icon.ico"
<br/>
128 ICON DISCARDABLE "icon.ico"</td> </tr></table><span class="postbody">
<br/>
.h:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define IDR_ICON 128</td> </tr></table><span class="postbody">
<br/>
that makes me a sad panda. :^C
<br/>
<br/>
ps: OS is XP32SP2</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#155907 - kusma - Mon May 05, 2008 2:47 pm</h4>
    <div class="postbody"><span class="postbody">Check that windowClassEx.hIcon and windowClassEx.hIconSm isn't NULL. I tried at home with my mingw-install right after posting, and it worked just fine. The only difference from what I can see here, was that I loaded the icon from file, not resource (just by using the LR_LOADFROMFILE-flag), as I didn't want to find out how to include resources under mingw ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#155910 - silent_code - Mon May 05, 2008 4:12 pm</h4>
    <div class="postbody"><span class="postbody">including resources is easy. write a .rc file, compile it with windres and link it.
<br/>
<br/>
well, i'll try loading the damn thing from file, but i really don't want to ship a seperate .ico file when the icon is *obviously* in the .exe. i though i could get around this somehow. :^(
<br/>
<br/>
anyway, thanks for the tip. :^D</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#155914 - kusma - Mon May 05, 2008 4:43 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>silent_code wrote:</b></span></td> </tr> <tr> <td class="quote">including resources is easy. write a .rc file, compile it with windres and link it.
<br/>
</td> </tr></table><span class="postbody">
<br/>
I'll give it a go when I get home.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>silent_code wrote:</b></span></td> </tr> <tr> <td class="quote">well, i'll try loading the damn thing from file, but i really don't want to ship a seperate .ico file when the icon is *obviously* in the .exe.</td> </tr></table><span class="postbody">
<br/>
Of course, my suggestion was to check that it's non-null, not to put it in a separate file. There's a whole lot of things that can go wrong with the icons, I went through some of the same shit recently ;).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#155922 - kusma - Mon May 05, 2008 7:55 pm</h4>
    <div class="postbody"><span class="postbody">just tried, and everything works just fine here.
<br/>
<br/>
Here's my source code:
<br/>
test.cpp:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define WIN32_LEAN_AND_MEAN
<br/>
#include &lt;windows.h&gt;
<br/>
<br/>
int APIENTRY WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, int nCmdShow)
<br/>
{
<br/>
   WNDCLASSEX wcex;
<br/>
   wcex.cbSize        = sizeof(WNDCLASSEX);
<br/>
   wcex.style         = CS_HREDRAW | CS_VREDRAW;
<br/>
   wcex.lpfnWndProc   = DefWindowProc;
<br/>
   wcex.cbClsExtra    = 0;
<br/>
   wcex.cbWndExtra    = 0;
<br/>
   wcex.hInstance     = hInstance;
<br/>
   wcex.hIcon         = (HICON)LoadImage(wcex.hInstance, MAKEINTRESOURCE(128), IMAGE_ICON, GetSystemMetrics(SM_CXICON),   GetSystemMetrics(SM_CXICON),   0);
<br/>
   wcex.hIconSm       = (HICON)LoadImage(wcex.hInstance, MAKEINTRESOURCE(128), IMAGE_ICON, GetSystemMetrics(SM_CXSMICON), GetSystemMetrics(SM_CXSMICON), 0);
<br/>
   wcex.hCursor       = LoadCursor(NULL, IDC_ARROW);
<br/>
   wcex.hbrBackground = (HBRUSH)COLOR_WINDOW;
<br/>
   wcex.lpszMenuName  = NULL;
<br/>
   wcex.lpszClassName = "something";
<br/>
   RegisterClassEx(&amp;wcex);
<br/>
   
<br/>
   HWND hWnd = CreateWindow("something", "Icon test", WS_OVERLAPPEDWINDOW, CW_USEDEFAULT, 0, CW_USEDEFAULT, 0, NULL, NULL, hInstance, NULL);
<br/>
   ShowWindow(hWnd, nCmdShow);
<br/>
   UpdateWindow(hWnd);
<br/>
   
<br/>
   MSG msg;
<br/>
   while (GetMessage(&amp;msg, NULL, 0, 0))
<br/>
   {
<br/>
      TranslateMessage(&amp;msg);
<br/>
      DispatchMessage(&amp;msg);
<br/>
   }
<br/>
   return (int) msg.wParam;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
test.rc:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">128 ICON DISCARDABLE "test.ico"
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
compiled like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">windres.exe test.rc test.o
<br/>
g++ test.cpp test.o &amp;&amp; ./a.exe</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#155936 - silent_code - Mon May 05, 2008 11:11 pm</h4>
    <div class="postbody"><span class="postbody">oh, kusma, dear kusma, what would i do without you? if there were a third toystory movie, i'd most likely watch it, but...
<br/>
<br/>
thanks, i'll check it out asap! :^)
<br/>
<br/>
EDIT:
<br/>
<br/>
that did it!!!!
<br/>
<br/>
i'm going to behave like a man an say: THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU, THANK YOU!!!!
<br/>
<br/>
(does that count as ascii art?)
<br/>
<br/>
no really, thanks! :^)
<br/>
<br/>
btw: nice minimal win32 program :^D
<br/>
thanks, again. ;^)
<br/>
<br/>
EDIT2: wooooh, this is soooo cooool! &lt;hopps like a bunny - in a *square*&gt; (is that even healthy?)
<br/>
<br/>
for solving this quest, i would give you 50000 xp and 500 gil if i had any of it! ... and a mighty rat-flail on top of it! ;^D</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#155939 - kusma - Mon May 05, 2008 11:48 pm</h4>
    <div class="postbody"><span class="postbody">You're welcome, I'm glad it helped :)
<br/>
Just out of curiosity, what was really wrong?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#155940 - silent_code - Tue May 06, 2008 12:03 am</h4>
    <div class="postbody"><span class="postbody">i'm about to find out. come what may come, i will have to rewrite the whole window handling subsystem.
<br/>
i just needed a proof of concept. you code compiled and ran right away, so i have an example that i will use later. i really don't have a clue what was wrong there. as i said, the whole window handlig is bogus.
<br/>
honestly, i have thought of some really "spacey" ways to get that damn icon loaded... good i ask here in the forum, instead of wasting time (again). ;^)
<br/>
<br/>
as soon as i find out what was wrong, i'll post it here. :^D
<br/>
<br/>
it's 1:00 am, i think i'll be going to sleep... damn, i wanted to record that video for yellowstar... the whole damn thing (multisampling not working because of - guess what?- wndwHndl'g - in one project the setup works, in another it doesn't [not the same code, just the setup. it works in yet another proof of concept]) cost me so much time today. :^C
<br/>
<br/>
@ yellowstar: sorry!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#155942 - silent_code - Tue May 06, 2008 12:20 am</h4>
    <div class="postbody"><span class="postbody">NOTE: this post is intentionally seterate. (is that even propper english?)
<br/>
<br/>
just tested it in my code base and guess what? it works!
<br/>
you actually had a typo in (taking x-metrics for y-metrics). ;^D
<br/>
<br/>
well, looks like the only real difference is that i used an (HICON__*) cast and LR_DEFAULTCOLOR as the last parameter (instead of 0)...
<br/>
<br/>
now, the crazy thing is, that i uncommented the old line, that is simmilar to yours and GUESS WHAT? it worked, too!
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">windowClassEx.hIcon         = (HICON__*)LoadImage(hInstance, MAKEINTRESOURCE(IDR_ICON), IMAGE_ICON, GetSystemMetrics(SM_CXICON), GetSystemMetrics(SM_CYICON), LR_DEFAULTCOLOR);</td> </tr></table><span class="postbody">
<br/>
<br/>
THIS IS CRAZY!!!! TOTALLY NUTS!!!! what the heck?
<br/>
<br/>
in the life cycle of the code base, i went from win32 3.10 (or even older, can't remember) to 3.14, but it NEVER worked! never ever! as i said, i just uncommented a line that DID NOT work, but this time it worked! ????
<br/>
<br/>
console programming is SOOOO (&lt;----------------&gt;) much easier.
<br/>
<br/>
if kusma or anybody else has nothing to add, this thread can be closed (just wait a day, please. thank you.)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#155944 - kusma - Tue May 06, 2008 12:32 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>silent_code wrote:</b></span></td> </tr> <tr> <td class="quote">you actually had a typo in (taking x-metrics for y-metrics). ;^D</td> </tr></table><span class="postbody">
<br/>
Ah! Thanks a lot, I didn't catch that one. It's taken from my current boilerplate-code, and it's nice to get that corrected so I don't have to back-patch lots of small things later ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#155947 - silent_code - Tue May 06, 2008 12:46 am</h4>
    <div class="postbody"><span class="postbody">you're welcome. one hand washes the other, right? ;^D
<br/>
make also sure you use that define for the last parameter. :^)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#156132 - tepples - Wed May 07, 2008 2:06 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>silent_code wrote:</b></span></td> </tr> <tr> <td class="quote">EDIT2: wooooh, this is soooo cooool! &lt;hopps like a bunny - in a *square*&gt; (is that even healthy?)</td> </tr></table><span class="postbody">
<br/>
It depends on exactly how you're hopping. Some methods are harder on joints than others. Could you videotape yourself, bring the video into the computer, and then put it on a video sharing site so that all the I Am Not A Doctors can give you suggestions?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">for solving this quest, i would give you 50000 xp and 500 gil if i had any of it! ... and a mighty rat-flail on top of it! ;^D</td> </tr></table><span class="postbody">
<br/>
Do you play Animal Crossing: Wild World? I've heard that some people take bells instead of gil.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#156177 - silent_code - Wed May 07, 2008 12:56 pm</h4>
    <div class="postbody"><span class="postbody">hahahaha. :^D
<br/>
<br/>
no, i wasn't really hopping like a bunny. it was very close to what i felt like, though.
<br/>
<br/>
well, i don't play AC, haven't ever, but i play resident evil (offline on my ngc)... bullets anyone? or paper mario... or viewtiful joe or... metroid (samus doesn't even *have* bullest... i bet she could spare and energy tank, though. )</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#156765 - silent_code - Tue May 13, 2008 8:56 pm</h4>
    <div class="postbody"><span class="postbody">so, it looks like it's working now... without further changes. i just wonder what the heck happened? i haven't touched a line of code (even with "(HICON__*)")! damn.
<br/>
<br/>
what the heck? does anyone have an idea what might have caused that? as i said before, i didn't change anything (code, .rc, .ico, nothing!)
<br/>
<br/>
but i'm glad it finally works in all of my projects! ;^)<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
