<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>GBA key-press frequency ? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>OffTopic > GBA key-press frequency ?</h2>
<div id="posts">
<div class="post">
    <h4>#17491 - mathieu - Tue Mar 09, 2004 3:35 pm</h4>
    <div class="postbody"><span class="postbody">Hi, folks !
<br/>
<br/>
My question is a bit related to GBA development, but also a bit related to emulator development... So I guess "off-topic" is the best place. I was wondering if anyone knows up to how many keys-per-second can one press consecutively on a keypad. Even if you don't know, your experience of gamer may give you a thought that I'd love to hear.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17493 - poslundc - Tue Mar 09, 2004 4:15 pm</h4>
    <div class="postbody"><span class="postbody">It depends how quick your thumbs are. :P
<br/>
<br/>
Seriously, though, the GBA (like most game systems) isn't event-driven at a certain frequency. A key is either down or it is up. It is up to the game to decide how often it wants to check. Most GBA games run at 60 FPS and will check the state of the keys once each cycle, so that amounts to a rate of 60 times per second. There is nothing to stop the programmer from sitting in a tight loop that checks for a keypress on the order of millions of times per second, though.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17496 - mathieu - Tue Mar 09, 2004 4:38 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Seriously, though, the GBA (like most game systems) isn't event-driven at a certain frequency.</td> </tr></table><span class="postbody">
<br/>
<br/>
Yep, but an emulator is - it would be too costly to checkout for a key change on the host system after each single native CPU instruction interpreted, just to simulate the "asynchronous" nature of the GBA keypad.
<br/>
<br/>
Refreshing the virtual GBA paddle at a rate of 60 times per second seems good enough. My thumbs ain't so fast ^_^ .</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17499 - ampz - Tue Mar 09, 2004 5:10 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>mathieu wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Seriously, though, the GBA (like most game systems) isn't event-driven at a certain frequency.</td> </tr></table><span class="postbody">
<br/>
<br/>
Yep, but an emulator is - it would be too costly to checkout for a key change on the host system after each single native CPU instruction interpreted, just to simulate the "asynchronous" nature of the GBA keypad.</span></td> </tr></table><span class="postbody">
<br/>
Why?
<br/>
A emulator can certainly check the state of the keyboard keys when the GBA code reads the keypad IO register.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17500 - poslundc - Tue Mar 09, 2004 5:27 pm</h4>
    <div class="postbody"><span class="postbody">Of course, you also need to be able to handle keypad interrupts, which if you strictly want to follow the GBA's specification have to be tested for every cycle. This might be the kind of area where you can get away with doing a reduced-frequency check... I dunno.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17502 - tepples - Tue Mar 09, 2004 6:36 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>mathieu wrote:</b></span></td> </tr> <tr> <td class="quote">it would be too costly to checkout for a key change on the host system after each single native CPU instruction interpreted</td> </tr></table><span class="postbody">
<br/>
Would it be too slow to call the host system's input polling on every emulated scanline where 0x04000130 is read, or on about a dozen random scanlines throughout the frame if keypress interrupts are enabled? Some programs use keypress interrupts with the timer to generate a random seed and may detect that all keypresses happen on the same scanline, interpreting it as "you are running this on an emulator, you dirty pirate". I'll have to check it against the Game Boy Player, which may in fact poll only once every frame. Does Windows itself have keypress interrupts, that is, can DirectInput unblock a thread immediately when the state of a key changes?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17506 - ampz - Tue Mar 09, 2004 7:13 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">Of course, you also need to be able to handle keypad interrupts, which if you strictly want to follow the GBA's specification have to be tested for every cycle. This might be the kind of area where you can get away with doing a reduced-frequency check... I dunno.</td> </tr></table><span class="postbody">
<br/>
Why?
<br/>
The PC fires a interrupt when a key is pressed, the emulator can act on that interrupt.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17510 - tepples - Tue Mar 09, 2004 7:33 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ampz wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">Of course, you also need to be able to handle keypad interrupts, which if you strictly want to follow the GBA's specification have to be tested for every cycle. This might be the kind of area where you can get away with doing a reduced-frequency check... I dunno.</td> </tr></table><span class="postbody">
<br/>
Why?
<br/>
The PC fires a interrupt when a key is pressed, the emulator can act on that interrupt.</span></td> </tr></table><span class="postbody">
<br/>
First off, the operating system may prevent an application from being able to see that interrupt.
<br/>
<br/>
Second, not everybody plays with a keyboard. I personally play with an N64 controller through a USB adapter. Are USB joystick devices able to send interrupts to the host PC, or do they have to be polled?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17521 - Lupin - Tue Mar 09, 2004 8:54 pm</h4>
    <div class="postbody"><span class="postbody">Why do we actually need the input interrupt?
<br/>
<br/>
I don't really understand for what i can use the input interrupt (other than getting key press events)...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17528 - dagamer34 - Tue Mar 09, 2004 10:43 pm</h4>
    <div class="postbody"><span class="postbody">Some games like MegaMan Battle Network don't actually poll the key register but instead wait for an interrupt to change the state of some variable in the ROM. If you look in VBA, it will generate a keypad interrupt if any key is pressed if you want to know.
<br/>
<br/>
It saves cycles and some battery power in the long run.<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17532 - Lupin - Tue Mar 09, 2004 11:06 pm</h4>
    <div class="postbody"><span class="postbody">But how do i differentiate between key up and key down event?!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17554 - poslundc - Wed Mar 10, 2004 3:48 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lupin wrote:</b></span></td> </tr> <tr> <td class="quote">But how do i differentiate between key up and key down event?!</td> </tr></table><span class="postbody">
<br/>
<br/>
I'm fairly certain that the interrupts are triggered on key-down only.
<br/>
<br/>
Probably the most widespread/obvious use of the keypad interrupt (I'm only speculating, but it's an educated speculation) would be to do a soft reset on the A-B-Start-Select combination.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17605 - dagamer34 - Thu Mar 11, 2004 1:11 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">Probably the most widespread/obvious use of the keypad interrupt (I'm only speculating, but it's an educated speculation) would be to do a soft reset on the A-B-Start-Select combination. </td> </tr></table><span class="postbody">
<br/>
<br/>
Yeah, he's right about that. Fire up any Nintendo-published game and if you look at the key interrupt register, it will be set to A+B+Start+Select. That way, games don't need to constantly check for it in the main loop.<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17635 - mathieu - Thu Mar 11, 2004 5:12 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Does Windows itself have keypress interrupts, that is, can DirectInput unblock a thread immediately when the state of a key changes?</td> </tr></table><span class="postbody">
<br/>
<br/>
I don't know a lot about windows/DX, as I am planning to work with Linux/SDL.  Here keypresses are handled by "events" : define a thread that loops calling a function that waits for events (I presume this function is a sort of "system call" that halts the thread and waits for the system to send a wake on interrupt signal) and when an event is returned check its type, and do whatever you want with it.
<br/>
<br/>
I guess I can use that, using event-handlers to simulate the asynchronous peripherals (the keypad...), and a classical system of "I call you peripheral device simulation code every N cycles" for the synchronous ones (video, sound, and so on). But I can say good-bye to my idea of a common peripheral interface... Hard luck.
<br/>
<br/>
Thanks for your answers everyone, it's been really helpful :-).</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
