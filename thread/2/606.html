<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>HAM adding HAMlib junk - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>OffTopic > HAM adding HAMlib junk</h2>
<div id="posts">
<div class="post">
    <h4>#3105 - peebrain - Tue Feb 18, 2003 8:43 am</h4>
    <div class="postbody"><span class="postbody">So I'm just chilling with my editor and HAM devkit until I randomally decide to check out the actual binary HAM outputs.  I do NOT use HAMlib, I never call ham_Init or whatever, I choose to re-invent the wheel.  But in my binary I have all this hamlib stuff!  What's up with that?!  I got a ton of strings like:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
You cannot use Drawtext in BGMode 3-5   F_DISCNT_BGMODE_GET&lt;3   ham_InitText: you can only run the HAM text system in BGMode 0-2    (F_DISCNT_BGMODE_GET&lt;3) ham_InitText: in this BGMode, the bgno doesnt exist! try a different bgno   (ham_GetBgType(bgno)!=0xFF)  @ @  @@ @? @?tile.c  ham_InitMapSet: Invalid input for map_rot   !(map_rot&gt;1)    ham_InitMapSet:Invalid input for map_size   !(map_size&gt;3)   ham_InitMapSet: the Map you want to load is bigger than map_size/map_rot specified. STOP!   size_map_u16&gt;=size_u16  ham_InsertMapFragment:You cannot combine a rot map with a non rot map.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I do not want this junk in my binary.  Is there a way to remove HAMlib completely from the output file?  Edit a make file or something?  I love HAM, I hate HAMlib.  Or should I just stick to DevKitAdv?
<br/>
<br/>
~Sean<br/>_________________<br/><a href="http://www.pbwhere.com" target="_blank">http://www.pbwhere.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#3107 - tubooboo - Tue Feb 18, 2003 10:25 am</h4>
    <div class="postbody"><span class="postbody">just go into system/master.mak
<br/>
<br/>
and remove -lham from the linker configuration, thats all.
<br/>
<br/>
Emanuel<br/>_________________<br/>HAM author
<br/>
<a href="http://www.ngine.de" target="_blank">http://www.ngine.de</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#3130 - peebrain - Tue Feb 18, 2003 8:40 pm</h4>
    <div class="postbody"><span class="postbody">Umm... tried something similiar to that.  There is no -lham in master.mak but there is a bunch in standard-targets.mak.  I edited one line like so:
<br/>
<br/>
From (line 120):
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
$(PROGNAME).elf : $(OFILES)
<br/>
   $(LD) $(LDFLAGS) -o $(PROGNAME).elf $(OFILES) $(ADD_LIBS) -lafm -lham -lm -lc  -lstdc++ -lsupc++ -lgcc
<br/>
endif 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
To:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
$(PROGNAME).elf : $(OFILES)
<br/>
#   $(LD) $(LDFLAGS) -o $(PROGNAME).elf $(OFILES) $(ADD_LIBS) -lafm -lham -lm -lc  -lstdc++ -lsupc++ -lgcc
<br/>
   $(LD) $(LDFLAGS) -o $(PROGNAME).elf $(OFILES) $(ADD_LIBS) -lafm -lm -lc  -lstdc++ -lsupc++ -lgcc
<br/>
endif
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Then I get the following errors when I try to "make vba" it:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
C:\gbadev\mystuff\pwase30&gt;set PATH=C:\gbadev\ham\gcc-arm;C:\gbadev\ham\tools\win32;C:\WINDOWS\system32;C:\WINDOWS;C:\WINDOWS\System32\Wbem 
<br/>
<br/>
C:\gbadev\mystuff\pwase30&gt;set HAMDIR=C:\gbadev\ham 
<br/>
<br/>
C:\gbadev\mystuff\pwase30&gt;make vba 
<br/>
C:/gbadev/ham/gcc-arm/bin/arm-thumb-elf-as.exe   -mthumb-interwork  C:/gbadev/ham/system/crt0.s -ocrt0.o
<br/>
C:/gbadev/ham/gcc-arm/bin/arm-thumb-elf-gcc.exe    -I C:/gbadev/ham/gcc-arm/include -I C:/gbadev/ham/gcc-arm/arm-thumb-elf/include -I C:/gbadev/ham/include -I C:/gbadev/ham/system  -c -DHAM_HAM  -DHAM_MULTIBOOT  -DHAM_ENABLE_MBV2LIB  -O2  -DHAM_WITH_LIBHAM  -mthumb-interwork -mlong-calls -Wall -save-temps -fverbose-asm  pwase30.cpp 
<br/>
C:/gbadev/ham/gcc-arm/bin/arm-thumb-elf-ld.exe    -L C:/gbadev/ham/gcc-arm/arm-thumb-elf/lib/normal -L C:/gbadev/ham/gcc-arm/lib -L C:/gbadev/ham/gcc-arm/lib/gcc-lib/arm-thumb-elf/3.0.4/normal --script C:/gbadev/ham/system/lnkscript-afm  -o pwase30.elf crt0.o C:/gbadev/ham/gcc-arm/lib/gcc-lib/arm-thumb-elf/3.0.4/normal/crtbegin.o C:/gbadev/ham/gcc-arm/lib/gcc-lib/arm-thumb-elf/3.0.4/normal/crtend.o  pwase30.o  -lafm -lm -lc  -lstdc++ -lsupc++ -lgcc
<br/>
crt0.o: In function `IntrRet':
<br/>
crt0.o(.text+0x308): undefined reference to `IntrTable'
<br/>
C:/gbadev/ham/gcc-arm/lib/gcc-lib/arm-thumb-elf/3.0.4/normal/libgcc.a(__main.o): In function `__do_global_ctors':
<br/>
__main.o(.text+0xd0): undefined reference to `atexit'
<br/>
C:/gbadev/ham/gcc-arm/lib/gcc-lib/arm-thumb-elf/3.0.4/normal/libgcc.a(unwind-dw2-fde.o): In function `size_of_encoded_value':
<br/>
unwind-dw2-fde.o(.text+0x60): undefined reference to `abort'
<br/>
C:/gbadev/ham/gcc-arm/lib/gcc-lib/arm-thumb-elf/3.0.4/normal/libgcc.a(unwind-dw2-fde.o): In function `read_encoded_value_with_base':
<br/>
unwind-dw2-fde.o(.text+0x1e0): undefined reference to `abort'
<br/>
C:/gbadev/ham/gcc-arm/lib/gcc-lib/arm-thumb-elf/3.0.4/normal/libgcc.a(unwind-dw2-fde.o): In function `__register_frame':
<br/>
unwind-dw2-fde.o(.text+0x284): undefined reference to `malloc'
<br/>
C:/gbadev/ham/gcc-arm/lib/gcc-lib/arm-thumb-elf/3.0.4/normal/libgcc.a(unwind-dw2-fde.o): In function `__register_frame_table':
<br/>
unwind-dw2-fde.o(.text+0x348): undefined reference to `malloc'
<br/>
C:/gbadev/ham/gcc-arm/lib/gcc-lib/arm-thumb-elf/3.0.4/normal/libgcc.a(unwind-dw2-fde.o): In function `__deregister_frame_info_bases':
<br/>
unwind-dw2-fde.o(.text+0x404): undefined reference to `free'
<br/>
unwind-dw2-fde.o(.text+0x440): undefined reference to `abort'
<br/>
C:/gbadev/ham/gcc-arm/lib/gcc-lib/arm-thumb-elf/3.0.4/normal/libgcc.a(unwind-dw2-fde.o): In function `__deregister_frame':
<br/>
unwind-dw2-fde.o(.text+0x478): undefined reference to `free'
<br/>
C:/gbadev/ham/gcc-arm/lib/gcc-lib/arm-thumb-elf/3.0.4/normal/libgcc.a(unwind-dw2-fde.o): In function `base_from_object':
<br/>
unwind-dw2-fde.o(.text+0x4f0): undefined reference to `abort'
<br/>
C:/gbadev/ham/gcc-arm/lib/gcc-lib/arm-thumb-elf/3.0.4/normal/libgcc.a(unwind-dw2-fde.o): In function `get_cie_encoding':
<br/>
unwind-dw2-fde.o(.text+0x528): undefined reference to `strlen'
<br/>
C:/gbadev/ham/gcc-arm/lib/gcc-lib/arm-thumb-elf/3.0.4/normal/libgcc.a(unwind-dw2-fde.o): In function `start_fde_sort':
<br/>
unwind-dw2-fde.o(.text+0x1314): undefined reference to `malloc'
<br/>
unwind-dw2-fde.o(.text+0x1338): undefined reference to `malloc'
<br/>
C:/gbadev/ham/gcc-arm/lib/gcc-lib/arm-thumb-elf/3.0.4/normal/libgcc.a(unwind-dw2-fde.o): In function `end_fde_sort':
<br/>
unwind-dw2-fde.o(.text+0x13f4): undefined reference to `free'
<br/>
unwind-dw2-fde.o(.text+0x1434): undefined reference to `abort'
<br/>
unwind-dw2-fde.o(.text+0x1438): undefined reference to `abort'
<br/>
make: *** [pwase30.elf] Error 1
<br/>
&gt; Execution finished.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
... any tips?
<br/>
<br/>
~Sean<br/>_________________<br/><a href="http://www.pbwhere.com" target="_blank">http://www.pbwhere.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#3133 - CoolMan - Tue Feb 18, 2003 9:35 pm</h4>
    <div class="postbody"><span class="postbody">crt0.o(.text+0x308): undefined reference to `IntrTable' - Crt0 refers to a function pointer array which contains pointers to the various interrupt funcs. This array is called `IntrTable'. I guess HamLib defines IntrTable? (You can get an example of an IntrTable from <a href="http://www.thepernproject.com" target="_blank">www.thepernproject.com</a>)
<br/>
<br/>
As for the other stuff... It looks like you can link in libc (newlib) to fix that. (libc should definately define 'malloc', 'free', and 'strlen'. I'm not sure about 'abort'.)
<br/>
<br/>
Hope that helps.
<br/>
--Alex
<br/>
<br/>
(Feel free to correct me if I'm wrong.) :-)<br/>_________________<br/>Moron! You don't herd chickens with a shotgun!
<br/>
<br/>
--CoolMan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#3136 - peebrain - Tue Feb 18, 2003 9:46 pm</h4>
    <div class="postbody"><span class="postbody">What if I don't want all that crap?  I just want basic C/C++.  No malloc, no free, no strlen, I can code those myself.
<br/>
<br/>
~Sean<br/>_________________<br/><a href="http://www.pbwhere.com" target="_blank">http://www.pbwhere.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#3144 - tepples - Tue Feb 18, 2003 11:04 pm</h4>
    <div class="postbody"><span class="postbody">There is no such thing as "C/C++".  Do you want basic C, or do you want basic C++?  If you want basic C++, you're going to need some sort of malloc() to support operator 'new'.
<br/>
<br/>
The other stuff that's getting linked in seems to be called from the crt0.  If you're not going to be using HAMlib, I'd suggest using Jeff F's crt0 instead of the one that comes with HAMlib.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#3148 - CoolMan - Wed Feb 19, 2003 1:55 am</h4>
    <div class="postbody"><span class="postbody">According to thoes link errors...
<br/>
<br/>
The only thing that crt0 is referencing is IntrTable. This is as per Jeff's crt0 standard.
<br/>
<br/>
The other things are being referenced by libgcc. (the switch is "-lgcc")
<br/>
<br/>
If you get more link errors after taking out -lgcc, then your gonna need to figure out which lib is the culprit, and oust it. Unfortunately, methinks that this process will leave you with nothing in the lines of object oriented programming, or anything else externally useful. (Of course, if you truely want to 're-invent' the 'wheel', then you won't mind not having sin or cos, or any string manipulation funcs, etc.) :-\
<br/>
<br/>
Hope you get it working...
<br/>
--Alex<br/>_________________<br/>Moron! You don't herd chickens with a shotgun!
<br/>
<br/>
--CoolMan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#3170 - Quirky - Wed Feb 19, 2003 11:42 am</h4>
    <div class="postbody"><span class="postbody">Is this not partly the infamous "lib order matters" problem? I don't know why removing libham would make that much of a difference, but try placing -lm at the end. Could be wrong though.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#3178 - peebrain - Wed Feb 19, 2003 1:13 pm</h4>
    <div class="postbody"><span class="postbody">Ok, something is really screwed up... I tried re-installing HAM and now it doesn't work at all.  I don't know what I did wrong so I'm checking everything... *eyes wide open*
<br/>
<br/>
~Sean<br/>_________________<br/><a href="http://www.pbwhere.com" target="_blank">http://www.pbwhere.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#3179 - peebrain - Wed Feb 19, 2003 1:22 pm</h4>
    <div class="postbody"><span class="postbody">Ooook, this is odd...:
<br/>
<br/>
If I leave in -lham and never declare IntrTable, no errors.
<br/>
<br/>
If I leave in -lham and declare an array IntrTable, I get the "malloc" errors, etc...
<br/>
<br/>
If I take out -lham and never declare IntrTable, I get the "malloc" errors, along with the: crt0.o(.text+0x308): undefined reference to `IntrTable'
<br/>
<br/>
If I take out -lham and declare an array IntrTable, I get the "malloc" errors.
<br/>
<br/>
~Sean<br/>_________________<br/><a href="http://www.pbwhere.com" target="_blank">http://www.pbwhere.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#3183 - CoolMan - Wed Feb 19, 2003 2:32 pm</h4>
    <div class="postbody"><span class="postbody">Sounds like I'm very happy to be using devkitadv... :-\<br/>_________________<br/>Moron! You don't herd chickens with a shotgun!
<br/>
<br/>
--CoolMan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#3188 - Quirky - Wed Feb 19, 2003 4:03 pm</h4>
    <div class="postbody"><span class="postbody">Just a thought: try linking with gcc instead of ld. i.e. test out "LD = gcc" in your make file...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#3190 - CoolMan - Wed Feb 19, 2003 5:44 pm</h4>
    <div class="postbody"><span class="postbody">Using gcc (as a linker) is simply a frontend for ld.<br/>_________________<br/>Moron! You don't herd chickens with a shotgun!
<br/>
<br/>
--CoolMan</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
