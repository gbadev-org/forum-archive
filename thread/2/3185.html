<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>D3D Camera - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>OffTopic > D3D Camera</h2>
<div id="posts">
<div class="post">
    <h4>#18843 - StealthElement - Wed Apr 07, 2004 12:25 am</h4>
    <div class="postbody"><span class="postbody"><span style="color: darkblue">Has anyone tried to move their camera with the mouse? I got the tutorial from GameTutorials.com, but i didn't need a class as big as the ones they used. Actually, they didn't even use all of the functions in CVector. I created my own class and got the camera to rotate on the y-axis, but when i move the mouse up or down, everything is upside down. The cause isn't obvious to me at the moment; I'm still trying to understand the math...if you need some code listings, I'll show some</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18865 - Lupin - Wed Apr 07, 2004 12:23 pm</h4>
    <div class="postbody"><span class="postbody">uhm, i don't think that you'll find a lot of 3D programmers on this board, but I might be able to help you because i once wrote a simple 1st person camera for D3D.
<br/>
<br/>
You will have to convert the code to C++, but that's how it's done:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
Public Sub SetCam()
<br/>
Dim vAxis As D3DVECTOR, vView As D3DVECTOR
<br/>
Dim MatRot1 As D3DMATRIX, MatRot2 As D3DMATRIX
<br/>
<br/>
  If Not g_camera.bMovedSinceLastUpdate Then
<br/>
    Exit Sub
<br/>
  End If
<br/>
  ' To find the axis we need to rotate around for up and down
<br/>
  ' movements, we need to get a perpendicular vector from the
<br/>
  ' camera's view vector and up vector.  This will be the axis.
<br/>
  D3DXVec3Cross vAxis, g_camera.vViewDir, g_camera.vUp
<br/>
  D3DXVec3Normalize vAxis, vAxis
<br/>
<br/>
  D3DXMatrixRotationAxis MatRot1, vAxis, g_camera.fRotAboutUp
<br/>
  D3DXMatrixRotationAxis MatRot2, MakeVector(0, 1, 0), g_camera.fRotAboutRight
<br/>
  D3DXMatrixMultiply MatRot1, MatRot1, MatRot2
<br/>
  D3DXVec3TransformCoord vView, g_camera.vViewDir, MatRot1
<br/>
  D3DXVec3Normalize vView, vView 'make sure it's normalized
<br/>
  
<br/>
  'Initialize a variable for the cross product result
<br/>
  D3DXVec3Cross g_camera.vStrafe, vView, g_camera.vUp
<br/>
  D3DXVec3Normalize g_camera.vStrafe, g_camera.vStrafe
<br/>
  
<br/>
  g_camera.vViewDir = vView
<br/>
  
<br/>
  D3DXVec3Add g_camera.vView, g_camera.vPosition, vView
<br/>
<br/>
  D3DXMatrixLookAtLH matView, g_camera.vPosition, g_camera.vView, g_camera.vUp
<br/>
  D3Ddevice.SetTransform D3DTS_VIEW, matView
<br/>
<br/>
  g_camera.fRotAboutRight = 0
<br/>
  g_camera.fRotAboutUp = 0
<br/>
End Sub
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
This code is converted from the OGL camera tutorial of gt.com, they use to put their math routines into their own functions, if you want to use the D3DX functions you just have to know what's going on :)
<br/>
<br/>
The math behind it is quite complex (not too much though), I didn't fully understand it either :P<br/>_________________<br/><a class="postlink" href="http://pokeme.shizzle.it/" target="_blank">Team Pokeme</a>
<br/>
<a class="postlink" href="http://lupin.shizzle.it/" target="_blank">My blog and PM ASM tutorials</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18920 - Cearn - Thu Apr 08, 2004 9:33 am</h4>
    <div class="postbody"><span class="postbody">When you say upside-down, do you mean that the whole image is upside-down, or just that when you expect that you tilt your view up, it goes down and vice verca? In the latter case, this could probably be fixed with inverting your pitch angle. Somewhere, you should have something like 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
if(mouse forward)
<br/>
  pitch += angle_change
<br/>
else if(mous backward)
<br/>
  pitch -= angle_change
<br/>
</td> </tr></table><span class="postbody">
<br/>
Switching the -= and += should do the trick.
<br/>
<br/>
When in 3D space you have know exactly what axis or angle points in which direction, otherwise you're bound to mess these things up. If I remember correctly, this is especially true for D3D, since it uses a left-handed coordinate system instead of the more usual righthanded one, so sign mix-ups are pretty much guaranteed.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18979 - StealthElement - Fri Apr 09, 2004 3:19 am</h4>
    <div class="postbody"><span class="postbody"><span style="color: darkblue">Thanks a lot, really. It finally works now. By the way, the whole image was upside-down, but the tip is useful anyway for inverted preferences and stuff.</span></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
