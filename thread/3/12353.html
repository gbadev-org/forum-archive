<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>GBA Multiboot  Format - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Hardware > GBA Multiboot  Format</h2>
<div id="posts">
<div class="post">
    <h4>#117444 - Funky Gibbon - Sun Feb 04, 2007 10:05 pm</h4>
    <div class="postbody"><span class="postbody">Hi All,
<br/>
<br/>
I want to create an external hardware app for GBA without the need for a flash cart, it means carrying the firmware on the external device and using multiboot to get it into the GBA, something along the lines of the Majesco wireless messenger, the hardwares not a problem but i dont have a clue as to the multiboot protacol, is there someone who can point me in the right direction, or maybe atempted this project already
<br/>
<br/>
I have connected gps to GBA and talked to it serially, that had the software on a flash cart, i just think it would be cool to have a self contained device that doesn't need a cart
<br/>
<br/>
Thanks</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117449 - tepples - Sun Feb 04, 2007 10:23 pm</h4>
    <div class="postbody"><span class="postbody">GBATEK should tell everything you need to know about the GBA MultiBoot protocol.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117451 - Funky Gibbon - Sun Feb 04, 2007 10:37 pm</h4>
    <div class="postbody"><span class="postbody">So it does, and the amount of times i've looked at that document, guess i should have gone to spec savers, lol</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117638 - ZeroX - Tue Feb 06, 2007 6:59 am</h4>
    <div class="postbody"><span class="postbody">The GBA only has 256 + 32 KB of internal memory. You need to make sure your app is small enough.
<br/>
<br/>
My program XBOO XP is a multiboot rom transfer program. Its open source. So you can take a look at the code and see if it helps. Its not that hard, really. Ive put in comments i think. But i kinda forgot what i wrote, ever since i migrated to Linux.
<br/>
<br/>
You can find it in floating around somewhere. I submitted it to GBADev but they didnt take it in.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117649 - Diddl - Tue Feb 06, 2007 10:36 am</h4>
    <div class="postbody"><span class="postbody">I'm also interested in this multiboot. Where can I find sources of your XBOO XP?
<br/>
<br/>
I use multiboot with an old F2A cable, but I always have to change between F2A and GBA UART cable, so I'm searching for a better solution ...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117654 - Funky Gibbon - Tue Feb 06, 2007 10:55 am</h4>
    <div class="postbody"><span class="postbody">Hello ZeroX,
<br/>
<br/>
Im not too worried about memory as my app wont be graphic intensive, i've had a look at GBATEK, the document is so big i've never taken the time to read right though it, just skipped to the releant pages, it's not reall a multiboot cable im bulding, at the moment i dont have any hardware apps n mind  just want to get the multiboot transfer working from say a pic18f452 which has i2c, 8x adc's parallel port (full size gameboy printer maybe?), and 33 i/o pins, which could be PWM'd to drive servo's.
<br/>
All without the need of a flash cart because the .gba will be stored on th pc and transfered to the GBA
<br/>
i hope i done sound like Dr Frankenstein, i do have a day job too. lol
<br/>
Are you familiar with the Majesco Wireless messenger?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117662 - Diddl - Tue Feb 06, 2007 1:36 pm</h4>
    <div class="postbody"><span class="postbody">should not be a problem for the pic. it is very fast 16 bit protokoll while booting. after booting you can go over normal UART function of GBA.
<br/>
<br/>
but GBA has 3V and PIC should  use 5V, so a MAX3232 will be nessecary.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117670 - Funky Gibbon - Tue Feb 06, 2007 2:38 pm</h4>
    <div class="postbody"><span class="postbody">most of the new pic's will run down to 2.7v i think the 18f452 might even go down to 2.1v, but the exact figure escapes me at the moment, in my last post i said the program would be transfered from the pc, this was a typo, one of many now that i look back at the post, but it should have said transfered from the pic, but i think you understood that anyway.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117851 - ZeroX - Thu Feb 08, 2007 2:26 am</h4>
    <div class="postbody"><span class="postbody">Im an engineer too.
<br/>
<br/>
You want to do a multiboot transfer from a PIC to the GBA. You wont really need MAX232, 5V output going into a 3.3V GBA will work just fine. But dont blame me if anything explodes though. I think PIC comes in many models these days. Pick a lower voltage one.
<br/>
<br/>
Sounds like you need a cable to connect the PIC serial output to the GBA regardless of what you are doing, as well as learn the multiboot protocol.
<br/>
<br/>
All you need to do is read and understand these 2 functions in my source : Initialize() and SendMainData()
<br/>
<br/>
The function SendData(A,B,C,D) is sending 4 bytes (ABCD) in one transfer.
<br/>
<br/>
The CRC check is a pain. Just copy my code and you're good to go.
<br/>
<br/>
Heres my source
<br/>
<a href="http://cedega.firepipe.net/arundel/src/XBOOXP%20source.zip" target="_blank">http://cedega.firepipe.net/arundel/src/XBOOXP%20source.zip</a>
<br/>
<br/>
And the program
<br/>
<a href="http://cedega.firepipe.net/arundel/src/XBOO%20XP.zip" target="_blank">http://cedega.firepipe.net/arundel/src/XBOO%20XP.zip</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117885 - Diddl - Thu Feb 08, 2007 8:32 am</h4>
    <div class="postbody"><span class="postbody">@ZeroX
<br/>
<br/>
Thank you for the source code! I'm impressed of the small size of XBOO.com.
<br/>
<br/>
I will do the same for a Atmel Atmega for learning reasons. A GBA would be a nice graphic terminal for an atmel controller! But I will use a Max3232, cause Atmega will only work at 20MHz with 5V. Below the maximal frequency will decrease.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117889 - Funky Gibbon - Thu Feb 08, 2007 10:26 am</h4>
    <div class="postbody"><span class="postbody">Thanks ZeroX,
<br/>
I'll have a look at your source now, i can communicate fine in UART mode i just dont understand the multiboot method yet, hopefully your source will help there, the 18f452 has a selectable brownout voltage and i'm sure it goes down to 2.1v, like you say the voltage difference wont require a max232.
<br/>
Thanks to all for replies, i'll post comments on my progress incase anyone else is interested in this or their own project</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117922 - ZeroX - Thu Feb 08, 2007 7:04 pm</h4>
    <div class="postbody"><span class="postbody">By the way, UART is wont work. GBA serial communication is different. During multiboot, GBA uses Normal mode serial communication.
<br/>
<br/>
See the GBATek documentation on 16/32 bit Normal mode serial communication. There is a pin the master (in your case, this is the microcontroller) uses to pulse a clock signal. UART doesnt have this. But dont worry, its easy.
<br/>
<br/>
My code will only help you understand the protocol. The transfer part in my code uses the parallel port, so its a bit hard to understand.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117968 - Funky Gibbon - Thu Feb 08, 2007 11:06 pm</h4>
    <div class="postbody"><span class="postbody">Hello ZeroX,
<br/>
<br/>
The plan will be to switch to UART made after to booting is complete,
<br/>
thanks for the source btw.
<br/>
<br/>
the one crucial thing i needed to know was wether the GBA uses SD / SC or SI, SO, i've since found that bytes are sent recieved on SI &amp; SO and Clocked on SD, so i was wrong in all cases.
<br/>
<br/>
Im very happy tonight as the GBA Returned a value of 7202 to the pic, yes i know, only 2 steps of many into the boot sequence, it's cheered me up though as it's an expected value, send 0x6200 until 720x recieved, send 0x6202, recieced 0x7202, i beleve this to be correct as if i send anything other than 0x6202 i get no responce, but then someones gonna correct me now</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#118890 - Funky Gibbon - Sat Feb 17, 2007 9:47 pm</h4>
    <div class="postbody"><span class="postbody">Seems my excitement was somewhat premature, my progress is at a halt at the moment with work and family commitments.
<br/>
Im a bit confused after looking at ZeroX's Source as it seems to be sending data in 32 bit's at a time, i've tried this and cant get it to work, although i am using a different platform, here is a snippet of the debug data i get back from the Pic,
<br/>
<br/>
Send   Expected   Actual.
<br/>
6200 --- 0000 --- 0000
<br/>
6200 --- 720x --- 7202
<br/>
6102 --- 720x --- 6002 &lt;&lt;&lt; Fails Here
<br/>
2E00 --- nn0x --- 5F02
<br/>
00EA --- nn0x --- 5E02
<br/>
24FF --- nn0x --- 5D02
<br/>
AE51 --- nn0x --- 5C02
<br/>
<br/>
...... Sending Header .....
<br/>
<br/>
0000 --- nn0x --- 0402
<br/>
0000 --- nn0x --- 0302
<br/>
0000 --- nn0x --- 0202
<br/>
0070 --- nn0x --- 0102
<br/>
0000 --- nn0x --- 0002
<br/>
6200 --- 000x --- 7202
<br/>
6200 --- 720x --- 7202
<br/>
631C --- 73xx --- 73AE
<br/>
6414 --- 73xx --- 73EC
<br/>
1000 --- 73xx --- 00C0
<br/>
0000 --- nnnn --- 00C4
<br/>
EA00 --- nnnn --- 00C8
<br/>
0000 --- nnnn --- 00CC
<br/>
0000 --- nnnn --- 00D0
<br/>
0000 --- nnnn --- 00D4
<br/>
0000 --- nnnn --- 00D8
<br/>
<br/>
.... Sending Main Block ....
<br/>
<br/>
it still comes back with an unexpected result just 3 steps in to the process, but does seem to still work ok. if the data does'nt make much sense im following the GBATEK Document, it should make some sense then</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119087 - ZeroX - Mon Feb 19, 2007 3:16 pm</h4>
    <div class="postbody"><span class="postbody">Hi there.
<br/>
<br/>
Your problem is simple. Im gonna snip just the important part of GBATek for you to see (its kinda misaligned, so refer to the real one after this) :-
<br/>
<br/>
  Times  Send   Receive  Expl.
<br/>
  -----------------------Required Transfer Initiation in master program
<br/>
  ...    6200   FFFF     Slave not in multiplay/normal mode yet
<br/>
  1      6200   0000     Slave entered correct mode now
<br/>
  15     6200   720x     <span style="font-weight: bold">Repeat 15 times, if failed: delay 1/16s and restart</span>
<br/>
  1      610y   720x     Recognition okay, exchange master/slave info
<br/>
  60h    xxxx   NN0x     Transfer C0h bytes header data in units of 16bits
<br/>
  1      6200   000x     Transfer of header data completed
<br/>
  1      620y   720x     Exchange master/slave info again
<br/>
  ...    63pp   720x     Wait until all slaves reply 73cc instead 720x
<br/>
  1      63pp   73cc     Send palette_data and receive client_data[1-3]
<br/>
  1      64hh   73uu     Send handshake_data for final transfer completion
<br/>
  -----------------------Below is SWI 25h MultiBoot handler in BIOS
<br/>
  DELAY  -      -        Wait 1/16 seconds at master side
<br/>
  1      llll   73rr     Send length information and receive random data[1-3]
<br/>
  LEN    yyyy   nnnn     Transfer main data block in units of 16 or 32 bits
<br/>
  1      0065   nnnn     Transfer of main data block completed, request CRC
<br/>
  ...    0065   0074     Wait until all slaves reply 0075 instead 0074
<br/>
  1      0065   0075     All slaves ready for CRC transfer
<br/>
  1      0066   0075     Signalize that transfer of CRC follows
<br/>
  1      zzzz   zzzz     Exchange CRC must be same for master and slaves
<br/>
<br/>
<br/>
<br/>
Ok, I've bolded the part where you've made your mistake. Kinda self explanatory.
<br/>
<br/>
<span style="font-weight: bold">You should repeat 0x6200 at least 15 times. In your table, it seems you only did it once.</span> Notice the number 15 in the "times" column.
<br/>
<br/>
You should always refer to the GBATek Multiboot table, specifically the one I've snipped.
<br/>
<br/>
Cheers. Hopefully that should get you going again.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119124 - Funky Gibbon - Mon Feb 19, 2007 11:15 pm</h4>
    <div class="postbody"><span class="postbody">Thanks ZeroX
<br/>
I understand the principal im just not so good at putting it into practice
<br/>
it's gets very frustrating for me after a while.
<br/>
Thanks for your input
<br/>
Shaun</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
