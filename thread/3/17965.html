<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Supercard SD - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Hardware > Supercard SD</h2>
<div id="posts">
<div class="post">
    <h4>#178029 - WriteASM - Mon Aug 05, 2013 4:01 pm</h4>
    <div class="postbody"><span class="postbody">Am looking at a Supercard Mini SD adapter for GBA/DS devving, but have a question.  Does anyone know whether the SD card can be accessed from the GBA?  I know that the Supercard supports gamesave, but that's only ~64K, which doesn't count for me.
<br/>
<br/>
It would be fun to make an audio recorder--connect a codec chip to the link port, and there's the SD card adapter in the slot.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#178030 - Dwedit - Wed Aug 07, 2013 2:31 pm</h4>
    <div class="postbody"><span class="postbody">Yes it can be accessed from the GBA.  Libfat should work with it.
<br/>
Libfat was originally written for the GBA and the GBA Movie Player, then it expanded to the NDS and other cards, and later to the Gamecube/Wii.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#178031 - WriteASM - Wed Aug 07, 2013 4:31 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for the reply.  I had figured that if the card had software for video and audio playback, there had to be a means of accessing the data on the card!  Will do.<br/>_________________<br/>"Finally, brethren, whatever is true, whatever is honorable, whatever is right, whatever is pure, whatever is lovely, whatever is of good repute, if there is any excellence and if anything worthy of praise, dwell on these things." (Philippians 4:8)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#178056 - WriteASM - Sat Aug 24, 2013 2:26 pm</h4>
    <div class="postbody"><span class="postbody">OK, now I have a Supercard Mini SD.  It works pretty good, but the DevKitPro "biosdumper" example does not work.  I tried the Win32 GUI "DLDI patcher", and it says that the binary does not have a DLDI section.
<br/>
<br/>
I did find the libfat source, and would like to port it to ASM for my projects (retaining DLDI-patching ability), which would probably help data transfer speed.  That is, only if it works!  
<br/>
An ASM port would probably help the binary's size as well: the very simple "BiosDumper" binary is 90KB (and my far more complicated 100% ASM "bASMic" is 46K.)  Looking at the DLDI source for the Supercard SD, it appears that the Supercard only provides direct access to the SD card.  In other words, does libfat have to know the SD communication protocol?  Or is that the responsibility of the DLDI file?
<br/>
<br/>
For some reason, the "GBA Movie Player" (Filmplay.gba) doesn't work correctly on the GBA--videos are a garbled diagonal-sliding mess that doesn't resemble the input at all.  (The audio is correct, although very low quality.)  Perhaps "GBA Movie Player Movie Converter 1.3" isn't compatible with "GBA Movie Player 1.3"?  Or is something else wrong?
<br/>
<br/>
One last thing: I'm not sure how this affects compatibility, but the Supercard's gamesave memory area doesn't appear to behave like a FLASH chip <span style="font-style: italic">or </span>an SRAM chip.  It acts more like an SRAM chip...but then refuses writes.  Any suggestions?<br/>_________________<br/>"Finally, brethren, whatever is true, whatever is honorable, whatever is right, whatever is pure, whatever is lovely, whatever is of good repute, if there is any excellence and if anything worthy of praise, dwell on these things." (Philippians 4:8)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#178057 - Dwedit - Sat Aug 24, 2013 6:22 pm</h4>
    <div class="postbody"><span class="postbody">Supercard has non-battery backed SRAM, so you need to power off then quickly power on again to get it to save.
<br/>
<br/>
Data transfer speed isn't limited by how fast the code is, it's limited by the card reading hardware.  There is additional latency when it has to wait for the device to become ready, and then there are necessary time delays added to reads and writes.
<br/>
<br/>
If you need something lighter than libfat, you can use the previous versions of the filesystem, they're called GBA_NDS_FAT.  I once had to heavily reduce the stack usage of the driver, and moved some sector-sized arrays into statically allocated memory instead of stack ram.
<br/>
Only problem is that GBA_NDS_FAT sometimes has filesystem corruption problems, libfat got all the bugfixes since to fix them.
<br/>
There's also the really old version of the filesystem called GBAMP_CF that was intended solely for the original GBA Movie Player.
<br/>
<br/>
And yes, the DLDI driver is responsible for containing all the code to read and write sectors from the disk.  This was done so that card manufacturers could provide a driver and existing homebrew would work.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#178058 - WriteASM - Sun Aug 25, 2013 1:31 pm</h4>
    <div class="postbody"><span class="postbody">Thanks, Dwedit.  Yes, I am aware that the Supercard needs a power cycle to get to the menu to save the data.  I was just about to list the source code I was using to save data, and...bummer, my bad!  Using the wrong register for the address won't exactly get the desired result :-).
<br/>
I'm not sure if this means anything, but most of the Supercard software export settings have to be disabled to make anything function, including the GBA Movie Player.
<br/>
<br/>
It seems that all of the DLDI patching utilities are for Nintendo DS binaries.  The Supercard software has an automatic Patch, but that always comes up "Fail."  I would note that I got stuck with Windoze 8 (regular), which is pretty bad with compatibility.  Too many "permissions."  
<br/>
Do you know of any GBA binaries that write to a memory card with DLDI?  (Source code would be appreciated as well.)  As I mentioned the DevKitPro BIOSDumper example doesn't work.
<br/>
<br/>
Hmm...transfer speed not limited by code...?  If the code has to wait for each SD command to finish, then the delay between each command is, well, code-based: the faster the commands come, the higher the data rate.  Of course, the CLK rate also determines the data speed.  A good PC card reader can get 10MBytes/sec in/out from an SD card, requiring a clock rate of 100MHz or higher!  I doubt the Supercard provides a clock rate that high.
<br/>
<br/>
P.S. Discovered that the link port's shift-clock serial mode can be used while the link port is set to GPIO mode...just as long as the required pins are inputs.  Surprise!<br/>_________________<br/>"Finally, brethren, whatever is true, whatever is honorable, whatever is right, whatever is pure, whatever is lovely, whatever is of good repute, if there is any excellence and if anything worthy of praise, dwell on these things." (Philippians 4:8)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
