<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Flash2Advance FAILS with GBA SP! Drat! - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Hardware > Flash2Advance FAILS with GBA SP! Drat!</h2>
<div id="posts">
<div class="post">
    <h4>#4188 - cesium - Sun Mar 23, 2003 12:09 am</h4>
    <div class="postbody"><span class="postbody">Just picked up a GBA SP 15 mins ago. Popped in my Flash2Advance
<br/>
128M cart. I ran F2AW13NT. It sends over the i-Linker just fine.
<br/>
Software reports that it finds i-Linker. But then it says....
<br/>
Flash not found!!!
<br/>
<br/>
What!? I tried running with the re-charger plugged into the wall.
<br/>
Same result.
<br/>
<br/>
I'll let it charge for an hour and try again...
<br/>
<br/>
Back in an hour.
<br/>
<br/>
cesium</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4191 - cesium - Sun Mar 23, 2003 2:03 am</h4>
    <div class="postbody"><span class="postbody">No joy yet.
<br/>
<br/>
Does your Flash2Advance work in the SP?
<br/>
<br/>
cesium</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4192 - cesium - Sun Mar 23, 2003 2:32 am</h4>
    <div class="postbody"><span class="postbody">I fully charged GBA-SP. I still can't get the F2A writer to work.
<br/>
<br/>
I upgraded to ver 2.0 (f2aw20nt), no luck.
<br/>
<br/>
I went back to the original GBA: I can write to the flash just fine.
<br/>
I then put this flash in the GBA-SP, it runs great.
<br/>
<br/>
I simply cannot write to the flash from i-Linker. At several points
<br/>
in the tinkering I saw different behaviors from the i-Linker code.
<br/>
Sometimes it said it didn't recognize the type of cart,
<br/>
other times it wrote garbage out to its little text region.
<br/>
<br/>
I give up.
<br/>
<br/>
cesium
<br/>
<br/>
PS, I think I'll go take a bath. (Get it? cesium + H2O = boom!).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4194 - mbcook - Sun Mar 23, 2003 3:49 am</h4>
    <div class="postbody"><span class="postbody">Just a guess, but here is what I think is going on:
<br/>
<br/>
The GBA SP has an internal battery (as we all know) and that might be the problem. My guess would be that because it takes more current to write to flash (than to read it), you can't write to the cart because the GBASP won't give you enough current. Chances are that the GBA (with it's AAs) can give you that much current.
<br/>
<br/>
I would expect that plugging the thing into the wall would fix the problem, but you said it didn't. Now if the power sequence was like this:
<br/>
<br/>
Battery
<br/>
|
<br/>
|
<br/>
+---- Electronics
<br/>
|
<br/>
|
<br/>
AC
<br/>
<br/>
So that the AC bypassed the battery, I would expect that it would work. But it's possible that it's not setup that way. It could be setup like so:
<br/>
<br/>
AC-----Battery---Electronics
<br/>
<br/>
In this way, even with it plugged in, you're still limited by the battery. This could be the cause. OK, now that I'm looking at it, it looks more like it's the second case. The battery provides 3.6v, the AC adapter provides 5.2. That means it's probably the second case. Now let's see about current.
<br/>
<br/>
The GBA SP battery is rated at 600mah (according to a picture of it on lik-sang). Looking on the net standard AA batteries (alkaline) have at least 1200mah (double what the internal battery has). In fact, many AAs have 2500mah. Now in high draw devices, they won't give you their full performance, but the point is that they can supply lots more current.
<br/>
<br/>
After looking around the 'net for about 15 minutes I found a datasheet for a NEC flash chip (the brand used in your flash cart, don't know if it's the same one). That chip required 3-4x as much current to program it as it did to read it. I think it's quite possible that it just won't work on the GBA SP unless they (Visorly or whoever) redesigns the cart to need less current.
<br/>
<br/>
But please note: the GBA was never designed for in system flash programming like you're using it for. When you buy a product like that, that DEPENDS on an ablility that isn't officially there, you run a large risk that a redesign of the product will "break" your device. I suggest that you either just program things in your GBA (non SP), or you buy a cart programmer (I have Visorly's USB one for the GBA, very nice). Please don't fault Nintendo for unliscenced 3rd party stuff. If it was licensed and it didn't work that would be one thing, but you run risks with stuff like this.<br/>_________________<br/>--Michael</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4195 - cesium - Sun Mar 23, 2003 5:12 am</h4>
    <div class="postbody"><span class="postbody">Interesting explanation. I'll look at bit closer at the Intel Advanced
<br/>
Boot Block Flash data sheet (28F320B3) (Not NEC), to see if the
<br/>
currents take a jump.
<br/>
<br/>
Hmmm, so I wonder what are reasonable currents that can be drawn
<br/>
from the cart interface lines for peripherals that plug in there.
<br/>
<br/>
Do things like the TV Tuner and camera steal their power from
<br/>
somewhere else?
<br/>
<br/>
I see your point about using a stand-alone cart programmer. But
<br/>
I am bummed because I wanted to provide users of my product
<br/>
with the ability to download software updates from the WEB and
<br/>
re-flash the cart "in system." Now that I look at it, the Intel
<br/>
StrataFlash chips that I am planning to use in my cart design
<br/>
can really suck some current when erasing
<br/>
and programming. I guess I could always design a flash
<br/>
programmer into my CPLD and add a power supply. Boy that
<br/>
cart would be crowded!
<br/>
<br/>
I'll write some code to read the Device Code and Manufacturer ID,
<br/>
(That shouldn't eat much current should it?) just to test
<br/>
writing to the flash chip's state machine.
<br/>
<br/>
Thanks for the helpful and insightful reply,
<br/>
cesium
<br/>
<br/>
PS: Of course, I am not faulting Nintendo for this situation. Did my posts
<br/>
imply that? If so, that was not my intention.
<br/>
<br/>
Also, I'll simply draw some current from the VCC supply and map
<br/>
its DC output impedance. I really need to know if this is a show stopper
<br/>
for my design.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4205 - ampz - Sun Mar 23, 2003 2:47 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>mbcook wrote:</b></span></td> </tr> <tr> <td class="quote">Just a guess, but here is what I think is going on:
<br/>
The GBA SP has an internal battery (as we all know) and that might be the problem. My guess would be that because it takes more current to write to flash (than to read it), you can't write to the cart because the GBASP won't give you enough current. Chances are that the GBA (with it's AAs) can give you that much current.
<br/>
...
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
No, that's not it.
<br/>
First of all, writing to flash doesn't require much current.
<br/>
Second, if your explanation is correct, then the GBA supervisorcircuit would kick in and reset the entire GBA when you try to draw too much current.
<br/>
One explanation might be that Nintendo has disabled the write ability to the 16bit cart bus altogether. A quick check with a logic probe or a osciloscope could answer that.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4207 - tepples - Sun Mar 23, 2003 3:27 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ampz wrote:</b></span></td> </tr> <tr> <td class="quote">One explanation might be that Nintendo has disabled the write ability to the 16bit cart bus altogether. A quick check with a logic probe or a osciloscope could answer that.</td> </tr></table><span class="postbody">
<br/>
If a future GBA were to disable the Game Pak connector's write enable entirely, then games with EEPROM save would fail.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4209 - cesium - Sun Mar 23, 2003 4:52 pm</h4>
    <div class="postbody"><span class="postbody">I made a couple of observations this morning.
<br/>
<br/>
Using the original GBA (I'll call it TOGBA :) I sent over a program on the
<br/>
multilink cable to read the manufacturer code and device code of the
<br/>
flash chips. We know from previous work that you must write the
<br/>
Visoly preamble to the cart in order to enable writing to the flash
<br/>
chips. Also, the Intel Command User Interface (CUI) requires writing
<br/>
to the flash chips in order to read the manufacturer code and device code.
<br/>
<br/>
This works on TOGBA:
<br/>
Manufacturer Code=0x0089 (Intel. Correct value.)
<br/>
Device Code=0x8896 (28F320B3T. Correct value.)
<br/>
<br/>
So I did the same thing with the GBASP running on batteries.
<br/>
Manufacturer Code=0x0089 (Intel. Correct value.)
<br/>
Device Code=0x8896 (28F320B3T. Correct value.)
<br/>
<br/>
Apparently I can write to the flash chips' CUI state machine.
<br/>
<br/>
I can identify the flash chips, but i-Linker cannot.
<br/>
How odd.
<br/>
<br/>
Can anyone get the Flash2Advance system working on GBASP?
<br/>
<br/>
cesium (with a little cesium hydroxide)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4211 - ampz - Sun Mar 23, 2003 8:11 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ampz wrote:</b></span></td> </tr> <tr> <td class="quote">One explanation might be that Nintendo has disabled the write ability to the 16bit cart bus altogether. A quick check with a logic probe or a osciloscope could answer that.</td> </tr></table><span class="postbody">
<br/>
If a future GBA were to disable the Game Pak connector's write enable entirely, then games with EEPROM save would fail.</span></td> </tr></table><span class="postbody">
<br/>
True, but a simple adress decoder could solve that.
<br/>
Doesn't matter, as cesium notes, that does not seem to be the case anyway.
<br/>
How about wait states? Perhaps the SP boots at a different waitstate setting?
<br/>
It can really be one of many things.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4215 - cesium - Sun Mar 23, 2003 10:37 pm</h4>
    <div class="postbody"><span class="postbody">Hmmm,
<br/>
I should dump the waitstate config register to the screen
<br/>
when my code starts up. I don't change it myself but there's
<br/>
a butt-load of startup code from devkit and Jeff that I have not
<br/>
read through. It might fiddle with it to produce a NULL result
<br/>
experiment.
<br/>
<br/>
cesium
<br/>
<br/>
(Don't call me caesium.)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4217 - cesium - Mon Mar 24, 2003 12:12 am</h4>
    <div class="postbody"><span class="postbody">The waitstate reg (0x04000204) comes up 0x0000 on
<br/>
both the original GBA (TOGBA) and the GBASP.
<br/>
<br/>
The supply voltage on the cart is a FIRM 3.300 volts throughout
<br/>
the Flash2Advance's attempt to ID the Flash cart. No sag here.
<br/>
<br/>
cesium
<br/>
(9192631770 and counting.)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4218 - mbcook - Mon Mar 24, 2003 3:54 am</h4>
    <div class="postbody"><span class="postbody">Well, it doesn't seem to be a voltage problem, or a current problem. We know the cart works because it works in your origional GBA. Well, maybe the answers to these questions can help us figure out what is going on.
<br/>
<br/>
1. Have you tried it in another GBA SP? Do you have access to one?
<br/>
2. I assume you can still use the cart to play games on the GBA SP, you just can't write to it, correct?
<br/>
3. Have you missed any ritualistic sacrifices to the GBA gods this month?
<br/>
<br/>
OK, maybe that last one won't help much. But I'm quite interested in the answer to #1. Maybe it's just your unit for some reason.<br/>_________________<br/>--Michael</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4220 - FluBBa - Mon Mar 24, 2003 11:50 am</h4>
    <div class="postbody"><span class="postbody">Has anyone dumped the BIOS from the SP yet?
<br/>
I don't know about revers enginering it, but maybe a simple filecompare can come up with somethings =)
<br/>
<br/>
/FluBBa<br/>_________________<br/>I probably suck, my not is a programmer.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4221 - ampz - Mon Mar 24, 2003 12:51 pm</h4>
    <div class="postbody"><span class="postbody">As far as I know, no one have even fully reverse engineered the original GBA BIOS..</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4244 - cesium - Tue Mar 25, 2003 5:05 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>mbcook wrote:</b></span></td> </tr> <tr> <td class="quote">1. Have you tried it in another GBA SP? Do you have access to one?
<br/>
</td> </tr></table><span class="postbody">
<br/>
Nope. I only have 1 of these babys.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>mbcook wrote:</b></span></td> </tr> <tr> <td class="quote">2. I assume you can still use the cart to play games on the GBA SP, you just can't write to it, correct?
<br/>
</td> </tr></table><span class="postbody">
<br/>
That's right. I can play games off the flash cart just fine.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>mbcook wrote:</b></span></td> </tr> <tr> <td class="quote">3. Have you missed any ritualistic sacrifices to the GBA gods this month?
<br/>
</td> </tr></table><span class="postbody">
<br/>
Doh! I ran out of sacrificial AA batteries!
<br/>
<br/>
I really can't believe that I'm the only one on this forum that has
<br/>
a GBASP and a Flash2Advance cart. Has anyone else had it work?
<br/>
<br/>
Could someone please cross post this question to other boards/forums
<br/>
that they frequent?
<br/>
<br/>
Thanks,
<br/>
cesium
<br/>
(Don't call me caesium!)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4266 - ronin64 - Wed Mar 26, 2003 9:26 am</h4>
    <div class="postbody"><span class="postbody">Does this problem with Flash2Advance on the GBA SP mean that there will be a similar problem for the GBA SP and the GameWallet?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4280 - gb_feedback - Wed Mar 26, 2003 1:57 pm</h4>
    <div class="postbody"><span class="postbody">Over on the gbaemu boards there are people the F2A does work for, as well as people it doesn't. Someone suggested you have to have the light off. I wouldn't know - they haven't released the SP here yet.<br/>_________________<br/><a class="postlink" href="http://www.bookreader.co.uk/" target="_blank">http://www.bookreader.co.uk/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4284 - Tseng - Wed Mar 26, 2003 3:56 pm</h4>
    <div class="postbody"><span class="postbody">I've got a SP and a 256 F2A.  When I first got the SP, everytime I flashed the cart it would give me odd bugs when I started it up (distorted GB title screen or the games wouldn't run on Pogoshell) so I just used my old GBA for flashing instead.
<br/>
<br/>
However, I tried it again yesterday and turned the light off as numerous people have suggested and it works fine.  That's really the only advice I can give, is to have the light off before you start flashing.  Doubt it'll help though, since even with the light on there's no reason the i-Linker shouldn't be detected.
<br/>
<br/>
Good luck.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4301 - mbcook - Wed Mar 26, 2003 11:17 pm</h4>
    <div class="postbody"><span class="postbody">Tseng, that makes absolutly no sense. Therefor, it must be the correct answer. Who knows why. Don't you love electronics?<br/>_________________<br/>--Michael</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4303 - ampz - Wed Mar 26, 2003 11:20 pm</h4>
    <div class="postbody"><span class="postbody">Gee... Well... If the GBA SP power supply is _very_ poorly decoupled then I guess it could make a difference...
<br/>
<br/>
The light, does it have adjustable brightness?</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
