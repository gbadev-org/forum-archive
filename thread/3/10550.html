<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>accessing RTC on Procard 128M - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Hardware > accessing RTC on Procard 128M</h2>
<div id="posts">
<div class="post">
    <h4>#94988 - pproc - Thu Jul 27, 2006 6:17 am</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
Does anyone have source code examples for accessing the real-time clock on the Procard 128M - this is supposed to be a "lite" version of Xcarts flash card.
<br/>
<br/>
Thanks !</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#95109 - Sausage Boy - Thu Jul 27, 2006 10:26 pm</h4>
    <div class="postbody"><span class="postbody">I assume the way to access the RTC would be the same in every cart, since they would want it to be compatible with teh romz. How it is actually done, I don't know.<br/>_________________<br/>"no offense, but this is the gayest game ever"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#95152 - dantheman - Fri Jul 28, 2006 1:47 am</h4>
    <div class="postbody"><span class="postbody">It doesn't include sourcecode, but you could try using the RTC utility from the X-ROM tools kit.  It's a multiboot program that accesses the X-ROM's RTC, although I have had success using it on my Flash2Advance Ultra cart.  It sometimes doesn't work right though.  I've found that it never works when I actually send it through multiboot, and it only works with Multiboot Menu when I flash it separately from everything else.  I haven't done too much testing, but that is what seems to be the case.
<br/>
<br/>
There is also another RTC demo out there that actually has sourcecode with it.  Google for "gba rtc" to find it.
<br/>
<br/>
EDIT:  there also appears to be a few RTC programs with sourcecode at <a href="http://www.pat.hi-ho.ne.jp/sata68/gba.shtml" target="_blank">http://www.pat.hi-ho.ne.jp/sata68/gba.shtml</a> although it's all in Japanese.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#95163 - pproc - Fri Jul 28, 2006 3:20 am</h4>
    <div class="postbody"><span class="postbody">I found Timothy Brolins (ampz) rtc source code and am testing with this. 
<br/>
<br/>
The above links led me to <a href="http://www.sii.co.jp" target="_blank">http://www.sii.co.jp</a> and the data sheet for the RTC - it is a Seiko Instruments S3511 or derivative. Datasheet attached. Unfortunately in Japanese, but there are some timing diagrams and indication of the response bytes. Looks like an SPI interface.
<br/>
<br/>
Will let you know if I am successful - thanks a lot for the pointers !</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#95233 - pproc - Fri Jul 28, 2006 8:54 am</h4>
    <div class="postbody"><span class="postbody">I tested with T. Brolins rtc sample code, modified rtc_detect code to  clear and then set the enable bit always. 
<br/>
<br/>
First I put the rtc functions in iwram space, and then leaving them in rom space. Verified by looking at the linker output  map file.
<br/>
<br/>
I read the RTC every 5 seconds, printing a 1/60 second frame counter to verify the timing.
<br/>
<br/>
End result is that in both cases I am repeatedly reading the following data from the "RTC"
<br/>
<br/>
Year 0
<br/>
Mon  1
<br/>
Day of Month 1
<br/>
Day of week 0
<br/>
Hour 0
<br/>
Min 0
<br/>
Sec 0
<br/>
<br/>
These are plausible reset values if you look at the data sheet for the RTC chip S3511 for legit values of the above fields (mon and day of month are restricted to 1-12 and 1-31).  This is also true for another RTC chip I have used, so am assuming this is generally true.
<br/>
<br/>
Perhaps the RTC is never enabled ?
<br/>
<br/>
Another puzzling thing is I get the same results when the RTC functions are placed in ROM space....
<br/>
<br/>
???</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
