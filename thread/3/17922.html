<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Accessing the RAM on a NDS Slot 2 cartridge - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Hardware > Accessing the RAM on a NDS Slot 2 cartridge</h2>
<div id="posts">
<div class="post">
    <h4>#177800 - nitro2k01 - Wed Mar 13, 2013 12:35 am</h4>
    <div class="postbody"><span class="postbody">I have a NDS slot 2 cartridge that came with an M3 Real NDS flash cartridge package. Inside, it has an Altera MAX 2 CPLD, a RAM chip for holding a ROM image, a battery backed SRAM chip and an S3511A RTC chip. 
<br/>
Now I'm looking for any hints on how one would write to the "ROM" RAM. Is it open for access, or do you need to write an unlock sequence to access it? I've seen documents describing this before, but not sure where.
<br/>
<br/>
Images for those may be interested:
<br/>
<br/>
<a class="postlink" href="http://www.flickr.com/photos/gameboygenius/8552329303/" target="_blank"></a><a href="http://farm9.staticflickr.com/8106/8552329303_333b2832df_o.jpg">[Images not permitted - Click here to view it]</a>
<br/>
<br/>
<a class="postlink" href="http://www.flickr.com/photos/gameboygenius/8552327459/" target="_blank"></a><a href="http://farm9.staticflickr.com/8098/8552327459_9cbe2e1bf3_o.jpg">[Images not permitted - Click here to view it]</a>
<br/>
<br/>
<a class="postlink" href="http://www.flickr.com/photos/gameboygenius/8552325621/" target="_blank"></a><a href="http://farm9.staticflickr.com/8519/8552325621_36c0121208_o.jpg">[Images not permitted - Click here to view it]</a><br/>_________________<br/><a class="postlink" href="http://blog.gg8.se/" target="_blank">My blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177801 - Dwedit - Wed Mar 13, 2013 1:04 am</h4>
    <div class="postbody"><span class="postbody">Try this code:
<br/>
ram.c: <a href="http://pastebin.com/aEzTmxe0" target="_blank">http://pastebin.com/aEzTmxe0</a>
<br/>
ram.h: <a href="http://pastebin.com/ebSuRirE" target="_blank">http://pastebin.com/ebSuRirE</a><br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177802 - elhobbs - Wed Mar 13, 2013 11:34 am</h4>
    <div class="postbody"><span class="postbody">The ram in these gba carts is typically 16bit access only like VRAM. So, you need to be careful and avoid things like memcpy and memset which may try to use 8 bit writes - which would write bad data. Any 8bit reads at all will cause unexpected results. And keep in mind that gcc will emit its own memcpy calls for things like struct copies. Also it is really slow.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177803 - nitro2k01 - Wed Mar 13, 2013 5:26 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dwedit wrote:</b></span></td> </tr> <tr> <td class="quote">Try this code:
<br/>
ram.c: <a href="http://pastebin.com/aEzTmxe0" target="_blank">http://pastebin.com/aEzTmxe0</a>
<br/>
ram.h: <a href="http://pastebin.com/ebSuRirE" target="_blank">http://pastebin.com/ebSuRirE</a></td> </tr></table><span class="postbody">Thanks for the code, however I had no luck with getting it working. After some struggling I managed to compile the code with DevKit Advance, but the test comes back negative. Both the automatic test (ram_init(DETECT_RAM)) and some things I tried like always using _ram_test_nolock in case somehow the provided unlock function worked but not the lock function, so hat part of the test worked. But no luck.
<br/>
<br/>
I noticed that the battery has run dry. I don't see how this could affect the function if he ROM emulation, however. I'm also noticing that D2 (the battery side of the diode bridge for the SRAM power supply) has been replaced with a resistor. I wonder if this means the battery is actually meant to be rechargeable, since this allows current to flow into the battery when external power is present, or if this is a mistake/extreme cost cut.<br/>_________________<br/><a class="postlink" href="http://blog.gg8.se/" target="_blank">My blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177804 - elhobbs - Wed Mar 13, 2013 6:37 pm</h4>
    <div class="postbody"><span class="postbody">unlock puts the device in RAM mode - lock puts it back in cart mode. So,the no lock version only differs in that it leaves the device in RAM mode. Did you try changing it from auto detect to specify the M3 device on init? I remember some devices having a problem with the auto detect logic.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177805 - nitro2k01 - Wed Mar 13, 2013 6:47 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>elhobbs wrote:</b></span></td> </tr> <tr> <td class="quote">unlock puts the device in RAM mode - lock puts it back in cart mode. So,the no lock version only differs in that it leaves the device in RAM mode.</td> </tr></table><span class="postbody">No, the normal version also <span style="font-style: italic">confirms</span> that the lock command took effect and only returns true if that passes. Say that the unlock function works for my cartridge, but the lock function does not for some reason. Then the normal version of the test will fail because the cartridge still acts as RAM after the lock function failed to lock the cartridge.
<br/>
But, that did not make a difference in my case. It was just something I tried when trying to think of reasons why the test might fail.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>elhobbs wrote:</b></span></td> </tr> <tr> <td class="quote">Did you try changing it from auto detect to specify the M3 device on init? I remember some devices having a problem with the auto detect logic.</td> </tr></table><span class="postbody">Yes.<br/>_________________<br/><a class="postlink" href="http://blog.gg8.se/" target="_blank">My blog</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
