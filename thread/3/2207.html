<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>DMA3 with source fixed from cartridge - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Hardware > DMA3 with source fixed from cartridge</h2>
<div id="posts">
<div class="post">
    <h4>#11516 - poslundc - Thu Oct 09, 2003 4:56 am</h4>
    <div class="postbody"><span class="postbody">Here's a hard-earned lesson to share with everyone:
<br/>
<br/>
Don't use the SOURCE_FIXED parameter with DMA3 if your source is the cartridge. It works in emulation, but it doesn't seem to work on hardware.
<br/>
<br/>
I don't know if the problem extends to other DMAs or other types of memory; I just know that my data was getting garbled under those circumstances.
<br/>
<br/>
(One bug down... about a million to go...)
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11525 - tom - Thu Oct 09, 2003 2:19 pm</h4>
    <div class="postbody"><span class="postbody">probably you messed up something else. never had problems with stuff like that. besides, if you use a fixed source address you might aswell use the cpu, as its faster.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11526 - poslundc - Thu Oct 09, 2003 2:39 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tom wrote:</b></span></td> </tr> <tr> <td class="quote">probably you messed up something else. never had problems with stuff like that. besides, if you use a fixed source address you might aswell use the cpu, as its faster.</td> </tr></table><span class="postbody">
<br/>
<br/>
Have you tried specifically DMA3 with fixed source, 16-bit, reading from the cartridge, on a GBA?
<br/>
<br/>
Cuz I'm saying that unless your GBA is different from my GBA, it doesn't work. I know I didn't screw something else up because it works just fine in emulation.
<br/>
<br/>
Are you certain that CPU transfers are faster? I'd like to hear your reasoning behind it. (I wouldn't think that the DMA timings on the Cowbite spec would apply to a fixed-source transfer; I'd imagine it would be at least as fast as writing to the locations yourself.)
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11529 - tepples - Thu Oct 09, 2003 3:05 pm</h4>
    <div class="postbody"><span class="postbody">If you have a fixed source address, a somewhat-unrolled loop of STMIA instructions can be faster than DMA. DMA needs to reread data from the source address every time; STMIA doesn't and can write 12 u32s for every instruction fetch.
<br/>
<br/>
DMA: set up registers, read source, write dest, read source, write dest, read source, write dest, ...
<br/>
<br/>
STMIA: read source, copy to all CPU registers, read instruction, write dest * 12, read instruction, write dest * 12, read instruction, write dest * 12, ...
<br/>
<br/>
Notice how there are several times fewer reads once the STMIA loop gets going. The result can be at least 75% faster than DMA.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11531 - tom - Thu Oct 09, 2003 4:27 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">I know I didn't screw something else up because it works just fine in emulation.</td> </tr></table><span class="postbody">
<br/>
<br/>
this doesn't mean anything. except that the emulator you're using might be buggy =)
<br/>
<br/>
seriously, dma *does* work the same on all memory areas of the gba.(except sram and bios rom. you can't access those with dma)</span><span class="gensmall"><br/><br/>Last edited by tom on Thu Oct 09, 2003 4:36 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#11532 - tom - Thu Oct 09, 2003 4:34 pm</h4>
    <div class="postbody"><span class="postbody">btw, you can use the cpufastset syscall to try out wether it's faster.
<br/>
it uses an
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
stmia r0!,{r1-r8}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
instruction (or similar) to write 32 bytes at once.
<br/>
<br/>
but you might be better off with a handcoded routine that uses 4 more registers and writes 48 bytes at once.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
