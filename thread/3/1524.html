<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>How GBA detect the save game type of original game cart. ? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Hardware > How GBA detect the save game type of original game cart. ?</h2>
<div id="posts">
<div class="post">
    <h4>#7698 - sfhuang100 - Mon Jun 23, 2003 3:52 am</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
I have been searching for this answer for a long time and hope somebody can help me.
<br/>
As people said, there are 3 kinds of save game type of original cart. : EEPROM, FLASH, and SRAM.    The physical interface to these 3 types of hardware are different, for example, EEPROM is with serial interface and others are with parallel interface.  
<br/>
When these different cart. are plugged into the GBA machine, how would GBA know the way to communicate with  these save-game chips ? 
<br/>
<br/>
Thank you very much.<br/>_________________<br/>---
<br/>
sfhuang100</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7702 - tepples - Mon Jun 23, 2003 7:17 am</h4>
    <div class="postbody"><span class="postbody">A driver for the save chip is stored in the game code. Nintendo has made such drivers available to its licensed developers. That said, the homebrew community has managed to figure some things out.
<br/>
<br/>
I know about everything about SRAM and very little about flash or EEPROM.
<br/>
<br/>
SRAM is easy; it's just a 32 KB (or so, depending on save chip specifics) array of bytes, which must be addressed as bytes. There's code in the FAQ to move things in and out of SRAM; just make sure you put bytecpy() in EWRAM instead of ROM.
<br/>
<br/>
Flash save memory is 64 KB in 4 KB sectors; it's read like SRAM but written differently.
<br/>
<br/>
EEPROM is serial and either 4 Kbit or 64 Kbit in 64-bit sectors, connected to lines A23 and D0. <a class="postlink" href="http://www.work.de/nocash/gbatek.htm#backupeeprom" target="_blank">Here's some info from GBATEK</a>.
<br/>
<br/>
(EDIT: fix gbatek url)<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"><br/><br/>Last edited by tepples on Mon Jun 23, 2003 5:45 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#7708 - sfhuang100 - Mon Jun 23, 2003 10:37 am</h4>
    <div class="postbody"><span class="postbody">Really thanks a lot , tepples.
<br/>
So does the game developer need to choose what kind of hardware of saving chip before developing the game?   Or does he just only combines the driver into his game and the driver will detect the hardware automatically?
<br/>
<br/>
By the way, could you please type again the link to EEPROM info linked to GBATEK ?  
<br/>
<br/>
Thank you again.<br/>_________________<br/>---
<br/>
sfhuang100</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7712 - gb_feedback - Mon Jun 23, 2003 2:09 pm</h4>
    <div class="postbody"><span class="postbody">I have never managed to get any facts out of those who know...
<br/>
<br/>
But here's some speculation.
<br/>
<br/>
EEPROM at least is quite complex to write to, using as it does \RAMCS, A23 and D0 to access the device (serially). It was at least originally something like the Xicor X84256. These take about 2ms for a write cycle, and I believe there is a library function available to official developers which handles this (possibly stealing an interrupt to do the job?).
<br/>
<br/>
Any commercial cartridge will have imbedded in it somewhere, a text string indicating the type of save access in use. For example a Static RAM saving game may have 'SRAM_V112' embedded.
<br/>
<br/>
Some people have been able to change the save type of a ROM image by a small patch, which suggests that the library function is present in most commercial games, and contains the necessary code for each save type.
<br/>
<br/>
The logical consequence would be that the library function is accessed in a generic way and the save processing is invisible to the official developer.
<br/>
<br/>
Anyone bothered by this because they are hoping for an unofficially developed game to become an official game in the future could take comfort in the knowledge that as long as they save through their own fairly generalised save function (to sram), then it could easily be replaced in the future.
<br/>
<br/>
Of course statistically most such games are extremely unlikely to ever get to this stage!<br/>_________________<br/><a class="postlink" href="http://www.bookreader.co.uk/" target="_blank">http://www.bookreader.co.uk/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7720 - torne - Mon Jun 23, 2003 3:35 pm</h4>
    <div class="postbody"><span class="postbody">The Nintendo backup libraries for SRAM/Flash/EEPROM have totally different interfaces - the savegame type is highly visible to the developer. Onlky the used save method is present in a commercial cart. The savegame patches used on roms work by simulating the Flash/EEPROM calls, as the SRAM functionality is a 'lowest common denominator' in terms of permitted operations. (I think, anyway; I have never examined the SRAM patchers in detail).
<br/>
<br/>
The patches work on any game which uses an unmodified copy of the Nintendo backup libraries; all versions in current use by licenced developers are dealt with. And not through reverse engineering, either, I'm sure. =) There are a few Flash games such as Pokemon which do not use the Nintendo backup library for various reasons, and instead interface directly with the flash memory; these have custom patches. *grin*
<br/>
<br/>
To be honest, the motivations for using EEPROM vs Flash vs SRAM are such that it makes little sense to present a unified interface. For example, Pokemon uses flash because it has to save a large amount of complex, highly variable data, twice over for backup purposes; but only when the user explicitly asks to save, and a delay is expected. The interface desired is therefore one of bulk data transfer; the data is kept in WRAM and is dumped out to flash in bulk when Save is selected. Whereas a game like Klonoa uses SRAM saving: the game saves transparently every time you walk from one room to the next (which is great as being able to just turn the gba off when the puzzles get frustrating does wonders..). There is relatively little data to save and few things change between saves (as all rooms reset when you leave them; only the current room and player status need be recorded), so the SRAM interface which allows direct usage of the savegame data (albeit with 8 wait states) makes sense. I confess that I'm not too familiar with the EEPROM interface, and so can't really tell you much about it (other than it has the longest lifetime of all the save types; EEPROMS can be rewritten more times than flash, and don't need batteries like SRAM).
<br/>
<br/>
Homebrew games are all written to use SRAM because that's all that's trivially available on most carts; some of them probably would benefit from using other save types. It all depends how 'natural' the SRAM interface seems to be.
<br/>
<br/>
If you're actually intending to publish a game, abstract out your savegame concept; don't just have a save function, move anything related to savegames out of your main code. This would allow you to switch between a bulk-save model a la Pokemon, or an incremental save model like Klonoa with relative ease.
<br/>
<br/>
Hope this helps,
<br/>
<br/>
Torneo</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7724 - gb_feedback - Mon Jun 23, 2003 4:02 pm</h4>
    <div class="postbody"><span class="postbody">torne: thanks - nice to hear some facts at last!<br/>_________________<br/><a class="postlink" href="http://www.bookreader.co.uk/" target="_blank">http://www.bookreader.co.uk/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7736 - Cyberman - Mon Jun 23, 2003 7:04 pm</h4>
    <div class="postbody"><span class="postbody">EEPROM saves work by as said utilizing A23 and D0.
<br/>
<br/>
This ONLY works through the use of DMA. You cannot do an EEPROM read or save otherwise.  The data bits are written to a buffer in WRAM the DMA is set up and the data is sent. The dma is monitored to find out when it's done. Reading is pretty much the same only you send a read command and then read from the DMA channel. Why is DMA neccesary? this is entirely because of the EEPROM chipselect.
<br/>
<br/>
FLASH/SRAM are 32KB/64KB respectively and are memory maped. Writting to this takes I believe 8 wait states (IE normal write + 8 extra bus cycles). So it's much slower.  FLASH requires one to support flash erasure and writting routines which vary from manufacturer to manufacturer.
<br/>
<br/>
However there is another way to save games.  Flash Again. This is how those cartridges (flash type) are programed in the GBA.  The same address space as the ROM resides in can also be used for saving game state. (So you can have 16 mbytes of flash memory in a game if you do a LOT of saves ;) ).
<br/>
<br/>
All of these require different methods and program code to be able to facilitate them.
<br/>
<br/>
Cyb</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7862 - ampz - Fri Jun 27, 2003 3:48 am</h4>
    <div class="postbody"><span class="postbody">Just to point out, EEPROM is by far the slowest savegame type, as well as the smallest.  ( 512Byte / 8kByte )
<br/>
The life of EEPROM is usually the same as flash memory.
<br/>
<br/>
The main technical advantage of EEPROM over flash is that it is not sector-based, so you don't have to erase an entire sector when you need to update one byte.
<br/>
The important difference is that EEPROM is cheaper than flash.
<br/>
<br/>
Flash is cheaper than SRAM.
<br/>
<br/>
EEPROM and Flash does not have any real technical advantages over SRAM. It's really only a price difference.
<br/>
<br/>
Yes, SRAM has a limited life of 10 years or so due to the battery, but that's not considered much of a problem.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7903 - Cyberman - Sat Jun 28, 2003 12:22 am</h4>
    <div class="postbody"><span class="postbody">A few things EEPROM doesn't have the same erase write life cycle expectancy of flash.
<br/>
Flash is normally good for 10000 cycles ERASE write they often use additional memory for errorcorrecting small corruptions getting it's endurance close to 50000 (this is normally just parity data).  EEPROM can range from 100000 to 1000000 erase write endurance cycles.    If per chance they are using FRAM EEPROM (little expensive but). These are good for 100000000 erase write cycles.
<br/>
<br/>
EEPROM is not limited to <a class="postlink" href="http://www.atmel.com/dyn/products/product_card.asp?part_id=3036" target="_blank">512</a> (4Kbit) or <a class="postlink" href="http://www.atmel.com/dyn/products/product_card.asp?part_id=2791" target="_blank">8K</a> (64Kbit) as well.
<br/>
Ones options are:
<br/>
<a class="postlink" href="http://www.atmel.com/dyn/products/product_card.asp?part_id=2820" target="_blank">128K</a> <a class="postlink" href="http://www.atmel.com/dyn/products/product_card.asp?part_id=2821" target="_blank">256K</a>, <a class="postlink" href="http://www.atmel.com/dyn/products/product_card.asp?part_id=2497" target="_blank">512K</a>, <a class="postlink" href="http://www.atmel.com/dyn/products/product_card.asp?part_id=2495" target="_blank">1024K</a> bit EEPROMS (16K 32K 64K 128K)
<br/>
<a class="postlink" href="http://www.atmel.com/dyn/products/param_table.asp?family_id=668&amp;OrderBy=part_no&amp;Direction=ASC" target="_blank">Serial flash:</a>
<br/>
512Kbit 1Mbit 2Mbit densities.
<br/>
<br/>
<a class="postlink" href="http://www.atmel.com/dyn/products/param_table.asp?family_id=616&amp;OrderBy=part_no&amp;Direction=ASC" target="_blank">Data flash</a> &lt;atmel special?&gt;
<br/>
Densities available are
<br/>
1M, 2M, 4M, 8M, 16M, 32M, 64M, 128M
<br/>
These have extra data per sector availabel for error correction and 2 RAM buffers for fast reading and writting (20mbit/second peak rate).
<br/>
<br/>
Cyb</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8436 - ampz - Thu Jul 10, 2003 2:36 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cyberman wrote:</b></span></td> </tr> <tr> <td class="quote">A few things EEPROM doesn't have the same erase write life cycle expectancy of flash.
<br/>
Flash is normally good for 10000 cycles ERASE write they often use additional memory for errorcorrecting small corruptions getting it's endurance close to 50000 (this is normally just parity data).  EEPROM can range from 100000 to 1000000 erase write endurance cycles.    If per chance they are using FRAM EEPROM (little expensive but). These are good for 100000000 erase write cycles.
<br/>
<br/>
EEPROM is not limited to <a class="postlink" href="http://www.atmel.com/dyn/products/product_card.asp?part_id=3036" target="_blank">512</a> (4Kbit) or <a class="postlink" href="http://www.atmel.com/dyn/products/product_card.asp?part_id=2791" target="_blank">8K</a> (64Kbit) as well.
<br/>
Ones options are:
<br/>
<a class="postlink" href="http://www.atmel.com/dyn/products/product_card.asp?part_id=2820" target="_blank">128K</a> <a class="postlink" href="http://www.atmel.com/dyn/products/product_card.asp?part_id=2821" target="_blank">256K</a>, <a class="postlink" href="http://www.atmel.com/dyn/products/product_card.asp?part_id=2497" target="_blank">512K</a>, <a class="postlink" href="http://www.atmel.com/dyn/products/product_card.asp?part_id=2495" target="_blank">1024K</a> bit EEPROMS (16K 32K 64K 128K)
<br/>
<a class="postlink" href="http://www.atmel.com/dyn/products/param_table.asp?family_id=668&amp;OrderBy=part_no&amp;Direction=ASC" target="_blank">Serial flash:</a>
<br/>
512Kbit 1Mbit 2Mbit densities.
<br/>
<br/>
<a class="postlink" href="http://www.atmel.com/dyn/products/param_table.asp?family_id=616&amp;OrderBy=part_no&amp;Direction=ASC" target="_blank">Data flash</a> &lt;atmel special?&gt;
<br/>
Densities available are
<br/>
1M, 2M, 4M, 8M, 16M, 32M, 64M, 128M
<br/>
These have extra data per sector availabel for error correction and 2 RAM buffers for fast reading and writting (20mbit/second peak rate).
<br/>
<br/>
Cyb</td> </tr></table><span class="postbody">
<br/>
<br/>
We were talking GBA savegame types here, and there are only 4k and 64k EEPROM carts. I'am well aware that serial EEPROM's exist in many different configurations.
<br/>
The ones you pointed out are not "N compatible".
<br/>
<br/>
As for flash savegame support, only 64kB is supported due to the 16bit adress bus.
<br/>
<br/>
Flash memories generally have the same erase cycle expectancy as EEPROM. Only a few special Intel flash versions have 10k cycle expectancy.
<br/>
100k and 1M cycle expectancy is normal for flash.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8437 - Cyberman - Thu Jul 10, 2003 3:46 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ampz wrote: wrote:</b></span></td> </tr> <tr> <td class="quote">We were talking GBA savegame types here, and there are only 4k and 64k EEPROM carts. I'am well aware that serial EEPROM's exist in many different configurations. 
<br/>
The ones you pointed out are not "N compatible". </td> </tr></table><span class="postbody">
<br/>
<br/>
You mean Nintendo library compatible then? hmmm Then options are pretty limited sadly, would be nice if one could have larger saves with the simple EEPROM and FLASH.  However it is possible to have &gt; 64K flash saves.  Though you must use part of the memory normally reserved for the game cartridge for this.  I am not sure if N has library code for this, I believe from what I've read they do.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ampz wrote: wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
As for flash savegame support, only 64kB is supported due to the 16bit adress bus. 
<br/>
</td> </tr></table><span class="postbody">
<br/>
Well if you aren't using N's library's this is not true, the same with SRAM. You can do a lot of odd little things to gain more space the question in my mind though is it worth it.  I have seen mentioned ATMEL flash used, this small sectored flash? It must be because it's 64k.  That makes things interesting because you can erase and write 128 byte sections of the flash memory.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ampz wrote: wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Flash memories generally have the same erase cycle expectancy as EEPROM. Only a few special Intel flash versions have 10k cycle expectancy. 
<br/>
100k and 1M cycle expectancy is normal for flash.
<br/>
</td> </tr></table><span class="postbody">
<br/>
Doh yes sorry about that :)
<br/>
I was thinking embeded processor flash.. le sigh.
<br/>
<br/>
Anyhow it looks to me if one is planning on needing lots of save memory compatibility with N is out the window. Which isn't a real shame just anoying.
<br/>
<br/>
Cyb</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8491 - ampz - Fri Jul 11, 2003 11:53 pm</h4>
    <div class="postbody"><span class="postbody">If you intend to design your own cart hardware then you can do whatever you want and put any amount of memory in there, but I think the original discussion was regarding Nintendo savegame types.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
