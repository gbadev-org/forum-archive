<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>AAS mod-playing = crash - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Audio > AAS mod-playing = crash</h2>
<div id="posts">
<div class="post">
    <h4>#37129 - mr_square - Mon Mar 07, 2005 8:43 pm</h4>
    <div class="postbody"><span class="postbody">Arg - I'm having a weird problem where my game randomly crashes after a few minutes of play. The gameplay freezes, the sound screws up (and goes into a high pitched ringing noise) and the % counter on VisualBoyAdvance drops from 100% to about 80%. This happens even if I just leave the game on the menu screen.
<br/>
<br/>
If I don't play any mod-files using AAS though, its fine. Removing the last two lines from the code below sorts it out, but then, obviously, I can't have any music running :S. Any ideas on whats going on?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
AAS_SetConfig( AAS_CONFIG_MIX_16KHZ, AAS_CONFIG_CHANS_8, AAS_CONFIG_SPATIAL_MONO, AAS_CONFIG_DYNAMIC_OFF );
<br/>
AAS_MOD_Play( AAS_DATA_MOD_youandme );
<br/>
AAS_MOD_SetLoop(true);
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#37163 - kashiwa - Tue Mar 08, 2005 11:54 am</h4>
    <div class="postbody"><span class="postbody">Does the stack suffice?
<br/>
Check your LinkerScript about __sp_usr &amp; __sp_irq, though it might be not the point.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#37345 - jd - Thu Mar 10, 2005 6:43 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>mr_square wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
If I don't play any mod-files using AAS though, its fine. Removing the last two lines from the code below sorts it out, but then, obviously, I can't have any music running :S. Any ideas on whats going on?
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
There's two possible causes I can think of:
<br/>
<br/>
1) You're directly using DMA3 in your code. You'll need to use AAS_DoDMA3 (or a single stmia instruction to write out all the parameters) instead. It might also be worth checking you're not using DMA1, DMA2, Timer 0 or Timer 1 as these are also used by AAS.
<br/>
<br/>
2) As kashiwa suggested, you might be running out of IWRAM - AAS takes an extra 3.2K. This might be enough to make your stack collide with your IWRAM data. It's also conceivable that you're running out of EWRAM (AAS takes an extra 3.3K).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#37346 - mr_square - Thu Mar 10, 2005 6:47 pm</h4>
    <div class="postbody"><span class="postbody">Is there any way I can reduce the amount of data stored in IWRAM/EWRAM? Can any of that be put into ROM?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#37351 - jd - Thu Mar 10, 2005 7:35 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>mr_square wrote:</b></span></td> </tr> <tr> <td class="quote">Is there any way I can reduce the amount of data stored in IWRAM/EWRAM? Can any of that be put into ROM?</td> </tr></table><span class="postbody">
<br/>
<br/>
You can't reduce the amount of IWRAM/EWRAM used by AAS (I could make you a version that doesn't use IWRAM but it would be much slower). In your own code you should declare anything that doesn't change as const so it's put in ROM. Variables that are only accessed rarely should be put in EWRAM rather than IWRAM. Recursion can also use a lot of stack space if you're not careful. It would be useful to know more details of your project so I can offer more specific suggestions.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
