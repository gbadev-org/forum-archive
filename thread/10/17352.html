<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>A random thought about ADPCM streaming via hardware (NDS) - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Audio > A random thought about ADPCM streaming via hardware (NDS)</h2>
<div id="posts">
<div class="post">
    <h4>#174940 - DiscoStew - Fri Aug 06, 2010 5:39 pm</h4>
    <div class="postbody"><span class="postbody">Now, if this is not applicable or messes up the audio too much, then we can forget it, but the other day, I was thinking about this idea.
<br/>
<br/>
With how the hardware deals with ADPCM playback, it loads the initial sample and step index before running the compressed data following. When it reaches the point where it loops back, the initial sample and step index are reloaded, and playback continues. Therefore, the only way to stream the audio via hardware is if you happen to reloop with the same sample and step index initially started.
<br/>
<br/>
So, what if before we compressed audio to the ADPCM format, after every certain block of data, we'd change the sample to be exactly like the initial sample? To go further, we could take the initial sample, and then the samples after a set data size, and then average them out, and write the average value in their places before compression.
<br/>
<br/>
To go even further, what about a variable-block method, where each block isn't the same size? As far as I can tell from GBATek, while the starting loop address shouldn't be changed, what about the length? If the length could be changed mid-playback, then we could take the idea above, and enhance with variable block compression, where the initial value will still be an average, but that average can be more based on samples actually close to the originals.
<br/>
<br/>
Anyone understand what I'm saying?<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#174959 - sverx - Mon Aug 09, 2010 4:36 pm</h4>
    <div class="postbody"><span class="postbody">I wonder if it's really possible. I mean, you should not simply start again with the same sample you had in the beginning, you should also bring the step index back to its initial value.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#174960 - DiscoStew - Mon Aug 09, 2010 5:28 pm</h4>
    <div class="postbody"><span class="postbody">Yes, I meant both the initial sample and step index.<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#174961 - Ruben - Mon Aug 09, 2010 6:51 pm</h4>
    <div class="postbody"><span class="postbody">I'm not 100% sure, but the length part seems that it would work. I can imagine that the loop point can't be changed because it loads its sample and index from there, but the final sample has no effect on it, therefore it should be changeable, but it'd have to be tested on hardware first.
<br/>
<br/>
And about averaging: I'd say use ~5% x-fading to the sample rather than simply average one sample, as then you may get a very noticeable bias change.
<br/>
<br/>
But other than that, it definitely seems doable.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#174962 - sverx - Tue Aug 10, 2010 2:16 pm</h4>
    <div class="postbody"><span class="postbody">btw I noticed that sox converts PCM wav into ADPCM wav file 'in chunks' (each one having its header) so I guess it's possible to stream them using a timer to restart the audio channel after each chunk...</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
