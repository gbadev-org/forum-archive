<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>MOD format - question about 'period' - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Audio > MOD format - question about 'period'</h2>
<div id="posts">
<div class="post">
    <h4>#34035 - gbawiz - Wed Jan 12, 2005 10:17 pm</h4>
    <div class="postbody"><span class="postbody">Hello,
<br/>
Im a bit confused with the subject of periods.
<br/>
I have been reading about them and the documents say that you should not store the note as period values (even although they are stored that way in the MOD file itself).
<br/>
<br/>
What should they be stored as?
<br/>
<br/>
Another question is regarding the period values.
<br/>
When I looked into the file with a fileviewer and interpreted the period values according to the period table also shown in the documents I find that the corresponding note stored is different from that shown in the tracker when I load the file.
<br/>
<br/>
for example:
<br/>
a period value of
<br/>
254 in the table indicates A-2 but in tracker it is A-5
<br/>
214 in table indicates C-3 but tracker says C-6
<br/>
339 in table indicates E-2 but tracker says E-5
<br/>
<br/>
They are all showing up in tracker with 3 added (three octaves?)
<br/>
<br/>
Why is this, any ideas?
<br/>
<br/>
Thanks</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#34036 - tepples - Wed Jan 12, 2005 10:22 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>gbawiz wrote:</b></span></td> </tr> <tr> <td class="quote">When I looked into the file with a fileviewer and interpreted the period values according to the period table also shown in the documents I find that the corresponding note stored is different from that shown in the tracker when I load the file.
<br/>
<br/>
for example:
<br/>
a period value of
<br/>
254 in the table indicates A-2 but in tracker it is A-5
<br/>
214 in table indicates C-3 but tracker says C-6
<br/>
339 in table indicates E-2 but tracker says E-5
<br/>
<br/>
They are all showing up in tracker with 3 added (three octaves?)</td> </tr></table><span class="postbody">
<br/>
That's because the note range for Modplug Tracker is bigger than the note range for Protracker was. Modplug can reach C-1 to B-8 or so; Protracker was limited to its C-1 through B-3, which correspond to Modplug's C-4 through B-6.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#34038 - gbawiz - Wed Jan 12, 2005 10:27 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">That's because the note range for Modplug Tracker is bigger than the note range for Protracker was. Modplug can reach C-1 to B-8 or so; Protracker was limited to its C-1 through B-3, which correspond to Modplug's C-4 through B-6.</td> </tr></table><span class="postbody">
<br/>
<br/>
I am using modplug tracker to load the files.
<br/>
would they appear different in other trackers?
<br/>
<br/>
Im confused as to why the modplug tracker would choose to display this value instead of the one which is in the MOD file.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#34040 - poslundc - Wed Jan 12, 2005 10:31 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>gbawiz wrote:</b></span></td> </tr> <tr> <td class="quote">Im confused as to why the modplug tracker would choose to display this value instead of the one which is in the MOD file.</td> </tr></table><span class="postbody">
<br/>
<br/>
Like most composing software, it's designed for people who want to track music effectively, not for people who want to understand or pick apart the internal workings of the file format.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#34041 - gbawiz - Wed Jan 12, 2005 10:35 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">Like most composing software, it's designed for people who want to track music effectively, not for people who want to understand or pick apart the internal workings of the file format.</td> </tr></table><span class="postbody">
<br/>
<br/>
I 'pick apart' the format so that I can understand how it is laid out in order to create my own 'Converter'.
<br/>
Its no use trying to create a converter which will create notes which are false.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#34045 - DekuTree64 - Wed Jan 12, 2005 11:04 pm</h4>
    <div class="postbody"><span class="postbody">Yeah, you'll probably want to write your own converter. There's a lot of work to be done, but none of it is particularly difficult. 
<br/>
The exact format of everything should be whatever makes your player easy to write. Granted, you can't really write a player until you have some data to work with, so you'll just have to do the best you can, improving the converter as you write the player.
<br/>
For notes, I'd suggest converting the period to a note number (12 notes per octave), and make a lookup table of frequencies in Hz for each note.
<br/>
<br/>
I'm working on a GBA sound/MOD player tutorial, which can be found on my site <a class="postlink" href="http://deku.gbadev.org/program.html" target="_blank">here</a>, down toward the bottom. <a class="postlink" href="http://deku.gbadev.org/program/sound3.html" target="_blank">Day 3</a> is specifically on writing a converter program, so hopefully that can give you an idea where to start.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#34049 - tepples - Wed Jan 12, 2005 11:41 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>DekuTree64 wrote:</b></span></td> </tr> <tr> <td class="quote">For notes, I'd suggest converting the period to a note number (12 notes per octave), and make a lookup table of frequencies in Hz for each note.</td> </tr></table><span class="postbody">
<br/>
That won't help with pitch slides (MOD effects 1xx, 2xx, 3xx, corresponding to S3M effects Fxx, Exx, Gxx), which work on period values. You really have to make your lookup table from notes to Amiga periods and then convert your pitch values from Amiga period to mixer frequency every frame (that's about one division for each channel that has a new note or a pitch effect, not too bad even if you use the BIOS divide), or you can use Amiga periods with a little conversion (something like GBC_period = 2048 - Amiga_period * 300 / 256; if it's off by an octave, change the 256) on the GBC tone generators if you decide to implement those.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#34050 - DekuTree64 - Wed Jan 12, 2005 11:56 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">That won't help with pitch slides (MOD effects 1xx, 2xx, 3xx, corresponding to S3M effects Fxx, Exx, Gxx), which work on period values. You really have to make your lookup table from notes to Amiga periods and then convert your pitch values from Amiga period to mixer frequency every frame</td> </tr></table><span class="postbody">
<br/>
<br/>
True that pitch slides can't be done directly on the linear Hz frequency, but with some mathematical optimization, you can convert Hz to period, slide, and back to Hz only using one divide. 
<br/>
You still have at most one divide per channel per frame, and the more common case of just playing a note can be done with only a lookup.
<br/>
<br/>
The final formula is 
<br/>
newHz = AMIGA_VAL*oldHz / (AMIGA_VAL+slide*oldHz)
<br/>
Where AMIGA_VAL is 3579364 (or 8363*428, or baseFreq*basePeriod). I don't remember off the top of my head exactly how I came to that, but it works, and I'll have it in the next issue of the tutorial.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#34106 - ProblemBaby - Thu Jan 13, 2005 6:14 pm</h4>
    <div class="postbody"><span class="postbody">DekuTree: does it exist a formula like that for linear freq table?
<br/>
Now Ive a big LUT (about 32kb) with all possible Periods it works splendid but maybe its a bit of waste!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#34111 - tepples - Thu Jan 13, 2005 6:35 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ProblemBaby wrote:</b></span></td> </tr> <tr> <td class="quote">DekuTree: does it exist a formula like that for linear freq table?
<br/>
Now Ive a big LUT (about 32kb) with all possible Periods it works splendid but maybe its a bit of waste!</td> </tr></table><span class="postbody">
<br/>
Time/space/accuracy tradeoff: You can try cutting down your LUT to 4 KB and using linear interpolation to get the missing values. Or you can try storing only one octave of the LUT and then halving/doubling the inputs and outputs. Or do both.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#34123 - DekuTree64 - Thu Jan 13, 2005 8:48 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ProblemBaby wrote:</b></span></td> </tr> <tr> <td class="quote">DekuTree: does it exist a formula like that for linear freq table?
<br/>
Now Ive a big LUT (about 32kb) with all possible Periods it works splendid but maybe its a bit of waste!</td> </tr></table><span class="postbody">
<br/>
<br/>
I assume your table is 16 bits*5 octaves*12 notes*256 finetune levels? You should at least be able to chop off the finetune levels and interpolate between notes. The standard interpolation formula is 
<br/>
(a*(256-x) + b*x) / 256
<br/>
Where x ranges from 0-256. Then you can rearrange as follows to make is faster:
<br/>
(a*256 - a*x + b*x) /256
<br/>
(a*256 + x*(b - a)) / 256
<br/>
(x*(b - a) / 256) + a
<br/>
Which is only 3 instructions (sub, mul, add w/ shift). Actually, the time to load the second period from the table will be more than the whole calculation.
<br/>
<br/>
I think you'll get some slight inaccuracies doing that if you store your table as linear Hz values instead of periods, because of the non-linearness of the periods. Like, half way between 2 periods does not correspond to half way between their frequencies. As tepples said, just a trade of ROM for being forced to do the period-to-Hz conversion every note. Either way should be fine.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#34325 - gbawiz - Mon Jan 17, 2005 10:25 pm</h4>
    <div class="postbody"><span class="postbody">Hello and thanks guys for the advice.
<br/>
<br/>
Im a bit confused with the idea of finetuning.
<br/>
I read about the case that it is better to store the notes as note-numbers and use these numbers to access a lookuptable to get the amiga period values which are then converted to Hz.
<br/>
<br/>
I have a couple of questions:
<br/>
1. why use the note-number &amp; lookup table method instead of storing period values.
<br/>
<br/>
2. I assume that the fine-tune settings are stored in the sample information only but I was wondering how these fine-tune values are applied to the note-numbers which finally result in the frequency to play.
<br/>
<br/>
Thanks in advance for any advice, much appreciated</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#34332 - tepples - Tue Jan 18, 2005 2:38 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>gbawiz wrote:</b></span></td> </tr> <tr> <td class="quote">I have a couple of questions:
<br/>
1. why use the note-number &amp; lookup table method instead of storing period values.</td> </tr></table><span class="postbody">
<br/>
Some would claim that conversion to note number is necessary for the "arpeggio" (0xy) effect, although I know how to implement arpeggio without touching "note numbers".<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#34365 - gbawiz - Tue Jan 18, 2005 3:37 pm</h4>
    <div class="postbody"><span class="postbody">Im a bit confused about the finetuning,
<br/>
looking at a clip of the period table from FMODDOC.TXT shown below, there the finetune is mentioned.
<br/>
Do these finetunes refer to the value which is stored in the sample information block for each sample?
<br/>
Also are there any other finetuning settings not in sample (i.e in any effects or song info) and if so then which get priority?
<br/>
<br/>
--------------------------------------------------------------------------------------
<br/>
; Tuning 0, Normal
<br/>
	dc.w 856,808,762,720,678,640,604,570,538,508,480,453 ; C-1 to B-1
<br/>
	dc.w 428,404,381,360,339,320,302,285,269,254,240,226 ; C-2 to B-2
<br/>
	dc.w 214,202,190,180,170,160,151,143,135,127,120,113 ; C-3 to B-3
<br/>
; Tuning 1
<br/>
	dc.w 850,802,757,715,674,637,601,567,535,505,477,450 ; same as above
<br/>
	dc.w 425,401,379,357,337,318,300,284,268,253,239,225 ; but with 
<br/>
	dc.w 213,201,189,179,169,159,150,142,134,126,119,113 ; finetune +1
<br/>
; Tuning 2
<br/>
	dc.w 844,796,752,709,670,632,597,563,532,502,474,447 ; etc, 
<br/>
	dc.w 422,398,376,355,335,316,298,282,266,251,237,224 ; finetune +2
<br/>
	dc.w 211,199,188,177,167,158,149,141,133,125,118,112
<br/>
--------------------------------------------------------------------------------------</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#36389 - gbawiz - Fri Feb 18, 2005 5:23 pm</h4>
    <div class="postbody"><span class="postbody">Hello all,
<br/>
I have been looking at programming my mod player after getting the mixing stuff out of the way.
<br/>
I have been reading about the method of creating a period table which generates periods which correspond to all note periods and all notes with finetunes applied.
<br/>
<br/>
I have a couple of queries:
<br/>
1.) how are effects applied when using a period table?
<br/>
2.) Are period tables necessary, why not use the magic formula instead?
<br/>
<br/>
Thanks</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
