<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Loading MOD audio files into the GBA - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Audio > Loading MOD audio files into the GBA</h2>
<div id="posts">
<div class="post">
    <h4>#27577 - gbawiz - Fri Oct 15, 2004 11:26 pm</h4>
    <div class="postbody"><span class="postbody">Hello all,
<br/>
I am trying to write a MOD player for my GBA projects and have some problems on incorporating the MOD file data into the ROM image.
<br/>
<br/>
The method which I have used thus far is to convert the binary MOD file into an object then include this object in compilation.
<br/>
Then I have created a structure which is supposed to mirror the structure of the file. NOTE that i have set the sample name to 30. I have done this because there are 30 bytes per sample and the name is at the beginning of every sample.
<br/>
Here is the code:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
include"gba.h"
<br/>
<br/>
extern const unsigned char _binary_tunefile_mod_start[];
<br/>
<br/>
unsigned char *wram= (u8*)0x2000000;
<br/>
<br/>
typedef struct sample{
<br/>
   unsigned char name[30]; // i set this to 30 because there are 30 bytes per sample
<br/>
                     //i just want to try reading sample name first
<br/>
}sampletype;
<br/>
<br/>
typedef struct mod{
<br/>
   unsigned char song_name[20];
<br/>
   sampletype sam[31];
<br/>
}modtype;
<br/>
<br/>
int main()
<br/>
{
<br/>
   int n=0;
<br/>
   modtype *music=(modtype*)_binary_tunefile_mod_start;
<br/>
<br/>
   for(n=0;n&lt;20;n++)wram[n]=music-&gt;song_name[n];
<br/>
   unsigned char *samname=music-&gt;sam[1].name;   // change this number to move through the samples
<br/>
   
<br/>
   for(n=0;n&lt;22;n++)wram[n+21]=samname[n]; // displays the information found in the wram memory for viewing
<br/>
}
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
The problem is that when i scan through the samples, there seems to be data missing, where as the sample number progresses, more of the sample name seems to vanish.
<br/>
Im not sure what is the best way to load MOD files.
<br/>
Can anyone help?
<br/>
<br/>
Thanks</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27581 - DekuTree64 - Sat Oct 16, 2004 12:54 am</h4>
    <div class="postbody"><span class="postbody">Probably what's happening is that your struct is being padded to 4 bytes, so when you say music-&gt;sam[1].name, you're actually getting 32 bytes past music-&gt;sam, skipping over the first 2 letters of its name.
<br/>
<br/>
I wouldn't really suggest trying to work with straight MOD files in your GBA project, it'll just bog your game down trying to deal with all the quirky aspects of it, and probably be even more work trying to keep your head straight than just writing a converter tool up front to format the data exactly to your liking.
<br/>
<br/>
&lt;shameless plug&gt;
<br/>
I'm not sure if you've seen it or not, but I'm writing an article series on creating a MOD player, check out <a class="postlink" href="http://deku.gbadev.org/program/sound3.html" target="_blank">day 3</a> for some info on creating a converter tool. They're always more ugly than they should be, but usually not too hard to get running properly anyway.
<br/>
&lt;/shameless plug&gt;<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27600 - gbawiz - Sat Oct 16, 2004 6:17 pm</h4>
    <div class="postbody"><span class="postbody">Thanks Dekutree,
<br/>
I had a feeling that it may have had something to do with the padding after reading another article in this forum which had similar problems.
<br/>
<br/>
What you suggest is to use some kind of converter, and link the converted file into the ROM?
<br/>
<br/>
Would this mean that you would have to create structures and copy the data into them, resulting in 2 copies of the data? one in the linked file and the other in the structures.
<br/>
<br/>
Thanks</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27604 - DekuTree64 - Sat Oct 16, 2004 8:17 pm</h4>
    <div class="postbody"><span class="postbody">I'm not sure I fully understand what you mean by having 2 copies of the data, the purpose of the converter is to avoid duplicating data. 
<br/>
<br/>
Using the original MOD file, you'd either have to handle all the things like misalignment and unscrambling the pattern data while playing, or reformat the data into a temporary location in RAM to make it easy to use.
<br/>
<br/>
Instead of doing all that on the GBA, the converter (which is a regular PC program) should read in the data from the file, and reformat it the same way you'd do it into that temporary RAM location, and then print it all out into C/assembly/header/binary files that you include in ROM. That way, you only have that one ROM copy of the data, and you can use it like it is.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
