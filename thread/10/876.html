<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Using the Bios buildin sound driver - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Audio > Using the Bios buildin sound driver</h2>
<div id="posts">
<div class="post">
    <h4>#4379 - I.C.E - Sat Mar 29, 2003 9:52 am</h4>
    <div class="postbody"><span class="postbody">I tried using the builtin sound driver in BIOS but i failed. Is there any sample source code or tutorials using and maybe explaining the calls? I have taken the structures directly from the CowBite document: 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
typedef struct tSoundArea {
<br/>
     u32 ident;           //Flag the system checks to see if the work area has been
<br/>
                          //initialized/currently being accessed.
<br/>
     vu8 DmaCount;        //User access prohibited
<br/>
     u8  reverb;          //Variable for applying reverb effects to direct sound
<br/>
     u16 d1;              //User access prohibited
<br/>
     void (*func)();      //User access prohibited
<br/>
     int intp;            //User access prohibited
<br/>
     void* NoUse;         //User access prohibited
<br/>
     SoundChannel vchn[MAX];     //Array of Direct Sound channel structures.
<br/>
     s8 pcmbuf[PCM_BF*2]; //??
<br/>
} SoundArea;
<br/>
<br/>
typedef struct tSoundChannel {
<br/>
     u8 sf;     //Channel status.  When 0 sound it is stopped.  To start sound, set other 
<br/>
                //parameters and then write 0x80h.  Logical OR 0x40 for a key-off, or
<br/>
                //write zero for a pause. The use of other bits is prohibited.
<br/>
     u8 r1;     //User access prohibited
<br/>
     u8 rv;     //Sound volume output to right side
<br/>
     u8 lv;     //Sound volume output to left side
<br/>
     u8 at;     //The attack value of the envelope.
<br/>
     u8 de;     //The decay value of the envelope.
<br/>
     u8 su;     //The sustain value of the envelope.
<br/>
     u8 re;     //The release value of the envelope. Key-off to enter this state.
<br/>
     u8 r2[4];  //User access prohibited
<br/>
     u32 fr;    //The frequency of the produced sound.
<br/>
     WaveData*  wp;     //Pointer to the sound's waveform data.
<br/>
     u32 r3[6];  //  User access prohibited
<br/>
     u8 r4[4];   //User access prohibited
<br/>
} SoundChannel;
<br/>
<br/>
typedef struct tWaveData {
<br/>
     u16 type;   //Indicates the data type. This is currently not used.
<br/>
     u16 stat;   //0 - non-looped 0x4000 - forward loop
<br/>
     u32 freq;   //Frequency.
<br/>
     u32 loop;   //Loop pointer (start of loop)
<br/>
     u32 size;   //Number of samples (end position)
<br/>
     s8 data[];  //The actual waveform data. Takes (number of samples+1)bytes of 8bit 
<br/>
                 //signed linear uncompressed data. The last byte is zero for a non-looped
<br/>
                 //waveform, and the same value as the loop pointer data for a looped waveform.
<br/>
} WaveData;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
But I havn't understand everything. What is pcmbuf[] for? What are the "User access prohibited" fields for?
<br/>
<br/>
I have called IRQ 0x1a once and then i call 0x1d and 0x1c in my vblank irq handler.[/quote]<br/>_________________<br/>To this day, many C programmers believe that "strong typing" just means pounding extra hard on the keyboard.
<br/>
 -  Peter van der Linden</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4387 - DekuTree64 - Sat Mar 29, 2003 4:24 pm</h4>
    <div class="postbody"><span class="postbody">I was trying to get it to work the other day, but it never seemed to do anything, so I tried it on hardware, and it just made the screen go reddish color, and made lots of noise. Which I guess meant it was working, but maybe it was configured wrong and locked it up so the VBL interrupt was never happening. 
<br/>
But I think that means VBA doesn't support it, and since I do most of my testing with VBA, I decided to go back to working on my own mixer (besides, I've heard the BIOS sound driver is slow).
<br/>
But if you ever manage to get it working, let me know cause I'd still like to try it out^^</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
