<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Problems playing a simple sound.  help wanted - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Audio > Problems playing a simple sound.  help wanted</h2>
<div id="posts">
<div class="post">
    <h4>#55538 - TheMikaus - Thu Sep 29, 2005 4:18 am</h4>
    <div class="postbody"><span class="postbody">This is the file I have set up (I'm using a recent copy of devKitArm and libgba)
<br/>
<br/>
When you call playSound with a pointer to the wave file (generated by wav2gba) no sound comes out at all.  natta.
<br/>
<br/>
Any ideas? or links?  I just need to fix this block of code to play the sound.  I didn't want to use AAS or krawall or anything like that.
<br/>
<br/>
Thanks in advance.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include "sound.h"
<br/>
<br/>
#include "gba_interrupt.h"
<br/>
<br/>
//Sound registers
<br/>
<br/>
//Values
<br/>
#define Sound_Enabled 0x00000080
<br/>
#define Sound_Output_Ratio_25 0x0000
<br/>
#define Sound_Output_Ratio_50 0x0001
<br/>
#define Sound_Output_Ration_100 0x002
<br/>
<br/>
#define DirectSoundA_Output_Ratio_50 0x0000
<br/>
#define DirectSoundA_Output_Ratio_100 0x0004
<br/>
#define DirectSoundA_Output_To_Right 0x0100
<br/>
#define DirectSoundA_Output_To_Left 0x0200
<br/>
#define DirectSoundA_Output_To_Both 0x0300
<br/>
<br/>
#define DirectSoundA_Timer0 0x0000
<br/>
#define DirectSoundA_Timer1 0x0400
<br/>
#define DirectSoundA_FIFO_Reset 0x0800
<br/>
<br/>
#define DirectSoundB_Output_Ratio_50 0x0000
<br/>
#define DirectSoundB_Output_Ratio_100 0x0008
<br/>
#define DirectSoundB_Output_To_Right 0x1000
<br/>
#define DirectSoundB_Output_To_Left 0x200
<br/>
#define DirectSoundB_Output_To_Both 0x3000
<br/>
<br/>
#define DirectSoundB_Timer0 0x0000
<br/>
#define DirectSoundB_Timer1 0x4000
<br/>
#define DirectSoundB_FIFO_Reset 0x8000
<br/>
<br/>
#define Register_Timer0D      *(volatile unsigned short *)0x4000100
<br/>
#define Register_Timer0Cnt   *(volatile unsigned short *)0x4000102
<br/>
#define Register_DMA1Source     *(volatile unsigned int *)0x40000BC
<br/>
#define Register_DMA1Destination *(volatile unsigned int *)0x40000C0
<br/>
#define Register_DMA1Cnt_H  (*(volatile unsigned short *)0x40000C6)
<br/>
<br/>
#define Timer_Enable 0x80
<br/>
<br/>
#define DMA_Dest_Fixed 64
<br/>
#define DMA_Repeat 512
<br/>
#define DMA_32 1024
<br/>
#define DMA_Enable 32768
<br/>
#define DMA_Timing_Sync_To_Display 4096 | 8192
<br/>
<br/>
#define Register_SGCNT0_H *(volatile unsigned short *)0x4000082
<br/>
#define Register_SGCNT1 *(volatile unsigned short *)0x400084
<br/>
#define DSound_A_Right_Channel 256
<br/>
#define DSound_A_Left_Channel 512
<br/>
#define DSound_A_FIFO_Reset 2048
<br/>
#define Sound_Master_Enable 128
<br/>
<br/>
<br/>
unsigned short sound_length;
<br/>
<br/>
void VblankInterrupt()
<br/>
{
<br/>
   sound_length--;
<br/>
   if(sound_length == 0)
<br/>
   {
<br/>
      //Turn off DMA and Timer
<br/>
      Register_Timer0Cnt = 0;
<br/>
      Register_DMA1Cnt_H = 0;
<br/>
   }
<br/>
}
<br/>
<br/>
<br/>
void InitSound()
<br/>
{
<br/>
   InitInterrupt();
<br/>
   SetInterrupt(Int_Vblank, VblankInterrupt);
<br/>
   EnableInterrupt(Int_Vblank);
<br/>
   
<br/>
   //Set up the sound registers too
<br/>
   Register_SGCNT0_H = DSound_A_Right_Channel | DSound_A_Left_Channel | DSound_A_FIFO_Reset;
<br/>
   
<br/>
   Register_SGCNT1 = Sound_Master_Enable;
<br/>
   
<br/>
   REG_IME = 1;
<br/>
}
<br/>
<br/>
void playSound(unsigned long * source, unsigned long size)
<br/>
{
<br/>
   unsigned short samples = (16777216 / 8000);
<br/>
   Register_DMA1Source = (unsigned int)source;
<br/>
   Register_DMA1Destination = (unsigned int)0x40000a0;
<br/>
   
<br/>
   Register_DMA1Cnt_H = DMA_Dest_Fixed | DMA_Repeat | DMA_32 | DMA_Timing_Sync_To_Display | DMA_Enable;
<br/>
   Register_Timer0D = 65536 - samples;
<br/>
   
<br/>
<br/>
   sound_length = (size / samples) * 15.57;
<br/>
   
<br/>
   Register_Timer0Cnt = Timer_Enable;
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
