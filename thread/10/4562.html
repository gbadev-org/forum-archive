<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Panoration - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Audio > Panoration</h2>
<div id="posts">
<div class="post">
    <h4>#30981 - ProblemBaby - Mon Dec 06, 2004 9:01 pm</h4>
    <div class="postbody"><span class="postbody">Hi 
<br/>
How is the volume in left and right calculated?
<br/>
if ive have a pan value between -64 and 64
<br/>
if it for example is far left than left should be played at full volume and right not at all, right?
<br/>
But if it is in middle what volume should left/right have??</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#30988 - tepples - Mon Dec 06, 2004 10:12 pm</h4>
    <div class="postbody"><span class="postbody">These formulas should work well enough on a handheld game:
<br/>
<br/>
Left: 100% left, 0% right
<br/>
Middle: 70% left, 70% right
<br/>
Right: 0% left, 100% right
<br/>
<br/>
The reason why middle isn't 50% involves an inverse square law, the fact that power is the square of amplitude.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#30992 - ProblemBaby - Mon Dec 06, 2004 10:30 pm</h4>
    <div class="postbody"><span class="postbody">thanks for the reply
<br/>
but ive to ask one more question:
<br/>
if it is between middle and left should right still be 70% then?
<br/>
<br/>
so it just to do something like:
<br/>
<br/>
rightvol = 70;
<br/>
leftvol = 70;
<br/>
<br/>
if (pan &gt; 0)
<br/>
finalrightvol = rightvol + pan;
<br/>
else if (pan &lt; 0)
<br/>
finalleftvol = leftvol - pan;</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#31007 - pyros - Tue Dec 07, 2004 12:21 am</h4>
    <div class="postbody"><span class="postbody">I suspect you will need a less 'discreet' function to give smooth fading.
<br/>
<br/>
I think the equations you are looking for are something like:
<br/>
<br/>
pan=-64 is left
<br/>
pan=0 is middle
<br/>
pan=64 is right
<br/>
<br/>
then: 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
leftvol  = 100  *  sqrt(128-(2*pan)) / 16
<br/>
<br/>
<br/>
rightvol = 100  *  sqrt(128+(2*pan)) / 16
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I think this would ensure that the power is always a constant 100%.
<br/>
<br/>
Obviously you will need to change the '100' value to something more appropriate.
<br/>
<br/>
I've not coded any sound before, so someone correct me if i'm wrong.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#31069 - bertsnks - Tue Dec 07, 2004 4:23 pm</h4>
    <div class="postbody"><span class="postbody">squareroot operation is very pricy on GBA I suspect - and calculating new volumes with XM is done almost on every 'tick' .</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#31075 - tepples - Tue Dec 07, 2004 5:13 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>bertsnks wrote:</b></span></td> </tr> <tr> <td class="quote">squareroot operation is very pricy on GBA I suspect</td> </tr></table><span class="postbody">
<br/>
Not with only 255 or fewer levels. In those cases, a square root can be done with a quick table lookup.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#31088 - pyros - Tue Dec 07, 2004 7:00 pm</h4>
    <div class="postbody"><span class="postbody">uh, i was assuming that pan was an integer.
<br/>
<br/>
if that was the case then for pan=-64 to 64, there would be only 128 leftvol values and 128 rightvol values. so quite a small lookup table. for anyone concerned about space, then you could actually use the same table for both, as rightvol[pan+64] = leftvol[64-pan] :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#31201 - ProblemBaby - Wed Dec 08, 2004 8:59 pm</h4>
    <div class="postbody"><span class="postbody">It was a nice formula thanks!
<br/>
I thought totally wrong when I wrote the other thing.
<br/>
But i changed it a bit cause it will only create 32 + 1 levels
<br/>
and i want 128 + 1.
<br/>
<br/>
so I did this
<br/>
leftvol = 100 * sqrt(2048 - (32 * pan)) &gt;&gt; 6;
<br/>
rightvol = 100 * sqrt(2048 + (32 * pan)) &gt;&gt; 6;
<br/>
<br/>
that must be correct, huh?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#31211 - pyros - Wed Dec 08, 2004 10:07 pm</h4>
    <div class="postbody"><span class="postbody">I'm not too sure what you mean. However, if pan is between -64 and 64, then the right-hand-side of the equation should be correct.
<br/>
<br/>
However, what you will need to change is the value '100'. Because what you need to produce is actually:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
leftvol  = sample  *  sqrt(128-(2*pan)) / 16 
<br/>
<br/>
rightvol = sample  *  sqrt(128+(2*pan)) / 16 
<br/>
<br/>
<br/>
Which will give:
<br/>
<br/>
if pan = -64, then:  leftvol = sample*1,    rightvol = sample*0
<br/>
if pan = 0,   then:  leftvol = sample*0.7,  rightvol = sample*0.7
<br/>
if pan = +64, then:  leftvol = sample*0,    rightvol = sample*1
<br/>
<br/>
obviously:
<br/>
sample*1 = full volume
<br/>
sample*0.7 = 'half power'
<br/>
sample*0 = silent
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
For ANY value of (-64&gt;pan&gt;64):
<br/>
leftvol^2 + rightvol^2 = sample^2
<br/>
Thus the total sound from both speakers combined is always at 'full power'.
<br/>
<br/>
When you put this in a lookup-table, you will have to use a set value instead of sample, and then multiply(and shift-right) for each actual sample.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
