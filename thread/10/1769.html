<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>c++, DevKitAdv & FRAS - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Audio > c++, DevKitAdv & FRAS</h2>
<div id="posts">
<div class="post">
    <h4>#9021 - mtg101 - Sat Jul 26, 2003 5:17 pm</h4>
    <div class="postbody"><span class="postbody">I'm using DevKitAdv (R4), and programming in C++.  And I'd like to have a MOD file playing in the background. So I've found FRAS and I'm having trouble using it.
<br/>
<br/>
Firstly - is FRAS the best thing to use?  Is there anything significantly better out there?
<br/>
<br/>
So onto the the problem...  I've generated, from the sample country.mod file, country.cpp &amp; country.h; and included stuff into my project with the following makefile:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
CFLAGS = -c -O3
<br/>
MODEL = -mthumb -mthumb-interwork 
<br/>
NAME = mydemo
<br/>
LIST =  $(NAME).o tilebg.o bgtext.o intro.o country.o
<br/>
<br/>
<br/>
all: $(NAME).mb.gba
<br/>
<br/>
$(NAME).mb.gba: $(NAME).elf 
<br/>
   objcopy -O binary $(NAME).elf $(NAME).mb.gba 
<br/>
   c:/gba/dev/gbaromfixer/gbafix -t$(NAME) $(NAME).mb.gba
<br/>
<br/>
$(NAME).elf: $(LIST) crt0.o
<br/>
   gcc $(MODEL) -nostartfiles -T lnkscript -o $(NAME).elf crt0.o obj/crtbegin.o obj/crtend.o fras.lib $(LIST) -lm
<br/>
<br/>
$(LIST): %.o: %.cpp
<br/>
   gcc $(MODEL) $(CFLAGS) $&lt;
<br/>
<br/>
crt0.o: crt0.s 
<br/>
   gcc $(CFLAGS) $(MODEL) crt0.S
<br/>
<br/>
clean:
<br/>
   rm -f *.o
<br/>
   rm -f *.elf
<br/>
   rm -f $(NAME).mb.gba
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
It compiles fine, but the linker fails (undefined reference) on the FRAS functions. What am I doing wrong?
<br/>
<br/>
<br/>
Cheers
<br/>
Russell<br/>_________________<br/>---
<br/>
Speaker for the Dead</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9024 - tepples - Sat Jul 26, 2003 5:35 pm</h4>
    <div class="postbody"><span class="postbody">Try putting the FRAS library after the $(LIST).
<br/>
<br/>
I also see that you downloaded a .lib file rather than a .a file. GNU Binutils tends to use .a files for static libraries. Are you dealing with a library that was compiled for use with ARM SDT rather than with the GNU toolchain?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9033 - mtg101 - Sat Jul 26, 2003 9:02 pm</h4>
    <div class="postbody"><span class="postbody">I've tried changing the order, putting extern "C" {} in the fras.h file, but none of that didn't help.
<br/>
<br/>
I don't know for sure how the .lib was compiled - but the devrs.com link says it's GCC. Maybe I'll haveto compile it myself... which as I don't know ASM willbe a challenge...
<br/>
<br/>
Can anyone suggest a GBA MOD player that might be easier to get up and running with DevKitAdv?<br/>_________________<br/>---
<br/>
Speaker for the Dead</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9035 - mtg101 - Sat Jul 26, 2003 10:04 pm</h4>
    <div class="postbody"><span class="postbody">OK - I've done somemore work and realised I had to hack the crt0.S file to enable inturupts and provide an interrupt table - done that, and unsuprisingly it didn't help.  But at least I got rid of a future problem :)<br/>_________________<br/>---
<br/>
Speaker for the Dead</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9054 - mtg101 - Sun Jul 27, 2003 12:45 pm</h4>
    <div class="postbody"><span class="postbody">After lots of tweaking lots of code with extern "C" {}, making sure fras.lib comes after the object files in the makefile, and realising that the FrasModStop() function doesn't exist, I've got it building now.  Doesn't actually play anything yet... but it'sa step in the right direction. Thanks.<br/>_________________<br/>---
<br/>
Speaker for the Dead</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9088 - mtg101 - Mon Jul 28, 2003 11:34 am</h4>
    <div class="postbody"><span class="postbody">I'm still having problems here.  Not only does sound not play, but the pattern/line counter global vars don't get updated (yes - I have declared them volatile).
<br/>
<br/>
Looks to me like the inturrupts aren't being called... I guess i'll have to go and find out more about how to get inturrupts working...  I was hoping just uncommenting the right lie in crt0.S would do it... ho hum....<br/>_________________<br/>---
<br/>
Speaker for the Dead</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9148 - mtg101 - Tue Jul 29, 2003 10:23 am</h4>
    <div class="postbody"><span class="postbody">Ah - maybe because it's becuase I'm not doing...
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
REG_DISPSTAT=0x0020;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
...to enable the VCOUNT interrupt.  I'll try that later when I get home (at work I'm not allowed to code GBAs :( )<br/>_________________<br/>---
<br/>
Speaker for the Dead</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9168 - mtg101 - Tue Jul 29, 2003 9:50 pm</h4>
    <div class="postbody"><span class="postbody">Setting REG_DISPSTAT worked - phew. Thanks for the help, and I'm off to read the Pern project tutorial om interrupts again...<br/>_________________<br/>---
<br/>
Speaker for the Dead</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9177 - tepples - Tue Jul 29, 2003 11:22 pm</h4>
    <div class="postbody"><span class="postbody">In general you have to do four things to enable an interrupts, preferably in this order:<ol type="1"><li>set the ISR to point at ARM code, preferably in IWRAM,</li><li>turn on the interrupt source,</li><li>turn on the corresponding mask flag in REG_IE, and</li><li>turn on the interrupt master enable.</li></ol>What you forgot was step 2.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
