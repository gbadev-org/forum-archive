<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>DMA problem - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Audio > DMA problem</h2>
<div id="posts">
<div class="post">
    <h4>#16284 - doudou - Wed Feb 11, 2004 7:24 pm</h4>
    <div class="postbody"><span class="postbody">We are 2 developer on a project. We have few weeks of development and so far, i did the graphic stuffs and the other guy did the audio stuff. We tried to merge our code and we have some major issues, like nothing works anymore. The problem seems to come from the dma. If in my code I put the "problematic line" (see below) in comment, we at least have the sound
<br/>
<br/>
void DMAFastCopy(const void* source,void* dest,unsigned int 	REG_DMA3SAD = (unsigned int)source;
<br/>
	REG_DMA3DAD = (unsigned int)dest;
<br/>
 	REG_DMA3CNT = count | mode;	  // problematic line
<br/>
}</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#16286 - doudou - Wed Feb 11, 2004 7:53 pm</h4>
    <div class="postbody"><span class="postbody">we have this code inspired from Jonathan Harbour's book :
<br/>
<br/>
void GBASound::enable_interrupt(void)
<br/>
{
<br/>
	REG_IME = INT_DISABLE;
<br/>
	REG_INTERRUPT = (u32) &amp;sound_handler;
<br/>
	REG_IE = INT_VBLANK;
<br/>
	REG_DISPSTAT = STS_ENABLE_VB;
<br/>
	REG_IME = INT_ENABLE;
<br/>
}
<br/>
<br/>
we don't know what the line REG_DISPSTAT = STS_ENABLE_VB; is doing, but when we remove it, it seems to work.
<br/>
<br/>
#define REG_DISPSTAT	*(u16*)	0x04000004	// Interrupt status register
<br/>
<br/>
<br/>
#define STS_ENABLE_VB	0x0008		// Enable vertical blank</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#16289 - poslundc - Wed Feb 11, 2004 8:23 pm</h4>
    <div class="postbody"><span class="postbody">How does your mixing routine get called? The REG_DISPSTAT line is what enables the VBlank interrupt, so if it works when you <span style="font-style: italic">turn that line off</span> it means that you must be calling your mix routine from some other spot in the code, because you're not generating an interrupt without it.
<br/>
<br/>
It seems like your problem may be rooted in interrupt handling in general. Does the code you're combining with the mixer use interrupts at all? Are you certain you're handling all of your interrupts properly, and setting the acknowledge bits at the end of each ISR?
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
