<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Sound lag - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Audio > Sound lag</h2>
<div id="posts">
<div class="post">
    <h4>#50961 - wiz - Sun Aug 14, 2005 10:15 pm</h4>
    <div class="postbody"><span class="postbody">Hello once again,
<br/>
<br/>
Following Deku's sound tutorial, I now have a sound mixer running (and sort of a mod playing in early stages)
<br/>
<br/>
I have imported the sound code to a small game but I notice when I play a sound it doesnt feel like is quite right.
<br/>
<br/>
Like a collision will sound very slightly after the collision was made.. I think this is to do with the double buffering?
<br/>
<br/>
Does this make sense?
<br/>
<br/>
if so, how can I avoid the delay? =/
<br/>
<br/>
Thank you!!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#50968 - DekuTree64 - Sun Aug 14, 2005 11:21 pm</h4>
    <div class="postbody"><span class="postbody">Yeah, that's the double buffering. You can't really fix it entirely, although you can make the delay shorter by using a timer interrupt to mix samples instead of VBlank, and triggering it more often. 
<br/>
Timer interrupts are usually more bug-prone though, so I'd suggest ignoring the problem :)
<br/>
<br/>
Another possibility is if your music is mono, then you can get immediate response on a single sound effect by playing it on the other hardware channel.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#50978 - wiz - Mon Aug 15, 2005 12:12 am</h4>
    <div class="postbody"><span class="postbody">ah, you'll have to bare with me as I'm very new to this area.  do you mean set up another timer and dont buffer the other channel which will be used purely for sfx?
<br/>
<br/>
how important is it to have a double buffering sound mixer?  reason I ask is because I took out the switching of the buffer and everything still appears to play fine.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#50980 - tepples - Mon Aug 15, 2005 12:17 am</h4>
    <div class="postbody"><span class="postbody">If your double buffering sound mixer is done right, you'll only get a maximum of 17 milliseconds of delay. Many implementations switch buffers every vblank. For example, with the timer set to -924 and the buffer length set to 304, you'll get a 18157 Hz playback that lasts exactly one frame so that you can switch buffers in your interrupt handler.
<br/>
<br/>
If you're mixing an entire row of the .mod file at a time, mix it to a separate buffer and then feed a snippet into the main mixer once every vblank.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#51003 - FluBBa - Mon Aug 15, 2005 8:15 am</h4>
    <div class="postbody"><span class="postbody">wiz: are you testing this in an emulator, if so you will probably experience a lot more lag than on the real deal.<br/>_________________<br/>I probably suck, my not is a programmer.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#51033 - wiz - Mon Aug 15, 2005 6:59 pm</h4>
    <div class="postbody"><span class="postbody">FluBBa: Spot on, I was testing in VBA and soon as I got home I tried it on hardware and it looks absolutely fine!  That'll teach me to do more testing in future.
<br/>
<br/>
Tepples: Thanks for that, I guess 17 millisecs is no problem at all :) 
<br/>
<br/>
and again, many thanks DekuTree64 for the sound tutorial, I have learned a lot from reading it!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#51062 - tepples - Tue Aug 16, 2005 12:29 am</h4>
    <div class="postbody"><span class="postbody">And about emulation: I get some noticeable controller-&gt;audio lag on the GameCube Game Boy Player, but not nearly as much as on VBA. The amount of lag that VBA introduces makes Konami's rhythm games unplayable.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
