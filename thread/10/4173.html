<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Frequence Tables - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Audio > Frequence Tables</h2>
<div id="posts">
<div class="post">
    <h4>#27171 - ProblemBaby - Tue Oct 05, 2004 10:27 am</h4>
    <div class="postbody"><span class="postbody">Hi
<br/>
<br/>
it is one thing I haven't got yet (probably more things later but for now) 
<br/>
Iam trying to make a modplayer and Ive samples that is different in frequency do Ive to stick to one frequency for all my samples?
<br/>
or doesnt it care. I dont exaclty understand the relationship between all the stuff of 8393hz, amiga period table, sample frequence, finetune, and the actual frequency on the GBA.
<br/>
<br/>
some information would be great!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27209 - ProblemBaby - Wed Oct 06, 2004 3:47 pm</h4>
    <div class="postbody"><span class="postbody">OK, Ive started to understand things now!
<br/>
I understand that Ive to stick to one frequency.
<br/>
But...
<br/>
If I open my MOD (with my 16khz samples) in ModPlugTracker
<br/>
the C-5, Middle C (My sample without pitch) is written C-6
<br/>
I understand that it is becuase the default is 8393 and 16384 is about one octave up.
<br/>
In SkaleTracker though they are corrected to C-5.
<br/>
How can they Calculate that  cuz the MOD has no information about frequency right?, just length!
<br/>
I want to correct it to C-5 in my mod2gba too so the pitch is totally correct. But I dont really know how.
<br/>
<br/>
second I want to build a Incremt table for each note.
<br/>
So I know how much to increment the sample each sample =)
<br/>
I know that 
<br/>
Inc = (frequency&lt;&lt;12) / 18157 (in my case)
<br/>
I also know that C-5 has frequency 16384 C-6 twice as much
<br/>
but what about the notes between?
<br/>
is it like I think a formula or is it unlogical?
<br/>
<br/>
Thanks</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27219 - SmileyDude - Wed Oct 06, 2004 11:14 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ProblemBaby wrote:</b></span></td> </tr> <tr> <td class="quote">How can they Calculate that  cuz the MOD has no information about frequency right?, just length!
<br/>
I want to correct it to C-5 in my mod2gba too so the pitch is totally correct. But I dont really know how.</td> </tr></table><span class="postbody">
<br/>
<br/>
I'm not entirely sure what you are asking, but I'll give it a shot (and, it may be a little bit off, so take it with a grain of salt :) ).
<br/>
<br/>
The MOD file stores periods, which are how many 3.5MHz clocks there should be between each sample.  But, on the GBA, this value is pretty useless as is -- you need to convert it to a sample rate.  The sample rate is basically 3.5MHz / period.
<br/>
<br/>
Now, the MOD document I have has differences for PAL and NTSC machines, and I'm assuming that this is for the Amiga.  But, I don't really understand why these should be different.  Is this just a result of tuning for NTSC and PAL that causes C-1 to be different periods?  And if so, doesn't that mean to accurately playback a MOD that you need to know if it's tuned for NTSC or PAL?
<br/>
<br/>
Does anyone have the real values that should be used in the conversion from period to frequency? :)
<br/>
<br/>
As for what to display, if the period doesn't match what the tracker has exactly, it has to find the closest match.  It could also be a difference between NTSC and PAL again.  But, in reality, what's being displayed has no bearing on what's getting played :)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ProblemBaby wrote:</b></span></td> </tr> <tr> <td class="quote">but what about the notes between?
<br/>
is it like I think a formula or is it unlogical?</td> </tr></table><span class="postbody">
<br/>
<br/>
It's a formula -- as you've seen, going one octave down or up involves multiplying or dividing by 2.  The tones in between are basically the 12th root of 2 apart, or approximately 1.05946309.  There are 12 tones in an octave.<br/>_________________<br/>dennis</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27221 - ProblemBaby - Wed Oct 06, 2004 11:31 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for the information about the frequeny now I understand that=)
<br/>
My other questions was a bit hard to understand I also think!
<br/>
Anyway I try to describe it again.
<br/>
<br/>
If I load a sample to my tracker that isnt 8393hz instead it is 16384 (for example).
<br/>
Ive to play a C-6 to hear the original sound that should be C-5 if it was a 8393hz sample, right
<br/>
well C-6 isnt totally correct either but it is close enough.
<br/>
this is the case for modPlugTracker BUT if I open the song in SkaleTracker it kind of knows the frequency I dont understand how cause it writes C-5 for the original sound. and not C-6.
<br/>
<br/>
And I want to work with 16khz samples and also be able to play
<br/>
C-7 notes but they would be out of range if I dont correct them C-5.
<br/>
<br/>
Hope you got my question!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27229 - poslundc - Thu Oct 07, 2004 12:53 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ProblemBaby wrote:</b></span></td> </tr> <tr> <td class="quote">And I want to work with 16khz samples</td> </tr></table><span class="postbody">
<br/>
<br/>
Then MOD isn't for you. Try one of the variations on it (S3M, IT, etc.). Most of them support higher-frequency samples, but you won't get MOD working with them unless you hack the format considerably.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27240 - ProblemBaby - Thu Oct 07, 2004 8:13 am</h4>
    <div class="postbody"><span class="postbody">I still wont the simpleness (does that word exist?) from the MOD-format
<br/>
the fantastic thing with for example SkaleTracker is that I can make a song without telling the program that it is a MOD, XM, SKM so 16khz works. 
<br/>
<br/>
and cause I will use a LUT for frequency in my musicplayer I cant accept a lot of different samplerates.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27241 - DekuTree64 - Thu Oct 07, 2004 8:52 am</h4>
    <div class="postbody"><span class="postbody">Do the variable frequency MODs from that tracker play properly in other trackers? Do they still show the correct note names (C, C#, D, etc)? It's possible that they just generate a period table for each sample based on its original frequency, and because MOD only stores the actual period values rather than note numbers, it would work as long as you could regenerate that same period table after saving/loading the file so you could keep the note names the same. The hitch is that MOD doesn't store the original frequency anywhere, so I don't know how they pulled that off. Maybe just append some custom data to the end of the file or something.
<br/>
<br/>
Most likely you won't be able to handle that in your player easily unless you store the period values like standard MOD, instead of converting them to note numbers or whatever. Working in periods involves a divide per channel to go from period to Hz, but that shouldn't be too much of a problem, especially if you only do it when the frequency actually changes. Even if you do go with a note/frequency table to get out of the mandatory period-to-Hz divide, you'll then have to divide when doing vibrato/pitch slides and stuff that are period-based, so you may want to work in periods to begin with (that is, assuming that I guessed right about how that tracker works)<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27250 - ProblemBaby - Thu Oct 07, 2004 5:18 pm</h4>
    <div class="postbody"><span class="postbody">Well to me its like magic.
<br/>
I will use XM instead I think.
<br/>
anyway i have one little question more..
<br/>
<br/>
Ive coded the Shell for my player in C
<br/>
it looks quite much like the one made by DekuTree (Day 2 of the Audio Mixing tutorial).
<br/>
<br/>
But it is damn slow! I dont do anything else then mixing even though the ?mixing two samples take 97% of the GBA if I try to have 3 or 4 it is totally distorted. is it that slow in C or have I missed something really important??</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27253 - SmileyDude - Thu Oct 07, 2004 5:49 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ProblemBaby wrote:</b></span></td> </tr> <tr> <td class="quote">But it is damn slow! I dont do anything else then mixing even though the ?mixing two samples take 97% of the GBA if I try to have 3 or 4 it is totally distorted. is it that slow in C or have I missed something really important??</td> </tr></table><span class="postbody">
<br/>
<br/>
In theory, you can write a fast mixer in C on the GBA, but I'm not really entirely sure on how it can be done.  I had pretty much the same results on my first mixer in C -- I could mix a couple of channels, but as soon as I added more channels, it all fell apart.  I found it much simpler to bite the bullet, and write a mixer in asm.  By doing that, I was able to optimize the mixing loop quite well register wise, and was easily able to pull of mixing more than 2 channels at once :)<br/>_________________<br/>dennis</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27256 - poslundc - Thu Oct 07, 2004 5:59 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ProblemBaby wrote:</b></span></td> </tr> <tr> <td class="quote">But it is damn slow! I dont do anything else then mixing even though the ?mixing two samples take 97% of the GBA if I try to have 3 or 4 it is totally distorted. is it that slow in C or have I missed something really important??</td> </tr></table><span class="postbody">
<br/>
<br/>
1. Have you tried it on hardware? Remember that emulator slowdown does not equal slow code.
<br/>
<br/>
2. Playing slowly or distorted sound doesn't necessarily equal slow code either; it's far more likely to be incorrect code than slow code.
<br/>
<br/>
It is far more likely that your mixer is <span style="font-style: italic">too slow to keep up with the sound processor</span> rather than <span style="font-style: italic">too slow to run on the GBA</span>. It is extremely suspicious when you say it takes 97% of the GBA's processor, in fact.
<br/>
<br/>
A C-coded mixer should, in fact, be sufficient to play music so long as it's efficiently coded. If you want to combine it with other things (like a game) then it will probably have to be coded in assembly.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27260 - ProblemBaby - Thu Oct 07, 2004 7:13 pm</h4>
    <div class="postbody"><span class="postbody">I meant 79% but it isnt fast either.
<br/>
First I want to get it working in C then I will convert it to ASM.
<br/>
and put in in IWRAM.
<br/>
<br/>
Well the code as I said is much like the code from DekuTrees tutorials on the topic.
<br/>
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
for (n = 0; n &lt; 304; n++)
<br/>
TempBuffer[n] = 0;
<br/>
<br/>
for (n = 0; n &lt; 304; n++)
<br/>
Snd.CurrentMixBuf[n] = TempBuffer[n] &gt;&gt; 1;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I tried to just have this code in my update function to see how much that was spent.
<br/>
and it was 12% can it be true??</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27267 - DekuTree64 - Thu Oct 07, 2004 9:22 pm</h4>
    <div class="postbody"><span class="postbody">Do you have the mixer code compiled as ARM in IWRAM? That should speed it up a bunch, but even THUMB in ROM shouldn't be THAT bad. You'll probably want to rewrite in ASM eventually, but C should be able to mix at least 4 channels in a reasonable amount of time. 
<br/>
<br/>
For what it's worth, I actually have some free time again, so I'm back to writing on the article series. Hopefully I'll have the beginnings of a MOD player up within the next few days, which should be somewhat helpful for doing XM too.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27268 - ProblemBaby - Thu Oct 07, 2004 9:29 pm</h4>
    <div class="postbody"><span class="postbody">Nice, I will check it out!
<br/>
<br/>
Actually iam trying to mix 8 channels.
<br/>
But that is all i do.
<br/>
Ive tried to optimize a little bit, so now I can play 3 channels with 97% CPU=)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27280 - tepples - Fri Oct 08, 2004 2:48 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>SmileyDude wrote:</b></span></td> </tr> <tr> <td class="quote">In theory, you can write a fast mixer in C on the GBA, but I'm not really entirely sure on how it can be done.  I had pretty much the same results on my first mixer in C -- I could mix a couple of channels, but as soon as I added more channels, it all fell apart.</td> </tr></table><span class="postbody">
<br/>
The mixer in Tetanus On Drugs is in C and somewhat optimized. The keys are 1. ARM code in IWRAM, 2. a bit of explicit unrolling, and 3. occasionally glancing at the generated assembly code. It takes about 20% CPU when mixing eight samples at 18 kHz. Sure it's not as efficient as AAS, but I'm not enough of a genius to understand how the Payback texture mapper works either.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
