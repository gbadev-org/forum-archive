<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Boyscout Playback Library - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Audio > Boyscout Playback Library</h2>
<div id="posts">
<div class="post">
    <h4>#38615 - SNES-lover - Tue Mar 29, 2005 4:47 pm</h4>
    <div class="postbody"><span class="postbody">Hi.
<br/>
I've started using Boyscout in the days, but as you all propably know, the playback library that comes with it doesn't work properly onm hardware, as Channel 3 doesn't make any sound at all.
<br/>
<br/>
Is there anyone out there that has a solution to this, or maybe someone has made their own code for playback(I'm programming in C using Devkit Advance).
<br/>
<br/>
I think many would be really grateful if code working on hardware would be made public.<br/>_________________<br/>In a realm beyond sight,
<br/>
the sky shines gold, not blue.
<br/>
There, the Triforce might
<br/>
make mortal dreams come true.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#38749 - Bowser - Thu Mar 31, 2005 10:22 am</h4>
    <div class="postbody"><span class="postbody">Yes, that would be nice! I'm using Devkitadv also with Boyscout, and no sound on channel 3 when runing on my real GBA SP!
<br/>
<br/>
And it's a pain in the butt, to get the Boyscout code to work in Multiboot mode. However, I did get it to work in Multiboot mode without editing the Boyscout code!
<br/>
<br/>
I can post what I did and my code, if you guys want?
<br/>
<br/>
Edit: Wow! This is my first post, since I joined here last year!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#38752 - SNES-lover - Thu Mar 31, 2005 11:01 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Bowser wrote:</b></span></td> </tr> <tr> <td class="quote">However, I did get it to work in Multiboot mode without editing the Boyscout code!
<br/>
<br/>
I can post what I did and my code, if you guys want?
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Yes, I have that problem too.. If you care to post it, that would be pretty nice =)<br/>_________________<br/>In a realm beyond sight,
<br/>
the sky shines gold, not blue.
<br/>
There, the Triforce might
<br/>
make mortal dreams come true.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#38753 - Bowser - Thu Mar 31, 2005 11:51 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Bowser wrote:</b></span></td> </tr> <tr> <td class="quote"> And it's a pain in the butt, to get the Boyscout code to work in Multiboot mode. However, I did get it to work in Multiboot mode without editing the Boyscout code! </td> </tr></table><span class="postbody">
<br/>
<br/>
Oops! You DO need to edit one line of code in the Boyscout.cpp file:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">// Default memory to beginning of external RAM
<br/>
          g_nBoyScoutMemoryArea = 0x02000000;
<br/>
<br/>
Change to:
<br/>
<br/>
g_nBoyScoutMemoryArea = 0x02FA0000;</td> </tr></table><span class="postbody">
<br/>
<br/>
That way, Boyscout uses that memory area for it's ram buffer, and not right over the multiboot program. Then put:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">int __gba_multiboot;</td> </tr></table><span class="postbody">
<br/>
<br/>
At the top off your main code file.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#38760 - FluBBa - Thu Mar 31, 2005 12:42 pm</h4>
    <div class="postbody"><span class="postbody">The EWRAM is 0x02000000-0x0203FFFF, so use g_nBoyScoutMemoryArea = 0x02020000 instead.
<br/>
Is the source available for the BoyScout player, the problem with channel 3 is probably due to swapping of the wave ram banks.<br/>_________________<br/>I probably suck, my not is a programmer.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#38764 - wintermute - Thu Mar 31, 2005 1:06 pm</h4>
    <div class="postbody"><span class="postbody">source can be found here -&gt; <a href="http://www.pidelipom.com/boyscout/" target="_blank">http://www.pidelipom.com/boyscout/</a>
<br/>
<br/>
as for the memory use the provided functions instead
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
///////////////////////////////////////////////////////////////////////
<br/>
// Function: BoyScoutSetMemoryArea                                   //
<br/>
//                                                                   //
<br/>
// Description: Sets the address to the beginning of a memory area   //
<br/>
//            that BoyScout may use. This is basically for storing //
<br/>
//            pattern description for faster access times.         //
<br/>
//                                                                   //
<br/>
// Parameters: Address to the memory area beginning.                 //
<br/>
//                                                                   //
<br/>
void BoyScoutSetMemoryArea(unsigned int nMemoryAddress) ///////////////
<br/>
{
<br/>
   // Set it
<br/>
   g_nBoyScoutMemoryArea = nMemoryAddress;
<br/>
}
<br/>
// End of BoyScoutSetMemoryArea
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
You can use BoyScoutSetMemoryArea(0x02020000); after the BoyScoutInitialize(); call.
<br/>
<br/>
You should really malloc a buffer though.
<br/>
<br/>
From the BoyScout manual
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void AgbMain(void)
<br/>
{
<br/>
     unsigned int nBSSongSize;
<br/>
<br/>
// Initialize BoyScout
<br/>
BoyScoutInitialize();
<br/>
<br/>
// Get needed song memory
<br/>
nBSSongSize = BoyScoutGetNeededSongMemory((unsigned char *)SongData);
<br/>
<br/>
// Allocate and set BoyScout memory area
<br/>
BoyScoutSetMemoryArea((unsigned int)malloc(nBSSongSize));
<br/>
<br/>
// Open song
<br/>
BoyScoutOpenSong((unsigned char *)SongData);
<br/>
<br/>
// Play song and loop
<br/>
BoyScoutPlaySong(1);
<br/>
<br/>
while(1)
<br/>
{
<br/>
     // Wait for vertical blank
<br/>
WaitForVSync();
<br/>
<br/>
// Update song
<br/>
BoyScoutUpdateSong();
<br/>
     }
<br/>
<br/>
// This part will never be reached but just for completion
<br/>
// Free memory
<br/>
free((void *)BoyScoutGetMemoryArea());
<br/>
}
<br/>
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#38842 - Bowser - Fri Apr 01, 2005 10:33 am</h4>
    <div class="postbody"><span class="postbody">I put together a simple program, Edited one line o code in Boyscout.cpp , included a some test music I made, and renamed some files. It also works with Multiboot but, still no sound 3. And, I got it to come out REALY small: 8.25KBs :)
<br/>
<br/>
Download it from my site:
<br/>
*Right click, Save Target As...*
<br/>
<br/>
<a class="postlink" href="http://www.VirtualMario.com/download/R.B.J-BSTestTune.zip" target="_blank">http://www.VirtualMario.com/download/R.B.J-BSTestTune.zip</a></span><span class="gensmall"><br/><br/>Last edited by Bowser on Wed Apr 13, 2005 6:22 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#38851 - FluBBa - Fri Apr 01, 2005 1:41 pm</h4>
    <div class="postbody"><span class="postbody">They only set the waveram bank to 1 and never switch it.
<br/>
<br/>
from line 612:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
         // Copy waveform to bank 0
<br/>
         SG30L = SG30LSTEP32   | SG30LSETBANK1;
<br/>
<br/>
            // WK add conditional define, and fix software copy
<br/>
<br/>
            #if(USE_DMA)
<br/>
<br/>
            DMA3Copy32((unsigned int)&amp;g_pSound3WaveForms[4*g_nSound3PlayWaveForm], (unsigned int)&amp;SGWRAM, 4);
<br/>
<br/>
            #else
<br/>
<br/>
         pSrc = (unsigned int*)&amp;g_pSound3WaveForms[4*g_nSound3PlayWaveForm];
<br/>
         pDst = (unsigned int*)&amp;SGWRAM;
<br/>
         pDst[0] = pSrc[0];
<br/>
         pDst[1] = pSrc[1];
<br/>
         pDst[2] = pSrc[2];
<br/>
         pDst[3] = pSrc[3];
<br/>
<br/>
            #endif
<br/>
      }
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
You should probably insert
<br/>
			SG30L = SG30LSTEP32	| SG30LSETBANK0;
<br/>
after the copy so the GBA actually uses the new waveram...<br/>_________________<br/>I probably suck, my not is a programmer.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#38890 - wintermute - Fri Apr 01, 2005 5:34 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>FluBBa wrote:</b></span></td> </tr> <tr> <td class="quote">They only set the waveram bank to 1 and never switch it.
<br/>
<br/>
from line 612:
<br/>
<br/>
You should probably insert
<br/>
			SG30L = SG30LSTEP32	| SG30LSETBANK0;
<br/>
after the copy so the GBA actually uses the new waveram...</td> </tr></table><span class="postbody">
<br/>
<br/>
That's the initial wave loading, the switching is done at line 841
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
            // Set to correct bank
<br/>
            if(g_iSound3PlayBank == 1)
<br/>
               SG30L = SG30LSTEP32 | SG30LSETBANK1;
<br/>
            else
<br/>
               SG30L = SG30LSTEP32 | SG30LSETBANK0;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
and waveform updating done at 1071
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   // UPDATE SOUND3 WAVE FORM DATA //
<br/>
<br/>
   // If a new waveform is set
<br/>
   if(g_aRLESound3[2].nValue != g_nSound3PlayWaveForm &amp;&amp; g_aRLESound3[2].nValue != PATTERN_PARAMETER_EMPTY)
<br/>
   {
<br/>
      // If a valid wave form
<br/>
      if(g_aRLESound3[2].nValue &lt; g_cSound3WaveForms)
<br/>
      {
<br/>
         unsigned int *pDst, *pSrc;
<br/>
         // Set wave form
<br/>
         g_nSound3PlayWaveForm = g_aRLESound3[2].nValue;
<br/>
<br/>
<br/>
            // WK add conditional define, and fix software copy
<br/>
<br/>
         // Copy wave form to WRAM
<br/>
            #if(USE_DMA)
<br/>
            
<br/>
         DMA3Copy32((unsigned int)&amp;g_pSound3WaveForms[4*g_nSound3PlayWaveForm], (unsigned int)&amp;SGWRAM, 4);
<br/>
<br/>
            #else
<br/>
<br/>
         pSrc = (unsigned int*)&amp;g_pSound3WaveForms[4*g_nSound3PlayWaveForm];
<br/>
         pDst = (unsigned int*)&amp;SGWRAM;
<br/>
         pDst[0] = pSrc[0];
<br/>
         pDst[1] = pSrc[1];
<br/>
         pDst[2] = pSrc[2];
<br/>
         pDst[3] = pSrc[3];
<br/>
<br/>
            #endif
<br/>
<br/>
         // Set current play bank
<br/>
         if(g_iSound3PlayBank == 1)
<br/>
            g_iSound3PlayBank = 0;
<br/>
         else
<br/>
            g_iSound3PlayBank = 1;
<br/>
      }
<br/>
   }
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
I submitted a couple of fixes to Christer just now
<br/>
<br/>
the problem with hardware playback is at line 875
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
            SG31  = SG31FREQUENCY(canNoteFrequencies[g_anSound3Params[3]-36]) | SG31PLAYONCE;
<br/>
<br/>
            SG31  |= SG31INIT;
<br/>
            SG30L |= SG30LPLAY;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
which should read
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
            SG30L |= SG30LPLAY;
<br/>
            SG31  = SG31FREQUENCY(canNoteFrequencies[g_anSound3Params[3]-36]) | SG31PLAYONCE;
<br/>
<br/>
            SG31  |= SG31INIT;
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#38891 - wintermute - Fri Apr 01, 2005 5:44 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Bowser wrote:</b></span></td> </tr> <tr> <td class="quote">I put together a simple program, Edited one line o code in Boyscout.cpp , included a some test music I made, and renamed some files. It also works with Multiboot but, still no sound 3. And, I got it to come out REALY small: 8.25KBs :)
<br/>
<br/>
Download it from my site:
<br/>
*Right click, Save Target As...*
<br/>
<br/>
<a class="postlink" href="http://www.virtualmario.com/BSLib.zip" target="_blank">http://www.virtualmario.com/BSLib.zip</a></td> </tr></table><span class="postbody">
<br/>
<br/>
that's such a horrible build system
<br/>
<br/>
devkitARM_r11 makes a binary of 6,528 bytes with your tune
<br/>
<br/>
<br/>
<a href="http://l33t.spod.org/~WntrMute/Boyscout.zip" target="_blank">http://l33t.spod.org/~WntrMute/Boyscout.zip</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39148 - Bowser - Tue Apr 05, 2005 5:31 am</h4>
    <div class="postbody"><span class="postbody">Boyscout lib sets, sound 3 notes, step, ect... Just fine but, it does NOT set the Wave form data when on a real GBA/SP or it sets it to FF FF FF ect...!
<br/>
<br/>
Wintermute, your Makefile won't work for me at all! I set things right but, it just won't work!
<br/>
<br/>
And your BoyS example, all sounds work fine on a emulater but not the real thing, and sound 4 sounds fine on both with your example but, sound 4 only sounds good on a emulater with my example! Kinda weard... Must be DevKitAdv with the memory! :P
<br/>
<br/>
I also tried the code fix you said starting at line 875 but, it did'nt work.
<br/>
<br/>
I'm sure somebody can fix the sound 3 playback! ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39212 - wintermute - Wed Apr 06, 2005 1:23 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Bowser wrote:</b></span></td> </tr> <tr> <td class="quote">Boyscout lib sets, sound 3 notes, step, ect... Just fine but, it does NOT set the Wave form data when on a real GBA/SP or it sets it to FF FF FF ect...!
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
well, the last attempt sounded like it wasn't setting the notes properly to me.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Wintermute, your Makefile won't work for me at all! I set things right but, it just won't work!
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
well, devkitadvance is a bit behind the times now :P
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
I'm sure somebody can fix the sound 3 playback! ;)</td> </tr></table><span class="postbody">
<br/>
<br/>
yeah, try this
<br/>
<br/>
<a href="http://l33t.spod.org/~WntrMute/WorkingBoyscout.zip" target="_blank">http://l33t.spod.org/~WntrMute/WorkingBoyscout.zip</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39226 - Bowser - Wed Apr 06, 2005 5:28 am</h4>
    <div class="postbody"><span class="postbody">Wintermute, you did it!!! You MUST send it to the Boyscout owner! Now it's time to start making music using Boyscout!
<br/>
<br/>
As for your makefiles, I DID use DevkitArm with makesys but, it came up with lots of dir errors and can't find file errors! I'll try again later.
<br/>
<br/>
To everyone: I know this is a little bit offtopic but, I finished my BoyS test tune, download below (Right click, Save As):
<br/>
<br/>
<br/>
<a class="postlink" href="http://www.VirtualMario.com/download/R.B.J-BSTestTune.zip" target="_blank">http://www.VirtualMario.com/download/R.B.J-BSTestTune.zip</a>
<br/>
<br/>
Great job Wintermute, on the Boyscout Lib!!!</span><span class="gensmall"><br/><br/>Last edited by Bowser on Wed Apr 13, 2005 6:21 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#39233 - SNES-lover - Wed Apr 06, 2005 9:31 am</h4>
    <div class="postbody"><span class="postbody">wintermute, I tested out your updated library and the code in my project this morning, but it made no difference to the distorted sounds at all(in multiboot at least). I will check it out properly when I come home from school and meetings tonight.<br/>_________________<br/>In a realm beyond sight,
<br/>
the sky shines gold, not blue.
<br/>
There, the Triforce might
<br/>
make mortal dreams come true.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39234 - Bowser - Wed Apr 06, 2005 10:04 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>SNES-lover wrote:</b></span></td> </tr> <tr> <td class="quote">wintermute, I tested out your updated library and the code in my project this morning, but it made no difference to the distorted sounds at all(in multiboot at least). I will check it out properly when I come home from school and meetings tonight.</td> </tr></table><span class="postbody">
<br/>
<br/>
Yep! It is DevKitAdv! We need to start using DevkitArm! *Go's and Trys using DevkitArm again!* :P
<br/>
<br/>
And I updated my tune cause, I set the notes to lood on sound 4 in the music. :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39236 - SNES-lover - Wed Apr 06, 2005 10:54 am</h4>
    <div class="postbody"><span class="postbody">Yep, it is DevKitAdvance I'm using, as I'm going with HAM and the HAMlib.. Maybe I'll try to go DevKitARM with the HAMlib if it's possible ;/<br/>_________________<br/>In a realm beyond sight,
<br/>
the sky shines gold, not blue.
<br/>
There, the Triforce might
<br/>
make mortal dreams come true.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
