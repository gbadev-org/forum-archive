<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>DMA, Timers, Argh! - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Audio > DMA, Timers, Argh!</h2>
<div id="posts">
<div class="post">
    <h4>#49952 - wiz - Wed Aug 03, 2005 10:40 pm</h4>
    <div class="postbody"><span class="postbody">Hello,
<br/>
<br/>
I'm following Deku's sound tutorial, which is really fantastic, but because I'm thick its taking a while for me to understand the first part (Timer and DMA)
<br/>
<br/>
For now there are 2 simple things I would like to clear up..
<br/>
<br/>
1) What *is* the _L and _H and _X representing on the reg defines?  e.g. REG_SOUNDCNT_H  (actually this is not a "sound" related question at all)
<br/>
<br/>
2) after a lot of messing and testing I have raw sound playing without any stopping in the code below:
<br/>
<br/>
I would like to know why its using DMA1, why not DMA2 - I havent set it up to use any... so whats all that about?  whats telling it which to use? I dont like when things just work without knowing why or how. ;)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
REG_SOUNDCNT_H = SOUNDA_TIMER1 | SOUNDA_VOLUME_100 | SOUNDA_LOUT | SOUNDA_ROUT | SOUNDA_FIFO_RESET;
<br/>
REG_SOUNDCNT_X = SOUND_ENABLE;
<br/>
<br/>
REG_TM1D = 65536 - 800;
<br/>
REG_TM1CNT = TIMER_ENABLE;
<br/>
<br/>
REG_DMA1SAD = (u32) (s8*)TestSndSample;
<br/>
REG_DMA1DAD = (u32) &amp;(REG_FIFO_A_H);
<br/>
REG_DMA1CNT_H = DMA_DEST_FIXED | DMA_REPEAT | DMA_WORD | DMA_MODE_FIFO | DMA_ENABLE;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Thanks!!
<br/>
<br/>
p.s Deku if you read this, I think there is a small bug on page one.. on the line REG_TM0D = 65536 - (16777216 / soundFreq);    &lt;- I changed this to REG_TM1D for it to work.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49953 - poslundc - Wed Aug 03, 2005 11:20 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wiz wrote:</b></span></td> </tr> <tr> <td class="quote">1) What *is* the _L and _H and _X representing on the reg defines?  e.g. REG_SOUNDCNT_H  (actually this is not a "sound" related question at all)</td> </tr></table><span class="postbody">
<br/>
<br/>
_L and _H stand for Low and High, and represent the lower and upper 16-bits of a 32-bit register, respectively. I almost always just refer to the entire register without splitting it up into _L and _H within my code, and there are extremely few situations that actually require you to do so.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I would like to know why its using DMA1, why not DMA2 - I havent set it up to use any... so whats all that about?  whats telling it which to use? I dont like when things just work without knowing why or how. ;)</td> </tr></table><span class="postbody">
<br/>
<br/>
DMAs 1 and 2 are intended (but not required) to work with sound and have a special mode for doing so. Other than that, there's no difference between 1 and 2 other than that 1 will preempt 2 if the two should its trigger fire while 2 is running. You are given both so that you may use both at once for stereo sound.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49957 - wiz - Wed Aug 03, 2005 11:42 pm</h4>
    <div class="postbody"><span class="postbody">Great thanks Poslundc, all makes sense, :)
<br/>
<br/>
but I'm still a little puzzled because if I change my code to read DMA2's instead of DMA1's it does not play the sound anymore?
<br/>
<br/>
I'm just missing something obvious ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49958 - wiz - Wed Aug 03, 2005 11:49 pm</h4>
    <div class="postbody"><span class="postbody">ahh,
<br/>
<br/>
is it because SOUNDB is linked to DMA2, and SOUNDA is linked to DMA1 ?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#58696 - SittingDuck - Tue Oct 25, 2005 1:24 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wiz wrote:</b></span></td> </tr> <tr> <td class="quote">ahh,
<br/>
<br/>
is it because SOUNDB is linked to DMA2, and SOUNDA is linked to DMA1 ?</td> </tr></table><span class="postbody">
<br/>
<br/>
Yes. I have heard somewhere that they are 'hard-wired' that way.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#71377 - nmain - Sun Feb 12, 2006 6:53 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<br/>
DMAs 1 and 2 are intended (but not required) to work with sound and have a special mode for doing so.</td> </tr></table><span class="postbody">
<br/>
<br/>
Just to clarify:  You can use DMA 1&amp;2 to do other things, but you can't use other DMA channels to fill the direct sound.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#72516 - SittingDuck - Sun Feb 19, 2006 11:43 am</h4>
    <div class="postbody"><span class="postbody">Yes, I think so.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
