<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>GBA MOD player - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Audio > GBA MOD player</h2>
<div id="posts">
<div class="post">
    <h4>#173881 - gelinlonlin - Thu May 06, 2010 11:45 am</h4>
    <div class="postbody"><span class="postbody">I am do a GBA mod player now,and i have seen this:http://deku.gbadev.org/program.html 
<br/>
Now, i have a problem.In deku's code,there is a DMA3 using for sound.
<br/>
I can not understand it.like i=0, for what?
<br/>
IN sound.c:
<br/>
s32 i, curChn;
<br/>
<br/>
		// If you want to use a higher frequency than 18157, 
<br/>
		// you'll need to make this bigger. 
<br/>
		// To be safe, it would be best to set it to the buffer 
<br/>
		// size of the highest frequency we allow in freqTable
<br/>
	s16 tempBuffer[304];
<br/>
<br/>
		// zero as much of the buffer as we'll actually use, 
<br/>
		// rounding samples up to nearest 2 for memset32
<br/>
	i = 0;
<br/>
	Dma3(tempBuffer, &amp;i, (samplesToMix+1)*sizeof(s16)/4, DMA_MEMSET32);
<br/>
<br/>
thanks for explaining.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#173883 - Maximus32 - Thu May 06, 2010 12:00 pm</h4>
    <div class="postbody"><span class="postbody">It's a fast (dma) version of memset, clearing the tempBuffer to 0. The only difference is this function does 32bit at a time, where memset does 8bit at a time.<br/>_________________<br/>Bricks-OS, Operating System for Game Consoles</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#173885 - Ruben - Thu May 06, 2010 1:32 pm</h4>
    <div class="postbody"><span class="postbody">Yeah, as was mentioned earlier, it's just a DMA-based memset32 to clear the mixing buffer. IMO, it'd probably be best to have the buffer in RAM rather than the stack and use CPU-based clearing rather than DMA to make sure there are no conflicts.
<br/>
<br/>
So something like...</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">//outside the function
<br/>
static s16 MixingBuffer[304];
<br/>
<br/>
//in the function...
<br/>
int i = (samplesToMix+1)*sizeof(s16) / sizeof(u32);
<br/>
u32 *dst = (u32*)MixingBuffer;
<br/>
do {
<br/>
Â  *dst++ = 0;
<br/>
} while(--i);</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#173888 - Dwedit - Thu May 06, 2010 8:10 pm</h4>
    <div class="postbody"><span class="postbody">I thought CPU-based memsets were faster than DMA on the GBA.  Assuming of course you are using the stmia instruction with at least 8 registers.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#173897 - Ruben - Fri May 07, 2010 3:30 am</h4>
    <div class="postbody"><span class="postbody">Yeah, I'm pretty sure it is faster as DMA would have to load from the source address for every write even if it's fixed source.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
