<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>GBC sound 1 - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Audio > GBC sound 1</h2>
<div id="posts">
<div class="post">
    <h4>#10829 - Daikath - Wed Sep 17, 2003 2:51 pm</h4>
    <div class="postbody"><span class="postbody">I've tried to set the registers to play a GBC sound, sound 1 to be exact but when I play my emulator it won't let me hear anything.
<br/>
<br/>
I've set the hardware registers like this.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void soundplay(void)
<br/>
{
<br/>
REG_SOUND1CNT_L = 0x0074;
<br/>
REG_SOUND1CNT_H = 0xCC07;
<br/>
REG_SOUND1CNT_X = 0x05C0;
<br/>
}
<br/>
<br/>
void AgbMain(void)
<br/>
{
<br/>
REG_SOUNDCNT_X = 0x80;
<br/>
REG_SOUNDCNT_L = 0x1177;
<br/>
REG_SOUNDCNT_H = 2;
<br/>
<br/>
while(1)
<br/>
   {
<br/>
   soundplay();
<br/>
   }
<br/>
}
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/>?There are no stupid questions but there are a LOT of inquisitive idiots.?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10840 - gb_feedback - Wed Sep 17, 2003 7:32 pm</h4>
    <div class="postbody"><span class="postbody">Sorry to reply without looking up what the result would be.
<br/>
<br/>
But what if you just played it once, rather than every few us?<br/>_________________<br/><a class="postlink" href="http://www.bookreader.co.uk/" target="_blank">http://www.bookreader.co.uk/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10851 - Daikath - Thu Sep 18, 2003 10:34 am</h4>
    <div class="postbody"><span class="postbody">Did that and it didn;t work, still thanks for the effort though.<br/>_________________<br/>?There are no stupid questions but there are a LOT of inquisitive idiots.?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10853 - gb_feedback - Thu Sep 18, 2003 1:21 pm</h4>
    <div class="postbody"><span class="postbody">I once had something going with sound 1-4 before I started to use the digital output. I've lost my code, but I looked at the stuff on the web which I used to learn how to do it.
<br/>
<br/>
The most obvious thing that is different is that in the code I just looked at the note is played by:
<br/>
<br/>
stopping anything which is playing 
<br/>
<br/>
NR51_REG &amp;= 0xEE;
<br/>
<br/>
adjusting the settings for the next note
<br/>
<br/>
NR12_REG = 
<br/>
NR11_REG = 
<br/>
NR10_REG = 
<br/>
NR13_REG = 
<br/>
NR14_REG = 		
<br/>
<br/>
then starting the sound playing again
<br/>
<br/>
NR51_REG |= 0x11;
<br/>
<br/>
Of course this is GBC code; you have to map this onto the GBA names for the regs. But it certainly used to work for me. So my theory is that the note is played only when  you do the NR51_REG |= 0x11;
<br/>
This would correspond to the upper byte of SOUNDCNT_L
<br/>
<br/>
The code by the way comes from the excellent Ultima 3 for the Gameboy at <a class="postlink" href="http://home.nc.rr.com/sven/ultima3.html" target="_blank">http://home.nc.rr.com/sven/ultima3.html</a> which contains the source code for a complete player.
<br/>
<br/>
EDIT: and of course you should still give the note time to play before you try it again...<br/>_________________<br/><a class="postlink" href="http://www.bookreader.co.uk/" target="_blank">http://www.bookreader.co.uk/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10870 - Vortex - Thu Sep 18, 2003 7:28 pm</h4>
    <div class="postbody"><span class="postbody">These are the functions I use to play sound for channels 1-2:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define DUTY_CICLE_12 (0x0000)
<br/>
#define DUTY_CICLE_25 (0x0040)
<br/>
#define DUTY_CICLE_50 (0x0080)
<br/>
#define DUTY_CICLE_75 (0x00C0)
<br/>
<br/>
void InitSound(void)
<br/>
{
<br/>
   // Turn on sound circuit
<br/>
   REG_SOUNDCNT_X = 0x80;
<br/>
<br/>
   // Full volume, enable sound 1 &amp; 2 to left and right
<br/>
   REG_SOUNDCNT_L = 0x3377;
<br/>
<br/>
   // Overall output ratio - Full
<br/>
   REG_SOUNDCNT_H = 2;
<br/>
}
<br/>
<br/>
void PlaySoundChannel2(u8 duration, u16 frequency, u16 duty_cicle)
<br/>
{
<br/>
   REG_SOUND2CNT_L = 0xF000 | duty_cicle | duration;    // No Envelope
<br/>
   REG_SOUND2CNT_H = 0xC000 | frequency;             // Timed mode
<br/>
}
<br/>
<br/>
void PlayMelody( const u16* notes, u16 size )
<br/>
{
<br/>
   u16 i;
<br/>
<br/>
   for( i = 0; i &lt; size; i++)
<br/>
   {
<br/>
      PlaySoundChannel2( 0xA0, notes[i], DUTY_CICLE_50 );
<br/>
<br/>
      // wait while the sound is playing
<br/>
      while(REG_SOUNDCNT_X &amp; 2)
<br/>
      {
<br/>
      }
<br/>
   }
<br/>
}
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Hope that helps.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
