<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Sounds playing incorrectly - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Audio > Sounds playing incorrectly</h2>
<div id="posts">
<div class="post">
    <h4>#25607 - daveb - Wed Aug 25, 2004 10:57 pm</h4>
    <div class="postbody"><span class="postbody">I have coded a sound player based on the 'Interrupt Mode Direct Sound Example' on the audio advance page.  I choose this way as the page suggested using the dma &amp; interrupts may disrupt multi player games.
<br/>
<br/>
I have several wav file all slightly different formats.
<br/>
<br/>
I converted all of them to 16000hz using the simon tool, but some of them seem to play correctly and other seem to play at wrong speeds.
<br/>
<br/>
I guess it is to do with the format of the wavs before converting them with simon.   If this is the problem can anybody suggest conversion tools to use to convert the wavs to a consistant format I can use on the gba, preferably some sort of array.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25608 - poslundc - Wed Aug 25, 2004 11:03 pm</h4>
    <div class="postbody"><span class="postbody">Do they sound correct when you play them on your PC after converting them?
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25636 - daveb - Thu Aug 26, 2004 12:17 pm</h4>
    <div class="postbody"><span class="postbody">The sounds sound fine when played in windows.
<br/>
<br/>
I have a wav file in the format unsigned 8bit, 44100hz 352 khz mono
<br/>
I convert this to a 16000hz header file using the simon tool
<br/>
<br/>
in my program I start timer 0 and trigger an interrupt
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">REG_TM0D   = 0xffff;
<br/>
REG_TM0CNT = 0x00C3;</td> </tr></table><span class="postbody">
<br/>
<br/>
then when I recieve the interrupt I do
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">if (!(iNextSampleA&amp;3))
<br/>
     REG_SGFIF0A=soundA[iNextSampleA&lt;&lt;2];
<br/>
iNextSampleA++;</td> </tr></table><span class="postbody">
<br/>
To point the fifo a to the sound to be played
<br/>
<br/>
I guess the problem (apart from me not really knowing what I am doing) is the format of the wav and the tools used to convert it.  I think I need to convert the wav to be signed 8bit, but I cannot find a tool that will do this.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25641 - poslundc - Thu Aug 26, 2004 1:56 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>daveb wrote:</b></span></td> </tr> <tr> <td class="quote">I guess the problem (apart from me not really knowing what I am doing)</td> </tr></table><span class="postbody">
<br/>
<br/>
That is a big problem. If you are new to the GBA, audio programming is not a good starting point, as is definitely one of the more challenging things to do and there are tons of pitfalls you can run into if you aren't very familiar with how the hardware operates.
<br/>
<br/>
You might check out DekuTree's <a class="postlink" href="http://www.angelfire.com/wizard/deku/program/sound1.html" target="_blank">sound tutorial</a> if you feel confident enough at GBA programming and just need help wrapping your head around sound concepts.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I think I need to convert the wav to be signed 8bit, but I cannot find a tool that will do this.</td> </tr></table><span class="postbody">
<br/>
<br/>
I don't know any Windows tools. I can recommend two possible courses of action:
<br/>
<br/>
1. Write your own tool to convert the samples from unsigned to signed.
<br/>
2. Change your mixer to process unsigned samples.
<br/>
<br/>
If you don't feel comfortable doing either of these things... well, in all honesty you're probably going to run into a lot more trouble if you continue doing audio programming.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25651 - DekuTree64 - Thu Aug 26, 2004 5:46 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>daveb wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">if (!(iNextSampleA&amp;3))
<br/>
     REG_SGFIF0A=soundA[iNextSampleA&lt;&lt;2];
<br/>
iNextSampleA++;</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
<br/>
This doesn't look quite right. What type of array is aoundA? If it's a u32, you're just shifting the wrong direction, but if it's an s8, then you need to add a cast too.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">if (!(iNextSampleA&amp;3))
<br/>
     REG_SGFIF0A=((u32*)soundA)[iNextSampleA&gt;&gt;2];
<br/>
iNextSampleA++;</td> </tr></table><span class="postbody">
<br/>
<br/>
That will load 4 samples into the buffer every 4 interrupts. 
<br/>
<br/>
The unsigned wav could be a problem too. To convert it, all you have to do is subtract 128 from each byte. You might have to write your own little program to do this, and that would be pretty hard. 
<br/>
Try searching for a program called Cool Edit, it can save as raw signed 8-bit PCM data that can be converted to an array or .o file and used directly.
<br/>
I use Cool Edit 96, but I think 2000 is still good. I think Adobe bought them though, and put a several hundred dollar price tag on it like they always do, so ignore any Adobe pages that come up.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25984 - daveb - Thu Sep 02, 2004 4:51 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for the help guys.  I managed to get my sound to work correctly.
<br/>
<br/>
One more quick question, If I pass one sound to Direct Sound Channel A and another to Direct Sound Channel B at the same time will they both play correctly or will they interfere with each other?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25987 - tepples - Thu Sep 02, 2004 5:00 pm</h4>
    <div class="postbody"><span class="postbody">PCM channel A and PCM channel B are entirely separate, except that you can enable each at full scale, half scale, or off to each of left or right. If you enable both PCM channels to the same output channel, they'll "interfere" (that is, mix) correctly.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
