<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Dynamic channel allocation? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Audio > Dynamic channel allocation?</h2>
<div id="posts">
<div class="post">
    <h4>#164396 - Ruben - Thu Oct 30, 2008 1:46 pm</h4>
    <div class="postbody"><span class="postbody">Hi (again).
<br/>
<br/>
OK, so I've finally got the mixer's reverb setting working fine, and now I'm starting to make the music player... and ALREADY came across an obstacle~~
<br/>
<br/>
xD
<br/>
<br/>
Anyway... so does anyone here know a good way to do dynamic channel allocation? As in MIDI/IT style, where not every music channel corresponds to that sound channel.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164435 - Ruben - Sat Nov 01, 2008 11:50 am</h4>
    <div class="postbody"><span class="postbody">OK, I'd better re-word that before the post gets deleted for being so darn STUPID! :P
<br/>
<br/>
Anyone know of a "good" way to implement dynamic channel allocation, and then being able to do stuff to the allocated channel, where more than 1 note can be present?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164437 - kusma - Sat Nov 01, 2008 12:07 pm</h4>
    <div class="postbody"><span class="postbody">Sure, free-lists (linked list of unused elements) is a nice way of managing limited resources. The problematic thing is knowing what to do when you run out of resources. Stealing a channel is a tricky thing, and I've done it for a soft-synth I've done. What I did was to try to pick the channel with the lower volume that was played "a while ago" (what this might mean depends on your player. For me it was when the envelope was not in the attack-state). I used a couple of other heuristics as well. Note that for module-type formats, this might not be clever enough, since a lot of notes are dependent on the previous ones.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164438 - Ruben - Sat Nov 01, 2008 12:22 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>kusma wrote:</b></span></td> </tr> <tr> <td class="quote">Sure, free-lists (linked list of unused elements) is a nice way of managing limited resources. The problematic thing is knowing what to do when you run out of resources. Stealing a channel is a tricky thing, and I've done it for a soft-synth I've done. What I did was to try to pick the channel with the lower volume that was played "a while ago" (what this might mean depends on your player. For me it was when the envelope was not in the attack-state). I used a couple of other heuristics as well. Note that for module-type formats, this might not be clever enough, since a lot of notes are dependent on the previous ones.</td> </tr></table><span class="postbody">
<br/>
<br/>
Hehe, yeah, I've got a whole other thing sorted for module-type formats.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">What I did was to try to pick the channel with the lower volume that was played "a while ago" (what this might mean depends on your player. For me it was when the envelope was not in the attack-state)</td> </tr></table><span class="postbody">
<br/>
Yeah, I suppose that's easy enough to do. Get channel data, check if on attack, if not, compare to last stored volume, if less than store, continue through all channels.
<br/>
<br/>
And what exactly do you mean by "free-lists?" Do you mean like, say, a u32 variable keeping track of all the active channels, 1 per bit? Or do you mean something more complicated like a pointer to channel with status and stuff?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164439 - kusma - Sat Nov 01, 2008 12:33 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ruben wrote:</b></span></td> </tr> <tr> <td class="quote">Yeah, I suppose that's easy enough to do. Get channel data, check if on attack, if not, compare to last stored volume, if less than store, continue through all channels.
<br/>
</td> </tr></table><span class="postbody">
<br/>
Actually, I just gave a priority-value to each channel by setting the different bits to different settings based on the channel-state. That way, you don't really need to code any logic, you just bitwise OR together a series of heuristic values, and sort the channels to find the one to pick.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">And what exactly do you mean by "free-lists?" Do you mean like, say, a u32 variable keeping track of all the active channels, 1 per bit? Or do you mean something more complicated like a pointer to channel with status and stuff?</td> </tr></table><span class="postbody">
<br/>
A linked list of free channels. Whenever you allocate one, you just take the first element, and set the global free-pointer to the next free one. It's a pretty common thing to do for fixed-size memory allocators.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164440 - Ruben - Sat Nov 01, 2008 12:38 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">A linked list of free channels. Whenever you allocate one, you just take the first element, and set the global free-pointer to the next free one.</td> </tr></table><span class="postbody">
<br/>
Oh, so you mean like...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">channel *next_channel;
<br/>
//get a channel
<br/>
next_channel = fetch_free();</td> </tr></table><span class="postbody">
<br/>
<br/>
.. Or am I off track? :P</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
