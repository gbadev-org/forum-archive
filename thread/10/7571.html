<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Playing Notes? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Audio > Playing Notes?</h2>
<div id="posts">
<div class="post">
    <h4>#61681 - hello world - Tue Nov 22, 2005 5:37 pm</h4>
    <div class="postbody"><span class="postbody">Hi, I was wondering if it is possible to play a sound at a certain pitch for a certain amount of time (if you could give me an example i would be grateful). If possible it would also be helpful if you could explain it fully, since i am very new to Gameboy Advance developement.
<br/>
Thanks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#61683 - thegamefreak0134 - Tue Nov 22, 2005 6:11 pm</h4>
    <div class="postbody"><span class="postbody">Well obviously it's possible, or there wouldn't be any music in games, now would there? There are many ways to get this done, actually. There are the 4 GB channels used by the old GB and GBC games that can all play notes (save for the 4th, which is noise.), and then there are the 2 direct sound channels which can take any samples you provide them. Coupled with a mixer (either one you write or one you get from someone else) these can be used to play any sound imaginable, including what you're talking about.
<br/>
<br/>
I recommend posting specifically what you need soundwise, as it will be easier to determine a proper solution. But yes, it IS possible.<br/>_________________<br/>What if the hokey-pokey really is what it's all about?
<br/>
<br/>
[url=http:/www.darknovagames.com/index.php?action=recruit&amp;clanid=1]Support Zeta on DarkNova![/url]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#61688 - hello world - Tue Nov 22, 2005 6:54 pm</h4>
    <div class="postbody"><span class="postbody">An example of what i need, could be summed up by "monophonic ringtone" but if possible i would have two playing at the same time.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#61696 - tepples - Tue Nov 22, 2005 7:55 pm</h4>
    <div class="postbody"><span class="postbody">So you want to make NES/GBC style music. Here are the steps to get started: <ol type="1"><li>Read everything at <a class="postlink" href="http://belogic.com/gba" target="_blank">The Audio Advance</a> that pertains to the tone generators. </li><li>Figure out how to play a single tone on channel 1 and how to silence it. </li><li>Figure out how to play a single tone on channel 2 and how to silence it. </li><li>Read about <a class="postlink" href="http://en.wikipedia.org/wiki/Musical_tuning" target="_blank">musical tuning systems</a> including <a class="postlink" href="http://en.wikipedia.org/wiki/Equal_temperament" target="_blank">equal temperament</a> and MIDI note numbers. </li><li>Construct a lookup table mapping MIDI note numbers 36 through 99 (the usable range of tone generators) to period values. Middle C is note 60; 36 through 99 represent the usable range of the tone generators. </li><li>Create a table of note numbers that represent a melody. Loop through this table and play the rests and notes on each channel as you see them. </li></ol><br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#61795 - hello world - Wed Nov 23, 2005 5:10 pm</h4>
    <div class="postbody"><span class="postbody">No offence, but I have no idea what you are talking about. Isn't there a simple way to play a sound at a definable pitch &amp; for a certain time?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#61796 - kusma - Wed Nov 23, 2005 5:19 pm</h4>
    <div class="postbody"><span class="postbody">read the specs and wisdom will come to you.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#61799 - hello world - Wed Nov 23, 2005 6:01 pm</h4>
    <div class="postbody"><span class="postbody">I've had a look and I can't make anything out, all I know is I need REG_SOUND1CNT_H &amp; REG_SOUND1CNT_X , but I have no idea how to use them :-(.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#61801 - kusma - Wed Nov 23, 2005 7:03 pm</h4>
    <div class="postbody"><span class="postbody">if you have no clue on how to write to hardware-registers, perhaps you should be asking in the Beginners-forum instead?
<br/>
<br/>
#define REG_SOUND1CNT_H (*((u16 volatile *)0x04000062))
<br/>
REG_SOUND1CNT_H = some_value;</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#61803 - poslundc - Wed Nov 23, 2005 7:26 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>hello world wrote:</b></span></td> </tr> <tr> <td class="quote">No offence, but I have no idea what you are talking about. Isn't there a simple way to play a sound at a definable pitch &amp; for a certain time?</td> </tr></table><span class="postbody">
<br/>
<br/>
Depends what you consider to be simple, but if you think it's going to be something like "play(sound);" then the answer is no, there isn't.
<br/>
<br/>
This is GBA programming, not Visual Whatever or anything. Learn to crawl before you learn to walk, or you'll trip all over yourself.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#61807 - keldon - Wed Nov 23, 2005 8:47 pm</h4>
    <div class="postbody"><span class="postbody">Your answer is yes; there is a simple way to play a sound.
<br/>
<br/>
First get some code working that will produce a sound - any sound. Once you have done this then create code that will read out a sequence of notes and play them. Once you have done this everything else will become obvious.
<br/>
<br/>
The following sound table shows you what values will get you the correct frequencies to notes
<br/>
<a href="http://devrs.com/gb/files/sndtab.html" target="_blank">http://devrs.com/gb/files/sndtab.html</a>
<br/>
<br/>
The gameboy allows two sounds to be played simultaneously without any trouble.
<br/>
<br/>
Also you can use gbatek as your guide to answering these questions.
<br/>
<a href="http://www.work.de/nocash/gbatek.htm" target="_blank">http://www.work.de/nocash/gbatek.htm</a>
<br/>
<a class="postlink" href="http://www.work.de/nocash/gbatek.htm#soundchannel1tonesweep" target="_blank">direct -link to sound-</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62245 - thegamefreak0134 - Mon Nov 28, 2005 6:14 pm</h4>
    <div class="postbody"><span class="postbody">If you're still having issues, I recently got Krawall to work for my project. It's a bit of a hassle to set it up, but I can give you all the things you need to do for your project and give you an example, and even walk you through it if need be.
<br/>
<br/>
What this will do is let you create a blank .s3m file with the sounds (technically samples) you want to play. Then, simply call the krapSFX() thingy (can't remember off hand) with the name of your sample and you're good to go. Since you're not limited as to what you can include in a sample, you can very easily put like a square wave as a sample, which will sound like an old nokia phone.
<br/>
<br/>
As for dynamically changing the length of the playing sound, I believe you can set a loop property on the SFX, and then release the loop when the sound is done. However, I'll have to check my docs later to back that statement up.<br/>_________________<br/>What if the hokey-pokey really is what it's all about?
<br/>
<br/>
[url=http:/www.darknovagames.com/index.php?action=recruit&amp;clanid=1]Support Zeta on DarkNova![/url]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62796 - hello world - Mon Dec 05, 2005 8:03 pm</h4>
    <div class="postbody"><span class="postbody">Basically, I've had a close look at the audio advance, and have found that I need channel 2, using the registers SOUNDCNT_L, SOUNDCNT_H, SOUNDCNT_X, SOUND2CNT_H and SOUND2CNT_L. I should be able to play a sound, but it doesn't work...
<br/>
Here's my code:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
int main()
<br/>
{
<br/>
SOUNDCNT_X = 0x80;
<br/>
SOUNDCNT_L=0x2277;
<br/>
SOUNDCNT_H = 2;
<br/>
SOUND2CNT_L=0xf780;
<br/>
SOUND2CNT_H=0x8400;
<br/>
return 0;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
By the way, I know that I haven't used the prefix "REG_"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62797 - SittingDuck - Mon Dec 05, 2005 8:23 pm</h4>
    <div class="postbody"><span class="postbody">You need to set up:
<br/>
1. the correct timer at the correct rate (one that doesn't click and which is the correct sample rate, hard to find.)
<br/>
2. DMA to transfer buffer contents into the FIFO buffer
<br/>
3. Every VBlank point the DMA to one buffer and fill the other (double-buffering technique).
<br/>
<br/>
Note that you can't read from the FIFO register. The FIFO registers don't represent memory locations. Just write to them to output audio. (You don't need to - DMA will do it).
<br/>
<br/>
Just read some tutorials:
<br/>
<br/>
<a class="postlink" href="http://belogic.com/gba/" target="_blank">http://belogic.com/gba/</a>
<br/>
<a class="postlink" href="http://www.pineight.com/gba/samplerates/" target="_blank">http://www.pineight.com/gba/samplerates/</a>
<br/>
<a class="postlink" href="http://deku.gbadev.org/program/sound1.html" target="_blank">http://deku.gbadev.org/program/sound1.html</a>
<br/>
<a class="postlink" href="http://user.chem.tue.nl/jakvijn/tonc/" target="_blank">http://user.chem.tue.nl/jakvijn/tonc/</a> &lt;- look at DMA and timers</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62799 - keldon - Mon Dec 05, 2005 9:20 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   u16 ALLON = 1 &lt;&lt; 7; // you had bit 8 set
<br/>
   u16 leftVol = 7 &lt;&lt; 4;
<br/>
   u16 rightVol = 7;
<br/>
   u16 enableFlags = (2 &lt;&lt; 8)| (2&lt;&lt;12);
<br/>
   u16 soundVol = 2; // max volume
<br/>
   
<br/>
   
<br/>
   REG_SOUNDCNT_X = ALLON;
<br/>
   REG_SOUNDCNT_H = soundVol;
<br/>
   REG_SOUNDCNT_L=leftVol | rightVol| enableFlags;
<br/>
   
<br/>
   int  soundLen = 0; // 250 ms
<br/>
   int patternDuty = 2 &lt;&lt; 6;
<br/>
   int envelopeStep = 7 &lt;&lt; 8;
<br/>
   int envelopeDir = 0; // decrease
<br/>
   int initVol = 0xf &lt;&lt; 12;
<br/>
   
<br/>
   REG_SOUND2CNT_L= soundLen | patternDuty | envelopeStep | envelopeDir | initVol;
<br/>
   
<br/>
   int frequency = 1500; // 64 hz
<br/>
   int lenFlag = 0;
<br/>
   int restart = 1 &lt;&lt; 15;
<br/>
   REG_SOUND2CNT_H= frequency | lenFlag | restart;
<br/>
   // note that bits 11-13 are not used, and the 4 in ox8400 includes bit 11 </td> </tr></table><span class="postbody">
<br/>
<br/>
I found that you had set a lot of bits which had no effect. Also I found that my include in DevkitPro (gba_sound.h) was incorrect - shown below.
<br/>
<br/>
Also check your defines
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define   REG_SOUNDCNT_L   (*((u16 volatile *) REG_BASE + 0x080))</td> </tr></table><span class="postbody">
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define   REG_SOUNDCNT_L   (*((u16 volatile *) (REG_BASE + 0x080)))</td> </tr></table><span class="postbody">
<br/>
Check your defines. I know</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62877 - hello world - Tue Dec 06, 2005 5:51 pm</h4>
    <div class="postbody"><span class="postbody">Thanks keldon, I can finally play a sound, I wonder why it didn't work before...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62929 - keldon - Tue Dec 06, 2005 11:55 pm</h4>
    <div class="postbody"><span class="postbody">You was not setting REG_SOUNDCNT_X properly. But I think it is good practise to do something similar to what I did in code - at least for your first time as you can easily spot errors in values. You can later wrap these into methods so that your code does not contain cryptic bitshifts.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63010 - SittingDuck - Wed Dec 07, 2005 8:40 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>keldon wrote:</b></span></td> </tr> <tr> <td class="quote">You was not setting REG_SOUNDCNT_X properly.</td> </tr></table><span class="postbody">
<br/>
You <span style="font-style: italic">were</span>...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63013 - keldon - Wed Dec 07, 2005 8:51 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">You were...</td> </tr></table><span class="postbody">
<br/>
Sorry; my mistake. I was counting bit 0 as bit 1</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63243 - SittingDuck - Sat Dec 10, 2005 12:59 pm</h4>
    <div class="postbody"><span class="postbody">No, I was just correcting the grammar.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
