<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Problems with audio and emulators - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Audio > Problems with audio and emulators</h2>
<div id="posts">
<div class="post">
    <h4>#23823 - cappeca - Thu Jul 22, 2004 11:10 am</h4>
    <div class="postbody"><span class="postbody">I'm learning how to put audio samples in a GBA game. So far I've tried the documents in the gbadev.org site, and it... kinda worked. The code is the usual:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
      /* Inicializa o som */
<br/>
      REG_SOUNDCNT_X = SND_ENABLED;
<br/>
      REG_SOUNDCNT_L = 0;
<br/>
<br/>
      /* enable and reset Direct Sound channel A, at full volume, 
<br/>
       using Timer 0 to determine frequency */
<br/>
      REG_SOUNDCNT_H = SND_OUTPUT_RATIO_100 | 
<br/>
                       DSA_OUTPUT_RATIO_100 | 
<br/>
                       DSA_OUTPUT_TO_BOTH   |
<br/>
                       DSA_TIMER0           | 
<br/>
                       DSA_FIFO_RESET;
<br/>
<br/>
      /* set the timer to overflow at the appropriate frequency and start it */
<br/>
      REG_TM0Dv   = TIMER_INTERVAL;
<br/>
      REG_TM0CNTv = TIMER_ENABLED;
<br/>
<br/>
      /* start the DMA transfer (assume that pSample is a (signed char*)
<br/>
        pointer to the buffer containing our sound data) */
<br/>
      REG_DMA1SAD = (u32)CLIQUE_DATA;
<br/>
      REG_DMA1DAD = (u32)REG_FIFO_A;
<br/>
      REG_DMA1CNT = ENABLE_DMA | START_ON_FIFO_EMPTY | WORD_DMA | DMA_REPEAT;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
It works perfectly in Boycott Advance (0.2.6), distorted in Mappy (0.9), and not at all in Visual Boy Advance (1.7.1) or in the real hardware. Do you guys know about anything these emulators automatically do that I'm probably missing for the GBA?
<br/>
<br/>
Thanks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23825 - cappeca - Thu Jul 22, 2004 11:54 am</h4>
    <div class="postbody"><span class="postbody">Never mind, I found an old post where I had answered this myself. Some registers must be declared volatile to work.
<br/>
<br/>
Cesar.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
