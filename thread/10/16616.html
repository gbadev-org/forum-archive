<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>sound interrupts messing with OAM - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Audio > sound interrupts messing with OAM</h2>
<div id="posts">
<div class="post">
    <h4>#168265 - moonlightcheese - Fri Apr 17, 2009 3:55 pm</h4>
    <div class="postbody"><span class="postbody">so after calling the kragInit function, my OAM entries get all screwed up.  i can't see what kragInit actually does since it's compiled into that library archive (can i?).  i remember reading something about not being able to update OAM during VDraw but i don't know if that's related... i'm... once again... lost.
<br/>
<br/>
EDIT: i don't know if this has anything to do with interrupts or not since, when i don't call kragInit, the sprites work fine (just slower) and they animate properly after the calls to irqInit, irqSet (for both the TIMER1 and VBLANK interrupts) and work fine with VBlankIntrWait() in the main loop, with the kramWorker() function in Vblank()...  i could be wrong...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168266 - moonlightcheese - Fri Apr 17, 2009 4:06 pm</h4>
    <div class="postbody"><span class="postbody">wow... that was the quickest fix ever...
<br/>
<br/>
what was going on was, i had a define in a header file thusly:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define SPRITE_OAM ((OBJATTR*)EWRAM
<br/>
</td> </tr></table><span class="postbody">
<br/>
and i'm guessing that this places a pointer to OBJATTR right at the beginning of EWRAM and the kragInit call needs this space for buffering or something possibly.  after i got rid of the define and just declared it inside the header file without the preprocessor directive like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
OBJATTR SPRITE_OAM[128];
<br/>
</td> </tr></table><span class="postbody">
<br/>
it compiled and ran perfectly.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168267 - Miked0801 - Fri Apr 17, 2009 4:23 pm</h4>
    <div class="postbody"><span class="postbody">Which means other stuff is now being eaten by Krawall.  Make sure that the space is truly reserved...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168289 - Ruben - Sun Apr 19, 2009 3:33 pm</h4>
    <div class="postbody"><span class="postbody">And btw, any global variables declared with no section usually go in IWRAM, so you may have to explicitly tell it to be placed in EWRAM</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168291 - moonlightcheese - Sun Apr 19, 2009 6:46 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ruben wrote:</b></span></td> </tr> <tr> <td class="quote">And btw, any global variables declared with no section usually go in IWRAM, so you may have to explicitly tell it to be placed in EWRAM</td> </tr></table><span class="postbody">
<br/>
"no section"?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168292 - Ruben - Sun Apr 19, 2009 7:00 pm</h4>
    <div class="postbody"><span class="postbody">As in, when you don't explicitly define a section or "const"
<br/>
<br/>
Example
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">const u32 MyConstVar; //Goes into ROM
<br/>
u32 MyVar0; //Goes into BSS by default
<br/>
u32 MyVar1 = 0x12345678; //Goes into IWRAM by default
<br/>
IN_EWRAM MyVar2 = 4; //Goes into EWRAM
<br/>
IN_SBSS MyVar3; //Goes into SBSS
<br/>
IN_IWRAM MyVar4 = 0xC0DE; //Goes into IWRAM
<br/>
IN_BSS MyVar5; //Goes into BSS</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168300 - gauauu - Sun Apr 19, 2009 9:46 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Miked0801 wrote:</b></span></td> </tr> <tr> <td class="quote">Which means other stuff is now being eaten by Krawall.  Make sure that the space is truly reserved...</td> </tr></table><span class="postbody">
<br/>
<br/>
Well, the fact that the first try was just a define, which didn't reserve anything, makes it rather different from the 2nd, which actually allocated a variable array....</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
