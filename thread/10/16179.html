<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Implementing delay... - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Audio > Implementing delay...</h2>
<div id="posts">
<div class="post">
    <h4>#164362 - Ruben - Wed Oct 29, 2008 5:26 pm</h4>
    <div class="postbody"><span class="postbody">Hi again. So I was trying to do delay/reverb, but keep getting "errors" in it.
<br/>
By that, I mean either bias errors or some other, random and unknown error. :P
<br/>
<br/>
So basically...
<br/>
Does anyone know (or know about any links for that matter) how to implement delay "properly?" Cos mine sucks. Lol.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164367 - silent_code - Wed Oct 29, 2008 9:22 pm</h4>
    <div class="postbody"><span class="postbody">Keep in mind that there are different "types" of delay effects, that build on the same principle, but have different timing, among other parameters.
<br/>
<br/>
That kind of artifacts do you get? Please capture some samples and link them, so that we can hear for ourselves.
<br/>
<br/>
Then, some implementation details would be needed to help you improve your program.
<br/>
<br/>
Kind regards. :^)<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164379 - DekuTree64 - Thu Oct 30, 2008 2:01 am</h4>
    <div class="postbody"><span class="postbody">I've never found a description of reverb/echo that didn't make it sound way more complicated than it is. Here's my algorithm:
<br/>
<br/>
Make a buffer of x samples, x being the delay amount. At the end of each mixer call, make sure it's filled up with the most recent x output samples.
<br/>
<br/>
During mixing, add a sample from the reverb buffer to each output, until you're either done mixing or the reverb buffer runs out. 
<br/>
<br/>
If you finish mixing first, then just memcopy the remaining samples in the reverb buffer over to the start of it, and fill it the rest of the way from the freshly generated output samples.
<br/>
<br/>
If the reverb buffer runs out first, then switch the reverb buffer pointer to the start of the output buffer (i.e. where you're currently mixing to), and continue on.
<br/>
<br/>
And that's it! I hope that doesn't make it sound way more complicated than it is. The last step is fun because it basically makes an endless reverb buffer, since the reverb pointer follows a few samples behind the output pointer, which continually generates new samples.
<br/>
<br/>
Also, keep in mind that the reverb buffer will be signed 8-bit, even if you're doing unsigned mixing. So there can't be any bias errors from it, since it needs no bias. But do make sure you load the samples from it as signed.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164380 - Ruben - Thu Oct 30, 2008 2:19 am</h4>
    <div class="postbody"><span class="postbody">Well, yeah, that wasn't complicated to understand, but the bias error happens cos I'm clipping the data while still unsigned...
<br/>
Unless..~
<br/>
Are you supposed to do something like...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">do {
<br/>
 s32 new_value = (*dat_src++ - bias) + *rev_src++;
<br/>
 
<br/>
 //check the reverb buffer end, etc, etc
<br/>
 
<br/>
 //now clip??
<br/>
} while(--samples)</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164381 - DekuTree64 - Thu Oct 30, 2008 2:54 am</h4>
    <div class="postbody"><span class="postbody">Yeah, like that.
<br/>
<br/>
I can't think of any reason that unsigned clipping would be necessary, and it's a bit more complicated since the min/max values depend on the bias rather than being constant like for signed clipping.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
