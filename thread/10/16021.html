<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>New music format...? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Audio > New music format...?</h2>
<div id="posts">
<div class="post">
    <h4>#162577 - Ruben - Fri Sep 05, 2008 11:19 am</h4>
    <div class="postbody"><span class="postbody">Hi all. Was wondering if anyone was interested in certain specs for a new music format I'll be creating. So far, I've got... uh... *gets my notebook out* OK... so far, I've got these points down:
<br/>
<br/>
-16 fully pannable channels
<br/>
-Uses 22.10 fixed point accuracy to allow for files of up to 4mb (like certain songs that can't be "emulated" per-s?)
<br/>
-Supports 256 point attack, decay, sustain and release
<br/>
-Up to 4 notes in 1 channel (though still limited to 16 notes polyphony)
<br/>
-Pitch shifting
<br/>
-Key shifting (like writing ".byte SHIFT, 2" then ".byte NOTE, C5" would play D5)
<br/>
-127 levels of volume per channel
<br/>
-256 levels of global volume
<br/>
-Vibrato
<br/>
-Instruments (like MIDI or IT-ish)
<br/>
<br/>
Anyone else got any specs they'd like that I'm missing? I plan to make this player free for all uses, but I won't release the sources for a while. Since these specs kinda fit for most tracker music and a bit of MIDI, I was wondering if maybe I should include MIDI support in the converter.
<br/>
<br/>
So any ideas?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#162578 - Kyoufu Kawa - Fri Sep 05, 2008 12:38 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ruben wrote:</b></span></td> </tr> <tr> <td class="quote">maybe I should include MIDI support in the converter.</td> </tr></table><span class="postbody">Yes, you should. That'd be great. How 'bout sound effects?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#162581 - Ruben - Fri Sep 05, 2008 12:56 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Kyoufu Kawa wrote:</b></span></td> </tr> <tr> <td class="quote">How 'bout sound effects?</td> </tr></table><span class="postbody">
<br/>
<br/>
Sound effects like which ones? Like lo-pass filters and the such? Or reverb, chorus, etc? Cos I'm still trying to figure out how reverb works along with Cearn (math genius :P I'm just good at math, not a genius).
<br/>
<br/>
Or am I TOTALLY off track and you meant "sound" sound effects? ... OK, lemme rephrase that...
<br/>
By "sound effects", do you mean like, say, a blaster sound effect and having dedicated channels for that?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#162584 - Kyoufu Kawa - Fri Sep 05, 2008 2:13 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ruben wrote:</b></span></td> </tr> <tr> <td class="quote">By "sound effects", do you mean like, say, a blaster sound effect and having dedicated channels for that?</td> </tr></table><span class="postbody">Yes, yes I did.
<br/>
<br/>
Actually, some kind of priority system would be nice... when playing a sound, find a channel that the music's not using at that moment. If the music needs a channel that's already used by a sound effect, it drops that note instead. Or some shit like that, I dunno.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#162587 - Ruben - Fri Sep 05, 2008 2:32 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Actually, some kind of priority system would be nice... when playing a sound, find a channel that the music's not using at that moment...</td> </tr></table><span class="postbody">
<br/>
That's kinda what I have planned... something like:
<br/>
-16 "real" channel structures; these get read and then mixed by the mixer. So far, they only have 4 words:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">typedef struct {
<br/>
   u8  stat;   //status
<br/>
   u8  pan;    //panning (0-FFh)
<br/>
   u8  lvol;   //left volume (0-7Fh)
<br/>
   u8  rvol;   //right volume (0-7Fh)
<br/>
   u32 pos;    //position (22.10)
<br/>
   u32 inc;    //increment (22.10)
<br/>
   smS *wp;    //wave pointer
<br/>
   
<br/>
   //smS typedef is the same as the GBA BIOS' sound structure cos I'll be using the MIDIKey2Freq function
<br/>
} chn;</td> </tr></table><span class="postbody">
<br/>
<br/>
-16 "fake" channel structures; placed before the "real" channels, they contain a very small amount of information. Namely, only channel music data. In that structure, the music data gets stored, like ticks left till next read, expression, pitch, origin, etc.
<br/>
<br/>
So when you call the SFX function... I was thinking of either doing the above and search for an empty channel (there's an int in the mixer data stating channel modes)... or having dedicated channels for SFX. Which one do you think would probably be better?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#162599 - Kyoufu Kawa - Fri Sep 05, 2008 6:21 pm</h4>
    <div class="postbody"><span class="postbody">I'd go for finding free channels, myself.
<br/>
<br/>
Know what else'd be cool? If the sound effects could be done -as- music data.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#162604 - tepples - Fri Sep 05, 2008 8:54 pm</h4>
    <div class="postbody"><span class="postbody">Consider this architecture:
<br/>
<br/>
A <span style="font-weight: bold">song</span> is a list of references to <span style="font-weight: bold">patterns</span> and when and how to play them.
<br/>
A <span style="font-weight: bold">pattern</span> is a list of references to <span style="font-weight: bold">instruments</span> and when and how to play them.
<br/>
An <span style="font-weight: bold">instrument</span> is "like MIDI or IT-ish".
<br/>
<br/>
The API has these functions:
<br/>
<ul><li>Play a song with settings </li><li>Play a pattern with settings </li><li>Play a note on an instrument with settings </li><li>Set modifiers of playing song, pattern, or note </li></ul>
<br/>
Sound effects would be stored as instruments or patterns depending on their complexity.
<br/>
<br/>
Another question: What sort of music editor were you planning? Some sort of bytecode that one would use with a compiler (like LilyPond)? Or a custom graphical editor like a tracker?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#162616 - Ruben - Sat Sep 06, 2008 12:29 am</h4>
    <div class="postbody"><span class="postbody">Tepples:
<br/>
<br/>
What I had planned was to allow users to make their music in whatever application they use (MODPlug Tracker, MIDI Maestro, etc.), then have the files converted into a format the player will recognize. What I had planned on doing was something like:
<br/>
<br/>
-A <span style="font-weight: bold">song</span> has an ID for verification, a few settings like global volume, name, etc, and pointer to <span style="font-weight: bold">tracks</span>.
<br/>
<br/>
-A <span style="font-weight: bold">track</span> is a list of events occurring for channel <span style="font-style: italic">x</span>, which are stored as track-only data; IOW, a <span style="font-weight: bold">track</span> will only have settings like "set program, set volume, play note <span style="font-style: italic">x</span> at a velocity of <span style="font-style: italic">v</span>." The converter would deal with making the tracks into this (ie. S3M is stored like a type 0 MIDI file; the converter would convert it into a format similar to a type 1 MIDI file).
<br/>
<br/>
Kyoufu:
<br/>
<br/>
Like, say, a special effect that uses more than 1 sound and has like pattern data? Yeah, that's possible since the channels would just point to tracks which contain data for that channel, and that channel only. I was also thinking of supporting the sound generators in case the player reaches &gt; 16 notes... but if the sound was, say, a timpani... that would sound weird... so I was thinking if I should support them or not.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#162620 - tepples - Sat Sep 06, 2008 2:56 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ruben wrote:</b></span></td> </tr> <tr> <td class="quote">-A <span style="font-weight: bold">track</span> is a list of events occurring for channel <span style="font-style: italic">x</span>, which are stored as track-only data; IOW, a <span style="font-weight: bold">track</span> will only have settings like "set program, set volume, play note <span style="font-style: italic">x</span> at a velocity of <span style="font-style: italic">v</span>." The converter would deal with making the tracks into this (ie. S3M is stored like a type 0 MIDI file; the converter would convert it into a format similar to a type 1 MIDI file).</td> </tr></table><span class="postbody">
<br/>
So what you call "tracks" are similar to my patterns, except that patterns can be played multiple times over the course of a file or looped. It's like type 2 MIDI files.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#162621 - Ruben - Sat Sep 06, 2008 3:07 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">So what you call "tracks" are similar to my patterns...</td> </tr></table><span class="postbody">
<br/>
Well, I haven't actually had the time to look at the music player in TOD, but in case it wasn't clear enough, my "tracks" are something like:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">event - data
<br/>
--------------
<br/>
<br/>
PROGRAM, 00 &lt;- Piano 1
<br/>
VOLUME, 127 &lt;- Volume 127
<br/>
TEMPO, 154 &lt;- Set tempo for this song to 154
<br/>
<br/>
looppoint:
<br/>
NOTE, C5, 127 &lt;- Note on (C5 @ 127)
<br/>
WAIT, 3 &lt;- Wait 3 ticks
<br/>
NOTE, C5, 0 &lt;- Note off (C5)
<br/>
WAIT, 3 &lt;- Wait 3 ticks
<br/>
JUMP, looppoint &lt;- Jump to looppoint
<br/>
EOTr &lt;- End of track</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#162637 - tepples - Sat Sep 06, 2008 6:37 pm</h4>
    <div class="postbody"><span class="postbody">I'll take apart idltd.in, the source code for the BGM in TOD. You might use it for inspiration.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">speed 10
<br/>
channels 6
<br/>
</td> </tr></table><span class="postbody">
<br/>
This tells Tri Engine to play at 89.6 BPM (10 ticks per sixteenth note, where a tick is 280,896 CPU cycles), and to allocate 4 tone generators and 2 voices to music.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">instruments
<br/>
11-4,0x65  #deep kick
<br/>
10-1,0x24  #clap
<br/>
 5-1,0x04  #hat
<br/>
 6-3,0x04  #open hat
<br/>
10-7,0x40  #normal note
<br/>
   9,0x40  #sustain note
<br/>
10-4,0x00  #B back note
<br/>
 7-4,0x40  #C back note</td> </tr></table><span class="postbody">
<br/>
Starting volume, decay rate, and timbre for channels 1, 2, and 4.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">ch3instruments
<br/>
012457899aaa99887665556678abdef9  # saw without fundamental
<br/>
741007a9fba57b848a634945a75acfda  # bass</td> </tr></table><span class="postbody">
<br/>
Waveforms for channel 3 (the "triangle channel" to NES fans).
<br/>
<br/>
Instrument definitions for channels 5 and 6 (soft-mixed PCM) are in another file.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">orders
<br/>
g1 g2 g3 g4 g5 g6
<br/>
<br/>
1 p7 p23-5 p8-5 p9-5 p10-5
<br/>
  p11 p11 p11 p11 p11 p11 p11 p11 p13
<br/>
  p14 p14 p14 p14 p14 p14 p14 p14 
<br/>
  p14 p14 p14 p14 p14 p14 p16 g1
<br/>
2 p7 p9 p9 p9 p10
<br/>
  p12 p12 p13
<br/>
  p45-12 p45-12 p45-12 p45-12
<br/>
  p45-12 p45-12 p45-12 p15 g2
<br/>
<br/>
3 p7 p8-12 p8-12 p8-12 p0-12
<br/>
  p1 p1 p1 p1 p1 p1 p1 p1
<br/>
  p2 p4 p4 p4 p4 p4 p4 p6 p5 g3
<br/>
4 p17 p18 p19 p17 p18 p19
<br/>
  p17 p18 p19 p17 p18 p19 p17 p18 p19 p17 p18 p19
<br/>
  p20 p20 p20 p20 p20 p20 p20 p20
<br/>
  p21 p22 p22 p22 p22 p22 p22 p15
<br/>
  g4
<br/>
<br/>
5 p30 p31 p31 p31
<br/>
  p31 p31 p31 p31 p31 p31 p31 p31
<br/>
  p32 p33 p33 p34 p33 p33 p33 p34
<br/>
  p35 p37 p36 p38 p36 p37 p36 p38
<br/>
  p36 p37 p36 p38 p36 p37 p39
<br/>
  g5
<br/>
6 p40 p40 p40 p40 p40 p40 p40 p40 p40 p40 p40 p40
<br/>
  p41 p42 p42 p42 p42 p42 p42 p42 p43
<br/>
  p4 p4 p4 p4 p4 p4 p4 p44
<br/>
  g6
<br/>
</td> </tr></table><span class="postbody">
<br/>
'g' is a goto command, 'p' is a play command that selects a "pattern" aka "track" from the patterns section, and 1-6 are labels.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">patterns
<br/>
<br/>
# [snip]
<br/>
#sample 2: pick bass
<br/>
40 i3 g0 h1 r2 g0 h1 r1 d1 h1 d0 f1 h1 f1 h1 d1 h1
<br/>
      g0 h1 r2 g0 h1 r1 d1 h1 d0 f1 h1 f1 d1 c1 bb0 end
<br/>
</td> </tr></table><span class="postbody">
<br/>
0 is a label
<br/>
'i#' means change program to #. Instrument 0 has a special meaning, used mostly for drum tracks (noise and PCM). It acts like a program change before each note depending on the note's declared pitch, but the actual note is played at middle C.
<br/>
'a#' through 'g#' mean play a note at octave #, where 'c2' is middle C, then hold for 1 sixteenth note. The 's' (sharp) or 'b' (flat) raises or lowers a pitch by 1 semitone.
<br/>
'h#' means hold for # sixteenth notes
<br/>
'r#' means rest: cut the note, then wait for # sixteenth notes
<br/>
'n#' used in some of the patterns means play a note # semitones above c0. It was added to the system before the a-g commands.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#162668 - Ruben - Mon Sep 08, 2008 1:57 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">speed 10
<br/>
channels 6
<br/>
</td> </tr></table><span class="postbody">
<br/>
This tells Tri Engine to [snip] allocate 4 tone generators and 2 voices to music.</span></td> </tr></table><span class="postbody">
<br/>
Well... I personally think it'd be better to enable the tone generators using bits. IE:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define SQR1_ON 0x01
<br/>
#define SQR2_ON 0x02
<br/>
#define SAW_ON 0x04 //channel 3 data; written as saw on start up
<br/>
#define SONG 0x80 //just for verification
<br/>
<br/>
typedef struct {
<br/>
 u8 flags;
<br/>
 u8 voice_count; //actual voices, not TG's
<br/>
 u8 track_count;
<br/>
 u8 xx; //extension?
<br/>
 
<br/>
 smp *inst_tbl;
<br/>
 
<br/>
 u8 *tracks[];
<br/>
} song;
<br/>
<br/>
const u8 mysong_tr1[] = {
<br/>
 ...
<br/>
};
<br/>
<br/>
const u8 mysong_tr2[] = {
<br/>
 ...
<br/>
};
<br/>
<br/>
...
<br/>
<br/>
const smp *mysong_insttbl[] = {
<br/>
 inst1,
<br/>
 inst2,
<br/>
 ...
<br/>
};
<br/>
<br/>
const song mysong = {
<br/>
 SQR1_ON | SAW_ON | SONG, //turn on the square generator and the saw wave generator. tell the engine this *is* a song
<br/>
 7, //song has 7 "real" samples (sample data)
<br/>
 16, //16 soft-mixed channels
<br/>
 0,
<br/>
 
<br/>
 mysong_instbl,
<br/>
 
<br/>
 mysong_tr1,
<br/>
 mysong_tr2,
<br/>
 ...
<br/>
};</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">instruments
<br/>
11-4,0x65  #deep kick
<br/>
10-1,0x24  #clap
<br/>
 5-1,0x04  #hat
<br/>
<br/>
...</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
<br/>
??? How does that work? I would personally do something like...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">typedef struct {
<br/>
 u8 start_key; //key range - from
<br/>
 u8 end_key; //key range - to
<br/>
 u8 root_key; //original key
<br/>
 u8 fine_tune; //additional finetuning (for use with MIDIKey2Freq)
<br/>
 smp *samp; //pointer to WaveData-style sample
<br/>
} subsample;
<br/>
<br/>
typedef struct {
<br/>
 u16 smpcnt; //sample count for this instrument
<br/>
 u16 flags; //I'm not sure...
<br/>
 u8 attack;
<br/>
 u8 decay;
<br/>
 u8 sustain;
<br/>
 u8 release;
<br/>
 
<br/>
 subsample *subsmp[];
<br/>
} instrument;</td> </tr></table><span class="postbody">
<br/>
But I'm not sure... :-/</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#162679 - tepples - Mon Sep 08, 2008 8:24 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ruben wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">instruments
<br/>
11-4,0x65  #deep kick
<br/>
10-1,0x24  #clap
<br/>
 5-1,0x04  #hat
<br/>
<br/>
...</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
??? How does that work?</span></td> </tr></table><span class="postbody">
<br/>
It's a very thin syntactic sugar over raw writes to GBC PSG registers (see belogic.com/gba/). 11-4 means start at volume 11 and decrease every 4 ticks (64 ticks in a second, unlike the 60 that one would expect), and 0x65 is the value written to the noise frequency register. For channels 1 and 2, as on the NES, 0x00 is 1/8 duty, 0x40 is 1/4 duty, and 0x80 is 1/2 duty.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"> I would personally do something like</td> </tr></table><span class="postbody">
<br/>
That'd probably work OK for sampled instruments and anything else that can use a software envelope. It wouldn't work so well for GBC PSG instruments because of the click whenever you change the volume on a GBC channel, which is part of why PocketNES doesn't sound perfect.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#162682 - Ruben - Tue Sep 09, 2008 12:00 am</h4>
    <div class="postbody"><span class="postbody">Well... after thinking about that, I thought maybe that structure should be for software-enveloped instruments, and the tone generators have nothing like that. IE:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">@ track 1, 2, 3, 4 ...
<br/>
<br/>
@ track 8 (square 1 TG)
<br/>
mysong_tr8:
<br/>
 .byte VOICE, 0xFF @ FFh: square 1, FEh: square 2, FDh: saw
<br/>
 .byte VOLUME, 0x07
<br/>
 
<br/>
 ...
<br/>
 
<br/>
 .byte EOTr</td> </tr></table><span class="postbody">
<br/>
<br/>
As soon as the player sees a voice value that's &gt;= FDh, it doesn't assign a software channel, but just writes to the "fake" channel structure with the sound data and writes a flag as to what it's playing right now.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#162799 - Ruben - Sat Sep 13, 2008 9:09 am</h4>
    <div class="postbody"><span class="postbody">OK. So I've been thinking and thinking... and I finally came up with something:
<br/>
<br/>
-Square2 (at least that's what it's called in XG) is played by channel 1 and 2
<br/>
-Saw2 (ditto) is played by channel 3
<br/>
<br/>
Both of these patches/programs/instruments/etc are hard-coded to run at 50% volume (IOW: No volume changes for them and definitely no envelopes). All other instruments are software mixed. They all have 256 position attack, decay, sustain and release, with a maximum polyphony of 32 notes (Yes, increased now after I made the mixing routine faster; theoretically, 32 channels on would be ~56% CPU (~1.7% per channel) @ 18157Hz, plus another 4% or 5% for player load). The conversion program will look for program patches in a file called "patchinfo.inf", which contains data like this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">[0]
<br/>
name=Acoustic Grand Piano
<br/>
folder=samples\grndpno
<br/>
0=piano_c0.wav ;starting at C0, which is note number 0...
<br/>
24=piano_c2.wav ; ... ends at B1, with C2 starting with "piano_c2.wav"</td> </tr></table><span class="postbody">
<br/>
<br/>
So... any ideas?
<br/>
<br/>
And more importantly... does anyone know where I can find PD sound files which I might be able to use as an example?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163049 - Ruben - Sat Sep 20, 2008 1:35 pm</h4>
    <div class="postbody"><span class="postbody">OK. Did a lot more thinking and I *think* I might use my keyboard as an example sound bank (though I'm not sure if it's legal/etc to do it... hm).
<br/>
<br/>
As for instruments... I plan to do something like...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">typedef struct {
<br/>
 u8   attack;
<br/>
 u8   decay;
<br/>
 u8   sustain;
<br/>
 u8   release;
<br/>
 
<br/>
 u8   smp[]; //numbers are "pointers" per-se to samples in the sample pool
<br/>
} instrument;
<br/>
<br/>
const instrument someinst = {
<br/>
 24,  //attack starts at 24
<br/>
 234, //decay starts at 234
<br/>
 256, //sustain level is 256
<br/>
 63,  //release starts at 63
<br/>
 
<br/>
 {
<br/>
  0, //points to smppool[0] (Cn0)
<br/>
  7, //points to smppool[7] (Cs0)
<br/>
 };
<br/>
};
<br/>
<br/>
const smp *smppool[] = {
<br/>
 &amp;smp1,
<br/>
 &amp;smp2,
<br/>
 ...
<br/>
};</td> </tr></table><span class="postbody">
<br/>
Is that a "sane" format?
<br/>
As for tracks...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">typedef struct {
<br/>
 char id[3];   //ID - should be "TRK" or something
<br/>
 u8   chncnt;  //channel count
<br/>
 
<br/>
 u8  *track[]; //pointer to tracks
<br/>
} song;</td> </tr></table><span class="postbody">
<br/>
Then you define a song with tracks that have a variable tempo each (too much?) and have a pre-defined sample bank for all songs. Like...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">const smp *smppool[] = {
<br/>
 &amp;strings, //first used instrument detected by converter
<br/>
 &amp;gpiano1, //second ""      ""        ""    ""     ""
<br/>
...
<br/>
};
<br/>
<br/>
const u8 song001_trk001[] = {
<br/>
 SET_PROGRAM, 1, //change to gpiano1
<br/>
 SET_TEMPO, 125, //change tempo to 125
<br/>
 MULTINOTE_S,    //multinote start
<br/>
 NOTE, C4, 127,  //play C4 @ 127
<br/>
 NOTE, E4, 127,  //play E4 @ 127 along with C4
<br/>
 MULTINOTE_E,    //multinote end
<br/>
 WAIT, 3,        //wait 3 ticks
<br/>
 NOTEOFF_ALL,    //do a note off on all notes started by this channel
<br/>
 END,
<br/>
};</td> </tr></table><span class="postbody">
<br/>
Any opinions?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163051 - Kyoufu Kawa - Sat Sep 20, 2008 2:24 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ruben wrote:</b></span></td> </tr> <tr> <td class="quote">Then you define a song with tracks that have a variable tempo each (too much?)</td> </tr></table><span class="postbody">Too much if you ask me.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163054 - Ruben - Sat Sep 20, 2008 2:46 pm</h4>
    <div class="postbody"><span class="postbody">Yeah, I thought it was too much but I can't think of any other way to implement a song-like structure that has a tempo of it's own that runs parallel to another song... Hmm...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163056 - Kyoufu Kawa - Sat Sep 20, 2008 5:21 pm</h4>
    <div class="postbody"><span class="postbody">Keep timers for each track, but have tempo commands set the tempo for all tracks in that song?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163060 - keldon - Sat Sep 20, 2008 10:55 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ruben wrote:</b></span></td> </tr> <tr> <td class="quote">Yeah, I thought it was too much but I can't think of any other way to implement a song-like structure that has a tempo of it's own that runs parallel to another song... Hmm...</td> </tr></table><span class="postbody">
<br/>
<br/>
Hmm; well run two song instances in parallel - seems about the most obvious angle &lt;_&lt;</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163087 - Ruben - Mon Sep 22, 2008 6:03 am</h4>
    <div class="postbody"><span class="postbody">LMAO @ keldon.
<br/>
<br/>
Anyway... I think I'll allow a maximum of 2 songs running at the same time and keep a variable on each track to see what song it's running... Hmm... why am I coding this whole thing in ASM only..?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163383 - Ruben - Wed Oct 01, 2008 6:08 am</h4>
    <div class="postbody"><span class="postbody">OK. Re-writing the whole engine. Everything except the actual mixer is coded in C. Maximum of 4 tracks at a time, 32 channels polyphony, 1 track/pattern controls the whole song and all the channels (kinda like the S3M format). So far, it uses 2KBs of EWRAM and 2.8KBs of IWRAM. IWRAM I know is going to rise a fair bit with the mixing routines but that's all for now.
<br/>
<br/>
Only uses DMA1 (and DMA2 if built with the stereo define) and TM0 and is pretty light on CPU usage (1.7% CPU per channel, no looping @ 18157Hz). (The BIOS routines eat up *TWELVE* scanlines per channel @ 13379Hz! :O)
<br/>
<br/>
Since instruments are going to be multi-sampled (aka: different samples at different "regions"), I'm changing the music format around to something similar to that of S3M, and pre-calculating the samples on the conversion.
<br/>
<br/>
Anything I'm missing?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164010 - Ruben - Sat Oct 18, 2008 1:36 pm</h4>
    <div class="postbody"><span class="postbody">Okey-dokey...
<br/>
<br/>
First, I tried using a temp buffer (all @ 18157Hz). ~1.7% CPU per channel. OK, but could be a LOT better.
<br/>
<br/>
No temp buffer = ~2% CPU per channel. Not good.
<br/>
<br/>
So...
<br/>
What I've thought of is coming up with another mixer (please don't hate me! I just love writing and re-writing mixers trying to challenge myself~ ^___^)
<br/>
<br/>
-32 channels, 128 panning positions, 0-127 volume range.
<br/>
-Low IWRAM usage (~1KB, 3KB tops), average EWRAM usage (3-4KB).
<br/>
<br/>
-Master mixing frequency: 32768Hz (Got that number from GBATek on the GBA's re-sampling frequency)
<br/>
-Maybe I'll incorporate support for more frequencies later on.
<br/>
-Up to 4 tracks playing at once
<br/>
-Support for the square channels (will explain in the future (or quickly: Name a sample "__SQUARE__" and it will play back through the pulse generators, configure with different "undefined" tracker commands and SysEx MIDI commands))
<br/>
-Most code written in pure ASM (Everything except the music player will be written in ASM)
<br/>
-Free for non-commercial use, and sorry but no commercial use just yet. d(^_^)
<br/>
(Remember, I AM 14! :P)
<br/>
<br/>
Oh and in case you've been wondering:
<br/>
No, I'm not going to scrap this project and I haven't scrapped it either. I just haven't worked out a fast mixing algorithm.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164047 - Ruben - Sun Oct 19, 2008 1:38 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">-Master mixing frequency: 32768Hz</td> </tr></table><span class="postbody">
<br/>
<br/>
Did I say 32768Hz? I meant 18157Hz, sorry. :P
<br/>
(Question: Do you think I should re-sample to 36314Hz in the mix down, or is that just crazy?)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164048 - tepples - Sun Oct 19, 2008 2:51 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ruben wrote:</b></span></td> </tr> <tr> <td class="quote">(Question: Do you think I should re-sample to 36314Hz in the mix down, or is that just crazy?)</td> </tr></table><span class="postbody">
<br/>
<a class="postlink" href="http://www.pineight.com/gba/gsm/" target="_blank">GSM Player</a> linearly interpolates the 18157 Hz decoded stream to 36314 Hz. But as an April Fool's joke, I also made a proof-of-concept game demo based on a generic mode 7 engine, and its version of GSM Player lacked this sort of resampling. (This version ended up becoming <a class="postlink" href="http://www.pineight.com/lu/" target="_blank">Luminesweeper</a>'s music player.) A couple people on <span style="font-style: italic">that other forum</span> actually preferred the aliased sound of the demo compared to the "muffled" sound of the original GSM Player. So it might be wise to compare the results with and without resampling, when played through a GBA and headphones.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164053 - Ruben - Sun Oct 19, 2008 5:59 pm</h4>
    <div class="postbody"><span class="postbody">HOLY %^@#!!!!!!!!!!!!!!!
<br/>
<br/>
Just... WOW!!! That sounds effin' incredible!!! Looks like 18157Hz with no "final result" re-sampling sounds best~ Thanks! ^_________^
<br/>
<br/>
And DAMN! I couldn't even tell those files were compressed from how good they sounded!!!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164110 - naleksiev - Mon Oct 20, 2008 9:54 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ruben wrote:</b></span></td> </tr> <tr> <td class="quote">I might use my keyboard as an example sound bank (though I'm not sure if it's legal/etc to do it... hm).</td> </tr></table><span class="postbody">
<br/>
<br/>
I was thinking about doing a tracker before but never finished it. Anyway I was using different method for getting the samples. I created a single note MIDI files and then played them and capture the output using WinAMP. This method also allowed me to choose the quality I want to for the samples. Also I thought it's probably better quality because the sound never get converted to analog. Of course I don't know as well how legal this is.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164118 - Ruben - Tue Oct 21, 2008 2:49 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>naleksiev wrote:</b></span></td> </tr> <tr> <td class="quote">I was thinking about doing a tracker before but never finished it. Anyway I was using different method for getting the samples. I created a single note MIDI files and then played them and capture the output using WinAMP.</td> </tr></table><span class="postbody">
<br/>
Yeah, I've done that too but I guess the samples are definitely illegal to use, since they were taken from a sound driver without permission. 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>naleksiev wrote:</b></span></td> </tr> <tr> <td class="quote">This method also allowed me to choose the quality I want to for the samples.</td> </tr></table><span class="postbody">
<br/>
Really? I've been able to record all my samples @ 18157Hz all the time, from anywhere.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164639 - Ruben - Tue Nov 11, 2008 7:20 am</h4>
    <div class="postbody"><span class="postbody">OK guys. A demo of AGBMidi has been sent to the news e-mail so be ready~
<br/>
<br/>
d(^_^)
<br/>
<br/>
Has example song data (written by hand).. namely, this...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">//////////////////////////////////
<br/>
<br/>
.global sng_TestSong
<br/>
.align
<br/>
<br/>
sng_TestSong:
<br/>
   .word   2
<br/>
   .word   smpBank001
<br/>
   
<br/>
   .word   sng_TestSong_Trk001
<br/>
   .word   sng_TestSong_Trk002
<br/>
<br/>
.align
<br/>
.size sng_TestSong, .-sng_TestSong
<br/>
<br/>
//////////////////////////////////
<br/>
<br/>
.global sng_TestSong_Trk001
<br/>
.align
<br/>
<br/>
sng_TestSong_Trk001:
<br/>
   .byte   MIDI_TEMPO, 172
<br/>
   .byte   MIDI_VOLUME, MIDI_MAX_VAL
<br/>
   .byte   MIDI_PAN, MIDI_CNTR_VALUE
<br/>
   .byte   MIDI_PROGRAM, 1
<br/>
   .byte   MIDI_WHEEL, MIDI_CNTR_VALUE
<br/>
   .byte   MIDI_KEY_SHIFT, 0
<br/>
<br/>
.LTrack001_Loop0:
<br/>
   .byte   MIDI_NOTE_ON, MIDI_NOTE(MIDI_A, MIDI_OCTMID), 127
<br/>
   .byte   MIDI_WAIT(48)
<br/>
   .byte   MIDI_NOTE_OFF, MIDI_NOTE(MIDI_A, MIDI_OCTMID)
<br/>
   
<br/>
   .byte   MIDI_NOTE_ON, MIDI_NOTE(MIDI_C, MIDI_OCTMID+1), 127
<br/>
   .byte   MIDI_WAIT(48)
<br/>
   .byte   MIDI_NOTE_OFF, MIDI_NOTE(MIDI_C, MIDI_OCTMID+1)
<br/>
   
<br/>
   .byte   MIDI_NOTE_ON, MIDI_NOTE(MIDI_E, MIDI_OCTMID+1), 127
<br/>
   .byte   MIDI_WAIT(48)
<br/>
   .byte   MIDI_NOTE_OFF, MIDI_NOTE(MIDI_E, MIDI_OCTMID+1)
<br/>
   
<br/>
   .byte   MIDI_NOTE_ON, MIDI_NOTE(MIDI_G, MIDI_OCTMID+1), 127
<br/>
   .byte   MIDI_WAIT(48)
<br/>
   .byte   MIDI_NOTE_OFF, MIDI_NOTE(MIDI_G, MIDI_OCTMID+1)
<br/>
   
<br/>
   .byte   MIDI_NOTE_ON, MIDI_NOTE(MIDI_Fs, MIDI_OCTMID+1), 127
<br/>
   .byte   MIDI_WAIT(36)
<br/>
   .byte   MIDI_WAIT(36)
<br/>
   .byte   MIDI_WAIT(36)
<br/>
   .byte   MIDI_WAIT(36)
<br/>
   .byte   MIDI_WAIT(24)
<br/>
   .byte   MIDI_WAIT(24)
<br/>
   .byte   MIDI_NOTE_OFF, MIDI_NOTE(MIDI_Fs, MIDI_OCTMID+1)
<br/>
   
<br/>
//////////////////////////////////
<br/>
<br/>
.LTrack001_Loop1:
<br/>
   .byte   MIDI_NOTE_ON, MIDI_NOTE(MIDI_B, MIDI_OCTMID-1), 127
<br/>
   .byte   MIDI_NOTE_ON, MIDI_NOTE(MIDI_Fs, MIDI_OCTMID), 127
<br/>
   .byte   MIDI_NOTE_ON, MIDI_NOTE(MIDI_B, MIDI_OCTMID), 127
<br/>
   .byte   MIDI_NOTE_ON, MIDI_NOTE(MIDI_E, MIDI_OCTMID+1), 127
<br/>
   .byte   MIDI_WAIT(48)
<br/>
   .byte   MIDI_NOTE_OFF, MIDI_NOTE(MIDI_B, MIDI_OCTMID-1)
<br/>
   .byte   MIDI_NOTE_OFF, MIDI_NOTE(MIDI_Fs, MIDI_OCTMID)
<br/>
   .byte   MIDI_NOTE_OFF, MIDI_NOTE(MIDI_B, MIDI_OCTMID)
<br/>
   .byte   MIDI_NOTE_OFF, MIDI_NOTE(MIDI_E, MIDI_OCTMID+1)
<br/>
   
<br/>
   .byte   MIDI_NOTE_ON, MIDI_NOTE(MIDI_B, MIDI_OCTMID-1), 127
<br/>
   .byte   MIDI_NOTE_ON, MIDI_NOTE(MIDI_Fs, MIDI_OCTMID), 127
<br/>
   .byte   MIDI_NOTE_ON, MIDI_NOTE(MIDI_B, MIDI_OCTMID), 127
<br/>
   .byte   MIDI_NOTE_ON, MIDI_NOTE(MIDI_D, MIDI_OCTMID+1), 127
<br/>
   .byte   MIDI_WAIT(48)
<br/>
   .byte   MIDI_NOTE_OFF, MIDI_NOTE(MIDI_B, MIDI_OCTMID-1)
<br/>
   .byte   MIDI_NOTE_OFF, MIDI_NOTE(MIDI_Fs, MIDI_OCTMID)
<br/>
   .byte   MIDI_NOTE_OFF, MIDI_NOTE(MIDI_B, MIDI_OCTMID)
<br/>
   .byte   MIDI_NOTE_OFF, MIDI_NOTE(MIDI_D, MIDI_OCTMID+1)
<br/>
   
<br/>
   .byte   MIDI_NOTE_ON, MIDI_NOTE(MIDI_B, MIDI_OCTMID-1), 127
<br/>
   .byte   MIDI_NOTE_ON, MIDI_NOTE(MIDI_Fs, MIDI_OCTMID), 127
<br/>
   .byte   MIDI_NOTE_ON, MIDI_NOTE(MIDI_A, MIDI_OCTMID), 127
<br/>
   .byte   MIDI_NOTE_ON, MIDI_NOTE(MIDI_Cs, MIDI_OCTMID+1), 127
<br/>
   .byte   MIDI_WAIT(48)
<br/>
   .byte   MIDI_NOTE_OFF, MIDI_NOTE(MIDI_B, MIDI_OCTMID-1)
<br/>
   .byte   MIDI_NOTE_OFF, MIDI_NOTE(MIDI_Fs, MIDI_OCTMID)
<br/>
   .byte   MIDI_NOTE_OFF, MIDI_NOTE(MIDI_A, MIDI_OCTMID)
<br/>
   .byte   MIDI_NOTE_OFF, MIDI_NOTE(MIDI_Cs, MIDI_OCTMID+1)
<br/>
   
<br/>
   .byte   MIDI_NOTE_ON, MIDI_NOTE(MIDI_B, MIDI_OCTMID-1), 127
<br/>
   .byte   MIDI_NOTE_ON, MIDI_NOTE(MIDI_Fs, MIDI_OCTMID), 127
<br/>
   .byte   MIDI_NOTE_ON, MIDI_NOTE(MIDI_B, MIDI_OCTMID), 127
<br/>
   .byte   MIDI_NOTE_ON, MIDI_NOTE(MIDI_D, MIDI_OCTMID+1), 127
<br/>
   .byte   MIDI_WAIT(48)
<br/>
   .byte   MIDI_NOTE_OFF, MIDI_NOTE(MIDI_B, MIDI_OCTMID-1)
<br/>
   .byte   MIDI_NOTE_OFF, MIDI_NOTE(MIDI_Fs, MIDI_OCTMID)
<br/>
   .byte   MIDI_NOTE_OFF, MIDI_NOTE(MIDI_B, MIDI_OCTMID)
<br/>
   .byte   MIDI_NOTE_OFF, MIDI_NOTE(MIDI_D, MIDI_OCTMID+1)
<br/>
   
<br/>
   .byte   MIDI_NOTE_ON, MIDI_NOTE(MIDI_C, MIDI_OCTMID), 127
<br/>
   .byte   MIDI_NOTE_ON, MIDI_NOTE(MIDI_E, MIDI_OCTMID), 127
<br/>
   .byte   MIDI_WAIT(48)
<br/>
   .byte   MIDI_WAIT(48)
<br/>
   .byte   MIDI_WAIT(48)
<br/>
   .byte   MIDI_WAIT(48)
<br/>
   .byte   MIDI_NOTE_OFF, MIDI_NOTE(MIDI_C, MIDI_OCTMID)
<br/>
   .byte   MIDI_NOTE_OFF, MIDI_NOTE(MIDI_E, MIDI_OCTMID)
<br/>
   
<br/>
   .byte   MIDI_LOOP
<br/>
   .word   .LTrack001_Loop1
<br/>
   .byte   1
<br/>
   
<br/>
   .byte   MIDI_EOF
<br/>
<br/>
.align
<br/>
.size sng_TestSong_Trk001, .-sng_TestSong_Trk001
<br/>
<br/>
//////////////////////////////////
<br/>
<br/>
.global sng_TestSong_Trk002
<br/>
.align
<br/>
<br/>
sng_TestSong_Trk002:
<br/>
   .byte   MIDI_VOLUME, MIDI_MAX_VAL
<br/>
   .byte   MIDI_PAN, MIDI_CNTR_VALUE
<br/>
   .byte   MIDI_PROGRAM, 0
<br/>
   .byte   MIDI_WHEEL, MIDI_CNTR_VALUE
<br/>
   .byte   MIDI_KEY_SHIFT, 0
<br/>
<br/>
.LTrack002_Loop0:
<br/>
   .byte   MIDI_NOTE_ON, MIDI_NOTE(MIDI_A, MIDI_OCTMID-2), 127
<br/>
   .byte   MIDI_WAIT(12)
<br/>
   .byte   MIDI_NOTE_OFF, MIDI_NOTE(MIDI_A, MIDI_OCTMID-2)
<br/>
   
<br/>
   .byte   MIDI_NOTE_ON, MIDI_NOTE(MIDI_E, MIDI_OCTMID-1), 127
<br/>
   .byte   MIDI_WAIT(12)
<br/>
   .byte   MIDI_NOTE_OFF, MIDI_NOTE(MIDI_E, MIDI_OCTMID-1)
<br/>
   
<br/>
   .byte   MIDI_NOTE_ON, MIDI_NOTE(MIDI_A, MIDI_OCTMID-1), 127
<br/>
   .byte   MIDI_WAIT(12)
<br/>
   .byte   MIDI_NOTE_OFF, MIDI_NOTE(MIDI_A, MIDI_OCTMID-1)
<br/>
   
<br/>
   .byte   MIDI_NOTE_ON, MIDI_NOTE(MIDI_G, MIDI_OCTMID-2), 127
<br/>
   .byte   MIDI_WAIT(12)
<br/>
   .byte   MIDI_NOTE_OFF, MIDI_NOTE(MIDI_G, MIDI_OCTMID-2)
<br/>
   
<br/>
   .byte   MIDI_NOTE_ON, MIDI_NOTE(MIDI_D, MIDI_OCTMID-1), 127
<br/>
   .byte   MIDI_WAIT(12)
<br/>
   .byte   MIDI_NOTE_OFF, MIDI_NOTE(MIDI_D, MIDI_OCTMID-1)
<br/>
   
<br/>
   .byte   MIDI_NOTE_ON, MIDI_NOTE(MIDI_G, MIDI_OCTMID-1), 127
<br/>
   .byte   MIDI_WAIT(12)
<br/>
   .byte   MIDI_NOTE_OFF, MIDI_NOTE(MIDI_G, MIDI_OCTMID-1)
<br/>
   
<br/>
   .byte   MIDI_NOTE_ON, MIDI_NOTE(MIDI_F, MIDI_OCTMID-1), 127
<br/>
   .byte   MIDI_WAIT(12)
<br/>
   .byte   MIDI_NOTE_OFF, MIDI_NOTE(MIDI_F, MIDI_OCTMID-1)
<br/>
   
<br/>
   .byte   MIDI_NOTE_ON, MIDI_NOTE(MIDI_C, MIDI_OCTMID-1), 127
<br/>
   .byte   MIDI_WAIT(12)
<br/>
   .byte   MIDI_NOTE_OFF, MIDI_NOTE(MIDI_C, MIDI_OCTMID-1)
<br/>
   
<br/>
   .byte   MIDI_LOOP
<br/>
   .word   .LTrack002_Loop0
<br/>
   .byte   1
<br/>
   
<br/>
   .byte   MIDI_NOTE_ON, MIDI_NOTE(MIDI_A, MIDI_OCTMID-1), 127
<br/>
   .byte   MIDI_WAIT(36)
<br/>
   .byte   MIDI_NOTE_OFF, MIDI_NOTE(MIDI_A, MIDI_OCTMID-1)
<br/>
   
<br/>
   .byte   MIDI_NOTE_ON, MIDI_NOTE(MIDI_G, MIDI_OCTMID-1), 127
<br/>
   .byte   MIDI_WAIT(36)
<br/>
   .byte   MIDI_NOTE_OFF, MIDI_NOTE(MIDI_G, MIDI_OCTMID-1)
<br/>
   
<br/>
   .byte   MIDI_NOTE_ON, MIDI_NOTE(MIDI_Fs, MIDI_OCTMID-1), 127
<br/>
   .byte   MIDI_WAIT(36)
<br/>
   .byte   MIDI_NOTE_OFF, MIDI_NOTE(MIDI_Fs, MIDI_OCTMID-1)
<br/>
   
<br/>
   .byte   MIDI_NOTE_ON, MIDI_NOTE(MIDI_E, MIDI_OCTMID-1), 127
<br/>
   .byte   MIDI_WAIT(36)
<br/>
   .byte   MIDI_NOTE_OFF, MIDI_NOTE(MIDI_E, MIDI_OCTMID-1)
<br/>
   
<br/>
   .byte   MIDI_NOTE_ON, MIDI_NOTE(MIDI_Ds, MIDI_OCTMID-1), 127
<br/>
   .byte   MIDI_WAIT(24)
<br/>
   .byte   MIDI_NOTE_OFF, MIDI_NOTE(MIDI_Ds, MIDI_OCTMID-1)
<br/>
   
<br/>
   .byte   MIDI_NOTE_ON, MIDI_NOTE(MIDI_C, MIDI_OCTMID-1), 127
<br/>
   .byte   MIDI_WAIT(24)
<br/>
   .byte   MIDI_NOTE_OFF, MIDI_NOTE(MIDI_C, MIDI_OCTMID-1)
<br/>
   
<br/>
//////////////////////////////////
<br/>
<br/>
.LTrack002_Loop1:
<br/>
   .byte   MIDI_NOTE_ON, MIDI_NOTE(MIDI_B, MIDI_OCTMID-3), 127
<br/>
   .byte   MIDI_WAIT(12)
<br/>
   .byte   MIDI_NOTE_OFF, MIDI_NOTE(MIDI_B, MIDI_OCTMID-3)
<br/>
   .byte   MIDI_NOTE_ON, MIDI_NOTE(MIDI_B, MIDI_OCTMID-2), 127
<br/>
   .byte   MIDI_WAIT(12)
<br/>
   .byte   MIDI_NOTE_OFF, MIDI_NOTE(MIDI_B, MIDI_OCTMID-2)
<br/>
   
<br/>
   .byte   MIDI_LOOP
<br/>
   .word   .LTrack002_Loop1
<br/>
   .byte   7
<br/>
<br/>
.LTrack002_Loop2:
<br/>
   .byte   MIDI_NOTE_ON, MIDI_NOTE(MIDI_C, MIDI_OCTMID-2), 127
<br/>
   .byte   MIDI_WAIT(12)
<br/>
   .byte   MIDI_NOTE_OFF, MIDI_NOTE(MIDI_C, MIDI_OCTMID-2)
<br/>
   .byte   MIDI_NOTE_ON, MIDI_NOTE(MIDI_C, MIDI_OCTMID-1), 127
<br/>
   .byte   MIDI_WAIT(12)
<br/>
   .byte   MIDI_NOTE_OFF, MIDI_NOTE(MIDI_C, MIDI_OCTMID-1)
<br/>
   
<br/>
   .byte   MIDI_LOOP
<br/>
   .word   .LTrack002_Loop2
<br/>
   .byte   7
<br/>
   
<br/>
.LTrack002_Loop3:
<br/>
   .byte   MIDI_NOTE_ON, MIDI_NOTE(MIDI_B, MIDI_OCTMID-3), 127
<br/>
   .byte   MIDI_WAIT(12)
<br/>
   .byte   MIDI_NOTE_OFF, MIDI_NOTE(MIDI_B, MIDI_OCTMID-3)
<br/>
   .byte   MIDI_NOTE_ON, MIDI_NOTE(MIDI_B, MIDI_OCTMID-2), 127
<br/>
   .byte   MIDI_WAIT(12)
<br/>
   .byte   MIDI_NOTE_OFF, MIDI_NOTE(MIDI_B, MIDI_OCTMID-2)
<br/>
   
<br/>
   .byte   MIDI_LOOP
<br/>
   .word   .LTrack002_Loop3
<br/>
   .byte   7
<br/>
<br/>
.LTrack002_Loop4:
<br/>
   .byte   MIDI_NOTE_ON, MIDI_NOTE(MIDI_C, MIDI_OCTMID-2), 127
<br/>
   .byte   MIDI_WAIT(12)
<br/>
   .byte   MIDI_NOTE_OFF, MIDI_NOTE(MIDI_C, MIDI_OCTMID-2)
<br/>
   .byte   MIDI_NOTE_ON, MIDI_NOTE(MIDI_C, MIDI_OCTMID-1), 127
<br/>
   .byte   MIDI_WAIT(12)
<br/>
   .byte   MIDI_NOTE_OFF, MIDI_NOTE(MIDI_C, MIDI_OCTMID-1)
<br/>
   
<br/>
   .byte   MIDI_LOOP
<br/>
   .word   .LTrack002_Loop4
<br/>
   .byte   7
<br/>
   
<br/>
   .byte   MIDI_EOF
<br/>
<br/>
.align
<br/>
.size sng_TestSong_Trk002, .-sng_TestSong_Trk002
<br/>
<br/>
//////////////////////////////////
<br/>
<br/>
.global smpBank001
<br/>
.align
<br/>
<br/>
smpBank001:
<br/>
   .word   inst_square
<br/>
   .word   inst_string
<br/>
<br/>
.align
<br/>
.size smpBank001, .-smpBank001
<br/>
<br/>
//////////////////////////////////</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165198 - Ruben - Fri Dec 12, 2008 12:14 pm</h4>
    <div class="postbody"><span class="postbody">Hi guys.
<br/>
<br/>
After a bit of inactivity on the forum, I've finished AGBMidi 1.0a and released it. It can be found <a class="postlink" href="http://www.mediafire.com/?sharekey=490743648a1466e4d2db6fb9a8902bda" target="_blank">here</a>.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
