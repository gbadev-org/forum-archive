<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Probably a daft question - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>C/C++ > Probably a daft question</h2>
<div id="posts">
<div class="post">
    <h4>#5619 - punchy - Sat May 03, 2003 8:08 pm</h4>
    <div class="postbody"><span class="postbody">Hi, 
<br/>
<br/>
  Hope this isn't too stupid a question.
<br/>
<br/>
Say I have a large array of data which is used in a drawing function. Is declaring it globally a better idea, for execution speed reasons, than declaring it in the function it will be used in. Eg
<br/>
<br/>
int array [1000];
<br/>
<br/>
int main(){
<br/>
<br/>
DrawScreen();
<br/>
}
<br/>
<br/>
VS
<br/>
<br/>
int main(){
<br/>
<br/>
DrawScreen(); // 
<br/>
}
<br/>
<br/>
void DrawScreen(){
<br/>
<br/>
  int array [1000];
<br/>
  //Drawing code
<br/>
}
<br/>
<br/>
Will this data be pushed on the stack every call or will the compiler be smart. Do the optimisation flags affect this?
<br/>
<br/>
Thanks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#5702 - Sweex - Tue May 06, 2003 1:00 pm</h4>
    <div class="postbody"><span class="postbody">I don't know for sure, but I think the compiler will not be "smart" enough to put your int array [1000]; in the "global space". 
<br/>
<br/>
Why I think that? Because that is a fundamental change of the actual meaning of the code.
<br/>
<br/>
(Isn't accessing the stack faster than accessing global memory?)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#5705 - Quirky - Tue May 06, 2003 3:00 pm</h4>
    <div class="postbody"><span class="postbody">They would both go into IWRAM by default.
<br/>
<br/>
One thing you have to worry about if you place it on the stack is that you can't use ld's -Map feature to see where exactly in RAM the array goes, which is useful for debugging (and for seeing how much IWRAM you use). There would also be some extra assembler code added at compile time for accessing the stack-based array too, though that would probably only be noticed as a slightly larger final rom more than anything.
<br/>
<br/>
Something like that is probably better placed as a global though. It's what I would do with it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#5726 - jd - Wed May 07, 2003 1:40 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quirky wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Something like that is probably better placed as a global though. It's what I would do with it.</td> </tr></table><span class="postbody">
<br/>
<br/>
Whilst I agree with you in the case where you want to know the exact address so you can check it in an emulator (although perhaps displaying the address at run-time might be a better solution), you shouldn't usually use a global variable in the situation above for the following reasons:
<br/>
<br/>
1) Unlike a local variable, a global variable will still use the IWRAM even outside the routine.
<br/>
<br/>
2) Accessing a global means getting its address. Local variables don't require this step because the address of the stack is already in r13.
<br/>
<br/>
3) The optimiser knows when it can safely put local variables in registers - the same isn't true of globals so it has to err on the side of caution.
<br/>
<br/>
Remember that allocating space on the stack takes virtually no time at all - it's just a single subtraction.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#5738 - Quirky - Wed May 07, 2003 2:23 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>jd wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quirky wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Something like that is probably better placed as a global though. It's what I would do with it.</td> </tr></table><span class="postbody">
<br/>
<br/>
you shouldn't usually use a global variable in the situation above for the following reasons &lt;snip&gt;</span></td> </tr></table><span class="postbody">
<br/>
<br/>
There's nothing like putting my foot in it to learn new things ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#5743 - punchy - Wed May 07, 2003 10:09 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for the replies. There are still a couple of things i'd appreciate if anyone could clarify for me.
<br/>
<br/>
When I declare my array locally
<br/>
<br/>
void DrawScreen(){ 
<br/>
<br/>
int array [1000]; 
<br/>
//Drawing code 
<br/>
} 
<br/>
<br/>
What actually gets pushed onto the stack. Does the stack pointer just get moved 1000 array sized elements? Hence "Remember that allocating space on the stack takes virtually no time at all - it's just a single subtraction."
<br/>
<br/>
Now, say this array of 1000 elements gets initialised with values. Say graphics data for example. Now if the array is inside the DrawScreen function these 1000 values will have to be set. This I imagine will be quite a time consuming process. And it will happen every time the function is called.
<br/>
<br/>
In this case is it better to use global data, as these values will only be set once, when they are written to the global section of IWRAM.
<br/>
<br/>
Thanks for all your help.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#5746 - jd - Wed May 07, 2003 11:43 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>punchy wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
What actually gets pushed onto the stack. Does the stack pointer just get moved 1000 array sized elements? Hence "Remember that allocating space on the stack takes virtually no time at all - it's just a single subtraction."
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Yes.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>punchy wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Now, say this array of 1000 elements gets initialised with values. Say graphics data for example.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
In the case of fixed graphics data you should really be using const. But I digress. :)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>punchy wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Now if the array is inside the DrawScreen function these 1000 values will have to be set. This I imagine will be quite a time consuming process. And it will happen every time the function is called.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Yes.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>punchy wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
In this case is it better to use global data,
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
That depends on whether the function relies on the values being reset back to their initial values each time the code is called - if it does, then making the array a global (or, preferably, a static local) would break the routine.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#5771 - punchy - Thu May 08, 2003 9:45 am</h4>
    <div class="postbody"><span class="postbody">As the data does not ever change i'll just make it a const static local. 
<br/>
<br/>
Thanks for all your help.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
