<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>NPC System - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>C/C++ > NPC System</h2>
<div id="posts">
<div class="post">
    <h4>#114405 - QuantumDoja - Sun Jan 07, 2007 6:02 pm</h4>
    <div class="postbody"><span class="postbody">Hi, I just want to tell you about the system Im trying to implement for my npc system, please any thoughts are very welcome.....
<br/>
<br/>
<br/>
OAM Array will be an array that holds a typedef like, {id, OAMPtr etc}
<br/>
<br/>
OAM Entry 30 to 127 are free to use (for me) so I set up an array with 127 items in it (whenever ill loop, ill start from 30).
<br/>
<br/>
ok....so I move the map, and lo and behold a "coin" is in the next column of my npc array...so i need to load that in.......
<br/>
<br/>
first i check to see if this "coin" at this position has been loaded into the OAM Array, if it has, dont bother, if it hasnt, add it to the array, then loop the array for find a matching OAM ID thats in memory (a sprite), if none is found, DMA a sprite into memory and update the OAM array with this data, then I draw this onto the screen....
<br/>
<br/>
I am fine up to this point (c code).
<br/>
<br/>
I can scroll the map now, and the "coin" is scrolling with the map, ok, im getting confused with what happens when the "coin" scrolls off of the edge, should i destroy it? - Should I set it to live, but offscreen....any thoughts welcome....<br/>_________________<br/>Chris Davis</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114426 - DekuTree64 - Sun Jan 07, 2007 9:30 pm</h4>
    <div class="postbody"><span class="postbody">Depends on your needs, really. My opinion:
<br/>
<br/>
Easy way: Coin is alive at all times, and only deallocates its OAM if it's offscreen.
<br/>
<br/>
Hard way: Keep an array of bools for wether each coin has been picked up. When a coin comes onto the screen, if it hasn't already been picked up, spawn an entity for it. When it goes offscreen, kill the entity.
<br/>
<br/>
If you have massive numbers of coins in a level, the hard way will save some memory and processor time, since you'd only need to store 1 bit for each coin, and they don't need to have any sort of updating done to them when offscreen.
<br/>
<br/>
If you have less coins, then the easy way is better because you don't need all that code to handle to spawning/killing when scrolling, and managing the status array. Another benefit is that your processing time stays more constant since there aren't things being created and destroyed constantly as you move around, so you don't have to worry about jerky frame rates as much.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114439 - sajiimori - Sun Jan 07, 2007 11:18 pm</h4>
    <div class="postbody"><span class="postbody">QuantumDoja,
<br/>
<br/>
A red flag goes up for me at your second sentence -- the topic of OAMs shouldn't even come up in a discussion about NPCs.  =)
<br/>
<br/>
NPCs are a very high-level game concept, and OAMs are a very low-level hardware concept.  If you have to worry about hardware details while programming game logic, then more abstraction is needed.
<br/>
<br/>
Try making a Sprite class that handles details like OAMs.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
class Sprite
<br/>
{
<br/>
public:
<br/>
  enum Size
<br/>
  {
<br/>
    SIZE_8x8,
<br/>
    ...
<br/>
  };
<br/>
<br/>
  void setGraphic(const void* pixelData);
<br/>
  void setPalette(const void* colorData);
<br/>
  void setSize(Size);
<br/>
  void setPosition(const Vector2&amp;);
<br/>
<br/>
  const Vector2&amp; position() const;
<br/>
};
<br/>
</td> </tr></table><span class="postbody">
<br/>
Think about the minimum amount of information that you should have to provide to describe an NPC.  If you're writing much more than that in your NPC class, then use more abstraction.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
class Npc
<br/>
{
<br/>
public:
<br/>
  enum Type
<br/>
  {
<br/>
    NPC_SHEEP_FLOGGER,
<br/>
    ...
<br/>
  };
<br/>
<br/>
  Npc(Type type)
<br/>
  {
<br/>
    mSprite.setGraphic(kNpcData[type].graphic);
<br/>
    mSprite.setPalette(kNpcData[type].palette);
<br/>
    mSprite.setSize(kNpcData[type].size);
<br/>
  }
<br/>
<br/>
  void setPosition(const Vector2&amp; p)
<br/>
  {
<br/>
    mSprite.setPosition(p);
<br/>
  }
<br/>
<br/>
  const Vector2&amp; position() const
<br/>
  {
<br/>
    return mSprite.position();
<br/>
  }
<br/>
<br/>
private:
<br/>
  Sprite mSprite;
<br/>
};
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#118934 - Touchstone - Sun Feb 18, 2007 10:17 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">If you have to worry about hardware details while programming game logic, then more abstraction is needed.</td> </tr></table><span class="postbody">
<br/>
Not necessarily. If you have endless resources you can abstract to your hearts content but to really squeeze every last bit of performance you have to bite the bullet and get rid of abstraction.
<br/>
<br/>
Obviously it's a matter of code design, but "more abstraction is needed" is simply not always true.<br/>_________________<br/>You can't beat our meat</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119117 - sajiimori - Mon Feb 19, 2007 10:04 pm</h4>
    <div class="postbody"><span class="postbody"><span style="font-style: italic">Nobody</span> squeezes every last bit of performance.  Attempting to do so results in unmaintainable garbage... not to mention failure to achieve the desired goal of efficiency!
<br/>
<br/>
In real life, inadequate abstraction results in bad performance because the programmers can't spend their optimization hours effectively.
<br/>
<br/>
And abstraction doesn't necessarily reduce performance.  Sometimes it increases performance on plain technical merits, like better cache behavior from reducing code size.
<br/>
<br/>
Additionally, good programming tools make it possible to use seemingly expensive abstractions at low cost.  Templates and inline functions in C++ are good examples of abstraction tools with potentially zero runtime cost.
<br/>
<br/>
So again, if you think you need to twiddle OAM bits in the middle of would-be "high level" game logic, there's something wrong with your design.
<br/>
<br/>
Maybe you'll get lucky and no optimizations will be needed, but if performance does become an issue, you'll find yourself in a pit of unmaintainable code that you can't escape without extensive rewrites.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119295 - sgeos - Wed Feb 21, 2007 6:02 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote"><span style="font-style: italic">Nobody</span> squeezes every last bit of performance.  Attempting to do so results in unmaintainable garbage... not to mention failure to achieve the desired goal of efficiency!</td> </tr></table><span class="postbody">
<br/>
If you squeeze every last bit of space, you won't be able to localize your game.  Saying something in French takes more characters than English.  Japanese requires a 1000 to 2000 character font and code to manage it.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
