<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Can't seem to start properly - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>C/C++ > Can't seem to start properly</h2>
<div id="posts">
<div class="post">
    <h4>#48 - XyzZyx - Wed Jan 01, 2003 10:50 pm</h4>
    <div class="postbody"><span class="postbody">I just started programming the Gameboy Advance, but I can't seem to be able to run the ROM images I produce. I'm using gcc from DevKitAdvance and BoyCott/PlayBoy as the emulator. When I try to run the image file, the emulator complaints about an invalid logo and it also shows messages about "Illegal BIOS calls". I opened the debug window and saw that it kept looping the same three or four opcodes over and over. Yes, I did compile it to an object file first, then copied it to a binary file using the program which followed gcc. What am I doing wrong? The emulator doesn't even seem to access the main function of my C program at all. I thought the compiler filled in the nintendo logo and the header stuff, but it obviously didn't. Have I missed something in the compilation process or forgotten to include a file or two? Thanks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#52 - Dracula-X - Wed Jan 01, 2003 11:34 pm</h4>
    <div class="postbody"><span class="postbody">Look in the gbadev.org website in TOOLS-&gt;HEADER TOOLS
<br/>
and grab one of the many header tools that are there.  Integrate one of them into a makefile (or do it manually by hand for now) so that it 'validates' your rom with the logo and crc properly.  Most of the tools work just fine, I myself use fugbar+makefile so it validates my stuff automatically when I recompile.
<br/>
<br/>
-DX</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#58 - Costis - Thu Jan 02, 2003 1:29 am</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
Are you even using any SWI calls? If not, then you are probably running invalid code. Also, most emulators don't require for your GBA programs to have valid headers to run (VBA and Mappy for example).
<br/>
<br/>
Costis</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#59 - Splam - Thu Jan 02, 2003 1:29 am</h4>
    <div class="postbody"><span class="postbody">Fixing up the header shouldn't really be needed for emulators, only for hardware unless you've done something really wrong.  Make sure you've got (and include) CRT0.s and probably romheader.s (not sure what devkit advance uses) as these define the boot code for the rom and include the header (logo, name etc,  this is what the header tools will fix up to run on hardware).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#71 - AnthC - Thu Jan 02, 2003 7:07 am</h4>
    <div class="postbody"><span class="postbody">Hi
<br/>
Are you actually linking the object files into a ROM image?
<br/>
Just curious - from what you say, it sounds like you're renaming object files to the BIN?
<br/>
If you are still stuck, then pop into the channel sometime, i'm sure someone will help you.
<br/>
Anth</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#74 - XyzZyx - Thu Jan 02, 2003 7:54 am</h4>
    <div class="postbody"><span class="postbody">No, I didn't just copy the object file to have a .bin extension, I'm using objcopy.exe from the DevKitAdvance. And no, I did not include those .s files, but it sounds as I can use a header-fix tool to do what they would have done? Well, thanks, I'll try it! Actually, the reason I went to this forum was that it was kind of bad response in the channel (but that might also partly be because I live where I do with timezones and stuff).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#76 - Costis - Thu Jan 02, 2003 8:12 am</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
I don't really use GCC as a compiler, but I know that you need to actually link the object files in your project using the linker program, "ld". You shouldn't be converting the .o files into binary files with the "objcopy" program as that will just produce an invalid file. Oh, and you definately need the crt0.s file in your project as well.
<br/>
<br/>
Costis</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#78 - Splam - Thu Jan 02, 2003 9:28 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>XyzZyx wrote:</b></span></td> </tr> <tr> <td class="quote">No, I didn't just copy the object file to have a .bin extension, I'm using objcopy.exe from the DevKitAdvance. And no, I did not include those .s files, but it sounds as I can use a header-fix tool to do what they would have done? Well, thanks, I'll try it! Actually, the reason I went to this forum was that it was kind of bad response in the channel (but that might also partly be because I live where I do with timezones and stuff).</td> </tr></table><span class="postbody">
<br/>
<br/>
I think this all depends on your makefile, I'm pretty sure it will include crt0.s as standard unless you use the -nostarfiles switch on the linker (ld) check your makefile for that and if its there then you need to build your own crt0, that then includes the rom_header.  You cant use the header tool to save you building crt0 because the header tool would effect the area of the rom where that should be and if it's not included in your build it won't be in the rom.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#79 - XyzZyx - Thu Jan 02, 2003 10:01 am</h4>
    <div class="postbody"><span class="postbody">I don't have, don't know where to obtain and don't know how to use the crt0.s file (any tips would be appreciated). However, I think I am running the linker (the -ld option on gcc.exe).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#83 - imikeyi - Thu Jan 02, 2003 2:31 pm</h4>
    <div class="postbody"><span class="postbody">Maybe an example will help. These are the steps I'd use to compile main.c into a gba rom with gnu tools:
<br/>
<br/>
arm-agb-elf-as -o crt0.o crt0.s
<br/>
arm-agb-elf-gcc -nostartfiles -g crt0.o main.c -T lnkscript -o main.elf
<br/>
arm-agb-elf-objcopy -O binary main.elf main.gba
<br/>
<br/>
crt0.s and the lnkscript are downloadable together from <a href="http://www.devrs.com/gba." target="_blank">www.devrs.com/gba.</a> You shouldn't have to change the crt0.s file (unless you want to handle interrupts yourself etc).
<br/>
<br/>
gcc performs the linking for you. The -nostartfiles stops gcc from using the default crt0.s
<br/>
<br/>
The third line strips the elf format stuff from the file, and makes it a plain rom.
<br/>
<br/>
Hope this helps :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#86 - XyzZyx - Thu Jan 02, 2003 3:31 pm</h4>
    <div class="postbody"><span class="postbody">Thanks, I have got the crt0.o and crt0.s files along with lnkscript now. But there's still something wrong; the linker gives errors about undefined references (which I think was defined in the file(s) excluded by the -nostartfiles): The line
<br/>
<span style="font-weight: bold">C:/GBA/devkitadv/lib/gcc-lib/arm-agb-elf/3.0.2/libgcc.a(__main.o): In function '__do_global_dtors': __main.o(.text+0x74): undefined reference to '__EH_FRAME_BEGIN__'</span>
<br/>
comes out among others. When I don't include the -nostartfiles option, it pops out errors with "duplicate definitions" of other labels instead.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#108 - imikeyi - Fri Jan 03, 2003 1:03 am</h4>
    <div class="postbody"><span class="postbody">You should post all the error messages.
<br/>
<br/>
Also, what code are you trying to compile? Depending on the crt0.s file, you'll probably have to define your entry point function as int AgbMain(void)  rather than int main(void).
<br/>
<br/>
The -nostartfiles makes gcc not use the default c runtime file (crt.s), so you can specify your own. If you specify your own and don't include -nostartfiles, there will be duplicate definitions etc, resulting in the errors you are getting.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#125 - XyzZyx - Fri Jan 03, 2003 6:59 pm</h4>
    <div class="postbody"><span class="postbody">Yep, the main method was it! Thank you everybody, you've helped a lot :-D</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
