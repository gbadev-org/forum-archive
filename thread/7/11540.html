<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Fixed Point Math? Maybe? Move a sprite from A to B - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>C/C++ > Fixed Point Math? Maybe? Move a sprite from A to B</h2>
<div id="posts">
<div class="post">
    <h4>#107105 - psycorpse - Thu Oct 26, 2006 5:06 pm</h4>
    <div class="postbody"><span class="postbody">I am trying to move a sprite from point A to point B in a diagonal line. Currently as a work around I move the sprite one to the left and one up or what ever direction the sprite is supposed to move in. The problem that I am having is that the direction to the left or right is shorter in distance than the the up or down movement. So it will move diagonal for about half of the way and then it moves up or down. This looks funny and doesn't go well with a card game. So if Fixed point math is what I need to do does anyone have any links to documentation on what I am trying to achieve? I have done a couple of searches on this forum however my results haven't been very successful. I found a couple of threads but nothing really helped.
<br/>
<br/>
Thanks,
<br/>
Psycorpse</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#107107 - keldon - Thu Oct 26, 2006 5:48 pm</h4>
    <div class="postbody"><span class="postbody">Use a line drawing algorithm &gt;&gt; <a href="http://en.wikipedia.org/wiki/Bresenham" target="_blank">http://en.wikipedia.org/wiki/Bresenham</a>'s_line_algorithm</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#107115 - strager - Thu Oct 26, 2006 8:16 pm</h4>
    <div class="postbody"><span class="postbody">From what I see, you are only moving in a diagonal line (or a strait line, up/down and left/right).  You'd want the diagonal movement to seem as fast as the strait movement.
<br/>
<br/>
To do this, simply divide the number of pixels moved by the square root of two.  If you want to use fixed-point for this, you could do something like:
<br/>
<br/>
(Incomplete -- gotta go somewhere...)
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define FIXSIZE (8)
<br/>
#define SQRT2FIXED (int)(.. * (1 &lt;&lt; FIXSIZE))
<br/>
<br/>
u16 pixelx = .. &lt;&lt; FIXSIZE, pixely ... &lt;&lt; FIXSIZE;
<br/>
<br/>
// move
<br/>
if(diagonal) {
<br/>
pixelx += SQRT2FIXED;
<br/>
pixely += SQRT2FIXED;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Something like that...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#107124 - psycorpse - Thu Oct 26, 2006 10:10 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>strager wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
(Incomplete -- gotta go somewhere...)
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define FIXSIZE (8)
<br/>
#define SQRT2FIXED (int)(.. * (1 &lt;&lt; FIXSIZE))
<br/>
<br/>
u16 pixelx = .. &lt;&lt; FIXSIZE, pixely ... &lt;&lt; FIXSIZE;
<br/>
<br/>
// move
<br/>
if(diagonal) {
<br/>
pixelx += SQRT2FIXED;
<br/>
pixely += SQRT2FIXED;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
<br/>
What does the .. and ... stand for in .. &lt;&lt; FIXSIZE, ... &lt;&lt; FIXSIZE and in the define?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#107137 - strager - Fri Oct 27, 2006 12:51 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>psycorpse wrote:</b></span></td> </tr> <tr> <td class="quote">What does the .. and ... stand for in .. &lt;&lt; FIXSIZE, ... &lt;&lt; FIXSIZE and in the define?</td> </tr></table><span class="postbody">
<br/>
<br/>
Here's some code better explaining what to do:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define FIXSIZE (8)
<br/>
// Should be pre-calculated by your compiler.
<br/>
#define SQRT2FIXED (int)(1.414213562373095048801688724209698078569671875376948073176679737990 * (1 &lt;&lt; FIXSIZE))
<br/>
<br/>
void move(u16 *px, u16 *py, direction dir, int amount) {
<br/>
<br/>
// Move the sprite
<br/>
if(direction == diagonal_downright) {
<br/>
    *px += SQRT2FIXED * amount;
<br/>
    *py += SQRT2FIXED * amount;
<br/>
}
<br/>
else if(dir == up) {
<br/>
    *py -= amount &lt;&lt; FIXSIZE;
<br/>
}
<br/>
else // ...
<br/>
// ...
<br/>
}
<br/>
<br/>
// To get pixel coords from fixed coords, do:
<br/>
pixelx = px &gt;&gt; FIXSIZE;
<br/>
pixely = px &gt;&gt; FIXSIZE;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
... Or something like that.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
