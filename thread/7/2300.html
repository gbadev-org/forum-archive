<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>request for member `...' in something not a structu - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>C/C++ > request for member `...' in something not a structu</h2>
<div id="posts">
<div class="post">
    <h4>#12206 - RaBBi - Mon Nov 03, 2003 10:33 pm</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
Few days ago, I wrote a topic about cut-scenes management (not initially but it changed to it after discussion with Gopher, that I thank ^^, and others).
<br/>
<br/>
Then I started to wrote a system.
<br/>
This needs structs like the following.
<br/>
<br/>
One which stores the datas corresponding to the event type.
<br/>
One which stores the event itself.
<br/>
The first is used in a union inside the second.
<br/>
<br/>
You see it next :
<br/>
(typedefs.h file)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
typedef union UEventData {
<br/>
    struct TEventPrintf
<br/>
       {
<br/>
       
<br/>
           u8 startX, startY, timePause, vitesse;
<br/>
            const char *Fmt;
<br/>
<br/>
       } TEventPrintf;
<br/>
       
<br/>
       // some other structs
<br/>
<br/>
} UEventData;
<br/>
<br/>
typedef struct TEvent
<br/>
{
<br/>
    // donn?es communes :
<br/>
    // liste des events qui doivent etre ? true pour que l'?venement s'enclenche
<br/>
    // 5 maxi
<br/>
    u8 eventsTrueArray[5];
<br/>
    
<br/>
    // 1 indicateur de l'activit? de l'event
<br/>
    bool eventActive;
<br/>
    
<br/>
    // 1 indicateur de la terminaison de l'event
<br/>
    // il est mis ? TRUE quand la fonction renvoie TRUE
<br/>
    bool eventDone;
<br/>
<br/>
    // 1 union qui contient des structures EventType
<br/>
    struct TEventType {
<br/>
       
<br/>
            // donn?es propres ? l'event :
<br/>
            // elles seront transmises/utilis?es par la fonction associ?e
<br/>
            UEventData EventData;
<br/>
            
<br/>
            // un pointeur vers la fonction utilis?e par
<br/>
            // cet ?venement
<br/>
            // celle-ci doit renvoyer un bool
<br/>
            bool (*EventFunc)(UEventData *Data, ...);
<br/>
<br/>
    } TEventType;
<br/>
    
<br/>
 } TEvent;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Then I use a text function (for a dialog event).
<br/>
So the (*EventFunc) is pointing on it.
<br/>
(texts.c file)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
bool m_printf_Event(UEventData *Data, ...)
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
But when I compile, an error message says :
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
request for member `TEventPrintf' in something not a structure or union</td> </tr></table><span class="postbody">
<br/>
<br/>
When I try to use :
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
Data.TEventPrintf.Fmt
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
for example.
<br/>
<br/>
I precise that typedefs.h is included well by the texts.c file.<br/>_________________<br/>Sorry for my poor english, but it would be worst for you to understand me if I speak in my native language, French ^^</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12207 - spooo - Mon Nov 03, 2003 10:49 pm</h4>
    <div class="postbody"><span class="postbody">&gt; Data.TEventPrintf.Fmt 
<br/>
<br/>
You may try (Data-&gt;TEventPrintf).Fmt instead.
<br/>
<br/>
(You try to access data like if it was a union/structure, but Data is a pointer, that's the error message's meaning).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12208 - RaBBi - Mon Nov 03, 2003 11:15 pm</h4>
    <div class="postbody"><span class="postbody">Thank you !
<br/>
<br/>
it works now ^^
<br/>
<br/>
But I've got another problem now, a warning.
<br/>
<br/>
It deals with the text function.
<br/>
In fact, the original version of this function takes a string with format, like vprintf for example.
<br/>
<br/>
That's the prototype of this previous version :
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
bool m_printf(u8 startX, u8 startY, u8 timePause, u8 vitesse, const char *Fmt, ...)
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
you see the last one parameter, Fmt, is used like this :
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
...
<br/>
va_list ap;
<br/>
<br/>
        // D'abord affiche le texte format?
<br/>
        va_start ( ap, Fmt);
<br/>
        vsprintf(Buff, Fmt, ap);
<br/>
        va_end(ap);
<br/>
...
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
But with the new function I use in this event management, this parameter is stored into a struct UEventData.
<br/>
And I pass the struct to the new function.
<br/>
So I get a warning on this line :
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
va_start ( ap, Data.TEventPrintf.Fmt);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
It says me :
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
warning: second parameter of `va_start' not last named argument
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I was prepared to this type of warning.
<br/>
But for now, I cannot resolve it.
<br/>
<br/>
My purpose is to be able to store string and its format into UEventData structure.
<br/>
In order to do :
<br/>
<br/>
textFunction(UEventData_struct);
<br/>
<br/>
like I'll do :
<br/>
<br/>
textFunction(x,x,x,"this is my demo number %d", demoNumber);<br/>_________________<br/>Sorry for my poor english, but it would be worst for you to understand me if I speak in my native language, French ^^</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12219 - Gopher - Tue Nov 04, 2003 8:01 am</h4>
    <div class="postbody"><span class="postbody">I don't use the "..." variable parameter syntax much, so I can't speak very confidently here. But, I don't see why you need to pass the string Fmt to va_start.
<br/>
<br/>
In the first example
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
  va_start ( ap, Fmt); 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
you passed Fmt not because va_start actually uses the string, but because it was the last explicit parameter. So in your new example, where the parameter "char* Fmt" has been replaced with "UEventData Data", you don't need to pass Data.TEventPrintf.Fmt, but just Data.
<br/>
<br/>
If I'm wrong, someone correct me, as I said the "..." is not something I've used often.<br/>_________________<br/>"Only two things are infinite: the universe, and human stupidity. The first is debatable." -Albert Einstein</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12230 - RaBBi - Tue Nov 04, 2003 8:59 pm</h4>
    <div class="postbody"><span class="postbody">Yes you're right.
<br/>
<br/>
I didn't need to pass [...].Fmt, to specify the last fixed parameter, in fact I cannot.
<br/>
Cause the last fixed parameter is the whole struct Data.
<br/>
<br/>
So, with reflexion and your advice, I just did that :
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
va_start ( ap, Data);
<br/>
vsprintf(Buff, (Data-&gt;TEventPrintf).Fmt, ap);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
And it works ^^
<br/>
<br/>
But now, I would be able to store string and format is the UEventData.
<br/>
This means, store "you have %d victories and %d defeats", vicTotal, defTotal 
<br/>
But in the structure.<br/>_________________<br/>Sorry for my poor english, but it would be worst for you to understand me if I speak in my native language, French ^^</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12259 - Gopher - Wed Nov 05, 2003 9:29 pm</h4>
    <div class="postbody"><span class="postbody">If you want to store the variable-length array of parameters in a structure, there's only two options I can see.
<br/>
<br/>
One is to have a fixed-length array of void pointers to the parameters, with the length being set to the maximum number of parameters you may have in any case. 
<br/>
<br/>
The other is to use a dynamic allocation to hold them, either something like a linked list or a dynamic array of pointers.
<br/>
<br/>
Either approach could work, but both are fairly expensive; myself, it seems like a level of 'convenience programming' I generally avoid on GBA. By that I mean it doesn't really make the program better, it just makes the source easier to modify/extend, but without proper optimization the price may be high.<br/>_________________<br/>"Only two things are infinite: the universe, and human stupidity. The first is debatable." -Albert Einstein</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12345 - MumblyJoe - Sat Nov 08, 2003 2:17 pm</h4>
    <div class="postbody"><span class="postbody">Any chance of getting that code with english comments? Just curious...<br/>_________________<br/><a class="postlink" href="http://www.hungrydeveloper.com" target="_blank">www.hungrydeveloper.com</a>
<br/>
Version 2.0 now up - guaranteed at least 100% more pleasing!</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
