<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>GBA adaptation of x86 program - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>C/C++ > GBA adaptation of x86 program</h2>
<div id="posts">
<div class="post">
    <h4>#19311 - gbanoob - Sat Apr 17, 2004 12:18 am</h4>
    <div class="postbody"><span class="postbody">Hi !
<br/>
<br/>
I'm really new on GBA(for 3 days lol), so I don't really know how hardware works.
<br/>
I'm trying to make an adaptation of a C++ x86 prog on GBA. (it works fine on x86 ;) )
<br/>
All the compilation process works fine with devkitadv-r5-b3.
<br/>
But when I'm testing my code on an gba emulator(mappy), when I try to create an c++ object, the emulator restarts my code from the beginning (maybe there is a general error and the gba reboot)
<br/>
In the main code I use a 5k const array.
<br/>
In the oject there is a 65k array, and some malloc, memcpy, string from STL and base code nothing more.
<br/>
Could it be a memory problem ?
<br/>
I had try to debug it with mappy but when I'm loading the .elf mappy crashs ...
<br/>
<br/>
thanks in advance.
<br/>
<br/>
ps:sorry for my bad english ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19312 - Lord Graga - Sat Apr 17, 2004 1:02 am</h4>
    <div class="postbody"><span class="postbody">are you using any windows/linux targetted libaries?
<br/>
<br/>
GBA has a totally different layout and way of acting than x86, so you'll have to port it over....</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19313 - gbanoob - Sat Apr 17, 2004 1:22 am</h4>
    <div class="postbody"><span class="postbody">No I don't use any targetted libraries.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19315 - sajiimori - Sat Apr 17, 2004 4:18 am</h4>
    <div class="postbody"><span class="postbody">Have you tried writing some smaller test apps in C++?  Perhaps you can narrow it down to something more specific.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19316 - DekuTree64 - Sat Apr 17, 2004 4:46 am</h4>
    <div class="postbody"><span class="postbody">Is the 65K array in RAM, or is it const too? If RAM, you'll need to make sure it goes into EWRAM some way or another, because IWRAM is only 32K, and that's where variables go by default.
<br/>
To put it in EWRAM, you can either use an __attribute (don't remember the exact syntax), or put it there in code, by using EWRAM like a large stack, just initializing a pointer to the top of it (0x2040000) and subtracting 65K from that, and replace the array with a pointer which you then set to your EWRAM pointer. Then you can subtract more from the main pointer later and use that for more storage space, and add them back when you're done with them. That's exactly how the 'real' stack works too.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19318 - sajiimori - Sat Apr 17, 2004 5:15 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   for(i=0; i &lt; 7; i++)
<br/>
   {
<br/>
      for(b=0; b &lt; Mem_Length; b++)
<br/>
      {
<br/>
         if(Data[b] &amp; (1 &lt;&lt; i ))
<br/>
            channels[i] |= 1 &lt;&lt; ((Mem_Length - 1) - b);
<br/>
      }
<br/>
   }
<br/>
</td> </tr></table><span class="postbody">
<br/>
If Mem_Length is greater than 32, you're shifting off the edge of the 32-bit long.  Try long long for 64 bits (if your compiler supports it), or use a custom structure.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19332 - gbanoob - Sat Apr 17, 2004 4:19 pm</h4>
    <div class="postbody"><span class="postbody">Ah yes thanks so much, it was the too small IWRAM ;)
<br/>
<br/>
Hum but if I need more memory than IWRAM+EWRAM, there is a space where I can put my other datas ?
<br/>
<br/>
** edited **
<br/>
hum I found this :
<br/>
<a href="http://www.ziegler.desaign.de/GBA/gba.htm#GBA%20memory%20map" target="_blank">http://www.ziegler.desaign.de/GBA/gba.htm#GBA%20memory%20map</a>
<br/>
It seems except in ROM there is no more space ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19340 - Miked0801 - Sat Apr 17, 2004 7:02 pm</h4>
    <div class="postbody"><span class="postbody">Welcome to handheld RAM concerns.  The GBC/DMG was even worse :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19342 - tepples - Sat Apr 17, 2004 7:05 pm</h4>
    <div class="postbody"><span class="postbody">If you have data that won't change, it's best to make it <span style="font-weight: bold">const</span>. The popular linker scripts will put <span style="font-weight: bold">const</span> data in ROM if you're making a cartridge-based program. If you need to store more non-<span style="font-weight: bold">const</span> state than the capacity of IWRAM + EWRAM + those parts of VRAM you aren't using for video, then consider developing for Palm or Pocket PC rather than for GBA.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19345 - sajiimori - Sat Apr 17, 2004 7:11 pm</h4>
    <div class="postbody"><span class="postbody">Oops, my earlier post was to the wrong thread!! lol</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19348 - gbanoob - Sat Apr 17, 2004 7:26 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"> then consider developing for Palm or Pocket PC rather than for GBA.</td> </tr></table><span class="postbody">
<br/>
Lol, you are malicious with me tepples. Sure that, like me, you understand that is why dev on GBA may be fun.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19354 - tepples - Sat Apr 17, 2004 8:33 pm</h4>
    <div class="postbody"><span class="postbody">What arrays do you need to store that take more than 256 KB (capacity of EWRAM)?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19362 - gbanoob - Sat Apr 17, 2004 11:14 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">What arrays do you need to store that take more than 256 KB (capacity of EWRAM)?</td> </tr></table><span class="postbody">
<br/>
<br/>
Actually I don't need more, it was just a question ....</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
