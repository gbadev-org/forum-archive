<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>reading parts of a file? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>C/C++ > reading parts of a file?</h2>
<div id="posts">
<div class="post">
    <h4>#135737 - spinal_cord - Wed Jul 25, 2007 11:28 pm</h4>
    <div class="postbody"><span class="postbody">I'm trying to find info on reading only part of a file, not the whole thing, and not from the beginning. So how would I read say a 10 byte chunck from around 30 bytes into a file, without having to read the first 30 bytes before it?
<br/>
<br/>
doesn't matter, fseek() was what i was looking for.<br/>_________________<br/>I'm not a boring person, it's just that boring things keep happening to me.
<br/>
<a class="postlink" href="http://spinal.dizidesigns.co.uk/" target="_blank">Homepage</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135742 - Dwedit - Wed Jul 25, 2007 11:55 pm</h4>
    <div class="postbody"><span class="postbody">Looks like you got your post edited just as I was going to post "Fseek is your friend"<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135749 - spinal_cord - Thu Jul 26, 2007 12:18 am</h4>
    <div class="postbody"><span class="postbody">although i seem not to be fread()ing properly...<br/>_________________<br/>I'm not a boring person, it's just that boring things keep happening to me.
<br/>
<a class="postlink" href="http://spinal.dizidesigns.co.uk/" target="_blank">Homepage</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135915 - spinal_cord - Fri Jul 27, 2007 12:53 pm</h4>
    <div class="postbody"><span class="postbody">Can someone tell me what I'm doing wrong here?
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void readheader(const char *filename)
<br/>
{
<br/>
 int offset=0x068;  //0x068
<br/>
   FILE* testRead = fopen (filename, "rb"); //rb = read
<br/>
   u16 *filetext=0; // 32bit int? (4 bytes)
<br/>
   fseek(testRead,0x068,SEEK_SET);
<br/>
   fread(&amp;filetext, sizeof(filetext), 2, testRead);
<br/>
   fclose(testRead);
<br/>
   PA_OutputText(0,1,1, "%d", &amp;filetext);  
<br/>
}   
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
filetext seems to always be 184564612.<br/>_________________<br/>I'm not a boring person, it's just that boring things keep happening to me.
<br/>
<a class="postlink" href="http://spinal.dizidesigns.co.uk/" target="_blank">Homepage</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135917 - Diddl - Fri Jul 27, 2007 1:12 pm</h4>
    <div class="postbody"><span class="postbody">first I'm not sure if mode "rb" works in this case.
<br/>
<br/>
then you use a pointer to NULL as a buffer for fread()?? you read in a pointer from this file?
<br/>
<br/>
next problem is you read in 2 items of length sizeof(filetext). you only have defined one item??
<br/>
<br/>
the output always prints the address of your variable (filetext). surely it is always same address ...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135919 - spinal_cord - Fri Jul 27, 2007 1:31 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void readheader(const char *filename)
<br/>
{
<br/>
   FILE* testRead = fopen (filename, "r");
<br/>
   u32 filetext; // 32bit int? (4 bytes)
<br/>
   fseek(testRead,0x068,SEEK_SET);
<br/>
   fread(&amp;filetext, sizeof(filetext), 1, testRead);
<br/>
   fclose(testRead);
<br/>
   PA_OutputText(0,1,1, "%d", filetext); 
<br/>
}   
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Is that better?
<br/>
I have never tried to read only part of a file before.<br/>_________________<br/>I'm not a boring person, it's just that boring things keep happening to me.
<br/>
<a class="postlink" href="http://spinal.dizidesigns.co.uk/" target="_blank">Homepage</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135942 - Miked0801 - Fri Jul 27, 2007 6:39 pm</h4>
    <div class="postbody"><span class="postbody">You do need the 'rb' for a binary read.  The default in text mode which is not what you want.  Here's how I think it would work.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void readheader(const char *filename) 
<br/>
{
<br/>
    FILE *testRead;
<br/>
    u32  fileInt;
<br/>
 
<br/>
    if(fopen(filename, "rb") == NULL)
<br/>
    {
<br/>
        // File could not be opened, report error and exit
<br/>
        return;
<br/>
    }
<br/>
<br/>
    fseek(testRead, 0x068, SEEK_SET)
<br/>
    fread(&amp;fileInt, sizeof(filetext), 1, testRead);
<br/>
    fclose(testRead);
<br/>
    PA_OutputText(0,1,1, "%d", fileInt);
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
The above code should read 4 bytes from offset 0x68 bytes from the beginning of the file and place it in fileInt, close the file, then display the result.  If your fopen fails (always needs to be checked), your passing in a garbage file string.
<br/>
<br/>
Also, I'd double check the file length to make sure I wasn't reading off the end of the file.  ftell() will give you the current file position.  Combine that with a seek_end (or whatever the heck the correct seek from back command is) to get that size and compare against 0x068.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135943 - Lick - Fri Jul 27, 2007 6:54 pm</h4>
    <div class="postbody"><span class="postbody">Miked, you don't seem to assign the handle returned by  fopen().
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void readheader(const char *filename) {
<br/>
    u32 word = 0;
<br/>
    FILE *handle = fopen(filename, "rb");
<br/>
 
<br/>
    if (handle) {
<br/>
        fseek(handle, 0x68, SEEK_SET);
<br/>
        fread(&amp;word, sizeof(u32), 1, handle);
<br/>
        fclose(handle);
<br/>
    }
<br/>
<br/>
    PA_OutputText(0,1,1, "%d", word);
<br/>
} </td> </tr></table><span class="postbody"><br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135949 - spinal_cord - Fri Jul 27, 2007 8:10 pm</h4>
    <div class="postbody"><span class="postbody">Thanks guys. I'm never going to get the hang of C.<br/>_________________<br/>I'm not a boring person, it's just that boring things keep happening to me.
<br/>
<a class="postlink" href="http://spinal.dizidesigns.co.uk/" target="_blank">Homepage</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135981 - sgeos - Sat Jul 28, 2007 5:42 am</h4>
    <div class="postbody"><span class="postbody">Languages like perl and ruby are much better than C at text processing.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#136009 - tepples - Sat Jul 28, 2007 2:23 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sgeos wrote:</b></span></td> </tr> <tr> <td class="quote">Languages like perl and ruby are much better than C at text processing.</td> </tr></table><span class="postbody">
<br/>
You are correct that the standard libraries of languages such as Perl, Ruby, and Python have richer text processing than libc. But does Perl, Ruby, or Python run on a GBA or even a DS? Or are you talking about precompiling data files on a PC, turning some input format into .s to be assembled and linked into a C program?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#136062 - Miked0801 - Sat Jul 28, 2007 8:39 pm</h4>
    <div class="postbody"><span class="postbody">Doh - good catch.  It's been a few years since I had to write fopen code.  Good catch...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#136095 - sgeos - Sun Jul 29, 2007 1:35 am</h4>
    <div class="postbody"><span class="postbody">Precompile if you can, muck around with C's lexical manipulation facilities if you must.
<br/>
<br/>
<span style="font-weight: bold">EDIT:</span> <a class="postlink" href="http://www.ddj.com/184404797" target="_blank">regex++</a> looks like a nice library that can be used with C or C++.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#136130 - kusma - Sun Jul 29, 2007 3:19 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">But does Perl, Ruby, or Python run on a GBA or even a DS?</td> </tr></table><span class="postbody">
<br/>
<a class="postlink" href="http://www.disinterest.org/NDS/Python25.html" target="_blank">Yes.</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#136138 - dantheman - Sun Jul 29, 2007 4:53 pm</h4>
    <div class="postbody"><span class="postbody">There's also a port of MicroPerl to DSLinux.  I've used it in the past to run a Perl script that wrapped text files to the character width you specify for use with Moonshell (before it did word wrapping automatically).</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
