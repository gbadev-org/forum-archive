<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>typedef struct question. - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>C/C++ > typedef struct question.</h2>
<div id="posts">
<div class="post">
    <h4>#167510 - intel3 - Mon Mar 16, 2009 11:15 am</h4>
    <div class="postbody"><span class="postbody">I am new to c++ programming, here is a basic question I have
<br/>
<br/>
my struct:
<br/>
<br/>
typedef struct {
<br/>
    s32 radius;
<br/>
	Mysprite sprites[30];
<br/>
}ImageInfo;
<br/>
<br/>
<br/>
Can I declare the size of the Mysprite array dynamically whenever I create a new ImageInfo stuct pointer?
<br/>
<br/>
If so how...
<br/>
<br/>
<br/>
Thanks</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167511 - sgeos - Mon Mar 16, 2009 11:24 am</h4>
    <div class="postbody"><span class="postbody">Use a constructor that takes the size of the array you need.  Allocate that much memory dynamically and clean up in the destructor.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167512 - intel3 - Mon Mar 16, 2009 11:46 am</h4>
    <div class="postbody"><span class="postbody">Thanks for the quick replay
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sgeos wrote:</b></span></td> </tr> <tr> <td class="quote">Use a constructor that takes the size of the array you need.  Allocate that much memory dynamically and clean up in the destructor.</td> </tr></table><span class="postbody">
<br/>
<br/>
I am not sure what to do here is what I think.
<br/>
Create a Image.cpp like below
<br/>
<br/>
<br/>
#include &lt;nds.h&gt;
<br/>
#include "Mysprite.h"
<br/>
<br/>
ImageInfo * info;
<br/>
<br/>
Image::Image(u8 size) {
<br/>
	ImageInfo * info = new ImageInfo();
<br/>
	info -&gt; sprites[size];
<br/>
}
<br/>
<br/>
Image::~Image() {
<br/>
	//destory
<br/>
}
<br/>
<br/>
Image::getInfo(){
<br/>
	return info;
<br/>
}
<br/>
<br/>
So when i want to get the pointer reference in the main function it would be
<br/>
<br/>
Image test = new Image(5);
<br/>
ImageInfo * info = test.getInfo();
<br/>
<br/>
Previous I was thinking to use it like
<br/>
<br/>
ImageInfo * image = new ImageInfo();
<br/>
	image-&gt;radius = 3;
<br/>
<br/>
So the different is instead of getting a pointer to the typedef struct, now i wrap the struct inside a class constructor and then use function call to get that struct.
<br/>
<br/>
Is this correct?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167514 - Miked0801 - Mon Mar 16, 2009 4:23 pm</h4>
    <div class="postbody"><span class="postbody">No.  More like this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
struct // or public class, which I'd use as this is no longer a POD
<br/>
{
<br/>
    s32 radius;
<br/>
    Mysprite *sprites;
<br/>
}
<br/>
<br/>
Image::Image(int size)
<br/>
{
<br/>
    radius = kDefaultValueForRadius;
<br/>
    sprites = new Mysprite[size];    
<br/>
}
<br/>
<br/>
Image::~Image()
<br/>
{
<br/>
    delete[] sprites;
<br/>
}
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Then the next step is:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
class Image
<br/>
{
<br/>
public:
<br/>
    Image(int size);
<br/>
    ~Image(){delete[] sprites;}
<br/>
<br/>
    Mysprite *getSpritePtr(int index);
<br/>
    int radius(){return mRadius;}
<br/>
<br/>
private:
<br/>
    Mysprite *sprites;
<br/>
    int mSpriteArraySize;
<br/>
    int mRadius;
<br/>
}
<br/>
<br/>
Image::Image(int size)
<br/>
{
<br/>
    mSpriteArraySize = size;
<br/>
    radius = kDefaultValueForRadius;
<br/>
    sprites = new Mysprite[size];    
<br/>
}
<br/>
<br/>
<br/>
Mysprite *Image::getSpritePtr(int index)
<br/>
{
<br/>
    assert(sprites != null);
<br/>
    assert(index &lt; mMaxSpriteIndex);
<br/>
    return sprites[index];
<br/>
}
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Which then begs the question of why we aren't using a Vector&lt;Mysprite&gt; to handle dynamic allocation/deallocation for us in the first place as it has all the safety checks and more.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167519 - albinofrenchy - Mon Mar 16, 2009 10:21 pm</h4>
    <div class="postbody"><span class="postbody">Might be something you know already, but C++ treats structs different than C treats them. They become C++ classes. 
<br/>
<br/>
I agree with Miked0801; It is worth while to learn the STL classes. They are quite handy and documentation on them is  everywhere. I've never run into any performance issues, but I doubt they carry massive amounts of overhead. I will say though, that if the number of sprites in the struct will NEVER change after you create the class, go ahead and make it an array.
<br/>
<br/>
Also make sure you delete the thing instead of free it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167520 - Miked0801 - Mon Mar 16, 2009 11:58 pm</h4>
    <div class="postbody"><span class="postbody">Yep.  struct = public default class.  I had that in my original post, but it got lost somewhere in the editing :)
<br/>
<br/>
The reason I was suggesting the class was because he moved away from a POD as soon as he needed a constructor.
<br/>
<br/>
And there is a valid argument for using Vector&lt;&gt; even with a fixed size given the extra bounds/error checking it gives.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167522 - albinofrenchy - Tue Mar 17, 2009 6:39 am</h4>
    <div class="postbody"><span class="postbody">Does it really give extra bounds checking? Is that only with the at() function and not the [] operator?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167523 - elyk1212 - Tue Mar 17, 2009 7:55 am</h4>
    <div class="postbody"><span class="postbody">As far as I know, the #at function provides the checks (throws exception), while [] opp assumes you know what you're doing.
<br/>
<br/>
<a href="http://www.cplusplus.com/reference/stl/vector/operator%5B%5D.html" target="_blank">http://www.cplusplus.com/reference/stl/vector/operator%5B%5D.html</a>
<br/>
<br/>
You'd run into the same issue with iterators I'm fairly certain.
<br/>
<br/>
BTW, as far as I can tell (at least within DevkitArm??) I could not link in STL containers etc, for GBA.  So... I guess in that case maybe you could consider rolling your own or something.... ?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167534 - Miked0801 - Tue Mar 17, 2009 5:26 pm</h4>
    <div class="postbody"><span class="postbody">Or use vector for the added future flexibility :)
<br/>
<br/>
Or just use arrays and assert the bounds.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167585 - albinofrenchy - Thu Mar 19, 2009 6:10 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">BTW, as far as I can tell (at least within DevkitArm??) I could not link in STL containers etc, for GBA. So... I guess in that case maybe you could consider rolling your own or something.... ?</td> </tr></table><span class="postbody">
<br/>
<br/>
Really? I'm using STL stuff with no problem in devkitarm for DS stuff, I don't know why it would work on ds and not the gba.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167586 - elyk1212 - Thu Mar 19, 2009 7:09 am</h4>
    <div class="postbody"><span class="postbody">Yeah, I don't really know either.  I just assumed it was a resource limitation, and maybe someone forcefully undefined symbols that would cause an issue (such as parts of STL?).  
<br/>
<br/>
Here's a small example of what I get:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
//*****************************************************************
<br/>
<br/>
int main()
<br/>
{   
<br/>
<br/>
    vector&lt;int&gt; test;
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Notice...
<br/>
<span style="font-weight: bold">-I/home/kyle2/Development/Games/Gameboy/devkitARM/devkitARM/include/c++/4.1.1</span>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
arm-eabi-g++ -MMD -MP -MF /home/kyle2/Desktop/GBASvn/build/main.d -g -Wall -O3 -mcpu=arm7tdmi -mtune=arm7tdmi -fomit-frame-pointer -ffast-math -mthumb -mthumb-interwork -I/home/kyle2/Desktop/GBASvn/"include" -I/home/kyle2/Desktop/GBASvn/build -I/home/kyle2/Desktop/GBASvn/sound -I/home/kyle2/Desktop/GBASvn/Maps/test/ -I/home/kyle2/Development/Games/Multi_System_Compilers/DevikitPro/libgba/include -I/home/kyle2/Development/Games/Multi_System_Compilers/DevikitPro/Krawall//include -I/home/kyle2/Desktop/GBASvn/build -I/home/kyle2/Development/Games/Gameboy/devkitARM/devkitARM/include/c++/4.1.1  -fno-rtti -fno-exceptions -fno-rtti -c /home/kyle2/Desktop/GBASvn/source/main.cpp -o main.o
<br/>
/home/kyle2/Desktop/GBASvn/source/main.cpp: In function 'void handleBallCollision(Ball*, Vector2D)':
<br/>
/home/kyle2/Desktop/GBASvn/source/main.cpp:149: warning: passing 'double' for argument 1 to 'Vector2D::Vector2D(int, int)'
<br/>
/home/kyle2/Desktop/GBASvn/source/main.cpp: In function 'void init_map_test()':
<br/>
/home/kyle2/Desktop/GBASvn/source/main.cpp:760: warning: comparison between signed and unsigned integer expressions
<br/>
/home/kyle2/Desktop/GBASvn/source/main.cpp:852: warning: unused variable 'pse'
<br/>
/home/kyle2/Desktop/GBASvn/source/main.cpp: In function 'int main()':
<br/>
/home/kyle2/Desktop/GBASvn/source/main.cpp:930: error: 'vector' was not declared in this scope
<br/>
/home/kyle2/Desktop/GBASvn/source/main.cpp:930: error: expected primary-expression before 'int'
<br/>
/home/kyle2/Desktop/GBASvn/source/main.cpp:930: error: expected `;' before 'int'
<br/>
make[1]: *** [main.o] Error 1
<br/>
make: *** [build] Error 2
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
And a ls of the following shows vector... (which is a non empty file that looks correct).
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
[kyle2@localhost GBASvn]$ ls /home/kyle2/Development/Games/Gameboy/devkitARM/devkitARM/include/c++/4.1.1
<br/>
algorithm  bitset   cfloat   cmath    cstdarg  cstring  cxxabi.h   exception_defines.h  iomanip   istream   locale  numeric  sstream    string    valarray
<br/>
arm-eabi/  cassert  ciso646  complex  cstddef  ctime    debug/     ext/                 ios       iterator  map     ostream  stack      tr1/      vector
<br/>
backward/  cctype   climits  csetjmp  cstdio   cwchar   deque      fstream              iosfwd    limits    memory  queue    stdexcept  typeinfo
<br/>
bits/      cerrno   clocale  csignal  cstdlib  cwctype  exception  functional           iostream  list      new     set      streambuf  utility
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
A cat of the vector header, gives what I would expect:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
// &lt;vector&gt; -*- C++ -*-
<br/>
<br/>
// Copyright (C) 2001, 2002, 2003 Free Software Foundation, Inc.
<br/>
//
<br/>
// This file is part of the GNU ISO C++ Library.  This library is free
<br/>
// software; you can redistribute it and/or modify it under the
<br/>
// terms of the GNU General Public License as published by the
<br/>
// Free Software Foundation; either version 2, or (at your option)
<br/>
// any later version.
<br/>
<br/>
// This library is distributed in the hope that it will be useful,
<br/>
// but WITHOUT ANY WARRANTY; without even the implied warranty of
<br/>
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
<br/>
// GNU General Public License for more details.
<br/>
<br/>
// You should have received a copy of the GNU General Public License along
<br/>
// with this library; see the file COPYING.  If not, write to the Free
<br/>
// Software Foundation, 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301,
<br/>
// USA.
<br/>
<br/>
// As a special exception, you may use this file as part of a free software
<br/>
// library without restriction.  Specifically, if other files instantiate
<br/>
// templates or use macros or inline functions from this file, or you compile
<br/>
// this file and link it with other files to produce an executable, this
<br/>
// file does not by itself cause the resulting executable to be covered by
<br/>
// the GNU General Public License.  This exception does not however
<br/>
// invalidate any other reasons why the executable file might be covered by
<br/>
// the GNU General Public License.
<br/>
<br/>
/*
<br/>
 *
<br/>
 * Copyright (c) 1994
<br/>
 * Hewlett-Packard Company
<br/>
 *
<br/>
 * Permission to use, copy, modify, distribute and sell this software
<br/>
 * and its documentation for any purpose is hereby granted without fee,
<br/>
 * provided that the above copyright notice appear in all copies and
<br/>
 * that both that copyright notice and this permission notice appear
<br/>
 * in supporting documentation.  Hewlett-Packard Company makes no
<br/>
 * representations about the suitability of this software for any
<br/>
 * purpose.  It is provided "as is" without express or implied warranty.
<br/>
 *
<br/>
 *
<br/>
 * Copyright (c) 1996
<br/>
 * Silicon Graphics Computer Systems, Inc.
<br/>
 *
<br/>
 * Permission to use, copy, modify, distribute and sell this software
<br/>
 * and its documentation for any purpose is hereby granted without fee,
<br/>
 * provided that the above copyright notice appear in all copies and
<br/>
 * that both that copyright notice and this permission notice appear
<br/>
 * in supporting documentation.  Silicon Graphics makes no
<br/>
 * representations about the suitability of this software for any
<br/>
 * purpose.  It is provided "as is" without express or implied warranty.
<br/>
 */
<br/>
<br/>
/** @file vector
<br/>
 *  This is a Standard C++ Library header.
<br/>
 */
<br/>
<br/>
#ifndef _GLIBCXX_VECTOR
<br/>
#define _GLIBCXX_VECTOR 1
<br/>
<br/>
#pragma GCC system_header
<br/>
<br/>
#include &lt;bits/functexcept.h&gt;
<br/>
#include &lt;bits/stl_algobase.h&gt;
<br/>
#include &lt;bits/allocator.h&gt;
<br/>
#include &lt;bits/stl_construct.h&gt;
<br/>
#include &lt;bits/stl_uninitialized.h&gt;
<br/>
#include &lt;bits/stl_vector.h&gt;
<br/>
#include &lt;bits/stl_bvector.h&gt; 
<br/>
<br/>
#ifndef _GLIBCXX_EXPORT_TEMPLATE
<br/>
# include &lt;bits/vector.tcc&gt;
<br/>
#endif
<br/>
<br/>
#ifdef _GLIBCXX_DEBUG
<br/>
# include &lt;debug/vector&gt;
<br/>
#endif
<br/>
<br/>
#endif /* _GLIBCXX_VECTOR */
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
Any ideas?  Anyone used STL on GBA?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167589 - albinofrenchy - Thu Mar 19, 2009 8:39 am</h4>
    <div class="postbody"><span class="postbody">I almost hate to ask this; but I assume you have the ole' "#include &lt;vector&gt;" with the ole "using namespace std" in there at the top?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167595 - elyk1212 - Thu Mar 19, 2009 3:44 pm</h4>
    <div class="postbody"><span class="postbody">Oh... you know what, Doh!   You're right.  I just pushed that example out quick to show you, and forgot the resolution operator std::vector...
<br/>
<br/>
Compiles fine :P  Just goes to show when I get something in my head, I make assumptions.
<br/>
<br/>
I swore I got a linker error in the past though, using slightly older DevkitArm release.  Maybe I am crazy :O.
<br/>
<br/>
I hadn't tried since, and since I asked the GBA_with_STL question so many times, with no clear response, I thought for sure it wouldn't work.
<br/>
<br/>
Well, that's something to try out now :)
<br/>
<br/>
Ohhhh.... priority queues and algorithms and such with no need to recreate the wheel.  Yay STL C++.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
