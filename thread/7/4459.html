<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>C++ float weirdness - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>C/C++ > C++ float weirdness</h2>
<div id="posts">
<div class="post">
    <h4>#29736 - _pluto9 - Wed Nov 24, 2004 4:59 pm</h4>
    <div class="postbody"><span class="postbody">Last night I was making a program in MSVC 6 to convert a number into scientific notation, I wrote the part for numbers where the exponent was positive first which worked fine, then I wrote the part that handes negative exponients, for some reason, I got the following output:
<br/>
<br/>
(.01) = 1 x 10 ^ 2
<br/>
(.001) = 10 x 10 ^ 2 &lt;-- the error!!!
<br/>
(.0001) = 1 x 10 ^ 4
<br/>
(.00001) = 1 x 10 ^ 5
<br/>
(.000001) = 1 x 10 ^ 6
<br/>
etc..
<br/>
<br/>
now the code I was using looked like this (n is the original number):
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">for(e=-1, d=10.0f; abs(n)*d &lt;= 0.1f; e--, d*=10.0f);</td> </tr></table><span class="postbody">
<br/>
<br/>
I isolated the error, and found that it wasn't getting the third loop (where d would be 1000.0f, and e would be -3), because (0.001 * 100.0f) &lt;= 0.1 was returning false .... ?!@#!@$!
<br/>
<br/>
I could figure for the life of me, why it was doing that, so I changed all my floats to doubles, and the problem disapeared.
<br/>
<br/>
Is this an issue with floats in general? or is it a bug in MSVC 6?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#29738 - poslundc - Wed Nov 24, 2004 5:12 pm</h4>
    <div class="postbody"><span class="postbody">It is not possible to perfectly represent the number 0.1 (and likewise 0.01, 0.001, etc.) in base-2. It is a repeating fraction, like 1/3 is when represented in base-10 (which evaluates to 0.3333...). Programs that repeatedly add or subtract numbers like 0.1 will usually accumulate a noticeable error.
<br/>
<br/>
There are more sophisticated math libraries available if you require more scientific accuracy, but the general rule for computational programming is to remember that you are always working with discrete values. If you need to check for equality with floats, you ought to define a function to do so (or overload the "==" operator) that checks if the two values are within a certain tolerance.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#29748 - _pluto9 - Wed Nov 24, 2004 6:40 pm</h4>
    <div class="postbody"><span class="postbody">I kinda understand that..
<br/>
<br/>
but in my code I wasn't doing any adding or subtracting of floats... just multiplying and dividing, so I'm guessing this goes for multiplying and dividing as well?
<br/>
<br/>
now if I did this all using fixed point math, would it illiminate these problems?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#29753 - poslundc - Wed Nov 24, 2004 7:08 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>_pluto9 wrote:</b></span></td> </tr> <tr> <td class="quote">I kinda understand that..
<br/>
<br/>
but in my code I wasn't doing any adding or subtracting of floats... just multiplying and dividing, so I'm guessing this goes for multiplying and dividing as well?</td> </tr></table><span class="postbody">
<br/>
<br/>
You get the most noticeable error from accumulation, but multiplication and division always introduce error as well.
<br/>
<br/>
Exercise: run the following program on your computer and see why your conditional of (0.001 * 100.0f) &lt;= 0.1 doesn't hold:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int main(void)
<br/>
{
<br/>
    float a = 100;
<br/>
    float b = 0.001;
<br/>
    
<br/>
    printf("%.20f\n", 0.1);
<br/>
    printf("%.20f\n", (a * b));
<br/>
<br/>
    return 0;
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">now if I did this all using fixed point math, would it illiminate these problems?</td> </tr></table><span class="postbody">
<br/>
<br/>
No, but it would possibly make you much more aware of both where and why these problems are occurring in your code.
<br/>
<br/>
I generally wouldn't recommend bothering with fixed-point if you're writing your program for a computer with an FPU. If you're writing it for the GBA, on the other hand, you should probably use exclusively fixed-point.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
