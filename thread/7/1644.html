<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Very stupid trouble - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>C/C++ > Very stupid trouble</h2>
<div id="posts">
<div class="post">
    <h4>#8365 - XeroxBoy - Wed Jul 09, 2003 4:44 am</h4>
    <div class="postbody"><span class="postbody">Previously, I've been including my external data through included .h files, and its worked fairly well. However, this generally isn't the best way to do things - recompilling takes forever. So, I've decided to switch over to GBFS, but I'm, unfortunately, having some difficulty getting it to work. I've packed my files together properly, as far as I can tell, and have appended them to my ROM. However, it doesn't seem to be working, and I'm fairly confident that it's because I'm making one or more stupid, stupid mistakes in my code. So, I'd really appreciate it if someone looked over my code and pointed out all of the flaws in it.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define REG_DM3SAD     *(u32*)0x40000D4
<br/>
#define REG_DM3DAD     *(u32*)0x40000D8
<br/>
#define REG_DM3CNT_L   *(u16*)0x40000DC
<br/>
#define REG_DM3CNT_H   *(u16*)0x40000DE
<br/>
<br/>
#define CharMem ((u16*)0x6010000)
<br/>
<br/>
const GBFS_FILE *dat = find_first_gbfs_file(find_first_gbfs_file);
<br/>
const u8 *tileset = gbfs_get_obj(dat, "tileset.dat", NULL);
<br/>
<br/>
<br/>
REG_DM3SAD = tileset;
<br/>
REG_DM3DAD = tiles0;
<br/>
REG_DM3CNT_L = 8192;
<br/>
REG_DM3CNT_H |= 0x80000000;</td> </tr></table><span class="postbody">
<br/>
<br/>
Many thanks in advance!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8366 - niltsair - Wed Jul 09, 2003 6:23 am</h4>
    <div class="postbody"><span class="postbody">You're declaring a constant pointer to receive the value of what seems to be a function, not possible.  And in your <span style="font-weight: bold">REG_DM3SAD [/b ] should receive a 32bits value that represent the address
<br/>
<br/>
Try this :
<br/>
u32 tileset = gbfs_get_obj(dat, "tileset.dat", NULL);
<br/>
<br/>
Or if [b]gbfs_get_obj</span> is a define and not a function, then :
<br/>
const u32 tileset = gbfs_get_obj(dat, "tileset.dat", NULL);</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8377 - tepples - Wed Jul 09, 2003 12:01 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>niltsair wrote:</b></span></td> </tr> <tr> <td class="quote">You're declaring a constant pointer to receive the value of what seems to be a function, not possible.</td> </tr></table><span class="postbody">
<br/>
The gbfs_get_obj() does return a pointer to constant data, and the DMA source address register does take such a pointer.
<br/>
<br/>
What I'd like to know is whether find_first_gbfs_file() is returning a NULL pointer. If find_first_gbfs_file() returns a NULL pointer, then the appending probably went wrong somehow. Perhaps you didn't pad your program to a 256-byte boundary like the GBFS docs say.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8412 - XeroxBoy - Wed Jul 09, 2003 9:00 pm</h4>
    <div class="postbody"><span class="postbody">Yes! Thank you! That was the problem (along with a few goofy little bugs in the DMA code).</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
