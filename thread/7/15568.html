<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>What's the best way to write any given .h file? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>C/C++ > What's the best way to write any given .h file?</h2>
<div id="posts">
<div class="post">
    <h4>#157288 - Polaris - Wed May 21, 2008 7:44 pm</h4>
    <div class="postbody"><span class="postbody">This was pretty clear to me, up until the moment I read a bit of TONC. Particularly the part where it says, and I quote:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"><span style="font-weight: bold">Thou shalt not #include data or code!</span></td> </tr></table><span class="postbody"> The exclamation wasn't there, but I think it deserves it :P
<br/>
<br/>
This was a pretty shaking statement, and one that made me ask myself if I have been doing things properly all along. Like a lot of people, I enjoy doing things properly.
<br/>
<br/>
This is how I would write a regular .h that might be describing a player class or an enemy class or something along the lines.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
/*include useful stuff here*/
<br/>
<br/>
/*define more stuff here*/
<br/>
<br/>
/*namespaces go here*/
<br/>
<br/>
class Thing {
<br/>
<br/>
    int positionX;
<br/>
    int positionY;
<br/>
    int velocity;
<br/>
    int direction;
<br/>
    int angle;
<br/>
    int turnSpeed;
<br/>
<br/>
    void accelerate();
<br/>
    void turnClockwise();
<br/>
    void turnCounterClockwise();
<br/>
<br/>
public:
<br/>
    Thing();
<br/>
    ~Thing();
<br/>
 
<br/>
    void Update();
<br/>
    void Draw();
<br/>
};</td> </tr></table><span class="postbody">
<br/>
Could that kind of stuff be potential trouble for medium sized projects and onwards?
<br/>
<br/>
And one more thing. I have seen this lately
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#ifndef ANY_CLASS
<br/>
#define ANY_CLASS
<br/>
/*all the necessary stuff goes here*/
<br/>
#endif</td> </tr></table><span class="postbody">
<br/>
<br/>
What's that for? Is it doing something similar to <span style="font-weight: bold">#pragma once</span>?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157291 - DekuTree64 - Wed May 21, 2008 8:27 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Polaris wrote:</b></span></td> </tr> <tr> <td class="quote">This is how I would write a regular .h that might be describing a player class or an enemy class or something along the lines.
<br/>
...
<br/>
Could that kind of stuff be potential trouble for medium sized projects and onwards?</td> </tr></table><span class="postbody">
<br/>
That's all perfectly fine. I think you're thinking of a different kind of "data" (member variable declarations).
<br/>
<br/>
The bit about #including data is referring to putting large const arrays in header files for graphical data and such, rather than using a file system or something.
<br/>
<br/>
But since you indirectly asked, there is some value in hiding member variable declarations for large projects, just so you don't have to #include so many things from header files and rebuild everything when one of them changes. For that, a common technique is the "pimpl" (private implementation) design pattern. Basically make a nested class defined in the .cpp file, and allocate it seperately:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">Thing.h:
<br/>
<br/>
class Thing {
<br/>
    class Impl;
<br/>
    Impl *impl;
<br/>
<br/>
public:
<br/>
    Thing();
<br/>
    ~Thing();
<br/>
  
<br/>
    void Update(); 
<br/>
    void Draw(); 
<br/>
};
<br/>
<br/>
<br/>
Thing.cpp:
<br/>
<br/>
class Thing::Impl {
<br/>
public:
<br/>
    int positionX; 
<br/>
    int positionY; 
<br/>
    int velocity; 
<br/>
    int direction; 
<br/>
    int angle; 
<br/>
    int turnSpeed; 
<br/>
<br/>
    void accelerate(); 
<br/>
    void turnClockwise(); 
<br/>
    void turnCounterClockwise(); 
<br/>
};
<br/>
<br/>
Thing::Thing() :
<br/>
    impl(new Impl)
<br/>
{
<br/>
}
<br/>
<br/>
Thing::~Thing()
<br/>
{
<br/>
    delete impl;
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
And lastly, yes, the #ifndef thing is just another way of preventing multiple inclusion, like #pragma once.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157292 - sajiimori - Wed May 21, 2008 8:30 pm</h4>
    <div class="postbody"><span class="postbody">Do not include "useful stuff" from within headers.  Do everything you can to minimize the number of headers you include from within headers -- try to reduce it to zero, when possible.  Nested header includes will increase your header dependencies geometrically, so that modifying one header will force much of your project to recompile.
<br/>
<br/>
Make good use of forward declarations to eliminate includes.  Choose key points to apply the pimpl idiom: it has technical costs, but when applied carefully, it can greatly reduce rebuilds without much performance loss.
<br/>
<br/>
For a zero-cost variant of pimpl, leave your data members in the header, and only move your private methods to the .cpp file.  Declare a nested class, befriend it, and change your private methods into static methods of the nested class.
<br/>
<br/>
Beyond that, just minimize the quantity of stuff in the header.  Move things to the .cpp file whenever possible.
<br/>
<br/>
Edit: Ah, Deku beat me to some of that.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157293 - silent_code - Wed May 21, 2008 8:46 pm</h4>
    <div class="postbody"><span class="postbody">being a #pragma once user for many years, some beatyful day i have come to the point, that i had to use the preprocessor guards.
<br/>
i can't remember when, where or why it was, just that it made me change that habbit i had for a long time (i'm not *exactly* a friend of changing things) and since then, i haven't used #pragma once again.
<br/>
<br/>
although "#po" is widely supported and used, it's not standard and not as flexible (yes, it's shorter) as the guards.
<br/>
<br/>
i guess my situation was something along the following: when you have a fairly complex system, that, due to (sometimes poor) design choises, needs a lot of - let's call it: "cross inludes" (think: clark kent loves loris lane, loris lane loves superman, superman is clark kent, clark kent loves...) #po may become tricky in some cases. i experienced it and i have to say, even though i can't remember why #po didn't work, it ... didn't work. :^p
<br/>
<br/>
but guards have their own set of problems: they need names, what might cause problems etc.
<br/>
<br/>
in the end, you have to try it yourself. weather you prefer one approach over the other is a matter of taste *and* how you use it in the end.
<br/>
or just use both.
<br/>
<br/>
happy coding! :^D
<br/>
<br/>
ps: i have just found a wikipedia (is it called:) <a class="postlink" href="http://en.wikipedia.org/wiki/Pragma_once" target="_blank">article</a> (?), that i want to reccommend to you. :^)<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157295 - Polaris - Wed May 21, 2008 9:05 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for the replys guys. I'll have to look into that design pattern once i'm done fiddling with my small demos.
<br/>
<br/>
When you are talking about const arrays for graphical data,  is it the same as <span style="font-weight: bold">extern</span> const array? Because I never really understood why grit generated those arrays with extern before them.
<br/>
<br/>
I guess I'll also need to look into making a file system, even if I have no idea how it works, any good tutorials on that?
<br/>
<br/>
silent_code: Using both seems like the best thing. After all, if my program is running like a turtle, I don't think it will ever be because of some include guards.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157297 - silent_code - Wed May 21, 2008 9:19 pm</h4>
    <div class="postbody"><span class="postbody">you seem like a quite new and fresh programmer, from what i read (excuse me, if i'm wrong!)
<br/>
<br/>
i wouldn't reccomend in programming your own filesystem. simply use one of the available like libfat or it's derivates, instead. ;^)
<br/>
<br/>
ps: if you declare something extern, that means the same "thing" gets linked everywhere its declaration is included, in contrast to a new "thing" (symbol) being created for each "unit" (think .cpp file), which most likely *will* cause trouble.<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157299 - Cearn - Wed May 21, 2008 9:43 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Polaris wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
When you are talking about const arrays for graphical data,  is it the same as <span style="font-weight: bold">extern</span> const array? Because I never really understood why grit generated those arrays with extern before them.
<br/>
</td> </tr></table><span class="postbody">
<br/>
`extern' anything isn't really data, it's just a sign to the compiler that something with that name is supposed to exist somewhere in the project, and says how to interact with it. For example, compare these two:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
//# (1) The declaration of `foo'
<br/>
extern const u8 foo[];
<br/>
<br/>
<br/>
//# (2) The definition of `foo'
<br/>
const u8 foo[256]= { 1, 2, 3 ... };
<br/>
</td> </tr></table><span class="postbody">
<br/>
The second item is the definition of an array called <span style="font-style: italic">foo</span>. This is where the actual content of <span style="font-style: italic">foo</span> is located. The first thing, the one with <span style="font-style: italic">extern</span> is known as a declaration. It just says that something called <span style="font-style: italic">foo</span> exists and that it's a const u8 array, but it's not where the actual data for <span style="font-style: italic">foo</span> is. The 'definition' is the real thing; the 'declaration' is just a name tag.
<br/>
<br/>
That you're required to declare variables (and functions) is just part of the language. Whenever the compiler encounters an identifier, it needs to know how to use it; whether it's a variable, or function or macro; what its type is and, for functions, what its arguments are. This method may seem annoying, but it does mean that you can catch certain errors with more ease than if it weren't the case.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157302 - Polaris - Wed May 21, 2008 10:03 pm</h4>
    <div class="postbody"><span class="postbody">Actually I am quite new to programming, but it is surprising all the things you can with just, arrays, for loops, if's and some basic concepts on OOP and design patterns. Currently I am fascinated with bitwise operations. 
<br/>
<br/>
LibFat is a file system? You don't say?! I really need to pay more attention when I read things. Because I have seen that name a lot and never made the connection.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157310 - simonjhall - Wed May 21, 2008 10:36 pm</h4>
    <div class="postbody"><span class="postbody">Back on the original question, yeah including .cpp files (ie code) is a frowned upon thing by everyone who's worth their salt. Yet the thing that bugs me is the massive amount of code that I encounter (often done by senior programmers...) that's in .inl files, included through header files.
<br/>
When you bug the person in question you always hear the same old excuses. Fun ones include "oh but it's inline - that's compiler pixie dust! there's zero cost!" etc. Love it.
<br/>
<br/>
This has the knock-on effect mentioned by sajiimori - if you include the header that includes the .inl file all over your project, every time you change some actual code (not necessarily prototypes) you've got to re-build your project, which can be a right pain in the arse!
<br/>
<br/>
Compiler pixie dust has just cost you a half-hour build ;-)
<br/>
<br/>
(can you tell I wrote the header dependency scanner/makefile builder where I work?!)<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157311 - silent_code - Wed May 21, 2008 10:36 pm</h4>
    <div class="postbody"><span class="postbody">&lt;lol&gt; ;^)
<br/>
no problem!
<br/>
libfat is not a file system itself, but it is a library that adds support for the fat file system (i guess both 16 and 32, but i don't know and i won't look it up right now ;^D ) to your program.
<br/>
there's also nitro fs, efs, gbfs and maybe others, each with a set of advantages and disadvantages.
<br/>
<br/>
usually, libfat looks like a good choise, but efs (which is one of libfat's derivates, iirc) has come to my attention, too and has a 2.0 release coming. ;^)
<br/>
<br/>
ps @ simon: i'm with you man! the horror!<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157314 - Cearn - Wed May 21, 2008 11:01 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>simonjhall wrote:</b></span></td> </tr> <tr> <td class="quote">Compiler pixie dust has just cost you a half-hour build ;-)
<br/>
</td> </tr></table><span class="postbody">
<br/>
Because somebody has to say it: <a href="http://imgs.xkcd.com/comics/compiling.png">[Images not permitted - Click here to view it]</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157316 - tepples - Wed May 21, 2008 11:34 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cearn wrote:</b></span></td> </tr> <tr> <td class="quote">compare these two:
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
//# (1) The declaration of `foo'
<br/>
extern const u8 foo[];
<br/>
<br/>
<br/>
//# (2) The definition of `foo'
<br/>
const u8 foo[256]= { 1, 2, 3 ... };
<br/>
</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
It's also fine to declare 'foo' like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">extern const u8 foo[256];
<br/>
</td> </tr></table><span class="postbody">
<br/>
This is similar to (1) above, but it lets operator sizeof work properly.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Polaris wrote:</b></span></td> </tr> <tr> <td class="quote">LibFat is a file system? You don't say?!</td> </tr></table><span class="postbody">
<br/>
See <a class="postlink" href="http://en.wikipedia.org/wiki/File_allocation_table" target="_blank">FAT@Wikipedia</a>.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cearn wrote:</b></span></td> </tr> <tr> <td class="quote"><a class="postlink" href="http://imgs.xkcd.com/comics/compiling.png" target="_blank">[xkcd panel about slacking while code is compiling]</a></td> </tr></table><span class="postbody">
<br/>
Where I work, our internal apps don't need to be "compiled" to run, but we do have to wait for batch processing to complete, either on our machines or on a business partner's machines. Sometimes I can slack off while that happens; other times I need to send it to the background and get other work done.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157324 - sajiimori - Thu May 22, 2008 12:24 am</h4>
    <div class="postbody"><span class="postbody">If you have headers including each other, you've got bigger problems than deciding between #pragma once and include guards.
<br/>
<br/>
The only reason to <span style="font-style: italic">not</span> use #pragma once is portability, though every compiler I've used supports it.  I thought our compiler at work had a broken implementation, but it turns out that it's fine as long as you don't enable it globally.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157325 - silent_code - Thu May 22, 2008 12:41 am</h4>
    <div class="postbody"><span class="postbody">@ sajiimori: ... which sounds hacky... ;^D
<br/>
but you're right, *that* should not be a *real* problem. most of the time, such "problems" simply indicate much bigger issues in one's design or project management.<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157338 - simonjhall - Thu May 22, 2008 7:47 am</h4>
    <div class="postbody"><span class="postbody">One of the targets that I write for supports pragma once (it's a gcc) yet every time it sees one it gives you a warning! And there doesn't seem to be a way to turn that warning off (bar -Wnone). So I got everyone to change their code ;-)<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
