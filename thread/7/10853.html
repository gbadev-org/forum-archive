<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>TinyC Compiler - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>C/C++ > TinyC Compiler</h2>
<div id="posts">
<div class="post">
    <h4>#98902 - Outlaw - Fri Aug 18, 2006 11:18 am</h4>
    <div class="postbody"><span class="postbody">Hi folks,
<br/>
<br/>
while searching for an small and nice to handle c compiler I have found the TinyC Compiler. This compiler is damn small and fast and compiles for Linux and Win32 - <a href="http://fabrice.bellard.free.fr/tcc/" target="_blank">http://fabrice.bellard.free.fr/tcc/</a>
<br/>
<br/>
In the documentation I found the hint that there is a project called tcc-arm which targets the ARM processors.
<br/>
<br/>
Does anybody have an idea where i can get it and if it is useful in the GBA development ?
<br/>
<br/>
Greetz
<br/>
<br/>
Outlaw
<br/>
<a href="http://www.yakuza.de.be" target="_blank">www.yakuza.de.be</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#98999 - Sausage Boy - Fri Aug 18, 2006 11:57 pm</h4>
    <div class="postbody"><span class="postbody">Do you mean actually running the compiler on the GBA? I doubt the GBA would handle that, though I havn't checked TinyC's requirements yet. Would be awesome to have a programming environment for the DS though. :P
<br/>
<br/>
Edit: Hmm, seems like it produces x86 code only, as far as I can see.<br/>_________________<br/>"no offense, but this is the gayest game ever"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#99067 - Outlaw - Sat Aug 19, 2006 12:57 pm</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
in the introduction chapter of the online-documentation there is an Arm support mentioned ..
<br/>
<br/>
<a href="http://fabrice.bellard.free.fr/tcc/tcc-doc.html#SEC1" target="_blank">http://fabrice.bellard.free.fr/tcc/tcc-doc.html#SEC1</a>
<br/>
<br/>
I'm not sure whether it runs in windows or linux and just creates ARM binaries or runs itself on ARM processors ..
<br/>
<br/>
So long
<br/>
<br/>
Outlaw
<br/>
<a href="http://www.yakuza.de.be" target="_blank">www.yakuza.de.be</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#99224 - kashiwa - Sun Aug 20, 2006 4:13 am</h4>
    <div class="postbody"><span class="postbody">edit configure file:
<br/>
- build_cross="no"
<br/>
+ build_cross="yes"
<br/>
<br/>
then you can build arm-tcc cross compiler with gcc. (I tested with gcc 3.4.2 mingw special)
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
sh configure
<br/>
make
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I thought that there is no linker or loader for arm-tcc, you must use gcc (also devkitARM) to link object files.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#99337 - Sausage Boy - Sun Aug 20, 2006 8:01 pm</h4>
    <div class="postbody"><span class="postbody">I think it's included in arm-tcc:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">SMALL! You can compile and execute C code everywhere, for example on rescue disks (about 100KB for x86 TCC executable, including C preprocessor, C compiler, assembler and <span style="font-weight: bold">linker</span>).</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
Were you able to compile anything? I get errors about missing crt's.<br/>_________________<br/>"no offense, but this is the gayest game ever"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#99568 - kashiwa - Tue Aug 22, 2006 1:41 pm</h4>
    <div class="postbody"><span class="postbody">I tested only compile... that code.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
int main(void) {
<br/>
  printf("hello world!\n");
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
arm-tcc -c hello.c -o hello.o
<br/>
arm-elf-objdump -D hello.o
<br/>
<br/>
it returns that
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
Disassembly of section .text:
<br/>
<br/>
00000000 &lt;main&gt;:
<br/>
   0:   e1a0c00d        mov     ip, sp
<br/>
   4:   e92d5800        stmdb   sp!, {fp, ip, lr}
<br/>
   8:   e1a0b00d        mov     fp, sp
<br/>
   c:   e1a00000        nop                     (mov r0,r0)
<br/>
  10:   e59f0000        ldr     r0, [pc, #0]    ; 18 &lt;main+0x18&gt;
<br/>
  14:   ea000000        b       1c &lt;main+0x1c&gt;
<br/>
  18:   00000000        andeq   r0, r0, r0
<br/>
  1c:   ebfffffe        bl      1c &lt;main+0x1c&gt;
<br/>
  20:   e3a00000        mov     r0, #0  ; 0x0
<br/>
  24:   e1a00000        nop                     (mov r0,r0)
<br/>
  28:   e89ba800        ldmia   fp, {fp, sp, pc}
<br/>
Disassembly of section .data:
<br/>
<br/>
00000000 &lt;L.0&gt;:
<br/>
   0:   6c6c6568        cfstr64vs       mvdx6, [ip], #-416
<br/>
   4:   6f77206f        swivs   0x0077206f
<br/>
   8:   21646c72        cmncs   r4, r2, ror ip
<br/>
        ...
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I have been satisfied seeing the elf format obj generated.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#99572 - chishm - Tue Aug 22, 2006 2:18 pm</h4>
    <div class="postbody"><span class="postbody">That is some ugly, ugly code. Data placed in the middle of executable sections and multiple unneeded nops make me think that compilers that do an add and subtract immediately after each other on the same register with constant data are doing a good job.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#99614 - sajiimori - Tue Aug 22, 2006 6:33 pm</h4>
    <div class="postbody"><span class="postbody">Be sure to test something other than main() because many compilers insert extra unconditional code (that is not subject to optimization) inside that function, so it often looks really bad.
<br/>
<br/>
Of course, I'm not claiming that TCC will do any better -- maybe it's always that bad!  ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#99690 - Outlaw - Wed Aug 23, 2006 10:08 am</h4>
    <div class="postbody"><span class="postbody">Hi folks,
<br/>
<br/>
I'm a little bit confused .. did you find the arm-tcc package and could you use it ?
<br/>
<br/>
Btw. its easier to find a small C cross compiler for old homecomputers like ATARI800 than for the GBA. Sure, there is the almighty GCC for all platforms - but its not my way. If I had BeOS I could cross compile with ARM-LCC - isn't that funny :-)
<br/>
<br/>
I hope the tcc-arm project will help .. till than i write some stuff for 6502 processors with my neat cc65 Cross Compiler :-)
<br/>
<br/>
So long
<br/>
<br/>
Outlaw
<br/>
<a href="http://www.yakuza.de.be" target="_blank">www.yakuza.de.be</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#99734 - sajiimori - Wed Aug 23, 2006 5:25 pm</h4>
    <div class="postbody"><span class="postbody">LCC works on Win32.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#99831 - kashiwa - Thu Aug 24, 2006 4:33 am</h4>
    <div class="postbody"><span class="postbody">I tried to build my old project with TCC according to the advice of sajimori.
<br/>
Here is the bins and srcs. (including TCC 0.9.23 binary)
<br/>
<a class="postlink" href="http://www.liarsoft.org/data/La_tcc.zip" target="_blank">http://www.liarsoft.org/data/La_tcc.zip</a>
<br/>
<br/>
I found some tips about arm-tcc.
<br/>
<br/>
1. TCC supports gas-like inline assembly (wow!), but ARM assembly seems to be not yet. I got error.
<br/>
2. supports __attribute__((section)) but long_call isn't too.
<br/>
3. The constants arranged by section ".data". To place in ROM, I wrote __attribute__((section (".rodata")))　instead of const.
<br/>
4. signed char (not char) gets 0-255...
<br/>
5. There is no crt0/ldscripts suitable for ARM, I used DevkitARM's.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#99855 - Outlaw - Thu Aug 24, 2006 9:48 am</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">LCC works on Win32.</td> </tr></table><span class="postbody">
<br/>
<br/>
it's right - there is a LCC-<span style="font-weight: bold">version</span> called LCC32 which targets Win32 and runs on Win32 Systems. <a href="http://www.cs.virginia.edu/~lcc-win32/" target="_blank">http://www.cs.virginia.edu/~lcc-win32/</a>
<br/>
<br/>
LCC itself is a multiplatform C Compiler which runs on a variety of hosts, but I don't now any project which uses LCC as CrossCompiler that runs in Win32 and targets ARM
<br/>
<a href="http://www.cs.princeton.edu/software/lcc/" target="_blank">http://www.cs.princeton.edu/software/lcc/</a>
<br/>
<br/>
As I mentioned, for BeOS there is an ARM-LCC version
<br/>
<a href="http://www.bebits.com/app/1501" target="_blank">http://www.bebits.com/app/1501</a>
<br/>
<br/>
@kashiwa: sounds great .. I'll give it a try. 
<br/>
<br/>
So long
<br/>
<br/>
Outlaw
<br/>
<a href="http://www.yakuza.de.be" target="_blank">www.yakuza.de.be</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#99867 - kashiwa - Thu Aug 24, 2006 12:25 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Outlaw wrote:</b></span></td> </tr> <tr> <td class="quote">As I mentioned, for BeOS there is an ARM-LCC version
<br/>
<a href="http://www.bebits.com/app/1501" target="_blank">http://www.bebits.com/app/1501</a>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
tell me why you don't click 'home page' button on that page. OTL</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#99872 - Outlaw - Thu Aug 24, 2006 1:42 pm</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>kashiwa wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
tell me why you don't click 'home page' button on that page. OTL</td> </tr></table><span class="postbody">
<br/>
<br/>
???</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#99909 - sajiimori - Thu Aug 24, 2006 6:52 pm</h4>
    <div class="postbody"><span class="postbody">Outlaw, LCC is open source.  If you can't find a binary that runs on Win32 and targets ARM, you can build one.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#99941 - tepples - Thu Aug 24, 2006 9:07 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">Outlaw, LCC is open source.  If you can't find a binary that runs on Win32 and targets ARM, you can build one.</td> </tr></table><span class="postbody">
<br/>
LCC is not open source; its license has a "non-commercial" clause. If you have advertisements on a site from which you distribute LCC or programs linked with LCC's libraries, that might be considered selling LCC. If you resell a memory card containing LCC or programs linked with LCC's libraries, that might be considered selling LCC.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#99963 - sajiimori - Thu Aug 24, 2006 10:49 pm</h4>
    <div class="postbody"><span class="postbody">By "open source," I mean the source code is available.  I understand there are other meanings of the term, but I find them muddled as a result of propaganda from Richard Stallman and others.
<br/>
<br/>
<a class="postlink" href="http://www.cs.princeton.edu/software/lcc/cgi-bin/ls.cgi?dir=../3.6&amp;title=lcc%203.6%20source%20code" target="_blank">http://www.cs.princeton.edu/software/lcc/cgi-bin/ls.cgi?dir=../3.6&amp;title=lcc%203.6%20source%20code</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100001 - Outlaw - Fri Aug 25, 2006 9:18 am</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">Outlaw, LCC is open source.  If you can't find a binary that runs on Win32 and targets ARM, you can build one.</td> </tr></table><span class="postbody">
<br/>
<br/>
you're right .. but I never handled pojects like building Compilers or other big tasks; I have absolutely no idea what to take care of .. my prefered programming language was always assembly language - no IDE's, no make-files, no "projects" .. simply, clean software stuff .. 
<br/>
<br/>
If someone like kashiwa has experiences how to manage, it would be nice if that people do that for the community ;-)
<br/>
<br/>
Btw. I installed the HAMDevKit .. is there any way how to shrink the executables ? I guess that 130 kb (!) for a small memory-register-test without using special libs is just to big ..
<br/>
<br/>
So long
<br/>
<br/>
Outlaw
<br/>
<a href="http://www.yakuza.de.be" target="_blank">www.yakuza.de.be</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100029 - sajiimori - Fri Aug 25, 2006 4:54 pm</h4>
    <div class="postbody"><span class="postbody">Well if you avoid anything you've never done, how will you learn new things?  ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100350 - Outlaw - Sun Aug 27, 2006 2:33 pm</h4>
    <div class="postbody"><span class="postbody">Hi guys,
<br/>
<br/>
so, after playing around for a while with HAM first I was disappointed about the great binary size.
<br/>
<br/>
But I found a way that is suitable to get minimized binarys:
<br/>
<br/>
just let HAM or GCC do the compilation. Take the assembly file and let it GoldRoad - the great GBA Assembler - compile.
<br/>
<br/>
The result: from a 32kb binary created by HAM (with everything stripped out) I got a running binary through GoldRoad with 56 Bytes ! Great job !
<br/>
<br/>
Of course this way is only acceptable (and only works ?!) with single-File projects without using any Libs brought to you by HAM or other people.
<br/>
<br/>
But my intention is to create some nifty demos/intros and I felt no longer like coding in assembly (just see the source of my simple Firecube) - its a torture to care about simple things like variables or structures ... that's why my interest for the smart TinyC compiler - all I needed was just a "assembly like" higher language. The rest especially adressing the registers, writing algorithms I'll do old-school like myself.
<br/>
<br/>
I'll tell you how far the GoldRoad Trick will work with my next project ..
<br/>
<br/>
So long
<br/>
<br/>
Outlaw
<br/>
<a href="http://www.yakuza.de.be" target="_blank">www.yakuza.de.be</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100363 - sajiimori - Sun Aug 27, 2006 3:54 pm</h4>
    <div class="postbody"><span class="postbody">HAM is not a compiler.
<br/>
<br/>
The thing to realize is that the gcc command is a front-end for cpp (the preprocessor), cc1 (the compiler), as (the assembler), and ld (the linker).
<br/>
<br/>
You have as much control as you <span style="font-style: italic">take</span> over your projects.  If you don't want to link in certain libraries, don't.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100511 - Outlaw - Mon Aug 28, 2006 11:30 am</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">HAM is not a compiler.
<br/>
<br/>
The thing to realize is that the gcc command is a front-end for cpp (the preprocessor), cc1 (the compiler), as (the assembler), and ld (the linker).
<br/>
<br/>
You have as much control as you <span style="font-style: italic">take</span> over your projects.  If you don't want to link in certain libraries, don't.</td> </tr></table><span class="postbody">
<br/>
<br/>
You're right, no question and I realized it ;)
<br/>
<br/>
If you can, show me a binary created by all that "GCC" stuff  that is shorter than - lets say - 10 kb (unpacked) .. I guess as experienced with other Compilers / Linkers that this won't work. The only Compiler I know for example in Win32 is LCC32 that can handle this job .. I don't have any idea why this seems to be a hard task for Compilers to strip - everything - that isn't needed ..
<br/>
<br/>
So long
<br/>
<br/>
Outlaw
<br/>
<a href="http://www.yakuza.de.be" target="_blank">www.yakuza.de.be</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100512 - gmiller - Mon Aug 28, 2006 11:42 am</h4>
    <div class="postbody"><span class="postbody">Just remember that compilers by default do not do full optimization so you need to turn on their optimizations with command line options.  Their are also command line options for the link phase to optimize the output.  Not that these steps automaticly do a great job but without them you optimization efforts require more work.  You can tell the gcc compiler to keep all of it's work files so you can see all of the generated assembly.  Looking at these files can help you do a better job at the C/C++ coding if you know ARM assembly.  Every compiler has a different level of paranoia so the generated code from your source will reflex that.  Pointer aliasing, type limiting, loop type and register optimization can impact the generated code.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100523 - Outlaw - Mon Aug 28, 2006 12:55 pm</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>gmiller wrote:</b></span></td> </tr> <tr> <td class="quote">Just remember that compilers by default do not do full optimization so you need to turn on their optimizations with command line options.  Their are also command line options for the link phase to optimize the output.  Not that these steps automaticly do a great job but without them you optimization efforts require more work.  You can tell the gcc compiler to keep all of it's work files so you can see all of the generated assembly.  Looking at these files can help you do a better job at the C/C++ coding if you know ARM assembly.</td> </tr></table><span class="postbody">
<br/>
<br/>
I know - and I tried all official command line parameters that were given by --help. And as I mentioned before I took the generated asm file and passed it through GoldRoad-Assembler which created the expected small binary (there where only 20 lines of asm intructions). But "GCC" (or ld) created 39kb .. sure, "GCC" isn't the only DevKit that works that way; in earlier times Borland C or WatCom C (but not Turbo C!) or the pascal compilers created comparable big size binaries. I have no experiences in Linker/compiler creation so I can only guess its just the price for flexibility ..
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>gmiller wrote:</b></span></td> </tr> <tr> <td class="quote">Every compiler has a different level of paranoia so the generated code from your source will reflex that.  Pointer aliasing, type limiting, loop type and register optimization can impact the generated code.</td> </tr></table><span class="postbody">
<br/>
<br/>
I don't think so .. my mentioned example demonstrates that this can't be the reason .. the generated assembly-file just took 20 Lines of ARM instructions; the .c-source was around 6 lines. Goldroad just linked it to 56 bytes, ld to 39 kb ... the overhead is mysterious ..
<br/>
<br/>
Btw - to pass the .S-Files to goldroad some steps are to go which I'll describe later in a short tutorial ..
<br/>
<br/>
So long
<br/>
<br/>
Outlaw
<br/>
<a href="http://www.yakuza.de.be" target="_blank">www.yakuza.de.be</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100551 - sajiimori - Mon Aug 28, 2006 5:36 pm</h4>
    <div class="postbody"><span class="postbody">Once again, Outlaw, you have as much control as you're willing to take.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
C&gt; echo void f() {} &gt; test.c
<br/>
C&gt; gcc -c test.c
<br/>
C&gt; objdump -d test.o
<br/>
<br/>
test.o:     file format pe-i386
<br/>
<br/>
Disassembly of section .text:
<br/>
<br/>
00000000 &lt;_f&gt;:
<br/>
   0:   55                      push   %ebp
<br/>
   1:   89 e5                   mov    %esp,%ebp
<br/>
   3:   5d                      pop    %ebp
<br/>
   4:   c3                      ret
<br/>
   5:   90                      nop
<br/>
   6:   90                      nop
<br/>
   7:   90                      nop
<br/>
   8:   90                      nop
<br/>
   9:   90                      nop
<br/>
   a:   90                      nop
<br/>
   b:   90                      nop
<br/>
   c:   90                      nop
<br/>
   d:   90                      nop
<br/>
   e:   90                      nop
<br/>
   f:   90                      nop
<br/>
<br/>
C&gt; objcopy -I pe-i386 -O binary test.o test.bin
<br/>
C&gt; dir test.bin
<br/>
 Volume in drive C has no label.
<br/>
 Volume Serial Number is 788D-C32A
<br/>
<br/>
 Directory of C:\DOCUME~1\saji\Desktop\test
<br/>
<br/>
08/28/2006  09:35 AM                16 test.bin
<br/>
               1 File(s)             16 bytes
<br/>
               0 Dir(s)  20,024,975,360 bytes free
<br/>
</td> </tr></table><span class="postbody">
<br/>
Note that the padding is to keep object files aligned to 16 bytes, which is important on x86.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100552 - sajiimori - Mon Aug 28, 2006 5:39 pm</h4>
    <div class="postbody"><span class="postbody">BTW, with -fomit-frame-pointer, the output is 'ret' plus padding.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100555 - wintermute - Mon Aug 28, 2006 6:26 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Outlaw wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
I don't think so .. my mentioned example demonstrates that this can't be the reason .. the generated assembly-file just took 20 Lines of ARM instructions; the .c-source was around 6 lines. Goldroad just linked it to 56 bytes, ld to 39 kb ... the overhead is mysterious ..
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
There's something seriously wrong with your build process somewhere. If Goldroad can create a 56byte binary with the same code then so can gcc.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100570 - gmiller - Mon Aug 28, 2006 8:16 pm</h4>
    <div class="postbody"><span class="postbody">I agree with wintermute ... what is the command line to gcc ?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100578 - Flood_of_SYNs - Mon Aug 28, 2006 8:40 pm</h4>
    <div class="postbody"><span class="postbody"><a href="http://linuxreviews.org/man/gcc/" target="_blank">http://linuxreviews.org/man/gcc/</a>
<br/>
<br/>
<a href="http://gcc.gnu.org/" target="_blank">http://gcc.gnu.org/</a>
<br/>
<a href="http://gcc.gnu.org/wiki" target="_blank">http://gcc.gnu.org/wiki</a><br/>_________________<br/><span style="font-weight: bold"><span style="font-size: 9px; line-height: normal"><span style="color: blue">Blue NDS v4 (FlashMe v7) - GBAMP V2 CF</span>
<br/>
?There is no shame in not knowing; the shame lies in not finding out.?
<br/>
?The church is near but the road is icy, the bar is far away but I will walk carefully?</span></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100591 - tepples - Mon Aug 28, 2006 9:46 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Outlaw wrote:</b></span></td> </tr> <tr> <td class="quote">If you can, show me a binary created by all that "GCC" stuff  that is shorter than - lets say - 10 kb (unpacked)</td> </tr></table><span class="postbody">
<br/>
<a class="postlink" href="http://www.pineight.com/ds/" target="_blank">AXE, from my DS page</a>. In fact, that's two programs: one for ARM7 and one for ARM9, concatenated into one .nds file.
<br/>
<br/>
When linking on MinGW (GCC for Windows), if you use the <span style="font-weight: bold">-s</span> switch, hello world will be a lot smaller. The following C one-liner from someone's board signature that generates a Sierpinski triangle compiles to a 5,632 byte file on my MinGW installation:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">E:\develop&gt;type cr.c
<br/>
main(c,r) {for(r=32;r;)printf(++c&gt;31?c=!r--,"\n":c&lt;r?" ":~c&amp;r?" `":" #");}
<br/>
E:\develop&gt;gcc cr.c -s -o cr.exe
<br/>
cr.c:1:75: warning: no newline at end of file
<br/>
<br/>
E:\develop&gt;dir cr.exe
<br/>
 Volume in drive E is DEDODEDO
<br/>
 Volume Serial Number is 09D6-3A1F
<br/>
<br/>
 Directory of E:\develop
<br/>
<br/>
08/28/2006  04:49p               5,632 cr.exe
<br/>
               1 File(s)          5,632 bytes
<br/>
               0 Dir(s)   5,566,922,752 bytes free
<br/>
<br/>
E:\develop&gt;</td> </tr></table><span class="postbody"><br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100595 - gmiller - Mon Aug 28, 2006 9:59 pm</h4>
    <div class="postbody"><span class="postbody">Of course that command line uses no optimization at all adding -O2 or -O3 would be better plus a few more.  But it depends on the goal .. you can optimize for space or speed and generally not for both but each compiler is different.  gcc is not the best, nor the worst.  It compiles for LOTS of platforms but is not really targeted for a specific one.  The lexial analyizer and other code stuff is generic the code generation and optimizations are targeted at particular platforms.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100625 - sajiimori - Tue Aug 29, 2006 12:09 am</h4>
    <div class="postbody"><span class="postbody">Also, most of those 5,632 bytes for the one-liner are overhead from the .exe format.  On my system, the raw binary compiles down to 119 bytes (which is padded to 128).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100629 - Flood_of_SYNs - Tue Aug 29, 2006 12:28 am</h4>
    <div class="postbody"><span class="postbody">Mainly for X86 Linux ELF binaries.
<br/>
<br/>
<a href="http://muppetlabs.com/~breadbox/software/tiny/teensy.html" target="_blank">http://muppetlabs.com/~breadbox/software/tiny/teensy.html</a><br/>_________________<br/><span style="font-weight: bold"><span style="font-size: 9px; line-height: normal"><span style="color: blue">Blue NDS v4 (FlashMe v7) - GBAMP V2 CF</span>
<br/>
?There is no shame in not knowing; the shame lies in not finding out.?
<br/>
?The church is near but the road is icy, the bar is far away but I will walk carefully?</span></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100750 - Outlaw - Wed Aug 30, 2006 8:37 am</h4>
    <div class="postbody"><span class="postbody">Hi folks,
<br/>
<br/>
okay .. you're right. It's almost a question of passing the right commandline options to the different stages of the compiling process. 
<br/>
After seaching for a short time I found the "real" C Parser CC1.exe somewhere hidden in lib-gcc directory of the HAM distribution.
<br/>
<br/>
It does a great job of optimisation of the code ! 
<br/>
I checked the .asm-source with and without the -Os parameter.
<br/>
Without optimisation it creates the same (ugly) code as TinyC Compiler does. But with that parameter - you can't do better when coding in assembly language ! Especially the usage of the conditional postfixes for all ARM instructions reduces size of the source.
<br/>
<br/>
But I didnt get into the linking process. Using the ld for the linking process (after as ;) didnt create a running GBA binary .  Perhaps someone could show me the commandline options for that task.
<br/>
<br/>
(Btw. If some of you think, stripping the binary with objcopy and telling its only 110 Bytes would solve the problem or show, that ld can produce binarys smaller than 1kb .. guys, I didn't want the smallest "binary" itself, I wanted the smallest RUNNING binary .. the stripped out objectcode won't run 'cause there is no entry point defined (it's only needless when only having the main() function) ! GBA binarys start with a branch instruction (followed by the GBA-Header), that you won't find inside the created objcode)
<br/>
<br/>
So long
<br/>
<br/>
Outlaw
<br/>
<a href="http://www.yakuza.de.be" target="_blank">www.yakuza.de.be</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100796 - sajiimori - Wed Aug 30, 2006 5:07 pm</h4>
    <div class="postbody"><span class="postbody">But Outlaw, you can run any code you want on a system without an OS.  The hardware begins execution at some address -- you can drop whatever opcodes you want there and it'll be executed, entry points be damned!  :)
<br/>
<br/>
The GBA doesn't know or care what you named your functions.  The idea of "main" as an entry point is only mandated by the startup code that's linked in by default (typically called "crt0") which jumps to main at the end.  Crt0 contains the actual code that's placed at the hard-coded address where the hardware begins execution.
<br/>
<br/>
But these are just conventions.  Since you want to do away with all this silly "crt0" stuff, you're free to drop in any raw opcodes you please... including stripped object files.
<br/>
<br/>
Edit: This is all notwithstanding hardware copy protection or signing mechanisms.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100883 - Outlaw - Thu Aug 31, 2006 10:45 am</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">But Outlaw, you can run any code you want on a system without an OS.  The hardware begins execution at some address -- you can drop whatever opcodes you want there and it'll be executed, entry points be damned!  :) ..
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
That is not an answer/statement to my post.
<br/>
<br/>
I said - if you just strip the objcode you won't get a running binary.
<br/>
<br/>
See that example:
<br/>
<br/>
first the simple C source (just for testing purpose, doesnt make any sense ;-)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">unsigned long testvar[100];
<br/>
<br/>
void test()
<br/>
{
<br/>
   int t,t1;
<br/>
   *(unsigned long*)(unsigned long)0x06000000=(unsigned long)0;
<br/>
   testvar[10]=20;
<br/>
   t=testvar[10];
<br/>
   t1=28475;
<br/>
   if (t&gt;t1) { t=t1+t*3; } else { t1=t*3;test(); }
<br/>
}   
<br/>
<br/>
int main(void)
<br/>
{
<br/>
   *(unsigned long*)(unsigned long)0x06000000=(unsigned long)0;
<br/>
   test();
<br/>
   while(1)
<br/>
   { }
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Now the generated objcode - disassembled with objdump
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
test.obj:     file format elf32-littlearm
<br/>
<br/>
Disassembly of section .text:
<br/>
<br/>
00000000 &lt;test&gt;:
<br/>
   0:   mov   r2, #0   ; 0x0
<br/>
   4:   mov   r3, #100663296   ; 0x6000000
<br/>
   8:   str   r2, [r3]
<br/>
   c:   ldr   r3, [pc, #8]   ; 1c &lt;test+0x1c&gt;
<br/>
  10:   mov   r2, #20   ; 0x14
<br/>
  14:   str   r2, [r3, #40]
<br/>
  18:   b   0 &lt;test&gt;
<br/>
  1c:   andeq   r0, r0, r0
<br/>
<br/>
00000020 &lt;main&gt;:
<br/>
  20:   mov   r12, sp
<br/>
  24:   mov   r2, #0   ; 0x0
<br/>
  28:   mov   r3, #100663296   ; 0x6000000
<br/>
  2c:   stmdb   sp!, {r11, r12, lr, pc}
<br/>
  30:   sub   r11, r12, #4   ; 0x4
<br/>
  34:   str   r2, [r3]
<br/>
  38:   bl   0 &lt;test&gt;
<br/>
  3c:   b   3c &lt;main+0x1c&gt;
<br/>
Disassembly of section .data:
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Now you see what I mean - branch addresses must be fixed to start - 0x0800000. But most important - if you run that objcode it starts in first line (with mov r2,#0), cause you have no "entry point". 
<br/>
The "entry point" has to be created by a branch instruction in the first line - and thats the Structure of GBA Roms 'cause after that you must have a ROM-Header.
<br/>
<br/>
So long
<br/>
<br/>
Outlaw
<br/>
<a href="http://www.yakuza.de.be" target="_blank">www.yakuza.de.be</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100907 - sajiimori - Thu Aug 31, 2006 5:29 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">unsigned long testvar[100];
<br/>
<br/>
void test();
<br/>
<br/>
int main(void)
<br/>
{
<br/>
   *(unsigned long*)(unsigned long)0x06000000=(unsigned long)0;
<br/>
   test();
<br/>
   while(1)
<br/>
   { }
<br/>
}
<br/>
<br/>
void test()
<br/>
{
<br/>
   int t,t1;
<br/>
   *(unsigned long*)(unsigned long)0x06000000=(unsigned long)0;
<br/>
   testvar[10]=20;
<br/>
   t=testvar[10];
<br/>
   t1=28475;
<br/>
   if (t&gt;t1) { t=t1+t*3; } else { t1=t*3;test(); }
<br/>
}</td> </tr></table><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">C&gt; gcc -c test.c
<br/>
C&gt; objcopy --change-addresses 0x08000000 test.o test_adjusted.o
<br/>
C&gt; objdump -d test_adjusted.o
<br/>
<br/>
test_adjusted.o:     file format pe-i386
<br/>
<br/>
Disassembly of section .text:
<br/>
<br/>
08000000 &lt;_main&gt;:
<br/>
 8000000:   55                      push   %ebp
<br/>
 8000001:   89 e5                   mov    %esp,%ebp
<br/>
 8000003:   83 ec 08                sub    $0x8,%esp
<br/>
 8000006:   83 e4 f0                and    $0xfffffff0,%esp
<br/>
 8000009:   b8 00 00 00 00          mov    $0x0,%eax
<br/>
 800000e:   83 c0 0f                add    $0xf,%eax
<br/>
 8000011:   83 c0 0f                add    $0xf,%eax
<br/>
 8000014:   c1 e8 04                shr    $0x4,%eax
<br/>
 8000017:   c1 e0 04                shl    $0x4,%eax
<br/>
 800001a:   89 45 fc                mov    %eax,0xfffffffc(%ebp)
<br/>
 800001d:   8b 45 fc                mov    0xfffffffc(%ebp),%eax
<br/>
 8000020:   e8 00 00 00 00          call   8000025 &lt;_main+0x25&gt;
<br/>
 8000025:   e8 00 00 00 00          call   800002a &lt;_main+0x2a&gt;
<br/>
 800002a:   c7 05 00 00 00 06 00    movl   $0x0,0x6000000
<br/>
 8000031:   00 00 00 
<br/>
 8000034:   e8 02 00 00 00          call   800003b &lt;_test&gt;
<br/>
 8000039:   eb fe                   jmp    8000039 &lt;_main+0x39&gt;
<br/>
<br/>
0800003b &lt;_test&gt;:
<br/>
 800003b:   55                      push   %ebp
<br/>
 800003c:   89 e5                   mov    %esp,%ebp
<br/>
 800003e:   83 ec 08                sub    $0x8,%esp
<br/>
 8000041:   c7 05 00 00 00 06 00    movl   $0x0,0x6000000
<br/>
 8000048:   00 00 00 
<br/>
 800004b:   c7 05 28 00 00 00 14    movl   $0x14,0x28
<br/>
 8000052:   00 00 00 
<br/>
 8000055:   a1 28 00 00 00          mov    0x28,%eax
<br/>
 800005a:   89 45 fc                mov    %eax,0xfffffffc(%ebp)
<br/>
 800005d:   c7 45 f8 3b 6f 00 00    movl   $0x6f3b,0xfffffff8(%ebp)
<br/>
 8000064:   8b 45 fc                mov    0xfffffffc(%ebp),%eax
<br/>
 8000067:   3b 45 f8                cmp    0xfffffff8(%ebp),%eax
<br/>
 800006a:   7e 13                   jle    800007f &lt;_test+0x44&gt;
<br/>
 800006c:   8b 45 fc                mov    0xfffffffc(%ebp),%eax
<br/>
 800006f:   89 c2                   mov    %eax,%edx
<br/>
 8000071:   01 d2                   add    %edx,%edx
<br/>
 8000073:   01 c2                   add    %eax,%edx
<br/>
 8000075:   89 d0                   mov    %edx,%eax
<br/>
 8000077:   03 45 f8                add    0xfffffff8(%ebp),%eax
<br/>
 800007a:   89 45 fc                mov    %eax,0xfffffffc(%ebp)
<br/>
 800007d:   eb 12                   jmp    8000091 &lt;_test+0x56&gt;
<br/>
 800007f:   8b 45 fc                mov    0xfffffffc(%ebp),%eax
<br/>
 8000082:   89 c2                   mov    %eax,%edx
<br/>
 8000084:   01 d2                   add    %edx,%edx
<br/>
 8000086:   8d 04 02                lea    (%edx,%eax,1),%eax
<br/>
 8000089:   89 45 f8                mov    %eax,0xfffffff8(%ebp)
<br/>
 800008c:   e8 aa ff ff ff          call   800003b &lt;_test&gt;
<br/>
 8000091:   c9                      leave  
<br/>
 8000092:   c3                      ret    
<br/>
 8000093:   90                      nop    
<br/>
 8000094:   90                      nop    
<br/>
 8000095:   90                      nop    
<br/>
 8000096:   90                      nop    
<br/>
 8000097:   90                      nop    
<br/>
 8000098:   90                      nop    
<br/>
 8000099:   90                      nop    
<br/>
 800009a:   90                      nop    
<br/>
 800009b:   90                      nop    
<br/>
 800009c:   90                      nop    
<br/>
 800009d:   90                      nop    
<br/>
 800009e:   90                      nop    
<br/>
 800009f:   90                      nop    
<br/>
<br/>
C&gt; objcopy -I pe-i386 -O binary test_adjusted.o test.bin</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100925 - tepples - Thu Aug 31, 2006 9:42 pm</h4>
    <div class="postbody"><span class="postbody"><ol type="1"><li>Please use arm-eabi-*, not your native tools. </li><li>Unlike on the NES, the Game Boy Advance includes the 192-byte header into ROM space. Executable code starts at 0x080000<span style="font-weight: bold">c0</span>, after the header, not 0x080000<span style="font-weight: bold">00</span>. </li></ol><br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100931 - sajiimori - Thu Aug 31, 2006 10:12 pm</h4>
    <div class="postbody"><span class="postbody">Adjust my example accordingly.  If anyone wants to try it, also remember to move the data section to RAM instead of 0x00000000.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100948 - wintermute - Fri Sep 01, 2006 12:02 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include &lt;gba.h&gt;
<br/>
<br/>
//---------------------------------------------------------------------------------
<br/>
// Program entry point
<br/>
//---------------------------------------------------------------------------------
<br/>
int main(void) {
<br/>
//---------------------------------------------------------------------------------
<br/>
<br/>
   SetMode(MODE_0 | BG0_ON);
<br/>
<br/>
   BG_PALETTE[0] = RGB5(31,0,31);
<br/>
<br/>
   while (1);
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Using devkitARM and libgba with standard template makefile results in a 904 byte rom image. This could be made smaller using -nostartfiles, -nostdlib and a custom crt0 but it's probably not really worth the effort if you plan on more complex applications.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
