<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>error with global objects - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>C/C++ > error with global objects</h2>
<div id="posts">
<div class="post">
    <h4>#168859 - vuurrobin - Sun May 31, 2009 4:56 pm</h4>
    <div class="postbody"><span class="postbody">hello everybody
<br/>
<br/>
I had a problem with some code. after a while I figured out how to solve it, but I dont understand why it would solve the problem, or why it was wrong in the first place. 
<br/>
<br/>
I created a global object of a (template) class, and initialised it by putting '()' right after the objects name. after that I tried to create a temporarily object by using '=', but the compiler gave me an 'error: invalid initialization of reference of type 'BooleanArray16&amp;' from expression of type 'BooleanArray16 ()()''. if I remove the '()' from the global object decleration, the error go's away. why? AFAIK, both with and without the '()' it should call the standard constructor, so why does it make a difference?
<br/>
<br/>
here is the code if anyone wants to see it:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">typedef unsigned int uint;
<br/>
<br/>
typedef unsigned char       u8;
<br/>
typedef unsigned short int  u16;
<br/>
typedef unsigned long int   u32;
<br/>
typedef signed char         s8;
<br/>
typedef signed short int    s16;
<br/>
typedef signed long int     s32;
<br/>
<br/>
<br/>
//#define BIT(x) (1 &lt;&lt; (x))
<br/>
<br/>
inline int BIT(int x)
<br/>
{
<br/>
    return 1&lt;&lt;x;
<br/>
}
<br/>
<br/>
<br/>
/**
<br/>
    @brief a class for creating a static(with a fixed length) boolean array.
<br/>
*/
<br/>
template &lt;typename T&gt;
<br/>
class BooleanArray
<br/>
{
<br/>
    private:
<br/>
        //a user defined variable, the bits of the variable will be used as an array of booleans
<br/>
        T array;
<br/>
<br/>
    public:
<br/>
        /**
<br/>
            @brief creates the array and fills the booleans with false
<br/>
        */
<br/>
        BooleanArray() : array(0)
<br/>
        {}
<br/>
<br/>
        /**
<br/>
            @brief returns the value at the given index
<br/>
<br/>
            @param index the index you want to get
<br/>
<br/>
            @return the value at the given index
<br/>
        */
<br/>
        bool get(const uint index) const
<br/>
        {
<br/>
            //sassert(index &lt; (sizeof(T) * 8), "BooleanArray get() index out of bounds");
<br/>
<br/>
            return ((array &amp; BIT(index)) != 0);
<br/>
        }
<br/>
<br/>
        /**
<br/>
            @brief sets the given value at the given index
<br/>
<br/>
            @param index the index of the array that you want to change
<br/>
            @param value the value that the array at position index should become
<br/>
        */
<br/>
        void set(const uint index, const bool value)
<br/>
        {
<br/>
            //sassert(index &lt; (sizeof(T) * 8), "BooleanArray set() index out of bounds");
<br/>
<br/>
            if(value)
<br/>
            {
<br/>
                //sets the bit at index to 1
<br/>
                array |= BIT(index);
<br/>
            }
<br/>
            else
<br/>
            {
<br/>
                //sets the bit at index to 0
<br/>
                array &amp;= ~BIT(index);
<br/>
            }
<br/>
        }
<br/>
<br/>
};//end class BooleanArray
<br/>
<br/>
/** @brief an typedef for the BooleanArray with the size already filled in */
<br/>
typedef BooleanArray&lt;u8&gt; BooleanArray8;
<br/>
/** @brief an typedef for the BooleanArray with the size already filled in */
<br/>
typedef BooleanArray&lt;u16&gt; BooleanArray16;
<br/>
/** @brief an typedef for the BooleanArray with the size already filled in */
<br/>
typedef BooleanArray&lt;u32&gt; BooleanArray32;
<br/>
<br/>
<br/>
<br/>
BooleanArray16 test();// = BooleanArray16();
<br/>
BooleanArray16 test2();
<br/>
<br/>
int main()
<br/>
{
<br/>
    register BooleanArray16&amp; temp = test;
<br/>
<br/>
    temp = test2;
<br/>
<br/>
    return 0;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
also, do you think this is a good way of implementing a boolean array or are there better ways?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168860 - Tyler24 - Mon Jun 01, 2009 2:05 am</h4>
    <div class="postbody"><span class="postbody">I'm confused as to why you think it's supposed to be BooleanArray()()... I've never seen ()() before. What would it mean, if it could mean something?
<br/>
<br/>
I'm not all too familiar with C/C++ syntax, but wouldn't you want something like:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">BooleanArray *boolArray = new BooleanArray();</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168863 - gauauu - Mon Jun 01, 2009 2:53 am</h4>
    <div class="postbody"><span class="postbody">My C++ isn't really that strong, so somebody smart should correct me if I misspeak.  That being said, there are (at least) two ways to allocate an object:
<br/>
<br/>
First, using new and a pointer:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">BooleanArray *boolArray = new BooleanArray();</td> </tr></table><span class="postbody">
<br/>
<br/>
Second, just declaring the object:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">BooleanArray boolArray;</td> </tr></table><span class="postbody">
<br/>
<br/>
This second way generally puts the object on the stack instead of in the heap (if you do it within a function).  Doing it for a global, I believe, will put it in the heap.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168864 - Dwedit - Mon Jun 01, 2009 3:07 am</h4>
    <div class="postbody"><span class="postbody">Globals aren't actually in the heap, they go in the BSS section.
<br/>
So the class instance for a variable sized array is sitting in the BSS section (probably in IWRAM/DTCM), and the DATA for the variable sized array is in the heap.
<br/>
<br/>
I think you might be declaring 'test' as a function that takes in no parameters.  Take the parenthesis off the variable names, put them back on the end of the default constructor class name.
<br/>
<br/>
like "BooleanArray16 test = BooleanArray16(); "<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168869 - vuurrobin - Mon Jun 01, 2009 12:00 pm</h4>
    <div class="postbody"><span class="postbody">wow, never realised that it looked so much like a function decleration.
<br/>
<br/>
thank everybody :).</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
