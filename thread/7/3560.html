<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Help me with float! I want to wrap a float value.... - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>C/C++ > Help me with float! I want to wrap a float value....</h2>
<div id="posts">
<div class="post">
    <h4>#22128 - LOst? - Sun Jun 13, 2004 7:48 pm</h4>
    <div class="postbody"><span class="postbody">This is illegal:
<br/>
<br/>
float fU;
<br/>
<br/>
fU %= 1.0f
<br/>
<br/>
<br/>
<br/>
And using AND is impossible &gt;.&lt;
<br/>
<br/>
How do I wrap a float value between 0.0 and 1.0 depending on what the value was from the beginning?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22131 - tepples - Sun Jun 13, 2004 8:31 pm</h4>
    <div class="postbody"><span class="postbody">First of all, consider learning fixed-point math very soon.
<br/>
<br/>
Second, look up frac().<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22134 - LOst? - Sun Jun 13, 2004 8:35 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">First of all, consider learning fixed-point math very soon.
<br/>
<br/>
Second, look up frac().</td> </tr></table><span class="postbody">
<br/>
<br/>
What is frac() ?
<br/>
<br/>
I can't find any info on it...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22135 - tepples - Sun Jun 13, 2004 8:38 pm</h4>
    <div class="postbody"><span class="postbody">oops, my bad. It was part of a library I use. Try x - floor(x).<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22137 - LOst? - Sun Jun 13, 2004 8:42 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">oops, my bad. It was part of a library I use. Try x - floor(x).</td> </tr></table><span class="postbody">
<br/>
<br/>
Yea thanks!!!! That helped!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22138 - f(DarkAngel) - Sun Jun 13, 2004 8:48 pm</h4>
    <div class="postbody"><span class="postbody">You can also use fU-(int)fu (compiler should convert 2nd value to float, explictly, it should be (float)(int)fu), which should be faster than floor() version.<br/>_________________<br/>death scream...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22139 - LOst? - Sun Jun 13, 2004 8:56 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>f(DarkAngel) wrote:</b></span></td> </tr> <tr> <td class="quote">You can also use fU-(int)fu (compiler should convert 2nd value to float, explictly, it should be (float)(int)fu), which should be faster than floor() version.</td> </tr></table><span class="postbody">
<br/>
<br/>
Yea, but floor is better since it is designed to do floor. INT will convert it, and that's maybe not working on different systems (with different float sizes)?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22145 - tepples - Sun Jun 13, 2004 9:26 pm</h4>
    <div class="postbody"><span class="postbody">Casting to int will also depend on the rounding mode you have set.
<br/>
<br/>
Is this for a PC-side tool?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22146 - poslundc - Sun Jun 13, 2004 9:27 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>LOst? wrote:</b></span></td> </tr> <tr> <td class="quote">Yea, but floor is better since it is designed to do floor.</td> </tr></table><span class="postbody">
<br/>
<br/>
That's a naive way of looking at it...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">INT will convert it, and that's maybe not working on different systems (with different float sizes)?</td> </tr></table><span class="postbody">
<br/>
<br/>
IEEE floats are all 32 bits, all using the same representation.
<br/>
<br/>
Truthfully I don't know whether the floor() algorithm is faster than a float-&gt;int-&gt;float conversion when done purely in software, as would be the case on the GBA. On FPU-based hardware I expect the typecasting technique (notwithstanding any rounding mode, which isn't something I've had to deal with) would be faster since it involves two primitive instructions to the FPU.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22147 - LOst? - Sun Jun 13, 2004 9:33 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>LOst? wrote:</b></span></td> </tr> <tr> <td class="quote">Yea, but floor is better since it is designed to do floor.</td> </tr></table><span class="postbody">
<br/>
<br/>
That's a naive way of looking at it...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">INT will convert it, and that's maybe not working on different systems (with different float sizes)?</td> </tr></table><span class="postbody">
<br/>
<br/>
IEEE floats are all 32 bits, all using the same representation.
<br/>
<br/>
Truthfully I don't know whether the floor() algorithm is faster than a float-&gt;int-&gt;float conversion when done purely in software, as would be the case on the GBA. On FPU-based hardware I expect the typecasting technique (notwithstanding any rounding mode, which isn't something I've had to deal with) would be faster since it involves two primitive instructions to the FPU.
<br/>
<br/>
Dan.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
So you say that casting to INT is better than using floor?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22152 - poslundc - Sun Jun 13, 2004 10:22 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>LOst? wrote:</b></span></td> </tr> <tr> <td class="quote">So you say that casting to INT is better than using floor?</td> </tr></table><span class="postbody">
<br/>
<br/>
On a machine that has an FPU? I'd expect it to be at least the same speed or faster, depending on the implementation of floor().
<br/>
<br/>
On the GBA? Harder to say. Either way will be bad, and you shouldn't be using floats on the GBA to begin with.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22159 - FPChris - Mon Jun 14, 2004 12:30 am</h4>
    <div class="postbody"><span class="postbody">I'm new to the GBA. I known fixed math and why floats would be
<br/>
bad on the GBA.
<br/>
<br/>
However, do you guys use floats on the GBA to build your fixed lookups
<br/>
or do you build your tables externally then bring them in?
<br/>
<br/>
What would be the harm of useing floats on the GBA if they are not in 'gametime' code areas only in intializations etc.?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22165 - sgeos - Mon Jun 14, 2004 1:35 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>FPChris wrote:</b></span></td> </tr> <tr> <td class="quote">However, do you guys use floats on the GBA to build your fixed lookups or do you build your tables externally then bring them in?</td> </tr></table><span class="postbody">
<br/>
Generally one uses a PC side tool to calcute all the need floats.  It then spits out a list of corresponding fixed point versions of those numbers.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">What would be the harm of useing floats on the GBA if they are not in 'gametime' code areas only in intializations etc.?</td> </tr></table><span class="postbody">
<br/>
Longer initialization time.  If your tables are large, you will be trading execution time to get some extra space on the cart.  I'm not sure, but I suspect that a calculating a single value will result in longer initialization and *less* space on the cart.
<br/>
<br/>
If one uses a float, does that import a whole bunch of code to handle floats in software?
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22167 - poslundc - Mon Jun 14, 2004 2:05 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>FPChris wrote:</b></span></td> </tr> <tr> <td class="quote">However, do you guys use floats on the GBA to build your fixed lookups
<br/>
or do you build your tables externally then bring them in?</td> </tr></table><span class="postbody">
<br/>
<br/>
I concur with sgeos: I build all of my tables natively on my development machine and then load the tables directly into my program.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">What would be the harm of useing floats on the GBA if they are not in 'gametime' code areas only in intializations etc.?</td> </tr></table><span class="postbody">
<br/>
<br/>
Probably no great harm would come of it. But there is an awful lot of extra work the compiler does to afford you the convenience of floating-point numbers, so it may make your program much larger (speed isn't the only thing to optimize) and it makes your code higher-level and more abstracted from what is actually generated by the compiler, which is generally something to be wary of when you are working on an embedded system such as the GBA.
<br/>
<br/>
I am normally the first to discourage premature optimization, but it's important to realize that fixed-point math isn't an optimization in the conventional sense. I see fixed-point math as being more of a programming reality or necessity for the GBA. Once you've mastered it - which isn't very difficult to do - it is even easier than using floating-point math, and it makes it simpler for you to write and debug code. I know I can estimate the value of a 32-bit fixed-point number much easier than I can an IEEE float.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22171 - FPChris - Mon Jun 14, 2004 3:04 am</h4>
    <div class="postbody"><span class="postbody">Sounds good. I probably use float during development then
<br/>
import tables once I'm happy with the code and I settle in a bit more.
<br/>
<br/>
Thanks for the advice.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#29277 - Jau - Mon Nov 15, 2004 9:24 pm</h4>
    <div class="postbody"><span class="postbody">Where can I learn fixed-point math?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#29278 - poslundc - Mon Nov 15, 2004 9:44 pm</h4>
    <div class="postbody"><span class="postbody"><a class="postlink" href="http://www.google.com/search?hl=en&amp;q=fixed+point+math" target="_blank">Google: fixed point math</a>
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#29675 - _pluto9 - Tue Nov 23, 2004 7:17 pm</h4>
    <div class="postbody"><span class="postbody">Your trying to isolate the decimal portion right?, well you might want to learn all that IEEE stuff, but I'd just do this (PRECISION being some power of ten, 10 meaning 1 decimal place, 100 meaning 2, etc..):
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">f = float(int(f * PRECISION.0f) % PRECISION) / PRECISION.0f;</td> </tr></table><span class="postbody">
<br/>
unless your using it for some low level graphics routine or something... then yeah, learn the IEEE stuff</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
