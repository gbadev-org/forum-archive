<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Variables behaving strangely - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>C/C++ > Variables behaving strangely</h2>
<div id="posts">
<div class="post">
    <h4>#173873 - zelbo - Wed May 05, 2010 9:36 pm</h4>
    <div class="postbody"><span class="postbody">Working on a sudoku solver for the DS, but i'm running into some odd behavior, which i'm sure is due to my lack of understanding of C/C++.
<br/>
<br/>
Two main problems right now, one of them minor but seems to be connected to the other.
<br/>
<br/>
When i move my cursor around, it changes a value that it should not be changing (int cel.is).
<br/>
<br/>
At first, it was only when my cursor moved up and down. After i tried different ways of initializing the cursor position, the value changed only during left/right movement. This is very troubling to me. Syntax error maybe?
<br/>
<br/>
The other problem is that i have tried to initialize the starting position of the cursor both during the constructor and immediately after creating the cursor object. Neither seems to work, although my cursor movement code seems to work fine (other than the problem mentioned above).
<br/>
I'm aware that i'm using naked arrays and have no asserts, working on adding those now.
<br/>
<br/>
relevant parts of sudoku.cpp:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">Sudoku::Sudoku()
<br/>
{
<br/>
   initVideo();
<br/>
   //initBackground();   //seem to have broken the backgrounds, low priority for now. solver engine more important.
<br/>
   initGraphics();
<br/>
   initText();
<br/>
   state = STATE_EDIT;
<br/>
   
<br/>
   Cursor * cursor = new Cursor(CURSOR_OAM_ID);
<br/>
   
<br/>
   cursor-&gt;x = 5;
<br/>
   cursor-&gt;y = 5;
<br/>
   
<br/>
   cursor-&gt;gfx = oamAllocateGfx(&amp;oamMain, SpriteSize_8x8, SpriteColorFormat_16Color);
<br/>
    dmaCopyHalfWords(SPRITE_DMA_CHANNEL, cursor_spriteTiles, cursor-&gt;gfx, cursor_spriteTilesLen);
<br/>
   dmaCopyHalfWords(SPRITE_DMA_CHANNEL, cursor_spritePal, SPRITE_PALETTE, cursor_spritePalLen);
<br/>
<br/>
}
<br/>
void Sudoku::edit()
<br/>
{
<br/>
<br/>
// select cel (set current_cel, block, row, column)
<br/>
   if(pressed &amp; KEY_UP and cursor-&gt;y &gt; TOP_BOUNDARY) cursor-&gt;move(UP);
<br/>
   if(pressed &amp; KEY_DOWN and cursor-&gt;y &lt; BOTTOM_BOUNDARY) cursor-&gt;move(DOWN);
<br/>
   if(pressed &amp; KEY_LEFT and cursor-&gt;x &gt; LEFT_BOUNDARY) cursor-&gt;move(LEFT);
<br/>
   if(pressed &amp; KEY_RIGHT and cursor-&gt;x &lt; RIGHT_BOUNDARY) cursor-&gt;move(RIGHT);
<br/>
   
<br/>
// edit current_cel (touchpad)
<br/>
<br/>
}
<br/>
<br/>
void Sudoku::draw()
<br/>
{
<br/>
   swiWaitForVBlank();
<br/>
<br/>
   consoleSelect(&amp;consoleTop);// use console for now, while getting guts working, get fancy later
<br/>
   consoleClear();
<br/>
   
<br/>
   // begin "this is horrid, fix this"
<br/>
   iprintf("%i%i%i %i%i%i %i%i%i\n", cel[0]-&gt;display(), cel[1]-&gt;display(), cel[2]-&gt;display(), cel[3]-&gt;display(), cel[4]-&gt;display(), cel[5]-&gt;display(), cel[6]-&gt;display(), cel[7]-&gt;display(), cel[8]-&gt;display());
<br/>
   iprintf("%i%i%i %i%i%i %i%i%i\n", cel[9]-&gt;display(), cel[10]-&gt;display(), cel[11]-&gt;display(), cel[12]-&gt;display(), cel[13]-&gt;display(), cel[14]-&gt;display(), cel[15]-&gt;display(), cel[16]-&gt;display(), cel[17]-&gt;display());
<br/>
   iprintf("%i%i%i %i%i%i %i%i%i\n\n", cel[18]-&gt;display(), cel[19]-&gt;display(), cel[20]-&gt;display(), cel[21]-&gt;display(), cel[22]-&gt;display(), cel[23]-&gt;display(), cel[24]-&gt;display(), cel[25]-&gt;display(), cel[26]-&gt;display());
<br/>
   
<br/>
   iprintf("%i%i%i %i%i%i %i%i%i\n", cel[27]-&gt;display(), cel[28]-&gt;display(), cel[29]-&gt;display(), cel[30]-&gt;display(), cel[31]-&gt;display(), cel[32]-&gt;display(), cel[33]-&gt;display(), cel[34]-&gt;display(), cel[35]-&gt;display());
<br/>
   iprintf("%i%i%i %i%i%i %i%i%i\n", cel[36]-&gt;display(), cel[37]-&gt;display(), cel[38]-&gt;display(), cel[39]-&gt;display(), cel[40]-&gt;display(), cel[41]-&gt;display(), cel[42]-&gt;display(), cel[43]-&gt;display(), cel[44]-&gt;display());
<br/>
   iprintf("%i%i%i %i%i%i %i%i%i\n\n", cel[45]-&gt;display(), cel[46]-&gt;display(), cel[47]-&gt;display(), cel[48]-&gt;display(), cel[49]-&gt;display(), cel[50]-&gt;display(), cel[51]-&gt;display(), cel[52]-&gt;display(), cel[53]-&gt;display());
<br/>
   
<br/>
   iprintf("%i%i%i %i%i%i %i%i%i\n", cel[54]-&gt;display(), cel[55]-&gt;display(), cel[56]-&gt;display(), cel[57]-&gt;display(), cel[58]-&gt;display(), cel[59]-&gt;display(), cel[60]-&gt;display(), cel[61]-&gt;display(), cel[62]-&gt;display());
<br/>
   iprintf("%i%i%i %i%i%i %i%i%i\n", cel[63]-&gt;display(), cel[64]-&gt;display(), cel[65]-&gt;display(), cel[66]-&gt;display(), cel[67]-&gt;display(), cel[68]-&gt;display(), cel[69]-&gt;display(), cel[70]-&gt;display(), cel[71]-&gt;display());
<br/>
   iprintf("%i%i%i %i%i%i %i%i%i\n\n", cel[72]-&gt;display(), cel[73]-&gt;display(), cel[74]-&gt;display(), cel[75]-&gt;display(), cel[76]-&gt;display(), cel[77]-&gt;display(), cel[78]-&gt;display(), cel[79]-&gt;display(), cel[80]-&gt;display());
<br/>
   // end "this is is horrid, fix this"
<br/>
   
<br/>
   consoleSelect(&amp;consoleBottom);
<br/>
   consoleClear();
<br/>
   iprintf("123456789\n");
<br/>
   
<br/>
   iprintf("Touch x = %04i, %04i, %02i\n", touch.rawx, touch.px, touch.px &gt;&gt; 3);
<br/>
   iprintf("Touch y = %04i, %04i, %02i\n", touch.rawy, touch.py, touch.py &gt;&gt; 3);
<br/>
   iprintf("cursor x, y = %02i, %02i\n", cursor-&gt;x, cursor-&gt;y);
<br/>
   iprintf("cel 0 is %i\n", cel[0]-&gt;display());
<br/>
<br/>
   oamSet(&amp;oamMain, CURSOR_OAM_ID, (cursor-&gt;x * TILE_SIZE), (cursor-&gt;y * TILE_SIZE), CURSOR_LAYER, 0, SpriteSize_8x8,
<br/>
      SpriteColorFormat_16Color, cursor-&gt;gfx, -1, false, false,  false, false, false);
<br/>
   
<br/>
//   bgSetScroll(bgCursor, screen-&gt;x, screen-&gt;y);
<br/>
   bgUpdate();
<br/>
   oamUpdate(&amp;oamMain);
<br/>
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
cursor.hpp:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">class Cursor
<br/>
{
<br/>
   public:
<br/>
      u16* gfx;
<br/>
      int x, y;
<br/>
      int oamID;
<br/>
<br/>
      Cursor(int ID);
<br/>
      ~Cursor();
<br/>
      void move(int direction);
<br/>
   protected:
<br/>
};</td> </tr></table><span class="postbody">
<br/>
<br/>
cursor.cpp:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">Cursor::Cursor(int ID)
<br/>
{
<br/>
   oamID = ID;
<br/>
   // why are these not getting set?
<br/>
   x = 5;
<br/>
   y = 5;
<br/>
}
<br/>
<br/>
Cursor::~Cursor()
<br/>
{
<br/>
   ;
<br/>
}
<br/>
<br/>
void Cursor::move(int direction)
<br/>
{
<br/>
   if(direction == UP)
<br/>
   {
<br/>
      y--;
<br/>
      if(y == TOP_BREAK) y--;
<br/>
      if(y == BOTTOM_BREAK) y--;
<br/>
   }
<br/>
   else if(direction == DOWN)
<br/>
   {
<br/>
      y++;
<br/>
      if(y == TOP_BREAK) y++;
<br/>
      if(y == BOTTOM_BREAK) y++;
<br/>
   }
<br/>
   else if(direction == LEFT)
<br/>
   {
<br/>
      x--;
<br/>
      if(x == LEFT_BREAK) x--;
<br/>
      if(x == RIGHT_BREAK) x--;
<br/>
   }
<br/>
   else if(direction == RIGHT)
<br/>
   {
<br/>
      x++;
<br/>
      if(x == LEFT_BREAK) x++;
<br/>
      if(x == RIGHT_BREAK) x++;
<br/>
   }
<br/>
   else ;   //drink!
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
cel.hpp: (note protected nature of the "is" variable)
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">class Cel
<br/>
{
<br/>
<br/>
public:
<br/>
   Cel();
<br/>
   virtual ~Cel();
<br/>
   int set(int new_value);
<br/>
   int display();
<br/>
   bool can_be(int value);
<br/>
   
<br/>
private:
<br/>
<br/>
protected:
<br/>
   int is;
<br/>
   bool potential[9];
<br/>
<br/>
};</td> </tr></table><span class="postbody">
<br/>
<br/>
cel.cpp:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">Cel::Cel()
<br/>
{
<br/>
   is = 0;
<br/>
   int i;
<br/>
   for(i = 0; i &lt; 9; i++) potential[i] = true;
<br/>
}
<br/>
<br/>
Cel::~Cel()
<br/>
{
<br/>
}
<br/>
<br/>
int Cel::set(int new_value)
<br/>
{
<br/>
   int i;
<br/>
   if(new_value == 0)
<br/>
   {
<br/>
      for(i = 0; i &lt; 9; i++) potential[i] = true;
<br/>
      is = new_value;
<br/>
   }
<br/>
   else
<br/>
   {
<br/>
      for(i = 0; i &lt; 9; i++) potential[i] = false;
<br/>
      potential[new_value] = true;
<br/>
      is = new_value;
<br/>
   }
<br/>
   return 0;
<br/>
}
<br/>
<br/>
int Cel::display()
<br/>
{
<br/>
   // maybe make a string or char and output the display string (" ", "1", "2"...)
<br/>
   int value = is;
<br/>
   return value;
<br/>
}
<br/>
<br/>
bool Cel::can_be(int value)
<br/>
{
<br/>
   return potential[value];
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I find this very strange, especially since the "is" variable is protected and so far the only place i know of that i'm doing anything to it is during initialization of the cel.
<br/>
<br/>
Let me know if more information is needed. I know i'm not that good at this stuff yet, but just getting this simple thing working is seeming harder than it should be. What the heck am i doing wrong?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#173874 - DiscoStew - Wed May 05, 2010 11:06 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">Cursor * cursor = new Cursor(CURSOR_OAM_ID); </td> </tr></table><span class="postbody">
<br/>
<br/>
This is within your Sudoku constructor, which becomes lost in memory after leaving the constructor because it has no relationship to anything except being generated locally. If the Sudoku class has "cursor" as a member, then change the line to....
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">cursor = new Cursor(CURSOR_OAM_ID);</td> </tr></table><span class="postbody">
<br/>
<br/>
...and make sure to delete it when your Sudoku object terminates.
<br/>
<br/>
Remember, if you have two or more variables or the same exact name, each set in a particular layer of code, the inner one will always be used for manipulation, like so...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
{
<br/>
   int x = 1;
<br/>
   {
<br/>
      int x = 2; // outer x is ignored, but still exists
<br/>
      {
<br/>
         int x = 3; // outer x is ignored, but still exists
<br/>
         // x = 3
<br/>
      }
<br/>
      // x now equals 2 because the inner 'x' was terminated
<br/>
   }
<br/>
   // x now equals 1 because the inner 'x' was terminated
<br/>
}</td> </tr></table><span class="postbody"><br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#173875 - zelbo - Wed May 05, 2010 11:29 pm</h4>
    <div class="postbody"><span class="postbody">That fixed both problems! Thank you.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
