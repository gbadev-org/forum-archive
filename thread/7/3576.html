<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Free Mode 4 floor mapper here - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>C/C++ > Free Mode 4 floor mapper here</h2>
<div id="posts">
<div class="post">
    <h4>#22342 - FPChris - Sat Jun 19, 2004 2:44 am</h4>
    <div class="postbody"><span class="postbody">My first attempt at a 3d floor mapper in Mode 4.
<br/>
Not bad realtime performance on gba hardware.
<br/>
Any optimizations are welcome. Like the two divs in the
<br/>
outer loop area. Enjoy...
<br/>
<br/>
Chris
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
...removed...
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"><br/><br/>Last edited by FPChris on Sat Jun 19, 2004 5:07 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#22349 - sajiimori - Sat Jun 19, 2004 4:47 am</h4>
    <div class="postbody"><span class="postbody">A few suggestions:
<br/>
<br/>
Change all the non-pointer variables to 'int'.  GCC seems to have an easier time optimizing code that uses register-sized variables.
<br/>
<br/>
The divisions can be eliminated with a small reciprocal table.
<br/>
<br/>
Let the compiler unroll loops for you.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22352 - FPChris - Sat Jun 19, 2004 5:24 am</h4>
    <div class="postbody"><span class="postbody">Thanks for the heads up. I'll give it a shot.
<br/>
<br/>
I was going to do an LUT for the height but this way made it
<br/>
portable to anyone that wants to drop it in.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22357 - FPChris - Sat Jun 19, 2004 5:48 am</h4>
    <div class="postbody"><span class="postbody">Also I just found out in another post that this code is 'invalid'.
<br/>
<br/>
I am typecasting the video memory as a u8*. This was not
<br/>
throwing an error nor failing on the hardware. BUT it is
<br/>
drawing u16 pixels not u8 as the code will lead you to think.
<br/>
<br/>
I was testing with a grassy green texture and I could see that
<br/>
2 pixels were being drawn regardless of the u8 typecasting.
<br/>
<br/>
I'll revise and repost if anyone is interested.
<br/>
<br/>
Chris</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22359 - sajiimori - Sat Jun 19, 2004 6:13 am</h4>
    <div class="postbody"><span class="postbody">The compiler doesn't know about the GBA's hardware quirks, so one would not expect it to produce an error.  Besides, it's rather impossible for it to detect which code will eventually write something to VRAM at runtime.
<br/>
<br/>
Also, the GBA doesn't "fail" the way PCs do with blue screens of death and all that.  If you do something undefined, you'll get undefined results.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22365 - FPChris - Sat Jun 19, 2004 1:31 pm</h4>
    <div class="postbody"><span class="postbody">True. I wasn't expecting gcc to catch it but I did expect the gba
<br/>
to act is if something wasn't right somewhere. 
<br/>
<br/>
Your 'int' suggestion also showed an improvement.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
