<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>problem with scope [SOLVED] - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>C/C++ > problem with scope [SOLVED]</h2>
<div id="posts">
<div class="post">
    <h4>#172018 - zelbo - Sat Jan 09, 2010 12:52 am</h4>
    <div class="postbody"><span class="postbody">I'm somewhat new to c. Trying to wrap my head around pointers currently.
<br/>
<br/>
I'm trying to make a roguelike without using curses. So i plan to use an array to hold all the display information, then update as needed. i'm having trouble with scope and pointers, however.
<br/>
<br/>
running into trouble at line 41 (void drawMap(void))
<br/>
<br/>
any help is greatly appreciated.
<br/>
<br/>
do i just need to give up and use curses? even doing that, i feel like i should get a handle on how to make this work.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
/* Yet Another Roguelike for the DS - By Zelbo */
<br/>
<br/>
#include &lt;nds.h&gt;
<br/>
#include &lt;stdio.h&gt;
<br/>
#include &lt;time.h&gt;
<br/>
#include &lt;string.h&gt;
<br/>
<br/>
// Month information
<br/>
const char* month[12] = {"January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"};
<br/>
<br/>
// Arrays for displays - map, items, creatures, fog of war
<br/>
int dispMap[32][20], dispItems[32][20], dispCreatures[32][20], dispFog[32][20];
<br/>
<br/>
// monster class
<br/>
class monster
<br/>
{
<br/>
   private:
<br/>
   public:
<br/>
   char name[15];
<br/>
   int avatar; // ascii code of display char
<br/>
   int cRace, cClass;
<br/>
   int x, y, z;
<br/>
   int maxHealth, maxMana, curHealth, curMana;
<br/>
   int attack, armor, experience, level;
<br/>
   bool alive;
<br/>
   int state;
<br/>
   
<br/>
   void move(int direction)
<br/>
   {
<br/>
   
<br/>
   
<br/>
   };
<br/>
};
<br/>
<br/>
<br/>
<br/>
/*
<br/>
Scope and pointers ... how do i make this work?
<br/>
do i need to pass pointers for console and array to the function?
<br/>
*/
<br/>
void drawMap(void)
<br/>
{
<br/>
// maybe do this part outside of the function?
<br/>
// consoleSelect(&amp;winGame0);
<br/>
  for(i=0;i&lt;32;i++)
<br/>
  {
<br/>
      for(i2=0;i2&lt;20;i2++)
<br/>
     {
<br/>
       iprintf("%c", dispMap(i,i2));
<br/>
     }
<br/>
   
<br/>
  }
<br/>
<br/>
<br/>
}
<br/>
<br/>
<br/>
//---------------------------------------------------------------------------------
<br/>
int main(void)
<br/>
{
<br/>
// initialize variables
<br/>
   monster Player;
<br/>
   Player.avatar=64;
<br/>
   Player.x=10;
<br/>
   Player.y=10;
<br/>
   int keys;
<br/>
   int i, i2;
<br/>
   int hours, seconds, minutes;
<br/>
    unsigned long init[4]={0x123, 0x234, 0x345, 0x456}, length=4;
<br/>
    init_by_array(init, length);
<br/>
   touchPosition touch;
<br/>
<br/>
// initialize the consoles
<br/>
  PrintConsole winGame0;
<br/>
   PrintConsole winGame1;
<br/>
   PrintConsole winGame2;
<br/>
   PrintConsole winGame3;
<br/>
   PrintConsole winMessage;
<br/>
   PrintConsole winStats;
<br/>
   PrintConsole winDebug;
<br/>
   
<br/>
// set screen modes
<br/>
   videoSetMode(MODE_0_2D);
<br/>
   videoSetModeSub(MODE_0_2D);
<br/>
<br/>
// assign memory banks
<br/>
   vramSetBankA(VRAM_A_MAIN_BG);
<br/>
   vramSetBankC(VRAM_C_SUB_BG);
<br/>
<br/>
// define the consoles
<br/>
/*
<br/>
consoleInit (PrintConsole *console,
<br/>
 int layer,
<br/>
 BgType type,
<br/>
 BgSize size,
<br/>
 int mapBase,
<br/>
 int tileBase,
<br/>
 bool mainDisplay,
<br/>
 bool loadGraphics)
<br/>
 
<br/>
*/
<br/>
   consoleInit(&amp;winGame0, 0, BgType_Text4bpp, BgSize_T_256x256, 31, 0, true, true);
<br/>
   consoleInit(&amp;winGame1, 1, BgType_Text4bpp, BgSize_T_256x256, 31, 0, true, true);
<br/>
   consoleInit(&amp;winGame2, 2, BgType_Text4bpp, BgSize_T_256x256, 31, 0, true, true);
<br/>
   consoleInit(&amp;winGame3, 3, BgType_Text4bpp, BgSize_T_256x256, 31, 0, true, true);
<br/>
   consoleInit(&amp;winMessage, 3, BgType_Text4bpp, BgSize_T_256x256, 31, 0, true, true);
<br/>
   consoleInit(&amp;winStats, 3, BgType_Text4bpp, BgSize_T_256x256, 31, 0, true, true);
<br/>
   consoleInit(&amp;winDebug, 3, BgType_Text4bpp, BgSize_T_256x256, 31, 0, false, true);
<br/>
<br/>
// customize consoles
<br/>
/*
<br/>
void consoleSetWindow     (     PrintConsole *       console,
<br/>
      int     x,
<br/>
      int     y,
<br/>
      int     width,
<br/>
      int     height   
<br/>
   )          
<br/>
*/
<br/>
consoleSetWindow(&amp;winGame0, 0, 0, 32, 20);
<br/>
consoleSetWindow(&amp;winGame1, 0, 0, 32, 20);
<br/>
consoleSetWindow(&amp;winGame2, 0, 0, 32, 20);
<br/>
consoleSetWindow(&amp;winGame3, 0, 0, 32, 20);
<br/>
consoleSetWindow(&amp;winMessage, 0, 20, 32, 3);
<br/>
consoleSetWindow(&amp;winStats, 0, 23, 32, 1);
<br/>
consoleSetWindow(&amp;winDebug, 0, 0, 32, 24);
<br/>
<br/>
// test all consoles
<br/>
consoleSelect(&amp;winGame0);
<br/>
iprintf("Game Window\n");
<br/>
<br/>
consoleSelect(&amp;winMessage);
<br/>
iprintf("Message Window\n");
<br/>
<br/>
consoleSelect(&amp;winStats);
<br/>
iprintf("Quick Stats");
<br/>
<br/>
consoleSelect(&amp;winDebug);
<br/>
iprintf("Debug Window\n");
<br/>
     for(i2=32;i2&lt;127;i2++)
<br/>
     {
<br/>
       iprintf("%c",i2);   
<br/>
     }
<br/>
<br/>
   
<br/>
   consoleSelect(&amp;winGame2);
<br/>
   iprintf("\x1b[10;20H\x1b[35m%c", Player.avatar);
<br/>
<br/>
consoleSelect(&amp;winGame0);
<br/>
drawMap(); 
<br/>
   
<br/>
   
<br/>
// select bottom console
<br/>
   consoleSelect(&amp;bottomScreen);
<br/>
<br/>
   while(1) {
<br/>
      // get the time inform
<br/>
      time_t unixTime = time(NULL);
<br/>
      struct tm* timeStruct = gmtime((const time_t *)&amp;unixTime);
<br/>
      hours = timeStruct-&gt;tm_hour;
<br/>
      minutes = timeStruct-&gt;tm_min;
<br/>
      seconds = timeStruct-&gt;tm_sec;
<br/>
      
<br/>
      //get input
<br/>
      touchRead(&amp;touch);
<br/>
      scanKeys();
<br/>
      keys = keysHeld();
<br/>
      
<br/>
      // display date and time
<br/>
      iprintf("\x1b[2J%s %i %i %02i:%02i:%02i", month[timeStruct-&gt;tm_mon], timeStruct-&gt;tm_mday, timeStruct-&gt;tm_year +1900, hours, minutes, seconds); // display the current time
<br/>
      
<br/>
      // display pen coordinates
<br/>
      iprintf("\x1b[1;0HTouch x, y = %02i, %02i\n", (touch.px/8), (touch.py/8));
<br/>
      
<br/>
<br/>
<br/>
      swiWaitForVBlank();
<br/>
   }
<br/>
<br/>
   return 0;
<br/>
} 
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
edit: cut out some irrelevant parts, made small changes to how i'm trying to do it.</span><span class="gensmall"><br/><br/>Last edited by zelbo on Sun Jan 10, 2010 11:36 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#172022 - ninjalj - Sat Jan 09, 2010 11:10 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">iprintf("%c", dispMap(i,i2));</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
maybe you wanted to do:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">iprintf("%c", dispMap[i][i2]);</td> </tr></table><span class="postbody">
<br/>
<br/>
dispMap is an array (of arrays to integers), not a pointer.
<br/>
<br/>
Anything that you declare outside of functions has either global scope (it is visible in all the program) or compilation-unit scope if it's declared static (it is visible only in the current object file).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172024 - zelbo - Sun Jan 10, 2010 4:18 am</h4>
    <div class="postbody"><span class="postbody">I'll never stop kicking myself for learning basic over c back in highschool.
<br/>
<br/>
so i changed that, and it seems to help, except  i still can't get the function to do what it's supposed to. I need to get it to print the map to the game console, having trouble with that. I'm sure it's something to do with pointers, haven't quite nailed those yet. I'll keep fiddling with it, but if anyone can solve it for me, that would be sweet.
<br/>
<br/>
the function is at line 49, the call to it is at 164.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
/* Yet Another Roguelike for the DS - By Zelbo */
<br/>
<br/>
#include &lt;nds.h&gt;
<br/>
#include &lt;stdio.h&gt;
<br/>
#include &lt;time.h&gt;
<br/>
#include &lt;string.h&gt;
<br/>
<br/>
// Month information
<br/>
const char* month[12] = {"January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"};
<br/>
<br/>
// Arrays for displays - map, items, creatures, fog of war
<br/>
int dispMap[32][20], dispItems[32][20], dispCreatures[32][20], dispFog[32][20];
<br/>
int i, i2;
<br/>
// monster class
<br/>
class monster
<br/>
{
<br/>
   private:
<br/>
   public:
<br/>
   char name[15];
<br/>
   int avatar; // ascii code of display char
<br/>
   int cRace, cClass;
<br/>
   int x, y, z;
<br/>
   int maxHealth, maxMana, curHealth, curMana;
<br/>
   int attack, armor, experience, level;
<br/>
   bool alive;
<br/>
   int state;
<br/>
   
<br/>
   void move(int direction)
<br/>
   {
<br/>
   
<br/>
   
<br/>
   };
<br/>
};
<br/>
<br/>
<br/>
// initialize the consoles
<br/>
PrintConsole winGame0;
<br/>
PrintConsole winGame1;
<br/>
PrintConsole winGame2;
<br/>
PrintConsole winGame3;
<br/>
PrintConsole winMessage;
<br/>
PrintConsole winStats;
<br/>
PrintConsole winDebug;
<br/>
   
<br/>
<br/>
/*
<br/>
how do i make this work?
<br/>
*/
<br/>
void drawMap(PrintConsole* ptr)
<br/>
{
<br/>
// maybe do this part outside of the function? (tried, no good)
<br/>
// maybe pass the 
<br/>
consoleSelect(ptr);
<br/>
<br/>
  for(i=0;i&lt;32;i++)
<br/>
  {
<br/>
      for(i2=0;i2&lt;20;i2++)
<br/>
     {
<br/>
       iprintf("%c", dispMap[i][i2]);
<br/>
     }
<br/>
   
<br/>
  }
<br/>
<br/>
<br/>
}
<br/>
<br/>
<br/>
//---------------------------------------------------------------------------------
<br/>
int main(void)
<br/>
{
<br/>
// initialize variables
<br/>
   monster Player;
<br/>
   Player.avatar=64;
<br/>
   Player.x=10;
<br/>
   Player.y=10;
<br/>
   int keys;
<br/>
   int hours, seconds, minutes;
<br/>
   touchPosition touch;
<br/>
<br/>
<br/>
// set screen modes
<br/>
   videoSetMode(MODE_0_2D);
<br/>
   videoSetModeSub(MODE_0_2D);
<br/>
<br/>
// assign memory banks
<br/>
   vramSetBankA(VRAM_A_MAIN_BG);
<br/>
   vramSetBankC(VRAM_C_SUB_BG);
<br/>
<br/>
// define the consoles
<br/>
/*
<br/>
consoleInit (PrintConsole *console,
<br/>
 int layer,
<br/>
 BgType type,
<br/>
 BgSize size,
<br/>
 int mapBase,
<br/>
 int tileBase,
<br/>
 bool mainDisplay,
<br/>
 bool loadGraphics)
<br/>
 
<br/>
*/
<br/>
   consoleInit(&amp;winGame0, 0, BgType_Text4bpp, BgSize_T_256x256, 31, 0, true, true);
<br/>
   consoleInit(&amp;winGame1, 1, BgType_Text4bpp, BgSize_T_256x256, 31, 0, true, true);
<br/>
   consoleInit(&amp;winGame2, 2, BgType_Text4bpp, BgSize_T_256x256, 31, 0, true, true);
<br/>
   consoleInit(&amp;winGame3, 3, BgType_Text4bpp, BgSize_T_256x256, 31, 0, true, true);
<br/>
   consoleInit(&amp;winMessage, 3, BgType_Text4bpp, BgSize_T_256x256, 31, 0, true, true);
<br/>
   consoleInit(&amp;winStats, 3, BgType_Text4bpp, BgSize_T_256x256, 31, 0, true, true);
<br/>
   consoleInit(&amp;winDebug, 3, BgType_Text4bpp, BgSize_T_256x256, 31, 0, false, true);
<br/>
<br/>
// customize consoles
<br/>
/*
<br/>
void consoleSetWindow     (     PrintConsole *       console,
<br/>
      int     x,
<br/>
      int     y,
<br/>
      int     width,
<br/>
      int     height   
<br/>
   )         
<br/>
*/
<br/>
consoleSetWindow(&amp;winGame0, 0, 0, 32, 20);
<br/>
consoleSetWindow(&amp;winGame1, 0, 0, 32, 20);
<br/>
consoleSetWindow(&amp;winGame2, 0, 0, 32, 20);
<br/>
consoleSetWindow(&amp;winGame3, 0, 0, 32, 20);
<br/>
consoleSetWindow(&amp;winMessage, 0, 20, 32, 3);
<br/>
consoleSetWindow(&amp;winStats, 0, 23, 32, 1);
<br/>
consoleSetWindow(&amp;winDebug, 0, 0, 32, 24);
<br/>
<br/>
// test all consoles
<br/>
consoleSelect(&amp;winGame0);
<br/>
iprintf("Game Window\n");
<br/>
<br/>
consoleSelect(&amp;winMessage);
<br/>
iprintf("Message Window\n");
<br/>
<br/>
consoleSelect(&amp;winStats);
<br/>
iprintf("Quick Stats");
<br/>
<br/>
consoleSelect(&amp;winDebug);
<br/>
iprintf("Debug Window\n");
<br/>
     for(i2=32;i2&lt;127;i2++)
<br/>
     {
<br/>
       iprintf("%c",i2);   
<br/>
     }
<br/>
<br/>
   
<br/>
   consoleSelect(&amp;winGame2);
<br/>
   iprintf("\x1b[10;20H\x1b[35m%c", Player.avatar);
<br/>
   
<br/>
   
<br/>
   
<br/>
// fill the map with something
<br/>
  for(i=0;i&lt;33;i++)
<br/>
  {
<br/>
    
<br/>
     for(i2=0;i2&lt;21;i2++)
<br/>
     {
<br/>
      dispMap[i][i2]=65;
<br/>
     }
<br/>
   
<br/>
   
<br/>
  }
<br/>
<br/>
<br/>
<br/>
consoleSelect(&amp;winGame0);
<br/>
drawMap(&amp;winGame0);
<br/>
   
<br/>
   
<br/>
// select bottom console
<br/>
   while(1) {
<br/>
      // get the time inform
<br/>
      time_t unixTime = time(NULL);
<br/>
      struct tm* timeStruct = gmtime((const time_t *)&amp;unixTime);
<br/>
      hours = timeStruct-&gt;tm_hour;
<br/>
      minutes = timeStruct-&gt;tm_min;
<br/>
      seconds = timeStruct-&gt;tm_sec;
<br/>
     
<br/>
      //get input
<br/>
      touchRead(&amp;touch);
<br/>
      scanKeys();
<br/>
      keys = keysHeld();
<br/>
     
<br/>
      // display date and time
<br/>
      iprintf("\x1b[2J%s %i %i %02i:%02i:%02i", month[timeStruct-&gt;tm_mon], timeStruct-&gt;tm_mday, timeStruct-&gt;tm_year +1900, hours, minutes, seconds); // display the current time
<br/>
     
<br/>
      // display pen coordinates
<br/>
      iprintf("\x1b[1;0HTouch x, y = %02i, %02i\n", (touch.px/8), (touch.py/8));
<br/>
     
<br/>
<br/>
<br/>
      swiWaitForVBlank();
<br/>
   }
<br/>
<br/>
   return 0;
<br/>
}
<br/>
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172028 - Cearn - Sun Jan 10, 2010 12:07 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>zelbo wrote:</b></span></td> </tr> <tr> <td class="quote">I need to get it to print the map to the game console, having trouble with that.
<br/>
</td> </tr></table><span class="postbody">
<br/>
The function does what it's supposed to do, but you're erasing it later inside the loop (see the '//#' comments):
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>zelbo wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int main() 
<br/>
{
<br/>
   //# &lt;SNIP&gt;
<br/>
<br/>
   //# Select game window and draw map
<br/>
   consoleSelect(&amp;winGame0);
<br/>
   drawMap(&amp;winGame0);
<br/>
   
<br/>
    // select bottom console
<br/>
   while(1)
<br/>
   {
<br/>
      // get the time inform
<br/>
      time_t unixTime = time(NULL);
<br/>
      struct tm* timeStruct = gmtime((const time_t *)&amp;unixTime);
<br/>
      hours = timeStruct-&gt;tm_hour;
<br/>
      minutes = timeStruct-&gt;tm_min;
<br/>
      seconds = timeStruct-&gt;tm_sec;
<br/>
     
<br/>
      //get input
<br/>
      touchRead(&amp;touch);
<br/>
      scanKeys();
<br/>
      keys = keysHeld();
<br/>
     
<br/>
      //# Here it's still the game window, which is now cleared by the
<br/>
      //# ESC[2J code.
<br/>
<br/>
      // display date and time
<br/>
      iprintf("\x1b[2J%s %i %i %02i:%02i:%02i", month[timeStruct-&gt;tm_mon], timeStruct-&gt;tm_mday, timeStruct-&gt;tm_year +1900, hours, minutes, seconds); // display the current time
<br/>
     
<br/>
      // display pen coordinates
<br/>
      iprintf("\x1b[1;0HTouch x, y = %02i, %02i\n", (touch.px/8), (touch.py/8));
<br/>
<br/>
      swiWaitForVBlank();
<br/>
   }
<br/>
<br/>
   return 0;
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
I would say simply call the drawMap() function inside the loop, but using printf is too slow to be called like that; it takes over a frame to draw the whole map, leaving you no time to do any game logic. Here are a few alternatives:
<br/>
<ul><li>Instead of printing character for character, think of the character-map as a whole string and print the entire string in a single printf call (you need a terminating '\0' in the string first, though). That should cut down on some of the overhead.
<br/>
</li><li>Use putchar() for each character instead of printf. Or puts for the whole string.
<br/>
</li><li>Don't use the console system, but manipulate the map manually.
<br/>
</li></ul>
<br/>
Adittionally, 
<br/>
<ul><li>Do <span style="font-weight: bold">not</span> make your loop indices global variables. Not only will this be slower than locals, it will bite you in the ass at some point when 
<br/>
inside a loop you call another function that also contains a loop. The called function would then muck up the index of the caller.
<br/>
</li><li>In C, matrices are ordered [y][x], not [x][y]. Technically, something like dispMap[32][20] has width=20, height=32. If you're careful it won't matter, but it may slow things down a little because the loop accesses aren't sequential.
<br/>
</li><li>Consider whether you really need all those separate consoles. The console window isn't like Windows windows: it just gives a frame for placement and text wrapping. All your consoles actually still point to the same map (namely, 31), which could become problematic at some point. You can make due with a single console per screen and move the window as you go.
<br/>
</li></ul></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172036 - zelbo - Sun Jan 10, 2010 11:36 pm</h4>
    <div class="postbody"><span class="postbody">Awesome, thank you both. I've made a few changes, which i don't have on me at the moment, but i will probably post when i run into my next problem.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">    * Instead of printing character for character, think of the character-map as a whole string and print the entire string in a single printf call (you need a terminating '\0' in the string first, though). That should cut down on some of the overhead.</td> </tr></table><span class="postbody"> I was thinking i might need to do something along those lines, i'll try to get that implemented.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">    * Use putchar() for each character instead of printf. Or puts for the whole string.</td> </tr></table><span class="postbody"> Can you tell i'm new to C yet? I need to get my hands on a reference of all the functions, currently all i have is a C++ primer for non C programmers, which talks about code structure and some things like that, but what i need now is a solid command/syntax reference.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">    * Don't use the console system, but manipulate the map manually.</td> </tr></table><span class="postbody"> Not sure what you mean here, could you elaborate some?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">    * Do not make your loop indices global variables. Not only will this be slower than locals, it will bite you in the ass at some point when inside a loop you call another function that also contains a loop. The called function would then muck up the index of the caller.</td> </tr></table><span class="postbody"> Excellent, this is the sort of thing i need to know. Otherwise i would just global the crap out of everything to avoid having to muck around with scope and pointers.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">    * In C, matrices are ordered [y][x], not [x][y]. Technically, something like dispMap[32][20] has width=20, height=32. If you're careful it won't matter, but it may slow things down a little because the loop accesses aren't sequential.</td> </tr></table><span class="postbody"> This sort of thing i find confusing and will take some adjusting, but i think i can deal. Although i'm not sure i understand what you mean by 'not sequential', i thought they were very sequential.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">    * Consider whether you really need all those separate consoles. The console window isn't like Windows windows: it just gives a frame for placement and text wrapping. All your consoles actually still point to the same map (namely, 31), which could become problematic at some point. You can make due with a single console per screen and move the window as you go.</td> </tr></table><span class="postbody"> This i'm discovering, still playing around with it a bit. I thought the layers dictated their display priority, but it seems this is not the case.
<br/>
<br/>
I'm sure i'm going to have a ton more questions while working on this project, but for now i would say my question has been answered. Going by the "make a roguelike in 15 steps" from roguebasin, i'd say i have step three finished with room for improvement.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172039 - Cearn - Mon Jan 11, 2010 11:44 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>zelbo wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">    * Use putchar() for each character instead of printf. Or puts for the whole string.</td> </tr></table><span class="postbody"> Can you tell i'm new to C yet? I need to get my hands on a reference of all the functions, currently all i have is a C++ primer for non C programmers, which talks about code structure and some things like that, but what i need now is a solid command/syntax reference.</span></td> </tr></table><span class="postbody">
<br/>
I don't know about syntax, but for a function reference go here: <a class="postlink" href="http://www.cppreference.com" target="_blank">http://www.cppreference.com</a>. If you're doing this in pure C, not everything will be available, for obvious reasons. One non-obvious difference is that in C++ the headers are named &lt;cfoo&gt;, whereas in C you'd use &lt;foo.h&gt;.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>zelbo wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">    * Don't use the console system, but manipulate the map manually.</td> </tr></table><span class="postbody"> Not sure what you mean here, could you elaborate some?</span></td> </tr></table><span class="postbody">
<br/>
The NDS has 4 backgrounds, which can be either tilemaps or bitmaps -- mostly tilemaps. As tilemaps, you'll have a tileset and a map which says which tile should be rendered at a given position on the screen. What the console system does is provide a layer that makes it easier to print (formatted) text to a tilemap background, but underneath it's still a background. If it's really text (in particular, strings with numbers) that you need to print, use the console system. For general map interaction, it's probably easier and definitely faster to do that yourself.
<br/>
<br/>
See also: <a class="postlink" href="http://www.coranac.com/tonc/text/regbg.htm" target="_blank">tonc:regbg</a>, <a class="postlink" href="http://libnds.devkitpro.org/a00111.html" target="_blank">libnds:bg api</a>.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>zelbo wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">    * Do not make your loop indices global variables. Not only will this be slower than locals, it will bite you in the ass at some point when inside a loop you call another function that also contains a loop. The called function would then muck up the index of the caller.</td> </tr></table><span class="postbody"> Excellent, this is the sort of thing i need to know. Otherwise i would just global the crap out of everything to avoid having to muck around with scope and pointers.</span></td> </tr></table><span class="postbody">
<br/>
As a rule, try to keep scope as small as possible. Locals first, then passing via function parameters, then globals if passing the same things would just become too cumbersome. Loop indices should be locals. An array of monsters is suited to be global, but when acting on an individual monster it may be best to pass a monster-pointer as a function parameter. Or a class method. It's not exactly required to do it like this though.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>zelbo wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">    * In C, matrices are ordered [y][x], not [x][y]. Technically, something like dispMap[32][20] has width=20, height=32. If you're careful it won't matter, but it may slow things down a little because the loop accesses aren't sequential.</td> </tr></table><span class="postbody"> This sort of thing i find confusing and will take some adjusting, but i think i can deal. Although i'm not sure i understand what you mean by 'not sequential', i thought they were very sequential.</span></td> </tr></table><span class="postbody">
<br/>
Think of it like this: elements of an array (regardless of its dimensions) are laid out as one consecutive memory block. For example, if you have <span style="font-style: italic">array[40]</span>, the elements are ordered like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
 0  1  2  3  4  5  6  7  8  9
<br/>
10 11 12 13 14 15 16 17 18 19
<br/>
20 21 22 23 24 25 26 27 28 29
<br/>
30 31 32 33 34 35 36 37 38 39
<br/>
</td> </tr></table><span class="postbody">
<br/>
For multi-dimensional arrays, the rule is that if you run through memory, the last index loops the fastest. Compare it to regular numbers: if you count up, the last digit (the ones) increases with every step, then the tens every 10 numbers, hundreds and so on. 
<br/>
<br/>
The array from before can also be interpreted as a block. Since the last index is supposed to increment the fastest, the normal way to define this would be <span style="font-style: italic">matrix[4][10]</span>, and not <span style="font-style: italic">matrix[10][4]</span>. Note that the array and matrix format can be used interchangeably: matrix element [y][x] is the same as array element [y*matrixWidth+x].
<br/>
<br/>
With 'sequential' I meant adjacent in memory. In a C matrix, the element following [0][0] is [0][1], not [1][0]. [1][0] could be quite a way away from [0][0]. Sequential accesses are often faster for a number of reasons, so it's often beneficial to order the arrays and loops accordingly. Actually, now that I think of it, because both the orders of your arrays and loops currently match, it works out nicely (though it's still customary to do it the other way).
<br/>
<br/>
If you want to make sure there's no index confusion, you way want to use <span style="font-style: italic">x</span> and <span style="font-style: italic">y</span> as part of the loop-names (<span style="font-style: italic">ix</span> and <span style="font-style: italic">iy</span>, for example).
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>zelbo wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">    * Consider whether you really need all those separate consoles. The console window isn't like Windows windows: it just gives a frame for placement and text wrapping. All your consoles actually still point to the same map (namely, 31), which could become problematic at some point. You can make due with a single console per screen and move the window as you go.</td> </tr></table><span class="postbody"> This i'm discovering, still playing around with it a bit. I thought the layers dictated their display priority, but it seems this is not the case.</span></td> </tr></table><span class="postbody">
<br/>
Well, the layers <span style="font-style: italic">also</span> indicate priority, but that's just incidental and can be adjusted. The real thing to remember is that there are 4 backgrounds per screen. Using the same BG for multiple purposes is possible, but you have to be wary of overwriting. 
<br/>
<br/>
Something similar applies to VRAM use. Tile memory and map memory overlap and is shared between backgrounds. For example, you're using map-base 31 for all consoles, which effectively means they all use the same map memory. Whether this is good or bad is something you'll have to decide for yourself.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172046 - zelbo - Mon Jan 11, 2010 9:19 pm</h4>
    <div class="postbody"><span class="postbody">I have so many more questions, but i think most of them will need their own thread. For now, i'm wondering if i do stop using the console system and start working with graphics, can i access the console glyphs for my sprites and maps, or will i need to convert my own graphics? i seem to remember that i would also need separate tilesets for backgrounds and sprites, is this true?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172060 - sverx - Tue Jan 12, 2010 10:52 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>zelbo wrote:</b></span></td> </tr> <tr> <td class="quote">i seem to remember that i would also need separate tilesets for backgrounds and sprites, is this true?</td> </tr></table><span class="postbody">
<br/>
<br/>
VRAM banks can be assigned to backgrounds OR to sprites in a given moment, so actually you need to store separate tile for BGs and sprites.
<br/>
<br/>
Or if I'm wrong I'd like to know :)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
