<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>how to enable crt0.s interrupts in devkitadv r5b3 - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>C/C++ > how to enable crt0.s interrupts in devkitadv r5b3</h2>
<div id="posts">
<div class="post">
    <h4>#25202 - subatomic - Wed Aug 18, 2004 1:37 pm</h4>
    <div class="postbody"><span class="postbody">I see on other tutorial sites that I have to modify a crt0.s to enable interrupts.  In devkitadvance I see a directory called crtls that has the one copy of crt0.s and a makefile.  anyone know what I have to do to compile this for interrupts?  the doc file is empty for crtls, and the config-crt0.h seems to have an INI_INTR_VECT set to default already...
<br/>
<br/>
Basically my code links with or without the interrupt function table, so that tells me that it isn't enabled in crt0.s...   I did try to recompile crt0.s, and I did try hooking up the iterrupt table, setting the flags, etc... as outlined at the pern project tutorial...    
<br/>
<br/>
I'm pretty sure I didn't know what to change in crt0.s, so this is probably where the error lies...
<br/>
<br/>
<br/>
thanks
<br/>
-kevin
<br/>
<br/>
<br/>
ps.. (I compile (and link) my game with g++  file1.cpp file2.cpp ... filen.cpp and without any special flags or anything...
<br/>
<br/>
Does anyone have a link to documentation or some advice on how to add interrupt support to my project that compiles with devkitadvance?  It's all C++ by the way in case that matters...)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25212 - col - Wed Aug 18, 2004 9:20 pm</h4>
    <div class="postbody"><span class="postbody">Interrupt handling was removed from the crt0 in r5b3 - iirc, the reasoning was that crt0 is not the correct place for Interrupt service - as interrupts have nothing do with c or c++ language implementation.
<br/>
<br/>
What you can do is cut'n'paste the interrupt handler from Jeff Frohweins crt0 into a seperate .s file e.g. 'interrupts.s'
<br/>
<br/>
Then assemble and link that in with the rest of your project ..
<br/>
<br/>
At the top of your your new .s file you'll need to put the routine in iwram, export intr_main, import IntrTable...
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
    .SECTION    .iwram,"ax",%progbits
<br/>
    .EXTERN     IntrTable
<br/>
    .GLOBAL     intr_main
<br/>
    .ALIGN
<br/>
    .ARM
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
somewhere in your project code you will need to tell the hardware where the handler is - a good place is near the start of main... somthing like:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
*(u32 *)0x03fffffc = (u32)intr_main; 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I hope this is enough to get you started :)
<br/>
<br/>
cheers
<br/>
<br/>
col</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25252 - subatomic - Thu Aug 19, 2004 2:58 pm</h4>
    <div class="postbody"><span class="postbody">awsome reply.  thanks!.    searching around.  I also saw this implementation in the tonc library which seems to work pretty well (and an awsome explaination)...
<br/>
<br/>
<a href="http://user.chem.tue.nl/jakvijn/tonc/interrupts.htm" target="_blank">http://user.chem.tue.nl/jakvijn/tonc/interrupts.htm</a>
<br/>
<br/>
<br/>
With this and your reply above, it's good to finally understand the background of why crt0 wasn't working for me with interrupts...  good to know the back story for sure.<br/>_________________<br/>---
<br/>
<a href="http://www.subatomicglue.com" target="_blank">http://www.subatomicglue.com</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
