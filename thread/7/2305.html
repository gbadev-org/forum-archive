<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>optimising calculations.. - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>C/C++ > optimising calculations..</h2>
<div id="posts">
<div class="post">
    <h4>#12228 - yaustar - Tue Nov 04, 2003 8:36 pm</h4>
    <div class="postbody"><span class="postbody">At he moment I have this could snippet for a game to draw a radar. Basically it uses the collision layer to draw the outline of the environment. It works great expect for one problem, it's bog slow. I have tried everything that I could think of but all I seem to do id make it slower... Help is desperately needed here.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
//---Draw radar---//
<br/>
inline void func_drawRadar(s16 var_x, s16 var_y)
<br/>
{
<br/>
    bool even_odd;//false is even, true is odd
<br/>
    u8 var_newX, var_newY, var_diffY, var_diffX;//temp variables
<br/>
    s16 var_curX, var_curY;//temp variables
<br/>
    
<br/>
    var_curX = ((var_x + 120) &gt;&gt; 3) - 18;
<br/>
    var_curY = (((var_y + 80) &gt;&gt; 3) - 18) &lt;&lt; 6;
<br/>
    
<br/>
    for(u8 a = 0; a &lt; 39; a++)//y
<br/>
    {
<br/>
        for(u8 b = 0; b &lt; 39; b++)//x
<br/>
        {
<br/>
            if((Tank_Out_Collision[var_snakeHeight][var_curX + var_curY + b] &amp; 16)  == 16)
<br/>
            {
<br/>
                if(((b &gt;&gt; 1)&lt;&lt; 1) == b)
<br/>
                {even_odd = false;}
<br/>
                else
<br/>
                {even_odd = true;}
<br/>
                
<br/>
                var_newX = (b &gt;&gt; 3);//divide by eight 
<br/>
                var_newY = (a &gt;&gt; 3);//divide by eight
<br/>
                var_diffX = b - (var_newX &lt;&lt; 3);//obtain the reminder
<br/>
                var_diffY = a - (var_newY &lt;&lt; 3);//obtain the reminder
<br/>
                
<br/>
                if(even_odd==false)
<br/>
                {
<br/>
                    radar[(var_newY &lt;&lt; 8)+(var_diffY &lt;&lt; 2) + 
<br/>
                        (var_newX &lt;&lt; 5) + (var_diffX &gt;&gt; 1)] |= 128;
<br/>
                }
<br/>
                else
<br/>
                {
<br/>
                    radar[(var_newY &lt;&lt; 8)+(var_diffY &lt;&lt; 2) + 
<br/>
                        (var_newX &lt;&lt; 5) + (var_diffX &gt;&gt; 1)] |= 32768;
<br/>
                }
<br/>
            }
<br/>
        }
<br/>
        var_curY+=64;
<br/>
    }
<br/>
    radar[585] |= 129;
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
Thnaks in advance<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12231 - sajiimori - Tue Nov 04, 2003 9:44 pm</h4>
    <div class="postbody"><span class="postbody">I don't understand the purpose of these calculations:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
var_newX = (b &gt;&gt; 3);
<br/>
var_diffX = b - (var_newX &lt;&lt; 3);
<br/>
(var_newX &lt;&lt; 5) + (var_diffX &gt;&gt; 1)
<br/>
</td> </tr></table><span class="postbody">
<br/>
Here are some other ways of doing the same thing:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
var_diffX = b &amp; 7;
<br/>
(b &gt;&gt; 3 &lt;&lt; 5) + (var_diffX &gt;&gt; 1)
<br/>
<br/>
// or...
<br/>
<br/>
((b &amp; ~7) &lt;&lt; 2) + ((b &amp; 7) &gt;&gt; 1)
<br/>
</td> </tr></table><span class="postbody">
<br/>
Why would you clear the low 3 bits of a number, shift it left 2 bits, then add the low 3 bits back in except shifted right 1 bit?  I am just as confused about the calculations for the 'a' component.
<br/>
<br/>
Anyway, without understanding that, my contribution is limited to simple optimizations (I also renamed a lot of variables to aid readability).  I also don't know what kinds of arrays 'radar' and 'Tank_Out_Collision' are, so I can't make optimizations using pointers (which are potentially huge).
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void func_drawRadar(int arg_x, int arg_y)
<br/>
{
<br/>
    register int x, y_part;
<br/>
    int y, curX, curY, curSum;
<br/>
<br/>
    curX = ((arg_x + 120) &gt;&gt; 3) - 18;
<br/>
    curY = (((arg_y + 80) &gt;&gt; 3) - 18) &lt;&lt; 6;
<br/>
    curSum = curX + curY;
<br/>
<br/>
    for(y = 0; y &lt; 39; y++)
<br/>
    {
<br/>
        y_part = (y &gt;&gt; 3 &lt;&lt; 8) + ((y &amp; 7) &lt;&lt; 2);
<br/>
<br/>
        for(x = 0; x &lt; 39; x++)
<br/>
        {
<br/>
            if(Tank_Out_Collision[var_snakeHeight][curSum + x] &amp; 16)
<br/>
            {
<br/>
                radar[y_part + (x &gt;&gt; 3 &lt;&lt; 5) + ((x &amp; 7) &gt;&gt; 1)] |=
<br/>
                    x &amp; 1 ? 32768 : 128;
<br/>
            }
<br/>
        }
<br/>
        curSum+=64;
<br/>
    }
<br/>
    radar[585] |= 129;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
I think this code could be much, much faster if I had more information.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12232 - yaustar - Tue Nov 04, 2003 10:14 pm</h4>
    <div class="postbody"><span class="postbody">I try to explain as best as I can. The collision layer is a plain simple array, left to right and the next row down. The radar is done as a 64x64 sprite which is loaded  in a completely different way.
<br/>
<br/>
This:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
if(((b &gt;&gt; 1)&lt;&lt; 1) == b)
<br/>
                {even_odd = false;}
<br/>
                else
<br/>
                {even_odd = true;}
<br/>
               
<br/>
                var_newX = (b &gt;&gt; 3);//divide by eight
<br/>
                var_newY = (a &gt;&gt; 3);//divide by eight
<br/>
                var_diffX = b - (var_newX &lt;&lt; 3);//obtain the reminder
<br/>
                var_diffY = a - (var_newY &lt;&lt; 3);//obtain the reminder
<br/>
               
<br/>
                if(even_odd==false)
<br/>
                {
<br/>
                    radar[(var_newY &lt;&lt; 8)+(var_diffY &lt;&lt; 2) +
<br/>
                        (var_newX &lt;&lt; 5) + (var_diffX &gt;&gt; 1)] |= 128;
<br/>
                }
<br/>
                else
<br/>
                {
<br/>
                    radar[(var_newY &lt;&lt; 8)+(var_diffY &lt;&lt; 2) +
<br/>
                        (var_newX &lt;&lt; 5) + (var_diffX &gt;&gt; 1)] |= 32768;
<br/>
                } 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Was used to find the right value to edit within the spriteaccording to the collision layer.  'radar' is just a [4096] array which when finished edited is DMAed into the memory and Tank_out_Collision is also a [4096].<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12233 - yaustar - Tue Nov 04, 2003 10:30 pm</h4>
    <div class="postbody"><span class="postbody">No luck, it still goes at the same speed as ever. I think it may have something to do with the fact that the function is called once per Vblank doing something 39*39 times :(
<br/>
However I am intrerested what this line means
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
radar[y_part + (x &gt;&gt; 3 &lt;&lt; 5) + ((x &amp; 7) &gt;&gt; 1)] |=
<br/>
                    x &amp; 1 ? 32768 : 128; 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
mainly the ~, ? and :<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12234 - jma - Wed Nov 05, 2003 12:05 am</h4>
    <div class="postbody"><span class="postbody">I'm working on more optimizations for you, but here are some biggies right away (to get rid of bad conditionals):
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
if(((b &gt;&gt; 1)&lt;&lt; 1) == b) 
<br/>
{even_odd = false;} 
<br/>
else 
<br/>
{even_odd = true;} </td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
Change this to:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">even_odd = b &amp; 1;</td> </tr></table><span class="postbody">
<br/>
Also, don't do:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code"> if(even_odd==false) 
<br/>
{ 
<br/>
     radar[(var_newY &lt;&lt; 8)+(var_diffY &lt;&lt; 2) + 
<br/>
         (var_newX &lt;&lt; 5) + (var_diffX &gt;&gt; 1)] |= 128; 
<br/>
} 
<br/>
else 
<br/>
{ 
<br/>
     radar[(var_newY &lt;&lt; 8)+(var_diffY &lt;&lt; 2) + 
<br/>
         (var_newX &lt;&lt; 5) + (var_diffX &gt;&gt; 1)] |= 32768; 
<br/>
} </td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
Instead do:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int adder[2] = { 32768, 128 };
<br/>
...
<br/>
radar[(var_newY &lt;&lt; 8)+(var_diffY &lt;&lt; 2) + 
<br/>
         (var_newX &lt;&lt; 5) + (var_diffX &gt;&gt; 1)] |= adder[even_odd];</td> </tr></table><span class="postbody">
<br/>
Also, for your remainder calculations, do this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">var_diffX &amp;= 7;
<br/>
var_diffY &amp;= 7;
<br/>
</td> </tr></table><span class="postbody">
<br/>
See what that does right now. But the <span style="font-weight: bold">best</span> optimization you can make is in getting rid of that damn 39*39 loop... see if you can crunch that down some. I'm sure not all 1600 indexes need updating each frame. Instead, try having a flag to state whether one needs updating or not.
<br/>
<br/>
Jeff<br/>_________________<br/><a href="mailto:massung@gmail.com">massung@gmail.com</a>
<br/>
<a href="http://www.retrobyte.org" target="_blank">http://www.retrobyte.org</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12235 - yaustar - Wed Nov 05, 2003 12:19 am</h4>
    <div class="postbody"><span class="postbody">Not much difference but I have a feeling it help in the long (thanks guys).
<br/>
<br/>
The 39*39 loop is the most annoying thing, but I will still have to use it at least once every eight cycles (giving for constant movement in one direction) Would this make much of a difference in terms of performence?<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12236 - jma - Wed Nov 05, 2003 12:24 am</h4>
    <div class="postbody"><span class="postbody">Well, here is some modified code (but keeping var names, etc):
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">inline void func_drawRadar(s16 var_x, s16 var_y) 
<br/>
{ 
<br/>
int b,adder[2] = { 32768,128 };
<br/>
register u8 var_newX, var_newY, var_diffY, var_diffX;
<br/>
s16 var_curX, var_curY;//temp variables 
<br/>
    
<br/>
var_curX = ((var_x + 120) &gt;&gt; 3) - 18; 
<br/>
var_curY = (((var_y + 80) &gt;&gt; 3) - 18) &lt;&lt; 6; 
<br/>
    
<br/>
for(u8 a = 0; a &lt; 39; a++)//y 
<br/>
{ 
<br/>
   for(u8 b = 0; b &lt; 39; b++)//x 
<br/>
   { 
<br/>
       if((Tank_Out_Collision[var_snakeHeight][var_curX + var_curY + b] &amp; 16)  == 16) 
<br/>
       {
<br/>
   var_newX = (b &lt;&lt; 5) &amp; (~0x7); // div 8 mask 3 bits
<br/>
   var_newY = (a &lt;&lt; 2) &amp; (~0x7); // div 8 mask 3 bits
<br/>
<br/>
   var_diffX = (var_diffX &amp; 7) &gt;&gt; 1; // rem / 2
<br/>
   var_diffY = (var_diffY &amp; 7) &lt;&lt; 2; // rem * 4
<br/>
<br/>
   // speedy if in registers
<br/>
   var_newX += var_diffX;
<br/>
   var_newY += var_diffY;
<br/>
<br/>
   radar[var_newY + var_newX] = adder[b &amp; 1];
<br/>
        } 
<br/>
    } 
<br/>
   var_curY+=64; 
<br/>
} 
<br/>
radar[585] |= 129; 
<br/>
}</td> </tr></table><span class="postbody">
<br/>
If you email a screenshot of the effect, perhaps more help on limitting your loop would be possible. Good luck!
<br/>
<br/>
Jeff<br/>_________________<br/><a href="mailto:massung@gmail.com">massung@gmail.com</a>
<br/>
<a href="http://www.retrobyte.org" target="_blank">http://www.retrobyte.org</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12237 - yaustar - Wed Nov 05, 2003 12:28 am</h4>
    <div class="postbody"><span class="postbody">I email you the bins, one without the radar and one with. :)<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12238 - sajiimori - Wed Nov 05, 2003 2:48 am</h4>
    <div class="postbody"><span class="postbody">yaustar,
<br/>
<br/>
? and : constitute the conditional operator.  "a ? b : c" means "if a then b else c".  ~ is the bitwise inverse operator.
<br/>
<br/>
Your code is slow due to the complexity of the code inside the loop.  It is perfectly possible to do a 39*39 loop every frame, as long as the body of the loop is simple enough.
<br/>
<br/>
jma's code incorporates some of my optimizations, but not all.  The 'adder' array is just obfuscation and does not make the code faster.  Also, be careful because some of his code is not equivalent to yours.
<br/>
<br/>
Your explanations are somewhat incomplete, because you do not describe the actual types of your arrays.  I gather that 'radar' is a u8[], but I still don't know the type of Tank_Out_Collision.
<br/>
<br/>
I still think your math is very odd.  If you could explain exactly how your algorithm is supposed to work, I might be able to help you more.  Until then, I'm at a loss.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12239 - sajiimori - Wed Nov 05, 2003 3:30 am</h4>
    <div class="postbody"><span class="postbody">Why can't you do something like this?  It should run plenty fast.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void draw_radar(int map_x, map_y)
<br/>
{
<br/>
    register u8* tile = &amp;Tank_Out_Collision[var_snakeHeight]
<br/>
                [
<br/>
                    ((map_x + 120) &gt;&gt; 3) - RADAR_WIDTH/2 +
<br/>
                    ((((map_y + 80) &gt;&gt; 3) - RADAR_HEIGHT/2) &lt;&lt; 6)
<br/>
                ];
<br/>
<br/>
    register u8* pixel = radar;
<br/>
<br/>
    for(int y = 0; y &lt; RADAR_HEIGHT; ++y)
<br/>
    {
<br/>
        for(int x = 0; x &lt; RADAR_WIDTH; ++x)
<br/>
        {
<br/>
            if(*tile++ &amp; SOLID_BIT)
<br/>
                *pixel++ = SOLID_COLOR;
<br/>
            else
<br/>
                *pixel++ = CLEAR_COLOR;
<br/>
        }
<br/>
<br/>
        pixel += 64 - RADAR_WIDTH;
<br/>
        tile += MAP_WIDTH - RADAR_WIDTH;
<br/>
    }
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12244 - yaustar - Wed Nov 05, 2003 2:06 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
const u16 Tank_Out_Collision[3][4096] //colllision layer (64x64)
<br/>
const u16 radarBlank[2048] /sprite (64x64)
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Basically, all that code in that loop is to work out where the pixel I want to edit is stored within the data array of radar which is stored in a pian in the ass way to edit (8x8 pixel blocks).
<br/>
<br/>
I dont see how this would work though
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
for(int x = 0; x &lt; RADAR_WIDTH; ++x)
<br/>
        {
<br/>
            if(*tile++ &amp; SOLID_BIT)
<br/>
                *pixel++ = SOLID_COLOR;
<br/>
            else
<br/>
                *pixel++ = CLEAR_COLOR;
<br/>
        }
<br/>
<br/>
        pixel += 64 - RADAR_WIDTH;
<br/>
        tile += MAP_WIDTH - RADAR_WIDTH; 
<br/>
</td> </tr></table><span class="postbody">
<br/>
as  to transverse left to right  across a sprite, I would have move from 8x8 block of data to another every eight pixels.
<br/>
<br/>
Although saying that I could modify the loops slightly to adapt that... :/<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12246 - yaustar - Wed Nov 05, 2003 3:39 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
if(((b &gt;&gt; 1)&lt;&lt; 1) == b)
<br/>
                {even_odd = false;}
<br/>
                else
<br/>
                {even_odd = true;}
<br/>
</td> </tr></table><span class="postbody">check if it is odd or even
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">               
<br/>
                var_newX = (b &gt;&gt; 3);//divide by eight 
<br/>
                var_newY = (a &gt;&gt; 3);//divide by eight
<br/>
</td> </tr></table><span class="postbody">check which 8x8 block that the pixel is in
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
                var_diffX = b - (var_newX &lt;&lt; 3);//obtain the reminder
<br/>
                var_diffY = a - (var_newY &lt;&lt; 3);//obtain the reminder
<br/>
</td> </tr></table><span class="postbody">get the reminader which I use to access the right bit in a 8x8 block
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
                if(even_odd==false)
<br/>
                {
<br/>
                    radar[(var_newY &lt;&lt; 8)+(var_diffY &lt;&lt; 2) + 
<br/>
                        (var_newX &lt;&lt; 5) + (var_diffX &gt;&gt; 1)] |= 128;
<br/>
                }
<br/>
                else
<br/>
                {
<br/>
                    radar[(var_newY * 256)+(var_diffY * 4) + 
<br/>
                        (var_newX * 32) + (var_diffX / 2)] |= 32768;
<br/>
                }
<br/>
</td> </tr></table><span class="postbody">edit the pixel colour
<br/>
<br/>
var_newY * 256  (each 8*8pixel block has 32 data in it. A row of 8*8 blocks in a 64x64 sprite will therefore have 32*8 = 256 data)
<br/>
<br/>
var_diffY * 4  (each line in a 8*8 has 4 data)
<br/>
<br/>
var_newX * 32  (to hop to the next horizontal block of 8*8)
<br/>
<br/>
var_diffX / 2  (to access the pixel since each data represents teo pixels (256 color mode))[/code]
<br/>
<br/>
At the moment, the code stands as:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void func_drawRadar(s16 var_x, s16 var_y)
<br/>
{
<br/>
    register u8 var_newX, var_newY, var_diffY, var_diffX, a, b;//temp variables
<br/>
    s16 var_curX, var_curY;//temp variables
<br/>
   
<br/>
    var_curX = ((var_x + 120) &gt;&gt; 3) - 18;
<br/>
    var_curY = (((var_y + 80) &gt;&gt; 3) - 18) &lt;&lt; 6;
<br/>
    
<br/>
    register const u16* col_tile = &amp;Tank_Out_Collision[var_snakeHeight][var_curX + var_curY];
<br/>
       
<br/>
    for(a = 0; a &lt; 39; a++)//y
<br/>
    {
<br/>
        for(b = 0; b &lt; 39; b++)//x
<br/>
        {
<br/>
            if((*col_tile+b &amp; 16)  == 16)
<br/>
            {
<br/>
                var_newX = (b &gt;&gt; 3);//divide by eight
<br/>
                var_newY = (a &gt;&gt; 3);//divide by eight
<br/>
                var_diffX = b - (var_newX &lt;&lt; 3);//obtain the reminder
<br/>
                var_diffY = a - (var_newY &lt;&lt; 3);//obtain the reminder 
<br/>
                
<br/>
                radar[(var_newY &lt;&lt; 8)+(var_diffY &lt;&lt; 2) +
<br/>
                    (var_newX &lt;&lt; 5) + (var_diffX &gt;&gt; 1)] |= b &amp; 1 ? 32768 : 128;;
<br/>
            }
<br/>
        }
<br/>
        col_tile+=64;
<br/>
    }
<br/>
<br/>
    radar[585] |= 129;
<br/>
}</td> </tr></table><span class="postbody">
<br/>
but it comes out very wrong :(<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12254 - yaustar - Wed Nov 05, 2003 7:40 pm</h4>
    <div class="postbody"><span class="postbody">I have just tried something as simple as var++ and even then it is still as slow as hell (considering the stage that we are in the game). I just need a new idea to implement it.
<br/>
<br/>
Thanks for the help guys :)<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12257 - sajiimori - Wed Nov 05, 2003 8:35 pm</h4>
    <div class="postbody"><span class="postbody">Are you saying this runs slow?
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
for(a = 0; a &lt; 39; a++)
<br/>
        for(b = 0; b &lt; 39; b++)
<br/>
            var++;
<br/>
</td> </tr></table><span class="postbody">
<br/>
You might be doing something else wrong then.  A loop like that should run in way less than 1/60 of a second.  Are you trying to draw the radar and DMA it all within one vblank or something?
<br/>
<br/>
BTW, I understand your math now...I forgot that you wanted to DMA the radar straight into character RAM.  Just for fun, I'm still working on a fast (and correct) version.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12258 - yaustar - Wed Nov 05, 2003 8:36 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Are you saying this runs slow?
<br/>
Code:
<br/>
<br/>
for(a = 0; a &lt; 39; a++)
<br/>
        for(b = 0; b &lt; 39; b++)
<br/>
            var++;
<br/>
<br/>
You might be doing something else wrong then. A loop like that should run in way less than 1/60 of a second. Are you trying to draw the radar and DMA it all within one vblank or something? 
<br/>
</td> </tr></table><span class="postbody">
<br/>
yeah, how did you guess....:/
<br/>
<br/>
If you would like, I can send you the entire code to muck around with :)<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12260 - sajiimori - Wed Nov 05, 2003 9:36 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
yeah, how did you guess....:/ 
<br/>
</td> </tr></table><span class="postbody">
<br/>
Oh, you can't do that. ;-)  You should only do fast things during vblank, such as DMA copies.
<br/>
<br/>
Try organizing your program like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
main()
<br/>
{
<br/>
    init();
<br/>
<br/>
    while(1)
<br/>
    {
<br/>
        // these things happen during vdraw
<br/>
<br/>
        handle_input();
<br/>
        update_world();
<br/>
        draw_radar();
<br/>
        draw_other_graphics();
<br/>
<br/>
        wait_for_vsync();
<br/>
<br/>
        // these things happen during vblank
<br/>
<br/>
        copy_oam();
<br/>
        copy_radar();
<br/>
    }
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
Then try using an algorithm like this to draw the radar:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define CHAR_PITCH 8
<br/>
#define CHAR_HEIGHT 8
<br/>
#define CHAR_WIDTH 8
<br/>
#define CHAR_SIZE (CHAR_PITCH * CHAR_HEIGHT)
<br/>
#define RADAR_WIDTH 32
<br/>
#define RADAR_HEIGHT 32
<br/>
#define RPITCH (CHAR_SIZE * (RADAR_WIDTH/8))
<br/>
#define MAP_WIDTH 64
<br/>
<br/>
u8 radar[RADAR_WIDTH*RADAR_HEIGHT];
<br/>
<br/>
void draw_radar(int map_x, map_y)
<br/>
{
<br/>
    u16* tile_block = &amp;Tank_Out_Collision[var_snakeHeight]
<br/>
                [
<br/>
                    ((map_x + 120) &gt;&gt; 3) - RADAR_WIDTH/2 +
<br/>
                    (((map_y + 80) &gt;&gt; 3) - RADAR_HEIGHT/2) * MAP_WIDTH
<br/>
                ];
<br/>
<br/>
    for(u8* row = radar, u8* radar_end = radar + RADAR_HEIGHT*RADAR_WIDTH;
<br/>
        row &lt; radar_end; row += RPITCH)
<br/>
    {
<br/>
        for(u8* chr = row, u8* row_end = row + RPITCH;
<br/>
            chr &lt; row_end; chr += CHAR_SIZE)
<br/>
        {
<br/>
            u16* tile_row = tile_block;
<br/>
<br/>
            for(u8* strip = chr, u8* chr_end = chr + CHAR_SIZE;
<br/>
                strip &lt; chr_end; strip += CHAR_PITCH)
<br/>
            {
<br/>
                register u16* tile = tile_row;
<br/>
<br/>
                for(register u8* pixel = strip,
<br/>
                    register u8* strip_end = strip + CHAR_PITCH;
<br/>
                    pixel &lt; strip_end; ++pixel)
<br/>
                {
<br/>
                    if(*tile++ &amp; SOLID_BIT)
<br/>
                        *pixel = SOLID_COLOR;
<br/>
                    else
<br/>
                        *pixel = CLEAR_COLOR;
<br/>
                }
<br/>
<br/>
                tile_row += MAP_WIDTH;
<br/>
            }
<br/>
<br/>
            tile_block += CHAR_SIZE;
<br/>
        }
<br/>
<br/>
        tile_block += (MAP_WIDTH - RADAR_WIDTH) * CHAR_HEIGHT;
<br/>
    }
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
The reason this code is fast is because the innermost loop is very simple.
<br/>
<br/>
The general idea here is to simultaneously "step through" the radar and collision map using pointers.  That way, you don't have to recalculate array indexes for each pixel.
<br/>
<br/>
The loops are organized around walking through the radar sprite: first through rows of characters, then characters, then rows of pixels, and finally individual pixels.
<br/>
<br/>
The tile pointers play an auxiliary role, being created and advanced through the collision map within the bodies of the loops.  "tile_block" points to the top left of a block of 8x8 map tiles (corresponding to a sprite character), "tile_row" is the beginning of a row in such a block, and "tile" points to an individual tile.
<br/>
<br/>
Only the variables used in the innermost loop should be declared "register".  Inlining the function is unnecessary.  The 'radar' array should be u8[].  I changed the radar size to 32x32, but it should work with other sizes.
<br/>
<br/>
This code is untested.  It may not even compile.  One problem with it is that it will gladly run off the edge of the collision map.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12261 - yaustar - Wed Nov 05, 2003 9:42 pm</h4>
    <div class="postbody"><span class="postbody">well this is my while loop as it stands:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
while(1)
<br/>
    {
<br/>
        func_getInput(var_x, var_y, str_snakeSprite.spr_no, var_anim_delay, str_guardSprite);
<br/>
        
<br/>
        REG_DM3SAD = (u32)radarBlank;//source of data
<br/>
        REG_DM3DAD = (u32)radar;//target for data
<br/>
        REG_DM3CNT = (2048 | DMA_16NOW);//start copying NOW, in 16bit values
<br/>
        
<br/>
        func_drawRadar(var_x, var_y);
<br/>
        
<br/>
        /*for(var_loop = 1536; var_loop &lt; 3584; var_loop++) //96   = radar
<br/>
           {OAMData[var_loop] = radar[var_loop-1536];}*/
<br/>
        REG_DM3SAD = (u32)radar;//source of data
<br/>
        REG_DM3DAD = (u32)&amp;OAMData[1536];//target for data
<br/>
        REG_DM3CNT = (2048 | DMA_16NOW);//start copying NOW, in 16bit values
<br/>
       
<br/>
        //update backgrounds values
<br/>
        str_bgLayer[0].x_scroll = str_bgLayer[1].x_scroll = str_bgLayer[2].x_scroll = var_x;
<br/>
        str_bgLayer[0].y_scroll = str_bgLayer[1].y_scroll = str_bgLayer[2].y_scroll = var_y;        
<br/>
        
<br/>
        func_guardMove(str_guardSprite);
<br/>
<br/>
        sprites[0].attribute2 = str_snakeSprite.spr_no | PRIORITY(func_checkOverlay(0, var_x, var_y));//set priority to 2;
<br/>
<br/>
       func_moveSprite(&amp;sprites[1], str_guardSprite.x, str_guardSprite.y);
<br/>
<br/>
/**/    UpdateBackground(&amp;str_bgLayer[0]);
<br/>
/**/    UpdateBackground(&amp;str_bgLayer[1]);
<br/>
/**/    UpdateBackground(&amp;str_bgLayer[2]);
<br/>
<br/>
        WAIT_VSYNC();
<br/>
<br/>
        //func_copyOAM();         //Copies sprite array into OAM.
<br/>
        REG_DM3SAD = (u32)sprites;
<br/>
        REG_DM3DAD = (u32)OAM;
<br/>
        REG_DM3CNT = 512 | DMA_16NOW;
<br/>
    }
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
One thing that my compilar did not like in your prevouis code was :
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
 u16* tile_block = &amp;Tank_Out_Collision[var_snakeHeight]
<br/>
                [
<br/>
                    ((map_x + 120) &gt;&gt; 3) - RADAR_WIDTH/2 +
<br/>
                    (((map_y + 80) &gt;&gt; 3) - RADAR_HEIGHT/2) * MAP_WIDTH
<br/>
                ]; 
<br/>
</td> </tr></table><span class="postbody">
<br/>
it gave the error that it cannot convert u16* to u16. Something about the map being a 'const' i think.
<br/>
<br/>
I try out the code when I get a chance to fully study it. Thanks :)<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12262 - sajiimori - Wed Nov 05, 2003 9:57 pm</h4>
    <div class="postbody"><span class="postbody">Oh, I thought you were doing all that work from the vblank interrupt or something.  Anyway, it still seems to me that something is wrong if you can't run a simple loop within one frame.  Another thing you'll probably want to do is put the function in IWRAM.
<br/>
<br/>
So I guess radarBlank has some background picture?  Is that really necessary?
<br/>
<br/>
If the error you got was about converting u16* to u16, then it wasn't about constness.  That line looks fine to me...</span><span class="gensmall"><br/><br/>Last edited by sajiimori on Wed Nov 05, 2003 10:00 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#12263 - yaustar - Wed Nov 05, 2003 10:00 pm</h4>
    <div class="postbody"><span class="postbody">It is too bascically, 'erase' the entire sprite to transperent. So as a result I draw only the visable walls etc to the radar since DMA is faster then for loops.
<br/>
<br/>
IWRAM, heard of it, dont have a clue what the heck it is :/
<br/>
<br/>
edit: Internal work ram :p<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12264 - sajiimori - Wed Nov 05, 2003 10:08 pm</h4>
    <div class="postbody"><span class="postbody">You don't need a whole array of zeros just to clear a block of memory.  The DMA registers can be set up to copy a single value across a range.
<br/>
<br/>
Anyway, yes, DMA is faster than loops, but you are looping over the whole radar anyway.  There is no avoiding the loop, so you may as well ditch the useless DMA transfer.
<br/>
<br/>
You can read all about the gba's memory architecture in the various tutorials and hardware specs out there.
<br/>
<br/>
If the function is still not fast enough, try updating only a portion of the radar each frame.  For a 32x32 radar, it would still only take 16 frames to update the whole thing one character at a time.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12265 - yaustar - Wed Nov 05, 2003 10:12 pm</h4>
    <div class="postbody"><span class="postbody">How do 'use' the function to work with the IWRAM and what ram is it using at the moment  (by default)?<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12266 - sajiimori - Wed Nov 05, 2003 11:04 pm</h4>
    <div class="postbody"><span class="postbody">Code is normally in ROM.  This is one way to put a function in IWRAM:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void __attribute__((section(".iwram"))) function() { }
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12267 - sajiimori - Wed Nov 05, 2003 11:08 pm</h4>
    <div class="postbody"><span class="postbody">BTW, your idea of clearing out the radar before rendering it might be faster if most areas of the map are not solid.  If that's the case, fix your DMA so it copies a single value instead of a whole block of memory.  If you decide to render a character at a time, you'll obviously only want to clear the character you're about to draw.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12269 - yaustar - Wed Nov 05, 2003 11:12 pm</h4>
    <div class="postbody"><span class="postbody">would I be able to do this
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define IN_INRAM __attribute__ ((section (".iwram"))) </td> </tr></table><span class="postbody">
<br/>
and then do this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void IN_INRAM function() {   }</td> </tr></table><span class="postbody"><br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12270 - sajiimori - Wed Nov 05, 2003 11:17 pm</h4>
    <div class="postbody"><span class="postbody">Also, I just realized that the code I posted earlier won't work if the radar is not the same size as the sprite that it will be copied to.  If you do it this way you should be able to make the radar any size less than 64x64:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define RADAR_WIDTH (whatever)
<br/>
#define RADAR_HEIGHT (whatever)
<br/>
#define RADAR_SPRITE_WIDTH 64
<br/>
#define RADAR_SPRITE_HEIGHT 64
<br/>
#define RPITCH (CHAR_SIZE * (RADAR_SPRITE_WIDTH/8))
<br/>
<br/>
u8 radar[RADAR_SPRITE_WIDTH*RADAR_HEIGHT];
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12272 - sajiimori - Wed Nov 05, 2003 11:19 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
would I be able to do this 
<br/>
</td> </tr></table><span class="postbody">
<br/>
Why don't ya try it instead of asking me??  ^_^</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12273 - yaustar - Wed Nov 05, 2003 11:28 pm</h4>
    <div class="postbody"><span class="postbody">:p 
<br/>
heh...signs of a newbie (damn I got to get rid of these)<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12314 - yaustar - Fri Nov 07, 2003 10:49 pm</h4>
    <div class="postbody"><span class="postbody">okay, I am getting these errors:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
register u16* var_tile = &amp;Tank_Out_Collision[var_snakeHeight]
<br/>
        [
<br/>
            ((var_x + 120) &gt;&gt; 3) - 20 +
<br/>
            (((var_y + 80) &gt;&gt; 3) - 20) * 64
<br/>
        ];//pointer to the collision tile
<br/>
<br/>
invalid conversion from `const u16*' to `u16*'
<br/>
<br/>
register u8* var_pixel = &amp;radar[0];//pointer to radar sprite
<br/>
<br/>
165 C:\DOCUME~1\YAUSTA~1\MYDOCU~1\MYPROJ~1\Code\BG_DMA\main.cpp
<br/>
cannot convert `u16*' to `u8*' in initialization
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12315 - tepples - Fri Nov 07, 2003 11:24 pm</h4>
    <div class="postbody"><span class="postbody">C++ is a bit pickier with pointers than C is. You may have to compare your source code against the header files you use. Some of the gba.h files floating around the Internet are not const-correct, not void *-correct, or neither.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12317 - yaustar - Fri Nov 07, 2003 11:28 pm</h4>
    <div class="postbody"><span class="postbody">I have the one by Eloist (gba.h), what am I looking for in the gba files?<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12322 - sajiimori - Sat Nov 08, 2003 12:25 am</h4>
    <div class="postbody"><span class="postbody">Fix the first error by declaring var_tile const.  Do the same for all other tile pointers as well.
<br/>
<br/>
The second error is because I changed your <b style="color:#FFA34F">radar</b> array to u8[], but I guess you didn't change it accordingly.  Is there some reason you wanted it to be u16[]?
<br/>
<br/>
Do you have a book on C++?  You'll want some sort of reference that will help you solve these sorts of problems on your own.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12455 - yaustar - Fri Nov 14, 2003 3:46 pm</h4>
    <div class="postbody"><span class="postbody">Here is the new version of the code:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void func_drawRadar(s16 var_x, s16 var_y) 
<br/>
{
<br/>
    register u16 var_newX, var_newY, var_diffY, var_diffX;//temp variables
<br/>
    register int var_curSum;
<br/>
        
<br/>
    //var_curX = ((var_x + 120) &gt;&gt; 3) - 18;
<br/>
    var_x += 120;
<br/>
    var_x = var_x &gt;&gt; 3;
<br/>
    var_x -= 18;
<br/>
    
<br/>
    //var_curY = (((var_y + 80) &gt;&gt; 3) - 18) &lt;&lt; 6;
<br/>
    var_y +=80;
<br/>
    var_y = var_y &gt;&gt; 3;
<br/>
    var_y -= 18;
<br/>
    var_y = var_y &lt;&lt; 6;
<br/>
    
<br/>
    var_curSum = var_x + var_y;
<br/>
   
<br/>
    for(register u8 y = 0; y &lt; 39; y++)//y
<br/>
    {
<br/>
        var_newY = y &lt;&lt; 5;
<br/>
        var_newY &amp;= ~255;
<br/>
        var_diffY = y &amp; 7;//obtain the reminder
<br/>
        var_diffY = var_diffY &lt;&lt; 2;
<br/>
        var_newY += var_diffY;
<br/>
        
<br/>
        for(register u8 x = 0; x &lt; 39; x++)//x
<br/>
        {
<br/>
            if((Tank_Out_Collision[var_snakeHeight][var_curSum + x] &amp; 16)  == 16)
<br/>
            {
<br/>
                var_newX = x &lt;&lt; 2;
<br/>
                var_newX &amp;= ~31;
<br/>
                var_diffX = x &amp; 7;//obtain the reminder
<br/>
                var_diffX = var_diffX &gt;&gt; 1;
<br/>
                var_newX += var_diffX;
<br/>
               
<br/>
                <b style="color:#FFA34F">radar</b>[var_newY + var_newX] |= x &amp; 1 ? 32768 : 128;            
<br/>
            }
<br/>
        }
<br/>
        var_curSum+=64;
<br/>
    }
<br/>
    <b style="color:#FFA34F">radar</b>[585] |= 129;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
It is not put in IWRAM yet because I want to check out the speed<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12458 - sajiimori - Fri Nov 14, 2003 8:07 pm</h4>
    <div class="postbody"><span class="postbody">I suspect the code will be roughly the same speed as it was before.  You did not incorporate the most important optimization: avoiding the recalculation of array indexes on every pixel.  All the other optimizations are insignificant in comparison.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12459 - yaustar - Fri Nov 14, 2003 9:27 pm</h4>
    <div class="postbody"><span class="postbody">yeah, I would kinda of figured that :/
<br/>
I figure I need to get rid of this code somewhere
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
                var_newX = x &lt;&lt; 2;
<br/>
                var_newX &amp;= ~31;
<br/>
                var_diffX = x &amp; 7;//obtain the reminder
<br/>
                var_diffX = var_diffX &gt;&gt; 1;
<br/>
                var_newX += var_diffX;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
at the moment I am optimising this code a bit at a time so I dont run into any unexpected errors.
<br/>
Another for loop would be needed to help transverse across the sprite.
<br/>
Hopefully shouldn't be too hard ;)<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12465 - sajiimori - Sat Nov 15, 2003 3:24 am</h4>
    <div class="postbody"><span class="postbody">Your overall approach is inefficient, and you won't be able to make it efficient by making a series of small changes.
<br/>
<br/>
Let me be frank here:  Do you know how to use pointer arithmetic?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12471 - yaustar - Sat Nov 15, 2003 2:36 pm</h4>
    <div class="postbody"><span class="postbody">Not very well, but every time I used them in this code it kept coming up with errors that made no sense.
<br/>
<br/>
At the moment, the way I understand it is if I use a u8 pointer to transverse through a u16 array of 2048 length, then I would accessing 8 bits at a time and therefore be going through 4096 times to complete transverse through it.
<br/>
<br/>
If I am wrong them please correct me..
<br/>
<br/>
edit: forget that, it does not relate to what we are doing here. I giving the pointer stuff another shot at tne moment now that I have a clear head and a bigger insight of what my <b style="color:#FFA34F">radar</b> is doing I *should* be able to pull it off :)<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12472 - yaustar - Sat Nov 15, 2003 3:38 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
IN_IWRAM void func_drawRadar(s16 var_x, s16 var_y) 
<br/>
//void func_drawRadar(s16 var_x, s16 var_y) 
<br/>
{
<br/>
    register u16 var_newX, var_newY, var_diffY, var_diffX;//temp variables
<br/>
    register int var_curSum;
<br/>
    register u8 var_collInc = 0;
<br/>
    //register const u16* pointerRadar = &amp;<b style="color:#FFA34F">radar</b>[0];
<br/>
        
<br/>
    //var_curX = ((var_x + 120) &gt;&gt; 3) - 18;
<br/>
    var_x += 120;
<br/>
    var_x = var_x &gt;&gt; 3;
<br/>
    var_x -= 18;
<br/>
    
<br/>
    //var_curY = (((var_y + 80) &gt;&gt; 3) - 18) &lt;&lt; 6;
<br/>
    var_y +=80;
<br/>
    var_y = var_y &gt;&gt; 3;
<br/>
    var_y -= 18;
<br/>
    var_y = var_y &lt;&lt; 6;
<br/>
    
<br/>
    var_curSum = var_x + var_y;
<br/>
   
<br/>
    for(register u8 y = 0; y &lt; 39; y++)//y
<br/>
    {
<br/>
        var_newY = y &lt;&lt; 6;
<br/>
        var_newY &amp;= ~511;
<br/>
        var_diffY = y &amp; 7;//obtain the reminder
<br/>
        var_diffY &lt;&lt;= 3;
<br/>
        var_newY += var_diffY;
<br/>
        
<br/>
        for(register u8 xOuter = 0; xOuter &lt; 320; xOuter+=64)//x block
<br/>
        {
<br/>
            for(register u8 xInner = 0; xInner &lt; 8; xInner++)//x reminder
<br/>
            {       
<br/>
                if((Tank_Out_Collision[var_snakeHeight][var_curSum + var_collInc] &amp; 16)  == 16)
<br/>
                {
<br/>
                    var_newX = xInner + xOuter;
<br/>
                    var_newX += var_newY;
<br/>
                   
<br/>
                    <b style="color:#FFA34F">radar</b>[var_newX] = 128;
<br/>
                }
<br/>
                var_collInc++;
<br/>
            }
<br/>
        }
<br/>
        var_curSum+=64;
<br/>
        var_collInc = 0;
<br/>
    }
<br/>
    <b style="color:#FFA34F">radar</b>[1170] = 129;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
slowly getting there, I am beginning to understand how your code works on page two but hit a slight snag, my sprites have disappeared and not sure why :/ I think an infinite loop is happening somewhere
<br/>
<br/>
btw the <b style="color:#FFA34F">radar</b> is an u8 now
<br/>
<br/>
edit: me idiot
<br/>
u8 = 0-255
<br/>
for(u8&lt; 320)<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"><br/><br/>Last edited by yaustar on Sat Nov 15, 2003 6:02 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#12476 - yaustar - Sat Nov 15, 2003 5:59 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
    for(register u16 yOuter = 0; yOuter &lt; 2560; yOuter+=512)//y block
<br/>
    {
<br/>
        for(register u8 yInner = 0; yInner &lt; 64; yInner+=8)//y reminder
<br/>
        {
<br/>
            var_newY = yInner + yOuter;//5*8 = 40 times
<br/>
            for(register u16 xOuter = 0; xOuter &lt; 320; xOuter+=64)//x block
<br/>
            {
<br/>
                for(register u8 xInner = 0; xInner &lt; 8; xInner++)//x reminder
<br/>
                {       
<br/>
                    if((Tank_Out_Collision[var_snakeHeight][var_curSum + var_collInc] 
<br/>
                        &amp; 16) == 16)
<br/>
                    {
<br/>
                        var_newX = xInner + xOuter;
<br/>
                        var_newX += var_newY;
<br/>
                       
<br/>
                        <b style="color:#FFA34F">radar</b>[var_newX] = 128;
<br/>
                    }
<br/>
                    var_collInc++;//1600 times
<br/>
                }
<br/>
            }
<br/>
            var_curSum += 64;
<br/>
            var_collInc = 0;
<br/>
        }
<br/>
    }
<br/>
</td> </tr></table><span class="postbody">
<br/>
without using pointers, this is as best as I can get it (it doesn't quite work, not yet anyway) Still a bit jubious how pointers would make this faster though if you care to explain :/
<br/>
<br/>
edit: fixed it.<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12482 - sajiimori - Sat Nov 15, 2003 9:29 pm</h4>
    <div class="postbody"><span class="postbody">Jubious?? heheh
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
if you care to explain :/
<br/>
</td> </tr></table><span class="postbody">
<br/>
Sure, I'll give it a shot.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void abc()
<br/>
{
<br/>
    for(int i = 0; i &lt; 20; ++i)
<br/>
    {
<br/>
        f();
<br/>
<br/>
        for(int j = 0; j &lt; 10; ++j)
<br/>
            g();
<br/>
    }
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
Q: If f() takes 200 CPU cycles to execute, how many cycles are spent in f() while abc() runs?
<br/>
<br/>
A: Since f() is called 20 times, 4000 cycles are spent in f().
<br/>
<br/>
<br/>
Q: If g() takes 30 CPU cycles to execute, how many cycles are spent in g() while abc() runs?
<br/>
<br/>
A: Since g() is called 200 times, 6000 cycles are spent in g().
<br/>
<br/>
<br/>
Q: What happens to the execution speed of abc() if you optimize f() by 5 cycles?
<br/>
<br/>
A: abc() will execute 100 cycles faster.
<br/>
<br/>
<br/>
Q: What happens to the execution speed of abc() if you optimize g() by 5 cycles?
<br/>
<br/>
A: abc() will execute 1000 cycles faster.
<br/>
<br/>
<br/>
To optimize an algorithm, focus on the innermost loop because the most time is spent there.  Even if f() takes 200 cycles and g() only takes 30, you should still focus on g().
<br/>
<br/>
Here is your innermost loop (I've excluded the 'xInner &lt; 8; xInner++' part of the for loop, just for simplicity):
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
    if((Tank_Out_Collision[var_snakeHeight][var_curSum + var_collInc] 
<br/>
       &amp; 16) == 16) 
<br/>
    { 
<br/>
        var_newX = xInner + xOuter; 
<br/>
        var_newX += var_newY; 
<br/>
                        
<br/>
        <b style="color:#FFA34F">radar</b>[var_newX] = 128; 
<br/>
    } 
<br/>
    
<br/>
    var_collInc++;
<br/>
</td> </tr></table><span class="postbody">
<br/>
Here's a modified version that involves fewer operations (but it does not modify var_newX -- hopefully you didn't need it assigned to):
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
    if((Tank_Out_Collision[var_snakeHeight][var_curSum + var_collInc] 
<br/>
       &amp; 16) == 16) 
<br/>
    {
<br/>
        <b style="color:#FFA34F">radar</b>[xInner + xOuter + var_newY] = 128; 
<br/>
    }
<br/>
    
<br/>
    var_collInc++;
<br/>
</td> </tr></table><span class="postbody">
<br/>
Let's take a look at what kind of CPU operations will have to be performed each time this code is run.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
load           Tank_Out_Collision
<br/>
load           var_snakeHeight
<br/>
add            Tank_Out_Collision + var_snakeHeight
<br/>
dereference    *(Tank_Out_Collision + var_snakeHeight)
<br/>
load           var_curSum
<br/>
load           var_collInc
<br/>
add            var_curSum + var_collInc
<br/>
add            (*(Tank_Out_Collision + var_snakeHeight)) + var_curSum + var_collInc
<br/>
dereference    *((*(Tank_Out_Collision + var_snakeHeight)) + var_curSum + var_collInc)
<br/>
and            &amp; 16
<br/>
compare        == 16
<br/>
cond branch    if()
<br/>
<br/>
** The following is only executed for solid pixels **
<br/>
<br/>
load           <b style="color:#FFA34F">radar</b>
<br/>
load           xInner
<br/>
load           xOuter
<br/>
add            xInner + xOuter
<br/>
load           var_newY
<br/>
add            xInner + xOuter + var_newY
<br/>
add            <b style="color:#FFA34F">radar</b> + xInner + xOuter + var_newY
<br/>
load           128
<br/>
store          *(<b style="color:#FFA34F">radar</b> + xInner + xOuter + var_newY) = 128
<br/>
<br/>
** End conditional code **
<br/>
<br/>
load           collInc
<br/>
add            1
<br/>
store          collInc + 1
<br/>
</td> </tr></table><span class="postbody">
<br/>
Here is my innermost loop (with assigning the clear color removed, since you cleared the <b style="color:#FFA34F">radar</b> beforehand; I also replaced the #defined constants with your values; and like the earlier example, I excluded the 'pixel &lt; strip_end; ++pixel' part of the for loop):
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
    if(*tile++ &amp; 16)
<br/>
        *pixel = 128;
<br/>
</td> </tr></table><span class="postbody">
<br/>
Here's roughly what's involved:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
load           tile
<br/>
dereference    *tile
<br/>
add            1
<br/>
store          *tile + 1
<br/>
and            &amp; 16
<br/>
cond branch    if()
<br/>
<br/>
** The following is only executed for solid pixels **
<br/>
<br/>
load           pixel
<br/>
load           128
<br/>
store          *pixel = 128
<br/>
<br/>
** End conditional code **
<br/>
</td> </tr></table><span class="postbody">
<br/>
Alright, that's with no register variables.  For register variables, you can remove the 'load' and 'store' operations.  By putting xInner and xOuter in registers, yours looks like this (the top part is unchanged):
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
load           Tank_Out_Collision
<br/>
load           var_snakeHeight
<br/>
add            Tank_Out_Collision + var_snakeHeight
<br/>
dereference    *(Tank_Out_Collision + var_snakeHeight)
<br/>
load           var_curSum
<br/>
load           var_collInc
<br/>
add            var_curSum + var_collInc
<br/>
add            (*(Tank_Out_Collision + var_snakeHeight)) + var_curSum + var_collInc
<br/>
dereference    *((*(Tank_Out_Collision + var_snakeHeight)) + var_curSum + var_collInc)
<br/>
and            &amp; 16
<br/>
compare        == 16
<br/>
cond branch    if()
<br/>
<br/>
** The following is only executed for solid pixels **
<br/>
<br/>
load           <b style="color:#FFA34F">radar</b>
<br/>
add            xInner + xOuter
<br/>
load           var_newY
<br/>
add            xInner + xOuter + var_newY
<br/>
add            <b style="color:#FFA34F">radar</b> + xInner + xOuter + var_newY
<br/>
load           128
<br/>
store          *(<b style="color:#FFA34F">radar</b> + xInner + xOuter + var_newY) = 128
<br/>
<br/>
** End conditional code **
<br/>
<br/>
load           collInc
<br/>
add            1
<br/>
store          collInc + 1
<br/>
</td> </tr></table><span class="postbody">
<br/>
Here is mine with 'tile' and 'pixel' in registers:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
dereference    *tile
<br/>
add            1
<br/>
and            &amp; 16
<br/>
cond branch    if()
<br/>
<br/>
** The following is only executed for solid pixels **
<br/>
<br/>
load           128
<br/>
store          *pixel = 128
<br/>
<br/>
** End conditional code **
<br/>
</td> </tr></table><span class="postbody">
<br/>
Note that you cannot expect more than a few variables to be stored in registers.
<br/>
<br/>
So hopefully that explains why it's faster: it makes the inner loop simpler when you use pointers to keep track of where you are in the arrays.
<br/>
<br/>
Edit: noticed that 'pixel' doesn't have to be dereferenced because the value is never read.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12483 - yaustar - Sat Nov 15, 2003 9:47 pm</h4>
    <div class="postbody"><span class="postbody">Ah, I see now. (why wasnt I taught this at uni :/ )
<br/>
Pointers tend to 'tidy' the code up a bit and therefore saves the need to load all  the variables like snake height etc.
<br/>
<br/>
Now that I have the code in a better state then at the start, pointers should be an easy thing to incoprate (yeah right  (-.-;) )
<br/>
<br/>
Thanks for the help :)<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12484 - yaustar - Sat Nov 15, 2003 11:33 pm</h4>
    <div class="postbody"><span class="postbody">Slight update:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void func_drawRadar(s16 var_x, s16 var_y) 
<br/>
{
<br/>
    register u8* var_radarTile;//temp variables
<br/>
    register const u16* var_curSum;
<br/>
    //register const u16* pointerRadar = &amp;<b style="color:#FFA34F">radar</b>[0];
<br/>
        
<br/>
    //var_curX = ((var_x + 120) &gt;&gt; 3) - 18;
<br/>
    var_x += 120;
<br/>
    var_x = var_x &gt;&gt; 3;
<br/>
    var_x -= 18;
<br/>
    
<br/>
    //var_curY = (((var_y + 80) &gt;&gt; 3) - 18) &lt;&lt; 6;
<br/>
    var_y +=80;
<br/>
    var_y = var_y &gt;&gt; 3;
<br/>
    var_y -= 18;
<br/>
    var_y = var_y &lt;&lt; 6;
<br/>
    
<br/>
    var_curSum = &amp;Tank_Out_Collision[var_snakeHeight][var_x + var_y];
<br/>
   
<br/>
    for(u16 yOuter = 0; yOuter &lt; 2560; yOuter+=512)//y block, loops 5 times
<br/>
    {//gets called 5 times
<br/>
        for(u8 yInner = 0; yInner &lt; 64; yInner+=8)//y reminder, loops 8 tiems
<br/>
        {//gets called 40 times
<br/>
            var_radarTile = yInner + yOuter;//must be reset here
<br/>
            for(register u16 xOuter = 0; xOuter &lt; 320; xOuter+=64)//x block, loops 5 times
<br/>
            {//gets called 200 time
<br/>
                for(register u8 xInner = 0; xInner &lt; 8; xInner++)//x reminder. loops 8 times
<br/>
                {//gets called 1600 times
<br/>
                    if(*var_curSum++ &amp; 16)
<br/>
                    {                 
<br/>
                        *(var_radarTile + xInner) = 128;
<br/>
                    }
<br/>
                }
<br/>
                var_radarTile += 64;
<br/>
            }
<br/>
            var_curSum += 24;//64-40
<br/>
        }
<br/>
    }
<br/>
    <b style="color:#FFA34F">radar</b>[1170] = 129;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
but I get this error
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
132 C:\DOCUME~1\YAUSTA~1\MYDOCU~1\MYPROJ~1\Code\BG_DMA\main.cpp
<br/>
invalid conversion from `int' to `u8*'
<br/>
</td> </tr></table><span class="postbody">
<br/>
with this line
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
var_radarTile = yInner + yOuter;//must be reset here
<br/>
</td> </tr></table><span class="postbody">
<br/>
and not sure why<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12485 - sajiimori - Sat Nov 15, 2003 11:48 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
var_radarTile = yInner + yOuter;
<br/>
</td> </tr></table><span class="postbody">
<br/>
Of course it's an error (int + int != u8*).  I guess you were trying to calculate an offset, but an offset from what?
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
    //var_curX = ((var_x + 120) &gt;&gt; 3) - 18; 
<br/>
    var_x += 120; 
<br/>
    var_x = var_x &gt;&gt; 3; 
<br/>
    var_x -= 18; 
<br/>
    
<br/>
    //var_curY = (((var_y + 80) &gt;&gt; 3) - 18) &lt;&lt; 6; 
<br/>
    var_y +=80; 
<br/>
    var_y = var_y &gt;&gt; 3; 
<br/>
    var_y -= 18; 
<br/>
    var_y = var_y &lt;&lt; 6; 
<br/>
</td> </tr></table><span class="postbody">
<br/>
Why do you have single lines of code commented out and then replaced with multiple lines that do the same thing?  You created 9 lines of text where 2 would do.
<br/>
<br/>
Edit: BTW, don't do little optimizations like 'register' until you are done designing your algorithm.  They just make a mess.  Save fine-tuning until last.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12486 - yaustar - Sun Nov 16, 2003 12:12 am</h4>
    <div class="postbody"><span class="postbody">The 'turn 2 LOC' into 8 was an optimisation to lower the number of tempoary variables created during run time (read it somewhere).
<br/>
<br/>
Still dont fully understand the error, should I change it to a u16? Once I change it to anything else it starts to hate this line 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
var_radarTile = &amp;<b style="color:#FFA34F">radar</b>[0];
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
It is not so much of an offset but more of a restart point y wise.
<br/>
[/code]<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12487 - tepples - Sun Nov 16, 2003 12:18 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yaustar wrote:</b></span></td> </tr> <tr> <td class="quote">The 'turn 2 LOC' into 8 was an optimisation to lower the number of tempoary variables created during run time (read it somewhere).</td> </tr></table><span class="postbody">
<br/>
In my experience, reassigning repeatedly to a variable (such as using +=) actually slows the code down because it makes GCC blind to other optimizations, especially array access optimizations.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12489 - sajiimori - Sun Nov 16, 2003 12:29 am</h4>
    <div class="postbody"><span class="postbody">I guess I don't understand why you would think that yOuter and yInner would add up to a valid address.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12490 - yaustar - Sun Nov 16, 2003 12:39 am</h4>
    <div class="postbody"><span class="postbody">got mixed up with the examples
<br/>
here is my very clumsy way of dealing with it:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
var_radarTile = &amp;radar[0];
<br/>
var_radarTile += yInner;
<br/>
var_radarTile += yOuter;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Now time to tune the loops a bit :p<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12491 - yaustar - Sun Nov 16, 2003 12:52 am</h4>
    <div class="postbody"><span class="postbody">What is hopefully the last major iteration of the function (*panting*)
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void func_drawRadar(s16 var_x, s16 var_y) 
<br/>
{
<br/>
    register u8* var_radarTile;//temp variables
<br/>
    register const u16* var_curSum;
<br/>
        
<br/>
    var_x = ((var_x + 120) &gt;&gt; 3) - 18;
<br/>
    /*var_x += 120;
<br/>
    var_x &gt;&gt;= 3;
<br/>
    var_x -= 18;*/
<br/>
    
<br/>
    var_y = (((var_y + 80) &gt;&gt; 3) - 18) &lt;&lt; 6;
<br/>
    /*var_y +=80;
<br/>
    var_y &gt;&gt;= 3;
<br/>
    var_y -= 18;
<br/>
    var_y &lt;&lt;= 6;*/
<br/>
    
<br/>
    var_curSum = &amp;Tank_Out_Collision[var_snakeHeight][var_x + var_y];
<br/>
    var_radarTile = &amp;radar[0];
<br/>
   
<br/>
    for(u16 yOuter = 0; yOuter &lt; 2560; yOuter+=512)//y block, loops 5 times
<br/>
    {                                               //gets called 5 times
<br/>
        var_radarTile = &amp;radar[0];
<br/>
        var_radarTile += yOuter;
<br/>
        for(u8 yInner = 0; yInner &lt; 64; yInner+=8)//y reminder, loops 8 tiems
<br/>
        {                                           //gets called 40 times
<br/>
            for(u16 xOuter = 0; xOuter &lt; 320; xOuter+=64)//x block, loops 5 times
<br/>
            {                                       //gets called 200 time
<br/>
                for(register u8 xInner = 0; xInner &lt; 8; xInner++)//x reminder. loops 8 times
<br/>
                {                                   //gets called 1600 times
<br/>
                    if(*var_curSum++ &amp; 16)
<br/>
                    {                 
<br/>
                        *(var_radarTile + xInner) = 128;
<br/>
                    }
<br/>
                }
<br/>
                var_radarTile += 64;
<br/>
            }
<br/>
            var_curSum += 24;//64-40
<br/>
            var_radarTile -= 312;//(5*64)-8
<br/>
        }
<br/>
    }
<br/>
    radar[1170] = 129;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Please tell it's okay......<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12492 - sajiimori - Sun Nov 16, 2003 1:21 am</h4>
    <div class="postbody"><span class="postbody">If it works, that's much better than what you had before (though I still don't know why you put 'var' on many of your variables...so ugly!).
<br/>
<br/>
Looks like you have the right idea as far as which variables to make 'register'.
<br/>
<br/>
The last significant optimization I see is to get rid of that addition in the inner loop.  You can do that by changing the loop iterator to a pointer.  That is, since you're just calculating this:
<br/>
<br/>
radarTile + 0
<br/>
radarTile + 1
<br/>
radarTile + 2
<br/>
radarTile + 3...
<br/>
<br/>
...you may as well do it this way:
<br/>
<br/>
u8* tile = radarTile
<br/>
tile++
<br/>
tile++
<br/>
tile++...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12493 - yaustar - Sun Nov 16, 2003 1:38 am</h4>
    <div class="postbody"><span class="postbody">the var_ prefixes is part of a code standard that our small group has agreed to. We find it makes it easier to what is what.
<br/>
<br/>
I think you are talking about the inner loop addition which is this code
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
var_radarTile + xInner
<br/>
</td> </tr></table><span class="postbody">
<br/>
Since it only gets called 170 times max per function call due to the if statement , doing an increment out side the if statement, it does '++' 16000 times per function call.
<br/>
<br/>
If I am wrong please tell me.
<br/>
<br/>
Btw thanks for all your help sajiimori, in this topic ihave learnt 'streamlining algorithms (to an extent)', how pointers can be faster with arrays and a bit of ponter arithmatic :)
<br/>
<br/>
You will be added to the credits by name - 'sajiimori'<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12506 - sajiimori - Sun Nov 16, 2003 6:34 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Since it only gets called 170 times max per function call due to the if statement , doing an increment out side the if statement, it does '++' 16000 times per function call.
<br/>
</td> </tr></table><span class="postbody">
<br/>
I think I understand your point.  (I don't know where you got the number 170 and I think you meant 1600 instead of 16000, but besides that...)
<br/>
<br/>
It's true that the addition is only done for solid pixels on the radar, but you are still incrementing xInner 1600 times.  Instead of stepping xInner from 0 to 7, why not step a u8* from the start of the strip to the end of it?  I mean, if you have to increment *something* 1600 times, you may as well increment the most useful thing. ;-)
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
for(register u8* pixel = var_radarTile, register u8* strip_end = pixel + 8;
<br/>
    pixel &lt; strip_end; ++pixel)
<br/>
{
<br/>
    if(*var_curSum++ &amp; 16)
<br/>
        *pixel = 128;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
Now there are the same number of increments, but the addition is gone.  Any further optimizations would be minor.  You could unroll the loop, or rewrite in assembly.  Personally, I'd say if it's too slow as it is, just compromize and draw only a portion of the radar each frame.  I would be impressed if you get the radar to completely refresh 60 times a second on a 16MHz processor!
<br/>
<br/>
Anyway, glad to be of assistance.  :-)   Send me some screenshots (or a ROM) when you get it working.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12509 - sajiimori - Sun Nov 16, 2003 9:44 am</h4>
    <div class="postbody"><span class="postbody">Ok, I can't resist mentioning these other things (which aren't serious):
<br/>
<br/>
The second line here is useless:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
...
<br/>
    var_curSum = &amp;Tank_Out_Collision[var_snakeHeight][var_x + var_y];
<br/>
    var_radarTile = &amp;radar[0];
<br/>
...
<br/>
</td> </tr></table><span class="postbody">
<br/>
The loop variable here is useless:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
    for(u16 yOuter = 0; yOuter &lt; 2560; yOuter+=512)
<br/>
    {
<br/>
        var_radarTile = &amp;radar[0];
<br/>
        var_radarTile += yOuter;
<br/>
</td> </tr></table><span class="postbody">
<br/>
This is better (note that 'radar + 2560' is a compile-time constant, so no addition is required at runtime):
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
    for(var_radarTile = radar;
<br/>
        var_radarTile &lt; radar + 2560; var_radarTile += 512)
<br/>
    {
<br/>
</td> </tr></table><span class="postbody">
<br/>
These loops variables aren't used anywhere, and are simple counters:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
        for(u8 yInner = 0; yInner &lt; 64; yInner+=8)
<br/>
        {
<br/>
            for(u16 xOuter = 0; xOuter &lt; 320; xOuter+=64)
<br/>
            {
<br/>
</td> </tr></table><span class="postbody">
<br/>
It's better to count down to zero by decrementing:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
        for(u8 yInner = 8; yInner; --yInner)
<br/>
        {
<br/>
            for(u8 xOuter = 5; xOuter; --xOuter)
<br/>
            {
<br/>
</td> </tr></table><span class="postbody">
<br/>
Now for nit-picking on style:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
var_curSum += 24;//64-40
<br/>
</td> </tr></table><span class="postbody">
<br/>
If you mean 64-40, then just put 64-40.  The addition will be performed at compile-time, not run-time.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
    register u8* var_radarTile;//temp variables 
<br/>
</td> </tr></table><span class="postbody">
<br/>
Gee, I thought they were permanent.  ;-)  Comments should only be used to offer useful information.
<br/>
<br/>
Most important style note:
<br/>
<br/>
Your code is full of what they call 'magic numbers': values whose meanings are not apparent.  For example:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
yOuter &lt; 2560
<br/>
var_radarTile -= 312;
<br/>
radar[1170] = 129;
<br/>
</td> </tr></table><span class="postbody">
<br/>
Good code should use named constants to build such values.  The only numbers that should appear in your code are small numbers with obvious meanings.  All other values should be named.
<br/>
<br/>
I did use a couple magic numbers in my earlier posts: 120 and 80 for half the screen width and height respectively.  They really should have been SCREEN_WIDTH/2 and SCREEN_HEIGHT/2.
<br/>
<br/>
There are 2 main reasons for using named constants instead of magic numbers:
<br/>
<br/>
1)  If you want to change a value, you only have to change where it is defined.  If the value is used in multiple places, you don't have to try to track them all down.
<br/>
<br/>
2)  It's much easier to understand.  't = 10' could mean anything (why 10 instead of 15 or 1000?), but 't = SECONDS_UNTIL_LAUNCH' is crystal clear.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12518 - yaustar - Sun Nov 16, 2003 4:10 pm</h4>
    <div class="postbody"><span class="postbody">Good news, I have the radar going at full speed (woot) by drawing half of it per cycle of the while loop. The side effect is that it looks slightly disjointed when moving but that is going to a small sacifice of speed :)
<br/>
<br/>
PM you email address and I send you the bin file.<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
