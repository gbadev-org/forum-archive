<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>new and delete with devkitarm - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>C/C++ > new and delete with devkitarm</h2>
<div id="posts">
<div class="post">
    <h4>#25121 - MumblyJoe - Tue Aug 17, 2004 2:57 am</h4>
    <div class="postbody"><span class="postbody">Just quickly, I have never had any real problems with devkitarm that were not proven to be me bieng retarded so I'm sure this is the same deal.
<br/>
<br/>
When I use new/delete with devkitarm I get the following linker errors:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">bssoundtest.o(.text+0x56): In function `main':
<br/>
: undefined reference to `operator new[](unsigned long)'
<br/>
bssoundtest.o(.text+0xd8): In function `main':
<br/>
: undefined reference to `operator delete[](void*)'
<br/>
bssoundtest.o(.text+0xe0): In function `main':
<br/>
: undefined reference to `__gcj_personality_sj0'</td> </tr></table><span class="postbody">
<br/>
<br/>
If I explicitly link in libstdc++.a all sorts of other shit goes wrong so I don't know if I'm doing that right.
<br/>
<br/>
Anyway, if there is a solution I would love to hear it, even if its just "you cant use new and delete".<br/>_________________<br/><a class="postlink" href="http://www.hungrydeveloper.com" target="_blank">www.hungrydeveloper.com</a>
<br/>
Version 2.0 now up - guaranteed at least 100% more pleasing!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25122 - tepples - Tue Aug 17, 2004 3:15 am</h4>
    <div class="postbody"><span class="postbody">Are you using arm-elf-gcc or arm-elf-g++? When linking a C++ program, use the latter.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25144 - MumblyJoe - Tue Aug 17, 2004 11:01 am</h4>
    <div class="postbody"><span class="postbody">I'm using arm-elf-g++. Pretty much all I want new/delete for is to test out the BoyScout sound engine and see if it's reliable for what I'm doing.
<br/>
<br/>
Only way around it I can see unless anyone knows what I'm doing wrong, is to calculate myself the memory needed and allocate it at compile time...<br/>_________________<br/><a class="postlink" href="http://www.hungrydeveloper.com" target="_blank">www.hungrydeveloper.com</a>
<br/>
Version 2.0 now up - guaranteed at least 100% more pleasing!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25145 - MumblyJoe - Tue Aug 17, 2004 11:16 am</h4>
    <div class="postbody"><span class="postbody">in fact even if I use memory just declared in my program like so:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include "/noodle/noodle.h"
<br/>
#include "songo.h"
<br/>
<br/>
int main()
<br/>
{
<br/>
   using namespace noodle;
<br/>
<br/>
   u8 memforsong[cbssound::memneeded&lt;songo&gt;()];
<br/>
<br/>
   cbssound s((u8*)songo,memforsong);
<br/>
<br/>
   s.start();
<br/>
<br/>
   while(1)
<br/>
   {
<br/>
      while(display-&gt;vblank()!=160){}
<br/>
      s.update();
<br/>
   }
<br/>
<br/>
   return 0;
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
I still get this linker error:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">bssoundtest.o(.text+0xec): In function `main':
<br/>
: undefined reference to `__gxx_personality_sj0'</td> </tr></table><span class="postbody">
<br/>
<br/>
So I'm pretty stumped.<br/>_________________<br/><a class="postlink" href="http://www.hungrydeveloper.com" target="_blank">www.hungrydeveloper.com</a>
<br/>
Version 2.0 now up - guaranteed at least 100% more pleasing!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25146 - MumblyJoe - Tue Aug 17, 2004 11:28 am</h4>
    <div class="postbody"><span class="postbody">Sorry about the triple post but it appears enabling exceptions makes the problem go away... I have no idea why.<br/>_________________<br/><a class="postlink" href="http://www.hungrydeveloper.com" target="_blank">www.hungrydeveloper.com</a>
<br/>
Version 2.0 now up - guaranteed at least 100% more pleasing!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25162 - torne - Tue Aug 17, 2004 3:51 pm</h4>
    <div class="postbody"><span class="postbody">new likes to throw exceptions. More specifically, unlike malloc(), it doesn't return a null pointer on failure, it throws a bad_alloc exception. There exists a no-throw version of new in the ISO standard, used like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">pointer = new(nothrow) your_type;</td> </tr></table><span class="postbody">
<br/>
which returns null on failure and thus doesn't need exception support - include the header &lt;new&gt; to use this. I have no idea whether g++ actually supports this, though.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
