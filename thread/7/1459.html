<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Loading a function, the unusual way... - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>C/C++ > Loading a function, the unusual way...</h2>
<div id="posts">
<div class="post">
    <h4>#7321 - Burre - Sun Jun 15, 2003 12:32 am</h4>
    <div class="postbody"><span class="postbody">Hi all.
<br/>
<br/>
Does anyone know a way to call a function only using a function adress(&amp;function)? I don't need any input values nor any return values (void function(void)). If you don't know how to do it in C/C++ a inline ASM example would do, but i would prefer C if possible.
<br/>
<br/>
I've tried to search amongst the standard C libs but without any luck.
<br/>
<br/>
Any help on the subject is highly appreciated! :)<br/>_________________<br/>"The best optimizer is between your ears..."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7327 - col - Sun Jun 15, 2003 3:27 am</h4>
    <div class="postbody"><span class="postbody">here's one way:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void (*funcPtr) ();    //declares funcPtr as a ptr to void func()
<br/>
<br/>
funcPtr = myFunction;    //assign address to ptr
<br/>
<br/>
(*funcPtr)();    //call the function using the ptr
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
cheers
<br/>
<br/>
col</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7328 - sgeos - Sun Jun 15, 2003 4:00 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>col wrote:</b></span></td> </tr> <tr> <td class="quote">here's one way: *snip*</td> </tr></table><span class="postbody">
<br/>
<br/>
I'll list another:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void (*fptr)(void);
<br/>
<br/>
if (confirm)
<br/>
  fptr = delete;
<br/>
else
<br/>
  fptr = confirm_delete;
<br/>
fptr();</td> </tr></table><span class="postbody">
<br/>
<br/>
I realize that calling the function directly would work better.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7363 - Burre - Mon Jun 16, 2003 1:14 pm</h4>
    <div class="postbody"><span class="postbody">Thanks a lot!
<br/>
<br/>
When you think you know all you need to know about C something entirely new pops right up. ;)
<br/>
<br/>
I never could have guessed that one could declare pointers like that.
<br/>
<br/>
Some questions:
<br/>
<br/>
1. Is it safe to change the function adress on the fly while running the program?
<br/>
<br/>
2. If I sometime later wants to have input/return values in the function I only put them in the declaration, right?
<br/>
<br/>
3. Does return values function the same way as before? (int (*funcPtr)();)
<br/>
<br/>
4. What is the "confirm" test used for?
<br/>
<br/>
<br/>
Anyway, thanks again for the help.<br/>_________________<br/>"The best optimizer is between your ears..."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7374 - niltsair - Mon Jun 16, 2003 2:53 pm</h4>
    <div class="postbody"><span class="postbody">&gt;1. Is it safe to change the function adress on the fly while running the program?
<br/>
Yes
<br/>
<br/>
&gt;2. If I sometime later wants to have input/return values in the function I only put them in the declaration, right?
<br/>
Yes
<br/>
<br/>
&gt;3. Does return values function the same way as before? (int (*funcPtr)();)
<br/>
Yes. The function pointer must be declared the same a the prototype of the function (return type, parameters). Not quite certain what happen else, the compiler most probably throw an error.
<br/>
<br/>
&gt;4. What is the "confirm" test used for?
<br/>
Just an example to show how a function can be dynamicly assigned to a function pointer, to be called afterward. So confirm was an abitrary condition to chose which function should be called.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7375 - col - Mon Jun 16, 2003 3:07 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Burre wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
1. Is it safe to change the function adress on the fly while running the program?
<br/>
</td> </tr></table><span class="postbody">
<br/>
thats where the fun starts - thats what sgeos example does...
<br/>
you can even roll your own polymorphism with function pointers, if you want a challenge ;)
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
3. Does return values function the same way as before? (int (*funcPtr)();)
<br/>
</td> </tr></table><span class="postbody">
<br/>
the functionality is the same as for a 'normal' function call.
<br/>
to declare a pointer to a function that takes a u8 and a u16 and returns an s32:
<br/>
u32(*funcPtr)(u8, u16);
<br/>
this can only refer to a function with the same signature - although you can probably cast it - never tried that...
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Anyway, thanks again for the help.</td> </tr></table><span class="postbody">
<br/>
<br/>
no problem
<br/>
For a good explanation of the details of function pointers, how to read them! and what you can do with them, have a look at 'thinking in c++' by Bruce Eckel - the whole book is available as a free download from his website - great stuff :)
<br/>
<a href="http://www.bruceeckel.com/" target="_blank">http://www.bruceeckel.com/</a>
<br/>
<br/>
cheers
<br/>
<br/>
Col</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7397 - sgeos - Tue Jun 17, 2003 1:45 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Burre wrote:</b></span></td> </tr> <tr> <td class="quote">1. Is it safe to change the function adress on the fly while running the program?
<br/>
<br/>
2. If I sometime later wants to have input/return values in the function I only put them in the declaration, right?</td> </tr></table><span class="postbody">
<br/>
<br/>
Your function pointer only works with the 'right' kind of functions.
<br/>
<br/>
void (*fptr)(int, int);
<br/>
<br/>
Every single function needs this format, no retrun value and two integer inputs.  You can set it to the address of any function, but I image that bad things will happen when you try to call it.  For arbitrary input use something like this:
<br/>
<br/>
void (*fptr)(void *);
<br/>
<br/>
Then you can pass it a pointer to anything, probably a structure.  If you want it to return a pointer to function (or accept one) use a void pointer instead.
<br/>
<br/>
void *(*fptr)(void);
<br/>
<br/>
Some neat things to do with this: you can create character spell lists, etc, that are completely composed of function pointers:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void (*spell_list[16])(void *) =
<br/>
{
<br/>
  healing, big_healing, clearance, crazy_magic,
<br/>
  fire, ice, NULL, NULL,
<br/>
  NULL, NULL, NULL, NULL,
<br/>
  NULL, NULL, NULL, NULL
<br/>
};</td> </tr></table><span class="postbody">
<br/>
<br/>
You can also tag functions onto items:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">struct item item[10] =
<br/>
{
<br/>
  {"",               0,   0,  0,  0,  0,  0, NULL, NULL},
<br/>
  {"Potion", ITM | BRK,   0,  0,  0,  0,  0, b_potion, g_potion},
<br/>
  {"Winter Wand",  WEP,   0, 50,  5, 60,  0, frost, NULL},
<br/>
};</td> </tr></table><span class="postbody">
<br/>
<br/>
There is a function pointer for in battle and out of battle above.  There are many other very useful things you can do with pointers to functions.  Have fun with it, pointers to functions are good stuff!
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7516 - Burre - Thu Jun 19, 2003 1:05 am</h4>
    <div class="postbody"><span class="postbody">Yeah I figured it worked that way. Right now I only use it for directing IRQ to its proper IRQ function in my IRQ handler, but I'll surely dig some more in the possibilities if I feel the need or the opportunity.<br/>_________________<br/>"The best optimizer is between your ears..."</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
