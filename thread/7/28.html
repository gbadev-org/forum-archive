<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Stupid newbie question - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>C/C++ > Stupid newbie question</h2>
<div id="posts">
<div class="post">
    <h4>#129 - Alunze - Fri Jan 03, 2003 7:56 pm</h4>
    <div class="postbody"><span class="postbody">Here's the little problem I have: I wrote two libraries for different purposes, and both need some trigonometry in them, so I created a sincos.h file with an array of precalculated sine/cosine values for them. Then, when I try to link them together with the main file, the linker refuses with a duplicate definition (the array) error.
<br/>
I know what this error means and the cause, I could copy the arrays to the lbreries as a quick fix, but I feel this is not the way to do this. I have the some problems with other libraries (for example, the gba.h file has some variable declarations in it, so linking two separate files which uses it results in the same error). Is there any way or technique to avoid this? Or is there a way to link the files so the linker doesn't comply?
<br/>
<br/>
Thanks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#131 - Alunze - Fri Jan 03, 2003 8:02 pm</h4>
    <div class="postbody"><span class="postbody">Sorry, this should have been post in the C/C++ coding section... Someone please move this post.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137 - Touchstone - Fri Jan 03, 2003 8:48 pm</h4>
    <div class="postbody"><span class="postbody">Actually, moving the array to the library _is_ the right way of doing it. Or to put it in another way, you should make sure that there is only one copy of the array in all of your code files or the linker will get confused.
<br/>
<br/>
You could make the array static, that way the symbol won't be exported out of the code file and cannot be confused with any other symbols with the same name but on the other hand you end up with lots of redundant data.
<br/>
<br/>
Put the array in a C file that you include in your project and then declare the array as 'extern' in your header file, that way everything will work out just fine and you won't have any redundant data.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144 - Lord Graga - Fri Jan 03, 2003 10:48 pm</h4>
    <div class="postbody"><span class="postbody">Hmm....
<br/>
Maybe you included the .h file in BOTH lib's.
<br/>
Also, SIN and COS are standard functions in C (as far as i remember), maybe you should try to rename them.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#156 - zeuhl - Sat Jan 04, 2003 1:28 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Alunze wrote:</b></span></td> </tr> <tr> <td class="quote">Here's the little problem I have: I wrote two libraries for different purposes, and both need some trigonometry in them, so I created a sincos.h file with an array of precalculated sine/cosine values for them. Then, when I try to link them together with the main file, the linker refuses with a duplicate definition (the array) error.
<br/>
I know what this error means and the cause, I could copy the arrays to the lbreries as a quick fix, but I feel this is not the way to do this. I have the some problems with other libraries (for example, the gba.h file has some variable declarations in it, so linking two separate files which uses it results in the same error). Is there any way or technique to avoid this? Or is there a way to link the files so the linker doesn't comply?
<br/>
<br/>
Thanks.</td> </tr></table><span class="postbody">
<br/>
<br/>
Files with .h suffix are only for prototype and global variables declarations, you know. No code or defined variables should be present in such files.
<br/>
<br/>
the best way to do what you need is the following :
<br/>
<br/>
create a "sincos.c" file, with your sin/cos array in it. suppose you have declared your sin/cos array this way :
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">u16 sincos[2048] = { 0x0000, 0x0001, ..... };</td> </tr></table><span class="postbody">
<br/>
<br/>
then in the "sincos.h" file you should put this line :
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">extern u16 sincos[];</td> </tr></table><span class="postbody">
<br/>
<br/>
then, add sincos.c to your project and include sincos.h in the files which require the sin/cos stuff.
<br/>
<br/>
"extern" is meant to indicate the array exists, but does not actually define it. the only place the array is defined is in "sincos.c". So, there won't be any definition conflicts anymore.
<br/>
<br/>
[/b]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#497 - notron - Wed Jan 08, 2003 4:32 am</h4>
    <div class="postbody"><span class="postbody">Well, if you must put defined vars in an .h file, here is a way although a bit complicated.
<br/>
<br/>
First, define the following logic in the .h file that will contain the var:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#ifdef __myglobals__
<br/>
#define EXT
<br/>
#undef __EXT
<br/>
#else
<br/>
#define EXT extern
<br/>
#define __EXT
<br/>
#endif
<br/>
<br/>
EXT myvar[]
<br/>
#ifndef __EXT
<br/>
= { ......., ..... ,.... ,.....}
<br/>
#endif
<br/>
;</td> </tr></table><span class="postbody">
<br/>
<br/>
Now, you can include this .h file in all your .c/.cpp files at will. In the one .c file that has your main program, just add the following coding
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define __myglobals__
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Presto, you will have only one copy of the defined variable in your object files with all the rest having a defined external for the var. A better way is to include the first set of conditional logic above in a master .h file which has all the &lt;includes&gt; for all your other header files. Then you only have to have the master conditional logic in one place. After that you can just use the EXT preface-construct in any of the included header files. Just don't forget to put the one #define of __myglobals__ in your main .c file BEFORE your reference to all the &lt;include&gt; files.<br/>_________________<br/>MysticX is The Defender</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
