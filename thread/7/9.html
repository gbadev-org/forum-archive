<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Linking with Standard Library - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>C/C++ > Linking with Standard Library</h2>
<div id="posts">
<div class="post">
    <h4>#18 - Kater - Wed Jan 01, 2003 2:42 am</h4>
    <div class="postbody"><span class="postbody">Greets All and Happy New Year,
<br/>
<br/>
Does anyone know whether it is possible to link with the standard C++ library when building GBA images using GCC? If so, can you point me in the right direction?
<br/>
<br/>
Thanks,
<br/>
Kater</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#34 - dovoto2 - Wed Jan 01, 2003 1:35 pm</h4>
    <div class="postbody"><span class="postbody">$(PROJECT).elf : $(O_FILES)
<br/>
	$(CMPDIR)\ld $(LDFLAGS) -o $(PROJECT).elf $(O_FILES) -lstdc++ -lgcc -lc  
<br/>
<br/>
thats how I do it. If you use devkit it should work fine.  If you use Visual Studio for your IDE you can download the GBA appwizard from my site and it sets up a make file with full c++ suport...  You will need to include the two .o files: crtbegin.o  crtend.o as well as crt0.o.  These are someware in your devkit install.
<br/>
-dovoto</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#54 - Kater - Thu Jan 02, 2003 12:58 am</h4>
    <div class="postbody"><span class="postbody">Thanks for your suggestions dovoto2.
<br/>
<br/>
However, I'm using g++ to do the linking stage for me. I've since read that it automatically performs linking with c++ libraries. It seems to do so but now I'm getting strange errors.
<br/>
<br/>
I can successfully declare a std::string or std::vector in my code but as soon as I try to actually use it in my code the linker gives me these kind of errors:
<br/>
<br/>
/cygdrive/c/DevKitADV/bin/../lib/gcc-lib/arm-agb-elf/3.0.2/../../../../arm-agb-elf/lib/thumb/libstdc++.a(misc-inst.o):/home/Administrator/build-devkitadv/build-gcc/arm-agb-elf/thumb/libstdc++-v3/include/bits/stl_algobase.h:180: <span style="font-weight: bold">internal error: unsupported relocation error</span>
<br/>
/cygdrive/c/DevKitADV/bin/../lib/gcc-lib/arm-agb-elf/3.0.2/../../../../arm-agb-elf/lib/thumb/libstdc++.a(pure.o): In function `__cxa_pure_virtual':
<br/>
../../../../../gcc-3.0.2/libstdc++-v3/libsupc++/pure.cc:49: <span style="font-weight: bold">undefined reference to `write'</span>
<br/>
<br/>
Do you (or anyone) have any idea what this is all about?
<br/>
<br/>
Thanks heaps,
<br/>
Kater</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#55 - Legion - Thu Jan 02, 2003 1:09 am</h4>
    <div class="postbody"><span class="postbody">Does the Visual Studio GBA appwizard work with VS .NET?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#898 - animension - Sat Jan 11, 2003 11:39 pm</h4>
    <div class="postbody"><span class="postbody">Is there even support for STL other than strings? I thought maps and vectors and other high-level abstractions weren't implemented, though the headers are there (and thus the successful compile).
<br/>
<br/>
Also AFAIK, STL is extremely slow and should be avoided when programming for a limited platform like the GBA.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1314 - mo - Thu Jan 16, 2003 6:11 pm</h4>
    <div class="postbody"><span class="postbody">Hey Dovoto that appwizard is nice.  I'm really having problems with step #9, however, do you have any advice?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
step 9:
<br/>
Try not to be over awed by dovoto's superior intellect...This is the hardest step.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
!-)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1323 - maniac - Thu Jan 16, 2003 7:01 pm</h4>
    <div class="postbody"><span class="postbody">I got the exact same problem as Kater (I also used g++). The STL string class  works fine (however there seems to be some methods which aren't implemented?!).
<br/>
<br/>
vector&lt;int&gt; v; // works fine
<br/>
v.push_back(1); // spawns the same error as Kater got
<br/>
<br/>
I tried my code using the appwizard with vc6 and the same problem occurs! So is animension correct about STL not being fully implemented?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#2043 - mo - Tue Jan 28, 2003 4:47 am</h4>
    <div class="postbody"><span class="postbody">I was messing around with C++ today and saw something similar.  I'm not using STL in the code, but have defined an abstract class with some pure virtual functions.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
Â F:\gba\devkitadv\bin\g++ -L F:\gba\devkitadv\lib\gcc-lib\arm-agb-elf\3.0.2\interwork -L F:\gba\devkitadv\arm-agb-elf\lib\interwork -L F:\gba\SGADE\lib -L F:\gba\devkitadv\lib/gcc-lib\arm-agb-elf\3.0.2\interwork -L F:\gba\devkitadv\arm-agb-elf\lib\interwork -T lnkscript -o kaboom.elf main.o Kaboom.o Sprite.o MadBomber.o -lsocrates -lg -lc -lgcc
<br/>
<br/>
/cygdrive/f/gba/devkitadv/bin/../lib/gcc-lib/arm-agb-elf/3.0.2/../../../../arm-agb-elf/bin/ld: Warning: /cygdrive/f/gba/devkitadv/bin/../lib/gcc-lib/arm-agb-elf/3.0.2/crtend.o does not support interworking, whereas kaboom.elf does
<br/>
<br/>
F:\gba\devkitadv\arm-agb-elf\lib\interwork/libstdc++.a(pure.o): In function `__cxa_pure_virtual':
<br/>
../../../../../gcc-3.0.2/libstdc++-v3/libsupc++/pure.cc:49: undefined reference to `write'
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7989 - hnager - Mon Jun 30, 2003 3:31 am</h4>
    <div class="postbody"><span class="postbody">I'm also having strange &lt;vector&gt; errors - I haven't tried including crtbegin.o crtend.o and crt0.o - is that the key? In short - I have a small file which traces out some text to the mappy console - if &lt;vector&gt; is included it doesn't work, without - it's fine.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7994 - tepples - Mon Jun 30, 2003 4:50 am</h4>
    <div class="postbody"><span class="postbody">You need the crt* files in order to set up support for C++ features.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8030 - hnager - Tue Jul 01, 2003 1:03 am</h4>
    <div class="postbody"><span class="postbody">I haven't been able to link the ctr files without getting multiple errors - example:
<br/>
<br/>
crt0.o: In function `__FarProcedure':
<br/>
crt0.o(.text+0x1a8): undefined reference to `__sp_irq'
<br/>
<br/>
Here is my makefile - what is it that I am doing wrong?
<br/>
<br/>
<br/>
<br/>
PATH=c:\GBA\bin;
<br/>
NAME = POLYGON
<br/>
<br/>
CFLAGS = -c -O3
<br/>
MODEL = -mthumb -mthumb-interwork 
<br/>
<br/>
$(NAME).bin : $(NAME).elf
<br/>
	objcopy -O binary $(NAME).elf $(NAME).bin
<br/>
<br/>
$(NAME).elf :  main.o crt0.o crtbegin.o crtend.o
<br/>
	g++ $(MODEL)  -nostartfiles  -o $(NAME).elf  main.o crt0.o crtbegin.o crtend.o
<br/>
<br/>
main.o : main.cpp
<br/>
	g++ $(CFLAGS) $(MODEL) main.cpp
<br/>
<br/>
crt0.o : crt0.s
<br/>
	g++ $(CFLAGS) $(MODEL) crt0.s</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
