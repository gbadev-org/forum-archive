<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Just Another Stupid Question(TM) - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>C/C++ > Just Another Stupid Question(TM)</h2>
<div id="posts">
<div class="post">
    <h4>#264 - Japster - Sun Jan 05, 2003 6:51 pm</h4>
    <div class="postbody"><span class="postbody">Ok, this code is (almost) straigth copy from GBA Junkie's tutorial and it doesn't work.
<br/>
	signed long pa,pb,pc,pd;
<br/>
	pa = COS[45]&gt;&gt;8;
<br/>
	pb = SIN[45]&gt;&gt;8;
<br/>
	pc = -SIN[45]&gt;&gt;8;
<br/>
	pd = COS[45]&gt;&gt;8;
<br/>
<br/>
<br/>
This is what GCC says:
<br/>
invalid operands of types `const double' 
<br/>
   and `int' to binary `operator&gt;&gt;'
<br/>
<br/>
Should I use another compiler(Im using GCC)?
<br/>
<br/>
Jasper (If I keep asking you these stupid questions you have soon wrote 98% of my code...)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#265 - Touchstone - Sun Jan 05, 2003 7:09 pm</h4>
    <div class="postbody"><span class="postbody">It looks like your arrays COS and SIN are made up of floats (doubles) instead of integers and the &gt;&gt; operator only works on integers as opposed to floats. Build yourself new arrays of integers instead of floats, that will save you memory and speed performance. Ok, it's not necessarely more memory efficient but if you want to you can just store one quarter of SIN and then calculate all angles of SIN and COS from there.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#276 - Costis - Sun Jan 05, 2003 8:54 pm</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
I don't know what fixed point ratio your program is supposed to use, but it looks like you may be using 16:16 or 8:16. Anyway, here's some code to create the COS and SIN arrays for a 16:16 fixed point ratio:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
...
<br/>
<br/>
// PI definition. You can add more digits for better accuracy if you like
<br/>
#define PI                3.14159
<br/>
<br/>
// COS and SIN fixed point arrays
<br/>
unsigned long COS[360], SIN[360];
<br/>
<br/>
void AGBMain (void)
<br/>
{
<br/>
   int i;
<br/>
   ...
<br/>
<br/>
   // Fill the SIN and COS arrays with the correct sin and cos values in fixed point
<br/>
   for (i = 0; i &lt; 360; i++)
<br/>
   {
<br/>
         SIN[i] = sin(i * PI / 180) * 65536;
<br/>
         COS[i] = cos(i * PI / 180) * 65536;
<br/>
   }
<br/>
   ...
<br/>
}
<br/>
<br/>
...
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I haven't test this code out, but it should work without any problems.
<br/>
<br/>
Costis</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6911 - joris-fr - Wed Jun 04, 2003 2:20 pm</h4>
    <div class="postbody"><span class="postbody">Costis,
<br/>
<br/>
when the COS &amp; SIN arrays are filled with fixed point value,
<br/>
how do I use those arrays' values ?
<br/>
<br/>
(I don't mean how to access them).
<br/>
<br/>
For an example,
<br/>
if I use those statements
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
int x = 120 + (COS[i] &gt;&gt; 16) * 50;
<br/>
int y = 80 + (SIN[i] &gt;&gt; 16) * 50;
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
the values returned aren't what I expected.
<br/>
<br/>
I managed to realize a radar using float numbers, but now I want to try using Fixed Point.<br/>_________________<br/>Joris</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6919 - Torlus - Wed Jun 04, 2003 3:49 pm</h4>
    <div class="postbody"><span class="postbody">Two things :
<br/>
<br/>
- about Costis' code, SIN &amp; COS should'nt be declared unsigned, but signed.
<br/>
- about your code, if you shift SIN or COS values by 16 before multiplying you'll "always" get 0.
<br/>
<br/>
So you should try :
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
x = 120 + ( (COS[i]*50) &gt;&gt; 16 );
<br/>
y = 80 + ( (SIN[i]*50) &gt;&gt; 16 );
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Some other tricks :
<br/>
- Instead of having a 360 entries table, why not consider having a 256 entries table ? Then you could use bit masking to make out-of-bounds angle values fit in your table range. (Angle &amp;= 0xFF).
<br/>
- Instead of having 2 tables, one for sin and one for cos, you can make a (in your case, 360+90) entries SIN table, and then have COS declared as :
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
long *COS = SIN + 90;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
or if you use a 256 entries table and don't want to waste memory, just declare a SIN table and do :
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#declare COS(a) SIN[ ((a)+64) &amp; 0xFF ]
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Hope this helps<br/>_________________<br/>GBA,GC,NGPC,GP32,FPGA,DS stuff at <a class="postlink" href="http://torlus.com/" target="_blank">http://torlus.com/</a></span><span class="gensmall"><br/><br/>Last edited by Torlus on Wed Jun 04, 2003 4:10 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#6925 - Touchstone - Wed Jun 04, 2003 4:10 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Torlus wrote:</b></span></td> </tr> <tr> <td class="quote">long *COS = SIN + 90;</td> </tr></table><span class="postbody">
<br/>
Nah, COS[255] will be way of.
<br/>
<br/>
And if you want to save memory you can easily do a table with just one quarter of a circle and have functions to access the table (to calculate actual offset in table)<br/>_________________<br/>You can't beat our meat</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6926 - Torlus - Wed Jun 04, 2003 4:14 pm</h4>
    <div class="postbody"><span class="postbody">I meant SIN + 90 for a 360 entries table. For a 256 entries table it would be SIN + 64.
<br/>
But I'm guilty, as I edited my previous post many times :)<br/>_________________<br/>GBA,GC,NGPC,GP32,FPGA,DS stuff at <a class="postlink" href="http://torlus.com/" target="_blank">http://torlus.com/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6943 - joris-fr - Wed Jun 04, 2003 10:23 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Torlus wrote:</b></span></td> </tr> <tr> <td class="quote">Two things :
<br/>
<br/>
- about Costis' code, SIN &amp; COS should'nt be declared unsigned, but signed.
<br/>
- about your code, if you shift SIN or COS values by 16 before multiplying you'll "always" get 0.
<br/>
<br/>
So you should try :
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
x = 120 + ( (COS[i]*50) &gt;&gt; 16 );
<br/>
y = 80 + ( (SIN[i]*50) &gt;&gt; 16 );
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Some other tricks :
<br/>
- Instead of having a 360 entries table, why not consider having a 256 entries table ? Then you could use bit masking to make out-of-bounds angle values fit in your table range. (Angle &amp;= 0xFF).
<br/>
- Instead of having 2 tables, one for sin and one for cos, you can make a (in your case, 360+90) entries SIN table, and then have COS declared as :
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
long *COS = SIN + 90;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
or if you use a 256 entries table and don't want to waste memory, just declare a SIN table and do :
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#declare COS(a) SIN[ ((a)+64) &amp; 0xFF ]
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Hope this helps</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Ouais !!!
<br/>
<br/>
Now I understand why it didn't work. When I think of it, I am disapointed not to resolve it myself !!!
<br/>
<br/>
Maintenant, pour le reste : 
<br/>
Vu que je suis pas top en maths, les optimisations dont tu me parles me passent un peu au dessus de la t?te, il va falloir que j'?tudie ?a de plus pr?s.
<br/>
<br/>
Demain j'aurais le temps de mettre tout ?a en oeuvre.
<br/>
<br/>
Merci beaucoup Torlus.
<br/>
<br/>
...et en passant, vraiment bien ton moteur 3D :-)<br/>_________________<br/>Joris</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7014 - mpowell - Fri Jun 06, 2003 6:52 am</h4>
    <div class="postbody"><span class="postbody">If you create a SIN table on the fly in Main, it will be stored in RAM as opposed to having a table already filled out in a .c or .h file and having the constant table compiled into ROM with the code.
<br/>
<br/>
Does anyone know if pulling look up entries from ROM is much slower than pulling them from RAM? I know that the RAM memory is faster on the GBA than ROM but has anyone done any tests comparing the speeds from RAM, ROM, and calling the original SIN function? Is it worth while using the precious RAM for a table that could sit in ROM with code?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7018 - Quirky - Fri Jun 06, 2003 8:11 am</h4>
    <div class="postbody"><span class="postbody">If the table is in iwram it will be the fastest. If it's in ewram it will be either as fast as rom or slightly slower (but not faster than rom) it depends on if you have rom prefetch disabled or not. Basically, reading from rom is not as big a speed hit as you might imagine, in fact it's damn fast :)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
