<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>input from multiple keys... - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>C/C++ > input from multiple keys...</h2>
<div id="posts">
<div class="post">
    <h4>#1751 - Malefactor - Wed Jan 22, 2003 4:22 pm</h4>
    <div class="postbody"><span class="postbody">My C is a little shakey so I'm asking for help.
<br/>
<br/>
I currently use this code to check if select is pressed
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">if(!(*KEYS &amp; KEY_SELECT))
<br/>
{
<br/>
}</td> </tr></table><span class="postbody">
<br/>
Would this check if Select and A are pressed at the same time?
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">if(!(*KEYS &amp; KEY_SELECT))
<br/>
{
<br/>
    if(!(*KEYS &amp; KEY_A))
<br/>
    {
<br/>
    }
<br/>
}</td> </tr></table><span class="postbody">
<br/>
Or is there a more efficient way of doing it?<br/>_________________<br/><a class="postlink" href="http://lorrd.fearware.net" target="_blank"></a><a href="http://mysite.verizon.net/vzep3wth/sitebuildercontent/sitebuilderpictures/lorrdbanner.gif">[Images not permitted - Click here to view it]</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1753 - Vortex - Wed Jan 22, 2003 4:27 pm</h4>
    <div class="postbody"><span class="postbody">This one seems to be a little bit more efficient IMHO:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
if(!(*KEYS &amp; (KEY_SELECT | KEY_A))) 
<br/>
{ 
<br/>
// ...
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1777 - Malefactor - Wed Jan 22, 2003 11:29 pm</h4>
    <div class="postbody"><span class="postbody">ty<br/>_________________<br/><a class="postlink" href="http://lorrd.fearware.net" target="_blank"></a><a href="http://mysite.verizon.net/vzep3wth/sitebuildercontent/sitebuilderpictures/lorrdbanner.gif">[Images not permitted - Click here to view it]</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1789 - satanicfreak2 - Thu Jan 23, 2003 4:42 am</h4>
    <div class="postbody"><span class="postbody">what if you wanted to have a combination of buttons pressed... like for example trowing a fire ball.  down, then left, then b??</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1792 - Malefactor - Thu Jan 23, 2003 5:23 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">if(!(*KEYS &amp; (KEY_DOWN | KEY_LEFT | KEY_B))) 
<br/>
{ 
<br/>
// ... 
<br/>
} </td> </tr></table><span class="postbody">
<br/>
<br/>
I think...
<br/>
<br/>
SatanicFreak2:
<br/>
On a whim I went to your website and downloaded blocks..
<br/>
Thank you for showing me how to save and load from sram!<br/>_________________<br/><a class="postlink" href="http://lorrd.fearware.net" target="_blank"></a><a href="http://mysite.verizon.net/vzep3wth/sitebuildercontent/sitebuilderpictures/lorrdbanner.gif">[Images not permitted - Click here to view it]</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1821 - peebrain - Thu Jan 23, 2003 6:14 pm</h4>
    <div class="postbody"><span class="postbody">Just a little tip... Assuming your KEYS is #define'd to be the actual memory address of the keyboard input address, you'll want to store the value in another variable, then use that variable for checking against key states.
<br/>
<br/>
i.e.:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
int theKeys = *KEYS;
<br/>
if (theKeys &amp; KEY_A &amp;&amp; theKeys &amp; KEY_SELECT)
<br/>
{
<br/>
//whatever
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
The reason for that being that there is a slight chance the key state could change while checking whether a button is being hit or not.  Depending on how slow/fast your code is, that could lead to missed inputs, or contradicting inputs.  Say, for example, if the user pushes A or B, a menu comes up.  If the user pushes B though, you want to make a sound (stupid example, I know).  If your code was like:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
if (*KEYS &amp; KEY_A || *KEYS &amp; KEY_B)
<br/>
{
<br/>
// do menu
<br/>
  if (*KEYS &amp; KEY_B)
<br/>
  {
<br/>
  //do sound
<br/>
  }
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Then the KEYS could change while doing the menu, and you could miss the B input.  If you saved it in a variable it wouldn't have that problem.
<br/>
<br/>
This post is much too long to explain what I'm trying to explain... :-P.
<br/>
<br/>
~Sean</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1826 - Vortex - Thu Jan 23, 2003 7:55 pm</h4>
    <div class="postbody"><span class="postbody">Sean,
<br/>
<br/>
The probability for that to happend is close to zero, but you have a point. However I am afraid your IF statements will never work because the GBA keypad register reacts to pressing keys by turning bits to zero, so you still need the ! operator, i.e. in their currect form the IFs will trigger if the keys are NOT pressed. 
<br/>
<br/>
Just my $0.02.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1829 - Malefactor - Fri Jan 24, 2003 12:00 am</h4>
    <div class="postbody"><span class="postbody">thanx for the tip peebrain, I will implement it and see if it improves the responsiveness of my proggie...
<br/>
<br/>
their may be almost no chance of such a thing happening, but it will only take me a few seconds to eliminate that change altogether.<br/>_________________<br/><a class="postlink" href="http://lorrd.fearware.net" target="_blank"></a><a href="http://mysite.verizon.net/vzep3wth/sitebuildercontent/sitebuilderpictures/lorrdbanner.gif">[Images not permitted - Click here to view it]</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1832 - ampz - Fri Jan 24, 2003 12:40 am</h4>
    <div class="postbody"><span class="postbody">No keypad code, no matter how ugly you write it, will affect the responsiveness of your game. (ok, unless you introduce delay loops)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1834 - peebrain - Fri Jan 24, 2003 3:08 am</h4>
    <div class="postbody"><span class="postbody">Oh yeah, forgot about that crazy ! stuff... thanks Vortex.
<br/>
<br/>
Nonetheless, it's good programming practice, in my opinion.  Of course, I started writting games in Qbasic on a 386, so I instinctually write code that works better on slow machines :-P.  I guess for the GBA it really isn't necessary unless theres some odd special case...
<br/>
<br/>
~Sean</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1836 - Malefactor - Fri Jan 24, 2003 3:16 am</h4>
    <div class="postbody"><span class="postbody">BTW I also need to check for any key being pressed, so if | is 'and'...
<br/>
what is 'or'?<br/>_________________<br/><a class="postlink" href="http://lorrd.fearware.net" target="_blank"></a><a href="http://mysite.verizon.net/vzep3wth/sitebuildercontent/sitebuilderpictures/lorrdbanner.gif">[Images not permitted - Click here to view it]</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1837 - nolanjurgens - Fri Jan 24, 2003 5:34 am</h4>
    <div class="postbody"><span class="postbody">| is the bitwise OR operator, &amp; is the bitwise AND operator.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1839 - satanicfreak2 - Fri Jan 24, 2003 6:01 am</h4>
    <div class="postbody"><span class="postbody">Malefactor, you are welcome.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1852 - Malefactor - Fri Jan 24, 2003 2:11 pm</h4>
    <div class="postbody"><span class="postbody">ok, that's what I thought... But I guess I forgot about the ! and was thinking that | was and because of it...
<br/>
<br/>
so would
<br/>
(!(*KEYS &amp; (KEY_DOWN &amp; KEY_LEFT &amp; KEY_B))) 
<br/>
be true if any of those keys were being pressed?<br/>_________________<br/><a class="postlink" href="http://lorrd.fearware.net" target="_blank"></a><a href="http://mysite.verizon.net/vzep3wth/sitebuildercontent/sitebuilderpictures/lorrdbanner.gif">[Images not permitted - Click here to view it]</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1854 - Splam - Fri Jan 24, 2003 3:59 pm</h4>
    <div class="postbody"><span class="postbody">You probably want to | together the keys and then &amp; the result with the key register.  
<br/>
<br/>
eg (if the following bits were correct) ;)
<br/>
<br/>
KEY_DOWN=0001
<br/>
KEY_LEFT=  0010
<br/>
KEY_B    =  0100
<br/>
<br/>
your method would produce
<br/>
0001 &amp; 0010 &amp; 0100 = 0000
<br/>
and then you'd check 0000 against the button register</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1893 - satanicfreak2 - Sat Jan 25, 2003 3:37 am</h4>
    <div class="postbody"><span class="postbody">the best way to do it is to check if both are being pressed at the same time.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code"> if ( (! ((*KEYS) &amp; KEY_UP) )&amp;&amp;(! ((*KEYS) &amp; KEY_LEFT) ))
<br/>
  { 
<br/>
<br/>
// code goes in here
<br/>
<br/>
  }
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
at least thats how i do it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1928 - Malefactor - Sun Jan 26, 2003 2:01 am</h4>
    <div class="postbody"><span class="postbody">ty ppl<br/>_________________<br/><a class="postlink" href="http://lorrd.fearware.net" target="_blank"></a><a href="http://mysite.verizon.net/vzep3wth/sitebuildercontent/sitebuilderpictures/lorrdbanner.gif">[Images not permitted - Click here to view it]</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1932 - imikeyi - Sun Jan 26, 2003 6:40 am</h4>
    <div class="postbody"><span class="postbody">What about if you want a series of commands, such as a fireball in SF2, ie down, down-forward, forward, punch. Would you nest if statements such as:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
if down then 
<br/>
    if down-forward then
<br/>
          if forward
<br/>
              do fireball
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Personally I think this would be too fast to work.
<br/>
<br/>
Or would you test for the sequence per frame, eg in your control handling code
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
if down then 
<br/>
    do down action
<br/>
    fireball = 1
<br/>
if down-forward then
<br/>
    do down-forward action
<br/>
    if fireball=1 then fireball++;
<br/>
if forward then
<br/>
    do forward action
<br/>
    if fireball=2 then fireball++;
<br/>
if fireball = 3 then do fireball
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
(Sorry for the pseudocode!)<br/>_________________<br/>microkernel advance</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1936 - tepples - Sun Jan 26, 2003 9:54 am</h4>
    <div class="postbody"><span class="postbody">If I were writing a side-view 2D fighting game in the style of Capcom's Street Fighter II, I would detect key-down events, queue them up, and use string matching on the queue.
<br/>
<br/>
Pseudocode follows:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
/* find which buttons were just pressed */
<br/>
cur_joy = (JOY &amp; 0x3ff) ^ 0x3ff;  /* read controller and convert result to active-high */
<br/>
just_pressed = cur_joy &amp; ~last_joy;  /* find new presses */
<br/>
<br/>
/* add relevant events to queue */
<br/>
for(i = 0; i &lt; 10; i++)
<br/>
  if(just_pressed &amp; (1 &lt;&lt; i))  /* check each bit */
<br/>
    add_to_queue(i);
<br/>
<br/>
/* prime next iteration */
<br/>
last_joy = cur_joy;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Then you can detect a fireball by looking at the end of the queue for for 7 4 1 (Down Right B) if facing right or 7 5 1 (Down Left B) if facing left.  A dragon punch would be Right Down Right B (4 7 4 1) if facing right or Left Down Left B (5 7 5 1) if facing left.  A Zangief-style circle throw would be Right Down Left Up B (4 7 5 6 1) if facing right, etc.  My method also lets beginners use mortal kombat style flange moves (down, release, left, release, B) before they learn the smooth SF2 motions.
<br/>
<br/>
But if you're writing a fighting game, you have to take into account that experienced players will be able to make controller motions faster than 60fps, and so 60fps polling won't feel as accurate as 180fps polling.  You can get 180fps by polling the controller three times a frame: at approximately lines 0, 80, and 160.  A 180fps poll rate should be fast enough to capture the fastest controller motions but slow enough not to get confused by contact bounce.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1986 - Malefactor - Mon Jan 27, 2003 6:12 am</h4>
    <div class="postbody"><span class="postbody">I was going to say sequence because nested if statements will mean they'd either have to press them all at once or ungodly fast...
<br/>
<br/>
Queuing seems like the better way..<br/>_________________<br/><a class="postlink" href="http://lorrd.fearware.net" target="_blank"></a><a href="http://mysite.verizon.net/vzep3wth/sitebuildercontent/sitebuilderpictures/lorrdbanner.gif">[Images not permitted - Click here to view it]</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
