<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Global variable scope problem - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>C/C++ > Global variable scope problem</h2>
<div id="posts">
<div class="post">
    <h4>#24916 - isildur - Fri Aug 13, 2004 4:33 pm</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
I'm having a strange problem I never had when using the vc compiler.
<br/>
For gba dev I use devkitARM.
<br/>
<br/>
Let's say I have 2 different C files, I will call them file1.c and file2.c.
<br/>
I declare a global var with the same name and type in each of the 2 files like this:
<br/>
<br/>
int testVar = 0;
<br/>
<br/>
Both files have this and those variables are not declared as extern anywhere in other modules. But the linker complains of multiple definition of 'testVar'.
<br/>
<br/>
Those global vars should each have their own file scope? No?
<br/>
<br/>
What am I doing wrong?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#24918 - poslundc - Fri Aug 13, 2004 4:42 pm</h4>
    <div class="postbody"><span class="postbody">Variables on the global scope are, by default, global (and visible) to all modules.
<br/>
<br/>
You can declare a global as belonging to a single C file by prefixing it with the "static" keyword. (Not to be confused with the bajillion other purposes shared by the static keyword.) The same applies to functions you don't want conflicting with functions in other C files.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#24919 - isildur - Fri Aug 13, 2004 5:04 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for the fast answer. The compiler/linker in Visual Studio does not require the static keyword for globals. The global vars have file scope and have to be declared as extern in other files to be visible.
<br/>
<br/>
But if I declare it like you said:
<br/>
<br/>
static int testVar = 0;
<br/>
<br/>
in both modules, are they separate variables or the same?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#24921 - poslundc - Fri Aug 13, 2004 5:20 pm</h4>
    <div class="postbody"><span class="postbody">They will be separate variables.
<br/>
<br/>
More detailed explanation: anything global in a C file (in other words, global variables and functions not declared static) generates a symbol at compile time that is left in the object (.o) file. When it comes time to link your various modules together into an elf file (.elf), the linker uses those symbols to connect them together.
<br/>
<br/>
Functions and global variables declared static have file scope only, and do not generate those symbols, so you cannot reference them from other modules when linking either intentionally or by accident (as in your situation).
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#24924 - torne - Fri Aug 13, 2004 5:38 pm</h4>
    <div class="postbody"><span class="postbody">The 'extern' bit only tells the *compiler* which variables exist in other modules; it has nothing to do with the linker. The reason it works in VC++'s linker in the way you expect is just because their linker is more 'lenient' with things that are possible problems; the MS linker will usually emit a warning for this case but Visual Studio has a nice habit of decreasing the warning levels of the tools it calls. =)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#24931 - sajiimori - Fri Aug 13, 2004 6:07 pm</h4>
    <div class="postbody"><span class="postbody">Yeah, the older C standard allowed global variable to be declared in multiple files, and the linker would consider them the same variable.  That behavior has been deprecated ever since the "extern" keyword was introduced (which is to say, a long time ago).
<br/>
<br/>
So just to reiterate what Dan essentially said: "global scope" and "file scope" are mutually exclusive.  "Global" doesn't just mean visible to multiple functions -- it means visible to the entire project.  Modern compilers will complain if you reference a global symbol that hasn't been declared (mostly because it doesn't know its type), but the symbol is there nonetheless.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#24937 - isildur - Fri Aug 13, 2004 6:48 pm</h4>
    <div class="postbody"><span class="postbody">Thanks to all for the answers. :)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
