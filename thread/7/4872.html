<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Things to know about C (typdedef struct, weird pointers) - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>C/C++ > Things to know about C (typdedef struct, weird pointers)</h2>
<div id="posts">
<div class="post">
    <h4>#34509 - Dullin - Thu Jan 20, 2005 7:25 pm</h4>
    <div class="postbody"><span class="postbody">I have done a C course in college and wanted to start some GBA development but it seems that my knowledge is insufficient on certain aspects and I'd like to ask your help.
<br/>
<br/>
It seems that the course I took overlooked a couple of things in C that I would like to know before I try myself at some little exercise.
<br/>
<br/>
Let's first go into pointers. I learned that pointers point to an adress and know how to use them in a program (or so I thought) but when I see stuff like this
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define REG_DISPCNT (*(volatile unsigned short*)0x4000000)</td> </tr></table><span class="postbody">
<br/>
<br/>
I don't know what it's supposed to mean.  Especially about the * after the short.
<br/>
<br/>
<br/>
Now onto another problem.
<br/>
<br/>
I have not seen struct at all (they just said that they existed) so when I stumble upon this
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">typedef struct tagOAMEntry
<br/>
{
<br/>
            u16 attribute0;
<br/>
            u16 attribute1;
<br/>
            u16 attribute2;
<br/>
            u16 attribute3;
<br/>
} OAMEntry, *pOAMEntry;
<br/>
<br/>
// Sprite rotation information
<br/>
<br/>
typedef struct tagRotData
<br/>
{
<br/>
            u16 filler1[3];
<br/>
            u16 pa;
<br/>
            u16 filler2[3];
<br/>
            u16 pb;
<br/>
            u16 filler3[3];
<br/>
            u16 pc;
<br/>
            u16 filler4[3];
<br/>
            u16 pd;
<br/>
} RotData, *pRotData;</td> </tr></table><span class="postbody">
<br/>
<br/>
I am even more lost than before. Can anyone point me to what is this supposed to do or at a little tutorial explaining struct so that I can continu on my journey to make games :-)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#34511 - tepples - Thu Jan 20, 2005 7:34 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dullin wrote:</b></span></td> </tr> <tr> <td class="quote">I learned that pointers point to an adress and know how to use them in a program (or so I thought) but when I see stuff like this
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define REG_DISPCNT (*(volatile unsigned short*)0x4000000)</td> </tr></table><span class="postbody">
<br/>
<br/>
I don't know what it's supposed to mean.  Especially about the * after the short.</span></td> </tr></table><span class="postbody">
<br/>
Let's take this apart:
<br/>
<br/>
0x04000000 is a number.
<br/>
(volatile unsigned short*) is a cast operator that maps numbers to pointers.
<br/>
(volatile unsigned short*)0x04000000 is a pointer to a memory location.
<br/>
*(volatile unsigned short*)0x04000000 is the value of that memory location.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I have not seen struct at all (they just said that they existed)</td> </tr></table><span class="postbody">
<br/>
You may have to get a better C book, one that explains structs.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">so when I stumble upon this
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">typedef struct tagOAMEntry
<br/>
{
<br/>
            u16 attribute0;
<br/>
            u16 attribute1;
<br/>
            u16 attribute2;
<br/>
            u16 attribute3;
<br/>
} OAMEntry, *pOAMEntry;</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
This makes an 8-byte record, the first two bytes being attribute0, the second two bytes being attribute1, etc. Once you've read more about structs, you may understand the second one yourself.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#34531 - MumblyJoe - Fri Jan 21, 2005 1:07 am</h4>
    <div class="postbody"><span class="postbody">I would reccomend ditching that way of typing structs, its more past-friendly but doing it this way is FAR clearer to beginners:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
struct whatever
<br/>
{
<br/>
     int  a;
<br/>
     int b;
<br/>
};
<br/>
<br/>
whatever c;
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/><a class="postlink" href="http://www.hungrydeveloper.com" target="_blank">www.hungrydeveloper.com</a>
<br/>
Version 2.0 now up - guaranteed at least 100% more pleasing!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#34541 - sajiimori - Fri Jan 21, 2005 4:17 am</h4>
    <div class="postbody"><span class="postbody">That's only legal in C++, but I agree that it's better.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#34564 - MumblyJoe - Fri Jan 21, 2005 3:19 pm</h4>
    <div class="postbody"><span class="postbody">Really? I thought most C compilers accepted it now (although I haven't actually compiled anything in C for quite some time).<br/>_________________<br/><a class="postlink" href="http://www.hungrydeveloper.com" target="_blank">www.hungrydeveloper.com</a>
<br/>
Version 2.0 now up - guaranteed at least 100% more pleasing!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#34567 - sajiimori - Fri Jan 21, 2005 7:09 pm</h4>
    <div class="postbody"><span class="postbody">If a compiler is truly a C compiler, then it will accept what the C language allows, and it does not allow that form.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#34568 - tepples - Fri Jan 21, 2005 7:18 pm</h4>
    <div class="postbody"><span class="postbody">A compiler that is truly a C compiler will probably also not allow use of inline assembly, CODE_IN_IWRAM, or any other extension to the C language necessary to effective GBA programming.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#35926 - mtg101 - Sun Feb 13, 2005 1:41 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I have not seen struct at all (they just said that they existed)</td> </tr></table><span class="postbody">
<br/>
You may have to get a better C book, one that explains structs.
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
<br/>
I've always relied on "The C. Programming Language" by Brian W. Kernighan &amp; Dennis M. Ritchie (the guys who invented the C language).
<br/>
<br/>
This book won't teach you to program games, or any other specific type of software for that matter. However it does cover the entire C language and is an invaluable reference book.
<br/>
<br/>
The 'equivalent' book for C++ is "The C++ Programming Language" by Bjarne Stroustrup (once again the creator of the language).<br/>_________________<br/>---
<br/>
Speaker for the Dead</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#36246 - LOst? - Wed Feb 16, 2005 1:58 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>MumblyJoe wrote:</b></span></td> </tr> <tr> <td class="quote">I would reccomend ditching that way of typing structs, its more past-friendly but doing it this way is FAR clearer to beginners:
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
struct whatever
<br/>
{
<br/>
     int  a;
<br/>
     int b;
<br/>
};
<br/>
<br/>
whatever c;
<br/>
</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
<br/>
You must make whatever a struct when declaring c. Like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
struct whatever
<br/>
{
<br/>
     int  a;
<br/>
     int b;
<br/>
};
<br/>
<br/>
struct whatever c;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
That's why "typedef" is used, so that you can skip writing struct in front of every declaration. Am I right?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#36310 - sgeos - Thu Feb 17, 2005 5:13 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>LOst? wrote:</b></span></td> </tr> <tr> <td class="quote">You must make whatever a struct when declaring c. Like this:
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
struct whatever
<br/>
{
<br/>
     int  a;
<br/>
     int b;
<br/>
};
<br/>
<br/>
struct whatever c;</td> </tr></table><span class="postbody">
<br/>
<br/>
That's why "typedef" is used, so that you can skip writing struct in front of every declaration. Am I right?</span></td> </tr></table><span class="postbody">
<br/>
Many people typedef structs to save typing.  I've heard the argument that you should not typedef struct away.  If you always use <span style="font-weight: bold">struct type</span> instead of just <span style="font-weight: bold">type</span>, the people reading your code will know that it is a struct.
<br/>
<br/>
Not the best example... Anyway, this could get confusing:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">typedef struct hsv {
<br/>
     int h;
<br/>
     int s;
<br/>
     int v;
<br/>
} hsv;
<br/>
<br/>
typedef u16 rgb;
<br/>
<br/>
void my_function(void)
<br/>
{
<br/>
    rgb my_rgb;
<br/>
    hsv my_hsv;
<br/>
<br/>
    /* do stuff here */
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
Both rgb and hsv conceptually have 3 members.  hsv is a struct, because it is easier to deal with.  rgb is a u16, because that is what the gba uses.
<br/>
<br/>
You should only typedef struct away if the underlying type is a struct now, but might be changed to something else later.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#36314 - tepples - Thu Feb 17, 2005 6:16 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sgeos wrote:</b></span></td> </tr> <tr> <td class="quote">If you always use <span style="font-weight: bold">struct type</span> instead of just <span style="font-weight: bold">type</span>, the people reading your code will know that it is a struct.</td> </tr></table><span class="postbody">
<br/>
Implementations of stdio.h often implement the FILE type as a struct. Likewise, GBFS_FILE and GBFS_ENTRY types in <a class="postlink" href="http://www.pineight.com/gba/#gbfs" target="_blank">my appended asset loader</a> are structs internally, but all the program using the library sees are opaque pointers of type (const GBFS_FILE *). There exist other naming conventions for user-defined types, such as all-caps.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">You should only typedef struct away if the underlying type is a struct now, but might be changed to something else later.</td> </tr></table><span class="postbody">
<br/>
It's best to get in the habit of abstracting away implementation details such as what's behind an opaque pointer, so that if you do eventually change a smallish struct into a long int or a union for speed purposes, you don't have to go back and fix everything that calls your library.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#36318 - sajiimori - Thu Feb 17, 2005 7:47 am</h4>
    <div class="postbody"><span class="postbody">I think user-defined types should mesh cleanly with built-ins.  The more ways that built-ins are special, the harder it is to extend the language to fit your needs.
<br/>
<br/>
The most flexible (and long-lived) languages are the ones that explicitly attempt to make the built-in features unspecial.  You can often tell how well the language achieves that goal by how hard it is to implement the language in itself.
<br/>
<br/>
To answer that question, you ask things like:  If the language didn't have feature-X, could I write the feature as a library?  If I couldn't write it as a library, how hard would it be to implement as a preprocessor?  Would the language even be able to stand on its own without the feature?
<br/>
<br/>
Try answering those questions about C regarding:
<br/>
<br/>
sprintf
<br/>
enums
<br/>
structs
<br/>
functions
<br/>
<br/>
Then go here to see what is possible:
<br/>
<br/>
<a href="http://www.paulgraham.com/rootsoflisp.html" target="_blank">http://www.paulgraham.com/rootsoflisp.html</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#36323 - tepples - Thu Feb 17, 2005 9:43 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">you ask things like: If the language didn't have feature-X, could I write the feature as a library? If I couldn't write it as a library, how hard would it be to implement as a preprocessor? Would the language even be able to stand on its own without the feature?</td> </tr></table><span class="postbody">
<br/>
<ul><li>sprintf(): multiple calls to individual formatting instructions </li><li>enums (the C kind, not the C++ kind): #define </li><li>structs: arrays (which you already have to handle manually when serializing stuff) </li><li>functions outside main(): handle them like in asm; push a return label to a software stack before you call a function and then have the called function pop a return address and "goto" it </li></ul> By then you've reduced C to a portable assembly language, and a C compiler becomes a preprocessor for this.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Then go here to see what is possible:
<br/>
<br/>
<a href="http://www.paulgraham.com/rootsoflisp.html" target="_blank">http://www.paulgraham.com/rootsoflisp.html</a></td> </tr></table><span class="postbody">
<br/>
To read it if you have Adobe Reader but not ghostscript: <a class="postlink" href="http://www.ps2pdf.com/" target="_blank">ps2pdf.com</a><br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#36341 - sajiimori - Thu Feb 17, 2005 8:13 pm</h4>
    <div class="postbody"><span class="postbody">Right, the point is that sprintf can be entirely implemented in C, enums can be added fairly easily with preprocessing, structs can be added with much more challenging preprocessing, and the language simply cannot stand without functions because main() is required.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
