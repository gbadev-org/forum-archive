<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Newbie C question - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>C/C++ > Newbie C question</h2>
<div id="posts">
<div class="post">
    <h4>#168866 - sverx - Mon Jun 01, 2009 9:51 am</h4>
    <div class="postbody"><span class="postbody">... sometimes I feel a beginner even more than what I am in fact [;)]
<br/>
<br/>
The question, made short, is: would be a second condition after an OR evaluated if the first condition is already true (same with AND and false)? I mean, let's say we have
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">if ((a==5) || (b==6))  &lt;do something&gt;</td> </tr></table><span class="postbody">
<br/>
<br/>
The condition (b==6) would ever be evaluated if (a==5) is true?
<br/>
<br/>
And what if the code is like
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">if ((a==5) || (++b==6))  &lt;do something&gt;</td> </tr></table><span class="postbody">
<br/>
then?
<br/>
<br/>
(I'm asking this question also because I remember that once, when I was programming with Borland's Pascal, there was a compiler option called somewhat like "short circuit evaluation"...)
<br/>
<br/>
Thanks! :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168867 - Dwedit - Mon Jun 01, 2009 10:48 am</h4>
    <div class="postbody"><span class="postbody">I'm pretty sure that short circuit evaluation is the standard.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168870 - vuurrobin - Mon Jun 01, 2009 12:06 pm</h4>
    <div class="postbody"><span class="postbody">I believe that || is short circuit and | is long circuit evaluation if both sides are boolean values (bitwise OR with only 1 bit is pretty much the same as boolean wise OR).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168871 - Kyoufu Kawa - Mon Jun 01, 2009 1:45 pm</h4>
    <div class="postbody"><span class="postbody">I don't believe that's right, vuurrobin. Double || is "if this or that", a boolean operation that uses true or false conditions, while | is "this OR'd with that", a binary operation that changes the value of "this".
<br/>
<br/>
Same with &amp; (and).
<br/>
<br/>
<br/>
Edit: Note that if you use single | in a conditional...</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">if (this | that) ...</td> </tr></table><span class="postbody">and "this" ends up nonzero, it will evaluate to true. This behavior is related to using assignment = instead of comparison ==.
<br/>
<br/>
Edit 2: it also depends on what the boolean values <span style="font-style: italic">are</span>. We don't all use C++.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168872 - Mighty Max - Mon Jun 01, 2009 2:14 pm</h4>
    <div class="postbody"><span class="postbody">|| doesn't evaluate the remaining part if it the statement is already a tautology. Let a be a boolean  (a || !a) &amp;&amp; (!a || a) will only do 3 checks and skips one and evaluate directly to true.
<br/>
<br/>
| will evaluate both sides, because it will bitwise operate and has a bit value, not a strict boolean as a result. It doesn't matter if it is a int-type boolean or a another specific implementation. Let a be int or boolean or any other ordinal (a | ~a) &amp; (~a | a) evaluates to the same type as a with the value ~0 (-&gt; true) all elements are included in the calculation.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168874 - Kyoufu Kawa - Mon Jun 01, 2009 3:03 pm</h4>
    <div class="postbody"><span class="postbody">You can't really call | a comparison, though, can you? It's an assigment whose end result is compared, right?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168876 - gauauu - Mon Jun 01, 2009 3:22 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Kyoufu Kawa wrote:</b></span></td> </tr> <tr> <td class="quote">You can't really call | a comparison, though, can you? It's an assigment whose end result is compared, right?</td> </tr></table><span class="postbody">
<br/>
<br/>
Not sure what you mean by being an assignment -- it's an operator, just like + and - are.  (Although I would agree that you wouldn't generally call it a comparison operator) If you use |=, you will be doing assignment.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168877 - Mighty Max - Mon Jun 01, 2009 3:27 pm</h4>
    <div class="postbody"><span class="postbody">|| would fall under the same definition. (bool x bool) -&gt; bool is an operation.
<br/>
<br/>
So yes i can call it an compare, Only that the equivalences of it create not 2 partitions, but 2^bits_per_word.
<br/>
<br/>
Taken the (bool) cast, it then again does map to a boolean compare ... (and that cast is implizit for an if and such)<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168879 - Kyoufu Kawa - Mon Jun 01, 2009 3:54 pm</h4>
    <div class="postbody"><span class="postbody">Okay now my head hurts. Thanks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168911 - sgeos - Tue Jun 02, 2009 7:54 am</h4>
    <div class="postbody"><span class="postbody">This is easy to check.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include &lt;stdio.h&gt;
<br/>
<br/>
#define OPERATION       ||
<br/>
#define STRINGIZE_(a)   #a
<br/>
#define STRINGIZE(a)    STRINGIZE_(a)
<br/>
#define EVALUATE(a)     subroutine(#a, a)
<br/>
<br/>
int subroutine(const char *pName, int pValue)
<br/>
{
<br/>
        printf("%s = %d\n", pName, pValue);
<br/>
        return pValue;
<br/>
}
<br/>
<br/>
int main(void)
<br/>
{
<br/>
        int value[2] = {-1, 1};
<br/>
<br/>
        printf("if ( %s %s %s )\n",
<br/>
                STRINGIZE(value[0]), STRINGIZE(OPERATION), STRINGIZE(value[1]));
<br/>
        if ( EVALUATE(value[0]) OPERATION EVALUATE(value[1]) )
<br/>
                printf("if condition met\n");
<br/>
        else
<br/>
                printf("else condition met\n");
<br/>
<br/>
        return 0;
<br/>
}</td> </tr></table><span class="postbody">
<br/>
The output is:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">$ ./short.exe
<br/>
if ( value[0] || value[1] )
<br/>
value[0] = -1
<br/>
if condition met</td> </tr></table><span class="postbody">
<br/>
Only the first condition is tested.  Try changing the operation macro and see what happens.  =)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168912 - elwing - Tue Jun 02, 2009 8:21 am</h4>
    <div class="postbody"><span class="postbody">rather than trying to find theory, shouldn't we check ansi standard? i'm pretty sure that this is defined... that said perform the test, i wouldn't bet every compiler follows the norms exactly...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168913 - elwing - Tue Jun 02, 2009 8:38 am</h4>
    <div class="postbody"><span class="postbody">from ISO/IEC 9899:TC3 Committee Draft ? Septermber 7, 2007 WG14/N1256:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"><span style="text-decoration: underline"><span style="font-weight: bold">6.5.11 Bitwise exclusive OR operator</span></span>
<br/>
<span style="font-weight: bold">Syntax</span>
<br/>
1 exclusive-OR-expression:
<br/>
AND-expression
<br/>
exclusive-OR-expression ^ AND-expression
<br/>
<span style="font-weight: bold">Constraints</span>
<br/>
2 Each of the operands shall have integer type.
<br/>
<span style="font-weight: bold">Semantics</span>
<br/>
3 The usual arithmetic conversions are performed on the operands.
<br/>
4 The result of the ^ operator is the bitwise exclusive OR of the operands (that is, each bit
<br/>
in the result is set if and only if exactly one of the corresponding bits in the converted
<br/>
operands is set).
<br/>
<br/>
<span style="text-decoration: underline"><span style="font-weight: bold">6.5.12 Bitwise inclusive OR operator</span></span>
<br/>
<span style="font-weight: bold">Syntax</span>
<br/>
1 inclusive-OR-expression:
<br/>
exclusive-OR-expression
<br/>
inclusive-OR-expression | exclusive-OR-expression
<br/>
<span style="font-weight: bold">Constraints</span>
<br/>
2 Each of the operands shall have integer type.
<br/>
<span style="font-weight: bold">Semantics</span>
<br/>
3 The usual arithmetic conversions are performed on the operands.
<br/>
4 The result of the | operator is the bitwise inclusive OR of the operands (that is, each bit in
<br/>
the result is set if and only if at least one of the corresponding bits in the converted
<br/>
operands is set).
<br/>
<br/>
<span style="text-decoration: underline"><span style="font-weight: bold">6.5.13 Logical AND operator</span></span>
<br/>
<span style="font-weight: bold">Syntax</span>
<br/>
1 logical-AND-expression:
<br/>
inclusive-OR-expression
<br/>
logical-AND-expression &amp;&amp; inclusive-OR-expression
<br/>
<span style="font-weight: bold">Constraints</span>
<br/>
2 Each of the operands shall have scalar type.
<br/>
<span style="font-weight: bold">Semantics</span>
<br/>
3 The &amp;&amp; operator shall yield 1 if both of its operands compare unequal to 0; otherwise, it
<br/>
yields 0. The result has type int.
<br/>
4 Unlikethe bitwise binary &amp; operator,the &amp;&amp; operator guarantees left-to-right evaluation;
<br/>
there is a sequence point after the evaluation of the ﬁrst operand. If the ﬁrst operand
<br/>
compares equal to 0, the second operand is not evaluated.
<br/>
<br/>
<span style="text-decoration: underline"><span style="font-weight: bold">6.5.14 Logical OR operator</span></span>
<br/>
<span style="font-weight: bold">Syntax</span>
<br/>
1 logical-OR-expression:
<br/>
logical-AND-expression
<br/>
logical-OR-expression || logical-AND-expression
<br/>
<span style="font-weight: bold">Constraints</span>
<br/>
2 Each of the operands shall have scalar type.
<br/>
<span style="font-weight: bold">Semantics</span>
<br/>
3 The || operator shall yield 1 if either of its operands compare unequal to 0; otherwise, it
<br/>
yields 0. The result has type int.
<br/>
4 Unlikethe bitwise | operator,the || operator guarantees left-to-right evaluation; there is
<br/>
asequence point after the evaluation of the ﬁrst operand. If the ﬁrst operand compares
<br/>
unequal to 0, the second operand is not evaluated.</td> </tr></table><span class="postbody">
<br/>
<br/>
guess vuurrobin was right (for the norm at least)
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I believe that || is short circuit and | is long circuit evaluation if both sides are boolean values (bitwise OR with only 1 bit is pretty much the same as boolean wise OR).</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168919 - Miked0801 - Tue Jun 02, 2009 5:26 pm</h4>
    <div class="postbody"><span class="postbody">In anycase, doing:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
if ((a==5) || (++b==6))  &lt;do something&gt;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Would get you fired as a professional coder.  Seriously, if you have to really think about what a statement is doing and there is a much, much easier way to do it, then do it the easier way:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
if(a==5)
<br/>
{
<br/>
    something();
<br/>
}
<br/>
else
<br/>
{
<br/>
    ++b;
<br/>
    if(b == 6)
<br/>
    {
<br/>
        something();
<br/>
    }
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
Or don't short circuit it and do the increment always.  It matter little :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168920 - gauauu - Tue Jun 02, 2009 7:33 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Miked0801 wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Or don't short circuit it and do the increment always.  It matter little :)</td> </tr></table><span class="postbody">
<br/>
<br/>
Yes, what he said.  But (based on our previous conversation) don't take that to mean that
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
if ((a==5) | (++b==6))  &lt;do something&gt; 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
is a good idea either -- although it should work, and avoid the short-circuiting, the fact that we have this whole thread discussing whether that works goes to show that it can be confusing.  Clarity is more important.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168921 - Tyler24 - Wed Jun 03, 2009 2:43 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Would get you fired as a professional coder.</td> </tr></table><span class="postbody">
<br/>
<br/>
They're that serious in the real world, eh?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168922 - Dwedit - Wed Jun 03, 2009 3:12 am</h4>
    <div class="postbody"><span class="postbody">Read <a href="http://www.thedailywtf.com" target="_blank">www.thedailywtf.com</a> to see what "Professionals" can get away with.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168923 - elwing - Wed Jun 03, 2009 6:46 am</h4>
    <div class="postbody"><span class="postbody">that said i have already seen much worst code from professional consulting entreprise...
<br/>
I'll correct the issue... you might get fired with such a piece of code</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168924 - sgeos - Wed Jun 03, 2009 7:38 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>elwing wrote:</b></span></td> </tr> <tr> <td class="quote">you might get fired with such a piece of code</td> </tr></table><span class="postbody">
<br/>
You <span style="font-weight: bold">should</span> hear about it, at the very least.  You might get fired, you might be put on probation.  On the otherhand, some companies don't care about much of anything.
<br/>
<br/>
FWIW, I totally missed ++b part of the code.  Such expressions should live on lines of their own.  See Miked0801's post an example of good coding practice.
<br/>
<br/>
Often theoretical questions can be most compactly illustrated using bad coding practices.  If this is the case, fine, but again, such compact code can be easily tested.  If the behavior is not undefined, a compliant compiler will produce standard behavior by definition.  A few changes to the previous test program yield the following output:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">$ ./short.exe
<br/>
int a = 5;
<br/>
int b = 5;
<br/>
if ( (a == 5) || (++b == 6) )
<br/>
// (a == 5) == 1
<br/>
  // if condition met</td> </tr></table><span class="postbody">
<br/>
<br/>
Source:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include &lt;stdio.h&gt;
<br/>
<br/>
#define OPERATION       ||
<br/>
#define VALUE_A         5
<br/>
#define VALUE_B         5
<br/>
#define VALUE_TEST_A    5
<br/>
#define VALUE_TEST_B    6
<br/>
#define TEST_A(a)       (a == VALUE_TEST_A)
<br/>
#define TEST_B(a)       (++a == VALUE_TEST_B)
<br/>
#define STRINGIZE_(a)   #a
<br/>
#define STRINGIZE(a)    STRINGIZE_(a)
<br/>
#define EVALUATE(a)     printExpressionValue(STRINGIZE_(a), a)
<br/>
<br/>
int printExpressionValue(const char *pExpression, int pValue)
<br/>
{
<br/>
        printf("// %s == %d\n", pExpression, pValue);
<br/>
        return pValue;
<br/>
}
<br/>
<br/>
int main(void)
<br/>
{
<br/>
        int a = VALUE_A;
<br/>
        int b = VALUE_B;
<br/>
<br/>
        printf("int a = %d;\nint b = %d;\n", a, b);
<br/>
        printf("if ( %s %s %s )\n", STRINGIZE(TEST_A(a)),
<br/>
                STRINGIZE(OPERATION), STRINGIZE(TEST_B(b)));
<br/>
        if ( EVALUATE(TEST_A(a)) OPERATION EVALUATE(TEST_B(b)) )
<br/>
                printf("  // if condition met\n");
<br/>
        else
<br/>
                printf("  // else condition met\n");
<br/>
<br/>
        return 0;
<br/>
}</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168925 - kusma - Wed Jun 03, 2009 10:30 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Tyler24 wrote:</b></span></td> </tr> <tr> <td class="quote">They're that serious in the real world, eh?</td> </tr></table><span class="postbody">
<br/>
Not really. As a matter of fact, I think he's wrong. There's nothing wrong with constructs like that IMO. Sure, the variables shouldn't be named "a" and "b", and perhaps there should be a comment explaining the logic behind the code, but there's nothing wrong with using statements like that IMO. And I've seen people keep their jobs over way, WAY worse code than that.
<br/>
<br/>
Personally, I'd write it as 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">if (5 !=a) ++b;
<br/>
if (5 == a || 6 == b) &lt;code&gt;</td> </tr></table><span class="postbody">
<br/>
...but that's purely out of preference.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168926 - sverx - Wed Jun 03, 2009 10:41 am</h4>
    <div class="postbody"><span class="postbody">Oh, how many replies! Didn't expect that!
<br/>
<br/>
So, it seems to me that I understood that if I'm using the <span style="font-weight: bold">||</span> operator then a "second" comparison will be made only if the "first" isn't TRUE, and the same with <span style="font-weight: bold">&amp;&amp;</span> operator and having the first part not FALSE (thus it's actually what Borland's Pascal called "short circuit evaluation") right? Everyone agree?
<br/>
<br/>
btw:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">In anycase, doing:
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">if ((a==5) || (++b==6))  &lt;do something&gt; </td> </tr></table><span class="postbody">
<br/>
Would get you fired as a professional coder.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Fortunatly [;)] that was just for example, I'm not doing anything like that. (Actually I also prefer to keep the code as simple as possible, even if I have to write few more lines to achieve the same...)
<br/>
<br/>
The question originally entered my head because I wanted to check if a pointer was NULL or not and, if it wasn't null, if was NULL one of the pointer of the struct pointed by the first pointer. So I had something like that
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">if (ptr!=NULL)
<br/>
  if (ptr-&gt;son_ptr!=NULL)
<br/>
    &lt;do something&gt;</td> </tr></table><span class="postbody">
<br/>
<br/>
and I was asking myself if writing
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">if ((ptr!=NULL) &amp;&amp; (ptr-&gt;son_ptr!=NULL))
<br/>
  &lt;do something&gt;</td> </tr></table><span class="postbody">
<br/>
<br/>
would potentially lead to a problem when cheking the second condition if the pointer was NULL. I hope I explained well enough...
<br/>
<br/>
Thanks everyone :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168927 - kusma - Wed Jun 03, 2009 10:52 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sverx wrote:</b></span></td> </tr> <tr> <td class="quote">So, it seems to me that I understood that if I'm using the <span style="font-weight: bold">||</span> operator then a "second" comparison will be made only if the "first" isn't TRUE, and the same with <span style="font-weight: bold">&amp;&amp;</span> operator and having the first part not FALSE (thus it's actually what Borland's Pascal called "short circuit evaluation") right? Everyone agree?</td> </tr></table><span class="postbody">
<br/>
Yes. This is a guarantee that K&amp;R gives. Short circuiting (although I believe it's not called that by K&amp;R) these statements is a requirement for C/C++ compilers.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">if ((ptr!=NULL) &amp;&amp; (ptr-&gt;son_ptr!=NULL))
<br/>
  &lt;do something&gt;</td> </tr></table><span class="postbody">
<br/>
<br/>
would potentially lead to a problem when cheking the second condition if the pointer was NULL. I hope I explained well enough...
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
Yep, this is safe. This is a very common (and useful) construct. I use it (or similar constructs) all the time myself, and it's perfectly well-defined.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168928 - elwing - Wed Jun 03, 2009 10:52 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sverx wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
and I was asking myself if writing
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">if ((ptr!=NULL) &amp;&amp; (ptr-&gt;son_ptr!=NULL))
<br/>
  &lt;do something&gt;</td> </tr></table><span class="postbody">
<br/>
<br/>
would potentially lead to a problem when cheking the second condition if the pointer was NULL. I hope I explained well enough...
<br/>
<br/>
Thanks everyone :)</span></td> </tr></table><span class="postbody">
<br/>
<br/>
hum good example one where we could see that kind of example... I think I have already seen this kind of thing at work... not nice at all, but i guess it's a case were it is acceptable... and ansi C tell us the exact behaviour the compiler should have...
<br/>
and to the reader what is done is pretty obvious... trough he might miss the trick to avoid an access violation if ptr is null
<br/>
<br/>
edit, doh too late...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168929 - elwing - Wed Jun 03, 2009 10:54 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>kusma wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sverx wrote:</b></span></td> </tr> <tr> <td class="quote">So, it seems to me that I understood that if I'm using the <span style="font-weight: bold">||</span> operator then a "second" comparison will be made only if the "first" isn't TRUE, and the same with <span style="font-weight: bold">&amp;&amp;</span> operator and having the first part not FALSE (thus it's actually what Borland's Pascal called "short circuit evaluation") right? Everyone agree?</td> </tr></table><span class="postbody">
<br/>
Yes. This is a guarantee that K&amp;R gives. Short circuiting (although I believe it's not called that by K&amp;R) these statements is a requirement for C/C++ compilers.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
I have pasted the article from ansi C99 regarding this on the previous page</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168931 - kusma - Wed Jun 03, 2009 11:05 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>elwing wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>kusma wrote:</b></span></td> </tr> <tr> <td class="quote">Yes. This is a guarantee that K&amp;R gives. Short circuiting (although I believe it's not called that by K&amp;R) these statements is a requirement for C/C++ compilers.</td> </tr></table><span class="postbody">
<br/>
<br/>
I have pasted the article from ansi C99 regarding this on the previous page</span></td> </tr></table><span class="postbody">
<br/>
Yeah, I just thought it would be good for the discussion to mention that it has been a guarantee all along since K&amp;R, so it's a very safe assumption to make. Not everyone gets to play with C99-compliant compilers ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168932 - gauauu - Wed Jun 03, 2009 3:06 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>elwing wrote:</b></span></td> </tr> <tr> <td class="quote">not nice at all, but i guess it's a case were it is acceptable... </td> </tr></table><span class="postbody">
<br/>
<br/>
Heh, short-circuiting to avoid dereferencing null pointers is one of the few places where I DO think it is both nice and acceptable.  
<br/>
<br/>
And about getting fired for writing bad code -- I guess it depends on where you work.  I've worked for 4 different places over the past 14 years.  At 2 of them, bad code will get peer-reviewed and they'll just ask you to rewrite it better.  At the other two, the worst that might happen is somebody might make fun of you if they HAPPENED to look at your code.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168933 - elwing - Wed Jun 03, 2009 3:24 pm</h4>
    <div class="postbody"><span class="postbody">personally I am working in a place where, as long as your code works, the other don't care... well, don't care much... and i just hate that, i'dd love more control...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168934 - sgeos - Wed Jun 03, 2009 5:08 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>gauauu wrote:</b></span></td> </tr> <tr> <td class="quote">if they HAPPENED to look at your code.</td> </tr></table><span class="postbody">
<br/>
Because something like the <a class="postlink" href="http://www.thestreet.com/story/10455712/microsoft-zunes-new-year-crash.html" target="_blank">Microsoft Zune crash</a> is what every company wants.  Evidently it was an easy to spot <a class="postlink" href="http://tech.blorge.com/Structure:%20/2009/01/05/shoddy-programming-by-microsoft-led-to-zune-crash/" target="_blank">stupid programming mistake</a>.  Three cheers for failing to implement code reviews.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168935 - sajiimori - Wed Jun 03, 2009 6:16 pm</h4>
    <div class="postbody"><span class="postbody">I use short circuiting all the time.  I arrange conditional expressions so the cheapest/most-unlikely test comes first, so the expression will bail as quickly as possible.
<br/>
<br/>
I also don't believe that "uncommon" is the same thing as "bad", and I like short code.  I don't write 12 lines when 2 will do.  If the 2 lines need comments, then I write comments.
<br/>
<br/>
Guess I'm just weird like that!  =)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168936 - gmiller - Wed Jun 03, 2009 11:27 pm</h4>
    <div class="postbody"><span class="postbody">Just remember that at the compiler level "most" compilers reverse your if logic to branch to the false code and fall into the true code.  Of course your mileage may vary between compilers but they are trying to map what to type into assembly without introducing errors (pointer aliasing, etc ...)  on their part and allow you to totally screw things up (as long as your syntax and type checking works) on your own.
<br/>
<br/>
The compiler standards dictate how the code should work not how the compiler should emit their code so there is room for differences as long as the result is the standard behavior.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168938 - sajiimori - Thu Jun 04, 2009 3:30 am</h4>
    <div class="postbody"><span class="postbody">I meant "a &amp;&amp; b &amp;&amp; c" as opposed to "if a then b else c".
<br/>
<br/>
I guess the compiler could rearrange the &amp;&amp; expression, if it doesn't contain side-effects or extern calls.  But in that case, I don't care much about the order, either...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168945 - Miked0801 - Thu Jun 04, 2009 4:38 pm</h4>
    <div class="postbody"><span class="postbody">Bah, what I was commenting on was using the prefix increment operator while counting on short-circuit if loops.  Yes, it's standard.  Yes, it should work in every case.
<br/>
<br/>
No, it is not intuitive nor readable if you have to go back and maintain it in the future, therefore it is a future source of headaches and bugs all because someone got cute.  If you've got a strong reason for doing so, at least put a comment there calling out you are being cute for a reason.  
<br/>
<br/>
On the null checks, I admit that I get a slightly uncomfortable every time I see:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
if(foo != null &amp;&amp; foo-&gt;doSomething() == bleh)
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
just because I've been trained by wonderful compilers over the years not to trust them.  I usually break that into 2 different if blocks - though that is much more whitespace and is almost certainly overkill.
<br/>
<br/>
And no, doing the prefix/if thing once won't get you fired.  But that sort of code written over time will get you there quick.  Keep it simple stupid unless you have a good reason not to - and then comment like crazy.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168947 - kusma - Thu Jun 04, 2009 6:46 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Miked0801 wrote:</b></span></td> </tr> <tr> <td class="quote">just because I've been trained by wonderful compilers over the years not to trust them.</td> </tr></table><span class="postbody">
<br/>
Well, but to be able to get anything done, you absolutely HAVE to trust them. Whenever you find a breakage, find out why it breaks, and avoid that particular feature for that particular compiler. But for the love of god, verify that it's an actual compiler-bug. I WAY more often see programmers falsely believing they've found a compiler-bug than I see actual compiler-bugs... and I've been working on compilers and with other peoples alpha-quality compilers myself ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168950 - Miked0801 - Thu Jun 04, 2009 11:21 pm</h4>
    <div class="postbody"><span class="postbody">No worries, I don't go screaming compiler bug unless I am absolutely sure and have the proof in hand to back it.  Claiming compiler bug otherwise is just a quick out that usually masks bad code.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168962 - elyk1212 - Sat Jun 06, 2009 1:06 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sgeos wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>gauauu wrote:</b></span></td> </tr> <tr> <td class="quote">if they HAPPENED to look at your code.</td> </tr></table><span class="postbody">
<br/>
Because something like the <a class="postlink" href="http://www.thestreet.com/story/10455712/microsoft-zunes-new-year-crash.html" target="_blank">Microsoft Zune crash</a> is what every company wants.  Evidently it was an easy to spot <a class="postlink" href="http://tech.blorge.com/Structure:%20/2009/01/05/shoddy-programming-by-microsoft-led-to-zune-crash/" target="_blank">stupid programming mistake</a>.  Three cheers for failing to implement code reviews.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
LOL, I worked at Freescale when that bug was spotted (It was actually FS code, I didn't work on that project though).  
<br/>
<br/>
It was sad since, from my understanding, Freescale and MS seemed to have missed the bug, as it was example source handed over to MS...   
<br/>
<br/>
AFAIK it was just example code on how to program the hardware, a template for MS to follow.  But I didn't look into it much.  Either way, many pairs of eyes viewed the code... or should have...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168964 - sgeos - Sat Jun 06, 2009 10:56 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>elyk1212 wrote:</b></span></td> </tr> <tr> <td class="quote">AFAIK it was just example code on how to program the hardware, a template for MS to follow.  But I didn't look into it much.  Either way, many pairs of eyes viewed the code... or should have...</td> </tr></table><span class="postbody">
<br/>
So it was non-production code that slipped into the final product?  When I was talking about this with some MS guys, they theorized that it was some code produced by a subcontractor that nobody looked at... it sounds like they were half right.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168978 - elyk1212 - Sun Jun 07, 2009 9:38 pm</h4>
    <div class="postbody"><span class="postbody">Yeah, from what I know, it was driver code handed off to MS, for the RTC. Usually when they come up with new hardware they'll come out with a programming manual, and example code how to program the hardware (the usual: avoid this bug, stick to this use case sort of thing).
<br/>
<br/>
I *think* this was one piece of such code, or so was the rumor at the office.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
