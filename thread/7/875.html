<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Interrupt handling: tutorial and docs all differ on basics. - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>C/C++ > Interrupt handling: tutorial and docs all differ on basics.</h2>
<div id="posts">
<div class="post">
    <h4>#4378 - jaholmes - Sat Mar 29, 2003 8:41 am</h4>
    <div class="postbody"><span class="postbody">Ok, so I'm working on my first GBA project, and I'm a bit confused.  Docs talk about saving and restoring REG_IME in your interrupt handler, but is that really a concern?  For example, many demos don't do this (e.g., those that use Jeff F's Crt0.S with __FastInterrupts or __SingleInterrupts turned on and implement InterruptProcess in their C/C++ sources).
<br/>
<br/>
I've written some code that enables interrupts for timers 0 and 1, one set for twice the overflow rate of the other, and I don't see any nested interrupts happening.  I've put hideous delay loops inside of InterruptProcess, but a nested interrupt simply never happens.  Am I missing something?
<br/>
<br/>
Seems to me that, if you're NOT aiming to allow nested interrupts and NOT using __MultipleInterrupts, your interrupt handler ought to be as simple as:
<br/>
<br/>
void InterruptProcess() {
<br/>
<br/>
    //
<br/>
    // &lt;-- do whatever you want based on REG_IF;
<br/>
    //
<br/>
<br/>
    REG_IF=REG_IF;  // acknowledge all interrupts
<br/>
}
<br/>
<br/>
All of my experiments seem to indicate this is fine, but I'm more interested in hard facts :)
<br/>
<br/>
Regards,
<br/>
Aaron
<br/>
<br/>
BTW:  THANKS LUNA_S!!! ... for fixing my registration.  This is my first post, so "hello" all around.  I'm jazzed to be getting started here.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4389 - tepples - Sat Mar 29, 2003 5:07 pm</h4>
    <div class="postbody"><span class="postbody">Note that when you acknowledge interrupts, you also have to tell the BIOS that you acknowledged them.  Whatever you write to REG_IF you should also write to 0x03fffff8 (an address in IWRAM).
<br/>
<br/>
#define REG_BIOSIF (*(unsigned short *)0x03fffff8)
<br/>
<br/>
and then it'd be </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void InterruptProcess() {
<br/>
  int interrupts = REG_IF;
<br/>
<br/>
  //
<br/>
  // &lt;-- do whatever you want based on |interrupts|;
<br/>
  //
<br/>
<br/>
  REG_BIOSIF = interrupts; // acknowledge all interrupts to BIOS
<br/>
  REG_IF = interrupts; // acknowledge all interrupts to HW
<br/>
}</td> </tr></table><span class="postbody"><br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
