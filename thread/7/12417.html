<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Is there a shorter way I can do this? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>C/C++ > Is there a shorter way I can do this?</h2>
<div id="posts">
<div class="post">
    <h4>#118088 - LOst? - Sat Feb 10, 2007 12:26 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
template &lt;typename X, typename Y, typename Z&gt;
<br/>
class A
<br/>
{
<br/>
protected:
<br/>
void (A::*Hey) (A &lt;X, Y, Z&gt;* ptr);
<br/>
};
<br/>
<br/>
template &lt;typename X, typename Y, typename Z&gt;
<br/>
class B : public A &lt;X, Y, Z&gt;
<br/>
{
<br/>
private:
<br/>
void OMG (B &lt;X, Y, Z&gt;* ptr)
<br/>
{
<br/>
}
<br/>
<br/>
public:
<br/>
B ()
<br/>
{
<br/>
Hey = static_case &lt;void A &lt;X, Y, Z&gt;::*) (A &lt;X, Y, Z&gt;*)&gt; (&amp;B &lt;X, Y, Z&gt;::OMG);
<br/>
}
<br/>
<br/>
};
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Anyway to make this shorter? Or to write a macro, function, or template that can do this in a better way?
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Hey = static_case &lt;void A &lt;X, Y, Z&gt;::*) (A &lt;X, Y, Z&gt;*)&gt; (&amp;B &lt;X, Y, Z&gt;::OMG);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Thanks in advance :)<br/>_________________<br/><span style="font-style: italic">Exceptions are fun</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#118091 - sajiimori - Sat Feb 10, 2007 1:45 am</h4>
    <div class="postbody"><span class="postbody">Casting method pointers yields undefined behavior.  Use virtuals, boost::function, or <a class="postlink" href="http://www.codeproject.com/cpp/FastDelegate.asp" target="_blank">FastDelegate</a>.
<br/>
<br/>
Edit: Here's an example using FastDelegate.  I'm not sure why anyone would do this, but at least it's correct.  (All the template stuff is irrelevant.)
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
template &lt;typename X, typename Y, typename Z&gt;
<br/>
class A
<br/>
{
<br/>
protected:
<br/>
   FastDelegate&lt;void(A*)&gt; Hey;
<br/>
};
<br/>
<br/>
<br/>
template &lt;typename X, typename Y, typename Z&gt;
<br/>
class B : public A &lt;X, Y, Z&gt;
<br/>
{
<br/>
public:
<br/>
   B()
<br/>
   {
<br/>
      Hey = FastDelegate&lt;void(A&lt;X, Y, Z&gt;*)&gt;(this, &amp;B::OMG);
<br/>
   }
<br/>
<br/>
private:
<br/>
   void OMG(A&lt;X, Y, Z&gt;* aPtr)
<br/>
   {
<br/>
      // Dynamic cast needed because there's no way to guarantee
<br/>
      // that a B pointer was provided to OMG.
<br/>
      B* ptr = dynamic_cast&lt;B*&gt;(aPtr);
<br/>
   }
<br/>
};
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#118152 - LOst? - Sat Feb 10, 2007 3:03 pm</h4>
    <div class="postbody"><span class="postbody">sajiimori, thank you for your fast replay :)
<br/>
<br/>
I have looked into Delegate and other forms of tamplate hacks. It seems I have no wins by using any form of member function pointer here. I am going back to virtuals and switch case.
<br/>
<br/>
Else I wanted the best form of dynamic event processing possible.<br/>_________________<br/><span style="font-style: italic">Exceptions are fun</span></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
