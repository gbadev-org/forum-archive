<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>one little color question, whats wrong? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>C/C++ > one little color question, whats wrong?</h2>
<div id="posts">
<div class="post">
    <h4>#44016 - Issac - Sun May 29, 2005 12:12 pm</h4>
    <div class="postbody"><span class="postbody">I made a little test to catch up a little coding... 
<br/>
but somehow, when I try it out, I just get a black screen (white at first)
<br/>
can someone tell me what i've done wrong??
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include &lt;gba.h&gt;
<br/>
int main()
<br/>
{
<br/>
    unsigned char x,y,z,q;  
<br/>
    z=0;
<br/>
    q=0;
<br/>
    SetMode(MODE_3 | BG2_ENABLE);   
<br/>
 
<br/>
    for(x = 0; x &lt; SCREEN_WIDTH; x++){   
<br/>
        for(y = 0; y &lt; SCREEN_HEIGHT; y++){  
<br/>
            if(z&lt;31 &amp;&amp; q==0){
<br/>
               z++;
<br/>
               VideoBuffer [x+ y * SCREEN_WIDTH] = RGB16(z,0,0);
<br/>
       }
<br/>
       else{
<br/>
      q++;z=0;
<br/>
       }
<br/>
            if(z&lt;31 &amp;&amp; q==1){
<br/>
               z++;
<br/>
               VideoBuffer [x+ y * SCREEN_WIDTH] = RGB16(0,z,0);
<br/>
       }
<br/>
       else{
<br/>
      q++;z=0;
<br/>
       }
<br/>
            if(z&lt;31 &amp;&amp; q==2){
<br/>
               z++;
<br/>
               VideoBuffer [x+ y * SCREEN_WIDTH] = RGB16(0,0,z);
<br/>
       }
<br/>
       else{
<br/>
      q++;z=0;
<br/>
       }
<br/>
       if(q==3){
<br/>
      VideoBuffer [x+ y * SCREEN_WIDTH] = RGB16(31,31,31);
<br/>
         }
<br/>
 }}
<br/>
    while(1){}  
<br/>
 }</td> </tr></table><span class="postbody"><br/>_________________<br/>yeah, well, maybe... or? anyways.... eh...  what was i talking about??</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44032 - poslundc - Sun May 29, 2005 6:02 pm</h4>
    <div class="postbody"><span class="postbody">Fundamental debugging question you should ask yourself first: does it work when you take all the ifs/elses out and just try to paint the entire screen a single colour?
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44046 - Issac - Sun May 29, 2005 7:50 pm</h4>
    <div class="postbody"><span class="postbody">why, yes it does.
<br/>
i dont see why it shouldn't work :S
<br/>
EDIT:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
    unsigned char x,y,z;  
<br/>
 z=31;
<br/>
    SetMode(MODE_3 | BG2_ENABLE);   
<br/>
 
<br/>
    for(x = 0; x &lt; SCREEN_WIDTH; x++)   
<br/>
        for(y = 0; y &lt; SCREEN_HEIGHT; y++)  
<br/>
            VideoBuffer [x+ y * SCREEN_WIDTH] = RGB16(z,0,0);  
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
this code work, so I dont see why the other one wouldn't..... 
<br/>
first thing i thought about was having a variable as a "colorthing" ( the z )<br/>_________________<br/>yeah, well, maybe... or? anyways.... eh...  what was i talking about??</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44054 - poslundc - Sun May 29, 2005 8:56 pm</h4>
    <div class="postbody"><span class="postbody">OK, I'm having a real hard time reading your code; I don't know if it's just because of a problem between the way the tabs are formatted in your editor versus how they appear in the browser, but it's really messy and difficult to tell where the program flow is headed at any stage.
<br/>
<br/>
As best as I can make out, it should be working for a column on the left-hand edge of the screen of 32 pixels. After that, you start bumping up the value of q every cycle and resetting z to 0 every cycle, so the rest of the screen will be black.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44056 - Issac - Sun May 29, 2005 9:18 pm</h4>
    <div class="postbody"><span class="postbody">what it does is:
<br/>
different values of red for the first 31 pixels, then 31 pixels green, then 31 pixels blue... then the rest White....
<br/>
maybe this will simplyfie it a little:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
if(z&lt;31 &amp;&amp; q==0)
<br/>
{
<br/>
   z++;
<br/>
   VideoBuffer [x+ y * SCREEN_WIDTH] = RGB16(z,0,0);
<br/>
}
<br/>
else
<br/>
{
<br/>
   q++;
<br/>
   z=0;
<br/>
} 
<br/>
</td> </tr></table><span class="postbody">
<br/>
This piece check if the value of z is less than 31, and if q is 0 (as it is at first), and then make different shades of red. until z is 31, then reset z and make q 1.
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
if(z&lt;31 &amp;&amp; q==1)
<br/>
{
<br/>
   z++;
<br/>
   VideoBuffer [x+ y * SCREEN_WIDTH] = RGB16(0,z,0);
<br/>
}
<br/>
else
<br/>
{
<br/>
   q++;z=0;
<br/>
} 
<br/>
</td> </tr></table><span class="postbody">
<br/>
this piece check if z is less than 31, and if q is 1, then it fill different shades of green,
<br/>
<br/>
and then the same with blue.
<br/>
<br/>
and after that, it just check if q is 3, which it would be at this point, and fills the rest with white..... 
<br/>
<br/>
made any sence?
<br/>
<br/>
EDIT: OOH, i think i know why now!
<br/>
got to test it right away now,
<br/>
Since some of the if's isn't true, the else's will execute, and screw everything up right away... Maybe that was what you meant :)
<br/>
<br/>
Edit 2: Nope, still doesn't work.. and I now simplified it more... 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
    for(x = 0; x &lt; SCREEN_WIDTH; x++){   
<br/>
        for(y = 0; y &lt; SCREEN_HEIGHT; y++){  
<br/>
            for(z = 0; z &lt; 31; z++){
<br/>
               VideoBuffer [x+ y * SCREEN_WIDTH] = RGB16(z,z,z);
<br/>
       }
<br/>
            VideoBuffer [x+ y * SCREEN_WIDTH] = RGB16(15,12,0);
<br/>
        }
<br/>
    }
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Shouldn't this make it lighter and lighter grey (up to allmost white, then the rest brown? Now it just get brown :S<br/>_________________<br/>yeah, well, maybe... or? anyways.... eh...  what was i talking about??</span><span class="gensmall"><br/><br/>Last edited by Issac on Sun May 29, 2005 9:38 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#44057 - poslundc - Sun May 29, 2005 9:32 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Issac wrote:</b></span></td> </tr> <tr> <td class="quote">Since some of the if's isn't true, the else's will execute, and screw everything up right away... Maybe that was what you meant :)</td> </tr></table><span class="postbody">
<br/>
<br/>
*taps nose*
<br/>
<br/>
This is why a good debugging strategy is always to pare your code down to the simplest piece of code that does what it's supposed to, then gradually rebuild chunks on until you can see where it's going wrong. You will be surprised how often it isn't some mysterious aspect of the hardware's behaviour, but in fact an error in your underlying algorithm.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44059 - Issac - Sun May 29, 2005 9:41 pm</h4>
    <div class="postbody"><span class="postbody">yeah, but now i've tried some other things too, still without a success.. :S
<br/>
(code in the above post edit2)
<br/>
<br/>
and i also tried &gt;&gt;&gt;else{ if(z==31 &amp;&amp; q==0){ z=0;q++;} }&lt;&lt;&lt;
<br/>
but that didn't work either..<br/>_________________<br/>yeah, well, maybe... or? anyways.... eh...  what was i talking about??</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44071 - poslundc - Sun May 29, 2005 10:58 pm</h4>
    <div class="postbody"><span class="postbody">Your problem is that you are using weird counters and conditional structures so that the state of the current pixel is dependent on the states of the previous pixels. So if you make a mistake early on - which you probably are - that mistake gets propagated to everything else.
<br/>
<br/>
Instead of using q and z, see if you can find a way to algorithmically determine what colour a pixel should be, given <span style="font-style: italic">any values</span> of x and y. In other words, if I give you x = 12 and y = 80 you should be able to write a function that tells me what colour that pixel is, without knowing what happened in previous loop cycles.
<br/>
<br/>
Then your code just becomes the following:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">u16 GetColour(int x, int y)
<br/>
{
<br/>
    ...
<br/>
    return c;
<br/>
}
<br/>
<br/>
void main(void)
<br/>
{
<br/>
    ...
<br/>
    for (y = 0; y &lt; SCREEN_HEIGHT; y++)
<br/>
    {
<br/>
        for (x = 0; x &lt; SCREEN_WIDTH; x++)
<br/>
        {
<br/>
            VideoBuffer[y * SCREEN_WIDTH + x] = GetColour(x, y);
<br/>
        }
<br/>
    }
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44079 - strager - Mon May 30, 2005 1:32 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Issac wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Edit 2: Nope, still doesn't work.. and I now simplified it more... 
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
    for(x = 0; x &lt; SCREEN_WIDTH; x++){   
<br/>
        for(y = 0; y &lt; SCREEN_HEIGHT; y++){  
<br/>
            for(z = 0; z &lt; 31; z++){
<br/>
               VideoBuffer [x+ y * SCREEN_WIDTH] = RGB16(z,z,z);
<br/>
       }
<br/>
            VideoBuffer [x+ y * SCREEN_WIDTH] = RGB16(15,12,0);
<br/>
        }
<br/>
    }
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Shouldn't this make it lighter and lighter grey (up to allmost white, then the rest brown? Now it just get brown :S</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Oh, that is SOOOOOOOOOOOOOOOOOOOOO funny!!!  It's a hard-to-find mistake, and it makes you look like the dumbest person in the world...
<br/>
<br/>
Let's take it step-by-step, shall we?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
?L = ? loop
<br/>
<br/>
xL: x = 0
<br/>
    yL: y = 0
<br/>
        zL: z = 0
<br/>
            plot(x, y, z, z, z) // x=y=z=0
<br/>
        zL: z = 1
<br/>
            plot(x, y, z, z, z) // x=y=0; z=1
<br/>
        zL: z = 2
<br/>
            plot(x, y, z, z, z) // x=y=0; z=2
<br/>
        zL: z = 3
<br/>
            plot(x, y, z, z, z) // x=y=0; z=3
<br/>
        ...
<br/>
        plot(x, y, 15, 12, 0) // x=y=0
<br/>
    yL: y = 1
<br/>
        zL: z = 0
<br/>
            plot(x, y, z, z, z) // x=z=0; y=1
<br/>
        zL: z = 1
<br/>
            plot(x, y, z, z, z) // x=0; y=z=1
<br/>
        zL: z = 2
<br/>
            plot(x, y, z, z, z) // x=0; y=1; z=2
<br/>
        zL: z = 3
<br/>
            plot(x, y, z, z, z) // x=0; y=1; z=3
<br/>
        ...
<br/>
        plot(x, y, 15, 12, 0) // x=0; y=1
<br/>
   ...
<br/>
...
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
If you didn't see it, the inner loop plots the color to the SAME PIXEL 32 times, then that SAME PIXEL is plotted again.
<br/>
<br/>
Correct code:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
    z = 0;
<br/>
<br/>
    for(x = 0; x &lt; SCREEN_WIDTH; x++)
<br/>
    {
<br/>
        for(y = 0; y &lt; SCREEN_HEIGHT; y++)
<br/>
        {
<br/>
            if(z &lt; 32) /* Oh, and I replaced 31 with 32 for a fuller shade. */
<br/>
            {
<br/>
               VideoBuffer[x + (y * SCREEN_WIDTH)] = RGB16(z, z, z);
<br/>
                z++;
<br/>
            }
<br/>
            else
<br/>
            {
<br/>
                VideoBuffer[x + (y * SCREEN_WIDTH)] = RGB16(15, 12, 0);
<br/>
            };
<br/>
        };
<br/>
    };
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
That should do it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44094 - Issac - Mon May 30, 2005 6:06 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
for(x = 0; x &lt; SCREEN_WIDTH; x++)
<br/>
{   
<br/>
        for(y = 0; y &lt; SCREEN_HEIGHT; y++)
<br/>
       {  
<br/>
            if(z&lt;32 &amp;&amp; q==0)
<br/>
            {
<br/>
               VideoBuffer [x+ y * SCREEN_WIDTH] = RGB16(z,0,0);
<br/>
                z++;
<br/>
       }
<br/>
       else
<br/>
            {
<br/>
      if(z==32 &amp;&amp; q==0)
<br/>
                { 
<br/>
                   q++;z=0;
<br/>
                 }
<br/>
       }
<br/>
//and continuing for 2 more rounds, then fill with 15,12,0 
<br/>
}}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Okay, but then i dont see why this won't work :S
<br/>
its quite the same as the example you made, though it has more steps..
<br/>
<br/>
<br/>
<br/>
<span style="font-weight: bold">edit:</span> Whoa!
<br/>
Now i feel really stupid!
<br/>
that code works, just not in Visual Boy Advance... the screen it just black.
<br/>
but if i look at the mapviewer, i see the shades and all.. :)
<br/>
got to try this on hardware now to see if that works :P<br/>_________________<br/>yeah, well, maybe... or? anyways.... eh...  what was i talking about??</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44097 - sajiimori - Mon May 30, 2005 7:53 am</h4>
    <div class="postbody"><span class="postbody">Must you indent so obscenely?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44100 - Issac - Mon May 30, 2005 10:09 am</h4>
    <div class="postbody"><span class="postbody">what do you mean with that?
<br/>
and a little update: It doesn't work on hardware either :?
<br/>
this is really buggin me .....<br/>_________________<br/>yeah, well, maybe... or? anyways.... eh...  what was i talking about??</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44101 - Cearn - Mon May 30, 2005 10:15 am</h4>
    <div class="postbody"><span class="postbody">Indented for clarity
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
int main() 
<br/>
{ 
<br/>
    unsigned char x,y,z,q;
<br/>
    z=0; 
<br/>
    q=0; 
<br/>
    REG_DISPCNT = 0x0403;
<br/>
    
<br/>
    for(x = 0; x &lt; 240; x++)
<br/>
    {
<br/>
        for(y = 0; y &lt; 160; y++)
<br/>
        {
<br/>
            if(z&lt;31 &amp;&amp; q==0)        // first pass: start true -&gt; z++
<br/>
            {                       // second: q==2, false -&gt; q=3, z=0
<br/>
                z++; 
<br/>
                VideoBuffer [x+ y * 240] = RGB16(31,0,0); 
<br/>
            }
<br/>
            else
<br/>
            {
<br/>
                q++;z=0; 
<br/>
            }
<br/>
            if(z&lt;31 &amp;&amp; q==1)        // first: q==0, false -&gt; q=1, z=0
<br/>
            {                       // second: q==3, false -&gt; q=4, z=0 
<br/>
                z++; 
<br/>
                VideoBuffer [x+ y * 240] = RGB16(0,31,0); 
<br/>
            } 
<br/>
            else
<br/>
            {
<br/>
                q++;z=0; 
<br/>
            }
<br/>
            if(z&lt;31 &amp;&amp; q==2)        // first: q==1, false -&gt; q=2, z=0
<br/>
            {                       // second: q==4, false -&gt; q=5, z=0 
<br/>
                z++; 
<br/>
                VideoBuffer [x+ y * 240] = RGB16(0,0,31); 
<br/>
            }
<br/>
            else
<br/>
            {
<br/>
                q++;z=0; 
<br/>
            }
<br/>
            if(q==3)                // first q==2, false
<br/>
            {                       // second: q==5, false 
<br/>
                VideoBuffer [x+ y * 240] = RGB16(31,31,31); 
<br/>
            }
<br/>
            // etc
<br/>
        }
<br/>
    }
<br/>
    while(1){}  
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
The whole thing is basically 4 if-else blocks; the first one will work, z is incremented and q isn't. The <span style="font-style: italic">second</span> if-else is false since q!=1, so we go to the else of it, increment q and reset z. Etc, etc until q wraps around because it's a char (if you intented this that's fair, but if not <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?p=43159" target="_blank">USE INT, NOT CHAR</a>! 
<br/>
<br/>
I'd suggest scrapping this and starting over. I'm still not exactly sure what you were hoping to get, but if it's something along the line of four different gradients on the screen, think about using four different loops, one for each color. This will eliminate all the switching in the inner loop, so should be faster as well. Again, depending on what you're after, you might be able to get away with one row of intensive plotting, and then simply copying that a few times.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44113 - strager - Mon May 30, 2005 2:45 pm</h4>
    <div class="postbody"><span class="postbody">Here:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void main(void)
<br/>
{
<br/>
    int q, z;
<br/>
<br/>
    ...
<br/>
<br/>
    for(y = 0; y &lt; SCREENHEIGHT; y++)
<br/>
    {
<br/>
        for(x = 0; x &lt; SCREENWIDTH; x++)
<br/>
        {
<br/>
            if(q &lt;= 10)
<br/>
            {
<br/>
                VideoBuffer[x + (y * SCREENHEIGHT)] = z &lt;&lt; q;
<br/>
                z++;
<br/>
<br/>
                if(z &gt;= 32)
<br/>
                {
<br/>
                    z = 0;
<br/>
                    q += 5;
<br/>
                };
<br/>
            };
<br/>
        };
<br/>
    };
<br/>
};
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
A couple of reasons why your screen may be black:
<br/>
<ul>
<br/>
<li>You did not enable the background in DISPCNT
<br/>
</li><li>You enabled a window in DISPCNT, but not enabled in WININ or WINOUT
<br/>
</li><li>You have another layer above the one you want
<br/>
</li><li>MAYBE (stressed) you have the force-blank bit enabled in DISPCNT
<br/>
</li><li>Something else ?
<br/>
</li></ul></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44126 - poslundc - Mon May 30, 2005 4:43 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">Must you indent so obscenely?</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Isaac wrote:</b></span></td> </tr> <tr> <td class="quote">What do you mean with that?</td> </tr></table><span class="postbody">
<br/>
<br/>
What sajimori means is that it's practically impossible to read your code because of the bizarre and inconsistent spacings you use at the beginning of lines.
<br/>
<br/>
Please do the following:
<br/>
<br/>
- Use an editor designed for programming when writing your code. <a class="postlink" href="http://www.context.cx/" target="_blank">ConTEXT</a> is free, but any such program you happen to have will do fine.
<br/>
- Put any curly-braces on their own line, like you did in the previous post.
<br/>
- Let the editor handle the spacing for you. <span style="font-style: italic">Please.</span>
<br/>
<br/>
Next, go back up and read the post I made that included some sample code and a GetColour() function. <span style="font-weight: bold">Do it the way I tell you to there</span>, and your problems will go away.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
