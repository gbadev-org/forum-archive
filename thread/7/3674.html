<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>struct aggregate initialization - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>C/C++ > struct aggregate initialization</h2>
<div id="posts">
<div class="post">
    <h4>#23191 - mr_schmoe - Wed Jul 07, 2004 2:19 am</h4>
    <div class="postbody"><span class="postbody">I need to do something like this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
struct
<br/>
{
<br/>
   u8 size, shape;
<br/>
   u8 numcolors;
<br/>
   u8 pal_no;
<br/>
   u16 data[];
<br/>
} sprite_data_type;
<br/>
<br/>
const sprite_data_type player = {SIZE_32, TALL, 0, 0, {0x0000, 0x0001, ..., 0x0002} };
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
The funny thing is the above code doesn't work. I get an error something like "error: excess elements in aggregate initializer". I find out that if I define the number of elements in the array, u16 data[256], it works just fine. But I can't do that because not every sprite will have the same amount of data. So, any suggestions?<br/>_________________<br/>How many boards could the Mongols hoard, if the Mongol Hored got bored</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23193 - poslundc - Wed Jul 07, 2004 2:49 am</h4>
    <div class="postbody"><span class="postbody">You cannot directly "embed" the data as you do when you declare the size of the array, because the internal representation when you don't declare the size is actually a pointer to an array not contained within your struct.
<br/>
<br/>
One method to make it work in the way you've declared it would be to define the array of data separate from the struct, eg:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">static const u16 playerData[] = {0x0000, 0x0001, ..., 0x0002};
<br/>
<br/>
const sprite_data_type player = {SIZE_32, TALL, 0, 0, playerData};</td> </tr></table><span class="postbody">
<br/>
<br/>
Hope this helps,
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23195 - DiscoStew - Wed Jul 07, 2004 3:47 am</h4>
    <div class="postbody"><span class="postbody">Wouldn't there need to be a change on the array u16 data[] to be a pointer  like this...
<br/>
<br/>
u16 *data;
<br/>
<br/>
That way the playerData array can be used.<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23197 - mr_schmoe - Wed Jul 07, 2004 4:15 am</h4>
    <div class="postbody"><span class="postbody">Ya, that helps. I was thinking of doing it that way too. Thanks again.<br/>_________________<br/>How many boards could the Mongols hoard, if the Mongol Hored got bored</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23204 - poslundc - Wed Jul 07, 2004 1:39 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>DiscoStew wrote:</b></span></td> </tr> <tr> <td class="quote">Wouldn't there need to be a change on the array u16 data[] to be a pointer  like this...
<br/>
<br/>
u16 *data;
<br/>
<br/>
That way the playerData array can be used.</td> </tr></table><span class="postbody">
<br/>
<br/>
Hm... I just tested this and it appears to be the case, although I would've thought the two notations would have been interchangeable.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23268 - sajiimori - Fri Jul 09, 2004 1:24 am</h4>
    <div class="postbody"><span class="postbody">Structs with arbitrarily-sized arrays as their last elements are not meant to be instantiated directly.  The idea is to cast to that struct type, and it's a bit of a hack that got official support in C99.
<br/>
<br/>
It doesn't add a pointer to the struct.  It just says that there could be any number of array elements, and that those elements will be part of the struct.  This is confusing because using the same notation in an argument list declares a pointer.
<br/>
<br/>
So in summary, there are 3 places where you can use empty brackets: initializing regular arrays, declaring pointers in argument lists, and when using the undefined-struct-size hack.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23270 - MumblyJoe - Fri Jul 09, 2004 2:29 am</h4>
    <div class="postbody"><span class="postbody">There is another way if you like it (and if C++ doesn't scare you)...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">template&lt;unsigned int L&gt;
<br/>
class sprite_data
<br/>
{
<br/>
   public:
<br/>
   unsigned char size, shape;
<br/>
   unsigned char numcolors;
<br/>
   unsigned char pal_no;
<br/>
   unsigned short data[L];
<br/>
};
<br/>
<br/>
sprite_data&lt;5&gt; player = {32,3,0,0,{0x0000,0x0001,0x0002,0x0003,0x0004}};</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
It's a bit of a cheat but it's legal. Only downside is that the template argument cannot be dynamic, it has to be constant.<br/>_________________<br/><a class="postlink" href="http://www.hungrydeveloper.com" target="_blank">www.hungrydeveloper.com</a>
<br/>
Version 2.0 now up - guaranteed at least 100% more pleasing!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23308 - mr_schmoe - Fri Jul 09, 2004 6:22 pm</h4>
    <div class="postbody"><span class="postbody">No, C++ doesn't scare me. In fact, I'm use it quite extensively when programming my games. However, there are still parts of C++ I'm still learning. For example, I'm not sure what template does</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">template&lt;unsigned int L&gt;</td> </tr></table><span class="postbody">
<br/>
and what those less-than greater-than signs are suppose to do</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">sprite_data&lt;5&gt; player = {32,3,0,0,{0x0000,0x0001,0x0002,0x0003,0x0004}};</td> </tr></table><span class="postbody"><br/>_________________<br/>How many boards could the Mongols hoard, if the Mongol Hored got bored</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23344 - sajiimori - Sat Jul 10, 2004 5:33 am</h4>
    <div class="postbody"><span class="postbody">There are lots of great C++ books out there -- my favorite is Bruce Eckel's "Thinking in C++".  It really explains the point of every feature that was added to C.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23350 - MumblyJoe - Sat Jul 10, 2004 6:49 am</h4>
    <div class="postbody"><span class="postbody">I would also recomend Bruce Eckel's book, and also anything by Scott Myers.
<br/>
<br/>
Anyway, the simple explanation is that a template allows you to quickly create new classes from a template, not much more to it than that. Template parameters are passed in the &lt;&gt; fasion that I showed before. By doing this you can say anything from what constant number you want the class to use, to what class you want it to use internally. Actually, I think a book would be a good place to start...<br/>_________________<br/><a class="postlink" href="http://www.hungrydeveloper.com" target="_blank">www.hungrydeveloper.com</a>
<br/>
Version 2.0 now up - guaranteed at least 100% more pleasing!</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
