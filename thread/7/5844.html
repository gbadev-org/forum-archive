<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Branch out of range... again! (fixed, sorta) - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>C/C++ > Branch out of range... again! (fixed, sorta)</h2>
<div id="posts">
<div class="post">
    <h4>#43946 - MrD - Sat May 28, 2005 3:48 pm</h4>
    <div class="postbody"><span class="postbody">Hi folks,
<br/>
<br/>
I've been making a small GBA game in C without too many troubles (thanks to y'all =D) but recently I've been getting a lot of 'branch out of range' assembler errors when I try to compile.
<br/>
<br/>
This error happened before, so I looked it up and I replaced some of my <span style="font-weight: bold">switch</span>es with <span style="font-weight: bold">if</span>'s and <span style="font-weight: bold">else</span>'s and that seemed to chase it off. Unfortunately, it seems to have come back. ._.
<br/>
<br/>
I've looked this up on the search and it seems that this is because the ASM generated from the C is trying to jump across to far a code gap, or something suchly... Anybody got any suggestions on how I can try to eliminate this error?
<br/>
<br/>
The only way I've managed to fix it this last time is to disable -funroll-loops... which I don't really wanna do.
<br/>
<br/>
Edit - Recompilation with -mlong-calls results in a whole lot of 'invalid offset: value too big (0x00000403)' asm errors.
<br/>
<br/>
<span style="font-style: italic">Edit 2 - Ladies and gentlemen, I'd like to reiterate: <span style="font-weight: bold">switch</span> has some serious issues.
<br/>
<br/>
I found another one of the evil <span style="font-weight: bold">switches</span> hiding around some lesser seen and assumed perfect code and blasted it to <span style="font-weight: bold">else</span>s. now everything is back to fun!</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#43951 - poslundc - Sat May 28, 2005 5:04 pm</h4>
    <div class="postbody"><span class="postbody">If your switch statements are too long/complicated for the compiler to generate correct assembly code, consider refactoring some of the case-code into function calls.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#43955 - MrD - Sat May 28, 2005 5:39 pm</h4>
    <div class="postbody"><span class="postbody"><span style="font-style: italic">Function calls?!!!?11!</span> One one one one one!!
<br/>
<br/>
Okie doke, I'll give it a shot. :)
<br/>
<br/>
I don't know what was up with it... all that was in there was a one line allocation <span style="font-weight: bold">switch</span>ing the players direction variable and incrementing appropriate coordinates. Ah well. S'all good now. Cheers! :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#43957 - poslundc - Sat May 28, 2005 5:51 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>MrD wrote:</b></span></td> </tr> <tr> <td class="quote">I don't know what was up with it... all that was in there was a one line allocation <span style="font-weight: bold">switch</span>ing the players direction variable and incrementing appropriate coordinates. Ah well. S'all good now. Cheers! :)</td> </tr></table><span class="postbody">
<br/>
<br/>
Wow, it sounds pretty messed up if your code is that simple. I know that in Thumb mode the worst-case branch instruction can only jump ahead about 128 instructions, but I would think that the compiler would be smart enough not to use it for that kind of thing.
<br/>
<br/>
Are you using the latest DevkitARM? If not, perhaps upgrading to a newer version of GCC will fix this problem.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
