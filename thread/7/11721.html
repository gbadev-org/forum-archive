<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>[C++] Data structure and database (solved) - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>C/C++ > [C++] Data structure and database (solved)</h2>
<div id="posts">
<div class="post">
    <h4>#109336 - Nil - Fri Nov 17, 2006 11:36 am</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
I am developping a game in C++ for DS and I am stuck with an error when I build my database. I haven't programmed in C++ for several years so I am hoping that I am just making an obvious mistake (well not to me :(). Can you please help me ?
<br/>
<br/>
If there is a better path for declaring data in a program (a monster db, or whatever), I will happily take it (and look into source code).
<br/>
<br/>
So far what I have done (see source and compile result below):
<br/>
- declare a class A with the data elements (a pointer to the sprite declaration, its shape and palette Id)
<br/>
- built an array containing objects of the previous class (A). Ideally I want it to be const (since for that case I will not change its content). I try to declare the variable inside the class B (as private) and then instanciate it in the constructor of class (B)... but I have the same error as what I show below (where the array of A is declare outside of class B).
<br/>
<br/>
<span style="font-weight: bold">gfxconstants.h</span>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#ifndef _GFXCONSTANTS_H
<br/>
#define _GFXCONSTANTS_H
<br/>
<br/>
class _gfxfilesDB_{
<br/>
   public:   
<br/>
//         _gfxfilesDB_(char *pName, unsigned short shape, unsigned short palette)
<br/>
//            : name(pName), shape(shape), palette(palette) {}
<br/>
         char *name;      
<br/>
         const unsigned short *sprData;         
<br/>
         const unsigned short shape;
<br/>
         const unsigned short palette;
<br/>
};
<br/>
#endif //_GFXCONSTANTS_H
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
<span style="font-weight: bold">optionscreen.h</span>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#ifndef _OPTIONSCREEN_H
<br/>
#define _OPTIONSCREEN_H
<br/>
<br/>
#include "constants.h"
<br/>
#include "gfxconstants.h"
<br/>
<br/>
class OptionScreen {
<br/>
   public:
<br/>
      OptionScreen();
<br/>
      ~OptionScreen();
<br/>
      void Init();
<br/>
   private:
<br/>
};
<br/>
<br/>
#endif //_OPTIONSCREEN_H
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
and finally <span style="font-weight: bold">optionscreen.cpp</span>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include "optionscreen.h"
<br/>
#include "main.h"
<br/>
<br/>
#define PANSPRITEPAL 0
<br/>
<br/>
const _gfxfilesDB_ gfxGalSize[3]= {
<br/>
   {"Small", (unsigned short *)Size_Small_Sprite, OBJ_SIZE_16X32, PANSPRITEPAL},
<br/>
   {"Medium", (unsigned short *)Size_Small_Sprite, OBJ_SIZE_16X32, PANSPRITEPAL},
<br/>
   {"Large", (unsigned short *)Size_Small_Sprite, OBJ_SIZE_16X32, PANSPRITEPAL}
<br/>
};
<br/>
<br/>
OptionScreen::OptionScreen() { ... }
<br/>
OptionScreen::~OptionScreen() { ... }
<br/>
<br/>
void OptionScreen::Init() { ... }
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Output when building:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
optionscreen.cpp
<br/>
d:/Cpp/Nil/source/optionscreen.cpp:10: error: too many initializers for 'const _gfxfilesDB_'
<br/>
d:/Cpp/Nil/source/optionscreen.cpp:10: error: too many initializers for 'const _gfxfilesDB_'
<br/>
d:/Cpp/Nil/source/optionscreen.cpp:10: error: too many initializers for 'const _gfxfilesDB_'
<br/>
make[1]: *** [optionscreen.o] Error 1
<br/>
make: *** [build] Error 2
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Can someone help me ? 
<br/>
<br/>
Thanks in advance,
<br/>
<br/>
Nil</span><span class="gensmall"><br/><br/>Last edited by Nil on Fri Nov 17, 2006 2:42 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#109339 - KoshNi - Fri Nov 17, 2006 12:08 pm</h4>
    <div class="postbody"><span class="postbody">Here you have 3 parameters :
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
_gfxfilesDB_(char *pName, unsigned short shape, unsigned short palette)
<br/>
//                          1                       2                                3
<br/>
            : name(pName), shape(shape), palette(palette) {}  
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
and here 4 :
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
const _gfxfilesDB_ gfxGalSize[3]= {
<br/>
   {"Small", (unsigned short *)Size_Small_Sprite, OBJ_SIZE_16X32, PANSPRITEPAL},
<br/>
   {"Medium", (unsigned short *)Size_Small_Sprite, OBJ_SIZE_16X32, PANSPRITEPAL},
<br/>
   {"Large", (unsigned short *)Size_Small_Sprite, OBJ_SIZE_16X32, PANSPRITEPAL}
<br/>
  //     1                              2                                     3                           4                                
<br/>
}; 
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/>Sunshine. Beauty. Love. Happiness.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109341 - Nil - Fri Nov 17, 2006 12:58 pm</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
I have left that function in comment ( // ) just to show that I have try to do that. It is not up to date since this seems to me that it is not the way to go (I am wrong) ?
<br/>
So it is not responsible for the errors I have.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109343 - KoshNi - Fri Nov 17, 2006 1:18 pm</h4>
    <div class="postbody"><span class="postbody">What happens when you uncomment the constructor and give only <span style="font-weight: bold">three</span> parameters here :
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
const _gfxfilesDB_ gfxGalSize[3]= {
<br/>
   {"Small", (unsigned short *)Size_Small_Sprite, OBJ_SIZE_16X32, PANSPRITEPAL},
<br/>
   {"Medium", (unsigned short *)Size_Small_Sprite, OBJ_SIZE_16X32, PANSPRITEPAL},
<br/>
   {"Large", (unsigned short *)Size_Small_Sprite, OBJ_SIZE_16X32, PANSPRITEPAL}
<br/>
  //     1                              2                                     3                           4                               
<br/>
}; 
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/>Sunshine. Beauty. Love. Happiness.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109344 - Nil - Fri Nov 17, 2006 1:38 pm</h4>
    <div class="postbody"><span class="postbody">Ok, I have uncommented the constructor and updated the data (I removed the pointer to <span style="font-style: italic">sprData</span>). Here is the result: 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
main.cpp
<br/>
optionscreen.cpp
<br/>
d:/Cpp/Nil/source/optionscreen.cpp:10: error: braces around scalar initializer for type 'const _gfxfilesDB_'
<br/>
d:/Cpp/Nil/source/optionscreen.cpp:10: error: braces around scalar initializer for type 'const _gfxfilesDB_'
<br/>
d:/Cpp/Nil/source/optionscreen.cpp:10: error: braces around scalar initializer for type 'const _gfxfilesDB_'
<br/>
d:/Cpp/Nil/source/optionscreen.cpp: In constructor 'OptionScreen::OptionScreen()':
<br/>
d:/Cpp/Nil/source/optionscreen.cpp:20: error: no matching function for call to '_gfxfilesDB_::_gfxfilesDB_()'
<br/>
d:/Cpp/Nil/source/gfxconstants.h:6: note: candidates are: _gfxfilesDB_::_gfxfilesDB_(char*, short unsigned int, short unsigned int)
<br/>
d:/Cpp/Nil/source/gfxconstants.h:4: note:                 _gfxfilesDB_::_gfxfilesDB_(const _gfxfilesDB_&amp;)
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
<span style="font-style: italic">d:/Cpp/Nil/source/optionscreen.cpp:10</span> is the closing brakets ("};") in :
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
const _gfxfilesDB_ gfxGalSize[3]= {
<br/>
   {"Small", OBJ_SIZE_16X32, PANSPRITEPAL},
<br/>
   {"Medium", OBJ_SIZE_16X32, PANSPRITEPAL},
<br/>
   {"Large", OBJ_SIZE_16X32, PANSPRITEPAL}
<br/>
}; 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
OBJ_SIZE_16X32 and PANSPRITEPAL are #define with value 0.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109346 - KoshNi - Fri Nov 17, 2006 1:54 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
d:/Cpp/Nil/source/optionscreen.cpp:10: error: braces around scalar initializer for type 'const _gfxfilesDB_'
<br/>
d:/Cpp/Nil/source/optionscreen.cpp:10: error: braces around scalar initializer for type 'const _gfxfilesDB_'
<br/>
d:/Cpp/Nil/source/optionscreen.cpp:10: error: braces around scalar initializer for type 'const _gfxfilesDB_' 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I googled for "<span style="font-style: italic">braces around scalar initializer for type</span>" and I found 
<br/>
<a href="http://www.koders.com/c/fid7D6C62714FB9B16764AE1F3E6CFE2E05BEF2481E.aspx" target="_blank">http://www.koders.com/c/fid7D6C62714FB9B16764AE1F3E6CFE2E05BEF2481E.aspx</a> line number 4345 :
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"> /* It is invalid to initialize a non-aggregate type with a
<br/>
	 brace-enclosed initializer. (...) </td> </tr></table><span class="postbody">
<br/>
<br/>
What it means to me is that you can't give a char* a value with this kind of initialisation. Try to create your table line by line without using {}.
<br/>
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
d:/Cpp/Nil/source/optionscreen.cpp:20: error: no matching function for call to '_gfxfilesDB_::_gfxfilesDB_()'
<br/>
d:/Cpp/Nil/source/gfxconstants.h:6: note: candidates are: _gfxfilesDB_::_gfxfilesDB_(char*, short unsigned int, short unsigned int)
<br/>
d:/Cpp/Nil/source/gfxconstants.h:4: note:                 _gfxfilesDB_::_gfxfilesDB_(const _gfxfilesDB_&amp;) 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
It seems that a _gfxfilesDB_ is declared without using the 3 parameters constructor nor the copy constructor : either create a no parameter constructor, or use one that already exists<br/>_________________<br/>Sunshine. Beauty. Love. Happiness.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109349 - Nil - Fri Nov 17, 2006 2:42 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for the hint to just try google on my errors .... I finally understood that somehow I must have the wrong number of parameters... in fact OBJ_SIZE_16X32 was defined in a library I was using (but not designed) and it is :
<br/>
<span style="font-weight: bold">#define OBJ_SIZE_16X32 1,0</span>
<br/>
which counts as 2 parameters (I completely forgot  that this kind of thing was possible ... ).
<br/>
<br/>
So thanks again for your time, 
<br/>
<br/>
Nil</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109356 - Peter - Fri Nov 17, 2006 4:05 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Nil wrote:</b></span></td> </tr> <tr> <td class="quote">in fact OBJ_SIZE_16X32 was defined in a library I was using (but not designed) and it is :
<br/>
<span style="font-weight: bold">#define OBJ_SIZE_16X32 1,0</span>
<br/>
which counts as 2 parameters (I completely forgot  that this kind of thing was possible ... ).</td> </tr></table><span class="postbody">
<br/>
One of the most evil macro found in the HAM SDK imo, as this totally screws every code parser. Even VisualAssistX can't handle it properly when it provides its intellisense help.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
