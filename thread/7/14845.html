<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Quick sizeof question, bit confused - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>C/C++ > Quick sizeof question, bit confused</h2>
<div id="posts">
<div class="post">
    <h4>#149008 - Rajveer - Sun Jan 13, 2008 3:13 pm</h4>
    <div class="postbody"><span class="postbody">I have a struct
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">struct ObjModelCollision
<br/>
{
<br/>
   //blahblah;
<br/>
   u16* TimestampArray;
<br/>
   //blahblah;
<br/>
};
<br/>
struct ObjModelCollision* ModelColl = malloc(sizeof(struct ObjModelCollision));
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
The pointer TimestampArray will point to an array of u16 of size SizeOfArray. When creating the array that TimestampArray points to, instead of doing
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">ModelColl-&gt;TimestampArray = malloc(sizeof(u16)*SizeOfArray);</td> </tr></table><span class="postbody">
<br/>
<br/>
I want to replace u16 with the type of TimestampArray, so would I do
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">ModelColl-&gt;TimestampArray = malloc(sizeof(ModelColl-&gt;TimestampArray)*SizeOfArray);</td> </tr></table><span class="postbody">
<br/>
<br/>
even though TimestampArray is a pointer?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#149014 - Cearn - Sun Jan 13, 2008 4:39 pm</h4>
    <div class="postbody"><span class="postbody">Probably not. sizeof(ModelColl-&gt;TimestampArray) gets the size of the pointer, which is 4. If you want the type of an array element (u16 in this case), try sizeof(ModelColl-&gt;TimestampArray[0]).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#149015 - Rajveer - Sun Jan 13, 2008 5:00 pm</h4>
    <div class="postbody"><span class="postbody">Even though at the time of calling sizeof, there is no TimestampArray[0]? <a class="postlink" href="http://www.stanford.edu/~blp/writings/clc/malloc-sizeof.html" target="_blank">This website</a> says I should do
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">malloc(sizeof(*ModelColl-&gt;TimestampArray)*SizeOfArray);</td> </tr></table><span class="postbody">
<br/>
(with the extra star) which doesn't make sense to me either, as it's a pointer to a pointer...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#149017 - nipil - Sun Jan 13, 2008 5:16 pm</h4>
    <div class="postbody"><span class="postbody"><span style="font-weight: bold">*</span>ModelColl-&gt;TimestampArray is the same as ModelColl-&gt;TimestampArray[0].
<br/>
<br/>
Lets shorten and say you delared T p[123], then *p and p[0].
<br/>
Both return the value of the first element of the <span style="font-style: italic">possible</span> list, with its associated type T. 
<br/>
So, sizeof(*p) and sizeof(p[0]) both return the same value, ie sizeof(T).
<br/>
<br/>
Only thing is, in both cases, as you're using indirection to get an element from a pointer,
<br/>
"p" has to point to an allocated object. Not necessarily an array, but at least one element,
<br/>
or AFAIK you'll get a segfault.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#149022 - Rajveer - Sun Jan 13, 2008 5:53 pm</h4>
    <div class="postbody"><span class="postbody">Oops oh yeah, so since you're dereferencing *ModelColl-&gt;TimestampArray, sizeof takes its dereferenced type (so the type of ModelColl-TimestampArray[0]).
<br/>
<br/>
Hmm I tend to forget pointer basics quite frequently. Cheers guys!</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
