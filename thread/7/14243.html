<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Retrieving address of texture - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>C/C++ > Retrieving address of texture</h2>
<div id="posts">
<div class="post">
    <h4>#141757 - Rajveer - Sat Sep 29, 2007 12:56 pm</h4>
    <div class="postbody"><span class="postbody">I want to retrieve the location of a texture in VRAM. glTexParameter has the following code which stores the address in the textures[i] table:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void glTexParameter(   uint8 sizeX, uint8 sizeY,
<br/>
                  const uint32* addr,
<br/>
                  GL_TEXTURE_TYPE_ENUM mode,
<br/>
                  uint32 param) {
<br/>
//---------------------------------------------------------------------------------
<br/>
   textures[activeTexture] = param | (sizeX &lt;&lt; 20) | (sizeY &lt;&lt; 23) | (((uint32)addr &gt;&gt; 3) &amp; 0xFFFF) | (mode &lt;&lt; 26);
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
If I have a value stored in textures[i], how would I get rid of everything apart from addr?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141774 - gmiller - Sat Sep 29, 2007 6:43 pm</h4>
    <div class="postbody"><span class="postbody">based on:
<br/>
<br/>
textures[activeTexture] = param | (sizeX &lt;&lt; 20) | (sizeY &lt;&lt; 23) | (((uint32)addr &gt;&gt; 3) &amp; 0xFFFF) | (mode &lt;&lt; 26)
<br/>
<br/>
assuming that "param" is some value that does not set any bits lower than bit 20 then the address is on an 8 byte boundry (addr &gt;&gt; 3) so the lower 20 bits are the address.
<br/>
<br/>
addr = textures[i] &amp; 0xFFFFF; // get low order 20 bits
<br/>
addr = addr &lt;&lt; 3; // add removed low order 3 bits
<br/>
<br/>
<br/>
if param sets any bits in the lower 20 bits then this will negate the extraction.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141791 - Rajveer - Sun Sep 30, 2007 1:16 am</h4>
    <div class="postbody"><span class="postbody">Cheers for the helpful reply. Texture parameters can be the following, taken from libnds:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">enum GL_TEXTURE_PARAM_ENUM {
<br/>
   GL_TEXTURE_WRAP_S = (1 &lt;&lt; 16), /*!&lt; wrap(repeat) texture on S axis */
<br/>
   GL_TEXTURE_WRAP_T = (1 &lt;&lt; 17), /*!&lt; wrap(repeat) texture on T axis */
<br/>
   GL_TEXTURE_FLIP_S = (1 &lt;&lt; 18), /*!&lt; flip texture on S axis when wrapping */
<br/>
   GL_TEXTURE_FLIP_T = (1 &lt;&lt; 19), /*!&lt; flip texture on T axis when wrapping */
<br/>
   GL_TEXTURE_COLOR0_TRANSPARENT = (1&lt;&lt;29), /*!&lt; interpret color 0 as clear, same as old GL_TEXTURE_ALPHA_MASK */
<br/>
   TEXGEN_OFF      = (0&lt;&lt;30), /*!&lt; use unmodified texcoord */
<br/>
   TEXGEN_TEXCOORD = (1&lt;&lt;30), /*!&lt; multiply texcoords by the texture-matrix */
<br/>
   TEXGEN_NORMAL   = (2&lt;&lt;30), /*!&lt; set texcoords equal to normal * texture-matrix, used for spherical reflection mapping */
<br/>
   TEXGEN_POSITION = (3&lt;&lt;30)  /*!&lt; set texcoords equal to vertex * texture-matrix */
<br/>
};</td> </tr></table><span class="postbody">
<br/>
<br/>
So I guess that means that since the lowest bit set by param is bit 16, that addr is stored in the first 16 bits (0-15)? Would I then do
<br/>
<br/>
addr = textures[i] &amp; 0xFFFF; // get low order 16 bits
<br/>
addr = addr &lt;&lt; 3; // add removed low order 3 bits
<br/>
<br/>
Also, what are the removed low order 3 bits? When addr is stored as (((uint32)addr &gt;&gt; 3) &amp; 0xFFFF) in glTexParameter, wouldn't some information be lost when shifting to the right by 3 which wouldn't be recoverable when shifting back left by 3?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141792 - gmiller - Sun Sep 30, 2007 1:29 am</h4>
    <div class="postbody"><span class="postbody">Your right it is 16 bits (mask 0xFFFF) my mistake, I should look more closely.  The missing low order 3 bits would be zero if the alignment of the data is on an 8 byte boundary so it might not be an issue.  The address is only 18 bits in all (16 + 3) so the address is 0x00000 to 0x3FFF8 in range based just on the bits.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141834 - Rajveer - Sun Sep 30, 2007 6:14 pm</h4>
    <div class="postbody"><span class="postbody">Great, cheers for helping me. I have one more quick question: when trying to use the textures[] array I get a compiler error saying "'textures' undeclared (first use in this function)", I'm assuming its because its defined in videoGL.c. How would I access the array if I don't have the scope to access it in my code?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141836 - tepples - Sun Sep 30, 2007 6:21 pm</h4>
    <div class="postbody"><span class="postbody">From videoGL.h:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">typedef struct {
<br/>
  //[...]
<br/>
  uint32 textures[MAX_TEXTURES];
<br/>
  //[....]
<br/>
} gl_hidden_globals;
<br/>
//[...]
<br/>
gl_hidden_globals* glGetGlobals();</td> </tr></table><span class="postbody">
<br/>
You might have to change the code that uses this whenever libnds changes.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141852 - Rajveer - Sun Sep 30, 2007 9:25 pm</h4>
    <div class="postbody"><span class="postbody">So I'd make a prototype function in VideoGL.h which would return the struct gl_hidden_globals? Where would I store the function, or would I somehow recompile libnds's source?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141897 - tepples - Mon Oct 01, 2007 12:32 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Rajveer wrote:</b></span></td> </tr> <tr> <td class="quote">So I'd make a prototype function in VideoGL.h which would return the struct gl_hidden_globals? Where would I store the function, or would I somehow recompile libnds's source?</td> </tr></table><span class="postbody">
<br/>
That was from CVS videoGL.h, which I'm guessing should be part of the new libnds released alongside devkitARM R21. But even released videoGL.h already has <a class="postlink" href="http://devkitpro.sourceforge.net/devkitProWiki/libnds/a00036.html#b6590ee681c5ec50b57b522f8e9a8ae0" target="_blank">glGetTexturePointer</a>.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141898 - Rajveer - Mon Oct 01, 2007 12:37 pm</h4>
    <div class="postbody"><span class="postbody">Oh...haha all this time and I overlooked that function. Cheers!</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
