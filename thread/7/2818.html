<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Inline Assembly Syntax - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>C/C++ > Inline Assembly Syntax</h2>
<div id="posts">
<div class="post">
    <h4>#16062 - DarkPhantom - Sat Feb 07, 2004 4:37 pm</h4>
    <div class="postbody"><span class="postbody">I'm having trouble with getting inline assembly to work with GCC. I'm using VHAM and I think the problem is that VHAM doesn't properly configure the compiler to accomidate it. The compiler doesn't reconginize the "asm" or the "__asm" keywords. It simply rejects that token. Everything works fine if I write an assembly function in its own source file and then assemble it to link with the c code.
<br/>
<br/>
In addition, does anybody know how to access link script values like "__sp_usr" without using assembly? I can use an assembly function to return these values i.e.
<br/>
<br/>
<span style="color: darkblue">ld</span> r0,=__sp_usr
<br/>
<span style="color: darkblue">bx</span> lr
<br/>
<br/>
but I can't figure out the C syntax for the same thing. I tired using
<br/>
<br/>
<span style="color: darkblue">extern unsigned long</span> __sp_usr;
<br/>
<br/>
but that only causes the compiler to generate a global varialble.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#16071 - Miked0801 - Sat Feb 07, 2004 5:22 pm</h4>
    <div class="postbody"><span class="postbody">Put a const in front of it and the linker will put it in ROM for you - it's a start :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#16075 - Paul Shirley - Sat Feb 07, 2004 6:17 pm</h4>
    <div class="postbody"><span class="postbody">removed</span><span class="gensmall"><br/><br/>Last edited by Paul Shirley on Sun Mar 28, 2004 9:14 pm; edited 2 times in total</span></div>    
</div>
<div class="post">
    <h4>#16076 - Paul Shirley - Sat Feb 07, 2004 6:28 pm</h4>
    <div class="postbody"><span class="postbody">removed</span><span class="gensmall"><br/><br/>Last edited by Paul Shirley on Sun Mar 28, 2004 9:14 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#16089 - poslundc - Sat Feb 07, 2004 9:36 pm</h4>
    <div class="postbody"><span class="postbody">Be sure to check out the <a class="postlink" href="http://www.devrs.com/gba/files/asmrules.html" target="_blank">GCC Inline Assembly Rules of Engagement</a>. They may help solve some of the problems you are having.
<br/>
<br/>
As for accessing the linkscript variable from C, this is a longshot, but have you tried declaring it as a pointer? Sometimes C is sensitive to that kind of thing, even though it shouldn't be.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
