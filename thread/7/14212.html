<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Fragmentation - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>C/C++ > Fragmentation</h2>
<div id="posts">
<div class="post">
    <h4>#141357 - keldon - Mon Sep 24, 2007 2:31 pm</h4>
    <div class="postbody"><span class="postbody">Dynamic allocation scenario:
<br/>
 - there are 16 blocks of memory
<br/>
 - you initially allocate 3 for some random reason, but the 3 blocks will remain allocated
<br/>
 - your program is like a web page, in that memory allocated for each section will be completely thrown away with each transition
<br/>
 - because of this you know that if you allocate 10  blocks that you will deallocate 10 blocks when you are done with that webpage
<br/>
<br/>
Would it be beneficial to create custom allocation methods or would it be safe to use new/malloc and delete/free even if you don't deallocate in the same/reverse order as you allocate?
<br/>
<br/>
I would expect it to be fine, I mean when I wrote memory allocation methods it would be fine, but mine were written for correctness and not speed.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141365 - gmiller - Mon Sep 24, 2007 5:50 pm</h4>
    <div class="postbody"><span class="postbody">Depending on how you manage your allocations there can be issues that "malloc/new/free/delete" can be slow depending on how you manage the information.  The reason not to use the standard routines can be speed, lots of games allocate a chunk of "heap" and then manage the chunk themselves.  There can be reasons to allocate extra data at the beginning to save pointers to internal structures so the management can be done faster.  Every choice has good/bad associated with it so there will be trade offs no matter what.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141370 - sajiimori - Mon Sep 24, 2007 7:50 pm</h4>
    <div class="postbody"><span class="postbody">If there are a few permenent allocations at the beginning, and the rest is like a frame heap (where you never free anything, until it's all freed at once), then you won't have any fragmentation.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141405 - tepples - Tue Sep 25, 2007 2:02 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">If there are a few permenent allocations at the beginning, and the rest is like a frame heap (where you never free anything, until it's all freed at once), then you won't have any fragmentation.</td> </tr></table><span class="postbody">
<br/>
What would be needed for the destructors of objects within this frame heap to get called properly, releasing any other resources outside the frame heap (e.g. VRAM) that they may own? Or is the <a class="postlink" href="http://en.wikipedia.org/wiki/Resource_Acquisition_Is_Initialization" target="_blank">RAII</a> model considered overkill on a DS or smaller?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141408 - DekuTree64 - Tue Sep 25, 2007 2:17 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">What would be needed for the destructors of objects within this frame heap to get called properly, releasing any other resources outside the frame heap (e.g. VRAM) that they may own? Or is the <a class="postlink" href="http://en.wikipedia.org/wiki/Resource_Acquisition_Is_Initialization" target="_blank">RAII</a> model considered overkill on a DS or smaller?</td> </tr></table><span class="postbody">
<br/>
If you need to create and destroy things within the frame heap, you could use manually managed "slots" for the objects, and placement new into them. Otherwise deleting doesn't seem like such a good idea, since that implies that you'll be creating new objects too, which would perpetually grow the heap.
<br/>
<br/>
I definitely wouldn't consider RAII overkill on the DS.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141413 - tepples - Tue Sep 25, 2007 2:37 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>DekuTree64 wrote:</b></span></td> </tr> <tr> <td class="quote">If you need to create and destroy things within the frame heap, you could use manually managed "slots" for the objects, and placement new into them.</td> </tr></table><span class="postbody">
<br/>
I seem to remember something like that explained somewhere in the first half of <span style="font-style: italic">Effective C++</span> by Scott Meyers.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141475 - sajiimori - Tue Sep 25, 2007 11:58 pm</h4>
    <div class="postbody"><span class="postbody">RAII FTW.  :)
<br/>
<br/>
If you design your code specifically for a frame heap, you could override global new/delete and have them run linked lists through allocations of particular sizes.
<br/>
<br/>
For instance, if you try to allocate 16 bytes, operator 'new' would look at the '16 byte' linked list and pop the first free element, or else append a new one to the end of the frame heap.
<br/>
<br/>
That's basically a generalization of having pools for particular object types.  When you think about it, the type of object doesn't matter -- only the size.
<br/>
<br/>
No fragmentation, but potentially a lot of waste from unused allocations.  Probably more predictable behavior than a standard heap.  Very fast in the average case.  YMMV.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141495 - keldon - Wed Sep 26, 2007 7:48 am</h4>
    <div class="postbody"><span class="postbody">Well I overrid the classes new constructor (of certain objects) to allocate memory from a simple pool since all of those classes only exist for a certain use. The pool just keeps track using a offset pointer that it makes sure is always aligned.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
