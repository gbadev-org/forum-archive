<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Problems linking in math lib - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>C/C++ > Problems linking in math lib</h2>
<div id="posts">
<div class="post">
    <h4>#900 - punchy - Sun Jan 12, 2003 12:32 am</h4>
    <div class="postbody"><span class="postbody">Anyone have any ideas why linking in the math lib gives a lot of errors like this:
<br/>
<br/>
<br/>
"/gcc-3.0.2/newlib/libm/math/s_cos.c:67: undefined reference to `__subdf3'"
<br/>
<br/>
I'm trying to use sin/cos. Is my install missing something?
<br/>
<br/>
Thanks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#903 - Costis - Sun Jan 12, 2003 12:51 am</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
Try placing the "-lm" flag in your make file where you run the "ld" linker program.
<br/>
<br/>
Costis</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#907 - punchy - Sun Jan 12, 2003 1:32 am</h4>
    <div class="postbody"><span class="postbody">Yeah, I already have the lm flag to link-in the math lib. The errors i'm getting :
<br/>
<br/>
libm/math/e_rem_pio2.c:153: undefined reference to `__subdf3'
<br/>
<br/>
gcc-3.0.2/newlib/libm/math/e_rem_pio2.c:175: undefined reference to `__muldf3
<br/>
<br/>
and so forth, seem to suggest that the math lib is looking for a bunch of definitions it can find. 
<br/>
<br/>
Any other ideas?
<br/>
<br/>
Thanks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1005 - Quirky - Mon Jan 13, 2003 9:31 am</h4>
    <div class="postbody"><span class="postbody">Are you using devkitadvance? How are you linking the objects? If you use ld then you need to specify a lot more - if you use gcc to link then it will find most of the libraries for you. I remember that being a problem I had. Alterrnatively, the order you soecify the libs in matters, so try changing where lm is in the list - I think it has to be last.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1272 - punchy - Thu Jan 16, 2003 3:02 am</h4>
    <div class="postbody"><span class="postbody">Hi, 
<br/>
<br/>
i'm using devkit adv. I'm using vc++ and watzdat's makefile. The linker instructions i'm using are
<br/>
<br/>
$(PROJECT).elf : $(O_FILES)
<br/>
	$(CMPDIR)\ld $(LDFLAGS) -o $(PROJECT).elf $(O_FILES) -lstdc++ -lgcc -lc -lm 
<br/>
<br/>
I'm putting the math lib last, so any other ideas? Can you remember how you resolved the problem?
<br/>
<br/>
Thanks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1312 - mo - Thu Jan 16, 2003 6:03 pm</h4>
    <div class="postbody"><span class="postbody">I suspect this has something to do with the linker not executing a double pass.  Those __subdf3, etc. math routines which the math library is referencing are located in the gcc library.
<br/>
<br/>
There's two ways to solve the problem.  First, you could just put the math library before the gcc library in the link line.  
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
$(CMPDIR)\ld $(LDFLAGS) -o $(PROJECT).elf $(O_FILES) -lstdc++ -lm -lgcc -lc
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
But better yet, just add the <span style="font-style: italic">-rescan</span> flag to the list of linkers flags, <span style="font-style: italic">LDFLAGS</span>, and you never need to worry about an ordering problem again, i.e.:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
ld -L F:\gba\devkitadv\lib\gcc-lib\arm-agb-elf\3.0.2\interwork -L F:\gba\devkitadv\arm-agb-elf\lib\interwork -T LinkScript -rescan -o sprite.elf boot.o   crtbegin.o  crtend.o   main.o -lstdc++ -lgcc -lc -lm
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1389 - punchy - Sat Jan 18, 2003 2:52 am</h4>
    <div class="postbody"><span class="postbody">Both work like a charm. Thanks for your help!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1390 - punchy - Sat Jan 18, 2003 3:01 am</h4>
    <div class="postbody"><span class="postbody">Oh, using GCC to link solves it too.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
