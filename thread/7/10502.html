<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>C question (*pointer = *pointer) - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>C/C++ > C question (*pointer = *pointer)</h2>
<div id="posts">
<div class="post">
    <h4>#94309 - LOst? - Mon Jul 24, 2006 10:39 am</h4>
    <div class="postbody"><span class="postbody">I have never encountered this way of coding before:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
typedef struct
<br/>
{
<br/>
 int a;
<br/>
 int b;
<br/>
 int c;
<br/>
} BLAH;
<br/>
<br/>
int main (void)
<br/>
{
<br/>
 BLAH blah1 = {1, 2, 3};
<br/>
 BLAH blah2 = {3, 2, 1};
<br/>
<br/>
 BLAH* p_blah1 = &amp;blah1;
<br/>
 BLAH* p_blah2 = &amp;blah2;
<br/>
<br/>
<br/>
  // What the hell does this do?:
<br/>
  *p_blah2 = *p_blah1;
<br/>
<br/>
 return 0
<br/>
}
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
What is happening here? You can't copy structures so I assume this trick does something I can never guess by my own.<br/>_________________<br/><span style="font-style: italic">Exceptions are fun</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#94321 - wintermute - Mon Jul 24, 2006 10:55 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>LOst? wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
What is happening here? You can't copy structures so I assume this trick does something I can never guess by my own.</td> </tr></table><span class="postbody">
<br/>
<br/>
Yes, you can copy structs and that's exactly what the code is doing.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#94325 - LOst? - Mon Jul 24, 2006 11:51 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>LOst? wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
What is happening here? You can't copy structures so I assume this trick does something I can never guess by my own.</td> </tr></table><span class="postbody">
<br/>
<br/>
Yes, you can copy structs and that's exactly what the code is doing.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Thank you! I didn't know it was possible. No more memcpy sizeof (struct) for me :P
<br/>
<br/>
I never thought it was possible because this fails:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
blah2 = blah1;
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/><span style="font-style: italic">Exceptions are fun</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#94327 - MrD - Mon Jul 24, 2006 12:06 pm</h4>
    <div class="postbody"><span class="postbody">It shouldn't fail. :/<br/>_________________<br/>Not active on this forum. For Lemmings DS help see its website.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#94612 - sgeos - Tue Jul 25, 2006 2:42 pm</h4>
    <div class="postbody"><span class="postbody">How does it fail?  I can't get onto a unix box to find out.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#94731 - MrD - Tue Jul 25, 2006 11:33 pm</h4>
    <div class="postbody"><span class="postbody">It's possible it could fail in a different lanuage, such as the one which exhibits the bizarre property described in your sig, LOst :P<br/>_________________<br/>Not active on this forum. For Lemmings DS help see its website.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#94732 - tepples - Tue Jul 25, 2006 11:40 pm</h4>
    <div class="postbody"><span class="postbody">LOst's sig talks about some old version of Fortran that had only what C calls 'static' local variables, not the 'auto' variables that allow for recursion. Such versions of Fortran probably didn't even have structs, nor did they have pointer arithmetic. Many implementations of pre-ANSI C didn't have operator = perform a struct copy either.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#94735 - MrD - Tue Jul 25, 2006 11:45 pm</h4>
    <div class="postbody"><span class="postbody">Gosh... so... I was right then? :)<br/>_________________<br/>Not active on this forum. For Lemmings DS help see its website.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#94747 - PeterM - Wed Jul 26, 2006 12:58 am</h4>
    <div class="postbody"><span class="postbody">I have a suspicion that C doesn't let you copy structures using = but C++ does.
<br/>
<br/>
That could be complete rubbish though since I use C++ almost exclusively nowadays.<br/>_________________<br/><a href="http://aaiiee.wordpress.com/" target="_blank">http://aaiiee.wordpress.com/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#94749 - tepples - Wed Jul 26, 2006 1:02 am</h4>
    <div class="postbody"><span class="postbody">ISO C added a lot of features from early C++, such as function prototypes in their modern form. Struct copying with operator = may have been one of them.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#94750 - PeterM - Wed Jul 26, 2006 1:09 am</h4>
    <div class="postbody"><span class="postbody">You could be right there.
<br/>
<br/>
Visual C++ Express seems quite happy for me to copy a struct in C. I must have been mistaken before.<br/>_________________<br/><a href="http://aaiiee.wordpress.com/" target="_blank">http://aaiiee.wordpress.com/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#94828 - chishm - Wed Jul 26, 2006 9:23 am</h4>
    <div class="postbody"><span class="postbody">I often use struct copying with = in GCC C89 compilation mode. I haven't come across any problems yet.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#94831 - keldon - Wed Jul 26, 2006 9:42 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote">I often use struct copying with = in GCC C89 compilation mode. I haven't come across any problems yet.</td> </tr></table><span class="postbody">
<br/>
<br/>
But doesn't C89 have a lot of features borrowed from C++? But then again the compiler he'd be using should be C89 too. Were you using a different compiler when you tried that code?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#94835 - Cearn - Wed Jul 26, 2006 11:07 am</h4>
    <div class="postbody"><span class="postbody">Just checked in the library here. Might be slightly paraphrased. Emphasis mine.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>K&amp;R wrote:</b></span></td> </tr> <tr> <td class="quote">The only legal operations on structs are copying or assigning to it <span style="font-weight: bold">as a unit</span>, getting its address using &amp;, and accessing its members</td> </tr></table><span class="postbody">
<br/>
- The C programming language, 2nd Edition, section 6.2, first line (forgot to look up page number, sorry)
<br/>
<br/>
Might be reading it wrong, but that would seem to suggest it was possible from the start. Besides, I know that it is definitely possible to pass whole structures (that is, <span style="font-style: italic">copies</span> of structures) to functions, so it seems a little silly if stand-alone struct-copies would not be possible.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#95199 - sgeos - Fri Jul 28, 2006 5:33 am</h4>
    <div class="postbody"><span class="postbody">Silly?  Consider this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define STRING_MAX 82
<br/>
char myString[STRING_MAX] = "hello world";
<br/>
myString = "good bye creul world";</td> </tr></table><span class="postbody">
<br/>
IIRC it doesn't work.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#95208 - tepples - Fri Jul 28, 2006 5:54 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sgeos wrote:</b></span></td> </tr> <tr> <td class="quote">Silly?  Consider this:
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define STRING_MAX 82
<br/>
char myString[STRING_MAX] = "hello world";
<br/>
myString = "good bye creul world";</td> </tr></table><span class="postbody">
<br/>
IIRC it doesn't work.
<br/>
<br/>
-Brendan</span></td> </tr></table><span class="postbody">
<br/>
That demonstrates that you can copy structs but you can't copy arrays. Strings in C are arrays.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#95218 - sgeos - Fri Jul 28, 2006 6:29 am</h4>
    <div class="postbody"><span class="postbody">When you put it that way it makes sense.  Arrays can be of any size, and structs generally have a fixed size.  In C99 can't a variable length array be the last member of a struct?  Can such structs be copied?
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#95223 - sajiimori - Fri Jul 28, 2006 7:00 am</h4>
    <div class="postbody"><span class="postbody">Um... how would it know how much to copy?
<br/>
<br/>
Anyway, the char array initialization example you posted is a special case shortcut for this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">char myString[STRING_MAX] =
<br/>
    {'h','e','l','l','o',' ','w','o','r','l','d','\0'};
<br/>
</td> </tr></table><span class="postbody">
<br/>
It's the only shortcut of its kind in C.  In all other situations, string literals evaluate to const char* (or sometimes char* for backward compatability).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#95309 - tepples - Fri Jul 28, 2006 6:00 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sgeos wrote:</b></span></td> </tr> <tr> <td class="quote">In C99 can't a variable length array be the last member of a struct?</td> </tr></table><span class="postbody">
<br/>
A variable-length array as the last field of a struct is just a formalization of the semantics that C compilers have long used for a zero-length array as the last field.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Can such structs be copied?</td> </tr></table><span class="postbody">
<br/>
With memcpy(): Yes.
<br/>
With operator = : I don't know. Either it'll fail at compile time, or it just won't copy the members of the variable-length array.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
