<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Double Buffering error - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>C/C++ > Double Buffering error</h2>
<div id="posts">
<div class="post">
    <h4>#140242 - ShadowX - Fri Sep 14, 2007 7:39 pm</h4>
    <div class="postbody"><span class="postbody">I tried to display a picture in mode 4.
<br/>
I first tried to display it without Dougle Buffering. <span style="font-weight: bold">OK</span>.
<br/>
I tried to display it using Double Buffering. <span style="font-weight: bold">Error</span>.
<br/>
<br/>
Result of Double Buffering in GBA:
<br/>
<a class="postlink" href="http://img74.imageshack.us/my.php?image=errogbayu2.png" target="_blank">http://img74.imageshack.us/my.php?image=errogbayu2.png</a>
<br/>
<br/>
The code:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include &lt;gba.h&gt;
<br/>
#include "m374lx.c"
<br/>
<br/>
int main()
<br/>
{
<br/>
    SetMode(MODE_4 | BG2_ENABLE);
<br/>
    int i;
<br/>
    for (i=0;i&lt;256;i++)
<br/>
    {
<br/>
        BGPaletteMem[i]=m374lx_pal[i];
<br/>
    }
<br/>
    int x;
<br/>
    for (x=0; x&lt;(240*160);x++)
<br/>
    {
<br/>
        BackBuffer[x]=m374lx_data[x];
<br/>
    }
<br/>
    REG_DISPCNT ^= BACKBUFFER;
<br/>
    while (1) {}
<br/>
    return 0;
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
I used the headers from "the Pern Project".</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#140288 - Cearn - Sat Sep 15, 2007 1:08 am</h4>
    <div class="postbody"><span class="postbody">You're copying too much data.
<br/>
<br/>
While mode 4 may have 240x160 pixels/buffer, these are 8bit pixels, not 16bit. Backbuffer is an u16-pointer, so copying 240x160 items here means 240x160x2 bytes while you should only copy 240x160 bytes. Don't ignore the datatypes of the source and destination when copying: they will decide how and how much data is actually copied.
<br/>
<br/>
That funky stuff is probably because you're reading parts over the edge of ROM (the binary itself is probably smaller than 76.8kb) and writing over the edge of VRAM (0600:A000 + 240*160*2 = 0601:CC00, while VRAM ends at 0601:8000). What happens then is anyone's guess. Apparently, VBA responds by reading in incrementing values after ROM-end, and wrapping back to 0601:0000 after 0601:8000. Interestingly enough, my test image here should up alright in hardware &gt;_&gt;</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#140337 - ShadowX - Sat Sep 15, 2007 1:29 pm</h4>
    <div class="postbody"><span class="postbody">If I change the line
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">for (x=0; x&lt;(240*160);x++)</td> </tr></table><span class="postbody">
<br/>
to
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">for (x=0; x&lt;((240*160)/2);x++)</td> </tr></table><span class="postbody">
<br/>
will it work fine?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#140343 - Cearn - Sat Sep 15, 2007 2:07 pm</h4>
    <div class="postbody"><span class="postbody">Yes. You don't need all those parentheses though. You could also use a dedicated copier like memcpy(), where problems due to datatypes aren't a problem (<a class="postlink" href="http://www.coranac.com/tonc/text/bitmaps.htm#ssec-data-memcpy" target="_blank">usually, anyways</a>). They also have the benefit of being much faster.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#140451 - ShadowX - Sun Sep 16, 2007 3:43 pm</h4>
    <div class="postbody"><span class="postbody">I tried now to wait a button hit and draw other picture.
<br/>
It draws quickly and erases the screen.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
