<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>C code to IWRAM - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>C/C++ > C code to IWRAM</h2>
<div id="posts">
<div class="post">
    <h4>#90188 - Schultz - Wed Jun 28, 2006 9:19 pm</h4>
    <div class="postbody"><span class="postbody">I am compiling my C code with the gcc compiler.
<br/>
The code lies within the cartridge. I would, however, like to displace it so that it remains within the internal SRAM at address 0x03000000.
<br/>
I do not wish to merge assembly routines within my code, although I know the ARM assembly.
<br/>
What I need is to place the code in  IWRAM making use solely of the C language and then run such code.
<br/>
I am not looking foward to placing all the code in IWRAM. Only a few routines shall be placed.
<br/>
<br/>
Thanks in advance for your help.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#90202 - col - Wed Jun 28, 2006 10:08 pm</h4>
    <div class="postbody"><span class="postbody">are you using one of the devkits? if so, which one?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#90208 - tepples - Wed Jun 28, 2006 10:48 pm</h4>
    <div class="postbody"><span class="postbody">Put the files in a separate source code module (that is, separate .c file) and then compile them to an object file whose suffix is ".iwram.o". For example, compile mixer.c to mixer.iwram.o.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#90274 - Ant6n - Thu Jun 29, 2006 5:29 am</h4>
    <div class="postbody"><span class="postbody"><a href="http://www.devrs.com/gba/files/gbadevfaqs.php#IntRamCode" target="_blank">http://www.devrs.com/gba/files/gbadevfaqs.php#IntRamCode</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#90323 - Schultz - Thu Jun 29, 2006 6:34 pm</h4>
    <div class="postbody"><span class="postbody">I am using the standard DevKitAdv.
<br/>
I acknolowdge the labelling of the object file as "*.iwram.o".
<br/>
I, however, wish to, in addition, know how shall my code be setup in IWRAM. Shall it be put there by DMA or by normal copying?
<br/>
Moreover, I really wish to have another option, such as a modifier in the prototype of a function or a command to do so.
<br/>
<br/>
Thanks in advance.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#90327 - tepples - Thu Jun 29, 2006 6:58 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Schultz wrote:</b></span></td> </tr> <tr> <td class="quote">I am using the standard DevKitAdv.
<br/>
I acknolowdge the labelling of the object file as "*.iwram.o".
<br/>
I, however, wish to, in addition, know how shall my code be setup in IWRAM. Shall it be put there by DMA or by normal copying?</td> </tr></table><span class="postbody">
<br/>
The init code (crt0.s) handles this for you.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Moreover, I really wish to have another option, such as a modifier in the prototype of a function or a command to do so.</td> </tr></table><span class="postbody">
<br/>
There are keywords to specify which section a particular function's object code will be placed in. But those keywords aren't very useful because GCC does not support switching instruction sets within a module. In general, you want all code in IWRAM to use the ARM instruction set, and you want all code outside of IWRAM to use the Thumb instruction set. So you might as well compile everything *.iwram.o as ARM and everything else as Thumb. In fact my makefiles have a rule to do just that.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#90477 - Schultz - Fri Jun 30, 2006 11:46 am</h4>
    <div class="postbody"><span class="postbody">I have compiled the code as indicated.
<br/>
My object files to be placed in the IWRAM have been compiled with the -arm option and have been output to a *.iwram.o file.
<br/>
Nevertheless, when I compiled the main module with the option -mthumb,
<br/>
several errors raised indicating an ARM code calling a THUMB code.
<br/>
Futhermore, after compiling the main module with -marm, I checked the code linked by the *.iwram.o has been placed in the cartridge ROM instead of the IWRAM via VBA's disassemble tool.
<br/>
Why have the code not been placed in IWRAM?
<br/>
How shall I link ARM code with THUMB code?
<br/>
Please help.
<br/>
<br/>
Thanks in advance.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#90482 - chishm - Fri Jun 30, 2006 1:09 pm</h4>
    <div class="postbody"><span class="postbody">If you are using the arm-elf-* versions of the devkitpro tools, you need to specify -interwork for arm code and -thumb-interwork (or something similar, I can't remember the exact syntax) for thumb code when compiling, instead of -arm or -thumb. For arm-eabi-*, I think it shouldn't need interworking specified.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#90786 - yuriks - Sun Jul 02, 2006 1:04 pm</h4>
    <div class="postbody"><span class="postbody">You are using devkitAdv, upgrade to devkitPro (devkitARM)<br/>_________________<br/>---yuriks---</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
