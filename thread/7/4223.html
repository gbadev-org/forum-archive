<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Class redefinition error... - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>C/C++ > Class redefinition error...</h2>
<div id="posts">
<div class="post">
    <h4>#27555 - mr_square - Fri Oct 15, 2004 2:35 pm</h4>
    <div class="postbody"><span class="postbody">Hi all - I'm having a bit of trouble with compiling my C++ code. Everthing was working fine until about 1/2 hour ago when I tried to create a new class, 'collisionDetector'. This class needs to use one of my other classes, 'playerState' , as it takes a playerState instance as an argument to one of its methods.
<br/>
<br/>
So I add #include "playerState.h" to the top of collisionDetector.h file, and it comes back with errors about a redefinition of the playerState class. My main.cpp file also includes the same file, but surely if its a header it should work?? 
<br/>
<br/>
<br/>
Also - I was told that #include-ing C files is bad - I've compiled them into .o files like the Beginners FAQ says, but the compiler cant find their contents at compile time (they contain arrays, and the code that uses the arrays gets errors that they don't exist). I'm using:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
path=C:\devkitadv\bin
<br/>
<br/>
g++ -o city.o citybackdrop.o main.elf defines.cpp main.cpp DMA.cpp drawState.cpp background.cpp idleState.cpp bg.cpp jumpState.cpp lookUpState.cpp runLeftState.cpp trig.cpp kneelState.cpp runRightState.cpp playerState.cpp -lm
<br/>
<br/>
objcopy -O binary main.elf main.bin
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27556 - poslundc - Fri Oct 15, 2004 2:51 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>mr_square wrote:</b></span></td> </tr> <tr> <td class="quote">Hi all - I'm having a bit of trouble with compiling my C++ code. Everthing was working fine until about 1/2 hour ago when I tried to create a new class, 'collisionDetector'. This class needs to use one of my other classes, 'playerState' , as it takes a playerState instance as an argument to one of its methods.
<br/>
<br/>
So I add #include "playerState.h" to the top of collisionDetector.h file, and it comes back with errors about a redefinition of the playerState class. My main.cpp file also includes the same file, but surely if its a header it should work??</td> </tr></table><span class="postbody">
<br/>
<br/>
Make sure you're guarding against multiple inclusion. This is what happens in the following scenario:
<br/>
<br/>
<span style="font-weight: bold">a.h:</span>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">class myClass {...};</td> </tr></table><span class="postbody">
<br/>
<br/>
<span style="font-weight: bold">b.h:</span>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include "a.h"</td> </tr></table><span class="postbody">
<br/>
<br/>
<span style="font-weight: bold">program.c:</span>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include "a.h"
<br/>
#include "b.h"</td> </tr></table><span class="postbody">
<br/>
<br/>
... so myClass has been defined twice, which causes a compiler error.
<br/>
<br/>
To prevent this, all header files should have a guard in them such as the following:
<br/>
<br/>
<span style="font-weight: bold">a.h:</span>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#ifndef __SOME_UNIQUE_NAME__
<br/>
#define __SOME_UNIQUE_NAME__
<br/>
<br/>
class myClass {...};
<br/>
<br/>
#endif</td> </tr></table><span class="postbody">
<br/>
<br/>
This will prevent your header file from being #included more than once.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Also - I was told that #include-ing C files is bad - I've compiled them into .o files like the Beginners FAQ says, but the compiler cant find their contents at compile time (they contain arrays, and the code that uses the arrays gets errors that they don't exist).</td> </tr></table><span class="postbody">
<br/>
<br/>
You also need to create header files to be #included into the C code. Only these header files don't have the actual data in them, just references to the data so the compiler knows what to do. The data isn't actually appended on until the linking stage (separate from compilation).
<br/>
<br/>
A typical header file might look like:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#ifndef __MY_DATA_REFERENCES__
<br/>
#define __MY_DATA_REFERENCES__
<br/>
<br/>
extern const unsigned int myExternalData[];     // contents are in some other file, eg. myExternalData.c
<br/>
<br/>
#endif</td> </tr></table><span class="postbody">
<br/>
<br/>
Then #include this file into the program that needs to access the data in your C file.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27558 - mr_square - Fri Oct 15, 2004 3:20 pm</h4>
    <div class="postbody"><span class="postbody">Thanks man - great explanation :)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
