<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>STL:Mappy Console Errors - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>C/C++ > STL:Mappy Console Errors</h2>
<div id="posts">
<div class="post">
    <h4>#8239 - hnager - Sat Jul 05, 2003 2:57 am</h4>
    <div class="postbody"><span class="postbody">And here I thought that I had the STL linking properly - the following compiles without error, but running it kicks back the errors described below (from the Mappy Console). The makefile is also included below. THanks for any help - Howard:
<br/>
<br/>
//THE SOURCE
<br/>
<br/>
#include "gba.h"
<br/>
#include &lt;vector&gt;
<br/>
<br/>
extern "C" int write( int fh, const void *buf, unsigned cnt ){
<br/>
    return 0 ;
<br/>
}
<br/>
<br/>
void foo() {
<br/>
    std::vector&lt;int&gt; intvect; 
<br/>
    intvect.push_back(42);
<br/>
}
<br/>
<br/>
int main(){	 
<br/>
    foo();
<br/>
    return 0;
<br/>
}
<br/>
<br/>
<br/>
//AND...THE ERRORS
<br/>
<br/>
Mappy VM: Logging started on 7/4/2003 9:47:41 PM
<br/>
PlatformSound: Creating DirectSound interface
<br/>
Loading external BIOS "C:\GAME_DEV\GBA_TOOLS\mappyvm_0.9d\v0.bios"
<br/>
Loading cartridge info from POLYGON.sav
<br/>
Unimplemented opcode at $08019298: LDM with forced user bank
<br/>
Unimplemented opcode at $080192B4: LDM with forced user bank
<br/>
ROM[080192B4]=00000004 at 080192B4
<br/>
ROM[080192B8]=03007E3C at 080192B4
<br/>
ROM[080192BC]=00000000 at 080192B4
<br/>
<br/>
...
<br/>
<br/>
<br/>
//THE MAKEFILE - I'm guessing that I'm doing something wrong here
<br/>
<br/>
PATH=c:\DevKitAdv\bin;
<br/>
DEVDIR  = c:\DevKitAdv
<br/>
LIBDIR  = $(DEVDIR)\lib\gcc-lib\arm-agb-elf\3.0.2\interwork
<br/>
LIBDIR2 = $(DEVDIR)\arm-agb-elf\lib\interwork
<br/>
<br/>
NAME = POLYGON
<br/>
<br/>
CFLAGS = -c -O3
<br/>
LDFLAGS = -L $(LIBDIR) -L $(LIBDIR2) -T lnkscript 
<br/>
<br/>
MODEL = -mthumb -mthumb-interwork 
<br/>
<br/>
$(NAME).bin : $(NAME).elf
<br/>
	objcopy -O binary $(NAME).elf $(NAME).bin
<br/>
<br/>
$(NAME).elf : crt0.o crtbegin.o crtend.o main.o 
<br/>
	ld -nostartfiles $(LDFLAGS) -o $(NAME).elf crt0.o crtbegin.o crtend.o main.o -lstdc++ -lgcc -lc -lgcc 
<br/>
<br/>
main.o : main.cpp
<br/>
	g++ $(CFLAGS) $(MODEL) main.cpp
<br/>
<br/>
crt0.o : crt0.s
<br/>
	g++ $(CFLAGS) $(MODEL) crt0.s</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8243 - tepples - Sat Jul 05, 2003 6:21 am</h4>
    <div class="postbody"><span class="postbody">Does it work in VisualBoyAdvance?  Some emulators just haven't implemented all opcodes yet; my tests show that Mappy VM isn't nearly as accurate as VBA.
<br/>
<br/>
GCC 3.0.2 is said to have problems at optimization level -O3.  Change to -O2, or (better yet) upgrade to DevKit Advance R5 beta 3, which includes GCC version 3.2.2 that has fixed many ARM backend bugs.  In fact, you may not even need a custom link script and crt0 with DKA5.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8250 - hnager - Sat Jul 05, 2003 12:22 pm</h4>
    <div class="postbody"><span class="postbody">I don't get the all of those errors in VisualBoy Advanced, however in a seperate test I traced out some text to the console (logging...) window - only the text <span style="font-weight: bold">before </span> the vector initialization and initial push_back() showed up in the console.
<br/>
<br/>
I will try your suggestions - I reverted back to using an earlier release of devkit because I get the error that -lgcc cannot be found when using the new beta/release.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8251 - hnager - Sat Jul 05, 2003 12:53 pm</h4>
    <div class="postbody"><span class="postbody">Changing the optimization level to -02 seemed to have helped n- at first...but as soon as I push_back() a second value it won't trace out anymore to the console window.
<br/>
<br/>
Simply changing it to point to devkit r5b3 gives me this error at compiletime:
<br/>
<br/>
 ld -nostartfiles -L c:\GBA\lib\gcc-lib\arm-agb-elf\3.2.2\interwork -L c:\GBA\arm-agb-elf\lib\interwork -T lnkscript -o POLYGON.elf crt0.o crtbegin.o crtend.o main.o -lstdc++ -lgcc -lc -lgcc
<br/>
c:\GBA\arm-agb-elf\lib\interwork\libc.a(agb-sbrk.o): In function `_sbrk':
<br/>
../../../../../../../gcc-3.2.2/newlib/libc/sys/agb/agb-sbrk.c:28: undefined reference to `__appended_end'
<br/>
../../../../../../../gcc-3.2.2/newlib/libc/sys/agb/agb-sbrk.c:28: undefined reference to `__heap_limit'
<br/>
../../../../../../../gcc-3.2.2/newlib/libc/sys/agb/agb-sbrk.c:28: undefined reference to `__appended_start'
<br/>
<br/>
Any other attempt to remove the linkscript or use gcc/g++ as opposed to ld gives me a huge list that looks like:
<br/>
<br/>
c:\GBA\bin\..\lib\gcc-lib\arm-agb-elf\3.2.2\..\..\..\..\arm-agb-elf\bin\ld.exe: Warning: c:\GBA\bin\..\lib\gcc-lib\arm-agb-elf\3.2.2\..\..\..\..\arm-agb-elf\lib\libstdc++.a(functexcept.o) does not support interworking, whereas POLYGON.elf does
<br/>
<br/>
Thanks to everybody for the help so far - I feel as if I'm very close to this working...hopefully somebody will see something in these errors which will show what I'm doing wrong.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8252 - tepples - Sat Jul 05, 2003 5:15 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>hnager wrote:</b></span></td> </tr> <tr> <td class="quote">Simply changing it to point to devkit r5b3 gives me this error at compiletime:
<br/>
<br/>
 ld -nostartfiles -L c:\GBA\lib\gcc-lib\arm-agb-elf\3.2.2\interwork -L c:\GBA\arm-agb-elf\lib\interwork -T lnkscript -o POLYGON.elf crt0.o crtbegin.o crtend.o main.o -lstdc++ -lgcc -lc -lgcc
<br/>
c:\GBA\arm-agb-elf\lib\interwork\libc.a(agb-sbrk.o): In function `_sbrk':
<br/>
../../../../../../../gcc-3.2.2/newlib/libc/sys/agb/agb-sbrk.c:28: undefined reference to `__appended_end'
<br/>
../../../../../../../gcc-3.2.2/newlib/libc/sys/agb/agb-sbrk.c:28: undefined reference to `__heap_limit'
<br/>
../../../../../../../gcc-3.2.2/newlib/libc/sys/agb/agb-sbrk.c:28: undefined reference to `__appended_start'</td> </tr></table><span class="postbody">
<br/>
These were new symbols introduced in the new startup code in DKA5 beta 3.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Any other attempt to remove the linkscript or use gcc/g++ as opposed to ld gives me a huge list that looks like:
<br/>
<br/>
c:\GBA\bin\..\lib\gcc-lib\arm-agb-elf\3.2.2\..\..\..\..\arm-agb-elf\bin\ld.exe: Warning: c:\GBA\bin\..\lib\gcc-lib\arm-agb-elf\3.2.2\..\..\..\..\arm-agb-elf\lib\libstdc++.a(functexcept.o) does not support interworking, whereas POLYGON.elf does</td> </tr></table><span class="postbody">
<br/>
Fix this by using -mthumb -mthumb-interwork when calling g++ to link. This will link in the Thumb interworking version of the C and C++ standard libraries, rather than the default ARM non-interworking version.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8255 - hnager - Sat Jul 05, 2003 6:31 pm</h4>
    <div class="postbody"><span class="postbody">Well - my makefile is down to:
<br/>
<br/>
PATH=c:\GBA\bin;
<br/>
DEVDIR  = c:\GBA
<br/>
<br/>
NAME = POLYGON
<br/>
<br/>
CFLAGS = -c -O3
<br/>
LDFLAGS = -L $(LIBDIR) -L $(LIBDIR2) -T lnkscript 
<br/>
<br/>
MODEL = -mthumb -mthumb-interwork 
<br/>
<br/>
$(NAME).bin : $(NAME).elf
<br/>
	objcopy -O binary $(NAME).elf $(NAME).bin
<br/>
<br/>
$(NAME).elf : main.o 
<br/>
	g++ $(MODEL) -o $(NAME).elf main.o -lstdc++
<br/>
<br/>
main.o : main.cpp
<br/>
	g++ $(CFLAGS) $(MODEL) main.cpp
<br/>
<br/>
<br/>
using dka5b3 and the standard crt* files...everything compiles fine, however as soon as I introduce a vector the rom doesn't run as it's supposed to. None of the mappy console traces show up.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8287 - Jason Wilkins - Mon Jul 07, 2003 5:10 am</h4>
    <div class="postbody"><span class="postbody">There is a known issue with using STL, -mthumb and -mthumb-interwork.
<br/>
<br/>
This is probably due to a problem with linking the thumb version of libstdc++.a, so as a workaround, when you link, do not specify -mthumb.<br/>_________________<br/><a href="http://devkitadv.sourceforge.net" target="_blank">http://devkitadv.sourceforge.net</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8290 - hnager - Mon Jul 07, 2003 11:29 am</h4>
    <div class="postbody"><span class="postbody">It may be a dream - it's not even 6:30am where I am...but it looks as if - it works!
<br/>
<br/>
I created a vector, added some elements with push_back() and then traced out the length of the vector - all without error - here is where I ended up with on the makefile front using devkit r5b3:
<br/>
<br/>
PATH=c:\GBA\bin;
<br/>
NAME = POLYGON
<br/>
<br/>
CFLAGS = -c -O3
<br/>
<br/>
$(NAME).bin : $(NAME).elf
<br/>
	objcopy -O binary $(NAME).elf $(NAME).bin
<br/>
<br/>
$(NAME).elf : main.o 
<br/>
	g++ -o $(NAME).elf main.o -lstdc++
<br/>
<br/>
main.o : main.cpp
<br/>
	g++ $(CFLAGS) main.cpp
<br/>
<br/>
<br/>
Thanks again for all the help - my next issue will hopefully be unrelated to the STL - vectors at least.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8295 - Sweex - Mon Jul 07, 2003 2:19 pm</h4>
    <div class="postbody"><span class="postbody">Good for you!:-)
<br/>
<br/>
And that is with the verison of STL that comes with devkitadvance, isn't it?</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
