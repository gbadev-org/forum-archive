<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>32 Rotations - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>C/C++ > 32 Rotations</h2>
<div id="posts">
<div class="post">
    <h4>#26566 - Mephisto - Sat Sep 18, 2004 11:59 pm</h4>
    <div class="postbody"><span class="postbody">I really dont understand ... 
<br/>
<span style="font-weight: bold">i initialize 12 sprites :</span>
<br/>
sprite0 with rotation0
<br/>
sprite1 with rotation1
<br/>
sprite2 with rotation2
<br/>
sprite3 with rotation3
<br/>
sprite4 with rotation4
<br/>
sprite5 with rotation5
<br/>
sprite6 with rotation6
<br/>
sprite7 with rotation7
<br/>
sprite8 with rotation8
<br/>
sprite9 with rotation9
<br/>
sprite10 with rotation10
<br/>
sprite11 with rotation11
<br/>
with differents parameters
<br/>
<span style="font-weight: bold">but i saw that</span>
<br/>
sprite0 use rotation0
<br/>
sprite1 use rotation1
<br/>
sprite2 use rotation2
<br/>
sprite3 use rotation3
<br/>
sprite4 use rotation4
<br/>
sprite5 use rotation5
<br/>
sprite6 use rotation6
<br/>
sprite7 use rotation7
<br/>
sprite8 use rotation0
<br/>
sprite9 use rotation1
<br/>
sprite10 use rotation2
<br/>
sprite11 use rotation3
<br/>
<br/>
i really dont understand ...
<br/>
<br/>
<span style="text-decoration: underline">Here is my sprite initialisation </span>:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
typedef struct spriteOAM_struct
<br/>
{
<br/>
   u16 Attribute0;
<br/>
   u16 Attribute1;
<br/>
   u16 Attribute2;
<br/>
   u16 Unused;
<br/>
} spriteOAM_struct;
<br/>
<br/>
typedef struct spriteRot_struct
<br/>
{
<br/>
   u16 Unused0[3];
<br/>
   u16 PA;
<br/>
   u16 Unused1[3];
<br/>
   u16 PB;
<br/>
   u16 Unused2[3];
<br/>
   u16 PC;
<br/>
   u16 Unused3[3];
<br/>
   u16 PD;
<br/>
<br/>
} spriteRot_struct;
<br/>
<br/>
u16 *SpritesData_VRAM = (u16*)0x6010000;
<br/>
u16 *SpritesOAM_RAM = (u16*)0x7000000;
<br/>
spriteOAM_struct SpritesOAM[128];
<br/>
spriteRot_struct *RotData = (spriteRot_struct*)SpritesOAM;
<br/>
<br/>
u32 numrotation = 0;
<br/>
<br/>
sprite-&gt;SpriteOAM-&gt;Attribute0 = ROTATION_FLAG | COLOR_16 | SQUARE;
<br/>
sprite-&gt;SpriteOAM-&gt;Attribute1 = ROTDATA(numrotation) | SIZE_32;
<br/>
sprite-&gt;SpriteOAM-&gt;Attribute2 = PRIORITY(3) | PALETTE(0) | ( ... );   
<br/>
sprite-&gt;NumRot = numrotation++;</td> </tr></table><span class="postbody">
<br/>
<br/>
<span style="text-decoration: underline">here is the sprite refreshing code i use</span> :
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void RefreshSprite_All(void)
<br/>
{
<br/>
   u16 i;
<br/>
   u16* temp;
<br/>
   temp = (u16*)SpritesOAM;
<br/>
   for(i = 0; i &lt; 128 * 4; i++)
<br/>
   {
<br/>
      SpritesOAM_RAM[i] = temp[i];
<br/>
   }
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
<span style="text-decoration: underline">here is the rotation code i use</span> :
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void matrixMultiply( int * dest, int * one, int * two )
<br/>
{
<br/>
   int a, b, c, d;
<br/>
<br/>
   a = ( (one[0]*two[0]) &gt;&gt; 8) + ( (one[1]*two[2]) &gt;&gt; 8 );
<br/>
   b = ( (one[0]*two[1]) &gt;&gt; 8) + ( (one[1]*two[3]) &gt;&gt; 8 );
<br/>
   c = ( (one[2]*two[0]) &gt;&gt; 8) + ( (one[3]*two[2]) &gt;&gt; 8 );
<br/>
   d = ( (one[2]*two[1]) &gt;&gt; 8) + ( (one[3]*two[3]) &gt;&gt; 8 );
<br/>
<br/>
   dest[0] = a;
<br/>
   dest[1] = b;
<br/>
   dest[2] = c;
<br/>
   dest[3] = d;
<br/>
}
<br/>
<br/>
void createShearXMatrix( int * mat, int xshear )
<br/>
{
<br/>
   mat[0] = 256;
<br/>
   mat[1] = xshear;
<br/>
   mat[2] = 0;
<br/>
   mat[3] = 256;
<br/>
}
<br/>
<br/>
void createShearYMatrix( int * mat, int yshear )
<br/>
{
<br/>
   mat[0] = 256;
<br/>
   mat[1] = 0;
<br/>
   mat[2] = yshear;
<br/>
   mat[3] = 256;
<br/>
}
<br/>
<br/>
void createScaleMatrix( int * mat, int xscale, int yscale )
<br/>
{
<br/>
   mat[0] = xscale;
<br/>
   mat[1] = 0;
<br/>
   mat[2] = 0;
<br/>
   mat[3] = yscale;
<br/>
}
<br/>
<br/>
void createRotateMatrix( int * mat, int angle )
<br/>
{
<br/>
   mat[0] = getCos( angle );
<br/>
   mat[1] = getSin( angle );
<br/>
   mat[2] = -getSin( angle );
<br/>
   mat[3] = getCos( angle );
<br/>
}
<br/>
<br/>
void ApplyRotateScale(sprite_struct *sprite, int scalex, int scaley, int shearx, int sheary, int angle)
<br/>
{
<br/>
   static int mat0[4], mat1[4], mat2[4], mat3[4], result[4];
<br/>
<br/>
   createScaleMatrix( mat0, scalex, scaley );
<br/>
   createShearXMatrix( mat1, shearx );
<br/>
   createShearYMatrix( mat2, sheary );
<br/>
   createRotateMatrix( mat3, angle );
<br/>
<br/>
   matrixMultiply( result, mat0, mat1 );
<br/>
   matrixMultiply( result, result, mat2 );
<br/>
   matrixMultiply( result, result, mat3 );
<br/>
<br/>
   RotData[sprite-&gt;NumRot].PA = result[0];
<br/>
   RotData[sprite-&gt;NumRot].PB = result[1];
<br/>
   RotData[sprite-&gt;NumRot].PC = result[2];
<br/>
   RotData[sprite-&gt;NumRot].PD = result[3];
<br/>
}</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26567 - tepples - Sun Sep 19, 2004 12:36 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mephisto wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">sprite-&gt;SpriteOAM-&gt;Attribute0 = ROTATION_FLAG | COLOR_16 | SQUARE;
<br/>
sprite-&gt;SpriteOAM-&gt;Attribute1 = ROTDATA(numrotation) | SIZE_32;
<br/>
sprite-&gt;SpriteOAM-&gt;Attribute2 = PRIORITY(3) | PALETTE(0) | ( ... );   
<br/>
sprite-&gt;NumRot = numrotation++;</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
How have you defined the ROTDATA() macro?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26569 - Mephisto - Sun Sep 19, 2004 2:53 am</h4>
    <div class="postbody"><span class="postbody">#define ROTDATA(n)	( (n) &lt;&lt; 9 )
<br/>
<br/>
edit : problem solved</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
