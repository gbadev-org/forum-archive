<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Building and linking ASM (.S) files - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>C/C++ > Building and linking ASM (.S) files</h2>
<div id="posts">
<div class="post">
    <h4>#81346 - Crs - Fri Apr 28, 2006 4:23 pm</h4>
    <div class="postbody"><span class="postbody">Hi guys,
<br/>
<br/>
Should be simple one.. I'm having a bit of trouble linking an asm file to my project.
<br/>
<br/>
to compile it I am using:
<br/>
arm-elf-as -mthumb-interwork -o &lt;FILE.O&gt; &lt;FILE&gt;.S
<br/>
<br/>
this produces the object '.o' file
<br/>
<br/>
((and compiling my normal c files like: arm-elf-g++ -O2 -g -mcpu=arm7tdmi -mthumb-interwork -c &lt;FILE&gt;.C))
<br/>
<br/>
The functions in the asm file are declared as extern in the c file but when calling either one I get an undefined reference.
<br/>
<br/>
Am I missing anything or should I get posting some code?
<br/>
<br/>
Thanks
<br/>
<br/>
Chris.<br/>_________________<br/><a href="http://www.hazardball.com" target="_blank">www.hazardball.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#81349 - Lord Graga - Fri Apr 28, 2006 4:41 pm</h4>
    <div class="postbody"><span class="postbody">First of all, it seems like that you are using .bat files - use Makefiles, they are a thousand times more dynamic and will make things quite a lot easier for you.
<br/>
<br/>
How are you linking everything?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#81351 - wintermute - Fri Apr 28, 2006 5:02 pm</h4>
    <div class="postbody"><span class="postbody">Compiling files with g++ generates C++ linkage (i.e. the names are mangled). In order to call functions in assembly files you need to specify them with C linkage using extern "C". If you want to call functions in the C files from assembly then you also need to use extern "C" on your function declarations.
<br/>
<br/>
You can avoid all this by using gcc rather than g++ if you're writing standard C.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#81363 - Crs - Fri Apr 28, 2006 6:59 pm</h4>
    <div class="postbody"><span class="postbody">Bingo!
<br/>
<br/>
I really should have known that, *smack head* appreciated wintermute.
<br/>
<br/>
Chris.<br/>_________________<br/><a href="http://www.hazardball.com" target="_blank">www.hazardball.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#81365 - tepples - Fri Apr 28, 2006 7:13 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Crs wrote:</b></span></td> </tr> <tr> <td class="quote">((and compiling my normal c files like: arm-elf-g++ -O2 -g -mcpu=arm7tdmi -mthumb-interwork -c &lt;FILE&gt;.C))</td> </tr></table><span class="postbody">
<br/>
Both the use of g++ and the use of a capital C filename extension tend to trigger the compiler to treat a source code file as C++ instead of C.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#81366 - Crs - Fri Apr 28, 2006 7:18 pm</h4>
    <div class="postbody"><span class="postbody">interesting, the case of the extension really makes that difference?  I knew naming .c instead of .cpp made the compiler treat the source different but did not know uppercase/lowercase had anything to do with it.  Nice note thanks.<br/>_________________<br/><a href="http://www.hazardball.com" target="_blank">www.hazardball.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#81367 - tepples - Fri Apr 28, 2006 7:23 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Crs wrote:</b></span></td> </tr> <tr> <td class="quote">interesting, the case of the extension really makes that difference?</td> </tr></table><span class="postbody">
<br/>
Yes. The GNU operating system is a clone of the UNIX operating system, and both GNU and UNIX have historically used case sensitive file systems. FAT as implemented in Microsoft Windows, on the other hand, is case insensitive but case preserving.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#81424 - chishm - Sat Apr 29, 2006 2:47 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">FAT as implemented in Microsoft Windows, on the other hand, is case insensitive but case preserving.</td> </tr></table><span class="postbody">
<br/>
FAT itself (8.3 names) is not case preserving, VFAT (long file names) is.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#81431 - wintermute - Sat Apr 29, 2006 3:41 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Crs wrote:</b></span></td> </tr> <tr> <td class="quote">((and compiling my normal c files like: arm-elf-g++ -O2 -g -mcpu=arm7tdmi -mthumb-interwork -c &lt;FILE&gt;.C))</td> </tr></table><span class="postbody">
<br/>
Both the use of g++ and the use of a capital C filename extension tend to trigger the compiler to treat a source code file as C++ instead of C.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
good catch, forgot about that one.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">FAT as implemented in Microsoft Windows, on the other hand, is case insensitive but case preserving.</td> </tr></table><span class="postbody">
<br/>
FAT itself (8.3 names) is not case preserving, VFAT (long file names) is.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
That's not relevant. The filesystem is case insensitive so specifying an upper case letter on the command line is enough.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#81432 - tepples - Sat Apr 29, 2006 3:53 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">FAT as implemented in Microsoft Windows, on the other hand, is case insensitive but case preserving.</td> </tr></table><span class="postbody">
<br/>
FAT itself (8.3 names) is not case preserving, VFAT (long file names) is.</span></td> </tr></table><span class="postbody">
<br/>
"FAT as implemented in Microsoft Windows" is VFAT.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
