<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>full C++ features - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>C/C++ > full C++ features</h2>
<div id="posts">
<div class="post">
    <h4>#18526 - ns2v - Sun Mar 28, 2004 2:21 pm</h4>
    <div class="postbody"><span class="postbody">hello,
<br/>
<br/>
i'm trying to have clean C++ support on gba. But i still have two problems.
<br/>
First, i need to call myself the globals constructors from a list build with the linkscript. Second, exceptions works only if i use catch ( ... ), with a catch ( type t ), the execution freeze on the throw.
<br/>
<br/>
If you have ideas, specially for the first problem, because i don't like the way i call the constructors manually.
<br/>
<br/>
thanks,
<br/>
ns2v.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18527 - Paul Shirley - Sun Mar 28, 2004 2:39 pm</h4>
    <div class="postbody"><span class="postbody">removed</span><span class="gensmall"><br/><br/>Last edited by Paul Shirley on Sun Mar 28, 2004 8:54 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#18528 - beelzebub - Sun Mar 28, 2004 2:50 pm</h4>
    <div class="postbody"><span class="postbody">Constructures are called by the startup code (usally ct0.s), but if you're using a home grown version, or one from somebody who only uses striaght C, the chances are the list of constructures (and destructors) is not being called.
<br/>
<br/>
somelike this is needed in crt0.s
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   .extern   __CTORS_START,__CTORS_END
<br/>
   .extern   __DTORS_START,__DTORS_END
<br/>
      .CODE   32
<br/>
      .ALIGN
<br/>
      .GLOBAL   __gccmain
<br/>
__gccmain:
<br/>
__main:
<br/>
   @ Handle C++ constructors
<br/>
      ldr      r8,=__CTORS_START
<br/>
      ldr      r9,=__CTORS_END
<br/>
handle_tors:
<br/>
      mov      r11,lr
<br/>
tors_loop:
<br/>
      cmp      r8,r9
<br/>
      bxge   r11
<br/>
      ldr      lr,=tors_loop
<br/>
      ldr      r0,[r8],#4
<br/>
      bx      r0
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
is gccmain is called by the compiler at the start of main().</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18529 - ns2v - Sun Mar 28, 2004 3:04 pm</h4>
    <div class="postbody"><span class="postbody">it's exactly what i did but in c style for the moment. And yes my crt0 is homebrew because i do some initialisation process and interrupt code here. So, you think it's normal. I thank that was not the case because i read somewhere that in c++ mode, gcc identify the call to main and insert the __gccmain at this point.
<br/>
<br/>
Remain my exception problem now.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
