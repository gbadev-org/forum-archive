<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Non Blocking Keyboard Input - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>C/C++ > Non Blocking Keyboard Input</h2>
<div id="posts">
<div class="post">
    <h4>#137059 - K-Duke - Tue Aug 07, 2007 6:07 pm</h4>
    <div class="postbody"><span class="postbody">Hey Everyone,
<br/>
<br/>
since now i've mostly used </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">gets(buf);</td> </tr></table><span class="postbody"> to get Keyboard-Input from the user though because of it's nature to wait for the User to finish his/her writing it's not very practical for time- and synchronous-sensitive applications.
<br/>
<br/>
I've found the GetAsyncKeyState-function... though it won't work out for me..
<br/>
here a pseudo-code how I'm using it.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">while ( ! bQuit )
<br/>
{
<br/>
    // Search for keys pressed since the last time GetAsyncKeyState was called
<br/>
    CHAR Keys[256];
<br/>
    CHAR Pressed = 0;
<br/>
    for ( ULONG i=0; i&lt;256; i++ )
<br/>
        if ( GetAsyncKeyState(i) &amp; 1 )
<br/>
            Keys[Pressed++] = i;
<br/>
<br/>
    // If something was pressed...
<br/>
    if ( Pressed != 0 )
<br/>
    {
<br/>
        printf( "%s\n", Keys);
<br/>
    }
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
Though I don't get any output onto the console....
<br/>
Someone got an idea what I'm doing wrong?<br/>_________________<br/>Live is but a game noone asked us to play for.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">There are 10 types of people. Those thinking binary and thos who don't.</td> </tr></table><span class="postbody">
<br/>
<br/>
<a class="postlink" href="http://k-duke.myblog.de" target="_blank">http://k-duke.myblog.de</a>
<br/>
<a class="postlink" href="http://www.kdukes-cave.de" target="_blank">www.kdukes-cave.de</a> &lt;--WiP!!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137061 - elyk1212 - Tue Aug 07, 2007 6:35 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
.. time- and synchronous-sensitive applications. 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
To me, this would be an argument for concurrent programming (Threads, semaphores etc).  Depending on if you have an OS this is running on etc.  
<br/>
<br/>
From what I remember, libc does have non blocking I/O routines for keyboard input, however, if this is time sensitive, you may want to look into threading, forking a process... etc.
<br/>
<br/>
EDIT: Never mind if you are doing this on an embedded system/GBA.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137063 - elyk1212 - Tue Aug 07, 2007 6:44 pm</h4>
    <div class="postbody"><span class="postbody">Hey also, by looking at your code, um...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
for ( ULONG i=0; i&lt;256; i++ )
<br/>
        if ( GetAsyncKeyState(i) &amp; 1 )
<br/>
            Keys[Pressed++] = i; 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
So, on this loop, (if I understand the GetAsyncKeyState function) you are not waiting/blocking for input, therefore the system will probably finish the loop before getting any input from the user.  User input is in the order of seconds, while your loop is in the order of the speed of your CPU (quite a big difference)
<br/>
<br/>
For testing, maybe just use a while loop and check:
<br/>
<br/>
while(Pressed &lt; x),  where x is some number of keys you want to see.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137065 - kusma - Tue Aug 07, 2007 6:55 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>K-Duke wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
        printf( "%s\n", Keys);
<br/>
</td> </tr></table><span class="postbody">
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
<br/>
no wonder you get no output, i guess the key with scancode 0 is never pressed, so it becomes a string starting with the zero-termination.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137068 - elyk1212 - Tue Aug 07, 2007 7:04 pm</h4>
    <div class="postbody"><span class="postbody">"string starting with the zero-termination."
<br/>
<br/>
Yes, kusma is right.  
<br/>
<br/>
If the user did input something (in time for entry into the first element):
<br/>
You are printing a null terminated string of length 0.  You are just appending integer values from 'i' into the Keys array (first one is 0, of course).
<br/>
<br/>
If they didn't do this in time, you are guaranteed garbage in the first element.  Not necessarily 0, but what ever the stack frame contained from a previous allocation (could be anything).  This is what ever was in the memory space of Keys from before.
<br/>
<br/>
Let me ask you, what is the purpose of the code?  Do you wish to print out each character the user has entered?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137070 - K-Duke - Tue Aug 07, 2007 7:20 pm</h4>
    <div class="postbody"><span class="postbody">Sorry... I forgot to note thats Windows specific.
<br/>
Though GetAsyncKeyState returns the last key pressed since GetAsyncKeyState has been called.
<br/>
Well that's how it's defined at <a class="postlink" href="http://msdn2.microsoft.com/en-us/library/ms646293.aspx" target="_blank">MSDN</a>
<br/>
Those virtual-key codes mentioned there simply are "#defines" for the ascii codes. 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">So, on this loop, [...] you are not waiting/blocking for input</td> </tr></table><span class="postbody">
<br/>
<br/>
That is exactly what I don't want. To make it clear in fact it's a simple console chat client.
<br/>
Though if I wait for the User to finish his/her input the client cannot receive any messages from the server as the program still waits for the cariage return.
<br/>
<br/>
It doesn't have to be exactly this function (GetAsyncKeyState).
<br/>
If you've got another idea to do this I would appreciate any approach.
<br/>
<br/>
And for threads... well I don't have a clue to realize that.<br/>_________________<br/>Live is but a game noone asked us to play for.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">There are 10 types of people. Those thinking binary and thos who don't.</td> </tr></table><span class="postbody">
<br/>
<br/>
<a class="postlink" href="http://k-duke.myblog.de" target="_blank">http://k-duke.myblog.de</a>
<br/>
<a class="postlink" href="http://www.kdukes-cave.de" target="_blank">www.kdukes-cave.de</a> &lt;--WiP!!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137073 - elyk1212 - Tue Aug 07, 2007 7:42 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Though GetAsyncKeyState returns the last key pressed since GetAsyncKeyState has been called.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
BTW, you are anding with 1 which will only enter the conditional when the last bit in the key code is set.  So, only every other key will detected.
<br/>
<br/>
Does this make sense?  for example, if ASCI codes were 0 to 3 for chars a,b,c,d (which they are not, but for simplicity) .
<br/>
<br/>
The bits would be:
<br/>
<br/>
A = 000<span style="font-weight: bold">0</span>
<br/>
B = 000<span style="font-weight: bold">1</span>
<br/>
C = 001<span style="font-weight: bold">0</span>
<br/>
D = 001<span style="font-weight: bold">1</span>
<br/>
<br/>
Notice the LSB (least significant bit, Right hand side) is alternating every other character.  This is just normal binary counting.  You will see this pattern in all adjacent number values.  But this is the least of your worries  with that code, it is much more likely to not get anything at all from the user as the loop code will complete so fast there will be no input detected.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
"Though if I wait for the User to finish his/her input the client cannot receive any messages from the server as the program still waits for the carriage return. "
<br/>
</td> </tr></table><span class="postbody">
<br/>
This is why you need to use threads.  The idea is the client thread does its thing, while another thread can block for user input, while not conflicting with one another.  If they share data you will need to use semaphores to provide concurrency and eliminate things like "race conditions" etc.  If this doesn't make any sense I suggest reading up on threads and concurrency, as you will pull your hair out trying to sync all of these things without it. I'd venture to say impossible, but improbable is likely a better suite.
<br/>
<br/>
Another alternative is using a GUI tool kit which implements threads in the widgets for you (hiding many of the details), which may be all you need.  But more likely you will need to implement threads of some sort (the GUI tool kits make an easy interface for these, usually).
<br/>
<br/>
These can be wxWidgets, QT... for C++, or even Java swing etc.  You could check out wxDev-Cpp for windBloze, if you would like.  It is decent for rapid app dev.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137076 - K-Duke - Tue Aug 07, 2007 8:12 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">A = 0000
<br/>
B = 0001
<br/>
C = 0010
<br/>
D = 0011
<br/>
<br/>
Notice the LSB (least significant bit, Right hand side) is alternating every other character.</td> </tr></table><span class="postbody">
<br/>
That would be if the result of GetAsyncKeyState would be used to fill Keys.
<br/>
Though if you carefully look at the code you will see it works in another way as GetAsyncKeyState doesn't retun a char 8bit-Value.
<br/>
The reason I anded 1 to the return-value is because the LSB doesn't contain the ascii-code but is set to clarify that the key (i) as pressed since the last call of GetAsyncKeyState.
<br/>
When I press a key AFTER the function was called it (normally should) get this KeyPress from the Windows thread message-queue.
<br/>
As the key has been pressed the LSB is set.
<br/>
If a slash was the key returned it would be like
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">(key ain't down)
<br/>
 |       ascii scan code(also in loop counter i)
<br/>
 |      _____|______     Flag set as the key was pressed.
<br/>
\ /    /             \         |
<br/>
 0     1  0  1  1  1  1         1 
<br/>
                 &amp;
<br/>
 0     0  0  0  0  0  0         1
<br/>
<br/>
</td> </tr></table><span class="postbody">resulting in in... 1 as result. --&gt; Key i has been pressed.
<br/>
<br/>
Though saying this i notice i have to "!" the whole if statement...
<br/>
*hitting my forehead*<br/>_________________<br/>Live is but a game noone asked us to play for.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">There are 10 types of people. Those thinking binary and thos who don't.</td> </tr></table><span class="postbody">
<br/>
<br/>
<a class="postlink" href="http://k-duke.myblog.de" target="_blank">http://k-duke.myblog.de</a>
<br/>
<a class="postlink" href="http://www.kdukes-cave.de" target="_blank">www.kdukes-cave.de</a> &lt;--WiP!!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137077 - elyk1212 - Tue Aug 07, 2007 8:24 pm</h4>
    <div class="postbody"><span class="postbody">EDIT: Aw, I see.  Just read some Win32 docs on that func.  Still the concept needs work.  See my response on threads and speed of execution regarding using input.
<br/>
<br/>
The way your code is, Keys would always be
<br/>
<br/>
Keys =&gt; {0... 255} // where which ever ascii code that does not conform to keys possible, there will be garbage.
<br/>
<br/>
Anytime the user doesn't enter a key code for a particular value (such as 0 etc), that will be a garbage value.  But say you could enter in all key values from 0-255 on a keyboard, the print statement still makes little sense, in this context.  Also when done in this top down 0-255 loop, mannor, order of keys pressed comes into play.  
<br/>
<br/>
What if a user pressed key C before A, A &lt; C therefore A would never be detected, even while the loop was going!  (Or in the other case, C would not be detected and only A, depending on where we were in the loop).
<br/>
<br/>
Ultimately: I think... the way in which you are retrieving input does not make sense for your application.  It should not be a iterative polling process that tests each key, (this takes 0(N) time!) it should be a single query that instead asks for the value of the key press (O(1) time!).
<br/>
<br/>
------------------------------------------
<br/>
Hey, btw, did what I say about 'garbage' make sense.  
<br/>
<br/>
Have you read about initializing data in C/C++ to avoid this.  This is key to avoiding problems in C/C++.  It is not needed in some higher level interpreted languages, therefore, it is worth mentioning as it is not always remembered.
<br/>
<br/>
<br/>
Example if I had this code, what would printout?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
char stuff[3]
<br/>
int z = 5;
<br/>
int x;
<br/>
int i;
<br/>
for(i = 0; i &lt; 3; i++)
<br/>
{
<br/>
   printf("stuff[%d] = %c\n",i, stuff[i])
<br/>
}
<br/>
printf("z = %d\n",z);
<br/>
printf("x = %d\n",x);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
You are right if you said, "Who the H&amp;*l knows?", LOL.  It would be gargage for all stuff[] (what ever was left over on the stack) and would be 5 for z and gargabe for x.
<br/>
<br/>
So maybe it would look something like this (I say *maybe* due to garbage being unknown values):
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
stuff[0] = %
<br/>
stuff[1] = 3
<br/>
stuff[2] =  &amp;
<br/>
z = 5
<br/>
x = @
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"><br/><br/>Last edited by elyk1212 on Tue Aug 07, 2007 8:50 pm; edited 3 times in total</span></div>    
</div>
<div class="post">
    <h4>#137082 - K-Duke - Tue Aug 07, 2007 8:47 pm</h4>
    <div class="postbody"><span class="postbody">I think I'm missing something... &gt;.&lt;
<br/>
Where is the point I'm pointing to non-set memory?
<br/>
Could you please point out where I should get garbage?
<br/>
In fact I'm not getting any garbage at all because the if-statement never becomes true. Therefore Pressed is never incremented and printf never called.
<br/>
<br/>
Sorry for acting dumb....<br/>_________________<br/>Live is but a game noone asked us to play for.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">There are 10 types of people. Those thinking binary and thos who don't.</td> </tr></table><span class="postbody">
<br/>
<br/>
<a class="postlink" href="http://k-duke.myblog.de" target="_blank">http://k-duke.myblog.de</a>
<br/>
<a class="postlink" href="http://www.kdukes-cave.de" target="_blank">www.kdukes-cave.de</a> &lt;--WiP!!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137084 - elyk1212 - Tue Aug 07, 2007 8:53 pm</h4>
    <div class="postbody"><span class="postbody">No, no... you are not acting dumb.   This is good stuff to discuss.
<br/>
<br/>
Well, when you go through that loop, can a person ever enter a ASCII character of value 1?  No, how about 0? .. not really that is NULL, and a keyboard cannot 'press' null.  
<br/>
<br/>
Therefore, when you are asking is this key pressed in a loop like that, some keys will never be possible to be depressed.  Therefore, they will never be set.  
<br/>
<br/>
But regardless, even if they were all possible ASCII values, 
<br/>
<br/>
if the user did not press say... um 'A'.  Then the value of
<br/>
<br/>
Keys['A'] in your array is garbage as it is never initialized to anything!
<br/>
<br/>
<br/>
<br/>
I am sorry if this does not make sense.  Your code glosses over the keys that were never pushed.
<br/>
<br/>
BTW, even if the Pressed variable were non-zero, you would still see unpredictable things, as the concept of your application is off a bit.  Especially since the first value would be zero if it were at all possible for the user to push NULL!.
<br/>
<br/>
<br/>
More likely, the code steps through 256 iterations before you can blink or let alone push a key, and that variable is in fact zero (probably).  Add a printf statement and find out.
<br/>
<br/>
<br/>
printf("Pressed = %d\n",Pressed");</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137086 - elyk1212 - Tue Aug 07, 2007 9:01 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>K-Duke wrote:</b></span></td> </tr> <tr> <td class="quote">I think I'm missing something... &gt;.&lt;
<br/>
Where is the point I'm pointing to non-set memory?
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
printf( "%s\n", Keys); 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
this equals the same thing as..
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
printf( "%s\n", Keys[0]); 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
1) Keys[0] = 0, if it were possible for a user to push NULL
<br/>
2) Keys[0] = Garbage in real life
<br/>
<br/>
<br/>
If (1) were true, you would see nothing, a zero length null terminated string.
<br/>
<br/>
If (2) were possible, you may see the same as (1), or you may see unpredictable random crappy-crap garbled string that prints characters until it reaches the char value NULL (aka 0), etc.  
<br/>
<br/>
I've seen these plenty of times ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137088 - K-Duke - Tue Aug 07, 2007 9:07 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">printf( "%s\n", Keys);</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
this equals the same thing as..
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
printf( "%s\n", Keys[0]);</td> </tr></table><span class="postbody">
<br/>
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Then I wonder why server prints out "/Connect me:Nickname" calling </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">printf("%s\n", buf);</td> </tr></table><span class="postbody"> after receiving exacly this message over UDP.<br/>_________________<br/>Live is but a game noone asked us to play for.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">There are 10 types of people. Those thinking binary and thos who don't.</td> </tr></table><span class="postbody">
<br/>
<br/>
<a class="postlink" href="http://k-duke.myblog.de" target="_blank">http://k-duke.myblog.de</a>
<br/>
<a class="postlink" href="http://www.kdukes-cave.de" target="_blank">www.kdukes-cave.de</a> &lt;--WiP!!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137090 - elyk1212 - Tue Aug 07, 2007 9:11 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>K-Duke wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<br/>
Then I wonder why server prints out "/Connect me:Nickname" calling <table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">printf("%s\n", buf);</td> </tr></table><span class="postbody"> after receiving exacly this message over UDP.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Can you please explain more?  I didn't see that code.  
<br/>
<br/>
A guess: Likely, if that buffer is populated by some sort of network class you made or are implementing, you would have no issue with un-allocated strings.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137092 - elyk1212 - Tue Aug 07, 2007 9:18 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
for ( ULONG i=0; i&lt;256; i++ )
<br/>
        if ( GetAsyncKeyState(i) &amp; 1 )
<br/>
            Keys[Pressed++] = i; 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Dude, I'm tired or something, lol my understanding was way off.  I thought "Keys[i++] = i; " I need to retract what I said earlier about the glossing over parts and garbage being an issue (except no termination).  But anyhow, order still matters on key presses (not good), and there is no null termination at the end of retrieving input, so it could run on forever in memory when it reaches the printf statement (that is until it reaches NULL, somewhere in memory).
<br/>
<br/>
Concept change?:
<br/>
Try a threading approach.  And instead of asking each ascii value if it is pressed, ask what was pushed.  Also, debug output is your friend, go nuts with printfs and see what your code is doing.</span><span class="gensmall"><br/><br/>Last edited by elyk1212 on Tue Aug 07, 2007 9:35 pm; edited 2 times in total</span></div>    
</div>
<div class="post">
    <h4>#137093 - K-Duke - Tue Aug 07, 2007 9:22 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
while(1)
<br/>
{
<br/>
     //here buf is filled. it is simply a global "char buf[256];"
<br/>
     rc=recvfrom(MySock, buf, 256, 0, (SOCKADDR*)&amp;RemoteAddr, &amp;RemoteAddrLen);
<br/>
          if( rc == SOCKET_ERROR)
<br/>
          {
<br/>
              printf("recvfrom\n");
<br/>
              system("PAUSE");
<br/>
              return WSAGetLastError();
<br/>
          }
<br/>
          else
<br/>
          { //3
<br/>
              printf("%s\n", buf);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
recvfrom is defined as follow:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int recvfrom (
<br/>
  SOCKET s,                   
<br/>
  char FAR* buf,              
<br/>
  int len,                    
<br/>
  int flags,                  
<br/>
  struct sockaddr FAR* from,  
<br/>
  int FAR* fromlen            
<br/>
);</td> </tr></table><span class="postbody"><br/>_________________<br/>Live is but a game noone asked us to play for.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">There are 10 types of people. Those thinking binary and thos who don't.</td> </tr></table><span class="postbody">
<br/>
<br/>
<a class="postlink" href="http://k-duke.myblog.de" target="_blank">http://k-duke.myblog.de</a>
<br/>
<a class="postlink" href="http://www.kdukes-cave.de" target="_blank">www.kdukes-cave.de</a> &lt;--WiP!!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137100 - elyk1212 - Tue Aug 07, 2007 11:00 pm</h4>
    <div class="postbody"><span class="postbody">Hey man, sorry, read my last post (just placed during your last one).  
<br/>
<br/>
I was wrong about the garbage (for input anyhow), but your prints could still produce garbage due to no null termination.  
<br/>
<br/>
Suggestion:  Redesign with thread for receiving data from server, one for receiving user input, etc.  Easier to do with a GUI tool kit.... or using pthreads and friends (in your case a windows equivalent, perhaps encapsulated by the GUI tool kit you chose [?] ).  At least that is what I would do.  
<br/>
<br/>
I wrote something similar to this in Java not that long ago for a portable Yahoo chat client.  I spun off a new thread every time I made a blocking (network) request, that way the GUI was still responsive.
<br/>
<br/>
Analogy: in your case "That way the keyboard is still responsive"... or whatever you're doing.
<br/>
<br/>
<br/>
But given your current code, that may not be the reason you aren't seeing anything.  Could be the loop completion issue I mentioned (can you see how this can be an issue?).  Printf the crap out of your code and find out what's going on.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137108 - sgeos - Wed Aug 08, 2007 12:04 am</h4>
    <div class="postbody"><span class="postbody">Not sure what your are trying to do, but I have had no problems with the curses libraries.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137191 - K-Duke - Wed Aug 08, 2007 7:23 pm</h4>
    <div class="postbody"><span class="postbody">In the meantime I "solved" the problem...
<br/>
To be exact the code I posted first was completely ok.
<br/>
It is just that I have a blocking recv() call in the loop where the code snippet I posted was in too.
<br/>
So it only checked if there was a keypress once. No further call of GetAsyncKeyState() was done as the code waited at recv() to get some UDP-Packets before proceeding.
<br/>
Though to my disappointment it only returns capital letters.
<br/>
Furthermore it isn't possible to reach shift+key characters....
<br/>
<br/>
I guess I have no choice but to thread the whole thing.<br/>_________________<br/>Live is but a game noone asked us to play for.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">There are 10 types of people. Those thinking binary and thos who don't.</td> </tr></table><span class="postbody">
<br/>
<br/>
<a class="postlink" href="http://k-duke.myblog.de" target="_blank">http://k-duke.myblog.de</a>
<br/>
<a class="postlink" href="http://www.kdukes-cave.de" target="_blank">www.kdukes-cave.de</a> &lt;--WiP!!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137194 - elyk1212 - Wed Aug 08, 2007 7:40 pm</h4>
    <div class="postbody"><span class="postbody">That's good.  Sorry about my previous confusion.  
<br/>
<br/>
It would be a good idea to thread, if you are creating a serious chat app.  
<br/>
<br/>
--- About the previous ----
<br/>
Consider, any time you print a string you are constructing char by char, always NULL terminate before doing so (that avoids garbage prints, trust me).  Also, if you used any string.h functions without null terminating, you'd be hosed (strcat, strcpy and friends).  They can be handy.  Also, consider what I said about the letter order being restricted.  You aren't noticing this issue perhaps due to the speed of execution (in the loop), but you would if you stepped through.
<br/>
-------------------------------
<br/>
<br/>
But for now, I would look at another I/O routine for keyboard input.  It may be that GetAsyncKeyState()  is not the best choice (since your code just checks for individual keys, not combos etc).
<br/>
<br/>
getchar() and such from stdio do retrieve capital letters, and you don't have to do funny things to check for input.  However, the catch is it blocks by default.  I <span style="font-weight: bold">do</span> think I have heard of using non-blocking calls from stdio though.  Check the libc documents.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137198 - K-Duke - Wed Aug 08, 2007 8:09 pm</h4>
    <div class="postbody"><span class="postbody">I've now found a possibility to do it.
<br/>
I'll use a keyboard hook.
<br/>
This way the input is only checked when a keyboard event occurs in Windows. Then Windows calls my set filter function.
<br/>
So to say I use the results of the Windows intern keyboard processing thread.<br/>_________________<br/>Live is but a game noone asked us to play for.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">There are 10 types of people. Those thinking binary and thos who don't.</td> </tr></table><span class="postbody">
<br/>
<br/>
<a class="postlink" href="http://k-duke.myblog.de" target="_blank">http://k-duke.myblog.de</a>
<br/>
<a class="postlink" href="http://www.kdukes-cave.de" target="_blank">www.kdukes-cave.de</a> &lt;--WiP!!</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
