<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>gcc vs g++ - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>C/C++ > gcc vs g++</h2>
<div id="posts">
<div class="post">
    <h4>#15386 - doudou - Wed Jan 21, 2004 8:35 pm</h4>
    <div class="postbody"><span class="postbody">I'm doing a project that is getting pretty big. So far, I used only C code to compile with gcc. For some "clean implantation" issues, I'm now wondering if I should use C++ classes and build with g++. I don't know anything about the g++ compiler and I wonder if it's a good choice to pass from gcc to g++. I'd like to know if I can expect the same performance from both compiler.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15387 - sajiimori - Wed Jan 21, 2004 8:40 pm</h4>
    <div class="postbody"><span class="postbody">Both are simply front ends to the real compiler (cc1), assembler (as), and linker (ld).  They merely set different flags by default.  g++ sets things up to be C++-friendly.
<br/>
<br/>
Out of curiosity, what kind of issues are making you think about switching to C++?  Don't worry -- I'm not going to try to talk you out of it (though I might offer ways to clean things up without switching).  =)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15389 - doudou - Wed Jan 21, 2004 9:20 pm</h4>
    <div class="postbody"><span class="postbody">It's just that i want to use a more object oriented approach. Ex : i now want to introduce monsters in the game and a clean way for this would be to have a pure virtual class monster with a virtual function AI that is implemented in derived classes like Dragon. Is this a good enough reason ?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15391 - DekuTree64 - Wed Jan 21, 2004 9:41 pm</h4>
    <div class="postbody"><span class="postbody">Yeah, I'm doing a sort of OO battle system for my RPG, where you have things like menus and numbers to show damage all put into a list of 'objects' that need updated each frame. It may work better to use C++, but I kind of like C more anyway, so I just made a basic object struct with a pointer to the next one in the list, and a type and such, and then make sure all the specific things have those same first members, so I can just use a switch statement on the type to decide which update function to call. Or maybe even a table of function pointers so each type value is an index in the table. 
<br/>
Another way I've heard of is to give the base struct some function pointer members and when creating an object, set the pointers to the update function for the current type. 
<br/>
Bottom line: it doesn't matter what language you use as long as you get the job done. 
<br/>
<br/>
Anyway, I've never tried mixing C and C++, but I don't see why there would be any problems with it as long as you keep all your dealing with classes and other C++-related things in .cpp files. It all gets compiled to ASM anyway.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15399 - sajiimori - Thu Jan 22, 2004 1:16 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
It's just that i want to use a more object oriented approach. Ex : i now want to introduce monsters in the game and a clean way for this would be to have a pure virtual class monster with a virtual function AI that is implemented in derived classes like Dragon. Is this a good enough reason ?
<br/>
</td> </tr></table><span class="postbody">
<br/>
IMO, it's a good sign that you are even <span style="font-style: italic">thinking</span> about specific reasons to use C++ features, instead of just "because everybody says C++/OO is better".
<br/>
<br/>
If you want to start using C++ features in some places, first rename all your .c files to .cpp and compile them with g++.
<br/>
<br/>
No, seriously!  GCC is less strict when compiling .c files (as it should be), and recompiling your C code as C++ will bring any "relaxed" C-style code to light, such as using fuctions without declaring them.
<br/>
<br/>
After that, you can feel confident about using virtuals, overloaded functions, constructors, and other handy C++ features in places where they will make things significantly simpler, without feeling compelled to reshape your entire program to fit it into the OO mold.
<br/>
<br/>
Edit: a concrete comparison of the monster AI situation:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
/*
<br/>
 *  monster.c
<br/>
 */
<br/>
<br/>
struct MonsterType;
<br/>
<br/>
typedef struct Monster
<br/>
{
<br/>
  struct MonsterType* type;
<br/>
  int x, y;
<br/>
} Monster;
<br/>
<br/>
typedef struct MonsterType
<br/>
{
<br/>
  void (*think)(Monster*);
<br/>
} MonsterType;
<br/>
<br/>
Monster all_monsters[MAX_MONSTERS];
<br/>
int next_available_monster;
<br/>
<br/>
Monster* create_monster(MonsterType* t)
<br/>
{
<br/>
  /* naive allocation scheme */
<br/>
  Monster* m = &amp;all_monsters[next_avaliable_monster++];
<br/>
  m-&gt;type = t;
<br/>
  return m;
<br/>
}
<br/>
<br/>
void monsters_think()
<br/>
{
<br/>
  Monster* m = all_monsters;
<br/>
  Monster* end = m + MAX_MONSTERS;
<br/>
<br/>
  while(m &lt; end)
<br/>
  {
<br/>
    m-&gt;type-&gt;think(m);
<br/>
    m++;
<br/>
  }
<br/>
}
<br/>
<br/>
/*
<br/>
 *  dragon.c
<br/>
 */
<br/>
<br/>
Peasant* dragon_find_peasant(Monster*);
<br/>
void dragon_eat_peasant(Monster*, Peasant*);
<br/>
<br/>
void dragon_think(Monster* m)
<br/>
{
<br/>
  Peasant* p;
<br/>
<br/>
  p = dragon_find_peasant(m);
<br/>
  if(p)
<br/>
    dragon_eat_peasant(m, p);
<br/>
}
<br/>
<br/>
const MonsterType Dragon = { think: dragon_think; };
<br/>
<br/>
/*
<br/>
 *  magic_spells.c
<br/>
 */
<br/>
<br/>
void zap_wand()
<br/>
{
<br/>
  Monster* m;
<br/>
  player_say("Hmm, I wonder what this wand does?");
<br/>
<br/>
  m = create_monster(&amp;Dragon);
<br/>
  m-&gt;x = player.x;
<br/>
  m-&gt;y = player.y + 10;
<br/>
<br/>
  player_say("Oh crap!");
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
//
<br/>
// monster.cpp
<br/>
//
<br/>
<br/>
struct Monster
<br/>
{
<br/>
  int x, y;
<br/>
  virtual void think() = 0;
<br/>
};
<br/>
<br/>
// dummy type to initially fill array
<br/>
struct BlankMonster
<br/>
{
<br/>
  void think() {}
<br/>
};
<br/>
<br/>
BlankMonster all_monsters[MAX_MONSTERS];
<br/>
int next_available_monster;
<br/>
<br/>
Monster* allocate_monster()
<br/>
{
<br/>
  // naive allocation scheme
<br/>
  return &amp;all_monsters[next_avaliable_monster++];
<br/>
}
<br/>
<br/>
void monsters_think()
<br/>
{
<br/>
  Monster* m = all_monsters;
<br/>
  Monster* end = m + MAX_MONSTERS;
<br/>
<br/>
  while(m &lt; end)
<br/>
  {
<br/>
    m-&gt;think();
<br/>
    m++;
<br/>
  }
<br/>
}
<br/>
<br/>
//
<br/>
// dragon.cpp
<br/>
//
<br/>
<br/>
// any additional data members should be static
<br/>
// for this example, because Dragons have to fit
<br/>
// in the same array with other Monster types.
<br/>
struct Dragon : public Monster
<br/>
{
<br/>
  void think();
<br/>
  Peasant* find_peasant();
<br/>
  void eat_peasant(Peasant*);
<br/>
};
<br/>
<br/>
void Dragon::think()
<br/>
{
<br/>
  Peasant* p;
<br/>
<br/>
  p = find_peasant();
<br/>
  if(p)
<br/>
    eat_peasant(p);
<br/>
}
<br/>
<br/>
//
<br/>
// magic_spells.cpp
<br/>
//
<br/>
<br/>
void zap_wand()
<br/>
{
<br/>
  player_say("Hmm, I wonder what this wand does?");
<br/>
<br/>
  // use placement new to put the dragon in
<br/>
  // the pre-allocated array.  (is this the right
<br/>
  // syntax?)
<br/>
  Dragon* m = new (monster_allocate()) Dragon;
<br/>
<br/>
  m-&gt;x = player.x;
<br/>
  m-&gt;y = player.y + 10;
<br/>
<br/>
  player_say("Oh crap!");
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15483 - doudou - Fri Jan 23, 2004 1:44 am</h4>
    <div class="postbody"><span class="postbody">I cleaned my code since g++ is more restrictive than gcc (which is ok to me). I now have a problem that i did not have with gcc (and still don't have since i still can build my project using gcc) : stuff declared in a file that is used by many (at least 2 ;-) ) other files are bringing multiple defines error. Maybe my way to build is not good...here is my makefile :
<br/>
<br/>
<br/>
g++ -c -O3 -mthumb -mthumb-interwork engine\gfx.c
<br/>
g++ -c -O3 -mthumb -mthumb-interwork engine\misc.c
<br/>
g++ -c -O3 -mthumb -mthumb-interwork engine\sprite.c
<br/>
g++ -c -O3 -mthumb -mthumb-interwork engine\spriteengine.c
<br/>
g++ -c -O3 -mthumb -mthumb-interwork engine\saveload.c
<br/>
g++ -c -O3 -mthumb -mthumb-interwork engine\text.c
<br/>
g++ -c -O3 -mthumb -mthumb-interwork engine\DMACopy.c
<br/>
g++ -c -O3 -mthumb -mthumb-interwork engine\anims.c
<br/>
g++ -c -O3 -mthumb -mthumb-interwork engine\stats.c
<br/>
g++ -c -O3 -mthumb -mthumb-interwork engine\levels.c
<br/>
g++ -c -O3 -mthumb -mthumb-interwork engine\AI.c
<br/>
g++ -c -O3 -mthumb -mthumb-interwork engine\Time.c
<br/>
g++ -c -O3 -mthumb -mthumb-interwork engine\Debug.c
<br/>
g++ -c -O3 -mthumb -mthumb-interwork main.c
<br/>
<br/>
g++ -mthumb -mthumb-interwork -o mygame.elf mygame.o gfx.o misc.o spriteEngine.o sprite.o saveload.o text.o DMACopy.o anims.o stats.o levels.o AI.o time.o debug.o
<br/>
<br/>
objcopy -O binary mygame.elf mygame.gba</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15489 - tepples - Fri Jan 23, 2004 3:27 am</h4>
    <div class="postbody"><span class="postbody">You need to use the keyword <span style="font-weight: bold">extern</span> to reference global variables in your project's header files, and only one source code file should declare a global variable without <span style="font-weight: bold">extern</span>. Two declarations of a global variable without <span style="font-weight: bold">extern</span> result in multiple definitions, which the linker cannot resolve.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15504 - doudou - Fri Jan 23, 2004 3:49 pm</h4>
    <div class="postbody"><span class="postbody">Thanx, it worked. I still wonder why with gcc I did not have this problem.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15518 - sajiimori - Fri Jan 23, 2004 9:47 pm</h4>
    <div class="postbody"><span class="postbody">For compatability, the linker flags are probably more relaxed with gcc, automatically merging different occurances of the same symbol.  I haven't checked the manual though.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15711 - MoorCrow - Wed Jan 28, 2004 10:42 am</h4>
    <div class="postbody"><span class="postbody">Where can I get my hands on g++ and can I hook it up with Visual C++.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15714 - MoorCrow - Wed Jan 28, 2004 11:26 am</h4>
    <div class="postbody"><span class="postbody">Got g++ but still getting the same errors that gcc gave me. I thought that
<br/>
the errors might have been linked to my using classes, which I presume
<br/>
to be a C++ feature.
<br/>
<br/>
I created a class but I can't use it without getting an error.
<br/>
undefined reference to 'className::functionName'
<br/>
<br/>
How can I get to use classes?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15718 - poslundc - Wed Jan 28, 2004 2:33 pm</h4>
    <div class="postbody"><span class="postbody">Sounds like you either didn't define all of the class methods you are calling, or you didn't submit all of the .cpp files to g++ when you called it.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15735 - MoorCrow - Wed Jan 28, 2004 7:25 pm</h4>
    <div class="postbody"><span class="postbody">O, I thought that the visual studio helper added files to the compile
<br/>
automatically. Well, added it manually and I works fine. Thanks for the
<br/>
help.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
