<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>template: reference not found - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>C/C++ > template: reference not found</h2>
<div id="posts">
<div class="post">
    <h4>#156794 - Maxxie - Tue May 13, 2008 11:46 pm</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
i have a linking problem i can't seem to find the cause, someone might lift my blindness.
<br/>
<br/>
The file setup is the following:
<br/>
fifo.cpp, fifo.hpp, ipc,cpp and ipc.hpp
<br/>
<br/>
The .cpp's are compiled with g++, their .d and .o are generated in the same /build folder.
<br/>
<br/>
In fifo.hpp/cpp a template is declared
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#ifndef fifo_included
<br/>
#define fifo_included
<br/>
<br/>
template &lt;class T&gt; 
<br/>
class FIFO
<br/>
{
<br/>
   private:
<br/>
      volatile int *         head ;
<br/>
      volatile int *         tail ;
<br/>
      volatile int *         maxCount ;
<br/>
      volatile T *         buffer ;
<br/>
   public:
<br/>
      FIFO(int size) ;
<br/>
      ~FIFO() ;
<br/>
      
<br/>
      bool Push(T entry) ;
<br/>
      T Pop(void) ;
<br/>
      
<br/>
      int Count(void) ;
<br/>
      bool empty(void) ;
<br/>
      bool full(void) ;
<br/>
} ;
<br/>
<br/>
#endif
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
The bodies are in the .cpp like
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
template &lt;class T&gt; 
<br/>
bool FIFO&lt;T&gt;::empty(void)
<br/>
{
<br/>
// ...
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
They are used within ipc.cpp and should be created by "new FIFO&lt;int&gt;(32)", but that leads to 
<br/>
c:/devkitPro/projects/NeocronDS/arm7/../shared/source/ipc.cpp:35: undefined reference to `FIFO&lt;int&gt;::empty()'
<br/>
<br/>
The fifo.cpp itself is compiled without error or warning.
<br/>
<br/>
When examinating fifo.o, with objdump -t there is no symbol that would indicate any class in it.
<br/>
<br/>
What am i doing wrong?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#156796 - sniper - Tue May 13, 2008 11:55 pm</h4>
    <div class="postbody"><span class="postbody">try to put the method as <span style="text-decoration: underline">inline</span> in the header file and not in the cpp file.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">inline template &lt;class T&gt; bool FIFO&lt;T&gt;::empty(void)
<br/>
{
<br/>
// ...
<br/>
} </td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#156799 - Maxxie - Wed May 14, 2008 12:06 am</h4>
    <div class="postbody"><span class="postbody">:edit::edit:
<br/>
Nope, sorry no go.
<br/>
<br/>
I can define them in the class body, then the error goes away, but that undermines the purpose of having multiple sourcefiles to only compile parts that changed (any change in a function body would cause recompilation of all files including the header) ... well it propably needs too :/
<br/>
<br/>
Defining them as "inline template", they are not passing the syntax checker.
<br/>
Defining them as template &lt;class T&gt; inline does not solve anything</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#156802 - sniper - Wed May 14, 2008 12:36 am</h4>
    <div class="postbody"><span class="postbody">Oh sorry my fault. This should solve the problem??
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">template &lt;class T&gt; inline bool FIFO&lt;T&gt;::empty(void)
<br/>
{
<br/>
// ...
<br/>
} </td> </tr></table><span class="postbody">
<br/>
<br/>
Templates are better macros and if u use it all methods must be defined in the header file.
<br/>
<br/>
If you want define it in the source file you have to define all possible types:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
bool FIFO&lt;int&gt;::empty(void)
<br/>
{
<br/>
// ...
<br/>
}
<br/>
<br/>
bool FIFO&lt;char&gt;::empty(void)
<br/>
{
<br/>
// ...
<br/>
}  </td> </tr></table><span class="postbody">
<br/>
<br/>
Edit:
<br/>
<br/>
GCC has not implemented the "export" for templates which is defined in the C++ standard.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">export template &lt;class T&gt; bool FIFO&lt;T&gt;::empty(void)
<br/>
{
<br/>
// ...
<br/>
} </td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#156804 - Maxxie - Wed May 14, 2008 12:50 am</h4>
    <div class="postbody"><span class="postbody">Yes, thank you very much.
<br/>
<br/>
I should have thought earlier about that the templates implementation needs to be transparent to the including sources ...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#156848 - sajiimori - Wed May 14, 2008 6:49 pm</h4>
    <div class="postbody"><span class="postbody">Note that while the implementations have to be visible (i.e. in the header or similar) for automatic instantiation to work (i.e. to fix your link error), you don't actually have to inline all the methods.  You can remove the 'inline' keyword and the linker will strip out duplicate copies of uninlined methods.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
