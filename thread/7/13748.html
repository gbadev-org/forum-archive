<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Help with arrays - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>C/C++ > Help with arrays</h2>
<div id="posts">
<div class="post">
    <h4>#135404 - Takaishi_Takeru - Mon Jul 23, 2007 4:24 am</h4>
    <div class="postbody"><span class="postbody">Hi. 
<br/>
<br/>
I want to know if its possible to store a string into an array.
<br/>
(This is for NDS dev, im trying to read a file line by line, and store each line into the array.....)
<br/>
<br/>
Like this one:
<br/>
circle(0,649,CR1_Sprite,AROR_Sprite,112,48);
<br/>
<br/>
And then i need to execute the code in the array...
<br/>
<br/>
Its possible, or is there a better way to store (200-300) lines like that one, and then execute them?
<br/>
<br/>
Thanks. =3</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135412 - sgeos - Mon Jul 23, 2007 5:33 am</h4>
    <div class="postbody"><span class="postbody">Precompiling is genarally better.  How you do it depends on your scripts.  You could use an array of structs and do something like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">struct a
<br/>
{
<br/>
   void (*f)(int a, int b, int c, int d);
<br/>
   int a;
<br/>
   int b;
<br/>
   int c;
<br/>
   int d;
<br/>
} a;
<br/>
<br/>
void run(struct a pStruct)
<br/>
{
<br/>
   // load from struct for clarity
<br/>
   void (*f)(int a, int b, int c, int d) = pStruct-&gt;f;
<br/>
   int a = pStruct-&gt;a;
<br/>
   int b = pStruct-&gt;b;
<br/>
   int c = pStruct-&gt;c;
<br/>
   int d = pStruct-&gt;d;
<br/>
<br/>
   // execute
<br/>
   f(a,b,c,d);
<br/>
}
<br/>
<br/>
void run_many(struct a *pList)
<br/>
{
<br/>
   int i;
<br/>
<br/>
   for (i = 0; NULL != pList[i]-&gt;f; i++)
<br/>
      run( &amp;(pList[i]) );
<br/>
}
<br/>
<br/>
// data looks like this
<br/>
// you need functions that act
<br/>
draw(int a, int b, int c, int d) { /* do something */ };
<br/>
line(int a, int b, int c, int d) { /* do something */ };
<br/>
fill(int a, int b, int c, int d) { /* do something */ };
<br/>
<br/>
// and a "script" held in an array
<br/>
// use something like perl to convert a text file script into an array
<br/>
struct a list[] =
<br/>
{
<br/>
   {draw,1,2,SOLID,0},
<br/>
   {line,7,7,DOTS, 4},
<br/>
   {fill,5,1,RED,  1},
<br/>
   {NULL,0,0,0,0}
<br/>
};
<br/>
<br/>
// run it like this
<br/>
run_many(list);</td> </tr></table><span class="postbody">
<br/>
This code is untested, so there is probably a minor error that will prevent it from compiling.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135504 - Takaishi_Takeru - Tue Jul 24, 2007 12:25 am</h4>
    <div class="postbody"><span class="postbody">Thanks sgeos, but is there a way yo do this without precompiling?
<br/>
Or can i read a line from the text file and then execute it? (without ussing arrays)...or somethin like that?
<br/>
<br/>
Thanks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135506 - calcprogrammer1 - Tue Jul 24, 2007 1:03 am</h4>
    <div class="postbody"><span class="postbody">I'm looking at the same sort of thing.  I want to make a file browser, but I'd like to be able to store the names of each file and directory to an array, which would be used to generate the GUI.  Is there a better way to do this, or can I use an array of strings?<br/>_________________<br/>DS Firmware 1, Datel Games n' Music card / Chism's FW hacked GBA MP v2 CF
<br/>
<br/>
There's no place like 127.0.0.1.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135520 - sajiimori - Tue Jul 24, 2007 4:36 am</h4>
    <div class="postbody"><span class="postbody">Takaishi-san,
<br/>
<br/>
A program that executes source code (in a particular language) is called an <span style="font-style: italic">interpreter</span> for that language.  If you are wanting to execute C source code without compiling it, you must write a C interpreter.  However, this is unusual because C is not very appropriate as an interpreted language, although many scripting languages resemble C superficially.
<br/>
<br/>
Typical interpreters almost always translate the source code into a more compact form before starting to execute it, even if the translation step is immediately followed by execution (rather than being done much earlier).  Separating the translation and execution steps tends to simplify the interpreter program.
<br/>
<br/>
If you can perform the translation step during the build process, that would eliminate the need for your ROM to contain a translator.  You only need a translator in the ROM if the program will be dealing with unknown source code, e.g. code entered by the user.
<br/>
<br/>
Have you ever written a text adventure?  If so, you've written an interpreter: The user enters a command, then your program interprets it and executes some action.  The only difference between a text adventure and what you're describing is where the source code is coming from: the keyboard versus a text file.
<br/>
<br/>
And if you've never written a text adventure, try it out on your PC.  In fact, prototype everything on your PC before doing it on a handheld system -- it's much easier to work with.
<br/>
<br/>
<br/>
calcprogrammer1, storing lists of filenames as an array of strings sounds good.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135523 - calcprogrammer1 - Tue Jul 24, 2007 5:01 am</h4>
    <div class="postbody"><span class="postbody">It sounded good, I made an array of structs instead, so that I could store the names and stats, but I have a compiling issue, check my post in the DS Development forum if you could...<br/>_________________<br/>DS Firmware 1, Datel Games n' Music card / Chism's FW hacked GBA MP v2 CF
<br/>
<br/>
There's no place like 127.0.0.1.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135524 - Takaishi_Takeru - Tue Jul 24, 2007 5:04 am</h4>
    <div class="postbody"><span class="postbody">mm, the code on the text is declared on the compiled code, the text have only the call to the object.
<br/>
<br/>
The code is entered by the user, but it wont be anything else but that object.
<br/>
<br/>
But maybe i could read the data form the file, and  the compiled code puts the data on the object?
<br/>
<br/>
Thanks for your replay =3</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135533 - sgeos - Tue Jul 24, 2007 7:30 am</h4>
    <div class="postbody"><span class="postbody">You should split things that stay the same from user input.
<br/>
It is quite possible to collect user input using precompiled scripts.
<br/>
All you have to do is change internal state variables.  (Note that these may be pointers.)
<br/>
Even random (numbers) can be thrown into your scripts- just change an internal variable to some random value.
<br/>
<br/>
To use the same array of structs format:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">// prototypes
<br/>
void getColor(void);
<br/>
void draw(void);
<br/>
<br/>
// script
<br/>
struct command_item list
<br/>
{
<br/>
   {getUserColor},
<br/>
   {draw},
<br/>
   {NULL}
<br/>
};
<br/>
<br/>
// module variables
<br/>
int mMyColor;
<br/>
<br/>
// functions
<br/>
int getColor(void)
<br/>
{
<br/>
   return mMyColor;
<br/>
}
<br/>
<br/>
void setColor(int pMyColor)
<br/>
{
<br/>
   mMyColor = pMyColor;
<br/>
}
<br/>
<br/>
void getUserColor(void)
<br/>
{
<br/>
   if ( press(A) )
<br/>
      setColor(RED);
<br/>
   else if ( press(B) )
<br/>
      setColor(GREEN);
<br/>
   else
<br/>
      setColor(BLUE);
<br/>
}
<br/>
<br/>
void draw(void)
<br/>
{
<br/>
   switch ( getColor() )
<br/>
   {
<br/>
      case RED:
<br/>
         drawRed();
<br/>
      case GREEN:
<br/>
         drawGreen();
<br/>
      case BLUE:
<br/>
         drawBlue();
<br/>
      default:
<br/>
         drawWhite();
<br/>
   }
<br/>
}</td> </tr></table><span class="postbody">
<br/>
What are you trying to do?
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135556 - Takaishi_Takeru - Tue Jul 24, 2007 3:54 pm</h4>
    <div class="postbody"><span class="postbody">I just need to execute the code which is readed from the text file. 
<br/>
<br/>
The code on the text have the same format, and the user will change that file.
<br/>
<br/>
The text file have like 400 lines like this one:
<br/>
circle(0,649,CR1_Sprite,AROR_Sprite,112,48); 
<br/>
<br/>
but maybe to read it on the code i could use something like:
<br/>
c, 0, 649, cr1_sprite, aror_sprite, 112, 48;
<br/>
<br/>
.....using fseek( ?), serching for "," to separate each part.
<br/>
<br/>
But im not sure how to use fseek. Or how to make the code to decide how to separate each part of the text file on each variable on the code...
<br/>
<br/>
Thanks again.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135570 - sajiimori - Tue Jul 24, 2007 6:43 pm</h4>
    <div class="postbody"><span class="postbody">If the code has a complex format (with many symbols, like in C), your interpreter will be more complex, but maybe it will be easier for the user to write code.
<br/>
<br/>
Try using the simple comma-separated syntax first, because it's easier for you to interpret.  Later you can get more complex.
<br/>
<br/>
As I said earlier, you should write the code for your PC first, before doing anything on GBA or DS.  Try implementing this function, and use it to write the rest of your program:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
// This reads a token from a file and stores it in a char array.
<br/>
// Use fgetc to read from the source, and stop when you see a comma.
<br/>
// Each time you call this function, it will read the next token.
<br/>
// The function returns 1 if if successful, or 0 for fail (like end-of-file).
<br/>
int readToken(FILE* source, char* dest, int maxLength);
<br/>
</td> </tr></table><span class="postbody">
<br/>
Edit: Here's an example of using it.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define MAX_TOKEN_LENGTH 64
<br/>
<br/>
void test()
<br/>
{
<br/>
  int result;
<br/>
  FILE* source = fopen(...);
<br/>
  char token[MAX_TOKEN_LENGTH];
<br/>
<br/>
  result = readToken(source, token, MAX_TOKEN_LENGTH);
<br/>
<br/>
  if(result == 0)
<br/>
  {
<br/>
    printf("First token not found.\n");
<br/>
    return;
<br/>
  }
<br/>
<br/>
  printf("The first token was %s.\n", token);
<br/>
<br/>
  result = readToken(source, token, MAX_TOKEN_LENGTH);
<br/>
<br/>
  if(result == 0)
<br/>
  {
<br/>
    printf("Second token not found.\n");
<br/>
    return;
<br/>
  }
<br/>
<br/>
  printf("The second token was %s.\n", token);
<br/>
<br/>
  fclose(source);
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
