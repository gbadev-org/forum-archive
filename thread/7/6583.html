<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Hit test in C problems - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>C/C++ > Hit test in C problems</h2>
<div id="posts">
<div class="post">
    <h4>#50956 - THI - Sun Aug 14, 2005 9:46 pm</h4>
    <div class="postbody"><span class="postbody">Hi, i downloaded and installed devkitadv and a simple game( with source code), tank. I did a few conversions to make it a kind of side scroller. 
<br/>
<br/>
Heres my compiled game <a class="postlink" href="http://gbadcdev.emuscene.com/FF/tank.gba" target="_blank">http://gbadcdev.emuscene.com/FF/tank.gba</a>.
<br/>
<br/>
Heres the problems
<br/>
<br/>
*Hit test is only working sometimes.
<br/>
*Can get damaged when some bombs are in proximity,not actual hit
<br/>
<br/>
*sometimes bombs spawn in the middle of the screen
<br/>
*sometimes bombs dont 'turn off' at x coordinate reaching 0
<br/>
<br/>
I feel that the last 2 problems are causing the first two...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">// bomb movement and collision dectection and life removal
<br/>
         for(loop = 0; loop &lt; NUM_BOMBS; loop++)
<br/>
         {
<br/>
            // if off then random to turn it on
<br/>
            if (bombs[loop] == 0) 
<br/>
            {
<br/>
               rnum = RAND(10);
<br/>
               if (rnum == 4) 
<br/>
               {
<br/>
                  bombs[loop] = 1; // turn it on               
<br/>
                  bomby[loop] = RAND((180-objbomb_HEIGHT)/2);
<br/>
                  bombx[loop] = 240;
<br/>
               }
<br/>
            }
<br/>
            
<br/>
            // move the bombs
<br/>
            if (bombs[loop] == 1) 
<br/>
            {
<br/>
            // Changed to scroll bombs left 
<br/>
               bombx[loop] -= 1; // its on so move it
<br/>
            
<br/>
               // its on, so check for collision
<br/>
               
<br/>
               if (bombx[loop] == tankx)               
<br/>
               {
<br/>
                  if ( (  ( bombx[loop]+(objbomb_WIDTH/2))  &gt; tankx) &amp;&amp;
<br/>
                  (bombx[loop] &lt; (tankx+objtank_WIDTH/2))) 
<br/>
                  {
<br/>
                     // collision
<br/>
                     life -= 2;
<br/>
                     bombs[loop] = 0;
<br/>
                  }
<br/>
               }   
<br/>
               if (bombx[loop] &lt;= 10)
<br/>
               bombs[loop] = 0;
<br/>
            }
<br/>
            
<br/>
         } // end for bombs</td> </tr></table><span class="postbody">
<br/>
<br/>
thanks for any input, i have tried changing alot of things, every change i do to any factors seems to break the hit test.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#50962 - sajiimori - Sun Aug 14, 2005 10:23 pm</h4>
    <div class="postbody"><span class="postbody">First of all, if you've got a boolean and two integers per bomb, then define a bomb struct like this:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">struct Bomb
<br/>
{
<br/>
  bool alive;
<br/>
  int x, y;
<br/>
};
<br/>
<br/>
Bomb bombs[NUM_BOMBS];</td> </tr></table><span class="postbody">Also, your random number test can look like this:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">if(!RAND(10)) ...</td> </tr></table><span class="postbody">And since you'd then just have two nested if statements, it could be flattened to this:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">if(!bombs[loop].alive &amp;&amp; !RAND(10)) ...</td> </tr></table><span class="postbody">As for the bugs, you're establishing that the x coordinates of the bomb and the tank are equal, and then doing further tests on the x coordinate and doing nothing with the y.
<br/>
<br/>
The collision test can also be reduced to a single 'if', and it should really be a function like:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">bool bombCollidesWithTank(Bomb*);
<br/>
<br/>
if(bombCollidesWithTank(&amp;bombs[loop])) ...</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#50971 - THI - Sun Aug 14, 2005 11:35 pm</h4>
    <div class="postbody"><span class="postbody">ok, when i get the collision working, ill put it into a function..
<br/>
<br/>
but i try to simplify it like this...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">if (bombs[loop] == 1) 
<br/>
            {
<br/>
            // Changed to scroll bombs left 
<br/>
               bombx[loop] -= 1; // its on so move it
<br/>
            
<br/>
               // its on, so check for collision
<br/>
               
<br/>
               if (bombx[loop] == tankx)               
<br/>
               {
<br/>
               
<br/>
               
<br/>
                  if ((bombx[loop] == tankx) &amp;&amp; (bomby[loop] == tanky))
<br/>
                     {
<br/>
                     // collision
<br/>
                     life -= 2;
<br/>
                     bombs[loop] = 0;
<br/>
                  }
<br/>
               }   
<br/>
               if (bombx[loop] &lt;= 10)
<br/>
               bombs[loop] = 0;
<br/>
            }</td> </tr></table><span class="postbody">
<br/>
<br/>
And the hit test does not register at all.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#50974 - sajiimori - Sun Aug 14, 2005 11:47 pm</h4>
    <div class="postbody"><span class="postbody">Well, you're still checking the x twice, but there's no harm in that I suppose.  Otherwise, keep in mind that the two objects have to have the exact same coordinates in order to collide.  If your objects are not single pixels, they'll often pass through each other.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#50979 - THI - Mon Aug 15, 2005 12:14 am</h4>
    <div class="postbody"><span class="postbody">yeah,i just left that second x check in their because without it it still produces the same result.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">if (bombs[loop] == 1) 
<br/>
            {
<br/>
            // Changed to scroll bombs left 
<br/>
               bombx[loop] -= 1; // its on so move it
<br/>
            
<br/>
               // its on, so check for collision
<br/>
               if ((bombx[loop] == tankx) &amp;&amp; (bomby[loop] == tanky))
<br/>
                    {
<br/>
                     // collision
<br/>
                     life -= 2;
<br/>
                     bombs[loop] = 0;
<br/>
               } 
<br/>
             
<br/>
               if (bombx[loop] &lt;= 10)
<br/>
               bombs[loop] = 0;
<br/>
            }</td> </tr></table><span class="postbody">
<br/>
<br/>
would i just need to add some simple numbers to make it bounding box? 
<br/>
(like if (bombx = tankx +50) ?)
<br/>
<br/>
Height and width arent defined for the bomb, but are defined for the tank (objtank_WIDTH,objtank_HEIGHT)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#50983 - sajiimori - Mon Aug 15, 2005 12:49 am</h4>
    <div class="postbody"><span class="postbody">No, adding values to the coordinates will just move them around, but they're still points.  This is what you're looking for:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">struct Rect
<br/>
{
<br/>
  int x, y, width, height;
<br/>
};
<br/>
<br/>
// Implementation left as an exercise.
<br/>
bool rectsCollide(Rect*, Rect*);</td> </tr></table><span class="postbody">Give the bombs and the tank rectangles and check if they collide.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
