<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>rotating sprites - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>C/C++ > rotating sprites</h2>
<div id="posts">
<div class="post">
    <h4>#7063 - johnny_north - Sat Jun 07, 2003 5:53 pm</h4>
    <div class="postbody"><span class="postbody">I can't figure this one. When I set the rotation flag on my sprites, the entire sprite cells turn into one solid color. Anyone know what I'm doing wrong?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7065 - Touchstone - Sat Jun 07, 2003 6:44 pm</h4>
    <div class="postbody"><span class="postbody">Are the scale coefficient values correct? 1:1 scaling/rotation should be
<br/>
pa = 0x0100
<br/>
pb = 0x0000
<br/>
pc = 0x0000
<br/>
pd = 0x0100<br/>_________________<br/>You can't beat our meat</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7072 - johnny_north - Sun Jun 08, 2003 12:31 am</h4>
    <div class="postbody"><span class="postbody">Thanks for that tip. Last time I used rot/scale I didn't need to initialize the ro/scale parms. I should know better.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7099 - Lupin - Mon Jun 09, 2003 3:17 pm</h4>
    <div class="postbody"><span class="postbody">Do the rotation values and the Sprite mem change same memory area? This would mean that I have to be carefull to not overwrite sprite memory with my rotation flags :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9481 - johnny_north - Wed Aug 06, 2003 12:18 am</h4>
    <div class="postbody"><span class="postbody">OK, this was working fine last project, but I'm stuck with the scaling sprite problem again. Here's what I've done:
<br/>
<br/>
Initialixe the rot/scale members:
<br/>
<br/>
for(loop = 0; loop &lt; 32; loop++)
<br/>
	{
<br/>
		rotData[loop].pa = 0x0100;//pa; //put them in my data struct
<br/>
        rotData[loop].pb = 0x0000;//pb;
<br/>
        rotData[loop].pc = 0x0000;//pc;
<br/>
        rotData[loop].pd = 0x0100;//pd;
<br/>
	}
<br/>
<br/>
Now if I call this function:
<br/>
void SpriteObj::RotateSprite(int rotDataIndex, int angle, FIXED x_scale,FIXED y_scale)
<br/>
{
<br/>
        FIXED pa,pb,pc,pd;
<br/>
<br/>
        pa = ((x_scale) * COS[angle])&gt;&gt;8; //(do my fixed point multiplies and shift back down)
<br/>
        pb = ((y_scale) * SIN[angle])&gt;&gt;8;
<br/>
        pc = ((x_scale) * -SIN[angle])&gt;&gt;8;
<br/>
        pd = ((y_scale) * COS[angle])&gt;&gt;8;
<br/>
<br/>
        rotData[rotDataIndex].pa = pa; //put them in my data struct
<br/>
        rotData[rotDataIndex].pb = pb;
<br/>
        rotData[rotDataIndex].pc = pc;
<br/>
        rotData[rotDataIndex].pd = pd;
<br/>
}
<br/>
<br/>
Like this:
<br/>
<br/>
sprite-&gt;RotateSprite(0, 0, 1&lt;&lt;8, 1&lt;&lt;8);
<br/>
<br/>
All my 16x16 sprites with rot index 0 turn to solid color square (I suspect they are all scaled very large.
<br/>
<br/>
If I do this:
<br/>
sprite-&gt;RotateSprite(0, 0, scale, scale);
<br/>
<br/>
and increment the scale by one, I get sprites that alternate between different scale sizes and solid boxes without an apparent pattern.
<br/>
<br/>
What gives.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9482 - hnager - Wed Aug 06, 2003 1:24 am</h4>
    <div class="postbody"><span class="postbody">By any chance are you forgetting the following:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
sprites[loop].attribute1 = SIZE_16 | ROTDATA(loop); </td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9483 - johnny_north - Wed Aug 06, 2003 1:43 am</h4>
    <div class="postbody"><span class="postbody">I'm not actually taking this approach. I want all of the sprites that are supposed to scale to use the same rot/scale parameters (index 0). Thanks for the suggestion though.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9484 - hnager - Wed Aug 06, 2003 3:09 am</h4>
    <div class="postbody"><span class="postbody">ah - I forgot the ROTDATA() once and I was getting odd results - not all of hte sprites were doing the same thing, but a bunch were in sync...have you tried:
<br/>
<br/>
sprites[loop].attribute1 = SIZE_16 | <span style="font-weight: bold">ROTDATA(0);</span>
<br/>
<br/>
?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9485 - johnny_north - Wed Aug 06, 2003 3:19 am</h4>
    <div class="postbody"><span class="postbody">I wrapped up some of Dovoto's code into a sprite class:
<br/>
<br/>
u8 SpriteObj::CreateSprite(void* src, u16 size, u16 shape, u8 mode, bool mosaic, 
<br/>
						   bool hflip, bool vflip, u8 prio, bool dblSize, bool trans, 
<br/>
						   bool rotate, u8 rodatinx, u16 x, u16 y){
<br/>
<br/>
	u16 byteCount;
<br/>
	u8 sprnum;
<br/>
<br/>
	switch (size){
<br/>
	case SIZE_8:
<br/>
		switch (shape){
<br/>
		case SQUARE:
<br/>
			byteCount = 64;
<br/>
			break;
<br/>
		case TALL:
<br/>
		case WIDE:
<br/>
			byteCount = 128;
<br/>
			break;
<br/>
		default:
<br/>
			while(1){}
<br/>
		}
<br/>
		break;
<br/>
	case SIZE_16:
<br/>
		switch (shape){
<br/>
		case SQUARE:
<br/>
			byteCount = 256;
<br/>
			break;
<br/>
		case TALL:
<br/>
		case WIDE:
<br/>
			byteCount = 256;
<br/>
			break;
<br/>
		default:
<br/>
			while(1){}
<br/>
		}
<br/>
		break;
<br/>
	case SIZE_32:
<br/>
		switch (shape){
<br/>
		case SQUARE:
<br/>
			byteCount = 1024;
<br/>
			break;
<br/>
		case TALL:
<br/>
		case WIDE:
<br/>
			byteCount = 512;
<br/>
			break;
<br/>
		default:
<br/>
			while(1){}
<br/>
		}
<br/>
		break;
<br/>
	case SIZE_64:
<br/>
		switch (shape){
<br/>
		case SQUARE:
<br/>
			byteCount = 4096;
<br/>
			break;
<br/>
		case TALL:
<br/>
		case WIDE:
<br/>
			byteCount = 2048;
<br/>
			break;
<br/>
		default:
<br/>
			while(1){}
<br/>
		}
<br/>
		break;
<br/>
	}
<br/>
<br/>
<br/>
<br/>
	sprites[spriteNum].attribute0 = (COLOR_256|(trans*MODE_TRANSPERANT)|(dblSize*SIZE_DOUBLE)|(rotate*ROTATION_FLAG)|shape|y);
<br/>
	sprites[spriteNum].attribute1 = ((BIT13*vflip)|(BIT12*hflip)|ROTDATA(rodatinx)|size|x);
<br/>
	sprites[spriteNum].attribute2 = charNum;
<br/>
<br/>
	memcpy(&amp;CharMem[charNum*32], (u8*)src, byteCount);
<br/>
	charNum += ((byteCount/64)*2);
<br/>
	attributes[spriteNum].spriteBytes = byteCount;
<br/>
	sprnum = spriteNum;
<br/>
	spriteNum++;
<br/>
<br/>
	return sprnum;
<br/>
}</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9555 - Mr. GBA - Fri Aug 08, 2003 1:45 pm</h4>
    <div class="postbody"><span class="postbody">johnny_north, I've tried your code in my sprite program and it works well if I right shift your a values by 8.<br/>_________________<br/>my dev/business site:
<br/>
<br/>
<a href="http://codebytesdev.afraid.org" target="_blank">http://codebytesdev.afraid.org</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9645 - johnny_north - Tue Aug 12, 2003 3:48 am</h4>
    <div class="postbody"><span class="postbody">Hmm. Which values are you shifting? Do you mean that rot/scale is working?</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
