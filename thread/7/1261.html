<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Calling the bios in pure c - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>C/C++ > Calling the bios in pure c</h2>
<div id="posts">
<div class="post">
    <h4>#6247 - Maverick - Tue May 20, 2003 10:23 pm</h4>
    <div class="postbody"><span class="postbody">It is described everywhere how to run a bios function using ASM
<br/>
<br/>
This is easy but i am wondering if anyone knows how to or wether it is possible to do it in pure c.
<br/>
<br/>
I know you can call the function using thumb etc.
<br/>
<br/>
I am not brilliant at ASM so can not really "translate" a function from any ASM examples.
<br/>
<br/>
Sorry if this is an inconvenience to anyone and many thanks for the help!
<br/>
<br/>
<br/>
Maverick</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6250 - Daedro - Tue May 20, 2003 11:54 pm</h4>
    <div class="postbody"><span class="postbody">I also am sorry for any inconvenience to anyone as I would be asking this question soon too.
<br/>
<br/>
Daedro</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6257 - sgeos - Wed May 21, 2003 3:41 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Maverick wrote:</b></span></td> </tr> <tr> <td class="quote">It is described everywhere how to run a bios function using ASM
<br/>
<br/>
This is easy but i am wondering if anyone knows how to or wether it is possible to do it in pure c.</td> </tr></table><span class="postbody">
<br/>
<br/>
See my recent rotation/scaling demo for an example of using a bios SWI in C code.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Maverick wrote:</b></span></td> </tr> <tr> <td class="quote">I know you can call the function using thumb etc.</td> </tr></table><span class="postbody">
<br/>
<br/>
Use "SWI 0xnn" in thumb and "SWI 0xnn0000" in ARM, where nn is SWI number in hex.  I've only tested the ARM version.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6270 - sgeos - Wed May 21, 2003 7:50 am</h4>
    <div class="postbody"><span class="postbody">There might be a better way of doing this, but here is an example with a return value:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">unsigned short swi_atan(signed short x, signed short y)
<br/>
{
<br/>
  unsigned long result;
<br/>
<br/>
  asm volatile
<br/>
  (
<br/>
    "mov r0,%1\nmov r1,%2\nswi 0x0A0000\nmov %0,r0\n" :
<br/>
    "=r" (result) :  /* result is set to %0, the return value */
<br/>
    "r" (x), "r" (y) :  /* %1 set to x, %2 to y */
<br/>
    "r0", "r1" /* registers destroyed */
<br/>
  );
<br/>
  return result;
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
Here is the ASM in an easier to read format:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">mov r0,%1
<br/>
mov r1,%2
<br/>
swi 0x0A0000
<br/>
mov %0,r0</td> </tr></table><span class="postbody">
<br/>
<br/>
The compiler will pick registers for %0, %1, and %2.  We are using r0 and r1 explicitly, so we need to tell the compiler about that, so we tell the compiler that we are destroying the value of those registers.  I'm not going to go into any more detail now, but I'll do my best to answer any questions people might have.
<br/>
<br/>
This stuff is documented at:
<br/>
<a class="postlink" href="http://www.gnu.org/software/gcc/onlinedocs/" target="_blank">http://www.gnu.org/software/gcc/onlinedocs/</a>
<br/>
See extensions to the C language, "Assembler Instructions with C Expression Operands " for your version of gcc.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6275 - Maverick - Wed May 21, 2003 10:37 am</h4>
    <div class="postbody"><span class="postbody">Im sorry, i may have worded the question wrong
<br/>
<br/>
I already know how to do this. It is easy
<br/>
<br/>
But is it possible to do it in PURE C as in NO ASM.
<br/>
<br/>
Many thanks for all answers so far!
<br/>
<br/>
<br/>
<br/>
Maverick</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6290 - sgeos - Wed May 21, 2003 6:53 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Maverick wrote:</b></span></td> </tr> <tr> <td class="quote">Im sorry, i may have worded the question wrong
<br/>
<br/>
I already know how to do this. It is easy
<br/>
<br/>
But is it possible to do it in PURE C as in NO ASM.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
It is not possible without making the compiler aware of these 'optimizations'.  Somebody would have to add some gba specific information for the compiler to take into accout, and you would not be able to access the bios functions directly.  The bios functions are pretty much an ASM thing as far as I can tell.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6385 - Jason Wilkins - Fri May 23, 2003 10:23 pm</h4>
    <div class="postbody"><span class="postbody">The simple answer is no, you cannot use standard ANSI C to call the bios.
<br/>
<br/>
You must use assembly language.  For a novice, it would be good to find a library which implements the bios calls as functions which can be called from C.
<br/>
<br/>
Does anyone know of such a simple library?<br/>_________________<br/><a href="http://devkitadv.sourceforge.net" target="_blank">http://devkitadv.sourceforge.net</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6387 - darkcloud - Fri May 23, 2003 10:41 pm</h4>
    <div class="postbody"><span class="postbody">If you search around, you can find a few functions but I haven't seen any type of library.  
<br/>
<br/>
Someone should make one ;).<br/>_________________<br/>Maybe in order to understand mankind, we have to look at the word itself: "Mankind". Basically, it's made up of two separate words - "mank" and "ind". What do these words mean ? It's a mystery, and that's why so is mankind.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6388 - sgeos - Fri May 23, 2003 10:56 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>darkcloud wrote:</b></span></td> </tr> <tr> <td class="quote">Someone should make one ;).</td> </tr></table><span class="postbody">
<br/>
<br/>
Did you just volunteer?  Otherwise I could make one.  I think the bios functions are fun =)
<br/>
<br/>
I don't have any application for many of them, which could be a problem.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6389 - darkcloud - Fri May 23, 2003 11:01 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sgeos wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>darkcloud wrote:</b></span></td> </tr> <tr> <td class="quote">Someone should make one ;).</td> </tr></table><span class="postbody">
<br/>
<br/>
Did you just volunteer? </span></td> </tr></table><span class="postbody">
<br/>
<br/>
No no lol.  I'm not very good with ASM.  Although it would probably be a good learning experience.<br/>_________________<br/>Maybe in order to understand mankind, we have to look at the word itself: "Mankind". Basically, it's made up of two separate words - "mank" and "ind". What do these words mean ? It's a mystery, and that's why so is mankind.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6392 - sgeos - Sat May 24, 2003 12:35 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>darkcloud wrote:</b></span></td> </tr> <tr> <td class="quote">No no lol.  I'm not very good with ASM.  Although it would probably be a good learning experience.</td> </tr></table><span class="postbody">
<br/>
<br/>
I'm not convinced that I'm very good at ASM.  I'm also unconvinced that setting up C wrapper functions for the SWI calls is very difficult.  Well... I'll give it a go.  Worst case scenario I'll only finish part of the library.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6399 - Maverick - Sat May 24, 2003 10:16 am</h4>
    <div class="postbody"><span class="postbody">Thats ok, thanks for the help, i already know the bios in asm it is very simple even a novice could do it in their sleep.
<br/>
<br/>
It was meerely something i was wondering.
<br/>
<br/>
Thanks
<br/>
<br/>
<br/>
Maverick</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6844 - joris-fr - Tue Jun 03, 2003 12:25 pm</h4>
    <div class="postbody"><span class="postbody">What does SWI stand for ?
<br/>
SoftWare Interrupt ?<br/>_________________<br/>Joris</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6849 - MojoJojo - Tue Jun 03, 2003 1:22 pm</h4>
    <div class="postbody"><span class="postbody">Yes. Or it did on the BBC, but I haven't actually really looked at much assembler since then, but I would be surprised if its changed.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6945 - Darkain - Wed Jun 04, 2003 10:43 pm</h4>
    <div class="postbody"><span class="postbody">i dunno... but wouldnt it help if the C/C++ wrapper functions to the bios calls be inlined functions?  this way to help w/ speed a little bit.  when looking through all of the tutorials ive seen, i see very little, if not none at all that use inline for small simple functions like these.<br/>_________________<br/>-=- Darkain Dragoon -=-
<br/>
<a class="postlink" href="http://www.darkain.com" target="_blank">http://www.darkain.com</a>
<br/>
<a class="postlink" href="http://ds.darkain.com/hack" target="_blank">DarkStar</a> for <a class="postlink" href="http://ds.darkain.com" target="_blank">Nintendo DS</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
