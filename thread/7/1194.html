<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Odd Collision Detection Problem - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>C/C++ > Odd Collision Detection Problem</h2>
<div id="posts">
<div class="post">
    <h4>#5859 - Dae - Sun May 11, 2003 12:16 am</h4>
    <div class="postbody"><span class="postbody">I've been debugging this code for awhile now and I can't figure out what is wrong. It is supposed to handle collision detection and move the player around on the screen but for some reason it just sets the player at (0,0) and then stops them from moving. However when in uncomment those three lines or use local variables instead of the guy struct it will work fine. Im using DevKit Advance R5 if that makes any difference.
<br/>
I compile it like this: </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">gcc -o main.elf main.c bios.s libgbfs.c ..\..\vba.s -mthumb-interwork -mthumb -O3</td> </tr></table><span class="postbody">
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void GetInput(void)
<br/>
{
<br/>
   s16 newx, newy;
<br/>
<br/>
   newx = guy-&gt;mapX;
<br/>
   newy = guy-&gt;mapY;
<br/>
<br/>
//char str[256];
<br/>
//sprintf(str, "mapX: %d, mapY: %d, newx: %d, newy: %d\n", guy-&gt;mapX, guy-&gt;mapY, newx, newy);
<br/>
//vbalog(str);
<br/>
<br/>
   if(renIsKeyPressed(KEY_UP))
<br/>
      newy = guy-&gt;mapY - 1;
<br/>
<br/>
   if(renIsKeyPressed(KEY_DOWN))
<br/>
      newy = guy-&gt;mapY + 1;
<br/>
<br/>
   if(renIsKeyPressed(KEY_LEFT))
<br/>
      newx = guy-&gt;mapX - 1;
<br/>
<br/>
   if(renIsKeyPressed(KEY_RIGHT))
<br/>
      newx = guy-&gt;mapX + 1;
<br/>
<br/>
   if((guy-&gt;mapX != newx) &amp;&amp; TestCase(newx, guy-&gt;mapY))
<br/>
      guy-&gt;mapX = newx;
<br/>
<br/>
   if((guy-&gt;mapY != newy) &amp;&amp; TestCase(guy-&gt;mapX, newy))
<br/>
      guy-&gt;mapY = newy;
<br/>
<br/>
   guy-&gt;x = guy-&gt;mapX;
<br/>
   guy-&gt;y = guy-&gt;mapY;
<br/>
<br/>
   renUpdateSprite(guy); // update mirrored OAM from rensprite struct
<br/>
}
<br/>
<br/>
boolean TestCase(s16 xPos, s16 yPos)
<br/>
{
<br/>
return (backgrounds[0].cmap[((yPos + 4) / 8) * 32 + (xPos / 8)]==0) &amp;&amp; 
<br/>
(backgrounds[0].cmap[((yPos + 4) / 8) * 32 + ((xPos + 15) / 8)]==0) &amp;&amp;
<br/>
(backgrounds[0].cmap[((yPos + 15) / 8) * 32 + (xPos / 8)]==0) &amp;&amp;
<br/>
(backgrounds[0].cmap[((yPos + 15) / 8) * 32 + ((xPos + 15) / 8)]==0);
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
Setup code and game loop:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   guy-&gt;mapX = 110;
<br/>
   guy-&gt;mapY = 110;
<br/>
   
<br/>
   guy-&gt;x = guy-&gt;mapX;
<br/>
   guy-&gt;y = guy-&gt;mapY;
<br/>
   renUpdateSprite(guy);
<br/>
   renCopyOAM();
<br/>
<br/>
   while(gameRunning)
<br/>
   {
<br/>
      GetInput();
<br/>
      renWaitForVSync();
<br/>
      renCopyOAM();
<br/>
   }
<br/>
<br/>
   return 0;</td> </tr></table><span class="postbody">
<br/>
and in case you are wondering about the guy variable:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">typedef struct _RENSPRITE
<br/>
{
<br/>
   s16 x;
<br/>
   s16 y;
<br/>
   s16 mapX;
<br/>
   s16 mapY;
<br/>
   u8 OAMIndex;
<br/>
} RENSPRITE, *LPRENSPRITE;</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#5866 - Dae - Sun May 11, 2003 6:08 am</h4>
    <div class="postbody"><span class="postbody">Ahh, never mind. I think I got it. I don't know what I did exactly but it works fine now. It's amazing what the effects of added caffeine to the blood stream and loud music can do. :D</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
