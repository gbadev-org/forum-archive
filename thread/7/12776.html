<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Changing an object's movement vector - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>C/C++ > Changing an object's movement vector</h2>
<div id="posts">
<div class="post">
    <h4>#122580 - Rajveer - Tue Mar 20, 2007 2:09 pm</h4>
    <div class="postbody"><span class="postbody">Hi guys. I have a racing "ship" which has a few forces acting on it,a nd I want to know if my logic in calculating the final direction/speed of the ship is correct:
<br/>
<br/>
Forces:
<br/>
Ship's thrust vector: We'll call this the thrust vector, or thrust velocity when not normalised. Direction is the same as the ship's z-axis.
<br/>
Ship's speed: Speed at a given time, which I'll increase by a constant acceleration or decrease when no thrust, in the direction of the thrust vector.
<br/>
<br/>
Gravity vector: Simply (0, -1, 0) as it always acts downwards on a large scale.
<br/>
Gravity speed: The speed at a given time of the ship in the -ve y-axis caused by the acceleration of gravity (only when no collision with the ground in my case).
<br/>
<br/>
Final vector: Final direction for the ship to move.
<br/>
Final speed: Magnitude of the final vector before normalisation.
<br/>
<br/>
I'm thinking of breaking down the calculations as such:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
----------------------------
<br/>
-Left/Right held:
<br/>
*Rotate ship left/right
<br/>
<br/>
-A held:
<br/>
*Increase ship thrust speed i.e. ship accelerates along ship's z-axis
<br/>
-A NOT held:
<br/>
*Decrease ship thrust speed
<br/>
-Limit ship speed:
<br/>
*Cannot exceed maximum speed, cannot go below 0
<br/>
<br/>
-Combine Ship's thrust vector and speed with finalvector and final speed (from previous frame):
<br/>
*Q: Would I combine the ship's non-normalised thrust vector (so magnitude = thrust speed) with the ship's non-normalised final vector (from the previous frame)?? If I do, every frame I'll be accelerating the ship with a constant force as I'll keep increasing the final vector's magnitude, so instead do I combine the ship's non-normalised thrust vector with the ship's NORMALISED final vector??? And then calculate the final speed from this?? (I.e. magnitude of the final vector)
<br/>
<br/>
-Check Collision:
<br/>
*Check collision between polygons and line from ship's current position and future position
<br/>
*If intersection, move ship just infront of polygon so it doesn't pass through it
<br/>
IF Check Collision is false, move ship all the way from current position to future position
<br/>
<br/>
-Check Ground Collision:
<br/>
*Fire ray from bottom of ship to polygons, check if intersects
<br/>
*If it does intersect and is within certain distance, rotate ship to matrix alignment of the ground (then next frame, the final vector will tend toward this rotation), apply friction i.e. final speed * 0.9f?
<br/>
*If not, apply gravity: increase "gravity speed" by gravitational acceleration, add to move vector. Again same question: would I add the non-normalised gravity vector to the non-normalised final vector??
<br/>
----------------------------</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122586 - Rajveer - Tue Mar 20, 2007 3:32 pm</h4>
    <div class="postbody"><span class="postbody">I think I've answered my own questions. I SHOULD add the unnormalised final vector that the ship is moving in from the last frame to the unnormalised thrust vector that is applied during the current frame, and the magnitude of the final vector for the current frame after the additions (i.e. the speed) should keep increasing, BUT the friction should limit this speed with something like "drag(v) = kv^2" where v is the speed, to get a terminal velocity. Is this right?
<br/>
<br/>
If it is, in which order should I be doing all of this? At the moment I'm adding the thrust vector, checking for a collision between polygons and the line from the current position and the future position defined by the new final vector, checking if the ship is on the ground THEN adding friction if it is...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122617 - Ant6n - Tue Mar 20, 2007 9:03 pm</h4>
    <div class="postbody"><span class="postbody">Well the physics for a simple model kind of goes like this:
<br/>
we know F_total = m*a, with m the mass and a the acceleration
<br/>
and we know F = F_gravity + F_'thrust' + F_friction + F_lift
<br/>
F_gravity, F_thrust should be obvious, or one could cook up a simple model, F_lift is mostly relevant for airplane type objects. F_friction in a useful approximation could be written like
<br/>
F_friction = - a*v^2 - b*v.
<br/>
a is the fluid, b the viscious drag. Depending on the speed of the object and the sorrounding elements one of the two components is usually negligible. v In this case the unit vector of the volocity (not absolute, but relative to movement of environment, i.e. take wind into account).
<br/>
If you plug this into the above equation, you get some relation ship on a and v. Since a is the first time derivative of v, and you have three components, you get a system of differential equations. I think in most simple games the solution is not used, instead people use a numerical approximation. That is, one stores the position and velocity, and calculates the new force using the current velocity (and position, if required) and thrust. The new force gives the acceleration. this acceleration is added on top of the velocity (be carefule with the time!), and that new velocity is added onto the position.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122618 - keldon - Tue Mar 20, 2007 9:07 pm</h4>
    <div class="postbody"><span class="postbody">Objects have a velocity vector. The velocity determines the speed and direction that the object travels. The velocity is altered by acceleration, so gravity acts like a constant acceleration down.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122660 - poslundc - Wed Mar 21, 2007 1:09 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Rajveer wrote:</b></span></td> </tr> <tr> <td class="quote">Gravity vector: Simply (0, -1, 0) as it always acts downwards on a large scale.
<br/>
Gravity speed: The speed at a given time of the ship in the -ve y-axis caused by the acceleration of gravity (only when no collision with the ground in my case).
<br/>
<br/>
Final vector: Final direction for the ship to move.
<br/>
Final speed: Magnitude of the final vector before normalisation.</td> </tr></table><span class="postbody">
<br/>
<br/>
I find it confusing that you have an implied expectation that Cartesian vectors are normalized.
<br/>
<br/>
Vectors express both direction and magnitude, but you are using them to express direction only, which is misleading. (It can be a valid performance optimization, but optimization should come last, and if you have a reason to cache a normalized direction vector then you'll want to call it out as such for that purpose.)
<br/>
<br/>
So, I would use either Cartesian vectors exclusively, or spherical coordinates (magnitude plus direction in terms of pitch and yaw) to store your forces, and calculate one from the other when necessary. (Or cache one from the other when necessary, but only expose one at a time rather than combining them as you currently do.)
<br/>
<br/>
Between those two, I'd recommend sticking with Cartesian vectors most of the time and calculating things like magnitude when you need them. With Cartesian vectors you can easily add a bunch of forces, velocities or positions together to obtain the resultant force/velocity/position.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
