<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>C Preprocessor- is this portable? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>C/C++ > C Preprocessor- is this portable?</h2>
<div id="posts">
<div class="post">
    <h4>#105270 - sgeos - Sat Oct 07, 2006 5:27 am</h4>
    <div class="postbody"><span class="postbody">Input:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include "macro.h"
<br/>
#define PATH ../
<br/>
#define FILE dummy.file
<br/>
MACRO_LINK(PATH,FILE)</td> </tr></table><span class="postbody">
<br/>
Desired output:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">"../dummy.file"</td> </tr></table><span class="postbody">
<br/>
Unacceptable output:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">"../""dummy.file"</td> </tr></table><span class="postbody">
<br/>
macro.h
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#ifndef MACRO_H
<br/>
#define MACRO_H
<br/>
<br/>
#define MACRO_FORWARD(MACRO_string)      MACRO_string
<br/>
#define MACRO_SQUOTE(MACRO_string)      #MACRO_string
<br/>
#define MACRO_QUOTE(MACRO_string)      MACRO_SQUOTE(MACRO_string)
<br/>
#define MACRO_LINK(MACRO_path,MACRO_link)   MACRO_QUOTE(MACRO_FORWARD(MACRO_path)MACRO_FORWARD(MACRO_link))
<br/>
<br/>
#endif // MACRO_H</td> </tr></table><span class="postbody">
<br/>
This works.  Is it portable?
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#105272 - poslundc - Sat Oct 07, 2006 5:34 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sgeos wrote:</b></span></td> </tr> <tr> <td class="quote">This works.  Is it portable?</td> </tr></table><span class="postbody">
<br/>
<br/>
Better question: are you <span style="font-style: italic">insane</span>? O_o
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#105286 - sgeos - Sat Oct 07, 2006 10:56 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">Better question: are you <span style="font-style: italic">insane</span>? O_o</td> </tr></table><span class="postbody">
<br/>
The problem domain is atypical.  The C preprocessor's stringize and token paste features necessarily require dummy macros to use.  This makes them confusing to work with.
<br/>
<br/>
Is there a better way to meet the above specification using the C preprocessor?  I'd really like to know.  The interface is MACRO_LINK(A,B).
<br/>
<br/>
MACRO_LINK(a,b) gives me
<br/>
"ab"
<br/>
MACRO_FORWARD(a)MACRO_FORWARD(b) gives
<br/>
a b
<br/>
note the space.  The space can be removed using token paste instead.
<br/>
<br/>
I'm not fond of this solution, but it works.  Here and now at least.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#105309 - gmiller - Sat Oct 07, 2006 4:22 pm</h4>
    <div class="postbody"><span class="postbody">The features you are using are part of the standard and should be portable.  There are a number of things that work in C that are understandable but not always obvious.
<br/>
<br/>
two quoted strings one after the other will be concatenated by the compiler to a singe quoted string in the preprocessor.  I use this:
<br/>
<br/>
#define VERSION_NUMBER_STRING "1.0.4.2"
<br/>
<br/>
char version[] = "program name "VERSION_NUMBER_STRING
<br/>
<br/>
Using the macro expansion stuff I have debug that is:
<br/>
#define printDebug(a) cout &lt;&lt;#a" = "&lt;&lt;a
<br/>
<br/>
The extra space is not something I have seen but I generally have not used it in the fashion you are.  I have a number of different compilers so I will check to see how they react.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#105319 - poslundc - Sat Oct 07, 2006 6:02 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sgeos wrote:</b></span></td> </tr> <tr> <td class="quote">The problem domain is atypical.  The C preprocessor's stringize and token paste features necessarily require dummy macros to use.  This makes them confusing to work with.
<br/>
<br/>
Is there a better way to meet the above specification using the C preprocessor?  I'd really like to know.  The interface is MACRO_LINK(A,B).
<br/>
<br/>
MACRO_LINK(a,b) gives me
<br/>
"ab"
<br/>
MACRO_FORWARD(a)MACRO_FORWARD(b) gives
<br/>
a b
<br/>
note the space.  The space can be removed using token paste instead.
<br/>
<br/>
I'm not fond of this solution, but it works.  Here and now at least.</td> </tr></table><span class="postbody">
<br/>
<br/>
I don't know that I could easily create an alternative solution... I've used some of the fancier macro token features before but never anything that convoluted.
<br/>
<br/>
Could what you're ultimately trying to <span style="font-style: italic">accomplish</span> perhaps be better achieved through configuration through makefile options?
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#105357 - sgeos - Sun Oct 08, 2006 3:01 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>gmiller wrote:</b></span></td> </tr> <tr> <td class="quote">two quoted strings one after the other will be concatenated by the compiler to a singe quoted string in the preprocessor.</td> </tr></table><span class="postbody">
<br/>
The output from the preprocessor never gets to meet the compiler.  It gets to meet web browsers, printers and yet more conversion tools instead.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>gmiller wrote:</b></span></td> </tr> <tr> <td class="quote">The features you are using are part of the standard and should be portable.</td> </tr></table><span class="postbody">
<br/>
Excellent.  So long as extra spaces don't pop up, I'm happy.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>gmiller wrote:</b></span></td> </tr> <tr> <td class="quote">The extra space is not something I have seen but I generally have not used it in the fashion you are. I have a number of different compilers so I will check to see how they react.</td> </tr></table><span class="postbody">
<br/>
That would be fantastic.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">Could what you're ultimately trying to <span style="font-style: italic">accomplish</span> perhaps be better achieved through configuration through makefile options?</td> </tr></table><span class="postbody">
<br/>
I doubt it.  If I'm going to bother externalizing anything, if possible, I'd rather put that information a spreadsheet that in the makefile.  Some information is already being supplied by the makefile.
<br/>
<br/>
I'm converting template XHTML pages to real XHTML pages.  In this case, one of the templates is used to generate many (regularly formatted) pages.  This could probably be better accomplished with a different tool.  I don't know what that tool is- nor do I have time to learn how to use it right now.  This solution does work, afterall.  Next project... =)  If anyone knows, I'd still love to know what the tool for the job is.  Maybe PHP?  Right now I'm using C, the C preprocessor, make and perl.
<br/>
<br/>
This is basically what I'm doing:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">// macro.h - macro library
<br/>
#define MACRO_FORWARD(MACRO_string)      MACRO_string
<br/>
#define MACRO_SQUOTE(MACRO_string)      #MACRO_string
<br/>
#define MACRO_QUOTE(MACRO_string)      MACRO_SQUOTE(MACRO_string)
<br/>
#define MACRO_SCAT(MACRO_a,MACRO_b)      MACRO_a##MACRO_b
<br/>
#define MACRO_CAT(MACRO_a,MACRO_b)      MACRO_SCAT(MACRO_a,MACRO_b)
<br/>
#define MACRO_LINK5(a,b,c,d,e)   \
<br/>
   MACRO_QUOTE(MACRO_FORWARD(a)MACRO_FORWARD(b)MACRO_FORWARD(c)MACRO_FORWARD(d)MACRO_FORWARD(e))
<br/>
<br/>
// def.h - strings autogenerated from a spreadsheet (English Build)
<br/>
#define TXT_TITLE Bunch O'Links</td> </tr></table><span class="postbody">
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">&lt;h1&gt;TXT_TITLE&lt;/h1&gt;
<br/>
&lt;ul&gt;
<br/>
   &lt;li&gt;&lt;a href=MACRO_LINK5(../../../folder/subfolder/,TXT_BASE,suffix/prefix,TXT_CARDBASE,00.file)&gt;MACRO_CAT(TXT_BASE,00)&lt;/a&gt;&lt;/li&gt;
<br/>
   &lt;li&gt;&lt;a href=MACRO_LINK5(../../../folder/subfolder/,TXT_BASE,suffix/prefix,TXT_CARDBASE,01.file)&gt;MACRO_CAT(TXT_BASE,01)&lt;/a&gt;&lt;/li&gt;
<br/>
   &lt;li&gt;&lt;a href=MACRO_LINK5(../../../folder/subfolder/,TXT_BASE,suffix/prefix,TXT_CARDBASE,02.file)&gt;MACRO_CAT(TXT_BASE,02)&lt;/a&gt;&lt;/li&gt;
<br/>
   ...
<br/>
   &lt;li&gt;&lt;a href=MACRO_LINK5(../../../folder/subfolder/,TXT_BASE,suffix/prefix,TXT_CARDBASE,09.file)&gt;MACRO_CAT(TXT_BASE,09)&lt;/a&gt;&lt;/li&gt;
<br/>
&lt;/ul&gt;
<br/>
...
<br/>
&lt;ul&gt;
<br/>
   &lt;li&gt;&lt;a href=MACRO_LINK5(../../../folder/subfolder/,TXT_BASE,suffix/prefix,TXT_CARDBASE,90.file)&gt;MACRO_CAT(TXT_BASE,90)&lt;/a&gt;&lt;/li&gt;
<br/>
   ...
<br/>
   &lt;li&gt;&lt;a href=MACRO_LINK5(../../../folder/subfolder/,TXT_BASE,suffix/prefix,TXT_CARDBASE,99.file)&gt;MACRO_CAT(TXT_BASE,99)&lt;/a&gt;&lt;/li&gt;
<br/>
&lt;/ul&gt;</td> </tr></table><span class="postbody">
<br/>
And the output is:
<br/>
gcc -E -x c -P -C -DTXT_BASE=00 template.html &gt; output/00suffix.html
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">&lt;h1&gt;Bunch O'Links&lt;/h1&gt;
<br/>
&lt;ul&gt;
<br/>
   &lt;li&gt;&lt;a href="../../../folder/subfolder/00suffix/prefix0000.file"&gt;0000&lt;/a&gt;&lt;/li&gt;
<br/>
   &lt;li&gt;&lt;a href="../../../folder/subfolder/00suffix/prefix0001.file"&gt;0001&lt;/a&gt;&lt;/li&gt;
<br/>
   &lt;li&gt;&lt;a href="../../../folder/subfolder/00suffix/prefix0002.file"&gt;0002&lt;/a&gt;&lt;/li&gt;
<br/>
...</td> </tr></table><span class="postbody">
<br/>
gcc -E -x c -P -C -DTXT_BASE=27 template.html &gt; output/27suffix.html
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">&lt;h1&gt;Bunch O'Links&lt;/h1&gt;
<br/>
&lt;ul&gt;
<br/>
   &lt;li&gt;&lt;a href="../../../folder/subfolder/27suffix/prefix2700.file"&gt;2700&lt;/a&gt;&lt;/li&gt;
<br/>
...</td> </tr></table><span class="postbody">
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#105371 - poslundc - Sun Oct 08, 2006 6:44 am</h4>
    <div class="postbody"><span class="postbody">I would definitely consider using a scripting language in the future rather than shoehorning the preprocessor into doing this kind of thing for you. If I understand it correctly (which I'm far from certain of) all you're looking to do is automate a search-and-replace on certain dictionary tokens in the file, with multiple sets of values you want to instantiate in.
<br/>
<br/>
I used to do most of my utilitarian scripting in PHP, which I like because of its huge libraries, easy documentation, and that it runs in a web browser (making interface elements easy to add via forms).
<br/>
<br/>
Lately I've switched more to using Python, which doesn't have as many libraries as PHP and isn't innately a web-oriented scripting language, but is far, far more elegant and makes it easier for me to both read my own code and reuse it down the road (part of the reason I'm not fond of PERL).
<br/>
<br/>
Both languages have incredibly poweful set-types, PHP with its associative arrays, and Python with its lists and dictionaries. And they both have really convenient string-manipulation functions. Once you start working with those kinds of things you'll wonder how you ever got by without them. Doing something like what you describe above, iterating over multiple sets of data, instantiating them into the template, and writing the results out to separate files, would be a cinch in either one using those tools.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#107803 - gmiller - Thu Nov 02, 2006 4:36 am</h4>
    <div class="postbody"><span class="postbody">I checked the VS 2005/2003 compiler and the Sun compiler and saw no issues in the basic testing.  Of course the GCC compilers seemed to be happy as well on a number of platforms.  I also tried some older obsolete version and got some strange results (tubo C++, for example) that seemed to work but not all of the results were exact.  I was just using the posted examples so it was not a very extensive test.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#107821 - sgeos - Thu Nov 02, 2006 10:45 am</h4>
    <div class="postbody"><span class="postbody">Thanks for doing the tests.
<br/>
<br/>
This approach appears to be "basically" portable.  If I ever end up using a strange compiler that breaks things, I'll figure out a workaround then.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#107838 - Dwedit - Thu Nov 02, 2006 2:32 pm</h4>
    <div class="postbody"><span class="postbody">I thought most compilers would combine strings, so "../" "foo" would be identical to "../foo".<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#107858 - tepples - Thu Nov 02, 2006 5:14 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dwedit wrote:</b></span></td> </tr> <tr> <td class="quote">I thought most compilers would combine strings, so "../" "foo" would be identical to "../foo".</td> </tr></table><span class="postbody">
<br/>
Right, but then it's the C compiler combining the strings, not the preprocessor.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
