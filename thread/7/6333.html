<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Problem using sizeof() - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>C/C++ > Problem using sizeof()</h2>
<div id="posts">
<div class="post">
    <h4>#48173 - jmva16 - Sun Jul 17, 2005 10:35 pm</h4>
    <div class="postbody"><span class="postbody">I have an odd thing happening with the compiler.  I have defined a structure as such:
<br/>
typedef struct
<br/>
{
<br/>
    short x,y,rot,ability,tags;
<br/>
}  myobject;
<br/>
<br/>
When I do sizeof(myobject) it returns 12.  I should be 10 as each short is 2 bytes and I defined 5 of them.  I do not know why is is adding the additional 2 bytes.  I would like the actual size because I am using it to load external data (off the cart) and after I get the first data out and increment my pointer by sizeof(myobject), the data is misaligned.  Any thoughts?
<br/>
Thank you</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#48183 - tepples - Mon Jul 18, 2005 12:25 am</h4>
    <div class="postbody"><span class="postbody">Perhaps GCC rounds struct sizes up to the nearest multiple of sizeof(int) because of the target architecture's own addressing requirements. If you can't change the program that generates external data, look in the GCC manual or other documentation for an <a class="postlink" href="http://www.ohse.de/uwe/articles/gcc-attributes.html#type-packed" target="_blank">attribute that specifies packing</a>.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#48186 - Lord Graga - Mon Jul 18, 2005 12:44 am</h4>
    <div class="postbody"><span class="postbody">sizeof() should return the pricise size of a stuct, I am sure, not rounded. It sounds strange, but try this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">typedef struct
<br/>
{
<br/>
   short x;
<br/>
   short y;
<br/>
   short rot;
<br/>
   short ability;
<br/>
   short tags;
<br/>
} myobject;</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#48191 - MrAdults - Mon Jul 18, 2005 3:02 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">sizeof() should return the pricise size of a stuct, I am sure, not rounded. It sounds strange, but try this:</td> </tr></table><span class="postbody">
<br/>
<br/>
tepples is correct, struct data is 4-byte aligned by default, and sizeof returns the actual struct size as opposed to the size of the members you have defined. This is not a requirement for the architecture, but I would recommend allowing it where possible for performance (access) reasons. You can use the packed attribute, or just make sure your data is aligned yourself, e.g.:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
typedef struct
<br/>
{
<br/>
   short x;
<br/>
   short y;
<br/>
   short rot;
<br/>
   short ability;
<br/>
   short tags;
<br/>
   short padding;
<br/>
} myobject;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
-Rich</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#48306 - jmva16 - Mon Jul 18, 2005 11:09 pm</h4>
    <div class="postbody"><span class="postbody">Thank you for the replies.  tepples must be right, I have some other structures of varying sizes that I am handling the same way.  One has two shorts, therefore a size of 4, and it works fine.  Another has 4 shorts and therefore a size of 12, and it works fine.  I have another of size 34 and sizeof() returns 36.  I have no control over the external data, so for now I have hard coded the sizes in (crappy code practice), but I will look into the attributes tepples mentioned.  If I come up with anything I will post the solution.
<br/>
Thanks again!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#48339 - dafer - Tue Jul 19, 2005 10:36 am</h4>
    <div class="postbody"><span class="postbody">I have a related question.
<br/>
<br/>
I have a Oam class that is allocated in oam memory but I wonder if I can be sure that the variables of the class acctually is laid out as it is in the class. When I compile it it does work but can I be sure it allways does?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
class Oam{
<br/>
public:
<br/>
   uint16 attribute0;
<br/>
   uint16 attribute1;
<br/>
   uint16 attribute2;
<br/>
private:
<br/>
   uint16 rotData;
<br/>
};
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/>/As meningful to you as words written in water.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#48382 - sajiimori - Tue Jul 19, 2005 6:24 pm</h4>
    <div class="postbody"><span class="postbody">OAM is only relevant on GBA/DS and compilers for those platforms are unlikely to align structs to more than 4 bytes.  If you ever run into a problem, you could always use the packed attribute.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#48969 - cooky - Sun Jul 24, 2005 10:34 pm</h4>
    <div class="postbody"><span class="postbody">Simply it always returns the actual size because if you say had a function that took a void* as its data then the person wanted to access that as an array of singular bytes, for example, but still accesses the areas as he/she would do using an array then the size of must be the true and correct size of the data else you would get the wrong position in the array.
<br/>
Example
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void func(void* arr)
<br/>
{
<br/>
    //accessing 5th member
<br/>
    *(((u8)arr)+size_of(struc)*5);
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
It is however not ussually nessesary as you could just type cast it as the struct and use the [] operator to effectively make this code.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void func(void* arr)
<br/>
{
<br/>
    //accessing 5th member
<br/>
    ((struc)arr)[5];
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
Untested ofcourse
<br/>
<br/>
Anyway please keep questions about C and C++ in the correct section; [the DS development forum] is the section for DS development specifically
<br/>
<br/>
<span style="font-style: italic">Moved. You're welcome. -- mod</span></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
