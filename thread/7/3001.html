<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>problems with making a game full of mini-games - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>C/C++ > problems with making a game full of mini-games</h2>
<div id="posts">
<div class="post">
    <h4>#17382 - darknet - Sun Mar 07, 2004 3:31 am</h4>
    <div class="postbody"><span class="postbody">I have, as usual, scanned the forums + misc docs and found questions similar to the one I am about to ask but none that quite answer my dilemma, so here goes:
<br/>
<br/>
<br/>
My project consists of a number of mini-games and one main driver program. As of right now, theres only one mini-game and there is a major problem with a well-known linker error.
<br/>
<br/>
My drawMode3Background function is declared in "video.h" as such, in pseudocode:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
extern void drawMode3Background(unsigned short*, const unsigned short*);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
It is DEFINED in video.c as follows:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include "video.h"
<br/>
<br/>
  void drawMode3Background(unsigned short* d, const unsigned short* s) { .......implementation......; }
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Now, i use that function in my mini game .cpp file (textAdventure.cpp) AND in my main driver file (main.cpp) for various reasons. The error i'm getting is that in the textAdventure.o file there are "multiple definitions" of the drawMode3Bitmap function.
<br/>
<br/>
How can this be resolved? I need that function both in my mini-game and my driver. Right now for it to work i have basically shoved all of the text adventure code directly into the main driver and that works fine obviously, but also displays poor form.
<br/>
<br/>
I have properly included #ifndef -&gt; #endif in my video.h file, and i include "video.h"  both in the driver and in the text adventure file. Modifying the project to not include it in one place and in another had no effect.  I have also messed with not making the function extern (since it is inherently is right?) and making it extern, as displayed above.
<br/>
<br/>
Any help is greatly appreciated, thanks alot for your time,
<br/>
-Mike</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17385 - poslundc - Sun Mar 07, 2004 4:12 am</h4>
    <div class="postbody"><span class="postbody">First of all, you're right that you don't need the extern keyword for function prototypes. It's a good idea to take it out since declaring a function and then declaring an extern prototype to it in the same file could very well cause multiple definitions. Although if you've tried removing it then I suppose that isn't causing the problem, but best to take it out anyway.
<br/>
<br/>
Second of all, this is probably just a misspelling, but I notice that you say that there are multiple definitions of drawMode3<span style="font-weight: bold">Bitmap</span>, not Background. Do you have a separate function that goes by this name that might be causing the problem?
<br/>
<br/>
Third: I know you say you use #ifndef -&gt; #endif, but have you set it up to properly prevent multiple inclusion? eg.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#ifndef _VIDEO_HEADER_
<br/>
#define _VIDEO_HEADER_
<br/>
<br/>
... contents of the header file ...
<br/>
<br/>
#endif</td> </tr></table><span class="postbody">
<br/>
<br/>
Other than that, everything you've done seems kosher, so if you still can't figure it out try posting more code.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17391 - darknet - Sun Mar 07, 2004 6:47 am</h4>
    <div class="postbody"><span class="postbody">Thanks for the quick output Dan.
<br/>
<br/>
I did set up the ifndefs and everything correctly. I mistyped in my message about the drawMode3Bitmap/Background. Here is a little more info that hopefully puts up a red flag:
<br/>
<br/>
-I am compiling/linking/building with VisualHAM
<br/>
-I am mixing c files with c++ files. In particular, the c files are the headers and their respective .c implementations, whereas the main driver is a c++ file. This is done because I use object orientation for a few of my games that I will have.
<br/>
<br/>
 Here is a tiny bit of my actual code if that will help anybody.
<br/>
<br/>
MAIN.CPP:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
//general hardware includes
<br/>
#include "sprite.h"
<br/>
#include "timer.h"
<br/>
#include "dma.h"
<br/>
#include "interrupt.h"
<br/>
#include "buttons.h"
<br/>
#include "video.h"
<br/>
<br/>
.......
<br/>
<br/>
.......
<br/>
<br/>
int main() {
<br/>
<br/>
   setMode(MODE_3 | BG2_ENABLE);
<br/>
<br/>
   drawMode3Background(videoBuffer, firstDay_Bitmap);
<br/>
.... }
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
that function call is declared and implemented in the header file (since it wont work if i put it in a .c file!!!) as such:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
void drawMode3Background(unsigned short* destination, const unsigned short* source) {
<br/>
<br/>
   int i;
<br/>
   for(i = 0; i&lt;38400; i++) {
<br/>
      destination[i] = source[i];
<br/>
   }
<br/>
}
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
If any other code would be helpful and anyone is willing to give it a few minutes, let me know.
<br/>
<br/>
Thanks alot for reading,
<br/>
-Mike</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17394 - DarkPhantom - Sun Mar 07, 2004 8:41 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>darknet wrote:</b></span></td> </tr> <tr> <td class="quote">that function call is declared and implemented in the header file (since it wont work if i put it in a .c file!!!)</td> </tr></table><span class="postbody">
<br/>
<br/>
If we were programming DOS or Windows with a borland or microsoft compiler I would tell you that your problem is definately that you are putting the implementation in the header file. I'm not nearly as experienced as with GCC and the like as I am with Turbo C++ and Visual C++ but I'm pretty sure this is where the problem is.
<br/>
<br/>
I was explaining this same problem the people in class with me the other day. You see, basically when you include a header file, the compiler copy and pastes the contents of the header file into the c or cpp file before it tries to compile anything. As a result, if you put actual code in a header file, that code will appear in the object file of every source file compiled with that header included. So, you really are having multipul definitions of the function -- the linker isn't mistaken. The best way to fix this is to move the code to a its own source file. 
<br/>
<br/>
I was paying attention. I know you said you were having trouble with getting it to work in its own source file. I can honestly say I can't see how. It should work fine even if you are mixing c with c++ and even with assembly. My suggestion is to move the code back to it's own source file and post the problem that you having with that. I'm sure that we'll beable to help you figure out what problem you are having with it.
<br/>
<br/>
On a related note, the #ifndef that Dan mentioned won't help here as long as you are defining code in the header file. Don't get me wrong, #ifndef is an excellent practice that I use all the time. The problem here is that the #define will only live so long as the compiler is running and is lost when it exits. When you build a program, the compiler is invoked once for each source file (assuming that each source file needs to be built). All that the #ifndef ensures is that the information in the header won't be included twice in the same object file (or .s file in the case of GCC). Since that define doesn't carry over between building one.c and two.c it won't stop the compiler from putting the same code in both files. In general, I think that writing any code in header files should be avoided like the plague.
<br/>
<br/>
On an unrelated note, I love mini games! Do you have demo of what you've built so far?<br/>_________________<br/>"head straight for your goal by any means
<br/>
there is a door that you've never opened
<br/>
there is a window with a view you've never seen
<br/>
get there no matter how long it takes"
<br/>
<br/>
-Theme of Shadow, Sonic Adventure 2</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17406 - Paul Shirley - Sun Mar 07, 2004 2:43 pm</h4>
    <div class="postbody"><span class="postbody">removed</span><span class="gensmall"><br/><br/>Last edited by Paul Shirley on Sun Mar 28, 2004 9:02 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#17413 - poslundc - Sun Mar 07, 2004 4:10 pm</h4>
    <div class="postbody"><span class="postbody">I will echo this sentiment. <span style="font-style: italic">Never, ever</span> put executable code in a header file. That includes functions AND variable definitions.
<br/>
<br/>
Limit yourself to structures/typedefs, #defines and #includes, <span style="font-weight: bold">extern</span> variable references and function prototypes. Inlined functions are probably okay as well, I suppose.
<br/>
<br/>
Put your function in a separate .c file, and just put the prototype in the .h file. I don't know anything about VisualHAM so I can't tell you how to fix your compile problem, but I can tell you that this is what's causing your current problem. Go fix it. :)
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17429 - darknet - Sun Mar 07, 2004 11:25 pm</h4>
    <div class="postbody"><span class="postbody">That "extern C" tip eventually made everything kosher, thanks a whole bunch.
<br/>
<br/>
Funny thing was though, it only worked when I compiled the files in a certain order (by tweaking my makefile) --so far so good though.
<br/>
<br/>
Thanks once again, its a relief to see my project properly structured !
<br/>
<br/>
-Mike</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17434 - Paul Shirley - Mon Mar 08, 2004 2:39 am</h4>
    <div class="postbody"><span class="postbody">removed</span><span class="gensmall"><br/><br/>Last edited by Paul Shirley on Sun Mar 28, 2004 9:02 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#17475 - darknet - Tue Mar 09, 2004 2:31 am</h4>
    <div class="postbody"><span class="postbody">The IDE i am using, VisualHAM, generates its own makefile, and upon further inspection, everything does work out regardless of the order of things.
<br/>
<br/>
The project is defined as a c++ project and uses some C headers / source files, hence the earlier confusion + errors.
<br/>
<br/>
Thanks again,
<br/>
-Mike</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
