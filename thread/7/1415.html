<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Newbie C question... Typecasting the video buffer? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>C/C++ > Newbie C question... Typecasting the video buffer?</h2>
<div id="posts">
<div class="post">
    <h4>#7085 - bitshifter - Mon Jun 09, 2003 5:50 am</h4>
    <div class="postbody"><span class="postbody">Hi all, I know C, albeit not very well... I've been reading tutorials and messing around, I understand pretty much everything except this:
<br/>
<br/>
<span style="color: green">u16</span>* testingMem = (<span style="color: green">u16</span>*)<span style="color: red">0x5000000</span>; (ripped from dovoto's tutorial!)
<br/>
<br/>
Why exactly are we typecasting the memory address into an unsigned short? And what does this afford us? I've scoured google for tutorials on using memory addresses and what we can do with them and found very little... Obviously we can't just fiddle with a memory address as it is, but I still dont understand how this works... 
<br/>
<br/>
If this is explained elsewhere throw me a link! Thanks!!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7088 - tom - Mon Jun 09, 2003 10:24 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>bitshifter wrote:</b></span></td> </tr> <tr> <td class="quote"><span style="color: green">u16</span>* testingMem = (<span style="color: green">u16</span>*)<span style="color: red">0x5000000</span>; (ripped from dovoto's tutorial!)
<br/>
<br/>
Why exactly are we typecasting the memory address into an unsigned short? And what does this afford us?</td> </tr></table><span class="postbody">
<br/>
<br/>
you're not casting the address in an unsigned short, you're casting it into a *pointer to unsigned short*.
<br/>
<br/>
for the compiler, your address (the number you marked red) is simply an integer. if you were doing something like this:
<br/>
<br/>
u16* testingMem = 0x5000000;
<br/>
<br/>
gcc would spit out a warning message:
<br/>
"warning: initialization makes pointer from integer without a cast"
<br/>
with the cast you tell the compiler to shut up because you think you know what you're doing =)
<br/>
<br/>
now that testingMem holds the address of the video ram, you can access vram like this:
<br/>
<br/>
*testingMem = 0x7fff;
<br/>
<br/>
this will plot a white pixel in the upper left corner on the screen (assuming you're in mode 3)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7094 - niltsair - Mon Jun 09, 2003 2:11 pm</h4>
    <div class="postbody"><span class="postbody">Abd by casting it in a certain type, that tells the compiler how we want to access the memory. u16 means that when we read/write to this location, we read 16bits(unsigned short). 
<br/>
<br/>
If we were to do this : testingMem[10]
<br/>
then the compiler would know it's location 0x5000000 + (10*2) since a u16 takes 2 bytes. Same if we did a : testingMem++; 
<br/>
<br/>
The pointer would get increased by 2 (0x5000000 + 2)
<br/>
<br/>
If we had casted it to a u32, then we woudl read/write 4bytes at a time, and the address woudl increase by 4 bytes.
<br/>
<br/>
Last detail, why 16bits and not 8? In mode 3 it makes sens (since 1 pixel = 16bits, but in other mode it make less, when a pixel takes 8bits, but the hardware limit us to 16bits access when reading/writing video memory.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7110 - bitshifter - Mon Jun 09, 2003 8:36 pm</h4>
    <div class="postbody"><span class="postbody">Well that certainly clears up a lot. Thank you very much niltsair and tom!
<br/>
<br/>
But I am still fuzzy on understanding memory addresses. I know that the <span style="color: red">0x5000000</span> is in hex, and each 5 or 0 or whatever it happens to be represents a byte (four bits, 1 or 0), correct? 
<br/>
<br/>
So the <span style="color: red">0x5000000</span> is actually 0101 0000 0000 0000 0000 0000 0000, right? What is actually going on when we place a pixel value in <span style="color: green">videoBuffer</span>? And how does altering a value for the <span style="color: green">videoBuffer</span> at <span style="color: red">0x5000000 </span>differ from using the palette at <span style="color: red">0x4000000</span> (or whatever it is :)) where only one bit has changed? I understand hex-binary conversions easily, but how it all corresponds to memory values is difficult to understand at first....
<br/>
<br/>
Thanks again fellas, you've been a great help!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7113 - niltsair - Mon Jun 09, 2003 9:12 pm</h4>
    <div class="postbody"><span class="postbody"><span style="font-weight: bold">0x123456</span>
<br/>
1,2,3,4,5,6 are half Byte(4bits)
<br/>
12,34,56 are 1Byte(8bits)
<br/>
<br/>
<span style="font-weight: bold">0x01</span> = 1(decimal)
<br/>
<span style="font-weight: bold">0x10</span> = 16(decimal)
<br/>
<span style="font-weight: bold">0x100</span> = 256(decimal)
<br/>
<span style="font-weight: bold">0x1000</span> = 4096(decimal)
<br/>
...
<br/>
<br/>
So <span style="font-weight: bold">0x5000000</span> means that you're accessing address :
<br/>
0x05*(16777216) + 0x00*(65536) + 0x00*(256) + 0x00*(1) = 83,886,080
<br/>
<br/>
<span style="font-weight: bold">0x4000000</span> means that you're accessing address :
<br/>
67,108,864
<br/>
<br/>
So, when you're doing this : ((u16*)0x5000000) = RGB(15,15,22); you're saying that you want to store a value at the memory address 0x5000000 or 83,886,080 in decimal.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7114 - bitshifter - Mon Jun 09, 2003 9:32 pm</h4>
    <div class="postbody"><span class="postbody">thank you very very <span style="font-weight: bold">very</span> much, I searched the internet for hours looking for that, and it was summed up so easily by you. I really appreciate it!!! Thanks again!!!</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
