<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Linking problem with DevKitAdv - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>C/C++ > Linking problem with DevKitAdv</h2>
<div id="posts">
<div class="post">
    <h4>#13259 - MumblyJoe - Wed Dec 10, 2003 2:10 am</h4>
    <div class="postbody"><span class="postbody">OK, I am trying to link in some music to a game I am writing, but I am having trouble.
<br/>
<br/>
I have a:
<br/>
.cpp file that has a long array of data - the music.
<br/>
.h file that has an extern declaration of that array.
<br/>
.cpp file which is the game and includes the above .h file.
<br/>
<br/>
I compiled the .cpp file with the music in it using g++, no errors.
<br/>
I compile the game with g++ .cpp file, no errors.
<br/>
I link the two together with g++, and the array cannot be found.
<br/>
<br/>
I have tried using extern "C" for both to stop name mangling, and the nm tool which comes with devkitadv says that 'heyladies' (my array name) is the name in the music .o file, and says that my game .o file has an extern variable of the same name, but somehow the linker is freaking out and not doing what I want.
<br/>
<br/>
My .bat file for compiling the music is this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">g++ -c -nostartfiles -mthumb -mthumb-interwork -fno-rtti -fno-exceptions -o heyladies.o heyladies.c</td> </tr></table><span class="postbody">
<br/>
<br/>
My .bat file for compiling my game and linking the two is this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">g++ -c -O3 -mthumb -mthumb-interwork -fno-rtti -fno-exceptions -o Frogger.o Frogger.cpp
<br/>
g++ -mthumb -mthumb-interwork -o Frogger.elf heyladies.o Frogger.o
<br/>
objcopy -O binary Frogger.elf Frogger.gba</td> </tr></table><span class="postbody">
<br/>
<br/>
I have tried re-ordering the files in the linking line, that didnt help either. Oh and I know .bat files are a nasty way of doing things and I should use makefiles but I like this way.
<br/>
<br/>
Just including the array of music into my game instead of compiling it seperately and linking them is out of the question, as it is the whole of Hey Ladies by The Beastie Boys, and the music file takes over 30 minutes to compile on the piece of shit computer I use for GBA development, while compiling it seperately once (and sleeping while it does it) then compiling the game and linking them takes like 15 seconds each time i make a change.
<br/>
<br/>
Heres the error I get:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">C:\Programming\GBA Projects\TileFrogger&gt;g++ -c -O3 -mthumb -mthumb-interwork -fno-rtti -fno-exceptions -o Frogger.o Frogger.cpp 
<br/>
<br/>
C:\Programming\GBA Projects\TileFrogger&gt;g++ -mthumb -mthumb-interwork -o Frogger.elf heyladies.o Frogger.o 
<br/>
Frogger.o: In function `Frogger::Start()':
<br/>
Frogger.o(.gnu.linkonce.t._ZN7Frogger5StartEv+0xe4): undefined reference to `heyladies'
<br/>
collect2: ld returned 1 exit status
<br/>
<br/>
C:\Programming\GBA Projects\TileFrogger&gt;objcopy -O binary Frogger.elf Frogger.gba 
<br/>
objcopy: Frogger.elf: No such file or directory
<br/>
<br/>
Tool completed with exit code 1</td> </tr></table><span class="postbody">
<br/>
Any ideas folks?<br/>_________________<br/><a class="postlink" href="http://www.hungrydeveloper.com" target="_blank">www.hungrydeveloper.com</a>
<br/>
Version 2.0 now up - guaranteed at least 100% more pleasing!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#13260 - MumblyJoe - Wed Dec 10, 2003 2:22 am</h4>
    <div class="postbody"><span class="postbody">I just had a moment of realisation, and put a function that returned a pointer to the array in the music .cpp file, and declared that extern in the header, and used that function instead, and it links fine now! I still have to see if it worked properly but hooray anyway!
<br/>
<br/>
Any ideas why this happened?<br/>_________________<br/><a class="postlink" href="http://www.hungrydeveloper.com" target="_blank">www.hungrydeveloper.com</a>
<br/>
Version 2.0 now up - guaranteed at least 100% more pleasing!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#13304 - evil saltine - Wed Dec 10, 2003 10:19 pm</h4>
    <div class="postbody"><span class="postbody">If you use a .cpp file for the music instead of .c it should work fine, I had the same problem. I don't know why it does that.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
