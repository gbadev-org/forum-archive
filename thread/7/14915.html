<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>C++ : dooble pointer question - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>C/C++ > C++ : dooble pointer question</h2>
<div id="posts">
<div class="post">
    <h4>#149818 - ghuldan - Fri Jan 25, 2008 5:51 pm</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
I want to use an array of (int*), but i have some problems, here is a simplified code ... i just want to theorize, not make you debug my code.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">class NoName {
<br/>
  int** array;
<br/>
  
<br/>
  NoName() {
<br/>
      this-&gt;array = (int**)malloc(sizeof(int*) * 4);
<br/>
  }
<br/>
  void fillArray();
<br/>
}
<br/>
//----------------------
<br/>
void NoName::fillArray() {
<br/>
  fill( &amp;(this-&gt;array[0]) );
<br/>
<br/>
}
<br/>
//----------------------------------
<br/>
void fill(int** tab) {
<br/>
  (*tab) = new int[100];
<br/>
  for (int i = 0...) 
<br/>
      (*tab)[i] = 42;
<br/>
} </td> </tr></table><span class="postbody">
<br/>
<br/>
when i try to create and fill one of the (int*) of <span style="font-style: italic">NoName::array</span>, only the first element of the array (here NoName::array[0][0]) is filled, the rest is nonsense. I think i must be wrong in calling the <span style="font-style: italic">fill</span> function in <span style="font-style: italic">NoName::fillArray()</span>
<br/>
<br/>
I also tried with :
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">//----------------------
<br/>
void NoName::fillArray() {
<br/>
  fill( this-&gt;array, 0 );
<br/>
<br/>
}
<br/>
//----------------------------------
<br/>
void fill(int** tab, int num) {
<br/>
  tab[num]= new int[100];
<br/>
  for (int i = 0...) 
<br/>
      tab[num][i] = 42;
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
and 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">//----------------------
<br/>
void NoName::fillArray() {
<br/>
  this-&gt;array = fill( this-&gt;array, 0 );
<br/>
<br/>
}
<br/>
//----------------------------------
<br/>
int** fill(int** tab, int num) {
<br/>
  tab[num]= new int[100];
<br/>
  for (int i = 0...) 
<br/>
      tab[num][i] = 42;
<br/>
  return tab;
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
I would really want to know what's wrong here.
<br/>
<br/>
Thanks in advance.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#149829 - sajiimori - Fri Jan 25, 2008 8:09 pm</h4>
    <div class="postbody"><span class="postbody">Ok, so you've got an irregular 2D array, where each row can have a different length.  (If you only need a regular 2D array, use a single call to 'new' to allocate the whole thing.)
<br/>
<br/>
I can't say what the problem is because the code is too obscure for my poor brain.  ;)  Pointers to pointers are already confusing, but having a <span style="font-style: italic">dual meaning</span> of "pointer to pointer" sends it off the deep end in this code: sometimes it means a 2D array, and sometimes it means an output parameter.
<br/>
<br/>
I'd suggest replacing the 'malloc' call with 'new'.  It's less error prone, nicer looking, and mixing 'malloc' and 'new' is considered iffy in general.
<br/>
<br/>
Going further, boost::scoped_array would make your code a lot less error prone, and it costs basically nothing in terms of efficiency.
<br/>
<br/>
fillArray() could also be re-envisioned as something like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int* createArray();
<br/>
<br/>
void NoName::fillArray()
<br/>
{
<br/>
  // Use return values instead of output parameters.
<br/>
  array[0] = createArray();
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#149893 - gmiller - Sat Jan 26, 2008 2:51 pm</h4>
    <div class="postbody"><span class="postbody">sajiimori is correct .... you allocated an array of **in pointers and then wanted to create an array that each pointer "points" to.
<br/>
<br/>
array[x] points to an *int so you need to allocate memory and fill in the pointer.  The mixing of malloc and new is risky in general because your runtime library might not use the same underlying code to manage the heap which could cause cross pointer problems (two different heap pointers referencing the same memory or a partial overlap).
<br/>
<br/>
When I need aligned memory allocation for hardware data types (such as SIMD) I override new with malloc in VS so I can use the aligned malloc to create the memory on the heap at the required 16 byte aligned address. So the risk is not always an issue depending on your tools.
<br/>
<br/>
sajiimori approach is what you need to do (create the array in fill or just prior to calling fill ... depends on how you want to do it.
<br/>
<br/>
Sorry for the long winded reply ...</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
