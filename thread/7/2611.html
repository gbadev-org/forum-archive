<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>calling GBA BIOS functions from C - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>C/C++ > calling GBA BIOS functions from C</h2>
<div id="posts">
<div class="post">
    <h4>#14424 - NeoGeo - Tue Jan 06, 2004 12:43 pm</h4>
    <div class="postbody"><span class="postbody">I was tyring to do some sprite rotation the other day when I got a tip that there was possible to use some BIOS functions for this. I think it was called ObjAffineSet of something, can anyone give me a step by step  example  on how to do this from C.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14425 - Cearn - Tue Jan 06, 2004 1:17 pm</h4>
    <div class="postbody"><span class="postbody">You can do this by using inline assembly.  The CowBite Spec
<br/>
has a list of available BIOS calls and what the input and 
<br/>
output should be. ObjAffineSet is number 0x0f. The code for
<br/>
using it is:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
typedef struct tObjAffineSource
<br/>
{
<br/>
   s16 wX;
<br/>
   s16 wY;
<br/>
   u16 theta;
<br/>
}   ObjAffineSource;
<br/>
<br/>
typedef struct tObjAffineDest 
<br/>
{
<br/>
s16 pa, pb, pc, pd;
<br/>
}   ObjAffineDest ;
<br/>
// NOTE! 
<br/>
// ** theta does a CLOCKWISE rotation
<br/>
// ** wX and wY are reciprocals of the actual scales: wX=1/sX; wY= 1/sY
<br/>
//        | wX*cos(th)   -wX*sin(th) |
<br/>
//  P = |                                     |
<br/>
//        | wY*sin(th)    wY*cos(th) |
<br/>
<br/>
void ObjAffineSet(ObjAffineSource *src, ObjAffineDest *dst, int num, int offset)
<br/>
{   asm("swi 0x0f0000");   }
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
src and dst are arrays of structures, num is the numbers of elements 
<br/>
in the array (i.e., the numer of calculations) and offset is the 
<br/>
distance (in bytes) between the matrix elements. This is for GCC 
<br/>
in ARM  mode. SDT and THUMB is a little different.
<br/>
<br/>
Usage example:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
ObjAffineSource af_src= {0x0100, 0x0080, 0x4000};
<br/>
ObjAffineDest af_dest;
<br/>
ObjAffineSet(&amp;af_src, &amp;af_dest, 1, 2);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
As for <span style="font-style: italic">why</span> this works, I'll get back to you on that.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14537 - Miked0801 - Thu Jan 08, 2004 2:51 am</h4>
    <div class="postbody"><span class="postbody">Your devkit should have some built in function calls to do this for you in agb.h.  make sure that's included - then check it out for a list of functions.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15604 - dagamer34 - Mon Jan 26, 2004 3:14 am</h4>
    <div class="postbody"><span class="postbody">I have a problem when running my ROM from my cart. It always hangs when I can swi 0x010000, RegisterRamReset. It works perfectly in VBA but I get a white screen on real hardware.
<br/>
<br/>
Don't you just love it when that happens?
<br/>
<br/>
<br/>
Well, please download my ROM and test it on your flash cart and see if the same thing happens. That way I can know if its my ROM or the flash cart that's the problem. By the way, I tested it with a EZF-Advance so maybe someone with a F2A or XG1/XG2 can give it a go.
<br/>
<br/>
<a href="http://www.geocities.com/dagamer34/" target="_blank">www.geocities.com/dagamer34/</a>
<br/>
<br/>
It's called SWI Test.
<br/>
<br/>
Thanks.
<br/>
<br/>
EDIT: After using the BIOS when running VBA, I find that it decides to enable the Force Blank flag. Now why would it do something like that? Isn't it supposed to clear parts of RAM?<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15607 - tepples - Mon Jan 26, 2004 4:12 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>dagamer34 wrote:</b></span></td> </tr> <tr> <td class="quote">it decides to enable the Force Blank flag. Now why would it do something like that?</td> </tr></table><span class="postbody">
<br/>
umm... isn't it called <span style="font-weight: bold">Register</span>RamReset()?
<br/>
<br/>
Try clearing the bit that tells it to reset the video <span style="font-weight: bold">registers</span>.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15640 - dagamer34 - Mon Jan 26, 2004 11:20 pm</h4>
    <div class="postbody"><span class="postbody">Well, after extensive testing using a bios, I have figured out that SWI 01 decides to set the GBA to mode 0 and turn off the screen. All I did was save a temporary copy of REG_DISPCNT before calling it and restoring it afterwards.
<br/>
<br/>
I wonder why this was never documented. I guess the unofficial docs really are a work in progress. Someone should add it.<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15646 - torne - Tue Jan 27, 2004 12:30 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>dagamer34 wrote:</b></span></td> </tr> <tr> <td class="quote">Well, after extensive testing using a bios, I have figured out that SWI 01 decides to set the GBA to mode 0 and turn off the screen. All I did was save a temporary copy of REG_DISPCNT before calling it and restoring it afterwards.
<br/>
<br/>
I wonder why this was never documented. I guess the unofficial docs really are a work in progress. Someone should add it.</td> </tr></table><span class="postbody">
<br/>
<br/>
If you read GBAtek you will find the following:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">SWI 1 - RegisterRamReset
<br/>
...
<br/>
The function always switches the screen into forced blank by setting DISPCNT=0080h (regardless of incoming R0, screen becomes white).</td> </tr></table><span class="postbody">
<br/>
<br/>
It is documented.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15652 - dagamer34 - Tue Jan 27, 2004 4:42 am</h4>
    <div class="postbody"><span class="postbody">Sorry, I was looking at the CowBite spec. It needs to be documented there.<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15672 - torne - Tue Jan 27, 2004 6:31 pm</h4>
    <div class="postbody"><span class="postbody">Try referring to gbatek as well or instead, as it tends to be more complete and accurate (though often less helpful).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15702 - dagamer34 - Wed Jan 28, 2004 3:38 am</h4>
    <div class="postbody"><span class="postbody">It seems GBATek was really written for professional developers instead of hobbyists. And I finally took a look at that site... $5000?
<br/>
<br/>
The price really just goes to show how harmful piracy is. However, VBA is still useful, even if it has its *bugs*. Then again, he isn't getting paid for it. He works on it in his "spare" time. Thanks a lot, Forgotten!!
<br/>
<br/>
Some tips for the next release.... *laughs*<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15716 - tom - Wed Jan 28, 2004 1:21 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>dagamer34 wrote:</b></span></td> </tr> <tr> <td class="quote">It seems GBATek was really written for professional developers instead of hobbyists. And I finally took a look at that site... $5000?</td> </tr></table><span class="postbody">
<br/>
<br/>
uh, you're talking about no$gba.
<br/>
gbatek is the technical documentation for no$gba, which is available for free (the docs, not the emulator...):
<br/>
<br/>
<a class="postlink" href="http://www.work.de/nocash/gbatek.txt" target="_blank">http://www.work.de/nocash/gbatek.txt</a>
<br/>
<br/>
it's to be preferred over any other halfbaked technical docs on the gba (including the cowbite specs)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15733 - torne - Wed Jan 28, 2004 6:20 pm</h4>
    <div class="postbody"><span class="postbody"><a href="http://www.work.de/nocash/gbatek.htm" target="_blank">http://www.work.de/nocash/gbatek.htm</a> is the slightly more readable HTML version.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15749 - dagamer34 - Thu Jan 29, 2004 12:26 am</h4>
    <div class="postbody"><span class="postbody">"for the emulator" is what I meant to add on.<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17725 - batblaster - Sat Mar 13, 2004 11:05 am</h4>
    <div class="postbody"><span class="postbody">VBA is a great Emulator and is free but No$gba is the best emulator available for coders, when long time ago i do somethings for GBC the no$gbc help me a lot. The No$Gba has a lot of futures very very interesting for debugging and coding , very accurate and very very similar to real hardware... Normally i use vba but sometimes i use no$gba (the last public version released, not the best but work)...
<br/>
The No$gba help coder in a lot of things like a realtime showing of screenposition and realtime showing of obj position, is faster but is very very expensive...<br/>_________________<br/>Batblaster / 7 Raven Studios Co. Ltd
<br/>
------------------------------------------</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
