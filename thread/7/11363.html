<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Writing a DAT file parser - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>C/C++ > Writing a DAT file parser</h2>
<div id="posts">
<div class="post">
    <h4>#105113 - shadowghost21 - Fri Oct 06, 2006 2:28 am</h4>
    <div class="postbody"><span class="postbody">I am writing a LegoCad program for the NDS in C using the PAlib. The parts library for the pc version of the program are in dats. Each DAT contains some coordinates ill post an example of a 1x1 brick
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
0 Brick  1 x  1
<br/>
0 Name: 3005.dat
<br/>
0 Author: James Jessiman
<br/>
0 Original LDraw Part
<br/>
0 LDRAW_ORG Part UPDATE 2002-03
<br/>
<br/>
0 BFC CERTIFY CCW
<br/>
<br/>
0 2002-05-07 KJM BFC Certification
<br/>
<br/>
0 BFC INVERTNEXT
<br/>
1 16 0 24 0 6 0 0 0 -20 0 0 0 6 box5.dat
<br/>
<br/>
4 16 10 24 10 6 24 6 -6 24 6 -10 24 10
<br/>
4 16 -10 24 10 -6 24 6 -6 24 -6 -10 24 -10
<br/>
4 16 -10 24 -10 -6 24 -6 6 24 -6 10 24 -10
<br/>
4 16 10 24 -10 6 24 -6 6 24 6 10 24 10
<br/>
<br/>
1 16 0 24 0 10 0 0 0 -24 0 0 0 10 box5.dat
<br/>
<br/>
1 16 0 0 0 1 0 0 0 1 0 0 0 1 stud.dat
<br/>
0
<br/>
</td> </tr></table><span class="postbody">
<br/>
0 is a comment 1, is an include (with the file to include at the end) and 4, is a quad. Now I need to take info from this DAT and put them into coordinates to draw bricks. im not quite sure how to go about this. If any one can give me some advice, example code (quick and dirty) to get an idea, it would save me many a headache for the next few days.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#105145 - sgeos - Fri Oct 06, 2006 12:03 pm</h4>
    <div class="postbody"><span class="postbody">You'll want to write a filter that takes this file and spits out a C file.  I'd use perl.
<br/>
<br/>
This is what I'm using to generate header files from tab delimited spreadsheet files:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#!/usr/bin/perl -w
<br/>
<br/>
while (defined($line = &lt;STDIN&gt;))
<br/>
{
<br/>
   $line =~ s/([^\t\n]+|)([\t]|)([^\t\n]+|)(?:[\t]|)([^\t\n]+|)(?:[\t]|)[\n]/#define\t$1$2$3\n/g;
<br/>
   print STDOUT $line;
<br/>
}</td> </tr></table><span class="postbody">
<br/>
You'll want to write something similar.  This can be run from the command line using cygwin.  This runs the file jp.csv through two filters, amp2cr.pl and csv2def.pl, and spits out def.h.:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">cat jp.csv | ./amp2cr.pl | ./csv2def.pl &gt; def.h</td> </tr></table><span class="postbody">
<br/>
You'll want to write a "dat2c.pl" filter.  It can be used like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">cat in.dat | ./dat2c.pl &gt; out.c</td> </tr></table><span class="postbody">
<br/>
Google is your friend.  These keywords might help:
<br/>
"perl" "tutorial" "regular expression" "backreference"
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#105170 - wintermute - Fri Oct 06, 2006 3:23 pm</h4>
    <div class="postbody"><span class="postbody">I'd be more inclined to use libfat and use sscanf to read the file into C/C++ variables, that way you're not restricted to parts which are defined at compile time.
<br/>
<br/>
Here's a code snippet which illustrates use
<br/>
<br/>
<a href="http://www.daniweb.com/code/snippet281.html" target="_blank">http://www.daniweb.com/code/snippet281.html</a><br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#105207 - sgeos - Fri Oct 06, 2006 6:45 pm</h4>
    <div class="postbody"><span class="postbody">I can't see compiling adding much to the build time, especially if the doesn't change (often).  The data is going to live in ROM either as a struct/LUT or a file in the filesystem.  Is there something inherently better about the file approach that I'm missing?
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#105208 - Sausage Boy - Fri Oct 06, 2006 6:55 pm</h4>
    <div class="postbody"><span class="postbody">It's for the DS, so most people will use memory cards. It's nicer to just drop in another file on your memory card than to rebuild the entire program.
<br/>
<br/>
<br/>
<span style="font-size: 8px; line-height: normal">edit: spelling</span><br/>_________________<br/>"no offense, but this is the gayest game ever"</span><span class="gensmall"><br/><br/>Last edited by Sausage Boy on Sat Oct 07, 2006 11:44 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#105267 - sgeos - Sat Oct 07, 2006 3:17 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Sausage Boy wrote:</b></span></td> </tr> <tr> <td class="quote">It's for the DS, so most people will use memory cards. It's nicer to just drop in another file on your memory card than to rebuilt the entire program.</td> </tr></table><span class="postbody">
<br/>
Neat.  That is a good reason.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
