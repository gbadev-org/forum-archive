<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Shifting Arrays for High Scores Trouble. - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>C/C++ > Shifting Arrays for High Scores Trouble.</h2>
<div id="posts">
<div class="post">
    <h4>#97114 - chatterbug89 - Tue Aug 08, 2006 1:38 am</h4>
    <div class="postbody"><span class="postbody">I've been at this for a couple days and am sort of stumped.  I have a system set up where the high scores are saved in a text file, and when read, the high scores are loaded into 2 arrays, AdventureScores and AdventureNames (there are actually 4...but, that doesn't really matter for my question).  The scores are stored as text int he AdventureScores arrays, 6 digits for every score.  So every 6 new digits, there is a new score.  For the AdventureNames array, there are 3 letters to a name, so every 3 spaces, there is a new high score name.
<br/>
<br/>
Creating this file, reading it, etc. I have all working great.  But, shifting the arrays to add new scores is causing me problems.  One more thing before I show some code.  0 is the higest score.  The higher the number, the lower the score place.  At the momment, I have it working so that if you get a new higest score (a score greater than what is at 0), everything shifts down fine, clearing the lowest score, and making room for writing the new high score in the particlar place.
<br/>
<br/>
The following code is actually just part of a function of mine, but, I should have it so everything that concerns this question is included with it and enough to actually run it is included.
<br/>
<br/>
EDIT2:  By the way, there are 10 high scores.  That's why the names array is 30 (3 letters * 10 entries) and the score array is 60 ( 6 digits * 10 entries). ;-)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
/*****Check if we have made a high score in adventure mode.  If so, save the new high scores******/
<br/>
//This following code checks if we made a new high score and records the place.
<br/>
//Cscores was converted to an array of intigers from AdventureScores.
<br/>
//This code *should* be fine.
<br/>
//This first conditional statement see's if our current score is higher than the lowest high score in a list of 10 high scores.
<br/>
if ( score &gt; Cscores[9] ){
<br/>
   // Our score is bigger than our highest score, so we have a high score!
<br/>
   if (score &gt; Cscores[0] ){
<br/>
      //We have a new TOP score!
<br/>
      Cscores[0] = score;
<br/>
      scoreplace = 0;
<br/>
   }
<br/>
   else{
<br/>
      //Begin the loop to determine where we are.
<br/>
      scoreplace = -1; // Initially we wont want to kill the loop.
<br/>
      for ( i = 9; (i &gt;= 0) &amp;&amp; (scoreplace == -1); ++i ){
<br/>
         if (score &lt; Cscores[i]){
<br/>
            //We have found a high score higher than our new high score, so our new high score must go below it.
<br/>
            Cscores[i+1] = score;
<br/>
            scoreplace = (i+1); // Kill the Loop &amp; set the place we scored.
<br/>
         }
<br/>
      }
<br/>
   }
<br/>
   //Move all the scores down one level from the new high level place
<br/>
   //This is the part where i'm having the problems.
<br/>
   //First we begin a for loop that goes 3 times.  Since there are 3 spaces for a name, we have to do a shift tot he write three times.
<br/>
   for (i = 0; i &lt; 3; ++i){
<br/>
      // If it isn't our first time, we need to copy the temp array to the orignal array, since we are shifting it again.
<br/>
      if ( i != 0 ){
<br/>
         for ( p = 0; p &lt; 30; ++p)
<br/>
            AdventureNames[p] = AdventureNamesTemp[p];
<br/>
      }
<br/>
      //This is suspose to determine where we should start shifting from....this part is where i'm unsure.
<br/>
      actualscoreplace = scoreplace * 3;
<br/>
      if (actualscoreplace == 0)
<br/>
         actualscoreplace = 1;
<br/>
      //Right now it is a loop which shifts everything to the right. 
<br/>
      // It doesn't matter what's in AdventureNamesTemp[0] (this varies depending ont he place, but if we had a higest top score it woudl be 0), since it will just be ovewritten
<br/>
      //with the new high score later on.
<br/>
      for ( q = actualscoreplace; q &lt; 30; ++q)
<br/>
         AdventureNamesTemp[q] = AdventureNames[q-1];
<br/>
      // If a shift to the right diden't occur at the very beggining, we need to copy the old values to the unchangign parts of the arrays so they arn't filled with junk.
<br/>
      for ( q = 0; q &lt; actualscoreplace; ++q)
<br/>
         AdventureNamesTemp[q] = AdventureNames[q];
<br/>
   }
<br/>
   //This part is identical to the first part, except it is for the scores, which are 6 spaces instead of 3.
<br/>
   for (i = 0; i &lt; 6; ++i){
<br/>
   if ( i != 0 ){
<br/>
      for ( p = 0; p &lt; 60; ++p)
<br/>
         AdventureScores[p] = AdventureScoresTemp[p];
<br/>
   }
<br/>
   actualscoreplace = scoreplace * 6;
<br/>
   if (actualscoreplace == 0)
<br/>
      actualscoreplace = 1;
<br/>
   for ( q = 1; q &lt; 60; ++q)
<br/>
      AdventureScoresTemp[q] = AdventureScores[q-1];
<br/>
   for ( q = 0; q &lt; 1; ++q )
<br/>
      AdventureScoresTemp[q] = AdventureScores[q];
<br/>
   }
<br/>
   //This stuff doesn't realy pertain to my question..you can safely ignore it.  But, you can look at it to kind of see what's happenign witht he data after it's parsed.
<br/>
   convertscoresstring(AdventureScoresTemp, scoreplace); //Write out new score array.
<br/>
   writeintials(AdventureNamesTemp, scoreplace); // Get the user intials and write it to the array.
<br/>
   //Write the New High Scores to the High Scores File
<br/>
   ResetHighScores(AdventureScoresTemp, ClassicScores, AdventureNamesTemp, ClassicNames);
<br/>
}
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I left out the variable declartions (remember, this is a part of a game i'm working on)...but, I added extra comments for this example than in the orginal so everyone knew what I was doing.  Anyways, as I said before, it works if the new high score is higher than AdventureScores[0]...but, if it's lower or higher than any of the other scores....weird things happen.  The whole score array is messed up, and, some other score arrays for a differnt mode of game play are affected when they are never intentially modified or called (somehow, something like array[20] is being edited where array only goes up to 10...so, it affects the next array declared after it).
<br/>
<br/>
Any help on how to get this working would be greatly appreciated.  Also, feel free to use my ideas for score shifting :).
<br/>
<br/>
Finally, this was the preliminary code I made to test array shifting...and it works.  The difffernce between this and the above, is each element is a differnt number/score..it shoudlen't be any differnt than above in the general aspect, but ...for soem reason it just wont work.  In this example, place is the place of 0-9 in the array that you want to stick your new score in.  Everything is shifted from the place to make room for a new varaible, dumping the variable at the end of the array.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include &lt;stdio.h&gt;
<br/>
<br/>
main()
<br/>
{
<br/>
    int i;
<br/>
    int place = 9;
<br/>
    int teststring[10], transferstring[10];
<br/>
    for ( i = 0; i &lt; 10; ++i)
<br/>
        teststring[i] = i;
<br/>
    for ( i = 0; i &lt; 10; ++i)
<br/>
        printf("%d  ",teststring[i]);
<br/>
    for (i = place+1; i &lt; 10; ++i)
<br/>
        transferstring[i] = teststring[i-1];
<br/>
    for ( i = 0; i &lt; place+1; ++i)
<br/>
        transferstring[i] = teststring[i];
<br/>
    transferstring[place] = 9;
<br/>
    printf("\n");
<br/>
    for ( i = 0; i &lt; 10; ++i)
<br/>
        printf("%d  ",transferstring[i]);
<br/>
    while(1)
<br/>
        ;
<br/>
    return 0;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Anyways, thanks a lot :)[/code]
<br/>
<br/>
EDIT: By the way, I have a feeling i'm just doing somethign realy realy stupid :s  The problem lies with taking the place variable and figuring out where to start shifting from.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#97136 - tepples - Tue Aug 08, 2006 4:24 am</h4>
    <div class="postbody"><span class="postbody">The quick and dirty solution: Replace the <span style="font-style: italic">worst</span> score with the player's score, and then sort them by score afterward. It will help if you keep each score entry in a struct:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">struct AdventureScoreEntry {
<br/>
  int score;
<br/>
  char name[3];
<br/>
};</td> </tr></table><span class="postbody">
<br/>
And why are you storing scores as digits anyway? You can save 4 bytes by storing a score in a machine word.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#97143 - chatterbug89 - Tue Aug 08, 2006 5:09 am</h4>
    <div class="postbody"><span class="postbody">Hmm, I could try that.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">And why are you storing scores as digits anyway? You can save 4 bytes by storing a score in a machine word.</td> </tr></table><span class="postbody">
<br/>
<br/>
For my save games, values such as the ammount of lives and level (which are pretty small numbers) I'll save as a single char variable into a text file.  ex: 1 char woudl be the lives, another the level, etc.(EDIT: and I don't mean as ASCII text..but, a numercial number).  But, I can't fit the size of the scores inside of a single char.  Could you explain further?
<br/>
<br/>
Also, I probaly should use some structs.  It would make things a little cleaner/easier :)
<br/>
<br/>
Tommrow i'll probally look at it a little more and try to get it working how it works now (It seems like i'm missing something so small :S...it's bugging me i guess).  Otherwise, I guess i'll just resort to useing structs that  contain the score and intials, write the new data to the structure that would get pushed off of the top 10 list, sort it, then write it to the file.  Thanks for the tips.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#97145 - tepples - Tue Aug 08, 2006 5:23 am</h4>
    <div class="postbody"><span class="postbody">Instead of storing the score in SRAM in decimal digits, store it in binary with 8 bits per char:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void pokeBinary32(unsigned char *dst, int n) {
<br/>
  dst[0] = n;
<br/>
  dst[1] = n &gt;&gt; 8;
<br/>
  dst[2] = n &gt;&gt; 16;
<br/>
  dst[3] = n &gt;&gt; 24;
<br/>
}
<br/>
<br/>
unsigned int peekBinary32(const unsigned char *src) {
<br/>
  return src[0] | (src[1] &lt;&lt; 8) | (src[2] &lt;&lt; 16) | (src[3] &lt;&lt; 24);
<br/>
}</td> </tr></table><span class="postbody">
<br/>
I'd suggest implementing the sort yourself, based on the directions from <a class="postlink" href="http://en.wikipedia.org/wiki/Insertion_sort" target="_blank">wikipedia:Insertion sort</a>. Once you implement a proper insertion sort, you will know how to simplify it for the special case where all but the last element are sorted.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#97231 - chatterbug89 - Tue Aug 08, 2006 8:01 pm</h4>
    <div class="postbody"><span class="postbody">Yes!  I did it with my own logic.  The equation for getting the poitn to start in the array for shifting was 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
actualscoreplace = ((scoreplace + 1) * 3) - 2;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
for the intials and
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
actualscoreplace = ((scoreplace + 1) * 6) - 5;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
for the scores.
<br/>
<br/>
I spent some time and carefully worked out test situations on paper and came up with the equation....I should ahve took the time and carefully did it the way I did in the first place...I guess I just got stressed because it woudlen't work.
<br/>
<br/>
Also....the part of the program which determines the score place....had a mistake....  And I would have never noticed it if i wasn't so sure that my equation was correct.  my for loop starts at 9 and goes to 0...yet i had ++i instead of --i.  That exaplains why other arrays were getting messed up.
<br/>
<br/>
Anyways, i'm realy glad I got it working with my logic :)  I kind of got a realy high sense of accomplishment that I did it all by myself with my own logic :-P  And that I diden't give up ^^.  However, later on, I think I may implent your ideas, tepples...since, it would be a tad cleaner and more practical.  Plus, it'd be good practice for me either way. (I need to get bitwise operators down some more also).
<br/>
<br/>
Thanks a lot for your help Tepples.
<br/>
<br/>
EDIT: Actualy, it's not compeltely done.  I still need to decide how to handle duplicate high scores.  I'm still sort of decicing how to handle it, so...i'll probaly work on that later today. :)
<br/>
<br/>
EDIT2: There was one other change I made by the way for anyone interested.  The loop that wrote the origanl values tot he unchanging spots in the array, was moved out of the main for loop that shifted everything to the right.  Also, at the begginign of the main for loop, I put a for loop that copied the intial arrayt o be shifted to a temporary array.  The loop at the end that rewrites the variables in the array that were unchaning, gets its data from that temporary array. ;-)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#97246 - tepples - Tue Aug 08, 2006 9:08 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chatterbug89 wrote:</b></span></td> </tr> <tr> <td class="quote">I still need to decide how to handle duplicate high scores.  I'm still sort of decicing how to handle it, so...i'll probaly work on that later today. :)</td> </tr></table><span class="postbody">
<br/>
A new score equal to an existing score should go below the old score unless the scores are perfect scores (e.g. 100% perfect steps in DDR), in which case the latest perfect score should go on top. In addition, each set of initials should be allowed only once on a given table; otherwise, you're just seeing who plays the game more often, not who are the best players.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#97274 - chatterbug89 - Tue Aug 08, 2006 11:23 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">In addition, each set of initials should be allowed only once on a given table; otherwise, you're just seeing who plays the game more often, not who are the best players.</td> </tr></table><span class="postbody">
<br/>
<br/>
I sort of disagree with that.  Especialy in this case, where maybe the user wont share his or her game with other people.  In that case, he's goign to want to see all of his or her high scores.
<br/>
<br/>
If one user gets 100 points, the the same user gets 50 points...
<br/>
player1 - 100
<br/>
Player1 - 50.
<br/>
<br/>
If we removed the lower one...then, player two only has to get 1 point to get that same spot, when he or she would orginally have to get over 50.
<br/>
<br/>
Plus...I dont' think i've ever seen a high score system where only one certain set of intials could appear on a particlar high score table.  maybe there's something i'm missing in your statement.
<br/>
<br/>
EDIT:  Oh! i think i get what you mean.  If the same user, got the same score again, then, it shoudlen't be added...since as you said, it'd just be shwoing who plays more.  ^^</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#97276 - tepples - Tue Aug 08, 2006 11:41 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chatterbug89 wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">In addition, each set of initials should be allowed only once on a given table; otherwise, you're just seeing who plays the game more often, not who are the best players.</td> </tr></table><span class="postbody">
<br/>
I sort of disagree with that.  Especialy in this case, where maybe the user wont share his or her game with other people.  In that case, he's goign to want to see all of his or her high scores.</span></td> </tr></table><span class="postbody">
<br/>
I was thinking more of the situation in an arcade machine, an Internet ranking, or a game that <span style="font-style: italic">is</span> shared among children in a household or college students in neighboring dorm rooms. Why would you want someone to hog the top 5 with 99.5, 99.4, 99.3, 99.2, 99.1?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#97282 - chatterbug89 - Wed Aug 09, 2006 12:02 am</h4>
    <div class="postbody"><span class="postbody">Using fractiosn is kind of eagerating it, isn't it? :-P
<br/>
<br/>
But, I guess you do have some point, if there was something like this.
<br/>
1. ABC - 105
<br/>
2. ABC - 104
<br/>
3. ABC - 103
<br/>
4. ABC - 102
<br/>
<br/>
But, then if there is something like this
<br/>
1. ABC - 105
<br/>
2. ABC - 50
<br/>
<br/>
If the two entries dident' exist, getting on the high score list becomes easier.  Also, taking your suggestion about how to move things.  In our first example, if a differnt player got 104, they would gain either the new 2 or 3rd place, pushing everything else down.  It woudlen't realy be hogging anything.  Also, what's the differnce if, lets say, 4 people got 4 differnt scores like that.
<br/>
1. ABC - 105
<br/>
2. DEF - 104
<br/>
3. GHI - 103
<br/>
4. JKL - 102
<br/>
...Plus....the user coudl always just change his intials to get past the restrictions to "hog" the high score.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#97284 - tepples - Wed Aug 09, 2006 12:31 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chatterbug89 wrote:</b></span></td> </tr> <tr> <td class="quote">Using fractiosn is kind of eagerating it, isn't it? :-P</td> </tr></table><span class="postbody">
<br/>
<span style="font-style: italic">In The Groove</span> keeps a score for each song from zero to 5 times the number of steps in the song and displays it as a percentage. In machines played by a lot of expert players, you see a lot of almost perfect scores, with timing off by a hair on a handful of steps. 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">If the two entries dident' exist, getting on the high score list becomes easier.</td> </tr></table><span class="postbody">
<br/>
Getting on a high score list is an incentive to put quarters in and play the game. (Everything I say about "quarters" also applies to pay MMO games, even though they're usually flat rate per month.)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Also, taking your suggestion about how to move things.  In our first example, if a differnt player got 104, they would gain either the new 2 or 3rd place, pushing everything else down.</td> </tr></table><span class="postbody">
<br/>
But then you have multiple people putting multiple sets of quarters in.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Also, what's the differnce if, lets say, 4 people got 4 differnt scores like that.
<br/>
1. ABC - 105
<br/>
2. DEF - 104
<br/>
3. GHI - 103
<br/>
4. JKL - 102</td> </tr></table><span class="postbody">
<br/>
Then you have four different people's high scores, and usually it means that a lot of quarters have been spent on playing that game.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">...Plus....the user coudl always just change his intials to get past the restrictions to "hog" the high score.</td> </tr></table><span class="postbody">
<br/>
But then if you make a new set of initials, you lose your custom game settings. And do people regularly change their initials to get multiple lines on nintendowifi.com's world rankings for <span style="font-style: italic">Tetris DS</span>?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#97286 - chatterbug89 - Wed Aug 09, 2006 12:57 am</h4>
    <div class="postbody"><span class="postbody">Heh, you make some good points.  I guess you win :-P  For a game that is goign to be in a comercial/arcade/online enviroment, I would agree with you now.  But, for a personal game on a handheld, it's probally not such a great idea due to what I mentioned.  For a personal game, it'll probaly be shared only with a few friends tryign to compete for new high scores and or only played by one person.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
