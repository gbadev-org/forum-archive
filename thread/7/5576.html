<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>i really need help here. - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>C/C++ > i really need help here.</h2>
<div id="posts">
<div class="post">
    <h4>#41561 - sparda - Fri Apr 29, 2005 6:24 pm</h4>
    <div class="postbody"><span class="postbody">ok, i've been learning all about C programming for the last 2 weeks. But Im stuck at pointers. Now here's my question, I dont completely understand what this means :
<br/>
<br/>
(*(volatile unsigned short*) 0x4000000)
<br/>
<br/>
i understand Volatile and everything else, i just dont get the pointers, why is it
<br/>
<br/>
*(volatile unsigned short*) 0x4000000 why not just--&gt; *(volatile unsigned short) 0x4000000
<br/>
<br/>
or maybe--&gt; (volatile unsigned short*) 0x4000000 ??
<br/>
<br/>
<br/>
Any help would be appreciated. Thank you.
<br/>
sparda is offline   	Reply With Quote<br/>_________________<br/>genius is 1% inspiration, 99% perspiration .</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#41567 - DekuTree64 - Fri Apr 29, 2005 6:43 pm</h4>
    <div class="postbody"><span class="postbody">That statement just means to reference the 2-byte value at memory address 0x4000000, which the hardware translates into meaning the display control register. 
<br/>
Casting the raw address to volatile unsigned short* tells the compiler how to treat it, and dereferencing with the * operator says you want the value stored at the address, and not the address itself.
<br/>
<br/>
Wrapping #defines in parentheses is pretty standard practice, even when it doesn't make a real difference. Since the preprocessor just does a straight text replace, you want to make sure your value is as isolated from everything else as possible, so it can't be affected by any of the surrounding code where it gets plugged in.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#41569 - tepples - Fri Apr 29, 2005 6:50 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sparda wrote:</b></span></td> </tr> <tr> <td class="quote">Now here's my question, I dont completely understand what this means :
<br/>
<br/>
(*(volatile unsigned short*) 0x4000000)
<br/>
<br/>
i understand Volatile and everything else, i just dont get the pointers, why is it
<br/>
<br/>
*(volatile unsigned short*) 0x4000000 why not just--&gt; *(volatile unsigned short) 0x4000000</td> </tr></table><span class="postbody">
<br/>
That doesn't work. Qualifiers such as 'const' and 'volatile' are intended for lvalues such as things pointed to; you can't add them to an rvalue such as a literal number. You may understand better after I explain the next one.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">or maybe--&gt; (volatile unsigned short*) 0x4000000 ??</td> </tr></table><span class="postbody">
<br/>
This is a valid expression for a pointer to the start of register space or specifically to DISPCNT. Adding a * in front dereferences this pointer, resulting in the value of DISPCNT.
<br/>
<br/>
In general, C pointer expressions are best understood from right to left like <a class="postlink" href="http://en.wikipedia.org/wiki/Hebrew_language#Writing_system" target="_blank">Hebrew</a>:
<br/>
<ul><li>0x04000000 - a number </li><li>(unsigned short *)0x04000000 - a pointer whose bit pattern is the same as the number, which on the GBA refers to DISPCNT and the following registers </li><li>(volatile unsigned short *)0x04000000 - the same pointer, except the compiler will always issue write instructions in the sequence that they're given in the program </li><li>*(volatile unsigned short *)0x04000000 - the data contained at that address</li></ul><br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#41570 - sajiimori - Fri Apr 29, 2005 6:53 pm</h4>
    <div class="postbody"><span class="postbody">Edit: oops, too slow. ;)
<br/>
<br/>
This is basically reiterating what Deku said, but...
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">why not just--&gt; *(volatile unsigned short) 0x4000000</td> </tr></table><span class="postbody">
<br/>
Because the * at the beginning means "dereference" -- which is to say, "get the value that the following pointer points to".  You can only dereference pointers, so the above would not compile because the cast is telling the compiler to treat the number as a short, not as a pointer.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">or maybe--&gt; (volatile unsigned short*) 0x4000000</td> </tr></table><span class="postbody">
<br/>
That would compile, but it would only tells the compiler to treat the number as a pointer.  You would still have to use * to actually get the value at that address.
<br/>
<br/>
So in short, the complete phrase should be read right to left as: "Take the value 0x4000000, treat it as a pointer to a volatile unsigned short, and then read the unsigned short at that address."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#41674 - sparda - Sun May 01, 2005 1:18 am</h4>
    <div class="postbody"><span class="postbody">Yo, guys thanks alot for all the info, thankfully i understand it now.  I really appreciate all the help. again, thanks alot.
<br/>
<br/>
--sparda<br/>_________________<br/>genius is 1% inspiration, 99% perspiration .</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
