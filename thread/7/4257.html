<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Object oriented programming in C - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>C/C++ > Object oriented programming in C</h2>
<div id="posts">
<div class="post">
    <h4>#27834 - Touchstone - Thu Oct 21, 2004 10:45 pm</h4>
    <div class="postbody"><span class="postbody">Hi all,
<br/>
<br/>
I'm just at the beginning of writing an animation system for the agb and I'm curious, does anyone have any good ideas on how to write object oriented code in C? If I want to perform a certain action on an animation, for example set a couple of attributes and play a certain sequence, I currently see two ways of writing the code.
<br/>
<br/>
Alt. 1:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">animSetSpeed(&amp;anim_hero, 256); // anim_hero is the animation
<br/>
animSetFlippedX(&amp;anim_hero, TRUE);
<br/>
animSetPosition(&amp;anim_hero, 120, 80);
<br/>
animPlaySequence(&amp;anim_hero, 3);</td> </tr></table><span class="postbody">
<br/>
Alt. 2:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">animSetCurrentAnimation(&amp;anim_hero);
<br/>
animSetSpeed(256);
<br/>
animSetFlippedX(TRUE);
<br/>
animSetPosition(120, 80);
<br/>
animPlaySequence(3);</td> </tr></table><span class="postbody">
<br/>
Alt. 1 is the most understandable and straight-forward solution, but it sums up to quite a lot of redundant typing. Alt. 2 is .. well .. it's a great way to confuse anyone who reads the code and a veritable bug producer.
<br/>
<br/>
I would like to have a C++-like way with accessing methods straight off the animation object and not having to pass the object as parameter.
<br/>
<br/>
So, does anyone have a better idea for C code to be more like C++, so to speak. :) What does your object oriented code in C look like?
<br/>
<br/>
Cheers.<br/>_________________<br/>You can't beat our meat</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27835 - poslundc - Thu Oct 21, 2004 10:57 pm</h4>
    <div class="postbody"><span class="postbody">Well, if you really want to write your code like C++, you might consider using C++.
<br/>
<br/>
That said, if like me you by-and-large prefer plain old vanilla C, the first way would definitely be the preferred way of implementing an OO-style system. But you might consider freeing yourself of the OO paradigm entirely, then, and finding other ways to get the encapsulation and modularization you need.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27836 - sajiimori - Thu Oct 21, 2004 11:42 pm</h4>
    <div class="postbody"><span class="postbody">After he frees himself, how might he represent the state of a given animation and act upon it?
<br/>
<br/>
Oh, and the first way is so much better that it could be called the "correct" one.  If you write short functions and abstract over repetitive patterns, you'll find that the redundancy tends to be fairly managable.
<br/>
<br/>
For instance, what are you really describing in your example?  The way a game object should move and animate for a particular action (perhaps walking to the left)?  Try giving that set of variables a name, such as an "Action" or an "ActorMotion" or something along those lines, and make functions like "play_action" or "do_motion" or whatever.  Then you never have to repeat that sequence of calls again -- just make a new motion for walking to the left.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27841 - keldon - Fri Oct 22, 2004 1:09 am</h4>
    <div class="postbody"><span class="postbody">Why are you trying to avoid C++, it sounds like you're refusing it more than anything. As for redundant typing, <span style="text-decoration: underline">function ( object, param1 )</span> is no more characters than <span style="text-decoration: underline">object.function ( param 1 )</span>, unless you're going to count that extra space break between param1 and the comma =)
<br/>
<br/>
your Alt. 2 is similar to something you can do with classes (types) in Basic.
<br/>
<br/>
I think the only way to call a function directly from your struct is to do (something like) this
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">Struct structClass {
<br/>
   (void)(*structFunc)(int);   // this may be written a little differently
<br/>
   int num;
<br/>
}
<br/>
<br/>
structClass a = { a_structFunc };
<br/>
void a_structFunc ( int param1, 0 ) {
<br/>
   structFunc ( &amp;a, param1 );
<br/>
}
<br/>
<br/>
void structFunc ( structClass s, int param1 ) {
<br/>
   s.num = param1;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
and for every instance include its own structFunc.</span><span class="gensmall"><br/><br/>Last edited by keldon on Fri Oct 22, 2004 2:19 am; edited 2 times in total</span></div>    
</div>
<div class="post">
    <h4>#27850 - sajiimori - Fri Oct 22, 2004 1:59 am</h4>
    <div class="postbody"><span class="postbody">The redundancy is traditionally said to be in the function name, which is prefixed by the type of object that's being operated on.  You know, "dog-wash the dog, but car-wash the car"...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27854 - sgeos - Fri Oct 22, 2004 3:31 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">The redundancy is traditionally said to be in the function name, which is prefixed by the type of object that's being operated on.  You know, "dog-wash the dog, but car-wash the car"...</td> </tr></table><span class="postbody">
<br/>
That could potentially be fixed with the preprocessor tokenizer ## if you use the same prefix.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27856 - sajiimori - Fri Oct 22, 2004 6:53 am</h4>
    <div class="postbody"><span class="postbody">And how would the preprocessor know the type of the first argument?
<br/>
<br/>
Edit: I'm getting ahead of myself here.  Let's step back for a moment and realize that what you're suggesting is that every single function call be a macro expansion.  Um, no.  C is not extensible in the least, so be satisfied or use something else.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27858 - MumblyJoe - Fri Oct 22, 2004 12:08 pm</h4>
    <div class="postbody"><span class="postbody">Well... if by OOP you mean functions that modify structs you really aren't talking about many of the fundamentals of OOP anyway and your examples are perfectly adequate. However if you want to use some other features of OOP you may just want to bite the bullet and use c++.<br/>_________________<br/><a class="postlink" href="http://www.hungrydeveloper.com" target="_blank">www.hungrydeveloper.com</a>
<br/>
Version 2.0 now up - guaranteed at least 100% more pleasing!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27859 - keldon - Fri Oct 22, 2004 12:58 pm</h4>
    <div class="postbody"><span class="postbody">yes, I'm still confused why not. But does my suggestion work for you??? I might try it once I've finished my lab exercises.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27862 - poslundc - Fri Oct 22, 2004 2:17 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">After he frees himself, how might he represent the state of a given animation and act upon it?</td> </tr></table><span class="postbody">
<br/>
<br/>
Represent the state with a struct. Act upon it by directly manipulating the struct's members for simple state changes (set speed, set flipped, etc.). For more complicated state changes, maintain additional structs that specify how the objects are supposed to change over time and run module functions every frame that iterate over the list and apply those changes.
<br/>
<br/>
Not as elegant as OO, but then not everything has to be. :P
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27872 - sajiimori - Fri Oct 22, 2004 7:13 pm</h4>
    <div class="postbody"><span class="postbody">Alright, so let's assume animSetCurrentAnimation, animSetSpeed, animSetFlippedX, and animSetPosition are all easily replaced by direct struct assignments (which seems reasonable, though you know the drawbacks of each approach in C/C++).
<br/>
<br/>
Now let's say animPlaySequence involves more than one operation, in its function form.  Maybe it looks like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
Sequence* sequenceGet(int id);
<br/>
<br/>
void animPlaySequence(Animator* a, int sequence_id)
<br/>
{
<br/>
  a-&gt;sequence = sequenceGet(sequence_id);
<br/>
  a-&gt;current_frame = 0;
<br/>
  a-&gt;time_left = a-&gt;sequence-&gt;frames[0].duration;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
I can think of 2 ways to translate that abstraction into direct struct assignments: either manually inline the body of that function each time you want to do those operations, or do something like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
anim_hero.sequence_id = 3;
<br/>
anim_hero.flags |= ANIMATOR_FLAG_STARTING_NEW_SEQUENCE;
<br/>
</td> </tr></table><span class="postbody">
<br/>
And then defer the actual work to your per-frame iterators.
<br/>
<br/>
To both methods I say: ouch.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27874 - Gene Ostrowski - Fri Oct 22, 2004 7:31 pm</h4>
    <div class="postbody"><span class="postbody">If it helps, here's a sample of some of my code that I use to maintain my game "objects", and how to OOP-ize the code so that it's just "plain C" but get some of the benefits of OOP:
<br/>
<br/>
Part of my generic game object "class":
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
struct CObject
<br/>
{
<br/>
   s16 x;  
<br/>
   s16 y;  
<br/>
   s16 xoff; 
<br/>
   s16 yoff; 
<br/>
   s16 shapenum;
<br/>
. 
<br/>
.
<br/>
.
<br/>
   // here is the important stuff
<br/>
   void (*f_setup)(struct CObject* obj);
<br/>
   u8   (*f_move)(struct CObject* obj);
<br/>
   void (*f_preparedraw)(struct CObject* obj);
<br/>
   void (*f_project)(struct CObject* obj);
<br/>
<br/>
   void *data; // pointer to user defined data structure
<br/>
<br/>
};
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Then, I can use the function pointers to define functions that handle all of the methods that each object needs.  Each object is maintained in it's own file, to keep things together and make it more like "classes":
<br/>
<br/>
Then in a file called ObjDefault.cpp:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void setupDefault(struct CObject* obj) { // do something }
<br/>
u8 moveDefault(struct CObject* obj) { // do something }
<br/>
void preparedrawDefault(struct CObject* obj) { // do something } 
<br/>
void projectDefault(struct CObject* obj) { // do something } 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
In the file ObjPlayer.cpp:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void setupPlayer(struct CObject* obj) { // do something }
<br/>
u8 movePlayer(struct CObject* obj) { // do something }
<br/>
void preparedrawPlayer(struct CObject* obj) { // do something } 
<br/>
void projectPlayer(struct CObject* obj) { // do something } 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
In the file ObjShot.cpp:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void setupShot(struct CObject* obj) { // do something }
<br/>
u8 moveShot(struct CObject* obj) { // do something }
<br/>
void preparedrawShot(struct CObject* obj) { // do something } 
<br/>
void projectShot(struct CObject* obj) { // do something } 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
In the file ObjXXX.cpp:  (you get the idea)
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void setupXXX(struct CObject* obj) { // do something }
<br/>
u8 moveXXX(struct CObject* obj) { // do something }
<br/>
void preparedrawXXX(struct CObject* obj) { // do something } 
<br/>
void projectXXX(struct CObject* obj) { // do something } 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
Then I have a file that handles all the object management functions, for allocating, freeing, etc.  In this "object manager" file:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void SetObjectFunctions(struct CObject *obj, int type)
<br/>
{
<br/>
      obj-&gt;f_setup=&amp;setupDefault;
<br/>
      obj-&gt;f_move=&amp;moveDefault;
<br/>
      obj-&gt;f_preparedraw=&amp;preparedrawDefault;
<br/>
      obj-&gt;f_project=&amp;projectDefault;
<br/>
<br/>
       if (type==TYPE_PLAYER)
<br/>
     {
<br/>
         obj-&gt;f_setup=&amp;setupPlayer;
<br/>
         obj-&gt;f_move=&amp;movePlayer;
<br/>
         obj-&gt;f_preparedraw=&amp;preparedrawPlayer;
<br/>
         obj-&gt;f_project=&amp;projectPlayer;
<br/>
     }
<br/>
     else if (type==TYPE_SHOT)
<br/>
     {
<br/>
         obj-&gt;f_setup=&amp;setupShot;
<br/>
         obj-&gt;f_move=&amp;moveShot;
<br/>
         obj-&gt;f_preparedraw=&amp;preparedrawShot;
<br/>
         obj-&gt;f_project=&amp;projectShot;
<br/>
     }
<br/>
          else if ....
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
In actuality, though, this function is project specific, to keep the defines out of my object manager, thus allowing me to reuse my object manager libraries in all my projects.  This function isn't totally necessary either, since I can do it elsewhere, but it keeps things together...
<br/>
<br/>
Then, to actually get the benefit of this, things are kept clean and simple in the object management functions:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
struct CObject *AllocateObject(int type)
<br/>
{
<br/>
   struct CObject *newobj=NULL;   
<br/>
<br/>
   newobj=&lt;do whatever to allocate the object&gt;
<br/>
   if (newobj)
<br/>
   {
<br/>
      // set all the object's member functions
<br/>
      SetObjectFunctions(newobj, type);
<br/>
      // call the object's setup routine
<br/>
      newobj-&gt;f_setup(newobj); 
<br/>
      // do other stuff
<br/>
      return(newobj);
<br/>
   }
<br/>
   else return(NULL);
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Again, it keeps the code clean when you need to iterate over your object list and call the object's member functions:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
arbitrary_gameloop()  
<br/>
{
<br/>
   struct CObject *newobj=NULL;   
<br/>
<br/>
   // to allocate objects
<br/>
   newobj=AllocateObject(TYPE_PLAYER);
<br/>
   if (newobj) { // do something }
<br/>
   
<br/>
<br/>
   // to "process objects"
<br/>
   struct CObject *currentobj=NULL;   
<br/>
<br/>
   &lt;loop through all objects&gt;
<br/>
      currentobj=&lt;get the next object&gt;
<br/>
   
<br/>
      // call object function to move itself
<br/>
      currentobj-&gt;f_move(currentobj);
<br/>
      // call object function to project itself
<br/>
      currentobj-&gt;f_project(currentobj);
<br/>
      // call object function to set up parms to draw itself to screen
<br/>
      currentobj-&gt;f_preparedraw(currentobj);
<br/>
   &lt;next object&gt;
<br/>
}
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Of course, the "object iterators" are actually kept in with the object management functions, to allow me to reuse this logic in all my projects (i.e. I actually just call a generic "MoveObjects(objectlist)" function).
<br/>
<br/>
Each object knows how to setup, move, project, and draw itself.  Each object is maintained in it's own file to keep the code clean.  I can reuse the code in all my projects.  Etc.
<br/>
<br/>
This approach works very well.  It's fast too.  Plus, by "overriding" member functions you can "subclass" your objects to your heart's content.
<br/>
<br/>
The nice thing about all this is that I can avoid all the C++ overhead, avoid all new/delete allocations, and still retain a lot of the benefits that C++ provides.  It works well for the low memory, low speed, embedded environment  that is the GBA.
<br/>
<br/>
Hope that helps.<br/>_________________<br/>------------------
<br/>
Gene Ostrowski</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27876 - poslundc - Fri Oct 22, 2004 7:40 pm</h4>
    <div class="postbody"><span class="postbody">I'm unclear what the point you're making is. In 90% of cases for something like that I probably use the ancestor-of-OO method as well rather than excessive inlining or more hackneyed schemes. By "freeing himself of OO" I'm not suggesting he abandon useful and sensible coding practices. The point is to use the technique as a tool where it is best suited to the task, rather than trying to craft your program around a certain style.
<br/>
<br/>
Here's another way to think of it: I may write a function like that in a module of functions pertaining to a certain encapsulation of behaviour. I don't consider that as being a "specifically object-oriented function" as I'm writing it, though; it's just a function that takes a pointer to the struct it modifies. It's OOP that is derived from the more general technique, not the other way around. It may seem like quibbling over semantics, but I find it makes a huge difference when you don't feel confined to the rigours of a single paradigm while coding.
<br/>
<br/>
Dan.
<br/>
<br/>
<span style="font-weight: bold">Edit:</span> This was posted in response to sajimori two posts up; Gene's submission got in before mine.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27877 - poslundc - Fri Oct 22, 2004 7:46 pm</h4>
    <div class="postbody"><span class="postbody">And to Gene: dude, you are reinventing the wheel. The C++ overhead is apparently negligible so long as you are savvy in your coding, so if you like C++ then go ahead and use it.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27879 - sajiimori - Fri Oct 22, 2004 7:59 pm</h4>
    <div class="postbody"><span class="postbody">I think I'm mostly responding to "consider freeing yourself of the OO paradigm entirely, then, and finding other ways to get the encapsulation and modularization you need".  It seemed to imply that there are always other ways that are better (or even just as good), but now I see that's not what you meant.
<br/>
<br/>
As far as quibbling: If you write a program with a totally open mind as to the methodology, and the result happens to match the OO paradigm perfectly, did you write an OO program?  Who cares? ;)
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">The nice thing about all this is that I can avoid all the C++ overhead, avoid all new/delete allocations, and still retain a lot of the benefits that C++ provides. It works well for the low memory, low speed, embedded environment that is the GBA.</td> </tr></table><span class="postbody">I disagree in many ways.
<br/>
<br/>
Your method calls are slightly faster when compared to virtual functions (one less dereference operation), but it involves a large memory loss in situations where there are a lot of objects of a class with many "virtuals".
<br/>
<br/>
Object construction is slower in 3 ways: doing at least one assignment per method, initializing methods with the default values then overriding them with assignments, and switching on types.
<br/>
<br/>
If you don't use malloc/free, you lose exactly the same thing you lose if you don't use new/delete in C++ -- dynamic object allocation.  If you don't want that feature, don't use it.
<br/>
<br/>
Most importantly, it involves a lot of tedious manual labor that is best left to a computer.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27881 - poslundc - Fri Oct 22, 2004 8:10 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">I think I'm mostly responding to "consider freeing yourself of the OO paradigm entirely, then, and finding other ways to get the encapsulation and modularization you need".  It seemed to imply that there are always other ways that are better (or even just as good), but now I see that's not what you meant.</td> </tr></table><span class="postbody">
<br/>
<br/>
Looking back on what I said I see that it comes across that way. So to set the record straight: no, I'm not suggesting you abandon the techniques or even core values used in OOP. Rather, I'm saying you can do yourself a disservice if you bridle yourself to the methodology where it isn't automatically necessary.
<br/>
<br/>
I think my point makes itself evident from Gene's code, actually. You've written a needlessly complicated C infrastructure to simulate OO features, and dug yourself a big round hole in the process. I'm sure it works and does what you want it to, but if you're not careful, you may find yourself jamming square pegs into it.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27887 - keldon - Sat Oct 23, 2004 12:17 am</h4>
    <div class="postbody"><span class="postbody">On the free yourself from OO, I think that's important to do. Not to abandon it, or go against it; but to understand that there is possibly more. Some things still cannot be represented properly by OO .. our Systems Engineering lecturer was demonstrating them; if only I could remember them because they're so obviously procedral problems.
<br/>
<br/>
And reinventing the wheel is fine if you don't have to chew your way through Michelins to do it. But you're able to use C++, and the scope of your code is begging for classes. A simple animation struct is fine for this stuff; windows API manages with using structs.
<br/>
<br/>
But having said that you have done something that had probably seemed impossible to think of happening before. Some 20 years too late I may add though.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27890 - Touchstone - Sat Oct 23, 2004 2:37 am</h4>
    <div class="postbody"><span class="postbody">Oh, thanks for the discussion guys!
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">Well, if you really want to write your code like C++, you might consider using C++.</td> </tr></table><span class="postbody">
<br/>
I'm trying to keep the code as assembler-like as possible, with as few dependencies as possible and something I can access from assembler. Not because it's the "best" way to solve the problem, it's just that I want to solve the problem that way, I'm in an assembler kind of mood. You seem to assume that people don't want to reinvent the wheel. And as for Gene's code being needlessly complicated, function pointers offers stuff you cannot do in C++, but there's no argue that he has written a lot of code that basically do what c++ does for you automatically.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajimori wrote:</b></span></td> </tr> <tr> <td class="quote">If you write short functions and abstract over repetitive patterns, you'll find that the redundancy tends to be fairly managable.</td> </tr></table><span class="postbody">
<br/>
Yes, I like that idea.
<br/>
<br/>
<span style="font-weight: bold">Keldon</span>: Yeah, I was thinking of something like that but you still have to specify which object to work on twice. hero_anim.playSequence(&amp;anim_hero, 5);
<br/>
<br/>
<span style="font-weight: bold">Gene</span>: That's a way of solving other problems, and I have thought about doing something like that. It doesn't really solve my problem though, but you can do some pretty interesting stuff with function pointers, like instead of having a state-machine for your character idle physics for instance, by default it can be like a regular "affected by gravity"-drop but if for example you use a mini hot-air balloon power-up the function can be replaced with a "float upward" function instead, with simply a function pointer stack and some rules as to when a general purpose stack solver can just remove the latest function, making the character go back to his drop function. Mmmm, yes. (I'm really tired at the moment :)
<br/>
<br/>
Thanks again. Hope I haven't missed anything.<br/>_________________<br/>You can't beat our meat</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27892 - sajiimori - Sat Oct 23, 2004 3:01 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">...function pointers offers stuff you cannot do in C++...</td> </tr></table><span class="postbody">C++ <span style="font-style: italic">has</span> function pointers, and what's more, C++ offers method pointers which carry a pointer to both the code and an object.  Beat that! ;)
<br/>
<br/>
(Ok, closures win hands-down, but we're talking C/C++ land here.)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27893 - Abscissa - Sat Oct 23, 2004 3:48 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">...function pointers offers stuff you cannot do in C++...</td> </tr></table><span class="postbody">C++ <span style="font-style: italic">has</span> function pointers, and what's more, C++ offers method pointers which carry a pointer to both the code and an object.  Beat that! ;)
<br/>
<br/>
(Ok, closures win hands-down, but we're talking C/C++ land here.)</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Function pointers in C++ are kind of tricky, though, aren't they?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27894 - sajiimori - Sat Oct 23, 2004 4:03 am</h4>
    <div class="postbody"><span class="postbody">As far as I know, regular function pointers are the same in C++ as they are in C.  Pointers to non-static methods are a little weird, but I think I misremembered the details.
<br/>
<br/>
In my experience, function pointers get a lot less interesting as you start using C++ to its fullest.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27895 - poslundc - Sat Oct 23, 2004 4:39 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Touchstone wrote:</b></span></td> </tr> <tr> <td class="quote">Oh, thanks for the discussion guys!
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">Well, if you really want to write your code like C++, you might consider using C++.</td> </tr></table><span class="postbody">
<br/>
I'm trying to keep the code as assembler-like as possible, with as few dependencies as possible and something I can access from assembler. Not because it's the "best" way to solve the problem, it's just that I want to solve the problem that way, I'm in an assembler kind of mood. You seem to assume that people don't want to reinvent the wheel. And as for Gene's code being needlessly complicated, function pointers offers stuff you cannot do in C++, but there's no argue that he has written a lot of code that basically do what c++ does for you automatically.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
I'm not opposed to complicated code (well, I am, but for the sake of this explanation I'm not); I'm opposed to complicated infrastructures. I do some crazy shit with things like function pointers in my game, but the point is I use them on a case-by-case basis in situations that call for them, rather than trying to use them to build up a whole paradigm for the rest of my program to follow, such as OOP.
<br/>
<br/>
That's the kind of wheel that I don't think is worth reinventing. I use vanilla C because following the OOP paradigm isn't important to me. The code I write is complicated, but the infrastructure is almost always dead-simple.
<br/>
<br/>
It's when you're considering writing code basically just to do everything that C++ already does for you... that's when I think it's time to haul ass to Midas instead of trying to sand the corners down off of your triangles.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27896 - LOst? - Sat Oct 23, 2004 5:19 am</h4>
    <div class="postbody"><span class="postbody">And here we go....
<br/>
<br/>
<br/>
C vs C++, as in so many threads you have been going through this lately.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27897 - sajiimori - Sat Oct 23, 2004 5:26 am</h4>
    <div class="postbody"><span class="postbody">Honestly, I haven't found these discussions to be repetitive yet -- each time the subject comes up, it appears to be centered around a different aspect of programming style, technique, or philosophy.  It's rarely about technical differences.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27899 - LOst? - Sat Oct 23, 2004 5:41 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">Honestly, I haven't found these discussions to be repetitive yet -- each time the subject comes up, it appears to be centered around a different aspect of programming style, technique, or philosophy.  It's rarely about technical differences.</td> </tr></table><span class="postbody">
<br/>
<br/>
True. Just a warning of things to come. I'm too tired to read all the posts so this was a basic attemt to be smart which failed :P
<br/>
<br/>
I better shut up</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27901 - MumblyJoe - Sat Oct 23, 2004 10:21 am</h4>
    <div class="postbody"><span class="postbody">As for function pointers in C++, the language can do ANYTHING C can do and more, also compilers are usually more stirict when compiling in C++ mode and may find errors you made in C, which is a good thing.
<br/>
<br/>
Regardless of me trying to make you switch from a very old language to a pretty old language, I can't see the whole problem, looks like what you are trying to do works, so stick with it.<br/>_________________<br/><a class="postlink" href="http://www.hungrydeveloper.com" target="_blank">www.hungrydeveloper.com</a>
<br/>
Version 2.0 now up - guaranteed at least 100% more pleasing!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27904 - Touchstone - Sat Oct 23, 2004 1:41 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">...function pointers offers stuff you cannot do in C++...</td> </tr></table><span class="postbody">C++ <span style="font-style: italic">has</span> function pointers, and what's more, C++ offers method pointers which carry a pointer to both the code and an object.</span></td> </tr></table><span class="postbody">
<br/>
Yes of course.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">That's the kind of wheel that I don't think is worth reinventing.</td> </tr></table><span class="postbody">
<br/>
The important part is that it is YOUR opinion that it's not worth reinventing, not necessarily mine. Go ahead and recommend changing to C++ for those that are willing to do so but you are not really helping me with my problem. Thanks for trying though, I honestly appreciate it.<br/>_________________<br/>You can't beat our meat</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27906 - keldon - Sat Oct 23, 2004 4:12 pm</h4>
    <div class="postbody"><span class="postbody">with my suggestion you should be able to access a function using object.functionName (params) not object.functionName ( object, params).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27913 - sajiimori - Sat Oct 23, 2004 6:11 pm</h4>
    <div class="postbody"><span class="postbody">Touchstone, everything that's said here is the opinion of the speaker, whether they present it that way or not (and Dan even said "...I don't <span style="font-style: italic">think</span>...").  For example, the previous sentence does not have extra verbiage to specify that it is only my belief and that my beliefs do not affect reality.  I find such "disclaimers" to be a waste of space.
<br/>
<br/>
So, when you say "that's your opinion", what I hear is "don't post in MY thread unless you're going to say something I like".  But this is not your thread -- it's gbadev's thread.  You should be grateful that anybody bothered to reply at all.  Feel free to ignore posts that are not of interest to you.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27919 - Touchstone - Sat Oct 23, 2004 11:28 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>keldon wrote:</b></span></td> </tr> <tr> <td class="quote">with my suggestion you should be able to access a function using object.functionName (params) not object.functionName ( object, params).</td> </tr></table><span class="postbody">
<br/>
Ah, yes, I missed that the first time I read your post. That's cool. It does require a few of extra functions, and each object has to be in file-scope. An interesting idea.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">Touchstone, everything that's said here is the opinion of the speaker, whether they present it that way or not</td> </tr></table><span class="postbody">
<br/>
Yes, of course.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">So, when you say "that's your opinion", what I hear is "don't post in MY thread unless you're going to say something I like". But this is not your thread -- it's gbadev's thread. You should be grateful that anybody bothered to reply at all. Feel free to ignore posts that are not of interest to you.</td> </tr></table><span class="postbody">
<br/>
I AM grateful, I even wrote so in the end of my reply to him. And I really don't want to just ignore someone that answer a question of mine just because I don't like the answer. And if you think I'm a bastard then please understand that english is not my native tounge so what I mean to say might not be what I end up writing, even though it looks exactly the same to me. What I meant with my reply to him was that he is not helping me solve my problem the way I want to solve it.
<br/>
<br/>
I'm sorry if I upset anyone, of course I don't want to do that.<br/>_________________<br/>You can't beat our meat</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27923 - keldon - Sun Oct 24, 2004 2:24 am</h4>
    <div class="postbody"><span class="postbody">well your english is better than mine; so I don't think you are doing too bad</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27941 - Gene Ostrowski - Sun Oct 24, 2004 6:05 pm</h4>
    <div class="postbody"><span class="postbody">I thought long and hard about posting code as a reply to this thread, knowing:
<br/>
<br/>
1) It would be blasted by those who don't understand it or think it's needless work or reinventing the wheel or overly complicated or pointless to do it this way or blah blah blah
<br/>
2) It would turn into a C vs. C++ "argument".
<br/>
<br/>
I decided to post it anyway.
<br/>
<br/>
The original post was asking about writing OO C code, which is what my reply was addressing.  He clearly was not asking "What's better for OO code, C or C++?", which is what most people in this thread are discussing.  If you guys want to argue this, go to the other threads that specifically discusses that topic.
<br/>
<br/>
To write OO code in C, of <span style="font-weight: bold">course </span>you have to do things that C++ compilers do for you,  that's the whole point.  Why is this point even being discussed?
<br/>
<br/>
When he asked the original question, I assumed that he had worked out the C vs. C++ issue on his own (and decided to stick with C for his own reasons), and was merely looking for guidance on how to code it <span style="font-weight: bold">in C</span> for use in his object manager.
<br/>
<br/>
I'm sure many of you are seasoned software engineers, as am I.  I've learned over the years that it's almost pointless to debate things that involve too many shades of grey, including opinions and style.  I fully understand every point that was brought up, and for every argument "If you do A then you can't do B or must do C", an equally valid argument of "but if I do A I can also do D" or "but I can then do B by doing E without doing F",<span style="font-style: italic"> ad infinitum</span>.
<br/>
<br/>
As a software engineer, I look at what I have to accomplish given the constraints, and decide which tool to use to do it.  For what it's worth, I actually <span style="font-style: italic">had </span>my object manager written in OO C++, but decided to convert it to straight C because I wanted to make it faster and bring the code closer to my new, simplified implementation.
<br/>
<br/>
"There's more than one way to skin a cat."
<br/>
"When all you have is a hammer, everything looks like a nail."<br/>_________________<br/>------------------
<br/>
Gene Ostrowski</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27942 - tepples - Sun Oct 24, 2004 6:25 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">If you don't use malloc/free, you lose exactly the same thing you lose if you don't use new/delete in C++ -- dynamic object allocation.  If you don't want that feature, don't use it.</td> </tr></table><span class="postbody">
<br/>
Not exactly. The other thing new and delete do is run your class's constructors, and they can run your constructors even in semi-static situations when you use the <a class="postlink" href="http://www.parashift.com/c++-faq-lite/dtors.html#faq-11.14" target="_blank">"placement new" form</a>.
<br/>
<br/>
Anyway, language wars go in the C/C++ thread. Moved.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27944 - Gene Ostrowski - Sun Oct 24, 2004 6:48 pm</h4>
    <div class="postbody"><span class="postbody">Touchstone wrote:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Gene: That's a way of solving other problems, and I have thought about doing something like that. It doesn't really solve my problem though, but you can do some pretty interesting stuff with function pointers, like instead of having a state-machine for your character idle physics for instance, by default it can be like a regular "affected by gravity"-drop but if for example you use a mini hot-air balloon power-up the function can be replaced with a "float upward" function instead, with simply a function pointer stack and some rules as to when a general purpose stack solver can just remove the latest function, making the character go back to his drop function. Mmmm, yes. (I'm really tired at the moment :) </td> </tr></table><span class="postbody">
<br/>
<br/>
You get the idea.  It's actually quite powerful as a supplement to normal state-management.   I do still keep a state-machine for the objects, though, and don't rely on modifying function pointers for <span style="font-weight: bold">all </span>the state changes, to keep the code clean.  For the example you gave about switching the "gravity" drop to the "float up" drop, I do this only if the function has no object-specific logic in it.    
<br/>
<br/>
In other words, I'd keep the object's move function as movePlayer(), and would keep a state variable handy within that function to determine if I needed to use the gravity logic or the lift logic.  Of course, this is just how I'd do it, as there are many ways-- this approach is abstracted enough that it should handle just about anything you'd throw at it.
<br/>
<br/>
If you have a spaceship object that gets hit by a missile, you can call changeObject(obj, TYPE_EXPLOSION) which will set the object's type, move, and draw functions to the "explosion" routines, then forget the object forever letting the object manage itself at that point:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">// does it collide with the missile
<br/>
if (obj-&gt;checkCollision(missileobj))
<br/>
{
<br/>
    // yes, turn it into an explosion object
<br/>
    ChangeObject(obj, TYPE_EXPLOSION);
<br/>
    // stop processing it as a spaceship anymore
<br/>
    break;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
At this point, the object's "functions" will be replaced with the functions that handle animating explosions, adding particles, etc.  As far as the system is concerned, it's no longer a spaceship.  Somewhere in the explosion routines will be logic to determine the end of the lifecycle for the object and will delete itself.  The point is that there is no logic in the "spaceship" code for managing what at this stage is just an "explosion" object.   Just my coding style, and you may find something else that works for you equally as well.
<br/>
<br/>
You mention that it won't address the specific problem you are having:  can you elaborate on what exactly you are trying to do?<br/>_________________<br/>------------------
<br/>
Gene Ostrowski</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27960 - sajiimori - Mon Oct 25, 2004 5:34 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I've learned over the years that it's almost pointless to debate things that involve too many shades of grey, including opinions and style.</td> </tr></table><span class="postbody">I'm very interested in style, and I think it's an important subject even if there are no absolute answers.  If nothing else, I enjoy talking about it.
<br/>
<br/>
I also don't feel guilty about letting a thread wander about in its natural course -- the ideas tend to flow more freely that way.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">The other thing new and delete do is run your class's constructors, and they can run your constructors even in semi-static situations when you use the "placement new" form.</td> </tr></table><span class="postbody">Right, I should have said you lose dynamic object allocation if you don't use malloc/free (or some variant thereof), just as you lose dynamic object allocation if you don't use new/delete (or some variant thereof), though you also lose other capabilities if you don't use new/delete.  But that's hard to say, and the simple-yet-not-quite-accurate version seemed to get the point across. =P</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27969 - Gene Ostrowski - Mon Oct 25, 2004 4:54 pm</h4>
    <div class="postbody"><span class="postbody">sajiimori:
<br/>
Yes, duscussions about style can be interesting, but there's a fine line between discussion and debate.  It's always ok to discuss things, as that's how horizons are broadened, but here's a scenario that has probably never happened in the history of communication:
<br/>
<br/>
Alice: I love spinach.
<br/>
Bob: Uungh.  Spinach is so nasty.  It tastes disgusting.
<br/>
Alice: No, it tastes good.  And it's full of vitamins and its so healthy for you. 
<br/>
Bob: Oh, now I see your points.  Oh well, I guess I love it now after all.<br/>_________________<br/>------------------
<br/>
Gene Ostrowski</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27975 - tepples - Mon Oct 25, 2004 5:56 pm</h4>
    <div class="postbody"><span class="postbody">It has at my dad's house.
<br/>
-- I hate spinach!
<br/>
-- It has vitamins.
<br/>
-- Perhaps if I put some syrup on it to disguise the taste...
<br/>
-- Here's some.
<br/>
-- I can handle this.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27977 - keldon - Mon Oct 25, 2004 6:01 pm</h4>
    <div class="postbody"><span class="postbody">or at my house:
<br/>
-- Mr Keldon I don't like spinach
<br/>
-- I told you to eat it, now shut up
<br/>
-- no, I don't like it
<br/>
-- you can either have vitamins or no playstation
<br/>
-- ok, I like it now
<br/>
=D isn't babysitting cool</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27988 - sajiimori - Mon Oct 25, 2004 7:58 pm</h4>
    <div class="postbody"><span class="postbody">I like debate, too.  (Sorry?)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27997 - Abscissa - Mon Oct 25, 2004 9:12 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>keldon wrote:</b></span></td> </tr> <tr> <td class="quote">or at my house:
<br/>
-- Mr Keldon I don't like spinach
<br/>
-- I told you to eat it, now shut up
<br/>
-- no, I don't like it
<br/>
-- you can either have vitamins or no playstation
<br/>
-- ok, I like it now
<br/>
=D isn't babysitting cool</td> </tr></table><span class="postbody">
<br/>
<br/>
lol, I go away for a few hours and look what happens to the C vs C++ thread. ;)
<br/>
<br/>
I think someone warned earlier that these new language vs old language debates can get really out of hand, but did anybody listen? Nooo! And now see what happens? :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#28050 - Touchstone - Tue Oct 26, 2004 4:13 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Abscissa wrote:</b></span></td> </tr> <tr> <td class="quote">I think someone warned earlier that these new language vs old language debates can get really out of hand</td> </tr></table><span class="postbody">
<br/>
This thread didn't even start out as a language vs. language discussion either, it just seems like that's what people like to talk about. Well, this should learn me never to ask a question. :-)<br/>_________________<br/>You can't beat our meat</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
