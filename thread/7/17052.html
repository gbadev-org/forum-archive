<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>warning: deprecated conversion [solved] - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>C/C++ > warning: deprecated conversion [solved]</h2>
<div id="posts">
<div class="post">
    <h4>#172048 - zelbo - Mon Jan 11, 2010 9:43 pm</h4>
    <div class="postbody"><span class="postbody">When i compile my program, i get the following warning:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">c:/devkitPro/projects/Quest_yarlds0.0.0c/source/gameMain.cpp: In function 'int main()':
<br/>
c:/devkitPro/projects/Quest_yarlds0.0.0c/source/gameMain.cpp:199: warning: deprecated conversion from string constant to 'char*'</td> </tr></table><span class="postbody">
<br/>
Is this warning a problem? how would i fix this? do i need to fix this?
<br/>
I've fiddled with it a lot and so far this is what i've gotten to 'work', but i'm not sure it's the right way to do it.
<br/>
<br/>
the relevant parts:(lots of other crap chopped out for your convenience)
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include &lt;string.h&gt;
<br/>
<br/>
char message;
<br/>
<br/>
void printMessage(PrintConsole pConsole, char* message)
<br/>
<br/>
{
<br/>
   consoleSelect(&amp;pConsole);
<br/>
   iprintf("\x1b[02;00H\n%s", message);
<br/>
}
<br/>
<br/>
int main(void)
<br/>
{
<br/>
// snip - console set up, screen mode initialize, blah blah blah...
<br/>
<br/>
   printMessage(winMessage, "You see Steve the Kobold.");
<br/>
<br/>
   while(1)
<br/>
   {
<br/>
      
<br/>
   }
<br/>
   return 0;
<br/>
}</td> </tr></table><span class="postbody"></span><span class="gensmall"><br/><br/>Last edited by zelbo on Tue Jan 12, 2010 2:59 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#172051 - kusma - Mon Jan 11, 2010 10:27 pm</h4>
    <div class="postbody"><span class="postbody">A string-literal ("text inside quotes") is "const char *" in C, not "char *". So when you're calling printMessage() with a string-literal parameter, you're casting away the const-ness of it. For this reason, some C compilers used to have implicit conversion from "const char *" to "char *", but this have been deprecated.
<br/>
<br/>
Change the prototype of printMessage() to "void printMessage(PrintConsole pConsole, const char* message)" to get rid of it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172059 - zelbo - Tue Jan 12, 2010 2:59 am</h4>
    <div class="postbody"><span class="postbody">Awesome. Thank you!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172062 - Ruben - Tue Jan 12, 2010 11:28 am</h4>
    <div class="postbody"><span class="postbody">Hopefully this time I haven't overlooked something &gt;_&gt;'
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">char message; //1st declaration of a variable name 'message'
<br/>
<br/>
//another dec? I would recommend that it be changed, or better yet, name the previous variable "gMessage" for 'global'
<br/>
void printMessage(PrintConsole pConsole, char* message)
<br/>
<br/>
{
<br/>
   consoleSelect(&amp;pConsole);
<br/>
   iprintf("\x1b[02;00H\n%s", message);
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
EDIT:
<br/>
<br/>
And yeah, you need to make the string type "const char*" as all variables that can't/shouldn't be edited are constant.
<br/>
<br/>
Also, I'm not sure how libnds works, but wouldn't it be more... 'correct' to pass off a *pointer* to the print console rather than the whole struct?</span><span class="gensmall"><br/><br/>Last edited by Ruben on Tue Jan 12, 2010 4:31 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#172064 - Dwedit - Tue Jan 12, 2010 3:24 pm</h4>
    <div class="postbody"><span class="postbody">You aren't changing the message, so you should declare it "const char *" rather than char*.
<br/>
<br/>
If you don't, you won't be able to pass in string literals.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172065 - kusma - Tue Jan 12, 2010 4:36 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dwedit wrote:</b></span></td> </tr> <tr> <td class="quote">You aren't changing the message, so you should declare it "const char *" rather than char*.
<br/>
<br/>
If you don't, you won't be able to pass in string literals.</td> </tr></table><span class="postbody">
<br/>
<br/>
If you're referring to Ruben's post, I think he was referring to the superfluous "char message;"...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172068 - zelbo - Tue Jan 12, 2010 9:25 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Also, I'm not sure how libnds works, but wouldn't it be more... 'correct' to pass off a *pointer* to the print console rather than the whole struct?</td> </tr></table><span class="postbody">Probably, but i'm not very good with pointers yet and this is the only way i could get it to work. I tried a few variations with pointers and addresses and blahblahblah everything i did broke it but good. If someone can show me how to do this right, i would appreciate it.
<br/>
I think this falls into the area of stuff i would call "bad habits i need to break before it's too late". There are a few other things i'm struggling with, but i'd like to try to figure them out before i ask for help.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172071 - Ruben - Tue Jan 12, 2010 10:53 pm</h4>
    <div class="postbody"><span class="postbody">Well, to pass it off as a pointer, you simply change the declaration to "void printMessage(PrintConsole *pConsole, const char* message)" and when passing the console, you use "printMessage(&amp;myConsole, "Hello World!")"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172074 - zelbo - Wed Jan 13, 2010 1:41 am</h4>
    <div class="postbody"><span class="postbody">As for the extra declaration, yeah, i'm not using that one. i put it there while trying to make it work, but i've since gotten rid of it. actually, i'm thinking about putting the whole message system into a class and making a message object to handle all that. object oriented, you know?</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
