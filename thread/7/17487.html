<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Signed vs Unsigned integer divisions and modulus - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>C/C++ > Signed vs Unsigned integer divisions and modulus</h2>
<div id="posts">
<div class="post">
    <h4>#175959 - sverx - Thu Mar 10, 2011 5:26 pm</h4>
    <div class="postbody"><span class="postbody">I guess I'm asking one of these things that they teach in high school but either I was sleeping or the school wasn't as good as I'd want it to be... BTW:
<br/>
<br/>
Do the integer divisions (and modulus) operations between a variable (the dividend) and a constant value, power of 2 [2^n] (the divisor) generate different ARM ASM code when the variable is unsigned vs. signed? And are the operations on the former faster?
<br/>
<br/>
Thanks :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175960 - Dwedit - Thu Mar 10, 2011 11:47 pm</h4>
    <div class="postbody"><span class="postbody">Right shift is different depending on whether it's signed or not, so that the sign bit is preserved.  Otherwise, they are the same.  Doesn't matter whether you write x &gt;&gt; 4 or x/16, it's the same asm.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175961 - Ruben - Fri Mar 11, 2011 5:48 am</h4>
    <div class="postbody"><span class="postbody">Dividing by a signed power of two needs a bit more baggage (cmp, addmi) to round the number to zero (ASR rounds to -infinity).
<br/>
<br/>
Read TONC ;D</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175962 - sverx - Fri Mar 11, 2011 9:55 am</h4>
    <div class="postbody"><span class="postbody">Thank you both. If I understand correctly, if there's no real reason to use a signed, then it's better to use an unsigned, right? :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175963 - Ruben - Fri Mar 11, 2011 10:07 am</h4>
    <div class="postbody"><span class="postbody">Mhm.
<br/>
<br/>
Here's the article at Cearn's site (turns out it wasn't TONC afterall =P): <a class="postlink" href="http://www.coranac.com/2009/08/signs-from-hell/#ssec-prob-div" target="_blank">Linky</a>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">... There are some other consequences besides the obvious difference in results. First, there's how compilers deal with it. Compilers are very well aware that a bit-shift is faster than division and one of the optimizations they perform is replacing divisions by shifts where appropriate. For unsigned numerals the division will be replaced by a single shift. <span style="font-weight: bold">However, for signed variables some extra instructions have to added to correct the difference in rounding.</span></td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175964 - sverx - Fri Mar 11, 2011 10:44 am</h4>
    <div class="postbody"><span class="postbody">I went to run a test. For the work I needed to be done, the time required went from 22 scanlines down to 18 scanlines, after I changed my <span style="font-style: italic">short ints</span> with <span style="font-style: italic">unsigned short ints</span>. It's 18% faster :)
<br/>
(Since I needed to store values from 0 to 4095 plus a 'null' value that I defined as '-1' I had to change that 'null' to 0xFFFF but anyway I see it was a good choice :) )</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175965 - Ruben - Fri Mar 11, 2011 10:50 am</h4>
    <div class="postbody"><span class="postbody">Usually, you'll want to use 'signed int' or 'unsigned int' for types unless you ABSOLUTELY have to, but even then there's work arounds.
<br/>
<br/>
For example:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">//! When doing addition/subtraction/storing
<br/>
//! You truncate only if you need to use multiplication/division
<br/>
0x6382 + 0xFF28 = 0x162AA [truncated to 16-bit, this is still correct]
<br/>
0x6382 - 0xFF28 = 0xF645A [ditto]
<br/>
<br/>
//! When multiplying/dividing
<br/>
val &lt;&lt;= 16; //! get rid of carry area
<br/>
val &gt;&gt;= 16; //! shift back to 16-bit
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175980 - sverx - Mon Mar 14, 2011 12:50 pm</h4>
    <div class="postbody"><span class="postbody">Thanks, I'll follow your advices :)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
