<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Using structs and bitfields to map memory - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>C/C++ > Using structs and bitfields to map memory</h2>
<div id="posts">
<div class="post">
    <h4>#11353 - jerkize - Fri Oct 03, 2003 2:13 am</h4>
    <div class="postbody"><span class="postbody">I'm still new to GBA development.  In all of the sample code that I've
<br/>
seen, everyone is using symbols and bit shifting to modify sections of
<br/>
GBA memory.  Does anyone see any pros/cons with mapping a struct to
<br/>
GBA memory?  As an example, here's what I'm doing for sprites (please
<br/>
excuse my variable names if they don't make sense):
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
  typedef struct Sprite {
<br/>
    u16 y                 : 8;
<br/>
    u16 allow_transforms  : 1;
<br/>
    u16 double_it         : 1;
<br/>
    u16 alpha_mode        : 2;
<br/>
    u16 allow_zoom        : 1;
<br/>
    u16 color_mode        : 1;
<br/>
    u16 yshape            : 2;
<br/>
    u16 x                 : 9;
<br/>
    u16 scale             : 3;
<br/>
    u16 hflip             : 1;
<br/>
    u16 vflip             : 1;
<br/>
    u16 xshape            : 2;
<br/>
    u16 id                : 10;
<br/>
    u16 priority          : 2;
<br/>
    u16 palette           : 4;
<br/>
    u16 rotation_register : 16;
<br/>
  };
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
These are what I see as the benefits: <ul>
<br/>
<br/>
<li>The code is more self-documenting.
<br/>
<br/>
</li><li>It is simpler to modify a field, meaning you don't have to OR
<br/>
everything together just to update, say, the x position.
<br/>
<br/>
</li><li>I'm <span style="font-weight: bold">hoping</span> it is faster but this is just a gut feeling, nothing more.
<br/>
<br/>
</li></ul>
<br/>
<br/>
Thanks for any feedback.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11356 - tepples - Fri Oct 03, 2003 3:32 am</h4>
    <div class="postbody"><span class="postbody">Big con: Different compilers have different ideas of how to lay out the bits in a bitfield, so your code may break from one version of the compiler's C ABI to the next.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11370 - torne - Fri Oct 03, 2003 4:28 pm</h4>
    <div class="postbody"><span class="postbody">It's not faster; it's exactly the same speed at best; and as tepples said, there is no requirement that bitfields in a struct are composed in the same way between different compilers, so if an ABI change happens your code will break. =)
<br/>
<br/>
Also, if you use bitfields, then it will be slower if you DO want to change more than one entry at a time: if you change, say, the X and the Y location through bitfield access, it will be two binary operations as the compiler doesn't seem to be able to optimise across them, whereas if you do it with shifts..etc it will only be one (albiet a slightly more complex one, but the code I just compiled and disassembled was much better than the bitfield case).</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
