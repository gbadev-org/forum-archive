<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Bitmap error - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>C/C++ > Bitmap error</h2>
<div id="posts">
<div class="post">
    <h4>#130636 - ShadowX - Wed Jun 06, 2007 12:47 am</h4>
    <div class="postbody"><span class="postbody">I tried to draw a bitmap in GBA using C.
<br/>
Look what happens:
<br/>
<a href="http://img529.imageshack.us/img529/6895/errorhl8.png" target="_blank">http://img529.imageshack.us/img529/6895/errorhl8.png</a>
<br/>
<br/>
I used this code:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
int main()
<br/>
{
<br/>
    u16 loop,x;
<br/>
    SetMode( MODE_4 | BG2_ENABLE );
<br/>
    for (loop=0;loop&lt;256;loop++)
<br/>
    {
<br/>
       BG_PaletteMem[loop]=palette[loop];
<br/>
    }
<br/>
    for (x=0;x&lt;(240*160);x++)
<br/>
    {
<br/>
        FrontBuffer[x]=bitmap[x];
<br/>
    }
<br/>
    return 0;
<br/>
}
<br/>
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130638 - Lick - Wed Jun 06, 2007 12:52 am</h4>
    <div class="postbody"><span class="postbody">Try copying in shorts instead of bytes.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">unsigned short *FrontBuffer = ....;
<br/>
<br/>
for (x=0; x&lt;240*160/2; x++)
<br/>
{
<br/>
    FrontBuffer = ((unsigned short*)bitmap)[x];
<br/>
}</td> </tr></table><span class="postbody"><br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130671 - gmiller - Wed Jun 06, 2007 12:54 pm</h4>
    <div class="postbody"><span class="postbody">as Lick said do the copy in shorts because video memory must be written 16 bits at a time.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130672 - ScottLininger - Wed Jun 06, 2007 2:12 pm</h4>
    <div class="postbody"><span class="postbody">Just from the image, it looks like you might be writing some sprites or other tiles into your vram in the wrong spot. Try commented out any code besides your image writing routine.
<br/>
<br/>
-Scott</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130682 - ShadowX - Wed Jun 06, 2007 4:35 pm</h4>
    <div class="postbody"><span class="postbody">Are you sure that is's not necessary the array's number?
<br/>
<br/>
I tried to convert the image using other tool.
<br/>
The result: <a href="http://img394.imageshack.us/img394/5223/errornd4.png" target="_blank">http://img394.imageshack.us/img394/5223/errornd4.png</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130752 - Cearn - Thu Jun 07, 2007 1:45 pm</h4>
    <div class="postbody"><span class="postbody">It may help if we could see the original image, the declaration of the data array and which tool(s) and which settings you used to convert the image.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130757 - ShadowX - Thu Jun 07, 2007 3:54 pm</h4>
    <div class="postbody"><span class="postbody">Original image in 256 colors: <a href="http://www.aaronrogers.com/ham/Day4/gfx/bg.bmp" target="_blank">http://www.aaronrogers.com/ham/Day4/gfx/bg.bmp</a>
<br/>
<br/>
I used "BMP2GBA" in second post.
<br/>
<br/>
If I try to convert using a CommandLine tool it shows the window. And close.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130918 - tepples - Sat Jun 09, 2007 5:33 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ShadowX wrote:</b></span></td> </tr> <tr> <td class="quote">If I try to convert using a CommandLine tool it shows the window. And close.</td> </tr></table><span class="postbody">
<br/>
<span style="font-weight: bold">Q: I've downloaded a program, but when I double-click its icon in Windows Explorer, a window filled with black opens and closes so quickly that I cannot read it. How do I use this program? </span>
<br/>
<br/>
<a class="postlink" href="http://forum.gbadev.org/viewtopic.php?p=6770#6770" target="_blank">Answered in FAQ</a>.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130953 - Cearn - Sat Jun 09, 2007 3:51 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ShadowX wrote:</b></span></td> </tr> <tr> <td class="quote">Original image in 256 colors: <a href="http://www.aaronrogers.com/ham/Day4/gfx/bg.bmp" target="_blank">http://www.aaronrogers.com/ham/Day4/gfx/bg.bmp</a></td> </tr></table><span class="postbody">Right, so it's not just the image that goes wonky, it's the palette as well.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ShadowX wrote:</b></span></td> </tr> <tr> <td class="quote">I used "BMP2GBA" in second post.</td> </tr></table><span class="postbody">There are several tools of that name; you're to have to be a little more specific :P. Also try <a class="postlink" href="http://www.gbadev.org/tools.php?showinfo=142" target="_blank">gfx2gba</a> or <a class="postlink" href="http://www.coranac.com/projects.php#grit" target="_blank">grit</a>/<a class="postlink" href="http://www.coranac.com/projects.php#usenti" target="_blank">usenti</a>. Those tools are pretty common and known to work properly.
<br/>
<br/>
Post the first few lines of the palette and bitmap arrays, that should show a few things. Most importantly, are they 'const' arrays?
<br/>
<br/>
As the others have indicated, VRAM needs to be written to in 16bit chunks (well, that or 32bit). I expect that <span style="font-style: italic">bitmap</span> is already 16bit so the datatype should be a problem, but what is is that you copy too much: 240x160 is the size of the bitmap in bytes, not halfwords. Divide by two to get the number of halfwords (see Lick's post). Better yet, just use memcpy().</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130975 - ShadowX - Sat Jun 09, 2007 8:15 pm</h4>
    <div class="postbody"><span class="postbody">"Grit" works!
<br/>
Can "Grit" convert to GBA sprite?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130987 - Cearn - Sat Jun 09, 2007 9:17 pm</h4>
    <div class="postbody"><span class="postbody">Yes. Sprite (aka object) graphics are just a special-case of tiled graphics. Objects effectively make use of tiled tiles (i.e., tiles made up of tiles; meta-tiles), use the Meta/Obj settings to whatever size meta-tiles you need. Note that the units of the meta-tiles are in tiles, though, not pixels</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
