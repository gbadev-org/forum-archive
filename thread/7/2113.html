<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Makefile - Confusing error msg - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>C/C++ > Makefile - Confusing error msg</h2>
<div id="posts">
<div class="post">
    <h4>#10965 - Ruiner - Mon Sep 22, 2003 2:54 am</h4>
    <div class="postbody"><span class="postbody">New to makefiles. I have always used visual studio so this is all new to me. Here is the error I am getting.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
c:/devkitadv/bin/gcc -c source/main.cpp -obin/main.o -I./data -I./include -Ic:/devkitadv/lib/gcc-lib/arm-agb-elf/3.2.2/include -IC:/devkitadv/arm-agb-elf/inclue -mthumb -mthumb-interwork -c -g -Wall -fverbose-asm
<br/>
<br/>
c:\Docume~1\Therui~1\Locals~1\Temp/ccUxaaaa.s: Assembler messages:
<br/>
c:\Docume~1\Therui~1\Locals~1\Temp/ccUxaaaa.s:1029: Error: invalid offset value to big (0xFFFFFFF8)
<br/>
make: *** [bin/main.o] Error 1
<br/>
</td> </tr></table><span class="postbody">
<br/>
Can anyone help me figure out how to fix it? It compiles fine with my old makefile but I decided to modify it learning from the SGADE makefile because I wasn't sure how to add in crt0.o and link in includes on my own.
<br/>
<br/>
The main changes from what I had before are from this:
<br/>
    CFLAGS = -c -O  -I $(INCDIR2) -I $(INCDIR) -g -O2
<br/>
to this:
<br/>
    C_FLAGS  = -I$(DAT_DIR) -I$(INC_DIR) -mthumb -mthumb-interwork -c -g -Wall -fverbose-asm
<br/>
<br/>
and linked with this.
<br/>
   L_FLAGS = -T $(LINK_SCRIPT_DIR)/lnkscript -lg -lc -lgcc</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10966 - sajiimori - Mon Sep 22, 2003 5:27 am</h4>
    <div class="postbody"><span class="postbody">Hopefully somebody else will have a real answer, but here's at least a start.
<br/>
<br/>
Forget about the linker for the moment, because the compile isn't getting that far.  It's also not make's fault.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
C_FLAGS = -I$(DAT_DIR) -I$(INC_DIR) -mthumb -mthumb-interwork -c -g -Wall -fverbose-asm
<br/>
</td> </tr></table><span class="postbody">
<br/>
If -fverbose-asm, -mthumb, and -mthumb-interwork are the new additions, then try removing those.  If it works after that, let us know.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
-IC:/devkitadv/arm-agb-elf/inclue
<br/>
</td> </tr></table><span class="postbody">
<br/>
Typo?  Probably not relevant to the error, though.
<br/>
<br/>
Just a guess, but try adding -mlong-calls to cflags.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11008 - Ruiner - Tue Sep 23, 2003 10:51 am</h4>
    <div class="postbody"><span class="postbody">Ok, I fixed the problem by removing crtbegin and crtend which i read you have to include if you wanted to use c++. I really have no clue what they are but it works w/o them. So now I want to know if that was being caused by -mthumb interwork then what have i possibly done wrong in my code that is preventing thumb code from compiling?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11037 - sajiimori - Wed Sep 24, 2003 12:10 am</h4>
    <div class="postbody"><span class="postbody">I don't know how the error could have been fixed by changing your linker options, since the error you posted was from the assembler (which is used before the linker).
<br/>
<br/>
I also don't know why you would think -mthumb-interwork was causing the problem, if you already solved it by changing your linker options.
<br/>
<br/>
In other words, I have no idea what you're talking about. :-/
<br/>
<br/>
BTW, try using g++ instead of gcc when compiling C++ code, so it'll automatically link in the right stuff (no need to worry about crts).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11113 - Ruiner - Fri Sep 26, 2003 4:55 am</h4>
    <div class="postbody"><span class="postbody">Erm, man i need to smack myself about the head a few times here and there. Im sorry I was probably typing on nyquil while my wife was talking to me and my daughter was screaming. My family has been sick for the past week straight and its a mad house. Im surprised I get anything done :)
<br/>
<br/>
Ok I removed the -mthumb first and it assembled but I got another error. I removed crtbegin and end and it compiled and worked beautifully. So what I was wanting to know was what might be happening to cause -mthumb interwork to make that error.
<br/>
<br/>
And now I also want to ask what crtbegin and end is? I was only copying them over because there was a paragraph saying you had to include them in a c++ project.
<br/>
<br/>
Finally if g++ links everything correctly then will I need to include everything that needs to be linked in my g++ command line or is it automagical detecting what I have included in my headers? My project is separated in diferent folders and my current setup allows me to compile w/o having to specify which folder each include is in.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
# PROJECT
<br/>
# --------------------------------------------------------------------
<br/>
ROM = project.gba
<br/>
ELF = project.elf
<br/>
<br/>
# Visual Boy Advance Directory
<br/>
# --------------------------------------------------------------------
<br/>
VBA = C:\Documents and Settings\The Ruiner\My Documents\GB\VisualBoyAdvance.exe
<br/>
GDB = C:\Documents and Settings\The Ruiner\My Documents\GB\arm-gdb.exe
<br/>
<br/>
# GCC Directories for Includes
<br/>
# --------------------------------------------------------------------
<br/>
GCC_VERSION = 3.2.2
<br/>
GCC_DIR  = C:/devkitadv
<br/>
STD_LIB_DIR0 = $(GCC_DIR)/lib/gcc-lib/arm-agb-elf/$(GCC_VERSION)/interwork
<br/>
STD_LIB_DIR1 = $(GCC_DIR)/arm-agb-elf/lib/interwork
<br/>
STD_INC_DIR0 = $(GCC_DIR)/lib/gcc-lib/arm-agb-elf/$(GCC_VERSION)/include
<br/>
STD_INC_DIR1 = $(GCC_DIR)/arm-agb-elf/include
<br/>
<br/>
# Project Directories for Includes
<br/>
# --------------------------------------------------------------------
<br/>
PROJECT_DIR      = .
<br/>
INC_DIR         = $(PROJECT_DIR)/include
<br/>
SRC_DIR         = $(PROJECT_DIR)/source
<br/>
CRT0_S_DIR      = $(PROJECT_DIR)
<br/>
LINK_SCRIPT_DIR = $(PROJECT_DIR)
<br/>
OBJ_DIR         = $(PROJECT_DIR)/bin
<br/>
ELF_DIR         = $(PROJECT_DIR)/bin
<br/>
DAT_DIR         = $(PROJECT_DIR)/data
<br/>
<br/>
# Flags for Compiler, Assembler, and Linker (thumb smaller, arm faster)
<br/>
# --------------------------------------------------------------------
<br/>
C_FLAGS  = -I$(DAT_DIR) -I$(INC_DIR) -I$(STD_INC_DIR0) -I$(STD_INC_DIR1) -c -g -Wall -mlong-calls
<br/>
S_FLAGS  = -I$(DAT_DIR) -I$(INC_DIR) -I$(STD_INC_DIR0) -I$(STD_INC_DIR1)
<br/>
L_FLAGS = -L$(STD_LIB_DIR0) -L$(STD_LIB_DIR1) -T $(LINK_SCRIPT_DIR)/lnkscript  -lstdc++ -lgcc -lc
<br/>
<br/>
# List of compiled Object files before they get linked
<br/>
# --------------------------------------------------------------------
<br/>
CRT0_O         = $(OBJ_DIR)/crt0.o
<br/>
#CRTBEGIN_O      = $(STD_LIB_DIR0)/crtbegin.o
<br/>
#CRTEND_O      = $(STD_LIB_DIR0)/crtend.o
<br/>
LIST         = $(patsubst $(SRC_DIR)/%.cpp, %.o, $(wildcard $(SRC_DIR)/*.cpp))
<br/>
O_FROM_LIST      = $(addprefix $(OBJ_DIR)/, $(LIST))
<br/>
O_FILES         = $(CRT0_O) $(CRTBEGIN_O) $(CRTEND_O) $(O_FROM_LIST)
<br/>
<br/>
<br/>
# Goal of the make file. Produce $(ROM) in $(PROJECT_DIR)
<br/>
# --------------------------------------------------------------------
<br/>
all: $(PROJECT_DIR)/$(ROM)
<br/>
   @echo "Done."
<br/>
<br/>
# PARAM: (clean) - clean the directory of .elf and .o files
<br/>
# --------------------------------------------------------------------
<br/>
clean:
<br/>
   @echo ""
<br/>
   @echo "----------------------------------"   
<br/>
   @echo "- Cleaning Directory"
<br/>
   @echo "----------------------------------"   
<br/>
   rm -f $(ELF_DIR)/*.elf
<br/>
   rm -f $(OBJ_DIR)/*.o
<br/>
<br/>
# PARAM: (run) - after compiling run the rom on VisualBoy
<br/>
# --------------------------------------------------------------------
<br/>
run: $(PROJECT_DIR)/$(ROM)
<br/>
   @echo ""
<br/>
   @echo "----------------------------------"
<br/>
   @echo "- Running VisualBoy ($(ROM))"
<br/>
   @echo "----------------------------------"   
<br/>
   $(VBA) $&lt;
<br/>
   
<br/>
# PARAM: (debug) - after compiling run the rom on VisualBoy using GDB/Insight
<br/>
# --------------------------------------------------------------------
<br/>
debug:
<br/>
   @echo ""
<br/>
   @echo "----------------------------------"
<br/>
   @echo "- Debug not implemented yet"
<br/>
   @echo "----------------------------------"
<br/>
<br/>
<br/>
# ********************************************************************
<br/>
# * COMPILATION BELOW                                                *
<br/>
# ********************************************************************
<br/>
<br/>
# Copy .elf to .gba
<br/>
# --------------------------------------------------------------------
<br/>
$(PROJECT_DIR)/$(ROM): $(ELF_DIR)/$(ELF)
<br/>
   @echo ""
<br/>
   @echo "Copy"
<br/>
   @echo "----------------------------------"
<br/>
   $(GCC_DIR)/bin/objcopy -v -O binary $&lt; $@
<br/>
<br/>
# Link the project;
<br/>
# -----------------------------------------------------------------------------
<br/>
$(ELF_DIR)/$(ELF) : $(O_FILES)
<br/>
   @echo ""
<br/>
   @echo "Link"
<br/>
   @echo "----------------------------------"
<br/>
   $(GCC_DIR)/bin/ld  $(O_FILES) -o./$@ $(L_FLAGS)
<br/>
   
<br/>
# Assembly of source files;
<br/>
# -----------------------------------------------------------------------------
<br/>
$(O_FROM_LIST) : $(OBJ_DIR)/%.o : $(SRC_DIR)/%.cpp
<br/>
   @echo ""
<br/>
   @echo "Assemble"
<br/>
   @echo "----------------------------------"
<br/>
   $(GCC_DIR)/bin/gcc  -c $&lt; -o$@ $(C_FLAGS)    
<br/>
<br/>
# Define the assembly of the crt0 file;
<br/>
# -----------------------------------------------------------------------------
<br/>
$(CRT0_O) : $(OBJ_DIR)/%.o : $(CRT0_S_DIR)/%.S
<br/>
   @echo ""
<br/>
   @echo "Assemble crt0.o"
<br/>
   @echo "----------------------------------"
<br/>
   $(GCC_DIR)/bin/gcc -c $&lt; -o$@ $(S_FLAGS) 
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11114 - sajiimori - Fri Sep 26, 2003 5:34 am</h4>
    <div class="postbody"><span class="postbody">I still don't understand.  What problem is -mthumb-interwork causing?
<br/>
<br/>
crtbegin/end are startup/shutdown code used by gcc.  They are normally linked in automatically by gcc or g++, as appropriate.
<br/>
<br/>
g++ doesn't do anything weird, like read your headers or anything.  It just sets the flags and links in the stuff that C++ apps need in general, like modules for exception handling.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11118 - Ruiner - Fri Sep 26, 2003 3:05 pm</h4>
    <div class="postbody"><span class="postbody">Ok, the first error. The error that started this post. I add -mthumb -mthumb-interwork to $(C_FLAGS) and I get THAT message. I remove it and its fine. 
<br/>
<br/>
Once its removed if I have $(CRTBEGIN_O) and $(CRTEND_O) uncommented so it gets added to $(O_FILES) then i get an error stating that my project.elf supports interworking but main.o (i think it was main.o) does not.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">c:\Docume~1\Therui~1\Locals~1\Temp/ccUxaaaa.s: Assembler messages: 
<br/>
c:\Docume~1\Therui~1\Locals~1\Temp/ccUxaaaa.s:1029: Error: invalid offset value to big (0xFFFFFFF8) 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Its diferent every time though. Like this last time it was cc6faaaa.s:941: rather than ccUxaaaa.s:1029:</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11128 - sajiimori - Fri Sep 26, 2003 6:51 pm</h4>
    <div class="postbody"><span class="postbody">Hmm...can you email me a source file that has the problem?  (myname)@hotmail.com</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
