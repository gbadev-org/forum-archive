<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Drawing lines and fixed point - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>C/C++ > Drawing lines and fixed point</h2>
<div id="posts">
<div class="post">
    <h4>#22461 - FPChris - Tue Jun 22, 2004 2:45 am</h4>
    <div class="postbody"><span class="postbody">Here's a nagging question...
<br/>
<br/>
Alot of interger based line routines I've seen have
<br/>
a common problem when dealing with lines at near vertical
<br/>
or near horizontal. Example...
<br/>
<br/>
instead of:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
XXXXXXXX
<br/>
        XXXXXXXX
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
you get this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
X
<br/>
 XXXXXXXXXXXXXXX
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Can anybody offer a way of getting rid of this?
<br/>
<br/>
It seems to be releated to the direction of the line and integer math.
<br/>
<br/>
The lower right quardrant types seem fine. But I didn't
<br/>
want to implement a bunch of end swapping to deal with it.
<br/>
<br/>
Any suggestions?
<br/>
<br/>
Chris</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22462 - poslundc - Tue Jun 22, 2004 3:23 am</h4>
    <div class="postbody"><span class="postbody">I am hard-pressed to think of an algorithm that would generate a line like your second example, especially seeing as it seems to be generating more of an arc than a line. Can you post the algorithm you're using?
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22463 - sgeos - Tue Jun 22, 2004 4:12 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>FPChris wrote:</b></span></td> </tr> <tr> <td class="quote">Here's a nagging question...
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
X
<br/>
 XXXXXXXXXXXXXXX
<br/>
</td> </tr></table><span class="postbody">Can anybody offer a way of getting rid of this?</span></td> </tr></table><span class="postbody">If you are doing this the way I think you are, then I think you'll have to add some constant before you divide.  I think the constant is derived y0 and y1 when horizontal, and from x0 and x1 when vertical.  (It's more of a proportion, perhaps?)
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22464 - FPChris - Tue Jun 22, 2004 4:56 am</h4>
    <div class="postbody"><span class="postbody">Here's part of it. I am writing and 'x' edge tabler for polygon routines
<br/>
so for the 'x row' fill in the loop I'm just plotting the leading pixel
<br/>
to test the results for now.
<br/>
<br/>
I have seen this happen in several bresenham implementations.
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
s32 dx = (x2-x1);
<br/>
s32 dy = (y2-y1);
<br/>
<br/>
s32 m = (dx &lt;&lt; 16) / dy;
<br/>
s32 x = x1 &lt;&lt; 16;
<br/>
   
<br/>
s32 yoff = 1;
<br/>
if(y1 &gt; y2){ yoff = -1; m=-m; }
<br/>
s32 loop = abs(dy);
<br/>
<br/>
for(int i=0;i&lt;loop;i++,y1+=yoff){ //loop y1 to y2
<br/>
<br/>
 DrawPixel(x&gt;&gt;16,y1,clr,buf);
<br/>
 x+=m;   
<br/>
   
<br/>
}//i
<br/>
<br/>
DrawPixel(x2,y2,clr,buf); //last pixel
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22465 - FPChris - Tue Jun 22, 2004 5:12 am</h4>
    <div class="postbody"><span class="postbody">I just found an article at:
<br/>
<br/>
<a href="http://www.cit.gu.edu.au/~anthony/info/graphics/bresenham.procs" target="_blank">http://www.cit.gu.edu.au/~anthony/info/graphics/bresenham.procs</a>
<br/>
<br/>
I'll give it a read and see if it explains this sort of error.
<br/>
At quick glance it appears too.
<br/>
<br/>
Chris</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22509 - DekuTree64 - Wed Jun 23, 2004 6:09 am</h4>
    <div class="postbody"><span class="postbody">Hmm, I gave that article a quick look and it seemed to be using some sort of error terms, which are a little confusing sometimes. A much easier way using regular fixed point is explaned at <a class="postlink" href="http://freespace.virgin.net/hugo.elias/graphics/x_polysc.htm" target="_blank">Hugo Elias's web site</a>. 
<br/>
The theory is that you interpolate along your line until your Y position is at an even integer, and then start drawing. The way to do that is by getting the Y distance between the actual start of the line and the center of the next pixel, which is done like this:
<br/>
<br/>
yError = INT_TO_FIXED( FIXED_TO_INT(y) + 1 ) - y;
<br/>
<br/>
That page has an image that shows graphically what yError is, which helps a lot to understand it. 
<br/>
<br/>
Then you do like 
<br/>
x += deltaX * yError;
<br/>
y += INT_TO_FIXED(1);
<br/>
<br/>
And then draw the line as normal. It seems like I remember that method moving everything down one pixel, which it does seem like it would do. I'd have to do some experimenting, but I think you could do it like 
<br/>
<br/>
yError = INT_TO_FIXED(FIXED_TO_INT(y)) - y;
<br/>
<br/>
And skip adding the 1 to y and it would be in the right place. I think you could end up with a negtive yError that way though, because if y was say .8, chopping off the fractional portion would get 0, and then subtracting the .8 from 0 would give -.8 for yError, which is right, because rounding down to the top edge of pixel 0, you would need to 'back up' along the 'real space' line and then start drawing forward. 
<br/>
<br/>
Well, I hope that makes sense to you, or at least the web site does. It all depends on how you define your pixel space. The way he does it, the center of the top row is defined to be 0, which makes anything between the very top edge and the center of the top row's pixels negative, which I think is why mine was getting off by one, because it was clipping anything in that range. The second method I was talking about (not adding 1) defines the borders between the pixels to be the integer coordinates, so the very top edge of the screen is 0, and the edge between the first and second rows of pixels is 1. I think it works either way, just gotta keep your head straight on what you're doing.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22519 - FPChris - Wed Jun 23, 2004 12:34 pm</h4>
    <div class="postbody"><span class="postbody">Thanks, I'll give it a read. 
<br/>
<br/>
From what I've read elsewhere drawing the line in two
<br/>
different directions can make a difference as well. So in order
<br/>
not to have gaps between my poly edges I probably have to
<br/>
use a swap ends so than A-&gt;B draws the same line as B-&gt;A etc.
<br/>
<br/>
This may be effecting the fixed point I was using and causing
<br/>
and improper line to be draw depending on which end I was
<br/>
working from -&gt; to.
<br/>
<br/>
Chris</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#30732 - AnthC - Sat Dec 04, 2004 1:25 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>FPChris wrote:</b></span></td> </tr> <tr> <td class="quote">Thanks, I'll give it a read. 
<br/>
<br/>
From what I've read elsewhere drawing the line in two
<br/>
different directions can make a difference as well. So in order
<br/>
not to have gaps between my poly edges I probably have to
<br/>
use a swap ends so than A-&gt;B draws the same line as B-&gt;A etc.
<br/>
<br/>
This may be effecting the fixed point I was using and causing
<br/>
and improper line to be draw depending on which end I was
<br/>
working from -&gt; to.
<br/>
<br/>
Chris</td> </tr></table><span class="postbody">
<br/>
<br/>
My suggesttions :-
<br/>
<br/>
Use fixed point slopes.
<br/>
Avoid Bresenham altogether.
<br/>
<br/>
Make sure you sample your edge from consistent pixel positions for every pixel. So make sure you take your x from the same y position for each vertical pixel. (I use y=0.5 in each pixel)
<br/>
That way you should avoid the issues you're getting in your polygon drawer. This is a common problem.
<br/>
<br/>
So if your line starting y is at pixel position 0.9 then you need to fixup your y to 0.5 and then fixup your x also.
<br/>
So x+=(0.9-0.5)*dx
<br/>
This means when you add your horizontal gradient for every vertical you sample consistently at 0.5 in your pixel.
<br/>
Confused ? Well I've not found a good way of explaining this, someone else might be able to help you more on this.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
