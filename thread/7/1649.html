<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Problem with compiling - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>C/C++ > Problem with compiling</h2>
<div id="posts">
<div class="post">
    <h4>#8397 - DiscoStew - Wed Jul 09, 2003 5:27 pm</h4>
    <div class="postbody"><span class="postbody">I am totally stressed out because of this.
<br/>
I'm working with large maps, and what I'm trying to do is whenever a background moves off by 8 pixels, it reloads the map correctly and resets the background coordinates. It all works fine and dandy, but when I use the WaitForVsync function, the program runs faster than it should (I trying to achieve 60fps to make it run smooth), so then I tried a Pern Project example on large maps which instead uses something like this...
<br/>
<br/>
while(!(REG_DISPSTAT &amp; 1));//wait for vblank 
<br/>
<br/>
		//redraw the entire map...bit slow but thats okay
<br/>
		BlitBG(bg0map,testMap.layers[0].data,testMap.layers[0].w,(x&gt;&gt;3),(y&gt;&gt;3));
<br/>
<br/>
		REG_BG0VOFS = y &amp; 7;
<br/>
		REG_BG0HOFS = x &amp; 7;
<br/>
<br/>
		while((REG_DISPSTAT &amp; 1));//Make sure VBLANK is over so our game does run faster than 60 frames per second
<br/>
<br/>
Note: I am not using his BlitBG function, since it does that every single frame.
<br/>
I'm reloading everytime the screen is off by 8 pixels (1 tile).
<br/>
I'm not sure exactly what he's doing here, but I tried it, and now the top 1/4 of the screen is jittering when I move the background. During this frustration, I came up with using the VBlank interupt so that when the screen is done drawing, it will interupt my code to where it can check and reload the map. Now here is where my problem is...
<br/>
<br/>
I'm using VS 6.0 and the GBA AppWizard (which I finally got working after having to change a few things in its MAK file that it creates). I have additional headers and source files that have that consist of my map functions. I use both linkers and headers from The Pern Project for my program. 
<br/>
<br/>
My problem is that through building a program, it makes its "interupt.o" file before the "test.o" file (where my main entry point is located), which then requires me to include the necessary header/source files, since my map functions are separate. Because of this, I thought that since that is done first, commenting out those includes from my main file would work, but my program states that the specific variables/functions are undeclared. But when I remove the comments, the program states that there are multiple instances of each variable/function. It's driving me nuts!
<br/>
<br/>
So, my question is, how can I call a external function from interupt.cpp that is being included in the main source file if interupt.cpp is being compiled first? OR, How can I prevent VS 6.0 from creating the interupt.o before compiling test.o? I've checked the MAK file on this, and I don't see anything about it. Please help....
<br/>
<br/>
If what I'm saying is not clear, please ask me. thx<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8402 - DiscoStew - Wed Jul 09, 2003 7:17 pm</h4>
    <div class="postbody"><span class="postbody">Great.....
<br/>
After posting my topic, I noticed the "external" in my post, and it made me realize about calling external function and the such. Boy, my mind was somewhere else. But now comes another problem.
<br/>
<br/>
Everything seems to be working. I can now check my map for any needed reloading during my VBlank interupt phase, but different emulators are showing different results as of using the VBlank interupt.
<br/>
<br/>
When using "WaitForVsync()"
<br/>
*VisualBoyAdvance:
<br/>
  Still fast, but its not even checking VBlank, so my map is not reloading when it's supposed to.
<br/>
*BoyCotAdvance:
<br/>
  Nothing is even happening, like it froze or something.
<br/>
*Mappy:
<br/>
  It's doing as it should, but it is jumping far worse than any of my other tests.
<br/>
<br/>
When using The Pern's Project VBlank wait (refer to code in last post)
<br/>
Note: I've been using only the 2 while loops together with no other code between them.
<br/>
*VisualBoyAdvance:
<br/>
  Works exactly like it should, smooth movement and all. Minor jumps are probably because of emulation.
<br/>
*BoyCottAdvance:
<br/>
  Still nothing. I wonder if it can't handle VBlank interupts?
<br/>
*Mappy:
<br/>
  Smooth movement, but jumpiness is still there.
<br/>
<br/>
Update: I moved the variables for map placing into the VBlank interupt, now Mappy is showing only the upper portion of the screen being jumpy.
<br/>
<br/>
I wonder, does anyone have a better solution as to dealing with large maps (preferably through the VBlank interupt)?<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8407 - tepples - Wed Jul 09, 2003 8:10 pm</h4>
    <div class="postbody"><span class="postbody">In general, you shouldn't be reloading the whole map during vblank. It's best to load only the parts of the map at the "seam" and then let the map wrap around. Start your favorite commercial platform game and open up VisualBoyAdvance's tile viewer to see what a seam is.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8409 - DiscoStew - Wed Jul 09, 2003 8:30 pm</h4>
    <div class="postbody"><span class="postbody">I guess I didn't clarify myself about the map. The whole map is loaded when it starts up into an array, and at every VBlank, if the X/Y coordinates are off by 8 pixels (1 tile), it reloads from that portion that is related to the coordinates into the last ScreenBaseBlock, and I reset the coordinates to its original values. It's pretty close to The Pern's Project's large maps example, except instead of loading that portion of the map every go around, I do it in the VBlank interupt and only if the coordinates are off by 8 pixels.
<br/>
<br/>
I used to have Castlevania: COTM, and I've seen the way they set up there map using a 512x512 text background for their different layers, but I'm using 256x256 to save up on space for Tiles. This is really just a test of what I could try doing.<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
