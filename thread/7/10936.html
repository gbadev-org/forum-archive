<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>HAM button problem - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>C/C++ > HAM button problem</h2>
<div id="posts">
<div class="post">
    <h4>#100093 - cppdungeon - Sat Aug 26, 2006 2:22 am</h4>
    <div class="postbody"><span class="postbody">the program is supposed to let the user choose from 3 options, but when you press "down" it skips from 1-3.  is there a way to fix this? (im using HAM)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include &lt;mygba.h&gt;
<br/>
#include &lt;iostream&gt;
<br/>
#define A 1
<br/>
#define B 2
<br/>
#define SELECT 4
<br/>
#define START 5
<br/>
#define RIGHT 16
<br/>
#define LEFT 32
<br/>
#define UP 64
<br/>
#define DOWN 128
<br/>
#define R 256
<br/>
#define L 512
<br/>
<br/>
volatile unsigned int *buttons = (volatile unsigned int *)0x04000130;
<br/>
<br/>
MULTIBOOT
<br/>
<br/>
int main(void)
<br/>
{
<br/>
   ham_Init();
<br/>
   ham_InitText(0);
<br/>
<br/>
   bool button [10];
<br/>
   int sp;
<br/>
   sp=0;
<br/>
<br/>
<br/>
<br/>
   //bg select block
<br/>
   while(TRUE)
<br/>
   {
<br/>
   ////////////////////////////////
<br/>
   button[0] = !((*buttons)&amp; A);
<br/>
   button[1] = !((*buttons)&amp; B);
<br/>
   button[2] = !((*buttons)&amp; SELECT);
<br/>
   button[3] = !((*buttons)&amp; START);
<br/>
   button[4] = !((*buttons)&amp; RIGHT);
<br/>
   button[5] = !((*buttons)&amp; LEFT);
<br/>
   button[6] = !((*buttons)&amp; UP);
<br/>
   button[7] = !((*buttons)&amp; DOWN);
<br/>
   button[8] = !((*buttons)&amp; R);
<br/>
   button[9] = !((*buttons)&amp; L);
<br/>
   ////////////////////////////////
<br/>
       ham_DrawText(0,0, "Choose Mode");
<br/>
       if(button[7] &amp;&amp; sp!=-2){
<br/>
           sp--;
<br/>
       }
<br/>
       if(button[6] &amp;&amp; sp!=0){
<br/>
           sp++;
<br/>
       }
<br/>
<br/>
       if(sp==0){
<br/>
       ham_DrawText(0, 1, "choice one  ");
<br/>
   }
<br/>
       if(sp==-1){
<br/>
       ham_DrawText(0,1,  "choice two  ");
<br/>
   }
<br/>
       if(sp==-2){
<br/>
       ham_DrawText(0,1, "choice three");
<br/>
   }
<br/>
<br/>
   }
<br/>
<br/>
   return 0;
<br/>
}
<br/>
<br/>
<br/>
/* END OF FILE */</td> </tr></table><span class="postbody">[/code]<br/>_________________<br/>"in Soviet Russia, car pimps you!"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100139 - gmiller - Sat Aug 26, 2006 3:00 pm</h4>
    <div class="postbody"><span class="postbody">It would appear that you do not have any delay in the code so it is constantly running.  When you press a button if the code is running fast enough you could see it down multiple times.  If you buffer the last state of the key you could work without delay (compare last state to current state, if different use the new key value).  other wise you might want to wait for VBLANK to slow things down.  I would buffer the keys anyway and I would not use boolean values because a single long would do (of course a short would do as well but the native operation of the ARM is 32 bit).  I avoid 'int' because that size is not defined by the standard as a particular number of bits.  I use long because it is 32 bit in the standard and short/char.  The implementation of 'int' is up to the compiler writer not the hardware or the standard.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100151 - tepples - Sat Aug 26, 2006 4:00 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>gmiller wrote:</b></span></td> </tr> <tr> <td class="quote">I avoid 'int' because that size is not defined by the standard as a particular number of bits.  I use long because it is 32 bit in the standard and short/char.  The implementation of 'int' is up to the compiler writer not the hardware or the standard.</td> </tr></table><span class="postbody">
<br/>
It's also up to whoever specifies the platform's application binary interface (ABI). In this case ARM Ltd. has specified that 'int' shall be 32 bits. What happens when you port to a machine where 'long' is 64 bits? My suggestion is to use 'int' for loop counters and 'u32' for data structures.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100161 - gmiller - Sat Aug 26, 2006 4:52 pm</h4>
    <div class="postbody"><span class="postbody">I believe that the standard say that short is 16, long is 32 and long long is 64.   But int on the same CPU can be 16, 32, 64 based on the compiler writer.  This was a problem when switching between SPARC, RS6000, Alpha, Intel CPU's for me so I switched to using types with defined lengths.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100169 - tepples - Sat Aug 26, 2006 5:45 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>gmiller wrote:</b></span></td> </tr> <tr> <td class="quote">I believe that the standard say that short is 16, long is 32 and long long is 64.</td> </tr></table><span class="postbody">
<br/>
Actually the standard states that short &gt;= 16, long &gt;= 32, and long long &gt;= 64. It does not state the size of int, except that short &lt;= int &lt;= long &lt;= long long.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">But int on the same CPU can be 16, 32, 64 based on the compiler writer.</td> </tr></table><span class="postbody">
<br/>
Still, on any target system better than an 8-bit micro, any competent compiler developer will make 'int' the fastest integer type that the compiler supports. So use 'int' for loop counters smaller than 32000 unless you have a good reason not to.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100183 - keldon - Sat Aug 26, 2006 6:56 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Actually the standard states that short &gt;= 16, long &gt;= 32, and long long &gt;= 64. It does not state the size of int, except that short &lt;= int &lt;= long &lt;= long long.</td> </tr></table><span class="postbody">
<br/>
<br/>
So does that mean that 8-bit processors need to break the standard? I'm sure the gameboy compilers have int as 16bit and short as 8 bits (but I can't be too sure). And when compiling for the 286 I'm sure I remember it being something similar.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100199 - tepples - Sat Aug 26, 2006 8:15 pm</h4>
    <div class="postbody"><span class="postbody">C was originally developed on and for 16-bit processors. C compilers for 8-bit processors tend to make 'char' the fastest variable type (see <a class="postlink" href="http://www.cc65.org/doc/coding.html" target="_blank">cc65 coding hints</a>).<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100207 - keldon - Sat Aug 26, 2006 8:34 pm</h4>
    <div class="postbody"><span class="postbody">Oh yeah!!!</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
