<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Advanced C++ topic covering templates and operator overloads - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>C/C++ > Advanced C++ topic covering templates and operator overloads</h2>
<div id="posts">
<div class="post">
    <h4>#2455 - animension - Tue Feb 04, 2003 9:45 am</h4>
    <div class="postbody"><span class="postbody">Hi guys,
<br/>
<br/>
I'm trying to create a wrapper class for fixed point decimal operations such that numeric operations on the class would allow me to write code that closely resembles the use of floating point operations. I'll try to get down in writing exactly what it is I'm trying to do, but apologies beforehand if I end up sounding unclear.
<br/>
<br/>
I'd like to be able to specify the primitive type that the class wraps around in order to control storage requirements and memory overhead. Something like that is typically done with templates. The numeric operations on them would be a case of operator overloading. However, I'd also like to allow different instantiated class templates that have different primitive types the class wraps around interact with each other and with other primitives and constants.
<br/>
<br/>
What I'd like to see as an end result is being able to do something like the following:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
Fixed&lt;signed long int&gt; fixedvar1 = 231.6521;
<br/>
Fixed&lt;unsigned char&gt; fixedvar2 = 0.923;
<br/>
unsigned short int var3 = 10;
<br/>
<br/>
// adding an unsigned short to Fixed&lt;signed long int&gt;
<br/>
fixedvar += var3; 
<br/>
<br/>
// adding a primitive float constant to Fixed&lt;signed long int&gt;
<br/>
fixedvar += 22.528;
<br/>
<br/>
// multiplying Fixed&lt;signed long int&gt; by Fixed&lt;unsigned char&gt;
<br/>
fixedvar *= fixedvar2;
<br/>
<br/>
// adding primitive unsigned short int to Fixed&lt;signed long int&gt; and returning a Fixed&lt;unsigned char&gt;
<br/>
fixedvar2 = fixedvar1 + var3 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Is there an elegant way to make the operator overloads take an ambigous Fixed&lt;T&gt; type (also primitive type) and add it to another Fixed&lt;T&gt; type and return an appropriate Fixed&lt;T&gt; type that is storing the resulting value?
<br/>
<br/>
I've tinkered around a bit with this idea but my implementations always end up having to declare argument types that are specific (Fixed&lt;signed char&gt; for example) for EACH operator overload, bloating my code. I'd imagine there's a way to do this by combining template classes, function templates, and operator overloads, but I can't seem to get the combination right.
<br/>
<br/>
If any C++ savvy person could point me in the right direction or heck, even recommend a book that extensively discusses the creation and use of class templates, function templates, etc, I'd be indebted.
<br/>
<br/>
Thanks!<br/>_________________<br/>"Beer is proof that God loves us and wants us to be happy."
<br/>
-- Benjamin Franklin</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#2481 - Vortex - Tue Feb 04, 2003 5:53 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">If any C++ savvy person could point me in the right direction or heck, even recommend a book that extensively discusses the creation and use of class templates, function templates, etc, I'd be indebted. 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
The best C++ book IMO is Bjarne Stroustrup's "The C++ Programming Language". I am sure you will be able to find your answers there.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#2484 - col - Tue Feb 04, 2003 8:09 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>animension wrote:</b></span></td> </tr> <tr> <td class="quote">Hi guys,
<br/>
<br/>
...
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
Fixed&lt;signed long int&gt; fixedvar1 = 231.6521;
<br/>
Fixed&lt;unsigned char&gt; fixedvar2 = 0.923;
<br/>
unsigned short int var3 = 10;
<br/>
<br/>
...
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Is there an elegant way to make the operator overloads take an ambigous Fixed&lt;T&gt; type (also primitive type) and add it to another Fixed&lt;T&gt; type and return an appropriate Fixed&lt;T&gt; type that is storing the resulting value?
<br/>
...
<br/>
Thanks!</span></td> </tr></table><span class="postbody">
<br/>
<br/>
wow :)
<br/>
<br/>
When I started coding on gba, I started attempting what you're trying to do - however, I very soon gave up.
<br/>
<br/>
As I developed a better understanding of fixed point maths and of gba programming / ARM assembly, I realised that it was a pointless exercise.
<br/>
<br/>
the way the ARM chip works, fixed point math can be VERY quick - but converting floating point values into fixed is a slow process, and having a constructor called to initialise a fixedPoint is serious overkill!! (not to mention all that bloat.
<br/>
<br/>
After a while thinking/writing in fixed point becomes almost second nature.
<br/>
I don't think you should worry about fixed point chars either - just extra added processing for the cpu!! - just stick to longs
<br/>
<br/>
For general code, pick a format (many use 24:8 - I chose 16:16) and stick to it, then all you have to do is remember to shift after a multiplication or divide, and shift to convert to integer math.
<br/>
<br/>
When you need to squeeze more precision out of your code, just keep track of the position of the imaginary point (in your comments?).
<br/>
<br/>
Whatever, its a nice idea wrapping fixed point - very oop - but IMO a complete waste of time on gba (cpu time and you time) - better wrapping the hardware ie sprites, backgrounds, DMA, Timers, interuppts etc. - if you've already done all that, write a game :)
<br/>
<br/>
Remember fixed point is (almost) as fast as using integers and almost as simple :)
<br/>
<br/>
cheers
<br/>
<br/>
col.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#2492 - animension - Tue Feb 04, 2003 9:58 pm</h4>
    <div class="postbody"><span class="postbody">Col,
<br/>
<br/>
Thanks for the lengthy, thoughtful reply. I guess I just wanted to stick to OOP paradigms and write really elegant code. The flip side to that, as you say, is the sacrifice in efficiency which translates into a speed decrease.
<br/>
<br/>
If there isn't really much of a point in doing it, I won't pursue a solution. Nevertheless, for sheer academic value, it would be interesting to see a solution to a complex problem like that one all the same. :)
<br/>
<br/>
Cheers!<br/>_________________<br/>"Beer is proof that God loves us and wants us to be happy."
<br/>
-- Benjamin Franklin</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
