<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Typecasting multidimensional arrays - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>C/C++ > Typecasting multidimensional arrays</h2>
<div id="posts">
<div class="post">
    <h4>#18056 - poslundc - Fri Mar 19, 2004 10:02 pm</h4>
    <div class="postbody"><span class="postbody">What I've done is declared a pool of memory for various shared purposes. It is declared in my main module as follows:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">u8      gMemoryPool[2048];</td> </tr></table><span class="postbody">
<br/>
<br/>
Just a simple array of 2048 bytes.
<br/>
<br/>
I would like to use this memory in another module as a 32x32 multidimensional array, preferably under a different name, so I would be able to refer to, say, map[10][7] and have it treat that as gMemoryPool[327]. I've tried using a macro:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define      map      ((u8 [][32])gMemoryPool)</td> </tr></table><span class="postbody">
<br/>
<br/>
But this form of typecasting doesn't seem to work.
<br/>
<br/>
Anyone know how to typecast a multidimensional array? Or otherwise accomplish what I am trying?
<br/>
<br/>
Thanks,
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18057 - sajiimori - Fri Mar 19, 2004 10:07 pm</h4>
    <div class="postbody"><span class="postbody">Multidimensional arrays in C are implemented as arrays of pointers to arrays, so you can't treat a flat array as a multidimensional array.  You have to use multiplication or shifting.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define map(x, y) (gMemoryPool[((y)&lt;&lt;5)+(x)])
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18060 - poslundc - Fri Mar 19, 2004 10:31 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">Multidimensional arrays in C are implemented as arrays of pointers to arrays</td> </tr></table><span class="postbody">
<br/>
<br/>
What?! Since when? I've been programming C for over a decade; I'm sure someone would've told me this!
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18062 - poslundc - Fri Mar 19, 2004 11:42 pm</h4>
    <div class="postbody"><span class="postbody">OK, I figured out how to do this.
<br/>
<br/>
For anyone ever attempting anything similar:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define map      ((u8 (*)[32])gMemoryPool)</td> </tr></table><span class="postbody">
<br/>
<br/>
You can then refer to map[row][column] as though it were an n x 32 two-dimensional array.
<br/>
<br/>
And for the record, C <span style="font-weight: bold">does</span> interpret multidimensional arrays as linear arrays.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18063 - sajiimori - Fri Mar 19, 2004 11:50 pm</h4>
    <div class="postbody"><span class="postbody">Is that right?  I wonder where I got my idea.  Maybe from C# and all that.
<br/>
<br/>
In any case, the compiler has to produce the shift for you anyway, so there's not much of a difference...
<br/>
<br/>
Edit:  If you have an array a[x][y], then a[i] returns a pointer to the i-th array, so that produces a bit of an illusion.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18099 - beelzebub - Sat Mar 20, 2004 12:32 pm</h4>
    <div class="postbody"><span class="postbody">Wouldn't a union be better...
<br/>
<br/>
typedef union uMEMORY_POOL_tag
<br/>
{
<br/>
    u8       mRaw [2048];
<br/>
    u8       mMap [10][7];
<br/>
} uMEMORY_POOL;
<br/>
<br/>
<br/>
uMEMORY_POOL gMemoryPool;
<br/>
<br/>
<br/>
Then you can access the map data as gMemoryPool.mMap [y][x] and you can add as many other pooled resources to the union as you want (front end screens and menus etc...), and still minimize memory usage.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18101 - poslundc - Sat Mar 20, 2004 2:11 pm</h4>
    <div class="postbody"><span class="postbody">A union would also work, except for a couple of things I don't like:
<br/>
<br/>
- the module containing the union has to know all of the possible uses for the pool, instead of other modules just using the module containing the pool
<br/>
<br/>
- you can't reference it as a single variable name, you have to reference it as an element of an object
<br/>
<br/>
Although in hindsight I could've done the union thing and then #defined my map variable as being gMemoryPool.mMap if I'd done it that way.
<br/>
<br/>
Still, I prefer it this way, so I don't have to keep a centralized list of the different ways that the pool is used.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18107 - Miked0801 - Sat Mar 20, 2004 5:44 pm</h4>
    <div class="postbody"><span class="postbody">Cool, thanks for that.  Always wondered how to do it... :)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
