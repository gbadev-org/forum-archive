<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>stdio question - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>C/C++ > stdio question</h2>
<div id="posts">
<div class="post">
    <h4>#7991 - Ninja - Mon Jun 30, 2003 4:06 am</h4>
    <div class="postbody"><span class="postbody">Hi.  I have just finished my sprite text support for my game, which uses the last part of the OAM memory, and counts backwards to set up the sprite characters.  Basically, the format is similar to TextOut() on the Windows GDI, and the prototype is like this:
<br/>
<br/>
u16 SpriteText256(s16 x, s16 y, char* text, u8 length);
<br/>
<br/>
x and y are the coordinates to print the text,
<br/>
text is the text,
<br/>
length is the length of the character array inputted.
<br/>
it returns the current sprite number when it finishes to ease the erasure process.
<br/>
<br/>
I was going to use a string instead of the last two input parameters, but the compiler didn't seem to think that was such a great idea.  It wouldn't accept a string as a data type.
<br/>
<br/>
Anyways, the function works just fine.  I can print all the text I want until I run out of sprites.  :)  The problem is that I had intended to print numbers like this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include &lt;stdio.h&gt;
<br/>
<br/>
int framesPerSec = getFPS();  //pseudo-code
<br/>
int length;
<br/>
char buffer[32];
<br/>
<br/>
length = sprintf(buffer, "Current FPS: %d", framePerSec);
<br/>
SpriteText256(10, 10, buffer, length);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
That's essentially how I would handle this problem in windows.  The problem is that I get a million linking errors when trying to compile this code in GCC.  It could be that my make file is in error perhaps, but I would have absolutely no clue how to fix that... I am not so good with make files.
<br/>
<br/>
I am using the GBA Appwizard in Visual Studio 6.
<br/>
<br/>
Any ideas on how I could get this working would be greatly appreciated.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7995 - tepples - Mon Jun 30, 2003 4:54 am</h4>
    <div class="postbody"><span class="postbody">For one thing, you should not use sprintf() on the GBA because not only will it bring in the entire printf library, but it'll also bring in the floating-point library (for handling %e %f %g). Instead, use siprintf(), which is identical except for not handling floating-point types.
<br/>
<br/>
Better yet, just use some sort of itoa() function (you may have to write your own).<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8001 - wizardgsz - Mon Jun 30, 2003 10:39 am</h4>
    <div class="postbody"><span class="postbody">Use your own libc/stdlib or use some Linux one.
<br/>
<br/>
libgba, GameBoy Advance Development Library (Chuck Mason), has libc from a Linux box.<br/>_________________<br/><a href="http://www.geocities.com/gabriele_scibilia/" target="_blank">http://www.geocities.com/gabriele_scibilia/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8014 - Cyberman - Mon Jun 30, 2003 7:25 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ninja wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include &lt;stdio.h&gt;
<br/>
<br/>
int framesPerSec = getFPS();  //pseudo-code
<br/>
int length;
<br/>
char buffer[32];
<br/>
<br/>
length = sprintf(buffer, "Current FPS: %d", framePerSec);
<br/>
SpriteText256(10, 10, buffer, length);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
That's essentially how I would handle this problem in windows.  The problem is that I get a million linking errors when trying to compile this code in GCC.  It could be that my make file is in error perhaps, but I would have absolutely no clue how to fix that... I am not so good with make files.
<br/>
<br/>
I am using the GBA Appwizard in Visual Studio 6.
<br/>
<br/>
Any ideas on how I could get this working would be greatly appreciated.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Hmmm I've tackled similar problems before ..
<br/>
I would recomend a slightly different approach
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void s_printf(s16 X, s16 Y, s16 W, const char *Fmt, ...)
<br/>
{
<br/>
    char    Buff[128];
<br/>
    va_list ap;
<br/>
    char   *Str;
<br/>
<br/>
    // first print the formated text
<br/>
    va_start ( ap, Fmt);
<br/>
    vsprintf(Buff, Fmt, ap);
<br/>
    va_end(ap);
<br/>
    // now convert the formated text to the proper tiles.
<br/>
    Str = Buff;
<br/>
    while(*Str)
<br/>
    {
<br/>
        s_putc(X, Y, *Str++);
<br/>
        X += W;
<br/>
    }
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
You need to be sure to include the headers for var arg lists in your program.
<br/>
<br/>
This allows you to use it just like sprintf the big difference being that it gives a bit more flexibility.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void s_putc(s16 X, s16 Y, char Char)
<br/>
{
<br/>
    // find next available sprite
<br/>
    // associate character tile in VRAM to sprite
<br/>
    // set up other sprite characteristics
<br/>
    // display sprite
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
This has all sorts of interesting uses obviously I suppose if you are worried about loading the floating point library in you can look for visprintf? :)
<br/>
<br/>
Use:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
s_printf(10, 10, PITCH, "'%8s' Loses %03d gumballs!", Person-&gt;Name, Loss);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
You will need a way to recycle the sprites you allocated doing this I might point out too.
<br/>
<br/>
Cyb</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8024 - Ninja - Mon Jun 30, 2003 9:00 pm</h4>
    <div class="postbody"><span class="postbody">Thanks guys.  This is sort of depressing actually... I was hoping for a quick fix.  :)  I guess now I will have to go out and find some way of converting an int to a char on my own.  I imagine that would be faster and more efficient.  Bummer.
<br/>
<br/>
Anyone have any idea how to divide by 10 without using division?  hehe...
<br/>
<br/>
Maybe I will look up that siprintf() function, and try to figure out how to compile it without the linker errors...  I still have no clue why I am getting all the errors when I try to compile.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8073 - Cyberman - Tue Jul 01, 2003 4:32 pm</h4>
    <div class="postbody"><span class="postbody">Hmmm dividing by ten huh?
<br/>
Division is tricky period.
<br/>
Since you are dividing by a FIXED number you can reduce it to shifts and subtracts I suppose.
<br/>
It's also important to remember signed versus unsigned division.
<br/>
<br/>
Try <a class="postlink" href="http://www.emesystems.com/division.htm" target="_blank">this</a> to get a start on what to do.
<br/>
<br/>
Cyb</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8096 - Ninja - Wed Jul 02, 2003 12:32 am</h4>
    <div class="postbody"><span class="postbody">Thanks for the tip Cyberman.  :)  When it comes time to optimize my code, I might just program something like that.  I did get siprintf() to work though, and it's just a beautiful function.  :)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
