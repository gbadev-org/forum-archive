<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>ERROR: initializer element is not constant - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>C/C++ > ERROR: initializer element is not constant</h2>
<div id="posts">
<div class="post">
    <h4>#48370 - sabkaraja - Tue Jul 19, 2005 4:40 pm</h4>
    <div class="postbody"><span class="postbody">Hi
<br/>
<br/>
I have some arrays like the following in a .h file:
<br/>
extern const u8 a1[512];
<br/>
extern const u8 a2[512];
<br/>
extern const u8 a3[512];
<br/>
extern const u8 a4[512];
<br/>
and the data defined elsewhere in another file.
<br/>
<br/>
I am using the list as follows:
<br/>
<br/>
const u8 *MyList[]={
<br/>
  (u8*) a1,
<br/>
  (u8*) a2,
<br/>
  (u8*) a3,
<br/>
  (u8*) a4,
<br/>
};
<br/>
<br/>
I have to populate a struct  MyStruct[] (which has a member const u8* someData) based on user selection. 
<br/>
<br/>
But when I compile the code, it gives me an error saying that:
<br/>
initializer element for `MyStruct[0].someData' is not constant
<br/>
<br/>
I saw one similar post by another member which relates to this, but my problem isnt solved still.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#48377 - poslundc - Tue Jul 19, 2005 6:12 pm</h4>
    <div class="postbody"><span class="postbody">You are casting away the const-ness of your four u8 pointers in your declaration of MyList. The way you have set it up, you probably should not have to typecast at all, but if you do, the type you'd cast to would be (const u8 *), not (u8 *).
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#48378 - sajiimori - Tue Jul 19, 2005 6:17 pm</h4>
    <div class="postbody"><span class="postbody">You're asking about an error initializing an array of MyStructs, but you didn't post the struct declaration, the array declaration, or the initializers.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#48400 - sabkaraja - Tue Jul 19, 2005 8:27 pm</h4>
    <div class="postbody"><span class="postbody">Sorry about that:
<br/>
<br/>
typedef struct StrData_tag
<br/>
{
<br/>
	const u8* someData;
<br/>
	u16	param0;					u16	param1;				
<br/>
}StrData;
<br/>
<br/>
The data was assigned into the struct like this:
<br/>
<br/>
StrData MyStruct[] = {
<br/>
  { &amp;MyList[0], 2,7},
<br/>
  { &amp;MyList[1], 5,2},
<br/>
  { &amp;MyList[2], 61,8},
<br/>
  { &amp;MyList[3], 6,4},
<br/>
};
<br/>
<br/>
Above code doesnt seem to work, where as this works
<br/>
StrData MyStruct[] = {
<br/>
  { a1, 2,7},
<br/>
  { a2, 5,2},
<br/>
  { a3, 61,8},
<br/>
  { a4, 6,4},
<br/>
};
<br/>
<br/>
TIA</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#48406 - poslundc - Tue Jul 19, 2005 9:36 pm</h4>
    <div class="postbody"><span class="postbody">You are casting away the const-ness of your four u8 pointers in your declaration of MyList. The way you have set it up, you probably should not have to typecast at all, but if you do, the type you'd cast to would be (const u8 *), not (u8 *). 
<br/>
<br/>
Dan (conspicuously similar to my last post).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#48411 - sajiimori - Tue Jul 19, 2005 9:49 pm</h4>
    <div class="postbody"><span class="postbody">I disagree.  The casts are not an error because the newly casted non-const pointers will automatically be demoted back to const.
<br/>
<br/>
Initializing someData with &amp;MyList[0] is an error because it is a pointer to a pointer.  (Recall that MyList is an array of pointers, and you are taking the address of one of those pointers.)  It should actually give a different error message than the one you initialially posted, presumably something about not being able to convert u8** to u8*.
<br/>
<br/>
On the other hand, if you initialize it with MyList[0] then it should give the error that you posted because MyList[0] is not constant.  MyList is an array of non-const pointers to const data.  You probably want an array of const pointers to const data, like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">const u8* const MyList[] = { ... };</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#48416 - poslundc - Tue Jul 19, 2005 10:10 pm</h4>
    <div class="postbody"><span class="postbody">Ah, you're right, I had the const-correctness legality backwards.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#48419 - sajiimori - Tue Jul 19, 2005 10:22 pm</h4>
    <div class="postbody"><span class="postbody">You know, the solution I posted (about const pointers to const data) probably won't work, either.  Array elements are never compile-time constants, even for const arrays.  The addresses of the array elements are known at compile time though, so you could always change someData to u8**.
<br/>
<br/>
I've long wished for more things to be compile-time constants in C, including the results of pure functions.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#48455 - sabkaraja - Wed Jul 20, 2005 4:55 am</h4>
    <div class="postbody"><span class="postbody">I was trying to access the MyList data like MyList[gLang]
<br/>
<br/>
But when I used MyList[1] instead of gLang, it doesnt give an error. So it confirms what sajiimori said.
<br/>
<br/>
But for some reasons, I cannot change the someData. The data structure cannot be touched at all.
<br/>
<br/>
I believe there must be some other solution to this?
<br/>
<br/>
Thank you Friends</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#48505 - tepples - Wed Jul 20, 2005 1:56 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">I've long wished for more things to be compile-time constants in C, including the results of pure functions.</td> </tr></table><span class="postbody">
<br/>
Perhaps GCC supports this as an extension to the C language. Have you looked into the <a class="postlink" href="http://www.ohse.de/uwe/articles/gcc-attributes.html#func-pure" target="_blank">pure attribute</a>?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#48538 - sajiimori - Wed Jul 20, 2005 5:55 pm</h4>
    <div class="postbody"><span class="postbody">Sadly, I don't use GCC at work.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
