<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>256 colors to 16 colors - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>C/C++ > 256 colors to 16 colors</h2>
<div id="posts">
<div class="post">
    <h4>#26412 - Mephisto - Wed Sep 15, 2004 12:36 am</h4>
    <div class="postbody"><span class="postbody">To display a sprite, i use dma, to put sprite info into vram
<br/>
In 256 colors mode, i use this code and it works fine.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">unsigned char* SpriteData;
<br/>
<br/>
REG_DM3SAD = (u32)&amp;SpriteData[***];
<br/>
REG_DM3DAD = (u32)&amp;VRAM[***];
<br/>
REG_DM3CNT = TileWidth * TileHeight / 2 | DMA_16NOW;</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
but recently i needed to switch to 16 colors mode, but with the following code, VRAM is filled only 1 colomn / 2 ... 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">unsigned char* SpriteData;
<br/>
<br/>
REG_DM3SAD = (u32)&amp;SpriteData[***];
<br/>
REG_DM3DAD = (u32)&amp;VRAM[***];
<br/>
REG_DM3CNT = TileWidth * TileHeight / 4 | DMA_16NOW;</td> </tr></table><span class="postbody">
<br/>
<br/>
what do i need to change ? plz
<br/>
(to avoid any array fusion)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26414 - sajiimori - Wed Sep 15, 2004 1:41 am</h4>
    <div class="postbody"><span class="postbody">Nothing -- just make sure you're reading from a halfword-aligned address.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26418 - Mephisto - Wed Sep 15, 2004 2:00 am</h4>
    <div class="postbody"><span class="postbody">how do you "shift" an adress, incrementing it ?
<br/>
so it would be
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">(u32)&amp;SpriteData[***] + 4;</td> </tr></table><span class="postbody">
<br/>
but it doesnt work, always fill 1 colomn on 2</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26420 - sajiimori - Wed Sep 15, 2004 2:48 am</h4>
    <div class="postbody"><span class="postbody">I don't know why you're adding anything to the address, but adding 4 to the address is the same as adding 4 to the value inside the brackets (since SpriteData is u8*).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26430 - Mephisto - Wed Sep 15, 2004 3:11 pm</h4>
    <div class="postbody"><span class="postbody">My Spritedata in 256 color was like :  
<br/>
  { 0xFF, 0xFF, 0xFF, ... }
<br/>
<br/>
But in 16 color with the same bmp2gba converting tool its like :
<br/>
  { 0x0F, 0x0F, 0x0F, ... }
<br/>
<br/>
that why VRAM is filled 1 colomn on 2, so there is no way to display well without fusing ...
<br/>
So if anyone use well Tilestudio and the GBA_C_SPRITE.tsd of Edorul, could tell me how to fuse 2 pixels ( ( (pixel + 1) &lt;&lt; 4) + pixel ), i didnt do it succefully ...
<br/>
i dont really understand this language ^^
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#tinytiles 8 8
<br/>
const unsigned short &lt;ProjectName&gt;_&lt;TileSetIdentifier&gt;_Tiles[] = {
<br/>
#tstile
<br/>
   // Tile &lt;TileNumber&gt;
<br/>
#tiledata "\n   "  ","  ",\n   "  ",\n   "  ",\n"
<br/>
&lt;(Pixel+1):"%3d"&gt;
<br/>
#end tiledata
<br/>
#end tstile
<br/>
   0 };
<br/>
#end tinytiles
<br/>
#end tileset</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26440 - sajiimori - Wed Sep 15, 2004 6:05 pm</h4>
    <div class="postbody"><span class="postbody">Maybe you're giving the wrong arguments to bmp2gba, or maybe you should switch to gfx2gba since people seem to like it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26441 - Mephisto - Wed Sep 15, 2004 7:18 pm</h4>
    <div class="postbody"><span class="postbody">the bmp2gba tool is TileStudio ^^</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26479 - Quirky - Thu Sep 16, 2004 8:15 pm</h4>
    <div class="postbody"><span class="postbody">The sprite data should be 4 bits per pixel for 16 colour sprites. 
<br/>
<br/>
16 colour pixels using colour 15:  0F 0F 0F 0F
<br/>
as 16 colour data they are 2 bytes&gt; FF, FF
<br/>
as 256 colour data they are 4 bytes&gt; 0f, 0f, 0f, 0f
<br/>
<br/>
Do you see what I mean? You have to "pack" your 4 bits together. Now gfx2gba does this, it looks like what you use doesn't (or not with the options you give it at least) - it treats your 16 colour image as though it has 256 colours, possibly because you need to tell it otherwise.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
