<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>My sprites keep messing up! - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>C/C++ > My sprites keep messing up!</h2>
<div id="posts">
<div class="post">
    <h4>#48669 - lewisrevill - Thu Jul 21, 2005 5:52 pm</h4>
    <div class="postbody"><span class="postbody">Im coding a GBA game in Mode 4 and if a sprite gets moved partly off screen it either messes up or dissapears.  Can you help?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#48680 - tepples - Thu Jul 21, 2005 6:54 pm</h4>
    <div class="postbody"><span class="postbody">Five bucks says you're not properly masking off the upper bits of the X and Y coordinates. If you don't, then the 1-bits that represent negative numbers will overflow into the parts of the OAM bitfields that specify sprite shape, size, rotation, and the like.
<br/>
<br/>
Hints: y &amp; 0x00FF and x &amp; 0x01FF.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#48743 - ScottLininger - Fri Jul 22, 2005 1:14 am</h4>
    <div class="postbody"><span class="postbody">You may already know this, but negative sprite locations are invalid, so you have to take advantage of the 512x256 pixel "wraparound universe" that the gameboy uses.
<br/>
<br/>
So, if you want the sprite to be 10 pixels off the left (x location of -10), then you set it's x value in memory to be 512 - 10 = 502.
<br/>
<br/>
Plus the masking stuff that Tepples said.
<br/>
<br/>
Cheers,
<br/>
<br/>
-Scott</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#48908 - lewisrevill - Sun Jul 24, 2005 12:13 am</h4>
    <div class="postbody"><span class="postbody">Hey thanks for your reply's guys.  I pretty new to this so parden my nieve-ness, but what is this masking business?? is it something in corespondence to this piece of code? :
<br/>
<br/>
void CopyOAM(void)
<br/>
{
<br/>
	u16 loop;
<br/>
	u16* temp;
<br/>
	temp = (u16*)sprites;
<br/>
	for(loop = 0; loop &lt; 128*4; loop++)	{
<br/>
		OAM_Mem[loop] = temp[loop];
<br/>
	}
<br/>
}
<br/>
<br/>
please reply</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#48909 - Sintax - Sun Jul 24, 2005 12:21 am</h4>
    <div class="postbody"><span class="postbody">That code only moves the OAM copy (which is used to hold OAM data until it can be set during vsync) onto the GBA's OAM memory. If you don't know what any of that means, it doesn't really matter because that's not the code they're talking about.
<br/>
<br/>
This is the code I use to moves sprites, and it has the masking stuff that tepples talked about. You should have it too because it looks like you got your sprite code from the same place:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">oam-&gt;attribute[1] &amp;= 0xFE00;
<br/>
oam-&gt;attribute[1] |= (x &amp; 0x01FF);
<br/>
<br/>
oam-&gt;attribute[0] &amp;= 0xFF00;
<br/>
oam-&gt;attribute[0] |= (y &amp; 0x00FF);</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
