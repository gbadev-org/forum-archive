<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>is this a good optimization - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>C/C++ > is this a good optimization</h2>
<div id="posts">
<div class="post">
    <h4>#22444 - ProblemBaby - Mon Jun 21, 2004 1:04 pm</h4>
    <div class="postbody"><span class="postbody">in my main game loop
<br/>
I call a lot of differnt functions
<br/>
like get input, handle different stuff and so on
<br/>
BUT they are called only once per frame
<br/>
is it smart to declare those functions as inline then?
<br/>
<br/>
if not, why??</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22447 - poslundc - Mon Jun 21, 2004 2:02 pm</h4>
    <div class="postbody"><span class="postbody">No, it's not smart, for several reasons:
<br/>
<br/>
- Inline functions are generally only useful for very short blocks of code only - usually less than five lines or so - that are called more than once, where it is more efficient to have the code copied in directly every time it is needed rather than branching to and returning from a subroutine.
<br/>
<br/>
- Code that is only called once per frame will not be made any more efficient by being made inline. It may, however, result in a much larger and more wasteful stack, and it may be much harder to debug.
<br/>
<br/>
- Premature optimization is the root of all evil. Get your program working first, and then if you need to squeeze more speed out of it you can profile and optimize your code. I guarantee you won't save anything noticeable by inlining functions called once per frame.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22454 - ProblemBaby - Mon Jun 21, 2004 8:49 pm</h4>
    <div class="postbody"><span class="postbody">Aha I thought inline worked like a macro!
<br/>
but is it good if Ive a quite small function
<br/>
that should be called through a for-loop a couple of times??
<br/>
<br/>
Then i have another question about optimization.
<br/>
Is it smart to have a LUT for Division?
<br/>
I use it very much in collision detection and to find screen-positions!
<br/>
I would need about divisions for -32/32 FIXED
<br/>
thats 64*256 = 16384 * sizeof(s32)
<br/>
Thats quite much! but do it make it much faster?
<br/>
I need speed!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22455 - poslundc - Mon Jun 21, 2004 9:08 pm</h4>
    <div class="postbody"><span class="postbody">I don't know how you figured on your calculations for the size of your LUT, but if you leave it in ROM then 64K is not a big deal, and it would only consume a quarter of your EWRAM, which depending on your application's needs may be worthwhile. And a reciprocal LUT in EWRAM is simply the fastest way to divide by a non-constant amount.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22456 - sajiimori - Mon Jun 21, 2004 9:25 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
but is it good if Ive a quite small function 
<br/>
that should be called through a for-loop a couple of times??
<br/>
</td> </tr></table><span class="postbody">
<br/>
If it's really only a "couple", then it still won't be significant.  Seriously, forget about inlining until you've identified your bottlenecks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22457 - poslundc - Mon Jun 21, 2004 9:42 pm</h4>
    <div class="postbody"><span class="postbody">Um, yeah. Listen to saji. Inlining is provided mainly to accomodate those rare situations where the need for form and readability comes into conflict with having sensible, efficient code.
<br/>
<br/>
In other words, it is only to allow programmers to code in a style that is modular and encapsulated without it being recklessly inefficient with the calling of functions. An example would be calling a function every single time you need to take the absolute value of a number. You want to (and should) use a function call rather than having "if" statements all over the place, but the overhead of a function call would be extremely wasteful in this circumstance, so an inline function provides the form without the overhead.
<br/>
<br/>
Don't think you can go through your code adding "inline" everywhere - or even anywhere - to improve its speed. It is a bit of a surgical tool, and needs to be applied delicately.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22458 - sajiimori - Mon Jun 21, 2004 10:28 pm</h4>
    <div class="postbody"><span class="postbody">A couple additons:
<br/>
<br/>
The 'inline' keyword already means very little (gcc -O3 does auto-inlining), and it will only mean less as compilers get smarter.  Some of the more <a class="postlink" href="http://www.cons.org/cmucl/" target="_blank">advanced</a> compilers are already at the stage where you only specify how important each factor is (code size, execution speed, safety), and it does appropriate optimizations based on your choices.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22469 - NoMis - Tue Jun 22, 2004 8:41 am</h4>
    <div class="postbody"><span class="postbody">Another thing about inlining. The inline keyword just tells the compiler that you preferre this function as inline but its up to the compiler to do it
<br/>
<br/>
" ... The inline keyword tells the compiler that inline expansion is preferred. However, the compiler can create a separate instance of the function (instantiate) and create standard calling linkages instead of inserting the code inline.
<br/>
<br/>
Things that usually make the compiler ignore your request are: using loops in the inline function, calling other inline functions from within the function, and recursion. ... "
<br/>
<br/>
"Performance Programming applied to c++"
<br/>
<a href="http://www.gamedev.net/reference/articles/article1139.asp" target="_blank">http://www.gamedev.net/reference/articles/article1139.asp</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22494 - jma - Wed Jun 23, 2004 2:25 am</h4>
    <div class="postbody"><span class="postbody">Another great reason to use inlining is if you have code that will compile away and you want the compiler or optimizer to catch it. For example, check the following:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">inline void set_x(int new_x) {
<br/>
  ASSERT(new_x &gt;= 0 &amp;&amp; new_x &lt; 100);
<br/>
  global_x = new_x;
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
This is a wonderful place and reason to use inlining. The ASSERT() will not be compiled into release code, but you don't want to use it over and over again whenever changing a variable's value, so you bust out a function that will do it for you. But calling a function that does nothing but set one value is a waste of processor -- so inline it.
<br/>
<br/>
Jeff<br/>_________________<br/><a href="mailto:massung@gmail.com">massung@gmail.com</a>
<br/>
<a href="http://www.retrobyte.org" target="_blank">http://www.retrobyte.org</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
