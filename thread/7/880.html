<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>n00b problem - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>C/C++ > n00b problem</h2>
<div id="posts">
<div class="post">
    <h4>#4392 - Daikath - Sat Mar 29, 2003 6:16 pm</h4>
    <div class="postbody"><span class="postbody">Hi, I am reasonable new to programming, I am making a small demo wherein a couple of balls are on screen and you get to control one ball and the rest move along as though they are connected with a rubberband, this is just practice code to get the hang of it but when I move one ball around on screen the second just stays put. This is the function I use for the second ball to move.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void Elastiek()
<br/>
{   
<br/>
   s16 var1;
<br/>
   var1 = 0;
<br/>
   var1 = x - x2;
<br/>
   /*s16 acceleration;
<br/>
   s16 speed;*/
<br/>
   s8 xleft;
<br/>
   s8 xright;
<br/>
   s8 possibility;
<br/>
   u8 trigger;
<br/>
   /*acceleration = 0;
<br/>
   speed = 0;*/
<br/>
   xleft = 0;
<br/>
   xright = 0;
<br/>
   possibility = 0;
<br/>
   trigger = 0;
<br/>
   if ((var1 &lt; 0) &amp; (trigger == 0))
<br/>
   {
<br/>
      possibility = 1;
<br/>
   }
<br/>
   if ((var1 &gt; 0) &amp; (trigger == 0))
<br/>
   {
<br/>
      possibility = 2;
<br/>
   }
<br/>
   switch (possibility)
<br/>
   {
<br/>
   case '1':
<br/>
   {
<br/>
      trigger = 1;
<br/>
      xleft = 0 - var1;
<br/>
      xright = var1 - var1 - var1 - 3;
<br/>
      while (trigger == 1)
<br/>
      {
<br/>
      
<br/>
         if (x2 &gt; xleft)
<br/>
         {
<br/>
            x2--;
<br/>
         }
<br/>
         trigger = 2;
<br/>
      }
<br/>
      while (trigger == 2)
<br/>
      {
<br/>
         if (x2 &lt; xright)
<br/>
         {
<br/>
            x2++;
<br/>
         }
<br/>
         trigger = 0;
<br/>
      }
<br/>
break;
<br/>
   }
<br/>
   case '2':
<br/>
      {
<br/>
         trigger = 3;
<br/>
         xright = 0 + var1;
<br/>
         xleft = var1 - var1 - var1 + 3;
<br/>
         while (trigger == 3)
<br/>
         {
<br/>
            if (x2 &lt; xright)
<br/>
            {
<br/>
               x2++;
<br/>
            }
<br/>
            trigger = 4;
<br/>
         }
<br/>
         while (trigger == 4)
<br/>
         {
<br/>
            if (x2 &gt; xleft)
<br/>
            {
<br/>
               x2--;
<br/>
            }
<br/>
         }
<br/>
      }
<br/>
break;
<br/>
   }
<br/>
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
I'd be very greatful if someone were to help me :).<br/>_________________<br/>?There are no stupid questions but there are a LOT of inquisitive idiots.?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4483 - Daikath - Tue Apr 01, 2003 1:03 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">// springy.c AGBmain Entry point is contained here (main program loop)
<br/>
<br/>
#include "gba.h" //GBA register definitions
<br/>
#include "gbakeys.h"     //button registers
<br/>
<br/>
<br/>
#include "gbaregs.h"
<br/>
<br/>
typedef struct tagOAMEntry
<br/>
{
<br/>
u16 Attrib0;
<br/>
u16 Attrib1;
<br/>
u16 Attrib2;
<br/>
u16 Attrib3;
<br/>
}OAMEntry, *pOAMEntry;
<br/>
typedef struct tagRotData
<br/>
{
<br/>
u16 filler1[3];
<br/>
u16 pa;
<br/>
u16 filler2[3];
<br/>
u16 pb;
<br/>
u16 filler3[3];
<br/>
u16 pc;
<br/>
u16 filler4[3];
<br/>
u16 pd;
<br/>
}RotData, *pRotData;
<br/>
<br/>
<br/>
extern const u16 SilohData[];
<br/>
extern const u16 SilohPalette[];
<br/>
extern const u16 Siloh2Data[];
<br/>
//create an OAM variable and make it point to the address of OAM
<br/>
u16* OAMData = (u16*)0x7000000;
<br/>
<br/>
//create the array of sprites (128 is the maximum)
<br/>
OAMEntry Sprites[128];
<br/>
/*
<br/>
u8 counter;
<br/>
u8 counter2;*/
<br/>
<br/>
s16 x;
<br/>
s16 y;
<br/>
s16 x2;
<br/>
s16 y2;
<br/>
s16 x3;
<br/>
s16 y3;
<br/>
u16 busy;
<br/>
<br/>
//create the rotation and scaling array (overlaps the OAMEntry array memory)
<br/>
pRotData rotData = (pRotData)Sprites;
<br/>
<br/>
<br/>
<br/>
<br/>
// this is a piece of code to het the sprite move, use it for whatever you want :)
<br/>
void sprite_move (OAMEntry *s, u16 x, u16 y)
<br/>
{
<br/>
  u16 not_y = 0xFF00;
<br/>
  u16 not_x = 0xFE00;
<br/>
 
<br/>
  x = x &amp; 0x1FF;
<br/>
  y = y &amp; 0xFF;
<br/>
  Sprites[0].Attrib0 = Sprites[0].Attrib0 &amp; not_y;
<br/>
  Sprites[0].Attrib0 += y;
<br/>
  
<br/>
  Sprites[0].Attrib1 = Sprites[0].Attrib1 &amp; not_x;
<br/>
  Sprites[0].Attrib1 += x;
<br/>
<br/>
  x2 = x2 &amp; 0x1FF;
<br/>
   y2 = y2 &amp; 0xFF;
<br/>
   Sprites[1].Attrib0 = Sprites[1].Attrib0 &amp; not_y;
<br/>
   Sprites[1].Attrib0 += y2;
<br/>
<br/>
   Sprites[1].Attrib1 = Sprites[1].Attrib1 &amp; not_x;
<br/>
   Sprites[1].Attrib1 += x2;
<br/>
<br/>
<br/>
}
<br/>
<br/>
//Copy our sprite array to OAM
<br/>
void CopyOAM()
<br/>
{
<br/>
u16 loop;
<br/>
u16* temp;
<br/>
temp = (u16*)Sprites;
<br/>
for(loop = 0; loop &lt; 512; loop++)
<br/>
{
<br/>
OAMData[loop] = temp[loop];
<br/>
}
<br/>
}
<br/>
<br/>
//Set sprites to off screen
<br/>
void InitializeSprites()
<br/>
{
<br/>
u16 loop;
<br/>
/*for(loop = 0; loop &lt; 128; loop++)
<br/>
{
<br/>
Sprites[loop].Attrib0 = 160;  //y to &gt; 159
<br/>
Sprites[loop].Attrib1 = 240;  //x to &gt; 239
<br/>
}*/
<br/>
for (loop = 0; loop &lt; 8; loop++)
<br/>
{
<br/>
   Sprites[loop].Attrib0= 1 &lt;&lt; 9;
<br/>
}
<br/>
}
<br/>
<br/>
// CopySpriteData(); // ANTH : added this
<br/>
<br/>
void CopySpriteData(void)
<br/>
{
<br/>
u16 loop;
<br/>
volatile u16 *p0=(volatile u16 *)0x6010000;
<br/>
u16 *p1=(u16 *)SilohData;
<br/>
<br/>
for (loop=0;loop&lt;(16*16/*/sizeof(u16)*/);loop++) *p0++=*p1++;
<br/>
}
<br/>
/*
<br/>
void CopySpriteData2(void)
<br/>
{
<br/>
u16 loop;
<br/>
volatile u16 *p0=(volatile u16 *)(0x6010000+(8*8)*(8*8)*1); // ANTH : Fixed this
<br/>
u16 *p1=(u16*)Siloh2Data;
<br/>
for (loop=(64*64/sizeof(u16)); loop &lt; 
<br/>
(64*64/sizeof(u16))+(64*64/sizeof(u16)) ; loop++) *p0++=*p1++;
<br/>
}
<br/>
*/
<br/>
//wait for the screen to stop drawing
<br/>
<br/>
<br/>
/*
<br/>
void WaitforVsync()
<br/>
{
<br/>
   while((volatile u16)REG_VCOUNT != 160){}
<br/>
}*/
<br/>
void GetInput()
<br/>
{/*
<br/>
  u16 joy;
<br/>
<br/>
  joy = REG_P1;
<br/>
  joy = -joy;
<br/>
*/   
<br/>
   
<br/>
   if (KEYS &amp; KEY_LEFT)//32
<br/>
   {
<br/>
      x = x + 5;
<br/>
   }
<br/>
   /*if (KEYS &amp; KEY_UP)
<br/>
   {
<br/>
      y = y + 3;
<br/>
   }
<br/>
   if (KEYS &amp; KEY_DOWN)
<br/>
   {
<br/>
      y = y - 3;
<br/>
   }*/
<br/>
   
<br/>
   if (KEYS &amp; KEY_RIGHT)//16
<br/>
   {
<br/>
    x = x - 5;
<br/>
   }
<br/>
  // after we update the x and y position of the sprite for movement we need to update 
<br/>
  // the OAM data as well
<br/>
  sprite_move (&amp;Sprites[0],x,y);
<br/>
<br/>
}
<br/>
<br/>
void Elastiek()
<br/>
{   
<br/>
   s16 var1;
<br/>
   var1 = 0;
<br/>
   var1 = x - x2;
<br/>
   /*s16 acceleration;
<br/>
   s16 speed;*/
<br/>
   s8 xleft;
<br/>
   s8 xright;
<br/>
   s8 possibility;
<br/>
   u8 trigger;
<br/>
   /*acceleration = 0;
<br/>
   speed = 0;*/
<br/>
   xleft = 0;
<br/>
   xright = 0;
<br/>
   possibility = 0;
<br/>
   trigger = 0;
<br/>
   if (KEYS &amp; KEY_A)
<br/>
   {
<br/>
      possibility = 1;
<br/>
   }
<br/>
   if (KEYS &amp; KEY_B)
<br/>
   {
<br/>
      possibility = 2;
<br/>
   }
<br/>
   switch (possibility)
<br/>
   {
<br/>
      case '1':
<br/>
      x2--;
<br/>
      break;
<br/>
      case '2':
<br/>
      x2++;
<br/>
      break;
<br/>
   }
<br/>
}
<br/>
void WaitforVsync()
<br/>
{
<br/>
  while (REG_VCOUNT != 160);
<br/>
  while (REG_VCOUNT != 161);
<br/>
  /*counter++;
<br/>
  if (counter == 40)
<br/>
  {  counter = 0;
<br/>
  }*/
<br/>
  GetInput();
<br/>
}
<br/>
/*
<br/>
void animation(void)
<br/>
{ 
<br/>
   if (counter &gt; 19)
<br/>
      Sprites[0].Attrib2 = 128;
<br/>
   else
<br/>
   Sprites[0].Attrib2 = 0;
<br/>
      
<br/>
   if (counter &gt; 19)
<br/>
      Sprites[1].Attrib2 = 0;
<br/>
   else
<br/>
      Sprites[1].Attrib2 = 128;
<br/>
}*/
<br/>
int AgbMain()
<br/>
{
<br/>
  u16 loop;       //generic loop variable
<br/>
<br/>
  x = 80;
<br/>
  y = 10;
<br/>
  x2 = 80;
<br/>
  y2 = 70;
<br/>
  x3 = 300;
<br/>
  y3 = 300;
<br/>
  
<br/>
  SetVideoMode(MODE0 | OBJ_ENABLE | OBJ_MAP_1D); //set mode 1 and enable 
<br/>
  //sprites and 1d mapping
<br/>
<br/>
  for(loop = 0; loop &lt; 256; loop++)
<br/>
  {
<br/>
    OBJPaletteMem[loop] = SilohPalette[loop];
<br/>
  }
<br/>
<br/>
  InitializeSprites();                       //set all sprites off screen 
<br/>
  //(stops artifact)
<br/>
<br/>
<br/>
  CopySpriteData(); // ANTH : added this
<br/>
  /*CopySpriteData2();
<br/>
     */
<br/>
  
<br/>
  Sprites[0].Attrib0 = COLOR_256 | SQUARE | y; //setup sprite info, 
<br/>
  //256 colour, shape and y-coord
<br/>
  Sprites[0].Attrib1 = SIZE_16 | x;            //size 16x16 and 
<br/>
  //x-coord
<br/>
  Sprites[0].Attrib2 = 0;                      //pointer to tile where 
<br/>
  //sprite starts
<br/>
<br/>
<br/>
<br/>
  Sprites[1].Attrib0 = COLOR_256 | SQUARE | y2;
<br/>
  Sprites[1].Attrib1 = SIZE_16 | x2;
<br/>
  Sprites[1].Attrib2 = 0;
<br/>
u16 i;
<br/>
for (i = 2; i &lt; 128; i++) 
<br/>
{
<br/>
  Sprites[i].Attrib0 = COLOR_256 | SQUARE | y3;
<br/>
  Sprites[i].Attrib1 = SIZE_16 | x3;
<br/>
  Sprites[i].Attrib2 = 0;
<br/>
} 
<br/>
  while(1)
<br/>
  {
<br/>
    //Copies sprite array into OAM.
<br/>
    CopyOAM();
<br/>
    /*animation();*/
<br/>
   GetInput();
<br/>
   Elastiek();
<br/>
    WaitforVsync();
<br/>
<br/>
  }
<br/>
}
<br/>
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/>?There are no stupid questions but there are a LOT of inquisitive idiots.?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4484 - Torlus - Tue Apr 01, 2003 1:24 pm</h4>
    <div class="postbody"><span class="postbody">ok first thing :
<br/>
<br/>
on your top code you have a variable named "possibility" that can be 1 or 2. but in your switch() instruction, you test on values '1' and '2'.
<br/>
<br/>
'1' and '2' there represent characters of values 0x31 and 0x32, and not 1 or 2. You need to replace " case '1': " by " case 1: ". Same thing for the "case 2", of course...
<br/>
<br/>
then as i have a quick look at your code i think you'll meet some other problems.
<br/>
For instance, at the bottom of your code you have :
<br/>
<br/>
         while (trigger == 4) 
<br/>
         { 
<br/>
            if (x2 &gt; xleft) 
<br/>
            { 
<br/>
               x2--; 
<br/>
            } 
<br/>
         } 
<br/>
<br/>
which is an endless loop :)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
