<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Fading the BG palette.... - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>C/C++ > Fading the BG palette....</h2>
<div id="posts">
<div class="post">
    <h4>#26313 - sfz989 - Sun Sep 12, 2004 8:29 pm</h4>
    <div class="postbody"><span class="postbody">I want the screen to fade from black to my tiles. I've been tryin to get this working right for 3 days now......I know, I'm a n00b. Anyway can someone show me what is wrong with my code or give different code that will work? thanks in advance. Oh yeah, guess I should metion this is my first real project on gba, just to test my understanding of it....
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include "gba.h"
<br/>
<br/>
#define colors 0x100
<br/>
#define cnt_max 0x800
<br/>
<br/>
u16 palette[] = {0x7FFF,0x03E0,0x0019,0x0000,};
<br/>
<br/>
void fade_in()
<br/>
{
<br/>
   u16 loop1, loop2, r[colors], g[colors], b[colors], rt[colors], gt[colors], bt[colors];
<br/>
   u8 cnt, low_color, rd[colors], gd[colors], bd[colors], tempPalette[colors];
<br/>
   s8 diff;
<br/>
<br/>
   for( loop1 = 0; loop1 &lt; colors; loop1 ++ )
<br/>
   {
<br/>
      rt[loop1] = (palette[loop1] &lt;&lt; 10) &gt;&gt; 10;  // get red
<br/>
      gt[loop1] = (palette[loop1] &lt;&lt; 5) &gt;&gt; 10;   // get green
<br/>
      bt[loop1] = palette[loop1] &gt;&gt; 10;          // get blue
<br/>
      tempPalette[loop1] = palette[loop1];   // put palette[] in tempPalette[]
<br/>
      palette[loop1] = 0x0000;          // set palette[] to black
<br/>
      BG_PaletteMem[loop1] = palette[loop1]; // set screen to black
<br/>
   }
<br/>
   
<br/>
   for( loop2 = 0; loop2 &lt; colors; loop2 ++ )
<br/>
   {
<br/>
      if( cnt &lt; cnt_max ){         // slows fade down
<br/>
         while( palette[loop2] &lt; tempPalette[loop2] )
<br/>
         {
<br/>
            diff = -1;            // set to diff to -1
<br/>
            rd[loop2] = rt[loop2]-r[loop2];      // diff between red
<br/>
            gd[loop2] = gt[loop2]-g[loop2];      // diff between green
<br/>
            bd[loop2] = bt[loop2]-b[loop2];      // diff between blue
<br/>
<br/>
            if( rd[loop2] &gt; diff ){diff = rd[loop2]; low_color = 0;}
<br/>
            if( gd[loop2] &gt; diff ){diff = gd[loop2]; low_color = 1;}
<br/>
            if( bd[loop2] &gt; diff ){diff = bd[loop2]; low_color = 2;}
<br/>
<br/>
            if( low_color == 0 )
<br/>
            {
<br/>
               palette[loop2] += 0x0001; r[loop2] += 0x0001;
<br/>
            }
<br/>
            if( low_color == 1 )
<br/>
            {
<br/>
               palette[loop2] += 0x0020; g[loop2] += 0x0020;}
<br/>
            if( low_color == 2 )
<br/>
            {
<br/>
               palette[loop2] += 0x0400; b[loop2] += 0x0400;
<br/>
            }
<br/>
<br/>
            BG_PaletteMem[loop2] = palette[loop2];
<br/>
            cnt = 0;
<br/>
         }
<br/>
      }else{
<br/>
         cnt += 1;
<br/>
      }
<br/>
   }
<br/>
}
<br/>
<br/>
int main()
<br/>
{
<br/>
   u8 i, x, y;
<br/>
   u16* ScreenBB = (u16*)ScreenBaseBlock(8);
<br/>
   u16* CharBB = (u16*)CharBaseBlock(0);
<br/>
   REG_BG0CNT = BG_COLOR_256|TEXTBG_SIZE_256x256|(8&lt;&lt;SCREEN_SHIFT)|(0&lt;&lt;CHAR_SHIFT);
<br/>
   
<br/>
   SetMode(MODE_0|BG0_ENABLE);
<br/>
<br/>
   BG_PaletteMem[0] = RGB(31,31,31); //0x7FFF -white
<br/>
   BG_PaletteMem[1] = RGB(0,31,0); //0x03E0 -green
<br/>
   BG_PaletteMem[2] = RGB(0,0,25); //0x0019 -blue
<br/>
<br/>
   for(i=0;i&lt;32;i++)
<br/>
   {
<br/>
      CharBB[i] = 0x0000;
<br/>
   }
<br/>
<br/>
   for(i=32;i&lt;64;i++)
<br/>
   {
<br/>
      CharBB[i] = 0x0101;
<br/>
   }
<br/>
<br/>
   for(i=64;i&lt;96;i++)
<br/>
   {
<br/>
      CharBB[i] = 0x0202;
<br/>
   }
<br/>
<br/>
   x = 5;
<br/>
   y = 3;
<br/>
   ScreenBB[x+(32*y)] = 1;
<br/>
<br/>
   x = 15;
<br/>
   y = 8;
<br/>
   ScreenBB[x+(32*y)] = 2;
<br/>
   
<br/>
   fade_in();
<br/>
   
<br/>
   while(1){}
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"><br/><br/>Last edited by sfz989 on Mon Sep 13, 2004 2:24 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#26317 - poslundc - Sun Sep 12, 2004 8:43 pm</h4>
    <div class="postbody"><span class="postbody">It is helpful if you tell us what it is you are seeing vesus what you expect to see. But right off the bat I notice an error:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code"> ? ?? ?rt[l1]=(palette[l1]&lt;&lt;10)&gt;&gt;10;? // get red 
<br/>
 ? ?? ?gt[l1]=(palette[l1]&lt;&lt;5)&gt;&gt;10;? ?// get green 
<br/>
 ? ?? ?bt[l1]=palette[l1]&gt;&gt;10;? ?? ? ? ?// get blue</td> </tr></table><span class="postbody">
<br/>
<br/>
Shifting to get rid of the high bits in this fashion is unlikely to work in the first place, because the compiler will be treating the number as 32-bit instead of 16-bit. But even if it does, you would have to shift an extra bit in order properly zero 16 bits (you are shifting for 15 bits).
<br/>
<br/>
You are far better off using bitwise-and, as follows:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">red = c &amp; 0x1F;
<br/>
green = (c &gt;&gt; 5 ) &amp; 0x1F;
<br/>
blue = (c &gt;&gt; 10) &amp; 0x1F;</td> </tr></table><span class="postbody">
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26322 - sajiimori - Sun Sep 12, 2004 9:19 pm</h4>
    <div class="postbody"><span class="postbody">Style tips when posting code for others to read:
<br/>
<br/>
Get rid of all the magic numbers.
<br/>
<br/>
Variable names like "l1" are very hard to read because at first glance they almost look like numbers.
<br/>
<br/>
Whitespace around infix operators (= + - * / &lt; &gt; &lt;&lt; &gt;&gt;) is helpful.
<br/>
<br/>
Put opening braces on their own lines, directly under the first character of the previous line.  Use a different style privately if you want, but it's a very well established standard.
<br/>
<br/>
Use proper indentation.</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
// bad
<br/>
for(l2=0;l2&lt;256;l2++){                      // loop through all colors 
<br/>
   if(cnt&lt;2048){
<br/>
<br/>
// good (besides l2 and the magic numbers)
<br/>
for(l2 = 0; l2 &lt; 256; l2++)  // loop through all colors
<br/>
{
<br/>
    if(cnt &lt; 2048)
<br/>
    {</td> </tr></table><span class="postbody">Again, use whatever style you like in private, but try to do things the traditional way when asking others to read your code. =)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26331 - sfz989 - Mon Sep 13, 2004 2:31 am</h4>
    <div class="postbody"><span class="postbody">Thanks for the advice sajiimori. I think I have my code setup the right way now. 
<br/>
<br/>
Here's what the code really does:
<br/>
BG_PaletteMem[0] = RGB(0,0,1);   //it should be RGB(31,31,31);
<br/>
BG_PaletteMem[1] = RGB(0,1,1);   //should be RGB(0,31,0);
<br/>
BG_PaletteMem[2] = RGB(25,0,0); //should be RGB(0,0,25);</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26342 - FluBBa - Mon Sep 13, 2004 2:24 pm</h4>
    <div class="postbody"><span class="postbody">There seem to be a lot of different erros in the code...
<br/>
cnt is not initialized neither is the r array, the cnt/cnt_max check looks broken.
<br/>
Try this instead:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define colors 0x100
<br/>
<br/>
u16 palette[] = {0x7FFF,0x03E0,0x0019,0x0000,};
<br/>
<br/>
void fade_in()
<br/>
{
<br/>
    u32 luma;
<br/>
    for( luma = 1 ; luma &lt; 257 ; luma++)
<br/>
    {
<br/>
        fade(luma);
<br/>
        VSyncWait();
<br/>
     }
<br/>
}
<br/>
void fade(int luma)
<br/>
{
<br/>
   u32 loop1, loop2,r,g,b;
<br/>
<br/>
   for( loop1 = 0; loop1 &lt; colors; loop1 ++ )
<br/>
   {
<br/>
      r = ((palette[loop1] &amp; 0x1f) * luma)&gt;&gt;8;             // get red
<br/>
      g = (((palette[loop1] &gt;&gt; 5) &amp; 0x1f)*luma)&gt;&gt;8;    // get green
<br/>
      b = (((palette[loop1] &gt;&gt; 10) &amp; 0x1f)*luma)&gt;&gt;8;  // get blue
<br/>
      BG_PaletteMem[loop1] = r | (g&lt;&lt;5) | (b&lt;&lt;10);  // set screen colors
<br/>
   }
<br/>
}
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/>I probably suck, my not is a programmer.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26349 - sfz989 - Mon Sep 13, 2004 5:07 pm</h4>
    <div class="postbody"><span class="postbody">I never could figure out what was wrong with my code, but FluBBa's works perfectly. I'm not exactly sure how your code works, but Thanks a million!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26358 - sajiimori - Mon Sep 13, 2004 6:16 pm</h4>
    <div class="postbody"><span class="postbody">I'm not sure which part you don't understand, but splitting up the work might make each operation more clear:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define COLORS 0x100
<br/>
<br/>
u16 palette[COLORS] = {0x7FFF,0x03E0,0x0019,0x0000,};
<br/>
<br/>
int make_rgb(int r, int g, int b)
<br/>
{
<br/>
    return r | (g &lt;&lt; 5) | (b &lt;&lt; 10);
<br/>
}
<br/>
<br/>
int get_red(int color)
<br/>
{
<br/>
    return color &amp; 0x1f;
<br/>
}
<br/>
<br/>
int get_green(int color)
<br/>
{
<br/>
    return (color &gt;&gt; 5) &amp; 0x1f;
<br/>
}
<br/>
<br/>
int get_blue(int color)
<br/>
{
<br/>
    return (color &gt;&gt; 10) &amp; 0x1f;
<br/>
}
<br/>
<br/>
int dim_component(int component, int luma)
<br/>
{
<br/>
    return (component * luma) &gt;&gt; 8;
<br/>
}
<br/>
<br/>
int dim_color(int color, int luma)
<br/>
{
<br/>
    return make_rgb(
<br/>
        dim_component(get_red(color),   luma),
<br/>
        dim_component(get_green(color), luma),
<br/>
        dim_component(get_blue(color),  luma));
<br/>
}
<br/>
<br/>
void dim_palette(int luma)
<br/>
{
<br/>
    int i;
<br/>
    for(i = 0; i &lt; COLORS; i++)
<br/>
        BG_PaletteMem[i] = dim_color(palette[i], luma);
<br/>
}
<br/>
<br/>
void fade_in()
<br/>
{
<br/>
    int luma;
<br/>
    for(luma = 1; luma &lt; COLORS + 1; luma++)
<br/>
    {
<br/>
        dim_palette(luma);
<br/>
        VSyncWait();
<br/>
    }
<br/>
}
<br/>
</td> </tr></table><span class="postbody">Inline as preferred.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26377 - sfz989 - Tue Sep 14, 2004 4:24 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
int dim_component(int component, int luma) 
<br/>
{ 
<br/>
    return (component * luma) &gt;&gt; 8; 
<br/>
} 
<br/>
</td> </tr></table><span class="postbody">
<br/>
I get everything else but there's this one part I still dont' quite understand. Why do you multiply the color by luma then shitf it by 8 bits, what does this do? Sorry if this is really simple, I just don't get it...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26378 - sajiimori - Tue Sep 14, 2004 5:06 am</h4>
    <div class="postbody"><span class="postbody">Well, <span style="font-weight: bold">luma</span> is the numerator of a fraction whose denominator is <span style="font-weight: bold">256</span>.  So, when <span style="font-weight: bold">luma=1</span> then the fraction is <span style="font-weight: bold">1/256</span> and when luma is <span style="font-weight: bold">256</span> the fraction is <span style="font-weight: bold">256/256</span>.  The color component's value is reduced by multiplying by that fraction.  Obviously, when the fraction is <span style="font-weight: bold">256/256</span>, multiplying by it won't affect the component at all.
<br/>
<br/>
And, in case you didn't know, shifting right by 8 bits is the same as dividing by 256.  256 was chosen as the denominator because it is a power of 2, which allows a shift instead of a divide.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26381 - sgeos - Tue Sep 14, 2004 8:15 am</h4>
    <div class="postbody"><span class="postbody">I think you people are completely insane... messing with individual palette entries to get a fade effect.  Just use the blend registers.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">/***   Bits
<br/>
 */
<br/>
#define BIT(x)   (1 &lt;&lt; (x))
<br/>
<br/>
   // LCD I/O Color Special Effects
<br/>
   #define REG_BLDCNT   (*(vu16*)0x4000050)   // Color Special Effects Selection (Read/Write)
<br/>
      #define BLD_1ST(a)   BIT((a) + 0)
<br/>
      #define BLD_1ST_BG0   BIT(0)
<br/>
      #define BLD_1ST_BG1   BIT(1)
<br/>
      #define BLD_1ST_BG2   BIT(2)
<br/>
      #define BLD_1ST_BG3   BIT(3)
<br/>
      #define BLD_1ST_OBJ   BIT(4)
<br/>
      #define BLD_1ST_BD   BIT(5)
<br/>
      #define BLD_1ST_ALL   0x003F
<br/>
      #define BLD_OFF      0x0
<br/>
      #define BLD_ALPHA   BIT(6)
<br/>
      #define BLD_INC      BIT(7)
<br/>
      #define BLD_DEC      (BIT(6) | BIT(7))
<br/>
      #define BLD_MODE_MASK   (BIT(6) | BIT(7))
<br/>
      #define BLD_2ND(a)   BIT((a) + 8)
<br/>
      #define BLD_2ND_BG0   BIT(8)
<br/>
      #define BLD_2ND_BG1   BIT(9)
<br/>
      #define BLD_2ND_BG2   BIT(10)
<br/>
      #define BLD_2ND_BG3   BIT(11)
<br/>
      #define BLD_2ND_OBJ   BIT(12)
<br/>
      #define BLD_2ND_BD   BIT(13)
<br/>
      #define BLD_2ND_ALL   0x3F00
<br/>
   #define REG_BLDALPHA   (*(vu16*)0x4000052)   // Alpha Blending Coefficients (Write)
<br/>
      #define BLD_EVA(a)   ((a) &lt;&lt; 0)
<br/>
      #define BLD_EVB(a)   ((a) &lt;&lt; 8)
<br/>
      #define BLD_EVA_MASK   BLD_EVA(0x1F)
<br/>
      #define BLD_EVB_MASK   BLD_EVB(0x1F)
<br/>
   #define REG_BLDY   (*(vu16*)0x4000054)   // Brightness (Fade-In/Out) Coefficient (Write)
<br/>
      #define BLD_EVY(a)   ((a) &lt;&lt; 0)
<br/>
      #define BLD_EVY_MASK   BLD_EVY(0x1F)
<br/>
<br/>
<br/>
void vsync(void)
<br/>
{
<br/>
   increase_frame_count();
<br/>
   /* If we are in the vblank, wait for vdraw */
<br/>
   while (REG_VCOUNT &gt; 159)
<br/>
   {
<br/>
      /* wait */
<br/>
   }
<br/>
   /* Wait for vblank to begin */
<br/>
   while (REG_VCOUNT &lt; 160)
<br/>
   {
<br/>
      /* wait */
<br/>
   }
<br/>
}
<br/>
<br/>
void fade_to_black(int frames)
<br/>
{
<br/>
   int i;
<br/>
<br/>
   REG_BLDCNT =   BLD_DEC | BLD_1ST_ALL;
<br/>
   REG_BLDY =   BLD_EVY(0);
<br/>
   for (i = 0; i &lt; frames; i++) {
<br/>
      vsync();
<br/>
      REG_BLDY = BLD_EVY(16 * i / frames);
<br/>
   }
<br/>
   REG_BLDY =   BLD_EVY(16);
<br/>
}
<br/>
<br/>
void fade_from_black(int frames)
<br/>
{
<br/>
   int i;
<br/>
<br/>
   REG_BLDCNT =   BLD_DEC | BLD_1ST_ALL;
<br/>
   REG_BLDY =   BLD_EVY(16);
<br/>
   for (i = 0; i &lt; frames; i++) {
<br/>
      vsync();
<br/>
      REG_BLDY = BLD_EVY(16 - 16 * i / frames);
<br/>
   }
<br/>
   REG_BLDCNT =   BLD_OFF;
<br/>
   REG_BLDY =   BLD_EVY(0);
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26382 - DekuTree64 - Tue Sep 14, 2004 9:30 am</h4>
    <div class="postbody"><span class="postbody">One nice optimization for color blending is to do the red and blue in one pass. If you make your luma range from 0-31, and clear out the green bits, you can safely overflow into the hole, shift down, and re-clear the green bits. Green will have to be done by itself though, but that's still 1/3 of your work gone.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">rb = originalColor &amp; ~(31&lt;&lt;5); // clear green
<br/>
rb *= luma;
<br/>
rb &gt;&gt;= 5;
<br/>
rb &amp;= ~(31&lt;&lt;5);
<br/>
<br/>
g = originalColor &amp; (31&lt;&lt;5); // get green
<br/>
g *= luma;
<br/>
g &gt;&gt;= 10;  // chop the lower bits off, as well as the 5 empty bits where red was
<br/>
<br/>
finalColor = rb | (g &lt;&lt; 5); // this can be done in a single ARM instruction</td> </tr></table><span class="postbody">
<br/>
That should be fairly quick. Probably couldn't do much better even with ASM, since each line there is more or less one ARM instruction anyway. It'll be a lot slower if compiled as THUMB though.
<br/>
<br/>
But yeah, I agree with sgeos, if you're not using the blending register for anything else, by all means use it for fading. The only reason to ever use a palette fade is if you want to only fade certain colors, or if the blending register is already tied up.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26383 - Krakken - Tue Sep 14, 2004 10:06 am</h4>
    <div class="postbody"><span class="postbody">I found that palette fading produces much smoother results than the BLD registers, that's why I dont use them for that.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26385 - FluBBa - Tue Sep 14, 2004 12:28 pm</h4>
    <div class="postbody"><span class="postbody">Actually I've never coded a palette fading routine for the GBA before as I've only used the BLD regs myself, but it could be better to use a homemade routine if you want better resolution (32 steps for the brigths instead of 16) or if you use the BLD reg for other things. Happy that it worked (you never know until it's tested ;).<br/>_________________<br/>I probably suck, my not is a programmer.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26387 - tepples - Tue Sep 14, 2004 1:26 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sgeos wrote:</b></span></td> </tr> <tr> <td class="quote">I think you people are completely insane... messing with individual palette entries to get a fade effect.  Just use the blend registers.</td> </tr></table><span class="postbody">
<br/>
And have your transparency effects suddenly turn off, right?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26388 - dagamer34 - Tue Sep 14, 2004 2:39 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sgeos wrote:</b></span></td> </tr> <tr> <td class="quote">I think you people are completely insane... messing with individual palette entries to get a fade effect.  Just use the blend registers.</td> </tr></table><span class="postbody">
<br/>
And have your transparency effects suddenly turn off, right?</span></td> </tr></table><span class="postbody">
<br/>
<br/>
For a programmer, it is better to learn the hard way, and then the easy way, than to learn the easy way, and never learn the hard way at all. It makes programming all the more worthwhile. :)<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26394 - sfz989 - Tue Sep 14, 2004 4:32 pm</h4>
    <div class="postbody"><span class="postbody">^True true^
<br/>
<br/>
Thanks for breaking that code down sajiimori. I think I finally got it. Just to make sure let me try something....if that code makes it fade from black then all I would have to do to make it fade to black is this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void fade_out()
<br/>
{
<br/>
    u32 luma;
<br/>
    for( luma = 257 ; luma &gt; 1 ; luma--)
<br/>
    {
<br/>
        fade(luma);
<br/>
        WaitForVsync();
<br/>
     }
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
And if I wanted it to fade faster I could do this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void fade(int luma)
<br/>
{ 
<br/>
   u32 loop1,r,g,b;
<br/>
<br/>
   for( loop1 = 0; loop1 &lt; colors; loop1 ++ )
<br/>
   {
<br/>
      r = ((palette[loop1] &amp; 0x1f) * luma)&gt;&gt;7;             // get red
<br/>
      g = (((palette[loop1] &gt;&gt; 5) &amp; 0x1f)*luma)&gt;&gt;7;    // get green
<br/>
      b = (((palette[loop1] &gt;&gt; 10) &amp; 0x1f)*luma)&gt;&gt;7;  // get blue
<br/>
      BG_PaletteMem[loop1] = r | (g&lt;&lt;5) | (b&lt;&lt;10);  // set screen colors
<br/>
   }
<br/>
}
<br/>
void fade_in()
<br/>
{
<br/>
    u32 luma;
<br/>
    for( luma = 1 ; luma &lt; 129 ; luma++)
<br/>
    {
<br/>
        fade(luma);
<br/>
        WaitForVsync();
<br/>
     }
<br/>
}</td> </tr></table><span class="postbody">
<br/>
[edit] - Tested the code and it works, I finally got it. Thanks everyone!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26399 - sajiimori - Tue Sep 14, 2004 6:00 pm</h4>
    <div class="postbody"><span class="postbody">To fade at any speed, keep the denominator 256 and let fade_out take an argument that specifies the increment for luma at each iteration.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26401 - sgeos - Tue Sep 14, 2004 8:06 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sgeos wrote:</b></span></td> </tr> <tr> <td class="quote">I think you people are completely insane... messing with individual palette entries to get a fade effect. Just use the blend registers.</td> </tr></table><span class="postbody">And have your transparency effects suddenly turn off, right?</span></td> </tr></table><span class="postbody">
<br/>
I failed to recognize that requirement.  If blending and fading need to be done at once, by all means use a palette fading routine.  I personally think this would be a fantastic application of HSV routines.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">To fade at any speed, keep the denominator 256 and let fade_out take an argument that specifies the increment for luma at each iteration.</td> </tr></table><span class="postbody">
<br/>
<br/>
I'd do something like this.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">/*** MACROS
<br/>
 *
<br/>
 *  Magic numbers are evil.
<br/>
 *  Figure out what the numbers represent and use macros instead.
<br/>
 *  This makes reading and understanding code *much* easier!
<br/>
 */
<br/>
#define MAX_LUMINA    256
<br/>
#define MIN_LUMINA    0
<br/>
<br/>
void fade_out(int p_frames)
<br/>
{ 
<br/>
    s32 luma;
<br/>
    s32 increment;
<br/>
<br/>
<br/>
    /*** Calculate increment from frames
<br/>
     *
<br/>
     *  Valid frame range:
<br/>
     *      0 &lt; frames &lt;= MAX_LUMINA
<br/>
     */
<br/>
    increment = MAX_LUMINA / p_frames;
<br/>
<br/>
    /*** Main fade loop
<br/>
     */
<br/>
    for (luma = MAX_LUMINA; luma &gt; MIN_LUMINA; luma -= increment) 
<br/>
    { 
<br/>
        fade(luma); 
<br/>
        WaitForVsync(); 
<br/>
    } 
<br/>
<br/>
    /*** Ensure we fade completely
<br/>
     */
<br/>
    fade(MIN_LUMINA);
<br/>
    WaitForVsync();
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
