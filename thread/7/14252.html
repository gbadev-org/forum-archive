<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>My first graphics in SDL/C++ - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>C/C++ > My first graphics in SDL/C++</h2>
<div id="posts">
<div class="post">
    <h4>#141864 - Dood77 - Sun Sep 30, 2007 10:39 pm</h4>
    <div class="postbody"><span class="postbody">I've been attempting to learn C++ on my own time with online tutorials, soon I hope to get a nice book, etc.
<br/>
I've programmed a few console apps that do simple math, etc. 
<br/>
And now I've tried to program some graphics with SDL, I did this tutorial that sets up the screen and fills it with a colorful background, and now I'm trying to code a simple pong game, but I'm having trouble with some object-oriented things.
<br/>
<br/>
So far I have my struct called box.
<br/>
Box contains x, y, height, width ints, as well as two color structs called innerColor and borderColor, each with ints r, g, and b.
<br/>
I want box to have a function called draw that will use two for loops to draw its pixels on to the buffer, but this is where I'm having the trouble.
<br/>
In the main function, I have a while loop that loops until the int done == 1, and in that loop, I create an instance of the box struct called p1, I set p1.x, p1.y, p1.width, etc. I then want to be able to call p1::draw(buffer) but I'm getting some really strange compiler errors.
<br/>
Oh yeah, and I'm compiling using Dev-C++ on win32
<br/>
Heres my messy source:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include &lt;stdlib.h&gt;
<br/>
#include &lt;iostream.h&gt;
<br/>
<br/>
#include &lt;SDL/SDL.h&gt;
<br/>
using namespace std;
<br/>
// Check if screen needs to be locked and lock it on func call:
<br/>
void Slock(SDL_Surface *screen)
<br/>
{
<br/>
  if ( SDL_MUSTLOCK(screen) )
<br/>
  {
<br/>
    if ( SDL_LockSurface(screen) &lt; 0 )
<br/>
    {
<br/>
      return;
<br/>
    }
<br/>
  }
<br/>
}
<br/>
//unlock screen:
<br/>
void Sulock(SDL_Surface *screen)
<br/>
{
<br/>
  if ( SDL_MUSTLOCK(screen) )
<br/>
  {
<br/>
    SDL_UnlockSurface(screen);
<br/>
  }
<br/>
}  
<br/>
<br/>
<br/>
//function to draw a pixel as dictated by SDL tutorial
<br/>
void DrawPixel(SDL_Surface *screen, int x, int y,
<br/>
                                    Uint8 R, Uint8 G, Uint8 B)
<br/>
{
<br/>
  Uint32 color = SDL_MapRGB(screen-&gt;format, R, G, B);
<br/>
  switch (screen-&gt;format-&gt;BytesPerPixel)
<br/>
  {
<br/>
    case 1: // Assuming 8-bpp
<br/>
      {
<br/>
        Uint8 *bufp;
<br/>
        bufp = (Uint8 *)screen-&gt;pixels + y*screen-&gt;pitch + x;
<br/>
        *bufp = color;
<br/>
      }
<br/>
      break;
<br/>
    case 2: // Probably 15-bpp or 16-bpp
<br/>
      {
<br/>
        Uint16 *bufp;
<br/>
        bufp = (Uint16 *)screen-&gt;pixels + y*screen-&gt;pitch/2 + x;
<br/>
        *bufp = color;
<br/>
      }
<br/>
      break;
<br/>
    case 3: // Slow 24-bpp mode, usually not used
<br/>
      {
<br/>
        Uint8 *bufp;
<br/>
        bufp = (Uint8 *)screen-&gt;pixels + y*screen-&gt;pitch + x * 3;
<br/>
        if(SDL_BYTEORDER == SDL_LIL_ENDIAN)
<br/>
        {
<br/>
          bufp[0] = color;
<br/>
          bufp[1] = color &gt;&gt; 8;
<br/>
          bufp[2] = color &gt;&gt; 16;
<br/>
        } else {
<br/>
          bufp[2] = color;
<br/>
          bufp[1] = color &gt;&gt; 8;
<br/>
          bufp[0] = color &gt;&gt; 16;
<br/>
        }
<br/>
      }
<br/>
      break;
<br/>
    case 4: // Probably 32-bpp
<br/>
      {
<br/>
        Uint32 *bufp;
<br/>
        bufp = (Uint32 *)screen-&gt;pixels + y*screen-&gt;pitch/4 + x;
<br/>
        *bufp = color;
<br/>
      }
<br/>
      break;
<br/>
  }
<br/>
}
<br/>
//structs
<br/>
struct color 
<br/>
{
<br/>
       int r;
<br/>
       int g;
<br/>
       int b;
<br/>
}
<br/>
struct box
<br/>
{
<br/>
       int width;
<br/>
       int height;
<br/>
       int x;
<br/>
       int y;
<br/>
       struct color borderColor;
<br/>
       struct color innerColor;
<br/>
//heres where I attempt to have the draw function in box
<br/>
       void box::draw(SDL_Surface *screen)
<br/>
       {
<br/>
         for (x;x&lt;x+width;x++)
<br/>
         {
<br/>
              for (y;y&lt;y+height;y++)
<br/>
                 {
<br/>
                        DrawPixel(screen,x,y,innerColor.r,innerColor.g,innerColor.b);
<br/>
                 }
<br/>
         }
<br/>
       }     
<br/>
}
<br/>
<br/>
<br/>
   
<br/>
<br/>
//draw background
<br/>
void DrawScene(SDL_Surface *screen)
<br/>
{
<br/>
<br/>
  Slock(screen);
<br/>
  for(x=0;x&lt;32;x++)
<br/>
  {
<br/>
    for(y=0;y&lt;32;y++)
<br/>
    {
<br/>
       DrawPixel(screen, x, y, 255, 255, 255);
<br/>
    }
<br/>
  }
<br/>
<br/>
  Sulock(screen);
<br/>
  SDL_Flip(screen);
<br/>
}
<br/>
<br/>
//----------------MAIN------------------
<br/>
int main(int argc, char *argv[])
<br/>
{
<br/>
                   //error checking
<br/>
  if ( SDL_Init(SDL_INIT_AUDIO|SDL_INIT_VIDEO) &lt; 0 )
<br/>
  {
<br/>
    cout &lt;&lt; "Unable to init SDL: " &lt;&lt; SDL_GetError() &lt;&lt;endl;
<br/>
    exit(1);
<br/>
  }
<br/>
  atexit(SDL_Quit);
<br/>
                   //setup surface
<br/>
  SDL_Surface *screen;
<br/>
  screen=SDL_SetVideoMode(640,480,32,SDL_HWSURFACE|SDL_DOUBLEBUF);
<br/>
                   //error check surface
<br/>
  if ( screen == NULL )
<br/>
  {
<br/>
    cout &lt;&lt; "Unable to set 640x480 video: " &lt;&lt; SDL_GetError() &lt;&lt; endl;
<br/>
    exit(1);
<br/>
  }
<br/>
<br/>
int done = 0;
<br/>
    //----------Game loop-----------
<br/>
while (done == 0)
<br/>
{
<br/>
      SDL_Event event;
<br/>
<br/>
    while ( SDL_PollEvent(&amp;event) )
<br/>
    {
<br/>
      if ( event.type == SDL_QUIT )  {  done = 1;  }
<br/>
/*
<br/>
      if ( event.type == SDL_KEYDOWN )
<br/>
      {
<br/>
        cout &lt;&lt; event.key.keysym.sym &lt;&lt; endl &lt;&lt; endl;
<br/>
        done = 0;
<br/>
      } */
<br/>
    }
<br/>
    struct box p1;
<br/>
    p1.width = 32;
<br/>
    p1.height = 8;
<br/>
    p1.borderColor.r = 0;
<br/>
    p1.borderColor.g = 0;
<br/>
    p1.borderColor.b = 0;
<br/>
    p1.innerColor.r = 0;
<br/>
    p1.innerColor.g = 200;
<br/>
    p1.innerColor.b = 0;
<br/>
    p1::draw(screen);
<br/>
    DrawScene(screen);
<br/>
}
<br/>
//program end
<br/>
  return 0;
<br/>
}
<br/>
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/>If I use a term wrong or something then feel free to correct, I?m not much of a programmer.
<br/>
<span style="font-size: 9px; line-height: normal">
<br/>
Original DS Phat obtained on day of release + flashme v7
<br/>
Supercard: miniSD, Kingston 1GB, Kingston 2GB
<br/>
Ralink chipset PCI NIC
<br/>
</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141925 - gauauu - Mon Oct 01, 2007 7:18 pm</h4>
    <div class="postbody"><span class="postbody">I haven't used C++ structs with methods in them much, so maybe I'm smoking crack, but why are you calling draw() as a static method instead of as a member.  Instead, try calling it as a member:
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
...
<br/>
    p1.innerColor.g = 200;
<br/>
    p1.innerColor.b = 0;
<br/>
    p1.draw(screen); 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
<span style="font-weight: bold">edit:</span>added text to clarify that might code snippet was a correction.</span><span class="gensmall"><br/><br/>Last edited by gauauu on Mon Oct 01, 2007 10:20 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#141928 - tepples - Mon Oct 01, 2007 7:41 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>gauauu wrote:</b></span></td> </tr> <tr> <td class="quote">I haven't used C++ structs with methods in them much</td> </tr></table><span class="postbody">
<br/>
You may have used something identical and just not know it. As StoneCypher has <a class="postlink" href="http://wiki.answers.com/Q/What_is_the_difference_between_a_structure_and_a_class" target="_blank">explained</a> several times, the struct and class keywords of the C++ language differ only in the privilege of any members that precede the first privilege label: public for structs and private for classes. Semantics in code designed to be compiled in both the C++ language and the C language, such as the header file of a library, are more complicated.
<br/>
<br/>
EDIT: Removed the second part of my post where I was confusing a quotation with a correction.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"><br/><br/>Last edited by tepples on Mon Oct 01, 2007 7:57 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#141929 - Lick - Mon Oct 01, 2007 7:54 pm</h4>
    <div class="postbody"><span class="postbody">tepples: near the end of the original source listing...
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">p1::draw(screen); </td> </tr></table><span class="postbody">
<br/>
<br/>
By the way this is just funny naming of variables:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">event.key.keysym.sym</td> </tr></table><span class="postbody"><br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141945 - Dood77 - Tue Oct 02, 2007 3:20 am</h4>
    <div class="postbody"><span class="postbody">Thanks for the help, I figured it all out today at school, and the school blocks almost all forums so I probably would've figured it out sooner were it not for my school's blind sensorship... But it turns out the problem mentioned was one of them, but my main problem was that I required semicolons after the block of code defining my structs. I read nothing of this in my earlier more basic tutorials, and the compiler errors were really unrelated to this problem.
<br/>
<br/>
The other problem I was having with this function was SDL throwing a "segmentation fault" and terminating the program (or in stderr.txt's words, "SDL Parachute deployed", lol). This was caused by the rather daft blunder of creating an infinite for loop like so:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
for (x=0;x&lt;x+width;x++)
<br/>
{
<br/>
//blah
<br/>
}
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/>If I use a term wrong or something then feel free to correct, I?m not much of a programmer.
<br/>
<span style="font-size: 9px; line-height: normal">
<br/>
Original DS Phat obtained on day of release + flashme v7
<br/>
Supercard: miniSD, Kingston 1GB, Kingston 2GB
<br/>
Ralink chipset PCI NIC
<br/>
</span></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
