<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Having more than 6 ships in collection causes crash - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>C/C++ > Having more than 6 ships in collection causes crash</h2>
<div id="posts">
<div class="post">
    <h4>#83010 - Lini - Fri May 12, 2006 12:27 am</h4>
    <div class="postbody"><span class="postbody">I can't seem to figure this out myself.
<br/>
<br/>
I have 2 arrays for ship placement, one for horizontal and one for vertical:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
const u8 IN_ROW[21] = {0,0,0,0,0,0,0,1,1,1,1,1,1,1,2,2,2,2,2,2,2}; //The row each ship is in
<br/>
const u8 IN_COL[21] = {0,1,2,3,4,5,6,0,1,2,3,4,5,6,0,1,2,3,4,5,6}; //The column each ship is in
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I use ham_CreateObj() to create the ships at the correct x/y position:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   while(i &lt; MAX_IN_COLLECTION)
<br/>
   {
<br/>
      if(ships_type[i] != NO_SHIP)
<br/>
      {
<br/>
         ships[i] = ham_CreateObj((void*)&amp;shipspr_Bitmap,
<br/>
OBJ_SIZE_16X16,OBJ_MODE_NORMAL,1,0,0,0,0,0,0,((IN_COL[i])*19)+4,((IN_ROW[i])*19)+103);
<br/>
<br/>
         ham_UpdateObjGfx(ships[i],(void*)&amp;shipspr_Bitmap[256*ships_type[i]]);
<br/>
      }
<br/>
<br/>
      i++;
<br/>
   }
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I also update the ship graphic according to ships_type (which is the ship type).
<br/>
Yes, I know I could use a 'for' loop, I just forgot about i when I coded this.  It was about 2AM, and I was tired.
<br/>
<br/>
But when I get more than 6 ships in collection, it causes the graphics to bug out, and it crashes when you try to go to flight-mode after that.
<br/>
<br/>
Other related code:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define NO_SHIP            150
<br/>
const u8 MAX_IN_COLLECTION = 21;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
The interface background (I'm using a 256 color bitmap, had to convert to gif to upload/show):
<br/>
<a href="http://kupo-ing.freeservers.com/images/interfacebg.GIF">[Images not permitted - Click here to view it]</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#83038 - ScottLininger - Fri May 12, 2006 6:29 am</h4>
    <div class="postbody"><span class="postbody">I'm not familiar enough with HAM to say for certain, but it sounds like you're overflowing your sprite tile memory. 
<br/>
<br/>
If you're using VisualBoy for emulation, you can use the Tile viewer to peek into your sprite tile memory and see how full it is. 
<br/>
<br/>
If I'm right about the problem, your solution might be to more carefully share tiles between ships so that you're minimizing the # of tiles. Your other solution might be to go to 16-color tiles rather than 256.
<br/>
<br/>
-scott</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#83056 - sgeos - Fri May 12, 2006 1:02 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lini wrote:</b></span></td> </tr> <tr> <td class="quote">Yes, I know I could use a 'for' loop, I just forgot about i when I coded this.  It was about 2AM, and I was tired.</td> </tr></table><span class="postbody">
<br/>
You should promptly fix things that seem silly instead of trying to excuse  coding behavior.  I'll let someone else bring up the counter argument =)
<br/>
<br/>
I don't know enough about HAM to help you.  Read over other parts of your code.  The problem might be somewhere else.  I've had times where I know the problem is *here*... then after six hours and a nights sleep, I find the problem *there*. =P
<br/>
<br/>
Good luck!
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#83693 - ProblemBaby - Wed May 17, 2006 10:00 pm</h4>
    <div class="postbody"><span class="postbody">a buffer with 21 u8's would cause misaligned data I think.
<br/>
change to 24 to be safe.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
