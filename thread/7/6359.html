<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Pass custom pointer to function. - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>C/C++ > Pass custom pointer to function.</h2>
<div id="posts">
<div class="post">
    <h4>#48440 - QuantumDoja - Wed Jul 20, 2005 12:04 am</h4>
    <div class="postbody"><span class="postbody">Hi, I have the following structure: Question at bottom.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
typedef struct combo {
<br/>
   u8 step;
<br/>
   u16 difference;
<br/>
   u8 stepmax;
<br/>
   u16 sequence[7];
<br/>
}combo;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I have some variables of it like so:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
combo combo0;
<br/>
combo combo1;
<br/>
combo combo2;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
and a function:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void update_combo(combo cb, int id) {
<br/>
<br/>
   if (keyDown(cb.sequence[cb.step])) {
<br/>
      cb.difference = 0;
<br/>
      if (cb.step == cb.stepmax) {
<br/>
<br/>
         cb.step = 0;
<br/>
      }
<br/>
      cb.step++;
<br/>
   } else {
<br/>
      cb.difference++;
<br/>
      if (cb.difference &gt; 40) {
<br/>
         cb.step = 0;
<br/>
         cb.difference = 0;
<br/>
      }
<br/>
   }
<br/>
<br/>
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
How can I pass into the update_combo function the defined variables as a pointer, i have tried it, but it keeps saying that all the members of the struct are not a struct or union!!
<br/>
<br/>
I have tried this to no luck:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
void update_combo(combo *cb, int id) {
<br/>
<br/>
   if (keyDown(*cb.sequence[*cb.step])) {
<br/>
      *cb.difference = 0;
<br/>
      if (*cb.step == *cb.stepmax) {
<br/>
<br/>
         *cb.step = 0;
<br/>
      }
<br/>
      *cb.step++;
<br/>
   } else {
<br/>
      *cb.difference++;
<br/>
      if (*cb.difference &gt; 40) {
<br/>
         *cb.step = 0;
<br/>
         *cb.difference = 0;
<br/>
      }
<br/>
   }
<br/>
<br/>
<br/>
}</td> </tr></table><span class="postbody"><br/>_________________<br/>Chris Davis</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#48443 - sajiimori - Wed Jul 20, 2005 1:13 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
*cb.sequence  // Equivalent to *(cb.sequence)
<br/>
cb-&gt;sequence  // Equivalent to (*cb).sequence
<br/>
</td> </tr></table><span class="postbody">
<br/>
Use the first if cb is a struct and sequence is a pointer.  Use the second if cb is a pointer to a struct.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#48448 - APL - Wed Jul 20, 2005 2:34 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">typedef struct combo {
<br/>
   u8 step;
<br/>
   u16 difference;
<br/>
   u8 stepmax;
<br/>
   u16 sequence[7];
<br/>
}combo; </td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
<br/>
Are we confident this syntax is legal?  Try it without the first "combo".    (or without the second "combo" and do the typedef seperately.)
<br/>
<br/>
<br/>
Notice that the first version of your function would not do anything usefull.  If you pass by value like that you're working on a local copy of the struct, not the original.  If you want to change the original, you need to pass by pointer, as in your second function.<br/>_________________<br/>-Andy L 
<br/>
<a href="http://www.depthchasers.com" target="_blank">http://www.depthchasers.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#48450 - sajiimori - Wed Jul 20, 2005 3:06 am</h4>
    <div class="postbody"><span class="postbody">The syntax is legal.  Structs are in a different namespace than typedefs.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#48480 - QuantumDoja - Wed Jul 20, 2005 10:38 am</h4>
    <div class="postbody"><span class="postbody"><span style="font-weight: bold">Thank you</span>
<br/>
<br/>
you guys are teh best.
<br/>
<br/>
Here is the final code:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
void update_combo(combo *cb, int id) {
<br/>
<br/>
<br/>
   if (keyDown(cb-&gt;sequence[cb-&gt;step])) {
<br/>
      cb-&gt;difference = 0;
<br/>
      if (cb-&gt;step == cb-&gt;stepmax) {
<br/>
<br/>
<br/>
         switch (id) {
<br/>
            case 0:
<br/>
               {
<br/>
               //do something
<br/>
               break;
<br/>
               }
<br/>
            case 1:
<br/>
               {
<br/>
               //do something
<br/>
               break;
<br/>
               }
<br/>
            case 2:
<br/>
               {
<br/>
               //do something
<br/>
               break;
<br/>
               }
<br/>
            default:break;
<br/>
         }         
<br/>
<br/>
<br/>
         cb-&gt;step = 0;
<br/>
      }
<br/>
      cb-&gt;step++;
<br/>
   } else {
<br/>
      cb-&gt;difference++;
<br/>
      if (cb-&gt;difference &gt; 40) {
<br/>
         cb-&gt;step = 0;
<br/>
         cb-&gt;difference = 0;
<br/>
      }
<br/>
   }
<br/>
<br/>
}
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/>Chris Davis</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#48502 - tepples - Wed Jul 20, 2005 1:49 pm</h4>
    <div class="postbody"><span class="postbody">Step? Combo? Are you trying to infringe Konami's patent on DDR? Or are you using some other display method, such as the Taiko Drum Master method (50% Flip, horizontally scrolling) or the Parappa method (similar, but with a moving receptor over multiple rows of step marks)?
<br/>
<br/>
EDIT: Based on information you sent in a PM, you must mean "combo" as in Street Fighter, not "combo" as in Dance Dance Revolution. The word "step" confused me.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
