<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Annoying problem - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>C/C++ > Annoying problem</h2>
<div id="posts">
<div class="post">
    <h4>#7652 - Psyk - Sun Jun 22, 2003 1:26 pm</h4>
    <div class="postbody"><span class="postbody">For collision detection i build up a collision map based on the tiles. It checks through every tile and if it's a walkable tile it will set the corresponding entry of the collision map to 0 and if not it sets it to 1. This works fine when i check it against the map data itself but when i try to check it against a pointer to the map data it just doesn't work. It doesn't come up with an error when i compile it, it just sets the whole collision map to 1s. Does anyone have any idea why it doesn't work?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7653 - funkeejeffou - Sun Jun 22, 2003 1:54 pm</h4>
    <div class="postbody"><span class="postbody">Could you please show the collision code and how you define your pointers?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7657 - Psyk - Sun Jun 22, 2003 6:21 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   for(loopx=0;loopx&lt;bg-&gt;sizeX;loopx++)
<br/>
      for(loopy=0;loopy&lt;bg-&gt;sizeY;loopy++)
<br/>
         if(bg-&gt;mapData[bg-&gt;sizeX*loopy+loopx]==0x18)
<br/>
            collisionMap[loopx][loopy]=0;
<br/>
         else
<br/>
            collisionMap[loopx][loopy]=1;
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
mapData is part of a structure for the bg that is the pointer to the actual map data. Here is how the pointer is defined:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
const Bg rooma = {other structure data ,(u16*)room, more structure data};
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
room is the name of the actual map data.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7741 - Cyberman - Mon Jun 23, 2003 7:55 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Psyk wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
const Bg rooma = {other structure data ,(u16*)room, more structure data};
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
room is the name of the actual map data.</span></td> </tr></table><span class="postbody">
<br/>
Hmmm how about trying this instead
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
const Bg rooma = {other structure data ,(u16*)&amp;room, more structure data};
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I think the problem is actually bad coding habits, I've seen this mistake a lot, Assuming that putting a variable (room) will automatically dereference it. This only happens with type char and only in certain circumstances.  I wouldn't depend on it.
<br/>
<br/>
ALWAYS use the dereference operator ( &amp; ) to be sure you get a POINTER and not the actual variable or the first few elements of the array cast to a pointer (thus it point god knows where).
<br/>
<br/>
Cyb</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7747 - Psyk - Mon Jun 23, 2003 10:37 pm</h4>
    <div class="postbody"><span class="postbody">Well i tried your suggestion but i still have the same problem. Still I'll remember to put the &amp; operator in the future. Maybe there could be a problem here:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">if(bg-&gt;mapData[bg-&gt;sizeX*loopy+loopx]==0x18)</td> </tr></table><span class="postbody">
<br/>
<br/>
Is there some operator or something that i'm missing out here?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7784 - Psyk - Tue Jun 24, 2003 4:42 pm</h4>
    <div class="postbody"><span class="postbody">I've sorted it now but I still don't know why it didn't work before. To fix it I added the pointer to the map data as a seperate argument for the function instead of it being part of the bg structure.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7785 - johnny_north - Tue Jun 24, 2003 4:46 pm</h4>
    <div class="postbody"><span class="postbody">I don't see anything wrong here. Are you certain that the map data actually contains 0x18 as one of the tile entries? Does this actually correspont to a pathway tile? Never hurts to double check.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7786 - Psyk - Tue Jun 24, 2003 4:53 pm</h4>
    <div class="postbody"><span class="postbody">Yeah it definately does as it worked before when i was refering directly to the data without a pointer and it works now that the pointer is seperate to the bg strucutre.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7799 - GbaGuy - Tue Jun 24, 2003 11:19 pm</h4>
    <div class="postbody"><span class="postbody">I thought that &amp; was the Address Of operator and  * was the 
<br/>
dereference operator...
<br/>
<br/>
Now I'm confused... :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7808 - Lupin - Wed Jun 25, 2003 1:25 pm</h4>
    <div class="postbody"><span class="postbody">var1 = var2 &amp; var3;  //That's logical AND
<br/>
var1 = &amp;var2;  //That will get var2's address and store it into var1
<br/>
<br/>
* is multiply and for dereferencing, but if you have double pointers you need paranthesis for dereferencing, like this:
<br/>
<br/>
(*var1)[2] = var3; //this would solve var1 first and then solve it again using array index
<br/>
<br/>
the context is important for these operators</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
