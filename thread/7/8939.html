<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>no binary OR on a float? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>C/C++ > no binary OR on a float?</h2>
<div id="posts">
<div class="post">
    <h4>#75902 - racarate - Thu Mar 16, 2006 10:33 pm</h4>
    <div class="postbody"><span class="postbody">Hi, I wrote a function to blend two colors
<br/>
<br/>
<br/>
unsigned short blendColor( unsigned short colorA, unsigned short colorB, float colorRatio ) 
<br/>
{
<br/>
<br/>
colorA = ( colorRatio * ( colorA &amp; 0xF000 ) ) | ( colorA &amp; 0x0FFF );	
<br/>
colorA = ( colorRatio * ( colorA &amp; 0x0F00 ) ) | ( colorA &amp; 0xF0FF );
<br/>
colorA = ( colorRatio * ( colorA &amp; 0x00F0 ) ) | ( colorA &amp; 0xFF0F );
<br/>
colorA = ( colorRatio * ( colorA &amp; 0x000F ) ) | ( colorA &amp; 0xFFF0 );
<br/>
<br/>
colorRatio = 1 - colorRatio;
<br/>
<br/>
colorB = ( colorRatio * ( colorA &amp; 0xF000 ) ) | ( colorA &amp; 0x0FFF );	
<br/>
colorB = ( colorRatio * ( colorA &amp; 0x0F00 ) ) | ( colorA &amp; 0xF0FF );
<br/>
colorB = ( colorRatio * ( colorA &amp; 0x00F0 ) ) | ( colorA &amp; 0xFF0F );
<br/>
colorB = ( colorRatio * ( colorA &amp; 0x000F ) ) | ( colorA &amp; 0xFFF0 );
<br/>
<br/>
return ( colorA + colorB );
<br/>
<br/>
}
<br/>
<br/>
<br/>
And while I think my logic is sound, I am getting the following error:
<br/>
<br/>
error: invalid operands to binary |
<br/>
<br/>
What is the implicit cast that occurs when a short is multiplied by a float?  If it resolves to a float, why can't I use a binary OR on it?<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="font-weight: bold">Neko: I love meow-tain climbing! 
<br/>
Need anything? I'll even save your game!</span></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#75915 - poslundc - Thu Mar 16, 2006 11:35 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>racarate wrote:</b></span></td> </tr> <tr> <td class="quote">What is the implicit cast that occurs when a short is multiplied by a float?  If it resolves to a float, why can't I use a binary OR on it?</td> </tr></table><span class="postbody">
<br/>
<br/>
Because bitwise-OR isn't intended to be used with floating-point representations of numbers, and many hardware platforms (though not the GBA, I suppose) have dedicated floating-point registers that you would not be able to use the OR operation on.
<br/>
<br/>
But as the <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=418" target="_blank">FAQ</a> says, don't use floating point, use <a class="postlink" href="http://www.google.com/search?q=fixed+point" target="_blank">fixed-point</a>.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#75923 - tepples - Fri Mar 17, 2006 1:07 am</h4>
    <div class="postbody"><span class="postbody">I could convert this code to fixed-point, but it wouldn't work as expected on the Game Boy Advance or Nintendo DS. For one thing, you're blending groups of 4 bits, which works on the Apple IIGS, Sega Game Gear, Sega Genesis, and PC Engine, but not on Nintendo systems. The Super NES, GBC, GBA, and Nintendo DS use groups of 5 bits.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#75949 - racarate - Fri Mar 17, 2006 5:39 am</h4>
    <div class="postbody"><span class="postbody">Ack, there is a bunch of things wrong with this.  Thanks for the help, I think I know how to proceed now.<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="font-weight: bold">Neko: I love meow-tain climbing! 
<br/>
Need anything? I'll even save your game!</span></span></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
