<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Extract bmp files from game boy camera .sav - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>C/C++ > Extract bmp files from game boy camera .sav</h2>
<div id="posts">
<div class="post">
    <h4>#177938 - rombus - Wed May 15, 2013 3:21 am</h4>
    <div class="postbody"><span class="postbody">Hello everyone! I'm trying to develop a linux native image extractor for game boy camera .sav's
<br/>
<br/>
From what I understand, the 4 shades of grey are represented with 2 bits. And so far I've managed to read every byte and mapp it to a color. But all I end up having is a black square.
<br/>
<br/>
Anyone has any information about how can I achieve this functionality?
<br/>
<br/>
Any tips are appreciated. I couldn't find much information on this topic.
<br/>
<br/>
Here's the algorithm I'm using to convert each byte from the sav to a RGB pixel. putColor, adds 3 values to the file (RGB values)
<br/>
<br/>
In pastebin <a class="postlink" href="http://pastebin.com/uSMT0Wpj" target="_blank">http://pastebin.com/uSMT0Wpj</a>
<br/>
<br/>
<br/>
Thanks in advance!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177939 - sverx - Wed May 15, 2013 8:53 am</h4>
    <div class="postbody"><span class="postbody">A black square? Then it either means your file is all filled with zeros or you've got a problem in your code...<br/>_________________<br/><a class="postlink" href="http://bit.ly/yiQrz9" target="_blank">libXM7</a>|<a class="postlink" href="http://bit.ly/yJwcOo" target="_blank">NDS programming tutorial (Italiano)</a>|<a class="postlink" href="http://disjointedstudio.blogspot.com/" target="_blank">Waimanu DS / GBA</a>|<a class="postlink" href="http://adshomebrewersdiary.blogspot.com" target="_blank">A DS Homebrewer's Diary</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177940 - rombus - Wed May 15, 2013 12:00 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for the quick response sverx. 
<br/>
When I analyze the output.bmp the file is a lot bigger than it shoud be, and I notice too that the first data bytes are full of zeros. I'm kind of stuck with this. The fact that I'm picking every 2 bits and converting them to 3 R-G-B values into the output.bmp is right?
<br/>
<br/>
Here's a link for a zip file where I uploaded my code and the test .sav and .bmp I'm using. 
<br/>
<br/>
totem.sav is the sav file from the gb camera.
<br/>
totem1.bmp is the first photo of that sav (extracted with a win2 program)
<br/>
When the program finish running it will generate a out.bmp (black in this case :c )
<br/>
<br/>
<a class="postlink" href="https://docs.google.com/file/d/0B1icVXjWL_BUMG5RZ0VDdmg2SW8/edit?usp=sharing" target="_blank">https://docs.google.com/file/d/0B1icVXjWL_BUMG5RZ0VDdmg2SW8/edit?usp=sharing</a>
<br/>
<br/>
I'm copying the header from totem1.bmp though I programmed a little header in my code that I'm not using right now just to leave it out of generating problems.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177941 - sverx - Thu May 16, 2013 10:10 am</h4>
    <div class="postbody"><span class="postbody">totem1.bmp is a 16 color bitmap (4 bpp), which is using only palette entries number 0 (black), 7 (light gray), 8 (dark gray) and 15 (white) of a 'standard' 16 colors (a.k.a. EGA) palette.
<br/>
To do the same, your program should read one byte from the original image (2bpp) and write 2 bytes (4 nibbles). You can achieve this with a little LUT and few bit manipulations such as
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">outbyte[0]=LUT[inbyte&amp;0x03]|(LUT[(inbyte&gt;&gt;2)&amp;0x03]&lt;&lt;4);
<br/>
outbyte[1]=LUT[(inbyte&gt;&gt;4)&amp;0x03]|(LUT[(inbyte&gt;&gt;6)&amp;0x03]&lt;&lt;4);
<br/>
</td> </tr></table><span class="postbody">
<br/>
where LUT[] is {0,7,8,15} of course :)<br/>_________________<br/><a class="postlink" href="http://bit.ly/yiQrz9" target="_blank">libXM7</a>|<a class="postlink" href="http://bit.ly/yJwcOo" target="_blank">NDS programming tutorial (Italiano)</a>|<a class="postlink" href="http://disjointedstudio.blogspot.com/" target="_blank">Waimanu DS / GBA</a>|<a class="postlink" href="http://adshomebrewersdiary.blogspot.com" target="_blank">A DS Homebrewer's Diary</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177942 - rombus - Thu May 16, 2013 9:42 pm</h4>
    <div class="postbody"><span class="postbody">Thanks a lot sverx!
<br/>
<br/>
That is very useful. I'll need a couple of days to digest what you said as I'm kind of a noob in respect of treating with .bmp files.
<br/>
<br/>
When I have news I will post them here!
<br/>
<br/>
<br/>
cheers :D</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177948 - rombus - Sat May 18, 2013 4:36 pm</h4>
    <div class="postbody"><span class="postbody">Sverx! I got the colors working, from having a black square now I have a mess of black, white, light grey and dark grey pixels lol.
<br/>
<br/>
I quite didn't understand the code you share with me. And more importantly I don't think I understand what information I have to write to the file in the extra byte. Since I have to turn every byte of the binary into 2 bytes of the bmp, what do I have to put in that extra byte?
<br/>
<br/>
Edit: mm I think I'm already turning the 2bpp image into 4bpp image. But somehow I'm not getting the results I want. Heres the code updated: <a class="postlink" href="https://docs.google.com/file/d/0B1icVXjWL_BUUnRKSF9iV2xGOFk/edit?usp=sharing" target="_blank">https://docs.google.com/file/d/0B1icVXjWL_BUUnRKSF9iV2xGOFk/edit?usp=sharing</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177949 - sverx - Mon May 20, 2013 1:24 pm</h4>
    <div class="postbody"><span class="postbody">The matter is that you've got 4 pixels in each byte in the 'source' image, but you want to convert it into a 16 colors bitmap, so you can store only 2 pixels in a single byte. What you're doing in your code is storing one pixel only per byte, making the other pixel equal to 0 implicitly.
<br/>
<br/>
So, you can either make you program read one byte a time (remember it's 4 pixel) and make it write 2 bytes OR you can make it read 'half' byte and write 1 byte (2 pixels). But you can't write an half byte to the file...
<br/>
<br/>
The code I suggested you takes the input byte ('inbyte' = 4 pixels) and calculates the 2 output bytes outbyte[0] and outbyte[1] that you have to write in the file. It makes them using bit manipulations instead of using if-then-else constructs... it takes 2 bits from the original inbyte, uses them as indexes for LUT access and stores the result in the correct outbyte[] element. Check how bit manipulations works (I'm using 'AND' and 'LOGICAL RIGHT SHIFT' operators only, to extract the 2 bit values... and I'm using the 'OR' and 'LOGICAL LEFT SHIFT' operators to combine the 2 LUT values together)
<br/>
<br/>
I hope this helps you :)<br/>_________________<br/><a class="postlink" href="http://bit.ly/yiQrz9" target="_blank">libXM7</a>|<a class="postlink" href="http://bit.ly/yJwcOo" target="_blank">NDS programming tutorial (Italiano)</a>|<a class="postlink" href="http://disjointedstudio.blogspot.com/" target="_blank">Waimanu DS / GBA</a>|<a class="postlink" href="http://adshomebrewersdiary.blogspot.com" target="_blank">A DS Homebrewer's Diary</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177950 - rombus - Wed May 22, 2013 2:47 am</h4>
    <div class="postbody"><span class="postbody">do'hhhhhhhhhhhhhh
<br/>
<br/>
after reading endless times your responses I now understand what you mean about what I was doing. I was trying to write 1 nibble at a time, and that's why I have a 0 nibble implicit. I will keep trying with this new info you gave me.
<br/>
<br/>
Thanks a lot!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177951 - sverx - Wed May 22, 2013 12:18 pm</h4>
    <div class="postbody"><span class="postbody">I really suggest you to read some about bitwise operators. C is king in this and in console programming you'll easily use these operators a lot.
<br/>
I would start with <a href="http://en.wikipedia.org/wiki/Bitwise_operations_in_C" target="_blank">http://en.wikipedia.org/wiki/Bitwise_operations_in_C</a> to get an idea :)<br/>_________________<br/><a class="postlink" href="http://bit.ly/yiQrz9" target="_blank">libXM7</a>|<a class="postlink" href="http://bit.ly/yJwcOo" target="_blank">NDS programming tutorial (Italiano)</a>|<a class="postlink" href="http://disjointedstudio.blogspot.com/" target="_blank">Waimanu DS / GBA</a>|<a class="postlink" href="http://adshomebrewersdiary.blogspot.com" target="_blank">A DS Homebrewer's Diary</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177958 - rombus - Mon Jun 03, 2013 12:11 pm</h4>
    <div class="postbody"><span class="postbody">Hey sverx! I finally got the program working. Thanks a lot! I uploaded here: <a class="postlink" href="http://code.google.com/p/rgbcdumper/" target="_blank">http://code.google.com/p/rgbcdumper/</a> it may not be that efficient, but it works :-)
<br/>
<br/>
Totally understood what you explained to me in your 2? post and it's implemented in the code also.
<br/>
<br/>
Cheers!</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
