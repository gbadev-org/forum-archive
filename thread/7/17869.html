<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Getting started - manual compiling with the new devkitarm - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>C/C++ > Getting started - manual compiling with the new devkitarm</h2>
<div id="posts">
<div class="post">
    <h4>#177502 - Bregalad - Thu Jul 12, 2012 11:15 am</h4>
    <div class="postbody"><span class="postbody">I'm sorry if what I'm asking sounds trivial.
<br/>
<br/>
I'm trying to get started to GBAdev. Most tutorials for the GBA uses the old devkitgba instead of the new devkitarm.
<br/>
<br/>
Supposedly it's roughly equivalent but I have trouble following the tutorials, I'm trying to get started like they describe <a class="postlink" href="http://www.loirak.com/gameboy/gbatutor.php" target="_blank">here</a>.
<br/>
<br/>
Of course I replace "gcc" and "objcopy" by "arm-none-eabi-gcc" and "arm-none-eabi-objcopy" respectively.
<br/>
<br/>
I get no errors, but the resulting GBA rom refuses to run in an emulator.
<br/>
<br/>
This works fine using the devkitpro's template, BUT I don't understand how their incredibly complex makefile works, and I'd like to have the freedom to compile my files as I want (and not as THEY want).
<br/>
(At a later stage I'd like to have different optimisation settings for different .c files, and chose which files are compiled in ARM or THUMB mode).
<br/>
<br/>
Thanks in advance for any help.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177503 - elhobbs - Thu Jul 12, 2012 1:48 pm</h4>
    <div class="postbody"><span class="postbody">using the default makefiles you can choose between thumb and arm by naming the file as *.arm.c or *.thumb.c - cpp works too.
<br/>
<br/>
A lot of the tutorials are really out of date. did you look at the examples that are installed with devkitarm/libgba? If you are just starting then optimizing is probably not super important at this point. get something that will run and then see if it needs to be optimized.
<br/>
<br/>
I am not sure who you think "THEY" are? The build system may seem a little complex but it does let beginners get started relatively quickly, without having to figure out how to turn the compiler output into something the system can run. if you are determined to make something on your own then the gba_rules file included at the top of the template makefile (and the base_rules which it includes) contains most of the logic. nothing nefarious. both of these file are in the devkitpro/devkitarm folder.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177504 - Bregalad - Thu Jul 12, 2012 10:49 pm</h4>
    <div class="postbody"><span class="postbody">Thank you for your answer,
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">using the default makefiles you can choose between thumb and arm by naming the file as *.arm.c or *.thumb.c - cpp works too.</td> </tr></table><span class="postbody">
<br/>
This is good to know.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
A lot of the tutorials are really out of date. did you look at the examples that are installed with devkitarm/libgba? If you are just starting then optimizing is probably not super important at this point. get something that will run and then see if it needs to be optimized.</td> </tr></table><span class="postbody">
<br/>
You're probably right. In fact I'm not exactly just starting - I've been into GBA romhacking (I don't know if you've heard about FF5/6 Advance sound restoration) - I'm not new to the GBA hardware. What is new is that I'd like to try and compile my own things for the system.
<br/>
<br/>
Like I said I already got things working with their templates. However I really feel like I don't know what I'm doing when I'm using their makefiles, it's more like magic to me and I don't like this.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">The build system may seem a little complex but it does let beginners get started relatively quickly, without having to figure out how to turn the compiler output into something the system can run.</td> </tr></table><span class="postbody">
<br/>
In fact it's exactly what I'd like to figure out !
<br/>
After you boot the BIOS, how does the GBA know how to jump to your main() function ?
<br/>
<br/>
I already coded something for the NDS using devkitpro, and like I said the compilation really feels like magic, and not like something I made myself, which is a bit disturbing.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177505 - elhobbs - Fri Jul 13, 2012 12:18 am</h4>
    <div class="postbody"><span class="postbody">gba_rules references a spec file which in turn references a link script for memory layout/regions as will an asm file that defines the entry point and setups a minimal c run time. it calls the main function in the sources you provide. the link script is probably the most complicated part and there is no good reason to mess with it - unless it is broken.
<br/>
<br/>
the resulting elf file is run through objcopy and converted to binary. then a gbafix utility transforms the resulting bin to a runnable gba file.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177506 - Dwedit - Fri Jul 13, 2012 12:20 am</h4>
    <div class="postbody"><span class="postbody">The code inside crt0.s boots the game.
<br/>
It copies sections to the correct locations in memory, and then calls main.
<br/>
<br/>
Sections include ".text" (most code, runs from ROM), ".iwram", ".ewram", ".data" (initialized variables put at the end of iwram), ".bss" (zero-filled variables put at the end of iwram), and there's some others too.
<br/>
<br/>
The code is found at "C:\devkitPro\devkitARM\arm-none-eabi\lib\gba_crt0.s"
<br/>
<br/>
The linkscript (found at "C:\devkitPro\devkitARM\arm-none-eabi\lib\gba_cart.ld") defines what the sections are, and how it glues the binary file together.
<br/>
<br/>
Edit: one more thing:
<br/>
To call ASM code from C, you need to use this:
<br/>
	.global &lt;functionname&gt;
<br/>
	.type   &lt;functionname&gt; STT_FUNC
<br/>
Otherwise it won't generate the interworking code correctly.  This is for the newer versions of the GCC toolchain.  In older versions, you did not need to use .type xxxx STT_FUNC.  So older code may need this fix to build correctly.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
