<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Sprite troubles - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>C/C++ > Sprite troubles</h2>
<div id="posts">
<div class="post">
    <h4>#51254 - triton - Wed Aug 17, 2005 5:45 pm</h4>
    <div class="postbody"><span class="postbody">Been trying to display a sprite.  Here's my gba.h code.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
....
<br/>
typedef struct
<br/>
{
<br/>
    u16 att0, att1, att2, att3;
<br/>
}OAM;
<br/>
OAM oamc[128];
<br/>
typedef struct
<br/>
{
<br/>
    int x, y;
<br/>
    OAM* oam;
<br/>
}SPRITE;
<br/>
<br/>
void initspr()
<br/>
{
<br/>
    int i;
<br/>
    for (i=0; i&lt;128; i++)
<br/>
    {
<br/>
        oamc[i].att0=160;
<br/>
        oamc[i].att1=240;
<br/>
    }
<br/>
}
<br/>
void oamup()
<br/>
{
<br/>
    int i;
<br/>
    for(i=0; i&lt;128*sizeof(OAM)/4; i++)
<br/>
    ((u32*)charmem)[i]=((u32*)oamc)[i];
<br/>
}
<br/>
void DMA(int dma, u32* source, u32* dest,unsigned int count)
<br/>
{//      0,1,2,3                          # words/halfwords      2, 4
<br/>
{
<br/>
 (*(unsigned int*)(0x40000b0 + dma * 12))= (unsigned int)source;
<br/>
 (*(unsigned int*)(0x40000b4 + dma * 12)) = (unsigned int)dest;
<br/>
 (*(unsigned int*)(0x40000b8 + dma * 12)) = 0x84000000| count;
<br/>
}
<br/>
return;
<br/>
}
<br/>
void keys(SPRITE* ex)
<br/>
{
<br/>
   if(!(KEY &amp; 0x0010))//right
<br/>
        {
<br/>
            ex-&gt;x += 1;
<br/>
        }
<br/>
        if(!(KEY &amp; 0x0020))
<br/>
        {
<br/>
            ex-&gt;x -= 1;
<br/>
        }
<br/>
}
<br/>
....
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
And my main file:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
int main()
<br/>
{
<br/>
    DISP_CNT=0x1000;
<br/>
    initspr();
<br/>
    DMA(3, (u32*)spr_palette, (u32*)0x5000200, 128);
<br/>
    DMA(3, (u32*)spr, (u32*)0x6010000, 1024);
<br/>
    SPRITE sprite;
<br/>
    sprite.x = 120;
<br/>
    sprite.y = 80;
<br/>
    sprite.oam=&amp;oamc[0];
<br/>
    sprite.oam-&gt;att0=sprite.y|COLOR_256;
<br/>
    sprite.oam-&gt;att1=sprite.x|SIZE_64;
<br/>
    while(1)
<br/>
    {
<br/>
   keys(&amp;sprite);
<br/>
        vblank();
<br/>
   oamup();
<br/>
    }
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
But the sprite doesn't move can someone help?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#51258 - rodolforg - Wed Aug 17, 2005 6:51 pm</h4>
    <div class="postbody"><span class="postbody">You don't change OAM data, only SPRITE fields (x,y).
<br/>
You must copy these values to oamc[0] first, and only after update the real oam.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#51291 - triton - Thu Aug 18, 2005 12:33 am</h4>
    <div class="postbody"><span class="postbody">I kinda get what you're saying.  Could you give me some code?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#51295 - sajiimori - Thu Aug 18, 2005 12:50 am</h4>
    <div class="postbody"><span class="postbody">There are lots of tutorials with code.  Try copying one and making sure it works, then modifying it to do what you want.
<br/>
<br/>
Also, don't put functions definitions in header files (unless they're declared inline, but that's a more advanced topic).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#51310 - rodolforg - Thu Aug 18, 2005 5:04 am</h4>
    <div class="postbody"><span class="postbody">You update <span style="font-style: italic">OAM</span> copying <span style="font-weight: bold">oamc</span> vector by using  <span style="font-weight: bold">oamup()</span>, right? But you didn't change <span style="font-weight: bold">oamc</span> data: you don't assign the new <span style="font-style: italic">y</span> value to <span style="font-weight: bold">oamc[0].att0</span> neither <span style="font-style: italic">x</span> value to <span style="font-weight: bold">oamc[0].att1</span>... You must change these data before call the function <span style="font-weight: bold">oamup()</span>, just how you do here:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">sprite.oam-&gt;att0=sprite.y|COLOR_256; 
<br/>
sprite.oam-&gt;att1=sprite.x|SIZE_64;</td> </tr></table><span class="postbody">
<br/>
Check you're just changing the <span style="font-style: italic">x</span> value bits, though. You can do this through <span style="font-style: italic">and</span> and <span style="font-style: italic">or</span> operations.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">sprite.oam-&gt;att0 &amp;= 0x00FF;
<br/>
sprite.oam-&gt;att0 |= sprite.y;
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
