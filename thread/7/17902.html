<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>GBC coding - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>C/C++ > GBC coding</h2>
<div id="posts">
<div class="post">
    <h4>#177735 - mills26 - Sat Dec 29, 2012 8:35 pm</h4>
    <div class="postbody"><span class="postbody">Hi, i'm trying to make games for game boy color. I asked in gbdev forums but no luck. I'm using GBDK.
<br/>
<br/>
I made cool things, but i can't overcome a bug or something in gbdk.
<br/>
<br/>
When i compile roms with more than 2 banks (bigger tham 32 Kb) the compiler complains:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">ERROR: address overflow (addr c230 &gt;= 8000)
<br/>
lcc: C:\gbdk\bin/link-gbz80: No error</td> </tr></table><span class="postbody">
<br/>
<br/>
Some guy solved it by using asm for big variables instead of C arrays. 
<br/>
<br/>
I also tried this, but ended up with lots of lines with something like "mnemonic errors".
<br/>
<br/>
My question is, how do i include asm code inside the main c program?
<br/>
<br/>
In my game, i load a background map and some sprites made with gameboy tools that can export asm code as well as c.
<br/>
<br/>
<br/>
Thanks a lot</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177834 - WriteASM - Sun Mar 31, 2013 12:47 pm</h4>
    <div class="postbody"><span class="postbody">Have you looked at the source code for the GBDK "Banked" example?  (Including Make.bat)  I have also found at least one more GBDK example that uses multiple ROM banks.
<br/>
<br/>
Including ASM code inside a C project?  I did that back a few years, but unfortunately can't seem to find the source code.  Basically, you need to put the ASM code inside a ".s" file (use the Space.s GBDK example for ideas), and add the ".s" file to the "make.bat" list.  What I'm not sure about is how to actually call the routine.  
<br/>
I'll keep hunting for the source.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177841 - WriteASM - Wed Apr 03, 2013 12:54 pm</h4>
    <div class="postbody"><span class="postbody">Found the source code...on a different computer.  I made an ASM function called "LScroll" that scrolled a portion of the graphics screen left by one pixel, on an attempted audio recorder project.  Here goes:
<br/>
<br/>
In a C source file (in my case, "m-audio.c"):
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void LScroll(void);           //ASM function declaration
<br/>
<br/>
LScroll();      //Call the function</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
In the "S" file (in my case, "gfx.s"):
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">.include "../libc/gb/global.s"
<br/>
.globl _LScroll             ;  define the routine
<br/>
<br/>
;  VOID LScroll(VOID)
<br/>
_LScroll: push af
<br/>
...
<br/>
...
<br/>
done:    pop AF
<br/>
       ret</td> </tr></table><span class="postbody">
<br/>
<br/>
In the makefile ("make.bat"), one command does it all (the other C source files were "#included" in the main file):
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">..\bin\lcc -Wl-m -Wl -yp0x143=0xC0 -O audiorec.gbc audiorec.c gfx.s</td> </tr></table><span class="postbody">
<br/>
<br/>
The "yp" tag sets the GBC flag in the cartridge header.  
<br/>
<br/>
Hope this helps.  Perhaps I should check out GBDev also?<br/>_________________<br/>"Finally, brethren, whatever is true, whatever is honorable, whatever is right, whatever is pure, whatever is lovely, whatever is of good repute, if there is any excellence and if anything worthy of praise, dwell on these things." (Philippians 4:8)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
