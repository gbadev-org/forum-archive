<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Tile code problem - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>C/C++ > Tile code problem</h2>
<div id="posts">
<div class="post">
    <h4>#35406 - interdpth - Fri Feb 04, 2005 6:57 am</h4>
    <div class="postbody"><span class="postbody">Oh goodie new problems! Alrighty my new problem is my tiles get displayed 
<br/>
<br/>
like this 
<br/>
<br/>
|\\\\\\\\\\\\\\\
<br/>
|\\\\\\\\\\\\\\\\
<br/>
|\\\\\\\\\\\\\\\\\
<br/>
|\\\\\\\\\\\\\\\\\
<br/>
-------------------
<br/>
<br/>
Theyshould be like 
<br/>
 Straight down and across. Here's a pic if you don't understand what I mean 
<br/>
<br/>
<a href="http://www.overmyhead.net/mew3domain/kittyhacker/help.png">[Images not permitted - Click here to view it]</a>
<br/>
The tile code is declared as  const u16 Map1_Mapdata[32 * 32];
<br/>
<br/>
my Display code is
<br/>
<br/>
for (Y=0;Y&lt;32;Y++) 						
<br/>
		   for (X=0;X&lt;32;X++) {
<br/>
			    BG2[Y*32+X]=Map1_MapData[(Y +1)*32+X];
<br/>
		   }
<br/>
<br/>
Thank you for your help.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#35412 - AnthC - Fri Feb 04, 2005 10:13 am</h4>
    <div class="postbody"><span class="postbody">I'd be guessing but it looks like you have a common off by one bug - your map data array isn't a multiple of 32
<br/>
<br/>
Try (modified the Y*32 to Y*31 or try for  Y*32 to Y*33
<br/>
<br/>
for (X=0;X&lt;32;X++) { 
<br/>
BG2[Y*32+X]=Map1_MapData[(Y +1)*31+X]; 
<br/>
} 
<br/>
<br/>
or
<br/>
<br/>
for (X=0;X&lt;32;X++) { 
<br/>
BG2[Y*32+X]=Map1_MapData[(Y +1)*31+X]; 
<br/>
} 
<br/>
<br/>
If this appears to fix the squewing then I'd suggest re-processing your map and make sure is it 32 units wide.
<br/>
<br/>
IMO, a cleaner way to code the ugly y*32 + x would be to ensure your map is a AxB array and use a pointer to array for the BG
<br/>
<br/>
Which you could do like this :-
<br/>
<br/>
u16  (*p)[32]=(u16  (*)[32])BG; // bg map array of [][32]
<br/>
<br/>
Then use 
<br/>
<br/>
p[y][x]=Map1_MapData[y][x];
<br/>
<br/>
Anth</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#35423 - ImInABand - Fri Feb 04, 2005 2:37 pm</h4>
    <div class="postbody"><span class="postbody">try this:
<br/>
<br/>
take out the for() loops. try this, see if it works:
<br/>
<br/>
<br/>
memcpy( (u16 *)0x06000000, &amp;Map1_MapData, sizeof(Map1_MapData) );</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#35433 - Cearn - Fri Feb 04, 2005 4:24 pm</h4>
    <div class="postbody"><span class="postbody">AnthC is probably right, the map width isn't what you think it is. It seems more like a 34 or 18 wide map. But even then the map looks strange, with the green tiles everywhere I mean. Do you have a picture of what it should look like (as well as a picture of the tileset)? And why the (y+1) in the copy loop?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#35438 - interdpth - Fri Feb 04, 2005 6:02 pm</h4>
    <div class="postbody"><span class="postbody">Yeah here's the tileset pic
<br/>
<br/>
[img]http://www.overmyhead.net/mew3domain/kittyhacker/tile.bmp[/img]
<br/>
<br/>
Here's the map 
<br/>
[img]http://www.overmyhead.net/mew3domain/kittyhacker/map.bmp[/img]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#35441 - ScottLininger - Fri Feb 04, 2005 6:43 pm</h4>
    <div class="postbody"><span class="postbody">What conversion tool are you using? Some tools do *weird* changes to the data. Try converting a single, 8x8 tile and see how large the resulting array is. If it's not exactly 64 entries, then you might need to pass in some extra parameter or use a different tool.
<br/>
<br/>
-Scott</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#35443 - interdpth - Fri Feb 04, 2005 7:46 pm</h4>
    <div class="postbody"><span class="postbody">The tiles them selves get copied in to VRAM</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#35498 - Cearn - Sat Feb 05, 2005 4:36 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ScottLininger wrote:</b></span></td> </tr> <tr> <td class="quote">... Some tools do *weird* changes to the data. ...
<br/>
-Scott</td> </tr></table><span class="postbody">
<br/>
Heh, no shit. 
<br/>
<br/>
From that little blue square in the corner I have the feeling that you're using Warder1's GBA Map Edit Demo 4, am I correct? This has some <span style="font-style: italic">very</span> strange notions of exporting. The first one is that exporting is done in u8, as you already noticed. However, these bytes just denote 8bit tile indices, there's no palette of flipping information. This would be fine for rotational bgs, but not for text bgs. This is one case where you <span style="font-style: italic">shouldn't</span> use a cast to u16. The only way to use the data properly is by a loop which has a u16 destination and a u8 source.
<br/>
That's one problem, now for another. Apparently the exporter works differently when you have a 16x16 tilesize. In this case it doesn't print out 32x32 bytes, but <span style="font-weight: bold">17x17</span>. I have the exported map in front of me and the data makes absolutely no sense at all. It would however explain the screen you are getting, though.
<br/>
<br/>
I suppose I could point you to <a class="postlink" href="http://user.chem.tue.nl/jakvijn/downloads.htm#mirach" target="_blank">my own crappy map editor</a> which operates in a similar fashion to GBAMapEdit b4, and gets the exporting right (I think. I believe I tested it for a wide number of uses, but it has been a while), but in the end you'll probably be much better off with Nessie's far more advanced <a class="postlink" href="http://nessie.gbadev.org" target="_blank">MapEd</a>.</span><span class="gensmall"><br/><br/>Last edited by Cearn on Fri Aug 19, 2005 2:12 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#35522 - interdpth - Sun Feb 06, 2005 2:12 am</h4>
    <div class="postbody"><span class="postbody">I like your map editor the Best Cearn. But I have a question for you I would like to ask over MSN or AIM i'm <a href="mailto:kittyhacker@hotmail.com">kittyhacker@hotmail.com</a> on MSN and neko mattchan on AIM not sure if this info is not to be posted on here. So sorry Mods and Admins if it is.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
