<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Timers - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>C/C++ > Timers</h2>
<div id="posts">
<div class="post">
    <h4>#105673 - NighTiger - Tue Oct 10, 2006 9:03 pm</h4>
    <div class="postbody"><span class="postbody">Hi guys,
<br/>
I tried to understand when 256 ms are incremented in the timers.
<br/>
<br/>
I had enabled the following timers:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
  enableTimer2(_FREQUENCY_256_ | _TIMER_ENABLE_); 
<br/>
  enableTimer3(_TIMER_CASCADE_ | _TIMER_ENABLE_);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
How can I obtain the 256 ms?
<br/>
tnx</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#105728 - gmiller - Wed Oct 11, 2006 3:12 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>NighTiger wrote:</b></span></td> </tr> <tr> <td class="quote">Hi guys,
<br/>
I tried to understand when 256 ms are incremented in the timers.
<br/>
<br/>
I had enabled the following timers:
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
  enableTimer2(_FREQUENCY_256_ | _TIMER_ENABLE_); 
<br/>
  enableTimer3(_TIMER_CASCADE_ | _TIMER_ENABLE_);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
How can I obtain the 256 ms?
<br/>
tnx</span></td> </tr></table><span class="postbody">
<br/>
<br/>
The 256 timer "counts" every 256 clock ticks (the clock running at 16.7 Mhz) so expecting 256 ms is not going to deliver what you expect.  
<br/>
<br/>
If you are looking for how to get the 32 bit value you are generating between the two data registers then the lower 16 bits would be Timer2's data register and the upper 16 bits would be timer3's data register.  When you get these values remember that when you get the data timer2 is always running so it is possible that Timer2 could overflow after you read it then increment Timer3.  I generally do not use multiple timers to get more bits.  I use an interrupt and then increment a 32 bit timer by 65536 (adding bt skipping the low order 16 bits) and the the combination is just a  "OR" of my 32 bit value with the 16 bit data register.  This can be done many ways and I might be a little parnoid about the combination taking too much time.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#105886 - hickscorp - Thu Oct 12, 2006 10:45 pm</h4>
    <div class="postbody"><span class="postbody">I dunno if it can help, but looking at your problem with math logic will probably give you some idea:
<br/>
From what you say, it seems that you want a timer to tick each 256ms. It approximately means that the timer would tick 4 times a second (One second is 1000ms, so 1000 / 256 = 3.9, let's say 4).
<br/>
The problem is: your code seems to ask for 256 ticks a second, not a tick each 256ms. Don't get confused, HTz are ticks per seconds, milliseconds are 1/1000 seconds :)
<br/>
<br/>
But i don't have a solution for your thing, maybe looking at the TIMER_DIV_x consts?
<br/>
<br/>
Bye!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#105974 - NighTiger - Fri Oct 13, 2006 7:50 pm</h4>
    <div class="postbody"><span class="postbody">Tnx guys I have resolved.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106047 - NighTiger - Sat Oct 14, 2006 6:01 pm</h4>
    <div class="postbody"><span class="postbody">I have a problem.
<br/>
I show you:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
    if (_TM2D_ &gt; (16780000/1024) &amp;&amp; mbh &gt; 0)
<br/>
    {
<br/>
      _MOSAIC_ = _SET_BGMOSAIC(mbh, mbv, 0, 0);
<br/>
      mbh--, mbv--;
<br/>
     _TM2D_ = 0;
<br/>
    }
<br/>
  }
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I think that this code is correct.
<br/>
But it seems that the demo alway enters in the if statement.
<br/>
Does anybody know why? :-o</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
