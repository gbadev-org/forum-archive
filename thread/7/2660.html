<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Structs in structs - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>C/C++ > Structs in structs</h2>
<div id="posts">
<div class="post">
    <h4>#14864 - DekuTree64 - Tue Jan 13, 2004 9:02 pm</h4>
    <div class="postbody"><span class="postbody">There's probably a simple solution to this, but is there any way to declare a pointer to a struct in itself in C? Like 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">typedef struct tFoo
<br/>
{
<br/>
   tFoo *bar;
<br/>
} Foo, *pFoo;</td> </tr></table><span class="postbody">
<br/>
That works fine in MSVC++ for windows, but not with GCC. Is it a C++-only feature, or just a compiler difference letting me get away with something non-standard? I've tried using Foo * and pFoo, but as logic would suggest, only using the original type definition works even in MSVC++, because the others haven't been declared yet.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14865 - Miked0801 - Tue Jan 13, 2004 9:42 pm</h4>
    <div class="postbody"><span class="postbody">Forward declare the struct if you're getting into trouble.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
struct tFoo;
<br/>
<br/>
typedef struct tFoo
<br/>
{
<br/>
    tFoo *bar;
<br/>
} Foo, *pFoo;
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14867 - DekuTree64 - Tue Jan 13, 2004 9:50 pm</h4>
    <div class="postbody"><span class="postbody">Nope, still says there's a syntax error before tFoo *bar;. Has anyone actually gotten it to work in DevKitAdv? I'm sure it's possible, but I can't very well do it if it keeps giving me errors. I can make it work just fine using a void* and just cast it when actually doing things, it's just a hassle to do.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14868 - Miked0801 - Tue Jan 13, 2004 10:37 pm</h4>
    <div class="postbody"><span class="postbody">Oh.  I see what's wrong.  You can't use the typedef declaration before it's defined.
<br/>
<br/>
Do this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
typedef struct tFoo 
<br/>
{ 
<br/>
    struct tFoo *bar; 
<br/>
} Foo, *pFoo; 
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
And yes, I've gotten it to work just fine (used for linked lists and such)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14869 - poslundc - Tue Jan 13, 2004 10:40 pm</h4>
    <div class="postbody"><span class="postbody">You don't have to use separate names for the struct and the typedef if you don't want to. (Most people rarely do, since once you typedef a struct there is no practical reason to use the struct keyword with it anymore.)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">typedef struct Foo
<br/>
{
<br/>
   struct Foo      *f;
<br/>
}
<br/>
Foo;</td> </tr></table><span class="postbody">
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14909 - MumblyJoe - Wed Jan 14, 2004 6:55 pm</h4>
    <div class="postbody"><span class="postbody">Just from a C++ perspective, there is no reason this wont work:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
class A
<br/>
{
<br/>
    A *a;
<br/>
};
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
so if you are using C++, forget all that typedef shit, if you are using C, well too bad... :P<br/>_________________<br/><a class="postlink" href="http://www.hungrydeveloper.com" target="_blank">www.hungrydeveloper.com</a>
<br/>
Version 2.0 now up - guaranteed at least 100% more pleasing!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14910 - DekuTree64 - Wed Jan 14, 2004 7:06 pm</h4>
    <div class="postbody"><span class="postbody">I love C, much less to worry about than C++. And besides, Dan's way worked (thanks!), so I'm happily on my way to an object-oriented battle system. Admittedly, C++ may be a better choice in this case, but I may be rewriting some of the code in ASM in the future, and C translates quite nicely.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14915 - Maddox - Wed Jan 14, 2004 7:56 pm</h4>
    <div class="postbody"><span class="postbody">MumblyChoad,
<br/>
  C++ on the GBA sucks ass.  So quit giving crap advice to poor slobs when they ask about structs in structs.  
<br/>
<br/>
And anyway, a class member variable of type pointer-to-class is just bad form in C++.<br/>_________________<br/>You probably suck.  I hope you're is not a game programmer.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14917 - jma - Wed Jan 14, 2004 8:12 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Maddox wrote:</b></span></td> </tr> <tr> <td class="quote">And anyway, a class member variable of type pointer-to-class is just bad form in C++.</td> </tr></table><span class="postbody">
<br/>
<br/>
Where do you get this idea from? How do you think linked lists, queues and stacks are made?
<br/>
<br/>
Jeff<br/>_________________<br/><a href="mailto:massung@gmail.com">massung@gmail.com</a>
<br/>
<a href="http://www.retrobyte.org" target="_blank">http://www.retrobyte.org</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14919 - torne - Wed Jan 14, 2004 8:19 pm</h4>
    <div class="postbody"><span class="postbody">Also, C++ on the GBA works perfectly.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14925 - bomberman - Wed Jan 14, 2004 8:33 pm</h4>
    <div class="postbody"><span class="postbody">maybe he just has problems with C++ in general and not only on GBA...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14948 - MumblyJoe - Thu Jan 15, 2004 2:54 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Maddox wrote:</b></span></td> </tr> <tr> <td class="quote">MumblyChoad,
<br/>
  C++ on the GBA sucks ass.  So quit giving crap advice to poor slobs when they ask about structs in structs.  
<br/>
<br/>
And anyway, a class member variable of type pointer-to-class is just bad form in C++.</td> </tr></table><span class="postbody">
<br/>
<br/>
Sounds like someone has some daddy issues.
<br/>
<br/>
C++ on the GBA is just fine, and anyone who truly understands what the compiler does to C++ code knows how to avoid any pitfalls that may arise. Also a pointer to the same class in C++ <span style="font-style: italic">is</span> bad form if it is public, and much less bad form than C if you use accessor functions. Note that <span style="font-style: italic">nothing</span> was public in the example I gave, because it was an example.
<br/>
<br/>
Back to the actual topic though and forgetting about flaming jerks, I think why your original code may have worked in MSVC++ is because you may have been using the default .cpp filename, which will still compile any C code, but may complain more about casting etc (which is good, Bruce Eckel recommends doing this anyway) and will allow you to use the keyword <span style="font-style: italic">stuct</span> like the keyword <span style="font-style: italic">class</span>.<br/>_________________<br/><a class="postlink" href="http://www.hungrydeveloper.com" target="_blank">www.hungrydeveloper.com</a>
<br/>
Version 2.0 now up - guaranteed at least 100% more pleasing!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14978 - tepples - Thu Jan 15, 2004 5:02 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>MumblyJoe wrote:</b></span></td> </tr> <tr> <td class="quote">you may have been using the default .cpp filename, which will still compile any C code, but may complain more about casting etc (which is good, Bruce Eckel recommends doing this anyway)</td> </tr></table><span class="postbody">
<br/>
Not necessarily. Though C99 has absorbed quite a few of C++'s improvements to C, I can think of several things that I'd find useful in C99 that C++ lacks.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14980 - torne - Thu Jan 15, 2004 5:15 pm</h4>
    <div class="postbody"><span class="postbody">Though most sensible compilers use the extensions in C++ and C99 at the same time (except where they conflict).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14990 - animension - Thu Jan 15, 2004 7:53 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
maybe he just has problems with C++ in general and not only on GBA...
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
MumblyChoad,
<br/>
C++ on the GBA sucks ass. So quit giving crap advice to poor slobs when they ask about structs in structs.
<br/>
<br/>
And anyway, a class member variable of type pointer-to-class is just bad form in C++.
<br/>
</td> </tr></table><span class="postbody">
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
<br/>
I think he has a problem with everything, many teenagers do. He obviously doesn't know what he's talking about, or he'd know that any dynamic data structure like lists, queues, stacks, heaps, maps, etc, couldn't exist if what he said is true.<br/>_________________<br/>"Beer is proof that God loves us and wants us to be happy."
<br/>
-- Benjamin Franklin</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15002 - tepples - Thu Jan 15, 2004 11:22 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>animension wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">And anyway, a class member variable of type pointer-to-class is just bad form in C++.</td> </tr></table><span class="postbody">
<br/>
I think he has a problem with everything, many teenagers do. He obviously doesn't know what he's talking about, or he'd know that any dynamic data structure like lists, queues, stacks, heaps, maps, etc, couldn't exist if what he said is true.</span></td> </tr></table><span class="postbody">
<br/>
I read it and inferred that he found it better to use STL than to implement one's own data structures.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15020 - MumblyJoe - Fri Jan 16, 2004 4:21 am</h4>
    <div class="postbody"><span class="postbody">Good point tepples. Know of any good sites/books you can recomend for learning C99, I sort of ignored it because it's still not how I like to do things...<br/>_________________<br/><a class="postlink" href="http://www.hungrydeveloper.com" target="_blank">www.hungrydeveloper.com</a>
<br/>
Version 2.0 now up - guaranteed at least 100% more pleasing!</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
