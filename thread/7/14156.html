<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>strings and directory listings? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>C/C++ > strings and directory listings?</h2>
<div id="posts">
<div class="post">
    <h4>#140453 - spinal_cord - Sun Sep 16, 2007 4:28 pm</h4>
    <div class="postbody"><span class="postbody">This is bugging me a bit, I'm trying to navigate a directory list but I'm getting nowhere.
<br/>
I have the filename in a string icon[file_to_load].filename[255] and im using a second variable to say if it is a folder or not.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
         if(icon[file_to_load].is_folder)
<br/>
         {
<br/>
            sprintf(folder,"/%s",folder,icon[file_to_load].filename);
<br/>
            get_file_list();
<br/>
         }
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
get_file_list(); creates a list of files and folders in the 'folder' directory.
<br/>
I assube i'm doing this wrong as it doesnt work properly.
<br/>
If I was doing this in BASIC, i would
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
if icon[file_to_load].is_folder then
<br/>
  if icon[file_to_load].filename &lt;&gt;".." then
<br/>
    folder$=left$(folder$,len(folder$)-len(icon[file_to_load].filename)
<br/>
    get_file_list()
<br/>
  else
<br/>
    folder$=folder$+"/"+icon[file_to_load].filename
<br/>
    get_file_list()
<br/>
  end if
<br/>
end if
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
But im lost in C, please help!<br/>_________________<br/>I'm not a boring person, it's just that boring things keep happening to me.
<br/>
<a class="postlink" href="http://spinal.dizidesigns.co.uk/" target="_blank">Homepage</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#140458 - tepples - Sun Sep 16, 2007 5:29 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>spinal_cord wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">sprintf(folder,"/%s",folder,icon[file_to_load].filename);</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
I see two problems with this statement: <ul><li>You have specified only one formatting argument in the format string "/%s", but you have specified a different number of arguments (two) in the list of values to be formatted. </li><li>I don't think it's wise to use the same variable 'folder' as both the output and an input. Unlike string operations in BASIC, Java, and Python, which create new string objects that are garbage collected, C's sprintf() modifies the output in place, and modifying things in place tends to cause problems if the function that you are calling does not expect you to use the same variable for input and output. </li></ul>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
if icon[file_to_load].is_folder then
<br/>
  if icon[file_to_load].filename &lt;&gt;".." then
<br/>
    folder$=left$(folder$,len(folder$)-len(icon[file_to_load].filename)
<br/>
    get_file_list()
<br/>
  else
<br/>
    folder$=folder$+"/"+icon[file_to_load].filename
<br/>
    get_file_list()
<br/>
  end if
<br/>
end if
<br/>
</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
Can you describe in English what this code in BASIC is supposed to do? What does folder$ represent at the start of this code, and what does it represent at the end?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#140482 - spinal_cord - Sun Sep 16, 2007 8:43 pm</h4>
    <div class="postbody"><span class="postbody">OK, in english, I have a list of filenames and weather they are folder or not. If they are folder, I want to check if it is ".." so I can then remove the current folder from the path, or if it is a folder name, then append it to the folder string.
<br/>
<br/>
eg.
<br/>
_pseudo code_
<br/>
folder="/games/lemmings"
<br/>
if user selects ".." folder="/games"
<br/>
else if user selects "data" folder="/games/lemmings/data"
<br/>
<br/>
as I said, I would like to append or remove a directory name to/from the string.<br/>_________________<br/>I'm not a boring person, it's just that boring things keep happening to me.
<br/>
<a class="postlink" href="http://spinal.dizidesigns.co.uk/" target="_blank">Homepage</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#140514 - tepples - Sun Sep 16, 2007 11:22 pm</h4>
    <div class="postbody"><span class="postbody">See <a class="postlink" href="http://www.cplusplus.com/reference/clibrary/cstring/strrchr.html" target="_blank">strrchr</a>.
<br/>
<br/>
The following code in the C language is untested, optimized for understandability (not for runtime efficiency), and subject to a potential buffer overflow if paths get really long:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include &lt;string.h&gt;
<br/>
<br/>
/**
<br/>
 * Modifies a path in place to add a name at the end.
<br/>
 * If the name is "..", modifies the path to remove the last item.
<br/>
 * @param path a list of items separated by '/' (slash) characters
<br/>
 * @param filename the name to be added to path
<br/>
 */
<br/>
void addFolderToPath(char *restrict path, const char *restrict filename) {
<br/>
  /* "restrict" is a new keyword added to the 1999 version of
<br/>
     the C language.  Roughly, pointers passed to a function in
<br/>
     restricted arguments must not point to overlapping memory. */
<br/>
<br/>
  /* If two strings are compared and the result is 0,
<br/>
     the strings are equal. */
<br/>
  if (strcmp(filename, "..") == 0) {
<br/>
<br/>
    /* When one tries to add the name ".." to a path, remove
<br/>
       the last name in the path instead of adding "..". */
<br/>
<br/>
    /* Search for the last slash character in a string. */
<br/>
    char *lastSlash = strrchr(path, '/');
<br/>
<br/>
    /* If a slash was found, chop off the end by
<br/>
       replacing the slash with a NUL byte (0). */
<br/>
    if (lastSlash) {
<br/>
      *lastSlash = 0;
<br/>
    }
<br/>
  } else {
<br/>
    /* When adding any name other than "..",
<br/>
       add a slash followed by the name. */
<br/>
    strcat(path, "/");
<br/>
    strcat(path, filename);
<br/>
  }
<br/>
}
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
