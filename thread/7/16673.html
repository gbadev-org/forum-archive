<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>malloc question - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>C/C++ > malloc question</h2>
<div id="posts">
<div class="post">
    <h4>#168760 - moonlightcheese - Wed May 20, 2009 9:01 pm</h4>
    <div class="postbody"><span class="postbody">if i declare a pointer to an object in a function and use malloc to allocate space for the size of the object... does the object die at the end of the function?
<br/>
<br/>
ex.</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
typedef struct {
<br/>
     int* foo;
<br/>
} bar;
<br/>
<br/>
void myFunc(bar* myBar) {
<br/>
     int* myInt=malloc(sizeof(int));
<br/>
     *myInt=4;
<br/>
     myBar-&gt;foo=myInt;
<br/>
}
<br/>
<br/>
int main() {
<br/>
     bar* theBar=malloc(sizeof(bar));
<br/>
     myFunc(theBar);   //would theBar contain a pointer to an integer 4?
<br/>
     return 0;
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
i think malloc'd memory isn't free'd at the end of a function, but i'm asking to make sure i'm not mucking things up.  if i'm reading this right, it looks like memory that is claimed with malloc is reserved until explicitly free'd... right?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168761 - Dwedit - Wed May 20, 2009 9:06 pm</h4>
    <div class="postbody"><span class="postbody">Yep, it doesn't die until you kill it.
<br/>
<br/>
Welcome to the world of Memory Leaks, whenever you forget to free something you've allocated.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168762 - moonlightcheese - Wed May 20, 2009 9:10 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dwedit wrote:</b></span></td> </tr> <tr> <td class="quote">Yep, it doesn't die until you kill it.
<br/>
<br/>
Welcome to the world of Memory Leaks, whenever you forget to free something you've allocated.</td> </tr></table><span class="postbody">
<br/>
cool thanks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#169087 - elyk1212 - Sun Jun 14, 2009 5:58 pm</h4>
    <div class="postbody"><span class="postbody">The easiest way to remember this is just to think of memory existing in two different spaces:  Heap and stack space. 
<br/>
<br/>
Stack space are local variables that are auto created when entering a block
<br/>
e.g
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
{
<br/>
   int temp;
<br/>
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
At the end of the block, temp's memory space will be reclaimed and popped off the <span style="font-weight: bold">Stack</span>.
<br/>
<br/>
<br/>
However,
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
{
<br/>
   Object* temp = new Object();
<br/>
   int* temp2 = (int*)malloc(sizeof(int));
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
........In both of these cases, memory is allocated in Heap space (a dynamic, at times fragmented, memory space).   Anytime you allocate space in this way you will have to worry about reclaiming them..
<br/>
<br/>
<br/>
Have you ever looked into Boost shared pointers?   These are counted and tracked pieces of memory, that can auto delete/free the entire object, type etc, that the pointer/array/etc is pointed to when no more references to the said memory exist.
<br/>
<br/>
They work pretty well, and are worth a look.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175748 - erana_ - Thu Jan 27, 2011 9:03 pm</h4>
    <div class="postbody"><span class="postbody">If you pass : &amp;theBar to your function you get stack speed. Not just heap flipping mallocs which mess up your fine memory.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
