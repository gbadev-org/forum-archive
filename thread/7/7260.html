<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Array pointer - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>C/C++ > Array pointer</h2>
<div id="posts">
<div class="post">
    <h4>#58331 - wiz - Sat Oct 22, 2005 6:54 pm</h4>
    <div class="postbody"><span class="postbody">Hello!
<br/>
<br/>
I have an array which I am just playing around with to revise on pointers a bit more.  I am currently going through the array a char at a time.  This is how my array is set up:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define LINESPERPAGE 4
<br/>
<br/>
const char *BOOK1[][LINESPERPAGE] =
<br/>
{
<br/>
   {
<br/>
      "PARA 0 LINE 0",
<br/>
      "PARA 0 LINE 1",
<br/>
      "PARA 0 LINE 2",
<br/>
      "PARA 0 LINE 3",
<br/>
   },
<br/>
<br/>
   {
<br/>
      "PARA 1 LINE 0",
<br/>
      "PARA 1 LINE 1",
<br/>
      "PARA 1 LINE 2",
<br/>
      "PARA 1 LINE 3",
<br/>
   },
<br/>
};
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I know I can read through this array like so, fixing myself to the array directly:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
for (int EC = 0; EC &lt; 14; EC++)
<br/>
{
<br/>
  // view each letter of PARA 0 LINE 0
<br/>
  char Letter = BOOK1[0][0][EC];
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
But instead of the previous I would like to point to the array, so I could add more "BOOK" arrays and access any one, I thought something like this would work - but it doesnt.  I found myself guessing with the pointers which I dont like to do
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
for (int EC = 0; EC &lt; 14; EC++)
<br/>
{
<br/>
  Get a pointer to a BOOK array
<br/>
  const char *pBOOK = &amp;BOOK1;
<br/>
<br/>
  // view each letter of PARA 0 LINE 0
<br/>
  char Letter = pBOOK[0][0][EC];
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
How should I be approaching this correctly?  For now Im not looking for complete alternatives, just want to get my head around pointers thats all.
<br/>
<br/>
Thank you for any help!!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#58342 - sajiimori - Sat Oct 22, 2005 8:34 pm</h4>
    <div class="postbody"><span class="postbody">First off, typing the name of an array returns the address of its first element.  If you type BOOK1, that returns &amp;BOOK1[0].  &amp;BOOK1 is also equivalent.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
char c = BOOK1[0][0][0];  // A single letter
<br/>
char* cp = BOOK1[0][0];  // A line
<br/>
char** cpp = BOOK1[0];  // A page
<br/>
char*** cppp = BOOK1;  // The whole book
<br/>
</td> </tr></table><span class="postbody">
<br/>
BTW, the contents of your strings suggest that the book is divided into paragraphs, but the LINESPERPAGE constant suggests that it's divided into pages.  Just a semantic issue.  :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#58348 - Cearn - Sat Oct 22, 2005 9:14 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wiz wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define LINESPERPAGE 4
<br/>
<br/>
const char *BOOK1[][LINESPERPAGE] =
<br/>
{
<br/>
   {
<br/>
      "PARA 0 LINE 0",
<br/>
      "PARA 0 LINE 1",
<br/>
      "PARA 0 LINE 2",
<br/>
      "PARA 0 LINE 3",
<br/>
   },
<br/>
<br/>
   {
<br/>
      "PARA 1 LINE 0",
<br/>
      "PARA 1 LINE 1",
<br/>
      "PARA 1 LINE 2",
<br/>
      "PARA 1 LINE 3",
<br/>
   },
<br/>
};
<br/>
</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
MSVC's debugger (you're not just testing this in a GBA environment are you?) gives me these memory locations:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">:D748 book
<br/>
:D748 book
<br/>
  :D748 book[0]
<br/>
    :908C "PARA 0 LINE 0"
<br/>
    :9078 "PARA 0 LINE 1", 
<br/>
    :90D0 "PARA 0 LINE 2", 
<br/>
    :807C "PARA 0 LINE 3", 
<br/>
  :D758 book[1]
<br/>
    :90BC "PARA 1 LINE 0"
<br/>
   ... etc
<br/>
</td> </tr></table><span class="postbody">
<br/>
So apparently, this means that BOOK1 is an array of quartets of pointers to strings (IOW, it's a matrix of char-pointers). Kinda surprised me too. If I hadn't tested it I would have sworn that the last index in the array would have been for the number of characters in each string. Oh well, live and learn. Note that if you have more than 4 lines/paragraph compilation will fail, and if you have less, you'll have an open space in the matrix.
<br/>
<br/>
Because of pointer and arrays are closely linked, you can use BOOK1 as a triple array because the first two indices give a char-pointer, and the last one gives the offset from that pointer. But once you start casting, there's no telling where you end up. 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wiz wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">for (int EC = 0; EC &lt; 14; EC++) 
<br/>
{ 
<br/>
  Get a pointer to a BOOK array 
<br/>
  const char *pBOOK = &amp;BOOK1; 
<br/>
<br/>
  // view each letter of PARA 0 LINE 0 
<br/>
  char Letter = pBOOK[0][0][EC]; 
<br/>
} </td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
The first problem here is that BOOK1 is 3D-ish, while pBook is 1D. That's never gonna work unless you add extra casting code. The second if pBook is 1D, it expects all the characters to be consecutive, which is definitely not the case. 3D pointers wouldn't work you don't have 3 levels of pointers, you have a matrix (1st level) of char-pointers (2nd level). <span style="font-weight: bold">if</span> you are certain that the paragraphs have a fixed number of lines, 2D pointers (1 for the matrix and 1 for the strings) will work:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
const char **ppc= *book1;
<br/>
<br/>
int ip, il, ic;
<br/>
<br/>
// get #para's from somewhere else
<br/>
for(ip=0; ip&lt;2; ip++)  // para loop
<br/>
{
<br/>
    for(il=0; il&lt;LPP; il++)  // line loop
<br/>
    {
<br/>
        for(ic=0; ppc[LPP*ip+il][ic]; ic++) // char loop
<br/>
            cerr &lt;&lt; ppc[LPP*ip+il][ic];
<br/>
        cerr &lt;&lt; endl;
<br/>
    }
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#58420 - sgeos - Sun Oct 23, 2005 2:15 pm</h4>
    <div class="postbody"><span class="postbody">What are you trying to do?  Whatever it is, there must be a less confusing way to do it.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#58694 - wiz - Tue Oct 25, 2005 1:20 pm</h4>
    <div class="postbody"><span class="postbody">Thanks a lot guys, Cearn, thats a very detailed run down - very appreciate your time!  sorry for taking so long to get back to you I need to re-read your post and understand it correctly :)
<br/>
<br/>
sgeos, cheers and you are right I shouldnt have named them as paragraphs.. If I want to confuse myself I need to do it properly ;)
<br/>
<br/>
To answer your question on what Im trying to do let me explain. 
<br/>
<br/>
I plan on making a demo which at the start of every scene has a screen of text, (maximum of say 5 lines or so)  The letters are displayed as sprites.  I want to be able to have any amount of chars per line.  
<br/>
<br/>
so in my head it looks like this:
<br/>
<br/>
BOOK1
<br/>
|
<br/>
PAGE1
<br/>
|
<br/>
LINE1
<br/>
LINE2
<br/>
...
<br/>
|
<br/>
PAGE2
<br/>
|
<br/>
LINE1
<br/>
LINE2
<br/>
...
<br/>
<br/>
BOOK2
<br/>
etc.
<br/>
<br/>
<br/>
This is how I created the array for a single book, because using a pointer I seem to be allowed to have any number of letters per line, and any number of pages.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">const char *BOOK1[][LINESPERPAGE]</td> </tr></table><span class="postbody">
<br/>
<br/>
my displaying routine could loop through each line of a page by doing this:
<br/>
<br/>
for each line (say 0 to 5)
<br/>
while current letter is not '\0' (to end of the line)
<br/>
current letter = BOOK1[pagenumber][each line][letter pos++]
<br/>
display the 'current letter'
<br/>
<br/>
which I have working, but as I said I could not make BOOK1 a variable as I needed to point to any book and page I want to display
<br/>
<br/>
I think Cearn has nailed it, so I will give that a go but any comments on my methods would be nice too :)
<br/>
<br/>
P.S. I am testing this is Borland C++ Builder.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#58762 - strager - Tue Oct 25, 2005 9:37 pm</h4>
    <div class="postbody"><span class="postbody">I may be totally off... But, I would say... Try using typedefs for each 'type.'  For example:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">typedef char *line;
<br/>
typedef line *page;
<br/>
typedef page *book;</td> </tr></table><span class="postbody">
<br/>
<br/>
And for your array you would do:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define MAX_BOOKS 256
<br/>
book *myBooks[MAX_BOOKS];
<br/>
int usedBooks = 0;
<br/>
<br/>
book myBook = 
<br/>
{
<br/>
  "This is line 1 of page 1 of book 1",
<br/>
  "Line 2",
<br/>
  "Line three"
<br/>
},
<br/>
{
<br/>
  "This is page 2",
<br/>
  "Page 2 line 2",
<br/>
  // ...
<br/>
},
<br/>
// ...</td> </tr></table><span class="postbody">
<br/>
<br/>
To add a book to myBooks:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int addBook(const book *addbook)
<br/>
{
<br/>
    /* Add the book to the list */
<br/>
    myBooks[usedBooks] = (book *)addbook;
<br/>
<br/>
    /* Increment the book counter */
<br/>
    usedBooks++;
<br/>
};</td> </tr></table><span class="postbody">
<br/>
<br/>
Since you are using C++, you could make a book set class and have the oppropriate functions and such, which might be a little easier to manage.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#58771 - sajiimori - Tue Oct 25, 2005 10:27 pm</h4>
    <div class="postbody"><span class="postbody">Does that even compile, strager?  When you say <span style="font-weight: bold">book myBook = {...}</span>, you're trying to create an anonymous array and store a pointer to its first element in <span style="font-weight: bold">myBook</span>, which is a pointer type.  Sadly, neither C nor C++ support array literals.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#58780 - strager - Tue Oct 25, 2005 11:27 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">Does that even compile, strager?  When you say <span style="font-weight: bold">book myBook = {...}</span>, you're trying to create an anonymous array and store a pointer to its first element in <span style="font-weight: bold">myBook</span>, which is a pointer type.  Sadly, neither C nor C++ support array literals.</td> </tr></table><span class="postbody">
<br/>
<br/>
Oh, didn't realize that.  Well, one way you could do it is by typecasting, so your initial declaration would look like what is in the origional post, and this could be added:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">// Use either one, but I think the second is more safe
<br/>
#define myBook ((book *)(arrayBook))
<br/>
// -- or --
<br/>
book *myBook = (book *)(arrayBook);
<br/>
<br/>
// -- or even... --
<br/>
#define getBook(b) ((book *)(b))</td> </tr></table><span class="postbody">
<br/>
<br/>
I also noticed (in my last post) I didn't surround the data from myBook with brackets (only the pages)... Typo :-X .</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#58787 - sajiimori - Wed Oct 26, 2005 1:08 am</h4>
    <div class="postbody"><span class="postbody">The compiler is giving a type error for a reason.  Casting gets rid of the error, but it doesn't solve the problem.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#58841 - legalize - Wed Oct 26, 2005 5:59 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">First off, typing the name of an array returns the address of its first element.  If you type BOOK1, that returns &amp;BOOK1[0].  &amp;BOOK1 is also equivalent.</td> </tr></table><span class="postbody">
<br/>
<br/>
&amp;BOOK1[0] is a pointer to the first element in the array BOOK1.
<br/>
<br/>
&amp;BOOK1 is a pointer to the array BOOK1.
<br/>
<br/>
These are entirely different things.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>strager wrote:</b></span></td> </tr> <tr> <td class="quote">I may be totally off... But, I would say... Try using typedefs for each 'type.'  For example:
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">typedef char *line;
<br/>
typedef line *page;
<br/>
typedef page *book;</td> </tr></table><span class="postbody">
<br/>
<br/>
And for your array you would do:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define MAX_BOOKS 256
<br/>
book *myBooks[MAX_BOOKS];
<br/>
int usedBooks = 0;
<br/>
<br/>
book myBook = 
<br/>
{
<br/>
  "This is line 1 of page 1 of book 1",
<br/>
  "Line 2",
<br/>
  "Line three"
<br/>
},
<br/>
{
<br/>
  "This is page 2",
<br/>
  "Page 2 line 2",
<br/>
  // ...
<br/>
},
<br/>
// ...</td> </tr></table><span class="postbody">
<br/>
<br/>
To add a book to myBooks:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int addBook(const book *addbook)
<br/>
{
<br/>
    /* Add the book to the list */
<br/>
    myBooks[usedBooks] = (book *)addbook;
<br/>
<br/>
    /* Increment the book counter */
<br/>
    usedBooks++;
<br/>
};</td> </tr></table><span class="postbody">
<br/>
<br/>
Since you are using C++, you could make a book set class and have the oppropriate functions and such, which might be a little easier to manage.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Since he wants to display 1 of N predefined books, you can eliminate the array of book pointers to create the simplest thing that could possibly work.  Also, he's not going to be changing the book text, so everything can be const.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
const book myBooks[] =
<br/>
{           // open array of books
<br/>
    {       // open book 1
<br/>
        {   // open page 1
<br/>
            "This is line 1 of page 1 of book 1",
<br/>
            "Line 2",
<br/>
            "Last line of page 1"
<br/>
        },  // close page 1
<br/>
        {   // open page 2
<br/>
            "This is line 1 of page 2 of book 1",
<br/>
            "Line 2"
<br/>
        }   // close page 2
<br/>
    },      // close book 1
<br/>
    {       // open book 2
<br/>
        {   // open page 1
<br/>
            "Line 1 of page 1 of book 2",
<br/>
            "Line 2"
<br/>
        }   // close page 1
<br/>
    }       // close book 3
<br/>
};          // close array of books
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
To know the number of books that were defined, you can use a simple sizeof() idiom:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define NUM_BOOKS (sizeof(myBooks)/sizeof(myBooks[0]))
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
This is the size of the entire array divided by the size of the first element in the array, giving the number of elements in the array.  Everything is evaluated at compile time into a constant value for an array like this with a good compiler like gcc.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#58846 - sajiimori - Wed Oct 26, 2005 6:40 pm</h4>
    <div class="postbody"><span class="postbody">Oh right, type-wise they're different, though value-wise they are the same.  Personally, I've never had a use for the pointer-to-array type.
<br/>
<br/>
It should probably be noted that your example assumes that the <span style="font-weight: bold">book</span> type is padded out to the maximum number of pages and the maximum number of lines per page.  That could turn <span style="font-style: italic">Alice's Adventures in Wonderland</span> to <span style="font-style: italic">Moby Dick</span>.  ;)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
