<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>class and lockup - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>C/C++ > class and lockup</h2>
<div id="posts">
<div class="post">
    <h4>#4682 - johnny_north - Mon Apr 07, 2003 12:04 am</h4>
    <div class="postbody"><span class="postbody">This is my problem...
<br/>
<br/>
If I include a declaration of this class:
<br/>
<br/>
class ClearBlocks{
<br/>
	short x;
<br/>
	short y;
<br/>
	short which;
<br/>
	bool active;
<br/>
};
<br/>
<br/>
in another class:
<br/>
<br/>
class Piece{
<br/>
...(other vars)
<br/>
ClearBlocks cb[40];
<br/>
...
<br/>
}
<br/>
<br/>
my code hangs during the first graphic. However, if I do this:
<br/>
<br/>
class Piece{
<br/>
...(other vars)
<br/>
short x[40];
<br/>
short y[40];
<br/>
short which[40];
<br/>
bool active[40];
<br/>
...
<br/>
}
<br/>
<br/>
everything runs just fine? Seems like this should be the same, just less organized. I'm using the original devkit, compiling in ARM. Can anyone help?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4684 - niltsair - Mon Apr 07, 2003 1:46 am</h4>
    <div class="postbody"><span class="postbody">First thing, you should either do:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">struct ClearBlocks{ 
<br/>
short x; 
<br/>
short y; 
<br/>
short which; 
<br/>
bool active; 
<br/>
}; </td> </tr></table><span class="postbody">
<br/>
or
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">class ClearBlocks{ 
<br/>
public:
<br/>
short x; 
<br/>
short y; 
<br/>
short which; 
<br/>
bool active; 
<br/>
}; </td> </tr></table><span class="postbody">
<br/>
<br/>
Because all members of a class are private by default(not accessible from outside the class) while all members of a struct are public.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4685 - johnny_north - Mon Apr 07, 2003 1:56 am</h4>
    <div class="postbody"><span class="postbody">I actually did start by using your struct example, but the accessability of the members doesn't affect the problem. These members are actually meant to be private as the class will have its own member functions.
<br/>
<br/>
The devkit compiler doesn't like the struct and class types. I thought it might have something to do with alignment issues (I've had to align const arrays that hold graphics), but I've tried to do some padding and it doesn't seem to help.
<br/>
<br/>
Anyone know - is there a lot of overhead with a struct or class? Anyone know how many bytes?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4690 - johnny_north - Mon Apr 07, 2003 3:11 am</h4>
    <div class="postbody"><span class="postbody">Ok, after messing with this a bit I might suspect that I'm running out of room for variables. I've got quite a number of them in class headers, and so all of them are in memory at any given time. After optimizing variable usage in several classes, the:
<br/>
<br/>
ClearBlocks cb[40] 
<br/>
<br/>
seems to work. Question is, what's my limit. If I remember right, I think that all of the variables in each instace of all current classes are pushed onto the stack. I went looking into Jeff F's crt0.s:
<br/>
<br/>
__text_start = DEFINED (__gba_multiboot) ? 0x2000000 : 0x8000000;
<br/>
/* __ewram_start     = 0x2000000; */ /* Removed in v1.3 */
<br/>
__eheap_end       = 0x2040000;
<br/>
__iwram_start     = 0x3000000;
<br/>
__iheap_end       = 0x3008000 - 0x400;
<br/>
__sp_usr          = 0x3008000 - 0x100;
<br/>
__sp_irq          = 0x3008000 - 0x60;
<br/>
__intr_vector_buf = 0x3008000 - 4;
<br/>
__sp_usr_offset   = __sp_usr - __iwram_start;
<br/>
__intr_vect_offset = __intr_vector_buf - __sp_usr;
<br/>
<br/>
I'm confused here. Is sp_usr a pointer to the stack, and how many bytes is it? Also, because of alignment issues, if I use a u8 variable, does the compiler allocate 4 bytes anyway?
<br/>
<br/>
Thanks for the help!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4700 - Quirky - Mon Apr 07, 2003 7:42 am</h4>
    <div class="postbody"><span class="postbody">Use the -Map linker option to see where your variables are going. Your limit, assuming that these variables haven't been assigned to go in EWRAM, is 32k.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
