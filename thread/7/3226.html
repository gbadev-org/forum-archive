<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Class initialiser not working in global space. - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>C/C++ > Class initialiser not working in global space.</h2>
<div id="posts">
<div class="post">
    <h4>#19222 - Krakken - Wed Apr 14, 2004 7:23 am</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
For some reason when I declare a class with initialiser parameters outside of a function, whether this be main() or any other, the constructor is not executed.
<br/>
<br/>
Example:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
// IMAGINE THE CONSTRUCTOR SETS cValue AS THE INITIAL PARAMETER
<br/>
<br/>
// WORKS //
<br/>
int main() {
<br/>
  class_object class_name ('A'); // class_name.cValue is set to 'A'
<br/>
<br/>
  while (true);
<br/>
  return 0;
<br/>
}
<br/>
<br/>
// DOES NOT WORK //
<br/>
class_object class_name ('A'); // class_name.cValue is not set to anything
<br/>
<br/>
int main() {
<br/>
  while (true);
<br/>
  return 0;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Any ideas why?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19224 - f(DarkAngel) - Wed Apr 14, 2004 11:45 am</h4>
    <div class="postbody"><span class="postbody">In C, globals should be assigned staticaly, in bss. If you want compiler to execute a function at compile time, use macros. 
<br/>
It worked without any problems with the standard (x86) GCC in Linux. It might be a init execution problem of the start up code (Jeff Frohwein?). With a simple logic, your (run-time) program execution starts at main, not global inits.<br/>_________________<br/>death scream...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19226 - torne - Wed Apr 14, 2004 4:01 pm</h4>
    <div class="postbody"><span class="postbody">Commonly available link scripts (the one in DKA and Jeff's) should execute constructors correctly for globals but you may need to turn on C++ support in the crt0 file. This enables the code that runs the .ctors entries.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19233 - sajiimori - Wed Apr 14, 2004 9:22 pm</h4>
    <div class="postbody"><span class="postbody">No offense f(DarkAngel), but your post is kinda nonsense.  Executing functions at compile time??  This ain't Lisp ya know.  :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19243 - tepples - Thu Apr 15, 2004 5:52 am</h4>
    <div class="postbody"><span class="postbody">Though it's not as powerful in practice as Lisp's, the C++ preprocessor is said to be Turing complete.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19255 - f(DarkAngel) - Thu Apr 15, 2004 12:04 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">No offense f(DarkAngel), but your post is kinda nonsense.  Executing functions at compile time??  This ain't Lisp ya know.  :)</td> </tr></table><span class="postbody">
<br/>
<br/>
#define SOMEVALUE_SET(x) ((x) &gt;&gt; 4)
<br/>
#define GLOBAL_SOMETHING (*((vu16*)0x4543523412))
<br/>
<br/>
GLOBAL_SOMETHING = SOMEVALUE_SET(5);
<br/>
<br/>
<br/>
A macro is what i intended with "complie time function". A macro can be written without violating the mathematical meaning of the "function". Is this non-sense?<br/>_________________<br/>death scream...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19258 - poslundc - Thu Apr 15, 2004 2:43 pm</h4>
    <div class="postbody"><span class="postbody">Actually, that example <span style="font-weight: bold">is</span> nonsense. You can't place executable code like that outside of a function.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19266 - f(DarkAngel) - Thu Apr 15, 2004 5:06 pm</h4>
    <div class="postbody"><span class="postbody">Of course it's not possible to implement that example outside of a function. It's very normal for some to intentionally miss the true intesion of a sentence, even though there's an explanation in the previous/next sentence; both of my posts.. I have seen this kind in communities i have been, internet either real life, and naturally this community cannot be an exception. 
<br/>
<br/>
This example has no assertion that the code is inside of a function. It emphasizes that a functionality can be executed by compiler, a reply to the previous post, "Executing functions at compile time??". If it's going to statisfy your insatible ego:
<br/>
<br/>
int my_global = SOMEVALUE_SET(5);
<br/>
<br/>
is valid in global scope.
<br/>
<br/>
The discussions you poslundc and sajiimori have started are off-topic, and this is what is non-sense.
<br/>
<br/>
Yes poslundc , i am non-sense, yes i am idiot and ignorant, yes you are the greatest. If you don't have anything to say about the actual purpose, question of this thread, don't reply. Case ended.<br/>_________________<br/>death scream...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19269 - poslundc - Thu Apr 15, 2004 7:20 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>f(DarkAngel) wrote:</b></span></td> </tr> <tr> <td class="quote">If you don't have anything to say about the actual purpose, question of this thread, don't reply. Case ended.</td> </tr></table><span class="postbody">
<br/>
<br/>
I'm sorry, I thought this thread was about initializing objects in global space. I don't know where I got that idea from.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19567 - wintermute - Thu Apr 22, 2004 2:42 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Krakken wrote:</b></span></td> </tr> <tr> <td class="quote">Hi,
<br/>
<br/>
For some reason when I declare a class with initialiser parameters outside of a function, whether this be main() or any other, the constructor is not executed.
<br/>
<br/>
Any ideas why?</td> </tr></table><span class="postbody">
<br/>
<br/>
most GBA crtls don't support global constructors. The only exception is the set built in to devkitARM - <a href="http://www.devkit.tk" target="_blank">http://www.devkit.tk</a> .
<br/>
<br/>
Documentation and examples are still being worked on so apologies for a lack of information at present.
<br/>
<br/>
Code should be linked using arm-elf-g++ -specs=gba.specs -o &lt;output&gt;.elf &lt;object list&gt;
<br/>
<br/>
please feel free to join the mailing list detailed on the about page for any queries you may have.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19568 - wintermute - Thu Apr 22, 2004 2:45 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>torne wrote:</b></span></td> </tr> <tr> <td class="quote">Commonly available link scripts (the one in DKA and Jeff's) should execute constructors correctly for globals but you may need to turn on C++ support in the crt0 file. This enables the code that runs the .ctors entries.</td> </tr></table><span class="postbody">
<br/>
<br/>
This is not the case, the CPP support only changes the name of the main function. With the arm-elf target this is not enough to enable global constructors.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19581 - torne - Thu Apr 22, 2004 11:16 am</h4>
    <div class="postbody"><span class="postbody">The crt0 I use executes the _ctors section just fine.. it claims to be Jeff's. Perhaps someone else modified it.. I forget where I downloaded it from.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
