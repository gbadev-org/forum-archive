<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Casting function pointers with different argument signatures - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>C/C++ > Casting function pointers with different argument signatures</h2>
<div id="posts">
<div class="post">
    <h4>#62100 - undefined - Sun Nov 27, 2005 12:39 pm</h4>
    <div class="postbody"><span class="postbody">Is it possible to cast a function pointer for a function that takes a char argument into a function pointer that takes no arguments?
<br/>
<br/>
What I've got is basically two functions:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void RBCReadCapacityCommand(UInt8 byte);
<br/>
SIOWaitForClearToSendWithCallback(void (*clearToSendCallback)(void));</td> </tr></table><span class="postbody">
<br/>
<br/>
What I'd like to be able to do is this, but I'm not sure if it will result in stack trashing or something equally evil:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">SIOWaitForClearToSendWithCallback(&amp;RBCReadCapacityCommand)</td> </tr></table><span class="postbody">
<br/>
<br/>
At this time I don't have a unit to try the code on either (I traded my SP for an old shitty computer, STUPIDSTUPIDSTUPID), so for now all I've really got to tell me if my code's even somewhat sane is gcc.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62106 - wintermute - Sun Nov 27, 2005 2:30 pm</h4>
    <div class="postbody"><span class="postbody">Well, you can, but whether it's advisable or not is something else entirely.
<br/>
<br/>
You could use a typedef to cast the pointer to a different signature type like this :-
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
typedef void ( * voidFn)(void);
<br/>
<br/>
   SIOWaitForClearToSendWithCallback((voidFn)RBCReadCapacityCommand);
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
The problem is what to do with the invalid parameter that the function will receive. On arm systems you can get away with this since the parameters are passed in registers (the first 4 parameters anyway). On a system where all parameters are passed on the stack you might not.
<br/>
<br/>
I'm not 100% certain how the compiler will deal with stack based parameters if you try this. I believe the stack is cleaned by the caller by default which would allow this particular compiler abuse to work but I wouldn't offer any guarantees.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62111 - undefined - Sun Nov 27, 2005 3:16 pm</h4>
    <div class="postbody"><span class="postbody">That's about what i thought. But I've now come to my senses, and that whole mess has been scrapped for something that actually makes sense :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63192 - Joat - Fri Dec 09, 2005 4:13 pm</h4>
    <div class="postbody"><span class="postbody">In future, if you don't have the option of rewriting the function(s), do *not* cast function pointers.  On the ARM, it's *probably* safe for functions of fewer than 4 int-sized arguments (for which the ABI defines that r0-r3 are used to pass arguments, and are trashed/must be backed up over a function call, even in void functions), but it's *never* a good idea.
<br/>
<br/>
Instead, wrap the function you want to call:
<br/>
<br/>
void SomeFunc(int arg);
<br/>
<br/>
void SomeFuncVoidWrapper(void) { SomeFunc(0); } // or some other 'null' value
<br/>
<br/>
ThirdFuncThatTakesAFP(SomeFuncVoidWrapper)
<br/>
<br/>
instead of SomeFunc<br/>_________________<br/>Joat
<br/>
<a href="http://www.bottledlight.com" target="_blank">http://www.bottledlight.com</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
