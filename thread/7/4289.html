<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>atoi() - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>C/C++ > atoi()</h2>
<div id="posts">
<div class="post">
    <h4>#28156 - Krakken - Wed Oct 27, 2004 3:28 pm</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
I can't seem to get atoi() or _atoi() to work. I have included stdlib.h. Is it unsupported? I don't see why it would be and it's got me very confused as to why it won't work. 
<br/>
<br/>
I use DevKitARM, latest version.
<br/>
<br/>
Cheers,
<br/>
Krakken.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#28161 - poslundc - Wed Oct 27, 2004 3:54 pm</h4>
    <div class="postbody"><span class="postbody">Don't know if you can get atoi to work specifically... but a couple of thoughts:
<br/>
<br/>
1. Do you need it? There are very few GBA applications I can think of that need to parse a string into an integer.
<br/>
<br/>
2. You might consider just writing your own routine... for base 10, anyway, all it has to do is step through the string maintaining a running total. For each character, multiply the running total by ten, subtract '0' from the current char, and add it to your total. Repeat until you reach the end of the string or hit an illegal token (c &lt; '0' || c &gt; '9').
<br/>
<br/>
3. If you're looking to go the other way around (integer to string), which is a MUCH more common problem on the GBA, search the forum for keywords related to that or consider just using my <a class="postlink" href="http://www.danposluns.com/gbadev/posprintf/" target="_blank">posprintf</a>.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#28222 - Krakken - Thu Oct 28, 2004 12:21 am</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
Thanks, poslundc.
<br/>
<br/>
Oops, it was <span style="font-weight: bold">itoa()</span> silly me.
<br/>
<br/>
I wanted to see if I was making a silly mistake before considering writing my own. atoi allows you to set the base which was very convinent for what I needed. I am re-writing my entire library you see and i'm working on text display at the moment. The old way I used to do it with a printf() style interface added to much unnessacary code into my ROM and so it would increase the size 30 kb or so. This time I decided to go with a cleaner, cout style interface and wanted to be able to wrap up the entire integer conversion into one "operator &lt;&lt; (int)" function. 
<br/>
<br/>
I'll search around to see if someone has re-written the itoa() function and use that. Otherwise i'll use your posprintf() function.
<br/>
<br/>
Thanks,
<br/>
Krakken.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#28225 - DekuTree64 - Thu Oct 28, 2004 12:38 am</h4>
    <div class="postbody"><span class="postbody">There's a <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=1508" target="_blank">thread</a> in the ASM section with various itoa implementations. Check out my one there using a reciprocal multiply (not my first post there using the BIOS div), it's pretty fast, and written in THUMB so no need to waste precious IWRAM on it since you most likely won't be spending much CPU time at all in it.
<br/>
And yes, Dan's posprintf method is very fast too.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#28302 - Krakken - Fri Oct 29, 2004 11:01 am</h4>
    <div class="postbody"><span class="postbody">For some reason i'm having trouble compiling with both bits of code. I keep getting undefined reference errors. I checked my makefile and all seems well. It's compiling the .s files and linking the .o files. Not sure what the problem is.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#28307 - poslundc - Fri Oct 29, 2004 12:39 pm</h4>
    <div class="postbody"><span class="postbody">This indicates that you aren't linking correctly.
<br/>
<br/>
What are the parameters you are passing to GCC?
<br/>
<br/>
(Try changing about the order of posprintf and the program that uses it... doesn't always work, but it does sometimes.)
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#28309 - Krakken - Fri Oct 29, 2004 1:07 pm</h4>
    <div class="postbody"><span class="postbody">Here ya go, I made it print out exactly what it is doing. I personally see no error.
<br/>
<br/>
arm-elf-gcc -specs=gba_mb.specs -mthumb-interwork -o _bin/rom.elf _bin/posprintf.o _bin/xGame.o _bin/xMain.o _bin/kFile.o _bin/kGBA.o _bin/kSRAM.o _bin/kText.o
<br/>
<br/>
I tried reversing the order putting posprintf.o at the end too but no luck.
<br/>
<br/>
All files are present in the "_bin" folder.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#28311 - poslundc - Fri Oct 29, 2004 1:49 pm</h4>
    <div class="postbody"><span class="postbody">Hm... very strange. Can you print the exact errors that are being generated?
<br/>
<br/>
Also: it's a long shot, but maybe try adding ".section .text" to the first line of posprintf.S. I notice that I didn't specify a memory directive when looking at the code... it worked fine in Devkit Advance but perhaps is causing problems at the linking stage with Devkit ARM.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#28357 - Krakken - Sat Oct 30, 2004 2:59 am</h4>
    <div class="postbody"><span class="postbody">This is getting very strange now. Now I can't even seem to compile "posprintf.s". I haven't changed a thing in it (not even added the ".section .text" yet and it still gives me errors. Here is the command line that is generated by my makefile:
<br/>
<br/>
<span style="color: blue">
<br/>
arm-elf-as kelix/external/posprintf.s -o _bin/posprintf.o
<br/>
</span>
<br/>
<br/>
That gives me the errors:
<br/>
<br/>
<span style="color: blue">
<br/>
kelix/external/posprintf.s: Assembler messages:
<br/>
kelix/external/posprintf.s:0: Warning: end of file in comment; newline inserted
<br/>
kelix/external/posprintf.s:1: Error: junk at end of line, first unrecognized character is `.'
<br/>
</span>
<br/>
<br/>
The error I get if I try to link in the .o file:
<br/>
<br/>
<span style="color: blue">
<br/>
_bin/xGame.o(.text+0x7e): In function `TEMPLATE::xGame::xGame()':
<br/>
: undefined reference to `posprintf(char*, char const*, ...)'
<br/>
_bin/xGame.o(.text+0x152): In function `TEMPLATE::xGame::xGame()':
<br/>
: undefined reference to `posprintf(char*, char const*, ...)'
<br/>
</span>
<br/>
<br/>
posprintf() is not in a namespace.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#28358 - poslundc - Sat Oct 30, 2004 3:22 am</h4>
    <div class="postbody"><span class="postbody">The source file's extension should be a captial S, not a lowercase one, and you should run it through GCC rather than through GAS directly.
<br/>
<br/>
The captial-S indicates to GCC that it needs to run the preprocessor on it, and using GCC, uh, gives you access to the preprocessor.
<br/>
<br/>
In general, it is a good idea to call GCC on your files rather than specifying which component programs you want to use. Let GCC do the work for you; it usually knows what it's doing.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#28365 - Krakken - Sat Oct 30, 2004 5:16 am</h4>
    <div class="postbody"><span class="postbody">I actually originally did call GCC but changed it to AS thinking that may be the problem.  Changing it to ".S" makes it compile fine now, thanks for that. The undefined error still persists after adding ".section .text" however.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#28368 - allenu - Sat Oct 30, 2004 6:30 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Krakken wrote:</b></span></td> </tr> <tr> <td class="quote">I actually originally did call GCC but changed it to AS thinking that may be the problem.  Changing it to ".S" makes it compile fine now, thanks for that. The undefined error still persists after adding ".section .text" however.</td> </tr></table><span class="postbody">
<br/>
<br/>
I just gave it a shot myself out of curiousity.  Try changing posprintf.h to this:
<br/>
<br/>
extern "C" void posprintf(char *, const char *, ...);
<br/>
<br/>
i.e. insert the "C" after extern.  That works for me over here.  
<br/>
<br/>
I suspect that your build of gcc is actually "g++" (the GNU C++ compiler) and so it is mangling the posprintf label for C++, thus making your linker not find it.  This fixes it so that the C++ compiler treats posprintf() as a C function, and it does not mangle the function name.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#28370 - Krakken - Sat Oct 30, 2004 6:52 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>allenu wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Krakken wrote:</b></span></td> </tr> <tr> <td class="quote">I actually originally did call GCC but changed it to AS thinking that may be the problem.  Changing it to ".S" makes it compile fine now, thanks for that. The undefined error still persists after adding ".section .text" however.</td> </tr></table><span class="postbody">
<br/>
<br/>
I just gave it a shot myself out of curiousity.  Try changing posprintf.h to this:
<br/>
<br/>
extern "C" void posprintf(char *, const char *, ...);
<br/>
<br/>
i.e. insert the "C" after extern.  That works for me over here.  
<br/>
<br/>
I suspect that your build of gcc is actually "g++" (the GNU C++ compiler) and so it is mangling the posprintf label for C++, thus making your linker not find it.  This fixes it so that the C++ compiler treats posprintf() as a C function, and it does not mangle the function name.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Thank you! You're a genius. :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#28371 - Krakken - Sat Oct 30, 2004 7:00 am</h4>
    <div class="postbody"><span class="postbody">Here, I fixed up the header. Now it should work for C and C++.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#ifdef __cplusplus
<br/>
extern "C" void posprintf(char *, const char *, ...);
<br/>
#else
<br/>
extern void posprintf(char *, const char *, ...);
<br/>
#endif</td> </tr></table><span class="postbody">
<br/>
<br/>
Cheers for everyones help. I appreciate it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#28381 - poslundc - Sat Oct 30, 2004 3:17 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>allenu wrote:</b></span></td> </tr> <tr> <td class="quote">I just gave it a shot myself out of curiousity.  Try changing posprintf.h to this:
<br/>
<br/>
extern "C" void posprintf(char *, const char *, ...);
<br/>
<br/>
i.e. insert the "C" after extern.  That works for me over here.  
<br/>
<br/>
I suspect that your build of gcc is actually "g++" (the GNU C++ compiler) and so it is mangling the posprintf label for C++, thus making your linker not find it.  This fixes it so that the C++ compiler treats posprintf() as a C function, and it does not mangle the function name.</td> </tr></table><span class="postbody">
<br/>
<br/>
Ah, that's interesting. I'd never tried compiling it in the C++ environment. Good to know for the future!
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#28420 - Krakken - Sun Oct 31, 2004 5:30 am</h4>
    <div class="postbody"><span class="postbody">Any ideas why I get a <span style="color: blue">warning: no newline at end of file</span> on both the posprintf header and .S file? I checked and both have a new line.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#28430 - allenu - Sun Oct 31, 2004 9:22 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Krakken wrote:</b></span></td> </tr> <tr> <td class="quote">Any ideas why I get a <span style="color: blue">warning: no newline at end of file</span> on both the posprintf header and .S file? I checked and both have a new line.</td> </tr></table><span class="postbody">
<br/>
<br/>
Perhaps your editor is not placing a carriage-return/line-feed combination at the end of the line, but is placing just a line-feed?  I dunno.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#28450 - Miked0801 - Sun Oct 31, 2004 8:44 pm</h4>
    <div class="postbody"><span class="postbody">I got this with newer versions of GCC.  Older versions don't care what the last char of a file is, the newer ones do.  Kind of a silly warning...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#28485 - tepples - Mon Nov 01, 2004 6:15 am</h4>
    <div class="postbody"><span class="postbody">Over successive versions, GCC tends to get stricter with respect to standards conformance because too many people run into bugs trying to support programs that work both on GCC and on proprietary compilers. GCC warns you to save time when porting to platforms that treat it as an <span style="font-style: italic">error</span> rather than a warning.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#28487 - Krakken - Mon Nov 01, 2004 9:00 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>allenu wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Krakken wrote:</b></span></td> </tr> <tr> <td class="quote">Any ideas why I get a <span style="color: blue">warning: no newline at end of file</span> on both the posprintf header and .S file? I checked and both have a new line.</td> </tr></table><span class="postbody">
<br/>
<br/>
Perhaps your editor is not placing a carriage-return/line-feed combination at the end of the line, but is placing just a line-feed?  I dunno.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Problem solved, it was as you said. I opened it in notepad to see if it was the file formatting (a good way to tell this) and there were no newlines.
<br/>
<br/>
Thanks.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
