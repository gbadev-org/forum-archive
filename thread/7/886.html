<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Dynamic memory allocation on the GBA ? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>C/C++ > Dynamic memory allocation on the GBA ?</h2>
<div id="posts">
<div class="post">
    <h4>#4431 - Shadow - Mon Mar 31, 2003 2:25 am</h4>
    <div class="postbody"><span class="postbody">Hi.
<br/>
<br/>
I have seen on some other posts something about problems using dynamic memory allocation (malloc, calloc, etc...) on the GBA, and I was wondering why.  As far as I know, it is a very useful and powerful technique, especially when it comes to making games.
<br/>
So, is it possible (recommended) to use dynamic memory allocation on the GBA ?  Does the GBA even have (and use) a heap ?  If so, where is it located in memory and what is its size ?  And finally, if it is too troublesome to use, how do you get things done without it (linked lists, dynamic arrays, etc...) ?
<br/>
<br/>
Thanks in advance.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4440 - tepples - Mon Mar 31, 2003 8:40 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Shadow wrote:</b></span></td> </tr> <tr> <td class="quote">So, is it possible (recommended) to use dynamic memory allocation on the GBA ?</td> </tr></table><span class="postbody">
<br/>
It's possible, but it's not recommended in general unless you have an algorithm that requires it.  It's best to lay out video back buffers, etc. at some fixed location in RAM.  And when possible, use either a 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Does the GBA even have (and use) a heap ?</td> </tr></table><span class="postbody">
<br/>
The BIOS does not have memory allocation functions, but the malloc() implementation linked into some programs allocates from EWRAM.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">if it is too troublesome to use, how do you get things done without it (linked lists, dynamic arrays, etc...) ?</td> </tr></table><span class="postbody">
<br/>
Here are some good dynamic allocation strategies, each designed to cause much less external fragmentation vs. the typical chained-blocks structure:
<br/>
<ul>
<br/>
<li>Stack (freeing blocks in reverse order of allocation)
<br/>
</li><li>Tower (freeing all blocks allocated after this one, good for a linked list that you use during each frame and then destroy when you're done with it)
<br/>
</li><li>FAT (allocate in large fixed-size clusters about 1 KB in size, and keep a linked list of clusters in use by a block)
<br/>
</li></ul>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Thanks in advance.</td> </tr></table><span class="postbody">
<br/>
Pun intendo? ;-)<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4449 - Paul Shirley - Mon Mar 31, 2003 1:50 pm</h4>
    <div class="postbody"><span class="postbody">The malloc heap usually occupies the whole of EWRAM but GBA programmers have a nasty habit of directly accessing EWRAM. Collisions aren't pretty.
<br/>
<br/>
You need to allocate blocks of EWRAM with the __attribute__((section)) system, the linker will then keep the heap away from your direct allocations and its safe to use malloc/new.
<br/>
<br/>
On a fixed size memory machine avoiding dynamic memory is usually good advice for reasons of efficiency and stability. Memory leaks are annoying on a PC but fatal on a Gameboy, the same applies to memory fragmentation.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
