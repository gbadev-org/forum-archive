<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>struct help! - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>C/C++ > struct help!</h2>
<div id="posts">
<div class="post">
    <h4>#26815 - LOst? - Sun Sep 26, 2004 7:47 pm</h4>
    <div class="postbody"><span class="postbody">I want a type struct like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
typedef struct
<br/>
{
<br/>
   size = ?;
<br/>
   const int array [size]
<br/>
} name;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
And I don't want to use new or malloc because I want the array to be set at compilation, and not during execution.
<br/>
<br/>
I hope I'm not too confusing. I need a mappings struct with an array with each sprite represented. I want to have a managable ammount of sprites for each mappings that will be hardcoded, and I only want to have one struct. Not hard coded structs for each mappings.
<br/>
<br/>
EDIT:
<br/>
Or maybe I should just use structs for all mappings without the typedef? Is this working?
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
struct HeroCharacter
<br/>
{
<br/>
   size = 12;
<br/>
   const sprites array [size]
<br/>
};
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26816 - Lord Graga - Sun Sep 26, 2004 7:59 pm</h4>
    <div class="postbody"><span class="postbody">When you set size at compilation and define all RAM ereas, you do NOT malloc.
<br/>
<br/>
Here's an example of something that does not take malloc:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include "someheadershere.h"
<br/>
<br/>
const int array[1324];
<br/>
<br/>
int main() {
<br/>
   SetUpPrintSystem();
<br/>
   PrintNumberToScreen(sizeof(array));
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
This will print the size of the array in bytes (1234*4, I believe).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26817 - sajiimori - Sun Sep 26, 2004 8:01 pm</h4>
    <div class="postbody"><span class="postbody">That's one sort of problem that templates were meant to fix in C++, but it's not so bad in C as long as you're using a compiler that supports flexible arrays (which GCC has for a while).</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">typedef struct
<br/>
{
<br/>
  int size;
<br/>
  int array[];
<br/>
} S;
<br/>
<br/>
const S s =
<br/>
{
<br/>
  3,
<br/>
  { 100, 200, 300 }
<br/>
};</td> </tr></table><span class="postbody">You still have to ensure that 'size' matches the length of the array, so if you have to manage a lot of data then write a code generator and let your computer do the tedious work.  Perl helps here.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26821 - LOst? - Sun Sep 26, 2004 9:57 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">That's one sort of problem that templates were meant to fix in C++, but it's not so bad in C as long as you're using a compiler that supports flexible arrays (which GCC has for a while).<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">typedef struct
<br/>
{
<br/>
  int size;
<br/>
  int array[];
<br/>
} S;
<br/>
<br/>
const S s =
<br/>
{
<br/>
  3,
<br/>
  { 100, 200, 300 }
<br/>
};</td> </tr></table><span class="postbody">You still have to ensure that 'size' matches the length of the array, so if you have to manage a lot of data then write a code generator and let your computer do the tedious work.  Perl helps here.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Thank you very much! I can see how you are using const. That's something I really wanted to know. Const in C++ is so confusing.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26824 - LOst? - Sun Sep 26, 2004 10:16 pm</h4>
    <div class="postbody"><span class="postbody">Okay, I'm stuck. Do you have any suggestion on making this working?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
typedef struct
<br/>
{
<br/>
   s16 sx;
<br/>
   s8   sy;
<br/>
   u16   CharStart;
<br/>
   s8   PalNumPlus;
<br/>
   u16   Shape;
<br/>
   u16   Size;
<br/>
} Fragment;
<br/>
<br/>
typedef struct
<br/>
{
<br/>
   int size;
<br/>
   Fragment fragments [];
<br/>
} Mappings;
<br/>
<br/>
const Mappings test [2] =
<br/>
{
<br/>
   2,
<br/>
   { {-8, -8, 512, 0, SQUARE, SIZE_16}, {-8, -8, 252, 0, SQUARE, SIZE_16} }
<br/>
};
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I have no idea how to initialize the Fragment structure inside the array {} :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26825 - Lord Graga - Sun Sep 26, 2004 10:23 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
const Mappings test [2] =
<br/>
{
<br/>
   2,
<br/>
   { {{-8, -8, 512, 0, SQUARE, SIZE_16}, {-8, -8, 252, 0, SQUARE, SIZE_16}} }
<br/>
};
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
<span style="font-style: italic">I have no idea how to initialize the Fragment structure inside the array {} :(</span>
<br/>
<br/>
There you go. An extra { } should do it. Beware that if you plan to copy the struct that you made to the OAM, then errors will definetly occur :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26826 - sajiimori - Sun Sep 26, 2004 10:26 pm</h4>
    <div class="postbody"><span class="postbody">I wouldn't expect Graga's code to work, either.  The reason neither version should work is that you declared an array of Mappings, which you can't really do since Mapping is of undefined size.  It could be 4 bytes or 4000, depending on the size of the 'fragments' array.
<br/>
<br/>
You can make single Mapping structs, or you can make arrays of Mapping pointers.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26828 - LOst? - Sun Sep 26, 2004 10:33 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">I wouldn't expect Graga's code to work, either.  The reason neither version should work is that you declared an array of Mappings, which you can't really do since Mapping is of undefined size.  It could be 4 bytes or 4000, depending on the size of the 'fragments' array.
<br/>
<br/>
You can make single Mapping structs, or you can make arrays of Mapping pointers.</td> </tr></table><span class="postbody">
<br/>
<br/>
I have no idea how to do this. I want the best and fastest way to do sprite mappings. It doesn't need to be the same format as the OAM memory.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26829 - sajiimori - Sun Sep 26, 2004 11:30 pm</h4>
    <div class="postbody"><span class="postbody">Sorry, I don't understand the problem well enough to offer a solution.  If by "fastest" you mean in terms of CPU usage, I wouldn't worry about it until you are actually running out of CPU.  Do it whichever way is simplest.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26832 - LOst? - Mon Sep 27, 2004 12:23 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">Sorry, I don't understand the problem well enough to offer a solution.  If by "fastest" you mean in terms of CPU usage, I wouldn't worry about it until you are actually running out of CPU.  Do it whichever way is simplest.</td> </tr></table><span class="postbody">
<br/>
<br/>
Okay. No not really fast in terms of CPU usage... More of a fast way to handle the data.
<br/>
<br/>
I mean managing sprite frames (using multiple sprites per frame) in a data format represented by a struct.
<br/>
<br/>
I have a sprite list that is copied every vblank. I will use a function called ShowObject(); to translate the mappings into sprites and load them into that list. I have everything set except for the mappings format. If it was Motorola 68k assembler I would do it like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
MappingsStart:
<br/>
dc.w Frame1-MappingsStart
<br/>
dc.w Frame2.MappingsStart
<br/>
<br/>
Frame1:
<br/>
dc.b $05 ; 5 sprites for this frame
<br/>
<br/>
dc.w $FFE0 ; X offset of sprite 1
<br/>
....
<br/>
<br/>
dc.w $FFE0 ; X offset of sprite 2
<br/>
....
<br/>
<br/>
dc.w $FFE0 ; X offset of sprite 3
<br/>
....
<br/>
<br/>
dc.w $FFE0 ; X offset of sprite 4
<br/>
....
<br/>
<br/>
dc.w $FFE0 ; X offset of sprite 5
<br/>
....
<br/>
<br/>
Frame2:
<br/>
dc.b $01 ; One sprite for this frame
<br/>
<br/>
dc.w $FFE0 ; X offset of sprite 1
<br/>
....
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
A simple list where every frame has its unique number of sprites with their X, Y, PALLINE, CHARACTER data declared.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26833 - sajiimori - Mon Sep 27, 2004 1:58 am</h4>
    <div class="postbody"><span class="postbody">It looks like "MappingsStart" is an array of pointers to "Mappings" structures, which are each created seperately.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
Mappings Frame1 =
<br/>
{
<br/>
  5, // 5 sprites for this frame
<br/>
  { ... },
<br/>
  ...
<br/>
};
<br/>
<br/>
Mappings Frame2 =
<br/>
{
<br/>
  ...
<br/>
};
<br/>
<br/>
Mappings* MappingsStart[] =
<br/>
{
<br/>
  &amp;Frame1,
<br/>
  &amp;Frame2,
<br/>
  ...
<br/>
};
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26834 - MumblyJoe - Mon Sep 27, 2004 2:29 am</h4>
    <div class="postbody"><span class="postbody">Just throwing my C++ hat into the ring:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">template&lt;unsigned int SIZE&gt;
<br/>
class Mappings
<br/>
{
<br/>
   public:
<br/>
   class Fragment
<br/>
   {
<br/>
      public:
<br/>
      s16 sx;
<br/>
      s8   sy;
<br/>
      u16   CharStart;
<br/>
      s8   PalNumPlus;
<br/>
      u16   Shape;
<br/>
      u16   Size;
<br/>
   };
<br/>
   Fragment fragments [SIZE];
<br/>
};
<br/>
<br/>
const Mappings&lt;2&gt; test =
<br/>
{
<br/>
   { {-8, -8, 512, 0, 5, 3}, {-8, -8, 252, 0, 3, 5} }
<br/>
};</td> </tr></table><span class="postbody">
<br/>
<br/>
Tested on borland 5.5.1, not gcc yet.<br/>_________________<br/><a class="postlink" href="http://www.hungrydeveloper.com" target="_blank">www.hungrydeveloper.com</a>
<br/>
Version 2.0 now up - guaranteed at least 100% more pleasing!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26836 - sajiimori - Mon Sep 27, 2004 2:38 am</h4>
    <div class="postbody"><span class="postbody">Ok, now make an array of those, or pointers to them, in such a way that the fragments of each array element can be iterated over.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26837 - Lord Graga - Mon Sep 27, 2004 7:43 am</h4>
    <div class="postbody"><span class="postbody">If C++ gives you problems, you can probably just use C and then make a header?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26840 - sajiimori - Mon Sep 27, 2004 8:02 am</h4>
    <div class="postbody"><span class="postbody">What problems?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26849 - LOst? - Mon Sep 27, 2004 1:46 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>MumblyJoe wrote:</b></span></td> </tr> <tr> <td class="quote">Just throwing my C++ hat into the ring:
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">template&lt;unsigned int SIZE&gt;
<br/>
class Mappings
<br/>
{
<br/>
   public:
<br/>
   class Fragment
<br/>
   {
<br/>
      public:
<br/>
      s16 sx;
<br/>
      s8   sy;
<br/>
      u16   CharStart;
<br/>
      s8   PalNumPlus;
<br/>
      u16   Shape;
<br/>
      u16   Size;
<br/>
   };
<br/>
   Fragment fragments [SIZE];
<br/>
};
<br/>
<br/>
const Mappings&lt;2&gt; test =
<br/>
{
<br/>
   { {-8, -8, 512, 0, 5, 3}, {-8, -8, 252, 0, 3, 5} }
<br/>
};</td> </tr></table><span class="postbody">
<br/>
<br/>
Tested on borland 5.5.1, not gcc yet.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
I'm really interested in learning templates someday. This might be the start of it. And if it doesn't work, I will go by sajiimori list of pointers.
<br/>
<br/>
EDIT: MumblyJoe's code compiles without errors. This is going to be interesting. Hopefully this works...
<br/>
<br/>
<br/>
EDIT: How do I get the stuff out from "test"?
<br/>
Would it be like this?
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
test.fragments [0].Shape
<br/>
</td> </tr></table><span class="postbody">
<br/>
Also this class misses the info on how many fragments there are. How do I implent it into the class Mappings?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26852 - poslundc - Mon Sep 27, 2004 2:25 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>LOst? wrote:</b></span></td> </tr> <tr> <td class="quote">I'm really interested in learning templates someday.</td> </tr></table><span class="postbody">
<br/>
<br/>
<a href="http://cplusplus.com/doc/tutorial/tut5-1.html" target="_blank">http://cplusplus.com/doc/tutorial/tut5-1.html</a>
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26854 - jma - Mon Sep 27, 2004 3:38 pm</h4>
    <div class="postbody"><span class="postbody">It probably doesn't matter to the original poster, but just to add completeness to the template idea: every <span style="font-style: italic">different</span> instance of the template will generate more code for that template. In essence, a templated class is just one massive macro that will generate code. So, using your Mappings class:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">Mappings&lt;128&gt; sprite_list_1;
<br/>
Mappings&lt;200&gt; sprite_list_2;</td> </tr></table><span class="postbody">
<br/>
<br/>
This will create 2 different copies of the Mappings code. Just letting the original poster know if space is precious to him. Usually, templates aren't much of a big deal because they template types (like an array of ints, or an array of doubles) -- not too many different ones floating around. But when you start templating with integers and such, you can generate <span style="font-style: italic">lots</span> of extra code.
<br/>
<br/>
If you only need a single instance of it, (like &lt;128&gt; in this case perhaps?) then there is no real need to use a template. I consider this especially true since you are declaring them globally at compile time. Just use a #define'd constant. Likewise, there is no reason that you can't use C, either:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">typedef struct tagFragment {
<br/>
  s16 sx;
<br/>
  s8 sy;
<br/>
  u16 CharStart;
<br/>
  s8 PalNumPlus;
<br/>
  u16 Shape;
<br/>
  u16 Size; 
<br/>
} Fragment;
<br/>
<br/>
typedef struct tagMappings {
<br/>
  unsigned int nFragments;
<br/>
  Fragment *pFragments;
<br/>
} Mappings;
<br/>
<br/>
/* declare your constant list of them */
<br/>
const Fragment some_fragments[] = {
<br/>
  {-8, -8, 512, 0, 5, 3}, 
<br/>
  {-8, -8, 252, 0, 3, 5},
<br/>
  /* TODO: fill in the rest */
<br/>
};
<br/>
<br/>
/* delcare the mapping to them */
<br/>
const Mappings a_mapping = {
<br/>
  sizeof(some_fragments) / sizeof(Fragment),
<br/>
  some_fragments,
<br/>
};</td> </tr></table><span class="postbody">
<br/>
<br/>
Nothing against C++ and templates -- they can be very useful. Just giving the original poster more information and options to choose from.
<br/>
<br/>
Jeff<br/>_________________<br/><a href="mailto:massung@gmail.com">massung@gmail.com</a>
<br/>
<a href="http://www.retrobyte.org" target="_blank">http://www.retrobyte.org</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26857 - LOst? - Mon Sep 27, 2004 8:31 pm</h4>
    <div class="postbody"><span class="postbody">For the first time in my life I see C/C++ missing something.
<br/>
<br/>
Pointers to class templates of different sizes.
<br/>
Predeclaration of a array of structures with more arrays with different data types in it.
<br/>
<br/>
<br/>
With a lot off errors for these kind of datas, I'm forced to use 4 structures each, with different types, so making a simple sprite frame I need to have 4 different types of structures seperate from each other.
<br/>
<br/>
This is what I call OOP!
<br/>
<br/>
EDIT:
<br/>
And guess what? It still isn't working!
<br/>
<br/>
You guys seem to forget one thing when you post your examples: Number of mappings (frames)! I need each mapping to have a variable with number of fragments, but I also need the mappings to hold a variable with number of frames.
<br/>
<br/>
Mappings = (a group of frames)
<br/>
Frame = (a group of fragments)
<br/>
Fragment = a hardware sprite.
<br/>
<br/>
-------------------------------------------------
<br/>
<br/>
EDIT:
<br/>
I have taken out the mappings structure, and I go with this now:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
typedef struct
<br/>
{
<br/>
   s16 sx;
<br/>
   s8   sy;
<br/>
   u16   CharStart;
<br/>
   s8   PalNumPlus;
<br/>
   u16   Shape;
<br/>
   u16   Size;
<br/>
} Fragment;
<br/>
<br/>
#define NumFragments(n)      sizeof (n) / sizeof (Fragment)
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
And when creating two frames, I go like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
const Fragment frame1 [] =
<br/>
{
<br/>
   {-8, -8, 512, 0, SQUARE, SIZE_16},
<br/>
   {-8, -8, 252, 0, SQUARE, SIZE_16}
<br/>
};
<br/>
<br/>
const Fragment frame2 [] =
<br/>
{
<br/>
   {-8, -8, 512, 0, SQUARE, SIZE_16},
<br/>
   {-8, -8, 512, 0, SQUARE, SIZE_16},
<br/>
   {-8, -8, 252, 0, SQUARE, SIZE_16}
<br/>
};
<br/>
<br/>
const Fragment* test [] =
<br/>
{
<br/>
   frame1,
<br/>
   frame2
<br/>
};
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Then I guess I can get the number of fragments by doing this (hopefully):
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   int number = NumFragments (test [0]); // Using macro for getting the amount of arrays
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
But I'm kinda stuck now. The biggest issue right now is to keep track of the data through pointers to arrays of unknown sizes that points to (is it?) the fragments wich i can use that macro to get the number of.
<br/>
<br/>
God this code would give so much Access Violation exceptions if it was a Win32 application I assume.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26866 - jma - Mon Sep 27, 2004 10:57 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>LOst? wrote:</b></span></td> </tr> <tr> <td class="quote">I need each mapping to have a variable with number of fragments</td> </tr></table><span class="postbody">
<br/>
How do you not have that with the example code I provided above?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Mappings = (a group of frames)
<br/>
Frame = (a group of fragments)
<br/>
Fragment = a hardware sprite.
<br/>
...
<br/>
And when creating two frames, I go like this:
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
const Fragment frame1 [] =
<br/>
{
<br/>
   {-8, -8, 512, 0, SQUARE, SIZE_16},
<br/>
   {-8, -8, 252, 0, SQUARE, SIZE_16}
<br/>
};
<br/>
<br/>
const Fragment frame2 [] =
<br/>
{
<br/>
   {-8, -8, 512, 0, SQUARE, SIZE_16},
<br/>
   {-8, -8, 512, 0, SQUARE, SIZE_16},
<br/>
   {-8, -8, 252, 0, SQUARE, SIZE_16}
<br/>
};
<br/>
<br/>
const Fragment* test [] =
<br/>
{
<br/>
   frame1,
<br/>
   frame2
<br/>
};
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Then I guess I can get the number of fragments by doing this (hopefully):
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   int number = NumFragments (test [0]); // Using macro for getting the amount of arrays
<br/>
</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
I think you are sorely confused in your "objectifying" of the problem. Given your example code, test[0] should contain (in some way) the number of fragments (hardware sprites) in the frame. But you state at the beginning of your post that the number of fragments should be stored in the mapping. Which do you want? If a frame is no more than an array of fragments it can't contain the size (unless you make it a struct or class that can hold more data).
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">but I also need the mappings to hold a variable with number of frames.</td> </tr></table><span class="postbody">
<br/>
Again, you are objectifying poorly. You are saying one thing and coding something entirely different. You should have an entirely separate structure here just for frames:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">struct Mapping {
<br/>
  int n_frames;
<br/>
  Frame *frames;
<br/>
};
<br/>
<br/>
struct Frame {
<br/>
  int n_fragments;
<br/>
  Fragment *fragments;
<br/>
};
<br/>
<br/>
struct Fragment {
<br/>
  /* sprite stuff */
<br/>
};
<br/>
<br/>
// Now put it all together:
<br/>
<br/>
const Fragment some_fragments[] = {
<br/>
  /* todo */
<br/>
};
<br/>
<br/>
const Frame some_frames[] = {
<br/>
  { sizeof(some_fragments) / sizeof(Fragment), some_fragments },
<br/>
  /* todo: more */
<br/>
};
<br/>
<br/>
const Mapping some_mappings[] = {
<br/>
  { sizeof(some_frames) / sizeof(Frames), some_frames },
<br/>
  /* todo: more */
<br/>
};</td> </tr></table><span class="postbody">
<br/>
You are trying to skip the middle step of "Frame" and expect the array to just "know" how many elements it has. Sorry, no-go in C.
<br/>
<br/>
Jeff<br/>_________________<br/><a href="mailto:massung@gmail.com">massung@gmail.com</a>
<br/>
<a href="http://www.retrobyte.org" target="_blank">http://www.retrobyte.org</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26867 - LOst? - Mon Sep 27, 2004 11:07 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>jma wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>LOst? wrote:</b></span></td> </tr> <tr> <td class="quote">I need each mapping to have a variable with number of fragments</td> </tr></table><span class="postbody">
<br/>
How do you not have that with the example code I provided above?
<br/>
<br/>
I think you are sorely confused in your "objectifying" of the problem.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Well, it's an outcome of my bad English. I'm sorry for that. I'm also sorry for getting upset. I hoped I would have found a way to make this mappings system work today.
<br/>
<br/>
You are correct, and I used some of you code. I never aimed this problem to be caused by you. I got mad at all the errors I got from GCC while trying to get this to work. Mostly the error that says you can't convert <span style="font-weight: bold">const Mappings*</span> into <span style="font-weight: bold">Mappings*</span>.
<br/>
<br/>
I really don't need the number of frames, but my wish was to hold the number so that I can't by accident read data outside of the array.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26871 - sajiimori - Tue Sep 28, 2004 1:04 am</h4>
    <div class="postbody"><span class="postbody">Well, you've heard plenty of reasonable solutions by now, and you can pick the one you like best.  C and C++ lack a lot of things I like, but the features you are complaining about are too vague to implement.
<br/>
<br/>
You want a pointer to a templatized object with an unspecified argument?  You may as well ask for pointers to classes you haven't finished writing yet.  The compiler couldn't know how to treat such an "object".  Use dynamic allocation or flexible arrays.
<br/>
<br/>
You want arrays of values that are all different sizes?  Then what does <span style="font-weight: bold">a[i]</span> compile to if <span style="font-weight: bold">a</span> is such an array?  Use arrays of pointers.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
