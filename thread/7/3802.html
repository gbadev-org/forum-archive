<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>abs() with math.h? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>C/C++ > abs() with math.h?</h2>
<div id="posts">
<div class="post">
    <h4>#24195 - cyberg - Thu Jul 29, 2004 3:16 pm</h4>
    <div class="postbody"><span class="postbody">Hi, I would like to know if it's better to use abs() of math.h or to code myself the function. I don't need it for a time critical section of my code so a little overhead is not the end of the world, but I just need to know if the function won't be like 10 times slower than coding it myself. And I'd like to know if it's the same for all the functions implemented in math.h and other c++ libraries!
<br/>
<br/>
Thank you!<br/>_________________<br/>Etienne Houle</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#24197 - FluBBa - Thu Jul 29, 2004 3:44 pm</h4>
    <div class="postbody"><span class="postbody">I dont know how it's implemented in math.h
<br/>
<br/>
Here's how to do it in ARM code for 32bit ints:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
tst r0,#0x80000000
<br/>
rsbne r0,r0,#0
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/>I probably suck, my not is a programmer.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#24198 - poslundc - Thu Jul 29, 2004 3:58 pm</h4>
    <div class="postbody"><span class="postbody">You can code it yourself as a C macro:
<br/>
<br/>
#define abs(a) (((a) &lt; 0) ? -(a) : (a))
<br/>
<br/>
At least by inlining it like this you save yourself the overhead of a function call when using the standard library version of it.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#24203 - tepples - Thu Jul 29, 2004 5:21 pm</h4>
    <div class="postbody"><span class="postbody">Except your abs(a) macro doesn't work when a has side effects. Rather, I'd code it like this, placed in the project's header file:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">static inline unsigned int abs(int a)
<br/>
{
<br/>
Â  return (((a) &lt; 0) ? -(a) : (a));
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
Still, I'd guess that the standard library uses C inline functions. However, be careful, as bringing in &lt;math.h&gt; may bring in the entire bulk of the floating-point library with it.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#24209 - Miked0801 - Thu Jul 29, 2004 7:52 pm</h4>
    <div class="postbody"><span class="postbody">Beware of Macro ABS calls - you can get burned:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
int i, j, k;
<br/>
<br/>
i = 10983240
<br/>
j = -387594875
<br/>
<br/>
k = ABS(i /j + i*j + IamAHugeFunctionCallWithBigOverhead(i, j));
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
A macro will paste and run the above up to 3 times...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#24266 - sgeos - Sat Jul 31, 2004 6:06 am</h4>
    <div class="postbody"><span class="postbody">Things get even worse with random numbers.  Consider this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">hp = abs(hp - random_number(0, max_hp / 2));</td> </tr></table><span class="postbody">
<br/>
Can anyone come up with a macro that gives the desired results?
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#24269 - tepples - Sat Jul 31, 2004 6:22 am</h4>
    <div class="postbody"><span class="postbody">The inline function will give the result you want, as inline functions evaluate each argument exactly once.
<br/>
<br/>
Or if you insist on a macro, you can use a GCC extension to create blocks of code within an expression:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define abs(x) ({long int x_1 = x; (x_1 &lt; 0 ? -x_1 : x_1)})</td> </tr></table><span class="postbody"><br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#24278 - wintermute - Sat Jul 31, 2004 11:01 am</h4>
    <div class="postbody"><span class="postbody">abs is a gcc-builtin.
<br/>
<br/>
#include &lt;math.h&gt; won't link in anything you don't use</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#24281 - f(DarkAngel) - Sat Jul 31, 2004 2:45 pm</h4>
    <div class="postbody"><span class="postbody">Another bad case for normal macro call would be abs(x++);<br/>_________________<br/>death scream...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#24342 - Miked0801 - Sun Aug 01, 2004 9:30 pm</h4>
    <div class="postbody"><span class="postbody">Lol - indeed :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#24686 - wintermute - Mon Aug 09, 2004 7:46 pm</h4>
    <div class="postbody"><span class="postbody">oh yeah, abs isn't in &lt;math.h&gt;
<br/>
<br/>
it's in &lt;stdlib.h&gt;</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
