<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>friendship and operator= - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>C/C++ > friendship and operator=</h2>
<div id="posts">
<div class="post">
    <h4>#13334 - sajiimori - Thu Dec 11, 2003 7:20 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void test();
<br/>
<br/>
class Base
<br/>
{
<br/>
  protected:
<br/>
    void f() {}
<br/>
    void operator+(int) {}
<br/>
    void operator=(int) {}
<br/>
};
<br/>
<br/>
class Derived : public Base
<br/>
{
<br/>
    friend void test();
<br/>
};
<br/>
<br/>
void test()
<br/>
{
<br/>
    Derived d;
<br/>
    d.f();
<br/>
    d + 5;
<br/>
    d = 2;    // this line doesn't compile
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
It says there's no match for the `Derived&amp; = int' operator.  Why would other protected methods work, but not operator=?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#13338 - MumblyJoe - Thu Dec 11, 2003 7:58 am</h4>
    <div class="postbody"><span class="postbody">Well I wont pretend to understand why you would want to hide an overloaded operator behind a protective shield, but I think your problem is based around the fact that op= is created by the compiler sometimes etc, and I think it may not inherit correctly, much like constructors dont inherit because it wouldnt make much sense for them to do so.
<br/>
<br/>
I changed your code to this to verify my theory:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">class Base
<br/>
{
<br/>
    public:
<br/>
    void f() {}
<br/>
    void operator+(int) {}
<br/>
    void operator=(int) {}
<br/>
};
<br/>
<br/>
class Derived : public Base
<br/>
{
<br/>
};
<br/>
<br/>
int main()
<br/>
{
<br/>
    Base b;
<br/>
    b = 2;
<br/>
<br/>
    Derived d;
<br/>
    d.f();
<br/>
    d + 5;
<br/>
    d = 2;
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
I get the exact same error as you (using a borland compiler), so it clearly has nothing to do with protected inheritance or friend declarations. I think the simple fact is that you have to do a new op= for each class that derives.<br/>_________________<br/><a class="postlink" href="http://www.hungrydeveloper.com" target="_blank">www.hungrydeveloper.com</a>
<br/>
Version 2.0 now up - guaranteed at least 100% more pleasing!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#13357 - sajiimori - Thu Dec 11, 2003 7:33 pm</h4>
    <div class="postbody"><span class="postbody">That's interesting...I agree that the only apparent difference between operator= and other operators is that the compiler sometimes generates a version of operator=.  But the only version it should generate is Type&amp; operator=(const Type&amp;) -- not e.g. void operator=(int) -- so I don't see why it shouldn't work.
<br/>
<br/>
Anyway, if it doesn't work on GCC or Borland, I guess it's pretty hopeless...
<br/>
<br/>
The reason I was hiding some operators is the same reason you would hide any other method -- I want to restrict access at compile-time.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#13389 - Sweex - Fri Dec 12, 2003 12:29 pm</h4>
    <div class="postbody"><span class="postbody">I don't think it's got anything to do with the friend relation. In most cases, the compiler provides an implementation of operator =. If you define your own in a base class the compiler realizes it should not create one but use the one that's defined.
<br/>
<br/>
As I see it, you cannot have two implementations of operator = because it cannot work out which one to use in all situations. You have an inherited (protected) operator = from class Base, and the compiler will create a default one for the class Derived.<br/>_________________<br/>If everything fails, read the manual: If even that fails, post on forum!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#13402 - sajiimori - Fri Dec 12, 2003 6:35 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
I don't think it's got anything to do with the friend relation.
<br/>
</td> </tr></table><span class="postbody">
<br/>
MumblyJoe has corrected me on that.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
In most cases, the compiler provides an implementation of operator =.
<br/>
</td> </tr></table><span class="postbody">
<br/>
It will provide an implementation of C&amp; operator=(const C&amp;) if you don't provide your own, but that's all.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
As I see it, you cannot have two implementations of operator = because it cannot work out which one to use in all situations.
<br/>
</td> </tr></table><span class="postbody">
<br/>
Of course you can.  This code works fine:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
struct C
<br/>
{
<br/>
    void operator=(int) { cout &lt;&lt; "int"; }
<br/>
    void operator=(char) { cout &lt;&lt; "char"; }
<br/>
    void operator=(double) { cout &lt;&lt; "double"; }
<br/>
};
<br/>
<br/>
void test()
<br/>
{
<br/>
    C c;
<br/>
    c = 5;
<br/>
    c = 'A';
<br/>
    c = 1.23;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
The compiler will give an error if there's an ambiguity, in which case you can be more explicit.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#13535 - Burton Radons - Tue Dec 16, 2003 6:26 am</h4>
    <div class="postbody"><span class="postbody">This is standard (<a class="postlink" href="http://www.csci.csusb.edu/dick/c++std/cd2/over.html#over.oper" target="_blank">over.oper</a>, paragraph 6).  Here's a quote:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>C++ draft standard, over.oper, paragraph 6 wrote:</b></span></td> </tr> <tr> <td class="quote">The meaning of the operators =, (unary) &amp;, and , (comma), predefined for each type, can be changed for specific class and enumeration types by defining operator functions that implement these operators.  Operator functions are inherited in the same manner as other base class functions, but because an instance of operator= is automatically constructed for each class (_class.copy_,  _over.ass_), operator= is never inherited by a class from its bases.</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#13540 - Sweex - Tue Dec 16, 2003 11:15 am</h4>
    <div class="postbody"><span class="postbody">Perhaps I should've written a bit more, sajiimori, as you're right that you can have multiple operator =. I meant two implementations of C&amp; operator=(const C&amp;), one in the base clas and one in the derived. 
<br/>
<br/>
Anyway, what Burton Radons says sounds right to me!<br/>_________________<br/>If everything fails, read the manual: If even that fails, post on forum!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#13562 - sajiimori - Tue Dec 16, 2003 7:35 pm</h4>
    <div class="postbody"><span class="postbody">Thanks!</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
