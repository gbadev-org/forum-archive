<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Checking memory - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>C/C++ > Checking memory</h2>
<div id="posts">
<div class="post">
    <h4>#9684 - DiscoStew - Wed Aug 13, 2003 8:52 pm</h4>
    <div class="postbody"><span class="postbody">Is there a way that I can check to see what is the first unused section of RAM at runtime on the GBA? Allocating a dynamic array of variables is supposedly slow, so I just want to get the address of the first unused section of memory. Is this possible?<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9689 - tepples - Wed Aug 13, 2003 11:19 pm</h4>
    <div class="postbody"><span class="postbody">Depending on your link script, your elf file should have a symbol with a name like 'ewram heap start'. To read the symbols in your elf file, provided you didn't link it with -s (which tells the linker to omit symbols), do <span style="font-weight: bold">nm -n <span style="font-style: italic">your elf file</span></span>. Look for the highest address matching 0x020##### to see which symbol your link script uses.
<br/>
<br/>
Dynamic memory allocation can be fast depending on the algorithm. The general-purpose malloc() included with newlib may be too slow or have too much fragmentation, but given the address of the start of the heap in EWRAM, you can write your own allocator.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9697 - Touchstone - Thu Aug 14, 2003 11:51 am</h4>
    <div class="postbody"><span class="postbody">Like tepples said, it's very much up to your linkerscript, but there is often a symbol called <span style="font-weight: bold">__bss_end__</span> and the address of that symbol is the first byte of RAM that is not allocated for variables.
<br/>
<br/>
When linking you can generate a map-file by passing <span style="font-weight: bold">-Map <span style="font-style: italic">mapfile name</span></span> to the linker. Find the BSS section in the generated mapfile (by looking for the line that starts with <span style="font-weight: bold">.bss</span>) and then look for the last symbol before the next segment section.
<br/>
<br/>
I don't know if there is an all-purpose solution to this problem so how you should solve it depends on if you are using linkerscripts and in that case, what they look like.<br/>_________________<br/>You can't beat our meat</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9699 - Sweex - Thu Aug 14, 2003 2:27 pm</h4>
    <div class="postbody"><span class="postbody">Just thought of the following, in line with this topic: Is it possible to detect the amount of free work memory (EWRAM?).
<br/>
<br/>
I currently subtract the number of bytes allocated by my own "new" function from 256k, but obviously this isn't too accurate.<br/>_________________<br/>If everything fails, read the manual: If even that fails, post on forum!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9704 - tepples - Thu Aug 14, 2003 4:45 pm</h4>
    <div class="postbody"><span class="postbody">Yes, you have the right idea: if you want to know how much free memory is left, keep track of free memory yourself.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9711 - DiscoStew - Thu Aug 14, 2003 6:19 pm</h4>
    <div class="postbody"><span class="postbody">Thx for the answer to my question, but now I've got another question.
<br/>
I check my small program, and it appears that if you don't set it, the 1st 32k of variables, arrays, etc. is set into IWRAM, since my ewram_heap_start starts at 0x02000000. How can I prevent anything from going into IWRAM, and setting specific things into IWRAM?<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9720 - tepples - Fri Aug 15, 2003 3:27 am</h4>
    <div class="postbody"><span class="postbody">If you're using Jeff F's link script (found in DevKit Advance), you can use attributes to put code and data in various sections. See <a class="postlink" href="http://www.devrs.com/gba/files/gbadevfaqs.php#IntRamCode" target="_blank">the relevant part of Jeff F's GBA FAQ</a>.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
