<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>my .gba works on emulator but not on the real hardware, ??? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>C/C++ > my .gba works on emulator but not on the real hardware, ???</h2>
<div id="posts">
<div class="post">
    <h4>#16517 - subatomic - Wed Feb 18, 2004 4:45 pm</h4>
    <div class="postbody"><span class="postbody">I have a C++ app compiled with gcc 3.3.2 (built from the toolchain Makefile at <a href="http://www.geocities.com/xgoatboyx/index.html" target="_blank">http://www.geocities.com/xgoatboyx/index.html</a>)
<br/>
<br/>
<br/>
This game works in VisualBoyAdvance but when I load it onto my flash cartridge, the actual GBA hardware only shows a white screen.  Also, none of the names or RAM sizes are set on the .gba like with other gba rom "backups"...
<br/>
<br/>
- Is there a checklist of things to look for, or things I need to do to my rom file to prepare it for real hardware?  Could it be some flag in crt0.s or lnkscript?  
<br/>
<br/>
- Also, how would I debug something like this?
<br/>
<br/>
- Possibly related...  how do I set up the cart parameters (RAM size, name, etc...) that I see onther carts have?
<br/>
<br/>
- Anyone have a demo that definately runs on the GBA I could look at?  
<br/>
<br/>
- I'm programming in C++, is there anything special about c++ that would make a difference?
<br/>
<br/>
<br/>
thanks!!!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#16518 - subatomic - Wed Feb 18, 2004 4:47 pm</h4>
    <div class="postbody"><span class="postbody">note... i'm using the EZF advance Realtime 256M flashcart...  and version 1.0 of their client.
<br/>
<br/>
I tried it with both multiROM enabled and without...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#16519 - poslundc - Wed Feb 18, 2004 5:19 pm</h4>
    <div class="postbody"><span class="postbody">I think you're going to have to post some code if you want us to be able to help with debugging it.
<br/>
<br/>
How simple a program is it? Try stripping away as many of the "extras" as you can (especially if you have things like interrupts running) and just try to get a simple program that works. That makes it much easier to isolate the piece of code that's causing problems for you.
<br/>
<br/>
All of the demos from <a class="postlink" href="http://www.danposluns.com/gbadev/" target="_blank">my website</a> should work with an EZ-Flash, and they are just compiled/linked with gcc; no fancy extras.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#16523 - qw3rty - Wed Feb 18, 2004 7:09 pm</h4>
    <div class="postbody"><span class="postbody">You could try fixing the .gba wit "gbafix.exe" and pad it to the next "legal" size...
<br/>
I once had a similar problem, and fixing the bin did the trick...
<br/>
(although in most cases this isn't necessary...)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#16525 - Blacken - Wed Feb 18, 2004 10:15 pm</h4>
    <div class="postbody"><span class="postbody">Emulators are frequently more forgiving code-wise than the GBA hardware itself. Don't try to be too fancy for what you're doing. ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#16529 - subatomic - Thu Feb 19, 2004 12:04 am</h4>
    <div class="postbody"><span class="postbody">thanks for the tips...  maybe gbafix will work, i'll try when I get home tonight....
<br/>
<br/>
it looks like gbafix does some things I didn't know I had to do in my source...
<br/>
<br/>
- is there a doc I can read on how to set up my source to compile with the appropriate header info?  all I do is compile with crt0.s (v1.28 from JF) as the first .o file.  then link with same version lnkscript... then use objcopy.
<br/>
<br/>
I'm assuming maybe I should have special data in the code to set up the header info?   or maybe we're all supposed to use gbafix.exe?  I also dont pad my rom file... it's about 200k total...
<br/>
<br/>
anyway, send me reading material, i'd like to RTFM - i just haven't seen anything on gbadev.org or on <a href="http://www.devrs.com/gba/...." target="_blank">http://www.devrs.com/gba/....</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#16530 - subatomic - Thu Feb 19, 2004 12:10 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Blacken wrote:</b></span></td> </tr> <tr> <td class="quote">Emulators are frequently more forgiving code-wise than the GBA hardware itself. Don't try to be too fancy for what you're doing. ;)</td> </tr></table><span class="postbody">
<br/>
<br/>
I figured as much.  :)   well, I'm using c++, which seems more fancy than anyone's examples...  though it's pretty simple so far.   I also tried slideshow from <a href="http://www.geocities.com/xgoatboyx/index.html," target="_blank">http://www.geocities.com/xgoatboyx/index.html,</a> didn't work either, and it seems to be really simple.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#16531 - subatomic - Thu Feb 19, 2004 12:23 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">I think you're going to have to post some code if you want us to be able to help with debugging it.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I may do that later, but for now I just wanted to make sure I understood all the setup requirements for creating a proper rom file for use on the hardware.  
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
How simple a program is it? 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
not very, though if gbafix doesn't work I'll be stripping it down. :)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Try stripping away as many of the "extras" as you can (especially if you have things like interrupts running) and just try to get a simple program that works. That makes it much easier to isolate the piece of code that's causing problems for you.
<br/>
</td> </tr></table><span class="postbody">
<br/>
I planned to.  was just looking for a troubleshooting guide/FAQ, and/or document explaining how to setup the rom's header (other than GBAFIX)...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
All of the demos from <a class="postlink" href="http://www.danposluns.com/gbadev/" target="_blank">my website</a> should work with an EZ-Flash, and they are just compiled/linked with gcc; no fancy extras.
<br/>
<br/>
Dan.</td> </tr></table><span class="postbody">
<br/>
awsome.  I'll compare mine to yours.  thanks for the link.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#16532 - tepples - Thu Feb 19, 2004 12:25 am</h4>
    <div class="postbody"><span class="postbody">Padding a ROM file shouldn't affect whether it works on a flash cart. Flash writer programs will do any padding needed for the particular cart.
<br/>
<br/>
All Gbafix does is add a valid header including the 156 Byte Magic Cookie. If you see "GAME BOY" across the top of the screen and "Nintendo" across the bottom, you have a valid header. Many flash writer programs will correct the header for you.
<br/>
<br/>
If you get a white screen after the "GAME BOY" logo, then you have a bug in your code.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#16538 - subatomic - Thu Feb 19, 2004 2:51 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Padding a ROM file shouldn't affect whether it works on a flash cart. Flash writer programs will do any padding needed for the particular cart.
<br/>
<br/>
All Gbafix does is add a valid header including the 156 Byte Magic Cookie. If you see "GAME BOY" across the top of the screen and "Nintendo" across the bottom, you have a valid header. Many flash writer programs will correct the header for you.
<br/>
<br/>
If you get a white screen after the "GAME BOY" logo, then you have a bug in your code.</td> </tr></table><span class="postbody">
<br/>
<br/>
I get "GAME BOY", but the nintendo is garbled...  it's a block of noise instead of the word "nintendo"...   then I do get a white screen after that goes away...  i'll check the code.
<br/>
<br/>
Is the "valid header" written using the arm-thumb gcc crt0/lnkscript?  or should I have done something in code? (i'm not)...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#16539 - poslundc - Thu Feb 19, 2004 3:06 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>subatomic wrote:</b></span></td> </tr> <tr> <td class="quote">I get "GAME BOY", but the nintendo is garbled...  it's a block of noise instead of the word "nintendo"...   then I do get a white screen after that goes away...</td> </tr></table><span class="postbody">
<br/>
<br/>
Oh crikey, the physical connection is probably just dirty. I get that happening all the time. Try blowing into the cartridge, the GBA and the linker to clear any dust out. Reformat your cartridge and try again.
<br/>
<br/>
If you're still running into problems, dip a q-tip into rubbing alcohol and gently clean the contacts off on all three units.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#16540 - tepples - Thu Feb 19, 2004 3:16 am</h4>
    <div class="postbody"><span class="postbody">If the "Nintendo" is garbled, it's most likely a header problem. (If the cart was dirty, you probably wouldn't even get a garbled mess because the checksum on the rest of the header wouldn't check out.)<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#16541 - dagamer34 - Thu Feb 19, 2004 3:31 am</h4>
    <div class="postbody"><span class="postbody">Since you are using the EZFA client, I have specific help for you.
<br/>
<br/>
If you put on a ROM with MultiROM enabled, the GBA doesn't know that your ROM has a bad header, it doesn't even check it. However, if you don't have MultiROM enabled, then it is as if its a real ROM, it does header checking on the ROM itself.
<br/>
<br/>
But the EZFA client software should automatically patch the ROM for a correct header anyway.<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#16542 - poslundc - Thu Feb 19, 2004 4:16 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">If the "Nintendo" is garbled, it's most likely a header problem. (If the cart was dirty, you probably wouldn't even get a garbled mess because the checksum on the rest of the header wouldn't check out.)</td> </tr></table><span class="postbody">
<br/>
<br/>
I get this happening all the time as a result of cartridge dirt... the "Gameboy" appears just fine but the "Nintendo" is a garbled mess.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#16543 - DekuTree64 - Thu Feb 19, 2004 4:32 am</h4>
    <div class="postbody"><span class="postbody">I tried flashing a ROM with MultiROM turned off yesterday and got a garbled Nintendo. Then I tried it with MultiROM and it worked fine. I think it is the header, and the EZF client does bypass the checking when you start a ROM from the loader menu. So try it with MultiROM, or try a header editing utility.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#16551 - FluBBa - Thu Feb 19, 2004 1:49 pm</h4>
    <div class="postbody"><span class="postbody">If you want your GBA emulator to behave more like a real GBA hunt down a (or dump your own) BIOS and use with the emu.<br/>_________________<br/>I probably suck, my not is a programmer.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#16554 - poslundc - Thu Feb 19, 2004 3:50 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>FluBBa wrote:</b></span></td> </tr> <tr> <td class="quote">If you want your GBA emulator to behave more like a real GBA hunt down a (or dump your own) BIOS and use with the emu.</td> </tr></table><span class="postbody">
<br/>
<br/>
That only would make any difference for the BIOS system calls, which aren't typically a source of errors between emulation and hardware. Much more likely to be a source of problems is the inaccurate timing of waitstates in emulation and any incorrect handling of ISRs in the code (which I've found emulation to be more forgiving about).
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#16603 - FluBBa - Fri Feb 20, 2004 2:29 pm</h4>
    <div class="postbody"><span class="postbody">Yes it's mostly for SWI's and such but also as in this case the checking of the GBA header.<br/>_________________<br/>I probably suck, my not is a programmer.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19756 - notb4dinner - Sun Apr 25, 2004 1:57 am</h4>
    <div class="postbody"><span class="postbody">Although in your case it sounds like a header problem, something else I've just come across something alse that can cause a program to behave differently on hardware and an emulator is reading uninitialised RAM.  Visualboy Advance seems to initialise all it's RAM to 0 (ie. NULL) while the hardware's is in an undefined state to begin with.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19757 - poslundc - Sun Apr 25, 2004 2:09 am</h4>
    <div class="postbody"><span class="postbody">The crt0.o that is compiled/linked with your program zeros all memory on initialization, ie. before your program launches.
<br/>
<br/>
I have also heard that the GBA automatically zeros all memory when it is turned on, although I have not confirmed this.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19766 - torne - Sun Apr 25, 2004 10:38 am</h4>
    <div class="postbody"><span class="postbody">I'm fairly sure that on poweron, the GBA does the equivalent of SWI 1 with r0 set to 255 before it boots, which will clear all IO registers, memory..etc. I've not checked this, though..</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19820 - notb4dinner - Mon Apr 26, 2004 2:58 am</h4>
    <div class="postbody"><span class="postbody">Interesting... that's not the behaviour I was observing but I could very well have been confused.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19837 - FluBBa - Mon Apr 26, 2004 3:08 pm</h4>
    <div class="postbody"><span class="postbody">VBAs emulation of the SWIs is not perfect, it fails to initialize some regs at least when using the reset functions.
<br/>
A real GBA clears all memory and resets all HW registers before your program gets the control.
<br/>
Edit: a possible explanation for the wierd behaviour in that the GBA not reseting everything might be your bootmenu (ROM menu, pogoshell...).<br/>_________________<br/>I probably suck, my not is a programmer.</span><span class="gensmall"><br/><br/>Last edited by FluBBa on Tue Apr 27, 2004 11:02 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#19853 - dagamer34 - Mon Apr 26, 2004 10:30 pm</h4>
    <div class="postbody"><span class="postbody">One example of VBA's almost perfect SWI emulation is calling the RegisterRamReset swi (0x01). Real hardware will turn off all backgrounds, set the mode to 0, and set the force blank bit, whereas VBAs internal bios does none of that.<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
