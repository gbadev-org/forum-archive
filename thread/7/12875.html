<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Large compiled binary - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>C/C++ > Large compiled binary</h2>
<div id="posts">
<div class="post">
    <h4>#123823 - tyraen - Sat Mar 31, 2007 4:39 pm</h4>
    <div class="postbody"><span class="postbody">So I've been working on a DSO plugin in C++.  Using --no-rtti and --no-exceptions (as someone had mentioned here previously) the filesize after compiling was around 20kb.  In recent builds it has jumped up to 80kb, and I'm having trouble understanding why.  Maybe it's an unavoidable issue now (not that it's much of an issue).  The major change I've made recently was creating an interface class and a few others that implemented it.  Maybe this is a hard question to address without seeing code, but does anyone have any thoughts?
<br/>
<br/>
Thanks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123824 - tepples - Sat Mar 31, 2007 4:59 pm</h4>
    <div class="postbody"><span class="postbody">If you haven't been using stdio, then any pure virtual methods will bring in printf(), which brings in both the stdio library and the floating-point library.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123827 - tyraen - Sat Mar 31, 2007 5:26 pm</h4>
    <div class="postbody"><span class="postbody">Ouch, ok.  I don't really know a ton about C++, heh.  Does it... have to bring those in? :)  Why does it use those?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123829 - tyraen - Sat Mar 31, 2007 5:33 pm</h4>
    <div class="postbody"><span class="postbody">Yup, changing to non-pure functions brought the size back down a ways.  It's not going to kill me to keep them this way but I'd prefer pure virtual...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123839 - tepples - Sat Mar 31, 2007 7:01 pm</h4>
    <div class="postbody"><span class="postbody">Is there a place where I could browse the source code of libstdc++ and libsupc++ online so that I could investigate the inner workings of __cxa_pure_virtual (which prints an error message when a pure virtual function is called) without having to download and extract the entire libstdc++ source code?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123840 - tyraen - Sat Mar 31, 2007 7:11 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for the help tepples.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123862 - gmiller - Sun Apr 01, 2007 12:09 am</h4>
    <div class="postbody"><span class="postbody">for thinks about gcc there is <a href="http://gcc.gnu.org/wiki." target="_blank">http://gcc.gnu.org/wiki.</a>  I am not sure the libstdc++ stuff is there since I do not use C++ much.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123874 - tepples - Sun Apr 01, 2007 1:57 am</h4>
    <div class="postbody"><span class="postbody">I found <a class="postlink" href="http://src.opensolaris.org/source/xref/sfw/usr/src/cmd/gcc/gcc-3.4.3/libstdc++-v3/libsupc++/" target="_blank">browsable libsupc++</a> and am looking through it, just for kicks.
<br/>
<br/>
From <a class="postlink" href="http://src.opensolaris.org/source/xref/sfw/usr/src/cmd/gcc/gcc-3.4.3/libstdc++-v3/libsupc++/pure.cc" target="_blank">pure.cc</a>:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">extern "C" void __cxa_pure_virtual (void)
<br/>
{
<br/>
  std::fputs("pure virtual method called\n", stderr);
<br/>
  std::terminate();
<br/>
}</td> </tr></table><span class="postbody">
<br/>
fputs() brings in &lt;cstdio&gt; and the devoptab.
<br/>
<br/>
From <a class="postlink" href="http://src.opensolaris.org/source/xref/sfw/usr/src/cmd/gcc/gcc-3.4.3/libstdc++-v3/libsupc++/eh_terminate.cc" target="_blank">eh_terminate.cc</a> and <a class="postlink" href="http://src.opensolaris.org/source/xref/sfw/usr/src/cmd/gcc/gcc-3.4.3/libstdc++-v3/libsupc++/eh_term_handler.cc" target="_blank">eh_term_handler.cc</a>, I determine that std::terminate() calls <a class="postlink" href="http://src.opensolaris.org/source/xref/sfw/usr/src/cmd/gcc/gcc-3.4.3/libstdc++-v3/libsupc++/vterminate.cc#__verbose_terminate_handler" target="_blank">__verbose_terminate_handler()</a> (which brings in exception support, the name demangler, and malloc/free) followed by abort(). In turn, <a class="postlink" href="http://sourceware.org/cgi-bin/cvsweb.cgi/src/newlib/libc/stdlib/abort.c?cvsroot=src" target="_blank">abort()</a> brings in write() (and thus the devoptab handler).
<br/>
<br/>
So it appears you can use pure virtual functions without a big size penalty by writing your own replacement for __cxa_pure_virtual().<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
