<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>DSWIFI  Lib with WEP 128 bits  support - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > DSWIFI  Lib with WEP 128 bits  support</h2>
<div id="posts">
<div class="post">
    <h4>#108533 - Hermes - Thu Nov 09, 2006 11:09 pm</h4>
    <div class="postbody"><span class="postbody">Hi.
<br/>
<br/>
I have finded a little bug in the dswifilib that it did not allow me to connect by WEP 128 bits, 13 bytes ascii and i post the modified fucntion in wifi_arm7.c
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void Wifi_SetWepMode(int wepmode) {
<br/>
   if(wepmode&lt;0 || wepmode&gt;7) return;
<br/>
   if(wepmode==0) {
<br/>
      WIFI_REG(0x32)=0x0000;
<br/>
   } else {
<br/>
      WIFI_REG(0x32)=0x8000;
<br/>
   }
<br/>
   if(wepmode==0) wepmode=1;
<br/>
   wepmode&amp;=~4; /* 0-&gt;no wep, 1-&gt; 64 bits (5 chr), 2-&gt; 128 bits (13 chr) 3-&gt;128 bits (16 chr)*/
<br/>
   W_MODE_WEP = (W_MODE_WEP &amp; 0xFFC7) | (wepmode&lt;&lt;3);
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
As you can see, only change the line: wepmode&amp;=~4;
<br/>
<br/>
In my test i can see if you put the value 1, it work under WEP 64 bits, 5 chars and if you put the value 2, it work under WEP 128 bytes, 13 chars
<br/>
<br/>
Here the table of values (without my modification):
<br/>
<br/>
<br/>
0-&gt; no WEEP
<br/>
1-&gt; 64 bit, 5 chars
<br/>
2-&gt; 128 bits, 13 chars
<br/>
3-&gt; I think 128 bits, 16 chars
<br/>
4-&gt; unknown for me
<br/>
5-&gt; 64bits, 5 chars
<br/>
6-&gt; fail 
<br/>
7-&gt; 64 bits, 5 chars
<br/>
<br/>
So you can see it is a good idea set to 0 this bit ;)
<br/>
<br/>
I am using the Nintendo Wifi USB Conector, modified to be an AP</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#108619 - Xgame - Fri Nov 10, 2006 3:42 pm</h4>
    <div class="postbody"><span class="postbody">I have a 3com access point wich work with game but dosen't work with homebrew(it has a 128-bit WEP). I'll try your stuff now!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#108621 - OOPMan - Fri Nov 10, 2006 3:46 pm</h4>
    <div class="postbody"><span class="postbody">Have you mentioned this bug to sgstair?
<br/>
<br/>
I'll check and if not, let him know :-)<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#108698 - Hermes - Sat Nov 11, 2006 10:56 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>OOPMan wrote:</b></span></td> </tr> <tr> <td class="quote">Have you mentioned this bug to sgstair?
<br/>
<br/>
I'll check and if not, let him know :-)</td> </tr></table><span class="postbody">
<br/>
<br/>
No. If you can contact with sgstair send this modification, but i think is a good idea post here this question for all the developers ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#108699 - OOPMan - Sat Nov 11, 2006 10:58 am</h4>
    <div class="postbody"><span class="postbody">Indeed, thanks for posting :-)
<br/>
<br/>
I'll try and drop sgstair a line later today and point him in the direction of this forum thread.<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#108923 - sgstair - Mon Nov 13, 2006 4:21 am</h4>
    <div class="postbody"><span class="postbody">"So you can see it is a good idea set to 0 this bit ;)"
<br/>
<br/>
Wait, what? how is it a good idea to clear that bit? it doesn't change anything at all, except prevent the user from specifying other undocumented WEP modes (which DO exist, 3 and 4 are valid WEP modes, though not the ones you're predicting)
<br/>
<br/>
if you pass in a 1 or 2, for 64bit/128bit wep, it will work just as well if you don't clear that bit... I fail to see how that changes anything. :\
<br/>
<br/>
-Stephen<br/>_________________<br/><a class="postlink" href="http://blog.akkit.org/" target="_blank">http://blog.akkit.org/</a> - <a class="postlink" href="http://www.akkit.org/dswifi/" target="_blank">http://www.akkit.org/dswifi/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#108981 - Hermes - Mon Nov 13, 2006 8:58 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sgstair wrote:</b></span></td> </tr> <tr> <td class="quote">"So you can see it is a good idea set to 0 this bit ;)"
<br/>
<br/>
Wait, what? how is it a good idea to clear that bit? it doesn't change anything at all, except prevent the user from specifying other undocumented WEP modes (which DO exist, 3 and 4 are valid WEP modes, though not the ones you're predicting)
<br/>
<br/>
if you pass in a 1 or 2, for 64bit/128bit wep, it will work just as well if you don't clear that bit... I fail to see how that changes anything. :\
<br/>
<br/>
-Stephen</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
Hummm, you read the WFC data from the flash, ok? When you connect using WFC datas, you use the WIFI connection settings.
<br/>
<br/>
In the wiki page you can see this info:
<br/>
<br/>
<a href="http://www.bottledlight.com/ds/index.php/Firmware/UserSettings" target="_blank">http://www.bottledlight.com/ds/index.php/Firmware/UserSettings</a>
<br/>
<br/>
<br/>
In the 0xE6 offset resides  the WEP Mode info (you are using this data as argument for the Wifi_SetWepMode())
<br/>
<br/>
Well, WEP data for 128 bits, ASCII is 0x6. If you don't clear the bit, it fail.
<br/>
<br/>
So you decide: it is a bug or not, but it fail and it is very easy to resolve this problem.
<br/>
<br/>
PD: I can see that it has not been good idea to comment this failure here. Not problem, it is the last time i post mentioning a problem :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#108982 - Mighty Max - Mon Nov 13, 2006 9:18 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Hermes wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
PD: I can see that it has not been good idea to comment this failure here. Not problem, it is the last time i post mentioning a problem :(</td> </tr></table><span class="postbody">
<br/>
<br/>
Oh comeone, don't get snappy.
<br/>
<br/>
We all make errors, and doint the bitmask in SetWepMode is one. The caller is in duty to select the wep mode it really wants, not SetWepMode to "guess" what the caller meant to say.
<br/>
<br/>
To fix this problem of different mode indizes in the save and the actual hardware, is has to be in the save-parser.
<br/>
<br/>
One might actually want to set one of the reserved modes and would be stuck in "wtf?!" state if it doesnt do what it sais ;)<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#108984 - OOPMan - Mon Nov 13, 2006 9:24 pm</h4>
    <div class="postbody"><span class="postbody">If you think you've found a bug you should ALWAYS mention it, even if you're not sure. 
<br/>
<br/>
If it is a bug, then it can be fixed and people are happy that it's been fixed.
<br/>
<br/>
If it's not a bug then you've still learned something.
<br/>
<br/>
So please continue to post stuff Hermes...
<br/>
<br/>
I suspect that, in this case, the English-Spanish divide may be mangling what Hermes is trying to say...<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#108988 - Hermes - Mon Nov 13, 2006 9:52 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>OOPMan wrote:</b></span></td> </tr> <tr> <td class="quote">If you think you've found a bug you should ALWAYS mention it, even if you're not sure. 
<br/>
<br/>
If it is a bug, then it can be fixed and people are happy that it's been fixed.
<br/>
<br/>
If it's not a bug then you've still learned something.
<br/>
<br/>
So please continue to post stuff Hermes...
<br/>
<br/>
I suspect that, in this case, the English-Spanish divide may be mangling what Hermes is trying to say...</td> </tr></table><span class="postbody">
<br/>
<br/>
I have problems to understand some words in english, of course, but i have the the impression that sgtair has answered to me 'outside of tone' 
<br/>
<br/>
If he think that it is strange  i clear this bit,  he can ask to me and I can try an better explanation
<br/>
<br/>
The problem exist but it is possible to fix  in other point. The standard modes for NDS WIFI is in the Wiki info and i can see if for example, you put 0x7 mode (128 bits, 16 ASCII) it work from my AP as 64 bits 5 ASCII WEP mode).  
<br/>
<br/>
From the WFC, when i connect  using the WFC datas, it put the 0x5 value, and it connect to my AP as 64 bits  5 ASCII and 0x6 value don't work
<br/>
<br/>
So, it is very easy to think  if you set this bit to 0, it work correctly (and works)
<br/>
<br/>
It change 5 to 1 (64 bits) and 6  to 2 (128, 13 chr) and 7 to 3 (easy to think it is 128 bits 16 chr). 
<br/>
<br/>
if you set 4, it is a not standard value, so it don't have to much sense support  this mode,  and sets  5 and 7 work in the same way as 1 (in my AP) and 6 don't work as 128 bits and 13 chr</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#108992 - Lick - Mon Nov 13, 2006 10:08 pm</h4>
    <div class="postbody"><span class="postbody">I think he's trying to say this: the 0-7 values are used by software, but when talking to the hardware, you have to convert it to 0-3, by masking.
<br/>
Software will be able to distinguish between more properties (0-7). Think Connection Setup textbox behavior. But the hardware doesn't care (0-3). It only cares about the number of characters in the password?
<br/>
<br/>
In other words, W_MODE_WEP takes a 2bit WEP mode, derived from the 3bit value.
<br/>
<br/>
This might be wrong, but it's how I interpret his explanation.
<br/>
- Lick<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#108994 - Hermes - Mon Nov 13, 2006 10:26 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lick wrote:</b></span></td> </tr> <tr> <td class="quote">I think he's trying to say this: the 0-7 values are used by software, but when talking to the hardware, you have to convert it to 0-3, by masking.
<br/>
Software will be able to distinguish between more properties (0-7). Think Connection Setup textbox behavior. But the hardware doesn't care (0-3). It only cares about the number of characters in the password?
<br/>
<br/>
In other words, W_MODE_WEP takes a 2bit WEP mode, derived from the 3bit value.
<br/>
<br/>
This might be wrong, but it's how I interpret his explanation.
<br/>
- Lick</td> </tr></table><span class="postbody">
<br/>
<br/>
Yes! :D 
<br/>
<br/>
If sgstair knows  setting 4  here works, may be it can be changed to:
<br/>
<br/>
if(wepmode&gt;4) wepmode-=4;
<br/>
<br/>
Sorry, if i cannot explain it correctly :$</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#108996 - sgstair - Mon Nov 13, 2006 10:39 pm</h4>
    <div class="postbody"><span class="postbody">Re: Hermes:
<br/>
Yes, I did answer a bit harshly, sorry - I do see what you're talking about now.  However, modifying that function is very much not the best way to solve the problem - the best way is to change the wep mode used by the AP record before the system requests that WEP mode, it's never a good idea to limit the options that the hardware can accept by modifying the end function like that. The 2 places where this would be best to do are either in Wifi_AssocStatus() on arm9, or GetWfcSettings() on arm7.
<br/>
The reason that this hasn't been done yet is because I haven't had the time to explore all of the WEP key modes yet, so I haven't supported them all. (but it works for hex keys so I haven't exactly changed it :)
<br/>
<br/>
-Stephen
<br/>
PS: there is no 128 bit / 16 chr mode - but other wep modes are supported...
<br/>
PPS: If you're sure the modes 5 / 6 are the ascii 64 / 128bit wep modes, I can modify the lib to handle them properly.<br/>_________________<br/><a class="postlink" href="http://blog.akkit.org/" target="_blank">http://blog.akkit.org/</a> - <a class="postlink" href="http://www.akkit.org/dswifi/" target="_blank">http://www.akkit.org/dswifi/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#108997 - Lick - Mon Nov 13, 2006 10:40 pm</h4>
    <div class="postbody"><span class="postbody">W_MODE_WEP = (W_MODE_WEP &amp; 0xFFC7) | (<span style="font-weight: bold">(wepmode&amp;3)</span> &lt;&lt; 3); 
<br/>
<br/>
This should work as well. ;)<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#108998 - sgstair - Mon Nov 13, 2006 10:46 pm</h4>
    <div class="postbody"><span class="postbody">Lick:
<br/>
You're halfway right- what he's meaning is the WFC data's value for the "wep mode" doesn't think bit 2 is important. Please do not confuse this with the idea that "the hardware doesn't need that bit" - it is my philosophy to never limit the hardware like that unless absolutely necessary - the clearing of bit 2 should be done of the side dealing with the WFC data, not the side talking to the hardware. For example - I do know that WEP modes 3 and 4 are valid and potentially useful modes; were I to apply the fix suggested here, it would be impossible to use WEP mode 4, even though it's a valid hardware mode (either 256bit or 320bit WEP if my memory serves correctly)
<br/>
That's what got me all excited, the modification seemed to break things without any indication of being helpful. (I see now what was meant though, just that problem should be addressed elsewhere in the code)
<br/>
<br/>
-Stephen<br/>_________________<br/><a class="postlink" href="http://blog.akkit.org/" target="_blank">http://blog.akkit.org/</a> - <a class="postlink" href="http://www.akkit.org/dswifi/" target="_blank">http://www.akkit.org/dswifi/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109000 - Lick - Mon Nov 13, 2006 10:56 pm</h4>
    <div class="postbody"><span class="postbody">Oh I see, I thought that the first two bits were the same and the third bit flagged some setting like 64bit/128bit. I see my mistake now.
<br/>
<br/>
Thanks!
<br/>
- Lick<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109006 - Hermes - Tue Nov 14, 2006 12:05 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sgstair wrote:</b></span></td> </tr> <tr> <td class="quote">Re: Hermes:
<br/>
Yes, I did answer a bit harshly, sorry - I do see what you're talking about now.  However, modifying that function is very much not the best way to solve the problem - the best way is to change the wep mode used by the AP record before the system requests that WEP mode, it's never a good idea to limit the options that the hardware can accept by modifying the end function like that. The 2 places where this would be best to do are either in Wifi_AssocStatus() on arm9, or GetWfcSettings() on arm7.
<br/>
The reason that this hasn't been done yet is because I haven't had the time to explore all of the WEP key modes yet, so I haven't supported them all. (but it works for hex keys so I haven't exactly changed it :)
<br/>
<br/>
-Stephen
<br/>
PS: there is no 128 bit / 16 chr mode - but other wep modes are supported...
<br/>
PPS: If you're sure the modes 5 / 6 are the ascii 64 / 128bit wep modes, I can modify the lib to handle them properly.</td> </tr></table><span class="postbody">
<br/>
<br/>
Don't worry sgstair :D
<br/>
<br/>
i am sure 0x5 and 0x7 modes work as 64 bits 5 chars in my AP. I have tested it.
<br/>
<br/>
the best solution:
<br/>
<br/>
if(wepmode&gt;4) wepmode-=4; 
<br/>
<br/>
But also can be:
<br/>
<br/>
WifiData-&gt;wfc_enable[c] = 0x80 | (data[0xE6]&amp;0x03);
<br/>
<br/>
You decide :D
<br/>
<br/>
I have made other change in the ARM7 code:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
void Wifi_Init(u32 wifidata) {
<br/>
   WifiData = (Wifi_MainStruct *)wifidata;
<br/>
<br/>
    InitFlashData(); // &lt;- InitFlash here
<br/>
<br/>
   POWERCNT7 |= 2; // enable power for the wifi
<br/>
   *((volatile u16 *)0x04000206) = 0x30; // ???
<br/>
<br/>
   // reset/shutdown wifi:
<br/>
   WIFI_REG(0x4)=0xffff;
<br/>
   Wifi_Stop();
<br/>
   Wifi_Shutdown(); // power off wifi
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
It is because in Wifi_Shutdown(), you read a byte using ReadFlashByte()  so:
<br/>
<br/>
if(ReadFlashByte(0x40)!=3) {
<br/>
		Wifi_RFWrite(0xC008);
<br/>
	}
<br/>
<br/>
And i think it is to 0, if you are calling to the InitFlashData() function after.
<br/>
<br/>
<br/>
PD: In my next release of eSound and Multithread libs, i include the source code of your WIFI library 3.0A (i have integrated the lib in my ARM7 code). I hope you see this with good eyes. You have made a good work ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109009 - Mighty Max - Tue Nov 14, 2006 12:25 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Hermes wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
i am sure 0x5 and 0x7 modes work as 64 bits 5 chars in my AP. I have tested it.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Which one?
<br/>
You tested what the WFC_wep_modes stand for if i read you right
<br/>
<br/>
But a WFC_wep_mode might not be a valid HW_wep_mode and vice versa. 
<br/>
<br/>
Its like WFC talking spanish and the HW english. There are words that are nearly the same for both, but also words that sounds nearly the same that have a complete different meaning.
<br/>
<br/>
You need a knowing translator to solve that problem. Here: you got to fix the autoconnect translating the WFC setting into HW modes.
<br/>
<br/>
The hardware does i.e. not need to know how the wepcode is represented to the user, it just takes it bytes. Therefor the ascii and the hex modes of  wfc translate into the very same hw mode.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109015 - Hermes - Tue Nov 14, 2006 1:21 am</h4>
    <div class="postbody"><span class="postbody">Usually, when you use the WFC datas the mode is 0x5 for 64 bits 5 chars and it work as mode 0x1 
<br/>
<br/>
if you set mode 0x7, it connect as 64 bit too. I have connected my utility Wifiloader in this moment with mode 0x7 (forced), with my AP in WEP 64 bits ;) (when i say it connect to 64 bits, it is because i am test it !)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109029 - sgstair - Tue Nov 14, 2006 6:16 am</h4>
    <div class="postbody"><span class="postbody">Well, there's one critical piece of information you haven't given - under what conditions does say mode 0x07 appear naturally, without you setting the mode? is it an AOSS mode, or something similar? Mapping all of the available modes to what they do is the step that has kept me from properly fixing the lib's behavior re: WFC data to begin with.
<br/>
<br/>
Also, Hermes, you still don't seem to get it - Mighty Max is the most clear about explaining it so far - the wep modes you're talking about are the WFC modes, and you're wanting to modify a function that sets a hardware mode - which evidently isn't compatible. I will be doing the translation in Wifi_AssocStatus (arm9) when I get around to adding it, as this leaves the most room for flexibility.
<br/>
<br/>
-Stephen<br/>_________________<br/><a class="postlink" href="http://blog.akkit.org/" target="_blank">http://blog.akkit.org/</a> - <a class="postlink" href="http://www.akkit.org/dswifi/" target="_blank">http://www.akkit.org/dswifi/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109035 - Lick - Tue Nov 14, 2006 8:11 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Hermes wrote:</b></span></td> </tr> <tr> <td class="quote">I have made other change in the ARM7 code:
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void Wifi_Init(u32 wifidata) {
<br/>
   WifiData = (Wifi_MainStruct *)wifidata;
<br/>
<br/>
    InitFlashData(); // &lt;- InitFlash here
<br/>
<br/>
   POWERCNT7 |= 2; // enable power for the wifi
<br/>
   *((volatile u16 *)0x04000206) = 0x30; // ???
<br/>
<br/>
   // reset/shutdown wifi:
<br/>
   WIFI_REG(0x4)=0xffff;
<br/>
   Wifi_Stop();
<br/>
   Wifi_Shutdown(); // power off wifi
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
It is because in Wifi_Shutdown(), you read a byte using ReadFlashByte()  so:
<br/>
<br/>
if(ReadFlashByte(0x40)!=3) {
<br/>
		Wifi_RFWrite(0xC008);
<br/>
	}
<br/>
<br/>
And i think it is to 0, if you are calling to the InitFlashData() function after.
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
<br/>
I'm interested in this one, as it seems that this might cause the bug that I have when running a DSWifi enabled application twice without powering off. Perhaps this is the point where the full reset isn't completed.<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109049 - sgstair - Tue Nov 14, 2006 1:44 pm</h4>
    <div class="postbody"><span class="postbody">Granted, having the InitFlashData() earlier is probably a good idea, ultimately though it probably won't change anything.
<br/>
The actual reset is 'WIFI_REG(0x4)=0xffff;', which quite completely and utterly resets the wifi hardware's internal state, after which all the registers are set up.
<br/>
<br/>
-Stephen<br/>_________________<br/><a class="postlink" href="http://blog.akkit.org/" target="_blank">http://blog.akkit.org/</a> - <a class="postlink" href="http://www.akkit.org/dswifi/" target="_blank">http://www.akkit.org/dswifi/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109342 - pepsiman - Fri Nov 17, 2006 12:58 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sgstair wrote:</b></span></td> </tr> <tr> <td class="quote">PPS: If you're sure the modes 5 / 6 are the ascii 64 / 128bit wep modes, I can modify the lib to handle them properly.</td> </tr></table><span class="postbody">
<br/>
<a href="http://www.bottledlight.com/ds/index.php/Firmware/UserSettings" target="_blank">http://www.bottledlight.com/ds/index.php/Firmware/UserSettings</a>
<br/>
<br/>
WEP mode (0: disabled, 1: 5 byte hex WEP, 2: 13 byte hex WEP, 3: 16 byte hex WEP, 5: 5 byte ascii WEP, 6: 13 byte ascii WEP, 7: 16 byte ascii WEP</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109462 - gl0b - Sat Nov 18, 2006 1:42 pm</h4>
    <div class="postbody"><span class="postbody">If wep 128bits code bugs, you can also enter the password in hex instead of ASCII. I was looking for this solution during months!<br/>_________________<br/>----!-----
<br/>
<br/>
<a class="postlink" href="http://saiminbot.blog8.fc2.com/blog-entry-29.html" target="_blank">Next generation DS</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
