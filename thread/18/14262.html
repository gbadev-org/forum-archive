<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>VRAM Mapping for Sprites in Main Screen - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > VRAM Mapping for Sprites in Main Screen</h2>
<div id="posts">
<div class="post">
    <h4>#142025 - conejoroy - Wed Oct 03, 2007 10:27 am</h4>
    <div class="postbody"><span class="postbody">Hello ^^!
<br/>
<br/>
It is possible to assign VRAM banks B, E and F (208 Kb) to main sprites? I mean... they can work all together? I was thinking on this allocations:
<br/>
<br/>
VRAM_E: 0x06400000 to 0x0640FFFF (well its fixed anyway =p)
<br/>
VRAM_F: 0x06410000 to 0x06413FFF
<br/>
VRAM_B: 0x06420000 to 0x0643FFFF
<br/>
<br/>
but it leaves a "black hole" between 0x06413FFF and 0x06420000 (48kb)
<br/>
<br/>
is it possible to use this arrangement (of course without addressing sprites in that undefined offset)?. I know maybe it's weird, even I don't know if it's possible, but all other vram banks are taken and I need every kb I can get...
<br/>
<br/>
Well thanks ^^!!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142034 - knight0fdragon - Wed Oct 03, 2007 3:50 pm</h4>
    <div class="postbody"><span class="postbody">IIRC on the main screen, only 2 Banks can be used at max, and I think they have to be A and B, but I am not too sure on that one, allowing for a max of 256k.
<br/>
<br/>
Sub screen allows only 1 bank at max 128k
<br/>
<br/>
look here for more details
<br/>
<br/>
<a href="http://nocash.emubase.de/gbatek.htm#dsmemorycontrolvram" target="_blank">http://nocash.emubase.de/gbatek.htm#dsmemorycontrolvram</a><br/>_________________<br/><a href="http://www.myspace.com/knight0fdragonds" target="_blank">http://www.myspace.com/knight0fdragonds</a>
<br/>
<br/>
MK DS FC: Dragon 330772 075464 
<br/>
AC WW FC: Anthony SamsClub 1933-3433-9458 
<br/>
MPFH: Dragon 0215 4231 1206</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142040 - keldon - Wed Oct 03, 2007 6:23 pm</h4>
    <div class="postbody"><span class="postbody">I always read that as you can have AB, or EFG. Not sure about B,E and F though. What exactly are you trying to achieve?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142044 - ingramb - Wed Oct 03, 2007 7:34 pm</h4>
    <div class="postbody"><span class="postbody">From gbatek
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">VRAM    SIZE  MST  OFS   ARM9, 2D Graphics Engine A, OBJ-VRAM (max 256K)
<br/>
  A,B     128K  2    0..1  6400000h+(20000h*OFS.0)  ;(OFS.1 must be zero)
<br/>
  E       64K   2    -     6400000h
<br/>
  F,G     16K   2    0..3  6400000h+(4000h*OFS.0)+(10000h*OFS.1)</td> </tr></table><span class="postbody">
<br/>
It looks like you could assign B to 6420000h, E to 6400000h, and F to 6410000h.  Haven't tried it, but don't see why it couldn't work.
<br/>
<br/>
Edit: and reading your message again, this is exactly what you said.  But anway, I still think it will work.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142046 - conejoroy - Wed Oct 03, 2007 8:12 pm</h4>
    <div class="postbody"><span class="postbody">Thanks =)
<br/>
<br/>
Yes, it's theoretically possible... I arranged vram that way and it seems to work fine, at least the first bytes at 0x06400000, I didn't test storing/addressing a sprite above the 48kb "black hole".. I'll try that soon ^^
<br/>
<br/>
Why to do this? any other vram bank is allocated for other purposes, so either I live with "just" 128Kb of B for Main OBJ, or I try to allocate E and F to use their 80Kb for Main OBJ too; for a total of 208Kb in 2 segments of 128 and 80Kb.
<br/>
<br/>
If this works the only "problem" will be the unmapped area between F and B, but that offsets can be avoided. it's like working with 256Kb but with a missing 48kb in the middle xD
<br/>
<br/>
It sounds crazy that's why I'm in doubt, but it seems possible =)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142056 - conejoroy - Thu Oct 04, 2007 12:28 am</h4>
    <div class="postbody"><span class="postbody">Confirmed: it works =P!!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142058 - knight0fdragon - Thu Oct 04, 2007 12:34 am</h4>
    <div class="postbody"><span class="postbody">if it does work, wouldnt it create holes in your tile indexing?
<br/>
<br/>
<br/>
LOL wow sorry fixed that<br/>_________________<br/><a href="http://www.myspace.com/knight0fdragonds" target="_blank">http://www.myspace.com/knight0fdragonds</a>
<br/>
<br/>
MK DS FC: Dragon 330772 075464 
<br/>
AC WW FC: Anthony SamsClub 1933-3433-9458 
<br/>
MPFH: Dragon 0215 4231 1206</span><span class="gensmall"><br/><br/>Last edited by knight0fdragon on Thu Oct 04, 2007 4:45 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#142069 - conejoroy - Thu Oct 04, 2007 2:15 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>knight0fdragon wrote:</b></span></td> </tr> <tr> <td class="quote">if it does work, wouldnt it create games in your tile indexing?</td> </tr></table><span class="postbody">
<br/>
<br/>
Hm... I'm afraid I don't understand what you mean T__T</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142073 - edwdig - Thu Oct 04, 2007 3:20 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>knight0fdragon wrote:</b></span></td> </tr> <tr> <td class="quote">if it does work, wouldnt it create games in your tile indexing?</td> </tr></table><span class="postbody">
<br/>
<br/>
Assuming he's got a system for dynamically allocating the tiles, the easiest thing to do is create a map large enough for the full 256 KB range, but mark the 48 KB hole as used.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142111 - knight0fdragon - Thu Oct 04, 2007 4:37 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>conejoroy wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>knight0fdragon wrote:</b></span></td> </tr> <tr> <td class="quote">if it does work, wouldnt it create games in your tile indexing?</td> </tr></table><span class="postbody">
<br/>
<br/>
Hm... I'm afraid I don't understand what you mean T__T</span></td> </tr></table><span class="postbody">
<br/>
<br/>
I meant to say holes not game :-\
<br/>
The tile index in the OAM memory for each sprite. it is limited to 1023
<br/>
now if you are using multiple banks, that are not 128k, you will be losing a lot of these indexes.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>edwdig wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>knight0fdragon wrote:</b></span></td> </tr> <tr> <td class="quote">if it does work, wouldnt it create games in your tile indexing?</td> </tr></table><span class="postbody">
<br/>
<br/>
Assuming he's got a system for dynamically allocating the tiles, the easiest thing to do is create a map large enough for the full 256 KB range, but mark the 48 KB hole as used.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
We are talkin about OAM, not BG<br/>_________________<br/><a href="http://www.myspace.com/knight0fdragonds" target="_blank">http://www.myspace.com/knight0fdragonds</a>
<br/>
<br/>
MK DS FC: Dragon 330772 075464 
<br/>
AC WW FC: Anthony SamsClub 1933-3433-9458 
<br/>
MPFH: Dragon 0215 4231 1206</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142131 - edwdig - Thu Oct 04, 2007 10:17 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>knight0fdragon wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
The tile index in the OAM memory for each sprite. it is limited to 1023
<br/>
now if you are using multiple banks, that are not 128k, you will be losing a lot of these indexes. 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Yes, he'd lose 192 of them. Considering his VRAM needs, he probably has a lot of relatively large sprites, so it probably isn't that big of a deal.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>knight0fdragon wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>edwdig wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>knight0fdragon wrote:</b></span></td> </tr> <tr> <td class="quote">if it does work, wouldnt it create games in your tile indexing?</td> </tr></table><span class="postbody">
<br/>
<br/>
Assuming he's got a system for dynamically allocating the tiles, the easiest thing to do is create a map large enough for the full 256 KB range, but mark the 48 KB hole as used.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
We are talkin about OAM, not BG</span></td> </tr></table><span class="postbody">
<br/>
<br/>
So am I. By "map" I mean "area of memory keeping track of what portions of the tile memory are in use". To be used by his code when determining where he can place sprites in VRAM.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142396 - conejoroy - Mon Oct 08, 2007 10:38 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>edwdig wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>knight0fdragon wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
The tile index in the OAM memory for each sprite. it is limited to 1023
<br/>
now if you are using multiple banks, that are not 128k, you will be losing a lot of these indexes. 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Yes, he'd lose 192 of them. Considering his VRAM needs, he probably has a lot of relatively large sprites, so it probably isn't that big of a deal.
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
<br/>
He's right =p I dont have anything below 256 bytes (everything 16x16 or more, 8 bits) so I won't waste any memory indexing at 256 bytes =)
<br/>
<br/>
Well I'm glad this worked out just fine, thanks n.n!!</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
