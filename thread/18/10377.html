<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Problem with spritemem (seems to wrap around 32kb) - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Problem with spritemem (seems to wrap around 32kb)</h2>
<div id="posts">
<div class="post">
    <h4>#92957 - Valmond - Sat Jul 15, 2006 11:19 pm</h4>
    <div class="postbody"><span class="postbody">Hi everybody !
<br/>
<br/>
I'v run into this problem, and after well a whole day of checking &amp; controling
<br/>
I thought it was maybe time to ask the experts :)
<br/>
BTW, the code is run in Dualis and on a real DSlite.
<br/>
<br/>
Well, I have written this VRam manager for sprites, I "register" all images
<br/>
I want to use (once) and every frame I ask it to draw sprites on screen.
<br/>
If the image is loaded in VRAM it "draws" it with a sprite, otherwise
<br/>
it loads it and then draws it (frees up non used mem and so on).
<br/>
So the problem is that when I draws more than 32 different images, the
<br/>
33:d shows up like the first one.
<br/>
I use 32*32 256color sprites for testing so those 32 images should just eat 32kb out of the 128kb in bank B...
<br/>
<br/>
I use
<br/>
vramSetBankB(VRAM_B_MAIN_SPRITE); // 128kb
<br/>
but if I change to
<br/>
vramSetBankF(VRAM_F_MAIN_SPRITE); // 64kb
<br/>
then it wraps around on a 16kb boundary.
<br/>
<br/>
I have tried to disable the VRam manager, just write the first image
<br/>
to the first 32*32byte space and so on, but this doesnt change anything.
<br/>
<br/>
I also tried to write everything 2048 bytes further up but it just eated up
<br/>
two sprites... (they became invisible, like if I hadn't written anything to them)
<br/>
<br/>
<br/>
So it is like i have a short somewhere that wraps around... but I don't :-(
<br/>
(except that with VRAM_F, it wraps on 14 bits)
<br/>
<br/>
I'v checked my code quite much, the defines in libnds too :p
<br/>
but I'm stuck.
<br/>
<br/>
Does Sprite mem have special behaviour or should I go back
<br/>
continuing searching my code ?
<br/>
<br/>
<br/>
<br/>
thanks for the time :)
<br/>
<br/>
/Valmond</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#92985 - Valmond - Sun Jul 16, 2006 8:51 am</h4>
    <div class="postbody"><span class="postbody">After a good nights sleep, I found half of the problem :)
<br/>
<br/>
When I'm setting the <a class="postlink" href="http://www.bottledlight.com/ds/index.php/Video/Sprites" target="_blank"> OAM values</a>, the "Tiles" seems to be 32 bytes
<br/>
per step, and not 64 bytes which I thought would have been quite natural (64byte for a 256col 8x8pixel tile).
<br/>
<br/>
So the lines :
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code"> spriteEntry[i].attribute[2]=((0*32)&amp;1023)|(SpritePriority[i]&lt;&lt;10);
<br/>
 spriteEntry[i].attribute[2]=((1*32)&amp;1023)|(SpritePriority[i]&lt;&lt;10);</td> </tr></table><span class="postbody">
<br/>
points at the first and second 32x32 256col sprite in VRAM.
<br/>
<br/>
this seems wierd, why would you need steps smaller than one "8x8 tile" ?
<br/>
Is this for 4-bit graphics and/or can you somehow increase the size
<br/>
of these steps as you can't have more than 1024 ?
<br/>
<br/>
<br/>
Thanks again for reading my miseries :)
<br/>
<br/>
/Valmond</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93013 - tepples - Sun Jul 16, 2006 3:27 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Valmond wrote:</b></span></td> </tr> <tr> <td class="quote">why would you need steps smaller than one "8x8 tile" ? Is this for 4-bit graphics</td> </tr></table><span class="postbody">
<br/>
Yes.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">and/or can you somehow increase the size of these steps as you can't have more than 1024 ?</td> </tr></table><span class="postbody">
<br/>
<a class="postlink" href="http://nocash.emubase.de/gbatek.htm#dsvideoobjs" target="_blank">Yes</a>.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93024 - Valmond - Sun Jul 16, 2006 4:11 pm</h4>
    <div class="postbody"><span class="postbody">Got it, thanks !
<br/>
<br/>
Works like a charm now :D
<br/>
<br/>
/Valmond</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#96962 - walaber - Mon Aug 07, 2006 12:34 am</h4>
    <div class="postbody"><span class="postbody">I`m having the same problem... I know from the (informative) link above that I need to set bits 20-21 of DISP_CR so that I can setup a different step (and access more sprire memory)... but I'm not sure exactly how to do this.
<br/>
<br/>
is DISP_CR just BG0_CR in this case?
<br/>
<br/>
[edit]okay, i got it.  DISPLAY_CR :)<br/>_________________<br/>Go Go Gadget NDS!</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
