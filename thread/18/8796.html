<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>libnds bug or a bug of mine? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > libnds bug or a bug of mine?</h2>
<div id="posts">
<div class="post">
    <h4>#74347 - MrK - Sat Mar 04, 2006 5:53 pm</h4>
    <div class="postbody"><span class="postbody">I have this code, heavily borrowed from the nehe's samples from libnds samples:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   // Turn on everything
<br/>
   powerON(POWER_ALL);
<br/>
   
<br/>
   // Setup the Main screen for 3D 
<br/>
   videoSetMode(MODE_0_3D);
<br/>
   vramSetBankA(VRAM_A_TEXTURE);                        //NEW  must set up some memory for textures
<br/>
<br/>
   // Set our viewport to be the same size as the screen
<br/>
   glViewPort(0,0,255,191);
<br/>
   
<br/>
   // Specify the Clear Color and Depth 
<br/>
   glClearColor(0,0,0);
<br/>
   glClearDepth(0x7FFF);
<br/>
   
<br/>
   while (1)
<br/>
   {
<br/>
      // Reset the screen and setup the view
<br/>
      glReset();
<br/>
      glOrtho (0,16,16,0,0,256);               // ortho screen from 0,0 to 16,16 mapped to 0,0 to 256,192 (should be 256,192 to 256,192, but otherwise I can't see the polys being drawn ;) )
<br/>
<br/>
      glPushMatrix();
<br/>
      
<br/>
      glMatrixMode(GL_TEXTURE);
<br/>
      glIdentity();
<br/>
   
<br/>
      glMatrixMode(GL_MODELVIEW);
<br/>
<br/>
      //need to set up some material properties since DS does not have them set by default
<br/>
      glMaterialf(GL_AMBIENT, RGB15(16,16,16));
<br/>
      glMaterialf(GL_DIFFUSE, RGB15(16,16,16));
<br/>
      glMaterialf(GL_SPECULAR, BIT(15) | RGB15(8,8,8));
<br/>
      glMaterialf(GL_EMISSION, RGB15(16,16,16));
<br/>
<br/>
      //ds uses a table for shinyness..this generates a half-ass one
<br/>
      glMaterialShinyness();
<br/>
<br/>
      
<br/>
      //ds specific, several attributes can be set here   
<br/>
      glPolyFmt(POLY_ALPHA(31) | POLY_CULL_NONE);
<br/>
      
<br/>
      // Set the current matrix to be the model matrix
<br/>
      glMatrixMode(GL_MODELVIEW);
<br/>
   
<br/>
      //Push our original Matrix onto the stack (save state)
<br/>
      glPushMatrix();   
<br/>
<br/>
<br/>
      glLoadIdentity();                           // Reset The View
<br/>
<br/>
      glTranslatef(0.0f,0.0f,-5.0f);
<br/>
<br/>
static float XPOS=4.0f;
<br/>
<br/>
      glBegin (GL_QUADS);
<br/>
<br/>
      glColor3f (1,1,1);
<br/>
      glVertex3f(XPOS,0,16);
<br/>
<br/>
      glColor3f (1,0,0);
<br/>
      glVertex3f(XPOS+2,0,16);
<br/>
<br/>
      glColor3f (0,1,0);
<br/>
      glVertex3f(XPOS+2,4,16);
<br/>
<br/>
      glColor3f (0,0,1);
<br/>
      glVertex3f(XPOS,4,16);
<br/>
         
<br/>
      glEnd();
<br/>
<br/>
      // Pop our Matrix from the stack (restore state)
<br/>
      glPopMatrix(1);
<br/>
<br/>
      // flush to screen   
<br/>
      glFlush();
<br/>
   
<br/>
   }
<br/>
   
<br/>
   return 0;
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
my idea is putting an ortho perspective matching the real nds coordinates, 256,192, using this
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
glOrtho (0,256,192,0,0,256);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
but using this for visibility's sake
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
glOrtho (0,16,16,0,0,256);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
the sample works correctly, it just displays a colored quad in the screen, but if you change XPOS to 6.0f, does a weird thing to the quad. could this be a bug in libnds, or it's just I'm doing something wrong?
<br/>
<br/>
TIA
<br/>
MrK
<br/>
<br/>
<br/>
p.s. or maybe an emulator bug, but I've tried in two emulators and both do the same</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#74352 - Dark Knight ez - Sat Mar 04, 2006 7:10 pm</h4>
    <div class="postbody"><span class="postbody">I encountered some sort of wrap around with "high" values such as that, and am now using a 3d space of 1.0x1.0x1.0 to avoid problems, and scaling it to the size I actually want with glScalef (beforehand).
<br/>
<br/>
So, maybe you could try to scale everything with a factor of 100 and see if that helps. Meaning:
<br/>
<br/>
... some code ...
<br/>
glScalef(100.0f, 100.0f, 100.0f);
<br/>
... some code ....
<br/>
glTranslate(0.0f, 0.0f, -0.05f);
<br/>
XPOS = 0.04f;
<br/>
... some code ....  etc.
<br/>
<br/>
Hope this works out for you.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#74353 - Webez - Sat Mar 04, 2006 7:11 pm</h4>
    <div class="postbody"><span class="postbody">vertex 4.12 fixed format .
<br/>
<br/>
 1 bit is for sign. So you only have 3 bits-&gt; 111=7 is max number you can use in vertex</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#74357 - MrK - Sat Mar 04, 2006 7:33 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Webez wrote:</b></span></td> </tr> <tr> <td class="quote">vertex 4.12 fixed format .
<br/>
<br/>
 1 bit is for sign. So you only have 3 bits-&gt; 111=7 is max number you can use in vertex</td> </tr></table><span class="postbody">
<br/>
<br/>
mmm... the wrap around makes sense then, I thought about it but as I saw f32 (1.19.12) was widely used it'd be an error of mine or a library error.
<br/>
<br/>
is this a libnds limitation or it's a hardware one?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#74362 - dovoto - Sat Mar 04, 2006 8:15 pm</h4>
    <div class="postbody"><span class="postbody">The hardware accepts vertex data in 4.12 format only.  To use a large range you need to use the scale functionality or use the view matrix.
<br/>
<br/>
As for errors in libnds there is definatly an error in in ortho at the moment with Z sorting which people are looking into.<br/>_________________<br/><a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#74374 - MrK - Sat Mar 04, 2006 9:39 pm</h4>
    <div class="postbody"><span class="postbody">I see, hardware limit then. no worries about the scale, my objective was to do a mapping as if I were working in the real ds display (256x192), but I'll change the rendering to match another resolution (0,0 to 1,1 in example).
<br/>
<br/>
btw, is there any way to bypass the z sorting? I'm sending the polys in the exact order I want to be displayed (in fact I only want openGL to render)
<br/>
<br/>
thanks to all for the speddy responses :)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
