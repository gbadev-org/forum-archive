<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Wireless debugging - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Wireless debugging</h2>
<div id="posts">
<div class="post">
    <h4>#84387 - simonjhall - Mon May 22, 2006 10:08 am</h4>
    <div class="postbody"><span class="postbody">Hi, I'm new to homebrew on the DS (but not new to console programming) and I've noticed the lack of a debugger...
<br/>
<br/>
Just a quick question - does anybody want one? Or does everyone develop their programs inside one of the emulators (which would allow single-instruction stepping), then once it's working test it out on the real target?
<br/>
<br/>
Cos if there is demand for a (real) debugger, I've got a version 0.01 of a little project y'all might like :-)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#84392 - HyperHacker - Mon May 22, 2006 10:22 am</h4>
    <div class="postbody"><span class="postbody">I wouldn't mind seeing one. My debugging method right now consists of adding more text to the output and/or blinking the power LED. :-p<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#84400 - simonjhall - Mon May 22, 2006 11:37 am</h4>
    <div class="postbody"><span class="postbody">Anyone else?
<br/>
<br/>
Plus - how much does the ARM 7 get used? Cos at the moment I can only debug the ARM 9 and adding support for the '7 would be a bit trickier (as stalling it would halt the networking...)
<br/>
<br/>
Plus 2 - how much does the THUMB mode get used? Again, adding support for that may be non-trivial (though to be fair, I've not looked into it properly).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#84403 - Wuschmaster - Mon May 22, 2006 12:11 pm</h4>
    <div class="postbody"><span class="postbody">I'm interested.
<br/>
By the way, is it possible to add a "take screenshot" feature? That would be damn cool, dude.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#84404 - simonjhall - Mon May 22, 2006 12:20 pm</h4>
    <div class="postbody"><span class="postbody">As in capture what's currently on the LCD? Well if the data at the address of the framebuffer is readable (as in not write-only) then capturing the framebuffer(s) should be easy as pie!
<br/>
<br/>
Another idea I've been toying with is loading executables straight onto the target across the wireless link... Isn't the speed like 2MBit though? So filling 4 megs of RAM could be a bit sluggish. Pulling files from the PC's filesystem should be easy too. Wireless printfs (for those who swear who by debugging with printfs!) work well.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#84418 - GPFerror - Mon May 22, 2006 1:46 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>simonjhall wrote:</b></span></td> </tr> <tr> <td class="quote">Hi, I'm new to homebrew on the DS (but not new to console programming) and I've noticed the lack of a debugger...
<br/>
<br/>
Just a quick question - does anybody want one? Or does everyone develop their programs inside one of the emulators (which would allow single-instruction stepping), then once it's working test it out on the real target?
<br/>
<br/>
Cos if there is demand for a (real) debugger, I've got a version 0.01 of a little project y'all might like :-)</td> </tr></table><span class="postbody">
<br/>
<br/>
Source code debugger? like wireless gdb? that would be awesome. Or gdb support in dualis would be nice as well. This is one of my most requested features that would make development alot easier :)
<br/>
<br/>
Troy(GPF)
<br/>
<a href="http://gpf.dcemu.co.uk" target="_blank">http://gpf.dcemu.co.uk</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#84423 - simonjhall - Mon May 22, 2006 1:56 pm</h4>
    <div class="postbody"><span class="postbody">Yeah, I'm talking about stepping through real code running on a real DS in GDB (I'm using GDB plugged into Eclipse).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#84426 - GPFerror - Mon May 22, 2006 2:03 pm</h4>
    <div class="postbody"><span class="postbody">would love to test it, i have eclipse. If you need a tester or are you releasing soon?
<br/>
<br/>
Thanks,
<br/>
Troy(GPF)
<br/>
<a href="http://gpf.dcemu.co.uk" target="_blank">http://gpf.dcemu.co.uk</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#84438 - agentq - Mon May 22, 2006 4:34 pm</h4>
    <div class="postbody"><span class="postbody">I'd be very interested in seeing this.  It would be great to be able to trace through ScummVM, and have a networkable printf.  Also, being able to reload the executable over the wireless would save a lot of wear and tear on my slot.
<br/>
<br/>
My main worry would be the extra memory used by the stub, and the extra memory used by compiling my program without optimisations.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#84443 - simonjhall - Mon May 22, 2006 4:51 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>agentq wrote:</b></span></td> </tr> <tr> <td class="quote">Also, being able to reload the executable over the wireless would save a lot of wear and tear on my slot.</td> </tr></table><span class="postbody">
<br/>
Heh, slot.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>agentq wrote:</b></span></td> </tr> <tr> <td class="quote">My main worry would be the extra memory used by the stub, and the extra memory used by compiling my program without optimisations.</td> </tr></table><span class="postbody">
<br/>
At the moment, the stub is around 100k, though the bulk of that is from bits of libnds and libwifi I'm not using. Gonna (eventually) try and strip out the bits that aren't needed. Also if you're already linking with these libraries it's only gonna add like 20k to the size of the executable.
<br/>
Yeah, I suppose compiling your own code without an -O of some kind may make your code bigger. You could -O some bits of code and -g the bits you really wanna poke at...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>GPFerror wrote:</b></span></td> </tr> <tr> <td class="quote">would love to test it, i have eclipse. If you need a tester or are you releasing soon?</td> </tr></table><span class="postbody">
<br/>
Ta, but it's still a way from being properly testable. I'll get back to you... In the meanwhile me and my buddy aqentq (who I conveniently know in the Real World) may try running it on his baby to weed out the major bugs I'll inevitably have.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#84446 - agentq - Mon May 22, 2006 4:56 pm</h4>
    <div class="postbody"><span class="postbody">So you're <span style="font-style: italic">that</span> Simon J Hall?!  I never suspected.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#84447 - simonjhall - Mon May 22, 2006 5:03 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>agentq wrote:</b></span></td> </tr> <tr> <td class="quote">So you're <span style="font-style: italic">that</span> Simon J Hall?!  I never suspected.</td> </tr></table><span class="postbody">
<br/>
Well you are the 'new guy', so I guess you wouldn't know who I am. People have been talking about your dodgy name ever since you started... Post coming for Mr A Q does attract attention, y'know :-p</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#84448 - agentq - Mon May 22, 2006 5:14 pm</h4>
    <div class="postbody"><span class="postbody">Yeah, well I like to live life on the edge... of unemployment.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#84454 - Mighty Max - Mon May 22, 2006 6:06 pm</h4>
    <div class="postbody"><span class="postbody">Yes, we'd love it :D
<br/>
<br/>
Currently my main debugging mean is a memory dump  to CF at crash (exception). If i'd had something to browse through, change and continue, that would be great!<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#84455 - wintermute - Mon May 22, 2006 6:28 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>simonjhall wrote:</b></span></td> </tr> <tr> <td class="quote">Anyone else?
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Yes, very. I'm in the process of updating the Insight package provided by devkitPro. I'd be very happy to add such a project to the devkitPro CVS as well - I've just started looking at the feasability of doing exactly this with Insight/gdb over wifi but I hadn't yet started on code. 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Plus - how much does the ARM 7 get used? Cos at the moment I can only debug the ARM 9 and adding support for the '7 would be a bit trickier (as stalling it would halt the networking...)
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Quite a lot but I'd say most people would be happy enough with just debugging arm9.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Plus 2 - how much does the THUMB mode get used? Again, adding support for that may be non-trivial (though to be fair, I've not looked into it properly).</td> </tr></table><span class="postbody">
<br/>
<br/>
thumb mode is the default for the devkitPro examples and templates so probably quite a bit.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#84456 - wintermute - Mon May 22, 2006 6:30 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">Yes, we'd love it :D
<br/>
<br/>
Currently my main debugging mean is a memory dump  to CF at crash (<b style="color:#FFA34F">exception</b>). If i'd had something to browse through, change and continue, that would be great!</td> </tr></table><span class="postbody">
<br/>
<br/>
change and continue?
<br/>
<br/>
You've been a bit spoiled by the VS debugger haven't you?<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#84457 - simonjhall - Mon May 22, 2006 6:30 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">Currently my main debugging mean is a memory dump  to CF at crash (<b style="color:#FFA34F">exception</b>). If i'd had something to browse through, change and continue, that would be great!</td> </tr></table><span class="postbody">
<br/>
That's interesting... What kind of crash are you talking about? And how do you catch it? eg if you were to divide by zero, would you be able to catch that?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#84458 - Mighty Max - Mon May 22, 2006 6:33 pm</h4>
    <div class="postbody"><span class="postbody">I have that debug on any abort (Jump to or read/write invalid addresses, everything that calls an <b style="color:#FFA34F">exception</b> vector other then reset, irq or swi)
<br/>
or on key irq to check for endless loops via a key-combination.
<br/>
<br/>
<br/>
Wintermute: indeed :D<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"><br/><br/>Last edited by Mighty Max on Mon May 22, 2006 6:34 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#84459 - simonjhall - Mon May 22, 2006 6:34 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">I've just started looking at the feasability of doing exactly this with Insight/gdb over wifi but I hadn't yet started on code.</td> </tr></table><span class="postbody">
<br/>
Ooh ooh! Please don't steal my thunder and do it before me!
<br/>
<br/>
Anyway - I was having a bit of trouble finding a gdb which has arm as it's target. I tried Insight from devkitPro, but whenever I loaded in any elf the program would just crash... Any ideas? Since then I've been using a gdb from another source...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#84460 - wintermute - Mon May 22, 2006 6:36 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>simonjhall wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">Currently my main debugging mean is a memory dump  to CF at crash (<b style="color:#FFA34F">exception</b>). If i'd had something to browse through, change and continue, that would be great!</td> </tr></table><span class="postbody">
<br/>
That's interesting... What kind of crash are you talking about? And how do you catch it? eg if you were to divide by zero, would you be able to catch that?</span></td> </tr></table><span class="postbody">
<br/>
<br/>
The <b style="color:#FFA34F">exception</b> code in the <b style="color:#FFA34F">BIOS</b> looks like this
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
sub_FFFF00C0            ; CODE XREF: ROM:loc_FFFF001Cj
<br/>
      MRS   SP, CPSR
<br/>
      ORR   SP, SP,   #0xC0
<br/>
      MSR   CPSR_cxsf, SP
<br/>
      LDR   SP, =0x27FFD9C
<br/>
      ADD   SP, SP,   #1
<br/>
<br/>
loc_FFFF00D4            ; CODE XREF: ROM:FFFF0134j
<br/>
      STMFD   SP!, {R12,LR}
<br/>
      MRS   LR, SPSR
<br/>
      MRC   p15, 0,   R12,c1,c0
<br/>
      STMFD   SP!, {R12,LR}
<br/>
      BIC   R12, R12, #1
<br/>
      MCR   p15, 0,   R12,c1,c0
<br/>
      BIC   R12, SP, #1
<br/>
      LDR   R12, [R12,#0x10]
<br/>
      CMP   R12, #0
<br/>
      BLXNE   R12
<br/>
      LDMFD   SP!, {R12,LR}
<br/>
      MCR   p15, 0,   R12,c1,c0
<br/>
      MSR   SPSR_cxsf, LR
<br/>
      LDMFD   SP!, {R12,LR}
<br/>
      SUBS   PC, LR,   #4
<br/>
; End of function sub_FFFF00C0
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
the ARM vectors at these addresses point to this code
<br/>
<br/>
0x00000004 Undefined instruction  
<br/>
0x0000000C Prefetch Abort Abort 
<br/>
0x00000010 Data Abort
<br/>
<br/>
so these exceptions will eventually jump to the address stored in 0x27FFD9C<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#84464 - simonjhall - Mon May 22, 2006 6:46 pm</h4>
    <div class="postbody"><span class="postbody">wintermute: Cool, that's pretty much what I want. I'll get back to you when I wanna do it proper :-)
<br/>
At the moment the program breaks into my breakpoint-handling code by simply replacing the chosen instruction with a bl to my handler. It's then gotta save everything itself, rather than let the <b style="color:#FFA34F">exception</b>-handling mechanism do it for me.
<br/>
<br/>
max: I also thought about change and continue, but yeah - you'll be lucky! One thing at a time...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#84466 - wintermute - Mon May 22, 2006 6:52 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>simonjhall wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">I've just started looking at the feasability of doing exactly this with Insight/gdb over wifi but I hadn't yet started on code.</td> </tr></table><span class="postbody">
<br/>
Ooh ooh! Please don't steal my thunder and do it before me!
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Heh, this one is a task I'm perfectly happy to let someone else do the hard work
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Anyway - I was having a bit of trouble finding a gdb which has arm as it's target. I tried Insight from devkitPro, but whenever I loaded in any elf the program would just crash... Any ideas? Since then I've been using a gdb from another source...</td> </tr></table><span class="postbody">
<br/>
<br/>
There's the Insight package linked to from <a href="http://www.devkitpro.org/downloads.shtml" target="_blank">http://www.devkitpro.org/downloads.shtml</a> under the Visualboy Advance section. I haven't yet got around to updating the one used by the installer as there were still some weird problems which turned out to be VBA's fault. I'll be updating soon, I just haven't decided whether to go with the forthcoming 6.5 or one of the CVS builds I've been doing.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#84470 - mastertop101 - Mon May 22, 2006 7:12 pm</h4>
    <div class="postbody"><span class="postbody">What type of information could we get from it ? Would it send complicated errors and/or ram dumps ? or interpreted errors ?(with possible causes...)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#84490 - HyperHacker - Mon May 22, 2006 10:12 pm</h4>
    <div class="postbody"><span class="postbody">ARM7 does all sound and wireless and handles input from the touch screen, X and Y buttons, I believe a few other things as well. In a simple app it's generally just checking for instructions to write power management regs, enter GBA mode etc at VBlank, but it does make up 33% of the DS's processing power, so it does a fair bit of work in more complex apps. In official games it's always running a binary supplied by Nintendo, and I can't say how much processing power that uses, if you even intend to support those.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#84547 - simonjhall - Tue May 23, 2006 7:36 am</h4>
    <div class="postbody"><span class="postbody">Cool, I'll think about supporting the ARM 7. I suppose I'd be able to suspend the main thread of execution but breaking into interrupts on either processor is likely to be a no-no.
<br/>
<br/>
Plus debugging a real game? If you could somehow load in my code THEN execute the game it'd work - as long as the game loads itself into RAM first. Debugging ROM will not work as this is software debugging, and it requires write access to the code being debugged.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#84555 - Mighty Max - Tue May 23, 2006 9:15 am</h4>
    <div class="postbody"><span class="postbody">For non-write to code breakpoints you cound use a protection region.
<br/>
<br/>
If you map a 4kB region, RW Access but Execute disallowed, you'll have an <b style="color:#FFA34F">exception</b> everytime a opcode in that 4kB wants to be done. As this enters another mode on the ARM, you can backup all register contents fairly easy. After this, copy the command to a region you can control,  enter debug or set all registers, as you were in that 4kB region, execute this opcode, store the registers again, and leave the <b style="color:#FFA34F">exception</b>.(if it is some other address in this region)
<br/>
<br/>
It's slow as hell for this 4kB but hey, its debugging, and only needs done for code in the rom area.
<br/>
<br/>
You can btw do the same for data access breakpoints (i.e. break if a variable gets written) by disallowing writes/reads from that area, and calculate the fault address, disable the region, enter debug or execute the opcode causing the fault (if its some other value in this region) , and then reset the region.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#84558 - simonjhall - Tue May 23, 2006 11:01 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">You can btw do the same for data access breakpoints (i.e. break if a variable gets written) by disallowing writes/reads from that area, and calculate the fault address, disable the region, enter debug or execute the opcode causing the fault (if its some other value in this region) , and then reset the region.</td> </tr></table><span class="postbody">
<br/>
Bangin'. I was looking for a decent way of doing watchpoints that didn't involve stepping one instruction at a time and checking for a change. That method would do just fine.
<br/>
<br/>
May have to put the debugger on hold for a few days though as my new sax has just been delivered to work in a big-ass box :-)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#84656 - simonjhall - Tue May 23, 2006 11:13 pm</h4>
    <div class="postbody"><span class="postbody">Ok, it's progressing. I was thinking of showing a screenie but a) people might say I've faked it and b) I'm not too sure of where to host a picture.
<br/>
<br/>
Anyway, I've been thinking about this ARM 7-related stuff and one thing struck me whilst doing a test debug: I can't inspect any variables from the ARM 7 binary. It's cos I've only loaded the ARM 9 ELF :-)
<br/>
<br/>
So, anyone have any suggestions of how I can load a second ELF (or at least the symbol table) into GDB? I can't seem to get the two loaded side-by-side; either the second one isn't 'noticed' or adding a second one replaces the first. Also, not too sure on how it'd work anyway what with the duplicated symbols! (eg there's two main() functions)
<br/>
<br/>
<span style="font-weight: bold">A summary of the current status:</span>
<br/>
- placing breakpoints works well
<br/>
- variable inspection works great
<br/>
- traversing the stack seems to work
<br/>
- most registers can be inspected
<br/>
- stepping works ok (only puts next breakpoint at pc+4 - doesn't handle jumps)
<br/>
- continuing doesn't work well, as GDB is inconsistent with regards to when it wants to place or delete a breakpoint
<br/>
- less TCP packets going walkies due to better error detection
<br/>
- it is a bit slow...
<br/>
<br/>
Lots more left to do!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#84661 - agentq - Tue May 23, 2006 11:30 pm</h4>
    <div class="postbody"><span class="postbody">I thought your Sax was going to take up your spare time?
<br/>
<br/>
But anyway, the debugger sounds like it's going really well.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#84677 - HyperHacker - Wed May 24, 2006 2:37 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>simonjhall wrote:</b></span></td> </tr> <tr> <td class="quote">Ok, it's progressing. I was thinking of showing a screenie but a) people might say I've faked it and b) I'm not too sure of where to host a picture.</td> </tr></table><span class="postbody">
<br/>
Screw them, and Photobucket or Imageshack.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#84700 - simonjhall - Wed May 24, 2006 9:22 am</h4>
    <div class="postbody"><span class="postbody">Was a bit over-zealous with the posting last night, here's more!
<br/>
<span style="font-weight: bold">What's cool:</span>
<br/>
- figured out GDB's way of breakpointing, so stepping and continue work just fine
<br/>
- much faster than before, stepping is dog-slow though due to the amount of network chit-chat required
<br/>
- still only steps pc+4
<br/>
- register inspection works properly now (it didn't before)
<br/>
- inspecting variables from other stack frames works well
<br/>
- more network reliability fixes when under 'heavy load'
<br/>
- good integration with Eclipse's debugger
<br/>
<br/>
<span style="font-weight: bold">What's not cool:</span>
<br/>
- there's the ocassional race condition whilst stepping, and the PC-side hangs
<br/>
- when entering a new stack frame, Eclipse tells GDB to disassemble the code from memory, not from disk. GDB then does this 4 BYTES AT A TIME! You then have to wait whilst it downloads the code at a snails pace!
<br/>
- a similar thing happens when inspecting variables (in particular arrays/structures) - it likes to download then 10 bytes at at time. Not good.
<br/>
- there's gotta be more stuff that's broken
<br/>
<br/>
I'm at work at the mo, so no screenshot love, sorry!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#84713 - chishm - Wed May 24, 2006 11:06 am</h4>
    <div class="postbody"><span class="postbody">Wow, this will be very helpful. I normally debug by printing to screen, but this will make it so much easier. Keep up the good work, and hopefully I'll know how to use GDB when it's released. :D<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#84748 - 0xtob - Wed May 24, 2006 3:44 pm</h4>
    <div class="postbody"><span class="postbody">I agree, a wireless debugger would save a lot of time and frustration with debugging. It's awesome that someone is tackling this task and seems to be having quite impressive progess.
<br/>
<br/>
Keep it up!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#84761 - wintermute - Wed May 24, 2006 4:37 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>simonjhall wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
- much faster than before, stepping is dog-slow though due to the amount of network chit-chat required
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
You might want to look at the T packet response.
<br/>
<br/>
<a href="http://sourceware.org/gdb/current/onlinedocs/gdb_33.html#IDX1652" target="_blank">http://sourceware.org/gdb/current/onlinedocs/gdb_33.html#IDX1652</a>
<br/>
<br/>
<a href="http://sourceware.org/ml/gdb/2006-04/msg00313.html" target="_blank">http://sourceware.org/ml/gdb/2006-04/msg00313.html</a><br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#84841 - GPFerror - Wed May 24, 2006 11:34 pm</h4>
    <div class="postbody"><span class="postbody">yes looks like its coming along nicely, can't wait :)
<br/>
<br/>
thanks for working on this.
<br/>
<br/>
Troy</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#84852 - simonjhall - Thu May 25, 2006 12:36 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>GPFerror wrote:</b></span></td> </tr> <tr> <td class="quote">thanks for working on this.</td> </tr></table><span class="postbody">
<br/>
No problem. It is kinda for fun - I've never written a debugger or anything like it before :-) I'm just shocked at how well it's going!
<br/>
<br/>
For the fun of it, here's a screenshot of the thing running. NOTE: I've grabbed the whole (dual-screen) desktop so you 1024x768-ers will need to scroll (really sorry) and 56k users - just don't bother!
<br/>
<br/>
<a class="postlink" href="http://imageshack.us" target="_blank"></a><a href="http://img359.imageshack.us/img359/4306/dsdebugging5aj.gif">[Images not permitted - Click here to view it]</a>
<br/>
<br/>
In the far left console is the PC-side of the debugger, the bit which translates the commands from GDB into something easily understood by the DS stub.
<br/>
On the right screen I'm running Eclipse's debugger: I just jab F11 and it automatically runs the arm gdb, connects to the PC stub and jumps into debug mode.
<br/>
<br/>
I'm running the third demo (modified slightly) from the nehe examples for libnds.
<br/>
<br/>
<span style="font-weight: bold">Important things to notice</span> (yeah, I'm spelling it all out - but what the hell!):
<br/>
- when running normally, the quad on the right of the top display (of the DS) spins
<br/>
- I've suspended execution at the draw function by dumping down a breakpoint just before running glLoadIdentity
<br/>
- the image on the top display (of the DS) has now frozen
<br/>
- Eclipse then asks GDB for a disassembly of the current function, which then asks the PC stub, which then asks the DS for the relevant info
<br/>
- the PC stub has actually crashed :-) If you look in the disassembly at the selected line and the following line it would normally show the real opcodes, but as something has broken, the breakpoints haven't been deleted and the hooks into the debugger stub are visible!
<br/>
<br/>
Oh and unrelated: the speed of the thing has now improved, esp when it comes to downloading big chunks of memory. Before it used to take 45 secs to download and disassemble main(), and now it takes eight-ish... Single-stepping is much faster but still sluggish - I've not yet worked on that properly.
<br/>
<br/>
EDIT: And yeah, the Konfabulator weather widget is right - it IS raining here in Sunny London :-( Better not on my jolly commute 2mo morn though...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#85147 - simonjhall - Sat May 27, 2006 1:23 pm</h4>
    <div class="postbody"><span class="postbody">Here's a quick update on the debugger before I go away for the weekend...
<br/>
- Breakpoint handling is now pretty perfect (ie stepping and continuing etc). No more duplicate 'points or deleting breakpoints twice.
<br/>
- There was a bug where I'd get confirmation of a breakpoint write yet the program wouldn't halt there - I reckon this was a cache problem as flushing the d-cache fixed that (touch wood!)
<br/>
- Still can only step pc + 4; I reckon I need to verify the registers are correct first before I can calculate branch targets.
<br/>
- Networking is still a bit flakey. May change to UDP.
<br/>
- Memory writes work ok (eg variable changing).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#85150 - wintermute - Sat May 27, 2006 1:51 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>simonjhall wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
- There was a bug where I'd get confirmation of a breakpoint write yet the program wouldn't halt there - I reckon this was a cache problem as flushing the d-cache fixed that (touch wood!)
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
you might want to also invalidate the instruction cache at the address.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
- Networking is still a bit flakey. May change to UDP.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
UDP communciation isn't guaranteed to arrive. If it's already flaky with TCP then it'll get worse if you do that.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#85284 - simonjhall - Sun May 28, 2006 6:08 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">you might want to also invalidate the instruction cache at the address.</td> </tr></table><span class="postbody">
<br/>
Is that using CP15_FlushICache()? I did a really quick test of that, yet I couldn't figure out which library I had to link with (ie I got linker errors). But anyway, I think it's sorted now I'm flushing the data cache. Still would feel better flushing the instruction cache too!
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">UDP communciation isn't guaranteed to arrive. If it's already flaky with TCP then it'll get worse if you do that.</td> </tr></table><span class="postbody">
<br/>
The thing is I'm doing loads of network checking/checksuming/verifying/resending etc and I assumed that by cutting out the stuff that TCP does (as I'm doing it all myself) it might make it run a bit quicker. Is DS UDP any good, or is it really lossy?
<br/>
<br/>
Oh and I think I'm *nearly* ready to get people to try this :-) It's pretty reliable, and literally the only thing I need to write now is the mechanism to step into branches, rather than just over them.
<br/>
<br/>
Oh and quick question - r0 is a real register, right? I can do stuff with it, yet GDB never asks for its value and always insists that it's zero... Also, are there any fp registers?
<br/>
<br/>
Oh #3 - I've got some readahead mechanism to allow you to download/disassemble big chunks of memory faster (as GDB normally disassembles 4 bytes at a time) so now disassembling my demo function has gone from 45-&gt;15-&gt;2 seconds!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#85295 - GPFerror - Sun May 28, 2006 7:33 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>simonjhall wrote:</b></span></td> </tr> <tr> <td class="quote">Oh and I think I'm *nearly* ready to get people to try this :-) </td> </tr></table><span class="postbody">
<br/>
<br/>
Can't wait, thanks for working on this :)
<br/>
<br/>
Troy(GPF)
<br/>
<a href="http://gpf.dcemu.co.uk" target="_blank">http://gpf.dcemu.co.uk</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#85580 - simonjhall - Thu Jun 01, 2006 12:02 am</h4>
    <div class="postbody"><span class="postbody">Here's the low down on what's been happening with the debugger:
<br/>
<br/>
Had a very quick go at figuring out why the networking is so slow, but didn't have a lot of luck. Gonna try and fix this at some later date. Basically, there's some mondo lag in there, but I'm not even too sure whether it's my DS' fault or PC's fault! Still reckon datagrams are the way forward.
<br/>
<br/>
Also had a very quick go at ARM7-ing, but only to see if you could read variables from the ARM7 app. So the stub listens to two sockets - a GDB for the regular ARM9 code and one for a GDB for the ARM7 code. You guessed it, two debuggers controlling one program (with no real way of halting the '7) doesn't give good results - but you can inspect variables on the second processor (they just change a lot)! I'll think about real '7 support some other time.
<br/>
<br/>
THUMB - I'm pretty sure I stepped into some thumb code earlier (as it hung), yet it doesn't look like thumb to me... Here's an example: stepping into glTranslatef is cool, but that bx doesn't execute properly (it hangs). Even though it's branching to a 4-byte aligned address it still stops... Ah, who cares. This is the whole function definition btw, so I have no idea what's going on here!
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">0200024c &lt;__glTranslatef_from_arm&gt;:
<br/>
 200024c:       e59fc000        ldr     ip, [pc, #0]    ; 2000254 &lt;__glTranslatef_from_arm+0x8&gt;
<br/>
 2000250:       e12fff1c        bx      ip
<br/>
 2000254:       02002b81        andeq   r2, r0, #132096 ; 0x20400</td> </tr></table><span class="postbody">
<br/>
<br/>
And now the real work,
<br/>
<br/>
EASY: It no longer steps to the next address in memory, it'll handle b/bl/bx jumps properly as well as all conditionally executed instructions. So you can now step into functions, rather than straight over them :-) Needs more testing (esp the cond instrs) to verify that it's cool.
<br/>
<br/>
HARD: The tiny stub which launches into the debugger needed to be totally rewritten as it only worked in 95% of cases, ie it worked as long as the instruction you're stepping into didn't touch the link register. But now it's cool (I hope). Ta Neil for the chit-chats 'bout this today. Say 'no' to acid.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#85587 - The 9th Sage - Thu Jun 01, 2006 1:51 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>simonjhall wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Plus debugging a real game? If you could somehow load in my code THEN execute the game it'd work - as long as the game loads itself into RAM first. Debugging ROM will not work as this is software debugging, and it requires write access to the code being debugged.</td> </tr></table><span class="postbody">
<br/>
<br/>
Huh, there must be a way to load a gamecard after loading some homebrew into RAM...Dipstar (the NDS cheat program) does this.  Not sure about getting the game to send out the wireless though, I'm sure that'd take a LOT more hacking.<br/>_________________<br/>Now with 20% More Old Man from Zelda 1 than ever before!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#85588 - dexter0 - Thu Jun 01, 2006 2:22 am</h4>
    <div class="postbody"><span class="postbody">Sorry if I missed this but....
<br/>
<br/>
Is this going to have to be compiled with your game (during the time you are debugging of course) or will it be similar to dipstar?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#85611 - simonjhall - Thu Jun 01, 2006 9:28 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>dexter0 wrote:</b></span></td> </tr> <tr> <td class="quote">Is this going to have to be compiled with your game (during the time you are debugging of course) or will it be similar to dipstar?</td> </tr></table><span class="postbody">
<br/>
Originally the plan was to make it so that all you have on your CF card (or whatever you use to boot) was the stub which loaded in an elf over the network and then allowed you to debug it. But due to the network *currently* being too slow (but still kudos to the guy who did the wifi) you've gotta link your app with my stuff then call a function or two to allow debugging.
<br/>
<br/>
Gonna look into wireless booting once I figure out why my thing's so sluggish.
<br/>
<br/>
Actually, if you wanted to have both the stub and your app as separate apps on your card it wouldn't be TOO hard to load the stub first then load in the app... Pointless though, as you'd need extra loading code...and I'm too lazy to piss about with that!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#85749 - dexter0 - Fri Jun 02, 2006 4:13 am</h4>
    <div class="postbody"><span class="postbody">To Bad.  I was hoping to use it to help search for DipStar codes.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#87042 - josath - Sun Jun 11, 2006 6:38 pm</h4>
    <div class="postbody"><span class="postbody">might want to try latest version of the wifi lib updates. maybe he's fixed the slow wifi problem (i've had the same problem as well before, where ping time goes up, and transfer speeds go slow)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#87633 - simonjhall - Wed Jun 14, 2006 9:25 pm</h4>
    <div class="postbody"><span class="postbody">Yo, just wanted to say to those people who are still after a debugger that this thing IS still going on, it's just that I've been snowed under by work! Programming SIMD asm for eight hours a day, then coming home to program even more just hurts your brain!
<br/>
<br/>
I'm totally ready to have this thing tested btw - and now would have been an ideal time - but I'm off to CVPR all next week! So sorry guys, you're just gonna have to wait a little longer!
<br/>
<br/>
Stuff which is coming, soon
<br/>
- faster
<br/>
- *source-stepping* (rather than one opcode at a time)
<br/>
- no more race conditions locking the thing up :-)
<br/>
- the option to reset the target
<br/>
- if I have time: maybe a simple UI to separate all the console output (like an SN target manager if you've ever used one) and some buttons to control the pc-side stub
<br/>
<br/>
Maybe I should take my laptop on the plane :-)
<br/>
<br/>
EDIT: could I request having an arm-eabi-gdb in the next devkitarm? Just updated and I don't think there's one there...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#87640 - wintermute - Wed Jun 14, 2006 10:02 pm</h4>
    <div class="postbody"><span class="postbody">I've tested vba &amp; arm-elf-insight with the elfs from the new toolchain - it all seems to work as expected.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#90351 - simonjhall - Thu Jun 29, 2006 8:49 pm</h4>
    <div class="postbody"><span class="postbody">Ok, back from NYC and now I think I'm ready to have *a few* people test the debugger. So *a couple* of people who might have experience with low-level stuff wanna step forward? :-) You're gonna need to be comfortable with hex and looking at ARM assembler! Knowledge of gdb would kick ass greatly.
<br/>
<br/>
This is still pretty WIP, it's just that I've not had half as much time to work on it as when I originally started writing it... Just need some people to motivate me to finish it!
<br/>
<br/>
And Millstone, you're just too slow :-p
<br/>
<br/>
NOTE: the final thing ain't gonna require you to look at hex or assembler, this is just so you can confirm it's working correctly...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#90923 - simonjhall - Mon Jul 03, 2006 2:47 pm</h4>
    <div class="postbody"><span class="postbody">I WILL be releasing this soon - I promise! Just still need a bit of testing done (will send out testing ver shortly to some people).
<br/>
<br/>
BUT as I have a big ol' bug which only appears once in a blue moon I need to rewrite a critical bit of code in order to fix it. If I do rewrite it though I'm thinking of adding support for THUMB at the same time.
<br/>
<br/>
<span style="font-weight: bold">Now here's my problem</span> - how can I tell for a given instruction if it's a THUMB instruction or an ARM instruction? Yeah, I can check the alignment but that won't work for all instructions. Anyone have any suggestions? Ta :-)
<br/>
<br/>
Anyway, here's a refresh of what this thing can currently do, for those who don't wanna read the rest of this thread:
<br/>
- suspend ARM code running on the ARM9, allowing you to inspect memory/registers/variables/the stack etc
<br/>
- write to memory, but not registers (yet)
<br/>
- you can read/write ARM7 data that is in the main memory space - but the ARM7 can't be suspended at the moment so the values could be wrong
<br/>
- step into/over individual instructions *in user-space code* (ie not interrupts etc)
<br/>
- step into/over whole lines of source code - the big thing I've been working on
<br/>
- blacklisting of functions which won't be stepped into (eg so you don't accidently hang the debugger by stepping into itself)
<br/>
<br/>
Coming soon:
<br/>
- a released version :-)
<br/>
- hopefully transparent support for both THUMB and ARM code
<br/>
- the ability to catch erroneous memory accesses (eg NULL pointer exceptions)
<br/>
<br/>
I'm reluctant to add support for register writing and adding the ability to restart execution from a different instruction. Wouldn't be hard though, I just think it'll make it really easy for people to crash their programs... I also don't really want to add memory watchpoints either as it sounds like a world of pain!
<br/>
<br/>
Anyone have any special requests for stuff to be added?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#90946 - tepples - Mon Jul 03, 2006 6:06 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>simonjhall wrote:</b></span></td> </tr> <tr> <td class="quote"><span style="font-weight: bold">Now here's my problem</span> - how can I tell for a given instruction if it's a THUMB instruction or an ARM instruction? Yeah, I can check the alignment but that won't work for all instructions.</td> </tr></table><span class="postbody">
<br/>
I think bit 0 of the program counter is set when the CPU is in Thumb mode.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">- step into/over individual instructions *in user-space code* (ie not interrupts etc)</td> </tr></table><span class="postbody">
<br/>
So that means you can't use the debugger if your game loop is structured like Super Mario Bros. (NES), where the entire game after the init code is one big vblank handler, right?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#90954 - wintermute - Mon Jul 03, 2006 6:17 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>simonjhall wrote:</b></span></td> </tr> <tr> <td class="quote"><span style="font-weight: bold">Now here's my problem</span> - how can I tell for a given instruction if it's a THUMB instruction or an ARM instruction? Yeah, I can check the alignment but that won't work for all instructions.</td> </tr></table><span class="postbody">
<br/>
I think bit 0 of the program counter is set when the CPU is in Thumb mode.
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Doesn't help much for setting breakpoints.
<br/>
<br/>
I believe gdb should tell you if it's trying to set a breakpoint in thumb code or in arm code. I haven't really looked into the details of how source code stepping is acheived.
<br/>
<br/>
You should be able to get away with assuming that code which is currently thumb will still be thumb unless you encounter instructions which modify the program counter ( bx, blx etc)
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">- step into/over individual instructions *in user-space code* (ie not interrupts etc)</td> </tr></table><span class="postbody">
<br/>
So that means you can't use the debugger if your game loop is structured like Super Mario Bros. (NES), where the entire game after the init code is one big vblank handler, right?</span></td> </tr></table><span class="postbody">
<br/>
<br/>
If you allow nested interrupts then you should be able to get away with that.
<br/>
<br/>
Simon: I'd like to take a look at what you have working so far.
<br/>
<br/>
Feature request: zero dependencies on cygwin<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#90960 - simonjhall - Mon Jul 03, 2006 6:45 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">I think bit 0 of the program counter is set when the CPU is in Thumb mode.
<br/>
</td> </tr></table><span class="postbody">
<br/>
Yeah, I read that in the docs. Yet when I disassemble the code from disk, all the code is aligned to 2-byte or 4-byte boundaries. Maybe the final bit of the pc is set but it doesn't affect anything when the cpu fetches the next instruction (if you know what I mean)...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">Doesn't help much for setting breakpoints.
<br/>
</td> </tr></table><span class="postbody">
<br/>
If all I gotta do is test one bit and write a THUMB-specific breakpoint function then it should be easy! (touch wood)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">If you allow nested interrupts then you should be able to get away with that.
<br/>
</td> </tr></table><span class="postbody">
<br/>
Can't believe people can write a game in a v-blank handler :-)
<br/>
But yeah, the only reason it might not work in an exception handler or an interrupt is if interrupts get turned off. Basically anything which prevents the wifi from talking to the PC-side stub is a bad thing.
<br/>
This is another reason why I'm wary of adding support for the ARM7 - I'm worried that if someone dumps down a breakpoint in the wrong place it'll hang the wifi.
<br/>
<br/>
And I'll add you to the list of people I'm gonna send a test version out to if you like. And no, it's not dependent on cygwin. The GDB I currently use is one from the codesourcery site, but it works very well with Insight from devkitpro... It also talks to Eclipse fine too! Can you tell I'm running out of things to write?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#90963 - Dark Knight ez - Mon Jul 03, 2006 7:03 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Can't believe people can write a game in a v-blank handler :-) </td> </tr></table><span class="postbody">
<br/>
I did. As to give the background music decoding engine more time and being able to see that as one giant program... it would be hard to divide that program into small fragments, whereas the regular game is already divided in fragments (of less than a frame).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#90976 - tepples - Mon Jul 03, 2006 7:54 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>simonjhall wrote:</b></span></td> </tr> <tr> <td class="quote">Can't believe people can write a game in a v-blank handler :-) </td> </tr></table><span class="postbody">
<br/>
It's not that hard. Converting a game loop to a vblank ISR involves 1. converting your game loop into the following form, 2. adding a reentrancy guard in stuff() (or alternatively making sure that it never exceeds a million ARM9 cycles in the worst case), and then 3. setting stuff() as your ISR.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">//Frame call normal form
<br/>
void play(void) {
<br/>
  while (!done) {
<br/>
    vsync();
<br/>
    stuff();
<br/>
  }
<br/>
}</td> </tr></table><span class="postbody">
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dark Knight ez wrote:</b></span></td> </tr> <tr> <td class="quote">I did. As to give the background music decoding engine more time and being able to see that as one giant program... it would be hard to divide that program into small fragments</td> </tr></table><span class="postbody">
<br/>
GSM audio comes in frames. MPEG audio also comes in frames. So do tracker formats, where the "tempo" effect  controls how many frames happen in 2.5 seconds. What audio format were you trying to decode?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#91003 - Dark Knight ez - Mon Jul 03, 2006 10:12 pm</h4>
    <div class="postbody"><span class="postbody">I'm using the IT format played by libmikmod.
<br/>
The current setup works like a charm. It was a surprise to hear some other games have set it up like this as well.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#91019 - simonjhall - Tue Jul 04, 2006 12:21 am</h4>
    <div class="postbody"><span class="postbody">I've changed my breakpoint function so that it now runs part of it in an exception handler when the bkpt instruction is called (causes a data abort exception on a machine without debug hardware). The code works, and that big bug I had before has gone, but I've got some beef with a cache.
<br/>
<br/>
Basically the thing now works by hitting a bkpt instrucion, which then goes into the exception handler to save the program counter (the hardest bit to save). It then replaces the bkpt instruction with a jump to the real breakpoint handler which does all the rest of the work. The exception handler then breaks and returns to the original program counter to hit the jump to the bp handler.
<br/>
<br/>
*Except* it keeps hitting the original bkpt opcode over an over again. It might do this ten times or a thousand times until the real jump is hit. I've tried flushing the data cache, but that isn't doing anything. I'm not too sure on how to flush the instruction cache.
<br/>
<br/>
Yet if I read what's at the breakpoint address just before I write the new one, I can confirm that the right value has been written (somewhere), it's just that the old instruction keeps getting run... (so, i-cache?)
<br/>
<br/>
I'm using a modified version of Mighty Max's exception handling code (well, I think it's his!).
<br/>
<br/>
Here's the code which gets me in:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">EnterException:
<br/>
            // store context
<br/>
            LDR r12,=ExceptionLocalStorage
<br/>
            STMIA r12,{r0-r11,r13}
<br/>
            
<br/>
            // assign a stack
<br/>
            LDR r12,=ExceptionStack
<br/>
            LDR r13,[r12]
<br/>
            
<br/>
            // Get C function &amp; call it
<br/>
            LDR r12,=ExceptionC
<br/>
            LDR r12,[r12,#0]
<br/>
            ADD r14,r15,#0
<br/>
            BXNE r12
<br/>
         
<br/>
            // restore context
<br/>
            LDR r12,=ExceptionLocalStorage
<br/>
            LDMIA r12,{r0-r11,r13}
<br/>
            
<br/>
            // do the bios code
<br/>
            .word 0xE8BD5000 
<br/>
            .word 0xEE01CF10 
<br/>
            .word 0xE16FF00E 
<br/>
            .word 0xE8BD5000 
<br/>
            .word 0xE25EF004 </td> </tr></table><span class="postbody">
<br/>
and here's my code:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int hit_count = 0;
<br/>
void Exception(void) {
<br/>
   EnableMPU() ;         // without, console code accessing other mirrors fail
<br/>
   
<br/>
   //iprintf("Exception occured:\n") ;
<br/>
   switch (GetCPSR() &amp;0x1F) {
<br/>
      case 0x1B:
<br/>
         // Undefined instruction occured
<br/>
         break ;
<br/>
      case 0x17:
<br/>
         // General Protection Fault
<br/>
         
<br/>
         if (*(volatile unsigned int *)0x027FFD98 == 0)
<br/>
         {
<br/>
            printf("zero - not good\n");
<br/>
            while(1);
<br/>
            break;
<br/>
         }
<br/>
<br/>
         printf("hit count %d\n", hit_count++);
<br/>
         
<br/>
         int rewritten_opcode = compute_jump(*(volatile unsigned int *)0x027FFD98 - 4, debugger_hit);
<br/>
         int hit_address = *(volatile unsigned int *)0x027FFD98 - 4;
<br/>
         
<br/>
         *(volatile unsigned int *)hit_address = rewritten_opcode;
<br/>
         
<br/>
         break ;
<br/>
      default:
<br/>
         iprintf("  reason: unknown (%02X)\n",GetCPSR() &amp;0x1F) ;
<br/>
         while(1)
<br/>
         break ;
<br/>
   } ;
<br/>
   return ;
<br/>
} ;</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#91026 - gladius - Tue Jul 04, 2006 1:41 am</h4>
    <div class="postbody"><span class="postbody">"mcr p15,0,r0,c7,c5,0" will do a complete Icache flush.  You can do specific regions at a pretty small granularity as well, check out the arm9 docs on mcr to see how to do it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#91029 - wintermute - Tue Jul 04, 2006 2:57 am</h4>
    <div class="postbody"><span class="postbody">as it happens, instruction cache functions have been added to CVS libnds
<br/>
<br/>
<a href="http://devkitpro.sourceforge.net/devkitProWiki/libnds/a00030.html" target="_blank">http://devkitpro.sourceforge.net/devkitProWiki/libnds/a00030.html</a>
<br/>
<br/>
see icache.s for code
<br/>
<br/>
you might also like to take a look at the exception handler API in libnds - it needs extended a little bit to be able to return from an exception though. I haven't got around to decoding the instruction sequence that Mighty Max inserted as raw data.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#91060 - simonjhall - Tue Jul 04, 2006 10:15 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>gladius wrote:</b></span></td> </tr> <tr> <td class="quote">"mcr p15,0,r0,c7,c5,0" will do a complete Icache flush.</td> </tr></table><span class="postbody">
<br/>
That did the trick perfectly, thanks. It also worked if I disabled the i-cache or the d-cache (or both), but I wasn't happy with that solution...
<br/>
<br/>
Disassembling this code,
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">.word 0xE8BD5000 
<br/>
.word 0xEE01CF10 
<br/>
.word 0xE16FF00E 
<br/>
.word 0xE8BD5000 
<br/>
.word 0xE25EF004</td> </tr></table><span class="postbody">
<br/>
gives:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
ldmia   sp!, {ip, lr}
<br/>
mcr     15, 0, ip, cr1, cr0, {0}
<br/>
msr     SPSR_fsxc, lr
<br/>
ldmia   sp!, {ip, lr}
<br/>
subs    pc, lr, #4      ; 0x4</td> </tr></table><span class="postbody">
<br/>
<br/>
Ok I can't crash/deadlock it now, so I'm now gonna clean up the code, slap on some license and copyright junk and release version 0.1 to my testers :-)
<br/>
<br/>
No THUMB yet btw.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#91097 - Mighty Max - Tue Jul 04, 2006 4:08 pm</h4>
    <div class="postbody"><span class="postbody">You can tell if the exception is caused by thumb or arm code by checking the T-bit in SPSR. 
<br/>
<br/>
You can utilize the opcode 0xBExx (BKPT) to cause a prefetch abort in thumb. (ARMv5t)
<br/>
<br/>
---
<br/>
<br/>
I decided to put in the raw words instead of the decoded instruction, was a problem with a false decode that kept crashing. It was the fastest solution.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#91157 - wintermute - Tue Jul 04, 2006 11:08 pm</h4>
    <div class="postbody"><span class="postbody">Any particular reason you copied the bios code rather than just using mov pc,lr after restoring the registers?<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#91158 - mastertop101 - Tue Jul 04, 2006 11:20 pm</h4>
    <div class="postbody"><span class="postbody">or will it work? we'll need to patch our Nds file? it's going to be into a custom firmware? etc.?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#91159 - Mighty Max - Tue Jul 04, 2006 11:24 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">Any particular reason you copied the bios code rather than just using mov pc,lr after restoring the registers?</td> </tr></table><span class="postbody">
<br/>
<br/>
To be honest, i have to admit, i had some problems understanding those 4 lines and i saw no reason to get stuck there if the simple bandaid solution works *g* Never came around to check it again after that ...
<br/>
<br/>
Problems in understanding those lines where the unaligned access to the storage and the movs to restore the old cpu mode. I should have read more in the references.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#91208 - simonjhall - Wed Jul 05, 2006 9:24 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>mastertop101 wrote:</b></span></td> </tr> <tr> <td class="quote">or will it work? we'll need to patch our Nds file? it's going to be into a custom firmware? etc.?</td> </tr></table><span class="postbody">
<br/>
Do you mean how are you going to have to use the debugger? Technically I've not ruled anything out regarding how you can use it. Here's the options I currently got on the cards:
<br/>
- linking each app you wanna debug with the debug stub library and then call the setup functions and you're off, with the wireless command polling function in the main update loop (easy, the current method)
<br/>
- patching executable files with the required changes (hard, a lot of work for no real gain)
<br/>
- a tiny NDS file which pulls the real NDS over the network, inits the debugger, installs the update function in a timer and starts the app (may be unreliable)
<br/>
<br/>
Anyway, I've figured out how to find out if I should write an ARM breakpoint or a THUMB bp now. I'm just trying to decide whether to write that then release it, or just do THUMB at a later date...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#91291 - Abcd1234 - Thu Jul 06, 2006 3:55 am</h4>
    <div class="postbody"><span class="postbody">It strikes me that an earlier release is probably better.  At least then you can get some code out that people can run away with and hammer at. 
<br/>
<br/>
'course, I'll be the first to admit that my opinion is motivated by at least a little selfishness... I'm rather excited about the idea of interactively debugging my NDS apps. :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#91334 - simonjhall - Thu Jul 06, 2006 2:39 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Abcd1234 wrote:</b></span></td> </tr> <tr> <td class="quote">At least then you can get some code out that people can run away with and hammer at. 
<br/>
</td> </tr></table><span class="postbody">
<br/>
I've got to admit, I'm really worried about this! I know that if I put it out there that a) people are gonna have a million problems with it and will require me to solve them and b) if it's not finished when I release v0.1 then people are gonna moan even more! So that'd prob why I keep delaying it.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Abcd1234 wrote:</b></span></td> </tr> <tr> <td class="quote">I'm rather excited about the idea of interactively debugging my NDS apps. :)</td> </tr></table><span class="postbody">
<br/>
I have to say, the very first time I got my demo program to make and stop at a breakpoint, delete it then resume I jumped for joy and bounced around the room, grabbed my housemate (a girl who has no idea what a debugger is) and started yelling stuff at her!
<br/>
<br/>
The novelty has now worn off. Probably because I've had to rewrite the core breakpoint algorithm twice :-(
<br/>
<br/>
Anyway :-) I tried compiling the app last night with -O1 and -O2 last night just to see how it breaks and yeah, it breaks quite nicely. Sorry guys, but you're gonna have to wait again! The good news is that I got stepping to run faster - ~0.6 seconds/opcode when instruction stepping, ~0.4/opcode when line stepping. It's this slow because I still have the wireless sitting on that 50ms timer...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#91382 - EyeballKid - Thu Jul 06, 2006 9:11 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>simonjhall wrote:</b></span></td> </tr> <tr> <td class="quote">I know that if I put it out there that a) people are gonna have a million problems with it and will require me to solve them and b) if it's not finished when I release v0.1 then people are gonna moan even more! So that'd prob why I keep delaying it.</td> </tr></table><span class="postbody">
<br/>
<br/>
I wouldn't worry too much - I think you'd get a lot more positive feedback and good ideas than negative criticism and moaning. I'd just ignore anything negative unless it's accompanied by a patch to fix it :- )
<br/>
I say release early, release often!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#91399 - masscat - Thu Jul 06, 2006 11:53 pm</h4>
    <div class="postbody"><span class="postbody">simonjhall - you have done something that nobody else has and something that will be very useful to many people, so release it and be happy. Some people will moan about bugs and the like but many more will be very positive, appreciative and helpful.
<br/>
It is a strange feeling to release a personal project (especially releasing the source) as people will find bugs and scrutinise your work but having other people find your work useful is a good and you have to release at some point so if it is in some working state it may as well be now. Also, many times, other people's input will improve the project and help motivate you to continue.
<br/>
<br/>
On an aside: from <a class="postlink" href="http://nocash.emubase.de/gbatek.htm#dsvarious" target="_blank">this specification</a>, the DS has a serial port hidden somewhere inside it. Now if this could be found then it would allow a debug connection without the overhead/problems of the wireless interface.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#91410 - simonjhall - Fri Jul 07, 2006 1:02 am</h4>
    <div class="postbody"><span class="postbody">Ta man, thanks for the encouragement.
<br/>
If it makes y'all feel better, I'm writing the (currently pretty long) readme right now.
<br/>
It's gonna go to a few select testers first to weed out the obvious bugs and then out to the general public.
<br/>
<br/>
Slightly off topic, anyone wanna donate some web space for me to host this thing? Preferably a site with other DS homebrew too rather than <a href="http://ftp.genericfreehosting.com/user1234afdf/" target="_blank">ftp.genericfreehosting.com/user1234afdf/</a> etc.
<br/>
<br/>
Oh and I reckon a name for this thing, "Yet Another DS Debugger".
<br/>
Who wants to beat that? :-D</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#91427 - GPFerror - Fri Jul 07, 2006 4:11 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>simonjhall wrote:</b></span></td> </tr> <tr> <td class="quote">Ta man, thanks for the encouragement.
<br/>
If it makes y'all feel better, I'm writing the (currently pretty long) readme right now.
<br/>
It's gonna go to a few select testers first to weed out the obvious bugs and then out to the general public.
<br/>
<br/>
Slightly off topic, anyone wanna donate some web space for me to host this thing? Preferably a site with other DS homebrew too rather than <a href="http://ftp.genericfreehosting.com/user1234afdf/" target="_blank">ftp.genericfreehosting.com/user1234afdf/</a> etc.
<br/>
<br/>
Oh and I reckon a name for this thing, "Yet Another DS Debugger".
<br/>
Who wants to beat that? :-D</td> </tr></table><span class="postbody">
<br/>
<br/>
I would love to help test and would be willing to host it on my site <a href="http://gpf.dcemu.co.uk" target="_blank">http://gpf.dcemu.co.uk</a>
<br/>
<br/>
Im pretty familiar with gdb debugging I use it on the dreamcast and on the pc, just not familiar with asm.
<br/>
<br/>
Troy(GPF)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#91576 - dovoto - Sat Jul 08, 2006 12:22 am</h4>
    <div class="postbody"><span class="postbody">I also have room to host if needed<br/>_________________<br/><a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#91649 - simonjhall - Sat Jul 08, 2006 3:43 pm</h4>
    <div class="postbody"><span class="postbody">Thanks guys for the hosting offers - I'll get back to you. I'm gonna temporarily host it on my ISP space (which I didn't know I had) for a short while though.
<br/>
<br/>
Right - I'm gonna send out some testing versions in a couple of hours to weed out the really obvious problems people are gonna get.
<br/>
But as I know people never read readmes and this isn't your average NDS when you have no need to know how it works, I reckon I ought to put up the instructions now just to make sure people read them :-)
<br/>
<br/>
Check it out, it's pretty big:
<br/>
<a href="http://myweb.tiscali.co.uk/simonhall/README.txt" target="_blank">http://myweb.tiscali.co.uk/simonhall/README.txt</a>
<br/>
You're gonna wanna read it in something that has line wrapping, eg notepad.
<br/>
<br/>
And don't bother hunting for the real thing on that site as there's nothing else there!
<br/>
<br/>
EDIT: it's now gone out to a bunch of people</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#91727 - simonjhall - Sun Jul 09, 2006 1:14 am</h4>
    <div class="postbody"><span class="postbody">For those people who are testing it, I've already fixed one big-ass bug, cleaned up a bunch of code (builds with g++ now) and got it building with ScummVM.
<br/>
So shout if you're getting unexpected results when stepping beq/bneq etc.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#92229 - Ryan FB - Wed Jul 12, 2006 5:48 am</h4>
    <div class="postbody"><span class="postbody">Works for me, and I'm booting the demo via WMB <span style="font-style: italic">and</span> my default WFC connection uses 128-bit WEP.
<br/>
<br/>
My only major complaint is that the Java stub needs privileged ports (&lt;=1024) which on a *nix system means you have to run it as root.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#92329 - simonjhall - Wed Jul 12, 2006 9:04 pm</h4>
    <div class="postbody"><span class="postbody">For those in the know, any idea why I can't get my exception handler to catch invalid instructions/bad memory access/breakpoints in THUMB mode?
<br/>
<br/>
When there's an exception, the chip is supposed to switch to ARM mode then branch to your exception handler, ya? Whether I have the handler installed or not, the machine locks if I throw some kind of exception. When in ARM mode however if I don't have the handler installed the chip just carries on. But in THUMB it'll crash regardless!
<br/>
<br/>
Anyone got any ideas? Or have Nintendo 'customised' this chip?
<br/>
----
<br/>
I was thinking of killing off the exception-based breakpoint system but I realised that in THUMB b/bl instructions can only get you +/-2k (?) which is a bit pants. So I'm either gonna hafta get this exception stuff to work or dot your binary with breakpoint-helper functions!
<br/>
----
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Works for me, and I'm booting the demo via WMB and my default WFC connection uses 128-bit WEP.</td> </tr></table><span class="postbody">
<br/>
Thanks for letting me know, I'll update the readme (for v0.12).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#92340 - Mighty Max - Wed Jul 12, 2006 10:02 pm</h4>
    <div class="postbody"><span class="postbody">Breaking from Thumb mode worked just fine for me, but i guess you are then using thumb code (generated from compiler) in the exception too (the actual handler after the jumb can have both formats). 
<br/>
<br/>
In case of thumb, it is likely that it does some stack operations before you reenable the MPU, which then crashes. Fix: call the EnableMPU from the assembler before you enter the custom handler.
<br/>
<br/>
Erm ... nevermind the handler has an independent stack. But try enabling the MPU earlier anyways<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#92342 - wintermute - Wed Jul 12, 2006 10:46 pm</h4>
    <div class="postbody"><span class="postbody">Have a look at the exception handler code in libnds and the exception test demo, that works fine for me with thumb code.
<br/>
<br/>
<a class="postlink" href="http://devkitpro.cvs.sourceforge.net/devkitpro/libnds/source/arm9/exceptionHandler.s?revision=1.2&amp;view=markup" target="_blank">Exception handler</a>
<br/>
<br/>
<a class="postlink" href="http://devkitpro.cvs.sourceforge.net/devkitpro/examples/nds/debugging/exceptionTest/source/exceptionTest.c?revision=1.2&amp;view=markup" target="_blank">Exception test</a>
<br/>
<br/>
<a class="postlink" href="http://devkitpro.cvs.sourceforge.net/devkitpro/libnds/source/arm9/gurumeditation.c?revision=1.5&amp;view=markup" target="_blank">The error display code</a>
<br/>
<br/>
As it happens I'm considering just shifting to arm mode for libnds - while thumb is more size efficient and you get a hit from the 16bit ewram for arm mode the cache makes up the difference quite well.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#92343 - Mighty Max - Wed Jul 12, 2006 11:28 pm</h4>
    <div class="postbody"><span class="postbody">:) It's time for me to switch to the newer releases ... im just lazy when it comes to such *g*
<br/>
<br/>
<br/>
Btw wintermute, you know i am not much caring about what ppl do with code i give out to the public. But reading through the licence gives me a bad feeling. "you must not claim that you wrote the original software." is a rule i obviously break on some of the lines in these files.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#92352 - wintermute - Thu Jul 13, 2006 12:43 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">:) It's time for me to switch to the newer releases ... im just lazy when it comes to such *g*
<br/>
<br/>
<br/>
Btw wintermute, you know i am not much caring about what ppl do with code i give out to the public. But reading through the licence gives me a bad feeling. "you must not claim that you wrote the original software." is a rule i obviously break on some of the lines in these files.</td> </tr></table><span class="postbody">
<br/>
<br/>
Not sure what you mean here. Using libnds doesn't magically make your code our work - the clause is intended for people who want to distribute modified versions of the library and direct people to the right place for contributing changes back to the main project.
<br/>
<br/>
The exception handler code is based largely on the work you did, I just haven't got around to adding your name into the source in CVS yet.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#92407 - Mighty Max - Thu Jul 13, 2006 12:31 pm</h4>
    <div class="postbody"><span class="postbody">late in the night, a worrying missread, just ignor me ;)<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#92560 - dovoto - Thu Jul 13, 2006 10:20 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
As it happens I'm considering just shifting to arm mode for libnds - while thumb is more size efficient and you get a hit from the 16bit ewram for arm mode the cache makes up the difference quite well.</td> </tr></table><span class="postbody">
<br/>
<br/>
Can the cache hold twice as many thumb instructions as arm ?  If so it seems like you might be effictivly reducing your instruction cache by a factor of two and slowing down ewram access by choosing arm over thumb. I may just be confused :)<br/>_________________<br/><a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#92566 - masscat - Thu Jul 13, 2006 11:06 pm</h4>
    <div class="postbody"><span class="postbody">Good work on the debugger - a very useful tool to have (no more printing to the console).
<br/>
<br/>
I was wondering why you use the Java stub and do not just connect GDB directly with the DS.
<br/>
Somewhat selfish reason for asking - I was thinking about building a RS232 port using the SPI IO of the DS card slot with a micro controller to do the SPI UART bridge. If your DS debugger stub accepts GDB Remote Serial Protocol commands then to debug over the serial port would only require changing the packet read/send functions on the DS.
<br/>
And why debug over a wired connection? Well I want to play around with the wireless hardware some more and having a debugger would be very useful.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#92575 - wintermute - Thu Jul 13, 2006 11:37 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>dovoto wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
As it happens I'm considering just shifting to arm mode for libnds - while thumb is more size efficient and you get a hit from the 16bit ewram for arm mode the cache makes up the difference quite well.</td> </tr></table><span class="postbody">
<br/>
<br/>
Can the cache hold twice as many thumb instructions as arm ?  If so it seems like you might be effictivly reducing your instruction cache by a factor of two and slowing down ewram access by choosing arm over thumb. I may just be confused :)</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Well that was actually one of my original thoughts behind the whole thumb business. The cache does indeed hold twice as many thumb instructions but 4k is actually a rather large loop even for C code so, in the general case, ARM is quite a bit faster than thumb. While ARM instructions are twice as big, you can do more with a single instruction and it all seems to balance out.
<br/>
<br/>
I'm still undecided as yet though.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#92577 - Mighty Max - Thu Jul 13, 2006 11:42 pm</h4>
    <div class="postbody"><span class="postbody">When switching from thumb to arm, the size of your compiled code doesn't double. iirc (and im not quite sure) the average factor from switching from thumb to arm was about x1.5 in my tests.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#92610 - wintermute - Fri Jul 14, 2006 2:47 am</h4>
    <div class="postbody"><span class="postbody">A reliable source informs me that the size ratio is around 0.6:1 and speed is 0.7:1 ( thumb:arm).
<br/>
<br/>
Another option I was considering was to build libnds as both thumb and arm and leave the choice up to the user but it appears that the -mthumb option only does the right thing inside the system folders.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#92647 - simonjhall - Fri Jul 14, 2006 9:51 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>masscat wrote:</b></span></td> </tr> <tr> <td class="quote">I was wondering why you use the Java stub and do not just connect GDB directly with the DS.</td> </tr></table><span class="postbody">
<br/>
Check out the readme :-) Ease of development was a main point, as I didn't have a debugger whilst developing it (in fact I still can't debug my own stuff as debugging a debugger with a debugger is not cool). But developing the Java side of things was much easier as I could use an existing debugger to figure out what was going on. PLUS the monster amount of console output this thing generates would just be an arse on a DS screen. I have an extra screen on my PC just so I can try and follow what's going on!
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">If your DS debugger stub accepts GDB Remote Serial Protocol commands then to debug over the serial port would only require changing the packet read/send functions on the DS.</td> </tr></table><span class="postbody">
<br/>
The Java part translates all the complex GDB functions to memory reads and writes, so all you gotta do (if you wanted to use my thing) is to replace the functions which get data on and off the DS. The DS contains no debugging state info (eg addresses of breakpoints or rewritten instructions).
<br/>
You'd need to change the Java to use a serial interface, rather than a network socket, but the rest should be the same... I don't recommend writing your own GDB interface yourself as it's not as well documented as you'd think!
<br/>
<br/>
----
<br/>
<br/>
THUMB - I've gotta try and find some time to figure out why I can't throw an exception, but I'm kinda busy at the moment.
<br/>
<br/>
And debugging interrupts - are nested interrupts possible? I had a very quick test of renabling the wifi interrupts in my vblank hander, but I couldn't get that to work... (again, a very quick test).
<br/>
<br/>
AND! In the ARM spec it says that in IRQ mode that only r13 and r14 are banked registers. How come then in the interrupt handler r0-r12 aren't saved on entry and then restored on exit? Is there some BIOS code I've not yet seen?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#92907 - Mighty Max - Sat Jul 15, 2006 2:22 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>simonjhall wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
AND! In the ARM spec it says that in IRQ mode that only r13 and r14 are banked registers. How come then in the interrupt handler r0-r12 aren't saved on entry and then restored on exit? Is there some BIOS code I've not yet seen?</td> </tr></table><span class="postbody">
<br/>
<br/>
Yes. The bios saves the registers that can be altered but are not restored by functions (namely r0-r3 and r12).
<br/>
<br/>
<a href="http://www.bottledlight.com/ds/index.php/Main/Interrupts" target="_blank">http://www.bottledlight.com/ds/index.php/Main/Interrupts</a><br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#92910 - wintermute - Sat Jul 15, 2006 2:48 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>bios code wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
loc_FFFF0274
<br/>
      STMFD   SP!, {R0-R3,R12,LR}
<br/>
      MRC   p15, 0,   R0,c9,c1
<br/>
      MOV   R0, R0,LSR#12
<br/>
      MOV   R0, R0,LSL#12
<br/>
      ADD   R0, R0,   #0x4000
<br/>
      ADR   LR, loc_FFFF0290
<br/>
      LDR   PC, [R0,#-4]
<br/>
<br/>
loc_FFFF0290
<br/>
      LDMFD   SP!, {R0-R3,R12,LR}
<br/>
      SUBS   PC, LR,   #4
<br/>
</td> </tr></table><span class="postbody">
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Another point in favour of the java gdb proxy is the caching that's been implemented there. I'd imagine things would be a bit slow otherwise - Insight appears to request data from the proxy when you hover over a variable which surprised me.
<br/>
<br/>
With the libnds interrupt system use REG_IME=1 at the start of your VBlank handler to allow nesting of other interrupts. You should probably do this after any code which needs to execute within the vblank period.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#92912 - Mighty Max - Sat Jul 15, 2006 3:04 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<br/>
With the libnds interrupt system use REG_IME=1 at the start of your VBlank handler to allow nesting of other interrupts. You should probably do this after any code which needs to execute within the vblank period.</td> </tr></table><span class="postbody">
<br/>
<br/>
Don't forget the I-Bit in CPSR.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#92917 - wintermute - Sat Jul 15, 2006 4:09 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<br/>
With the libnds interrupt system use REG_IME=1 at the start of your VBlank handler to allow nesting of other interrupts. You should probably do this after any code which needs to execute within the vblank period.</td> </tr></table><span class="postbody">
<br/>
<br/>
Don't forget the I-Bit in CPSR.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
uh, read the code in the libnds interrupt dispatcher :P<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
