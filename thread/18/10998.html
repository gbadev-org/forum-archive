<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Using 2 exrot. bg's with different palettes? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Using 2 exrot. bg's with different palettes?</h2>
<div id="posts">
<div class="post">
    <h4>#100768 - ThomasS - Wed Aug 30, 2006 12:45 pm</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
I want to use 2 extended rotation backgrounds (Mode 5). Code for loading one of them:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">    BG3_CR = BG_BMP8_256x256 + BG_BMP_BASE(0);
<br/>
    BG3_XDX = 1 &lt;&lt; 8;
<br/>
    BG3_XDY = 0;
<br/>
    BG3_YDX = 0;
<br/>
    BG3_YDY = 1 &lt;&lt; 8;
<br/>
    BG3_CX = 0 &lt;&lt; 8;
<br/>
    BG3_CY = 0 &lt;&lt; 8;
<br/>
<br/>
    dmaCopy(Title_bin, (uint16*)(BG_BMP_RAM(0), 256*256);
<br/>
    dmaCopy(TitlePal_bin, BG_PALETTE, 256*2);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
The background alone is displayed ok, but I want the other background to use a different palette:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">    dmaCopy(OtherPal_bin, BG_PALETTE + 256*2, 256*2);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
But how can I tell the DS which palette a BG should use?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100770 - Lick - Wed Aug 30, 2006 1:13 pm</h4>
    <div class="postbody"><span class="postbody">There is a limitation to the size of the background palette. The max. number of colors is 256. For 16-color palettes this would mean there is room for 16 different palettes, but for 256-color palettes, do the math, there's only room for 1. 
<br/>
You'll have to switch to high color. (ATTR0_BMP)<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100779 - knight0fdragon - Wed Aug 30, 2006 2:18 pm</h4>
    <div class="postbody"><span class="postbody">thst is not true,  there is something called extended palette
<br/>
<br/>
<br/>
you may need somethings do do this:
<br/>
<br/>
<br/>
place this in your display CR
<br/>
<br/>
  DISPLAY_BG_EXT_PALETTE
<br/>
<br/>
<br/>
you will need one of these in your BG_CR, depending on the BG#
<br/>
<br/>
BG_PALETTE_SLOT0 
<br/>
 BG_PALETTE_SLOT1
<br/>
 BG_PALETTE_SLOT2
<br/>
 BG_PALETTE_SLOT3
<br/>
<br/>
note BG_PALETTE 0 and 1 are the same,  along with 2 and 3 being the same
<br/>
<br/>
BG0 can be used with the BG_PALETTE_SLOT2 and 
<br/>
BG1 can be swapped with the BG_PALETTE_SLOT3 also 
<br/>
<br/>
if you are using slo
<br/>
<br/>
to write to the extended palette
<br/>
<br/>
   vramSetBankF( VRAM_F_LCD ); 
<br/>
// copy the palette date to VRAM_F at this point
<br/>
   vramSetBankF( VRAM_F_BG_EXT_PALETTE  );<br/>_________________<br/><a href="http://www.myspace.com/knight0fdragonds" target="_blank">http://www.myspace.com/knight0fdragonds</a>
<br/>
<br/>
MK DS FC: Dragon 330772 075464 
<br/>
AC WW FC: Anthony SamsClub 1933-3433-9458 
<br/>
MPFH: Dragon 0215 4231 1206</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100788 - ThomasS - Wed Aug 30, 2006 4:19 pm</h4>
    <div class="postbody"><span class="postbody">Ok, thank you! I'll try it soon ...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100800 - ThomasS - Wed Aug 30, 2006 6:15 pm</h4>
    <div class="postbody"><span class="postbody">I can't get it to work ...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">you will need one of these in your BG_CR, depending on the BG#
<br/>
<br/>
BG_PALETTE_SLOT0
<br/>
BG_PALETTE_SLOT1
<br/>
BG_PALETTE_SLOT2
<br/>
BG_PALETTE_SLOT3
<br/>
<br/>
note BG_PALETTE 0 and 1 are the same, along with 2 and 3 being the same </td> </tr></table><span class="postbody">
<br/>
<br/>
Putting BG_PALETTE_SLOT2 or 3 in the BG_CR only activates wrapping:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define BG_WRAP_ON     (1 &lt;&lt; 13)
<br/>
<br/>
// ==
<br/>
<br/>
#define BIT(n) (1 &lt;&lt; (n))
<br/>
#define BG_PALETTE_SLOT3 BIT(13)
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
And why are BG_PALETTE_SLOT0 and 1 / 2 and 3 the same?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100848 - knight0fdragon - Thu Aug 31, 2006 2:43 am</h4>
    <div class="postbody"><span class="postbody">only 4 palettes are needed, one for each background, so i guess naturally the hardware just knows what the palettee is, be that if using BG1. it knows that the palette starts at 512<br/>_________________<br/><a href="http://www.myspace.com/knight0fdragonds" target="_blank">http://www.myspace.com/knight0fdragonds</a>
<br/>
<br/>
MK DS FC: Dragon 330772 075464 
<br/>
AC WW FC: Anthony SamsClub 1933-3433-9458 
<br/>
MPFH: Dragon 0215 4231 1206</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100849 - knight0fdragon - Thu Aug 31, 2006 2:50 am</h4>
    <div class="postbody"><span class="postbody">according to gbatek  slots are only used for BG0 and 1<br/>_________________<br/><a href="http://www.myspace.com/knight0fdragonds" target="_blank">http://www.myspace.com/knight0fdragonds</a>
<br/>
<br/>
MK DS FC: Dragon 330772 075464 
<br/>
AC WW FC: Anthony SamsClub 1933-3433-9458 
<br/>
MPFH: Dragon 0215 4231 1206</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100881 - ThomasS - Thu Aug 31, 2006 10:09 am</h4>
    <div class="postbody"><span class="postbody">I can't get the backgrounds to use extended palettes:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   videoSetMode(MODE_5_2D | DISPLAY_BG3_ACTIVE | DISPLAY_BG2_ACTIVE | DISPLAY_BG_EXT_PALETTE); 
<br/>
<br/>
   BG3_CR = BG_BMP8_256x256 | BG_BMP_BASE(0);
<br/>
<br/>
    BG3_XDX = 1 &lt;&lt; 8;
<br/>
    BG3_XDY = 0;
<br/>
    BG3_YDX = 0;
<br/>
    BG3_YDY = 1 &lt;&lt; 8;
<br/>
<br/>
    BG3_CX = 0 &lt;&lt; 8;
<br/>
    BG3_CY = 0 &lt;&lt; 8;
<br/>
<br/>
   u16 bg_number = 3;
<br/>
<br/>
   dmaCopy(Title_bin, (uint16*)(BG_BMP_RAM(0)), 256*256);   // Copy bitmap data ...
<br/>
   vramSetBankF(VRAM_F_LCD);
<br/>
   dmaCopy(TitlePal_bin, VRAM_F + (bg_number * 256*2), 256*2);   // Copy palette data ...
<br/>
   vramSetBankF(VRAM_F_BG_EXT_PALETTE);</td> </tr></table><span class="postbody">
<br/>
<br/>
... doesn't work - only a black screen appears. It works only if I copy the palette to <span style="font-weight: bold">BG_PALETTE</span> instead of <span style="font-weight: bold">VRAM_F + (bg_number * 256*2)</span>.
<br/>
And it seems like it doesn't matter if I set DISPLAY_BG_EXT_PALETTE or not - it only works if I copy the palette directly to BG_PALETTE, without any offset depending on the BG# ... help!</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
