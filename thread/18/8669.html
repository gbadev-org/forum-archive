<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>8 bit texture example, lights and bone animation? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > 8 bit texture example, lights and bone animation?</h2>
<div id="posts">
<div class="post">
    <h4>#72834 - Webez - Wed Feb 22, 2006 1:29 am</h4>
    <div class="postbody"><span class="postbody">Hi.
<br/>
<br/>
Does someone have an example of how to load 8 bit textures?
<br/>
And a light example (the one in the examples folder doesn't work for me)? 
<br/>
<br/>
As for the second thing. I have implemented a milkshape loader including bones. It works (even animations) but it is too slow (i think 15 fps without animations and 10 fps with them) because each time that vertex have to be drawn they have to multiplied (a lot of work). I would like to change things so I can just tranform them with the model matrix multiplied by each bone absolute matrix. Someone can help me or point in the right direction (I am very bad at matrix and vector maths)?  (Quite bad explanation but someone who knows about this should understand... or so I hope)
<br/>
<br/>
Thanks!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#73043 - Webez - Wed Feb 22, 2006 11:42 pm</h4>
    <div class="postbody"><span class="postbody"><a class="postlink" href="http://www.4shared.com/file/857698/31ffbfc1/bones.html" target="_blank">http://www.4shared.com/file/857698/31ffbfc1/bones.html</a>
<br/>
<br/>
I have uploaded a demo that shows the current state of the ms3d loader. One transforms each vertex each time it has to be drawn. As it can be seen fps are awful because of this operations. The second one uses the modelview matrix multplied by the final matrix of each bone. The problem with this is that then I have to group polygons by their bone. But a polygon has 3 vertex and each one can be relative to a different bone. So they can be first tranformed by the inverse of one matrix and then multplied by another (the one I select for the group) . So the model gets screwed. Is it impossible to group polygons by bone? Then how can display lists be made?
<br/>
<br/>
Thanks!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#73163 - ishraam - Thu Feb 23, 2006 6:22 pm</h4>
    <div class="postbody"><span class="postbody">I have exactly the same pbm -_-.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#73170 - Webez - Thu Feb 23, 2006 7:08 pm</h4>
    <div class="postbody"><span class="postbody">So close, so far</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#73172 - ecurtz - Thu Feb 23, 2006 7:34 pm</h4>
    <div class="postbody"><span class="postbody">I'm hardly a 3D expert, but I think the problem is you're treating the polygons as though they are attached to the bones rather than the vertices. You can change the matrix between vertices of the same polygon if you need to.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#73176 - Webez - Thu Feb 23, 2006 7:56 pm</h4>
    <div class="postbody"><span class="postbody">So you say something like this?
<br/>
<br/>
glBegin(GL_TRIANGLES);
<br/>
     for (all poligons){
<br/>
           matrix=bone[vertexA.bone].matrix;
<br/>
           pushmatrix()
<br/>
                glmultmatrix(matrix)
<br/>
                glvertex(vertexA.x,vertexA.y,vertexA.z)
<br/>
          popmatrix()      
<br/>
          .......  (the same for vertexA and vertexB)
<br/>
     }
<br/>
glEnd();
<br/>
<br/>
<br/>
I thought you could only could pushmatrix before glBegin not inside. Even I think I tried that (I am really trying everything).  I'll try again with that and see what happens. 
<br/>
<br/>
But if I do that it is impossible to use display lists.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#73183 - ishraam - Thu Feb 23, 2006 8:45 pm</h4>
    <div class="postbody"><span class="postbody"><span style="font-weight: bold">ecurtz </span> : I am treating the vertices as attached to bones, but I FEAR the impact of loading for each vertice its bone matrix. So I intended to minimize the number of time I load a matrix, hence grouping verts by bone. 
<br/>
<br/>
The problem is you draw faces not verts. I mean a triangle to be drawn has to "send its vertices to the hardware". So it's not "grouping verts by bone" but "grouping faces by bone" (even if in fact its the verts that are linked to bones, yeah). Which is not quite possible AFAIK - except if you affect a "submesh" to a bone, but what about elbows, knees, etc. ?
<br/>
<br/>
<span style="font-weight: bold">Webez</span>: using display list might still be possible, providing they're a little bit dynamic. The only condition would be that the matrices specified in the display lists are reevaluated each time a display list is used. 
<br/>
That would allow to update the bone matrices, and have them properly used in the rendering process.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#73184 - ecurtz - Thu Feb 23, 2006 9:06 pm</h4>
    <div class="postbody"><span class="postbody">Sorry, I thought you were talking about the case using display lists. In that case you can do the following.
<br/>
<br/>
Calculate the matrix for each bone and MatrixStore it in the matrix stack.
<br/>
Embed MatrixRestore commands into your display list when the active bone changes.
<br/>
Dump the display list onto hardware.
<br/>
<br/>
This requires exporting the data into DS specific formats, but it dramatically reduces the amount of calculation you're doing at runtime (which is good.)
<br/>
<br/>
ishraam - have you tried using MatrixStore/MatrixRestore instead of MatrixPop/MatrixPush? i.e. Put all the matrices onto the stack before glBegin and change the active one. I THINK that should work.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
