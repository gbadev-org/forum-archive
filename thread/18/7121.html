<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Dodgy touchscreen readings at top corners - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Dodgy touchscreen readings at top corners</h2>
<div id="posts">
<div class="post">
    <h4>#56764 - Zapf_Bandit - Tue Oct 11, 2005 9:21 am</h4>
    <div class="postbody"><span class="postbody">I am having very irritating issues with the touchscreen.
<br/>
<br/>
I am making a Maze game and I have the maze take the whole screen using tiles 8x8 to build it.
<br/>
<br/>
All is great when I am near the middle of the screen and the stylus position is nice and accurate.
<br/>
<br/>
Unfortunately it all falls to pieces when I try and use either of the top corners.
<br/>
<br/>
I can't even get within 8 pixels of the left hand side and the top right corner behaves differently if going upwards or coming down !!!
<br/>
<br/>
Has anyone else had similar problems such as this?
<br/>
<br/>
Before anyone asks I HAVE calibrated my stylus multiple times testing different offsets to no avail.
<br/>
<br/>
Thanks in Advance,
<br/>
Zapf Bandit</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#56765 - josath - Tue Oct 11, 2005 9:24 am</h4>
    <div class="postbody"><span class="postbody">does this happen in other homebrew, or just the one you wrote?
<br/>
<br/>
try this, and see if it has the same problem: <a href="http://devkitpro.kicks-ass.org/devkitPro/touch_test.nds" target="_blank">http://devkitpro.kicks-ass.org/devkitPro/touch_test.nds</a> (by WinterMute)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#56769 - Onori - Tue Oct 11, 2005 10:16 am</h4>
    <div class="postbody"><span class="postbody">I had the same problem using the method in old version of sdk example (IPC-&gt;touchX / IPC-&gt;touchY) that worked on emulator, then I used IPC-&gt;touchXpx IPC-&gt;touchYpx (that don't work on emulator like ideas) but it work quite fine on real DS</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#56809 - Maverick - Tue Oct 11, 2005 7:10 pm</h4>
    <div class="postbody"><span class="postbody">write a mini program that plots a white pixel at the touch screen coordinate and run some tests to see what the pixel plotting behaviour is</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#56848 - cybereality - Tue Oct 11, 2005 11:14 pm</h4>
    <div class="postbody"><span class="postbody">Its seems that other people have had those problems too. My DS seems to get the touch readings decent, just a little jittery (+-2) if you press nice and hard. If you just lightly graze the screen it gives horriblely inaccurate readings leaning toward the lower left hand corner (0,198). I heard that there were different touch screens produced for different models, so we may not even have the same exact hardware.
<br/>
<br/>
I put together this little test program that outputs touch readings. It gives the raw data and also some averaged values that are more accurate (but delayed because it is an average). It also displays a crosshair on screen so it is easy to see what it going wrong. I was going to fix it so it used the timer interupts to get the readings instead of the vblank, but I never got a chance to finish it. Anyway, I figured it might be useful to some people so here it is for download (source, nds &amp; nds.gba included):
<br/>
<br/>
<a class="postlink" href="http://www.cybereality.com/files/touch.zip" target="_blank">TOUCH SCREEN TEST PROGRAM</a><br/>_________________<br/><a class="postlink" href="http://www.cybereality.com" target="_blank">// cybereality</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#56859 - headspin - Wed Oct 12, 2005 12:15 am</h4>
    <div class="postbody"><span class="postbody">Check out the code at the end of this <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=6409" target="_blank">thread</a>. It sounds like your not reading the calibration offsets.<br/>_________________<br/><a class="postlink" href="http://headsoft.com.au/index.php?category=warhawk" target="_blank">Warhawk DS</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=mmll" target="_blank">Manic Miner: The Lost Levels</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=tdg" target="_blank">The Detective Game</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#56895 - Zapf_Bandit - Wed Oct 12, 2005 5:14 am</h4>
    <div class="postbody"><span class="postbody">Whoa, so many replies, you guys are great.
<br/>
<br/>
I am both happy and sad to say none of these things helped...
<br/>
<br/>
I tested with cyberreality's app and got exactly the same behaviours I experience. The top left corner gives me (9,0).
<br/>
<br/>
I implemented the code recommended by headspin since I was using hard coded constants for the calibration positions but this did nothing either.
<br/>
<br/>
I have already tried Mavrick's suggestion of ploting the pos and both the top corners are not reached.
<br/>
<br/>
I am really at a loss... With Nintendogs I can move my cursor anywhere... What am I doing wrong???
<br/>
<br/>
Zapf</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#56907 - Defect - Wed Oct 12, 2005 6:03 am</h4>
    <div class="postbody"><span class="postbody">I'm thinking it might be to do with the plastic cover on the touch screen, it may not flex enough to allow the stylus to get right into the corners?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#56928 - Dark Knight ez - Wed Oct 12, 2005 9:03 am</h4>
    <div class="postbody"><span class="postbody">No. That can't be it.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">With Nintendogs I can move my cursor anywhere</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#56939 - headspin - Wed Oct 12, 2005 11:46 am</h4>
    <div class="postbody"><span class="postbody">We are aware that the touchscreen processing of homebrew is not as good as commerical games. We are still yet to figure out why. The fact that the other homebrew you tested does the same thing suggests that it's not your code that is at fault but the accuracy issues of the library itself.
<br/>
<br/>
To quote wintermute on the latest release of devkitARM r16..
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Touch code has been tidied and stabilised slightly. There is still some work to do on this.</td> </tr></table><span class="postbody"><br/>_________________<br/><a class="postlink" href="http://headsoft.com.au/index.php?category=warhawk" target="_blank">Warhawk DS</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=mmll" target="_blank">Manic Miner: The Lost Levels</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=tdg" target="_blank">The Detective Game</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#57018 - Zapf_Bandit - Thu Oct 13, 2005 1:19 am</h4>
    <div class="postbody"><span class="postbody">I'm not sure but I think that the calibration is non-linear. When calibrating the DS asks for 3 points not 2. I am really going to try and improve this behaviour in my code since at the moment it is a quite big limitation on the game designs I want to make since I need to avoid certain areas on screen.
<br/>
<br/>
Is the value returned from the libnds "touchRead(TSC_MEASURE_X)" just a value of somewhere in memory of is some other processing done to it beforehand?
<br/>
<br/>
If it is processed where can I find the raw values?
<br/>
<br/>
Thanks,
<br/>
Zapf Bandit</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#57036 - josath - Thu Oct 13, 2005 4:45 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Zapf_Bandit wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Is the value returned from the libnds "touchRead(TSC_MEASURE_X)" just a value of somewhere in memory of is some other processing done to it beforehand?
<br/>
<br/>
If it is processed where can I find the raw values?</td> </tr></table><span class="postbody">
<br/>
<br/>
Did you even look at the code for touchRead()? It's fairly simple, like 15 lines, with a bunch of comments explaining each step. Right below that function is the one that takes all the calibration offsets into account, touchReadXY(), which is used in the arm7 template to store values into the IPC, which can be read on the arm9.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#57050 - cybereality - Thu Oct 13, 2005 9:43 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>headspin wrote:</b></span></td> </tr> <tr> <td class="quote">We are aware that the touchscreen processing of homebrew is not as good as commerical games.</td> </tr></table><span class="postbody">
<br/>
<br/>
You'd actually be surprised. I was figuring the same thing, but I ran some tests and some commercial games have the same problems. They are probably doing some form of interpolation on the raw data. The game I noticed it a bunch on was Need for Speed, but it also was in Feel the Magic (which relies on the stylus). Try it out on your DS, you'll see.<br/>_________________<br/><a class="postlink" href="http://www.cybereality.com" target="_blank">// cybereality</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#57060 - Didou - Thu Oct 13, 2005 12:28 pm</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
It appeared to me on ReboNDS that using the good old IPC-&gt;touchX works fine both on hardware and emulator.
<br/>
On the other side, using the touchRead () of libnds really give strange results.
<br/>
So I decided to keep my own old way,usign the hard coded famous constants...
<br/>
<br/>
  -- Didou</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#57079 - Mollusk - Thu Oct 13, 2005 4:37 pm</h4>
    <div class="postbody"><span class="postbody">the only problem with that is that some people don't have good stylus positions at all, depending on the touch screen ! 
<br/>
<br/>
I did some quick testing, and at one point I had a nearly perfect touch code for me (maximum 1-2 pixels off in the top corner, perfect everywhere), but for some people, it was... 20 pixels off ! So I went back to using the calibration, which isn't as good for me, but fairly good for everyone...<br/>_________________<br/>PAlib official forum : <a class="postlink" href="http://www.palib.info" target="_blank">http://www.palib.info</a>
<br/>
PAlib official tutorials: <a class="postlink" href="http://www.palib.info/wiki" target="_blank">http://www.palib.info/wiki</a>
<br/>
Updates, help, code examples, tutorials, etc...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#57097 - headspin - Thu Oct 13, 2005 7:28 pm</h4>
    <div class="postbody"><span class="postbody">There have been various ideas thrown around <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=6786" target="_blank">this thread</a> on how to improve the touchscreen readings.<br/>_________________<br/><a class="postlink" href="http://headsoft.com.au/index.php?category=warhawk" target="_blank">Warhawk DS</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=mmll" target="_blank">Manic Miner: The Lost Levels</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=tdg" target="_blank">The Detective Game</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
