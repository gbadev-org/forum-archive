<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Choppy performance - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Choppy performance</h2>
<div id="posts">
<div class="post">
    <h4>#103864 - TheWopr - Mon Sep 25, 2006 1:04 am</h4>
    <div class="postbody"><span class="postbody">Still working on the same game, if you don't know what it is check my other posts, and i've come across another problem.  My program runs at a good speed, but its really choppy, sometimes it goes slower and then jumps faster. 
<br/>
<br/>
I have a feeling i know whats wrong, i'm not waiting for the vblank.  My problem is that i'm using mode_5_2D for my main screen, but all the tutorials i've seen that wait for the vblank, are in Framebuffer mode, i tried copying their code anyway but it keeps returning a whole bunch of errors.  Anyone have code for waiting for the vblank on mode_5? If this is even my problem? Thanks in advance</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#103891 - josath - Mon Sep 25, 2006 5:03 am</h4>
    <div class="postbody"><span class="postbody">in your init code, put:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">irqInit();
<br/>
irqSet(IRQ_VBLANK, 0);</td> </tr></table><span class="postbody">
<br/>
<br/>
then to wait for vblank, call:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">          swiWaitForVBlank();</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#103989 - TheWopr - Mon Sep 25, 2006 9:21 pm</h4>
    <div class="postbody"><span class="postbody">Ok i tried that and heres my code, above it i used irq_init() and irqSet(IRQ_VBLANK, 0);
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   while(1) {
<br/>
      scanKeys();
<br/>
      doInputStuff();   
<br/>
      updatePlayers();
<br/>
      BG_GFX[(int)(player1.x + ((int)player1.y)*256)] = RGB15(0,31,0) | BIT(15);
<br/>
      swiWaitForVBlank();
<br/>
   }</td> </tr></table><span class="postbody">
<br/>
<br/>
Now all it does is pause until I hit a key or something, it stops in the while loop whenever it gets to swiWaitForVBlank().  As you can tell i'm just polling for the key's.  Thats pretty much it, any more help?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#103995 - Lick - Mon Sep 25, 2006 9:33 pm</h4>
    <div class="postbody"><span class="postbody">Please show us doInputStuff, I think the problem lies in that function.<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#103996 - TheWopr - Mon Sep 25, 2006 9:35 pm</h4>
    <div class="postbody"><span class="postbody">Hope this isn't too long for the forum but here it goes.....
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void doInputStuff() {
<br/>
<br/>
    if(keysDown() &amp; KEY_UP) {
<br/>
              player1.dy = -player1.speed; }
<br/>
    if(keysDown() &amp; KEY_DOWN){
<br/>
              player1.dy = player1.speed;  }
<br/>
    if(keysDown() &amp; KEY_LEFT){
<br/>
              player1.dx = -player1.speed; }
<br/>
    if(keysDown() &amp; KEY_RIGHT){
<br/>
              player1.dx = player1.speed; }
<br/>
    if(keysUp() &amp; KEY_UP) {
<br/>
              player1.dy = 0; }
<br/>
    if(keysUp() &amp; KEY_DOWN){
<br/>
              player1.dy = 0; }
<br/>
    if(keysUp() &amp; KEY_LEFT){
<br/>
              player1.dx = 0; }
<br/>
    if(keysUp() &amp; KEY_RIGHT){
<br/>
              player1.dx = 0; }
<br/>
}</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#103998 - Lick - Mon Sep 25, 2006 9:39 pm</h4>
    <div class="postbody"><span class="postbody">Weird, I see nothing wrong with it.. =/<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#103999 - TheWopr - Mon Sep 25, 2006 9:47 pm</h4>
    <div class="postbody"><span class="postbody">Wow, sorry guys, i realized that what i did was that the keyUp() had it set the speed back to 0 which i didn't even think of &gt;.&lt; i know how to fix it now but thanks for the help lick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104000 - sajiimori - Mon Sep 25, 2006 9:55 pm</h4>
    <div class="postbody"><span class="postbody">That approach can be fragile sometimes, and bugs can lead to getting stuck going in a direction.  I'd recommend clearing your velocity every tick and then adding to it based on input.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104006 - TheWopr - Mon Sep 25, 2006 11:02 pm</h4>
    <div class="postbody"><span class="postbody">Sajiimori: I see what your saying, but in this game i actually want people to stay in the direction that they press, similar games would be Surround(Atari) Tron(Atari) Nibbles(Everything) and I'm sure there are plenty of others.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104007 - sajiimori - Mon Sep 25, 2006 11:05 pm</h4>
    <div class="postbody"><span class="postbody">Oh, I guess I was confused because you were clearing velocity when the key is released.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
