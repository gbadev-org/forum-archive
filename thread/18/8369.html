<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Using 2D+3D hardware together on one screen? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Using 2D+3D hardware together on one screen?</h2>
<div id="posts">
<div class="post">
    <h4>#69720 - Extreme Coder - Wed Feb 01, 2006 2:57 pm</h4>
    <div class="postbody"><span class="postbody">Hello.
<br/>
I was trying to use the 2d (tiles+pals+sprites), with the 3d OGL hardware on the same screen. But only the 3d stuff appears. Here's the code I do for initalizing:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   // Turn on everything
<br/>
   powerON(POWER_ALL);
<br/>
   
<br/>
   // Setup the Main screen for 3D 
<br/>
   videoSetMode(MODE_0_3D|DISPLAY_BG1_ACTIVE);
<br/>
   vramSetBankA(VRAM_A_TEXTURE);                        //NEW  must set up some memory for textures
<br/>
   vramSetBankB(VRAM_B_TEXTURE);                        //NEW  must set up some memory
<br/>
   //vramSetBankC(VRAM_C_TEXTURE);                        //NEW  must set up some memory
<br/>
   vramSetBankC(VRAM_C_MAIN_BG); 
<br/>
   //gluLookAt(10.0f, 8.0f, 20.0f, 10.0f, 8.0f, 0.0f, 0.0f, 1.0f, 0.0f);
<br/>
   BG0_CR |= BG_PRIORITY(1);
<br/>
   BG1_CR = BG_MAP_BASE(31)|BG_PRIORITY(0);
<br/>
   
<br/>
   BG_PALETTE[255] = RGB15(31,31,31);   //by default font will be rendered with color 255
<br/>
   
<br/>
   //consoleInit() is a lot more flexible but this gets you up and running quick
<br/>
   consoleInitDefault((u16*)SCREEN_BASE_BLOCK(31), (u16*)CHAR_BASE_BLOCK(0), 16);
<br/>
   
<br/>
   // IRQ basic setup
<br/>
   irqInit();
<br/>
   irqSet(IRQ_VBLANK, 0);
<br/>
<br/>
   // Set our viewport to be the same size as the screen
<br/>
   glViewPort(0,0,255,191);
<br/>
   
<br/>
   // Specify the Clear Color and Depth 
<br/>
   glClearColor(0,0,0);
<br/>
   glClearDepth(0x7FFF);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I tried different priorites, btw.
<br/>
<br/>
Thanx for the help in Advance.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#69728 - Dark Knight ez - Wed Feb 01, 2006 3:44 pm</h4>
    <div class="postbody"><span class="postbody">First of all, I'm only now starting to look into pieces of code with OpenGL and NintendoDS, so what I'm about to say could not be accurate.... it's just a guess.
<br/>
<br/>
Could it be that the function glClearColor makes the background black on top of your 2D background? Meaning the 2D BG is there, but the 3D "blackness" is shown on top of that. What happens if you comment that out?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#69736 - Extreme Coder - Wed Feb 01, 2006 4:35 pm</h4>
    <div class="postbody"><span class="postbody">glClearColor is only called first frame.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#69751 - ecurtz - Wed Feb 01, 2006 5:56 pm</h4>
    <div class="postbody"><span class="postbody">It does work.
<br/>
<br/>
The dual pass demo I posted does an ugly hack with showing the 3D every frame but hiding it behind a BG layer on odd frames, so you could check that.
<br/>
<br/>
I'm still at the stage of the 2d/3d interaction being voodoo - I just curse and try changing everything until it does what I expect.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#69765 - Extreme Coder - Wed Feb 01, 2006 6:41 pm</h4>
    <div class="postbody"><span class="postbody">What is supposed to work?
<br/>
I'll check your demo now.
<br/>
TNX
<br/>
EDIT:I've checked your demo, I don't see what have I done wrong in the code above.Mind correcting my stupidity?:P</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#69827 - ecurtz - Thu Feb 02, 2006 7:02 am</h4>
    <div class="postbody"><span class="postbody">Sorry I just meant that using the BG layers along with the 3d output works.
<br/>
<br/>
My best guess is that glClearColor() call is messing you up because it always makes it opaque, try directly setting the value of the GFX_CLEAR_COLOR register to something (like 0).
<br/>
<br/>
I don't see anything else obvious there, but a couple other things to try.
<br/>
Make sure there's stuff in the BG - fill it with random junk or something.
<br/>
Turn up the alpha on the 3d layer and see if you see the bg through it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#69857 - Extreme Coder - Thu Feb 02, 2006 12:17 pm</h4>
    <div class="postbody"><span class="postbody">Thanks ecurtz, I fixed it. But the reason was very very wierd...
<br/>
I just changed vram_main_bg to vram_main_bg_0x060000. I don't know what is the difference...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#69927 - Cthulhu32 - Fri Feb 03, 2006 12:50 am</h4>
    <div class="postbody"><span class="postbody">you might also want to read up on what mode you're in.  Remember there are multiple 3D modes, for my 2D/3D example I used Mode_5_3D.
<br/>
<br/>
so, videoSetMode(MODE_0_3D|DISPLAY_BG1_ACTIVE); would be videoSetMode(MODE_5_3D|DISPLAY_BG1_ACTIVE);  Then you'd access your background just like you would with a Mode 5 bg.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#69952 - Extreme Coder - Fri Feb 03, 2006 6:27 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cthulhu32 wrote:</b></span></td> </tr> <tr> <td class="quote">you might also want to read up on what mode you're in.  Remember there are multiple 3D modes, for my 2D/3D example I used Mode_5_3D.
<br/>
<br/>
so, videoSetMode(MODE_0_3D|DISPLAY_BG1_ACTIVE); would be videoSetMode(MODE_5_3D|DISPLAY_BG1_ACTIVE);  Then you'd access your background just like you would with a Mode 5 bg.</td> </tr></table><span class="postbody">
<br/>
<br/>
access which BG? The 3d BG(BG0)?</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
