<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>displaying raw image - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > displaying raw image</h2>
<div id="posts">
<div class="post">
    <h4>#169143 - Tommmie - Sun Jun 21, 2009 4:27 pm</h4>
    <div class="postbody"><span class="postbody">hey everyone,
<br/>
<br/>
it try to display a raw image, but every time i get a black screen. but when i use dsorganize it displays perfect. can anyone tell me how to display a raw image. i'm doing it like this now:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include &lt;nds.h&gt;
<br/>
#include &lt;fat.h&gt;
<br/>
#include &lt;stdio.h&gt;
<br/>
<br/>
int main(void) {
<br/>
//---------------------------------------------------------------------------------
<br/>
 
<br/>
videoSetMode(MODE_5_2D);
<br/>
<br/>
vramSetBankA(VRAM_A_MAIN_BG_0x06000000);
<br/>
<br/>
int bg = bgInit(3, BgType_Bmp16, BgSize_B16_256x256, 0,0);
<br/>
<br/>
u16* backBuffer  = (u16*)0x06000000;
<br/>
fatInitDefault();
<br/>
FILE * pfile;
<br/>
pfile = fopen("decoded.raw", "rb");
<br/>
fread(backBuffer, 1, 256*192*2, pfile);
<br/>
fclose(pfile);
<br/>
<br/>
bgUpdate();
<br/>
<br/>
   while(1) {
<br/>
      swiWaitForVBlank();
<br/>
   }
<br/>
<br/>
}</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#169203 - LOst? - Tue Jun 23, 2009 1:17 pm</h4>
    <div class="postbody"><span class="postbody">First make sure you can display ANYTHING on the screen. Even if it is just pixel dirt. 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Tommmie wrote:</b></span></td> </tr> <tr> <td class="quote">fread(backBuffer, 1, 256*192*2, pfile);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Then I want to advice you that the area defined as backBuffer is of type u16 for a reason. You are reading 1 byte 256*192*2 times to a memory area that accepts unsigned words. That might give undesirable results. Even if you change this so that fread reads 2 bytes instead, it might still not work. 
<br/>
<br/>
Better read a word into a local variable of u16 type, and then send that variable to the backBuffer at the correct offset.
<br/>
<br/>
If you are looking for drawing speed, don't read images from some kind of a disk drive.<br/>_________________<br/><span style="font-style: italic">Exceptions are fun</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#169204 - Tommmie - Tue Jun 23, 2009 1:24 pm</h4>
    <div class="postbody"><span class="postbody">thanks, but it was already working</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#169205 - elhobbs - Tue Jun 23, 2009 1:33 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Tommmie wrote:</b></span></td> </tr> <tr> <td class="quote">thanks, but it was already working</td> </tr></table><span class="postbody">what was the problem? did the raw image data not have the alpha bit set?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#169207 - Tommmie - Tue Jun 23, 2009 3:46 pm</h4>
    <div class="postbody"><span class="postbody">i don know exactly now, i tried to an image, but when i did that i got nothing on the screen. when i changed this in the decoding process:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
RGB15((r &gt;&gt; 3),(g &gt;&gt; 3),(b &gt;&gt; 3)) </td> </tr></table><span class="postbody">
<br/>
<br/>
to this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">RGB15((r &gt;&gt; 3),(g &gt;&gt; 3),(b &gt;&gt; 3)) |BIT(15)  </td> </tr></table><span class="postbody">
<br/>
<br/>
it worked. raw image are still not loadable for me(i can decode images and show them on the screen with that bit(15)). but why is that BIT(15) needed?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#169208 - SteveH - Tue Jun 23, 2009 3:49 pm</h4>
    <div class="postbody"><span class="postbody">Bit(15) is the alpha bit:
<br/>
<br/>
0 - The color is stored with 0% opacity / 100% transparency
<br/>
1 - The color is stored with 100% opacity / 0% transparency
<br/>
<br/>
in other words it's an on/off alpha just like in a gif file where the transparent bit is one color.
<br/>
<br/>
When you made your raw image file, I'm assuming with grit, did you tell grit to set the slpha bit on?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#169209 - kusma - Tue Jun 23, 2009 3:51 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Tommmie wrote:</b></span></td> </tr> <tr> <td class="quote">but why is that BIT(15) needed?</td> </tr></table><span class="postbody">
<br/>
Because bit 15 is a 1 bit alpha value. If it's not set to 1, the pixel is transparent. Consider the format as ARGB1555 instead of RGB555.
<br/>
<br/>
Edit: Bah, beaten :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#169210 - Tommmie - Tue Jun 23, 2009 3:52 pm</h4>
    <div class="postbody"><span class="postbody">so it was because the alphabit? all colors where transparent due not doing | BIT(15)? and no it got the raw image, while i decoded it and saved it on my nds(the decoded buffer)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
