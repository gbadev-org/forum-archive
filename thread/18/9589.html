<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Are there limits for sound .raw files? [SOLVED] - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Are there limits for sound .raw files? [SOLVED]</h2>
<div id="posts">
<div class="post">
    <h4>#83467 - Dark Knight ez - Tue May 16, 2006 3:31 pm</h4>
    <div class="postbody"><span class="postbody">I've been using the sample raw-sounds of devkitPro until now, and they work properly with my code.
<br/>
Now, I've created some new samples... 1 channel, 22050 samples per second, 17275 data bytes, wav, and converted them to 8-bit.
<br/>
<br/>
Using sox and the normally used line: "sox -V in.wav out.raw" gives me on-screen output which is quite similiar to that found in Chris Double's tutorial, only replace his sample rate with my sample rate and also replace his sample's length by my own. One more thing is listed: the amount of samples per channel (which is equal to my sample rate). 
<br/>
Link to the tutorial I was refering to: <a class="postlink" href="http://www.double.co.nz/nintendo_ds/nds_develop4.html" target="_blank">http://www.double.co.nz/nintendo_ds/nds_develop4.html</a>
<br/>
<br/>
When I put the created raw files in my data-folder, add them as I did with the sample sounds, change the code to reflect the samples per seconds and sorts, and then after compiling try to play them... it sounds like complete rubbish.
<br/>
<br/>
Snippet of code to play one of the new samples:
<br/>
startSound(22050, snd_drumbeat_raw, snd_drumbeat_raw_size, channel, 127, 64, 1);
<br/>
<br/>
So, is there a limit to maybe the sample rate? Did I exceed that limit? Is my conversion using sox just rubbish? *shrugs*
<br/>
I've uploaded the drumbeat wav-file, so you people can have a look at it. It plays alright in Windows Media Player, and I can't see sox having trouble converting it, but on the DS it just doesn't play properly. Please help me out on this one.
<br/>
Link to the uploaded drumbeat wav: <a class="postlink" href="http://www.few.vu.nl/~ssstolk/temp/snd_drumbeat.wav" target="_blank">http://www.few.vu.nl/~ssstolk/temp/snd_drumbeat.wav</a></span><span class="gensmall"><br/><br/>Last edited by Dark Knight ez on Wed May 17, 2006 10:18 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#83603 - melw - Wed May 17, 2006 9:09 am</h4>
    <div class="postbody"><span class="postbody">It's definitely not using too high samplerate, at least 44kHz still works perfectly with the DS. Check your raw sample files by some sound editor to see if they're ok. Otherwise the code is not playing the correct file... playing from wrong memory offset results in neat rubbish sounds too :).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#83606 - Dark Knight ez - Wed May 17, 2006 9:42 am</h4>
    <div class="postbody"><span class="postbody">Thanks for the response.
<br/>
I didn't realise sound editors can play raw files, but I've checked, and it seems the converted raw file is good. Must be something in my code.
<br/>
<br/>
Oh. it seems the sample raw files use <span style="font-weight: bold">signed</span> 8 bit, and I'm using unsigned 8-bit. (I'm used to having 8-bit samples unsigned, since that's the standard for 8-bit wav files. Weird though that the tutorial does use unsigned 8-bit samples. Bah.)
<br/>
<br/>
Does anyone know of a program which can either convert a raw file from 8-bit unsigned to 8-bit signed, or a wav file from 8-bit unsigned to 8-bit signed?
<br/>
Audacity doesn't seem to support it, neither does Soundforge. Might have overlooked some option in Sox, but I'm not seeing it in there either.
<br/>
<br/>
EDIT: Sox does support it. "sox -V in.wav -s out.raw"
<br/>
The raw files now play perfectly. This stuff might be useful to add in tutorials.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#83669 - tepples - Wed May 17, 2006 7:53 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dark Knight ez wrote:</b></span></td> </tr> <tr> <td class="quote">Does anyone know of a program which can either convert a raw file from 8-bit unsigned to 8-bit signed, or a wav file from 8-bit unsigned to 8-bit signed?</td> </tr></table><span class="postbody">
<br/>
When you load the sample, XOR every byte with 0x80. Untested code:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void toggleSignBit(unsigned char *sample, size_t len) {
<br/>
  for(; len &gt; 0; --len, ++sample) {
<br/>
    *sample ^= 0x80;
<br/>
  }
<br/>
}
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#83704 - Dark Knight ez - Wed May 17, 2006 11:24 pm</h4>
    <div class="postbody"><span class="postbody">Wouldn't that "mirror" the wave over the horizontal axis compared to the original? (I guess that probably wouldn't make a difference.) 
<br/>
<br/>
Still, "loading the sample" in this case is just pointing to the included file for playback, and in your case, I'd have to reserve space in memory, convert the sample with XORs, and then point to it for playback... if I'm right.
<br/>
<br/>
I appreciate your reply though. If Sox couldn't handle converting it to signed, I would have tried your approach (only not on the DS itself, but before that, converting the sample by a self-written piece of code).
<br/>
It does seem that sox adds a "click" at the end of a sample (comment perhaps?), but that can easily be edited out with a hex editor.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#83713 - DekuTree64 - Thu May 18, 2006 12:28 am</h4>
    <div class="postbody"><span class="postbody">The XOR just converts it to signed format. A more clear way to do it is to subtract 128 (basically changing the 0,255 value to -128,127). It just happens that flipping the top bit has the same effect as subtracting the top bit, plus you can use it on 4 samples at once if you need it to be speedy, since it doesn't affect the bits above it like subtraction would:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void toggleSignBit(unsigned char *sample, size_t len) { 
<br/>
  for(; len &gt; 3; len -= 4, sample += 4) { 
<br/>
    *((u32*)sample) ^= 0x80808080; 
<br/>
  } 
<br/>
  for(; len &gt; 0; --len, ++sample) { 
<br/>
    *sample ^= 0x80; 
<br/>
  } 
<br/>
}</td> </tr></table><span class="postbody">
<br/>
Assuming that sample is 4-byte aligned to begin with.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#83727 - tepples - Thu May 18, 2006 1:50 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dark Knight ez wrote:</b></span></td> </tr> <tr> <td class="quote">If Sox couldn't handle converting it to signed, I would have tried your approach (only not on the DS itself, but before that, converting the sample by a self-written piece of code).</td> </tr></table><span class="postbody">
<br/>
It's not that difficult to make the conversion from 8-bit unsigned to signed work on the DS. Then you can store .wav files on the CF or in the GBFS, converting them as you load them.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#83754 - Dark Knight ez - Thu May 18, 2006 10:26 am</h4>
    <div class="postbody"><span class="postbody">That would have a couple of benefits, but I'm afraid I can't do that for several reasons. That is to say, I want to use GBFS for just two to three (customization) files and not also for sound effects and such.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
