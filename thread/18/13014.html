<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>External RAM test - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > External RAM test</h2>
<div id="posts">
<div class="post">
    <h4>#125960 - Lick - Wed Apr 18, 2007 4:09 pm</h4>
    <div class="postbody"><span class="postbody"><span style="font-size: 18px; line-height: normal">Update</span> run <a class="postlink" href="http://lickr.org/files/ram/ram_test.zip" target="_blank">this ram_test</a> instead!
<br/>
__________________________
<br/>
<br/>
<a class="postlink" href="http://lickr.org/files/exram.nds" target="_blank">http://lickr.org/files/exram.nds</a>
<br/>
<a class="postlink" href="http://lickr.org/files/exram.ds.gba" target="_blank">http://lickr.org/files/exram.ds.gba</a>
<br/>
<br/>
Hey, I've been working on my own external ram library and currently I have raw drivers for SC, Opera and M3. (Credits to Lazy1 for <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=12589" target="_blank">unlock codes</a>).
<br/>
<br/>
Could everyone with those devices test the above linked files? I'm particularly interested in Opera and M3, and the amount of RAM the testapp will display.
<br/>
<br/>
Thanks,
<br/>
- LIkc<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"><br/><br/>Last edited by Lick on Fri Apr 20, 2007 11:18 am; edited 2 times in total</span></div>    
</div>
<div class="post">
    <h4>#125967 - Stuk - Wed Apr 18, 2007 5:53 pm</h4>
    <div class="postbody"><span class="postbody">I've tried it on a Supercard lite and got two green screens, bar: 1234, and total: 33554432
<br/>
<br/>
I also have the Opera expansion, is it possible to test this with the Supercard lite?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#125968 - oofrab - Wed Apr 18, 2007 6:02 pm</h4>
    <div class="postbody"><span class="postbody">M3Lite here. Two green screens and upper shows:
<br/>
<br/>
init ram
<br/>
<br/>
bar: 1234
<br/>
total: 33554432</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#125969 - TheFish - Wed Apr 18, 2007 6:04 pm</h4>
    <div class="postbody"><span class="postbody">Tested with my Supercard SD
<br/>
<br/>
Bar: 1234
<br/>
<br/>
Total: 33554432
<br/>
<br/>
The full 32 meg is accessable then I see to developers to use (32 x 1024 x 1024 bytes)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#125970 - InGeNus - Wed Apr 18, 2007 6:09 pm</h4>
    <div class="postbody"><span class="postbody">tested opera with M3S. :
<br/>
bar: 1234
<br/>
total: 8388608</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#125972 - Dennis - Wed Apr 18, 2007 6:28 pm</h4>
    <div class="postbody"><span class="postbody">I have tested with original ram(opera ram cart)
<br/>
<br/>
Two green screens
<br/>
Init ram
<br/>
<br/>
bar: 1234 
<br/>
total: 8388608</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#125976 - Lick - Wed Apr 18, 2007 7:37 pm</h4>
    <div class="postbody"><span class="postbody">Stuk: Because the ram initializes immediately when the program is loaded, you need very quick hands to swap the SCLite with Opera expansion! But if the ram is intialized on command like a key, then I think you can use Opera.
<br/>
<br/>
I test the first 2 bytes of every 1024-byte block to see how much ram is writable. That's how the total memory is calculated.
<br/>
<br/>
Good that it's working, now I'll write the memory manager.<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#125980 - Sektor - Wed Apr 18, 2007 8:01 pm</h4>
    <div class="postbody"><span class="postbody">M3CF
<br/>
bar: 1234
<br/>
total: 33554432<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><a class="postlink" href="http://gtamp.com/DS" target="_blank">GTAMP.com/DS</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#125981 - tepples - Wed Apr 18, 2007 8:24 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lick wrote:</b></span></td> </tr> <tr> <td class="quote">I test the first 2 bytes of every 1024-byte block to see how much ram is writable. That's how the total memory is calculated.</td> </tr></table><span class="postbody">
<br/>
But how does your program handle incomplete decoding? What if a card has 4 MiB of RAM, but the 4 MiB is "<a class="postlink" href="http://nesdevwiki.ath.cx/wiki/index.php/Mirroring#Memory_Mirroring" target="_blank">mirrored</a>" or repeated throughout the 32 MiB address space?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#125983 - Lick - Wed Apr 18, 2007 8:55 pm</h4>
    <div class="postbody"><span class="postbody">Hmm that could be a problem, although it seems like it hasn't occured yet.
<br/>
<br/>
Would erasing the checked location after each positive validation be a solution?<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#125985 - tepples - Wed Apr 18, 2007 10:07 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lick wrote:</b></span></td> </tr> <tr> <td class="quote">Would erasing the checked location after each positive validation be a solution?</td> </tr></table><span class="postbody">
<br/>
What you'll want to do after you determine which kilobytes of address space have RAM in them is write a canary value (e.g. 0xDEADBEEF) to the first address and look for other appearances of that canary value in the address space.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#125986 - Lick - Wed Apr 18, 2007 10:12 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lick wrote:</b></span></td> </tr> <tr> <td class="quote">Would erasing the checked location after each positive validation be a solution?</td> </tr></table><span class="postbody">
<br/>
What you'll want to do after you determine which kilobytes of address space have RAM in them is write a canary value (e.g. 0xDEADBEEF) to the first address and look for other appearances of that canary value in the address space.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
It's going to take a few seconds to look for a 4-byte value in potentially 32 megabytes of memory! I rather not write such a blocking library, hehe.
<br/>
<br/>
<span style="font-size: 18px; line-height: normal"><span style="font-weight: bold">update: </span></span>Oh by the way, I think I will implement <a class="postlink" href="http://en.wikipedia.org/wiki/Buddy_memory_allocation" target="_blank">Buddy memory allocation</a>. Anyone have other suggestions or tips?<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"><br/><br/>Last edited by Lick on Wed Apr 18, 2007 10:25 pm; edited 2 times in total</span></div>    
</div>
<div class="post">
    <h4>#125988 - tepples - Wed Apr 18, 2007 10:24 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lick wrote:</b></span></td> </tr> <tr> <td class="quote">It's going to take a few seconds to look for a 4-byte value in potentially 32 megabytes of memory! I rather not write such a blocking library, hehe.</td> </tr></table><span class="postbody">
<br/>
That's why I had GBFS search on 256 byte boundaries, and that's why you had your program search on 1 KiB boundaries. You could just search for mirroring canaries on 1 KiB boundaries too.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#125989 - Lick - Wed Apr 18, 2007 10:29 pm</h4>
    <div class="postbody"><span class="postbody">Tatatatatatatatata-true! But I don't think it's worth it. Currently the code is reasonably fast and it works. But let us be reminded when errors start occurring.<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#125998 - felix123 - Wed Apr 18, 2007 11:59 pm</h4>
    <div class="postbody"><span class="postbody">SCSD and SCminiSD
<br/>
exactly the same result.
<br/>
<br/>
bar: 1234
<br/>
total: 33554432<br/>_________________<br/><a class="postlink" href="http://en.wikipedia.org/wiki/NDSh" target="_blank">Nintendo DS homebrew on Wikipedia</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#126012 - Lick - Thu Apr 19, 2007 4:56 am</h4>
    <div class="postbody"><span class="postbody"><a class="postlink" href="http://lickr.org/files/exram2.zip" target="_blank">http://lickr.org/files/exram2.zip</a>
<br/>
<br/>
It should work on: Supercard, M3, Opera.
<br/>
Newly added are: EZ3/4, EZ3in1, G6.
<br/>
<br/>
I have the feeling the new devices will fail. =(
<br/>
Thanks for testing!<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#126017 - theli - Thu Apr 19, 2007 7:09 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lick wrote:</b></span></td> </tr> <tr> <td class="quote"><a class="postlink" href="http://lickr.org/files/exram2.zip" target="_blank">http://lickr.org/files/exram2.zip</a>I have the feeling the new devices will fail. =(
<br/>
</td> </tr></table><span class="postbody">
<br/>
G6 Lite
<br/>
ram_init failed ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#126023 - Lick - Thu Apr 19, 2007 9:56 am</h4>
    <div class="postbody"><span class="postbody">theli: thanks for testing. G6 is a bitch!
<br/>
<br/>
I don't have time to upload a new version right now, but I figured it out for EZ4.
<br/>
<span style="font-weight: bold">EZ4 now has 16 MiB of RAM! HUGE CREDITS go to Cory1492!</span>
<br/>
This code should also work on EZ3-in-1.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">//========================
<br/>
vu16 *_ez_unlock ()
<br/>
//========================
<br/>
{
<br/>
    sysSetBusOwners(BUS_OWNER_ARM9, BUS_OWNER_ARM9);
<br/>
<br/>
    //SetRompage(768/0x300); //0x9000000
<br/>
    *(vu16*)0x9FE0000 = 0xD200;
<br/>
    *(vu16*)0x8000000 = 0x1500;
<br/>
    *(vu16*)0x8020000 = 0xD200;
<br/>
    *(vu16*)0x8040000 = 0x1500;
<br/>
    *(vu16*)0x9880000 = 0x300; // PSRAM to 0x9000000
<br/>
    *(vu16*)0x9FC0000 = 0x1500;
<br/>
<br/>
    //OpenNorWrite()
<br/>
    *(vu16*)0x9FE0000 = 0xD200;
<br/>
    *(vu16*)0x8000000 = 0x1500;
<br/>
    *(vu16*)0x8020000 = 0xD200;
<br/>
    *(vu16*)0x8040000 = 0x1500;
<br/>
    *(vu16*)0x9C40000 = 0x1500;
<br/>
    *(vu16*)0x9FC0000 = 0x1500;
<br/>
<br/>
    return (vu16*)0x9000000;
<br/>
}
<br/>
<br/>
//========================
<br/>
void _ez_lock ()
<br/>
//========================
<br/>
{
<br/>
    // CloseNorWrite()
<br/>
   *(vu16*)0x9FE0000 = 0xD200;
<br/>
   *(vu16*)0x8000000 = 0x1500;
<br/>
   *(vu16*)0x8020000 = 0xD200;
<br/>
   *(vu16*)0x8040000 = 0x1500;
<br/>
   *(vu16*)0x9C40000 = 0xD200;
<br/>
   *(vu16*)0x9FC0000 = 0x1500;
<br/>
}
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#126024 - Lick - Thu Apr 19, 2007 10:35 am</h4>
    <div class="postbody"><span class="postbody"><a class="postlink" href="http://w13.easy-share.com/1010753.html" target="_blank">exram3.nds</a>
<br/>
<a class="postlink" href="http://w13.easy-share.com/1010754.html" target="_blank">exram3.ds.gba</a>
<br/>
<br/>
Should work: SC, Opera, M3, EZ3/4/3-in-1
<br/>
Test needed: G6
<br/>
<br/>
Sorry for the random filehost.
<br/>
- Lick<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#126025 - theli - Thu Apr 19, 2007 10:54 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lick wrote:</b></span></td> </tr> <tr> <td class="quote">Test needed: G6</td> </tr></table><span class="postbody">
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">ram_init done
<br/>
ram_size: 33554432
<br/>
<br/>
Test: 0 20 40 60 80
<br/>
lock, unlock
<br/>
Test: 0 20 40 60 80</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#126026 - Lick - Thu Apr 19, 2007 11:00 am</h4>
    <div class="postbody"><span class="postbody"><span style="font-size: 18px; line-height: normal">Me died and me gone to heaven. </span><span style="font-size: 24px; line-height: normal">//`( ^_^ )'\\</span> Thanks theli, bringer of good news!<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#126027 - OOPMan - Thu Apr 19, 2007 11:41 am</h4>
    <div class="postbody"><span class="postbody">Good work lick, nice to see you turning your dab hand to the matter of RAM ;-)<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#126031 - tepples - Thu Apr 19, 2007 2:16 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>OOPMan wrote:</b></span></td> </tr> <tr> <td class="quote">Good work lick, nice to see you turning your dab hand to the matter of RAM ;-)</td> </tr></table><span class="postbody">
<br/>
On the other hand (olive flounder?), do these libraries support simultaneous use of libfat and RAM? The DLDIs may have to be updated so as not to step on RAM access.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#126033 - Lick - Thu Apr 19, 2007 2:22 pm</h4>
    <div class="postbody"><span class="postbody">Before using the RAM you have to lock it. If you pair each lock with an unlock, I think it wouldn't conflict with libfat. Though I haven't done any testing yet.
<br/>
<br/>
But do note that (sgstair explained to me) the external RAM is slow, and should only be used when memory is more important than performance. There are ways to make it faster, DMAing to VRAM for example. For more information you should ask sgstair on IRC or something.
<br/>
<br/>
I'm cleaning the files up and then I'm posting them!<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#126034 - OOPMan - Thu Apr 19, 2007 2:30 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>OOPMan wrote:</b></span></td> </tr> <tr> <td class="quote">Good work lick, nice to see you turning your dab hand to the matter of RAM ;-)</td> </tr></table><span class="postbody">
<br/>
On the other hand (olive flounder?), do these libraries support simultaneous use of libfat and RAM? The DLDIs may have to be updated so as not to step on RAM access.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Lick's reply pretty much answered as I suspected. RAM libs for the DS operating outside of an OS environment will probably have to rely on developer-level checking of RAM/FAT lock status.
<br/>
<br/>
'Course, under an OS the RAM might be contigious with normal memory or, at the very laest, managed by the OS to ensure the dev need not check for lock status.
<br/>
<br/>
But, this is a plain memory lib, so no frills here :-)<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#126047 - Lick - Thu Apr 19, 2007 4:23 pm</h4>
    <div class="postbody"><span class="postbody">I wrote a libfat+ram test. It works fine on my Supercard, but on my EZ4 it hangs at the second transition from ram to fat.
<br/>
<br/>
You guys care to figure out why? I really don't want to, right now. I am exhausted.<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#126127 - viruseb - Fri Apr 20, 2007 7:12 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>theli wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lick wrote:</b></span></td> </tr> <tr> <td class="quote">Test needed: G6</td> </tr></table><span class="postbody">
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">ram_init done
<br/>
ram_size: 33554432
<br/>
<br/>
Test: 0 20 40 60 80
<br/>
lock, unlock
<br/>
Test: 0 20 40 60 80</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
<br/>
Same result for me.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#126148 - GizmoTheGreen - Fri Apr 20, 2007 10:19 am</h4>
    <div class="postbody"><span class="postbody">exram3.nds didnt got Init_Ram failed
<br/>
running on Neo2 SD, i ran the file from my ds-x though, will try booting from SD card on Neo2 itself when i get home, deos the Neo2 have any Ram to access?<br/>_________________<br/>Starter of the project TrueLoveDS :D
<br/>
Will you find True Love?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#126155 - Lick - Fri Apr 20, 2007 11:14 am</h4>
    <div class="postbody"><span class="postbody">I don't think Neo2 has, but even if it does, the test is not programmed for Neo2s.
<br/>
<br/>
<span style="font-size: 18px; line-height: normal">Update</span> maybe it does. On some retailer's website I found this interesting description "128M Zip RAM for compression, 256M flash RAM". 
<br/>
I believe the M stands for Mbit, so it makes 16MiB of "zip" RAM and 32MiB of flash RAM.
<br/>
If we figure out how the zip RAM works, it might be usable as external RAM.
<br/>
<br/>
<span style="font-size: 18px; line-height: normal">Update </span>Wait a second.. So were you saying it actually WORKS? If so, what size does it report?<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
