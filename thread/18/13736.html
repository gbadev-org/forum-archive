<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Guitar tuner test (guinea pigs wanted, enquire within) - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > Guitar tuner test (guinea pigs wanted, enquire within)</h2>
<div id="posts">
<div class="post">
    <h4>#135262 - phlip - Sat Jul 21, 2007 4:05 pm</h4>
    <div class="postbody"><span class="postbody">I'm trying to write an electric tuner for the DS, but I'm having trouble with the timing. Namely, the timers in the DS aren't that accurate - they're well within the range you'd expect from a video game system, but to be accurate to, say, the nearest <a class="postlink" href="http://en.wikipedia.org/wiki/Cent_%28music%29" target="_blank">cent</a>, the timers need to be accurate to ?1/20%... way more than the DS is designed for.
<br/>
<br/>
I'd like to think that, with enough calibration, this problem can be gotten around... but it depends on how consistent a DS's timer is, in the same DS... I know from a quick experiment in IRC that WinterMute's DS's timer runs about 2% slower than mine (it reports the sound as about 40 cents higher)... but on the few tests I've run on my own DS, it rarely disagrees with itself more than about a cent. If it's always about the same on a single DS, then running some sort of calibration the first time you run it should be enough.
<br/>
<br/>
This is where you need your help:
<br/>
<a class="postlink" href="http://www.mrphlip.com/tmp/guitartune.zip" target="_blank">Download the tuner</a>.
<br/>
Put the .nds file on your DS and run it.
<br/>
Put your DS next to your computer speakers, and play the two .wav files in the zip.
<br/>
Post your results here. Specifically, the reading in the top-right of the lower screen.
<br/>
<br/>
Run the tests a few times, and see if you get consistent results... if possible, test it in the middle of the day, and at night... temperature might affect it, depending on how the timers work in the hardware.
<br/>
If all (or even most) DSs get similar numbers every time, even if they don't agree with each other, then the project can probably go ahead... otherwise, I'll probably have to scrap it, which'll be sad.
<br/>
<br/>
So yeah, the more data I have, the better, so if as many people as possible do this for me, it'll be great. I don't think I'm asking much, just run a program, and play a couple of sounds... should take 1 or 2 minutes, at most, at a couple of times during the day.
<br/>
<br/>
Oh, and one last thing: The program, as written, isn't particularly good for tuning actual instruments yet, even without the calibration problems... it's good for sine waves, and not much else. That'll get fixed before release... it's just got something in there right now that's simple and works.<br/>_________________<br/>&lt;link rel="signature" type="text/hilarious" href="/funnysig.txt" /&gt;</span><span class="gensmall"><br/><br/>Last edited by phlip on Sun Jul 22, 2007 12:36 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#135276 - tepples - Sat Jul 21, 2007 6:34 pm</h4>
    <div class="postbody"><span class="postbody">With this testing procedure, how do you plan to correct for an inaccurate sampling rate in PC audio equipment?
<br/>
<br/>
A useful real-time clock is accurate to within plus or minus one second per day, or plus or minus 11 parts per million, or plus or minus 0.02 cents of pitch. So might measuring the CPU timer against the RTC produce a good indication of your DS's actual clock rate?
<br/>
<br/>
As for generating actual tones to test against, have you considered the <a class="postlink" href="http://en.wikipedia.org/wiki/Karplus-Strong_string_synthesis" target="_blank">Karplus-Strong algorithm</a>, one of the early forms of waveguide synthesis?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135278 - voteforpedro36 - Sat Jul 21, 2007 6:41 pm</h4>
    <div class="postbody"><span class="postbody">The page cannot be found. 
<br/>
<br/>
Sounds so stupid after tepple's [technical] reply though...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135301 - phlip - Sun Jul 22, 2007 12:44 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">With this testing procedure, how do you plan to correct for an inaccurate sampling rate in PC audio equipment?</td> </tr></table><span class="postbody">
<br/>
<br/>
I'm pretty sure that a real computer, with a real oscillator, will do a lot better than an embedded system... My professional tuner reports my computer as being dead on.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">A useful real-time clock is accurate to within plus or minus one second per day, or plus or minus 11 parts per million, or plus or minus 0.02 cents of pitch. So might measuring the CPU timer against the RTC produce a good indication of your DS's actual clock rate?</td> </tr></table><span class="postbody">
<br/>
<br/>
That's... actually a very good idea. I'll look into that.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">As for generating actual tones to test against, have you considered the <a class="postlink" href="http://en.wikipedia.org/wiki/Karplus-Strong_string_synthesis" target="_blank">Karplus-Strong algorithm</a>, one of the early forms of waveguide synthesis?</td> </tr></table><span class="postbody">
<br/>
I don't see how that'd be useful, absent a reliable way to measure the length of the delay... and if there <span style="font-style: italic">is</span> a reliable way to measure the length of the delay, then it'd be overkill.
<br/>
<br/>
If you mean for the next bit, when I have to make it work with real instruments... I own a guitar, and I'll take the real thing over a synthesized waveform any day.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>voteforpedro36 wrote:</b></span></td> </tr> <tr> <td class="quote">The page cannot be found.</td> </tr></table><span class="postbody">
<br/>
My bad. The link is fixed now.<br/>_________________<br/>&lt;link rel="signature" type="text/hilarious" href="/funnysig.txt" /&gt;</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135304 - Agilo - Sun Jul 22, 2007 1:01 am</h4>
    <div class="postbody"><span class="postbody">Tested it real quickly, the application starts but isn't picking up on anything (I don't think it crashed though, because I think I can hear feedback coming from the speakers).
<br/>
<br/>
On a side-note: I've often considered attempting to write a tuning device, I made plans to implement all sorts of handy functions into it but I just never got around to getting the project off the ground.
<br/>
Shame on my part but I'm happy to see someone else giving it a try. :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135440 - felix123 - Mon Jul 23, 2007 11:49 am</h4>
    <div class="postbody"><span class="postbody">Tested on silver DS originally firmware v3.
<br/>
<br/>
Night test: For both notes, the result fluctuate between zero and plus one. For C, it spends roughly equal time in zero and one. For A, it is mostly zero.
<br/>
<br/>
I'll test again tomorrow morning.
<br/>
<br/>
Keep up the good work.<br/>_________________<br/><a class="postlink" href="http://en.wikipedia.org/wiki/NDSh" target="_blank">Nintendo DS homebrew on Wikipedia</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135491 - Dood77 - Mon Jul 23, 2007 10:56 pm</h4>
    <div class="postbody"><span class="postbody">I downloaded and tried, but I fear my PC's fans are annoyingly interrupting the DS's mic. (They make the B on my piano sound terrible!)
<br/>
<br/>
Maybe I should try a CD player with a burned CD?<br/>_________________<br/>If I use a term wrong or something then feel free to correct, I?m not much of a programmer.
<br/>
<span style="font-size: 9px; line-height: normal">
<br/>
Original DS Phat obtained on day of release + flashme v7
<br/>
Supercard: miniSD, Kingston 1GB, Kingston 2GB
<br/>
Ralink chipset PCI NIC
<br/>
</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135508 - Lynx - Tue Jul 24, 2007 1:36 am</h4>
    <div class="postbody"><span class="postbody">I tested my computer against a Korg GT-3 guitar tuner and the A was spot on, but the C was jumping all over the place.  And, I received the same results from the NDS application.  A seemed to tune right in, but C was jumping all over the place.<br/>_________________<br/><a class="postlink" href="http://www.ndshb.com" target="_blank">NDS Homebrew Roms &amp; Reviews</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135522 - happyface - Tue Jul 24, 2007 4:56 am</h4>
    <div class="postbody"><span class="postbody">Both my A and C flickered very quickly between +00 and +01
<br/>
<br/>
My DS is 33-35?C (as shown in Daignose)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135530 - DekuTree64 - Tue Jul 24, 2007 6:53 am</h4>
    <div class="postbody"><span class="postbody">Both are spot on for me (original silver DS, 25?C). I also tried tuning my guitar with it, and it sounds good. It seems to have trouble finding the lower notes though, so you might want to try sampling over a longer period.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135538 - Noda - Tue Jul 24, 2007 9:33 am</h4>
    <div class="postbody"><span class="postbody">Hmm I don't get the point, why are you speaking about internal timer frequency being related to the detection of the pitch of a sound???
<br/>
<br/>
Unless you're using some tricky methods to detect it, I don't get it...
<br/>
<br/>
I explain:
<br/>
The clock you're talking about can't be related to the one affecting the sampling frequency as sampling frequency innacuracy should have no effects (other than misrepresenting high frequencies) on the pitch of the sound.
<br/>
If you're measuring this clock frequency (which may slightly vary from one DS to another) and using it as a parameter when doing your FFT transform on the samples, then you're done.
<br/>
<br/>
Maybe I'm missing something here, as I never been bothered using the DS mic...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135987 - ghaxaq - Sat Jul 28, 2007 7:51 am</h4>
    <div class="postbody"><span class="postbody">I tried the application and it did not work on my SC CF(white screens). Any Help? Thanks<br/>_________________<br/>ghaxaq.wordpress.com</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#136028 - JAKETHESNAKE - Sat Jul 28, 2007 5:01 pm</h4>
    <div class="postbody"><span class="postbody">same with my scsd. i havent used that one sconv and that might be it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#136119 - phlip - Sun Jul 29, 2007 12:35 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Noda wrote:</b></span></td> </tr> <tr> <td class="quote">Hmm I don't get the point, why are you speaking about internal timer frequency being related to the detection of the pitch of a sound???</td> </tr></table><span class="postbody">
<br/>
<br/>
All it can tell directly is the period of the wave, measured in samples. Without knowing the sample rate, it's impossible to convert that period into seconds, and thus calculate the frequency in Hz.
<br/>
<br/>
Say the wave was measured to have a period of 50 samples. If it turns out to have been measured at a sample rate of 22kHz, then the recorded note is an A. If it's been measured at about 26.2kHz, then the recorded note is a C. If the sample rate is unreliable, then so is the measured frequency.
<br/>
<br/>
However, it seems that everyone that's gotten actual results has gotten the same thing (around 0 to +1c, the same as I get). The other results seem to be instability in the code and sensitivity to noise... both of which I'm working on fixing, and aren't a hardware issue... so it seems the timer <span style="font-style: italic">is</span> accurate enough for my purposes, and fancy calibration stuff isn't going to be necessary. WinterMute's +40c is still disconcerting... but I'm willing to consider it experimental error for now, unless anyone else is getting odd results.
<br/>
<br/>
Thanks for your help, guys!
<br/>
<br/>
Oh, and supercard guys: I don't really know anything about how that stuff works, but I've uploaded a .ds.gba version <a class="postlink" href="http://www.mrphlip.com/tmp/guitartune_dsgba.zip" target="_blank">here</a>... maybe you'll have better luck with that.<br/>_________________<br/>&lt;link rel="signature" type="text/hilarious" href="/funnysig.txt" /&gt;</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
