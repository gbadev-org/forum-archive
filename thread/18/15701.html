<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>PACKED attribute - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > PACKED attribute</h2>
<div id="posts">
<div class="post">
    <h4>#158845 - ingramb - Thu Jun 19, 2008 9:37 am</h4>
    <div class="postbody"><span class="postbody">It seems that any struct declared as packed is only accessed byte by byte, even if it is aligned properly.  I had some structs declared as PACKED "just to be safe", and noticed a problem with some code using slot2 ram.  So a struct like this:
<br/>
<br/>
struct PACKED MyStruct {
<br/>
  u32 a;
<br/>
  u32 b;
<br/>
  u16 c;
<br/>
  u16 d;
<br/>
  u8 e;
<br/>
  u8 f;
<br/>
  u8 g;
<br/>
  u8 i;
<br/>
};
<br/>
<br/>
will generate byte instructions even when accessing a-d.
<br/>
<br/>
Not really a question in here, just a heads up =)
<br/>
<br/>
[EDIT]
<br/>
See here for more info: <a class="postlink" href="http://digitalvampire.org/blog/index.php/2006/07/31/why-you-shouldnt-use-__attribute__packed/" target="_blank">http://digitalvampire.org/blog/index.php/2006/07/31/why-you-shouldnt-use-__attribute__packed/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#158848 - silent_code - Thu Jun 19, 2008 10:55 am</h4>
    <div class="postbody"><span class="postbody">You could put an union in and merge this structure with another anonymous structure which consists of 16bit or 32bit members.
<br/>
That way you could r/w the second structure when accessing external RAM and work with the regular structure in internal RAM.
<br/>
<br/>
<br/>
BUT WAIT: Doesn't externam RAM allow only byte reads/writes anyway? Then that may be nonsense, what I posted here... Although you could union-merge your structure with an u8 array of the same size and then work with it when accessing external RAM... you will have to see for yourself what works. (I can't help much more, because the RAM pack I have is for NDSl and I only have a phatty, so I can't use it. :^C )
<br/>
<br/>
<br/>
Just look at libnds' SpriteEntry structure.
<br/>
<br/>
I hope this is correct and it helps. ;^D
<br/>
<br/>
This will compile, but I haven't tested it:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">struct PACKED MyStruct
<br/>
{
<br/>
   u32 a;
<br/>
   u32 b;
<br/>
   u16 c;
<br/>
   u16 d;
<br/>
   union
<br/>
   {
<br/>
      struct
<br/>
      {
<br/>
         u8 e;
<br/>
         u8 f;
<br/>
         u8 g;
<br/>
         u8 i;
<br/>
      };
<br/>
      struct
<br/>
      {
<br/>
         u16 ef;
<br/>
         u16 gi;
<br/>
      };
<br/>
   };
<br/>
};
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
EDIT: This specific structure may not need packing at all, if you use the union approach, but I'm not 100% sure. Though, it simply looks like 4 32bit members, which could be easily put into an union (that would be done in a different structure layout, not the one I posted above.) :^)
<br/>
<br/>
PS: Why does i come after g, instead of h? ;?p<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#158850 - tepples - Thu Jun 19, 2008 12:26 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>silent_code wrote:</b></span></td> </tr> <tr> <td class="quote">BUT WAIT: Doesn't externam RAM allow only byte reads/writes anyway?</td> </tr></table><span class="postbody">
<br/>
SLOT-2 RAM in the SRAM space (0x0A000000-0x0A00FFFF on DS or 0x0E000000-0x0E00FFFF on GBA) uses only byte reads and byte writes. SLOT-2 RAM in the GBA ROM space (0x08000000-0x09FFFFFF) uses only 16-bit or larger writes.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#158855 - silent_code - Thu Jun 19, 2008 3:14 pm</h4>
    <div class="postbody"><span class="postbody">@ tepples: Let me guess, it's manufacturer dependent which option is implemented, right?<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#158858 - Dwedit - Thu Jun 19, 2008 4:43 pm</h4>
    <div class="postbody"><span class="postbody">Nope, just 8-bit writes if it's the 64K SRAM area, and 16-bit writes if it's the 32MB ROM area.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#158861 - silent_code - Thu Jun 19, 2008 6:27 pm</h4>
    <div class="postbody"><span class="postbody">Duh, I'm a stupid! I was in a rush to get out and later it occured to me. Thanks for clearing it up, anyway. :^)<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#158901 - tepples - Fri Jun 20, 2008 12:47 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>silent_code wrote:</b></span></td> </tr> <tr> <td class="quote">@ tepples: Let me guess, it's manufacturer dependent which option is implemented, right?</td> </tr></table><span class="postbody">
<br/>
Many cards designed to run GBA programs implement both options: the GBA ROM area for running GBA programs and the (usually battery- or capacitor-backed) GBA SRAM area for saving persistent data between runs.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
