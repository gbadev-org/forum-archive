<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>st9bad_alloc - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > st9bad_alloc</h2>
<div id="posts">
<div class="post">
    <h4>#98605 - yal - Wed Aug 16, 2006 11:00 am</h4>
    <div class="postbody"><span class="postbody">Hi, 
<br/>
I got some weird problems using DevKitPro with libnds. I'm new to Ds programming, so hopefully I'm missing something obvious and you'll be able to help me :)
<br/>
<br/>
I have a class like that :
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
class CApp
<br/>
{
<br/>
   virtual void Init();
<br/>
   ...
<br/>
   Some other function here
<br/>
   ...
<br/>
<br/>
   CBoard * m_pBoard;
<br/>
};
<br/>
<br/>
class CNdsApp : public CApp
<br/>
{
<br/>
   ...
<br/>
   Some Function here
<br/>
   ...
<br/>
   
<br/>
   int x;
<br/>
   int y;
<br/>
<br/>
   int         m_bPreviouslyTouching;
<br/>
<br/>
   unsigned short * m_pMap;   
<br/>
   int         m_iBoardOffsetX; //Offset in tiles
<br/>
   int         m_iBoardOffsetY; //Offset in tiles   
<br/>
};
<br/>
<br/>
class CBoard
<br/>
{
<br/>
   ...
<br/>
   some function
<br/>
   ...
<br/>
<br/>
   struct SBox
<br/>
   {
<br/>
      EBoxContent Content;
<br/>
      bool aNeighbors[4];
<br/>
   };
<br/>
<br/>
   SBox m_Board[BOARD_SIZE_X][BOARD_SIZE_Y];   
<br/>
};
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
CNdsApp is instantiate with a new in the main function of the Arm9 at application start-up, and the class CBoard is instantiate the same way in the Init function of CApp (called right after the new)
<br/>
On run-time I got an exception that seem to happen on the second new (I only got 2 new in my application) : st9bad_alloc.
<br/>
<br/>
The weird thing is that the exception doesn't happen if I move my two first int of CNdsApp (x and y) at the bottom of the class (every other emplacement make the application crash). My first though was memory alignment problem, but my class contain only 32 bit, so I don't see how that could cause memory alignment issue. 
<br/>
I don't think it's because I run out of memory either since I allocate only those two little classes.
<br/>
<br/>
Any idea?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#98621 - yal - Wed Aug 16, 2006 3:34 pm</h4>
    <div class="postbody"><span class="postbody">I did some further testing and the problem disappeared suddenly and I can't reproduce it anymore ...
<br/>
I think a simple rebuild all would have fix my problems, I wish I had think about that before :)
<br/>
Still weird tough...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#98639 - sajiimori - Wed Aug 16, 2006 6:48 pm</h4>
    <div class="postbody"><span class="postbody">A code file probably got out-of-sync with a header, causing garbage to be passed to operator new.  All things being equal, garbage unsigned int values tend to be big.  :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#98711 - jonezer4 - Thu Aug 17, 2006 12:53 am</h4>
    <div class="postbody"><span class="postbody">I got this error while attempting a software reset (calling the swiSoftReset() function) in the arm9. Anyone know how to fix this?</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
