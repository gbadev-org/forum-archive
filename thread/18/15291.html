<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Including SOX sound convertor in the Makefile - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Including SOX sound convertor in the Makefile</h2>
<div id="posts">
<div class="post">
    <h4>#153429 - TheMagnitude - Sun Mar 30, 2008 11:05 am</h4>
    <div class="postbody"><span class="postbody">How do you include a SOX rule in the Makefile so that it can automatically convert .wav sounds to .raw sounds and then the bin2o rule just converts the .raw to a .o?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153436 - strager - Sun Mar 30, 2008 5:31 pm</h4>
    <div class="postbody"><span class="postbody">Easy.  Add a Makefile rule.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">%.raw: %.wav
<br/>
   @echo $&lt;
<br/>
   @sox options $&lt; $@</td> </tr></table><span class="postbody">
<br/>
<br/>
<span style="font-weight: bold">$&lt;</span> is the input file (the .wav file).  <span style="font-weight: bold">$@</span> is the output file (the .raw file).
<br/>
<br/>
Though I haven't touched the stock libnds Makefiles in a while, so they may have changed their structure a bit.
<br/>
<br/>
Also, add a rule to detect the *.wav files as make'able...  =X</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153980 - TheMagnitude - Tue Apr 08, 2008 10:20 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>strager wrote:</b></span></td> </tr> <tr> <td class="quote">Easy.  Add a Makefile rule.
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">%.raw: %.wav
<br/>
   @echo $&lt;
<br/>
   @sox options $&lt; $@</td> </tr></table><span class="postbody">
<br/>
<br/>
<span style="font-weight: bold">$&lt;</span> is the input file (the .wav file).  <span style="font-weight: bold">$@</span> is the output file (the .raw file).
<br/>
<br/>
Though I haven't touched the stock libnds Makefiles in a while, so they may have changed their structure a bit.
<br/>
<br/>
Also, add a rule to detect the *.wav files as make'able...  =X</span></td> </tr></table><span class="postbody">Sorry this is my first time using makefiles could you modify my current makefile so itll work, its greatly appreciated.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#---------------------------------------------------------------------------------
<br/>
.SUFFIXES:
<br/>
#---------------------------------------------------------------------------------
<br/>
<br/>
ifeq ($(strip $(DEVKITARM)),)
<br/>
$(error "Please set DEVKITARM in your environment. export DEVKITARM=&lt;path to&gt;devkitARM")
<br/>
endif
<br/>
<br/>
include $(DEVKITARM)/ds_rules
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# TARGET is the name of the output
<br/>
# BUILD is the directory where object files &amp; intermediate files will be placed
<br/>
# SOURCES is a list of directories containing source code
<br/>
# INCLUDES is a list of directories containing extra header files
<br/>
# DATA is a list of directories containing binary data
<br/>
# GRAPHICS is a list of directories containing files to be processed by grit
<br/>
#
<br/>
# All directories are specified relative to the project directory where
<br/>
# the makefile is found
<br/>
#
<br/>
#---------------------------------------------------------------------------------
<br/>
TARGET      :=   $(notdir $(CURDIR))
<br/>
BUILD      :=   build
<br/>
SOURCES      :=   source
<br/>
DATA      :=   data
<br/>
INCLUDES   :=   include
<br/>
GRAPHICS   :=   gfx
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# options for code generation
<br/>
#---------------------------------------------------------------------------------
<br/>
ARCH      :=   -mthumb -mthumb-interwork
<br/>
<br/>
CFLAGS   :=   -g -Wall -O2\
<br/>
          -march=armv5te -mtune=arm946e-s -fomit-frame-pointer\
<br/>
         -ffast-math \
<br/>
         $(ARCH)
<br/>
<br/>
CFLAGS   +=   $(INCLUDE) -DARM9
<br/>
CXXFLAGS   :=   $(CFLAGS) -fno-rtti -fno-exceptions
<br/>
<br/>
ASFLAGS   :=   -g $(ARCH)
<br/>
LDFLAGS   =   -specs=ds_arm9.specs -g $(ARCH) -Wl,-Map,$(notdir $*.map)
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# any extra libraries we wish to link with the project
<br/>
#---------------------------------------------------------------------------------
<br/>
LIBS   := -lnds9
<br/>
 
<br/>
 
<br/>
#---------------------------------------------------------------------------------
<br/>
# list of directories containing libraries, this must be the top level containing
<br/>
# include and lib
<br/>
#---------------------------------------------------------------------------------
<br/>
LIBDIRS   :=   $(LIBNDS)
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# no real need to edit anything past this point unless you need to add additional
<br/>
# rules for different file extensions
<br/>
#---------------------------------------------------------------------------------
<br/>
<br/>
<br/>
ifneq ($(BUILDDIR), $(CURDIR))
<br/>
#---------------------------------------------------------------------------------
<br/>
 
<br/>
export OUTPUT   :=   $(CURDIR)/$(TARGET)
<br/>
 
<br/>
export VPATH   :=   $(foreach dir,$(SOURCES),$(CURDIR)/$(dir)) \
<br/>
               $(foreach dir,$(DATA),$(CURDIR)/$(dir)) \
<br/>
               $(foreach dir,$(GRAPHICS),$(CURDIR)/$(dir))
<br/>
<br/>
export DEPSDIR   :=   $(CURDIR)/$(BUILD)
<br/>
<br/>
CFILES      :=   $(foreach dir,$(SOURCES),$(notdir $(wildcard $(dir)/*.c)))
<br/>
CPPFILES   :=   $(foreach dir,$(SOURCES),$(notdir $(wildcard $(dir)/*.cpp)))
<br/>
SFILES      :=   $(foreach dir,$(SOURCES),$(notdir $(wildcard $(dir)/*.s)))
<br/>
BINFILES   :=   $(foreach dir,$(DATA),$(notdir $(wildcard $(dir)/*.*)))
<br/>
BMPFILES   :=   $(foreach dir,$(GRAPHICS),$(notdir $(wildcard $(dir)/*.bmp)))
<br/>
PNGFILES   :=   $(foreach dir,$(GRAPHICS),$(notdir $(wildcard $(dir)/*.png)))
<br/>
TIFFILES   :=   $(foreach dir,$(GRAPHICS),$(notdir $(wildcard $(dir)/*.tif)))
<br/>
GIFFILES   :=   $(foreach dir,$(GRAPHICS),$(notdir $(wildcard $(dir)/*.gif)))
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# use CXX for linking C++ projects, CC for standard C
<br/>
#---------------------------------------------------------------------------------
<br/>
ifeq ($(strip $(CPPFILES)),)
<br/>
#---------------------------------------------------------------------------------
<br/>
   export LD   :=   $(CC)
<br/>
#---------------------------------------------------------------------------------
<br/>
else
<br/>
#---------------------------------------------------------------------------------
<br/>
   export LD   :=   $(CXX)
<br/>
#---------------------------------------------------------------------------------
<br/>
endif
<br/>
#---------------------------------------------------------------------------------
<br/>
<br/>
export OFILES   :=   $(addsuffix .o,$(BINFILES)) \
<br/>
               $(BMPFILES:.bmp=.o) \
<br/>
               $(PNGFILES:.png=.o) \
<br/>
               $(TIFFILES:.tif=.o) \
<br/>
               $(GIFFILES:.gif=.o) \
<br/>
               $(CPPFILES:.cpp=.o) $(CFILES:.c=.o) $(SFILES:.s=.o)
<br/>
 
<br/>
export INCLUDE   :=   $(foreach dir,$(INCLUDES),-I$(CURDIR)/$(dir)) \
<br/>
               $(foreach dir,$(LIBDIRS),-I$(dir)/include) \
<br/>
               $(foreach dir,$(LIBDIRS),-I$(dir)/include) \
<br/>
               -I$(CURDIR)/$(BUILD)
<br/>
 
<br/>
export LIBPATHS   :=   $(foreach dir,$(LIBDIRS),-L$(dir)/lib)
<br/>
<br/>
.PHONY: $(BUILD) clean
<br/>
 
<br/>
#---------------------------------------------------------------------------------
<br/>
$(BUILD):
<br/>
   @[ -d $@ ] || mkdir -p $@
<br/>
   @make BUILDDIR=`cd $(BUILD) &amp;&amp; pwd` --no-print-directory -C $(BUILD) -f $(CURDIR)/Makefile
<br/>
 
<br/>
#---------------------------------------------------------------------------------
<br/>
clean:
<br/>
   @echo clean ...
<br/>
   @rm -fr $(BUILD) $(TARGET).elf $(TARGET).nds $(TARGET).arm9 $(TARGET).ds.gba 
<br/>
 
<br/>
 
<br/>
#---------------------------------------------------------------------------------
<br/>
else
<br/>
 
<br/>
DEPENDS   :=   $(OFILES:.o=.d)
<br/>
 
<br/>
#---------------------------------------------------------------------------------
<br/>
# main targets
<br/>
#---------------------------------------------------------------------------------
<br/>
$(OUTPUT).nds   :    $(OUTPUT).arm9
<br/>
$(OUTPUT).arm9   :   $(OUTPUT).elf
<br/>
$(OUTPUT).elf   :   $(OFILES)
<br/>
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# The bin2o rule should be copied and modified
<br/>
# for each extension used in the data directories
<br/>
#---------------------------------------------------------------------------------
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# This rule links in binary data with the .bin extension
<br/>
#---------------------------------------------------------------------------------
<br/>
%.bin.o   :   %.bin
<br/>
#---------------------------------------------------------------------------------
<br/>
   @echo $(notdir $&lt;)
<br/>
   @$(bin2o)
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# This rule links in binary data with the .raw extension
<br/>
#---------------------------------------------------------------------------------
<br/>
%.raw.o   :   %.raw
<br/>
#---------------------------------------------------------------------------------
<br/>
   @echo $(notdir $&lt;)
<br/>
   @$(bin2o)
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# This rule creates assembly source files using grit
<br/>
# grit takes an image file and a .grit describing how the file is to be processed
<br/>
# add additional rules like this for each image extension
<br/>
# you use in the graphics folders 
<br/>
#---------------------------------------------------------------------------------
<br/>
%.s %.h   : %.bmp %.grit
<br/>
#---------------------------------------------------------------------------------
<br/>
   grit $&lt; -fts -o$*
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
%.s %.h   : %.png %.grit
<br/>
#---------------------------------------------------------------------------------
<br/>
   grit $&lt; -fts -o$*
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
%.s %.h   : %.tif %.grit
<br/>
#---------------------------------------------------------------------------------
<br/>
   grit $&lt; -fts -o$*
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
%.s %.h   : %.gif %.grit
<br/>
#---------------------------------------------------------------------------------
<br/>
   grit $&lt; -fts -o$*
<br/>
 
<br/>
-include $(DEPENDS)
<br/>
 
<br/>
#---------------------------------------------------------------------------------------
<br/>
endif
<br/>
#---------------------------------------------------------------------------------------
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
