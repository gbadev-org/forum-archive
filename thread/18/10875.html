<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Clearing a BG - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Clearing a BG</h2>
<div id="posts">
<div class="post">
    <h4>#99216 - psycorpse - Sun Aug 20, 2006 3:12 am</h4>
    <div class="postbody"><span class="postbody">How do you clear a bank of ram? I need to clear BG_BMP_RAM(0). 
<br/>
<br/>
You don't even have to answer it if you can point me to a place that I can read up on it.
<br/>
<br/>
<br/>
Thanks,
<br/>
Mike</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#99217 - tepples - Sun Aug 20, 2006 3:16 am</h4>
    <div class="postbody"><span class="postbody">The simple way, given the base of a bank and its size in bytes:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void clearMemory(u32 *dst, unsigned int size) {
<br/>
  for(; size &gt;= sizeof(u32); size -= sizeof(u32)) {
<br/>
    *dst++ = 0;
<br/>
  }
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
The following equivalent code has been manually unrolled to encourage the compiler to emit efficient 'stmia' instructions and fewer branches:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void clearMemory(u32 *dst, unsigned int size) {
<br/>
  for (; size &gt;= 4 * sizeof(u32); size -= 4 * sizeof(u32)) {
<br/>
    dst[0] = 0;
<br/>
    dst[1] = 0;
<br/>
    dst[2] = 0;
<br/>
    dst[3] = 0;
<br/>
    dst += 4;
<br/>
  }
<br/>
  for(; size &gt;= sizeof(u32); size -= sizeof(u32)) {
<br/>
    *dst++ = 0;
<br/>
  }
<br/>
}
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#99219 - knight0fdragon - Sun Aug 20, 2006 3:37 am</h4>
    <div class="postbody"><span class="postbody">memset(dst,0,size);?<br/>_________________<br/><a href="http://www.myspace.com/knight0fdragonds" target="_blank">http://www.myspace.com/knight0fdragonds</a>
<br/>
<br/>
MK DS FC: Dragon 330772 075464 
<br/>
AC WW FC: Anthony SamsClub 1933-3433-9458 
<br/>
MPFH: Dragon 0215 4231 1206</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#99230 - tepples - Sun Aug 20, 2006 5:16 am</h4>
    <div class="postbody"><span class="postbody">memset() works a byte at a time, which is 1. slow and 2. not compatible with DS VRAM.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#99262 - LiraNuna - Sun Aug 20, 2006 10:40 am</h4>
    <div class="postbody"><span class="postbody">That's wrong. It has been proven that memset aligns itself to the size of the memory and it's the second fastest method after stmia clear. (dsboi's testings )
<br/>
<br/>
Edit: Oh and, you can use memset() to clear a 16bit rotoscale BG, it does 4byte writes.<br/>_________________<br/>Private property.
<br/>
Violators will be shot, survivors will be shot again.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#99433 - psycorpse - Mon Aug 21, 2006 5:40 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>LiraNuna wrote:</b></span></td> </tr> <tr> <td class="quote">That's wrong. It has been proven that memset aligns itself to the size of the memory and it's the second fastest method after stmia clear. (dsboi's testings )
<br/>
<br/>
Edit: Oh and, you can use memset() to clear a 16bit rotoscale BG, it does 4byte writes.</td> </tr></table><span class="postbody">
<br/>
<br/>
I gave it a shot and it worked. I also found <a class="postlink" href="http://www.double.co.nz/nintendo_ds/nds_develop10.html" target="_blank">www.double.co.nz/nintendo_ds/nds_develop10.html</a>
<br/>
which uses it to clear some memory.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
