<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>glFrustumf32 bug - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > glFrustumf32 bug</h2>
<div id="posts">
<div class="post">
    <h4>#140545 - a128 - Mon Sep 17, 2007 10:08 am</h4>
    <div class="postbody"><span class="postbody">The latest libnds has a bug.
<br/>
<br/>
glFrustumf32 sets the MATRIX_MULT4x4 in a wrong order. The older version in libnds does this right.
<br/>
<br/>
from <a class="postlink" href="http://nocash.emubase.de/gbatek.htm#ds3dmatrixtypes" target="_blank">http://nocash.emubase.de/gbatek.htm#ds3dmatrixtypes</a>
<br/>
<br/>
this is the order of the MATRIX_MULT4x4 operations ..so the old code does the setup correct.
<br/>
<br/>
m[0]  m[1]  m[2]  m[3]  
<br/>
	m[4]  m[5]  m[6]  m[7]    
<br/>
        m[8]  m[9]  m[10] m[11]   
<br/>
        m[12] m[13] m[14] m[15] 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
<br/>
//OLD CODE AND OK
<br/>
<br/>
   MATRIX_MULT4x4 = divf32(2*near, right - left);
<br/>
   MATRIX_MULT4x4 = 0;
<br/>
   MATRIX_MULT4x4 = divf32(right + left, right - left);
<br/>
   MATRIX_MULT4x4 = 0;
<br/>
   
<br/>
   MATRIX_MULT4x4 = 0;
<br/>
   MATRIX_MULT4x4 = divf32(2*near, top - bottom);
<br/>
   MATRIX_MULT4x4 = divf32(top + bottom, top - bottom);
<br/>
   MATRIX_MULT4x4 = 0;
<br/>
   
<br/>
   MATRIX_MULT4x4 = 0;
<br/>
   MATRIX_MULT4x4 = 0;
<br/>
   MATRIX_MULT4x4 = -divf32(far + near, far - near);
<br/>
   MATRIX_MULT4x4 = floattof32(-1.0F);
<br/>
   MATRIX_MULT4x4 = 0;
<br/>
   
<br/>
   MATRIX_MULT4x4 = 0;
<br/>
   MATRIX_MULT4x4 = -divf32(2 * mulf32(far, near), far - near);
<br/>
   MATRIX_MULT4x4 = 0;
<br/>
   
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
NEw CODE AND WRONG?!!!!!!
<br/>
<br/>
        MATRIX_MULT4x4 = divf32(2*near, right - left);
<br/>
   MATRIX_MULT4x4 = 0;
<br/>
   MATRIX_MULT4x4 = 0;
<br/>
   MATRIX_MULT4x4 = 0;
<br/>
 
<br/>
   MATRIX_MULT4x4 = 0;
<br/>
   MATRIX_MULT4x4 = divf32(2*near, top - bottom);
<br/>
   MATRIX_MULT4x4 = 0;
<br/>
   MATRIX_MULT4x4 = 0;
<br/>
 
<br/>
   MATRIX_MULT4x4 = divf32(right + left, right - left);
<br/>
   MATRIX_MULT4x4 = divf32(top + bottom, top - bottom);
<br/>
   MATRIX_MULT4x4 = -divf32(far + near, far - near);
<br/>
   MATRIX_MULT4x4 = floattof32(-1.0F);
<br/>
 
<br/>
   MATRIX_MULT4x4 = 0;
<br/>
   MATRIX_MULT4x4 = 0;
<br/>
   MATRIX_MULT4x4 = -divf32(2 * mulf32(far, near), far - near);
<br/>
   MATRIX_MULT4x4 = 0;
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#140610 - wintermute - Tue Sep 18, 2007 7:39 am</h4>
    <div class="postbody"><span class="postbody">And yet the bug report indicates that the old code was incorrect and the new code improves the compatibility with openGL.
<br/>
<br/>
I'm really not sure what to do with your report. What evidence do you actually have that the new code is wrong?
<br/>
<br/>
The orginal bug report with code showing the issue.
<br/>
<br/>
<a href="https://sourceforge.net/tracker/index.php?func=detail&amp;aid=1758603&amp;group_id=114505&amp;atid=668551" target="_blank">https://sourceforge.net/tracker/index.php?func=detail&amp;aid=1758603&amp;group_id=114505&amp;atid=668551</a>
<br/>
<br/>
Given that the new code produces the expected results for the previously broken sample and that all the libnds 3D example code displays appropriately I can't accept your assertion.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#140612 - a128 - Tue Sep 18, 2007 8:58 am</h4>
    <div class="postbody"><span class="postbody">If the new code is correct..
<br/>
<br/>
then 
<br/>
<a class="postlink" href="http://nocash.emubase.de/gbatek.htm#ds3dmatrixtypes" target="_blank">http://nocash.emubase.de/gbatek.htm#ds3dmatrixtypes</a>
<br/>
<br/>
is wrong.
<br/>
<br/>
I can not see that this spec is wrong because it`s the same with OpenGl
<br/>
<br/>
m[0] m[1] m[2] m[3]
<br/>
m[4] m[5] m[6] m[7]
<br/>
m[8] m[9] m[10] m[11]
<br/>
m[12] m[13] m[14] m[15] 
<br/>
<br/>
is the order where you apply your values
<br/>
<br/>
the new libnds glFrstum code have this order
<br/>
<br/>
m[0] m[4] m[8] m[12]
<br/>
m[1] m[5] m[9] m[13]
<br/>
m[2] m[6] m[10] m[14]
<br/>
m[3] m[7] m[11] m[15]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#140615 - mml - Tue Sep 18, 2007 9:37 am</h4>
    <div class="postbody"><span class="postbody">openGL's matrix functions take a one-dimensional array of 16 elements, which are then interpreted as a column-major 4x4 matrix.  that's consistent with the new libnds code here; how the DS hardware does it I have no idea.
<br/>
<br/>
for example of how opengl does it, see the glMultMatrix docs here:
<br/>
<a href="http://www.glprogramming.com/blue/ch05.html#id5509833" target="_blank">http://www.glprogramming.com/blue/ch05.html#id5509833</a>
<br/>
<br/>
<br/>
unless I'm much mistaken though (and I'll admit I could be, I'm new to this maths), the difference is mostly in how you conceptualise it, since a post-multiplication by a column-major matrix is the same as a pre-multiplication by the same matrix arranged row-majorly.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#140617 - a128 - Tue Sep 18, 2007 10:47 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>mml wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
for example of how opengl does it, see the glMultMatrix docs here:
<br/>
<a href="http://www.glprogramming.com/blue/ch05.html#id5509833" target="_blank">http://www.glprogramming.com/blue/ch05.html#id5509833</a>
<br/>
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Oh yes..I see glMultmatrix in OpenGl is in order 
<br/>
<br/>
0 4 8 12
<br/>
1 5 9 12
<br/>
2 6 10 14
<br/>
3 7 11 15
<br/>
<br/>
<br/>
so wintermute is right..that the new glFrustum using glMultMatrix is now mutch more opengl conform.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
