<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>2D Sprite Problems - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > 2D Sprite Problems</h2>
<div id="posts">
<div class="post">
    <h4>#125270 - Codeninja - Thu Apr 12, 2007 2:31 pm</h4>
    <div class="postbody"><span class="postbody">Okay I've spent all day looking around for a solution to what I'm guessing is a pretty easy and pretty n00by bug to fix but I've given in to the shame of making a thread to receive some help to my problem.  Anyones the problem is the sprite just doesn't display correctly.
<br/>
<br/>
The picture linked <a class="postlink" href="http://www.teamequidna.com/notetaker/uploads/Codeninja/helpmeplz.jpg" target="_blank">here</a> should pretty much explain the problem and allow anyone who has a solution to help me.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   public:
<br/>
      void UpdateOAM(SpriteEntry * spriteEntry){
<br/>
         DC_FlushAll();
<br/>
         dmaCopy(spriteEntry,OAM,128 * sizeof(SpriteEntry));
<br/>
      };
<br/>
      void InitOAM(SpriteEntry * spriteEntry, SpriteRotation * spriteRotation){
<br/>
         // For all 128 Sprites on the DS, disable and clear any attributes they
<br/>
         // might have.  This prevents any garbage from being displayed and gives
<br/>
         // us a clean slate to work with.
<br/>
         for(int i=0;i&lt;128;i++){
<br/>
            spriteEntry[i].attribute[0] = ATTR0_DISABLED;
<br/>
            spriteEntry[i].attribute[1] = 0;
<br/>
            spriteEntry[i].attribute[2] = 0;
<br/>
         }
<br/>
         // For all 32 Possible sprite rotations, set them to default values
<br/>
         for(int i = 0; i &lt; 32; i++){
<br/>
            spriteRotation[i].hdx = 256;
<br/>
            spriteRotation[i].hdy = 0;
<br/>
            spriteRotation[i].vdx = 0;
<br/>
            spriteRotation[i].vdy = 256;
<br/>
         }
<br/>
         this-&gt;UpdateOAM(spriteEntry);
<br/>
      };
<br/>
      void MoveSprite(SpriteEntry * spriteEntry, u16 x, u16 y){
<br/>
         spriteEntry-&gt;attribute[1] &amp;= 0xFE00;
<br/>
         spriteEntry-&gt;attribute[1] |= (x &amp; 0x01FF);
<br/>
<br/>
         spriteEntry-&gt;attribute[0] &amp;= 0xFF00;
<br/>
         spriteEntry-&gt;attribute[0] |= (y &amp; 0x00FF);
<br/>
      };
<br/>
<br/>
      void RotateSprite(SpriteRotation * spriteRotation, u16 angle){
<br/>
         s16 s = -SIN[angle &amp; 0x1FF] &gt;&gt; 4;
<br/>
         s16 c = COS[angle &amp; 0x1FF] &gt;&gt; 4;
<br/>
<br/>
         spriteRotation-&gt;hdx = c;
<br/>
         spriteRotation-&gt;hdy = -s;
<br/>
         spriteRotation-&gt;vdx = s;
<br/>
         spriteRotation-&gt;vdy = c;
<br/>
      };
<br/>
      void InitSprites(SpriteEntry * spriteEntry, SpriteRotation * spriteRotation){
<br/>
         // init OAM
<br/>
         this-&gt;InitOAM(spriteEntry, spriteRotation);
<br/>
<br/>
         Coordinate position;
<br/>
         position.x = SCREEN_WIDTH/2-64;
<br/>
         position.y = SCREEN_HEIGHT/2-64;
<br/>
<br/>
         // create the ship sprite
<br/>
         int spriteZeroID = 64;
<br/>
<br/>
         spriteEntry[0].attribute[0] = ATTR0_COLOR_256 | ATTR0_ROTSCALE_DOUBLE | ((int)position.y &amp; 0x00FF);//able to rotscale
<br/>
         spriteEntry[0].attribute[1] = ATTR1_ROTDATA(0) | ATTR1_SIZE_64 | ((int)position.x &amp; 0x01FF); // size: 64 x 64
<br/>
         spriteEntry[0].attribute[2] = spriteZeroID;
<br/>
<br/>
         RotateSprite(&amp;spriteRotation[0],0);
<br/>
<br/>
         dmaCopy(master, (uint16 *)SPRITE_PALETTE, (uint32)master_size);
<br/>
         dmaCopy(ship, &amp;SPRITE_GFX[spriteZeroID * 16], (uint32)ship_size);
<br/>
<br/>
         // update the OAM
<br/>
         this-&gt;UpdateOAM(spriteEntry);
<br/>
      };
<br/>
   };</td> </tr></table><span class="postbody">
<br/>
<br/>
The code is as above - is there something wrong with my code or with my creating of the image file?  Because I'm not entirely sure how I'm supposed to use gfx2gba... I used it with the following line for the sprite
<br/>
<br/>
gfx2gba -t8 ship.pcx
<br/>
<br/>
and used the master.pal and ship.raw files I got from that in my little test and it didn't turn out too good.  As you can tell.
<br/>
<br/>
<br/>
Any help would be appreciated, thank you very much for your time.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#125299 - Stuk - Thu Apr 12, 2007 4:21 pm</h4>
    <div class="postbody"><span class="postbody">What should the sprite look like? I recently had a sprite problem: <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=12931" target="_blank">http://forum.gbadev.org/viewtopic.php?t=12931</a>.
<br/>
<br/>
However I am also quite new to DS coding, so I can't really offer much more help :)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
