<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Chishm's libfat (superior to GBA_NDS_FAT) - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Chishm's libfat (superior to GBA_NDS_FAT)</h2>
<div id="posts">
<div class="post">
    <h4>#91774 - chishm - Sun Jul 09, 2006 1:39 pm</h4>
    <div class="postbody"><span class="postbody">After many hours, days, weeks and months of work, I have gotten the new libfat to a stage ready for testing. 
<br/>
<br/>
To try it, get <a class="postlink" href="http://chishm.drunkencoders.com/libfat/libfat-20060709.tar.bz2" target="_blank">libfat-20060709.tar.bz2</a> from my site.
<br/>
<br/>
To install, extract the archive to your libnds directory, so you should have  /path/to/devkitpro/libnds/include/fat.h and /path/to/devkitpro/libnds/lib/libfat.a .
<br/>
<br/>
To use, you'll need to #include &lt;fat.h&gt; in the file where the library will be initialised, and #include &lt;stdio.h&gt; in any source file that needs file access. In your makefile, add libfat to the list of libraries, before libnds. You'll also need to link in libnds. Eg:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">LIBS   :=  -lfat -lnds9</td> </tr></table><span class="postbody">
<br/>
<br/>
In your program initialisation code, add a call to fatInitialise. The first parameter specifies the size of the sector cache in pages and the second parameter determines if this is to be the default file driver. For 4 cache pages and setting this as the default I/O device, use:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">if (fatInitialise(4, true)) {
<br/>
    // Success
<br/>
} else {
<br/>
    // Failure
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
It needs a minimum of 2 cache pages to operate efficiently. Memory is malloc'd for this, so you'll need malloc for it to work. Each page takes about 550 bytes of memory. Use more pages for extra speed when randomly accessing files. 
<br/>
<br/>
Once the driver is initialised, files are accessed like in normal C implementations. Use FILE* file = fopen (path, mode); to open a file, for example. If this has been set as the default I/O device, the path is simply of the form "/path/to/file". If this isn't set as the default device, you'll need to specify the device in the path, eg "fat:/path/to/file". "fat:" tells open to open files using the FAT device. There is support for using a device in both slots at once. "fat0:" is equivalent to "fat:", and uses whichever slot it finds a valid device in first (starting with slot 1). "fat1:" specifies slot 1 (the DS Card). "fat2:" specifies slot 2 (the GBA slot). "fat3:" specifies a custom device (this isn't externally visible in the library yet).
<br/>
<br/>
Directory listing isn't available, since DevKitPro r19a doesn't have this functionality yet.
<br/>
<br/>
Keep in mind that this is still in alpha stage. Functionality will be added and possibly changed in future releases. Also, it requires at least DevKitPro r19 to function.
<br/>
<br/>
EDIT:
<br/>
Latest version comes with DevkitARM r20. Full instructions are on my <a class="postlink" href="http://chishm.drunkencoders.com/libfat/index.html" target="_blank">libfat page</a>.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"><br/><br/>Last edited by chishm on Thu Feb 15, 2007 1:17 am; edited 2 times in total</span></div>    
</div>
<div class="post">
    <h4>#91782 - Sausage Boy - Sun Jul 09, 2006 3:16 pm</h4>
    <div class="postbody"><span class="postbody">Great work! Which devices are supported now?<br/>_________________<br/>"no offense, but this is the gayest game ever"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#91784 - tepples - Sun Jul 09, 2006 3:56 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote">After many hours, days, weeks and months of work, I have gotten the new libfat to a stage ready for testing. 
<br/>
<br/>
To try it, get <a class="postlink" href="http://chishm.drunkencoders.com/libfat/libfat-20060709.tar.bz2" target="_blank">libfat-20060709.tar.bz2</a> from my site.</td> </tr></table><span class="postbody">
<br/>
For those confused by "tar.bz2", that's the extension for a popular compression format on FreeBSD and Linux. Developers on Windows can use 7-Zip to extract it.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">To install, extract the archive to your libnds directory</td> </tr></table><span class="postbody">
<br/>
Is the DS-only restriction just for this test version, or have you end-of-lifed the GBA version entirely?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">It needs a minimum of 2 cache pages to operate efficiently. Memory is malloc'd for this, so you'll need malloc for it to work.</td> </tr></table><span class="postbody">
<br/>
If you have not EOL'd the GBA version does anyone know how to trick malloc into starting its heap from an arbitrary EWRAM address instead of from the end of the multiboot program?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">There is support for using a device in both slots at once. "fat0:" is equivalent to "fat:", and uses whichever slot it finds a valid device in first (starting with slot 1). "fat1:" specifies slot 1 (the DS Card). "fat2:" specifies slot 2 (the GBA slot).</td> </tr></table><span class="postbody">
<br/>
Is fat1: compatible with Nitro FAT on a DS Game Card or compatible flash card, or only with MS-DOS FAT in the MK2/MK3 adapter? The distinction becomes important 1. for homebrew modding of games stored on DS Game Cards, and 2. once UltraFlashPass and similar cards become popular.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">"fat3:" specifies a custom device (this isn't externally visible in the library yet).</td> </tr></table><span class="postbody">
<br/>
Would this be flexible enough to accommodate CIFS or HTTP?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#91792 - parrot_ - Sun Jul 09, 2006 5:18 pm</h4>
    <div class="postbody"><span class="postbody">Would the fat3 "drive" be capable of handling flat-file FAT, like a FAT GBFS?<br/>_________________<br/>Squak! etc.
<br/>
<a class="postlink" href="http://squakly.wordpress.com" target="_blank">My Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#91800 - HyperHacker - Sun Jul 09, 2006 8:03 pm</h4>
    <div class="postbody"><span class="postbody">Can it be run without caching?
<br/>
<br/>
[edit] Also will we be able to determine how much disk space is available, and will you add some form of directory listing function?<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#91804 - Dwedit - Sun Jul 09, 2006 8:34 pm</h4>
    <div class="postbody"><span class="postbody">So this is just for standard library file IO functions?  Any differences between this and the gba_nds_fat library?<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#91811 - tepples - Sun Jul 09, 2006 9:50 pm</h4>
    <div class="postbody"><span class="postbody">As far as I can tell, this replaces at least the nds part of gba_nds_fat in the same way that SnezziDS replaces snesDS.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#91869 - chishm - Mon Jul 10, 2006 9:21 am</h4>
    <div class="postbody"><span class="postbody">Ok, I'll answer the questions in order of posting.
<br/>
<br/>
Supported devices: Neoflash MK2/3, GBAMP CF, M3 CF, M3 SD, SC CF, Flash Carts (search the forums for FCSR).
<br/>
Unconfirmed but included: Max Media Player/Dock, EFA2
<br/>
Included but not working: SC SD
<br/>
Unsupported: Anything else.
<br/>
<br/>
The DS only restriction is only for this build, since I haven't finished getting the GBA build to work. I'll probably make it used a fixed cache size and static allocated memory.
<br/>
<br/>
All "fat[0-3]:" devices only support MS-DOS FAT. For other filesystems, it is better to write a new filesystem driver from scratch and implement it the same way as libfat -- using the devoptab in DevKitPro (see &lt;sys/iosupport.h&gt;).
<br/>
<br/>
"fat3" is intended for using hardware devices that haven't been incorporated into the library yet. For example, if a new cart comes out that hasn't been incorporated into the library yet then it can still be used by developers by mounting the custom device.
<br/>
<br/>
It can't be run without caching, since the unified disc cache replaces several caches that were in the old version. In gba_nds_fat, the FAT had it's own cache, as did each openned file. That's why at least 2 pages are needed.
<br/>
<br/>
This is a more efficient implementation of file I/O functions. In gba_nds_fat, I had to implement fopen, fputs, etc. Now I only have open, close, read, write and a few other functions implemented, and newlib handles the rest. This means other filesystems will use the same fputs, etc functions too. In case you didn't check, fat.h only has one function, used to initialise libfat. The rest is done through callbacks provided to newlib through the devoptab. We should be very thankful that WinterMute provided the devoptab.
<br/>
<br/>
File listing won't be available until it is included in the devoptab.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#91878 - Normmatt - Mon Jul 10, 2006 10:40 am</h4>
    <div class="postbody"><span class="postbody">Wow I like the new way of doing things, Its much easier to setup than the older lib.
<br/>
<br/>
Also it works fine on my m3sd, nice work on the driver chishm :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#91897 - D-loader - Mon Jul 10, 2006 2:20 pm</h4>
    <div class="postbody"><span class="postbody">are you planning to make SC:SD support in the future?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#91899 - dawn2k - Mon Jul 10, 2006 2:28 pm</h4>
    <div class="postbody"><span class="postbody">What about the MiniSD/MicroSD Devices?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#91906 - Normmatt - Mon Jul 10, 2006 3:14 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>dawn2k wrote:</b></span></td> </tr> <tr> <td class="quote">What about the MiniSD/MicroSD Devices?</td> </tr></table><span class="postbody">
<br/>
MiniSD to my knowledge uses the same interface as the normal sized SD cards so should work using the SD drivers</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#91992 - bugmenot! - Tue Jul 11, 2006 12:00 am</h4>
    <div class="postbody"><span class="postbody">thank god, maybe now more homebrew will support SD devices like the M3. Flash cart file manager anyone?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#91993 - ThetaDot - Tue Jul 11, 2006 12:09 am</h4>
    <div class="postbody"><span class="postbody">Please pardon my n00b question, but what immediate effect does this have? This library handles the reading and writing through the flashcart to the media storage, right?
<br/>
*runs and hides*</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#92019 - HyperHacker - Tue Jul 11, 2006 4:38 am</h4>
    <div class="postbody"><span class="postbody">Hm, sounds great, but I guess we'll have to use soft-shutdown functions now due to the caching (unmount, then power off, instead of using the power button)? Either way its usefulness is rather limited without a directory listing function.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#92022 - chishm - Tue Jul 11, 2006 4:45 am</h4>
    <div class="postbody"><span class="postbody">D-loader:
<br/>
I would if I had a SC:SD. I've tried a few times to get it working, but without hardware to test it on, it's practically impossible.
<br/>
<br/>
HyperHacker:
<br/>
The cache is flushed when files are closed or deleted, so as long as you close files when you are finished with them (which you should be doing anyway) it will be fine.
<br/>
<br/>
ThetaDot:
<br/>
I guess you could say that.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#92051 - dem1980 - Tue Jul 11, 2006 9:48 am</h4>
    <div class="postbody"><span class="postbody">thank you for your work !
<br/>
does this first release support G6 linker for example !<br/>_________________<br/>I'm not inglish, sorry for my bad inglish :-/</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#92060 - chishm - Tue Jul 11, 2006 11:06 am</h4>
    <div class="postbody"><span class="postbody">At least read <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=10289&amp;start=7" target="_blank">my answers in this thread</a> before posting questions. 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Chishm wrote:</b></span></td> </tr> <tr> <td class="quote">Supported devices: Neoflash MK2/3, GBAMP CF, M3 CF, M3 SD, SC CF, Flash Carts (search the forums for FCSR).
<br/>
Unconfirmed but included: Max Media Player/Dock, EFA2
<br/>
Included but not working: SC SD
<br/>
<span style="font-weight: bold">Unsupported: Anything else. </span></td> </tr></table><span class="postbody"><br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#92068 - quadomatic - Tue Jul 11, 2006 11:51 am</h4>
    <div class="postbody"><span class="postbody">if Max Media Dock is supported by this fat library, does that mean that the Max Media Dock can/will be as homebrew capable as the gbamp?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#92074 - tepples - Tue Jul 11, 2006 1:18 pm</h4>
    <div class="postbody"><span class="postbody">First you'll have to implement exec() on top of this library, as MAX Media Player doesn't seem to support .nds files larger than 1 MB.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#92263 - chishm - Wed Jul 12, 2006 12:11 pm</h4>
    <div class="postbody"><span class="postbody">I have added everything I wanted to, so here it is, the latest version:
<br/>
<a class="postlink" href="http://chishm.drunkencoders.com/libfat/20060712/libfat-src-20060712.tar.bz2" target="_blank">Source</a>
<br/>
<a class="postlink" href="http://chishm.drunkencoders.com/libfat/20060712/libfat-nds-20060712.tar.bz2" target="_blank">DS library</a>
<br/>
<a class="postlink" href="http://chishm.drunkencoders.com/libfat/20060712/libfat-gba-20060712.tar.bz2" target="_blank">GBA library</a>
<br/>
As before, you need DevKitPro r19 to use this. The GBA version still uses malloc (it's unavoidable), but there is a bug in DKP r19(a) that causes malloc to fail for gba_mb specs. Therefore,  the GBA version will need DKP r20 when it's out.
<br/>
To compile the source, run make where you extracted the library. To install the NDS library in windows, download it to a folder and at a command line in that directory run:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">bzip2 -cd libfat-nds-20060712.tar.bz2 | tar -xv -C %DEVKITPRO%/libnds</td> </tr></table><span class="postbody">
<br/>
bzip2 and tar are included with DKP, so this should work. 
<br/>
Likewise for the GBA library run:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">bzip2 -cd libfat-gba-20060712.tar.bz2 | tar -xv -C %DEVKITPRO%/libgba</td> </tr></table><span class="postbody">
<br/>
<br/>
Usage of the library is the same as before. This is still in alpha, as function names may change again. Make sure to backup any media that you run this on.
<br/>
<br/>
EDIT:
<br/>
Forgot to mention that errno is now supported. Simply #include &lt;errno.h&gt; and use it like normal.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#92632 - chishm - Fri Jul 14, 2006 7:44 am</h4>
    <div class="postbody"><span class="postbody">There is now source code to <a class="postlink" href="http://devkitpro.cvs.sourceforge.net/devkitpro/libfat/" target="_blank">libfat</a> in the <a class="postlink" href="http://devkitpro.org/" target="_blank">devkitPro</a> <a class="postlink" href="http://sourceforge.net/cvs/?group_id=114505" target="_blank">CVS repository</a>. All future source code updates will be committed to the repository.
<br/>
<br/>
Also, libfat is still in alpha stage, as there aren't any directory listing functions yet. 
<br/>
<br/>
<span style="font-size: 7px; line-height: normal">PS, I thought this news was bump worthy.</span><br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93233 - tepples - Mon Jul 17, 2006 11:31 pm</h4>
    <div class="postbody"><span class="postbody">Exactly what would it take on your part and on wintermute's to get <a class="postlink" href="http://www.opengroup.org/onlinepubs/009695399/basedefs/dirent.h.html" target="_blank">&lt;dirent.h&gt;</a> and <a class="postlink" href="http://www.opengroup.org/onlinepubs/009695399/basedefs/sys/stat.h.html#tag_13_62" target="_blank">&lt;sys/stat.h&gt;</a> working?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93248 - chishm - Tue Jul 18, 2006 1:41 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Exactly what would it take on your part and on wintermute's to get <a class="postlink" href="http://www.opengroup.org/onlinepubs/009695399/basedefs/dirent.h.html" target="_blank">&lt;dirent.h&gt;</a> and <a class="postlink" href="http://www.opengroup.org/onlinepubs/009695399/basedefs/sys/stat.h.html#tag_13_62" target="_blank">&lt;sys/stat.h&gt;</a> working?</td> </tr></table><span class="postbody">
<br/>
stat and fstat work already. Directory listing needs some more functions added to devoptab_t (the structure of function pointers used for each stdio device) by WinterMute. Once that is done, I need to implement the functions within libfat. The changes to devoptab_t will need a new DKP release, and a new libfat release should follow soon after.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93282 - melw - Tue Jul 18, 2006 8:42 am</h4>
    <div class="postbody"><span class="postbody">Great work Chishm! I've been waiting unified / clean fat lib for a while and all the sudden it's here.
<br/>
<br/>
My two cents to the continuous "can you support this and this device" requests: Have you tried contacting flash card manufacturers asking for receiving free test adapters? To me it sounds like for example Supercard would benefit if they sent a free copy to you for testing, if that'd mean probable support for SC SD adapters. In the end lot of the flash card users are after homebrew - it'd be mutual benefit for both the card manufacturers and the homebrew community. Same goes for M3, G6... perhaps even GBAMP SD? :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93316 - josath - Tue Jul 18, 2006 4:25 pm</h4>
    <div class="postbody"><span class="postbody">Or even making a page where people can donate money to get you to support their favorite adaptor...i know i'd throw in a few bucks</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93340 - nukomod - Tue Jul 18, 2006 6:52 pm</h4>
    <div class="postbody"><span class="postbody">I'd be very tempted to throw in some change toward an SC SD adapter for you.. paypal or something?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93353 - Sintax - Tue Jul 18, 2006 7:33 pm</h4>
    <div class="postbody"><span class="postbody">Yeah just get a donations page up already, I'm sure plenty of people would throw in a few bucks to finally get full SCSD support.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93467 - chishm - Wed Jul 19, 2006 10:26 am</h4>
    <div class="postbody"><span class="postbody">Well I got a Supercard SD adapter donated yesterday, thanks to NorQue. I'll work on it as soon as I get time (busy with life, etc.).<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#94008 - chishm - Sat Jul 22, 2006 1:34 pm</h4>
    <div class="postbody"><span class="postbody">New lib out. The source is in <a class="postlink" href="http://devkitpro.cvs.sourceforge.net/devkitpro/libfat/" target="_blank">DevkitPro CVS</a>, or you can just use the <a class="postlink" href="http://chishm.drunkencoders.com/libfat/20060722/libfat-gba-20060722.tar.bz2" target="_blank">precompiled GBA version</a> or the <a class="postlink" href="http://chishm.drunkencoders.com/libfat/20060722/libfat-nds-20060722.tar.bz2" target="_blank">precompiled NDS version</a>.
<br/>
<br/>
A few bugs in the FAT handling code have been fixed thanks to loopy. There is now a fatInitDefault() function to make it even easier to use. There may be a few other bugs fixed that I've forgotten about. Also, there is now full Supercard SD support. 
<br/>
<br/>
Some of you may notice that I use ASM code in the SCSD driver. This is allowed within libfat, and is part of the reason I made it a proper library. That being said, I only used it because it was necessary for hardware timing accuracy, and I'd still prefer the drivers to be written in C.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#94014 - PeterM - Sat Jul 22, 2006 2:53 pm</h4>
    <div class="postbody"><span class="postbody">Thank you very very much for the SuperCard SD support. I really appreciate it.<br/>_________________<br/><a href="http://aaiiee.wordpress.com/" target="_blank">http://aaiiee.wordpress.com/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#94332 - melw - Mon Jul 24, 2006 1:14 pm</h4>
    <div class="postbody"><span class="postbody">Chishm, I had couple of quirks I have when using the latest CVS version out of the box with my own project space. Nothing major though, but I decided to paste these here just because of the 'long long long' line. :)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">c:/devkitpro/libnds/include/nds/jtypes.h:109: error: 'long long long' is too long for GCC
<br/>
c:/devkitpro/libnds/include/nds/jtypes.h:109: error: declaration does not declare anything
<br/>
c:/devkitpro/libnds/include/nds/jtypes.h:127: error: multiple types in one declaration
<br/>
c:/devkitpro/libnds/include/nds/jtypes.h:127: error: declaration does not declare anything
<br/>
c:/devkitpro/libnds/include/nds/jtypes.h:158: error: redefinition of 'struct touchPosition'
<br/>
c:\devkitpro\libnds/include/nds/jtypes.h:158: error: previous definition of 'struct touchPosition'
<br/>
c:/devkitpro/libnds/include/nds/jtypes.h:165: error: invalid type in declaration before ';' token
<br/>
c:/devkitpro/libnds/include/nds/jtypes.h:165: error: conflicting declaration 'typedef int touchPosition'
<br/>
c:\devkitpro\libnds/include/nds/jtypes.h:165: error: 'touchPosition' has a previous declaration as 'typedef struct touch Position touchPosition'</td> </tr></table><span class="postbody">
<br/>
<br/>
This when compiling, removing #include &lt;nds/jtypes.h&gt; from fat.h line 51 fixed the errors for me.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">c:\devkitpro\libnds/lib\libfat.a(io_nmmc.o): In function `_Neo_SelectMMC':
<br/>
c:/projects/nds/libfat/nds/../source/disc_io/io_nmmc.c:106: undefined reference to `cardWriteCommand'</td> </tr></table><span class="postbody">
<br/>
<br/>
This when linking. Just removed the NMMC support from disc.c as I don't need it myself right now, bypassing this problem.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#94355 - wintermute - Mon Jul 24, 2006 3:26 pm</h4>
    <div class="postbody"><span class="postbody">There's something very very wrong with your devkitARM installation. This looks like you've somehow managed to break the header guards in jtypes.h or have something else included before which is breaking things.
<br/>
<br/>
What do you mean with your own project space? The CVS version is a library meant to be built on it's own and linked against, not copied into your project like the older one.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#94394 - melw - Mon Jul 24, 2006 6:46 pm</h4>
    <div class="postbody"><span class="postbody">My bad. The first one was mangled code, and the linking error was a result of passing -lfat after -lnds9 to the linker, not the other way around. Nothing wrong with the libfat.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#94395 - josath - Mon Jul 24, 2006 6:55 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>melw wrote:</b></span></td> </tr> <tr> <td class="quote">My bad. The first one was mangled code, and the linking error was a result of passing -lfat after -lnds9 to the linker, not the other way around. Nothing wrong with the libfat.</td> </tr></table><span class="postbody">
<br/>
<br/>
I had the same exact problem...but I didn't see your post in time to warn you :P
<br/>
<br/>
Personally I can never remember the order in which to link libraries, so if I get 'undefined reference to ...', and I'm pretty sure it is defined, I just twiddle with the order of the -l commands to the linker.
<br/>
<br/>
---
<br/>
<br/>
Also, in a preliminary testing of libfat, by replacing fatlib usage in my code, appears to output 0-byte files. (on SC CF). I will also test on gbamp, and also run chkdsk, perhaps my CF card is corrupted (by some other buggy homebrew).
<br/>
<br/>
<span style="font-weight: bold">EDIT:</span> It appeared to be just a onetime glitch...chkdsk'd my card, then ran it again, and it seems to work fine. Loading is currently disabled, since I can't list files yet.
<br/>
<br/>
If anyone wants to test this on their device and report back, please go ahead. I tested with success on GBAMP and SC CF.
<br/>
<br/>
<a class="postlink" href="http://davr.org/ds2/Draw3.nds" target="_blank">NDS version</a> | <a class="postlink" href="http://davr.org/ds2/Draw3.ds.gba" target="_blank">.DS.GBA version</a> | <a class="postlink" href="http://blog.davr.org/2006/07/24/draw-test-with-new-libfat/" target="_blank">My site</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#94711 - arog - Tue Jul 25, 2006 9:58 pm</h4>
    <div class="postbody"><span class="postbody">Doing some testing with libfat myself, and though I can read files (on my GBAMP with DSlite) just fine, I am having trouble outputting to a subdirectory.
<br/>
<br/>
Here's the latest incarnation of my code (please forgive its ugliness):
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">	// Write to a file
<br/>
FILE *ostream, *fopen();
<br/>
if ( (ostream = fopen ("/data/write.txt", "w"))) { // Open file
<br/>
char x[10] = "0123456789";
<br/>
fwrite(x, sizeof(x[0]), sizeof(x)/sizeof(x[0]), ostream);
<br/>
fclose(ostream);  // close file
<br/>
iprintf("\n\n\tWrote to file\n");
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
If I take out <span style="font-weight: bold">/data</span>, it writes the file just fine.  Am I doing something wrong?
<br/>
<br/>
EDIT: Oh, I remember seeing that libfat couldn't list directories, is this basically the issue?
<br/>
<br/>
- Aaron Rogers
<br/>
<a href="http://www.aaronrogers.com/nintendods/" target="_blank">http://www.aaronrogers.com/nintendods/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#94843 - chishm - Wed Jul 26, 2006 12:16 pm</h4>
    <div class="postbody"><span class="postbody">I tried that code, and I did manage to get it to fail. To do this I had to create a new directory and write the file into that. I have fixed that particular bug, so when writing to the end of a directory, the file should work. Updated code is in CVS.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#94852 - melw - Wed Jul 26, 2006 1:00 pm</h4>
    <div class="postbody"><span class="postbody">Have done now some tests with M3, both CF and SD versions. With M3CF both the saving and reading the files work just as it should, but with M3SD fatInitDefault() returns false - same when trying something like fatInit(4, true). Not sure if the M3 firmware version has anything to do with the issue, I'm still using E18 due to problems reported with newer drivers.
<br/>
<br/>
Josath, with Draw3 test the M3CF outputs right away a blank/white .png but keeps jamming after that. With M3SD I can draw and it says it's saving when I press 'x' but no files are written on the memory card. If you could add an extra check to show on screen whether fatInit() fails that would be helpful with testing...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#94923 - arog - Wed Jul 26, 2006 10:05 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Updated code is in CVS.</td> </tr></table><span class="postbody">
<br/>
<br/>
Works great, thanks!
<br/>
<br/>
Next question, what if I want to create a directory?  Is that possible/easy to do?
<br/>
<br/>
- Aaron Rogers
<br/>
<a href="http://www.aaronrogers.com/nintendods/" target="_blank">http://www.aaronrogers.com/nintendods/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#94927 - Dwedit - Wed Jul 26, 2006 10:21 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Some of you may notice that I use ASM code in the SCSD driver. This is allowed within libfat, and is part of the reason I made it a proper library. That being said, I only used it because it was necessary for hardware timing accuracy, and I'd still prefer the drivers to be written in C.</td> </tr></table><span class="postbody">
<br/>
<br/>
If it requires exact timing, how does it work on both a GBA and NDS?<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#94932 - tepples - Wed Jul 26, 2006 10:38 pm</h4>
    <div class="postbody"><span class="postbody">Either separate binaries with the exact timing adjusted, or the timing depends on the speed of the GBA cart bus interface, which can be made the same in both modes.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#95007 - chishm - Thu Jul 27, 2006 9:17 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dwedit wrote:</b></span></td> </tr> <tr> <td class="quote">If it requires exact timing, how does it work on both a GBA and NDS?</td> </tr></table><span class="postbody">
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Either separate binaries with the exact timing adjusted, or the timing depends on the speed of the GBA cart bus interface, which can be made the same in both modes.</td> </tr></table><span class="postbody">
<br/>
The second one. It uses stmia to transmit 4 halfwords to the GBA cart (16 bits per transfer). The first halfword contains the data to be written, and the next 3 (along with the first) provide clock signals for the Supercard's internal circuitry to break that data into 4 nibbles and transmit them to the SD card. I tried to do it in C, but I can't guarantee that the compiler will compile to stmia, and 4 lots of strh doesn't work.
<br/>
<br/>
arog:
<br/>
Not as yet. Directories aren't fully supported within devkitPro yet, which is why libfat is still in alpha.
<br/>
<br/>
melw:
<br/>
It may be due to your SD card. SD cards have a wider range of quality and abilities compared to CF cards, and I only have 1 type of SD card to test with.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#95029 - Lazy1 - Thu Jul 27, 2006 12:49 pm</h4>
    <div class="postbody"><span class="postbody">I'm still having problems with libfat and Mini vMac, it reads the ROM okay but when a system disk is inserted it acts like the PC version does when it's given an invalid/corrupt disk.
<br/>
<br/>
The problem does not exist when using the older fat library or romdiskfs.
<br/>
I'm really interested in helping track this problem down.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#95033 - melw - Thu Jul 27, 2006 1:22 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote">melw:
<br/>
It may be due to your SD card. SD cards have a wider range of quality and abilities compared to CF cards, and I only have 1 type of SD card to test with.</td> </tr></table><span class="postbody">
<br/>
<br/>
Hmm. Using Kingston 1Gb SD card over here... should be one of the better quality ones, I believe. Also, both REIN v15 and Josath's old version of Draw3 (using the same SaTa modified FAT lib?) works well with the card what comes  reading and writing files.
<br/>
<br/>
Edit: fatInit() seems to go all the way to _M3SD_initCard() until it reaches the MAX_STARTUP_TRIES check. If I bypass that one, a moment later there's the RESPONSE_TIMEOUT failure. Couldn't find corresponding spot in SaTa's version to compare what's done differently. If you have any debugging tips on what to check next, I could do some more testing...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#95079 - Lazy1 - Thu Jul 27, 2006 7:18 pm</h4>
    <div class="postbody"><span class="postbody">I though I'd post the functions being called to read from the filesystem...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#ifndef NotAfileRef
<br/>
   #define NotAfileRef -1
<br/>
#endif
<br/>
<br/>
int Drives[NumDrives]; /* open disk image files */
<br/>
<br/>
LOCALPROC InitDrives(void)
<br/>
{
<br/>
   si4b i;
<br/>
<br/>
   for (i = 0; i &lt; NumDrives; ++i) {
<br/>
      Drives[i] = NotAfileRef;
<br/>
   }
<br/>
}
<br/>
<br/>
GLOBALFUNC si4b vSonyRead(void *Buffer, ui4b Drive_No, ui5b Sony_Start, ui5b *Sony_Count)
<br/>
{
<br/>
#ifdef DiskInSRAM
<br/>
   if ( Drives[ Drive_No ] == ( int ) SRAM ) {
<br/>
      MyMoveBytes( ( anyp ) ( SRAM + Sony_Start ), ( anyp ) Buffer, *Sony_Count );
<br/>
      return 0;
<br/>
   }
<br/>
#endif
<br/>
<br/>
   FS.seek( Drives[ Drive_No ], Sony_Start, SEEK_SET );
<br/>
   FS.read( Drives[ Drive_No ], Buffer, *Sony_Count );
<br/>
<br/>
   return 0; /*&amp; figure out what really to return &amp;*/
<br/>
}
<br/>
<br/>
GLOBALFUNC si4b vSonyWrite(void *Buffer, ui4b Drive_No, ui5b Sony_Start, ui5b *Sony_Count)
<br/>
{
<br/>
#ifdef DiskInSRAM
<br/>
   if ( Drives[ Drive_No ] == ( int ) SRAM ) {
<br/>
      MyMoveBytes( ( anyp ) Buffer, ( anyp ) ( SRAM + Sony_Start ), *Sony_Count );
<br/>
      return 0;
<br/>
   }
<br/>
#endif
<br/>
<br/>
   FS.seek( Drives[ Drive_No ], Sony_Start, SEEK_SET );
<br/>
   FS.write( Drives[ Drive_No ], Buffer, *Sony_Count );
<br/>
   
<br/>
   return 0; /*&amp; figure out what really to return &amp;*/
<br/>
}
<br/>
<br/>
GLOBALFUNC si4b vSonyGetSize(ui4b Drive_No, ui5b *Sony_Count)
<br/>
{
<br/>
#ifdef DiskInSRAM
<br/>
   if ( Drives[ Drive_No ] == ( int ) SRAM ) {
<br/>
      *Sony_Count = SRAMSize;
<br/>
      return 0;
<br/>
   }
<br/>
#endif
<br/>
<br/>
   FS.seek( Drives[ Drive_No ], 0, SEEK_END );
<br/>
   *Sony_Count = FS.tell( Drives[ Drive_No ] );
<br/>
   
<br/>
   return 0; /*&amp; figure out what really to return &amp;*/
<br/>
}
<br/>
<br/>
GLOBALFUNC si4b vSonyEject(ui4b Drive_No)
<br/>
{
<br/>
#ifdef DiskInSRAM
<br/>
   if ( Drives[ Drive_No ] == ( int ) SRAM ) {
<br/>
      Drives[ Drive_No ] = NotAfileRef;
<br/>
      return 0x0000;
<br/>
   }
<br/>
#endif
<br/>
<br/>
   FS.close( Drives[ Drive_No ] );
<br/>
<br/>
   Drives[Drive_No] = -1;
<br/>
   return 0x0000;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
FS is just a wrapper for using multiple filesystems in the project, right now it supports libfat, the old fat library and romdiskfs.
<br/>
The only one having problems is libfat.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#95377 - chishm - Sat Jul 29, 2006 2:44 am</h4>
    <div class="postbody"><span class="postbody">TheLazy1:
<br/>
I'm thinking that the problem may lie in my implementation of seek. To make it easier to track down the bug, I'll need a bit more information. Is Sony_Start always going to be a multiple of 512 (ie, it reads sectors at a time)? Does vSonyWrite get called at all before it tries to read the disc and fails? When I get back to my dev machine, I'll write an un-optimised version of seek for you to try.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#95388 - Lazy1 - Sat Jul 29, 2006 3:48 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
vSonyRead( Buffer=B003B1C, Drive_No=0, Sony_Start=1024, *Sony_Count=128 ); IPC-&gt;heartbeat = 509
<br/>
vSonyRead( Buffer=2193730, Drive_No=0, Sony_Start=0, *Sony_Count=1024 ); IPC-&gt;heartbeat = 596
<br/>
vSonyRead( Buffer=2056E02, Drive_No=0, Sony_Start=1024, *Sony_Count=512 ); IPC-&gt;heartbeat = 652
<br/>
vSonyRead( Buffer=205724E, Drive_No=0, Sony_Start=7168, *Sony_Count=512 ); IPC-&gt;heartbeat = 653
<br/>
vSonyRead( Buffer=B003B1C, Drive_No=1, Sony_Start=1024, *Sony_Count=128 ); IPC-&gt;heartbeat = 679
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
vSonyWrite is only called with the old fatlib and that's after the OS has started.
<br/>
I also have no idea if calls to vSonyRead follow any rules, but I doubt it does.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#95403 - chishm - Sat Jul 29, 2006 6:50 am</h4>
    <div class="postbody"><span class="postbody">From the looks of those reads, Sony_Start is aligned to 1024 byte boundaries, but I'll assume 512 since that is what ATA discs use.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#95570 - chishm - Sun Jul 30, 2006 9:18 am</h4>
    <div class="postbody"><span class="postbody">TheLazy1:
<br/>
<a class="postlink" href="http://chishm.drunkencoders.com/libfat/libfat-nds-20060730.zip" target="_blank">This</a> is a test version with seek simplified as much as possible. Try it out and tell me if the problem is solved or not.
<br/>
<br/>
Everyone else:
<br/>
Don't bother with the above debug version.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#95631 - Lazy1 - Sun Jul 30, 2006 5:02 pm</h4>
    <div class="postbody"><span class="postbody">Problem was solved, the system boots as expected :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#95888 - chishm - Mon Jul 31, 2006 12:35 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lazy1 wrote:</b></span></td> </tr> <tr> <td class="quote">Problem was solved, the system boots as expected :)</td> </tr></table><span class="postbody">
<br/>
Okay, that means I have work to do on seek(), since the version you tried is severely limited.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#96361 - jandujar - Wed Aug 02, 2006 9:42 pm</h4>
    <div class="postbody"><span class="postbody">Chishm:
<br/>
<br/>
First of all: Congratulations for your work.
<br/>
<br/>
The only thing that needs this library now is the directory listing.
<br/>
<br/>
I hope you solve this problem soon.
<br/>
<br/>
<span style="font-style: italic">WTF, who is Spelling Fairy?</span><br/>_________________<br/><a class="postlink" href="http://jandujar.homelinux.com" target="_blank">http://jandujar.homelinux.com</a>
<br/>
<a class="postlink" href="http://www.dsrobot.com" target="_blank">http://www.dsrobot.com</a></span><span class="gensmall"><br/><br/>Last edited by jandujar on Thu Aug 03, 2006 9:22 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#96424 - chishm - Thu Aug 03, 2006 9:14 am</h4>
    <div class="postbody"><span class="postbody">Heh, thanks. File listing will be done eventually, but I have a few higher priority tasks I need to take care of.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#98056 - TheRain - Sat Aug 12, 2006 11:02 pm</h4>
    <div class="postbody"><span class="postbody">Hi,   this is REALLY cool... I had my first chance to inspect it today and it has allowed me to add open and save features to dSTAR sequencer (my MIDI program).   
<br/>
<br/>
One thing I found, though, is that it won't work with my Sandisk 1GB SD card within my M3 Perfect.   It works just fine on my 512MB Sandisk card though.  
<br/>
<br/>
I am using the version that was included in the latest libnds update. 
<br/>
<br/>
Thanks so much for this work.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#98076 - chishm - Sun Aug 13, 2006 2:23 am</h4>
    <div class="postbody"><span class="postbody">The last DevkitPro release of libfat (2006-07-22 IIRC) had the SD timeout values set too low (I must have fast SD cards or something). This means that the startup is timing out before some cards have a chance to respond. I've fixed this about a week ago in the source in CVS. It shouldn't be too hard to <a class="postlink" href="http://sourceforge.net/cvs/?group_id=114505" target="_blank">checkout a copy</a> and compile it from source.
<br/>
<br/>
EDIT: w00t, 713th post!<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#98491 - Extreme Coder - Tue Aug 15, 2006 4:21 pm</h4>
    <div class="postbody"><span class="postbody">I hoped EZ4 would be added in this new libfat, looks like I'll have to wait a little longer... Damn it EZ team, why don't you give us the code?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#98494 - josath - Tue Aug 15, 2006 4:54 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Extreme Coder wrote:</b></span></td> </tr> <tr> <td class="quote">I hoped EZ4 would be added in this new libfat, looks like I'll have to wait a little longer... Damn it EZ team, why don't you give us the code?</td> </tr></table><span class="postbody">
<br/>
Have you asked them? Maybe if enough people request it, and include why they want it (better homebrew support, more people use the device, etc), then they might reconsider. Apparently a G6/m3minisd library was released, but without source code. I just sent them an email requesting source, they probably won't do it, but at least they know someone out there wants it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#98601 - chishm - Wed Aug 16, 2006 9:52 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Extreme Coder wrote:</b></span></td> </tr> <tr> <td class="quote">I hoped EZ4 would be added in this new libfat, looks like I'll have to wait a little longer... Damn it EZ team, why don't you give us the code?</td> </tr></table><span class="postbody">
<br/>
There is code, but read only. It isn't a simple case of changing the command to write to the SD card (as is the case for CF), so it will be harder to add write support.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#99078 - chishm - Sat Aug 19, 2006 1:44 pm</h4>
    <div class="postbody"><span class="postbody">I thought I might post a progress update. It turns out that the M3SD driver I wrote works so well even the new micro is supported (well, that's what I've been told). I have also updated the SCSD driver to support the SC Lite. Directory listing is added to the library code, but it requires an update of DevkitPro that isn't released yet. The functions chdir, mkdir and rename are also all there now too.
<br/>
<br/>
Once directory listing is supported by DevkitPro, libfat will reach beta stage. You may not be able to compile it from CVS at the moment, since the devoptab_t stucture needs to be updated first.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#99082 - Lick - Sat Aug 19, 2006 2:09 pm</h4>
    <div class="postbody"><span class="postbody">That's great news Chishm, great news! Your hard work is appreciated.<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#99237 - tepples - Sun Aug 20, 2006 5:50 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>In <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?p=99235#99235" target="_blank">this post</a>, chishm wrote:</b></span></td> </tr> <tr> <td class="quote">Actually, I'd recommend libfat, when DKP r20 comes out.</td> </tr></table><span class="postbody">
<br/>
Is that a hint-hint about the status of opendir()?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#99250 - chishm - Sun Aug 20, 2006 8:38 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>In <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?p=99235#99235" target="_blank">this post</a>, chishm wrote:</b></span></td> </tr> <tr> <td class="quote">Actually, I'd recommend libfat, when DKP r20 comes out.</td> </tr></table><span class="postbody">
<br/>
Is that a hint-hint about the status of opendir()?</span></td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>In <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=10289&amp;postdays=0&amp;postorder=asc&amp;start=58" target="_blank">this post</a>, chishm wrote:</b></span></td> </tr> <tr> <td class="quote">Directory listing is added to the library code, but it requires an update of DevkitPro that isn't released yet.</td> </tr></table><span class="postbody">
<br/>
Although I haven't finished opendir() yet, I have written directory listing functions that behave similarly, but better. Implementing opendir() will be a simple case of writing a wrapper around them.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#99294 - Frz - Sun Aug 20, 2006 3:08 pm</h4>
    <div class="postbody"><span class="postbody">is there any chance for ez4 support?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100062 - Twibber - Fri Aug 25, 2006 9:49 pm</h4>
    <div class="postbody"><span class="postbody">Much appreciated on the M3SD support <span style="font-style: italic">indeed!</span>  Finally I can look forward to some Stella and Coleco support... pending a re-compile of course.
<br/>
<br/>
Aces Chishm... <span style="font-style: italic">ACES!</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100661 - melw - Tue Aug 29, 2006 11:51 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote">You may not be able to compile it from CVS at the moment, since the devoptab_t stucture needs to be updated first.</td> </tr></table><span class="postbody">
<br/>
For the anxious ones like me (willing to test that M3SD again), what exactly needs to be updated in the devoptab_t structure?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100667 - chishm - Tue Aug 29, 2006 1:12 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>melw wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote">You may not be able to compile it from CVS at the moment, since the devoptab_t stucture needs to be updated first.</td> </tr></table><span class="postbody">
<br/>
For the anxious ones like me (willing to test that M3SD again), what exactly needs to be updated in the devoptab_t structure?</span></td> </tr></table><span class="postbody">
<br/>
Extra entries for creating and listing contents of directories.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#101941 - Bronto - Sat Sep 09, 2006 2:29 am</h4>
    <div class="postbody"><span class="postbody">fread always returns 0, although the data is read into the specified buffer. I'm using the libfat that came with the latest devkit (file date 08/13/06). 
<br/>
Is there a fix for this?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#101957 - chishm - Sat Sep 09, 2006 6:05 am</h4>
    <div class="postbody"><span class="postbody">I haven't come across this problem before, but there are some things you can try. First, make sure you are using the latest DevkitARM. The latest is r19b. If that doesn't work, try using open / read / close instead of fopen / fread / fclose. This will bring it as close to the bare libfat routines as possible (to make sure newlib isn't doing anything to mess it up).<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#101988 - Bronto - Sat Sep 09, 2006 3:54 pm</h4>
    <div class="postbody"><span class="postbody">I'm using dk r19b. open/read/close don't seem to be available (not declared in this scope). I'm using fcntl.h and stdio.h</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102057 - chishm - Sun Sep 10, 2006 9:17 am</h4>
    <div class="postbody"><span class="postbody">You want to #include &lt;unistd.h&gt;<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102071 - Bronto - Sun Sep 10, 2006 3:35 pm</h4>
    <div class="postbody"><span class="postbody">thanks, reading works now. 
<br/>
write()ing however fails. It "correctly" returns the bytes written, but actually does not write anything, resulting in a 0-sized file. I *think* fwrite worked though</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102123 - chishm - Mon Sep 11, 2006 1:01 am</h4>
    <div class="postbody"><span class="postbody">Make sure you close() the file after writing.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102124 - Bronto - Mon Sep 11, 2006 1:09 am</h4>
    <div class="postbody"><span class="postbody">I already do call close. Perhaps i need to flush it before?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102132 - darkfader - Mon Sep 11, 2006 3:11 am</h4>
    <div class="postbody"><span class="postbody">Can we flush within a timer or would that require some locks?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102139 - knight0fdragon - Mon Sep 11, 2006 5:37 am</h4>
    <div class="postbody"><span class="postbody">i seem to get it to write fine, but for some reason my time stamps are always fudged up, and I do close all my files when i finish using them<br/>_________________<br/><a href="http://www.myspace.com/knight0fdragonds" target="_blank">http://www.myspace.com/knight0fdragonds</a>
<br/>
<br/>
MK DS FC: Dragon 330772 075464 
<br/>
AC WW FC: Anthony SamsClub 1933-3433-9458 
<br/>
MPFH: Dragon 0215 4231 1206</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102141 - chishm - Mon Sep 11, 2006 5:58 am</h4>
    <div class="postbody"><span class="postbody">Calling close() will clean the cache. You really shouldn't be accessing the internal cache at all from outside the library, as it is all handled internally. 
<br/>
<br/>
I'll have to look into the time stamps when I get some spare time to work on this (no joke intended). They're probably fudged by the conversion from the DS representation of time to the directory entry structure. It's one of the small things that I copied directly over from gba_nds_fat without testing.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104410 - ChronoDK - Thu Sep 28, 2006 8:03 pm</h4>
    <div class="postbody"><span class="postbody">I just tried getting file access working, but I got stuck pretty fast. Hope you can help. 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
FILE* fp;
<br/>
if ((fp = fopen("/test.xml", "r")) == NULL) {
<br/>
   iprintf("\nCannot open file.\n");
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I had hoped not to see "Cannot open file.", but unfortunatly I do see it. What am I doing wrong? I'm using CF GBAMP, r19, the precompiled fatlib 20060722 and fatInit(4, true) returns true. Both the .nds and the file I'm trying to open is at the top level directory of the flashcard.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104457 - Sektor - Fri Sep 29, 2006 8:33 am</h4>
    <div class="postbody"><span class="postbody">That code worked as expected, no problem.  I'm using devkitarm r19b and libfat 20060722.  I'm using fatInitDefault(); to init but that shouldn't matter.<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><a class="postlink" href="http://gtamp.com/DS" target="_blank">GTAMP.com/DS</a></span></span><span class="gensmall"><br/><br/>Last edited by Sektor on Fri Sep 29, 2006 1:36 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#104462 - ChronoDK - Fri Sep 29, 2006 11:04 am</h4>
    <div class="postbody"><span class="postbody">FatInitDefault gives me the same error. I'm using r19b too btw. 
<br/>
<br/>
I also tried to checkout the latest version of libfat from CVS but it didn't compile. Is there a newer precompiled version than the one I'm using?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104521 - josath - Sat Sep 30, 2006 1:37 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ChronoDK wrote:</b></span></td> </tr> <tr> <td class="quote">FatInitDefault gives me the same error. I'm using r19b too btw. 
<br/>
<br/>
I also tried to checkout the latest version of libfat from CVS but it didn't compile. Is there a newer precompiled version than the one I'm using?</td> </tr></table><span class="postbody">
<br/>
<br/>
Perhaps you could post your full source code, as well as compiled .nds file? either:
<br/>
A) your device has some problems such that libfat cannot use it or
<br/>
B) your bug lies in some other part of your code.
<br/>
<br/>
Also: Make sure you don't do fatinit &amp; open at the very beginning of your code. Wait a couple of vblanks before you call fatinit etc</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104522 - tepples - Sat Sep 30, 2006 1:59 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>josath wrote:</b></span></td> </tr> <tr> <td class="quote">Also: Make sure you don't do fatinit &amp; open at the very beginning of your code. Wait a couple of vblanks before you call fatinit etc</td> </tr></table><span class="postbody">
<br/>
Reminds me of NES programming, where you're not supposed to read or write VRAM until after two vblanks.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104527 - chishm - Sat Sep 30, 2006 4:12 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>josath wrote:</b></span></td> </tr> <tr> <td class="quote">Also: Make sure you don't do fatinit &amp; open at the very beginning of your code. Wait a couple of vblanks before you call fatinit etc</td> </tr></table><span class="postbody">
<br/>
Reminds me of NES programming, where you're not supposed to read or write VRAM until after two vblanks.</span></td> </tr></table><span class="postbody">
<br/>
You can call fatInit immediately, but try not to call fopen() before the first VBlank has passed. This is so the time value in the IPC struct has had a chance to be updated with the correct value. Before anyone asks, forcing a check inside the library would just slow it down on every open() / close() for something that is not likely to happen and can easily be prevented in user code. Hand-holding has to stop somewhere.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104534 - PeterM - Sat Sep 30, 2006 8:49 am</h4>
    <div class="postbody"><span class="postbody">What kind of slow-down would it be?
<br/>
<br/>
Sounds like just a "if (static boolean) wait for 2 vblanks" which wouldn't be at all noticable after the initial wait.
<br/>
<br/>
I think the extra effort inside the library is worth it to stop many people inserting 2 NDS vblank waits in otherwise generic code.
<br/>
<br/>
Then again, I like holding hands...<br/>_________________<br/><a href="http://aaiiee.wordpress.com/" target="_blank">http://aaiiee.wordpress.com/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104537 - Link_of_Hyrule - Sat Sep 30, 2006 9:11 am</h4>
    <div class="postbody"><span class="postbody">just wondering hows the g6 compatibility for this or do we know?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104538 - ChronoDK - Sat Sep 30, 2006 9:39 am</h4>
    <div class="postbody"><span class="postbody">Thanks, I got it working. Will try not to call fopen immediately from now on. 
<br/>
<br/>
The primary error was something else though - but it is way too embarrassing to tell about :-)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104546 - Lick - Sat Sep 30, 2006 11:25 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define fatInitDefaultHoldingHands();  swiWaitForVBlank(); \
<br/>
                                                      swiWaitForVBlank(); \
<br/>
                                                      fatInitDefault();</td> </tr></table><span class="postbody">
<br/>
LOL.
<br/>
<br/>
By the way, is the main focus of libfat to provide stable code for as many cards possible, or to provide perfect code (+ code design) for the popular cards? That's really a question to think about.
<br/>
<br/>
- Lick<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104554 - ChronoDK - Sat Sep 30, 2006 11:54 am</h4>
    <div class="postbody"><span class="postbody">Heh, I used the exact code in that define :-)
<br/>
<br/>
Anyway, I'm trying to do something useful with the file system stuff now. Working with strings is nice, but I would like to load my sprites from file too. 
<br/>
<br/>
This is what I got, and it aint working:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
FILE* fp;
<br/>
if ((fp = fopen("/ninja_1.raw", "rb")) == NULL) {
<br/>
   iprintf("\nCannot open raw file.\n");
<br/>
}
<br/>
else {
<br/>
   dmaCopy((u8*)fp, (void*)SPRITE_MEM(0), 512);
<br/>
}
<br/>
   
<br/>
if ((fp = fopen("/ninja_1.pal", "rb")) == NULL) {
<br/>
   iprintf("\nCannot open pal file.\n");
<br/>
}
<br/>
else {
<br/>
   dmaCopy((u8*)fp, SPRITE_PAL(0), 32);
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
I'm trying to copy a 32x32 16 color sprite converted with gfx2gba (as doing the conversion in code seems way to advanced for me). Nothing shows up on the screen.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104556 - Lick - Sat Sep 30, 2006 12:01 pm</h4>
    <div class="postbody"><span class="postbody">C I/O doesn't work that way. fp is NOT a charpointer to the bytebuffer of that file. It's a handle, that the I/O system works with.
<br/>
<br/>
1) use fread();
<br/>
2) don't use dmaCopy(), use memcpy();
<br/>
3) "rb" isn't necessary, libfat only does binary. ("r" = "rb")
<br/>
<br/>
- Lick<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104558 - chishm - Sat Sep 30, 2006 12:16 pm</h4>
    <div class="postbody"><span class="postbody">I thought I would try the hand-holding approach for file times after all, but I discovered a few problems along the way. The combined ARM9 / ARM7 template provided in DKP r19 doesn't update the RTC values in the IPC struct. (No calls to rtcGetTime() are made at all.) This means the time will always be incorrect. If I attempt to wait until the time is valid, it may wait indefinitely. Therefore if the time is invalid, I'll simply set the file time to NULL rather than waiting for it to become valid.
<br/>
<br/>
Also, it is only close() that uses the time, so you can open() (and therefore fopen()) any time. 
<br/>
<br/>
The main focus is to provide stable, <span style="font-weight: bold">correct</span> code for as many cards as possible. Correctness means it cannot give false positives for the card detection function, it has to support reading, and it should (but doesn't have to) support writing. It also has to be fail safe, so if a function cannot access the card, it should give up and return an indication that an error occured.
<br/>
<br/>
ChronoDK:
<br/>
Care to share what the problem was? Other people can learn from your mistakes too.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104559 - Sausage Boy - Sat Sep 30, 2006 12:17 pm</h4>
    <div class="postbody"><span class="postbody">Using "rb" is a good habit, even if it's not necessary in this case. Who knows what future fat versions will add? Even if a text version is very unlikely, using "r" is just stupid. Don't change it.<br/>_________________<br/>"no offense, but this is the gayest game ever"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104562 - chishm - Sat Sep 30, 2006 12:36 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lick wrote:</b></span></td> </tr> <tr> <td class="quote">"rb" isn't necessary, libfat only does binary. ("r" = "rb")
<br/>
</td> </tr></table><span class="postbody">
<br/>
Actually, it's newlib that deals with fopen(), libfat just provides open() (which newlib calls). Therefore, if newlib gets updated to support text mode verses binary mode then so will whatever uses it. Sausage Boy is right though, leave it in just in case. It especially helps for ports.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104564 - Lick - Sat Sep 30, 2006 1:01 pm</h4>
    <div class="postbody"><span class="postbody">Whew.. man information is changing fast. Last time I asked it was still 'r is enough'.<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104566 - chishm - Sat Sep 30, 2006 1:14 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lick wrote:</b></span></td> </tr> <tr> <td class="quote">Whew.. man information is changing fast. Last time I asked it was still 'r is enough'.</td> </tr></table><span class="postbody">
<br/>
"r" is indeed enough. However, "rb" is better if you plan on reusing code at a later date or on another platform.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104571 - Hermes - Sat Sep 30, 2006 1:50 pm</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
I want to report a little bug present in libfat, in the function FAT_mkdir()
<br/>
<br/>
To initialize the entries the functions ends so:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
// Write entry to disc
<br/>
   disc_WriteSector(FAT_ClustToSect(newDirCluster), entries);
<br/>
<br/>
// Flush any sectors in disc cache
<br/>
   disc_CacheFlush();
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
So, it only write one sector of the cluster!!! (and the rest sectors has bad datas)
<br/>
<br/>
Replace by:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
   // Write entry to disc
<br/>
   for(i=0;i&lt;filesysSecPerClus;i++) /*  to write all the cluster correctly*/
<br/>
   {
<br/>
   disc_WriteSector(FAT_ClustToSect(newDirCluster)+i, entries);
<br/>
   memset(entries,  FILE_LAST, BYTE_PER_READ); /* set to 0 the rest of the sectors */
<br/>
   }
<br/>
<br/>
   // Flush any sectors in disc cache
<br/>
   disc_CacheFlush();
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
And problem solved ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104577 - chishm - Sat Sep 30, 2006 5:00 pm</h4>
    <div class="postbody"><span class="postbody">Well that is actually a function from gba_nds_fat, not libfat. However, the libfat version does operate in the same way. It shouldn't have affected anything, since the end of directory marker is moved when new entries are created. 
<br/>
<br/>
After testing, it appears that not clearing the cluster will cause problems for other OSes when they try to add entries to the directory. This has now been fixed in libfat (despite mkdir not actually being usable at the moment).<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104599 - ChronoDK - Sat Sep 30, 2006 7:37 pm</h4>
    <div class="postbody"><span class="postbody">Yay - happy! I got sprite loading from file working now. If you want to see, here it is: 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void cSprite::copyFile(cGameWorld* gameworld_, const char* strname_, bool newsprite_) {
<br/>
   FILE* fp;
<br/>
   
<br/>
   //copy sprite data from file
<br/>
   char filename[32];
<br/>
   strcpy(filename, "/data/sprites/");
<br/>
   strcat(filename, strname_);
<br/>
   strcat(filename, ".raw");
<br/>
<br/>
   if ((fp = fopen(filename, "rb")) != NULL) {
<br/>
      fseek(fp, 0, SEEK_END);
<br/>
      u16 size = ftell(fp);
<br/>
      iprintf("Bytes: %i\n", size);
<br/>
      rewind(fp);
<br/>
      u8* buffer;
<br/>
         if ((buffer = (u8*)malloc(size)) != NULL) {
<br/>
         fread(buffer, 1, size/sizeof(u8), fp);
<br/>
         memcpy((void*)SPRITE_MEM(gfx), buffer, size/sizeof(u8));
<br/>
         //dmaCopy(buffer, (void*)SPRITE_MEM(gfx), size);
<br/>
         if (newsprite_)
<br/>
            gameworld_-&gt;sprite_control-&gt;next_gfx = gameworld_-&gt;sprite_control-&gt;next_gfx + size/32;
<br/>
         }
<br/>
      fclose(fp);
<br/>
      free(buffer);
<br/>
      }
<br/>
      else
<br/>
      iprintf("\nCannot open raw file.\n");
<br/>
<br/>
   //copy sprite palette from file
<br/>
   strcpy(filename, "/data/sprites/");
<br/>
   strcat(filename, strname_);
<br/>
   strcat(filename, ".pal");
<br/>
<br/>
   if ((fp = fopen(filename, "rb")) != NULL) {
<br/>
      fseek(fp, 0, SEEK_END);
<br/>
      u16 size = ftell(fp);
<br/>
      iprintf("Bytes: %i\n", size);
<br/>
      rewind(fp);
<br/>
      u8* buffer;
<br/>
         if ((buffer = (u8*)malloc(size)) != NULL) {
<br/>
         fread(buffer, 1, size/sizeof(u8), fp);
<br/>
         memcpy(SPRITE_PAL(pal), buffer, size/sizeof(u8));
<br/>
         //dmaCopy(buffer, SPRITE_PAL(pal), size);
<br/>
         }
<br/>
      fclose(fp);
<br/>
      free(buffer);
<br/>
      }
<br/>
      else
<br/>
      iprintf("\nCannot open pal file.\n");
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Sorry for posting all that. But perhaps someone can use it sometime. Could I have done it in a better way? An why is memcpy better than dmaCopy? They both work, but I did as you told me and used memcpy.
<br/>
<br/>
chism: I dont think anyone can learn from the embarrassing part of the last error - I called the file "text" but tried to open "test" :-)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104615 - HyperHacker - Sat Sep 30, 2006 9:58 pm</h4>
    <div class="postbody"><span class="postbody">You'd be surprised how common that mistake is. At least to me. &gt;_&gt;<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104652 - chishm - Sun Oct 01, 2006 6:01 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ChronoDK wrote:</b></span></td> </tr> <tr> <td class="quote">chism: I dont think anyone can learn from the embarrassing part of the last error - I called the file "text" but tried to open "test" :-)</td> </tr></table><span class="postbody">
<br/>
Don't worry, I've done that too. 
<br/>
<br/>
Also, memcpy is better than dmaCopy since dmaCopy can't access the DTCM region of the ARM9, which is where the stack is placed.
<br/>
<br/>
<span style="font-size: 7px; line-height: normal">EDIT: Spelling</span><br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104883 - josath - Tue Oct 03, 2006 8:43 pm</h4>
    <div class="postbody"><span class="postbody">Hello,
<br/>
<br/>
Since devkitpro r19b does not have directory listing support yet, the latest CVS of libfat will not compile under it. In order to get it to work, simply apply <a class="postlink" href="http://h.davr.org/nodir.patch" target="_blank">this patch</a>
<br/>
<br/>
This is just a stopgap, to let you use the latest libfat, without having to wait for a devkitpro update (basically it comments out all the directory related functions)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104927 - chishm - Wed Oct 04, 2006 10:36 am</h4>
    <div class="postbody"><span class="postbody">Alternatively, you could just ask for <a class="postlink" href="http://chishm.drunkencoders.com/libfat/20061004/libfat-nds-20061004.tar.bz2" target="_blank">the latest compiled version</a>. This is compiled without the patch, but due to the way the device table in DevkitPro works, the extra functions will simply be ignored.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#105025 - melw - Thu Oct 05, 2006 8:42 am</h4>
    <div class="postbody"><span class="postbody">Good news. Checked out the latest CVS version, and compared to the previously released pre-compiled package also all the SD adapters worked flawlessly.
<br/>
<br/>
A test batch with writing and reading succeeding on each adapter included:
<br/>
<br/>
- GBAMP CF (256Mb Kingston)
<br/>
- M3 CF (256Mb Kingston)
<br/>
- M3 SD (1Gb Kingston)
<br/>
- M3 Lite SD (512Mb Sandisk)
<br/>
<br/>
I can also check how the Chinese M3 Mini SD works in the near future.. Looking forward for the official beta release of libfat!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#105551 - El Hobito - Mon Oct 09, 2006 2:40 pm</h4>
    <div class="postbody"><span class="postbody">Keep up the good work chishm!  Can we expect the new dewvkitpro anytime soon or is it still some ways off yet?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#105557 - josath - Mon Oct 09, 2006 4:01 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>El Hobito wrote:</b></span></td> </tr> <tr> <td class="quote">Keep up the good work chishm!  Can we expect the new dewvkitpro anytime soon or is it still some ways off yet?</td> </tr></table><span class="postbody">
<br/>
devkitpro = wintermute, not chishm. donate at devkitpro.org to get it out sooner!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#105578 - El Hobito - Mon Oct 09, 2006 7:47 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>josath wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>El Hobito wrote:</b></span></td> </tr> <tr> <td class="quote">Keep up the good work chishm!  Can we expect the new dewvkitpro anytime soon or is it still some ways off yet?</td> </tr></table><span class="postbody">
<br/>
devkitpro = wintermute, not chishm. donate at devkitpro.org to get it out sooner!</span></td> </tr></table><span class="postbody">
<br/>
yeah i know that! that was just a generic cop compliment!
<br/>
<br/>
If anyones interested i have little tester program with a list for know working cards starting.  If anyone can run it and test it that would be great.
<br/>
<br/>
<a class="postlink" href="http://teamnnc.free.fr/phpBB2/viewtopic.php?p=10581#10581" target="_blank">http://teamnnc.free.fr/phpBB2/viewtopic.php?p=10581#10581</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106242 - Marcel24 - Tue Oct 17, 2006 3:52 am</h4>
    <div class="postbody"><span class="postbody">hi, the new fatlib is great :)
<br/>
<br/>
<br/>
now write / read works on my SC SD card .
<br/>
<br/>
but i have a small problem now .
<br/>
i must RENAME a file name , but it doesnt work :(
<br/>
<br/>
isnt it implemented until now ?
<br/>
<br/>
must i make a work around ?
<br/>
<br/>
<br/>
tnx .
<br/>
cya</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106260 - chishm - Tue Oct 17, 2006 10:28 am</h4>
    <div class="postbody"><span class="postbody">rename() won't appear until the rest of the directory level functions appear, with the next version of DevkitPro.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106659 - felix123 - Sun Oct 22, 2006 9:03 am</h4>
    <div class="postbody"><span class="postbody">Have you guys seen this? It is supposed to be the source code for accessing the SCCF, SCSD and SCSD mini. It also includes the rumble code.
<br/>
<br/>
<a href="http://scdev.org/forum/viewtopic.php?t=6896" target="_blank">http://scdev.org/forum/viewtopic.php?t=6896</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106694 - josath - Sun Oct 22, 2006 7:39 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>felix123 wrote:</b></span></td> </tr> <tr> <td class="quote">Have you guys seen this? It is supposed to be the source code for accessing the SCCF, SCSD and SCSD mini. It also includes the rumble code.
<br/>
<br/>
<a href="http://scdev.org/forum/viewtopic.php?t=6896" target="_blank">http://scdev.org/forum/viewtopic.php?t=6896</a></td> </tr></table><span class="postbody">
<br/>
<br/>
It seems to include code for writing to SC Rumble, but not any code for actually making it vibrate. (Though I may have missed it). Otherwise, it appears to be all ARM ASM, with most functions having comments describing what it does in C</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106705 - Lick - Sun Oct 22, 2006 9:09 pm</h4>
    <div class="postbody"><span class="postbody">Using the WIP-build of libfat, is it possible to check which device is inserted? Like Supercard, M3..<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106712 - josath - Sun Oct 22, 2006 9:24 pm</h4>
    <div class="postbody"><span class="postbody">it doesn't seem there is any easy way. I think you could do:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">// make sure the libfat source directory is searched for includes, 
<br/>
// but not for source
<br/>
#include "partition.h"
<br/>
<br/>
extern PARTITION *_partitions;
<br/>
<br/>
for(int i=0; i&lt;MAXIMUM_PARTITIONS; i++) {
<br/>
  if(_partitions[i] != NULL) {
<br/>
     iprintf("Partition %d type = %X\n", i, _partitions[i].disc-&gt;ioType);
<br/>
  }
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
Then you can compare the 'partition type' with the magic numbers in the various io_*.h files in the disc_io dir:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">io_efa2.h:#define DEVICE_TYPE_EFA2 0x32414645
<br/>
io_fcsr.h:#define DEVICE_TYPE_FCSR 0x52534346
<br/>
io_m3cf.h:#define DEVICE_TYPE_M3CF 0x4643334D
<br/>
io_m3sd.h:#define DEVICE_TYPE_M3SD 0x4453334D
<br/>
io_mmcf.h:#define DEVICE_TYPE_MMCF 0x46434D4D
<br/>
io_mpcf.h:#define DEVICE_TYPE_MPCF 0x4643504D
<br/>
io_njsd.h:#define DEVICE_TYPE_NJSD 0x44534A4E
<br/>
io_nmmc.h:#define DEVICE_TYPE_NMMC 0x434D4D4E
<br/>
io_sccf.h:#define DEVICE_TYPE_SCCF 0x46434353
<br/>
io_scsd.h:#define DEVICE_TYPE_SCSD 0x44534353</td> </tr></table><span class="postbody">
<br/>
<br/>
I think they actually are 4 character strungs (not \0 terminated), so you could print them out as well.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106715 - Lick - Sun Oct 22, 2006 10:12 pm</h4>
    <div class="postbody"><span class="postbody">I tried it, but I couldn't get it to compile. Guess I'm releasing two binaries. =/<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106716 - josath - Sun Oct 22, 2006 10:37 pm</h4>
    <div class="postbody"><span class="postbody">Well, my code wasn't right, it wasn't tested like I said. They were just simple problems though (like a missing [], using a . instead of a -&gt;, etc)
<br/>
<br/>
source + compiled .nds --&gt; <a href="http://davr.org/ds2/fattest.tgz" target="_blank">http://davr.org/ds2/fattest.tgz</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106717 - Lick - Sun Oct 22, 2006 11:11 pm</h4>
    <div class="postbody"><span class="postbody">Would have been nice, but I already released LoveLite, without SC-detection. Thanks for your effort though, josath! Love you!
<br/>
<br/>
- Lick<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106755 - chishm - Mon Oct 23, 2006 5:47 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>josath wrote:</b></span></td> </tr> <tr> <td class="quote">I think they actually are 4 character strungs (not \0 terminated), so you could print them out as well.</td> </tr></table><span class="postbody">
<br/>
Yes, they are the 4 characters of the name of the device. For instance, the supercard SD will be SCSD. The characters are ASCII encoded and the highest byte corresponds to the last letter in the name (little-endian architecture).<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#107131 - Lick - Thu Oct 26, 2006 11:57 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>josath wrote:</b></span></td> </tr> <tr> <td class="quote">Well, my code wasn't right, it wasn't tested like I said. They were just simple problems though (like a missing [], using a . instead of a -&gt;, etc)
<br/>
<br/>
source + compiled .nds --&gt; <a href="http://davr.org/ds2/fattest.tgz" target="_blank">http://davr.org/ds2/fattest.tgz</a></td> </tr></table><span class="postbody">
<br/>
<br/>
<span style="font-size: 18px; line-height: normal">Thanks!</span> I'm using this and it's workig like a charm! ;)<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#107249 - Lick - Sat Oct 28, 2006 12:18 am</h4>
    <div class="postbody"><span class="postbody">I'm trying to do a "FAT_GetFileCluster()" in the DevKitPro libfat. I copied the necessary structs from the libfat source and then access access the FILE* I get from fopen() like this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">typedef struct {
<br/>
   u32 cluster;
<br/>
   u32 sector;
<br/>
   s32 byte;
<br/>
} FILE_POSITION;
<br/>
typedef struct {
<br/>
   u32 cluster;
<br/>
   u32 sector;
<br/>
   s32 offset;
<br/>
} DIR_ENTRY_POSITION;
<br/>
typedef struct {
<br/>
   u32 filesize;
<br/>
   u32 startCluster;
<br/>
   u32 currentPosition;
<br/>
   FILE_POSITION rwPosition;
<br/>
   FILE_POSITION appendPosition;
<br/>
   bool read;
<br/>
   bool write;
<br/>
   bool append;
<br/>
   bool inUse;
<br/>
   PARTITION* partition;
<br/>
   DIR_ENTRY_POSITION dirEntryStart;      // Points to the start of the LFN entries of a file, or the alias for no LFN
<br/>
   DIR_ENTRY_POSITION dirEntryEnd;         // Always points to the file's alias entry
<br/>
} FILE_STRUCT;
<br/>
<br/>
<br/>
..
<br/>
        FILE *_boot_mp = fopen("_BOOT_MP.NDS", "r");
<br/>
        u32 cluster = *((FILE_STRUCT*)(_boot_mp-&gt;_file)).startCluster;
<br/>
        fclose(_boot_mp);
<br/>
        return cluster;
<br/>
..
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Will this work?
<br/>
<br/>
- Lick<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#107293 - chishm - Sat Oct 28, 2006 8:52 am</h4>
    <div class="postbody"><span class="postbody">Use fstat. It will return a struct describing the file. The inode number (st_ino) is the file's start cluster. Also, don't use any variables or functions starting with an underscore (eg _partitions). They are meant to be hidden from the host application and may change between versions. 
<br/>
<br/>
The latest CVS version of libfat will return the hostType (ioType) in the device field of the stat struct (st_dev). So to get the type of disc inserted, try this (untested, should work):
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include &lt;sys/stat.h&gt;
<br/>
<br/>
/* To get the inserted device type */
<br/>
struct stat st;
<br/>
stat ("/.", &amp;st);       /* Get the file stat for the root directory */
<br/>
u32 partitionType = st.st_dev;     /* Get the disc that the root directory is on */
<br/>
<br/>
/* To get the start cluster of a file */
<br/>
int _boot_mp = open("_BOOT_MP.NDS", "r");
<br/>
fstat (_boot_mp, st);
<br/>
close(_boot_mp);
<br/>
u32 cluster = st.st_ino;
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#107297 - Lick - Sat Oct 28, 2006 9:48 am</h4>
    <div class="postbody"><span class="postbody">Thanks for clearing it up! Perhaps a list of implemented standard functions should be put up, as it's hard to track what is implemented and what not. (Don't know what libnds' coding standards are, but I dislike the idea in general to use standard functions, unless you implement them ALL.)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote">The latest CVS version of libfat will return the hostType (ioType) in the device field of the stat struct (st_dev). So to get the type of disc inserted, try this (untested, should work) ..</td> </tr></table><span class="postbody">
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote">Alternatively, you could just ask for <a class="postlink" href="http://chishm.drunkencoders.com/libfat/20061004/libfat-nds-20061004.tar.bz2" target="_blank">the latest compiled version</a>. This is compiled without the patch, but due to the way the device table in DevkitPro works, the extra functions will simply be ignored.</td> </tr></table><span class="postbody">
<br/>
<br/>
I will try that code, but it works with the quoted libfat version right?
<br/>
You're the man!
<br/>
<br/>
- Lick<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#107300 - chishm - Sat Oct 28, 2006 10:07 am</h4>
    <div class="postbody"><span class="postbody">No, I only added the code to CVS 5 minutes before making that last post.
<br/>
<br/>
EDIT: I did, however, compile the <a class="postlink" href="http://chishm.drunkencoders.com/libfat/20061028/libfat-nds-20061028.tar.bz2" target="_blank">the latest version</a> for you<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#107338 - Lick - Sat Oct 28, 2006 6:41 pm</h4>
    <div class="postbody"><span class="postbody">Yay! .. .. Yay! Yay!
<br/>
<br/>
Edit: I tested the paritionType detection and.. Sigh.. It works! ;D
<br/>
<br/>
Will there be ezsd support? AFAIK, that code is already released, or at least known.<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#107351 - Lick - Sat Oct 28, 2006 10:29 pm</h4>
    <div class="postbody"><span class="postbody">It doesn't work. I only get 0x4353 ("SC"), a 16-bit value. How do I get the whole 32-bit value? ("SCSD")
<br/>
<br/>
<span style="font-weight: bold">Edit: </span>Upon investigation I found that this define causes the compiler to make dev_t a short value.
<br/>
<span style="font-style: italic">/DevKitARM/arm-eabi/include/sys/types.h</span>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#if defined(__rtems__)
<br/>
/* device numbers are 32-bit major and and 32-bit minor */
<br/>
typedef unsigned long long dev_t;     // This is skipped
<br/>
#else
<br/>
#ifndef __CYGWIN__
<br/>
typedef   short   dev_t;         // This is parsed
<br/>
#endif
<br/>
#endif
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I simply brutely modified sys/types.h, but it still doesn't work. I think it's still 16-bit in libfat.a (or in my devkitpro version).
<br/>
<br/>
- Lick<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#107382 - chishm - Sun Oct 29, 2006 6:19 am</h4>
    <div class="postbody"><span class="postbody">Getting the partition type and boot file cluster can be greatly simplified from the above example:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include &lt;sys/stat.h&gt;
<br/>
<br/>
struct stat st;
<br/>
stat ("_BOOT_MP.NDS", &amp;st);       /* Get the file stat for the root directory */
<br/>
u32 partitionType = st.st_dev;     /* Get the disc that the root directory is on u32 cluster = st.st_ino; </td> </tr></table><span class="postbody">
<br/>
<br/>
It's rather unfortunate about the st_dev type being 16 bit. I can't do much about that without modifying the DevkitPro installation. Maybe WinterMute won't mind, but if he does, I'll need to find another (standardised) way.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#107385 - josath - Sun Oct 29, 2006 6:35 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
It's rather unfortunate about the st_dev type being 16 bit. I can't do much about that without modifying the DevkitPro installation. Maybe WinterMute won't mind, but if he does, I'll need to find another (standardised) way.</td> </tr></table><span class="postbody">
<br/>
<br/>
Another option is to use non-ascii representations of device types. like SCSD = 100, SCCF = 101, SCLite = 102, M3CF = 200, M3SD=201, gbamp=50, and so on. It's not like we will ever have more than 2^16 device types. You can then just provide an id-&gt;string lookup table in the fat.h headers for example.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#107393 - Lick - Sun Oct 29, 2006 10:11 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote">Maybe WinterMute won't mind, but if he does, ..</td> </tr></table><span class="postbody">
<br/>
Why would he mind? It's actually a FIX rather than a plain modification. ARM is 32-bit, y'know.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote">..but if he does, I'll need to find another (standardised) way.</td> </tr></table><span class="postbody">
<br/>
What about using the first 8bit for brand identification, and the second 8bit for the type identification? Josath is completely right that a 16-bit value is more than enough. (Oh, and 32-bit is actually waaaay too much. Although you can use it as a non-zeroed string..)
<br/>
<br/>
<br/>
I still think a simple fix in stat.h will do and should be allowed. (Chishm, could you be kind, for the millionth time, and build a version with a 32-bit st_dev? I really appreciate the immediate help you've given!)
<br/>
<br/>
- Lick<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#107403 - masscat - Sun Oct 29, 2006 11:26 am</h4>
    <div class="postbody"><span class="postbody">I would go with a change along the lines described by josath. Although the change of dev_t to a 32bit value is simple it is a change to the base source of newlib - maintenance hassle for the devkitARM team when/if a new version of newlib is used.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#107426 - diggla - Sun Oct 29, 2006 4:33 pm</h4>
    <div class="postbody"><span class="postbody">&lt; continued from <a href="http://forum.gbadev.org/viewtopic.php?t=7195&amp;start=155" target="_blank">http://forum.gbadev.org/viewtopic.php?t=7195&amp;start=155</a> &gt;
<br/>
<br/>
When using fread '\n' is also interpreted as the end of a string and libfat stops reading. 
<br/>
<br/>
So what i have to do as a workaround is to read my data char after char and stop reading when it finds '\n'. Then the program must fseek to the next position after the '\n' and continue reading. This is the only way to avoid garbage in memory when reading binary files. This does not happen when i use gcc for win32. binary data is read without any problems using fget or fread. 
<br/>
<br/>
code snippet for non working read method.  This will stop reading after '\n':
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">     fread(book_buffer, 20, cluster, book_file);</td> </tr></table><span class="postbody">
<br/>
<br/>
here is my example code for the workaround:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
      char tmp[20];
<br/>
<br/>
     // Binary Read Hack for NDS, 0x0a=\n causes corrupt reads
<br/>
     
<br/>
    for (j = 0; j &lt; cluster; j++) {
<br/>
<br/>
      for (i = 0; i &lt; 20; i++) {
<br/>
         tmp[i] = fgetc(book_file);
<br/>
         key++;
<br/>
         if (tmp[i] == 0x0a) {
<br/>
            myprintf("Found 0x0a at pos %d\n",key); 
<br/>
//             use seek to read correct bytes after \n
<br/>
            fseek(book_file, key, SEEK_SET);
<br/>
         }
<br/>
      }
<br/>
<br/>
      for (i = 0; i &lt; 20; i++) {
<br/>
            myprintf("%02X",(unsigned char) tmp[i]);
<br/>
      }
<br/>
<br/>
      memcpy(&amp;book_buffer[j],tmp,20);
<br/>
   }
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"><br/><br/>Last edited by diggla on Sun Oct 29, 2006 5:57 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#107434 - josath - Sun Oct 29, 2006 5:37 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>diggla wrote:</b></span></td> </tr> <tr> <td class="quote">&lt; continued from <a href="http://forum.gbadev.org/viewtopic.php?t=7195&amp;start=155" target="_blank">http://forum.gbadev.org/viewtopic.php?t=7195&amp;start=155</a> &gt;
<br/>
<br/>
When using fread '\n' is also interpreted as the end of a string and libfat stops reading. </td> </tr></table><span class="postbody">
<br/>
<br/>
You must be doing something else wrong, I've used fread and never needed to use fseek to skip \n, even when reading in a text file with many \n's in it</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#107464 - diggla - Sun Oct 29, 2006 10:23 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>josath wrote:</b></span></td> </tr> <tr> <td class="quote">You must be doing something else wrong, I've used fread and never needed to use fseek to skip \n, even when reading in a text file with many \n's in it</td> </tr></table><span class="postbody">
<br/>
<br/>
ok i found the flaw. i must stuff the disk data to a temp buffer first and then memcopy the data to my custom structures. loading directly to my structures didnt work.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#107471 - Lick - Sun Oct 29, 2006 10:51 pm</h4>
    <div class="postbody"><span class="postbody">chishm: does _BOOT_MP.NDS' startCluster always equal 0?
<br/>
<br/>
Also, besides st_dev there is another 16-bit variable that should be 32-bit: st_ino. =/<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#107480 - chishm - Mon Oct 30, 2006 12:34 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lick wrote:</b></span></td> </tr> <tr> <td class="quote">chishm: does _BOOT_MP.NDS' startCluster always equal 0?
<br/>
<br/>
Also, besides st_dev there is another 16-bit variable that should be 32-bit: st_ino. =/</td> </tr></table><span class="postbody">
<br/>
The start cluster should never be 0, unless it <span style="font-weight: bold">is the</span> root directory. I can work around the 16 bit st_dev field, but inodes really should be at least 32 bit. Imagine a modern operating system only being able to store a maximum of 65536 files.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#107482 - Lick - Mon Oct 30, 2006 12:39 am</h4>
    <div class="postbody"><span class="postbody">But if I simply enter 0 (for *(vu16*)0x027FFFFC, that is), will GBAMP's hacked firmware do the job of locating _BOOT_MP.NDS for me?
<br/>
<br/>
<span style="font-weight: bold">Edit:  yes.</span><br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#108664 - Mota - Sat Nov 11, 2006 2:48 am</h4>
    <div class="postbody"><span class="postbody">Apologies for the noob question, can libfat write to DS-Link? It's a slot-1 device. I didn't see the name mentioned in the thread but I may have missed it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#108777 - tepples - Sun Nov 12, 2006 12:52 am</h4>
    <div class="postbody"><span class="postbody">It's time for me to stop complaining and start contributing. If I wanted to download a suitable version of libfat source code and customize it by making, say, fopen("/", "r") return a newline-delimited list of files within the root directory, how would I go about this?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#108783 - Lick - Sun Nov 12, 2006 1:23 am</h4>
    <div class="postbody"><span class="postbody">Purrrhaps you shouuuld look at the other fatlibs that DO have directory functions and see what they do? Afterwards, just find a way to implement it into the standard C functions (but I think standard C doesn't include directory functions, so you should check out the Posix functions.)<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#108798 - felix123 - Sun Nov 12, 2006 3:38 am</h4>
    <div class="postbody"><span class="postbody">DS-link doesn't work yet. The company claims it will in the future.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#108829 - chishm - Sun Nov 12, 2006 6:50 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">It's time for me to stop complaining and start contributing. If I wanted to download a suitable version of libfat source code and customize it by making, say, fopen("/", "r") return a newline-delimited list of files within the root directory, how would I go about this?</td> </tr></table><span class="postbody">
<br/>
You can checkout the code from <a class="postlink" href="http://sourceforge.net/cvs/?group_id=114505" target="_blank">DevkitPro CVS</a>. If you just want to look at a couple of files, you can <a class="postlink" href="http://devkitpro.cvs.sourceforge.net/devkitpro/libfat/" target="_blank">browse the repository</a>.
<br/>
<br/>
To commit back to the source tree you'll need to get access rights from Wintermute, the project administrator. If you are going to make such a major change as this, it is best to discuss it with me or Wintermute before commiting. 
<br/>
<br/>
For your example, I'd suggest creating a fork instead of adding this to the main code base. This is because the proposed changes will be extraneous when DevkitPro r20 is finally released.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109280 - Jospfh - Thu Nov 16, 2006 8:36 pm</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
I made a simple piece of code to test libfat on my Supercard. I found out that the code did not work (fatInit() failed) on my 512 MB DaneElec SD card.
<br/>
Then I tried a 16MB SD card (SDC-16M Canon) and the code worked like a charm!
<br/>
<br/>
I have no problem running Beup and DSlinux which both do not use libfat. 
<br/>
<br/>
Anyway, if there is an update I would be happy to test it!
<br/>
<br/>
I'm about to buy a 2 GB SD card. Can anyone let me know which brand and type SD works with libfat &amp; supercard?
<br/>
<span style="font-weight: bold">
<br/>
Here is some info:</span>
<br/>
NDS lite
<br/>
SuperKey
<br/>
Supercard (firmware 1.7, also tried firmware 1.63)
<br/>
libfat-nds-20061028.tar.bz2
<br/>
devkitpro 19b
<br/>
<br/>
The code:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   iprintf("fatInit()..");
<br/>
   if (fatInit(4, true)) {
<br/>
    iprintf("\tSuccess\n");
<br/>
   } else {
<br/>
    iprintf("\tFailure\n");
<br/>
   } 
<br/>
<br/>
   // Write to a file
<br/>
   FILE *ostream, *fopen();
<br/>
   if ((ostream = fopen("/test.txt", "w")) == NULL) {
<br/>
    iprintf("Cannot open file\n");
<br/>
   }else{
<br/>
     iprintf("File opened.\n");
<br/>
     char x[10] = "0123456789";
<br/>
     fwrite(x, sizeof(x[0]), sizeof(x)/sizeof(x[0]), ostream);
<br/>
     fclose(ostream); // close file
<br/>
     iprintf("Wrote to file\n");
<br/>
   }
<br/>
<br/>
   // Read the same file
<br/>
   FILE *handle;
<br/>
   if ((handle = fopen("/test.txt", "r")) == NULL) {
<br/>
    iprintf("Cannot open file\n");
<br/>
   }else{
<br/>
     iprintf("File opened\n");
<br/>
    fseek(handle, 0, SEEK_END);  // Go to end of file
<br/>
    u32 size = ftell(handle);  // Get current position in file, because it is the end it will be the size
<br/>
    char* text = (char*) malloc (size);  // Allocate memory for file
<br/>
    fseek(handle, 0, SEEK_SET);  // Go to begining of file
<br/>
    fread((void*)text, size, 1, handle); // Read all of file into memory
<br/>
    fclose(handle); // Close file
<br/>
  }
<br/>
<br/>
   while(1) {
<br/>
<br/>
      touchXY=touchReadXY();
<br/>
      iprintf("\x1b[10;0HTouch x = %04X, %04X\n", touchXY.x, touchXY.px);
<br/>
      iprintf("Touch y = %04X, %04X\n", touchXY.y, touchXY.py);
<br/>
<br/>
   }</td> </tr></table><span class="postbody">
<br/>
<br/>
<a class="postlink" href="http://www.circuitdb.com/fattest.zip" target="_blank">fattest.zip</a><br/>_________________<br/><a class="postlink" href="http://www.circuitdb.com" target="_blank">CircuitDB - Free electronics circuits &amp; schematics!</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109418 - gimblefoot - Sat Nov 18, 2006 4:17 am</h4>
    <div class="postbody"><span class="postbody">I read through this topic in its entirety and figured I'd try using libfat in a NDS app I've written to allow me to remotely control XBMC using the NDS (e.g. edit/create play list, see album art, switch songs, ff/rw, etc).  The app works great except that it currently uses the GBA SRAM to save its settings (i.e. wifi settings, XBOX hostname/ip addresses, etc).  This is annoying with flash carts because saving is a two step process:
<br/>
<br/>
1. Save in app/game.
<br/>
2. Restart NDS and save SRAM to flash cart.
<br/>
<br/>
I figured using libfat in the app would be nice because then the app can just write its settings directly.  Also, I'm currently using gbfs for some data files used by the app.  This works fine with the SuperCard Lite but doesn't seem to work with the SuperCard Lite Rumble (probably because it doesn't support GBA).  I figured libfat should be able to help with this as well.
<br/>
<br/>
I decided to test out if libfat works in my app... so I wrote some code just to stat some files on the flash cart.  I started out by using fatInitDefault() and it seemed to be successful.  However, as soon as stat() was called, the program appeared to hang.  I tried using open() to read a file and to write a file but same problem.  So then based on the posts in this topic, I figured maybe my flash carts aren't supported properly or maybe I need to wait for a newer version of DevKitPro.
<br/>
<br/>
Instead of giving up, I decided to grab fattest source/binary linked on this topic to see if it would work.  The binary seemed to work fine printing out mounted partitions but I wasn't sure if stat or open would work since fattest didn't do any of these operations.  I managed to get the code to compile (after fiddling with the source a little) and I added in stat, open, read, write calls.  Everything worked fine.
<br/>
<br/>
Hmm... I checked my build env to make sure I'm using same options in Makefile, including same header files, linking to same library, etc.  Everything seemed to check out. While I was checking this stuff out, I left the NDS running after it froze on a stat() call.  I noticed that the call eventually returned with an error.  I assume the call eventually timed out but failed... I moved my libfat test code around and tried commenting some code out to see if it would have any effect.  It turns out that my config loading code that accesses SRAM was causing problems for libfat.  I'm guessing the reason was that after loading config details, I was doing a WAIT_CR that gave ownership of the cart/rom back to the ARM7 CPU.  After fixing this, libfat worked fine...
<br/>
<br/>
Anyway, I just thought I'd share this with the forum in case someone else hits this problem and doesn't feel like banging their head against a wall.
<br/>
<br/>
devkitPro 19b
<br/>
libfat-nds-20061116 (with directory functions commented out)
<br/>
NDS lite (flashmev7lite)
<br/>
SuperCard SD (firmware 1.63)
<br/>
SuperCard Lite (firmware 1.7)
<br/>
SuperCard Lite Rumble (firmware 1.7)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109895 - Drifter - Wed Nov 22, 2006 11:35 am</h4>
    <div class="postbody"><span class="postbody">I've just tried libfat with dualis and it doesn't appear to work (it actually crashes dualis).
<br/>
<br/>
Maybe I'm doing something wrong. gba_nds_fat worked.
<br/>
<br/>
Any ideas?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110213 - simonjhall - Sun Nov 26, 2006 10:00 pm</h4>
    <div class="postbody"><span class="postbody">I'm having trouble seeking then reading data from within a big file. I'm 99% sure that the file on the PC is the same as the file being used by the DS, but when I read data I don't get the same results. The data that gets read is from several hundred bytes later on in the file.
<br/>
<br/>
Here's a quick snippet of code which I can put near the beginning of my program which will replicate the problem. I call fatInitialise(4, true) before this.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">char buf[9];
<br/>
<br/>
FILE *fp = fopen("fat0:/baseq2/pak0.pak", "rb");
<br/>
<br/>
fseek(fp, 183786082, SEEK_SET);
<br/>
fread(&amp;buf, 1, 9, fp);
<br/>
<br/>
fclose(fp);
<br/>
<br/>
printf("buf is %s\n", buf);</td> </tr></table><span class="postbody">
<br/>
<br/>
The DS returns data from slightly further into the file and I get the string "textures/". The PC (under Linux) gives "env/unit".
<br/>
<br/>
I'd like to check which version is correct with a hex editor or something - could anyone suggest anything easy to use? Although as the PC runs fine and the DS gives whack results I'd like to think the PC's doing it right!
<br/>
<br/>
And does anyone have any suggestions as to what the problem could be? I'm using a gbamp with a 512 meg CF card.
<br/>
<br/>
Ta guys.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110219 - tepples - Sun Nov 26, 2006 11:03 pm</h4>
    <div class="postbody"><span class="postbody">At what offset do you see env/unit when reading the file on a PC?
<br/>
<br/>
You could find a hex editor (on Windows, I use Notepad++). Scroll to offset 0AF45A60, which corresponds to decimal 183786080.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110226 - simonjhall - Sun Nov 26, 2006 11:34 pm</h4>
    <div class="postbody"><span class="postbody">On the PC reading 183786082 gives env/unit&lt;and the rest of the filename&gt;
<br/>
On the DS reading 183786082 gives textures/e1u1/hint.wal
<br/>
<br/>
If I examine the pak file (on the CF card) myself with a hex editor the textures string actually lives at 183794274. So the DS is really reading 8192 bytes further into the file than where it really should do...
<br/>
<br/>
I would try the old fat driver just to see what's going on, but I really don't want to replace all the FILE * pointers in Q2 with plain integers...
<br/>
<br/>
EDIT: I just formatted the CF card and copied back on just the files I needed (as that pak file was fragmented), so now there are no fragmented files. I'm still getting the same problem though :-(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110233 - chishm - Mon Nov 27, 2006 3:35 am</h4>
    <div class="postbody"><span class="postbody">I'm going to guess that the cluster size of that disc is 8192 bytes. It's probably a seek() bug. If you can tell me the true cluster size, as well as try this test only 8200 bytes into the file, that'd be helpful for tracking it down.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110317 - simonjhall - Mon Nov 27, 2006 9:15 pm</h4>
    <div class="postbody"><span class="postbody">I was gonna try that this evening but I left my card reader on my desk at work!
<br/>
Is it likely that the error will be shown at 8200 bytes in? I could just imagine myself searching through a 175 meg file, 8k at a time (by hand) until I detect a difference...
<br/>
I'll do it tomorrow night :-p</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110339 - chishm - Mon Nov 27, 2006 11:16 pm</h4>
    <div class="postbody"><span class="postbody">It might be an off-by-one error in the cluster determination formula, in which case it should show up 8200 bytes into the file.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110519 - simonjhall - Wed Nov 29, 2006 12:34 am</h4>
    <div class="postbody"><span class="postbody">Right, I've just spent a while checking what's going on and no, I don't get an error at 8192 or 8200 bytes in. I've only managed to get an error at the address that I gave (175.271k in). I don't get an error at 175k and I don't get an error at 176k, only at that specific address. I could keep homing in until I figure out the exact address it fails on if you like. What would you like me to do?
<br/>
<br/>
If you've got pak0.pak from Quake 2 and a gbamp you could always test this yourself...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110542 - chishm - Wed Nov 29, 2006 2:47 am</h4>
    <div class="postbody"><span class="postbody">Can you tell me what the cluster size of the disc is. Also, make sure that there really is no error at 175k or 176k by checking to see you aren't simply seeing data that really is 8192 bytes ahead but is the exact same as you were expecting. What is the size of the file (in bytes)? Unfortunately I don't have Q2 to try this on. Perhaps try reading from 183777890 and see if you get the data you expected at 183786082.
<br/>
<br/>
Just to get the simple stuff out of the way, you are opening the file in "rb" mode on both the PC and DS right?
<br/>
<br/>
You can also cast the FILE* handle to a FILE_STRUCT* (see <a class="postlink" href="http://devkitpro.cvs.sourceforge.net/devkitpro/libfat/source/fatfile.h?revision=1.4&amp;view=markup" target="_blank">fatfile.h</a>) then extract the position information directly. This way you can tell what cluster, sector and byte it thinks it the data is at (after seeking) and compare it to the actual data position. It helps if the file is not fragmented when doing this. 
<br/>
<br/>
Finally, try opening the file using </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int fp = open (file_name, O_RDONLY);</td> </tr></table><span class="postbody"> to bypass newlib, then use seek and read instead of fseek and fread. This is only a test and I don't expect it to be a permanent solution.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110609 - simonjhall - Wed Nov 29, 2006 10:11 pm</h4>
    <div class="postbody"><span class="postbody">Ok, I've been testing more...
<br/>
The file size is 183,997,730 bytes. Diskeeper tells me that the file is not fragmented.
<br/>
<br/>
This broken region seems to start somewhere between 0xaf44f46 and 0xaf450c2 and seems to finish at 0xaf46022 to 0xaf45fe6 ish. So it's about 4000 bytes in size... Reads in this area appear to take data from 8k further into the file.
<br/>
Sorry I can't be more specific, but there's a lot of empty and repeated data.
<br/>
<br/>
This is what *fp is just after opening:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">(gdb) print *fp
<br/>
$9 = {_p = 0x0, _r = 0, _w = 0, _flags = 4, _file = 36930704, _bf = {_base = 0x0, _size = 0}, _lbfsize = 0, _cookie = 0x233830c,
<br/>
  _read = 0x20a8018 &lt;__sread&gt;, _write = 0x20a7fac &lt;__swrite&gt;, _seek = 0x20a7f60 &lt;__sseek&gt;, _close = 0x20a7f38 &lt;__sclose&gt;, _ub = {_base = 0x0,
<br/>
    _size = 0}, _up = 0x0, _ur = 0, _ubuf = "\000\000", _nbuf = "", _lb = {_base = 0x0, _size = 0}, _blksize = 0, _offset = 0, _data = 0x0,
<br/>
  _lock = 0}</td> </tr></table><span class="postbody">
<br/>
<br/>
after the a seek (to an address which I know works fine, 0xaf44f6c)
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">$11 = {_p = 0x2338854 ']' &lt;repeats 32 times&gt;, '\177' &lt;repeats 86 times&gt;, "\215\215\215\215\215UUUU\177\177\177\177PP\\\\\\]]]]]][[[[[[", _r = 148,
<br/>
  _w = 0, _flags = 5252, _file = 36930704, _bf = {
<br/>
    _base = 0x23384e8 ']' &lt;repeats 20 times&gt;, '\177' &lt;repeats 82 times&gt;, "Y\216\215\215\215\215\215YYUUUUU]]]]\\\\]]]]]]]]", '[' &lt;repeats 35 times&gt;, "
<br/>
U", '\177' &lt;repeats 34 times&gt;..., _size = 1024}, _lbfsize = 0, _cookie = 0x233830c, _read = 0x20a8018 &lt;__sread&gt;, _write = 0x20a7fac &lt;__swrite&gt;,
<br/>
  _seek = 0x20a7f60 &lt;__sseek&gt;, _close = 0x20a7f38 &lt;__sclose&gt;, _ub = {_base = 0x0, _size = 0}, _up = 0x0, _ur = 0, _ubuf = "\000\000", _nbuf = "",
<br/>
  _lb = {_base = 0x0, _size = 0}, _blksize = 1024, _offset = 183783424, _data = 0x0, _lock = 0}</td> </tr></table><span class="postbody">
<br/>
<br/>
after the read:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">(gdb) print *fp
<br/>
$13 = {_p = 0x2338868 ']' &lt;repeats 12 times&gt;, '\177' &lt;repeats 86 times&gt;, "\215\215\215\215\215UUUU\177\177\177\177PP\\\\\\]]]]]][[[[[[", _r = 128,
<br/>
  _w = 0, _flags = 5252, _file = 36930704, _bf = {
<br/>
    _base = 0x23384e8 ']' &lt;repeats 20 times&gt;, '\177' &lt;repeats 82 times&gt;, "Y\216\215\215\215\215\215YYUUUUU]]]]\\\\]]]]]]]]", '[' &lt;repeats 35 times&gt;, "
<br/>
U", '\177' &lt;repeats 34 times&gt;..., _size = 1024}, _lbfsize = 0, _cookie = 0x233830c, _read = 0x20a8018 &lt;__sread&gt;, _write = 0x20a7fac &lt;__swrite&gt;,
<br/>
  _seek = 0x20a7f60 &lt;__sseek&gt;, _close = 0x20a7f38 &lt;__sclose&gt;, _ub = {_base = 0x0, _size = 0}, _up = 0x0, _ur = 0, _ubuf = "\000\000", _nbuf = "",
<br/>
  _lb = {_base = 0x0, _size = 0}, _blksize = 1024, _offset = 183783424, _data = 0x0, _lock = 0}</td> </tr></table><span class="postbody">
<br/>
<br/>
Dunno if that's any use!
<br/>
<br/>
I don't know what the cluster size of the disk is - I just chose default. Is there an easy way of finding out?
<br/>
<br/>
Thanks for the help btw :-)
<br/>
<br/>
EDIT: I forgot to say, yes I'm using 'rb' and I tried to use open/seek/read, but I didn't know what the prototypes were. I'll try your other fat driver later to see if I get the same read problems.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110710 - simonjhall - Thu Nov 30, 2006 10:05 pm</h4>
    <div class="postbody"><span class="postbody">Yo, I just tested this with your gba_nds_fat library and it reads the data just as it should... Looks like I'm just gonna have to use that then instead!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110774 - chishm - Fri Dec 01, 2006 1:33 pm</h4>
    <div class="postbody"><span class="postbody">Unfortunately those structs aren't any help. I really needed the data pointed to by _file within that struct, but I suppose it isn't too important. I mistakenly asked for the wrong data. That doesn't really matter now, if you don't want to spend any more time debugging it. 
<br/>
<br/>
However, if you do want to debug further, the prototypes are in &lt;sys/unistd.h&gt;. It would also really help if you could find out the cluster size.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110812 - simonjhall - Fri Dec 01, 2006 9:13 pm</h4>
    <div class="postbody"><span class="postbody">Right! This is with libfat again. I've got 8192-byte clusters.
<br/>
<br/>
Here's me opening, seeking and reading from that funny bit of disk. I've basically printed *(FAT_FILE *)fp-&gt;_file here. Is that right? Sorry for the whack characters...
<br/>
after opening:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">$15 = {firstCluster = 3, length = 36953500, curPos = 183997730, curClus = 54, curSect = 0, curByte = 54,
<br/>
  readBuffer = "\000\000\000\000\000\000\000\000‗W\000\000\n\000\000\000\"\001\000\000\001\000\000\001h?3\002\002\000\000\000\001\000\000\000\b\000\00
<br/>
0\000\002\000\000\000\001\000\000\000\b", '\0' &lt;repeats 11 times&gt;, "▒\000\000\000\003\000\000\000\234?3\002\"\225?\n6\000\000\000\000\000\000\0006", '
<br/>
\0' &lt;repeats 11 times&gt;, "‗W\000\000\n\000\000\000\"\001\000\000\001\000\000\001h?3\002\002\000\000\000\001\000\000\000\b\000\000\000\002\000\000\000\0
<br/>
01\000\000\000\b\000\000\000\000\000\000\000\034\000\000\000\001\000\000\000@?3\002?", '\0' &lt;repeats 79 times&gt;, "i!", '\0' &lt;repeats 190 times&gt;, "█\000
<br/>
\000\000&amp;YA1? ", '\0' &lt;repeats 14 times&gt;, "z▀3"..., appClus = 1, appSect = 8273, appByte = 2, read = true, write = false, append = false,
<br/>
  inUse = false, dirEntSector = 8, dirEntOffset = 0}</td> </tr></table><span class="postbody">
<br/>
<br/>
after seeking:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">$19 = {firstCluster = 3, length = 36953500, curPos = 183997730, curClus = 54, curSect = 183786496, curByte = 22489,
<br/>
  readBuffer = "\016\000\000\000\000\000\000\000‗W\000\000\n\000\000\000\"\001\000\000\001\000\000\001h?3\002\002\000\000\000\001\000\000\000\b\000\00
<br/>
0\000\002\000\000\000\001\000\000\000\b", '\0' &lt;repeats 11 times&gt;, "\t\004", '\0' &lt;repeats 28 times&gt;, "\n?┬\000\212\003\001\000env/space1dn.tga", '\0'
<br/>
 &lt;repeats 40 times&gt;, "\224?├\000\022\000\003\000maps/base1.bsp", '\0' &lt;repeats 42 times&gt;, "???\000pc\036\000textures/e1u1/metal2_1.wal", '\0' &lt;repeats
<br/>
 30 times&gt;, "\026K?\000?*\000\000textures/e1"..., appClus = 0, appSect = 0, appByte = 0, read = false, write = false, append = false,
<br/>
  inUse = false, dirEntSector = 0, dirEntOffset = 0}</td> </tr></table><span class="postbody">
<br/>
<br/>
after reading:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">$21 = {firstCluster = 3, length = 36953500, curPos = 183997730, curClus = 54, curSect = 183786496, curByte = 22489,
<br/>
  readBuffer = "\016\000\000\000\000\000\000\000‗W\000\000\n\000\000\000\"\001\000\000\001\000\000\001h?3\002\002\000\000\000\001\000\000\000\b\000\00
<br/>
0\000\002\000\000\000\001\000\000\000\b", '\0' &lt;repeats 11 times&gt;, "\t\004", '\0' &lt;repeats 28 times&gt;, "\n?┬\000\212\003\001\000env/space1dn.tga", '\0'
<br/>
 &lt;repeats 40 times&gt;, "\224?├\000\022\000\003\000maps/base1.bsp", '\0' &lt;repeats 42 times&gt;, "???\000pc\036\000textures/e1u1/metal2_1.wal", '\0' &lt;repeats
<br/>
 30 times&gt;, "\026K?\000?*\000\000textures/e1"..., appClus = 0, appSect = 0, appByte = 0, read = false, write = false, append = false,
<br/>
  inUse = false, dirEntSector = 0, dirEntOffset = 0}</td> </tr></table><span class="postbody">
<br/>
<br/>
...and the data in my buffer is the data from 8192 bytes further into the file.
<br/>
Hope this can be some use.
<br/>
<br/>
I've not yet tried using open()/seek() etc btw.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110865 - chishm - Sat Dec 02, 2006 9:44 am</h4>
    <div class="postbody"><span class="postbody">After tracing through all the pointers, you should be using </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">*(FAT_FILE *)(*(__handle *)fp-&gt;_file)-&gt;fileStruct</td> </tr></table><span class="postbody"> You'll need to #include &lt;sys/iosupport.h&gt; for __handle. This is all assuming DKP r19<span style="font-weight: bold">b</span>.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110986 - simonjhall - Sun Dec 03, 2006 12:08 pm</h4>
    <div class="postbody"><span class="postbody">Do I need to be using r19b? I'm still using r19a. Is this likely to be the problem? I've been putting off upgrading as I'm sure everything will just suddenly break! Y'know, don't fix what ain't broken etc ;-)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110990 - chishm - Sun Dec 03, 2006 12:48 pm</h4>
    <div class="postbody"><span class="postbody">Um, yeah, you <span style="font-weight: bold">need</span> r19b for libfat to work correctly. r19a had a small bug that caused the fileStruct data to become corrupted. This may be the root of your problem.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111036 - OOPMan - Sun Dec 03, 2006 7:54 pm</h4>
    <div class="postbody"><span class="postbody">Doh :-( That's kinda funny, in a not so funny way...
<br/>
<br/>
Maybe devkitPro should try and version check and then cry bloody murder if it's not up to date :-)<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111043 - simonjhall - Sun Dec 03, 2006 8:30 pm</h4>
    <div class="postbody"><span class="postbody">Right...I didn't know that you required a certain version in order for it to work. I thought they were, like, two separate things...
<br/>
<br/>
I'll get back to you when I get round to updating!<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111460 - mysteryegg - Wed Dec 06, 2006 7:44 pm</h4>
    <div class="postbody"><span class="postbody">If anybody has encountered problems with chism's fat lib using DS-X, I've discovered this may be related to the auto-boot option in DS-X. If your DS-X settings allow for your program to be loaded without loading the DS-X operating system first, the fat lib will not function properly, and both read &amp; write operations may fail.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111469 - OOPMan - Wed Dec 06, 2006 8:37 pm</h4>
    <div class="postbody"><span class="postbody">That's no surprise, since the DS-X is not officially supported by fatlib and won't be until to DS-X developers actually release some info about how their fat system works...<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111967 - JessTicular - Tue Dec 12, 2006 2:48 am</h4>
    <div class="postbody"><span class="postbody">About the EFA2 support - I don't think it works.
<br/>
<br/>
I've tried using both init and initDefault, but both of which return false unfortunatly.
<br/>
<br/>
Is there anything different or special I could try to get it to work for the EFAII?
<br/>
<br/>
[EDIT]
<br/>
ie, do I have to enable something in the source, and re-compile?
<br/>
[/EDIT]
<br/>
<br/>
Cheers,
<br/>
Jess.<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="font-weight: bold">Nintendo DS &amp; Dominos :: <a class="postlink" href="http://dsdominos.sourceforge.net" target="_blank">DS Dominos</a></span>
<br/>
<a class="postlink" href="http://jt0.org" target="_blank">http://jt0.org</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111972 - chishm - Tue Dec 12, 2006 3:32 am</h4>
    <div class="postbody"><span class="postbody">That's unfortunate. EFA2 is placed as the very last device in the list, as an experimental card. Either another driver is returning true incorrectly or the EFA2 driver is faulty. I don't have an EFA2 to test with, so I can't really fix it, but feel free to play with the source.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112077 - JessTicular - Wed Dec 13, 2006 12:19 am</h4>
    <div class="postbody"><span class="postbody">Ok, I rearranged the order and made the efa2 first, and it still failed. So it's definatly the driver.
<br/>
<br/>
Next, I have put in a number of debug strings throughout the efa2 io code, and narrowed the issue down to the fact that the returned NAND ID is wrong (getting 0x41000000 instead of 0xEC79A5C0).
<br/>
<br/>
I have absolutlely no idea where to go from here, so I've emailed CyteX, but in the mean-time, do you know much about the EFA2 hardware and its registers?
<br/>
<br/>
Cheers,
<br/>
Jess.<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="font-weight: bold">Nintendo DS &amp; Dominos :: <a class="postlink" href="http://dsdominos.sourceforge.net" target="_blank">DS Dominos</a></span>
<br/>
<a class="postlink" href="http://jt0.org" target="_blank">http://jt0.org</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112083 - chishm - Wed Dec 13, 2006 2:45 am</h4>
    <div class="postbody"><span class="postbody">I know next to nothing about the EFA2, so your best bet is CyteX.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112179 - JessTicular - Thu Dec 14, 2006 1:48 am</h4>
    <div class="postbody"><span class="postbody">No worries.
<br/>
<br/>
Thanks for the great library, though, without it, I'd still be stuck not knowing what to do :P
<br/>
<br/>
If I ever do get the EFA2 code working, I'll most definatly give you the updated source to include into the repository so others can benefit from it.
<br/>
<br/>
Cheers,
<br/>
Jess.<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="font-weight: bold">Nintendo DS &amp; Dominos :: <a class="postlink" href="http://dsdominos.sourceforge.net" target="_blank">DS Dominos</a></span>
<br/>
<a class="postlink" href="http://jt0.org" target="_blank">http://jt0.org</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112261 - sirpoonga - Thu Dec 14, 2006 10:49 pm</h4>
    <div class="postbody"><span class="postbody">Is there an emulator that supports libfat for testing?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112337 - OOPMan - Fri Dec 15, 2006 10:49 am</h4>
    <div class="postbody"><span class="postbody">I think Dualis does. I know it gets past basic init...
<br/>
<br/>
*checks quickly*
<br/>
<br/>
Hmmmm, Dualis can pretend that a GBAMP v2 is plugged in, but it doesn't actually allow you to specify and image for use with it, so I guess the real answer is: Not really...<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112362 - josath - Fri Dec 15, 2006 5:43 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>OOPMan wrote:</b></span></td> </tr> <tr> <td class="quote">I think Dualis does. I know it gets past basic init...
<br/>
<br/>
*checks quickly*
<br/>
<br/>
Hmmmm, Dualis can pretend that a GBAMP v2 is plugged in, but it doesn't actually allow you to specify and image for use with it, so I guess the real answer is: Not really...</td> </tr></table><span class="postbody">
<br/>
<br/>
Reading documentation might have been helpful. Dualis emulates a GBAMP, and the root of the CF card should be taken as the same directory that the NDS is in. However, I've had problems with it with newer versions of libfat, don't know if this has been fixed.
<br/>
<br/>
DeSmMuUEme (or whatever it's called), supposedly has GBAMP emulation as well in newest version. I haven't tried this, so can't comment on it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112364 - OOPMan - Fri Dec 15, 2006 6:12 pm</h4>
    <div class="postbody"><span class="postbody">Good point :-(
<br/>
<br/>
No noddy badge for me :-(<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112368 - tepples - Fri Dec 15, 2006 7:20 pm</h4>
    <div class="postbody"><span class="postbody"><a class="postlink" href="http://images.google.com/imgres?imgurl=http://www.ffenril.info/blog/wp-content/uploads/2006/04/Wii-Wii.gif&amp;imgrefurl=http://www.ffenril.info/blog/category/jeux/&amp;h=283&amp;w=426&amp;sz=52&amp;hl=en&amp;start=6&amp;tbnid=mhwx7E4ujKZqeM:&amp;tbnh=84&amp;tbnw=126&amp;prev=/images%3Fq%3Dwii-wii%26svnum%3D10%26hl%3Den%26lr%3D" target="_blank">Noddy</a> badge? What's that?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112437 - felix123 - Sat Dec 16, 2006 11:12 am</h4>
    <div class="postbody"><span class="postbody">Supercard <a class="postlink" href="http://chn.supercard.cn/download/down.asp?n=supercard_DS_io.zip" target="_blank">released the driver</a> for SC DS ONE. It's good to see manufacturer release drivers on launch day.<br/>_________________<br/><a class="postlink" href="http://en.wikipedia.org/wiki/NDSh" target="_blank">Nintendo DS homebrew on Wikipedia</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112438 - OOPMan - Sat Dec 16, 2006 11:18 am</h4>
    <div class="postbody"><span class="postbody">That is good news. I may consider getting a SC-DS at some point. I've disinterested in the DS-X mainly because the creators have yet to release any of their actual homebrew support...
<br/>
<br/>
EDIT: Crap, no USB port or anything on it :-(<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112439 - Sunray - Sat Dec 16, 2006 11:25 am</h4>
    <div class="postbody"><span class="postbody">Well, I rather have only auto FAT integration (which works perfectly for me) than only a FAT lib (sucks to recompile every app out there). gba_nds_fat and fatlib works fine in my apps, without a driver. Hopefully DS-Xtreme will have both soon.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112441 - OOPMan - Sat Dec 16, 2006 11:39 am</h4>
    <div class="postbody"><span class="postbody">I'd rather not have closed-source auto-integration, thanks.
<br/>
<br/>
At least with an open-source fatlib and open source drivers for devices
<br/>
you have some way of dealing with problems.
<br/>
<br/>
At present people using a DS-X can only rely on the DS-X team to
<br/>
fix homebrew compataibility problems. Not optimal, as the homebrew
<br/>
community has demonstrated itself quite capable of fixing stuff itself.<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112634 - sirpoonga - Mon Dec 18, 2006 11:33 pm</h4>
    <div class="postbody"><span class="postbody">FYI, the new R4 slot 1 device released it's I/O interface.
<br/>
<a href="http://www.r4ds.com/soft/3-other-en.htm" target="_blank">http://www.r4ds.com/soft/3-other-en.htm</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113307 - chishm - Tue Dec 26, 2006 10:27 am</h4>
    <div class="postbody"><span class="postbody">There is a new version of <a class="postlink" href="http://chishm.drunkencoders.com/libfat/20061225/libfat-nds-20061225.tar.bz2" target="_blank">libfat</a> that should hopefully solve device interface problems forever. See this <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=12001&amp;start=33" target="_blank">post</a> in this <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=12001&amp;postdays=0&amp;postorder=asc&amp;start=0" target="_blank">thread</a> for details.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114841 - Vich - Thu Jan 11, 2007 1:06 am</h4>
    <div class="postbody"><span class="postbody">I wonder if there are plans for integrating EZ-Flash 5?
<br/>
(I'm on the virge of buying a cartridge and the EZ5 is cheaper than the M3-SD one, while the EZ5 doesn't need a flashed DS)<br/>_________________<br/>[<a class="postlink" href="http://www.lifeisdigital.net" target="_blank">project website</a>] [<a class="postlink" href="http://www.kenvanhoeylandt.net" target="_blank">personal website</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114842 - josath - Thu Jan 11, 2007 1:33 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Vich wrote:</b></span></td> </tr> <tr> <td class="quote">I wonder if there are plans for integrating EZ-Flash 5?
<br/>
(I'm on the virge of buying a cartridge and the EZ5 is cheaper than the M3-SD one, while the EZ5 doesn't need a flashed DS)</td> </tr></table><span class="postbody">
<br/>
<br/>
The shop I looked at (not supposed to mention its name,  but it starts with "kick") had both of them for $45, and neither one requires flashed DS. I'd say go with the M3 Simply.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114892 - Vich - Thu Jan 11, 2007 10:13 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>josath wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Vich wrote:</b></span></td> </tr> <tr> <td class="quote">I wonder if there are plans for integrating EZ-Flash 5?
<br/>
(I'm on the virge of buying a cartridge and the EZ5 is cheaper than the M3-SD one, while the EZ5 doesn't need a flashed DS)</td> </tr></table><span class="postbody">
<br/>
<br/>
The shop I looked at (not supposed to mention its name,  but it starts with "kick") had both of them for $45, and neither one requires flashed DS. I'd say go with the M3 Simply.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Add shipping costs(to the Netherlands) and taxes and it'll be very close to what the shops are asking here (65? at the lowst ... to 100?+ :X)
<br/>
But almost all of them get delivered with a passme device, so I presume it doesn't work without one?
<br/>
Although I have a flashed DS, I might buy a DS light later, so it would be nice if I don't have to flash it(for warranty).
<br/>
<br/>
(sorry for taking this thread offtopic)<br/>_________________<br/>[<a class="postlink" href="http://www.lifeisdigital.net" target="_blank">project website</a>] [<a class="postlink" href="http://www.kenvanhoeylandt.net" target="_blank">personal website</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#115667 - HyperHacker - Thu Jan 18, 2007 7:51 am</h4>
    <div class="postbody"><span class="postbody">So... I don't see a download link anywhere on the site for libfat.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#115682 - Lick - Thu Jan 18, 2007 11:31 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">So... I don't see a download link anywhere on the site for libfat.</td> </tr></table><span class="postbody">
<br/>
Third page of that topic. I agree that the libfat build should be linked on the DLDI page, even just temporarily.<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#115720 - Puyo - Thu Jan 18, 2007 6:05 pm</h4>
    <div class="postbody"><span class="postbody">How about looking 6 posts earlier in this topic? But indeed should be added to DLDI page.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#115762 - HyperHacker - Fri Jan 19, 2007 12:03 am</h4>
    <div class="postbody"><span class="postbody">Ah, I didn't see the link there. They're almost the same colour as the text; when I'm up that late they start to blend right in. Thanks. (Though still, why no link on the page? I checked the source, so I doubt I missed it.)<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116043 - HyperHacker - Sun Jan 21, 2007 11:18 am</h4>
    <div class="postbody"><span class="postbody">If anyone else is getting "undefined reference to irqDisable" in libfat.a, the solution is <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=11848" target="_blank">so trivial it's almost funny</a>.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116220 - Vich - Tue Jan 23, 2007 8:36 am</h4>
    <div class="postbody"><span class="postbody">Can we update the startpost with the latest version of libfat and the drivers? It's a real pain to browse to 15-page topics for stuff that could be the right link...
<br/>
Why don't the developpers always keep a zip file named like "MyDriver-Latest.zip"? This way, we don't have to change the topic start continuously!<br/>_________________<br/>[<a class="postlink" href="http://www.lifeisdigital.net" target="_blank">project website</a>] [<a class="postlink" href="http://www.kenvanhoeylandt.net" target="_blank">personal website</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116251 - tepples - Tue Jan 23, 2007 6:03 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Vich wrote:</b></span></td> </tr> <tr> <td class="quote">Why don't the developpers always keep a zip file named like "MyDriver-Latest.zip"?</td> </tr></table><span class="postbody">
<br/>
There are only two ways to do it: filenames with the version number and filenames without the version number. If the version number is included, you complain. If the version number is omitted, people who keep an archive of multiple previous versions of software would complain about having to go in and rename each version after downloading it, as I have seen when figuring out the distribution for LOCKJAW.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116273 - HyperHacker - Tue Jan 23, 2007 11:48 pm</h4>
    <div class="postbody"><span class="postbody">So I suppose the simple solution is to update the first post to link to the latest version with each new release.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116316 - Vich - Wed Jan 24, 2007 10:08 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Vich wrote:</b></span></td> </tr> <tr> <td class="quote">Why don't the developpers always keep a zip file named like "MyDriver-Latest.zip"?</td> </tr></table><span class="postbody">
<br/>
There are only two ways to do it: filenames with the version number and filenames without the version number. If the version number is included, you complain. If the version number is omitted, people who keep an archive of multiple previous versions of software would complain about having to go in and rename each version after downloading it, as I have seen when figuring out the distribution for LOCKJAW.</span></td> </tr></table><span class="postbody">
<br/>
And what about uploading the file that has the version number in it ?nd uploading it as MyDriver-Latest.zip
<br/>
If they put a changelog or version.txt or an empty [version x].txt in it, it would be easily identifyable. Of course that's more work for the developpers, but it's not as much work as constantly updating the startpost.<br/>_________________<br/>[<a class="postlink" href="http://www.lifeisdigital.net" target="_blank">project website</a>] [<a class="postlink" href="http://www.kenvanhoeylandt.net" target="_blank">personal website</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#118291 - simonjhall - Sun Feb 11, 2007 10:35 pm</h4>
    <div class="postbody"><span class="postbody">Feeling kinda dumb here...
<br/>
Which DLDI driver do I need to use for a Supercard which takes miniSD? The regular 'scsd' one doesn't wanna know when using the dldi tester.
<br/>
The card worked fine when using the SCSD stuff from gba_nds_fat...
<br/>
<br/>
PS: I realise there's a search function, but searching for Supercard, DLDI or FAT is gonna turn up like a million hits...<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#118292 - dantheman - Sun Feb 11, 2007 10:38 pm</h4>
    <div class="postbody"><span class="postbody">simon, using the regular SC SD patch file for my miniSD works fine, though I sometimes have to apply it to the .ds.gba instead of the .nds.  I haven't used the DLDI tester myself though.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#118296 - simonjhall - Sun Feb 11, 2007 11:12 pm</h4>
    <div class="postbody"><span class="postbody">Seems that I can't get the dldi tester to work on my SC no matter what (there's gotta be something obv that I'm missing), but Quake runs 'fine' with DLDI. It also works when I patch it with the R4 driver too, which I find a bit suspicious!
<br/>
On the other hand, the M3 Simply works first time with DLDI, but after one frame of gameplay it locks up. O...k!<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121419 - theli - Mon Mar 12, 2007 8:27 am</h4>
    <div class="postbody"><span class="postbody">chishm, can you update G6 driver on your DLDI page?
<br/>
<a href="http://forum.gbadev.org/viewtopic.php?p=120549#120549" target="_blank">http://forum.gbadev.org/viewtopic.php?p=120549#120549</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121420 - Diddl - Mon Mar 12, 2007 9:04 am</h4>
    <div class="postbody"><span class="postbody">and could you update the DLDI driver for DS Link card? 
<br/>
<br/>
<a href="http://forum.gbadev.org/viewtopic.php?p=120281#120281" target="_blank">http://forum.gbadev.org/viewtopic.php?p=120281#120281</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121511 - silent_code - Mon Mar 12, 2007 9:14 pm</h4>
    <div class="postbody"><span class="postbody">hi!
<br/>
<br/>
this may be a rather dumb question, but: i have a neoflash mk4 mini and a neoflash slot 2 card - can someone point me to a solution how to get my files and directories onto it? do i need to make some sort of disk image? i don't have the possibility (read: software) to create directories on the flash card. just... how? couldn't find a forum for this (may be that i'm blind or something or it just doesn't exist) and i don't have the time to read through *all* post. (sorry.)
<br/>
<br/>
thanks for any help!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121515 - josath - Mon Mar 12, 2007 9:52 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>silent_code wrote:</b></span></td> </tr> <tr> <td class="quote">hi!
<br/>
<br/>
this may be a rather dumb question, but: i have a neoflash mk4 mini and a neoflash slot 2 card - can someone point me to a solution how to get my files and directories onto it? do i need to make some sort of disk image? i don't have the possibility (read: software) to create directories on the flash card. just... how? couldn't find a forum for this (may be that i'm blind or something or it just doesn't exist) and i don't have the time to read through *all* post. (sorry.)
<br/>
<br/>
thanks for any help!</td> </tr></table><span class="postbody">
<br/>
<br/>
What you want is called 'FCSR', GPF has a tool for fcsr images under windows, you can find it on his website. Also search for it on the forums, it should come up.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121523 - silent_code - Mon Mar 12, 2007 10:17 pm</h4>
    <div class="postbody"><span class="postbody">thanks, i'll have a look at it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121543 - Paco_777 - Tue Mar 13, 2007 1:18 am</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
I may be wrong but it seems that there is a memory leak in the fopen/fclose code 
<br/>
(on Supercard SD, at least)
<br/>
<br/>
To reproduce the problem I performed the following code:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int allocsize=1000;
<br/>
void* before = malloc(allocsize);
<br/>
free(before);
<br/>
<br/>
FILE *handle = fopen("/my.file", "r");
<br/>
fclose(handle);
<br/>
<br/>
void* after = malloc(allocsize);
<br/>
free(after);
<br/>
</td> </tr></table><span class="postbody">
<br/>
As a result, I get different values for 'before' and 'after'.
<br/>
<br/>
Has anyone else having this problem ?
<br/>
<br/>
(I cannot really confirm that, but I think that the libfat I used before the directory listing was available, did not have this problem)<br/>_________________<br/><a href="http://Gnese.free.fr/NDS/" target="_blank">http://Gnese.free.fr/NDS/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121587 - Diddl - Tue Mar 13, 2007 9:21 am</h4>
    <div class="postbody"><span class="postbody">I think this is no memory leak. it is cause of the buffer allocation of libfat.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121604 - chishm - Tue Mar 13, 2007 12:50 pm</h4>
    <div class="postbody"><span class="postbody">Updated DLDIs for DS Link and G6 flash cart.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121635 - Paco_777 - Tue Mar 13, 2007 5:29 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Diddl wrote:</b></span></td> </tr> <tr> <td class="quote">I think this is no memory leak. it is cause of the buffer allocation of libfat.</td> </tr></table><span class="postbody">
<br/>
<br/>
You might be right.
<br/>
I checked on XP and the result is the same (the addresses are different).
<br/>
I was not aware of that behaviour.
<br/>
<br/>
So i guess that there is one memory allocation performed with the first fopen method call (which is kept during all the program execution).
<br/>
Is it possible that some new memory allocation (not deleted by a fclose()) are done in the next fopen calls (or is the first one, the only one) ?
<br/>
<br/>
<br/>
For information, i need to know what is happening in order to avoid memory fragmentation.<br/>_________________<br/><a href="http://Gnese.free.fr/NDS/" target="_blank">http://Gnese.free.fr/NDS/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#124003 - felix123 - Mon Apr 02, 2007 12:25 pm</h4>
    <div class="postbody"><span class="postbody">Here's a DLDI for N-Card. I think it is written by the manufacturer. 
<br/>
<a href="http://www.superdslink.com/download/file/NC_DLDI.rar" target="_blank">http://www.superdslink.com/download/file/NC_DLDI.rar</a>
<br/>
originally from 
<br/>
<a href="http://www.superdslink.com/download/download.html" target="_blank">http://www.superdslink.com/download/download.html</a><br/>_________________<br/><a class="postlink" href="http://en.wikipedia.org/wiki/NDSh" target="_blank">Nintendo DS homebrew on Wikipedia</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#124016 - Diddl - Mon Apr 02, 2007 2:20 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>felix123 wrote:</b></span></td> </tr> <tr> <td class="quote">Here's a DLDI for N-Card. I think it is written by the manufacturer. </td> </tr></table><span class="postbody">
<br/>
<br/>
we have this since many weeks from other companies (Neo MK5, DS Linker ...) it is same and has READ SUPPORT ONLY. (write functions are only for SRAM).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#124397 - ps2aich - Thu Apr 05, 2007 7:26 pm</h4>
    <div class="postbody"><span class="postbody">Hi to all,
<br/>
<br/>
when Moonshell 1.5.1 came out and my GBAMP SD worked with it,
<br/>
I lived with that for the last 3 month now.
<br/>
<br/>
Today, I tried the first time to use DLDI with the GBAMP SD.
<br/>
(especially to test the new NDS_loader of chishm).
<br/>
And, it unfortunately does not work. Has anyone got it to work?
<br/>
<br/>
I then tried the DLDI Testing tool, injected the mpsd.dldi and it stops by the line
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">Initing FAT...</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
Since on the DLDI site GBAMP SD is still remarked untested, am I the first one to test it?????</span><span class="gensmall"><br/><br/>Last edited by ps2aich on Mon Apr 09, 2007 10:12 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#124509 - knight0fdragon - Fri Apr 06, 2007 1:29 pm</h4>
    <div class="postbody"><span class="postbody">qwerty, author of blubb, seems to be having problems with fseek and the lastest CVS.  I have tracked it down to where any file exactly mod 16k ends up crashing the program when fseek (fp, 0, SEEK_END);
<br/>
the temporary fix I gave him right now is to add one byte do the file, since it will work that way<br/>_________________<br/><a href="http://www.myspace.com/knight0fdragonds" target="_blank">http://www.myspace.com/knight0fdragonds</a>
<br/>
<br/>
MK DS FC: Dragon 330772 075464 
<br/>
AC WW FC: Anthony SamsClub 1933-3433-9458 
<br/>
MPFH: Dragon 0215 4231 1206</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#124515 - chishm - Fri Apr 06, 2007 2:16 pm</h4>
    <div class="postbody"><span class="postbody">Can you please post the relevant code snippets and indicate the exact location where it crashes. Also, make sure it is definitely the latest code from CVS. I had placed a fix in there about a month ago that dealt with a similar case to yours (or Blubb's).<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#124534 - qw3rty - Fri Apr 06, 2007 5:34 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
...
<br/>
FILE* fp;
<br/>
fp = fopen (tiledatafilename, "rb");
<br/>
   if (!fp)
<br/>
    {
<br/>
      fprintf (stderr, "error: couldn't open \"%s\"!\n", tiledatafilename);
<br/>
     free(palette8);
<br/>
      return -1;
<br/>
    }
<br/>
   printf("seeking file raw %d\n",fp);
<br/>
   fseek (fp, 0, SEEK_END); //&lt;----this call crashes at files with n*16K bytes
<br/>
   printf("telling size\n");
<br/>
   i = ftell (fp);//size
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I am using the newest CVS - downloaded two times today, verified that fatfile.c is indeed the one with the "fix" for fseeking.
<br/>
<br/>
I never had any problems with fseeking, before I updated to the libfat-cvs today.(I used the current stable version before I tried the CVS)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#124594 - chishm - Sat Apr 07, 2007 3:05 am</h4>
    <div class="postbody"><span class="postbody">Okay, can you try this (replaced with direct calls to open/seek) and tell me what happens:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int fd;
<br/>
fd = open (tiledatafilename, O_RDONLY, 0);
<br/>
   if (fd &lt; 0)
<br/>
    {
<br/>
      fprintf (stderr, "error: couldn't open \"%s\"!\n", tiledatafilename);
<br/>
     free(palette8);
<br/>
      return -1;
<br/>
    }
<br/>
   printf("seeking file raw %d\n",fd);
<br/>
   lseek (fd, 0, SEEK_END); // Does it still crash here?
<br/>
   printf("telling size\n");
<br/>
 // No tell operation for i = ftell (fp);//size </td> </tr></table><span class="postbody">
<br/>
<br/>
This will help me figure out where the bug is.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"><br/><br/>Last edited by chishm on Sat Apr 07, 2007 12:53 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#124625 - qw3rty - Sat Apr 07, 2007 10:19 am</h4>
    <div class="postbody"><span class="postbody">I tried hard, but I just can't find this 'seek' function you are talking about :(
<br/>
(undefined refernece to 'seek')
<br/>
<br/>
I searched devkitpro up&amp;down, I just can't find what lib /h to include</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#124631 - chishm - Sat Apr 07, 2007 12:53 pm</h4>
    <div class="postbody"><span class="postbody">Sorry, I meant lseek. I've fixed the above code fragment now. The header for it is &lt;sys/unistd.h&gt;.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#124633 - qw3rty - Sat Apr 07, 2007 1:19 pm</h4>
    <div class="postbody"><span class="postbody">lseek crashed too.
<br/>
<br/>
but I replaced O_RDONLY with 0....no idea if that is correct.
<br/>
<br/>
fd is "35702408", maybe that helps.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#124641 - chishm - Sat Apr 07, 2007 3:34 pm</h4>
    <div class="postbody"><span class="postbody">It really shouldn't be 0. Hmm, the fd should've been returned as -1 in that case, but that's a different matter. When it crashes, does it simply freeze, or does it do something else entirely. If you don't mind sticking in debug iprintfs, and since you are already compiling libfat yourself, you might want to add some debug messages to _FAT_seek_r in fatfile.c .<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#124703 - qw3rty - Sat Apr 07, 2007 9:46 pm</h4>
    <div class="postbody"><span class="postbody">&lt;sys/fcntl.h&gt; :
<br/>
#define	O_RDONLY	0
<br/>
<br/>
so I thought putting ZERO would be ok.
<br/>
I included fcntl.h now, exactly the same result.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   int fd;
<br/>
fd = open (tiledatafilename, O_RDONLY, 0);
<br/>
   if (fd &lt; 0)
<br/>
    {
<br/>
      fprintf (stderr, "error: couldn't open \"%s\"!\n", tiledatafilename);
<br/>
     free(palette8);
<br/>
      return -1;
<br/>
    }
<br/>
   printf("seeking file raw %d\n",fd);
<br/>
   lseek (fd, 0, SEEK_END); // Does it still crash here?
<br/>
   printf("lseek didn't crash\n");
<br/>
   while(1);</td> </tr></table><span class="postbody">
<br/>
<br/>
about the crash - lseek never returns.
<br/>
Maybe I'll look further into the problem tomorrow - I just returned from work.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#124862 - qw3rty - Mon Apr 09, 2007 7:53 am</h4>
    <div class="postbody"><span class="postbody">Hi :)
<br/>
<br/>
I included a printf() in _FAT_seek :
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
...
<br/>
                        while ((clusCount &gt; 0) &amp;&amp; (nextCluster != CLUSTER_FREE) &amp;&amp; (nextCluster != CLUSTER_EOF)) {
<br/>
         clusCount--;
<br/>
         cluster = nextCluster;
<br/>
         nextCluster = _FAT_fat_nextCluster (partition, cluster);
<br/>
         printf("while cluscount %i, %i\n",cluster,nextCluster);
<br/>
      }
<br/>
....
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
It does NOT crash with the printf, but it does if I uncomment it again :O
<br/>
This does sound very strange !
<br/>
Either I included a stupid bug in my program somewhere ?!
<br/>
Or the little "pause" from the printf() fixes the crash - no idea ?!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#124864 - qw3rty - Mon Apr 09, 2007 8:21 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
      while ((clusCount &gt; 0) &amp;&amp; (nextCluster != CLUSTER_FREE) &amp;&amp; (nextCluster != CLUSTER_EOF)) {
<br/>
         vcount_old = REG_VCOUNT;
<br/>
         clusCount--;
<br/>
         cluster = nextCluster;
<br/>
         nextCluster = _FAT_fat_nextCluster (partition, cluster);
<br/>
         //printf("while cluscount %i, %i\n",cluster,nextCluster);
<br/>
         while (vcount_old == REG_VCOUNT);
<br/>
      }
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
fixes the bug too !
<br/>
<br/>
EDIT : !
<br/>
It doesn't really fix it, it just doesn't crash anymore, but now it returns the wrong size (for n*16k files) !
<br/>
<br/>
EDIT2 : printf() didn't really fix it neither - also wrong file size !
<br/>
The filesize I get from ftell is -22 !
<br/>
I tried to make a huge pause, 190 scanlines - same result.
<br/>
<br/>
P.S. : All my tests were made on GBA-MP, default dldi-driver (binary NOT patched)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#124897 - HyperHacker - Mon Apr 09, 2007 8:31 pm</h4>
    <div class="postbody"><span class="postbody">It's memory corruption. Have fun! &lt;_&lt;<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#125081 - chishm - Wed Apr 11, 2007 5:34 am</h4>
    <div class="postbody"><span class="postbody">Try sticking the printf after the while loop and see if it ever makes it out of the while loop, and to see if it still crashes. I'm with HyperHacker on this one, it sounds like memory corruption. Now we just need to figure out where.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#125203 - chishm - Thu Apr 12, 2007 2:13 am</h4>
    <div class="postbody"><span class="postbody">It seems that you were bitten by a bug that I cam across a few months ago. The newlib stubs that call _FAT_seek_r were passing a NULL pointer when they shouldn't, and _FAT_seek_r was writing to it, causing the freezing. There was also a related bug when seeking to the end of a read-mode file that was an integer multiple of a cluster size, which I just fixed. Try the latest CVS code now.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#125229 - qw3rty - Thu Apr 12, 2007 7:26 am</h4>
    <div class="postbody"><span class="postbody">OK, I will test it - thanks for the fix chism :D
<br/>
<br/>
P.S. : Seems to work flawless now (at least seaking to the end of n*16k files)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#126317 - cory1492 - Sun Apr 22, 2007 4:30 am</h4>
    <div class="postbody"><span class="postbody">ttbal pointed this out to me yesterday, is this problem localized to my build of what is in cvs? Is it something I missed?
<br/>
<a class="postlink" href="http://nds.cmamod.com/fattest_1492.zip" target="_blank">fattest_1492.zip</a>
<br/>
(a sample showing symptoms of the problem)
<br/>
<br/>
I am able to create multiple entries with identical file names (a side effect being that the name displayed by the dir iteration is also not correct) using current cvs revision of libfat???
<br/>
<br/>
Example:
<br/>
Within a directory "test2" I open a non-existant file called "zelda DX.sav" in "wb" mode, write data to it and close it, open a file called "zelda DX.sav" in "wb" mode, write data to it and close it, then use the directory iteration function to get the name of the file... they <span style="font-style: italic">both</span> are "zelda.sav" - the problem occurs whether /test is my cwd or when I call fopen with "/test/" prepended.
<br/>
<br/>
It doesn occur when the file was already existing via creation by windows (even if it is just a 0k file).
<br/>
<br/>
edit:/ meant cvs not svn</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#126325 - chishm - Sun Apr 22, 2007 8:35 am</h4>
    <div class="postbody"><span class="postbody">I've just fixed the code in CVS. It was because I had forgotten to add space to the list of illegal alias (short filename) characters. That sample really helped to track down the bug, thanks.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#126330 - cory1492 - Sun Apr 22, 2007 11:18 am</h4>
    <div class="postbody"><span class="postbody">Awesome, I'm not crazy... maybe.
<br/>
<br/>
Thanks chishm for the fast fix, works great now. Jumping from R17 to R20 was mildly painful, but for libfat it is definitely worth it.
<br/>
<br/>
On another note:
<br/>
Is there a simple way to tell free/used space (preferably before opening a file and writing to it)? I'm guessing no, but I figured I'd ask at any rate. Writing a file without enough free space, and then closing it (pretty much ignoring any ferror/errno) seems to be corrupting the card.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130431 - wandafritsch - Sun Jun 03, 2007 11:29 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>cory1492 wrote:</b></span></td> </tr> <tr> <td class="quote">I am able to create multiple entries with identical file names (a side effect being that the name displayed by the dir iteration is also not correct) using current cvs revision of libfat???</td> </tr></table><span class="postbody">
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote">I've just fixed the code in CVS. It was because I had forgotten to add space to the list of illegal alias (short filename) characters. That sample really helped to track down the bug, thanks.</td> </tr></table><span class="postbody">
<br/>
<br/>
Same thing happens if I worked with DSFTP.
<br/>
The ftp client showed two directories with the same name within one folder. 
<br/>
DSOrganize told me the same, two times an identical name... 
<br/>
<br/>
[APPL]
<br/>
 ---- [DSMI]
<br/>
 ---- [DSMI]
<br/>
 ---- ... 
<br/>
<br/>
Putting this 'corrupted' card into my PC shows up:
<br/>
<br/>
[APPL]
<br/>
 ---- [DSAIM]
<br/>
 ---- [DSMI]
<br/>
 ---- ...
<br/>
<br/>
So I am wondering why the PC could see the right things 
<br/>
while the DS shows wrong ones!?
<br/>
<br/>
:-)</span><span class="gensmall"><br/><br/>Last edited by wandafritsch on Sun Jun 03, 2007 3:31 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#130439 - jackman - Sun Jun 03, 2007 1:00 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wandafritsch wrote:</b></span></td> </tr> <tr> <td class="quote">The ftp client showed two directories with the same name within one folder.
<br/>
DSOrganize told me the same, two times an identical name...</td> </tr></table><span class="postbody">
<br/>
the same as on my SD Cards, but two things are different:
<br/>
<br/>
1. DSO freeze when I open the folder with the "corrupted" filenames
<br/>
2. MoonShell 1.7x displays wrong filenames, but opens the correct ones (will happen with both scsd.dldi and scsd_moon.dldi)<br/>_________________<br/>Equipment:
<br/>
Nintendo DS, GBAMP v2, SuperCard SD, SuperKey, Acekard 2i</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#132897 - HyperHacker - Sun Jul 01, 2007 8:50 am</h4>
    <div class="postbody"><span class="postbody">Is there a way to tell which slot fat0:/ is accessing?<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#133141 - tepples - Tue Jul 03, 2007 8:08 pm</h4>
    <div class="postbody"><span class="postbody">If fat1: is present, then fat0: uses it. Otherwise, fat0: uses fat2:.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>cory1492 wrote:</b></span></td> </tr> <tr> <td class="quote">Is there a simple way to tell free/used space (preferably before opening a file and writing to it)? I'm guessing no, but I figured I'd ask at any rate. Writing a file without enough free space, and then closing it (pretty much ignoring any ferror/errno) seems to be corrupting the card.</td> </tr></table><span class="postbody">
<br/>
I'd like to know as well so that my programs don't corrupt the card when writing out the state of a simulated village.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#133784 - abszero - Sun Jul 08, 2007 6:44 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote">It seems that you were bitten by a bug that I cam across a few months ago. The newlib stubs that call _FAT_seek_r were passing a NULL pointer when they shouldn't, and _FAT_seek_r was writing to it, causing the freezing.</td> </tr></table><span class="postbody">
<br/>
<br/>
I think a similar bug may still exist.  I seem to be getting sporadic data aborts from _FAT_seek_r that are arising from r being NULL when setting r-&gt;_errno.  They seem to all be arising from the 'if (position &lt; 0)' block, though I haven't tested this extensively.
<br/>
<br/>
Testing for NULL before accessing _errno seems to avoid the crashes, though it's somewhat hard to confirm whether my program is losing any data because of whatever's going on.  I haven't tracked down what the circumstances leading to the NULL call are, but they seem to only happen in _FAT_seek_r, even though the other _FAT_xxx functions are equally prone.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#133838 - chishm - Mon Jul 09, 2007 4:03 am</h4>
    <div class="postbody"><span class="postbody">_FAT_seek_r being called with r = NULL was a fault of the seek stub that was calling it. This fault should have been fixed in DKA r20, unless my memory of the release date is a little off. If not, then it will definitely be fixed in DKA r21.
<br/>
<br/>
The other _FAT_xxx functions should not have this problem, since the calling stubs don't have the same fault.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#133851 - abszero - Mon Jul 09, 2007 8:28 am</h4>
    <div class="postbody"><span class="postbody">Ah, good to know.  For the record, I was getting the problem with R20 and a freshly checked out version of libfat (07/07/07 I guess) so perhaps a real fix will have to wait till R21.
<br/>
<br/>
Thanks for all the work on libfat, btw :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135054 - josath - Thu Jul 19, 2007 8:13 pm</h4>
    <div class="postbody"><span class="postbody">I am attempting to make the DS appear as a Mass Storage Device via the USB port on the DSerial. In order to do this, I need to be able to read/write 512 byte sectors directly on the disk.
<br/>
<br/>
What is the best way to directly call a readSector(s)/writeSector(s) function, that still takes advantage of DLDI &amp; libfat's ability to autodetect the device type? (This way the MSD driver will automatically work for any libfat-supported slot-2 device)
<br/>
<br/>
I mean, I can see i want something like partition-&gt;disc-&gt;fn_readSectors &amp; fn_writeSectors, but if at all possible, I don't want to hack into the internals of libfat, which might make my code break if libfat gets changed internally.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135102 - chishm - Fri Jul 20, 2007 5:31 am</h4>
    <div class="postbody"><span class="postbody">Using the disc pointer is probably the best way to do it. Alternatively, you can just use the code in the disc_io folder of libfat's source to access the disc. This requires that you not use libfat at all, otherwise you'll end up with 2 DLDI sections and only the first will be patched.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135149 - Dwedit - Fri Jul 20, 2007 12:42 pm</h4>
    <div class="postbody"><span class="postbody">I was wondering if the busy waiting code for the Disc IO devices requires cycle-accurate accuracy, or if the CPU be spent doing something else useful while waiting for the device to become ready.  For example, let's say the disc IO code was modified to set a high resolution timer to generate interrupts, then check if the device is ready within the interrupt handler.
<br/>
I wouldn't expect all busy waiting to be interruptible, for example SCSD required assembly code to communicate.
<br/>
Additionally, I'm wondering if it's okay to have interrupts enabled during Disc IO calls.  I see nothing to disable interrupts anywhere in libfat, except for the apparently interrupt-driven NinjaDS driver.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135157 - chishm - Fri Jul 20, 2007 1:52 pm</h4>
    <div class="postbody"><span class="postbody">Most devices don't need cycle-level accuracy. 
<br/>
<br/>
Many SLOT-2 cards use the read/write signals on the GBA bus to generate the clock signal for the inserted SD/CF card. Media cards tend to have a high tollerance for the clock timings, and as long as you don't read/write other parts of the GBA cart when trying to access the media card, you should be okay. The SuperCard SD is an exception to this, as it uses an internal register when writing to the SD card.
<br/>
<br/>
SLOT-1 cards either abstract away the communication with the media card to work using the SLOT-1 ROM bus, or they use the SPI bus, which is also tolerant of varying clock signals.
<br/>
<br/>
For the same reason, interrupts should be acceptable when communicating with the media card, unless the adapter device's hardware requires higher cycle accuracy.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135251 - Dwedit - Sat Jul 21, 2007 12:56 pm</h4>
    <div class="postbody"><span class="postbody">Why not disable interrupts while talking to the SCSD then?
<br/>
<br/>
Also, is it possible to have a different IO driver that leaves the M3/supercard in RAM mode all the time, except when it's time to access the disk, then switches it to disk mode and back again on each IO call?<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135253 - Snaeng - Sat Jul 21, 2007 2:28 pm</h4>
    <div class="postbody"><span class="postbody">Maybe this was already asked, but theese are 16 pages :|
<br/>
<br/>
Does this also work with the C++ implementions of file accessing? -&gt; ifstream</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135259 - tepples - Sat Jul 21, 2007 3:27 pm</h4>
    <div class="postbody"><span class="postbody">Libfat is a file system implementation that installs itself into the "devoptab" of devkitARM libc. Such file systems work with anything that calls _open_r() (a function that is like open() but reentrant). The <a class="postlink" href="http://sourceware.org/cgi-bin/cvsweb.cgi/src/newlib/libc/stdio/fopen.c?rev=1.9&amp;content-type=text/x-cvsweb-markup&amp;cvsroot=src" target="_blank">newlib implementation of fopen()</a> of standard C I/O (&lt;stdio.h&gt;) calls _open_r(). <a class="postlink" href="http://gcc.gnu.org/cgi-bin/cvsweb.cgi/gcc/libstdc%2b%2b-v3/config/io/basic_file_stdio.cc?rev=1.36&amp;content-type=text/x-cvsweb-markup" target="_blank">ofstream::open() of libstdc++</a>, the GNU implementation of C++ standard library, calls fopen().
<br/>
<br/>
Caution: Like Knuth, I have only proved this call graph correct; I have not tested it.
<br/>
<br/>
But in practice, I would recommend against the use of C++'s I/O facilities unless you can spare 0.25 MiB of the 4 MiB EWRAM for dead code dealing with data types that your program does not use. (If you want verification of this, ask me for the results from nm on hello world.) Particularly on the GBA, which has only 0.25 MiB of EWRAM, you cannot.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135268 - Snaeng - Sat Jul 21, 2007 5:08 pm</h4>
    <div class="postbody"><span class="postbody">Well, I decided to code in C++, so I'll code in C++.
<br/>
I don't like a C++ / C mix, that's just awful.
<br/>
<br/>
But thanks for the answer. :&gt;</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135277 - tepples - Sat Jul 21, 2007 6:40 pm</h4>
    <div class="postbody"><span class="postbody">It's possible to code in C++ and use &lt;cstdio&gt; (std::printf(), etc) for binary sizes roughly comparable to those of C.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135281 - Snaeng - Sat Jul 21, 2007 7:43 pm</h4>
    <div class="postbody"><span class="postbody">That would still be a mix of C++ / C. std::printf are just there, because they were in C.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135305 - chishm - Sun Jul 22, 2007 2:50 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dwedit wrote:</b></span></td> </tr> <tr> <td class="quote">Why not disable interrupts while talking to the SCSD then?</td> </tr></table><span class="postbody">
<br/>
The SCSD only needs cycle accurate tming for each halfword of data written to the disc. It works by the host filling the SCSD's register with a 16 bit value on the first cycle, which the SCSD then outputs 4 bits at a time to the SD card. Each of those 4 bits is output on each strobe of the WR line (not absolutely sure on this one, but it describes the behaviour). Strobing the CS line inbetween causes problems. This is all achieved by using a stmia instruction to write 2 CPU register's contents to the GBA bus, with the low 16 bits of the low register containing the value to be written to the SD card and the rest containing garbage.
<br/>
<br/>
The SC Lite is slightly different, and doesn't use seem to use an intermediate register, so the data written in each halfword has to contain the correct nybble to be written to the SD card.
<br/>
<br/>
In either case, I'm pretty sure that the stmia instruction should be atomic, except on data aborts.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dwedit wrote:</b></span></td> </tr> <tr> <td class="quote">Also, is it possible to have a different IO driver that leaves the M3/supercard in RAM mode all the time, except when it's time to access the disk, then switches it to disk mode and back again on each IO call?</td> </tr></table><span class="postbody">
<br/>
Sure, DLDI allows you to write your own driver and use it without recompiling libfat.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135648 - abszero - Wed Jul 25, 2007 7:37 am</h4>
    <div class="postbody"><span class="postbody">It's not normal behavior for fseeks over a file to stop working after a bad seek is it?  I don't see any evidence of such in what documentation google readily turns up.
<br/>
<br/>
Specifically, I found a place in my code where I was calling fseek (SEEK_SET) with a negative file offset.  I got a correct error response at that point and handled it okay in my code, but at the next fseek on that file (to a correct offset that works fine if you haven't made the bad call first), I get a crash occuring in iocontrol.h's AddDevice during the fseek.
<br/>
<br/>
Am I supposed to be clearerr'ing or something?  Or is this a bug somewhere?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135652 - calcprogrammer1 - Wed Jul 25, 2007 8:10 am</h4>
    <div class="postbody"><span class="postbody">I'm making a file browser/manager for the DS, with the intention of using both SLOT1 and SLOT2.  I have the folder system implemented with but a few modifications to get it working.
<br/>
<br/>
I'd like to know, where is there a full documentation (all commands) reference of libfat?  If there is none, where might I find information about using the commands it has?
<br/>
<br/>
Also, is there a way to read the name/description of the DLDI?  I know in MoonShell it will say "adapter:gmtf" and "Datel Games n' Music (microSD)" somewhere in it's bootup sequence.  I'd like to put that information on my program too, as well (if possible) the name of the SLOT2 device (non-DLDI) like a GBAMP or Supercard CF or whatever didn't need DLDI.
<br/>
<br/>
Last thing...how would you go about copying a file?  Do you need to reserve a chunk of RAM to read stuff to, or can you directly read from SLOT2 and write to SLOT1 at the same time?  (hoping to add copy support between cards, also same card, if possible).
<br/>
<br/>
I've asked lots of questions, but once I get the documentation and enough time at my computer I usually can figure them out on my own...but I need documentation on this, as I've done very little file access, and that was only in C++, my app's using just C.<br/>_________________<br/>DS Firmware 1, Datel Games n' Music card / Chism's FW hacked GBA MP v2 CF
<br/>
<br/>
There's no place like 127.0.0.1.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135654 - Dwedit - Wed Jul 25, 2007 8:44 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>abszero wrote:</b></span></td> </tr> <tr> <td class="quote">It's not normal behavior for fseeks over a file to stop working after a bad seek is it?  I don't see any evidence of such in what documentation google readily turns up.
<br/>
<br/>
Specifically, I found a place in my code where I was calling fseek (SEEK_SET) with a negative file offset.  I got a correct error response at that point and handled it okay in my code, but at the next fseek on that file (to a correct offset that works fine if you haven't made the bad call first), I get a crash occuring in iocontrol.h's AddDevice during the fseek.
<br/>
<br/>
Am I supposed to be clearerr'ing or something?  Or is this a bug somewhere?</td> </tr></table><span class="postbody">
<br/>
According to this: <a href="http://www.cplusplus.com/reference/clibrary/cstdio/clearerr.html" target="_blank">http://www.cplusplus.com/reference/clibrary/cstdio/clearerr.html</a>
<br/>
You're supposed to use clearerr, otherwise the error condition stays set on the stream.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135655 - Dwedit - Wed Jul 25, 2007 8:45 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>calcprogrammer1 wrote:</b></span></td> </tr> <tr> <td class="quote">I'm making a file browser/manager for the DS, with the intention of using both SLOT1 and SLOT2.  I have the folder system implemented with but a few modifications to get it working.
<br/>
<br/>
I'd like to know, where is there a full documentation (all commands) reference of libfat?  If there is none, where might I find information about using the commands it has?
<br/>
<br/>
Also, is there a way to read the name/description of the DLDI?  I know in MoonShell it will say "adapter:gmtf" and "Datel Games n' Music (microSD)" somewhere in it's bootup sequence.  I'd like to put that information on my program too, as well (if possible) the name of the SLOT2 device (non-DLDI) like a GBAMP or Supercard CF or whatever didn't need DLDI.
<br/>
<br/>
Last thing...how would you go about copying a file?  Do you need to reserve a chunk of RAM to read stuff to, or can you directly read from SLOT2 and write to SLOT1 at the same time?  (hoping to add copy support between cards, also same card, if possible).
<br/>
<br/>
I've asked lots of questions, but once I get the documentation and enough time at my computer I usually can figure them out on my own...but I need documentation on this, as I've done very little file access, and that was only in C++, my app's using just C.</td> </tr></table><span class="postbody">
<br/>
<br/>
Usually you just use a small buffer, maybe 4k or 32k large.  Internally, the Disk IO routines read and write full 512 byte sectors, or multiple sectors as a whole cluster.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135666 - chishm - Wed Jul 25, 2007 12:48 pm</h4>
    <div class="postbody"><span class="postbody">calcprogrammer1:
<br/>
<a class="postlink" href="http://chishm.drunkencoders.com/libfat/index.html" target="_blank">http://chishm.drunkencoders.com/libfat/index.html</a> has all the non-standard information about libfat. Everything else can be done C stdio.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135686 - calcprogrammer1 - Wed Jul 25, 2007 4:50 pm</h4>
    <div class="postbody"><span class="postbody">Ok, I'm reading some C copying examples.  The browsing part seems to be done, and checking filenames shouldn't be hard.
<br/>
<br/>
Is there any way to read the name of the current devices?<br/>_________________<br/>DS Firmware 1, Datel Games n' Music card / Chism's FW hacked GBA MP v2 CF
<br/>
<br/>
There's no place like 127.0.0.1.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135724 - abszero - Wed Jul 25, 2007 8:14 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dwedit wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>abszero wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Am I supposed to be clearerr'ing or something?  Or is this a bug somewhere?</td> </tr></table><span class="postbody">
<br/>
According to this: <a href="http://www.cplusplus.com/reference/clibrary/cstdio/clearerr.html" target="_blank">http://www.cplusplus.com/reference/clibrary/cstdio/clearerr.html</a>
<br/>
You're supposed to use clearerr, otherwise the error condition stays set on the stream.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Yeah, that's one of the places I looked, but it says nothing about clearing the error being a requirement to continue using the stream (is this common knowledge I'm lacking?), and does say the next call to fseek should clear the error anyway.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135760 - calcprogrammer1 - Thu Jul 26, 2007 5:09 am</h4>
    <div class="postbody"><span class="postbody">How can you tell if a device is inserted or not?  My program crashes when I don't have a GBA card in, I want it to check to see if there's a slot-1, check to see if there's a slot-2, and if there is a slot 2 show its contents, otherwise show the slot-1's contents.<br/>_________________<br/>DS Firmware 1, Datel Games n' Music card / Chism's FW hacked GBA MP v2 CF
<br/>
<br/>
There's no place like 127.0.0.1.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135782 - Dwedit - Thu Jul 26, 2007 8:17 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>abszero wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dwedit wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>abszero wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Am I supposed to be clearerr'ing or something?  Or is this a bug somewhere?</td> </tr></table><span class="postbody">
<br/>
According to this: <a href="http://www.cplusplus.com/reference/clibrary/cstdio/clearerr.html" target="_blank">http://www.cplusplus.com/reference/clibrary/cstdio/clearerr.html</a>
<br/>
You're supposed to use clearerr, otherwise the error condition stays set on the stream.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Yeah, that's one of the places I looked, but it says nothing about clearing the error being a requirement to continue using the stream (is this common knowledge I'm lacking?), and does say the next call to fseek should clear the error anyway.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Well, basically if you've ever coded for C++, and accidently typed a non-number character when trying to do 'cin &gt;&gt; int', you'll notice that the program goes crazy.  What happens is that the Fail bit for the stream gets set, and until it gets cleared, all IO operations are basically aborted (because they test the Fail bit before starting) until you call cin.clear();  I'd assume it was similar for C.  Functions would immediately abort if the stream has an error condition.
<br/>
<br/>
Edit: I just realized my post was completely stupid and incorrect, disregard it.  Failbit does not propegate to other input, it just passes the input it did not take to the next call.  But Bad bit and EOF bit do behave like I mentioned.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135846 - abszero - Thu Jul 26, 2007 7:57 pm</h4>
    <div class="postbody"><span class="postbody">Well, I appreciate all the input, but I dug a little further and it turns out the answer is that I'm stupid.
<br/>
<br/>
I had some old cleanup code hidden away that was closing the stream on an error.  That code was supposed to have been deleted but wasn't, and so the stream was being closed before the second seek.  Removing the fclose causes the whole thing to work fine (without correcting the initial fseek to a negative offset or clearerr'ing afterwards).  
<br/>
<br/>
It still seems to me like incorrect behavior for a stream access to a closed stream to result in a pointer exception instead of returning EBADF or something.  But my problem is prevented several times over now, so I'm not too worried if people disagree.  
<br/>
<br/>
Thanks again for the responses.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137091 - tepples - Tue Aug 07, 2007 9:13 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b><a class="postlink" href="http://forum.gbadev.org/viewtopic.php?p=135102#135102" target="_blank">A couple weeks ago</a>, chishm wrote:</b></span></td> </tr> <tr> <td class="quote">Using the disc pointer is probably the best way to do it.</td> </tr></table><span class="postbody">
<br/>
But how do I do that? Would I need to recompile libfat from source to do it? And would I have to wait for CVS to stabilize after devkitARM R21 comes out? I ask because I am in the process of writing code that determines the number of free clusters and number of free kibibytes on the disc, and it appears to need some private interfaces into libfat.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#138544 - EyeballKid - Sat Aug 25, 2007 9:04 am</h4>
    <div class="postbody"><span class="postbody">When creating new files, does libfat always force short filenames to upper case?
<br/>
<br/>
Looking at the source, the _FAT_directory_addEntry() function does seem to force short filenames to upper case.
<br/>
I don't know much about the FAT filesystem (and all its variants :- ), but would a fix be to leave entry-&gt;filename as it is, and force just the generated alias to uppercase instead?
<br/>
<br/>
I'd be happy to sumbit a patch to do this, if it were the right approach!
<br/>
<br/>
<br/>
(I discovered this when using libfat to write NDS files to my supercard sd. I was wondering why the written file wasn't appearing in the supercard boot menu. It turns out the supercard sd bootmenu only displays nds files with a lowercase extension).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#138566 - tepples - Sat Aug 25, 2007 7:44 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>EyeballKid wrote:</b></span></td> </tr> <tr> <td class="quote">When creating new files, does libfat always force short filenames to upper case?</td> </tr></table><span class="postbody">
<br/>
FAT long file names as implemented by the NT kernel (Windows 2000, Windows XP, Windows Server 2003, Windows Vista) do not use aliases for short filenames where the name is entirely one case and the extension is entirely one case, such as "example.TXT" or "EXAMPLE.txt" or "example.txt". Instead, they are stored uppercase, without a long file name entry, with <a class="postlink" href="http://en.wikipedia.org/wiki/File_Allocation_Table#Long_file_names" target="_blank">two bits in byte 0x0C used to transform the case</a>. Linux since 2.6.something implements this, but I'm not sure that libfat does this correctly.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143153 - spinal_cord - Wed Oct 17, 2007 1:36 pm</h4>
    <div class="postbody"><span class="postbody">Can someone tell me how to check if a file is hidden?
<br/>
I don't think st_attr works (or I'm not using it correctly).<br/>_________________<br/>I'm not a boring person, it's just that boring things keep happening to me.
<br/>
<a class="postlink" href="http://spinal.dizidesigns.co.uk/" target="_blank">Homepage</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143179 - Dwedit - Wed Oct 17, 2007 7:34 pm</h4>
    <div class="postbody"><span class="postbody">Feature request:
<br/>
When scanning a directory containing many many files, I would like a function to call that returns a handle to a directory entry.  That way, I can call open on a file without rescanning the directory.
<br/>
<br/>
I've thought about this a bit, and obviously this will fail if there is more than one thread messing with the file system unless done carefully.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143416 - spinal_cord - Sun Oct 21, 2007 1:30 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>spinal_cord wrote:</b></span></td> </tr> <tr> <td class="quote">Can someone tell me how to check if a file is hidden?
<br/>
I don't think st_attr works (or I'm not using it correctly).</td> </tr></table><span class="postbody">
<br/>
<br/>
anyone? oh well...<br/>_________________<br/>I'm not a boring person, it's just that boring things keep happening to me.
<br/>
<a class="postlink" href="http://spinal.dizidesigns.co.uk/" target="_blank">Homepage</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143422 - chishm - Sun Oct 21, 2007 3:45 am</h4>
    <div class="postbody"><span class="postbody">spinal_cord:
<br/>
There's no field in the stat struct to indicate a hidden file. Maybe the execute bit in st_mode can be used for this, since it is used to indicate listable directories.
<br/>
<br/>
Dwedit:
<br/>
You can cast the dirStruct* in your DIR_ITER handle to a DIR_STATE_STRUCT, as defined in fatdir.h. This has the DIR_ENTRY of the current file, which you can use from there.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143839 - load*,8,1 - Fri Oct 26, 2007 6:00 pm</h4>
    <div class="postbody"><span class="postbody">I'm having a bit of trouble with the dirnext() function. What entries is it supposed to give you? Only all the files/folders for the diropen()ed  directory or subfolders as well? Because I'm getting all the files of the directory as well as all those of the first subfolder. I even get that result with the code snippet from here: <a href="http://chishm.drunkencoders.com/libfat/index.html" target="_blank">http://chishm.drunkencoders.com/libfat/index.html</a>
<br/>
Am I doing something wrong or is it a bug in libfat?
<br/>
<br/>
Edit: I did some more testing and something seems to be screwed up big time. :( I have two subdirectories, /data and /lang. When I open /data, I get the contents of /. Without any garbage from other subdirectories. And when I open /lang I get all the files from /data. Seems like the directory structure is shifted somehow.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143897 - chishm - Sat Oct 27, 2007 5:04 am</h4>
    <div class="postbody"><span class="postbody">Scandisk your card. If it still happens then remove all unnecessary files, defrag it, make a binary dump to a file, zip the file, then send the file to me so I can try to recreate the problem.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144095 - load*,8,1 - Mon Oct 29, 2007 1:15 am</h4>
    <div class="postbody"><span class="postbody">Thanks, that worked. Must've been just a screwed up file system.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144496 - Lazy1 - Sat Nov 03, 2007 12:21 am</h4>
    <div class="postbody"><span class="postbody">I don't know if it has been mentioned in this thread but how about a parameter in the fat initialize code to disable certain interrupts during I/O operations?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144503 - HyperHacker - Sat Nov 03, 2007 2:34 am</h4>
    <div class="postbody"><span class="postbody">I noticed with GBAMP if I give ARM7 access to the GBA slot, fopen() will just hang. I know it can't actually work, and I shouldn't have been doing that (stupid bug), but shouldn't it check if it has access and fail if not?
<br/>
<br/>
Also, if I want to write an app specifically for one device that already has a built-in driver, can I remove DLDI support since it wouldn't be necessary?<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144529 - chishm - Sat Nov 03, 2007 9:11 am</h4>
    <div class="postbody"><span class="postbody">Lazy1:
<br/>
Interrupt usage is up to the user. Wrap file accesses with interrupt disabling code if you want to be sure they won't fire.
<br/>
<br/>
HyperHacker:
<br/>
libfat sets access when it initializes. I take the view that the application code should have as much control as it wants. Checking that the user code hasn't changed slot permissions is an unnecessary overhead.
<br/>
<br/>
You can remove DLDI support if you are sure you won't need it. at least for now. You will have to remove references to it in disc_io.c and recompile libfat.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144568 - Lazy1 - Sat Nov 03, 2007 11:18 pm</h4>
    <div class="postbody"><span class="postbody">I have already disabled interrupts before the main loop does any file access, I just thought it would be neater/easier code wise if this was done at the driver level.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144584 - HyperHacker - Sun Nov 04, 2007 5:51 am</h4>
    <div class="postbody"><span class="postbody">So is fflush() broken? Writing to a file, calling fflush(), and turning off the system without closing the file results in an empty file. There's no way to close it when I'm done because I'm using it to keep track of what happens before the program crashes.
<br/>
<br/>
[edit] I managed to install my own exception handler and found that within it, fcloseall() hangs but fclose() works fine. O_o<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145155 - HyperHacker - Mon Nov 12, 2007 1:00 am</h4>
    <div class="postbody"><span class="postbody">I had some interesting ideas of things you could do with DLDI, especially if multiple patches were implemented.
<br/>
<br/>
-RAM disks. The driver creates a filesystem in slot-2 RAM and reads/writes to it. Maybe even in a malloc()'d buffer, of course then some apps would run out of memory, but others would be fine.
<br/>
<br/>
-Multiple patches would allow you to support multiple partitions on a card, or perhaps mount a filesystem image on the card. (fat0:/ is the card itself, fat1:/ is an image file.)
<br/>
<br/>
-A driver allowing read-only access to a filesystem appended to the .nds file itself. This would let you test in any emulator, or by WMB without a working flash card if your DS is flashed. With multiple patches, perhaps it could be made writeable too by finding the file on the card and writing to it.
<br/>
<br/>
I might just try that last one, since it's the only way I can use homebrew that uses the filesystem until I get a new flash card. &gt;_&gt; Aside from the obvious advantage to developers, I can see a few uses of this for users too: using DSOrganize without a flash card (a few KB should hold the required INI files and a playlist for a streaming radio station or some NSFs), or packing all of an app's required files into the app itself without having to change its code (no more clutter in the root directory!).<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145167 - tepples - Mon Nov 12, 2007 2:35 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">I had some interesting ideas of things you could do with DLDI, especially if multiple patches were implemented.
<br/>
<br/>
-RAM disks. The driver creates a filesystem in slot-2 RAM</td> </tr></table><span class="postbody">
<br/>
Extending FCSR to act as a RAM disk has already been <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=14042" target="_blank">discussed</a>. Consensus was that a separate file system for the RAM disk would be a better idea.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">-A driver allowing read-only access to a filesystem appended to the .nds file itself. This would let you test in any emulator, or by WMB without a working flash card if your DS is flashed.</td> </tr></table><span class="postbody">
<br/>
As far as I can tell, DS Download Play does not use appended data. You'd have to append the files to the ARM9 segment and then run ndstool again.
<br/>
<br/>
If a program is designed for use with FlashMe+wmb, it should probably pull configuration data such as a playlist over the network. Official games do this with Ni-Fi; homebrew could do it with CIFS or HTTP.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"> With multiple patches, perhaps it could be made writeable too by finding the file on the card and writing to it.</td> </tr></table><span class="postbody">
<br/>
Are you looking for <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=13195" target="_blank">EFS</a>?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145169 - Lazy1 - Mon Nov 12, 2007 2:50 am</h4>
    <div class="postbody"><span class="postbody">That just reminded me, for some reason FCSR is allowing files to be opened in write mode.
<br/>
I had this weird bug where under no$gba the screen would mess up and lock everything after high scores were displayed.
<br/>
<br/>
What was happening was it was trying to save the high scores to a file and sort-of succeeding.
<br/>
Normally I would expect fopen to fail for a read-only filesystem but for some reason it was allowed and messed up no$gba good.
<br/>
<br/>
I spent hours looking for this bug before trying hardware and finding out that an exception was raised during the highscore save.
<br/>
<br/>
Moral of the story: FCSR allows writes when it shouldn't, exceptions don't work under no$gba.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145170 - tepples - Mon Nov 12, 2007 2:54 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lazy1 wrote:</b></span></td> </tr> <tr> <td class="quote">That just reminded me, for some reason FCSR is allowing files to be opened in write mode.</td> </tr></table><span class="postbody">
<br/>
Are the modified sectors going to GBA SRAM?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145171 - Lazy1 - Mon Nov 12, 2007 3:00 am</h4>
    <div class="postbody"><span class="postbody">I'm not sure, I thought that the image needed to be set up a certain way to support SRAM overlays.
<br/>
I just wanted a read-only filesystem so I left that alone.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145174 - HyperHacker - Mon Nov 12, 2007 4:55 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Extending FCSR to act as a RAM disk has already been <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=14042" target="_blank">discussed</a>. Consensus was that a separate file system for the RAM disk would be a better idea.</td> </tr></table><span class="postbody">Right, this wouldn't be related to FCSR, this would be FAT16/32 in RAM.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">As far as I can tell, DS Download Play does not use appended data. You'd have to append the files to the ARM9 segment and then run ndstool again.</td> </tr></table><span class="postbody">Good to know. Thanks. Just tacking stuff on to the end of the ARM9 binary like that won't break anything will it?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">If a program is designed for use with FlashMe+wmb, it should probably pull configuration data such as a playlist over the network. Official games do this with Ni-Fi; homebrew could do it with CIFS or HTTP.</td> </tr></table><span class="postbody">Certainly a good idea, but I'm thinking more along the lines of programs that <span style="font-style: italic">aren't</span> designed for it. (That is, I'd rather use DSO than write an entire streaming music player of my own without access to hardware. :-p)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Are you looking for <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=13195" target="_blank">EFS</a>?</td> </tr></table><span class="postbody">Hm, I didn't know you could use actual FAT with that. Interesting. Still, if it can be done in a DLDI driver, you wouldn't need to modify the program at all.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145560 - chishm - Sun Nov 18, 2007 3:30 am</h4>
    <div class="postbody"><span class="postbody">As you might (not) have noticed, I've been busy tinkering away with libfat to add a few requested features. 
<br/>
<br/>
First up is Unicode support. libfat now supports UTF-8 encoded file names for both directory listing and opening files. Only the basic multilingual plane is supported. This is a limitation of VFAT, since it uses UCS-2 encoding of long file names. You will need multibyte string support in devkitARM for it to work, so you'll have to wait until r22 for this feature. For r21 it will behave the same as previous versions of libfat.
<br/>
<br/>
Next is a minor bug fix. Files opened for writing will only have a cluster allocated when data is written, rather than when the file is opened. This should keep Windows happy.
<br/>
<br/>
Finally there is a complete overhaul of the disc I/O. There are no longer any built-in drivers. Instead, there is a single space for a DLDI patch. Other drivers are loaded from disc at run-time, making them truly dynamic. The regular fatInit(u32 cacheSize, bool setAsDefaultDevice) and fatInitDefault() functions are there. The majority of applications and games will use these as they always have. 
<br/>
<br/>
For applications that use more than one disc at a time, there is the fatLoadExtraInterfaces (u32 cacheSize, u32 lastPartition) function. Start libfat like usual, then call fatLoadExtraInterfaces. This will load all DLDI files from fat0:/DS/config/DLDI/disc?.dldi where ? is a number from 0 to lastPartition. The files will be patched, then the discs initialised. The number of successfully initialised discs is returned. disc0.dldi will replace the built in driver, so you can load apps from one device and have them load their remaining files from another. 
<br/>
<br/>
fat0: is the only disc guaranteed to be available. fat1: and above are only loaded at run-time, and don't correspond to any particular slot. It is possible, through fatGetInterface (u32 partitionNumber), to get the DLDI used by a disc, then retrieve the desired information, including the DLDI's friendly name.
<br/>
<br/>
The disc I/O changes have not been committed to the devkitPro repository yet. I want to let people try the modified libfat out first and give feedback before I force this change on everyone.
<br/>
<br/>
The latest compiled version is <a class="postlink" href="http://chishm.drunkencoders.com/libfat/libfat-nds-20071118.zip" target="_blank">libfat-nds-20071118.zip</a>. Download it then extract libfat.a to your libnds/lib directory and extract fat.h to your libnds/include directory. Backup the original files before you overwrite them.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145570 - tepples - Sun Nov 18, 2007 5:29 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote">First up is Unicode support. libfat now supports UTF-8 encoded file names for both directory listing and opening files.</td> </tr></table><span class="postbody">
<br/>
Good job :-)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">For applications that use more than one disc at a time, there is the fatLoadExtraInterfaces (u32 cacheSize, u32 lastPartition) function. Start libfat like usual, then call fatLoadExtraInterfaces. This will load all DLDI files from fat0:/DS/config/DLDI/disc?.dldi</td> </tr></table><span class="postbody">
<br/>
In Windows terms, that would be something like J:\DS\config\DLDI\disc0.dldi through ...\disc9.dldi right? But why use /DS/config/ and not the /data/ folder that some other DS homebrew seems to use?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">It is possible, through fatGetInterface (u32 partitionNumber), to get the DLDI used by a disc, then retrieve the desired information, including the DLDI's friendly name.</td> </tr></table><span class="postbody">
<br/>
Including FEATURE_SLOT_NDS vs. FEATURE_SLOT_GBA.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145571 - Dwedit - Sun Nov 18, 2007 5:47 am</h4>
    <div class="postbody"><span class="postbody">Where are you hearing that VFAT is UCS-2 only?  As far as I know, Windows XP treats VFAT filenames as full UTF-16.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145572 - chishm - Sun Nov 18, 2007 6:14 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">In Windows terms, that would be something like J:\DS\config\DLDI\disc0.dldi through ...\disc9.dldi right? But why use /DS/config/ and not the /data/ folder that some other DS homebrew seems to use?</td> </tr></table><span class="postbody">
<br/>
Honestly, I had to come up with a directory that could be shared by all DS apps, and I like the idea of having DS stuff separate from, say, photos taken by a digital camera (/DCIM/). /DS/ seems the logical choice, just as /PSP/ is used by Sony for their handheld. 
<br/>
<br/>
This is one thing I wasn't sure everyone would like, so the path may be changed if there is a consensus on a different one.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Including FEATURE_SLOT_NDS vs. FEATURE_SLOT_GBA.</td> </tr></table><span class="postbody">
<br/>
Yes, those are all defined in the fat.h header, but they use FAT_* or DLDI_* to distinguish them from client code defines.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dwedit wrote:</b></span></td> </tr> <tr> <td class="quote">Where are you hearing that VFAT is UCS-2 only?  As far as I know, Windows XP treats VFAT filenames as full UTF-16.</td> </tr></table><span class="postbody">
<br/>
Windows 2000 and above use UTF-16 internally, versions before (Windows 95, 98, ME, previous versions of NT) use UCS-2. Microsoft only ever specify UNICODE in the official FAT white paper (fatgen103.doc), and the actual type depends on the OS. So yes, VFAT can be UTF-16, but not everything supports it, and it's not a requirement.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145577 - Quirky - Sun Nov 18, 2007 12:25 pm</h4>
    <div class="postbody"><span class="postbody">Nice work! I had noticed that there were changes going on...
<br/>
<br/>
A small request: Any chance of tagging the devkitpro CVS repository so we know what is in this release, and can see when new stuff is added afterwards?
<br/>
<br/>
e.g. <a class="postlink" href="http://devkitpro.cvs.sourceforge.net/devkitpro/libfat/source/fatfile.c?sortby=date&amp;view=log" target="_blank">fatfile.c log</a> has CVS Tags: libfat-20070127 at version 1.4. So it'd be nice to see  a tag libfat-20071118 for the current release. Tags are one area where CVS is better than SVN, so may as well use 'em.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145608 - HyperHacker - Mon Nov 19, 2007 12:21 am</h4>
    <div class="postbody"><span class="postbody">My vote is with /data just because it's common already. Also, this sounds great. Unicode support is quite a bonus.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145619 - chishm - Mon Nov 19, 2007 4:35 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quirky wrote:</b></span></td> </tr> <tr> <td class="quote">Nice work! I had noticed that there were changes going on...
<br/>
<br/>
A small request: Any chance of tagging the devkitpro CVS repository so we know what is in this release, and can see when new stuff is added afterwards?
<br/>
<br/>
e.g. <a class="postlink" href="http://devkitpro.cvs.sourceforge.net/devkitpro/libfat/source/fatfile.c?sortby=date&amp;view=log" target="_blank">fatfile.c log</a> has CVS Tags: libfat-20070127 at version 1.4. So it'd be nice to see  a tag libfat-20071118 for the current release. Tags are one area where CVS is better than SVN, so may as well use 'em.</td> </tr></table><span class="postbody">
<br/>
This is an unofficial test release. None of the disc code has been committed to CVS yet, hence it's not possible to tag it.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145641 - Quirky - Mon Nov 19, 2007 8:30 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote">The disc I/O changes have not been committed to the devkitPro repository yet.</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote">This is an unofficial test release. None of the disc code has been committed to CVS yet, hence it's not possible to tag it.</td> </tr></table><span class="postbody">
<br/>
<br/>
Fair enough, I didn't read all of your post - I got all excited after the first few paragraphs and skipped to the "post" button :-)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145986 - tepples - Tue Nov 27, 2007 4:41 am</h4>
    <div class="postbody"><span class="postbody">Today I ran devkitPro Updater to make sure I had the latest release (not pre-release) of devkitARM, libnds, and libfat. Then I made the following program to test whether libfat creates 8.3 character file names with the correct case. See "Instructions" at the bottom for more info.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">/*
<br/>
upper/lowercase tester for Chishm's libfat
<br/>
Copyright (c) 2007 Damian Yerrick
<br/>
<br/>
Permission is hereby granted, free of charge, to any person
<br/>
obtaining a copy of this software and associated documentation
<br/>
files (the "Software"), to deal in the Software without
<br/>
restriction, including without limitation the rights to use,
<br/>
copy, modify, merge, publish, distribute, sublicense, and/or sell
<br/>
copies of the Software, and to permit persons to whom the
<br/>
Software is furnished to do so, subject to the following
<br/>
conditions:
<br/>
<br/>
The above copyright notice and this permission notice shall be
<br/>
included in all copies or substantial portions of the Software.
<br/>
<br/>
THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
<br/>
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
<br/>
OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
<br/>
NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
<br/>
HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
<br/>
WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
<br/>
FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
<br/>
OTHER DEALINGS IN THE SOFTWARE.
<br/>
<br/>
based on devkitARM R21 libnds examples: arm9 template
<br/>
by dovoto and wintermute
<br/>
<br/>
*/
<br/>
<br/>
#include &lt;nds.h&gt;
<br/>
#include &lt;stdio.h&gt;
<br/>
#include &lt;stdlib.h&gt;
<br/>
#include &lt;string.h&gt;
<br/>
#include &lt;unistd.h&gt;
<br/>
#include &lt;fat.h&gt;
<br/>
#include &lt;sys/stat.h&gt;
<br/>
#include &lt;sys/syslimits.h&gt;
<br/>
#include &lt;sys/dir.h&gt;
<br/>
#include &lt;errno.h&gt;
<br/>
<br/>
// init DS video hardware: taken directly from template
<br/>
void dsInit(void) {
<br/>
   irqInit();
<br/>
   irqEnable(IRQ_VBLANK);
<br/>
<br/>
   videoSetMode(0);   //not using the main screen
<br/>
   videoSetModeSub(MODE_0_2D | DISPLAY_BG0_ACTIVE);   //sub bg 0 will be used to print text
<br/>
   vramSetBankC(VRAM_C_SUB_BG);
<br/>
<br/>
   SUB_BG0_CR = BG_MAP_BASE(31);
<br/>
<br/>
   BG_PALETTE_SUB[255] = RGB15(31,31,31);   //by default font will be rendered with color 255
<br/>
<br/>
   //consoleInit() is a lot more flexible but this gets you up and running quick
<br/>
   consoleInitDefault((u16*)SCREEN_BASE_BLOCK_SUB(31), (u16*)CHAR_BASE_BLOCK_SUB(0), 16);
<br/>
}
<br/>
<br/>
void press_A(void) {
<br/>
  fflush(stdout);
<br/>
  while (REG_KEYINPUT &amp; KEY_A) {
<br/>
    swiWaitForVBlank();
<br/>
  }
<br/>
  while (!(REG_KEYINPUT &amp; KEY_A)) {
<br/>
    swiWaitForVBlank();
<br/>
  }
<br/>
}
<br/>
<br/>
/**
<br/>
 * Ensures that a folders from root up to a file exist.
<br/>
 * Path separator is /.
<br/>
 * If the folders do not exist, they are created.
<br/>
 * @param filename the name of the file
<br/>
 * @param mode as for mkdir(path, mode)
<br/>
 * @return 0 for success or &lt;0 for failure
<br/>
 */
<br/>
int makedirs(const char *filename, mode_t mode) {
<br/>
  const char *curSlash = filename + 1;
<br/>
<br/>
  for (curSlash = strchr(curSlash, '/');
<br/>
       curSlash != 0;
<br/>
       curSlash = strchr(curSlash, '/')) {
<br/>
    char seg[PATH_MAX];
<br/>
<br/>
    // compute the length of this path segment
<br/>
    int segLen = curSlash - filename;
<br/>
    
<br/>
    // check length of buffer
<br/>
    if (segLen &gt; sizeof(seg) - 1) {
<br/>
      errno = ENAMETOOLONG;
<br/>
      return -1;
<br/>
    }
<br/>
<br/>
    memcpy(seg, filename, segLen);
<br/>
    seg[segLen] = 0;
<br/>
    if (mkdir(seg, mode) &lt; 0) {
<br/>
      switch (errno) {
<br/>
      case ENOTDIR:
<br/>
        return -1;
<br/>
      case EEXIST:
<br/>
        // this is normal
<br/>
        break;
<br/>
      default:
<br/>
        return -1;
<br/>
      }
<br/>
    } else {
<br/>
    }
<br/>
    
<br/>
    // skip slash
<br/>
    curSlash += 1;
<br/>
  }
<br/>
  return 0;
<br/>
}
<br/>
<br/>
void makeHelloFile(const char *filename) {
<br/>
  FILE *fp = fopen(filename, "wt");
<br/>
<br/>
  if (fp) {
<br/>
    fputs("hello world\n", fp);
<br/>
    fclose(fp);
<br/>
  } else {
<br/>
    fputs("could not write to ", stderr);
<br/>
    perror(filename);
<br/>
  }
<br/>
}
<br/>
<br/>
void ls(const char *path) {
<br/>
  struct stat st;
<br/>
  char filename[PATH_MAX];
<br/>
  DIR_ITER *dir = diropen(path); 
<br/>
<br/>
  if (dir == NULL) {
<br/>
    fputs("Unable to open the directory.\n", stderr);
<br/>
    return;
<br/>
  }
<br/>
  while (dirnext(dir, filename, &amp;st) == 0) {
<br/>
    fputs(filename, stdout);
<br/>
    // if it's a folder, write a trailing slash
<br/>
    if (st.st_mode &amp; S_IFDIR) {
<br/>
      fputc('/', stdout);
<br/>
    }
<br/>
    fputc('\n', stdout);
<br/>
  }
<br/>
}
<br/>
<br/>
void ls_break(void) {
<br/>
  fputs("press A to list disk", stdout);
<br/>
  press_A();
<br/>
  fputs("\033[2J", stdout);
<br/>
  ls("/data/hello/");
<br/>
  press_A();
<br/>
  fputs("\033[2J", stdout);
<br/>
}
<br/>
<br/>
__attribute__((noreturn))
<br/>
void die(const char *str) {
<br/>
  fputs(str, stderr);
<br/>
  fputs("\nSystem halted.\n", stderr);
<br/>
  while (1) { swiWaitForVBlank(); }
<br/>
}
<br/>
<br/>
int main(void) {
<br/>
  touchPosition touchXY;
<br/>
<br/>
  dsInit();
<br/>
  fputs("libfat test suite\n"
<br/>
        "Copr. 2007 Damian Yerrick\n", stdout);
<br/>
  if (!fatInitDefault()) {
<br/>
    die("libfat init failed.\n"
<br/>
        "Did you use the right DLDI?\n"
<br/>
        "http://dldi.drunkencoders.com/");
<br/>
  }
<br/>
  if (makedirs("/data/hello/",
<br/>
               S_IRWXU | S_IRWXG | S_IROTH | S_IXOTH) &lt; 0) {
<br/>
    die("Could not make /data/hello/");
<br/>
  }
<br/>
  ls_break();
<br/>
  fputs("Making four files with 8.3\n"
<br/>
        "character names, only one of\n"
<br/>
        "which should be all caps\n", stdout);
<br/>
  makeHelloFile("/data/hello/lowupper.TXT");
<br/>
  makeHelloFile("/data/hello/lowlower.txt");
<br/>
  makeHelloFile("/data/hello/UPPUPPER.TXT");
<br/>
  makeHelloFile("/data/hello/UPPLOWER.txt");
<br/>
  ls_break();
<br/>
  fputs("C:\\&gt;", stdout);
<br/>
  
<br/>
  // we're done; close the program
<br/>
  while(1) {
<br/>
    press_A();
<br/>
    fputc('A', stdout);
<br/>
    fflush(stdout);
<br/>
  }
<br/>
<br/>
  return 0;
<br/>
}
<br/>
<br/>
/* Instructions:
<br/>
<br/>
 1. Make a copy of the folder
<br/>
     .../devkitPro/examples/nds/templates/arm9
<br/>
 2. Replace the 'main.c' file in the copy with this file.
<br/>
 3. Build the project with latest devkitARM, libnds, and libfat.
<br/>
 4. Patch the .nds with DLDI if needed.
<br/>
 5. Run the program on your DS.
<br/>
 6. Look at the /data/hello/ folder on the card in Windows Explorer.
<br/>
<br/>
Expected result:
<br/>
The second time "list disk" happens, the names are mixed case:
<br/>
lowupper.TXT, lowlower.txt, UPPUPPER.TXT, and UPPLOWER.txt
<br/>
In Windows Explorer, "hello" is lowercase, and the names of the files
<br/>
inside it are mixed case as well.
<br/>
<br/>
Actual result:
<br/>
The second time "list disk" happens, the names are uppercase:
<br/>
LOWUPPER.TXT, LOWLOWER.TXT, UPPUPPER.TXT, and UPPLOWER.TXT
<br/>
In Windows Explorer, "HELLO" is uppercase, and the names of the files
<br/>
inside it are uppercase as well.
<br/>
<br/>
*/
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
<span style="font-weight: bold">EDIT:</span> Chishm told me on IRC that this is fixed in CVS.
<br/>
<br/>
<span style="font-weight: bold">EDIT 2:</span> I installed the pre-release from last page (as fat-pre.h and libfat-pre.a), and it worked as expected.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146305 - Peter - Sun Dec 02, 2007 1:38 pm</h4>
    <div class="postbody"><span class="postbody">I wonder if the time to access/read files from flash-cards differ much.
<br/>
<br/>
I ask because I would like to sync music/soundeffects/visualeffecs in my current project, but need to load data from flash-card from time to time. When I trial&amp;error until it's correct with my card (DL Linker 16G), I guess other cards might need longer or less time to read x bytes and so it would be out of sync again.
<br/>
<br/>
Maybe there exists a listing that gives information how much time xyz flash-cards need to load x bytes or something like this? :)<br/>_________________<br/>Kind Regards,
<br/>
Peter</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146331 - tepples - Sun Dec 02, 2007 10:08 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Peter wrote:</b></span></td> </tr> <tr> <td class="quote">I wonder if the time to access/read files from flash-cards differ much.</td> </tr></table><span class="postbody">
<br/>
They do. <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?p=136796#136796" target="_blank">My benchmark program</a> shows that the R4 is generally eight times as fast as the Games n' Music. But it also depends on what brand of CF, SD, miniSD, or microSD card you have.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Maybe there exists a listing that gives information how much time xyz flash-cards need to load x bytes or something like this? :)</td> </tr></table><span class="postbody">
<br/>
Given the number of brands of adapters times the number of different memory cards, I'm not sure that such a list maintained by amateurs could ever be comprehensive.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#148600 - Dwedit - Mon Jan 07, 2008 8:23 pm</h4>
    <div class="postbody"><span class="postbody">One of the things I miss from GBA_NDS_FAT is the ability to change directory, and use relative paths.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#148616 - wintermute - Mon Jan 07, 2008 10:32 pm</h4>
    <div class="postbody"><span class="postbody">chdir works fine, haven't tried relative paths recently but I don't see why they wouldn't work.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#148625 - tepples - Tue Jan 08, 2008 12:40 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">chdir works fine, haven't tried relative paths recently but I don't see why they wouldn't work.</td> </tr></table><span class="postbody">
<br/>
They do work. <a class="postlink" href="http://www.pineight.com/dx/RAC" target="_blank">RAC</a> uses libfat. Its file chooser uses chdir() and at least the relative path "..".<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#150671 - nipil - Sun Feb 10, 2008 12:28 pm</h4>
    <div class="postbody"><span class="postbody">The purpose of this post is to bring a small point to the attention : when using the <span style="font-weight: bold">dirnext</span> function, <span style="font-style: italic">you have no clue on which length the filename buffer should be</span>. When searching, you find a hint in CVS / fatdir.c / line 560, where it should be MAX_FILENAME_LENGTH. You learn in CVS / directory.h / line 046 that it equals 768 (due to UTF-8 encoding possibilities). I know <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?p=56930#56930" target="_blank">it has already been discussed here</a>, but at that time, it was limited to 256 chars. Now it's still "256 chars", but expands to 768 bytes because of possible UTF-8 encoding , so it's quite misleading to llib's users (imho).
<br/>
<br/>
My thought is, there should be a define somewhere in the library (user side, not only in its source), so we can malloc and use the right buffer size. Maybe there are other functions in the lib which are using a buffer as output, so the same "problem" might apply.
<br/>
<br/>
Just my 2 cents.<br/>_________________<br/>NDS Lite Gold/Silver, MK5/R4DS, MSI PC54G2, D-Link DI-624</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151678 - HyperHacker - Mon Mar 03, 2008 4:46 am</h4>
    <div class="postbody"><span class="postbody">I can't get either of the Games'n'Music DLDIs to initialize in my apps, while other programs work fine. I made a barebones <a class="postlink" href="http://hyperhacker.no-ip.org/b/gmtest.zip" target="_blank">test case</a> and sure enough it's not working either, with any boot method. (It just turns one screen red and calls fatInitDefault() in a loop. If it succeeds the screen turns green. ARM7 does absolutely nothing.) In my app it worked precisely once and I was able to navigate the filesystem, then I powered off and on again and it went back to not working. Most other homebrew I've tried works every time, from the latest DSOrganize to the DLDI build of TxtWriter and many other apps released ages ago.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151872 - HyperHacker - Thu Mar 06, 2008 7:03 am</h4>
    <div class="postbody"><span class="postbody">Tested this some more today. The app itself works if launched from DSOrganize but not if launched as bootme.nds or through WMB.The test program still doesn't work in any scenario. (With WMB, you have to boot up without the card inserted, stick it in once the app is loaded, and have it wait for a button to be pressed before trying to init, because it has that damn auto-boot flag, and putting it in at the firmware menu locks up the system. I suspected maybe the card has to be initialized with the encryption and so on before it can be used, but this app is actually capable of doing that itself - booting DS cards is one of its functions - and that doesn't help.)
<br/>
<br/>
The only thing I can think of that makes this app different from others is that it loads the ARM9 binary to 0x02260000. However, the test program doesn't do this, and it has the same problem, so I doubt that's related.
<br/>
<br/>
I remember hearing older versions of DSOrganize worked only if they were launched as bootme.nds. Any idea what was changed to fix that?<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152073 - HyperHacker - Sun Mar 09, 2008 7:50 am</h4>
    <div class="postbody"><span class="postbody">OK, it's working for the most part now (but the test program still isn't), but calling stat() breaks everything. The call itself only succeeds if the file is in the root directory, else it returns -1. Afterward, any directory listing returns the contents followed by the 8.3 filename of the last file repeated endlessly.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152220 - HyperHacker - Wed Mar 12, 2008 3:04 am</h4>
    <div class="postbody"><span class="postbody">Tried another MicroSD, same result. Test program doesn't work at all. My app usually - not always - initializes (as in fatInitDefault()) fine, though it sometimes takes several seconds, and reads files from various directories without a problem. Reading anything from /Apps is unreliable. Any given file will sometimes read fine, other times not read (haven't checked just what fails, but it just locks up reading the file), and most of the time stat() will just return -1 (occasionally taking several seconds to do so). Other apps seem to work fine, but also sometimes fail to init or take several seconds. errno.h doesn't even define a return value of -1, so I don't know what that's supposed to mean.
<br/>
<br/>
Both cards have been formatted repeatedly with FAT32. One is the 128MB that came with the G&amp;M and the other is a 2GB Kingston.
<br/>
<br/>
This is the directory listing for the 128MB card:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">J:\AUDIO
<br/>
J:\GAMES
<br/>
J:\VIDEO
<br/>
J:\_bootme.nds
<br/>
J:\SNEmulDS.nds
<br/>
J:\TI85.tisv
<br/>
J:\TIDS.CFG
<br/>
J:\data
<br/>
J:\gmtest.nds
<br/>
J:\Apps
<br/>
J:\bootme.nds
<br/>
J:\bootmenu2.nds
<br/>
J:\DualSlotBrowser.nds
<br/>
J:\lameboy.nds
<br/>
J:\Moonshell.nds
<br/>
J:\nesDS.nds
<br/>
J:\snemul.cfg
<br/>
J:\ti85.rom
<br/>
J:\GAMES\AquelaBall.nds
<br/>
J:\GAMES\bahlz.nds
<br/>
J:\GAMES\battleship.nds
<br/>
J:\GAMES\breakout.nds
<br/>
J:\GAMES\Bubbles.nds
<br/>
J:\GAMES\CarreRouge.nds
<br/>
J:\GAMES\ChainReaction.nds
<br/>
J:\GAMES\collection.nds
<br/>
J:\GAMES\diggerds.nds
<br/>
J:\GAMES\DoubleSkill.nds
<br/>
J:\GAMES\DSChess.nds
<br/>
J:\GAMES\HexaVirus.nds
<br/>
J:\GAMES\invasion.nds
<br/>
J:\GAMES\JoggleDS.nds
<br/>
J:\GAMES\London-Underground.nds
<br/>
J:\GAMES\Number_Minds.nds
<br/>
J:\GAMES\PaddleBattleDS.nds
<br/>
J:\GAMES\PopTheBalls.nds
<br/>
J:\GAMES\solitaire_ds.nds
<br/>
J:\GAMES\squashds.nds
<br/>
J:\GAMES\SuperSnakeDS.nds
<br/>
J:\GAMES\TalesOfDagur.nds
<br/>
J:\GAMES\TetrisAndTouch.nds
<br/>
J:\GAMES\tictactoe.nds
<br/>
J:\GAMES\warrior_training.nds
<br/>
J:\GAMES\Zi.nds
<br/>
J:\VIDEO\shrek_3.d3v
<br/>
J:\data\bootmenu
<br/>
J:\data\DSOrganize
<br/>
J:\data\bootmenu\config.ini
<br/>
J:\data\bootmenu\vortex.bmp
<br/>
J:\data\bootmenu\coolpurple.bmp
<br/>
J:\data\bootmenu\snowboard.bmp
<br/>
J:\data\bootmenu\vortexhighlight.bmp
<br/>
J:\data\bootmenu\rena.bmp
<br/>
J:\data\bootmenu\kite.bmp
<br/>
J:\data\bootmenu\kitedark.bmp
<br/>
J:\data\DSOrganize\autoperform.txt
<br/>
J:\data\DSOrganize\colors.ini.sample
<br/>
J:\data\DSOrganize\CONFIG.INI
<br/>
J:\data\DSOrganize\favorites.txt
<br/>
J:\data\DSOrganize\IRC.INI
<br/>
J:\data\DSOrganize\notify.wav
<br/>
J:\data\DSOrganize\searchprefs.txt
<br/>
J:\data\DSOrganize\specialkeys.txt
<br/>
J:\data\DSOrganize\startup.wav
<br/>
J:\data\DSOrganize\wifi.dat
<br/>
J:\data\DSOrganize\genre.dat
<br/>
J:\data\DSOrganize\sound.dat
<br/>
J:\data\DSOrganize\Cache
<br/>
J:\data\DSOrganize\VCARD
<br/>
J:\data\DSOrganize\TODO
<br/>
J:\data\DSOrganize\SCRIBBLE
<br/>
J:\data\DSOrganize\RESOURCES
<br/>
J:\data\DSOrganize\REMINDER
<br/>
J:\data\DSOrganize\PLUGINS
<br/>
J:\data\DSOrganize\LANG
<br/>
J:\data\DSOrganize\ICONS
<br/>
J:\data\DSOrganize\HOME
<br/>
J:\data\DSOrganize\HELP
<br/>
J:\data\DSOrganize\DAY
<br/>
J:\data\DSOrganize\COOKIES
<br/>
J:\data\DSOrganize\RESOURCES\resource0.bin
<br/>
J:\data\DSOrganize\RESOURCES\exec_stub.bin
<br/>
J:\data\DSOrganize\RESOURCES\load.bin
<br/>
J:\data\DSOrganize\LANG\Sample.lng
<br/>
J:\data\DSOrganize\ICONS\readme.txt
<br/>
J:\data\DSOrganize\HOME\readme.txt
<br/>
J:\data\DSOrganize\HOME\lmp.dss
<br/>
J:\data\DSOrganize\HOME\bunjalloo.dss
<br/>
J:\data\DSOrganize\HOME\firmware.dss
<br/>
J:\data\DSOrganize\HOME\jds.dss
<br/>
J:\data\DSOrganize\HELP\english
<br/>
J:\data\DSOrganize\HELP\english\address.html
<br/>
J:\data\DSOrganize\HELP\english\browser.html
<br/>
J:\data\DSOrganize\HELP\english\calculator.html
<br/>
J:\data\DSOrganize\HELP\english\calendar.html
<br/>
J:\data\DSOrganize\HELP\english\color.html
<br/>
J:\data\DSOrganize\HELP\english\configuration.html
<br/>
J:\data\DSOrganize\HELP\english\dayplanner.html
<br/>
J:\data\DSOrganize\HELP\english\db.html
<br/>
J:\data\DSOrganize\HELP\english\edit.html
<br/>
J:\data\DSOrganize\HELP\english\editaddress.html
<br/>
J:\data\DSOrganize\HELP\english\editscribble.html
<br/>
J:\data\DSOrganize\HELP\english\edittodo.html
<br/>
J:\data\DSOrganize\HELP\english\home.html
<br/>
J:\data\DSOrganize\HELP\english\irc.html
<br/>
J:\data\DSOrganize\HELP\english\pictureviewer.html
<br/>
J:\data\DSOrganize\HELP\english\recorder.html
<br/>
J:\data\DSOrganize\HELP\english\renaming.html
<br/>
J:\data\DSOrganize\HELP\english\scribble.html
<br/>
J:\data\DSOrganize\HELP\english\sound.html
<br/>
J:\data\DSOrganize\HELP\english\texteditor.html
<br/>
J:\data\DSOrganize\HELP\english\todo.html
<br/>
J:\data\DSOrganize\HELP\english\viewer.html
<br/>
J:\data\DSOrganize\HELP\english\webbrowser.html
<br/>
J:\data\DSOrganize\HELP\english\config
<br/>
J:\data\DSOrganize\HELP\english\config\altboot.txt
<br/>
J:\data\DSOrganize\HELP\english\config\autoconnect.txt
<br/>
J:\data\DSOrganize\HELP\english\config\autohide.txt
<br/>
J:\data\DSOrganize\HELP\english\config\bullets.txt
<br/>
J:\data\DSOrganize\HELP\english\config\date.txt
<br/>
J:\data\DSOrganize\HELP\english\config\dhcp.txt
<br/>
J:\data\DSOrganize\HELP\english\config\dns.txt
<br/>
J:\data\DSOrganize\HELP\english\config\fixededitor.txt
<br/>
J:\data\DSOrganize\HELP\english\config\fixedip.txt
<br/>
J:\data\DSOrganize\HELP\english\config\gateway.txt
<br/>
J:\data\DSOrganize\HELP\english\config\homescreen.txt
<br/>
J:\data\DSOrganize\HELP\english\config\htmlmode.txt
<br/>
J:\data\DSOrganize\HELP\english\config\iconset.txt
<br/>
J:\data\DSOrganize\HELP\english\config\imageorientation.txt
<br/>
J:\data\DSOrganize\HELP\english\config\ircfixed.txt
<br/>
J:\data\DSOrganize\HELP\english\config\keysound.txt
<br/>
J:\data\DSOrganize\HELP\english\config\language.txt
<br/>
J:\data\DSOrganize\HELP\english\config\lefthanded.txt
<br/>
J:\data\DSOrganize\HELP\english\config\name.txt
<br/>
J:\data\DSOrganize\HELP\english\config\normalboot.txt
<br/>
J:\data\DSOrganize\HELP\english\config\primarydns.txt
<br/>
J:\data\DSOrganize\HELP\english\config\save.txt
<br/>
J:\data\DSOrganize\HELP\english\config\secondarydns.txt
<br/>
J:\data\DSOrganize\HELP\english\config\secondclick.txt
<br/>
J:\data\DSOrganize\HELP\english\config\showhidden.txt
<br/>
J:\data\DSOrganize\HELP\english\config\ssid.txt
<br/>
J:\data\DSOrganize\HELP\english\config\ssidsearch.txt
<br/>
J:\data\DSOrganize\HELP\english\config\start.txt
<br/>
J:\data\DSOrganize\HELP\english\config\subnet.txt
<br/>
J:\data\DSOrganize\HELP\english\config\swapab.txt
<br/>
J:\data\DSOrganize\HELP\english\config\time.txt
<br/>
J:\data\DSOrganize\HELP\english\config\wep.txt
<br/>
J:\data\DSOrganize\HELP\english\config\wifi.txt
<br/>
J:\Apps\AireplayNDS_EB.nds
<br/>
J:\Apps\consoledemo.nds
<br/>
J:\Apps\DS2Key.nds
<br/>
J:\Apps\DSAIM.nds
<br/>
J:\Apps\dsbasic.nds
<br/>
J:\Apps\dslinux.nds
<br/>
J:\Apps\flashme.nds
<br/>
J:\Apps\memviewer.nds
<br/>
J:\Apps\motiontest.nds
<br/>
J:\Apps\TxtWriter.nds
<br/>
J:\Apps\wifi_VoiceChatClient14.nds
<br/>
J:\Apps\firmware.nds
<br/>
J:\Apps\DSLiveWeather.nds
<br/>
J:\Apps\lmp-ng-1.02.nds
<br/>
J:\Apps\NitroHax.nds
<br/>
J:\Apps\okiwi.nds
<br/>
J:\Apps\firmware2.nds
<br/>
J:\Apps\ds85_r3.nds
<br/>
J:\Apps\lmp-ng-2-alpha.nds
<br/>
J:\Apps\WabbitDS.nds
<br/>
J:\Apps\JDS.nds
<br/>
J:\Apps\bunjalloo.nds
<br/>
</td> </tr></table><span class="postbody">The 2GB one is almost the same; /Apps is a direct copy.
<br/>
<br/>
This app worked just fine with the GBAMP when I had one, and I've sanity-checked all the paths being passed to stat(). /Apps seems to be the only directory causing trouble. It has yet to fail reading several files from /data/bootmenu on startup nor any .nds file in another directory.
<br/>
<br/>
To be more specific:
<br/>
-The test program has never worked. fatInitDefault() always fails. This is what really makes me think something is wrong with the patch (or possibly libNDS), given how ridiculously simple the program is.
<br/>
-The demo that came with Chishm's loader, which loads .nds files, initializes successfully almost every time, but sometimes takes several seconds. It has no trouble reading any file, including those in /Apps.
<br/>
-DSOrganize, LMP-NG 1.02, and the G&amp;M's built-in menu have no problems.
<br/>
-My app initializes successfully almost every time (sometimes taking several seconds), then proceeds to read several files from /data/bootmenu without any problems, but fails almost every time trying to load a file from /Apps.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152733 - Dwedit - Thu Mar 20, 2008 7:27 am</h4>
    <div class="postbody"><span class="postbody">It looks like Loopy backported some bugfixes and other changes into GBA_NDS_FAT when he made NesDS. 
<br/>
Loopy's modified version of gba_nds_fat can be found in the DLDI folder of the NesDS source code, <a href="http://www.cs.utah.edu/~tew/nesDS/" target="_blank">http://www.cs.utah.edu/~tew/nesDS/</a>
<br/>
<br/>
These functions appear to have bugfixes in Loopy's version:
<br/>
u32 FAT_FirstFreeCluster(void)
<br/>
u32 FAT_LinkFreeCluster(u32 cluster)
<br/>
bool FAT_ClearLinks (u32 cluster)
<br/>
bool FAT_AddDirEntry (const char* path, DIR_ENT newDirEntry)
<br/>
<br/>
I suggest you fire up WinMerge, and see if some of Loopy's changes should be placed into the official distribution of GBA_NDS_FAT, or at least tell me which of those fixes is important.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153071 - SnakerDLK - Mon Mar 24, 2008 7:18 pm</h4>
    <div class="postbody"><span class="postbody">hi,
<br/>
when I use ' dirnext' , the function that uses it freezes up when 'exiting'
<br/>
with return or even when the function 'returns' void...
<br/>
( I used it as explained in the example in chisms site about libfat...)
<br/>
( Im using the PAlib beta community release 080203 )
<br/>
<br/>
more specific topic...
<br/>
<a href="http://forum.gbadev.org/viewtopic.php?t=15251" target="_blank">http://forum.gbadev.org/viewtopic.php?t=15251</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153109 - thegamefreak0134 - Tue Mar 25, 2008 1:37 am</h4>
    <div class="postbody"><span class="postbody">I just noticed a bug in this topic. In the main post, there is example code that is supposed to call "fatInitialise". This function has been changed to "fatInit" and the example code no longer compiles. (I made that one change and that fixed it.) Thought I'd let you know. ^_^
<br/>
<br/>
-gamefreak<br/>_________________<br/>What if the hokey-pokey really is what it's all about?
<br/>
<br/>
[url=http:/www.darknovagames.com/index.php?action=recruit&amp;clanid=1]Support Zeta on DarkNova![/url]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160232 - ferrand.d - Sat Jul 12, 2008 1:10 pm</h4>
    <div class="postbody"><span class="postbody">Hi everybody !
<br/>
I'm french so please excuse me for my bad english. I'm trying to compile a project which uses libfat, but this is a very old project, so I think many things have changed in two years.
<br/>
<br/>
The error I get is
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">error: 'DIR_ITER' undeclared (first use in this function)
<br/>
error: (Each undeclared identifier is reported only once
<br/>
error: for each function it appears in.)
<br/>
error: 'd' undeclared (first use in this function)</td> </tr></table><span class="postbody">
<br/>
<br/>
And my (simplified) source code is
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include &lt;nds.h&gt;
<br/>
<br/>
#include &lt;fat.h&gt;
<br/>
<br/>
#include &lt;stdio.h&gt;
<br/>
#include &lt;string.h&gt;
<br/>
#include &lt;stdlib.h&gt;
<br/>
<br/>
#include &lt;sys/types.h&gt;
<br/>
#include &lt;sys/stat.h&gt;
<br/>
#include &lt;sys/dir.h&gt;
<br/>
<br/>
// ...
<br/>
<br/>
DIR_ITER* d;</td> </tr></table><span class="postbody">
<br/>
<br/>
Actually, I don't know where does the DIR_ITER come from and even trying to compile the example code given by chishm on his website, I got that error !
<br/>
I think the error comes from the header sys/dir.h, but I didn't really understand the POSIX/non-POSIX point.
<br/>
<br/>
I'm totally lost so please help me !</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#162034 - hacker013 - Sat Aug 23, 2008 7:31 pm</h4>
    <div class="postbody"><span class="postbody">hey,
<br/>
<br/>
My project with the old libfat was 80 kb and with the new one from here (the one wihout the include drivers) is 97 kb, i thought this version was smaller than the previous one or am i wrong??<br/>_________________<br/><a class="postlink" href="http://imetal.nl/" target="_blank">Website / Blog</a>
<br/>
<br/>
Let the nds be with you.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165737 - hacker013 - Mon Jan 05, 2009 6:28 pm</h4>
    <div class="postbody"><span class="postbody">anybody?<br/>_________________<br/><a class="postlink" href="http://imetal.nl/" target="_blank">Website / Blog</a>
<br/>
<br/>
Let the nds be with you.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165743 - Dwedit - Mon Jan 05, 2009 7:15 pm</h4>
    <div class="postbody"><span class="postbody">Look at the map file to see where the size is coming from.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165746 - elhobbs - Mon Jan 05, 2009 7:28 pm</h4>
    <div class="postbody"><span class="postbody">I think the difference can be attributed to the new libnds in general. keep in mind that the default arm7 is a lot bigger as it has wifi and mod support builtin. I am not sure that this effects free main memory though - can anyone confirm?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165747 - hacker013 - Mon Jan 05, 2009 7:29 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>hacker013 wrote:</b></span></td> </tr> <tr> <td class="quote">hey,
<br/>
<br/>
My project with the old libfat was 80 kb and with the new one from here (the one wihout the include drivers) is 97 kb, i thought this version was smaller than the previous one or am i wrong??</td> </tr></table><span class="postbody">
<br/>
<br/>
this was with the old devkitARM 23 and with the new libfat.<br/>_________________<br/><a class="postlink" href="http://imetal.nl/" target="_blank">Website / Blog</a>
<br/>
<br/>
Let the nds be with you.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165764 - chishm - Tue Jan 06, 2009 4:18 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>hacker013 wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>hacker013 wrote:</b></span></td> </tr> <tr> <td class="quote">hey,
<br/>
<br/>
My project with the old libfat was 80 kb and with the new one from here (the one wihout the include drivers) is 97 kb, i thought this version was smaller than the previous one or am i wrong??</td> </tr></table><span class="postbody">
<br/>
<br/>
this was with the old devkitARM 23 and with the new libfat.</span></td> </tr></table><span class="postbody">
<br/>
The newest libfat shouldn't be able to link against devkitARM r23. In any case, the extra size is likely due to the allowances for Unicode (UTF-8 to/from UCS-16 conversion is not free) and other additional features.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#166139 - Tommmie - Sat Jan 31, 2009 10:58 am</h4>
    <div class="postbody"><span class="postbody">chishm, when i try to integrate your dldi loader in my app it doesn't work.
<br/>
is this because of the new libfat or the newest libnds? and if you know why it's not working, could you tell me how to solve it?
<br/>
the error that i'm getting is this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
d:/devkitPro/loader/arm9/source/nds_loader_arm9.c: In function 'runNds':
<br/>
d:/devkitPro/loader/arm9/source/nds_loader_arm9.c:77: warning: likely type-punni
<br/>
ng may break strict-aliasing rules: object '*src16' of main type 'short unsigned
<br/>
 int' is referenced at or around d:/devkitPro/loader/arm9/source/nds_loader_arm9
<br/>
.c:77 and may be aliased to object '_io_dldi' of main type 'unsigned int' which
<br/>
is referenced at or around d:/devkitPro/loader/arm9/source/nds_loader_arm9.c:77.
<br/>
<br/>
linking loader.arm9.elf
<br/>
nds_loader_arm9.o: In function `runNds':
<br/>
d:/devkitPro/loader/arm9/source/nds_loader_arm9.c:248: undefined reference to `_
<br/>
io_dldi'
<br/>
d:/devkitPro/loader/arm9/source/nds_loader_arm9.c:248: undefined reference to `_
<br/>
io_dldi'
<br/>
d:/devkitPro/loader/arm9/source/nds_loader_arm9.c:248: undefined reference to `_
<br/>
io_dldi'
<br/>
d:/devkitPro/loader/arm9/source/nds_loader_arm9.c:248: undefined reference to `_
<br/>
io_dldi'
<br/>
collect2: ld returned 1 exit status
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#166140 - Echo49 - Sat Jan 31, 2009 11:15 am</h4>
    <div class="postbody"><span class="postbody">Did you include the libfat library in your makefile?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#166149 - Tommmie - Sat Jan 31, 2009 5:59 pm</h4>
    <div class="postbody"><span class="postbody">yes i did, but i think it has to be something with the new devkitarm or libnds because it also doesn't compile when i replace libfat with the older one</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#166151 - hacker013 - Sat Jan 31, 2009 6:13 pm</h4>
    <div class="postbody"><span class="postbody">the var _io_dldi doesn't exists anymore with the newest libfat.<br/>_________________<br/><a class="postlink" href="http://imetal.nl/" target="_blank">Website / Blog</a>
<br/>
<br/>
Let the nds be with you.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#166159 - Tommmie - Sat Jan 31, 2009 7:49 pm</h4>
    <div class="postbody"><span class="postbody">so do i have to make this variable or do i have to use another one?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#166168 - chishm - Sun Feb 01, 2009 5:45 am</h4>
    <div class="postbody"><span class="postbody">Check &lt;nds/arm9/dldi.h&gt; for io_dldi_data. There are probably a few other changes that need to be made, but I can't remember. I suppose I should put a new loader release together, but it's just such nice weather outside.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#166169 - Tommmie - Sun Feb 01, 2009 7:12 am</h4>
    <div class="postbody"><span class="postbody">I know, its summer there,  but here in the Netherlands its freezing. but ok i will give your advice a try and it would be great if you update the loader.
<br/>
<br/>
<span style="font-weight: bold">edit</span>
<br/>
<br/>
yeah chishm you were right, no errors after changing _io_dldi but when i tested it i got two white screen and nothing happened</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167677 - renatobs - Sat Mar 21, 2009 11:56 pm</h4>
    <div class="postbody"><span class="postbody">Hi. I?m a brazilian developer ( newby ) and my english is not good but I think that you?ll understand me. I?m developing a remake of the game and I already have a lot of thing of the game finished, but now I need to use LIBFAT to imrpoved my "cart space".
<br/>
I have read a lot about Chishm  FAT but I?m very confused with a lot of things. I have studied the exemples and I could got some ideias. Does not the EFS working in NO$GBA ?! In my real NDS with EZFlashV the most of them are working... Need I to do some special thing to these files working on No$gba ?
<br/>
My main problem now is that I?m putting "mp3" files in my game. I?m using the AS_Lib ( that is so fantastic ) and I can play "mp3" and "sound efeccts" together without problems. These is excelent !!! But now I can?t do more things cuz the cart became almost 4Mb. I need to put the "Mp3" files out of RAM, using the "Mp3 Strem Player". Unfortunaly NODA is out ( I guess ) cuz I can?t a answer from him. Then I?d like a help from someone here, cuz "you are a kind of GOD?s of development in NDS".
<br/>
Well, these are my problems:
<br/>
<br/>
- I need that someone detect what?s happen with "AS_Lib" that it can?t play "MP3 stream" by "FAT", "ESF_FAT" or try change to "Chishm  FAT";
<br/>
<br/>
- In the case that I can?t solve this problem, is there some way to play the MP3 change these in the RAM ? The Direct Play of AS_Lib play a MP3 from RAM, but when I compile the code, the compiler create 2 files from MP3 ( *.o and *.h ), one have the codes of MP3 and other the headers with name and size. How could I change these in the RAM ? Creating a volatile array and put there a mp3 to play ?!?
<br/>
<br/>
- If I have a "image" file converted by "pcx2gba" with a "data" and "pal" arrays, how can I put these in a Chishm  FAT dir, read and put in VRAM, for exemple ?! Usually I use the "swicopy" or "dmacopy" with a pointer to tranfer the arrays to VRAM, but the files are in RAM, included in the code, and them get space of.
<br/>
<br/>
I don?t know if I wrote understandably... If not, sorry !! Please, I need some help and i?ll be so grateful !!!
<br/>
<br/>
Thanks !!
<br/>
<br/>
PS.: here is my game:
<br/>
- <a href="http://br.youtube.com/watch?v=oHwqK46bE50" target="_blank">http://br.youtube.com/watch?v=oHwqK46bE50</a>
<br/>
- <a href="http://forums.shiningforcecentral.com/index.php?showtopic=12564" target="_blank">http://forums.shiningforcecentral.com/index.php?showtopic=12564</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167745 - nanou - Wed Mar 25, 2009 11:12 am</h4>
    <div class="postbody"><span class="postbody">renatobs, I sent you a PM about this.<br/>_________________<br/>- nanou</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
