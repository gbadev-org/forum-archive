<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Access depth and/or stencil-buffer - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Access depth and/or stencil-buffer</h2>
<div id="posts">
<div class="post">
    <h4>#146248 - Peter - Sat Dec 01, 2007 10:42 am</h4>
    <div class="postbody"><span class="postbody">Does anyone know if it is possible to access (read) the depth and/or stencil buffers from the 3d-hardware somehow? With the DS Video Capture only image data can be captured as I understand <a class="postlink" href="http://nocash.emubase.de/gbatek.htm#ds3dvideo" target="_blank">GBATek</a>.<br/>_________________<br/>Kind Regards,
<br/>
Peter</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146264 - Cydrak - Sat Dec 01, 2007 6:02 pm</h4>
    <div class="postbody"><span class="postbody">No, not really. :/ All you can do is make a second capture, squeezing it out indirectly.
<br/>
<br/>
For depth: Render unlit, untextured, in black with white fog. Since hardware Z ranges over 0...0x7fff, like the RGB, this gives a rough but usable 5 bit approximation. I've personally done this--it works on the rear plane too, if you wanna have occluding "RGBZ" backdrops. See the <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=14568" target="_blank">recent discussion on multi-pass</a>...
<br/>
<br/>
(5.5 to 6 bits _might_ be gotten with a color like RGB(29,30,31) - rounding should cause R and G to increment sooner than the high blue bits. I played with it and that's exactly what happens, but I couldn't see a visual improvement. I think postprocessing is needed to move the rounding upward a few bits.)
<br/>
<br/>
I haven't tried capturing the stencil, but it shouldn't be much worse than Z. A couple of useful arrangements come to mind:
<br/>
<br/>
(1) Blue fog and red shadows - to get them for software use;
<br/>
(2) White fog and black shadows - the fog would be normal Z, and the black (Z=0) should occlude everything, so it could make a useful stencil on the rear plane.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146265 - Peter - Sat Dec 01, 2007 6:34 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cydrak wrote:</b></span></td> </tr> <tr> <td class="quote">For depth: Render unlit, untextured, in black with white fog. Since hardware Z ranges over 0...0x7fff, like the RGB, this gives a rough but usable 5 bit approximation.</td> </tr></table><span class="postbody">
<br/>
That's crafty, thanks a lot!<br/>_________________<br/>Kind Regards,
<br/>
Peter</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146415 - silent_code - Mon Dec 03, 2007 11:13 pm</h4>
    <div class="postbody"><span class="postbody">but after all, the depth and stencil buffers are just line buffers, so there are no such buffers as on the pc. sadly. ;^p</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146417 - Mighty Max - Mon Dec 03, 2007 11:33 pm</h4>
    <div class="postbody"><span class="postbody">That might be the reason why we talk about rendering tricks to create something aequivalent to the depth/stencil buffer output instead of accessing the buffers themself.
<br/>
<br/>
Even if there would be a complete frame in the HW buffers, we can't read it out, so the size of the actual buffer is irrelevant.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146419 - silent_code - Mon Dec 03, 2007 11:50 pm</h4>
    <div class="postbody"><span class="postbody">this is just an idea:
<br/>
well, the buffers *have* to be somewhere. if we knew the adress of the db, couldn't we get its contents during hblank?
<br/>
this won't probably happen, though.
<br/>
<br/>
ps: the topic was on reading the buffers, not computing approximations of them, so i thought i'd post a line about it not being possible (as of now).
<br/>
the tricks mentioned are pretty usable and shouldn't make a great differnece to the real thing on such low precision hw like the nds. memory usage it a concern, though.
<br/>
and if there *were* fullscreen buffers, who says they *couldn't* be read out? ;^P let's not talk about that any further. :^)</span><span class="gensmall"><br/><br/>Last edited by silent_code on Mon Dec 03, 2007 11:53 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#146420 - kusma - Mon Dec 03, 2007 11:52 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>silent_code wrote:</b></span></td> </tr> <tr> <td class="quote">this is just an idea:
<br/>
well, the buffers *have* to be somewhere. if we knew the adress of the db, couldn't we get its contents during hblank?</td> </tr></table><span class="postbody">
<br/>
No, those are buffers not accessible to the CPU.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146421 - silent_code - Mon Dec 03, 2007 11:54 pm</h4>
    <div class="postbody"><span class="postbody">so, they are on chip (gfx) and not memory mapped. makes sense. :^)
<br/>
else, i bet someone had done it by now.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
