<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Pinball development - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Pinball development</h2>
<div id="posts">
<div class="post">
    <h4>#172431 - Aurelio - Fri Feb 05, 2010 9:17 pm</h4>
    <div class="postbody"><span class="postbody">Hi!
<br/>
I'm making a Pinball game for the DS, but i have some problems with collision.
<br/>
I have a ball with x and y coordinates and vx and vy as components of the velocity.
<br/>
I have a bitmap with a value for each pixel of the screen, 1 if the ball have to collide with this pixel, 0 if it haven't to collide.
<br/>
Now the big problem is the response that I've to give to the ball coordinates and velocity.
<br/>
Can you help me?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172450 - TwentySeven - Sat Feb 06, 2010 10:40 pm</h4>
    <div class="postbody"><span class="postbody">If you're just doing this simply, you'll need to map a "return" direction (a normal) for every solid point of the playfield.
<br/>
<br/>
So an upwards facing wall would have an up normal, etc.  You use this then to do your reflection calculation on impact.
<br/>
<br/>
Positioning the ball post collision is easy, you can "cheat" there and just move it between where it was last frame and where it was when it collided until it no longer collides.. sort of like a rewind.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172458 - keldon - Mon Feb 08, 2010 5:31 am</h4>
    <div class="postbody"><span class="postbody">Use geometric operations to calculate the collision point ... It's 430am and I really shouldn't be up but I could knock together some code on Wednesday and explain how it works for your future reference.
<br/>
<br/>
For a "moving circle / line collision" it's something like:
<br/>
 - Create a transformation matrix from the line (<a class="postlink" href="http://en.wikipedia.org/wiki/Dot_product#Rotation" target="_blank">see here</a>)
<br/>
 - Create two circles from your pinball and connect them with a rectangle
<br/>
 - The two circles can be tested by their y values alone and the lines can be tested using a "line / line collision" function (which itself makes use of dot products)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172471 - Miked0801 - Mon Feb 08, 2010 10:37 pm</h4>
    <div class="postbody"><span class="postbody">Ah, the good old pixel vs Vector collision problem.  We had this exact same argument when we last did a pinball mini-game.  Vector based collisions are a better way to go.  You get much more accurate reflections calculated much faster than pxiel based math - plus you avoid a lot of the what to do when a ball goes through a thin collision area problem along with the ball sticking to the collision surface issues due to double refelctions caused by roundoff.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172487 - Aurelio - Tue Feb 09, 2010 6:28 pm</h4>
    <div class="postbody"><span class="postbody">This is my actual collision code, it works, but this need a great memory(and maybe CPU too) usage.
<br/>
This uses a map containing the coordinates(12bit fixed point) of pixels of a line in succession.
<br/>
The code first check if there is a collision by simply checking if the ball is near the line, then, if there is a collision, it rotates the system of the velocities( by the angle between a point before of the one with wich the ball collided and another one after the one with wich the ball collided) , inverts vy, and then rotates back the system of the velocities.
<br/>
I know, it's a bit confused, sorry.
<br/>
<br/>
I've uploaded the source in the last post</span><span class="gensmall"><br/><br/>Last edited by Aurelio on Tue Feb 09, 2010 7:24 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#172488 - Aurelio - Tue Feb 09, 2010 6:30 pm</h4>
    <div class="postbody"><span class="postbody">Ops, a lot of post</span><span class="gensmall"><br/><br/>Last edited by Aurelio on Tue Feb 09, 2010 7:23 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#172489 - Aurelio - Tue Feb 09, 2010 6:32 pm</h4>
    <div class="postbody"><span class="postbody">Ops, a lot of post</span><span class="gensmall"><br/><br/>Last edited by Aurelio on Tue Feb 09, 2010 7:24 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#172490 - Aurelio - Tue Feb 09, 2010 6:53 pm</h4>
    <div class="postbody"><span class="postbody">Ops, a lot of post</span><span class="gensmall"><br/><br/>Last edited by Aurelio on Tue Feb 09, 2010 7:23 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#172491 - Azenris - Tue Feb 09, 2010 7:00 pm</h4>
    <div class="postbody"><span class="postbody">You made the same post a few times. You might wanna delete/edit the content of them. Also you could have shown a snippet of the array instead of it all :p<br/>_________________<br/><a class="postlink" href="http://sacredpotion.blogspot.com/" target="_blank"><span style="color: red">My Homebrew Games</span></a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172494 - Aurelio - Tue Feb 09, 2010 7:29 pm</h4>
    <div class="postbody"><span class="postbody">Sorry, i had some connection problems...
<br/>
I've uploaded the source <a class="postlink" href="http://dl.dropbox.com/u/4586801/pinball.c" target="_blank">here</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172509 - sverx - Wed Feb 10, 2010 11:23 am</h4>
    <div class="postbody"><span class="postbody">Ciao Aurelio,
<br/>
  when the ball collide with a pixel you should find kind of a surface where your pixel belongs to and then calculate the bounce according to your ball angle and the surface angle. Can you calculate the surface angle starting from a given pixel?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172511 - sonny_jim - Wed Feb 10, 2010 1:34 pm</h4>
    <div class="postbody"><span class="postbody">I'm actually working on custom software for real pinball tables:
<br/>
<a href="http://www.oddchange.com/freewpc/" target="_blank">http://www.oddchange.com/freewpc/</a>
<br/>
<br/>
It may not be relevant, but there may be some code in the kernel/ and common/ directories that may interest you, although it's more along the lines of ball tracking/scoring.
<br/>
<br/>
If you need any ideas for rulesets, I've got millions of them ;-)<br/>_________________<br/></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Would that be the internet driver for the program?
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172524 - Miked0801 - Wed Feb 10, 2010 8:43 pm</h4>
    <div class="postbody"><span class="postbody">Line seqment collision (2D)
<br/>
<br/>
1. Did the ball pass through a collision line?  2D magnitude of cross product (determinant) of (last ball position - base line position X line Vector) and (new ball position - base line position  X line Vector).  Compare signs.  If they differ, the ball cross the line.  This check should only be around 8 subtracts, 4 multiplies and a compare.
<br/>
<br/>
2. Did the ball pass through the actual line or pass its extents?  The true way is to find the line segment intersection and see if it is within the line.  A faster way is to compare the dot product of previous 2 vectors and see if the value is non-negative and less than the length of the segment (squared if the segment vector is not normalized).  Again, 4 multiplies a couple addes and a couple compares.
<br/>
<br/>
3. You've collided, reflect or do whatever :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172525 - Aurelio - Wed Feb 10, 2010 9:01 pm</h4>
    <div class="postbody"><span class="postbody">Yeah, the real problem is what to do when the collided with the line :S</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172530 - TwentySeven - Thu Feb 11, 2010 4:09 am</h4>
    <div class="postbody"><span class="postbody">2d vector reflect?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172533 - melw - Thu Feb 11, 2010 12:34 pm</h4>
    <div class="postbody"><span class="postbody">One simple way of doing Pinball collisions is to think the ball to be a single dot and have a separate collision map you're comparing the ball coordinates against. The actual game graphics would be based on the collision map, having stuff also over the collision map borders - depending on the visible ball size. 
<br/>
<br/>
This solution - even if not entirely elegant - is very light-weight what comes to maths. Although you still need to calculate separately what happens after a collision has occurred.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172541 - Miked0801 - Thu Feb 11, 2010 8:13 pm</h4>
    <div class="postbody"><span class="postbody">The problem with bitmap collision solutions are:
<br/>
<br/>
1. How do you reflect your velocity accurately?  With vectors, its a very simple algorithm to do a reflection at any angle.  You either are forced to leave walls X/Y axis aligned or store/calculate the wall angle for reflection (which defeats the purpose of the bitmap.)
<br/>
<br/>
2. If your ball/dot is moving faster than 1 collision unit per tic, then you either have to check each individual collision square the ball travels through with some sort of integer line trace (kinda slow), make your walls thicker than the max velocity of the ball (kludge), or make sure the velocity of the ball never gets too high (epic kludge).
<br/>
<br/>
3. Flippers?  Without vectors, getting flippers to feel accurate at all is a major pain.  You can fake the plunger if it's straight up/down, but again it requires math to get the acceleration part right, plus code to make sure you push the ball during the impact to prevent double/triple/... internal collision with the plunger while it is moving.
<br/>
<br/>
4. Space efficiency.  Vectors will be much more space efficient most of the time compared to even a 1-bit bitmap.  Of course that bitmap compressed may win, but that's another layer of complexity.
<br/>
<br/>
5. Extendable.  Once you get a vector collision system working, the same system can be used for baseball games (stadium walls, bat/ball, etc.), RPG map tiles (sliding along vectors is sooo much easier to calculate than bitmap collision), and well any other sort of collision.  The math is just that much better.
<br/>
<br/>
Advantages of bitmap:
<br/>
1. Easy to draw and visualize the board and collision map.  Easy to change.  This is why it's so appealing.  It allows you to get further quicker and change the board on the fly.
<br/>
<br/>
2.First pass collision code s trivial.  What to do when a collision occurs is not.
<br/>
<br/>
Overall:
<br/>
Once you get reflections from walls working with either system, the next big pain will be getting moving game objects to correctly interact with the ball.  Vector math is the way to go hee with the infinite amount of angles are such that can be produced.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172542 - Miked0801 - Thu Feb 11, 2010 8:18 pm</h4>
    <div class="postbody"><span class="postbody">FYI, here the reflection code you need for walls:
<br/>
<br/>
BallVector is the direction of the ball before hitting the wall
<br/>
WallNormal is the normal of the wall (must be a unit vector)
<br/>
<br/>
ReflectedVector = BallVector - 2 * WallNormal * (WallNormal dot BallVector )
<br/>
<br/>
note that this will work for 3D vectors as well if you wanted to do ramps or the like.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172543 - Aurelio - Thu Feb 11, 2010 8:20 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Miked0801 wrote:</b></span></td> </tr> <tr> <td class="quote">FYI, here the reflection code you need for walls:
<br/>
<br/>
BallVector is the direction of the ball before hitting the wall
<br/>
WallNormal is the normal of the wall (must be a unit vector)
<br/>
<br/>
ReflectedVector = BallVector - 2 * WallNormal * (WallNormal dot BallVector )
<br/>
<br/>
note that this will work for 3D vectors as well if you wanted to do ramps or the like.</td> </tr></table><span class="postbody">
<br/>
With * you mean cross product, right?
<br/>
What I've to do with Reflected Vector?
<br/>
EDIT: My, mistake, it's a normal scalar product. I need to subtract 2 * WallNormal * (WallNormal dot BallVector ) to each component of BallVector?</span><span class="gensmall"><br/><br/>Last edited by Aurelio on Thu Feb 11, 2010 8:57 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#172546 - Dwedit - Thu Feb 11, 2010 8:53 pm</h4>
    <div class="postbody"><span class="postbody">Those look like scalar multiplication to me.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172548 - TwentySeven - Thu Feb 11, 2010 10:49 pm</h4>
    <div class="postbody"><span class="postbody">The difficulty of Bitmap flippers thing is a good point.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172550 - keldon - Fri Feb 12, 2010 6:15 pm</h4>
    <div class="postbody"><span class="postbody">It looks like it's too late; but I posted some useful code for collision detection <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=12409&amp;highlight=collision" target="_blank">[here]</a>. I haven't updated my server so you will not be able to load the examples unless I upload them, but the code displayed should give you some info (if it's not already been said).</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
