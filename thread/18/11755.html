<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>DOS on the DS? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > DOS on the DS?</h2>
<div id="posts">
<div class="post">
    <h4>#109637 - Joe_Sextus - Sun Nov 19, 2006 11:24 pm</h4>
    <div class="postbody"><span class="postbody">I'm considering writing a native port of DOS. I'm read through a couple of discussion here.
<br/>
<br/>
<a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=7652" target="_blank">http://forum.gbadev.org/viewtopic.php?t=7652</a>
<br/>
<a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=6875" target="_blank">http://forum.gbadev.org/viewtopic.php?t=6875</a>
<br/>
<br/>
Neither one even touch the technical aspects of porting DOS. I have been looking at <a class="postlink" href="http://sourceforge.net/projects/rxdos" target="_blank">http://sourceforge.net/projects/rxdos</a> as a possible starting point for this port. RxDOS is a real-time clone of MS-DOS completely written in x86 assembly. I have the book that the author of RxDos wrote so the DOS part of this project shouldn't be too difficult to start. But I have a few DS specific question (Bare in mind that I am new to DS development). 
<br/>
<br/>
1) From what I've gathered, mainly looking at the NDSTech Wiki, 0x02000000 is the lowest general purpose memory address. Does the DS load program code at this address (like the GBA)?
<br/>
<br/>
2) Can devkitARM produce a flat binary image (e.g the first instruction in my program is byte 0 of the binary)?
<br/>
<br/>
I'm thinking that this project will be CF/SD only and that it will contain 3 files: loader.nds (maybe), kernel.sys, command.com. loader.nds is the file responsible for loading kernel.sys into the correct memory location at boot. Both loader.nds and kernel.nds would be GBA slot device specific (e.g one set for GBAMPv2, one set for M3, ...). kernel.sys is obviously the kernel and it would load command.com after setting up the IVT and SIP and pass control to command.com which is the command line interpreter.  It would pare the config.sys and autoexec.bat, if present.
<br/>
<br/>
Any feedback would be appreciated.
<br/>
<br/>
-Joe</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109638 - Mighty Max - Sun Nov 19, 2006 11:30 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">. RxDOS is a real-time clone of MS-DOS completely written in x86 assembly</td> </tr></table><span class="postbody">
<br/>
<br/>
Thats the problem. x86 instructions do not work on a arm microprocessor.
<br/>
<br/>
It is not possible to create a DR/PC/MR-DOS clone for the DS without emulating the CPU and the primary peripherivals like pic, pit, fdc etc<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109641 - Joe_Sextus - Sun Nov 19, 2006 11:41 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">Thats the problem. x86 instructions do not work on a arm microprocessor.</td> </tr></table><span class="postbody">
<br/>
That's not a problem. I'm thinking that for the DS C/C++ code will work. I was originally thinking that translating from x86 to ARM would be enough.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">It is not possible to create a DR/PC/MR-DOS clone for the DS without emulating the CPU and the primary peripherivals like pic, pit, fdc etc</td> </tr></table><span class="postbody">
<br/>
I'm not thinking of a 100% compatible environment, but as close as possible. What peripherals would be needed?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109642 - Dwedit - Sun Nov 19, 2006 11:43 pm</h4>
    <div class="postbody"><span class="postbody">Address 0 is not in any user-writable area, it's in the BIOS.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109643 - Joe_Sextus - Sun Nov 19, 2006 11:48 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dwedit wrote:</b></span></td> </tr> <tr> <td class="quote">Address 0 is not in any user-writable area, it's in the BIOS.</td> </tr></table><span class="postbody">
<br/>
I was going to shift everything up by 0x02000000 for that reason.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109644 - Mighty Max - Sun Nov 19, 2006 11:56 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Joe_Sextus wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">Thats the problem. x86 instructions do not work on a arm microprocessor.</td> </tr></table><span class="postbody">
<br/>
That's not a problem. I'm thinking that for the DS C/C++ code will work. I was originally thinking that translating from x86 to ARM would be enough.
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
<br/>
It would run the kernel then, but what's the use of a OS if it cant start any programs? ".com" is complete based on the x86 processor layout and MZ (.exe part) are not much better.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">It is not possible to create a DR/PC/MR-DOS clone for the DS without emulating the CPU and the primary peripherivals like pic, pit, fdc etc</td> </tr></table><span class="postbody">
<br/>
I'm not thinking of a 100% compatible environment, but as close as possible. What peripherals would be needed?[/quote]
<br/>
<br/>
The named one at least + some gfx by either writing a int10 wrapper or an actual m/c/e/p/vga emulation.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109645 - Joe_Sextus - Mon Nov 20, 2006 12:09 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
It would run the kernel then, but what's the use of a OS if it cant start any programs? ".com" is complete based on the x86 processor layout and MZ (.exe part) are not much better.
<br/>
</td> </tr></table><span class="postbody">
<br/>
I'm not planning on writting an emulator, any DOS programs would have to be ported to the DS as well. The .com and .sys extensions in my example are more for the user to tell what they're for, kernel.sys and command.com could be called kernel.nds and command.nds respectively.
<br/>
<br/>
[EDIT]
<br/>
As far as graphics goes, I was planning on just DOS mode 0 for now using a modified version of Sylfurd's subpixelfont.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109651 - tepples - Mon Nov 20, 2006 12:55 am</h4>
    <div class="postbody"><span class="postbody">Mighty Max: This project appears to be to DOS as DSLinux is to Linux. If you want a real IBM PC emulator, start with the CPU core from dualSwan.
<br/>
<br/>
How much of <a class="postlink" href="http://www.freedos.org/" target="_blank">FreeDOS</a> (GPL clone of MS-DOS) is written in C?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109654 - Joe_Sextus - Mon Nov 20, 2006 1:00 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">How much of <a class="postlink" href="http://www.freedos.org/" target="_blank">FreeDOS</a> (GPL clone of MS-DOS) is written in C?</td> </tr></table><span class="postbody">
<br/>
I think most of freedos is written in C, but I think it will be easier to work from RxDOS even though its in Assembly. FreeDOS is a DOS for modern x86 system and has thing that would have to striped out (such as usb and ntfs). RxDOS is the equivalent of </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">format a: /s</td> </tr></table><span class="postbody"> There isn't any fluff in it.
<br/>
[EDIT]
<br/>
As fas as comparing this to DSLinux.  That's a good comparison for what I want.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109662 - kusma - Mon Nov 20, 2006 2:23 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Joe_Sextus wrote:</b></span></td> </tr> <tr> <td class="quote">As fas as comparing this to DSLinux.  That's a good comparison for what I want.</td> </tr></table><span class="postbody">
<br/>
...except that most linux software comes with the source code, unlike most dos software - more or less rendering the entire idea useless imo.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109663 - Joe_Sextus - Mon Nov 20, 2006 2:26 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>kusma wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Joe_Sextus wrote:</b></span></td> </tr> <tr> <td class="quote">As fas as comparing this to DSLinux.  That's a good comparison for what I want.</td> </tr></table><span class="postbody">
<br/>
...except that most linux software comes with the source code, unlike most dos software - more or less rendering the entire idea useless imo.</span></td> </tr></table><span class="postbody">
<br/>
My experience with DSLinux isn't much better (I have a GBAMP v2, so no X).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109664 - kusma - Mon Nov 20, 2006 2:26 am</h4>
    <div class="postbody"><span class="postbody">besides from that, even if you were to get the source code for some usable dos-tools, they'd mostly be written in assembly, or some "neat" watcom c/c++ with boat-loads of inline asm to do system calls. and how would you emulate dos interrupts etc anyway (ie provide an api for the applications)?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109665 - kusma - Mon Nov 20, 2006 2:27 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Joe_Sextus wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>kusma wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Joe_Sextus wrote:</b></span></td> </tr> <tr> <td class="quote">As fas as comparing this to DSLinux.  That's a good comparison for what I want.</td> </tr></table><span class="postbody">
<br/>
...except that most linux software comes with the source code, unlike most dos software - more or less rendering the entire idea useless imo.</span></td> </tr></table><span class="postbody">
<br/>
My experience with DSLinux isn't much better (I have a GBAMP v2, so no X).</span></td> </tr></table><span class="postbody">
<br/>
linux is SOOO much more than X. seriously. I'm not saying that I find dslinux to be a very good idea either, i'm just saying i find dos for the ds an even worse idea ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109668 - Joe_Sextus - Mon Nov 20, 2006 3:20 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>kusma wrote:</b></span></td> </tr> <tr> <td class="quote">... how would you emulate dos interrupts etc anyway (ie provide an api for the applications)?</td> </tr></table><span class="postbody">
<br/>
I had thought to just take and place the IVT at 0x02000000 and place the function addresses in there as 32-bit pointer instead of segment:offset. But their would still need to be an "int" instruction/function.  
<br/>
<br/>
For C/C++ it could be
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">uint32 int(uint32 ax, uint32 bx, uint32 cx, uint32 dx, byte intNum)
<br/>
{
<br/>
  /*
<br/>
   keep in mind this is pseudo code and the syntax may not be correct
<br/>
   IVT is an array of function pointers
<br/>
  */
<br/>
  IVT[intNum](ax, bx, cx, dx);
<br/>
}</td> </tr></table><span class="postbody">
<br/>
but I'm not sure how to handle this for asm, maybe a simple function that is included in the asm code.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>kusma wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Joe_Sextus wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>kusma wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Joe_Sextus wrote:</b></span></td> </tr> <tr> <td class="quote">As fas as comparing this to DSLinux.  That's a good comparison for what I want.</td> </tr></table><span class="postbody">
<br/>
...except that most linux software comes with the source code, unlike most dos software - more or less rendering the entire idea useless imo.</span></td> </tr></table><span class="postbody">
<br/>
My experience with DSLinux isn't much better (I have a GBAMP v2, so no X).</span></td> </tr></table><span class="postbody">
<br/>
linux is SOOO much more than X. seriously. I'm not saying that I find dslinux to be a very good idea either, i'm just saying i find dos for the ds an even worse idea ;)</span></td> </tr></table><span class="postbody">
<br/>
I know, both are bad ideas as far as being of any real use (for now). But its something I just wanted to play around with and see if I could make it work. More of a proof of concept rather than an OS to use day in and day out.
<br/>
<br/>
My only real problem with DSLinux (its on my GBAMP) as an embedded distribution is the font size.
<br/>
<br/>
Windows CE would probably be the best choice to run on the DS (if it was Open Source).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109684 - Cthulhu - Mon Nov 20, 2006 8:00 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Joe_Sextus wrote:</b></span></td> </tr> <tr> <td class="quote">Windows CE would probably be the best choice to run on the DS (if it was Open Source).</td> </tr></table><span class="postbody">
<br/>
<br/>
<a class="postlink" href="http://www.windowsfordevices.com/news/NS2632317407.html" target="_blank">It is.</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109685 - OOPMan - Mon Nov 20, 2006 8:14 am</h4>
    <div class="postbody"><span class="postbody">While we're on the subject of OS "porting", has anyone looked into porting one of the various Realtime RISC OSes about, like eCos?<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109699 - Lazy1 - Mon Nov 20, 2006 2:08 pm</h4>
    <div class="postbody"><span class="postbody">Your better off writing an x86 interpreter, then emulating some x86 hardware such as a CGA display.
<br/>
That way we can play some really old dos games on our ds without dos.
<br/>
<br/>
I doub't you'll have a problem emulating a 4.77mhz 8086, you might even be able to do that on the arm7.
<br/>
<br/>
Problem is you'd need to know some 8086 assembly in order to troubleshoot problems that will arise.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109700 - Joe_Sextus - Mon Nov 20, 2006 2:15 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lazy1 wrote:</b></span></td> </tr> <tr> <td class="quote">Your better off writing an x86 interpreter, then emulating some x86 hardware such as a CGA display.
<br/>
That way we can play some really old dos games on our ds without dos.
<br/>
<br/>
I doub't you'll have a problem emulating a 4.77mhz 8086, you might even be able to do that on the arm7.
<br/>
<br/>
Problem is you'd need to know some 8086 assembly in order to troubleshoot problems that will arise.</td> </tr></table><span class="postbody">
<br/>
The more I look into and think about this project, the I think that an emulator would be a better way to go.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109701 - OOPMan - Mon Nov 20, 2006 2:30 pm</h4>
    <div class="postbody"><span class="postbody">You could just try porting Bochs or DosBox...
<br/>
<br/>
I don't think the first has been tried, while the second has without much success...<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109702 - Joe_Sextus - Mon Nov 20, 2006 2:53 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>OOPMan wrote:</b></span></td> </tr> <tr> <td class="quote">You could just try porting Bochs or DosBox...
<br/>
<br/>
I don't think the first has been tried, while the second has without much success...</td> </tr></table><span class="postbody">
<br/>
<br/>
The problem with that is that I wanted a native DOS environment, not emulated.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109704 - Izhido - Mon Nov 20, 2006 3:41 pm</h4>
    <div class="postbody"><span class="postbody">I concur with most people here. If you want to be able to write DOS programs that run unchanged on the DS, emulation is the only way to go. x86 &amp; ARM are fundamentally different architectures. Assembly language for both platforms is not even similar. Now, if compatibility is being thought to be kept at C++ level, well, that's another thing...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109705 - OOPMan - Mon Nov 20, 2006 4:02 pm</h4>
    <div class="postbody"><span class="postbody">Yeah, I don't see much in the way of virtualisation happening here. The ARM is a pretty funky little chip, as detailed <a class="postlink" href="http://www.heyrick.co.uk/assembler/" target="_blank">here...</a><br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109718 - josath - Mon Nov 20, 2006 6:31 pm</h4>
    <div class="postbody"><span class="postbody">Like others said:
<br/>
<br/>
If you make a 'native' ARM version of DOS, you will not be able to run any existing dos programs. If you just want to make this as a fun excercise, then go ahead, but building one based on an emulator would be much more useful  IMHO.
<br/>
<br/>
Most likely, you will have to write the emulator from scratch, dosbox takes too much memory. Don't even bother with bochs, that thing is a beast even on my 2ghz PC.
<br/>
<br/>
I would get in contact with LiraNuna, I think he has made a 8086 CPU core, for some other emulator he was working on which uses a similar CPU. Then all you really need to emulate is: BIOS, a CGA display, Keyboard, and Disk access. Then we could run some old dos apps. If you keep it limited to 640KB of RAM (or even less. dos and lots of apps can run with less), I think it will be doable, to emulate say a 2MHz PC.
<br/>
<br/>
This will require you to understand x86 ASM, and be able to research the internals of a PC (the above mentioned devices which need emulating). If this is your first emulator, it may be a bit much, so don't expect it to work on your first try -- I know, I tried making an 8086 emulator. I got it far enough that it can emulate HELOWRLD.COM, but it's not designed real well, and I'd need to start again from scratch if I want to take it further.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109732 - Joe_Sextus - Mon Nov 20, 2006 9:43 pm</h4>
    <div class="postbody"><span class="postbody">After thinking about this project in more detail, I think I am not going to write it. 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">you will not be able to run any existing dos programs</td> </tr></table><span class="postbody">
<br/>
This is one of the reasons, every way I've looked at this (as a native port) would require the programs to be rewritten and have addresses changed.
<br/>
<br/>
I may make a DOS-like environment/shell instead.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109733 - Dan2552 - Mon Nov 20, 2006 10:00 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Joe_Sextus wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
I may make a DOS-like environment/shell instead.</td> </tr></table><span class="postbody">
<br/>
<br/>
Make it manage everything an OS is meant to do (memory management, filesystem management, etc), then think about writing a GUI for it :) Then everyone's happy</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109737 - Joe_Sextus - Mon Nov 20, 2006 10:24 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dan2552 wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Joe_Sextus wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
I may make a DOS-like environment/shell instead.</td> </tr></table><span class="postbody">
<br/>
<br/>
Make it manage everything an OS is meant to do (memory management, filesystem management, etc), then think about writing a GUI for it :) Then everyone's happy</span></td> </tr></table><span class="postbody">
<br/>
I can see it now, DS-DOS with Windows DS. (BSOD included for free!)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109746 - Lazy1 - Mon Nov 20, 2006 11:23 pm</h4>
    <div class="postbody"><span class="postbody">I'd say just go for it and write it anyway, so many people would have a use for this.
<br/>
I think SimCity would work on a CGA display...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109750 - Joe_Sextus - Mon Nov 20, 2006 11:58 pm</h4>
    <div class="postbody"><span class="postbody">If I write it the way I'm thinking about doing it, I'm going to load DOS high (like 4MB - sizeof(DOS) high). This gives programs the first 3+ MB of Memory.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109751 - Izhido - Tue Nov 21, 2006 12:05 am</h4>
    <div class="postbody"><span class="postbody">Just out of curiosity, are you going to implement DPMI? That sure would help a lot when porting DOS apps...
<br/>
<br/>
Just imagine... the DS breaking the 640kb barrier into a whole new world of... of...
<br/>
<br/>
D'oh!
<br/>
<br/>
Nevermind. :D :D :D
<br/>
<br/>
PS: Just a joke, man! Now, seriously, will you implement DPMI???
<br/>
<br/>
- Izhido</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109754 - Dan2552 - Tue Nov 21, 2006 12:15 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Joe_Sextus wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dan2552 wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Joe_Sextus wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
I may make a DOS-like environment/shell instead.</td> </tr></table><span class="postbody">
<br/>
<br/>
Make it manage everything an OS is meant to do (memory management, filesystem management, etc), then think about writing a GUI for it :) Then everyone's happy</span></td> </tr></table><span class="postbody">
<br/>
I can see it now, DS-DOS with Windows DS. (BSOD included for free!)</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Exactly! I'm glad someone's catching my drift.
<br/>
<br/>
This is how windows started, if we start something like this for DS - then it has the potential windows did back then!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109758 - Joe_Sextus - Tue Nov 21, 2006 12:42 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Izhido wrote:</b></span></td> </tr> <tr> <td class="quote">Just out of curiosity, are you going to implement DPMI? That sure would help a lot when porting DOS apps...
<br/>
<br/>
Just imagine... the DS breaking the 640kb barrier into a whole new world of... of...
<br/>
<br/>
D'oh!
<br/>
<br/>
Nevermind. :D :D :D
<br/>
<br/>
PS: Just a joke, man! Now, seriously, will you implement DPMI???
<br/>
<br/>
- Izhido</td> </tr></table><span class="postbody">
<br/>
<br/>
I'm not sure, I just want basic dos (equivalent of io.sys, msdos.sys, and command.com) for now.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109789 - HyperHacker - Tue Nov 21, 2006 7:29 am</h4>
    <div class="postbody"><span class="postbody">Windows DS? No no... WinDS. :p<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109851 - josath - Tue Nov 21, 2006 7:11 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">Windows DS? No no... WinDS. :p</td> </tr></table><span class="postbody">
<br/>
<br/>
We already have a WinDS:
<br/>
<a href="http://s3.invisionfree.com/GBAWinS/index.php?act=site" target="_blank">http://s3.invisionfree.com/GBAWinS/index.php?act=site</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109926 - Ant6n - Thu Nov 23, 2006 4:47 am</h4>
    <div class="postbody"><span class="postbody">does anybody know where one can find very specific information about the 8086 though? i.e. all the opcodes and all possible instruction format's etc. Also, what else would one need to 'emulate' besides the cpu to be able to run dos programs?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109927 - Lazy1 - Thu Nov 23, 2006 5:15 am</h4>
    <div class="postbody"><span class="postbody">I'd say grab dosbox and an 8086 assembly tutorial/book, there is no point in sitting down with just an opcode table and trying to write a cpu core.
<br/>
<br/>
Basically what you need:
<br/>
------------------------------
<br/>
808x cpu core
<br/>
CGA Graphics emulation
<br/>
implement bios/dos system calls
<br/>
<br/>
You'd probably be looking at an interpreter rather than a full blown emulator that can run dos.
<br/>
Then you can make small test programs and run them as you build your emulator and keep adding whatever is missing.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109928 - Joe_Sextus - Thu Nov 23, 2006 5:19 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ant6n wrote:</b></span></td> </tr> <tr> <td class="quote">does anybody know where one can find very specific information about the 8086 though? i.e. all the opcodes and all possible instruction format's etc. Also, what else would one need to 'emulate' besides the cpu to be able to run dos programs?</td> </tr></table><span class="postbody">
<br/>
I have a book from my Computer Architecture class that has all the instruction through the pentium. It called "IBM PC Assembly Language and Programming (Fifth Edition)" by Peter Abel. That might have what your looking for.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109930 - Ant6n - Thu Nov 23, 2006 6:10 am</h4>
    <div class="postbody"><span class="postbody">I have never read on how a cpu is emulated (i mean just the basic core). it probably comes down to something like
<br/>
- find what the sources are, and load them into r1,r2 
<br/>
- find out what the operation is and 
<br/>
- jump to a place where this operation is executed (i.e. r1+r2-&gt;r1). 
<br/>
- jump to some place where 
<br/>
- the flags (parity, sign, overflow, auxiliary) are being set,
<br/>
- r1 is moved to the destination register
<br/>
- repeat.
<br/>
<br/>
i am interested in how this is done, actually doing it seems like a crazy amount of work. it would probably be easier to do a JVM.
<br/>
<br/>
actually, there is quite some amount of information on 80x86, but only few sources on the 8086 alone. I think most dos programs that would run at &lt;8 MHz run on the 8086 alone.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109936 - OOPMan - Thu Nov 23, 2006 7:22 am</h4>
    <div class="postbody"><span class="postbody">Bochs is an x86 emulator. You might want to take a look at the source code for it if that's what you're keen on doing. At the very least it would be a useful reference...<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110019 - Payk - Fri Nov 24, 2006 9:23 am</h4>
    <div class="postbody"><span class="postbody">Well Bochs takes about 16 minutes to load win95 on gp2x.
<br/>
But it has alot of more ram, and better display resolution.
<br/>
I also thought about a dos emu, but thats stupid to emulate/translate asm
<br/>
since that are to little steps to translate. Smaller steps = more waste of time. Its much better to just make a java platform, dslua or maybe a script os which can read qbasic. The commands of java or qb arent that small steps. so there is less interprating then calculating as well. In Bochs loib its vice versa(i guess).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110059 - josath - Sat Nov 25, 2006 3:36 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ant6n wrote:</b></span></td> </tr> <tr> <td class="quote">I have never read on how a cpu is emulated (i mean just the basic core). it probably comes down to something like
<br/>
- find what the sources are, and load them into r1,r2 
<br/>
- find out what the operation is and 
<br/>
- jump to a place where this operation is executed (i.e. r1+r2-&gt;r1). 
<br/>
- jump to some place where 
<br/>
- the flags (parity, sign, overflow, auxiliary) are being set,
<br/>
- r1 is moved to the destination register
<br/>
- repeat.
<br/>
<br/>
i am interested in how this is done, actually doing it seems like a crazy amount of work. it would probably be easier to do a JVM.
<br/>
<br/>
actually, there is quite some amount of information on 80x86, but only few sources on the 8086 alone. I think most dos programs that would run at &lt;8 MHz run on the 8086 alone.</td> </tr></table><span class="postbody">
<br/>
<br/>
These should give you most of the info you need:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">Intel Architecture Software Developer's Manual
<br/>
  Volume 1: Basic Architecture
<br/>
  Volume 2: Instruction Set Reference Manual
<br/>
  Volume 3: System Programing Guide</td> </tr></table><span class="postbody">
<br/>
easy to find on google.
<br/>
<br/>
In order to run old dos apps, you also need to emulate:
<br/>
  BIOS routines
<br/>
  Text-Mode Display
<br/>
  Disk access
<br/>
  Keyboard input
<br/>
<br/>
Optional things:
<br/>
  CGA Video (play some old 4-color games)
<br/>
  EGA Video (more advanced, play 16-color video games)
<br/>
  Joystick input 
<br/>
  Mouse input
<br/>
  PC Speaker for some beeps and blips. Soundblaster type stuff is probably too advanced.
<br/>
<br/>
Here's an interesting tutorial on writing an emulator:
<br/>
<a href="http://fms.komkon.org/EMUL8/HOWTO.html" target="_blank">http://fms.komkon.org/EMUL8/HOWTO.html</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110084 - OOPMan - Sat Nov 25, 2006 8:56 am</h4>
    <div class="postbody"><span class="postbody">Nice link Josath :-)<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110214 - Joe_Sextus - Sun Nov 26, 2006 10:08 pm</h4>
    <div class="postbody"><span class="postbody">Can anyone point me to some good books or references on how to write an emulator?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110265 - Ant6n - Mon Nov 27, 2006 9:48 am</h4>
    <div class="postbody"><span class="postbody">ha! I have been searching for a 8086-only reference, since references usually go up til pentium which makes finding the information about the 8086 the biggest hassle.
<br/>
Instead i now found some nice reference to what appears to be a mobile spin off the 8186. it has seven instructions added to the original design, and its a little faster. so basicly nothin changed. here we go
<br/>
<a href="ftp://download.intel.com/design/intarch/manuals/27095003.pdf" target="_blank">ftp://download.intel.com/design/intarch/manuals/27095003.pdf</a>
<br/>
has nice lists with the opcodes and decoding info, together with a normal intel x86 reference (which tells what exactly each instruction does) this could be doable.
<br/>
a list of only 8086 instructions with what they do and which flags they set is at
<br/>
<a href="http://www.emu8086.com/assembly_language_tutorial_assembler_reference/8086_instruction_set.html" target="_blank">http://www.emu8086.com/assembly_language_tutorial_assembler_reference/8086_instruction_set.html</a>
<br/>
together with the info from josath (esp. the short tutorial), one could have something up in C.
<br/>
I realize that this might not be very relevant for somebody who doesnt develope for the ds but only gba, as the gba might not only be a little bit slow but also too constraint on memory. so i guess i am out of this game for the moment...</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
