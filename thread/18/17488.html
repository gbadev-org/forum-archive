<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Out of practice - can you help me decypher this? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Out of practice - can you help me decypher this?</h2>
<div id="posts">
<div class="post">
    <h4>#175967 - Lazy1 - Sat Mar 12, 2011 5:04 am</h4>
    <div class="postbody"><span class="postbody">Taking a look at the positioned sound code from the SDL/Id source:
<br/>
I have no idea what is going on, it looks like a table of modifiers to either sound position or volume level.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
*
<br/>
==========================
<br/>
=
<br/>
= SetSoundLoc - Given the location of an object (in terms of global
<br/>
=   coordinates, held in globalsoundx and globalsoundy), munges the values
<br/>
=   for an approximate distance from the left and right ear, and puts
<br/>
=   those values into leftchannel and rightchannel.
<br/>
=
<br/>
= JAB
<br/>
=
<br/>
==========================
<br/>
*/
<br/>
<br/>
#define ATABLEMAX 15
<br/>
static const byte righttable[ATABLEMAX][ATABLEMAX * 2] = {
<br/>
{ 8, 8, 8, 8, 8, 8, 8, 7, 7, 7, 7, 7, 7, 6, 0, 0, 0, 0, 0, 1, 3, 5, 8, 8, 8, 8, 8, 8, 8, 8},
<br/>
{ 8, 8, 8, 8, 8, 8, 8, 7, 7, 7, 7, 7, 6, 4, 0, 0, 0, 0, 0, 2, 4, 6, 8, 8, 8, 8, 8, 8, 8, 8},
<br/>
{ 8, 8, 8, 8, 8, 8, 8, 7, 7, 7, 7, 6, 6, 4, 1, 0, 0, 0, 1, 2, 4, 6, 8, 8, 8, 8, 8, 8, 8, 8},
<br/>
{ 8, 8, 8, 8, 8, 8, 8, 7, 7, 7, 7, 6, 5, 4, 2, 1, 0, 1, 2, 3, 5, 7, 8, 8, 8, 8, 8, 8, 8, 8},
<br/>
{ 8, 8, 8, 8, 8, 8, 8, 8, 7, 7, 7, 6, 5, 4, 3, 2, 2, 3, 3, 5, 6, 8, 8, 8, 8, 8, 8, 8, 8, 8},
<br/>
{ 8, 8, 8, 8, 8, 8, 8, 8, 7, 7, 7, 6, 6, 5, 4, 4, 4, 4, 5, 6, 7, 8, 8, 8, 8, 8, 8, 8, 8, 8},
<br/>
{ 8, 8, 8, 8, 8, 8, 8, 8, 8, 7, 7, 7, 6, 6, 5, 5, 5, 6, 6, 7, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8},
<br/>
{ 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 7, 7, 7, 6, 6, 7, 7, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8},
<br/>
{ 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8},
<br/>
{ 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8},
<br/>
{ 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8},
<br/>
{ 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8},
<br/>
{ 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8},
<br/>
{ 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8},
<br/>
{ 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8}
<br/>
};
<br/>
static const byte lefttable[ATABLEMAX][ATABLEMAX * 2] = {
<br/>
{ 8, 8, 8, 8, 8, 8, 8, 8, 5, 3, 1, 0, 0, 0, 0, 0, 6, 7, 7, 7, 7, 7, 7, 8, 8, 8, 8, 8, 8, 8},
<br/>
{ 8, 8, 8, 8, 8, 8, 8, 8, 6, 4, 2, 0, 0, 0, 0, 0, 4, 6, 7, 7, 7, 7, 7, 8, 8, 8, 8, 8, 8, 8},
<br/>
{ 8, 8, 8, 8, 8, 8, 8, 8, 6, 4, 2, 1, 0, 0, 0, 1, 4, 6, 6, 7, 7, 7, 7, 8, 8, 8, 8, 8, 8, 8},
<br/>
{ 8, 8, 8, 8, 8, 8, 8, 8, 7, 5, 3, 2, 1, 0, 1, 2, 4, 5, 6, 7, 7, 7, 7, 8, 8, 8, 8, 8, 8, 8},
<br/>
{ 8, 8, 8, 8, 8, 8, 8, 8, 8, 6, 5, 3, 3, 2, 2, 3, 4, 5, 6, 7, 7, 7, 8, 8, 8, 8, 8, 8, 8, 8},
<br/>
{ 8, 8, 8, 8, 8, 8, 8, 8, 8, 7, 6, 5, 4, 4, 4, 4, 5, 6, 6, 7, 7, 7, 8, 8, 8, 8, 8, 8, 8, 8},
<br/>
{ 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 7, 6, 6, 5, 5, 5, 6, 6, 7, 7, 7, 8, 8, 8, 8, 8, 8, 8, 8, 8},
<br/>
{ 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 7, 7, 6, 6, 7, 7, 7, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8},
<br/>
{ 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8},
<br/>
{ 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8},
<br/>
{ 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8},
<br/>
{ 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8},
<br/>
{ 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8},
<br/>
{ 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8},
<br/>
{ 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8}
<br/>
};
<br/>
<br/>
static void SetSoundLoc(fixed gx, fixed gy)
<br/>
{
<br/>
   fixed xt, yt;
<br/>
   int x, y;
<br/>
<br/>
// translate point to view centered coordinates
<br/>
//
<br/>
   gx -= viewx;
<br/>
   gy -= viewy;
<br/>
<br/>
//
<br/>
// calculate newx
<br/>
//
<br/>
   xt = FixedByFrac(gx,viewcos);
<br/>
   yt = FixedByFrac(gy,viewsin);
<br/>
   x = (xt - yt) &gt;&gt; TILESHIFT;
<br/>
<br/>
//
<br/>
// calculate newy
<br/>
//
<br/>
   xt = FixedByFrac(gx,viewsin);
<br/>
   yt = FixedByFrac(gy,viewcos);
<br/>
   y = (yt + xt) &gt;&gt; TILESHIFT;
<br/>
<br/>
   if (y &gt;= ATABLEMAX)
<br/>
      y = ATABLEMAX - 1;
<br/>
   else if (y &lt;= -ATABLEMAX)
<br/>
      y = -ATABLEMAX;
<br/>
   if (x &lt; 0)
<br/>
      x = -x;
<br/>
   if (x &gt;= ATABLEMAX)
<br/>
      x = ATABLEMAX - 1;
<br/>
<br/>
   leftchannel  =  lefttable[x][y + ATABLEMAX];
<br/>
   rightchannel = righttable[x][y + ATABLEMAX];
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Life issues aside I'm looking at Wolf3d more as I can, but I cannot imagine what operation is supposed to be applied from the values in the table.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175968 - Ruben - Sat Mar 12, 2011 12:08 pm</h4>
    <div class="postbody"><span class="postbody">From the looks of it, it calculates the distance between an object and another and applies the according sound level for effects. I suppose the point of the table was speed rather than calculating the vector length.
<br/>
<br/>
EDIT:
<br/>
On further inspection, it appears to be an attenuation table - that is, the amount to SUBTRACT from the volume [ie, the further an object is, the more attenuation].</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175973 - Lazy1 - Sun Mar 13, 2011 9:18 pm</h4>
    <div class="postbody"><span class="postbody">Cool, looking at the original sources seem to confirm this as well as suggesting positioned sound was only done on the SBPro.
<br/>
Interesting stuff since I had no idea it supported the SBPro at all.
<br/>
<br/>
I guess the best way to modify this would be to make new tables except fill it with volume levels and play the same sound on 2 channels?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175975 - elhobbs - Mon Mar 14, 2011 12:56 am</h4>
    <div class="postbody"><span class="postbody">the ds sound channels support panning.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175976 - Lazy1 - Mon Mar 14, 2011 1:48 am</h4>
    <div class="postbody"><span class="postbody">It does, but I think volume adjustments are the way to go here.
<br/>
I just quickly hacked it in and the results so far are mixed:
<br/>
<br/>
Good: Doors in the distance sound quieter
<br/>
Bad: Non existent or unnoticeable left/right positioning 
<br/>
<br/>
I only have channels 11-15 to work with since 0-10 will be used by Pate's AdLib emulator.
<br/>
Even worse: I use 2 channels for this effect.
<br/>
<br/>
[Edit]
<br/>
Got it working well with 2 channels, but that sucks since there can only be 2 sounds at once.
<br/>
Maybe one channel can be used by combining the panning and expected volume levels somehow?
<br/>
<br/>
[Edit again]
<br/>
It seems to work but I'm not sure the magic numbers used to get the panning value really do anything.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void VolumePanningHack( int LeftVolume, int RightVolume, int* Volume, int* Panning ) {
<br/>
    /*
<br/>
     * Easiest case first, if Left == Right then center the sound.
<br/>
     */
<br/>
    if ( LeftVolume == RightVolume ) {
<br/>
        *Volume = LeftVolume;
<br/>
        *Panning = 64;
<br/>
    }
<br/>
    /*
<br/>
     * Left is louder than right, pan more to the left.
<br/>
     */
<br/>
    else if ( LeftVolume &gt; RightVolume ) {
<br/>
        *Volume = ( LeftVolume - ( LeftVolume - RightVolume ) );
<br/>
        *Panning = 63 - ( LeftVolume - RightVolume );
<br/>
    }
<br/>
    /*
<br/>
     * Right is louder than left, pan to the right.
<br/>
     */
<br/>
    else {
<br/>
        *Volume = ( RightVolume - ( RightVolume - LeftVolume ) );
<br/>
        *Panning = 64 + ( RightVolume - LeftVolume );
<br/>
    }
<br/>
<br/>
    if ( *Volume &lt; 0 ) *Volume = 0;
<br/>
    if ( *Volume &gt; 127 ) *Volume = 127;
<br/>
<br/>
    if ( *Panning &lt; 0 ) *Panning = 0;
<br/>
    if ( *Panning &gt; 127 ) *Panning = 127;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Quick sound code, DON'T JUDGE ME! /cry
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
int FindFreeSoundChannel( void ) {
<br/>
    int i;
<br/>
<br/>
    for ( i = 11; i &lt;= 15; i++ ) {
<br/>
        if ( ! ( SCHANNEL_CR( i ) &amp; SCHANNEL_ENABLE ) )
<br/>
            return i;
<br/>
    }
<br/>
<br/>
    return -1;
<br/>
}
<br/>
<br/>
void WolfSoundSVC( int ByteCount, void* UserData ) {
<br/>
    u32 Data[ 4 ];
<br/>
    int ChanL;
<br/>
    int ChanR;
<br/>
<br/>
    fifoGetDatamsg( FIFO_USER_02, sizeof( Data ), ( u8* ) Data );
<br/>
    ChanL = FindFreeSoundChannel( );
<br/>
    ChanR = FindFreeSoundChannel( );
<br/>
<br/>
    if ( ChanL &gt;= 11 &amp;&amp; ChanL &lt;= 15 &amp;&amp; ChanR &gt;= 11 &amp;&amp; ChanL &lt;= 15 ) {
<br/>
        SCHANNEL_SOURCE( ChanL ) = Data[ 0 ];
<br/>
        SCHANNEL_LENGTH( ChanL ) = Data[ 1 ] &gt;&gt; 2;
<br/>
        SCHANNEL_TIMER( ChanL ) = SOUND_FREQ( 7000 );
<br/>
<br/>
        SCHANNEL_SOURCE( ChanR ) = Data[ 0 ];
<br/>
        SCHANNEL_LENGTH( ChanR ) = Data[ 1 ] &gt;&gt; 2;
<br/>
        SCHANNEL_TIMER( ChanR ) = SOUND_FREQ( 7000 );
<br/>
<br/>
        SCHANNEL_CR( ChanL ) = SCHANNEL_ENABLE | SOUND_VOL( Data[ 2 ] ) | SOUND_PAN( 64 ) | SOUND_FORMAT_8BIT | SOUND_ONE_SHOT;
<br/>
        SCHANNEL_CR( ChanR ) = SCHANNEL_ENABLE | SOUND_VOL( Data[ 3 ] ) | SOUND_PAN( 64 ) | SOUND_FORMAT_8BIT | SOUND_ONE_SHOT;
<br/>
    }
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
///////////////////////////////////////////////////////////////////////////
<br/>
//
<br/>
//   SD_PlaySound() - plays the specified sound on the appropriate hardware
<br/>
//
<br/>
///////////////////////////////////////////////////////////////////////////
<br/>
boolean SD_PlaySound( soundnames sound ) {
<br/>
    //SoundCommon* sc = ( SoundCommon* ) audiosegs[ STARTADLIBSOUNDS + sound ];
<br/>
    int SoundPage;
<br/>
    int SoundLength;
<br/>
    void* SoundData;
<br/>
    int x, y;
<br/>
<br/>
    if ( DigiMap[ sound ] != -1 ) {
<br/>
        x = SoundIsPositioned == true ? LeftVolAdjust : 128;
<br/>
        y = SoundIsPositioned == true ? RightVolAdjust : 128;
<br/>
<br/>
        SoundPage = DigiList[ 0 + ( DigiMap[ sound ] * 2 ) ];
<br/>
        SoundLength = DigiList[ 1 + ( DigiMap[ sound ] * 2 ) ];
<br/>
<br/>
        PM_SetPageSize( SoundPage, SoundLength );
<br/>
        SoundData = ( void* ) PM_GetSoundPage( SoundPage );
<br/>
<br/>
        EmitSound( SoundData, SoundLength, x, y );
<br/>
        return true;
<br/>
    }
<br/>
<br/>
   return false;
<br/>
}
<br/>
<br/>
/*
<br/>
==========================
<br/>
=
<br/>
= SetSoundLoc - Given the location of an object (in terms of global
<br/>
=   coordinates, held in globalsoundx and globalsoundy), munges the values
<br/>
=   for an approximate distance from the left and right ear, and puts
<br/>
=   those values into leftchannel and rightchannel.
<br/>
=
<br/>
= JAB
<br/>
=
<br/>
==========================
<br/>
*/
<br/>
#define ATABLEMAX 15
<br/>
<br/>
static const byte RightVolTable[ ATABLEMAX ][ ATABLEMAX * 2 ] = {
<br/>
    { 8, 8, 8, 8, 8, 8, 8, 16, 16, 16, 16, 16, 16, 32, 128, 128, 128, 128, 128, 112, 80, 48, 8, 8, 8, 8, 8, 8, 8, 8},
<br/>
    { 8, 8, 8, 8, 8, 8, 8, 16, 16, 16, 16, 16, 32, 64, 128, 128, 128, 128, 128, 96, 64, 32, 8, 8, 8, 8, 8, 8, 8, 8},
<br/>
    { 8, 8, 8, 8, 8, 8, 8, 16, 16, 16, 16, 32, 32, 64, 112, 128, 128, 128, 112, 96, 64, 32, 8, 8, 8, 8, 8, 8, 8, 8},
<br/>
    { 8, 8, 8, 8, 8, 8, 8, 16, 16, 16, 16, 32, 48, 64, 96, 112, 128, 112, 96, 80, 48, 16, 8, 8, 8, 8, 8, 8, 8, 8},
<br/>
    { 8, 8, 8, 8, 8, 8, 8, 8, 16, 16, 16, 32, 48, 64, 80, 96, 96, 80, 80, 48, 32, 8, 8, 8, 8, 8, 8, 8, 8, 8},
<br/>
    { 8, 8, 8, 8, 8, 8, 8, 8, 16, 16, 16, 32, 32, 48, 64, 64, 64, 64, 48, 32, 16, 8, 8, 8, 8, 8, 8, 8, 8, 8},
<br/>
    { 8, 8, 8, 8, 8, 8, 8, 8, 8, 16, 16, 16, 32, 32, 48, 48, 48, 32, 32, 16, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8},
<br/>
    { 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 16, 16, 16, 32, 32, 16, 16, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8},
<br/>
    { 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8},
<br/>
    { 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8},
<br/>
    { 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8},
<br/>
    { 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8},
<br/>
    { 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8},
<br/>
    { 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8},
<br/>
    { 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8}
<br/>
};
<br/>
<br/>
static const byte LeftVolTable[ ATABLEMAX ][ ATABLEMAX * 2 ] = {
<br/>
    { 8, 8, 8, 8, 8, 8, 8, 8, 48, 80, 112, 128, 128, 128, 128, 128, 32, 128, 128, 128, 128, 128, 128, 8, 8, 8, 8, 8, 8, 8},
<br/>
    { 8, 8, 8, 8, 8, 8, 8, 8, 32, 64, 96, 128, 128, 128, 128, 128, 64, 32, 128, 128, 128, 128, 128, 8, 8, 8, 8, 8, 8, 8},
<br/>
    { 8, 8, 8, 8, 8, 8, 8, 8, 32, 64, 96, 112, 128, 128, 128, 112, 64, 32, 32, 128, 128, 128, 128, 8, 8, 8, 8, 8, 8, 8},
<br/>
    { 8, 8, 8, 8, 8, 8, 8, 8, 128, 48, 80, 96, 112, 128, 112, 96, 64, 48, 32, 128, 128, 128, 128, 8, 8, 8, 8, 8, 8, 8},
<br/>
    { 8, 8, 8, 8, 8, 8, 8, 8, 8, 32, 48, 80, 80, 96, 96, 80, 64, 48, 32, 128, 128, 128, 8, 8, 8, 8, 8, 8, 8, 8},
<br/>
    { 8, 8, 8, 8, 8, 8, 8, 8, 8, 128, 32, 48, 64, 64, 64, 64, 48, 32, 32, 128, 128, 128, 8, 8, 8, 8, 8, 8, 8, 8},
<br/>
    { 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 128, 32, 32, 48, 48, 48, 32, 32, 128, 128, 128, 8, 8, 8, 8, 8, 8, 8, 8, 8},
<br/>
    { 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 128, 128, 32, 32, 128, 128, 128, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8},
<br/>
    { 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8},
<br/>
    { 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8},
<br/>
    { 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8},
<br/>
    { 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8},
<br/>
    { 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8},
<br/>
    { 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8},
<br/>
    { 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8}
<br/>
};
<br/>
<br/>
static void SetSoundLoc(fixed gx, fixed gy)
<br/>
{
<br/>
   fixed xt, yt;
<br/>
   int x, y;
<br/>
<br/>
// translate point to view centered coordinates
<br/>
//
<br/>
   gx -= viewx;
<br/>
   gy -= viewy;
<br/>
<br/>
//
<br/>
// calculate newx
<br/>
//
<br/>
   xt = FixedByFrac(gx,viewcos);
<br/>
   yt = FixedByFrac(gy,viewsin);
<br/>
   x = (xt - yt) &gt;&gt; TILESHIFT;
<br/>
<br/>
//
<br/>
// calculate newy
<br/>
//
<br/>
   xt = FixedByFrac(gx,viewsin);
<br/>
   yt = FixedByFrac(gy,viewcos);
<br/>
   y = (yt + xt) &gt;&gt; TILESHIFT;
<br/>
<br/>
   if (y &gt;= ATABLEMAX)
<br/>
      y = ATABLEMAX - 1;
<br/>
   else if (y &lt;= -ATABLEMAX)
<br/>
      y = -ATABLEMAX;
<br/>
   if (x &lt; 0)
<br/>
      x = -x;
<br/>
   if (x &gt;= ATABLEMAX)
<br/>
      x = ATABLEMAX - 1;
<br/>
<br/>
    LeftVolAdjust = LeftVolTable[ x ][ y + ATABLEMAX ];
<br/>
    RightVolAdjust = RightVolTable[ x ][ y + ATABLEMAX ];
<br/>
}
<br/>
<br/>
void PlaySoundLocGlobal( word s, int id, fixed gx, fixed gy ) {
<br/>
    SoundIsPositioned = true;
<br/>
<br/>
    SetSoundLoc( gx, gy );
<br/>
    SD_PlaySound( s );
<br/>
<br/>
    SoundIsPositioned = false;
<br/>
}
<br/>
<br/>
void UpdateSoundLoc(fixed x, fixed y, int angle) {
<br/>
    /*
<br/>
     * Cannot implement this, sounds are fire and forget.
<br/>
     */
<br/>
}
<br/>
<br/>
void EmitSound( void* SoundBase, int Length, int LeftVol, int RightVol ) {
<br/>
    u32 Data[ 4 ];
<br/>
<br/>
    if ( SoundBase == NULL )
<br/>
        return;
<br/>
<br/>
    if ( LeftVol &lt; 0 ) LeftVol = 0;
<br/>
    if ( RightVol &lt; 0 ) RightVol = 0;
<br/>
<br/>
    if ( LeftVol &gt; 127 ) LeftVol = 127;
<br/>
    if ( RightVol &gt; 127 ) RightVol = 127;
<br/>
<br/>
    Data[ 0 ] = ( u32 ) SoundBase;
<br/>
    Data[ 1 ] = ( u32 ) Length;
<br/>
    Data[ 2 ] = ( u32 ) LeftVol;
<br/>
    Data[ 3 ] = ( u32 ) RightVol;
<br/>
<br/>
    fifoSendDatamsg( FIFO_USER_02, sizeof( Data ), ( u8* ) Data );
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Let me know if there are fatal flaws here, still getting back into things.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175981 - sverx - Mon Mar 14, 2011 12:56 pm</h4>
    <div class="postbody"><span class="postbody">to get the final volume you should add both values and subtract from 16, IMHO. So you'll get a volume 0-16 to give to the channel (0-127).
<br/>
For panning, subtract the left from the right and, this way it'll be -8...+8. multiply by 16 and add 63 :) Dirty method but should work :D</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
