<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>256X256 sprite map of 32x32 16bpp sprites? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > 256X256 sprite map of 32x32 16bpp sprites?</h2>
<div id="posts">
<div class="post">
    <h4>#93413 - TheRain - Wed Jul 19, 2006 12:47 am</h4>
    <div class="postbody"><span class="postbody">Hey guys, I'm trying to load in one big sprite bin file with multiple 32x32 sprites and I was wondering... how should one copy this into VRAM space and how does one assign them individually to sprites in OAM?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93437 - TheRain - Wed Jul 19, 2006 4:08 am</h4>
    <div class="postbody"><span class="postbody">or where can I find information on working with sprites besides the C++ tutorial (since I'm working in C)?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93449 - TheRain - Wed Jul 19, 2006 5:05 am</h4>
    <div class="postbody"><span class="postbody">ok, I've figured out that I needed to set  DISPLAY_SPR_2D_BMP_256 to get the 256x256 sprite map to map correctly... also I figured out that setting     
<br/>
<br/>
sprites[1].attribute[2] = ATTR2_ALPHA(1)| 128;
<br/>
<br/>
that 128 moves down to the 32x32 square below the first 32x32 square... so I'm guessing I'd go in 128 incriments to get to each one after that... 
<br/>
However, I can't seem to figure out how to get to the 32x32 square immediately right to the first 32x32 square..    This way of addressing these squares isn't making much sense to me... I just kept experimenting to get this far.   
<br/>
<br/>
Any hints?
<br/>
<br/>
I figured that if there are 8 in each colum and incrimenting 128 gets me to square two.... then incrimenting to square nine, or by 1024 would get me over to column 2... but this does not seem to be the case.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93459 - Valmond - Wed Jul 19, 2006 7:36 am</h4>
    <div class="postbody"><span class="postbody">If the sprite data makes you wonder, it's organised in 8x8 blocks
<br/>
something like this :
<br/>
<br/>
1 2 3 4
<br/>
5 6 7 8
<br/>
9 ...
<br/>
<br/>
where each number is a 8x8 block then.
<br/>
<br/>
There are converters though if you don't want to write your own one.
<br/>
<br/>
HTH
<br/>
<br/>
/Valmond</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93460 - TheRain - Wed Jul 19, 2006 8:17 am</h4>
    <div class="postbody"><span class="postbody">i'm using 32 x 32 blocks though.... I just figured it out though.  thanks for that info, I'm not really sure what it means but hopefully I'll understand you soon.   here's what I've got goin....
<br/>
<br/>
256x256 pixel bitmap with 16bit color, divided into 64 32x32 pixel sprites.   loading the bmp converted to bin file, I wanted to be able to map any sprite entry to any of those 64 32x32 sprites... like a 2-dimensional array.   
<br/>
<br/>
Luckily, there is a mode for this- DISPLAY_SPR_2D_BMP_256  
<br/>
<br/>
which is used like 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
    videoSetMode(  MODE_5_2D | 
<br/>
                   DISPLAY_SPR_ACTIVE |    //turn on sprites
<br/>
                   DISPLAY_BG3_ACTIVE |    //turn on background 3
<br/>
                   DISPLAY_SPR_2D_BMP_256     //2D BMP 256x256 sprite map
<br/>
                    );
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
then the sprite entry looks something like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
    sprites[0].attribute[0] = ATTR0_BMP | ATTR0_ROTSCALE_DOUBLE | 10; //bitmap mode sprite at y=10
<br/>
   sprites[0].attribute[1] = ATTR1_SIZE_32 | 20;   //32x32 sprite placed at x=20
<br/>
   sprites[0].attribute[2] = ATTR2_ALPHA(1)| SPRITE_LOCATION;   // where location is a value that will reference a 32x32 space in the 256x256 bitmap
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
now, what I figured out is that iterating through 32x32 blocks horizontally, you must multiply the block number by 4... and iterating through 32x32 block vertically, you must multiply the block number by 128....   so in the code above, SPRITE_LOCATION can be replaced with an equation and x and y variables like so 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   sprites[0].attribute[2] = ATTR2_ALPHA(1)| ((x*4)+(y*128));
<br/>
 </td> </tr></table><span class="postbody">
<br/>
<br/>
Now if I have a 256x256 bitmap of 32x32 sprites like the following 
<br/>
<a href="http://www.collinmeyermusic.com/sprite.jpg">[Images not permitted - Click here to view it]</a>
<br/>
x = 4 and y = 0 will get me to the number 5
<br/>
x = 0 and y = 1 will get me to the number 9
<br/>
x= 1 and y=1 will get me to the number 10  
<br/>
<br/>
and so on.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93463 - TheRain - Wed Jul 19, 2006 9:02 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Valmond wrote:</b></span></td> </tr> <tr> <td class="quote">If the sprite data makes you wonder, it's organised in 8x8 blocks
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Oh!  now i get what you're saying... and now the math above that I did makes more sense since if it was 8x8 sprites...  i wouldn't have to times x by 4 anymore ;)    Somehow this was really not making sense to me before.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93507 - Valmond - Wed Jul 19, 2006 4:35 pm</h4>
    <div class="postbody"><span class="postbody">So did it work out ?
<br/>
<br/>
/Valmond</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93509 - iainprice - Wed Jul 19, 2006 4:41 pm</h4>
    <div class="postbody"><span class="postbody">So how did you modify the code to convert to 8x8?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93513 - TheRain - Wed Jul 19, 2006 4:59 pm</h4>
    <div class="postbody"><span class="postbody">yes, it's working... thanks again for the info also!
<br/>
<br/>
<br/>
to iainprice....
<br/>
<br/>
I didn't modify the code to convert to 8x8.. what I was having trouble understanding toward the end there is how the coordinate system worked that was used to select which 32x32 square was shown in the sprite from the 256x256 map.   
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
int SPRITE_LOCATION;
<br/>
sprites[0].attribute[2] = ATTR2_ALPHA(1)| SPRITE_LOCATION; 
<br/>
</td> </tr></table><span class="postbody">
<br/>
basically, if you have a 2D bitmap of sprites.... increasing SPRITE_LOCATION from 0 to 1 will move you 8 pixels over on the x axis of your sprite map.... regardless of if you are using 8x8, 16x16, 32x32 or whatever pixel sprites.   Once you've iterated through the top row and reached 32, you will have moved to the next 8 pixel wide row down.    In a 32x32 map, in order to get to the next row down, you would have to move 128 steps..... because 32 divided by 8 is 4...  and 32 steps times 4 is 128.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93571 - iainprice - Wed Jul 19, 2006 10:51 pm</h4>
    <div class="postbody"><span class="postbody">Cheers</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93713 - iainprice - Thu Jul 20, 2006 9:19 pm</h4>
    <div class="postbody"><span class="postbody">Actually I'm still having a problem or two....the images are loading wrong...
<br/>
<br/>
I have a 256*256 pixel bmp with 256 colours. Converted to h file...
<br/>
<br/>
[code]
<br/>
for(i = 0; i &lt; 256; i++)
<br/>
SPRITE_PALETTE[i] = spritesPal[i];
<br/>
for(i = 0; i&lt; 32*16*64; i++)//64 sprites?
<br/>
SPRITE_GFX[i] = spritesTiles[i];
<br/>
<br/>
sprites[e_call_pet_s].oam = &amp;OAMCopySub[e_call_pet_s];
<br/>
sprites[i].oam-&gt;attribute[0] = ATTR0_COLOR_256 | ATTR0_SQUARE | ATTR0_BMP;
<br/>
sprites[e_call_pet_s].oam-&gt;attribute[1] = ATTR1_SIZE_32|e_call_pet_s;
<br/>
sprites[e_call_pet_s].oam-&gt;attribute[2] = ATTR2_ALPHA(1); 
<br/>
sprites[e_call_pet_s].x = 111&lt;&lt;8;
<br/>
sprites[e_call_pet_s].y = 98&lt;&lt;8;
<br/>
sprites[e_call_pet_s].gfxID = 0;[/code]
<br/>
<br/>
where e_call_pet_s is an enumerated type with value 0 for the first sprite.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93716 - TheRain - Thu Jul 20, 2006 9:39 pm</h4>
    <div class="postbody"><span class="postbody">What data type is your tile data stored under?  it may need to be type casted...    also, can you explain more about the result you are getting?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93726 - iainprice - Thu Jul 20, 2006 10:14 pm</h4>
    <div class="postbody"><span class="postbody">[code]
<br/>
const unsigned short spritesTiles[32768]=
<br/>
{
<br/>
	0xFDFD,0xFDFD,0xFDFD,0xFDFD,0xFDFD,0xFDFD,0xFDFD,0xFBFD,
<br/>
[/code]
<br/>
<br/>
The sprites just seem to be the first row of eight across the top then a row eight high of white, then the next row eight high......
<br/>
<br/>
[/code]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93728 - TheRain - Thu Jul 20, 2006 10:27 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>iainprice wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<br/>
I have a 256*256 pixel bmp with 256 colours. Converted to h file...
<br/>
<br/>
for(i = 0; i&lt; 32*16*64; i++)//64 sprites?
<br/>
SPRITE_GFX[i] = spritesTiles[i];
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
to initialize SPRITE_GFX to your 256x256 space... you will want to do a for loop like this, i believe:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
for(i=0; i&lt;256*256;i++)
<br/>
SPRITE_GFX[i] = spritesTiles[i];
<br/>
</td> </tr></table><span class="postbody">
<br/>
then the data type of the sprites will determine what gets copied... since you are in 256 color mode with your sprite, you probably would consider SPRITE_GFX as a u8*  ??   I'm not totally sure about that, it may also be a u16* regardless of what your sprite mode is set to.... so then whatever your spriteTiles data type is, you'll want to type cast it to whatever SPRITE_GFX data type is in your code for copying the data here...   see the bitmap sprite example in the libnds examples to get an idea.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93729 - iainprice - Thu Jul 20, 2006 10:34 pm</h4>
    <div class="postbody"><span class="postbody">No change.
<br/>
<br/>
I have had a single 32*32 sprite working but am trying to convert to 256*256.
<br/>
<br/>
What does ATTR2_ALPHA do?
<br/>
<br/>
Also 
<br/>
sprites[i].oam-&gt;attribute[0] = ATTR0_COLOR_256 | ATTR0_SQUARE | ATTR0_BMP; 
<br/>
is different to the 32*32 code I used.....</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93732 - TheRain - Thu Jul 20, 2006 10:43 pm</h4>
    <div class="postbody"><span class="postbody">it appears, to me, that your data is 8 bit data being represented in pairs as 16 bit words...   
<br/>
<br/>
It appears that there are 32768 entries of these words.... and so if SPRITE_GFX is a u16*  maybe you should try this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
for(i=0; i&lt;256*128;i++)    // 258 * 128 = 32768
<br/>
SPRITE_GFX[i] = spritesTiles[i]; 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
And if that doesn't work, maybe try type casting ((u16*)spriteTiles)[i].</span><span class="gensmall"><br/><br/>Last edited by TheRain on Thu Jul 20, 2006 10:48 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#93735 - TheRain - Thu Jul 20, 2006 10:47 pm</h4>
    <div class="postbody"><span class="postbody">"What does ATTR2_ALPHA do? "
<br/>
<br/>
setting attr2_alpha to 1 makes it so that alpha bits are recognized and transparency is set accordingly.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93740 - iainprice - Thu Jul 20, 2006 11:01 pm</h4>
    <div class="postbody"><span class="postbody">Actually... I get 32 wide, 8 high correct, then the next row of 8 is from x=128 pixels, y=0. It was just that the area was white on my bmp.
<br/>
<br/>
<br/>
For the 256*256 it gets the first 32*32 sprite using:
<br/>
<br/>
32*8      skip        skip       skip     32*8   skip   skip   skip
<br/>
32*8      skip        skip       skip     32*8   skip   skip   skip</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93762 - TheRain - Fri Jul 21, 2006 2:08 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>TheRain wrote:</b></span></td> </tr> <tr> <td class="quote">"What does ATTR2_ALPHA do? "
<br/>
<br/>
setting attr2_alpha to 1 makes it so that alpha bits are recognized and transparency is set accordingly.</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
Actually, I think this works with the alpha blending modes not the alpha bit... because I tried turning it off and it didn't turn off the recognition of my alpha bits.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93847 - iainprice - Fri Jul 21, 2006 5:32 pm</h4>
    <div class="postbody"><span class="postbody">I think I'm having problems with:
<br/>
<br/>
sprites[e_call_pet_s].oam = &amp;OAMCopySub[e_call_pet_s]; 
<br/>
<br/>
<br/>
because I was copying 32*32 into 32*32... now I have 256*256 and I need just 32*32 of it.
<br/>
<br/>
How do I do that?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93854 - TheRain - Fri Jul 21, 2006 5:54 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>iainprice wrote:</b></span></td> </tr> <tr> <td class="quote">I think I'm having problems with:
<br/>
<br/>
sprites[e_call_pet_s].oam = &amp;OAMCopySub[e_call_pet_s]; 
<br/>
<br/>
<br/>
because I was copying 32*32 into 32*32... now I have 256*256 and I need just 32*32 of it.
<br/>
<br/>
How do I do that?</td> </tr></table><span class="postbody">
<br/>
<br/>
That is just copying attributes... not pixel data.   It looks like your code is initializing each sprite individually anyway, so you may not need to do the OAM copy routine.
<br/>
<br/>
But...    I think your problem may be in the format of your pixel data.  What tool did you use to convert your image?   
<br/>
<br/>
It looks as though your image is in tile format... try making a regular bitmap format one...   even though your sprites are organized into square blocks, it's read into the buffer as one large 256x256 bitmap... not as tiles.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93880 - iainprice - Fri Jul 21, 2006 7:57 pm</h4>
    <div class="postbody"><span class="postbody">I re-exported the 256*256 as it was tiled, now it is bmp - I use usenti.
<br/>
<br/>
I copy the data using:
<br/>
dmaCopy(spritesBitmap, SPRITE_GFX, 256*256);
<br/>
<br/>
I then use the data:
<br/>
sprites[e_call_pet_s].oam = &amp;OAMCopySub[e_call_pet_s];
<br/>
sprites[e_call_pet_s].oam-&gt;attribute[1] = ATTR1_SIZE_32;
<br/>
sprites[e_call_pet_s].oam-&gt;attribute[2] = ATTR2_ALPHA(1)|e_call_pet_s; 
<br/>
sprites[e_call_pet_s].x = 111&lt;&lt;8;
<br/>
sprites[e_call_pet_s].y = 98&lt;&lt;8;
<br/>
sprites[e_call_pet_s].gfxID = 0;
<br/>
<br/>
and enable the sprite with:
<br/>
sprites[i].oam-&gt;attribute[0] = ATTR0_BMP | ATTR0_SQUARE;
<br/>
<br/>
previously it was not BMP but 256 tiled...
<br/>
<br/>
now the sprites are just mashed up... :(
<br/>
<br/>
Not having fun any more....</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93906 - TheRain - Fri Jul 21, 2006 10:37 pm</h4>
    <div class="postbody"><span class="postbody">smashed up... as in... maybe your rotational properties are wrong?  or smashed up as in data is not formatted correctly...
<br/>
<br/>
btw... I did this with a 256 color bitmap last night, exported from usenti as a bitmap in a .c file... so you should be close.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93991 - iainprice - Sat Jul 22, 2006 10:39 am</h4>
    <div class="postbody"><span class="postbody">You mentioned rotational properties.....
<br/>
<br/>
The one difference I have to your code is that you use:
<br/>
sprites[0].attribute[0] = ATTR0_BMP | ATTR0_ROTSCALE_DOUBLE | 10; //bitmap mode sprite at y=10 
<br/>
<br/>
and I use:
<br/>
<br/>
sprites[0].attribute[0] = ATTR0_BMP | ATTR0_SQAURE;
<br/>
<br/>
My code gives mixed up 32*32 sprites, yours gives 64*64 purple boxes......</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#94064 - TheRain - Sat Jul 22, 2006 8:28 pm</h4>
    <div class="postbody"><span class="postbody">here's what my properties look like (in C, not C++) for a 256 color sprite.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
sprites[0].attribute[0] = ATTR0_COLOR_256| 80; // 256 color placed at Y=80
<br/>
sprites[0].attribute[1] = ATTR1_SIZE_32 | 96;  // 32x32 sprite placed at X=96
<br/>
sprites[0].attribute[2] =  ATTR2_ALPHA(1)|0; // choose first sprite location from bitmap.
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#94075 - iainprice - Sat Jul 22, 2006 9:54 pm</h4>
    <div class="postbody"><span class="postbody">TheRain,
<br/>
<br/>
I decided to start from scratch using the bitmap example from ndslib. I was previously using a different sprite structure.
<br/>
<br/>
Most of it is working but the sprites displayed are still messed up.
<br/>
<br/>
Is there any chance you could send me a text file with all the sprite stuff... definitions, bmp.c file, everything?
<br/>
<br/>
Sorry to be such a pain but this is really annoying me now....
<br/>
<br/>
Thanks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#94117 - TheRain - Sun Jul 23, 2006 3:05 am</h4>
    <div class="postbody"><span class="postbody">here is a tile mode 256x256, 256 Color, 32x32 tile size demo I made up just now... 
<br/>
<br/>
in usenti, to get the tiles to align properly you must set up some special tile properties.     
<br/>
<br/>
In the GBA export screen, under tile groups check the "cstm" box and enter 16x16 ... 
<br/>
<br/>
<a href="http://www.collinmeyermusic.com/SpritesPrice.zip" target="_blank">http://www.collinmeyermusic.com/SpritesPrice.zip</a>
<br/>
<br/>
in the demo I am providing here, use the A and B buttons to scroll through the horizontal axis... you'll notice once you scroll through to the end of the first horizontal row you will drop down on the y axis some, but not quite large enough to get to the next row... you'll have to play with it a little to figure out what the actual values should be. 
<br/>
<br/>
good luck!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#94125 - Turambar - Sun Jul 23, 2006 4:19 am</h4>
    <div class="postbody"><span class="postbody">I think you forgot to include guiset1.h.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#94128 - TheRain - Sun Jul 23, 2006 4:54 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Turambar wrote:</b></span></td> </tr> <tr> <td class="quote">I think you forgot to include guiset1.h.</td> </tr></table><span class="postbody">
<br/>
<br/>
i meant to alter it to not use it... should be good now.   
<br/>
<br/>
testing it a bit more, I think there's some bugs with this solution too...   i haven't found a good solution.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#94156 - iainprice - Sun Jul 23, 2006 1:16 pm</h4>
    <div class="postbody"><span class="postbody">Thank you for all your help.
<br/>
<br/>
I have just about got everything sorted now.
<br/>
<br/>
I had converted my code to bmp and usenti to bmp.... now I have converted back to tiles AND use 16*16 for the cstm setting.
<br/>
<br/>
I still need to sort out different sprites on the main and sub screens but I can sort that. 
<br/>
<br/>
Thanks again for all your help.....</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
