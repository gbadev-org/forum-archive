<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Program Structure for Sound - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > Program Structure for Sound</h2>
<div id="posts">
<div class="post">
    <h4>#43592 - Pacifist - Wed May 25, 2005 12:00 am</h4>
    <div class="postbody"><span class="postbody">Since the ARM7 runs the sounds and my game is on the ARM9 I need a way to tell the ARM7 when to play sounds.
<br/>
<br/>
Is there a good way to do this?  The only method that springs to mind is adding things to the IPC but I don't like the sound of that at all.
<br/>
<br/>
Forgive me if if this has been discussed and I just haven't dug enough.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#43603 - tepples - Wed May 25, 2005 2:34 am</h4>
    <div class="postbody"><span class="postbody">The Super NES had an IPC only four bytes wide in each direction. Just be glad you're not coding on that.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#43848 - DekuTree64 - Fri May 27, 2005 8:44 am</h4>
    <div class="postbody"><span class="postbody">Yeah, I did it with an IPC-type structure, just placed right after the IPC:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   // Commands filled out by ARM9 to tell ARM7 what to do
<br/>
typedef struct _SND_COMMAND
<br/>
{
<br/>
   u8 cmdType;   // SND_COMMAND_TYPE enum
<br/>
   u8 param[3];   // Depend on cmdType
<br/>
   u32 param32;   // Mainly for commands that need to send a pointer
<br/>
<br/>
} SND_COMMAND;
<br/>
<br/>
   // Processor communication area
<br/>
typedef struct _SND_CONTROL
<br/>
{
<br/>
   SND_COMMAND   cmd[MAX_SND_COMMANDS];
<br/>
   u8      curCmd;
<br/>
   BOOL      bInitialized;
<br/>
<br/>
} SND_CONTROL;
<br/>
<br/>
#define sndControl ((SND_CONTROL*)(IPC_ADDR + sizeof(TransferRegion)))</td> </tr></table><span class="postbody">
<br/>
<br/>
Then ARM9 writes commands to that buffer, and then increments the curCmd. ARM7 checks curCmd every frame and compares it to its own current command index to see if any new ones have been sent.
<br/>
<br/>
The command struct is pretty arbitrary, I just set up the params that way so it's nice and 4-byte aligned, and has 4 bytes worth of param so ARM9 can send pointers to song data and stuff.
<br/>
<br/>
Hopefully I'll be able to release the MOD player that uses it in the next couple of days, maybe get some music going in any GBAX entries that wouldn't have time for sound otherwise :)
<br/>
Just gotta speed up the pattern loading (it uses straight .mod files, so it has to convert periods in the pattern data into note numbers, and currently uses a dumb loop that takes several frames to run...), and get things tidied up a little.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#43871 - Pacifist - Fri May 27, 2005 3:27 pm</h4>
    <div class="postbody"><span class="postbody">Yeah this is exactly what I ended up doing.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
