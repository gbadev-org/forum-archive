<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Windowing constants not in libnds? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Windowing constants not in libnds?</h2>
<div id="posts">
<div class="post">
    <h4>#162725 - gauauu - Thu Sep 11, 2008 4:01 am</h4>
    <div class="postbody"><span class="postbody">Am I missing something, or is there a reason that the bit values for the various items for windows aren't in libnds?  
<br/>
<br/>
The registers for windows are (WIN_IN, WIN_OUT, etc), but no constants are defined for writing to those registers.
<br/>
<br/>
For example, for blending, BLEND_SRC_BG0, BLEND_SRC_BG1, etc, are defined.  But, unless I'm missing them, there's no constants to make writing to the windowing registers easier.
<br/>
<br/>
Not a big deal, as it's pretty easy to write the correct bits based on the specs, but it seems like this was omitted where other similar constants were defined. 
<br/>
<br/>
Thoughts?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#162745 - dovoto - Thu Sep 11, 2008 9:47 pm</h4>
    <div class="postbody"><span class="postbody">I will take a look at this for the next release.  It will probably be wrapped in an accessor but I will add register definitions for those that prefer to set registers directly.
<br/>
<br/>
If you have allready created some and they make sense feel free to post them here and I will look at getting them into the next release.<br/>_________________<br/><a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#162747 - gauauu - Thu Sep 11, 2008 10:13 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>dovoto wrote:</b></span></td> </tr> <tr> <td class="quote">If you have allready created some and they make sense feel free to post them here and I will look at getting them into the next release.</td> </tr></table><span class="postbody">
<br/>
<br/>
I've been using accessors also:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define WIN_BG0    (1&lt;&lt;0)
<br/>
#define WIN_BG1    (1&lt;&lt;1)
<br/>
#define WIN_BG2    (1&lt;&lt;2)
<br/>
#define WIN_BG3    (1&lt;&lt;3)
<br/>
#define WIN_OBJ    (1&lt;&lt;4)
<br/>
#define WIN_BLEND  (1&lt;&lt;5)
<br/>
<br/>
void setWinObjItems(uint8 items)
<br/>
{
<br/>
   WIN_OUT = (WIN_OUT &amp; 0x003F) | (items &lt;&lt; 8);
<br/>
}
<br/>
<br/>
void setWinOutItems(uint8 items)
<br/>
{
<br/>
   WIN_OUT = (WIN_OUT &amp; 0x3F00) | (items);
<br/>
}
<br/>
<br/>
void setWin0Items(uint8 items)
<br/>
{
<br/>
   WIN_IN = (WIN_IN &amp; 0x3F00) | (items);
<br/>
}
<br/>
<br/>
void setWin1Items(uint8 items)
<br/>
{
<br/>
   WIN_IN = (WIN_IN &amp; 0x003F) | (items &lt;&lt; 8);
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
(Although I'm not sure that my term "items" is the best term for it)
<br/>
<br/>
You could go farther and define pre-bitshifted versions of everything, but it seems a bit too cluttered and verbose to me:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define WIN0_BG0    WIN_BG0
<br/>
#define WIN0_BG1    WIN_BG1
<br/>
#define WIN0_BG2    WIN_BG2
<br/>
#define WIN0_BG3    WIN_BG3
<br/>
#define WIN0_OBJ    WIN_OBJ
<br/>
#define WIN0_BLEND  WIN_BLEND
<br/>
<br/>
#define WIN1_BG0    (WIN_BG0 &lt;&lt; 8)
<br/>
#define WIN1_BG1    (WIN_BG1 &lt;&lt; 8)
<br/>
#define WIN1_BG2    (WIN_BG2 &lt;&lt; 8)
<br/>
#define WIN1_BG3    (WIN_BG3 &lt;&lt; 8)
<br/>
#define WIN1_OBJ    (WIN_OBJ &lt;&lt; 8)
<br/>
#define WIN1_BLEND  (WIN_BLEND &lt;&lt; 8)
<br/>
<br/>
//...etc
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#162753 - tepples - Fri Sep 12, 2008 12:02 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>dovoto wrote:</b></span></td> </tr> <tr> <td class="quote">I will take a look at this for the next release.  It will probably be wrapped in an accessor but I will add register definitions for those that prefer to set registers directly.</td> </tr></table><span class="postbody">
<br/>
You're right. Accessors are nice, but exclusively using accessors doesn't work too well for defining the shape or content of a window with HDMA.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#162759 - Cearn - Fri Sep 12, 2008 2:59 pm</h4>
    <div class="postbody"><span class="postbody">You don't really need pre-shifted bits if the windowing registers are mapped to bytes instead of halfwords. 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">//! \name Windowing registers in bytes
<br/>
//\{
<br/>
#define REG_WIN0R           *(vu8*)(0x04000040)     //!&lt; Win 0 right
<br/>
#define REG_WIN0L           *(vu8*)(0x04000041)     //!&lt; Win 0 left
<br/>
#define REG_WIN1R           *(vu8*)(0x04000042)     //!&lt; Win 1 right
<br/>
#define REG_WIN1L           *(vu8*)(0x04000043)     //!&lt; Win 1 left
<br/>
<br/>
#define REG_WIN0B           *(vu8*)(0x04000044)     //!&lt; Win 0 bottom
<br/>
#define REG_WIN0T           *(vu8*)(0x04000045)     //!&lt; Win 0 top
<br/>
#define REG_WIN1B           *(vu8*)(0x04000046)     //!&lt; Win 1 bottom
<br/>
#define REG_WIN1T           *(vu8*)(0x04000047)     //!&lt; Win 1 top
<br/>
<br/>
#define REG_WIN0CNT         *(vu8*)(0x04000048)     //!&lt; Window 0 control
<br/>
#define REG_WIN1CNT         *(vu8*)(0x04000049)     //!&lt; Window 1 control
<br/>
#define REG_WINOUTCNT       *(vu8*)(0x0400004A)     //!&lt; Out window control
<br/>
#define REG_WINOBJCNT       *(vu8*)(0x0400004B)     //!&lt; Obj window control
<br/>
//\}
<br/>
<br/>
//! \name Window control bits
<br/>
//\{
<br/>
#define WIN_ALL            (31&lt;&lt; 0)     //&lt;! All layers in window
<br/>
#define WIN_BG0            ( 1&lt;&lt; 0)     //&lt;! Windowed bg 0
<br/>
#define WIN_BG1            ( 1&lt;&lt; 1)     //&lt;! Windowed bg 1
<br/>
#define WIN_BG2            ( 1&lt;&lt; 2)     //&lt;! Windowed bg 2
<br/>
#define WIN_BG3            ( 1&lt;&lt; 3)     //&lt;! Windowed bg 3
<br/>
#define WIN_OBJ            ( 1&lt;&lt; 4)     //&lt;! Windowed objects
<br/>
#define WIN_BLEND          ( 1&lt;&lt; 5)     //&lt;! Windowed blending
<br/>
//\}
<br/>
<br/>
<br/>
//! Set Window 0 mode.
<br/>
static inline void win0SetMode(u32 mode)
<br/>
{
<br/>
    REG_WIN0CNT= mode;
<br/>
}
<br/>
<br/>
etc
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
You can also map the control registers to a byte array and use control everything through a single function.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define REG_WINCNT      ((vu8*)(0x04000048))    //!&lt; Window control registers
<br/>
<br/>
enum WinType {  WINID_0= 0, WINID_1, WINID_OUT, WINID_OBJ   };
<br/>
<br/>
static inline void winSetMode(u32 id, u32 mode)
<br/>
{
<br/>
    REG_WINCNT[id]= mode;
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#162760 - gauauu - Fri Sep 12, 2008 3:19 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cearn wrote:</b></span></td> </tr> <tr> <td class="quote">You don't really need pre-shifted bits if the windowing registers are mapped to bytes instead of halfwords. </td> </tr></table><span class="postbody">
<br/>
<br/>
True.  Right now, in libnds, the window position registers are mapped to bytes, but the window control registers are mapped to halfwords.  (Not that this couldn't change, but that's why my brain was going from that direction)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#162769 - a128 - Fri Sep 12, 2008 5:10 pm</h4>
    <div class="postbody"><span class="postbody">great..but I was never able to get those window stuff working..any examples?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#162771 - gauauu - Fri Sep 12, 2008 5:31 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>a128 wrote:</b></span></td> </tr> <tr> <td class="quote">great..but I was never able to get those window stuff working..any examples?</td> </tr></table><span class="postbody">
<br/>
<br/>
Check out <a class="postlink" href="http://www.coranac.com/tonc/text/gfx.htm#sec-win" target="_blank">Tonc's information about it</a>.  Libnds uses different names for the registers, but other than that, the GBA handling of windows is almost identical to the DS.
<br/>
<br/>
There is this glitch, though, mentioned in gbatek:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
DS Window Glitches
<br/>
The DS counts scanlines in range 0..262 (0..106h), of which only the lower 8bit are compared with the WIN0V/WIN1V register settings. Respectively, Y1 coordinates 00h..06h will be triggered in scanlines 100h-106h by mistake. That means, the window gets activated within VBlank period, and will be active in scanline 0 and up (that is no problem with Y1=0, but Y1=1..6 will appear as if if Y1 would be 0). Workaround would be to disable the Window during VBlank, or to change Y1 during VBlank (to a value that does not occur during VBlank period, ie. 7..191).
<br/>
Also, there's a problem to fit the 256 pixel horizontal screen resolution into 8bit values: X1=00h is treated as 0 (left-most), X2=00h is treated as 100h (right-most). However, the window is not displayed if X1=X2=00h; the window width can be max 255 pixels.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
For more examples, Cearn posted some code of how to use hblank dma to make a cool circular window effect in <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=9023" target="_blank">this thread</a>.  Again, GBA code, but should help.
<br/>
<br/>
Also, I've got some simple windowing code from the DS port of Anguna I'm working on that I could share with you if you are interested (a black screen other than a small window specified by absolute coordinates, and another small window from a sprite mask).  Not going to waste the space posting it here, but if you're still stuck, send me a message, and I can send you relevant code.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
