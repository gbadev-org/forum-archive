<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>problem with showing bgs - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > problem with showing bgs</h2>
<div id="posts">
<div class="post">
    <h4>#44548 - b0on - Thu Jun 02, 2005 8:14 pm</h4>
    <div class="postbody"><span class="postbody">After trying forever to get a sprite to work onscreen, i tried to put a bg, but all it shows is scrambled stuff.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">for(i=0; i&lt;256; i++) { BG_PALETTE_SUB[i] = bg_palette[i]; }
<br/>
for(i=0; i&lt;(49152); i++) { BG_GFX_SUB[i] = bg_data[i]; }</td> </tr></table><span class="postbody">
<br/>
what did i do wrong?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44551 - josath - Thu Jun 02, 2005 8:21 pm</h4>
    <div class="postbody"><span class="postbody">wow you told us almost nothing besides "it shows scrambled stuff" and then you only post two lines from your code? you don't say what screen mode you are using, what the graphics are, how you converted them, what format you converted them or anything. these would help others to figure out what is wrong.
<br/>
<br/>
my only guess is you didn't convert the graphics correctly.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44553 - strager - Thu Jun 02, 2005 8:25 pm</h4>
    <div class="postbody"><span class="postbody">Maybe you need to change the pallet of each tile, or set the pallet mode in BGxCNT.  And, as josath said, please post more information.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44824 - b0on - Sun Jun 05, 2005 8:59 pm</h4>
    <div class="postbody"><span class="postbody">sorry, i was in hurry.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
//Custom defines 
<br/>
#define REG_VCOUNT *(vu16*)0x4000006 //Our good old vblank counter 
<br/>
<br/>
//System includes 
<br/>
#include &lt;NDS/NDS.h&gt; 
<br/>
Â 
<br/>
//------------------------------------------------------------------- 
<br/>
<br/>
//OAM globals 
<br/>
sSpriteEntry OAMCopy[128]; 
<br/>
sSpriteEntry OAMCopySub[128]; 
<br/>
<br/>
//Sprite structure 
<br/>
typedef struct 
<br/>
{ 
<br/>
int x,y; //location 
<br/>
int xSpeed, ySpeed; //speed 
<br/>
sSpriteEntry* oam; 
<br/>
}Sprite; 
<br/>
<br/>
//------------------------------------------------------------------- 
<br/>
<br/>
//Moves a sprite in OAM memory 
<br/>
void MoveSprite(Sprite* sp) 
<br/>
{ 
<br/>
int x = sp-&gt;x &gt;&gt; 8; 
<br/>
int y = sp-&gt;y &gt;&gt; 8; 
<br/>
<br/>
sp-&gt;oam-&gt;attribute[1] &amp;= 0xFE00; 
<br/>
sp-&gt;oam-&gt;attribute[1] |= x; 
<br/>
<br/>
sp-&gt;oam-&gt;attribute[0] &amp;= 0xFF00; 
<br/>
sp-&gt;oam-&gt;attribute[0] |= y; 
<br/>
<br/>
} 
<br/>
//------------------------------------------------------------------- 
<br/>
<br/>
//Initializes the sprites 
<br/>
void NextSprite(Sprite* sp, int number) 
<br/>
{ 
<br/>
<br/>
sp-&gt;x += sp-&gt;xSpeed; 
<br/>
sp-&gt;y += sp-&gt;ySpeed; 
<br/>
if(sp-&gt;x &lt; 256 || sp-&gt;x &gt; 61440) { sp-&gt;xSpeed=-sp-&gt;xSpeed; } 
<br/>
if(sp-&gt;y &lt; 256 || sp-&gt;y &gt; 45056) { sp-&gt;ySpeed=-sp-&gt;ySpeed; } 
<br/>
<br/>
<br/>
} 
<br/>
<br/>
//------------------------------------------------------------------- 
<br/>
<br/>
//Initialises OAM, moving all sprites offscreen 
<br/>
void initOAM(void) 
<br/>
{ 
<br/>
int i; 
<br/>
<br/>
for(i = 0; i &lt; 128; i++) 
<br/>
{ 
<br/>
OAMCopy[i].attribute[0] = ATTR0_DISABLED; 
<br/>
OAMCopySub[i].attribute[0] = ATTR0_DISABLED; 
<br/>
} 
<br/>
} 
<br/>
<br/>
//------------------------------------------------------------------- 
<br/>
<br/>
//Copies OAM buffer to actual OAM memory space 
<br/>
void updateOAM(void) 
<br/>
{ 
<br/>
int i; 
<br/>
<br/>
for(i = 0; i &lt; 128 * sizeof(sSpriteEntry) / 4 ; i++) 
<br/>
{ 
<br/>
((uint32*)OAM)[i] = ((uint32*)OAMCopy)[i]; 
<br/>
((uint32*)OAM_SUB)[i] = ((uint32*)OAMCopySub)[i]; 
<br/>
} 
<br/>
} 
<br/>
<br/>
//------------------------------------------------------------------- 
<br/>
<br/>
//Entry point- this is where we start! 
<br/>
int main(int argc, char ** argv) { 
<br/>
<br/>
int i=0; 
<br/>
<br/>
//turn on the power to the system 
<br/>
powerON(POWER_ALL); 
<br/>
videoSetMode( MODE_0_2D | DISPLAY_SPR_1D_LAYOUT | DISPLAY_SPR_ACTIVE | DISPLAY_BG0_ACTIVE ); 
<br/>
videoSetModeSub(MODE_0_2D | DISPLAY_SPR_1D_LAYOUT | DISPLAY_SPR_ACTIVE | DISPLAY_BG0_ACTIVE ); 
<br/>
/* 
<br/>
VRAM_A_CR = VRAM_ENABLE | VRAM_ARM9 | VRAM_CORE_A; 
<br/>
VRAM_B_CR = VRAM_ENABLE | VRAM_ARM9 | VRAM_CORE_A; 
<br/>
VRAM_C_CR = VRAM_ENABLE | VRAM_ARM9 | VRAM_CORE_B; 
<br/>
VRAM_D_CR = VRAM_ENABLE | VRAM_ARM9 | VRAM_CORE_B; 
<br/>
vramSetMainBanks(VRAM_A_MAIN_BG,VRAM_B_MAIN_SPRITE,VRAM_C_SUB_BG,VRAM_D_SUB_SPRITE); 
<br/>
*/ 
<br/>
<br/>
<br/>
//Set screens to black initially 
<br/>
//BG_PALETTE[0] = RGB15( 31, 21, 11); //Main screen 
<br/>
//BG_PALETTE_SUB[0] = RGB15( 11, 21, 31);//Top screen
<br/>
// BGs not working
<br/>
for(i=0; i&lt;256; i++) { BG_PALETTE_SUB[i] = bg_palette[i]; }
<br/>
for(i=0; i&lt;(49152); i++) { BG_GFX_SUB[i] = bg_data[i]; }
<br/>
<br/>
<br/>
//------------------------------------------------------------------- 
<br/>
<br/>
//Main game loop 
<br/>
bool exitFlag = false; 
<br/>
while (!exitFlag) 
<br/>
{
<br/>
<br/>
//swiWaitForVBlank(); 
<br/>
while(REG_VCOUNT != 190) {;} 
<br/>
<br/>
updateOAM(); 
<br/>
} 
<br/>
<br/>
return 0; 
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
I cant find a host to host images...
<br/>
josath dont get angry at me :P</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44831 - DekuTree64 - Sun Jun 05, 2005 9:38 pm</h4>
    <div class="postbody"><span class="postbody">2 things I noticed after a quick read:
<br/>
1. Why is your VRAM bank allocation commented out?
<br/>
2: You're not setting BG0CNT to tell it where your map and tile data are. That means the screen block is set to 0, and char block to 0 as well...
<br/>
But judging by the size of the data you're loading, is it a bitmap? Still need to set BG0CNT for that.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44868 - b0on - Mon Jun 06, 2005 10:09 am</h4>
    <div class="postbody"><span class="postbody">1) When i try to compile it in ndsdev, it doesn't recognize Vram_core_a and b and c and d.
<br/>
2)how do i set bg0cnt?
<br/>
<br/>
thanks anyway for ur help</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44871 - Ethos - Mon Jun 06, 2005 1:08 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>b0on wrote:</b></span></td> </tr> <tr> <td class="quote">1) When i try to compile it in ndsdev, it doesn't recognize Vram_core_a and b and c and d.
<br/>
2)how do i set bg0cnt?
<br/>
<br/>
thanks anyway for ur help</td> </tr></table><span class="postbody">
<br/>
<br/>
1) Uncomment only:
<br/>
vramSetMainBanks(VRAM_A_MAIN_BG,VRAM_B_MAIN_SPRITE,VRAM_C_SUB_BG,VRAM_D_SUB_SPRITE); 
<br/>
<br/>
2) Well I don't see where you are getting your palette or bg data from?
<br/>
    No includes at top of program.  Also in Mode 0 you have to load tiles and a map, and set the Control Register appropriately.<br/>_________________<br/><a class="postlink" href="http://ethos.oddigytitanium.com" target="_blank">Ethos' Homepage (Demos/NDS 3D Tutorial)</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44889 - b0on - Mon Jun 06, 2005 4:22 pm</h4>
    <div class="postbody"><span class="postbody">i forgot to add #include resources/bg.h
<br/>
so if i have the map data, what do i do?
<br/>
which mode allows to put bgs without maps?
<br/>
<br/>
<br/>
thanks again a lot</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#45899 - b0on - Thu Jun 16, 2005 9:08 am</h4>
    <div class="postbody"><span class="postbody">Since noone replied, could someone please just post an example(or code) that just shows a bg.
<br/>
thanks again alot.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#45956 - arog - Fri Jun 17, 2005 4:13 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Since noone replied, could someone please just post an example(or code) that just shows a bg.</td> </tr></table><span class="postbody">
<br/>
<br/>
Did you go through any of the examples that come with ndslib?
<br/>
<br/>
Here's a modified version of one of dovoto's 256 color backgrounds I made: 
<br/>
<a class="postlink" href="http://www.aaronrogers.com/nintendods/temp/256_color_bmp.zip" target="_blank">http://www.aaronrogers.com/nintendods/temp/256_color_bmp.zip</a>
<br/>
<br/>
Screenshot here: 
<br/>
<a href="http://www.aaronrogers.com/nintendods/temp/dk_bmp_x2.png">[Images not permitted - Click here to view it]</a>
<br/>
<br/>
I haven't tested/updated it with the latest ndslib, so who knows if it still works.  :)
<br/>
<br/>
- Aaron Rogers
<br/>
<a class="postlink" href="http://www.aaronrogers.com/nintendods/" target="_blank">http://www.aaronrogers.com/nintendods/</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
