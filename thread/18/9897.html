<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>scary warning at link - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > scary warning at link</h2>
<div id="posts">
<div class="post">
    <h4>#87380 - yanos - Tue Jun 13, 2006 5:55 pm</h4>
    <div class="postbody"><span class="postbody">I have a warning during link that I don't really like:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
main.cpp
<br/>
arm-eabi-g++ -MMD -MP -MF ./build/main.d -Wall -O2 -fno-exceptions -fno-rtti -mcpu=arm9tdmi -mtune=arm9tdmi -I/opt/devkitpro/libnds/include -DARM9 -c main.cpp -o main.o
<br/>
dsSprite.cpp
<br/>
arm-eabi-g++ -MMD -MP -MF ./build/dsSprite.d -Wall -O2 -fno-exceptions -fno-rtti -mcpu=arm9tdmi -mtune=arm9tdmi -I/opt/devkitpro/libnds/include -DARM9 -c dsSprite.cpp -o dsSprite.o
<br/>
linking test.arm9
<br/>
/opt/devkitpro/devkitARM/bin/arm-eabi-ld.real: warning: cannot find entry symbol cs=ds_arm9.specs; defaulting to 00008000
<br/>
</td> </tr></table><span class="postbody">
<br/>
If I remove -specs=ds_arm9.specs from LDFLAGS, it won't be able to find _start, witch scares me even more. Before, I was doing gba developpement and you had to supply a linkscript and a the ctr0.o object file. I'm not sure how to proceed with the ds.
<br/>
<br/>
Here is my Makefile:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
include $(DEVKITARM)/ds_rules
<br/>
<br/>
export LD       := $(PREFIX)ld
<br/>
<br/>
CFLAGS          := -Wall -O2 -fno-exceptions -fno-rtti -mcpu=arm9tdmi -mtune=arm9tdmi -I$(DEVKITPRO)/libnds/include -DARM9
<br/>
CXXFLAGS        := $(CFLAGS)
<br/>
LIBPATHS        := -L$(DEVKITARM)/lib -L$(DEVKITPRO)/libnds/lib
<br/>
LIBS            := -lnds9
<br/>
LDFLAGS         := -specs=ds_arm9.specs
<br/>
DEPSDIR         := ./build
<br/>
OFILES          := main.o dsSprite.o
<br/>
<br/>
all: test.nds
<br/>
<br/>
test.arm9:$(OFILES)
<br/>
<br/>
clean:
<br/>
        rm -f *.o
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I am trying to build with devkitpro19 and the latest libnds.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#87397 - silent_code - Tue Jun 13, 2006 8:18 pm</h4>
    <div class="postbody"><span class="postbody">try to use the makefile and folder layout that the examples use. try to compile one of the examples and if everything is fine (what should happen normally) just replace everything with your files (in a copy of the example) and try to compile that. should compile and link fine. beware, emulators won't run r19 code. you'll have to test it on hw.
<br/>
<br/>
sorry, i can't help you any further.
<br/>
<br/>
good luck!
<br/>
<br/>
ps: with the default makefile you just start make and have you rom. no need to modify it (that's why you'll have to use the special folder layout - shouldn't be a problem).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#87431 - wintermute - Tue Jun 13, 2006 10:18 pm</h4>
    <div class="postbody"><span class="postbody">-fno-exceptions and -fno-rtti aren't valid CFLAGS, these should be placed in CXXFLAGS.
<br/>
<br/>
Don't use ld directly for linking, use gcc (or g++ for C++ code)<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#87462 - yanos - Wed Jun 14, 2006 12:58 am</h4>
    <div class="postbody"><span class="postbody">Ok, I've found the examples you were talking about. There isn't much else to say, everything works just fine now :)
<br/>
<br/>
As for emulator not able to run code from devkitpro19, I was under the impression that the only thing that had changed was the abi, so with my (limited) understanding it would have cause incompatibility between binary and library of different abi only. Anyway, it's not that important since I was planing to test on real hardware...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#87474 - wintermute - Wed Jun 14, 2006 2:10 am</h4>
    <div class="postbody"><span class="postbody">the problems I've heard about appear to be related to unemulated arm946e-s instructions - this should only be a problem when using -march=armv5te -mtune=arm946e-s but I've heard vague reports of this cropping up with arm9tdmi.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#87479 - silent_code - Wed Jun 14, 2006 2:43 am</h4>
    <div class="postbody"><span class="postbody">i'm happy it works now! :) happy coding!
<br/>
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">the problems I've heard about appear to be related to unemulated arm946e-s instructions - this should only be a problem when using -march=armv5te -mtune=arm946e-s but I've heard vague reports of this cropping up with arm9tdmi.</td> </tr></table><span class="postbody">
<br/>
<br/>
i admit i Don't understand it in detail, but i get the general spin of the problem...
<br/>
<br/>
so it is (like tepples already said elsewhere) up to the emu authors to fix it and make r19 based roms work... i stepped back to r18 until that happens as i want to be able to test and debug my code more comfortably and check for compatibility issues (between buggy emus and real hardware) after the code appears to work in different emus (i still have to send it to other ppl to check it on hw... :( ).
<br/>
sending a rom to the nds and running it there (without debug tools - ok, you can put some of your own into the rom, but that changes the whole program and may affect performance...) every time you build it, is a bit unproductive, imo. though i know the hw test is simply crucial, because that is the target you build your code for (tepples had a fine quote), it is pretty time consuming and having no emulation hardware (e.g. the nitro hw emulator), software emus are the less evil.
<br/>
<br/>
ok, this is getting sort of offtopic. let's hope dualis &amp; co. get updated and run r19 based code properly... at least so the programs resulting behaviour is the same as on hw.
<br/>
<br/>
greetings to all you out there!</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
