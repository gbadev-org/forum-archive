<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>ROM Header question - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > ROM Header question</h2>
<div id="posts">
<div class="post">
    <h4>#32698 - scknight - Sat Dec 25, 2004 4:19 am</h4>
    <div class="postbody"><span class="postbody">Ok, so I'm looking over the ROM header from the metroid dump and looking at the code for darkfaders ndstool.cpp utility, and I have a couple questions hopefully someone can clear up. There's a rom9 rom offset and an arm7 rom offset in the header. So what does this mean? That when the game starts up it's executing both sections of code on each processor?
<br/>
<br/>
From what I understand as well since the header has the arm9 and arm7 rom offset, size and ram address, does this mean when the DS starts up it will copy these sectiions of code into RAM and execute from there? What is the purpose of this?
<br/>
<br/>
I guess it's not really clear what the DS is doing when it starts up. Can someone clue me in.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#32699 - LOst? - Sat Dec 25, 2004 4:37 am</h4>
    <div class="postbody"><span class="postbody">And if it really runs the code in RAM, that must be expensive for Nintendo. A solution I have never seen Nintendo has ever done. They always choose cheaper ways to perform game functions such as running everything on the ROM itself, or use built in BIOS functions (ROM too)
<br/>
<br/>
RAM is something limited. If they decided to give the games more RAM, still that RAM will be used by the games, and not the code itself.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#32703 - mike260 - Sat Dec 25, 2004 4:57 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>scknight wrote:</b></span></td> </tr> <tr> <td class="quote">From what I understand as well since the header has the arm9 and arm7 rom offset, size and ram address, does this mean when the DS starts up it will copy these sectiions of code into RAM and execute from there? What is the purpose of this?
<br/>
<br/>
I guess it's not really clear what the DS is doing when it starts up. Can someone clue me in.</td> </tr></table><span class="postbody">
<br/>
<br/>
Yes, the DS copies both binaries to the specified RAM addresses, then jumps to the specified RAM entry points.
<br/>
Presumably the carts are too slow to feed the CPUs at full speed - don't forget that compared to the GBA, the demand for instructions is tripled.
<br/>
<br/>
So is anyone else working on the Metroid ROM?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#32705 - scknight - Sat Dec 25, 2004 5:18 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>mike260 wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>scknight wrote:</b></span></td> </tr> <tr> <td class="quote">From what I understand as well since the header has the arm9 and arm7 rom offset, size and ram address, does this mean when the DS starts up it will copy these sectiions of code into RAM and execute from there? What is the purpose of this?
<br/>
<br/>
I guess it's not really clear what the DS is doing when it starts up. Can someone clue me in.</td> </tr></table><span class="postbody">
<br/>
<br/>
Yes, the DS copies both binaries to the specified RAM addresses, then jumps to the specified RAM entry points.
<br/>
Presumably the carts are too slow to feed the CPUs at full speed - don't forget that compared to the GBA, the demand for instructions is tripled.
<br/>
<br/>
So is anyone else working on the Metroid ROM?</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Ok so here's my next question. I've read speculation that the ARM9 processor is running the main game code and then possibly the ARM7 is used for audio and wireless and stuff like that.
<br/>
<br/>
So if it's the case that the code is copied to RAM and both processors started up running it, I would assume there's a way for the processors to communicate. Like if the ARM 7 is playing music and it has to be in sync with the ARM 9 somehow they're talking, probally just using RAM?
<br/>
<br/>
What is starting this whole process of copying the code to meory and running it. There's no branch instruction as the first thing like in the GBA Roms. So I would think there must be BIOS code to start the NDS ROM. But I thought everyone said the BIOS is identical. I think though that there must be some different routines for starting up NDS games.
<br/>
<br/>
Can anyone confirm this?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#32706 - tepples - Sat Dec 25, 2004 5:18 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>LOst? wrote:</b></span></td> </tr> <tr> <td class="quote">And if it really runs the code in RAM, that must be expensive for Nintendo. A solution I have never seen Nintendo has ever done. They always choose cheaper ways to perform game functions such as running everything on the ROM itself, or use built in BIOS functions (ROM too)</td> </tr></table><span class="postbody">
<br/>
<a class="postlink" href="http://www.dextrose.com/_forum/showthread.php?threadid=916" target="_blank">The ROM portion of the N64's cart edge connector has 20 pins</a>: a 16-bit multiplexed bus, and four control signals: latch high 16 address bits, latch low 16 address bits, read 16 bit word, and write 16-bit word. A scaled-down version of this bus, with 16 dedicated pins for the high address bits, was used in the Game Boy Advance cart edge connector. The MIPS processor in the N64 had no support for MIPS16, the MIPS analog to ARM's Thumb instruction encoding. I'm guessing that the N64 would run code much faster from the internal RAM than from ROM.
<br/>
<br/>
In addition, see also GameCube. Notice that GameCube games come on a disc, not a cartridge plus a disc.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">RAM is something limited. If they decided to give the games more RAM, still that RAM will be used by the games, and not the code itself.</td> </tr></table><span class="postbody">
<br/>
By "that RAM will be used by the games, and not the code" do you mean "used by assets"? The PS1 seemed to get along fine with less than 4 MB of RAM plus a ROM BIOS.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#32712 - sgeos - Sat Dec 25, 2004 5:32 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>scknight wrote:</b></span></td> </tr> <tr> <td class="quote">So if it's the case that the code is copied to RAM and both processors started up running it, I would assume there's a way for the processors to communicate. Like if the ARM 7 is playing music and it has to be in sync with the ARM 9 somehow they're talking, probally just using RAM?</td> </tr></table><span class="postbody">
<br/>
The ARM 9 and ARM 7 have some shared RAM that they can use to communicate with eachother.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#32714 - scknight - Sat Dec 25, 2004 5:43 am</h4>
    <div class="postbody"><span class="postbody">So what copies the code to RAM?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#32716 - sgeos - Sat Dec 25, 2004 5:48 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>scknight wrote:</b></span></td> </tr> <tr> <td class="quote">So what copies the code to RAM?</td> </tr></table><span class="postbody">
<br/>
I'd assume a BIOS boot strap routine initially moves code from the cart to a place where it can be run.  Once the processors are running code, then they read from and write to the shared memory to communicate.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#32719 - scknight - Sat Dec 25, 2004 8:26 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sgeos wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>scknight wrote:</b></span></td> </tr> <tr> <td class="quote">So what copies the code to RAM?</td> </tr></table><span class="postbody">
<br/>
I'd assume a BIOS boot strap routine initially moves code from the cart to a place where it can be run.  Once the processors are running code, then they read from and write to the shared memory to communicate.
<br/>
<br/>
-Brendan</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Like I said earlier, everything I've read here said the BIOS was identical to the GBA, but it seems like obviously it's not. Hopefully we'll be able to find a way to dump the DS BIOS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#32732 - Zhila - Sat Dec 25, 2004 12:51 pm</h4>
    <div class="postbody"><span class="postbody">From what I understand, the BIOS is the same as the GBA when the DS is in GBA mode.  When in DS mode, it would thus use it's own BIOS.<br/>_________________<br/>Current high scores on Super Mario 64 DS:
<br/>
Shell Smash - 50230
<br/>
Wanted - 140</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#32733 - mike260 - Sat Dec 25, 2004 12:55 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Zhila wrote:</b></span></td> </tr> <tr> <td class="quote">From what I understand, the BIOS is the same as the GBA when the DS is in GBA mode.  When in DS mode, it would thus use it's own BIOS.</td> </tr></table><span class="postbody">
<br/>
<br/>
Interesting factoid: The ARM spec defines an optional bit in a CP15 register, which controls where the CPU looks for exception vectors (ie. where the BIOS lives). The two selectable addresses are 0x00000000 and 0xFFFF0000, which happens to be where the DSes two BIOSes live (according to the leaked memory-map). So it may be that poking this bit switches which BIOS the DS uses.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#32744 - dafer - Sat Dec 25, 2004 6:32 pm</h4>
    <div class="postbody"><span class="postbody">I'm don't know very much about hardware, so I wonder if the bios is placed inside the cpu. Because if it's not couldn't the cpu then be removed and replaced with some kind of device in betwen like the one darkfader uses to read the roms to get all the information of what instructions the cpu gets.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
