<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Timers - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Timers</h2>
<div id="posts">
<div class="post">
    <h4>#133283 - yellowstar - Wed Jul 04, 2007 11:13 pm</h4>
    <div class="postbody"><span class="postbody">I need some help with timers.
<br/>
<br/>
How do I use timers, on both processors?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#133288 - Lick - Wed Jul 04, 2007 11:57 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">    // Handler
<br/>
void timer0_handler() {
<br/>
...
<br/>
}
<br/>
<br/>
<br/>
int main() {
<br/>
  // Initialize libnds interrupts system
<br/>
    irqInit();
<br/>
<br/>
  // Set IRQ handler and enable it
<br/>
    irqSet(IRQ_TIMER0, timer0_handler);
<br/>
    irqEnable(IRQ_TIMER0);
<br/>
<br/>
  // Start timer
<br/>
    TIMER0_DATA = 0xFFFF - 32768;
<br/>
    TIMER0_CR = TIMER_ENABLE | TIMER_DIV_1024 | TIMER_IRQ_REQ;
<br/>
<br/>
  // Stop timer
<br/>
    TIMER0_CR = 0;
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
You can also use the same code for TIMER1, TIMER2 and TIMER3. 
<br/>
<br/>
TIMER_DIV_1024 - TIMER_DIV_256 - TIMER_DIV_64 - TIMER_DIV_1, represent the divider of the frequency in which the timer increments. (These dividers are not dependent on the timer id. For example, all four timers can run at TIMER_DIV_1.) According to Gbatek the timers run at 33554432 Hz. That's 33 million times per second. The TIMERx_DATA value is only 16 bits, so it cannot hold a value large enough to to make a 1 second timer for that clockspeed. Now if you divide the clockspeed by a value of 1024, you'll get 33554432 / 1024 = 32768. That's the amount of increments a timer with TIMER_DIV_1024 will do in a second, and pleasantly it fits inside the 16 bits TIMERx_DATA register.
<br/>
In the real world you will pick your timer according to the amount of precision you want. And since you only have 4 timers, it's also wise to code your own timer system around a highest precision timer.<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
