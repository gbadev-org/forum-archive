<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Stylus drawing on top of an image. - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Stylus drawing on top of an image.</h2>
<div id="posts">
<div class="post">
    <h4>#125238 - FugitivePuppeT - Thu Apr 12, 2007 8:38 am</h4>
    <div class="postbody"><span class="postbody">First post, please bear with me, I'm not the greatest coder, and am just learning coding for the DS.
<br/>
<br/>
Anyways, my problem is that I learned how to create a simple drawing program that creates a "Rainbow" type of line wherever the stylus is used.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include&lt;nds.h&gt;
<br/>
#include&lt;stdlib.h&gt;
<br/>
 
<br/>
void clear_screen(void){
<br/>
unsigned short color;
<br/>
color = RGB15(0,0,0);
<br/>
int i;
<br/>
for(i = 0; i &lt; 256*192; i++)
<br/>
         VRAM_A[i] = color;
<br/>
}
<br/>
<br/>
int main(void)
<br/>
{
<br/>
   touchPosition touch;
<br/>
 
<br/>
   videoSetMode(MODE_FB0);
<br/>
   vramSetBankA(VRAM_A_LCD);
<br/>
        
<br/>
        //notice we make sure the main graphics engine renders
<br/>
        //to the lower lcd screen as it would be hard to draw if the 
<br/>
        //pixels did not show up directly benieth the pen
<br/>
   lcdMainOnBottom();
<br/>
 
<br/>
   while(1)
<br/>
   {
<br/>
      scanKeys();
<br/>
 
<br/>
      if(keysHeld() &amp; KEY_TOUCH)
<br/>
      {
<br/>
         // read the touchscreen coordinates
<br/>
         touch=touchReadXY();
<br/>
         
<br/>
         VRAM_A[touch.px + touch.py * 256] = rand();
<br/>
      }
<br/>
      
<br/>
      if(keysHeld() &amp; KEY_A)
<br/>
         clear_screen();
<br/>
   }
<br/>
 
<br/>
   return 0;
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
Then after some work, I finnaly got my first image displayed on the DS (The name of my image is "beer")
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   // Including libnds set of defines
<br/>
#include &lt;nds.h&gt;
<br/>
#include&lt;stdlib.h&gt;
<br/>
   // Include basic memory functions
<br/>
#include &lt;string.h&gt;
<br/>
<br/>
   // Including our converted graphics
<br/>
#include "beerTiles_bin.h"
<br/>
#include "beerMap_bin.h"
<br/>
#include "beerPal_bin.h"
<br/>
<br/>
int main()
<br/>
{
<br/>
      // Powering up the DS 2D hardware
<br/>
   REG_POWERCNT = POWER_ALL_2D;
<br/>
   
<br/>
      // Setting up video mode
<br/>
   DISPLAY_CR = MODE_0_2D | DISPLAY_BG0_ACTIVE;
<br/>
   BG0_CR = BG_32x32 | BG_COLOR_256 | BG_MAP_BASE(0) | BG_TILE_BASE(1);
<br/>
   
<br/>
      // Setting VRAM Bank A for Background display
<br/>
   VRAM_A_CR = VRAM_ENABLE | VRAM_A_MAIN_BG;
<br/>
   
<br/>
      // Copying the tiles to tile base 1
<br/>
   memcpy((void*)BG_TILE_RAM(1), beerTiles_bin, beerTiles_bin_size);
<br/>
      // Copying the map to map base 0
<br/>
   memcpy((void*)BG_MAP_RAM(0), beerMap_bin, beerMap_bin_size);
<br/>
      // Copying the palette to the palette area
<br/>
   memcpy((void*)BG_PALETTE, beerPal_bin, beerPal_bin_size);
<br/>
      
<br/>
      // Infinate loop to keep the program running
<br/>
   while(1)
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
What I was attempting to do is sort of combine the two, and draw on top of the image. I think my problem is that I'm using different video modes for each example. Any help would be great. Here is the combined code.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   // Including libnds set of defines
<br/>
#include &lt;nds.h&gt;
<br/>
#include&lt;stdlib.h&gt;
<br/>
   // Include basic memory functions
<br/>
#include &lt;string.h&gt;
<br/>
<br/>
   // Including our converted graphics
<br/>
#include "beerTiles_bin.h"
<br/>
#include "beerMap_bin.h"
<br/>
#include "beerPal_bin.h"
<br/>
<br/>
//This function simply makes the screen white. Will replace later.
<br/>
void clear_screen(void){
<br/>
unsigned short color;
<br/>
color = RGB15(0,0,0);
<br/>
int i;
<br/>
for(i = 0; i &lt; 256*192; i++)
<br/>
         VRAM_A[i] = color;
<br/>
}
<br/>
<br/>
int main()
<br/>
{
<br/>
   touchPosition touch;
<br/>
      // Powering up the DS 2D hardware
<br/>
   REG_POWERCNT = POWER_ALL_2D;
<br/>
   
<br/>
      // Setting up video mode
<br/>
   DISPLAY_CR = MODE_0_2D | DISPLAY_BG0_ACTIVE;
<br/>
   BG0_CR = BG_32x32 | BG_COLOR_256 | BG_MAP_BASE(0) | BG_TILE_BASE(1);
<br/>
   
<br/>
      // Setting VRAM Bank A for Background display
<br/>
   VRAM_A_CR = VRAM_ENABLE | VRAM_A_MAIN_BG;
<br/>
   
<br/>
      // Copying the tiles to tile base 1
<br/>
   memcpy((void*)BG_TILE_RAM(1), beerTiles_bin, beerTiles_bin_size);
<br/>
      // Copying the map to map base 0
<br/>
   memcpy((void*)BG_MAP_RAM(0), beerMap_bin, beerMap_bin_size);
<br/>
      // Copying the palette to the palette area
<br/>
   memcpy((void*)BG_PALETTE, beerPal_bin, beerPal_bin_size);
<br/>
      
<br/>
      // Infinate loop
<br/>
   while(1)
<br/>
   {
<br/>
      scanKeys();
<br/>
 
<br/>
      if(keysHeld() &amp; KEY_TOUCH)
<br/>
      {
<br/>
         // read the touchscreen coordinates
<br/>
         touch=touchReadXY();
<br/>
         
<br/>
         VRAM_A[touch.px + touch.py * 256] = rand();
<br/>
      }
<br/>
      
<br/>
      if(keysHeld() &amp; KEY_L &amp; KEY_R)
<br/>
         clear_screen();
<br/>
   }
<br/>
   
<br/>
   return 0;
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#125402 - FugitivePuppeT - Fri Apr 13, 2007 3:10 am</h4>
    <div class="postbody"><span class="postbody">Any help would be great!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#125404 - HyperHacker - Fri Apr 13, 2007 3:15 am</h4>
    <div class="postbody"><span class="postbody">Your beer image is tile-based? You need to select a video mode with at least one Extended Rotation layer and one tile ("text") layer. Put the beer image on the tile layer, and the EXR layer above it. Anywhere a pixel on the EXR layer doesn't have the highest bit set, the beer image should show through.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#125424 - FugitivePuppeT - Fri Apr 13, 2007 5:40 am</h4>
    <div class="postbody"><span class="postbody">Alright, I cant figure out how to set the order of the layers. Any examples someone can point me to (or just tell me?) Thanks again!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#125448 - tepples - Fri Apr 13, 2007 12:52 pm</h4>
    <div class="postbody"><span class="postbody">You set the layer order in the <a class="postlink" href="http://nocash.emubase.de/gbatek.htm#dsvideobgmodescontrol" target="_blank">BGxCNT</a> registers.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
