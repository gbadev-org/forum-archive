<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Problem connecting DS to a C++ Server - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Problem connecting DS to a C++ Server</h2>
<div id="posts">
<div class="post">
    <h4>#170434 - eglomer - Thu Sep 24, 2009 4:02 pm</h4>
    <div class="postbody"><span class="postbody">Hi!
<br/>
<br/>
I'm trying to connect my DS to a C++ Server running under linux (ubuntu 9.04), but I have problems with the Connect function (it don't connect).
<br/>
<br/>
I try with a linux c++ client, and i have no problems, but with DS is imposible... T_T
<br/>
<br/>
DS main:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">  #include &lt;nds.h&gt;
<br/>
    #include &lt;stdio.h&gt;
<br/>
    #include &lt;stdlib.h&gt;
<br/>
    #include &lt;string.h&gt;
<br/>
    #include &lt;fat.h&gt;
<br/>
    #include &lt;sys/types.h&gt;
<br/>
    #include &lt;sys/socket.h&gt;
<br/>
    #include &lt;netinet/in.h&gt;
<br/>
    #include &lt;netdb.h&gt;
<br/>
    #include &lt;dswifi9.h&gt;
<br/>
<br/>
    #define PORT 40000 // puerto al que vamos a conectar
<br/>
    #define MAXDATASIZE 256
<br/>
    #define NORMAL_TCP 0
<br/>
    #define NONBLOCKING_TCP 1
<br/>
<br/>
<br/>
    int EGL_ConnectIP(int *sock, const char *IP, int port, int mode);
<br/>
    int EGL_InitWifi(int debug);
<br/>
<br/>
<br/>
    int main (int argc, char *argv[]){
<br/>
       // Variables
<br/>
       int numbytes;
<br/>
       char buf[MAXDATASIZE]="hello from DS";
<br/>
<br/>
       // Inits
<br/>
       consoleDemoInit();
<br/>
       while (EGL_InitWifi(1) == 0);
<br/>
<br/>
       int sock;
<br/>
       if ( EGL_ConnectIP(&amp;sock, "127.0.0.1", PORT, NONBLOCKING_TCP) ){
<br/>
       printf ("Conectado\n");
<br/>
       }else{
<br/>
       return 0;
<br/>
       }     
<br/>
<br/>
       // Send
<br/>
       printf ("Enviando: ");
<br/>
       send( sock, buf, strlen(buf), 0 );
<br/>
       printf ("enviado...\n");
<br/>
<br/>
       // Receive
<br/>
       printf ("Recibiendo: ");
<br/>
       while ((numbytes=recv(sock, buf, MAXDATASIZE-1, 0)) != 0) {
<br/>
          if (numbytes &gt; 0){
<br/>
             buf[numbytes] = '\0';
<br/>
          }   
<br/>
       }
<br/>
       printf("recibido...\n\n%s\n\n",buf);
<br/>
<br/>
       printf ("Cerrando socket: ");
<br/>
       shutdown(sock,0);
<br/>
       closesocket(sock);
<br/>
       printf ("cerrado...");
<br/>
<br/>
       return 0;
<br/>
    }   
<br/>
<br/>
<br/>
    //--------------------------------------------------------------------------------------------------------------------------------------------
<br/>
<br/>
    int EGL_ConnectIP(int *sock, const char *IP, int port, int mode){
<br/>
<br/>
    //--------------------------------------------------------------------------------------------------------------------------------------------
<br/>
       int i = 0;
<br/>
       struct sockaddr_in client;
<br/>
         
<br/>
<br/>
       *sock = socket(AF_INET,SOCK_STREAM,0);
<br/>
       if(*sock == -1 ){
<br/>
          printf("Error al crear socket\n");
<br/>
          return 0;
<br/>
       }else printf("Socket creado\n");
<br/>
<br/>
       client.sin_addr.s_addr = inet_addr(IP);
<br/>
       client.sin_family = AF_INET;
<br/>
       client.sin_port = htons(port);
<br/>
<br/>
       if ( mode == NORMAL_TCP ){ 
<br/>
          i = 0;
<br/>
          printf ("Ajustado a NORMAL TCP\n");
<br/>
       }else if ( mode == NONBLOCKING_TCP ){
<br/>
          i = 1;
<br/>
          printf ("Ajustado a NONBLOCKING TCP\n");
<br/>
       }   
<br/>
       ioctl(*sock, FIONBIO, &amp;i); // set blocking or non-blocking
<br/>
<br/>
       if ( connect(*sock, (struct sockaddr *) &amp;client, sizeof(client)) == 0 ) return 1;
<br/>
       printf ("Imposible conectar al servidor\n"); 
<br/>
<br/>
       return 0;
<br/>
    }
<br/>
<br/>
<br/>
<br/>
    //--------------------------------------------------------------------------------------------------------------------------------------------
<br/>
<br/>
    int EGL_InitWifi(int debug){
<br/>
<br/>
    //--------------------------------------------------------------------------------------------------------------------------------------------
<br/>
       if(!Wifi_InitDefault(WFC_CONNECT)) {
<br/>
          return 0;
<br/>
       } else {
<br/>
          if (debug == true){
<br/>
             struct in_addr ip, gateway, mask, dns1, dns2;
<br/>
             ip = Wifi_GetIPInfo(&amp;gateway, &amp;mask, &amp;dns1, &amp;dns2);
<br/>
             iprintf("ip     : %s\n", inet_ntoa(ip) );
<br/>
             iprintf("gateway: %s\n", inet_ntoa(gateway) );
<br/>
             iprintf("mask   : %s\n", inet_ntoa(mask) );
<br/>
             iprintf("dns1   : %s\n", inet_ntoa(dns1) );
<br/>
             iprintf("dns2   : %s\n", inet_ntoa(dns2) );   
<br/>
          }         
<br/>
          return 1;   
<br/>
       }
<br/>
    }   </td> </tr></table><span class="postbody">
<br/>
<br/>
Client and Server source code for PC (linux with CodeBlocks): <a class="postlink" href="http://dl.getdropbox.com/u/971641/ClientServer.rar" target="_blank">Download</a>
<br/>
<br/>
Thank you!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#170445 - hacker013 - Sat Sep 26, 2009 1:01 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">while(EGL_WifiInit(1) == 0)</td> </tr></table><span class="postbody"> must be something like this</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">if(EGL_WifiInit(1)){printf("Wifi Succeed");}else{printf("Wifi failed");</td> </tr></table><span class="postbody">
<br/>
<br/>
because you can only init wifi one time &gt;.&gt;<br/>_________________<br/><a class="postlink" href="http://imetal.nl/" target="_blank">Website / Blog</a>
<br/>
<br/>
Let the nds be with you.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#170447 - elhobbs - Sat Sep 26, 2009 3:13 pm</h4>
    <div class="postbody"><span class="postbody">I do not think the loopback address is implemented in dswifi. can you connect to a separate computer?</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
