<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Problem with scanKeys() - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Problem with scanKeys()</h2>
<div id="posts">
<div class="post">
    <h4>#165729 - sverx - Mon Jan 05, 2009 5:37 pm</h4>
    <div class="postbody"><span class="postbody">Hi!
<br/>
  is it normal that if you call scanKeys() function "too soon" then you get strange values? I mean, If I write:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int main(void) {
<br/>
   // line1
<br/>
   scanKeys();
<br/>
   consoleDemoInit();  //setup the sub screen for printing
<br/>
   iprintf("Keys=0x%x\n",keysDown());
<br/>
.
<br/>
.
<br/>
.</td> </tr></table><span class="postbody">
<br/>
I get </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Keys=0x1c00</td> </tr></table><span class="postbody">, but what is really strange is that if I do something that takes some time (don't know how long) before the scanKeys() call, where I wrote <span style="font-style: italic">// line1</span>, then it's 0x0000.
<br/>
<br/>
It happens with no$gba, going to check this on hardware too, but it's annoying.
<br/>
<br/>
Normal? Bug? Nightmares?<br/>_________________<br/><a class="postlink" href="http://bit.ly/yiQrz9" target="_blank">libXM7</a>|<a class="postlink" href="http://bit.ly/yJwcOo" target="_blank">NDS programming tutorial (Italiano)</a>|<a class="postlink" href="http://disjointedstudio.blogspot.com/" target="_blank">Waimanu DS / GBA</a>|<a class="postlink" href="http://adshomebrewersdiary.blogspot.com" target="_blank">A DS Homebrewer's Diary</a></span><span class="gensmall"><br/><br/>Last edited by sverx on Mon Jan 05, 2009 5:42 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#165730 - Maxxie - Mon Jan 05, 2009 5:40 pm</h4>
    <div class="postbody"><span class="postbody">scan keys can only "see" what happens at the time it's called.
<br/>
<br/>
If the status of the key changes, but returns to the previous state before scanKeys is called another time. It will not find any change.<br/>_________________<br/><a class="postlink" href="http://nintendods.desperate-programmers.com/doku.php?id=wireless_io_map" target="_blank">Trying  to bring more detail into understanding the wireless hardware</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165731 - sverx - Mon Jan 05, 2009 5:42 pm</h4>
    <div class="postbody"><span class="postbody">mmm... I meant I wasn't pressing any key... :|<br/>_________________<br/><a class="postlink" href="http://bit.ly/yiQrz9" target="_blank">libXM7</a>|<a class="postlink" href="http://bit.ly/yJwcOo" target="_blank">NDS programming tutorial (Italiano)</a>|<a class="postlink" href="http://disjointedstudio.blogspot.com/" target="_blank">Waimanu DS / GBA</a>|<a class="postlink" href="http://adshomebrewersdiary.blogspot.com" target="_blank">A DS Homebrewer's Diary</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165734 - Maxxie - Mon Jan 05, 2009 6:21 pm</h4>
    <div class="postbody"><span class="postbody">oh ok,  then i have misread it.<br/>_________________<br/><a class="postlink" href="http://nintendods.desperate-programmers.com/doku.php?id=wireless_io_map" target="_blank">Trying  to bring more detail into understanding the wireless hardware</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165736 - hacker013 - Mon Jan 05, 2009 6:26 pm</h4>
    <div class="postbody"><span class="postbody">i think 0x1c00 is the value of that key before it is pressed and because it isn't pressed before you that function calls you get this value.<br/>_________________<br/><a class="postlink" href="http://imetal.nl/" target="_blank">Website / Blog</a>
<br/>
<br/>
Let the nds be with you.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165738 - Cearn - Mon Jan 05, 2009 6:42 pm</h4>
    <div class="postbody"><span class="postbody">0x1C00 are the bits coming from the Arm7-only input register, accessed in scanKeys() via the transferRegion. It's possible this data hasn't been transferred yet, meaning the transferRegion's members are still 0. The bit-inversion to move from active-low to active-high logic would then result in 0x1C00.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165751 - dovoto - Mon Jan 05, 2009 8:41 pm</h4>
    <div class="postbody"><span class="postbody">keysDown gives the keys pressed during scanKeys that were not pressed durring the prior call to scanKeys().  In other words, scankeys must be called at least twice for keysDown to have any meaning.<br/>_________________<br/><a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165809 - sverx - Wed Jan 07, 2009 10:43 am</h4>
    <div class="postbody"><span class="postbody">It happens on hardware too.
<br/>
<br/>
I understand that keysDown() will have meaning after <span style="font-weight: bold">two</span> scanKeys(), but I believe that keysDown() should return 0 until then... at least because it does that if you spend 'enough' time before the scanKeys() call. If you consider that a generic program can look like:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int main(void) { 
<br/>
   prepare();
<br/>
   while (1) {
<br/>
     scanKeys();
<br/>
     if (keysDown() &amp; KEY_X)  doSomethingX();
<br/>
     if (keysDown() &amp; KEY_A)  doSomethingA();
<br/>
   }</td> </tr></table><span class="postbody">
<br/>
<br/>
I think it's a problem if the behaviour of the program changes if prepare()  takes enough or if it takes too little time...<br/>_________________<br/><a class="postlink" href="http://bit.ly/yiQrz9" target="_blank">libXM7</a>|<a class="postlink" href="http://bit.ly/yJwcOo" target="_blank">NDS programming tutorial (Italiano)</a>|<a class="postlink" href="http://disjointedstudio.blogspot.com/" target="_blank">Waimanu DS / GBA</a>|<a class="postlink" href="http://adshomebrewersdiary.blogspot.com" target="_blank">A DS Homebrewer's Diary</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
