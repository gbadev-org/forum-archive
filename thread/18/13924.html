<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Libfat renaming - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Libfat renaming</h2>
<div id="posts">
<div class="post">
    <h4>#137624 - calcprogrammer1 - Tue Aug 14, 2007 4:01 am</h4>
    <div class="postbody"><span class="postbody">How do you rename using libfat?  I thought it was:
<br/>
<br/>
rename(char* oldname, char* newname);
<br/>
<br/>
but this is my code:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void renameFile(char *file){
<br/>
char * oldfile = file;
<br/>
PA_16cText(0,0,17,255,33,"Rename File:",1,1,100);
<br/>
PA_16cText(0,0,34,255,50,file,1,1,100);
<br/>
s32 nletter = strlen(file);
<br/>
char letter = 0;
<br/>
while(letter != '\n'){
<br/>
     letter = PA_CheckKeyboard();
<br/>
     if(letter &gt; 31){
<br/>
          file[nletter] = letter;
<br/>
          //clear screen, update text
<br/>
     }else if((letter == PA_BACKSPACE)&amp;&amp;nletter){
<br/>
          nletter--;
<br/>
          file[nletter] = ' ';
<br/>
          //clear screen, update text
<br/>
     }
<br/>
     PA_WaitForVBL();
<br/>
}
<br/>
PA_ClearBg(0,2);
<br/>
rename(oldfile,file);
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
Problem is, this code does nothing on Desmume (once you hit Enter it doesn't rename, but it still runs), and crashes on real DS (and when rebooted, it's not renamed).<br/>_________________<br/>DS Firmware 1, Datel Games n' Music card / Chism's FW hacked GBA MP v2 CF
<br/>
<br/>
There's no place like 127.0.0.1.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137625 - wintermute - Tue Aug 14, 2007 4:03 am</h4>
    <div class="postbody"><span class="postbody">rename doesn't work in the current toolchain.
<br/>
<br/>
<a href="http://forum.gbadev.org/viewtopic.php?p=133075#133075" target="_blank">http://forum.gbadev.org/viewtopic.php?p=133075#133075</a><br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137635 - DragonMinded - Tue Aug 14, 2007 6:22 am</h4>
    <div class="postbody"><span class="postbody">Does anyone else notice that he's assigning oldfile to the pointer of file, then overwriting the contents of file with the new data?  Basically oldfile and file are aliases and both contain the same data when it hits the rename, as well as the fact that you are overwriting an input pointer and have unspecified amount of memory.<br/>_________________<br/>Enter the mind of the dragon.
<br/>
<br/>
<a href="http://dragonminded.blogspot.com" target="_blank">http://dragonminded.blogspot.com</a>
<br/>
<br/>
Seriously guys, how hard is it to simply TRY something yourself?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137638 - calcprogrammer1 - Tue Aug 14, 2007 7:31 am</h4>
    <div class="postbody"><span class="postbody">So, you're saying that I shouldn't pass "file" by reference?  I though passing by reference (or using a pointer) was "char &amp;file" not "char *file".  From what I found, char* is a character type with an unspecified number of positions, because I was having problems using char [256] I used char*.
<br/>
<br/>
So if I change it to 
<br/>
<br/>
void renameFile(char file){
<br/>
char oldfile [256] = file;
<br/>
<br/>
that it'd work?  I'll try putting an output statement at both ends of that and see if they're the same or not.<br/>_________________<br/>DS Firmware 1, Datel Games n' Music card / Chism's FW hacked GBA MP v2 CF
<br/>
<br/>
There's no place like 127.0.0.1.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137639 - DragonMinded - Tue Aug 14, 2007 8:03 am</h4>
    <div class="postbody"><span class="postbody">You need to do some reading up on pointers and string operations in C.  You can't just assign a string to another like that.<br/>_________________<br/>Enter the mind of the dragon.
<br/>
<br/>
<a href="http://dragonminded.blogspot.com" target="_blank">http://dragonminded.blogspot.com</a>
<br/>
<br/>
Seriously guys, how hard is it to simply TRY something yourself?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137640 - calcprogrammer1 - Tue Aug 14, 2007 8:14 am</h4>
    <div class="postbody"><span class="postbody">Oh...lol, forgot
<br/>
<br/>
Wonder why I did that, I'm assuming you're referring to strcpy() and such.
<br/>
<br/>
All the other places in my program I used strcpy() but this I just realized is...not done right.  The keyboard input thing works, it was copied from PAlib tutorial (I think the whole thing was copied from PAlib tutorial actually).
<br/>
<br/>
So.
<br/>
<br/>
void renameFile(char file){
<br/>
char oldfile [256];
<br/>
strcpy(oldfile,file);
<br/>
...
<br/>
...
<br/>
<br/>
That should do the trick, but the question remains, does the rename() function work or will it still crash?  It's 2:12AM and I'm tired, maybe that's why I wasn't thinking, though I wrote the rename function really quickly, focusing mainly on trying to enable the keyboard, and when I found out that the keyboard didn't work, I put the project on hold for like a week, now I realize I should've commented the code some more.  I'll try it tomorrow.<br/>_________________<br/>DS Firmware 1, Datel Games n' Music card / Chism's FW hacked GBA MP v2 CF
<br/>
<br/>
There's no place like 127.0.0.1.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137652 - elhobbs - Tue Aug 14, 2007 1:52 pm</h4>
    <div class="postbody"><span class="postbody">make sure that the new file name you are creating is null terminated - doesn't look like it is from your partial code posting.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137654 - psychowood - Tue Aug 14, 2007 2:05 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>calcprogrammer1 wrote:</b></span></td> </tr> <tr> <td class="quote">but the question remains, does the rename() function work or will it still crash?</td> </tr></table><span class="postbody">
<br/>
<br/>
Nope, as wintermute said, rename doesn't work in current toolchain.<br/>_________________<br/><a class="postlink" href="http://dldi.drunkencoders.com/index.php?title=DLDI_Right_Click" target="_blank">DLDIrc Developer</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137659 - elhobbs - Tue Aug 14, 2007 3:05 pm</h4>
    <div class="postbody"><span class="postbody">it may not work correctly, but I do not think that it should crash</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137660 - psychowood - Tue Aug 14, 2007 3:09 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>elhobbs wrote:</b></span></td> </tr> <tr> <td class="quote">it may not work correctly, but I do not think that it should crash</td> </tr></table><span class="postbody">
<br/>
<br/>
Yep, no crash, it should (and it does, at least it did when I tried it some months ago) simply do nothing.<br/>_________________<br/><a class="postlink" href="http://dldi.drunkencoders.com/index.php?title=DLDI_Right_Click" target="_blank">DLDIrc Developer</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
