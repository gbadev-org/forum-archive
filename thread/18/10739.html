<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>custom mixer - SoundBuffer / streaming problem - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > custom mixer - SoundBuffer / streaming problem</h2>
<div id="posts">
<div class="post">
    <h4>#97366 - cold_as_ice - Wed Aug 09, 2006 1:57 pm</h4>
    <div class="postbody"><span class="postbody">I have a problem when playing sound on the nds.
<br/>
When i try to play a soundbuffer in arm7 during a vblank it misses a few bytes so my music sounds a little cracky. I hope someone can help me or anyone has a familair problem like me??
<br/>
<br/>
I set up my code like this:
<br/>
<br/>
ARM9 ------------------------------------------
<br/>
<br/>
Here i've set up a system to communicate between arm7 and arm9
<br/>
<br/>
typedef struct
<br/>
{
<br/>
    s8 *mixbuffer;
<br/>
    u32 buffersize,rate;
<br/>
    u8 cmdtype,bits_persample;
<br/>
    u8 snd_swapped;
<br/>
}S_CommandSystem;
<br/>
<br/>
#define commandsystem ((S_CommandSystem*)((u32)(IPC) + sizeof(TransferRegion)))
<br/>
<br/>
void InitSoundonArm9(int frequency,int bits)
<br/>
{
<br/>
     commandsystem-&gt;buffersize = frequency / 60;
<br/>
     commandsystem-&gt;mixbuffer = malloc(commandsystem-&gt;buffersize * 2); // 2 because i use 1 buffer for filling in my routine and the other one for filling it on the arm7.
<br/>
    commandsystem-&gt;cmdtype = SYSTEMINIT; // making sure that arm7 gets this bit
<br/>
}
<br/>
<br/>
// -------- During a V-Blank IRQ -------- \\
<br/>
void Arm9VBlankHandler(void)
<br/>
{
<br/>
     s8 *buffer;
<br/>
     int size;
<br/>
<br/>
     buffer = commandsystem-&gt;mixbuffer;
<br/>
     size = commandsystem-&gt;buffersize;
<br/>
     commandsystem-&gt;snd_swapped = 1 - commandsystem-&gt;snd_swapped
<br/>
<br/>
     // buffer1 = being filled/mixed with a custom filling-routine
<br/>
     // buffer2 = being played by arm7
<br/>
     if(commandsystem-&gt;snd_swapped == 1)
<br/>
     {
<br/>
          CustomMix(buffer,size / 2);
<br/>
     }
<br/>
     else
<br/>
     {
<br/>
          CustomMix(buffer +  (size / 2),size / 2);
<br/>
      }
<br/>
}
<br/>
<br/>
ARM7 ------------------------------------------
<br/>
<br/>
// -------- During a V-Blank IRQ -------- \\
<br/>
void Arm7VBlankHandler(void)
<br/>
{
<br/>
     s8 * buffer = commandsystem-&gt;mixbuffer;
<br/>
     int size = commandsystem-&gt;buffersize;
<br/>
    // check for messages sended by arm9
<br/>
    if(commandsystem-&gt;cmdtype &amp; PLAYSOUND)
<br/>
    {
<br/>
       SCHANNEL_CR(0) = 0;  // make sure nothing's playing
<br/>
       SCHANNEL_TIMER(0)  = SOUND_FREQ(22050);
<br/>
       SCHANNEL_REPEAT_POINT(0) = 0; 
<br/>
       SCHANNEL_LENGTH(0) = (size / 2) &amp; ~1;
<br/>
        if(commandsystem-&gt;snd_swapped == 1)
<br/>
       {
<br/>
              SCHANNEL_SOURCE(0) =  (u32)(buffer + (size / 2));
<br/>
       }
<br/>
       else
<br/>
       {
<br/>
              SCHANNEL_SOURCE(0) =  (u32)buffer;
<br/>
       }
<br/>
       SCHANNEL_CR(0) = SCHANNEL_ENABLE | SOUND_ENABLE |         SOUND_PAN(63) | SOUND_ONE_SHOT | SOUND_VOL(127) | (commandsystem-&gt;bpsample == 16 ? SOUND_16BIT : SOUND_8BIT);
<br/>
<br/>
      commandsystem-&gt;cmdtype &amp;= ~PLAYSOUND // discard this bit so it doesn't play again until we fill it in arm9
<br/>
    }
<br/>
}
<br/>
<br/>
<br/>
Now to sumarize:
<br/>
<br/>
arm9:
<br/>
<br/>
init the system. allocate the buffer's memory. set frequency. send package to arm7.
<br/>
to play sound: fill buffer 1,play buffer 2. and swap this every vblank
<br/>
<br/>
<br/>
arm7:
<br/>
<br/>
check for incoming packages via arm9. if so try to play.
<br/>
if buffer1 is filled then buffer2 is played
<br/>
<br/>
------------------------------------------------------------------------------------
<br/>
The CustomMix only fills the buffer that is required. So to play a sound i only mix that buffer with a sound</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#97378 - tepples - Wed Aug 09, 2006 2:25 pm</h4>
    <div class="postbody"><span class="postbody">Vblank buffer swapping may have worked on the GBA, but not on the DS because there aren't as many "nice" sample rate ratios. Use an interrupt.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#97386 - Mighty Max - Wed Aug 09, 2006 2:40 pm</h4>
    <div class="postbody"><span class="postbody">Indeed.
<br/>
<br/>
Another problem: You mixing in vblank will most likely need more time to put everything up, then the arm7 needs to check for the command. If that happens, the arm7 will handle the data on the next, not the same vblank.
<br/>
<br/>
For synching time critical things between processors, use the ipc fifo.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#97432 - DekuTree64 - Wed Aug 09, 2006 6:49 pm</h4>
    <div class="postbody"><span class="postbody">The only way I've gotten software mixing to be fully reliable is using a ring buffer. Instead of disabling the channel and telling it to play the other buffer, just set it up to loop a large single buffer. Then use a hardware timer to count how many samples have been played, and each VBlank, mix samples until the buffer is full again.
<br/>
<br/>
In pseudocode:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">Arm7VBlankHandler:
<br/>
<br/>
if (initSystem)
<br/>
{
<br/>
    Start sound channel, looping the buffer.
<br/>
    Start timer0 at the same rate as the sound channel.
<br/>
    Start timer1 cascading off timer0.
<br/>
<br/>
    Set commandsystem-&gt;prevTimerValue to 0. This is used to see how many samples you need to mix each VBlank.
<br/>
<br/>
    Set commandsystem-&gt;bufferPos to 0. This variable keeps track of where you should start mixing samples into each VBlank.
<br/>
}
<br/>
else
<br/>
{
<br/>
    int timerValue = timer1's current value
<br/>
    int samplesNeeded = timerValue - commandsystem-&gt;prevTimerValue
<br/>
<br/>
    if (samplesNeeded &lt; 0)
<br/>
        samplesNeeded += 65536  // Happens if timer wrapped back to 0
<br/>
<br/>
    Set commandsystem-&gt;prevTimerValue to timerValue.
<br/>
<br/>
    Mix samplesNeeded samples into the buffer, possibly in 2 batches if you run into the end of the buffer.
<br/>
<br/>
    Update commandsystem-&gt;bufferPos so you know where to start writing samples to next time.
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
Not sure how much sense that makes, but hopefully it will help.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#97472 - josath - Thu Aug 10, 2006 1:24 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>DekuTree64 wrote:</b></span></td> </tr> <tr> <td class="quote">The only way I've gotten software mixing to be fully reliable is using a ring buffer. Instead of disabling the channel and telling it to play the other buffer, just set it up to loop a large single buffer. Then use a hardware timer to count how many samples have been played, and each VBlank, mix samples until the buffer is full again.</td> </tr></table><span class="postbody">
<br/>
<br/>
That makes sense to me, one quick question: About what size buffers have you found to be optimal? Too big, and there will be some delay before the sound is heard, but too small might cause problems.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#97475 - DekuTree64 - Thu Aug 10, 2006 2:04 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>josath wrote:</b></span></td> </tr> <tr> <td class="quote">That makes sense to me, one quick question: About what size buffers have you found to be optimal?</td> </tr></table><span class="postbody">
<br/>
<br/>
You should only need a few more samples than you would for double buffering, since it's essentially the same thing, but with a little variation in how many samples are mixed each frame. Usually I go with more like 3 frames' worth just to be safe.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#97943 - cold_as_ice - Sat Aug 12, 2006 1:32 pm</h4>
    <div class="postbody"><span class="postbody">Deku can maybe post an example? Somehow i don't hear cracks anymore but my plack is little slow or to fast. Maybe it's because of my buffersize or my interupt at the wrong time or something else??????? This is a little bit with i did
<br/>
Set timer0 at playrate frequency and let timer1 cascade from it. then in the vblank-handler of arm7 is system == init {
<br/>
<br/>
init channels. set channeltimer at 65536 - ((1 &lt;&lt; 24) / system-&gt;frequency)
<br/>
play channel with buffersize ((1 &lt;&lt; 25) / frequency) / 2
<br/>
channel source = soundbuffer
<br/>
<br/>
}
<br/>
else
<br/>
{
<br/>
      int curtimer = TIMER1_DATA;
<br/>
      int samples_needed = curtimer - prevtimer;
<br/>
      if(samples_needed &lt; 0) samples_needed += 65536;
<br/>
      prevtimer = curtimer;
<br/>
<br/>
      soundbuffer = cursor == 0 ? mixbuffer : mixbuffer + buffersize;
<br/>
<br/>
      if(cursor == 0) MixSound(&amp;mixbuffer[buffersize],samplestomix);
<br/>
      else MixSound(&amp;mixbuffer[0],samplestomix);
<br/>
<br/>
      cursor = 1 - cursor;
<br/>
}
<br/>
<br/>
<br/>
Should i not mix in my vblank? SHould i make a timer-interupt of this... if so at what timer??? Should i even make a timer-interupt. Now i only cascade from timer0 and check in vblank it's amount.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#98121 - cold_as_ice - Sun Aug 13, 2006 10:55 am</h4>
    <div class="postbody"><span class="postbody">I started all over again. But still withouth succes:( I've set up a timer0 with playrate-frequency and timer1 set to cascade and irq enable. and inited the timer1 at 0x1000 - buffersize. It works a little bit. I can hear my music but it's so cracky. Maybe buffersize don't fits the soundchannel??? Anyway i included my sourcecode so maybe you can take a look at it and tell what i'm doing wrong??? I compiled it via Visual Studio and used devkitpro + libnds.
<br/>
Package includes sounds:)
<br/>
Get it here <a class="postlink" href="http://www.yousendit.com/transfer.php?action=check_download&amp;ufid=29E74E2C4DD8B3A5&amp;key=eceab629672ddeae265a40dfce96daf79ee27696" target="_blank">Please use <span style="font-weight: bold">[</span><span style="font-weight: bold">url=]</span> syntax for long URLs -- moderator</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#98177 - DekuTree64 - Sun Aug 13, 2006 8:46 pm</h4>
    <div class="postbody"><span class="postbody">Sorry, I was gone most of the day yesterday so I didn't have time to reply here. 
<br/>
<br/>
I still haven't made the switch to devkitpro r19, so I can't compile the newer one, but I think it has a few more bugs than the original anyway. ringbuffer_deku.zip compiles and runs, and does indeed click a lot.
<br/>
<br/>
I need to leave again now though, so I still might not get a chance to mess with the code until tomorrow.
<br/>
<br/>
EDIT: Also, I got this confused with <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=10778" target="_blank">this post</a>... I was kind of curious why the code changed so drastically :)<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#98345 - cold_as_ice - Mon Aug 14, 2006 8:18 pm</h4>
    <div class="postbody"><span class="postbody">It almost working, just a few clicks:( How big should i make buffersize (bigger or smaller). Let's say:
<br/>
<br/>
frequency = 22050 hz;
<br/>
buffersize = 2048;
<br/>
channel_cnt = 8bit playback;
<br/>
<br/>
SCHANNEL_LENGTH(0) = (buffersize / 4) &amp; ~3 // for word-alignment
<br/>
<br/>
it this correct or am i missing something???? 
<br/>
Here's my timer setup:
<br/>
<br/>
TIMER0_DATA = TIMER_FREQ_64(rate) &amp; 0xFFFE;
<br/>
TIMER0_CR = TIMER_ENABLE | TIMER_DIV_64;
<br/>
<br/>
TIMER1_DATA = 0;
<br/>
TIMER1_CR = TIMER_ENABLE | TIMER_CASCADE | TIMER_DIV_1;
<br/>
<br/>
I hope someone can help me? If you want i can also post my sourcecode as it is right now</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#98358 - DekuTree64 - Mon Aug 14, 2006 9:44 pm</h4>
    <div class="postbody"><span class="postbody">Timer0 should be using TIMER_DIV_1. The purpose of clearing the bottom bit of the period is to make it run at the exact same frequency as the sound channel, and using div64, you'd have to clear bits on the sound channel's period to get it to match.
<br/>
Which brings me to another problem I just noticed... clearing the bottom bit of the result from the TIMER_FREQ macros won't work. It looks like the macro does something like 0x10000 - SYSTEM_CLOCK / freq, but you need to clear the bottom bit of the SYSTEM_CLOCK / freq part BEFORE the subtraction happens.
<br/>
<br/>
Try this instead, because it's guaranteed to match the period perfectly:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">// 1 &lt;&lt; 24 is ~16MHz, which is the sound clock speed
<br/>
int period = (1 &lt;&lt; 24) / 22050;
<br/>
<br/>
SCHANNEL_TIMER(0) = 0x10000 - period;
<br/>
<br/>
// CPU timers run at twice the frequency of sound timers, so
<br/>
// wait twice as many cycles before wrapping around
<br/>
TIMER0_DATA = 0x10000 - (period * 2);
<br/>
TIMER0_CR = TIMER_ENABLE | TIMER_DIV_1;
<br/>
<br/>
...set up timer1 like before</td> </tr></table><span class="postbody"><br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#98440 - cold_as_ice - Tue Aug 15, 2006 9:27 am</h4>
    <div class="postbody"><span class="postbody">Yeah finally succes:) It runs pretty good. Btw.. it runs better on the real hardware,the emulator i test on still sounds little shitty(Ideas). I've only got it working with 8bit but i think 16bit shouldn't be that problem now. Thank you very much Deku!!!!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#98441 - GPFerror - Tue Aug 15, 2006 9:36 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>cold_as_ice wrote:</b></span></td> </tr> <tr> <td class="quote">Yeah finally succes:) It runs pretty good. Btw.. it runs better on the real hardware,the emulator i test on still sounds little shitty(Ideas). I've only got it working with 8bit but i think 16bit shouldn't be that problem now. Thank you very much Deku!!!!</td> </tr></table><span class="postbody">
<br/>
<br/>
Could you post the working version of your source please?
<br/>
<br/>
thanks,
<br/>
Troy(GPF)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#98447 - cold_as_ice - Tue Aug 15, 2006 9:52 am</h4>
    <div class="postbody"><span class="postbody">Sure! I also includes the sounds and the binaries so it might be a little big (+- 7 mb). So far it's only working with 8bit. The soundmix routine in arm9main.c could also be anything you want as long as you fill the buffer with the given size. I've only tested it with ideas-emulator and on the real nds so i don't know how other emulators responds to it?
<br/>
<br/>
here is the link <a class="postlink" href="http://www.yousendit.com/transfer.php?action=check_download&amp;ufid=2B866B7A78592735&amp;key=14e1ac70f256631645b034b4a65bd1fb7abe467e" target="_blank">http://www.yousendit.com/transfer.php?action=check_download&amp;ufid=2B866B7A78592735&amp;key=14e1ac70f256631645b034b4a65bd1fb7abe467e</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#99516 - GPFerror - Tue Aug 22, 2006 4:10 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>cold_as_ice wrote:</b></span></td> </tr> <tr> <td class="quote">Sure! I also includes the sounds and the binaries so it might be a little big (+- 7 mb). So far it's only working with 8bit. The soundmix routine in arm9main.c could also be anything you want as long as you fill the buffer with the given size. I've only tested it with ideas-emulator and on the real nds so i don't know how other emulators responds to it?
<br/>
<br/>
here is the link <a class="postlink" href="http://www.yousendit.com/transfer.php?action=check_download&amp;ufid=2B866B7A78592735&amp;key=14e1ac70f256631645b034b4a65bd1fb7abe467e" target="_blank">http://www.yousendit.com/transfer.php?action=check_download&amp;ufid=2B866B7A78592735&amp;key=14e1ac70f256631645b034b4a65bd1fb7abe467e</a></td> </tr></table><span class="postbody">
<br/>
<br/>
thanks, I have been able to implement partial sound streaming in my SDL lib now, did you figure out 16bit also yet ?
<br/>
<br/>
thanks,
<br/>
Troy(GPF)
<br/>
<a href="http://gpf.dcemu.co.uk" target="_blank">http://gpf.dcemu.co.uk</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100659 - cold_as_ice - Tue Aug 29, 2006 10:33 am</h4>
    <div class="postbody"><span class="postbody">Sorry for the late reaction. I was busy on something else. Maybe you've already found an solution but here's my source with 16bit and 8bit sound. Maybe i'm trying to get this work with module player:) It was actually pretty easy. 8bit to 16bit is just double the buffer sizes and mix the samples as 16bit.
<br/>
<a class="postlink" href="http://www.yousendit.com/transfer.php?action=check_download&amp;ufid=3282BF127B1D1DC0&amp;key=89c9f7f2c5a907dc980994b44c562b26987c7ce7" target="_blank"><span style="font-weight: bold">[Extra wide yousendit.com URL no longer widens page -- MOD]</span></a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#101805 - josath - Fri Sep 08, 2006 4:28 am</h4>
    <div class="postbody"><span class="postbody">I wish people wouldn't use yousendit/rapidshare/megaupload/etc, the files disappear, and when I want to see them later, I can't :( (since i missed it the first time around)
<br/>
I guess it's handy for people who don't have any webspace...but still</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#101815 - HyperHacker - Fri Sep 08, 2006 6:36 am</h4>
    <div class="postbody"><span class="postbody">Also the downloads are slow, the sites are crammed with ads, getting to the file is often a huge pain involving a completely pointless timer, at least one is completely inaccessible by people with bad sight, etc. Those types of sites have to be one of the most annoying things on the web.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#101836 - cold_as_ice - Fri Sep 08, 2006 9:19 am</h4>
    <div class="postbody"><span class="postbody">Lol sorry:) If you wish i can also send it by email or msn. I know rapidshares aren't that great and full off garbage.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#101847 - bsder - Fri Sep 08, 2006 11:04 am</h4>
    <div class="postbody"><span class="postbody">I'd appreciate it if you could email it.
<br/>
<br/>
I sent you a PM with my email.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#103127 - toa - Tue Sep 19, 2006 1:37 pm</h4>
    <div class="postbody"><span class="postbody">Can anyone re-seed the yousendit-links with the source code?
<br/>
None of the latest links works right now.  
<br/>
<br/>
Thanks in advance</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#103129 - Omegas - Tue Sep 19, 2006 1:54 pm</h4>
    <div class="postbody"><span class="postbody">Or put it up on <a class="postlink" href="http://www.dev-scene.com" target="_blank">dev-scene.com</a> for everyone to see?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#103250 - toa - Wed Sep 20, 2006 8:27 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Omegas wrote:</b></span></td> </tr> <tr> <td class="quote">Or put it up on <a class="postlink" href="http://www.dev-scene.com" target="_blank">dev-scene.com</a> for everyone to see?</td> </tr></table><span class="postbody">
<br/>
<br/>
Pretty nifty idea, upload away I say :-D</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#103423 - toa - Thu Sep 21, 2006 8:57 pm</h4>
    <div class="postbody"><span class="postbody"><a href="http://download.yousendit.com/EAE5B38555115712" target="_blank">http://download.yousendit.com/EAE5B38555115712</a>
<br/>
<br/>
Go grab the file, will re-upload in a few weeks time.
<br/>
thanks to the cold_as_ice for sending me the file via pm!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104451 - cold_as_ice - Fri Sep 29, 2006 7:50 am</h4>
    <div class="postbody"><span class="postbody">Alright. I managed to restore my old website so i could store this file to stay there. Here is the link to it.<a class="postlink" href="http://www.geocities.com/johan_amtsop/soundsync16bit.zip" target="_blank">http://www.geocities.com/johan_amtsop/soundsync16bit.zip</a>(use copy past for using the link). This might be a little slow(geocities isn't the best host:P). If there's still any error try mailing to <a href="mailto:johan_amtsop@hotmail.com">johan_amtsop@hotmail.com</a> or send me a pm via msn</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#129875 - TheChuckster - Mon May 28, 2007 3:57 pm</h4>
    <div class="postbody"><span class="postbody">Can somebody please rehost the 8bit code? I tried GPF's DSBoy sound streaming code, but it pops and crackles even with a simple square wave. I noticed it popping in DSBoy as well.
<br/>
<br/>
EDIT: Nevermind I got the square wave working smoothly.
<br/>
<br/>
Thanks GPF.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#129995 - Noda - Tue May 29, 2007 11:08 pm</h4>
    <div class="postbody"><span class="postbody">Where did you find that code? I can't find any trace of it on GPF's site :/</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130016 - GPFerror - Wed May 30, 2007 6:09 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Noda wrote:</b></span></td> </tr> <tr> <td class="quote">Where did you find that code? I can't find any trace of it on GPF's site :/</td> </tr></table><span class="postbody">
<br/>
<a href="http://forum.gbadev.org/viewtopic.php?t=12375&amp;postdays=0&amp;postorder=asc&amp;start=30" target="_blank">http://forum.gbadev.org/viewtopic.php?t=12375&amp;postdays=0&amp;postorder=asc&amp;start=30</a>
<br/>
<br/>
has the link to the sourcecode on my site, which is based off of cold_as_ice's posted example from this thread.
<br/>
<br/>
Troy(GPF)
<br/>
<a href="http://gpf.dcemu.co.uk" target="_blank">http://gpf.dcemu.co.uk</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130031 - Noda - Wed May 30, 2007 10:05 am</h4>
    <div class="postbody"><span class="postbody">Thanks a lot; I'll check that!
<br/>
<br/>
I think I'll release a template as this problem is very common, and I need to add some functions that may be useful to others (multiple streams, ADPCM, streaming from fat)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130353 - Noda - Sat Jun 02, 2007 2:31 pm</h4>
    <div class="postbody"><span class="postbody">Grrr... I still have problems with sound streaming, I can't get it working, and I don't know what is wrong... 
<br/>
<br/>
I've taken the cold_as_ice example, made it compile with latest DKP: no succes (no sound). I've tried getting the DSBoy streaming system (based on the previous one): still no sound...
<br/>
<br/>
I've tried quite a lot exprimentation, modifications, also I've taken a look at M-.-n streaming source, with the same results... I still don't get what is wrong :(
<br/>
<br/>
EDIT: FINALLY! I got it (somewhat working) :)
<br/>
<br/>
But I have a VERY strange problem, here is my main arm9 loop:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   while(1)
<br/>
   {
<br/>
      iprintf("\x1b[5;0Hcurrent frame: %d\n",framecounter);
<br/>
      iprintf("current soundbuffer: %X\n",soundsystem-&gt;mixbuffer);
<br/>
      iprintf("buffersize: %d\n",soundsystem-&gt;buffersize);
<br/>
      iprintf("samples needed %d\n",soundsystem-&gt;numsamples);
<br/>
      iprintf("soundformat: %d\n",soundsystem-&gt;format);
<br/>
      swiWaitForVBlank();
<br/>
   }
<br/>
</td> </tr></table><span class="postbody">
<br/>
If I remove one of those printf, the sound becomes all garbage (sort of alien version of the sound), if they are here, the sound is perfect...
<br/>
<br/>
quite strange, isn't it?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130458 - Noda - Sun Jun 03, 2007 8:04 pm</h4>
    <div class="postbody"><span class="postbody">X-( this bug only occurs on a no$gba, on a real DS everything works fine...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130463 - tepples - Sun Jun 03, 2007 9:16 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Noda wrote:</b></span></td> </tr> <tr> <td class="quote">X-( this bug only occurs on a no$gba, on a real DS everything works fine...</td> </tr></table><span class="postbody">
<br/>
If you find something that works on a DS but fails in NO$, then ask Martin Korth if he wants to see the source and binary.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130464 - Noda - Sun Jun 03, 2007 10:03 pm</h4>
    <div class="postbody"><span class="postbody">Actually I found various things which aren't working great in no$:
<br/>
- arm9 sync/clock is bad
<br/>
- fifo seems to work quite randomly
<br/>
- it seems there's some arm9/7 lock protection problems
<br/>
<br/>
When I'll have some time I'll write a mail to him concerning that...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130478 - tepples - Sun Jun 03, 2007 11:24 pm</h4>
    <div class="postbody"><span class="postbody">When I worked with Forgotten on VisualBoyAdvance, test cases showing behavior differences prompted the quickest response.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#131250 - bsder - Wed Jun 13, 2007 12:56 am</h4>
    <div class="postbody"><span class="postbody">While no$gba gets the pretty interface award, I find that being able to actually dig into the emulator source code is invaluable.
<br/>
<br/>
That's why I tend to prefer desmume over no$gba.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
