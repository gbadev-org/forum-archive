<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>DsWiFiLib + non-blocking sockets connection problem - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > DsWiFiLib + non-blocking sockets connection problem</h2>
<div id="posts">
<div class="post">
    <h4>#164872 - Cluster - Fri Nov 28, 2008 10:24 am</h4>
    <div class="postbody"><span class="postbody">Hi. Sorry, my english is not so good :\
<br/>
<br/>
I can't understand how to use connect() function with non-blocking sockets.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int sock;
<br/>
int i = 1;      
<br/>
sock = socket(AF_INET, SOCK_STREAM, 0); // Creating socket
<br/>
ioctl(IRC_Servers[ServerNum].sock, FIONBIO, &amp;i); // switching to non-blocking mode
<br/>
connect(sock, (struct sockaddr *) &amp;servaddr, sizeof(servaddr)); // Connecting to server</td> </tr></table><span class="postbody">
<br/>
<br/>
connect() returns control immediately, becouse sock is non-blocking. But how can I know connected it or not? I tryed to use select() function, but failed.
<br/>
<br/>
When I'm using blocking sockets:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int sock;
<br/>
sock = socket(AF_INET, SOCK_STREAM, 0); // Creating socket
<br/>
connect(sock, (struct sockaddr *) &amp;servaddr, sizeof(servaddr)); // Connecting to server... Program stops here for a while</td> </tr></table><span class="postbody">
<br/>
My program stops at connect() function until socket is connected... or until it can't connect. Sometimes it takes a very long time.
<br/>
Function gethostbyname() can froze program too.
<br/>
<br/>
Usually i'm using blocking socket to connect to server, then i'm switching to non-blocking mode. Under windows i'm using WSAWait API functions. But how to code it correctly with Berkley sockets?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164874 - Quirky - Fri Nov 28, 2008 1:26 pm</h4>
    <div class="postbody"><span class="postbody">You have to check the return value and errno. If connect returns -1, and errno is EINPROGRESS, then it is trying to connect asynchronously. Here's the relevant bit from the man page...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
If  the  connection  cannot  be  established immediately and O_NONBLOCK is set for the file descriptor for the socket, connect() shall fail and set errno to [EINPROGRESS], but the connection request shall not be aborted, and the connection shall  be  established  asynchronously.  Subsequent calls to connect() for the same socket, before the connection is established, shall fail and set errno to [EALREADY].</td> </tr></table><span class="postbody">
<br/>
<br/>
EDIT: I should mention that that is from the Linux man page for connect. The dswifi connect is not *exactly* the same, but sticks pretty close to that description in practice.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164879 - Cluster - Sat Nov 29, 2008 6:46 am</h4>
    <div class="postbody"><span class="postbody">Great... I'll try it :)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
