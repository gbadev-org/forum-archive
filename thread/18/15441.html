<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>shifting al pixels to the left in framebuffer mode - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > shifting al pixels to the left in framebuffer mode</h2>
<div id="posts">
<div class="post">
    <h4>#155072 - TheMagnitude - Thu Apr 24, 2008 7:16 pm</h4>
    <div class="postbody"><span class="postbody">Below shows my shiftpixels function which doesnt seem to work. In the function it copies the buffer into copy, then it puts copy (x+shift) back into the buffer. But i get wierd results, and i think its to do with the dmaCopy part.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void shiftHorPixels(int s, uint16* buffer)
<br/>
{
<br/>
   uint16 copy[256*192];
<br/>
   dmaCopy(buffer,copy,256*192*sizeof(uint16));
<br/>
   if (s&gt;=0)
<br/>
      for (int y = 0; y &lt; 192; y ++)
<br/>
         for (int x = s; x &lt; 256; x ++)
<br/>
            *(buffer + (y &lt;&lt; 8) + x) = copy[(y &lt;&lt; 8) + x - s];
<br/>
}</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#155075 - Maxxie - Thu Apr 24, 2008 7:46 pm</h4>
    <div class="postbody"><span class="postbody">- You are pushing a 98kB block onto the stack which should be bigger then the memory region used for the stack (16k if it's in the dtcm) 
<br/>
- DMA can not access the dtcm</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#155076 - Lazy1 - Thu Apr 24, 2008 7:53 pm</h4>
    <div class="postbody"><span class="postbody">Why not use a bitmap mode and use the hardware to scroll pixels?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#155077 - DiscoStew - Thu Apr 24, 2008 7:59 pm</h4>
    <div class="postbody"><span class="postbody">Just like Maxxie said, the DMA hardware can't transfer in this manner, and that is quite a big block you are copying. You'd have to make an array in Main RAM for this to work.
<br/>
<br/>
In addition, from what I see you trying to do, you're going the opposite way with shifting pixels, because you are starting *s* number of pixels to the right from the left-most pixel, and then copying from that left-most, and placing it into the ones at the right. This can lead to repeating pixels. This can be fixed simply by changing that last line to this...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">*(buffer + (y &lt;&lt; 8) + x - s) = copy[(y &lt;&lt; 8) + x]</td> </tr></table><span class="postbody"><br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#155079 - TheMagnitude - Thu Apr 24, 2008 8:10 pm</h4>
    <div class="postbody"><span class="postbody">Ah, sorry Im new to DS programming so I dont know what dtcm or bitmap mode is :(
<br/>
<br/>
I also dont know how to place a array in the main ram, do i just do this?:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">uint16 array[256*192];</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#155080 - silent_code - Thu Apr 24, 2008 8:11 pm</h4>
    <div class="postbody"><span class="postbody">if you mean to put that outside any function, yes, that's a way you can go. :^)
<br/>
<br/>
i'm not quite sure (about the heap), but i think static variables get allocated in the heap (i *am* sure not the stack), so that may be a solution to your problem as well. :^)
<br/>
<br/>
btw: allocation on the heap is also used with malloc/new. ;^)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#155100 - TheMagnitude - Fri Apr 25, 2008 12:28 am</h4>
    <div class="postbody"><span class="postbody">Thanks for everyones help, ive managed to sort it out :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#155102 - Maxxie - Fri Apr 25, 2008 12:39 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>silent_code wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
i'm not quite sure (about the heap), but i think static variables get allocated in the heap (i *am* sure not the stack), so that may be a solution to your problem as well. :^)</td> </tr></table><span class="postbody">
<br/>
<br/>
Named data objects defined outside functions are created in .rodata or .data except explicity told otherwise (like .dtcm)
<br/>
Named data objects defined inside functions are created on the stack
<br/>
Anonymous data objects (created via malloc/new) are taken from the heap</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#155103 - Dwedit - Fri Apr 25, 2008 12:50 am</h4>
    <div class="postbody"><span class="postbody">Couldn't you use memmove?<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#155109 - silent_code - Fri Apr 25, 2008 2:13 am</h4>
    <div class="postbody"><span class="postbody">@ Maxxie: could you phrase this a bit "beginner friendly"?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#155111 - tepples - Fri Apr 25, 2008 2:36 am</h4>
    <div class="postbody"><span class="postbody">The object 'copy' is on the stack because you defined it inside a function.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#155136 - silent_code - Fri Apr 25, 2008 12:34 pm</h4>
    <div class="postbody"><span class="postbody">gnu says:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">The C language supports two kinds of memory allocation through the variables in C programs:
<br/>
<br/>
    * Static allocation is what happens when you declare a static or global variable. Each static or global variable defines one block of space, of a fixed size. The space is allocated once, when your program is started (part of the exec operation), and is never freed.</td> </tr></table><span class="postbody">
<br/>
<br/>
so? also my reference tells me that static function variables don't get allocated on the stack. doesn't make sense to me and in asm, i'd put such a variable into .data or, if possible, make it "lokal". (ok, it's been a while since last time i asm'ed.)... but i'm always willing to learn (and obviously too lazy to just check out how gcc generates asm for static function variables). :^D
<br/>
<br/>
also, there seems to be a difference between initialized (.data) and uninitialized (.data?) statics (the first get allocated and initialized on program startup, iirc), although i haven't used statics in asm, yet, and just googled that out of curiosity.</span><span class="gensmall"><br/><br/>Last edited by silent_code on Fri Apr 25, 2008 1:22 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#155141 - tepples - Fri Apr 25, 2008 1:15 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>silent_code wrote:</b></span></td> </tr> <tr> <td class="quote">also my reference tells me that static function variables doesn't get allocated on the stack.</td> </tr></table><span class="postbody">
<br/>
True, but this variable isn't marked static. If the program doesn't specify a storage class for a variable defined in the scope of a function, the compiler assumes auto.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">also, there seems to be a difference between initialized (.data) and uninitialized (.data?) statics (the first get allocated and initialized on program startup, iirc)</td> </tr></table><span class="postbody">
<br/>
At file scope, devkitARM puts uninitialized variables with static allocation in .bss. I haven't tried the same with such variables at function scope.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#155142 - silent_code - Fri Apr 25, 2008 1:20 pm</h4>
    <div class="postbody"><span class="postbody">thanks.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
