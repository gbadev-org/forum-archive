<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Help with some power management code - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Help with some power management code</h2>
<div id="posts">
<div class="post">
    <h4>#40543 - maniacdevnull - Wed Apr 20, 2005 4:07 am</h4>
    <div class="postbody"><span class="postbody">I'm trying to write some power management code. I have something that seems to be working fine for now, I'm just looking if anyone has any suggestions / improvements for it.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
uint8 xkeys = (~IPC-&gt;buttons);
<br/>
bool screenOn = true;
<br/>
<br/>
...snip...
<br/>
<br/>
if (xkeys &lt; 128 &amp;&amp; screenOn) 
<br/>
   {
<br/>
   POWER_CR = POWER_CR - 527;
<br/>
   screenOn = false;
<br/>
   }
<br/>
if (xkeys &gt;= 128 &amp;&amp; !screenOn) 
<br/>
   {
<br/>
   POWER_CR = POWER_CR + 527;
<br/>
   screenOn = true;
<br/>
   }
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
That code seems to work fine for now, when the lid is shut, the screens power off, when the lid opens they come back on. I just wish I knew how to make the power light blink like in real DS games :-(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#40545 - josath - Wed Apr 20, 2005 4:23 am</h4>
    <div class="postbody"><span class="postbody">As well as turning the screens off, I would halt your program, make it go into a simple loop that just checks if the screen is opened, but not too fast, maybe once per second so the cpu sleeps alot.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#40550 - Theodore104 - Wed Apr 20, 2005 7:11 am</h4>
    <div class="postbody"><span class="postbody">It's worth making sure you power down the arm7's subsystems as well; I'm not sure whether any of them are powered by default.
<br/>
<br/>
No idea on the light, though; my guess would be that there is some further power-saving measure we can do, perhaps a sleep mode for one or both CPUs, that triggers the light mode to change... the existing method seems to provide a comfortably long battery life, though.
<br/>
<br/>
 - Theo</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#40556 - TJ - Wed Apr 20, 2005 8:15 am</h4>
    <div class="postbody"><span class="postbody">I think the light is probably software controlled rather than being an automatic function of the Sleep Mode.
<br/>
<br/>
I've played some games that the light didn't blink while in Sleep Mode, for instance.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
