<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Does touch screen pen down trigger an interrupt? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Does touch screen pen down trigger an interrupt?</h2>
<div id="posts">
<div class="post">
    <h4>#152656 - jiversen - Wed Mar 19, 2008 2:31 am</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
I would like the DS to generate an interrupt when the pen touches the touch screen. Can it? I've been reading everything I can find and don't have a definite answer.
<br/>
<br/>
The one thing that gave me a sense of the _possibility_ is the comment 'Not sure if the TSC [touch screen controller] /PENIRQ is actually triggering an IRQ on the NDS' found in the nocash gbatek document (nocash.emubase.de/gbatek.htm). 
<br/>
<br/>
However, everything else seems like evidence against this possibility:
<br/>
1) All the code I've examined (libnds, dslinux) just regularly polls REG_KEYXY (libnds), typically during Vblank or Vcount interrupt handler. [On the other hand, key interrupts aren't typically used for the other keys, even though they are available, so this doesn't prove anything].
<br/>
<br/>
2) I haven't found any reference to interrupt enable flags for any of the 'new' arm7-only accessible keys (e.g. X, Y). This leads one to think there may be no interrupt support for the pen either. But the hinge does give an interrupt...
<br/>
<br/>
I'm hoping someone may have direct knowledge that they are willing to share.
<br/>
<br/>
Thanks
<br/>
<br/>
John
<br/>
<br/>
PS. If you care, the reason for the request is an interest in achieving timing accuracy greater than 1/60 second in recording pen-down times.
<br/>
<br/>
PPS. This is my first post, so I'd like to also say I've been amazed by the wealth of information and individuals' dedication to the DS homebrew found in this forum and online and in code made freely available. I've learned tremendously from all of your efforts. It's so much fun. I humbly say Thank You!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152662 - wintermute - Wed Mar 19, 2008 2:51 am</h4>
    <div class="postbody"><span class="postbody">The hinge &amp; the X/Y button interrupts are only available on the arm7.
<br/>
<br/>
Generally speaking the button interrupts shouldn't be used for input. I'd need to go check some test code but I seem to remember the button interrupts being a continuous thing rather than a one shot thing - i.e. if you enable an interrupt for button A being down then you'll cycle through that interrupt continuously while the button is down. It's been a while though so feel free to test - I definitely came to the conclusion that it was only useful for key combo reset or similar features.
<br/>
<br/>
As far as we've been able to determine so far, there's no access to the pen irq line from the arm7.
<br/>
<br/>
To get higher frequency pen down sampling just increase the rate it's polled. You could use a timer or use the ytrigger code to interrupt on several scanlines instead of just one.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152665 - jiversen - Wed Mar 19, 2008 3:07 am</h4>
    <div class="postbody"><span class="postbody">Good to know about the button IRQs. I'd seen some mention that they weren't good for user input, but you've suggested why.
<br/>
<br/>
The timer route it is!
<br/>
<br/>
Thanks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152692 - tepples - Wed Mar 19, 2008 7:47 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">Generally speaking the button interrupts shouldn't be used for input. I'd need to go check some test code but I seem to remember the button interrupts being a continuous thing rather than a one shot thing - i.e. if you enable an interrupt for button A being down then you'll cycle through that interrupt continuously while the button is down. It's been a while though so feel free to test - I definitely came to the conclusion that it was only useful for key combo reset or similar features.</td> </tr></table><span class="postbody">
<br/>
I have not tested keypress interrupts on the Nintendo DS, but I do remember having run some tests on the Game Boy Advance:
<br/>
<ul><li>GBA hardware would give one interrupt or several interrupts when the button is pressed, no interrupts while the button is held, and zero to a few when the button is released. I chalked up the multiple interrupts to <a class="postlink" href="http://en.wikipedia.org/wiki/Switch#Contact_bounce" target="_blank">contact bounce</a>. </li><li>VisualBoyAdvance, an emulator, would inaccurately give one interrupt each frame. </li></ul>
<br/>
So sampling only once, twice, or thrice a frame, as might be done in a music game or fighting game, has the side effect of debouncing the switch.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
