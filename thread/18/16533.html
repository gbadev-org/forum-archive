<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Modifying loaded texture - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Modifying loaded texture</h2>
<div id="posts">
<div class="post">
    <h4>#167439 - 3dfx - Thu Mar 12, 2009 3:40 am</h4>
    <div class="postbody"><span class="postbody">I was poking around the libnds source code and was wondering how to modify a texture I loaded?
<br/>
<br/>
I was figuring I could change glTexImage2D to return the address of the loaded texture, then to update it, I'd use parts of the original glTexImage2D in a new function that takes the address to store the texture as an argument like so:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
uint32 *textureAddress = glTexImage2D( .... );
<br/>
<br/>
// 
<br/>
void UpdateTexture(int target, int empty1, GL_TEXTURE_TYPE_ENUM type, int sizeX, int sizeY, int empty2, GL_TEXTURE_PARAM_ENUM  param, const uint8* texture, uint32 *addr)
<br/>
{
<br/>
   uint32 size = 0;
<br/>
   uint32 vramTemp;
<br/>
<br/>
   size = 1 &lt;&lt; (sizeX + sizeY + 6);
<br/>
<br/>
   switch (type) {
<br/>
      case GL_RGB:
<br/>
      case GL_RGBA:
<br/>
         size = size &lt;&lt; 1;
<br/>
         break;
<br/>
      case GL_RGB4:
<br/>
         size = size &gt;&gt; 2;
<br/>
         break;
<br/>
      case GL_RGB16:
<br/>
         size = size &gt;&gt; 1;
<br/>
         break;
<br/>
      default:
<br/>
         break;
<br/>
   }
<br/>
<br/>
   
<br/>
   // unlock texture memory
<br/>
   vramTemp = vramSetMainBanks(VRAM_A_LCD,VRAM_B_LCD,VRAM_C_LCD,VRAM_D_LCD);
<br/>
<br/>
   if (type == GL_RGB) {
<br/>
      // We do GL_RGB as GL_RGBA, but we set each alpha bit to 1 during the copy
<br/>
      u16 * src = (u16*)texture;
<br/>
      u16 * dest = (u16*)addr;
<br/>
<br/>
      glTexParameter(sizeX, sizeY, addr, GL_RGBA, param);
<br/>
<br/>
      while (size--) {
<br/>
         *dest++ = *src | (1 &lt;&lt; 15);
<br/>
         src++;
<br/>
      }
<br/>
   } else {
<br/>
      // For everything else, we do a straight copy
<br/>
      glTexParameter(sizeX, sizeY, addr, type, param);
<br/>
      swiCopy((uint32*)texture, addr , size / 4 | COPY_MODE_WORD);
<br/>
   }
<br/>
   vramRestoreMainBanks(vramTemp);
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
where UpdateTexture would be nearly identical to glTexImage2D other than not looking for a free texture slot.
<br/>
Would this method work?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167446 - TwentySeven - Thu Mar 12, 2009 10:18 am</h4>
    <div class="postbody"><span class="postbody">yep.  I did exactly that :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167452 - 3dfx - Thu Mar 12, 2009 3:54 pm</h4>
    <div class="postbody"><span class="postbody">Awesome! Thanks a mil. :D</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167457 - elhobbs - Thu Mar 12, 2009 6:06 pm</h4>
    <div class="postbody"><span class="postbody">why do you need to modify glTexImage2D? you can use glGetTexturePointer to get a pointer to VRAM.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167458 - 3dfx - Thu Mar 12, 2009 6:22 pm</h4>
    <div class="postbody"><span class="postbody">:O
<br/>
I was not aware of that, (how'd I miss that function?).
<br/>
Thanks for the info. :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167483 - elhobbs - Fri Mar 13, 2009 6:17 pm</h4>
    <div class="postbody"><span class="postbody">I am not sure about older versions, but the current version of glTexImage2D does not allocate a new block of vram each call. It first checks to see if there if already memory allocated first and will reuse it. so, you do not even need a special UpdateTexture function either.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
