<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>How can I link nds-file? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > How can I link nds-file?</h2>
<div id="posts">
<div class="post">
    <h4>#119365 - Phantaseur - Thu Feb 22, 2007 1:16 pm</h4>
    <div class="postbody"><span class="postbody">I have a problem creating simple hello world application. As I understand at first I need compile source and get object-file then link it and get elf-file, and then using objcopy get bin and nds files... What for such difficulties? Why can't I get nds-file after linking?
<br/>
<br/>
I have no problems with compilation
<br/>
<br/>
arm-eabi-g++ -mcpu=arm9tdmi -Wall -DARM9 -I/e/devkitPro/libnds/include/ -c helloworld.cpp
<br/>
<br/>
after this helloworld.o appears and I try to link it
<br/>
<br/>
/e/devkitPro/devkitarm/bin/arm-eabi-g++ -L/e/devkitPro/libnds/lib/ -lnds9 my.o -o helloworld.elf
<br/>
<br/>
but next output appears
<br/>
<br/>
helloworld.o: In function `main':
<br/>
helloworld.cpp:(.text+0x7c): undefined reference to `vramSetBankC'
<br/>
helloworld.cpp:(.text+0xa4): undefined reference to `consoleInitDefault'
<br/>
e:/devkitpro/devkitarm/bin/../lib/gcc/arm-eabi/4.1.1/../../../../arm-eabi/lib\libc.a(lib_a-abort.o): In function `abort':
<br/>
(.text+0xc): undefined reference to `_exit'
<br/>
e:/devkitpro/devkitarm/bin/../lib/gcc/arm-eabi/4.1.1/../../../../arm-eabi/lib\libc.a(lib_a-exit.o): In function `exit':
<br/>
(.text+0x28): undefined reference to `_exit'
<br/>
e:/devkitpro/devkitarm/bin/../lib/gcc/arm-eabi/4.1.1/../../../../arm-eabi/lib\libc.a(lib_a-sbrkr.o): In function `_sbrk_r':
<br/>
(.text+0x1c): undefined reference to `_sbrk'
<br/>
e:/devkitpro/devkitarm/bin/../lib/gcc/arm-eabi/4.1.1/../../../../arm-eabi/lib\libc.a(lib_a-signalr.o): In function `_getpid_r':
<br/>
(.text+0x8): undefined reference to `_getpid'
<br/>
e:/devkitpro/devkitarm/bin/../lib/gcc/arm-eabi/4.1.1/../../../../arm-eabi/lib\libc.a(lib_a-signalr.o): In function `_kill_r':
<br/>
(.text+0x38): undefined reference to `_kill'
<br/>
e:/devkitpro/devkitarm/bin/../lib/gcc/arm-eabi/4.1.1/../../../../arm-eabi/lib\libc.a(lib_a-makebuf.o): In function `__smakebuf':
<br/>
(.text+0xf4): undefined reference to `isatty'
<br/>
e:/devkitpro/devkitarm/bin/../lib/gcc/arm-eabi/4.1.1/../../../../arm-eabi/lib\libc.a(lib_a-writer.o): In function `_write_r':
<br/>
(.text+0x24): undefined reference to `_write'
<br/>
e:/devkitpro/devkitarm/bin/../lib/gcc/arm-eabi/4.1.1/../../../../arm-eabi/lib\libc.a(lib_a-closer.o): In function `_close_r':
<br/>
(.text+0x1c): undefined reference to `_close'
<br/>
e:/devkitpro/devkitarm/bin/../lib/gcc/arm-eabi/4.1.1/../../../../arm-eabi/lib\libc.a(lib_a-fstatr.o): In function `_fstat_r':
<br/>
(.text+0x20): undefined reference to `_fstat'
<br/>
e:/devkitpro/devkitarm/bin/../lib/gcc/arm-eabi/4.1.1/../../../../arm-eabi/lib\libc.a(lib_a-lseekr.o): In function `_lseek_r':
<br/>
(.text+0x24): undefined reference to `_lseek'
<br/>
e:/devkitpro/devkitarm/bin/../lib/gcc/arm-eabi/4.1.1/../../../../arm-eabi/lib\libc.a(lib_a-readr.o): In function `_read_r':
<br/>
(.text+0x24): undefined reference to `_read'
<br/>
collect2: ld returned 1 exit status
<br/>
make: *** [helloworld.elf] Error 1
<br/>
<br/>
As I know first two strings
<br/>
helloworld.cpp:(.text+0x7c): undefined reference to `vramSetBankC'
<br/>
helloworld.cpp:(.text+0xa4): undefined reference to `consoleInitDefault'
<br/>
mean that there is no such functions in libnds, what else library need I load for these functions? And what mean other errors? What options need I use for successfull generating of nds-file?
<br/>
<br/>
Example of sourcecode of helloworld application I took here:
<br/>
<a href="http://www.double.co.nz/nintendo_ds/nds_develop1.html" target="_blank">http://www.double.co.nz/nintendo_ds/nds_develop1.html</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119386 - NeX - Thu Feb 22, 2007 5:11 pm</h4>
    <div class="postbody"><span class="postbody">You DO NOT want to compile like that.  It takes ages.  Instead, use ALT+1 in Programmers' Notepad.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119390 - simonjhall - Thu Feb 22, 2007 5:17 pm</h4>
    <div class="postbody"><span class="postbody">I seem to remember having trouble like this a while ago and it just 'went away' when I put spaces between -L and the libs directory.
<br/>
<br/>
It's obviously not finding the references to those functions, so either the compiler is generating the wrong function name (ie it could be mangling the function name) or the link library can't be found.
<br/>
<br/>
What happens when you compile the file with gcc instead of g++?<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119397 - wintermute - Thu Feb 22, 2007 6:06 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Phantaseur wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
after this helloworld.o appears and I try to link it
<br/>
<br/>
/e/devkitPro/devkitarm/bin/arm-eabi-g++ -L/e/devkitPro/libnds/lib/ -lnds9 my.o -o helloworld.elf
<br/>
<br/>
but next output appears
<br/>
<br/>
helloworld.o: In function `main':
<br/>
helloworld.cpp:(.text+0x7c): undefined reference to `vramSetBankC'
<br/>
helloworld.cpp:(.text+0xa4): undefined reference to `consoleInitDefault'
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
This is caused by specifying the library before the object files.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
e:/devkitpro/devkitarm/bin/../lib/gcc/arm-eabi/4.1.1/../../../../arm-eabi/lib\libc.a(lib_a-abort.o): In function `abort':
<br/>
(.text+0xc): undefined reference to `_exit'
<br/>
<br/>
...
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
These are caused by not telling g++ you want to link nds code.
<br/>
<br/>
The actual command line you want is
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
arm-eabi-g++ -specs=ds_arm9.specs -L/e/devkitPro/libnds/lib/Â  my.o -lnds9 -o helloworld.elf
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Chris is currently in the process of updating his tutorials for latest toolchain and libnds so you might have a bit of trouble getting things to work.
<br/>
<br/>
For now I'd recommend starting with the dev-scene tutorials Dovoto has been beavering on.
<br/>
<br/>
<a href="http://www.dev-scene.com/NDS/Tutorials" target="_blank">http://www.dev-scene.com/NDS/Tutorials</a><br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
