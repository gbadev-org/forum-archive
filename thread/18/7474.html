<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>3d Level - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > 3d Level</h2>
<div id="posts">
<div class="post">
    <h4>#60684 - Xgame - Sun Nov 13, 2005 6:33 pm</h4>
    <div class="postbody"><span class="postbody">Hi, i am developming a Fps for ds using libnd+opengl.
<br/>
for move camera i use gluLookAt; but i don' t now how import a 3d model as map. I need collision and calculated height.
<br/>
I have some .bsp map(quake 3).
<br/>
can i' ll use it?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#60693 - SevenString - Sun Nov 13, 2005 11:27 pm</h4>
    <div class="postbody"><span class="postbody">On the DS, I know of no common way to "get there from here".  A lot of people, including me, are rolling their own tools.
<br/>
<br/>
There are some conversion utils that will get various file formats into 3d text-based geometry files or .c code for later interpretation by your DS application.  Look at the libnds examples, epsecially the one that uses GBFS and an external "world.txt" file.  It's a very simple example of a way to get some data rendered on the DS.
<br/>
<br/>
Personally, what I've done is to create a Softimage:XSI script to export objects into a file format that my DS code can read and understand, including stuff like materials, animation, etc.
<br/>
<br/>
There's a lot of other stuff that I've done involving scripting, abstracting scene "actors" from the objects, and so forth.  However, I don't think there is anything like a free "level editor" or similar around the homebrew DS scene.<br/>_________________<br/><span style="font-style: italic">"Artificial Intelligence is no match for natural stupidity."</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#60767 - Xgame - Mon Nov 14, 2005 5:24 pm</h4>
    <div class="postbody"><span class="postbody">ok, but how to convert a model in those format?
<br/>
and how to use collision?
<br/>
maybe i must calcoulate point for point evry collision place?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#61104 - cybereality - Thu Nov 17, 2005 8:09 am</h4>
    <div class="postbody"><span class="postbody">I haven't gotten into and 3d ds coding yet, so I can't help you getting 3d assets onto the ds. In terms of collision I can offer some general ideas on how that would be implemented. I am actually working on a physics library in flash that I hope to port to the ds some day ;)
<br/>
<br/>
To test for collision in an arbitrary 3d mesh you need to first have an array of faces to test for collision. This could be the actual level mesh, or you may want to make a simplified "collision mesh" that dictates where the player can move. At the start of the level you want to precalculate the normals of each of the faces. 
<br/>
<br/>
I also assume there is a vector velocity to the player which controls the movement. So pressing the Up-button moves the player by a certain force in his forward vector.
<br/>
<br/>
To check for the collision you want to see if the angle between the players velocity and the surface normal vector is within a particular range. For instance, if the player is facing a wall the angle would be 0. If he was looking away from the wall the angle is 180. So you can say that only faces with an angle of +-90 from the players are potential collisions. This may be combined with any back-face culling code as an optimization. 
<br/>
<br/>
Now you have a list of potential collision faces. Within that list do a line-through-plane check and check the distance. If that distance is less than a certain value (i.e. the radius of the player) then you have a collision; return true;
<br/>
<br/>
You also need some way to handle the collisions. For an object (health for instance) it may be as simple as calling health++; for other things it may require special care. For wall/floor collision you need to be able to alter the players velocity so that he wont go through the wall or floor.
<br/>
<br/>
For wall collision you want to change the players velocity to the line perpendicular to the normal angle. This way the player will slide along the wall and not be stuck. Since there are 2 perpendicular rays from the normal vector, you use the one that the player is closest to (so you can slide both ways on the wall). 
<br/>
<br/>
For floor collision you want to do the same as with the wall collision except you use the player's downward vector for testing. If you have gravity in the game this is where you add the forces (i.e if the player is more that 10 units off the floor then kick gravity in). 
<br/>
<br/>
That covers the basic idea of a 3d collision system. I have some code in javascript, but I figured it would be easier to explain the concepts. This is by no means the only way. There are also numerous optimizations that could be done as well (binary space partitians, etc). I just wanted to lay out the basics. Hope its of some help.<br/>_________________<br/><a class="postlink" href="http://www.cybereality.com" target="_blank">// cybereality</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
