<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Including a file - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Including a file</h2>
<div id="posts">
<div class="post">
    <h4>#49306 - MasterRay - Thu Jul 28, 2005 12:03 pm</h4>
    <div class="postbody"><span class="postbody">This must be a very simple question, but nevertheless I can't solve it.
<br/>
I'm using the latest DevEnv 3.0.1.
<br/>
I have a main.cpp and a data.h, when I use #include "data.h" I get these errors:
<br/>
built ... arm7.bin
<br/>
main.cpp
<br/>
c:/ndsdev/projects/LogicGates/arm9/source/main.cpp:13: error: new types may not be defined in a return type
<br/>
c:/ndsdev/projects/LogicGates/arm9/source/main.cpp:13: error: extraneous `int' ignored
<br/>
c:/ndsdev/projects/LogicGates/arm9/source/main.cpp:13: error: `main' must return `int'
<br/>
c:/ndsdev/projects/LogicGates/arm9/source/main.cpp:13: error: return type for `main' changed to `int'
<br/>
make[2]: *** [main.o] Error 1
<br/>
make[1]: *** [build] Error 2
<br/>
<br/>
&gt; Process Exit Code: 0
<br/>
<br/>
I can't understand why it can't include the file, I hope you can help me.
<br/>
<br/>
Sorry, I've just solved the problem by myself
<br/>
No need to reply</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49307 - NoMis - Thu Jul 28, 2005 12:07 pm</h4>
    <div class="postbody"><span class="postbody">Seems like you have errors in your main function rather then with including the file. Seeing your main function might be helpfull to further investigate the error.
<br/>
<br/>
NoMis<br/>_________________<br/><span style="font-style: italic"><a class="postlink" href="http://www.gamedev.at/" target="_blank">www.gamedev.at</a></span> - The austrian gamedev site
<br/>
<span style="font-style: italic"><a class="postlink" href="http://hde.gamedev.at/" target="_blank">hde.gamedev.at</a></span> - The Handheld Dev Env plugins for Eclipse</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49308 - MasterRay - Thu Jul 28, 2005 12:17 pm</h4>
    <div class="postbody"><span class="postbody">I had a simple error in my include file</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49309 - NoMis - Thu Jul 28, 2005 12:27 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>MasterRay wrote:</b></span></td> </tr> <tr> <td class="quote">I had a simple error in my include file</td> </tr></table><span class="postbody">
<br/>
<br/>
The error output you provided tells me the error is in main.cpp row 13 and has something to do with your main function.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>MasterRay wrote:</b></span></td> </tr> <tr> <td class="quote">c:/ndsdev/projects/LogicGates/arm9/source/main.cpp:13: error: new types may not be defined in a return type 
<br/>
c:/ndsdev/projects/LogicGates/arm9/source/main.cpp:13: error: extraneous `int' ignored 
<br/>
c:/ndsdev/projects/LogicGates/arm9/source/main.cpp:13: error: `main' must return `int' 
<br/>
c:/ndsdev/projects/LogicGates/arm9/source/main.cpp:13: error: return type for `main' changed to `int'</td> </tr></table><span class="postbody">
<br/>
<br/>
We need further information to help you. The error output of the compiler tells us nothing. Send some code snippets of the places where the error happened. What is you include file containing.
<br/>
<br/>
NoMis<br/>_________________<br/><span style="font-style: italic"><a class="postlink" href="http://www.gamedev.at/" target="_blank">www.gamedev.at</a></span> - The austrian gamedev site
<br/>
<span style="font-style: italic"><a class="postlink" href="http://hde.gamedev.at/" target="_blank">hde.gamedev.at</a></span> - The Handheld Dev Env plugins for Eclipse</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49311 - MasterRay - Thu Jul 28, 2005 1:12 pm</h4>
    <div class="postbody"><span class="postbody">I've found the error already, I had a semicolon missing in the include file, but since it told me that the error was in the main file I looked there.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49315 - MasterRay - Thu Jul 28, 2005 4:53 pm</h4>
    <div class="postbody"><span class="postbody">I came to another problem:
<br/>
I'm trying to add my own sprites, I've drawn something and I use gfx2gba so it turned to *.pal and *.raw, how do I convert them to *.h or *.o so I can use them within my application?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49318 - tepples - Thu Jul 28, 2005 5:16 pm</h4>
    <div class="postbody"><span class="postbody">Try 'bin2s' included with <a class="postlink" href="http://www.pineight.com/gba/#gbfs" target="_blank">GBFS</a>. It'll convert any binary file to an assembly language (*.s) file that contains the same data, which you can then compile to an object code file (*.o).<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49331 - MasterRay - Thu Jul 28, 2005 8:13 pm</h4>
    <div class="postbody"><span class="postbody">But I saw that the demos, for example: UnderPressure, use *.h files and not *.o</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49332 - natrium42 - Thu Jul 28, 2005 8:20 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>MasterRay wrote:</b></span></td> </tr> <tr> <td class="quote">But I saw that the demos, for example: UnderPressure, use *.h files and not *.o</td> </tr></table><span class="postbody">
<br/>
Yes, it's better to not use bin2s. Put your ressource files into data/ folder and the Makefile will automatically create a header file for each ressource. Linker will link the ressources into the final binary.
<br/>
<br/>
Look for bin2o in the Makefile if you want to see the mechanism.<br/>_________________<br/><a class="postlink" href="http://www.natrium42.com" target="_blank">www.natrium42.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49338 - MasterRay - Thu Jul 28, 2005 10:28 pm</h4>
    <div class="postbody"><span class="postbody">I've added the files to a folder names 'data', and the compiler seem to have found them, but I got a new error message:
<br/>
built ... arm7.bin
<br/>
img.o: In function `img':
<br/>
: multiple definition of `img'
<br/>
img.o:: first defined here
<br/>
img.o: In function `img_end':
<br/>
: multiple definition of `img_end'
<br/>
img.o:: first defined here
<br/>
collect2: ld returned 1 exit status
<br/>
make[2]: *** [/c/ndsdev/projects/img/arm9/arm9.elf] Error 1
<br/>
make[1]: *** [build] Error 2
<br/>
<br/>
What is the problem?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49350 - natrium42 - Fri Jul 29, 2005 12:46 am</h4>
    <div class="postbody"><span class="postbody">You can't have a function name and a variable name be the same. I think that's your problem.<br/>_________________<br/><a class="postlink" href="http://www.natrium42.com" target="_blank">www.natrium42.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49395 - MasterRay - Fri Jul 29, 2005 10:37 am</h4>
    <div class="postbody"><span class="postbody">I have done nothing with the template I have only 'int main', and that's it, in the data folder I have: img.pal and img.raw, these are the only files. I haven't changed any line from the makefile.
<br/>
Yet, the problem remains, what can I do?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49408 - natrium42 - Fri Jul 29, 2005 3:02 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>MasterRay wrote:</b></span></td> </tr> <tr> <td class="quote">I have done nothing with the template I have only 'int main', and that's it, in the data folder I have: img.pal and img.raw, these are the only files. I haven't changed any line from the makefile.
<br/>
Yet, the problem remains, what can I do?</td> </tr></table><span class="postbody">
<br/>
Hm, perhaps the Makefile changed. Try to rename img.pal to img_pal.pal. Perhaps you can't have the same basenames for data files.<br/>_________________<br/><a class="postlink" href="http://www.natrium42.com" target="_blank">www.natrium42.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49413 - MasterRay - Fri Jul 29, 2005 4:50 pm</h4>
    <div class="postbody"><span class="postbody">Almost there, I have now an img.h file and I try to present it as a sprite, I've taken the demo that creates three sprites on the screen and I want to make the first sprite my image. I've copied the line: 
<br/>
for(int i=0;i&lt;32*32;i++)
<br/>
	SPRITE_GFX[i]=((u16*)img)[i] | BIT(15); //dont forget alpha bit
<br/>
from another example.
<br/>
But now all I get is:
<br/>
built ... arm7.bin
<br/>
main.cpp
<br/>
main.o: In function `main':
<br/>
c:/ndsdev/projects/LogicGates/arm9/source/main.cpp:139: undefined reference to `img'
<br/>
collect2: ld returned 1 exit status
<br/>
make[2]: *** [/c/ndsdev/projects/LogicGates/arm9/arm9.elf] Error 1
<br/>
make[1]: *** [build] Error 2
<br/>
Everything is exactly the same instead that line, what is the problem now?
<br/>
Thanks for all of your help.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49415 - natrium42 - Fri Jul 29, 2005 5:09 pm</h4>
    <div class="postbody"><span class="postbody">Did you include that header file? Look in the header file to make sure you are  using the correct variable name.<br/>_________________<br/><a class="postlink" href="http://www.natrium42.com" target="_blank">www.natrium42.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49417 - tepples - Fri Jul 29, 2005 5:18 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>natrium42 wrote:</b></span></td> </tr> <tr> <td class="quote">Yes, it's better to not use bin2s. Put your ressource files into data/ folder and the Makefile will automatically create a header file for each ressource. Linker will link the ressources into the final binary.
<br/>
<br/>
Look for bin2o in the Makefile if you want to see the mechanism.</td> </tr></table><span class="postbody">
<br/>
If it uses objcopy, then it will likely have alignment problems. Last time I tried objcopy, it had no way to specify an alignment larger than one byte. Using bin2s guarantees a 4-byte alignment.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49425 - natrium42 - Fri Jul 29, 2005 6:15 pm</h4>
    <div class="postbody"><span class="postbody">bin2o pads the file and I think the linker aligns the array but I am not sure. Didn't have any problems so far, though.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">define bin2o
<br/>
   padbin 4 $(&lt;)
<br/>
   $(OBJCOPY) -I binary -O elf32-littlearm -B arm \
<br/>
   ...
<br/>
endef
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/><a class="postlink" href="http://www.natrium42.com" target="_blank">www.natrium42.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49431 - tepples - Fri Jul 29, 2005 6:46 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>natrium42 wrote:</b></span></td> </tr> <tr> <td class="quote">bin2o pads the file and I think the linker aligns the array</td> </tr></table><span class="postbody">
<br/>
to a 1-byte boundary. The 'padbin' utility pads only the <span style="font-style: italic">end</span> of the file; if the last thing in .rodata before the first padbin+objcopy object is a 'char' or 'short' that doesn't happen to end up on a 4-byte boundary, then all the padbin+objcopy objects will still end up unaligned.
<br/>
<br/>
If you disagree with the whole-path behavior of bin2s, then modify it to use the basename behavior of gbfs.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49437 - natrium42 - Fri Jul 29, 2005 7:04 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>natrium42 wrote:</b></span></td> </tr> <tr> <td class="quote">bin2o pads the file and I think the linker aligns the array</td> </tr></table><span class="postbody">
<br/>
to a 1-byte boundary. The 'padbin' utility pads only the <span style="font-style: italic">end</span> of the file; if the last thing in .rodata before the first padbin+objcopy object is a 'char' or 'short' that doesn't happen to end up on a 4-byte boundary, then all the padbin+objcopy objects will still end up unaligned.</span></td> </tr></table><span class="postbody">
<br/>
I know that, hence the "I think the linker aligns the array but I am not sure"<br/>_________________<br/><a class="postlink" href="http://www.natrium42.com" target="_blank">www.natrium42.com</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
