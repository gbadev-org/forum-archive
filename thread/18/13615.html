<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Console problem - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > Console problem</h2>
<div id="posts">
<div class="post">
    <h4>#133777 - route66 - Sun Jul 08, 2007 4:40 pm</h4>
    <div class="postbody"><span class="postbody">Probably a noob thing, but if I move the printfs of the ansi_console example into the loop with swiWaitForVBlank(), then the first row doesn't get printed.  What am I missing?
<br/>
<br/>
Also \r doesn't work. (Just kidding!  hehehe)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#133830 - route66 - Mon Jul 09, 2007 2:23 am</h4>
    <div class="postbody"><span class="postbody">No thoughts?  
<br/>
<br/>
Actually, the first 6 rows dont get displayed.  And this is an example that is provided with DKP!
<br/>
<br/>
Do I need some kind of delay between the vblank interrupt and the first printf()?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#133835 - HyperHacker - Mon Jul 09, 2007 3:16 am</h4>
    <div class="postbody"><span class="postbody">The console isn't interrupt safe. Trying to print from within an interrupt can break things. Other than that, I don't know of any such limitations.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#133837 - route66 - Mon Jul 09, 2007 3:51 am</h4>
    <div class="postbody"><span class="postbody">I am not printing from interrupt, but from the main loop, I have tried before and after swiWaitForVBlank()</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#133843 - wintermute - Mon Jul 09, 2007 6:03 am</h4>
    <div class="postbody"><span class="postbody">Code would help determine what the problem might be. If it's simple then post here using the bbcode code tags, if not then host the complete project somewhere we can have a look.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#134004 - route66 - Tue Jul 10, 2007 1:55 am</h4>
    <div class="postbody"><span class="postbody">It is the ansi_console demo that comes with DKP.  I commented out some of the escape code sequences, now I just have 16 printfs.  The first 6 lines do not get shown.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include &lt;nds.h&gt;
<br/>
#include &lt;stdio.h&gt;
<br/>
<br/>
//---------------------------------------------------------------------------------
<br/>
int main(void) {
<br/>
//---------------------------------------------------------------------------------
<br/>
   int i;
<br/>
   // initialise the irq dispatcher
<br/>
   irqInit();
<br/>
   // a vblank interrupt is needed to use swiWaitForVBlank()
<br/>
   // since the dispatcher handles the flags no handler is required
<br/>
   irqEnable(IRQ_VBLANK);
<br/>
   videoSetMode(0);   //not using the main screen
<br/>
   videoSetModeSub(MODE_0_2D | DISPLAY_BG0_ACTIVE);   //sub bg 0 will be used to print text
<br/>
   vramSetBankC(VRAM_C_SUB_BG);
<br/>
<br/>
   SUB_BG0_CR = BG_MAP_BASE(31);
<br/>
<br/>
   BG_PALETTE_SUB[255] = RGB15(31,31,31);   //by default font will be rendered with color 255
<br/>
<br/>
   //consoleInit() is a lot more flexible but this gets you up and running quick
<br/>
   consoleInitDefault((u16*)SCREEN_BASE_BLOCK_SUB(31), (u16*)CHAR_BASE_BLOCK_SUB(0), 16);
<br/>
<br/>
   // ansi escape sequence to clear screen and home cursor
<br/>
   // /x1b[line;columnH
<br/>
   iprintf("\x1b[2J");
<br/>
   
<br/>
   // ansi escape sequence to set print co-ordinates
<br/>
   // /x1b[line;columnH
<br/>
   iprintf("\x1b[10;10HHello World!");
<br/>
<br/>
   // ansi escape sequence to move cursor up
<br/>
   // /x1b[linesA
<br/>
   iprintf("\x1b[10ALine 0");
<br/>
<br/>
   // ansi escape sequence to move cursor left
<br/>
   // /x1b[columnsD
<br/>
   iprintf("\x1b[28DColumn 0");
<br/>
<br/>
   // ansi escape sequence to move cursor down
<br/>
   // /x1b[linesB
<br/>
   iprintf("\x1b[19BLine 19");
<br/>
<br/>
   // ansi escape sequence to move cursor right
<br/>
   // /x1b[columnsC
<br/>
   iprintf("\x1b[5CColumn 20");
<br/>
<br/>
   while(1) {
<br/>
      
<br/>
      /*
<br/>
   // ansi escape sequence to clear screen and home cursor
<br/>
   // /x1b[line;columnH
<br/>
   iprintf("\x1b[2J");
<br/>
   
<br/>
   // ansi escape sequence to set print co-ordinates
<br/>
   // /x1b[line;columnH
<br/>
   iprintf("\x1b[10;10HHello World!");
<br/>
<br/>
   // ansi escape sequence to move cursor up
<br/>
   // /x1b[linesA
<br/>
   iprintf("\x1b[10ALine 0");
<br/>
<br/>
   // ansi escape sequence to move cursor left
<br/>
   // /x1b[columnsD
<br/>
   iprintf("\x1b[28DColumn 0");
<br/>
<br/>
   // ansi escape sequence to move cursor down
<br/>
   // /x1b[linesB
<br/>
   iprintf("\x1b[19BLine 19");
<br/>
<br/>
   // ansi escape sequence to move cursor right
<br/>
   // /x1b[columnsC
<br/>
   iprintf("\x1b[5CColumn 20");      
<br/>
   */
<br/>
      iprintf("\x1b[2J");
<br/>
      for (i=0; i&lt;15; i++)
<br/>
      {
<br/>
         printf("LINE%U\n", i);
<br/>
      }
<br/>
      swiWaitForVBlank();
<br/>
   }
<br/>
<br/>
   return 0;
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#134131 - wintermute - Tue Jul 10, 2007 9:41 pm</h4>
    <div class="postbody"><span class="postbody">The problem here is that the current code to clear the console is rather slow. The DS has already rendered part of the screen by the time you reach the first printf and, because you run the clear code and the printing in a continuous loop, you will never see the output for the first 6 or so lines.
<br/>
<br/>
The console was really designed as a quick and easy way to show debug output rather than anything you should use in an application. You can certainly build simple text menu applications easily but I wouldn't really consider using it for anything that needs to have fast screen updates.
<br/>
<br/>
For what it's worth, you don't really need to clear the screen for every loop of that. Since it's printing the same thing each loop all you need to do is home the cursor.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include &lt;nds.h&gt;
<br/>
#include &lt;stdio.h&gt;
<br/>
<br/>
<br/>
int main() {
<br/>
<br/>
   irqInit();
<br/>
   // a vblank interrupt is needed to use swiWaitForVBlank()
<br/>
   // since the dispatcher handles the flags no handler is required
<br/>
   irqEnable(IRQ_VBLANK);
<br/>
   
<br/>
   consoleDemoInit();
<br/>
<br/>
   int i;
<br/>
<br/>
    iprintf("\x1b[2J");
<br/>
<br/>
   while(1) {
<br/>
      swiWaitForVBlank();
<br/>
      iprintf("\x1b[0;0H"); 
<br/>
<br/>
      for (i=0; i&lt;15; i++) {
<br/>
           printf("LINE%u\n", i);
<br/>
        }
<br/>
   }
<br/>
}
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#134153 - route66 - Wed Jul 11, 2007 1:56 am</h4>
    <div class="postbody"><span class="postbody">Ok thanks, didn't realize clearing the screen was so slow.  I was clearing the screen on every loop so I could display a lot of debug info - but I will switch to just homing the cursor.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
