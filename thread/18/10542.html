<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Is there a work-around to break the 1024 unique tile limit? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > Is there a work-around to break the 1024 unique tile limit?</h2>
<div id="posts">
<div class="post">
    <h4>#94913 - thundrestrike - Wed Jul 26, 2006 9:02 pm</h4>
    <div class="postbody"><span class="postbody">Hello,
<br/>
<br/>
Is there a work-around for breaking the 1024 unique tile limit [Palib]?
<br/>
<br/>
Or do we have to wait for a new release that includes this?<br/>_________________<br/>popcorn</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#94929 - Sausage Boy - Wed Jul 26, 2006 10:30 pm</h4>
    <div class="postbody"><span class="postbody">It's a hardware limitation. If you want to work around it, use libnds with some trickery.<br/>_________________<br/>"no offense, but this is the gayest game ever"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#94930 - tepples - Wed Jul 26, 2006 10:36 pm</h4>
    <div class="postbody"><span class="postbody">Only 33x25 = 825 unique tiles can be visible on each layer of each screen at once. Why do you need more than 1,024?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#94935 - LiraNuna - Wed Jul 26, 2006 10:56 pm</h4>
    <div class="postbody"><span class="postbody">There is a workaround that i only planned to code for ToD2...
<br/>
Here's the basic pseudocode for it: 
<br/>
Wait a sec... are you using PAlib? forget what i said.
<br/>
<br/>
Edit: I'm not evil...
<br/>
Note: this code hadn't been tested, and could get re-written way better.
<br/>
dynamic tiles pseudocode: 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">// revision two
<br/>
<br/>
array of 1024 u32's. position represents tile index in RAM, value is the virtual tile
<br/>
<br/>
variables: 
<br/>
<br/>
unsigend number to represent current tile avaliable on VRAM
<br/>
unsigned number tilearray of size 1024
<br/>
<br/>
clear tiles array
<br/>
for all visable area on screen {
<br/>
   if tile to be placed is not on array
<br/>
      copy tile to VRAM in offset current tile on VRAM
<br/>
      mark current tile on VRAM as used
<br/>
      increase current tile variable
<br/>
      
<br/>
   place tile index to map from array
<br/>
}</td> </tr></table><span class="postbody"><br/>_________________<br/>Private property.
<br/>
Violators will be shot, survivors will be shot again.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#94959 - dovoto - Thu Jul 27, 2006 12:59 am</h4>
    <div class="postbody"><span class="postbody">First pass (basicaly the method Lira is suggesting i believe):
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
Create an array of u16 that is the size of the number of unique tiles in your world and zero it out. (lets say indexLookup[] )
<br/>
<br/>
Clear tile memory and map memory in vram.
<br/>
<br/>
Load the visable portion of the map as follows:
<br/>
  
<br/>
tileCount = 0;
<br/>
<br/>
 for(x is left to right)  
<br/>
      for (y is down to up)
<br/>
{
<br/>
   index =  get the index from your map based on current x and y;
<br/>
    
<br/>
   if(indexLookup[index] == 0)
<br/>
   {
<br/>
       Load tile graphics into background tile graphics memory at an offset  of  tileCount * sizeof(tile);
<br/>
<br/>
       vram_map[index by x and y] = tileCount | your tile flags;
<br/>
<br/>
       indexLookup[index] = tileCount++;
<br/>
   }
<br/>
    else //tile graphics are allready in memory
<br/>
   {
<br/>
         vram_map[index by x and y] = indexLookup[index] | your tile flags;
<br/>
   }
<br/>
}
<br/>
<br/>
Repeate each frame
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
This method is simple but you will notice you have to copy in tile graphics for every tile every frame (doable if you dont have much else going on in your game).
<br/>
<br/>
A bit better approach:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">Create another table called UsageCount of the same dimesions as your index lookup.  
<br/>
<br/>
Dont clear the lookup table or memory.
<br/>
<br/>
look only at the row and column coming onscreen due to scrolling.  Still use the indexLookup and if it is zero load your tile (but a bit different now) and if it is not zero just set the map index to the lookup value.
<br/>
<br/>
To load the tile you will need a stack of available tiles.  There are template classes in the STL or you can just roll your own stack struct.class.  It will simply maintain a list of offsets into tile graphics memory and allow you to pop them off as needed and push them back on when you are done with them.  So:
<br/>
<br/>
tileGraphicsPointer = Tilestack.pop();
<br/>
copy(myTileGraphics[index], tileGraphicsPointer, sizeof(tile));
<br/>
<br/>
Every time you add a certain index to the map increment that index?s UsageCount (usageCount[index]++).  This will keep track of how many of any given tile you have on screen.
<br/>
<br/>
Now process all the tiles that went off screen and decrement the usageCount[index] for those tiles.  This will actually require you to have another lookup table that maps on screen map index to your own index (inverseIndexLookup[] would be a good name)?
<br/>
<br/>
If the usageCount for that index gets down to 0 push its tile graphics slot back onto the stack so it can be reused.</td> </tr></table><span class="postbody">
<br/>
<br/>
This ensures only the tiles you need are actually loaded into memory, and only the new tiles coming on screen are processed.  This of course is quite a bit more complex.
<br/>
<br/>
Hope this was not too terribly confusing.<br/>_________________<br/><a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#94967 - thundrestrike - Thu Jul 27, 2006 1:37 am</h4>
    <div class="postbody"><span class="postbody">ok ill let you guys know the reason behind this
<br/>
<br/>
If you guys can remember "VGMDS" [Virtual Game Maker DS]
<br/>
The RPGMaker system for the Nintendo DS developed by Globoeil
<br/>
<br/>
It is still progressing, and it is very good so far!
<br/>
He needs to break the 1024 unique tiles limit in order to achieve working custom chipsets. For more information and to see how its going so far, visit <a class="postlink" href="http://vgmds.keogratuit.com/phpBB2/" target="_blank"> the Main Forum </a>. 
<br/>
<br/>
The next version is on the verge of releasing.
<br/>
Just so you know, I am the main tester of VGMDS, not the coder.
<br/>
The coder is Globoeil!
<br/>
<br/>
I will give him a link to this very topic.
<br/>
Thank you guys!
<br/>
-Thundrestrike<br/>_________________<br/>popcorn</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#94973 - tepples - Thu Jul 27, 2006 3:29 am</h4>
    <div class="postbody"><span class="postbody">You can get 2048 tiles if you use two backgrounds, and then you can just dynamically reload them as you scroll.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#94994 - Valmond - Thu Jul 27, 2006 7:38 am</h4>
    <div class="postbody"><span class="postbody">I'v written a couple of small "libraries" for tiles and sprites that
<br/>
handles them dynamicly (read streaming data) so I'm no longer
<br/>
bothered by limits like 128 sprites per level or 1024 tiles per game.
<br/>
<br/>
It works okay, some features are missing but I can put em up on
<br/>
my website if people are interested.
<br/>
<br/>
<br/>
Check out the my signature to see them in work^^
<br/>
<br/>
/Valmond<br/>_________________<br/><a class="postlink" href="http://ludviglarsson.free.fr/DSLite/" target="_blank">N?fer &amp; LudLib</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#95073 - DynamicStability - Thu Jul 27, 2006 6:39 pm</h4>
    <div class="postbody"><span class="postbody">Cool thread, thanks for the procedures Liran and Dov.  I'd like to take a look at that code Valmond!  I'll have to try your game too.<br/>_________________<br/>Framebuffer is dead.
<br/>
DynaStab.DrunkenCoders.com</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#95095 - Valmond - Thu Jul 27, 2006 8:49 pm</h4>
    <div class="postbody"><span class="postbody">Added a page for downloads on my "<a class="postlink" href="http://ludviglarsson.free.fr/DSLite/" target="_blank">site</a>".
<br/>
<br/>
feel free to bug me about stuff that doesn't work^^
<br/>
<br/>
/Valmond<br/>_________________<br/><a class="postlink" href="http://ludviglarsson.free.fr/DSLite/" target="_blank">N?fer &amp; LudLib</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#95304 - DynamicStability - Fri Jul 28, 2006 5:38 pm</h4>
    <div class="postbody"><span class="postbody">I'll try it out, thanks.<br/>_________________<br/>Framebuffer is dead.
<br/>
DynaStab.DrunkenCoders.com</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
