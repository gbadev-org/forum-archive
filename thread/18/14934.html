<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Getting a filesize with r21 - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Getting a filesize with r21</h2>
<div id="posts">
<div class="post">
    <h4>#150021 - cornaljoe - Mon Jan 28, 2008 11:55 pm</h4>
    <div class="postbody"><span class="postbody">Currently I'm using:
<br/>
Loop:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">fopen
<br/>
fseek(SEEK_END)
<br/>
ftell
<br/>
fclose</td> </tr></table><span class="postbody">
<br/>
Is there a faster way to get multiple filesizes?  Thanks for the help.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#150025 - yellowstar - Tue Jan 29, 2008 12:37 am</h4>
    <div class="postbody"><span class="postbody">*EDIT: Well, I don't know about speed... Here's the code I use. I've used this code for a long time, without any problems.*
<br/>
<br/>
Here's some code from flipcode:(I've tested it with the DS, and it works)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
GetFileLength(FILE *file)
<br/>
{
<br/>
   int l_iSavPos, l_iEnd;
<br/>
<br/>
   l_iSavPos = ftell(file);
<br/>
   fseek(file, 0, SEEK_END);
<br/>
   l_iEnd = ftell(file);
<br/>
   fseek(file, l_iSavPos, SEEK_SET);
<br/>
<br/>
   return l_iEnd;
<br/>
} 
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#150029 - Lazy1 - Tue Jan 29, 2008 1:12 am</h4>
    <div class="postbody"><span class="postbody">I believe <a class="postlink" href="http://www.hmug.org/man/2/stat.php" target="_blank">stat()</a> is what you are looking for and if I remember correctly it does work on the NDS.
<br/>
<br/>
Quick sample, tested MSVC C++ v2002:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include &lt;stdio.h&gt;
<br/>
#include &lt;string.h&gt;
<br/>
#include &lt;sys/stat.h&gt;
<br/>
<br/>
int main( int Argc, char* Argv[ ] ) {
<br/>
   struct stat st;
<br/>
<br/>
   if ( stat( "main.cpp", &amp;st ) == 0 ) {
<br/>
      printf( "File size: %d\n", st.st_size );
<br/>
      return 0;
<br/>
   }
<br/>
<br/>
   return 1;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
EDIT:
<br/>
Forgot multiple, but still this may be faster than opening, closing and seeking for each file.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#150241 - cornaljoe - Thu Jan 31, 2008 10:40 pm</h4>
    <div class="postbody"><span class="postbody">Thanks Lazy1 that did the trick!</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
