<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>DS GBA Link - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > DS GBA Link</h2>
<div id="posts">
<div class="post">
    <h4>#22544 - sgeos - Thu Jun 24, 2004 12:56 am</h4>
    <div class="postbody"><span class="postbody">Does anybody know if the the DS will be able to link to GBA units via the standard GBA link cable?
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22545 - PhoenixSoft - Thu Jun 24, 2004 12:57 am</h4>
    <div class="postbody"><span class="postbody">As far as I know, the DS has no GBA link port on it so only wireless-enabled games can be used with it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22546 - sgeos - Thu Jun 24, 2004 1:00 am</h4>
    <div class="postbody"><span class="postbody">In that case, perhaps it's a good thing that I spent my time learning things other than details of GBA SIO. =P
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22550 - ampz - Thu Jun 24, 2004 1:36 am</h4>
    <div class="postbody"><span class="postbody">GBA UART mode is straight forward and similar to any standard UART.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22552 - tepples - Thu Jun 24, 2004 1:38 am</h4>
    <div class="postbody"><span class="postbody">Last time I checked, GBA UART mode can't multiboot the clients in a single-pak situation. And can GBA UART mode be used with more than one GBA?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22580 - ampz - Thu Jun 24, 2004 4:30 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Last time I checked, GBA UART mode can't multiboot the clients in a single-pak situation. And can GBA UART mode be used with more than one GBA?</td> </tr></table><span class="postbody">
<br/>
Yes, it can be used with two GBAs ;-)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22602 - sgeos - Fri Jun 25, 2004 2:32 am</h4>
    <div class="postbody"><span class="postbody">Is it feasible to do a SIO Multiplayer transfer once a frame?
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22628 - Miked0801 - Fri Jun 25, 2004 7:10 pm</h4>
    <div class="postbody"><span class="postbody">Yes.  You can do this if you have really tight game code.  Keep in mind that the transfer code will take a signifigant portion of your CPU time.  We went every other frame to make it a bit easier.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22631 - sgeos - Fri Jun 25, 2004 7:42 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Miked0801 wrote:</b></span></td> </tr> <tr> <td class="quote">You can do this if you have really tight game code.  Keep in mind that the transfer code will take a signifigant portion of your CPU time.</td> </tr></table><span class="postbody">
<br/>
What percentage are we looking at?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Miked0801 wrote:</b></span></td> </tr> <tr> <td class="quote">We went every other frame to make it a bit easier.</td> </tr></table><span class="postbody">
<br/>
What is the best way to sync a game to 30 FPS?
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22635 - Miked0801 - Fri Jun 25, 2004 9:27 pm</h4>
    <div class="postbody"><span class="postbody">Check out the SGade stuff.  It has sutff built in for doing copying at about any rate you want.  It's the best resource out there for Multi SIO code.  As to percentage - I'd guess roughly 5-15% overhead depending on how big your packets are and if transfering to 2 or more players.  Keep in mind that this stuff is very error prone and resends are somewhat common so you need to checksum/error check each packet or watch things go out of sync in a hurry.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22646 - ampz - Sat Jun 26, 2004 3:26 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Miked0801 wrote:</b></span></td> </tr> <tr> <td class="quote">You can do this if you have really tight game code.  Keep in mind that the transfer code will take a signifigant portion of your CPU time.</td> </tr></table><span class="postbody">
<br/>
Use interrupts and no polling, should not consume much CPU time. DMA would be even better, but I guess the GBA do not support it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22652 - Miked0801 - Sat Jun 26, 2004 5:33 am</h4>
    <div class="postbody"><span class="postbody">This is assuming interrupts and no polling.  It takes a lot of time to send data across the link and verify it...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22674 - ampz - Sat Jun 26, 2004 6:52 pm</h4>
    <div class="postbody"><span class="postbody">Well, yes, it takes time (real time) to send data due to the modest bandwidth, but not CPU time.
<br/>
Of course, CRC allways takes its toll.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22693 - Miked0801 - Sun Jun 27, 2004 6:09 am</h4>
    <div class="postbody"><span class="postbody">A normal packet 12 bytes
<br/>
<br/>
1 send for all is ready
<br/>
6 16-bit sends
<br/>
1+ for slave(s) got ok
<br/>
1 for master tell slaves to go to next loop
<br/>
1+ resend till master is sure slaves are on next loop
<br/>
<br/>
So about a minimum of 10 (realistically, syncing eats a ton more) interrupts to get this to occur.
<br/>
<br/>
Each interrupt has both crt0.s and bios cycles to go through (for us, this is roughly 150 cycles in and 100 out)
<br/>
Each call has to go through all the state check code and get to the point where it wants to send.  I'll guess an average of 100 cycles.
<br/>
<br/>
So best case is (100+100)x10 cycles or 2,000.  You get roughly 280,000 cycles in a 1/60th sync period.  So cycle overhead isn't killing too bad.  
<br/>
<br/>
But, you can't call the SIO interrupt too often or the hardware won't recognize it and it will return an error state (bit 6 or 7 depending on timing).  I'd guess (no stats in front of me) that you could call the SIO roughly 15 times in a 1/60th period without too many hardware errors.  That means that you'd better have your data ready to send in 1/3 of 1/60 of a second.  Even with input buffering and playing with 1 tic of lag (what I do) it's very difficult to keep the game at 60Hz - and because of the induced lag, it will feel like a 30Hz game anyways.
<br/>
<br/>
BTW, if you miss a packet or get corruption (which happens quite often), you have to wait for the check to occur on the final send and then resend the whole packet (at at least 10 sends) which guarentees you will drop a frame if running at 60Hz and also means that 30Hz games get a bit tight.  
<br/>
<br/>
This is what I mean about 60Hz having to run really tight to pull it off.  Other people with experience, I'll gladly take your opinion as well.  Also since I am not at work, my 15 times a tick number might be a touch off - though not too much (perhaps as high as 20 but not much more)
<br/>
<br/>
Mike</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22694 - sgeos - Sun Jun 27, 2004 6:23 am</h4>
    <div class="postbody"><span class="postbody">After the initial setup, would it be too dangerous to try to keep the games synced only sending KEYINPUT, the frame number and parity bits (to up to four GBAs)?  Obviously "All OK" sends would be needed.
<br/>
<br/>
I'm looking at a scheme consisting of 10 bits for the buttons, 3 bits parity, 2 bits frame counter, and one control bit.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22697 - tepples - Sun Jun 27, 2004 7:10 am</h4>
    <div class="postbody"><span class="postbody">If you just use KEYINPUT reflection, then after 20 minutes, all machines may fall out of sync because their crystals will have got out of sync. It's best to use at least <span style="font-style: italic">some</span> universe reflection every once in a while, even if not all at once.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22728 - Miked0801 - Mon Jun 28, 2004 5:09 am</h4>
    <div class="postbody"><span class="postbody">Actually, we never need to do this.  We just don't assume that a packet is sent because the master send it (hence the ending sequence I mentioned earlier).  Universe reflection is just too expensive.  Key-button presses with an initial random seed and minimal starting state vars are enough.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22729 - sgeos - Mon Jun 28, 2004 5:17 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">If you just use KEYINPUT reflection, then after 20 minutes, all machines may fall out of sync because their crystals will have got out of sync. It's best to use at least <span style="font-style: italic">some</span> universe reflection every once in a while, even if not all at once.</td> </tr></table><span class="postbody">
<br/>
That is what the 2 bit frame counter is for.  If it does not match for all units, then the units that are ahead a frame go into stall state and do not update the universe (and frame counter) until the frame counters match again.
<br/>
<br/>
What are the chances of a unit becoming more than one frame out of sync assuming (near) identical initial setups?
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22733 - tepples - Mon Jun 28, 2004 7:15 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sgeos wrote:</b></span></td> </tr> <tr> <td class="quote">What are the chances of a unit becoming more than one frame out of sync assuming (near) identical initial setups?</td> </tr></table><span class="postbody">
<br/>
What are the chances of bit errors?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22752 - Miked0801 - Mon Jun 28, 2004 7:20 pm</h4>
    <div class="postbody"><span class="postbody">Lol :)
<br/>
<br/>
Pretty low, but it will happen.  Thus, you need a strong checksumming system (or CRC, but input interchanging isn't likely so checksum does about as well and is faster.)  
<br/>
<br/>
What Tepples is saying is that you can't just set 2 (or more) systems syncing with their interal timers and assume they will stay in sync.  You need a more robust solution (like what you and I are talking about.)  BTW, is this just a curiousity, or do you have the means to debug this sort of thing?  You need no$gba at the least and hardware debuggers are better do to the complexity of multiplayer code.  Also, you need to be really, really careful in your game code making sure that you aren't doing something that is hardware specific and will thus throw you out of sync (likme using an internal timer as a random number seed or reading off the end of an array on accident.)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22771 - sgeos - Tue Jun 29, 2004 5:51 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">What are the chances of bit errors?</td> </tr></table><span class="postbody">
<br/>
100%, given enough time.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Miked0801 wrote:</b></span></td> </tr> <tr> <td class="quote">Pretty low, but it will happen.</td> </tr></table><span class="postbody">
<br/>
At this point I think a better question is how long will it take for at least one of four GBAs to drop one frame out of sync?  How long will it take for at least a unit to fall two frames out of sync all at once?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Miked0801 wrote:</b></span></td> </tr> <tr> <td class="quote">What Tepples is saying is that you can't just set 2 (or more) systems syncing with their interal timers and assume they will stay in sync.  You need a more robust solution (like what you and I are talking about.)</td> </tr></table><span class="postbody">
<br/>
Right.  I'm trying to determine what kind of assumptions the robust solution can operate on.  If I know that two systems will never fall more than one frame out of sync at a time, then I can give the lagging system(s) a chance to catch up.  If a bit error happens about every second (found by parity), and two bit errors in one block happen about every fifteen minutes (not found by parity), I'd take two bit errors fairly seriously depending on the type of information being exchanged.
<br/>
<br/>
Do you have any idea how many bits are in error?  (Expressed in terms of a fraction.)  This could easily be calculated by seeding an RNG (probably a LCG) on both ends and comparing the data as it hits the remote system.
<br/>
<br/>
If one GBA receives erroneous data, that may not be the case for the other units, correct?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Miked0801 wrote:</b></span></td> </tr> <tr> <td class="quote">BTW, is this just a curiousity, or...</td> </tr></table><span class="postbody">
<br/>
It's more a question of how difficult integrating multiplayer capabilities into a game are.  If I can read KEYINPUT for four GBA units in a more or less reliable fashion, then adding multiplayer support certain types of multi-player games will be easy.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Miked0801 wrote:</b></span></td> </tr> <tr> <td class="quote">...or do you have the means to debug this sort of thing?  You need no$gba at the least and hardware debuggers are better do to the complexity of multiplayer code.</td> </tr></table><span class="postbody">
<br/>
I only have one GBA at the moment.  If I really need to implement multiplayer on my own I'd pick up a second unit (and/or petition friends to get GBAs =)  How painful would it be to hash out multiplayer issues using only hardware?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Also, you need to be really, really careful in your game code making sure that you aren't doing something that is hardware specific and will thus throw you out of sync (likme using an internal timer as a random number seed or reading off the end of an array on accident.)</td> </tr></table><span class="postbody">
<br/>
For a single player game, I think that adding the results of a LCG with a timer would be a fantastic way of getting random numbers.  Having remote units that have to stay in tune with one another changes things.  (The master unit may want to generate the initial seed using some hardware specific method.)
<br/>
<br/>
It seems to me that all units would want to (try to) keep and operate on identical models of the game universe and only differ in how those models are displayed.  (This is why all units need to be able to read eachother's KEYINPUT.)  The different views (one per GBA) of the game universe alone will be enough to mess up parallel timing.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22774 - Zero - Tue Jun 29, 2004 7:03 am</h4>
    <div class="postbody"><span class="postbody">holy post of hugeness!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22777 - sgeos - Tue Jun 29, 2004 8:11 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Zero wrote:</b></span></td> </tr> <tr> <td class="quote">holy post of hugeness!</td> </tr></table><span class="postbody">Bah! =)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22814 - dagamer34 - Tue Jun 29, 2004 10:17 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sgeos wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Miked0801 wrote:</b></span></td> </tr> <tr> <td class="quote">...or do you have the means to debug this sort of thing?  You need no$gba at the least and hardware debuggers are better do to the complexity of multiplayer code.</td> </tr></table><span class="postbody">
<br/>
I only have one GBA at the moment.  If I really need to implement multiplayer on my own I'd pick up a second unit (and/or petition friends to get GBAs =)  How painful would it be to hash out multiplayer issues using only hardware?
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
Like finding a needle in a haystack the size of Texas. It's really difficult. I eventually just gave up that part to focus on other things. If only I had no$GBA...<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"><br/><br/>Last edited by dagamer34 on Wed Jun 30, 2004 1:03 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#22825 - Miked0801 - Wed Jun 30, 2004 12:09 am</h4>
    <div class="postbody"><span class="postbody">Lol - Sounds like you entered the "I hate GBA mulitplayer" club as well.  A select few of us who have ripped out much hair to try to get it at all working.  Yes, you can get it working.  We spent about 6 man months to get the base engine there.  Then more per project to make sure that game code is behaving in a multiplayer safe manner.  I'm sorry, but GBA multiplayer just isn't something that I feel is a GBA hobbiest thing to get working.  Someone else, please prove me wrong and get a STABLE (as in a game that stays in sync for weeks, not hours or minutes) game connection with the standard cable.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22832 - dagamer34 - Wed Jun 30, 2004 1:09 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Miked0801 wrote:</b></span></td> </tr> <tr> <td class="quote">Lol - Sounds like you entered the "I hate GBA mulitplayer" club as well.  A select few of us who have ripped out much hair to try to get it at all working.  Yes, you can get it working.  We spent about 6 man months to get the base engine there.  Then more per project to make sure that game code is behaving in a multiplayer safe manner.  I'm sorry, but GBA multiplayer just isn't something that I feel is a GBA hobbiest thing to get working.  Someone else, please prove me wrong and get a STABLE (as in a game that stays in sync for weeks, not hours or minutes) game connection with the standard cable.</td> </tr></table><span class="postbody">
<br/>
<br/>
I STRONGLY doubt it. With no emulator to see what is happening, it's all guess work. I'm surprised I got the SGADE code working in the first place.<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22871 - ampz - Wed Jun 30, 2004 6:06 pm</h4>
    <div class="postbody"><span class="postbody">The standard cable cannot do UART comms?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22888 - Miked0801 - Wed Jun 30, 2004 8:25 pm</h4>
    <div class="postbody"><span class="postbody">Correct - at least that is what I've been told.  Someone else want to confirm that?  Even if it does work, it won't support 4 player which is what Nintendo wants...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22895 - ampz - Wed Jun 30, 2004 9:55 pm</h4>
    <div class="postbody"><span class="postbody">Well, not all of us care about what Nintendo want :)
<br/>
<br/>
I just checked the cable schematics. A GBC cable should work fine with GBA UART comms.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22930 - sgeos - Thu Jul 01, 2004 2:23 pm</h4>
    <div class="postbody"><span class="postbody">Nintendo want 4 player games to be made?  It sounds plausible.  Have they been telling this to developers?  (As opposed to 2 or 3 player games.)
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22947 - Miked0801 - Thu Jul 01, 2004 7:09 pm</h4>
    <div class="postbody"><span class="postbody">Can't really answer that one without sticking a foot in my mouth.  I will say that having a good 4 player engine in place has been nice marketing tool.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
