<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Getting both the ARM7 and ARM9 to access slot-2 memory - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > Getting both the ARM7 and ARM9 to access slot-2 memory</h2>
<div id="posts">
<div class="post">
    <h4>#148603 - simonjhall - Mon Jan 07, 2008 8:50 pm</h4>
    <div class="postbody"><span class="postbody">Am I right in thinking that only one of the processors is able to access the slot-2 card at any one time? As in, you need to explicityly change bit 11 (from the ARM9) of REG_EXEMEMCNT when you want to switch access?
<br/>
There's gotta be another way ;-) (Natwest?)
<br/>
<br/>
Writing a multithreaded game engine where only one CPU has access to the game's memory is doing my nut!<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#148610 - Rajveer - Mon Jan 07, 2008 10:05 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>simonjhall wrote:</b></span></td> </tr> <tr> <td class="quote">There's gotta be another way ;-) (Natwest?)</td> </tr></table><span class="postbody">
<br/>
<br/>
Haha! Sadly, that's all I can contribute to the thread :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#148653 - chishm - Tue Jan 08, 2008 9:51 am</h4>
    <div class="postbody"><span class="postbody">Definitely only one CPU at a time. Also, the register is named EXMEMCNT, not EXEMEMCNT. That was a mistake in a previous version of libnds and has been fixed in later versions. Probably the best you can do is give the slot to one CPU exclusively and have the other CPU use more of EXRAM. Don't forget that the sound hardware can't use the slot at all.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#148776 - ingramb - Thu Jan 10, 2008 5:39 am</h4>
    <div class="postbody"><span class="postbody">You've probably already thought of this, but you could probably build a system where the arm7 can lock/unlock the ram via IPC/FIFO interrupts to the arm9.
<br/>
<br/>
So each CPU would have the equivalent of ram_lock/ram_unlock.  ram_unlock would block while the other CPU had the ram_unlocked.  As long as neither CPU kept the ram unlocked for too long, it might work pretty well (as well as you could expect with slow slot2 ram).  Has anyone tried something like this?  Might be a useful project.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#148807 - simonjhall - Thu Jan 10, 2008 3:27 pm</h4>
    <div class="postbody"><span class="postbody">Yeah I already have an IPC thing goin' on that allows the second processor to unlock the memory. But as you say, the first would then have to block until it's done! Kind of defeats the point of using two processors to do the work!
<br/>
The other alternative would be to add blocking all over the code base (rather than in the IPC code) so the blocking only happens just before the data gets read. But there's so much code to mark up this would introduce so many bugs that it wouldn't be worth the effort!
<br/>
<br/>
Anyway, I've relocated half of my code to slot-2 RAM (it *almost* runs) and I've noticed a weird one: breakpoints no longer work! Data aborts still happen but breakpoints don't seem to trigger in this memory! I've not done enough testing though... (could be an 8-bit write thing)
<br/>
It's making debugging a bit slow :-)
<br/>
<br/>
EDIT: nevermind, I'm 95% sure that it's a "bl can only jump so far" problem. 0x8000000-&gt;0x2000000 is a loooong way!<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
