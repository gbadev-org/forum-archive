<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>n00bish vram bank setup problem - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > n00bish vram bank setup problem</h2>
<div id="posts">
<div class="post">
    <h4>#171176 - grapeape - Wed Nov 04, 2009 4:18 pm</h4>
    <div class="postbody"><span class="postbody">Hi all,
<br/>
<br/>
Can anyone tell me what I'm doing wrong?  I'm trying to draw some sprites on top of a background on the main screen.  I can draw the sprites or draw the background but not both!
<br/>
<br/>
The following gets me my sprites (sprite code is omitted - let me know if I should post it):
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
videoSetMode(MODE_0_2D | DISPLAY_BG0_ACTIVE);
<br/>
videoSetModeSub(MODE_0_2D);
<br/>
vramSetBankA(VRAM_A_MAIN_SPRITE);
<br/>
vramSetBankB(VRAM_B_MAIN_BG);
<br/>
<br/>
oamInit(&amp;oamMain, SpriteMapping_1D_128, false);
<br/>
   
<br/>
int bg = bgInit(0, BgType_Text8bpp, BgSize_T_256x256, 0,1);
<br/>
dmaCopy(tiles, bgGetGfxPtr(bg), sizeof(tiles));
<br/>
dmaCopy(map32x32, bgGetMapPtr(bg),  sizeof(map32x32));
<br/>
dmaCopy(palette, BG_PALETTE, sizeof(palette));
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
If I swap the vram banks for the sprites and background on the main screen like so:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
vramSetBankA(VRAM_A_MAIN_BG);
<br/>
vramSetBankB(VRAM_B_MAIN_SPRITE);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I can see my background, but not my sprites.  Any ideas?
<br/>
<br/>
The documentation for libnds appears a bit thin.  Am I missing some good resources?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171177 - sverx - Wed Nov 04, 2009 4:31 pm</h4>
    <div class="postbody"><span class="postbody">try this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">vramSetBankA(VRAM_A_MAIN_BG_0x06000000); 
<br/>
vramSetBankB(VRAM_B_MAIN_SPRITE_0x06400000);</td> </tr></table><span class="postbody">
<br/>
<br/>
it's because these defines for VRAM B with no address included do map the B bank as a BG (or Sprite) <span style="font-weight: bold">2nd</span> bank, thus at a different address.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171178 - grapeape - Wed Nov 04, 2009 4:35 pm</h4>
    <div class="postbody"><span class="postbody">That did the trick.  Can you explain (or point me to an explanation) what's going on there?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171179 - sverx - Wed Nov 04, 2009 4:40 pm</h4>
    <div class="postbody"><span class="postbody">Yeah, sorry I edited my original post but after posting it I decided a bit of explanation was needed, you see.
<br/>
<br/>
btw if you look at libnds video.h file, you'll see that VRAM_B_MAIN_SPRITE and VRAM_B_MAIN_BG are defined with an offset.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">VRAM_B_MAIN_BG       = 1 | VRAM_OFFSET(1)
<br/>
VRAM_B_MAIN_SPRITE   = 2 | VRAM_OFFSET(1)</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171180 - grapeape - Wed Nov 04, 2009 4:51 pm</h4>
    <div class="postbody"><span class="postbody">Thanks.  I'll spend some time poking around in the headers.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171189 - sverx - Thu Nov 05, 2009 9:12 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>grapeape wrote:</b></span></td> </tr> <tr> <td class="quote">Thanks.  I'll spend some time poking around in the headers.</td> </tr></table><span class="postbody">
<br/>
<br/>
Time well spent :)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
