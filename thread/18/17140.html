<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Trouble with tiles - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Trouble with tiles</h2>
<div id="posts">
<div class="post">
    <h4>#172852 - sylvestersteele - Mon Mar 08, 2010 3:46 pm</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
 I got a background to display properly- but when I use tiles nothing happens. 
<br/>
<br/>
My init code is:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
     vramSetMainBanks(VRAM_A_MAIN_BG_0x06000000,
<br/>
                     VRAM_B_MAIN_BG_0x06020000,
<br/>
                     VRAM_C_SUB_BG_0x06200000,
<br/>
                     VRAM_D_LCD);
<br/>
<br/>
    videoSetMode(MODE_5_2D | 
<br/>
                 DISPLAY_BG3_ACTIVE); 
<br/>
<br/>
   
<br/>
    videoSetModeSub(MODE_5_2D | 
<br/>
                    DISPLAY_BG3_ACTIVE);
<br/>
<br/>
<br/>
REG_BG3CNT = BG_RS_64x64 |
<br/>
                 BG_TILE_BASE(1) | 
<br/>
                 BG_PRIORITY(0);
<br/>
<br/>
   
<br/>
    REG_BG3PA = 1&lt;&lt; 8;
<br/>
    REG_BG3PB = 0;
<br/>
    REG_BG3PC = 0;
<br/>
    REG_BG3PD = 1&lt;&lt; 8;
<br/>
<br/>
    
<br/>
    REG_BG3X = 0;
<br/>
    REG_BG3Y = 0;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
To display I use:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">  dmaCopyHalfWords(DMA_CHANNEL,
<br/>
                     shuttleBitmap, 
<br/>
                     (uint16 *)BG_TILE_RAM(1), 
<br/>
                     shuttleBitmapLen); 
<br/>
<br/>
 dmaCopyHalfWords(DMA_CHANNEL,
<br/>
                     shuttlePal,
<br/>
                     (uint16 *)TILE_PALETTE(1),
<br/>
                     shuttlePalLen); 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
And my command line params to grit- which I used to convert a 64x64 png are:
<br/>
<br/>
-fts -W3 -gT! -gt -gB4
<br/>
<br/>
I looked at the following post- but I couldn't figure what I am missing.
<br/>
<a href="http://forum.gbadev.org/viewtopic.php?t=16828" target="_blank">http://forum.gbadev.org/viewtopic.php?t=16828</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172853 - elwing - Mon Mar 08, 2010 3:55 pm</h4>
    <div class="postbody"><span class="postbody">mode 5 is for bitmap, not tilemap...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172856 - sverx - Mon Mar 08, 2010 5:26 pm</h4>
    <div class="postbody"><span class="postbody">you can have tilemaps too in mode 5...
<br/>
<br/>
btw when I encounter those errors I check with an emulator if
<br/>
- I am using the correct video mode &amp; the background is activated
<br/>
- I load the tiles correctly
<br/>
- I load the palette correctly
<br/>
- I load the maps correctly
<br/>
at least one of these should be wrong if you don't see anything.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172862 - sylvestersteele - Mon Mar 08, 2010 6:10 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sverx wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
- I load the maps correctly
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I don't think I am loading the maps at all. I just load the tiles and the palette. I copy the "Bitmap" part of the grit output into the BG_TILE_RAM(1) location. How do I go about loading maps? 
<br/>
<br/>
When I check the palette in the emulator- I see no colors- its all black. Does that mean that my palette isn't being loaded correctly? What could be the problem here? I notice that the palette is in half words and the bitmap part is in a complete word- do I have to do something different to copy this etc?
<br/>
<br/>
Sylvester</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172866 - Cearn - Mon Mar 08, 2010 8:11 pm</h4>
    <div class="postbody"><span class="postbody">sylvestersteele, there are several inconsistencies and errors in what you've written here.
<br/>
<br/>
Firstly, inconsistencies between the grit arguments, its output and the way it is used in the code. This makes it hard to see what your actual intentions are.<ul><li>The `-gt' flag indicates the creation of tiled data, but the "-Bitmap" in the output suggests bitmapped data. So which are you looking for, tiles or bitmaps? </li><li>BG 3 in mode 5 is an extended affine BG, for which the options are an 8bpp affine tiled BG, and 8bpp or 16bpp bitmap BG. But in the grit options you use `-gB4', which creates 4bpp data. </li><li>Related to the last point, you're trying to copy the palette to a 16-color palette bank, but that's option is only available for 4bpp tilemaps.</li></ul>What are you actually after here, a tilemap or a bitmap? And at which bitdepth? How to set the background control and where/how to copy data depends very much on these questions.
<br/>
<br/>
The only real error here is the following: TILE_PALETTE is not an address, but a macro to tell a tile which 16-color palette bank it should use. There are no macros to get the address of a 16-color palette-bank, you'll just have to get it by using BG_PALETTE.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172892 - elwing - Wed Mar 10, 2010 9:41 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sverx wrote:</b></span></td> </tr> <tr> <td class="quote">you can have tilemaps too in mode 5...</td> </tr></table><span class="postbody">
<br/>
<br/>
doh... my bad... =&gt; going back to the GBA dev section....</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
