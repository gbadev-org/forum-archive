<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>dsutils - My texture and mesh convertors - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > dsutils - My texture and mesh convertors</h2>
<div id="posts">
<div class="post">
    <h4>#42211 - bluescrn - Sat May 07, 2005 11:16 pm</h4>
    <div class="postbody"><span class="postbody">Wasn't sure whether to release these yet, as they might have given me a little advantage in the compo... but <a class="postlink" href="http://www.bluescrn.net/dsutils.zip" target="_blank">here they are</a> anyway (includes src). Not really sure if they're any better than others that are already out there, but it's another option....
<br/>
<br/>
They're both win32 command-line tools, run them with no params for usage info.
<br/>
<br/>
The texture convertor takes a bitmap (anything DevIL can load) and outputs raw 1:5:5:5 texture data. Pure magenta should be transparent (untested).
<br/>
<br/>
The mesh convertor takes a .x file as input, and outputs a DS display list. No hierarchy, animation, or materials support, but it supports UVs and either normals or vertex colours (looks like you can't use both?) - it takes a single mesh (which is assumed to have the same texture all over it), and outputs a raw display list that can be called with glCallList().
<br/>
<br/>
It only uses triangles, no quads yet - that might be quite a big optimization for the future. I've got no plans to add animation support, but might wrap the display lists up in a node hierarchy, and may consider multiple materials support.
<br/>
<br/>
Simplest way to test a model is in the ndslib textured_cube sample. Just add glCallList((uint32*)my_mesh); at the point where it draws the cube. (You still need lights, material, and glPolyFmt() set up before calling the list).</span><span class="gensmall"><br/><br/>Last edited by bluescrn on Sat May 07, 2005 11:23 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#42212 - bluescrn - Sat May 07, 2005 11:19 pm</h4>
    <div class="postbody"><span class="postbody">..and as iDeaS doesn't support display lists yet, this code will render the output from ModelConv in an emu-friendly way. (Yep, it's really that simple!) Swap GFX_NORMAL for GFX_COLOR if you're using models with vertex colours.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void glCallListEmu(u32 *pList)
<br/>
{
<br/>
   int nNumVerts=(*pList - 4)/5;
<br/>
   pList+=3;
<br/>
<br/>
   GFX_BEGIN = GL_TRIANGLE;
<br/>
   for(int n=0;n&lt;nNumVerts;n++)
<br/>
   {
<br/>
       pList++;                   
<br/>
       GFX_TEX_COORD = *pList++;
<br/>
       GFX_NORMAL    = *pList++;
<br/>
       GFX_VERTEX16  = *pList++;
<br/>
       GFX_VERTEX16  = *pList++;       
<br/>
   }
<br/>
   GFX_END = 0;
<br/>
} 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
(edit: This will only work for ModelConv output, not arbitrary display lists!)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62821 - psimon - Tue Dec 06, 2005 7:05 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">The mesh convertor takes a .x file as input, and outputs a DS display list. No hierarchy, animation, or materials support, but it supports UVs and either normals or vertex colours (looks like you can't use both?) - it takes a single mesh (which is assumed to have the same texture all over it), and outputs a raw display list that can be called with glCallList(). </td> </tr></table><span class="postbody">
<br/>
<br/>
When you say that the mesh converter takes a .x file and outputs a DS display list, what exactly do you mean by this? What is the form of a DS display list? I am familiar with object files that have vertices:
<br/>
v -3.593235 0.000000 -2.016101
<br/>
and polys/faces:
<br/>
f 55/2/17 56/4/18 58/12/19
<br/>
and normals:
<br/>
uv 1 0 0
<br/>
<br/>
and I can export x files from maya.... but I am a bit lost on the DS display list. 
<br/>
<br/>
Thanks for the workaround for iDeaS... do you know if they plan on adding it? I assume display lists work fine on hardware. Going to try tomorrow!!! getting my wireless usb key....
<br/>
<br/>
cheers
<br/>
Simon.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#64217 - LunarCrisis - Tue Dec 20, 2005 8:12 am</h4>
    <div class="postbody"><span class="postbody">A DS display list is simply the instructions for drawing the model pre-formatted specifically for the DS's hardware, so that they can all be done with one function call.<br/>_________________<br/>If a tree falls in the forest and no one is there to hear it, why the heck do you care?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#64358 - Xgame - Wed Dec 21, 2005 6:15 pm</h4>
    <div class="postbody"><span class="postbody">Hi, you' ve made a great job!
<br/>
i wont to put it in Yeti3d for use model; can you help me?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#129448 - bmnb1234 - Tue May 22, 2007 10:23 pm</h4>
    <div class="postbody"><span class="postbody">I not not how usefull this is but I have the source code for the GP32 version that suports 3d files.
<br/>
<br/>
<br/>
Yeti modified sources 
<br/>
<br/>
<a href="http://www.geocities.com/rtb7/files/gp32/adic2k4_src.zip" target="_blank">http://www.geocities.com/rtb7/files/gp32/adic2k4_src.zip</a>
<br/>
<br/>
using Mirko SDK and devkitarm_r17
<br/>
<br/>
The java tools (MD2 transformation and Texture set editor) 
<br/>
<br/>
Here is the java file the tool that you will need to convert it tool from md2 to the 3d file format that this of yeti3d 
<br/>
3D tool : <a href="http://www.geocities.com/rtb7/files/gp32/3d_tools.zip" target="_blank">http://www.geocities.com/rtb7/files/gp32/3d_tools.zip</a>
<br/>
to export MD2 to my yeti anim format.
<br/>
<br/>
<br/>
It also uses a 128 
<br/>
texture 
<br/>
so here is the tool
<br/>
Texture tool : <a href="http://www.geocities.com/rtb7/files/gp32/yeti_tex.zip" target="_blank">http://www.geocities.com/rtb7/files/gp32/yeti_tex.zip</a>
<br/>
(Java tool to generate compatible .RAW and .PAL files from jpg/gif/png images)
<br/>
<br/>
<br/>
Hope you can find something usefull here.
<br/>
Jason</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#129496 - a128 - Wed May 23, 2007 8:12 am</h4>
    <div class="postbody"><span class="postbody">Can't download the Dsutils.zip file</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#136919 - ChrisKnott - Mon Aug 06, 2007 2:46 pm</h4>
    <div class="postbody"><span class="postbody">I think bluescrn's site is down, does anyone know what happened there are a few things I want to get from there...?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142779 - Noda - Sat Oct 13, 2007 3:50 am</h4>
    <div class="postbody"><span class="postbody">bump! I'm greatly interested into the mesh converter, does anyone have a copy of dsutil.zip?
<br/>
<br/>
thanks!
<br/>
<br/>
EDIT: found it on birslip's site: <a href="http://birslip.pizz.biz/temp/dsutils.zip" target="_blank">http://birslip.pizz.biz/temp/dsutils.zip</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142784 - Peter - Sat Oct 13, 2007 8:44 am</h4>
    <div class="postbody"><span class="postbody">In ModelConv.cpp:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
if ((px&lt;-8 || py&lt;-8 || px&lt;-8) || (px&gt;8 || py&gt;8 || px&gt;8))
<br/>
{
<br/>
    printf("Warning: vertex %d of face %d is out of range! Scale down!\n",v,nFace);
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
You probably also want to test for pz rather than four times px.
<br/>
<br/>
BTW according to GBATek the vertex16 command has 16bits for one coordinate:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Bit 0-15   X-Coordinate (signed, with 12bit fractional part)
<br/>
Bit 16-31  Y-Coordinate (signed, with 12bit fractional part)
<br/>
</td> </tr></table><span class="postbody">
<br/>
I interpret this as 1bit for sign, 3bits decimal part and 12 bits fraction.
<br/>
<br/>
<span style="font-style: italic">floattov16</span> in libnds is defined as:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define floattov16(n)        ((v16)((n) * (1 &lt;&lt; 12)))
<br/>
</td> </tr></table><span class="postbody">
<br/>
When your coordinate is 8 units (which is valid in your if-equation above) the result is:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
32768 = floattov16(8) = 8*4096
<br/>
</td> </tr></table><span class="postbody">
<br/>
But 32768 is just the 15th bit set. That maps to the most sinificant bit in the vertex16 command for a coordinate, which means -0? 
<br/>
<br/>
In short, you should probably test "if(px &gt;= 8 ..." or multiply by 4095.9f instead:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
32767.2f = 8 * 4095.9f // to fixed point v16
<br/>
32767 = (int)32767.2f // remove fraction
<br/>
7.997 = 32767/4096.0 // fixed point value represets 7.997
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
The same applies to the normals, but there is already a workaround in libnds (videogl.h):
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define floattov10(n)        ((n&gt;.998) ? 0x1FF : ((v10)((n)*(1&lt;&lt;9))))
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/>Kind Regards,
<br/>
Peter</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142797 - Noda - Sat Oct 13, 2007 4:34 pm</h4>
    <div class="postbody"><span class="postbody">Ouch! It may be related to these errors, but the model I converted using this program (a simple sphere mesh) give me lots of "invalid gx command" on no$gba, and the model doesn't show on a real DS :/
<br/>
<br/>
Does anyone has a working &lt;whatever_mesh_format&gt; to nds display list format which converts normals and UVs? (the one from the author of AmplituDS works great but doesn't convert normals and UVs, and isn't very user-friendly as the conversion needs to be done on NDS...)
<br/>
<br/>
thanks</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142805 - Peter - Sat Oct 13, 2007 5:58 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Noda wrote:</b></span></td> </tr> <tr> <td class="quote">Does anyone has a working &lt;whatever_mesh_format&gt; to nds display list format which converts normals and UVs?</td> </tr></table><span class="postbody">
<br/>
Maybe this? <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=14142&amp;highlight=" target="_blank">DS/libnds: How to create display lists (.h or .bin)?</a><br/>_________________<br/>Kind Regards,
<br/>
Peter</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142821 - Noda - Sun Oct 14, 2007 1:19 am</h4>
    <div class="postbody"><span class="postbody">I already saw that, but unfortunately the Ogre3D <b style="color:#FFA34F">exporter</b> of milkshape3D doesnt't export the .xml, only the .mesh file, and the ogre2n3D converter adds a header to the display lists :/</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
