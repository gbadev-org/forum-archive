<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Loading textures - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Loading textures</h2>
<div id="posts">
<div class="post">
    <h4>#169541 - GugloPWN - Tue Jul 21, 2009 11:55 pm</h4>
    <div class="postbody"><span class="postbody">My goal is to modify Payk's md2 loader so that the model and texture data is local to an object. Basically I wasn't happy how with Payks loader you have a global array of models and textures.
<br/>
<br/>
I got the models seperated but textures are not working correctly.  I think I need a better understanding of the glCommands.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void LoadModelTexture(char filename[],int &amp;Target,int &amp;TargetPal,int* w) 
<br/>
{
<br/>
//stuff here decodes the file into a buffer
<br/>
   TargetPal = gluTexLoadPal( pal, 256, GL_RGB256 );
<br/>
   glBindTexture (0, Target);
<br/>
   if(width==64)glTexImage2D(0, 0, GL_RGB256, TEXTURE_SIZE_64, TEXTURE_SIZE_64, 0, TEXGEN_TEXCOORD|(3&lt;&lt;29),(uint8*)buffer8);
<br/>
   if(width==128)glTexImage2D(0, 0, GL_RGB256, TEXTURE_SIZE_128, TEXTURE_SIZE_128, 0, TEXGEN_TEXCOORD |    GL_TEXTURE_WRAP_S |       GL_TEXTURE_WRAP_T,buffer8);
<br/>
   free(buffer8);
<br/>
}</td> </tr></table><span class="postbody">
<br/>
I call the function like this
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   glGenTextures(1, &amp;Texture);
<br/>
   LoadModelTexture(textfile,Texture,TexturePal,&amp;textsize) ;</td> </tr></table><span class="postbody">
<br/>
I am calling glGenTextures then LoadModelTexture upwards of 6 times, but it doesnt work for even the first. How does the code know where in VRAM to put the textures? I'd guess that the first call puts the texture at the beginning of bank A, does each subsequent call just pile the textures on after?
<br/>
<br/>
I've enabled banks A B and C for textures, will they automatically be used? glTexImage2D doesnt ask where in the VRAM it should put the textures so I have no idea where stuff is being written.
<br/>
<br/>
If someone can give me a good explanation of all this that'd be awesome.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#169543 - TwentySeven - Wed Jul 22, 2009 2:21 am</h4>
    <div class="postbody"><span class="postbody">we need to see your glGenTexture calls.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#169544 - GugloPWN - Wed Jul 22, 2009 2:52 am</h4>
    <div class="postbody"><span class="postbody">my objects each have members:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int Texture;
<br/>
int TexturePal;
<br/>
int textsize;</td> </tr></table><span class="postbody">
<br/>
I loop through each object doing various non-GL things and calling 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">glGenTextures(1, &amp;Texture);
<br/>
   LoadModelTexture(textfile,Texture,TexturePal,&amp;textsize) ;</td> </tr></table><span class="postbody">
<br/>
I know its not something like the file isnt being found, because the textures are showing up, just wrapped around in strange ways. I know the UV coords of my models and the textures work because they looked fine before I altered the code, but I think the textures arent being loaded correctly, so I need to know more about VRAM.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#169545 - DiscoStew - Wed Jul 22, 2009 3:36 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">if(width==64)glTexImage2D(0, 0, GL_RGB256, TEXTURE_SIZE_64, TEXTURE_SIZE_64, 0, TEXGEN_TEXCOORD|(3&lt;&lt;29),(uint8*)buffer8); </td> </tr></table><span class="postbody">
<br/>
<br/>
Is there a reason why you have (3&lt;&lt;29) in your code? What that does if I'm correct is enables Color 0 transparency and sets TEXGEN_TEXCOORD, which you already have set.
<br/>
<br/>
Also, you have one setting to have texture wrapping, but not the other?<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#169555 - GugloPWN - Wed Jul 22, 2009 11:09 pm</h4>
    <div class="postbody"><span class="postbody">Stew, I have no idea what that line of code does, Im modifying Payk's md2 loader and getting problems. I understand some of the loader, all the code I've posted here is stuff that I don't understand.
<br/>
<br/>
From what I could gather TEXGEN_TEXCOORD just allows me to warp textures with a texture matrix if I was going for effects. My texture matrix is identity so that shouldnt do anything. I think my problem is that Im calling glGenTextures and glTexImage2D repeatedly in different places.
<br/>
<br/>
I want to be able to load up textures and models dynamically as I run around my game environment, rather than genning all the textures in one go at runtime like the loader originally did.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#169556 - TwentySeven - Thu Jul 23, 2009 12:04 am</h4>
    <div class="postbody"><span class="postbody">The DS doesnt use normalized texture coordinates. 
<br/>
<br/>
So, one issue is that the UVs for the model need to match the texture size.  Are you accounting for this?  
<br/>
<br/>
ie: UV built for 64x64 textures, you'll need to modify the texture matrix for it to map correctly to a 128x128</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#169558 - GugloPWN - Thu Jul 23, 2009 2:53 am</h4>
    <div class="postbody"><span class="postbody">I had models working correctly with textures and everything before trying to seperate out the texture variables from an array (int Textures[10]) to ten seperate (int Texture) in different objects. Im using a model that came with the example so I know it should work.
<br/>
<br/>
Is there any reason why I wouldnt be allowed to call glGenTextures more than once?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#169559 - DiscoStew - Thu Jul 23, 2009 3:20 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>GugloPWN wrote:</b></span></td> </tr> <tr> <td class="quote">I had models working correctly with textures and everything before trying to seperate out the texture variables from an array (int Textures[10]) to ten seperate (int Texture) in different objects. Im using a model that came with the example so I know it should work.
<br/>
<br/>
Is there any reason why I wouldnt be allowed to call glGenTextures more than once?</td> </tr></table><span class="postbody">
<br/>
<br/>
Was it working with your current setup, but with an array of ints instead of a single int per object? If not, then it's somewhere else in your code that you made modifications to.
<br/>
<br/>
glGenTextures works multiple times (up until it reaches it's MAX_TEXTURE limit of 2400), and is reset completely with the use of glResetTextures.<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
