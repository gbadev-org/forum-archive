<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Saving to slot-1 - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > Saving to slot-1</h2>
<div id="posts">
<div class="post">
    <h4>#121880 - FRuMMaGe - Thu Mar 15, 2007 1:07 pm</h4>
    <div class="postbody"><span class="postbody">I'm new to programming and i've made a basic paint program.  it would really help me if I could save my pictures, preffereably to slot-1 as I have an R4.
<br/>
<br/>
Is there a way to save the current VRAM bank in the form of a bitmap?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121894 - Diddl - Thu Mar 15, 2007 2:20 pm</h4>
    <div class="postbody"><span class="postbody">you can save as a normal game cartridge does. most cartridges produce a .sav file while saving.
<br/>
<br/>
better way is to use libfat. you can save your picture as a normal file on your TF card in your R4. simply use fopen() fwrite() fclose() like any other c-Program.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121895 - Quirky - Thu Mar 15, 2007 2:26 pm</h4>
    <div class="postbody"><span class="postbody">Also, there is a screenshot function available that stores the current main screen to a given VRAM bank.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
  vramSetBankB(VRAM_B_LCD);
<br/>
  const int mode   = 0;  // source A (main screen)
<br/>
  const int source = 0; // 1 for 3D
<br/>
  const int dst    = 1;           // A = 0, B = 1, C = 2, D = 3
<br/>
  DISP_CAPTURE =
<br/>
    DCAP_ENABLE      |  // Enable/Busy flag
<br/>
    DCAP_MODE(mode)  |  // Capture mode    (0=Source A, 1=Source B, 2/3=Sources A+B blended)
<br/>
    DCAP_DST(0)      |  // VRAM Write Offset (0=00000h, 0=08000h, 0=10000h, 0=18000h)
<br/>
    DCAP_SRC(source) |  // Source A          (0=Graphics Screen BG+3D+OBJ, 1=3D Screen
<br/>
    DCAP_SIZE(3)     |  // Capture Size      (0=128x128, 1=256x64, 2=256x128, 3=256x192 dots)
<br/>
    DCAP_OFFSET(0)   |  // VRAM Read Offset  (0=00000h, 0=08000h, 0=10000h, 0=18000h)
<br/>
    DCAP_BANK(dst)   |  // VRAM Write Block  (0..3 = VRAM A..D) (VRAM must be allocated to LCDC)
<br/>
    DCAP_A(16)       |  // Bland ignored if capture mode is 0 or 1
<br/>
    DCAP_B(0);
<br/>
  // this may block forever on broken emulators...
<br/>
  while (DISP_CAPTURE &amp; DCAP_ENABLE) {
<br/>
    swiWaitForVBlank();
<br/>
  }
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Now you can read from bank B.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
for (int i = 0; i &lt; 192*256;i++) 
<br/>
{
<br/>
   u16 pixel = VRAM_B[i];
<br/>
   // do stuff with pixel
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Might be useful if you use palettes or 3D or other hardware gfx features. The data is "photographed" in ARGB bitmap format in the chosen bank.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121931 - FRuMMaGe - Thu Mar 15, 2007 9:02 pm</h4>
    <div class="postbody"><span class="postbody">Do I need PAlib for this?  I'm currently using just libnds.h</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121932 - HyperHacker - Thu Mar 15, 2007 9:06 pm</h4>
    <div class="postbody"><span class="postbody">You don't need PAlib for anything. It's just an alternative.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122005 - FRuMMaGe - Fri Mar 16, 2007 11:18 am</h4>
    <div class="postbody"><span class="postbody">Thanks for the help!
<br/>
<br/>
One more question though, how can I use this to capture just a certain part of the screen?  I have a pallette taking up the first 28 pixels of the screen.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122901 - FRuMMaGe - Fri Mar 23, 2007 11:47 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>FRuMMaGe wrote:</b></span></td> </tr> <tr> <td class="quote">Thanks for the help!
<br/>
<br/>
One more question though, how can I use this to capture just a certain part of the screen?  I have a pallette taking up the first 28 pixels of the screen.</td> </tr></table><span class="postbody">
<br/>
<br/>
Hello?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122909 - OOPMan - Fri Mar 23, 2007 1:15 pm</h4>
    <div class="postbody"><span class="postbody">Erm, just capture and then discard the first 28 pixels before saving?<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122911 - FRuMMaGe - Fri Mar 23, 2007 1:40 pm</h4>
    <div class="postbody"><span class="postbody">I'm new at this.  Exactly how do I implement this code in the context of saving a picture?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123013 - Noda - Sat Mar 24, 2007 3:32 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Diddl wrote:</b></span></td> </tr> <tr> <td class="quote">you can save as a normal game cartridge does. most cartridges produce a .sav file while saving.
<br/>
.</td> </tr></table><span class="postbody">
<br/>
<br/>
any hints on how to do this? I'm very interested in doing this! thanks</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123014 - Sektor - Sat Mar 24, 2007 3:43 pm</h4>
    <div class="postbody"><span class="postbody">I wouldn't recommend saving to EEPROM since if someone has an original DS game in slot-1, it could erase their save.  Many slot-1 devices don't have a normal EEPROM either, so they would fail with homebrew.<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><a class="postlink" href="http://gtamp.com/DS" target="_blank">GTAMP.com/DS</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123023 - Diddl - Sat Mar 24, 2007 6:07 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Noda wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Diddl wrote:</b></span></td> </tr> <tr> <td class="quote">you can save as a normal game cartridge does. most cartridges produce a .sav file while saving.
<br/>
.</td> </tr></table><span class="postbody">
<br/>
<br/>
any hints on how to do this? I'm very interested in doing this! thanks</span></td> </tr></table><span class="postbody">
<br/>
<br/>
it's already solved in rein17a source code. you can find it simply. rein17 is an application which can copy save area of slot 1 card to a file and vice versa. it works with all kind of saves (EEPROM, Flash, all sizes).
<br/>
<br/>
Sektor is right, you only should do it if homebrew is started from slot 1. if homebrew is started from slot 2 and in slot 1 is any card it could overwrite anything.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123228 - FRuMMaGe - Mon Mar 26, 2007 9:10 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Diddl wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Noda wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Diddl wrote:</b></span></td> </tr> <tr> <td class="quote">you can save as a normal game cartridge does. most cartridges produce a .sav file while saving.
<br/>
.</td> </tr></table><span class="postbody">
<br/>
<br/>
any hints on how to do this? I'm very interested in doing this! thanks</span></td> </tr></table><span class="postbody">
<br/>
<br/>
it's already solved in rein17a source code. you can find it simply. rein17 is an application which can copy save area of slot 1 card to a file and vice versa. it works with all kind of saves (EEPROM, Flash, all sizes).
<br/>
<br/>
Sektor is right, you only should do it if homebrew is started from slot 1. if homebrew is started from slot 2 and in slot 1 is any card it could overwrite anything.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Is there a way to determine which slot the user is booting from, then save accordingly?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123238 - Diddl - Mon Mar 26, 2007 11:46 am</h4>
    <div class="postbody"><span class="postbody">you cannot determine from which slot program has booted, but you can use libfat to determine if a slot 2 is inserted and accessable. and you can use libfat to determine if a slot 1 is inserted and accessable. 
<br/>
<br/>
if slot 1 is accessable by libfat it is not a game cartridge ==&gt; use slot 1.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123246 - Noda - Mon Mar 26, 2007 2:24 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Sektor wrote:</b></span></td> </tr> <tr> <td class="quote">I wouldn't recommend saving to EEPROM since if someone has an original DS game in slot-1, it could erase their save.  Many slot-1 devices don't have a normal EEPROM either, so they would fail with homebrew.</td> </tr></table><span class="postbody">
<br/>
<br/>
but a lot of flashcard produce a .sav instead of saving to EEPROM, but you may be right this should be used only on slot1 cards. But if we want compatibility for this, is it possible to patch the homebrew like any regular game to redirect the EEPROM save to a .sav file for slot2 cards?
<br/>
<br/>
It could be nice to have a standard way for stroring game saves.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
