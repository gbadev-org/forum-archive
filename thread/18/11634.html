<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Single texture multiple times on a polygon - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Single texture multiple times on a polygon</h2>
<div id="posts">
<div class="post">
    <h4>#108241 - Rajveer - Mon Nov 06, 2006 11:09 pm</h4>
    <div class="postbody"><span class="postbody">Hi guys. I have a small 16x16 polygon which I want to put onto a polygon multiple times, is this possible?
<br/>
<br/>
<a class="postlink" href="http://imageshack.us" target="_blank"></a><a href="http://img523.imageshack.us/img523/5493/texturezr7.jpg">[Images not permitted - Click here to view it]</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#108246 - DiscoStew - Tue Nov 07, 2006 12:37 am</h4>
    <div class="postbody"><span class="postbody">Yes, but to do this, you need to do 2 thing.
<br/>
<br/>
1) Set bits 16 and 17 of the  texture image parameters. Those will have the texture repeat in both directions.
<br/>
2) Coordinates. In order to make the texture repeat, you need to set the coordinates to be outside the range of 0.0 and 1.0. If you wanted your texture to repeat just twice in both directions, using 2.0 instead of 1.0 on the edges will do the trick. You can even change values of 0.0 to -2.0, and get the texture repeating 4 times in each direction. Remember, both values are 1bit sign + 11bit integer + 4bit fractional part.
<br/>
<br/>
I'm sure others will be a lot more explanation-friendly, as I am still getting the hang of this,<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#108254 - Payk - Tue Nov 07, 2006 1:16 am</h4>
    <div class="postbody"><span class="postbody">interesting...didnt knowed about that...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#108255 - Rajveer - Tue Nov 07, 2006 1:24 am</h4>
    <div class="postbody"><span class="postbody">Sweet, cheers DiscoStew. Its the GFX_TEX_FORMAT register. One noob question, how do you switch bits of a register?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#108259 - HyperHacker - Tue Nov 07, 2006 3:04 am</h4>
    <div class="postbody"><span class="postbody">Bit-manipulating operators such as AND (&amp; in C), OR (|), and XOR (^). Look them up, you might find other useful info.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#108267 - Rajveer - Tue Nov 07, 2006 5:59 am</h4>
    <div class="postbody"><span class="postbody">I'm reading up but finding it a bit complicated. I understand everything such as binary, hex, e.t.c, and understand alot of whats behind it. But I just dont know how to actually do it. If I wanted to switch GFX_TEX_FORMAT's 16th and 17th bit, I would switch those bits with
<br/>
<br/>
var |= GFX_TEX_FORMAT(16);
<br/>
var |= GFX_TEX_FORMAT(17);
<br/>
<br/>
But I dont understand why you need a variable var?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#108269 - sajiimori - Tue Nov 07, 2006 7:16 am</h4>
    <div class="postbody"><span class="postbody">Sometimes writing to an I/O register can be slow, so building up the value (in a temporary variable) and writing it once can be a good approach.
<br/>
<br/>
Other times, I/O registers are write-only, so you can't use bitwise operators on their current contents.
<br/>
<br/>
I don't know if either of these things apply in your situation, but the important thing is the final value that is written to the register.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#108270 - DiscoStew - Tue Nov 07, 2006 7:17 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Rajveer wrote:</b></span></td> </tr> <tr> <td class="quote">I'm reading up but finding it a bit complicated. I understand everything such as binary, hex, e.t.c, and understand alot of whats behind it. But I just dont know how to actually do it. If I wanted to switch GFX_TEX_FORMAT's 16th and 17th bit, I would switch those bits with
<br/>
<br/>
var |= GFX_TEX_FORMAT(16);
<br/>
var |= GFX_TEX_FORMAT(17);
<br/>
<br/>
But I dont understand why you need a variable var?</td> </tr></table><span class="postbody">
<br/>
<br/>
Well, I think you've got them mixed up.
<br/>
<br/>
Because you can't read from the GFX_TEX_FORMAT register, you have to hold information in a temporary variable if you wish to change it. After you've made all the changes, you can then set the information in that variable into the register.
<br/>
<br/>
For your particular example, let me show you how it would be done...
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
//If var is the temporary variable...
<br/>
var |= BIT16;
<br/>
var |= BIT17;
<br/>
<br/>
//When everything is ready to be set into the register...
<br/>
GFX_TEX_FORMAT = var;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
This is assuming constants for BIT0 - BIT31.
<br/>
However, you are doing an OR on the variable to set bits. To be able to unset the bits, do this (example BIT16)
<br/>
<br/>
var &amp;= ~BIT16;
<br/>
<br/>
This takes BIT16, and flips all bits on it with ~, and then ANDs it to var. Pretty much it keeps everything in var except for bit 16. This method isn't just for single bits, but can be used for multiple bits at once. For instance...
<br/>
<br/>
var &amp;= ~0x00000003;
<br/>
<br/>
...which is the same as doing...
<br/>
<br/>
var &amp;= ~(BIT0 | BIT1);
<br/>
<br/>
...Pretty much bits 0 and 1 are unset in var.
<br/>
<br/>
Perhaps I've gone a little bit indepth in this.<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#108277 - Rajveer - Tue Nov 07, 2006 11:38 am</h4>
    <div class="postbody"><span class="postbody">Cheers guys for the help, I think I got all of that :). One more thing, if I'm to store my data as a variable which I "feed" into a register, how would I know which variable type to choose? I'm guessing it should be unsigned firstly, and since the register I want in particular has a width of 32 bits, I'd choose an unsigned variable of size 32 too (but which type?)
<br/>
<br/>
P.S. Do all registers have a width of size power of two?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#108284 - tepples - Tue Nov 07, 2006 2:08 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Rajveer wrote:</b></span></td> </tr> <tr> <td class="quote">if I'm to store my data as a variable which I "feed" into a register, how would I know which variable type to choose?</td> </tr></table><span class="postbody">
<br/>
libgba and libnds define the types u8, u16, and u32.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">P.S. Do all registers have a width of size power of two?</td> </tr></table><span class="postbody">
<br/>
In 8-bit, 16-bit, 32-bit, and 64-bit systems, yes.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#108286 - Rajveer - Tue Nov 07, 2006 2:33 pm</h4>
    <div class="postbody"><span class="postbody">Can somebody tell me if I'm thinking about this correctly?
<br/>
<br/>
Ok GFX_TEX_FORMAT is a 32 bit register, so to be able to switch its bits I need to define a u32 which I'll call repeatTexSwitch. I want to switch two bits together so I need 2 bits together: first I'll say
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">u32 repeatTexSwitch= 3;</td> </tr></table><span class="postbody">
<br/>
so that I get two bits "switched on" in my variable together. Then I shift the variable left 16 places...or I could say
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">u32 repeatTexSwitch= 98304</td> </tr></table><span class="postbody">
<br/>
which will give me the bits I need in the right place anyways.
<br/>
<br/>
Then to switch the 16th and 17th bits of the register on, I need to use the OR operation with the register and the switch variable, like so:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">GFX_TEX_FORMAT = GFX_TEX_FORMAT | repeatTexSwitch&lt;&lt;16</td> </tr></table><span class="postbody"> (if I used repeatTexSwitch = 3)
<br/>
or
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">GFX_TEX_FORMAT = GFX_TEX_FORMAT | repeatTexSwitch</td> </tr></table><span class="postbody"> (if I used repeatTexSwitch = 98304)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#108295 - DiscoStew - Tue Nov 07, 2006 4:12 pm</h4>
    <div class="postbody"><span class="postbody">One thing you probably should learn not to do is not use what is called "magic numbers". What those are are values that mean something, yet have no type of description to go with them. They just magically work. I apologize that I used it a little in my last post, but only to get a point across. What you want to do to make sure what is going on with what you want, make your values #define, or if you are using something like libnds, use what they have provided. For the repeating texture, they have defines called GL_TEXTURE_WRAP_S (which is [1 &lt;&lt; 16]) and GL_TEXTURE_WRAP_T (which is [1 &lt;&lt; 17]). IMO, as far as setting bits in your temporary variable, set them as if that variable were the register itself. Your 2nd repeatTexSwitch is just about like that, except for the "magic number" part. Instead, do this using the defines I showed.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">u32 texFormat = GL_TEXTURE_WRAP_S | GL_TEXTURE_WRAP_T</td> </tr></table><span class="postbody">
<br/>
I changed the variable name to have it represent that it is the entire register, not just the bits you want it to set. Make sure that you set whatever else is needed in the variable for the register too, as this will be fed into it.
<br/>
<br/>
As was said before, that register can not be read from, so the code you provided won't work (at least on hardware)<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#108297 - Rajveer - Tue Nov 07, 2006 4:24 pm</h4>
    <div class="postbody"><span class="postbody">Cool, cheers for your time DiscoStew. So there are defines for all of the bits in all of the registers? And if not then programmers tend to make their own defines at the start of their code?
<br/>
<br/>
If I were to use the proper defines, from what you've told me and what I've learnt I would use
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">u32 texFormat = GL_TEXTURE_WRAP_S | GL_TEXTURE_WRAP_T;
<br/>
GFX_TEX_FORMAT = texFormat;</td> </tr></table><span class="postbody">
<br/>
<br/>
I'm sure I'm still doing it wrong since it's not working. I'm putting it before I call glBindTexture to test wrapping on a quad but no luck.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#108380 - HyperHacker - Wed Nov 08, 2006 10:15 am</h4>
    <div class="postbody"><span class="postbody">One thing you should note too is that any decent compiler will break down expressions to the simplest possible form before compiling them. So if for some silly reason you write
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define SOMETHING (2&lt;&lt;3)
<br/>
#define SOMETHING_ELSE (2&lt;&lt;4)
<br/>
<br/>
Variable = (SOMETHING | SOMETHING_ELSE) + (((5*4) / 20) - 1);</td> </tr></table><span class="postbody">
<br/>
the compiler will automatically break it down like so:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">Variable = (SOMETHING | SOMETHING_ELSE) + (((5*4) / 20) - 1);
<br/>
Variable = ((2&lt;&lt;3) | (2&lt;&lt;4)) + ((20 / 20) - 1);
<br/>
Variable = (16 | 32) + (1 - 1);
<br/>
Variable = 48 + (1 - 1);
<br/>
Variable = 48 + 0;
<br/>
Variable = 48;</td> </tr></table><span class="postbody">
<br/>
<br/>
What this means is you don't lose any speed by writing a big complicated expression with a bunch of constants (the first line) as opposed to a single number (the second), since the compiler will treat both the same way.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
