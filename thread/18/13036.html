<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>REG_KEYCNT for X, Y & touchscreen in ARM7 code? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > REG_KEYCNT for X, Y & touchscreen in ARM7 code?</h2>
<div id="posts">
<div class="post">
    <h4>#126193 - Phantaseur - Fri Apr 20, 2007 9:06 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   REG_IME=0;
<br/>
   IRQ_HANDLER=KeyPressed;
<br/>
   REG_IE = IRQ_KEYS;
<br/>
   REG_IF=~0;
<br/>
   REG_KEYCNT=0x7fff;
<br/>
   REG_IME=IME_ENABLE;</td> </tr></table><span class="postbody">
<br/>
What else need I set up in code for ARM7 to get an interrupt for X, Y and touchscreen?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#126195 - tepples - Fri Apr 20, 2007 9:47 pm</h4>
    <div class="postbody"><span class="postbody">Why do you need an interrupt for keypresses? Can't you just poll these at every vblank?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#126241 - Phantaseur - Sat Apr 21, 2007 8:59 am</h4>
    <div class="postbody"><span class="postbody">Vblank happens 60 times per second, if I once press any key I have ~100 detections. I need: one push - one detecion.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#126242 - qw3rty - Sat Apr 21, 2007 9:02 am</h4>
    <div class="postbody"><span class="postbody">keysDown() will do exactly what you want - it will only trigger once.
<br/>
(and will be true until you scanKeys() again)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#126254 - Phantaseur - Sat Apr 21, 2007 10:59 am</h4>
    <div class="postbody"><span class="postbody"><a href="http://nocash.emubase.de/gbatek.htm" target="_blank">http://nocash.emubase.de/gbatek.htm</a>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Interrupts are reportedly not supported for X,Y buttons.</td> </tr></table><span class="postbody">
<br/>
Aaaa... Is it true?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#126257 - LiraNuna - Sat Apr 21, 2007 11:18 am</h4>
    <div class="postbody"><span class="postbody">key IRQ is only for the buttons that are accessible from ARM9.<br/>_________________<br/>Private property.
<br/>
Violators will be shot, survivors will be shot again.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#126259 - Phantaseur - Sat Apr 21, 2007 11:25 am</h4>
    <div class="postbody"><span class="postbody">So, the only way to process X, Y &amp; touchscreen is to process it during vblank irq?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#126304 - HyperHacker - Sun Apr 22, 2007 2:26 am</h4>
    <div class="postbody"><span class="postbody">All game consoles I know of read the button status during VBlank, and use some simple logic to split the input into "buttons pressed this frame" and "buttons held for multiple frames" bitflags.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#126333 - LiraNuna - Sun Apr 22, 2007 11:43 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">All game consoles I know of read the button status during VBlank, and use some simple logic to split the input into "buttons pressed this frame" and "buttons held for multiple frames" bitflags.</td> </tr></table><span class="postbody">
<br/>
<br/>
Like libnds' key*() functions, which also gives you the same info for X and Y buttons (inc. touch and lid aswell). Implementing a software IRQ wouldn't be a problem at all.<br/>_________________<br/>Private property.
<br/>
Violators will be shot, survivors will be shot again.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#126479 - Phantaseur - Mon Apr 23, 2007 5:21 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">main7.cpp:11: error: 'scanKeys' was not declared in this scope
<br/>
main7.cpp:12: error: 'keysDown' was not declared in this scope</td> </tr></table><span class="postbody">These functions weren't realised for ARM7? Is it possible to process keys in code for ARM7?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#126489 - tepples - Mon Apr 23, 2007 7:46 pm</h4>
    <div class="postbody"><span class="postbody">Did you forget to #include the header that declares these functions?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#126490 - Phantaseur - Mon Apr 23, 2007 7:50 pm</h4>
    <div class="postbody"><span class="postbody">I didn't forget include nds.h, it was enough for ARM9; something else needed by ARM7?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#126536 - HyperHacker - Tue Apr 24, 2007 4:43 am</h4>
    <div class="postbody"><span class="postbody">You need to include it for ARM7 too.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#126537 - Phantaseur - Tue Apr 24, 2007 5:01 am</h4>
    <div class="postbody"><span class="postbody">Yes, I know and I did it after creation of file. This string</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include&lt;nds.h&gt;</td> </tr></table><span class="postbody">is the first string of my file, but I get error trying compile it with next options:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">arm-eabi-g++ -mcpu=arm7tdmi -Wall -DARM7 -I/e/devkitPro/libnds/include/ -c main7.cpp</td> </tr></table><span class="postbody">I said I didn't forget include it, I thought maybe something <span style="font-weight: bold">else</span> neded?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#126546 - strager - Tue Apr 24, 2007 11:00 am</h4>
    <div class="postbody"><span class="postbody">Those two functions are not in -lnds7.  You'd either have to not use them, or copy their source from the -lnds9 to your own module on the ARM7.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#126585 - Phantaseur - Tue Apr 24, 2007 9:04 pm</h4>
    <div class="postbody"><span class="postbody">OK, I'll try copy source from libnds9 to my ARM7 code, but where can I find it? I just tried search 'libnds' on sourceforge and found there libnds for freePascal and palib.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">You'd either have to not use them...</td> </tr></table><span class="postbody">Is there any alternative solution?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#126660 - Phantaseur - Wed Apr 25, 2007 7:04 pm</h4>
    <div class="postbody"><span class="postbody">Yeah! I did it. It was simple, I needed correct just one string and write</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define KEYS_CUR (( ( ((~REG_KEYXY)&amp;0x07) | (~REG_KEYINPUT)&amp;0x3ff) | (((~IPC-&gt;buttons)&amp;3)&lt;&lt;10) | (((~IPC-&gt;buttons)&lt;&lt;6) &amp; (KEY_TOUCH|KEY_LID) ))^KEY_LID)</td> </tr></table><span class="postbody"> instead of </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define KEYS_CUR (( ((~REG_KEYINPUT)&amp;0x3ff) | (((~IPC-&gt;buttons)&amp;3)&lt;&lt;10) | (((~IPC-&gt;buttons)&lt;&lt;6) &amp; (KEY_TOUCH|KEY_LID) ))^KEY_LID)</td> </tr></table><span class="postbody">I think may be I can delete these (((~IPC-&gt;buttons...?
<br/>
<span style="font-size: 9px; line-height: normal">added later:</span>
<br/>
Yes, now it looks next</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define KEYS_CUR ( ((~REG_KEYXY)&amp;0x43) | (~REG_KEYINPUT)&amp;0x3ff)</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
