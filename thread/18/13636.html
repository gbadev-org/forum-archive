<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Help Please, 2 rootation screens ? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > Help Please, 2 rootation screens ?</h2>
<div id="posts">
<div class="post">
    <h4>#134177 - jonnyhilly - Wed Jul 11, 2007 9:53 am</h4>
    <div class="postbody"><span class="postbody">Hi, Just trying to write my first DS homebrew project.
<br/>
I'm trying to get 2 rotation screens showing up, but to no avail.
<br/>
The top/map sceen shows up fine, and I can alter pixels, but the bottom screen, is always blank. 
<br/>
Here is the setup demo code, what am I doing wrong please ?
<br/>
help appreciated, thanks
<br/>
<br/>
<br/>
	// Turn on everything
<br/>
	powerON(POWER_ALL);
<br/>
<br/>
<br/>
	//MODE_5_2D is extended rotation mode.. can be used like framebuffer, with direct write to pixels
<br/>
	videoSetMode(MODE_5_2D | DISPLAY_BG2_ACTIVE );
<br/>
	videoSetModeSub(MODE_5_2D | DISPLAY_BG3_ACTIVE);
<br/>
<br/>
	vramSetMainBanks(VRAM_A_MAIN_BG_0x6000000,VRAM_B_MAIN_BG_0x6020000,			VRAM_C_SUB_BG_0x6200000,VRAM_D_LCD); 
<br/>
<br/>
<br/>
	// set up  bitmap backgrounds  8 bit,paletted
<br/>
	BG2_CR = BG_BMP8_256x256;
<br/>
	BG3_CR = BG_BMP8_256x256;
<br/>
<br/>
	// set the rotation attributes:
<br/>
		BG2_XDX = 1 &lt;&lt; 8;
<br/>
		BG2_XDY = 0;
<br/>
		BG2_YDX = 0;
<br/>
		BG2_YDY = 1 &lt;&lt; 8;
<br/>
		BG2_CX = 0;
<br/>
		BG2_CY = 0 ;
<br/>
<br/>
		BG3_XDX = 1 &lt;&lt; 8;
<br/>
		BG3_XDY = 0;
<br/>
		BG3_YDX = 0;
<br/>
		BG3_YDY = 1 &lt;&lt; 8;
<br/>
		BG3_CX = 0;
<br/>
		BG3_CY = 0;
<br/>
<br/>
	//make up 2 random palettes, one for each screen
<br/>
	int i;
<br/>
	for(i=0;i&lt;256; i++)
<br/>
	{
<br/>
		BG_PALETTE_SUB[i]=rand()&amp;0xFFFF;
<br/>
		BG_PALETTE[i]=rand()&amp;0xFFFF;		
<br/>
	}
<br/>
<br/>
	for(i=0;i&lt;256; i++)
<br/>
	{
<br/>
		//draw some Junk on top screen (THIS WORKS)
<br/>
		BG_GFX[i+25*256]=rand()&amp;0xFF;			
<br/>
		//draw some Junk on Bot screen (THIS DOESN'T)
<br/>
		BG_GFX_SUB[i+60*256]=rand()&amp;0xFF;				
<br/>
	}</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#134190 - tepples - Wed Jul 11, 2007 12:49 pm</h4>
    <div class="postbody"><span class="postbody">Based on my reading of nds/arm9/video.h, you can start to fix the bottom screen by changing the BG3_whatever to SUB_BG3_whatever when you set up bitmap backgrounds and rotation attributes.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#134205 - jonnyhilly - Wed Jul 11, 2007 4:35 pm</h4>
    <div class="postbody"><span class="postbody">thanks, that did the trick :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#134218 - knight0fdragon - Wed Jul 11, 2007 6:39 pm</h4>
    <div class="postbody"><span class="postbody">just to let you know jonnyhilly, each screen has its own set of 4 backgrounds<br/>_________________<br/><a href="http://www.myspace.com/knight0fdragonds" target="_blank">http://www.myspace.com/knight0fdragonds</a>
<br/>
<br/>
MK DS FC: Dragon 330772 075464 
<br/>
AC WW FC: Anthony SamsClub 1933-3433-9458 
<br/>
MPFH: Dragon 0215 4231 1206</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#134227 - jonnyhilly - Wed Jul 11, 2007 7:38 pm</h4>
    <div class="postbody"><span class="postbody">Thanks, yes I found out about the multiple screens on the DS wiki
<br/>
Though I can't find a good description of all the registers and defines though. and a clear guide on setting up screens.
<br/>
<br/>
I'm trying to do text with various sized fonts including asian characters, onto both screen, so I figured the rotation backgrounds were the best way to go.  
<br/>
<br/>
Next... is doing some research on the memory and file system, and figuring how much space the code has to fit into for home brew...
<br/>
<br/>
Interested to know, with the file system... does the data stay on the rom cart, but the exe portion gets loaded into ram ? or does it all get loaded into ram ?
<br/>
and whats the speed difference between drawing graphics from ram and from the rom....
<br/>
saw something about only 64k for home brew exe ?
<br/>
<br/>
anyways.... thanks for the help.. :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#134238 - tepples - Wed Jul 11, 2007 9:41 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>jonnyhilly wrote:</b></span></td> </tr> <tr> <td class="quote">I'm trying to do text with various sized fonts including asian characters, onto both screen, so I figured the rotation backgrounds were the best way to go.</td> </tr></table><span class="postbody">
<br/>
By "asian characters" do you mean kana and hangul, or do you mean CJK ideograms? Are you going to need UTF-8 handling code?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Next... is doing some research on the memory and file system, and figuring how much space the code has to fit into for home brew...</td> </tr></table><span class="postbody">
<br/>
Homebrew needs to fit into 4 MB unless it reads the file system. There isn't a generalized way to make code overlays, apart from the plug-in systems used by DSOrganize and MoonShell.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Interested to know, with the file system... does the data stay on the rom cart, but the exe portion gets loaded into ram ?</td> </tr></table><span class="postbody">
<br/>
Yes, just like on a PC.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">and whats the speed difference between drawing graphics from ram and from the rom....</td> </tr></table><span class="postbody">
<br/>
Everything needs to be loaded into RAM first, like on a PC.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">saw something about only 64k for home brew exe ?</td> </tr></table><span class="postbody">
<br/>
There is no 64 KB limit. There is a 64 KB limit for GBA SRAM, which translates to a 64 KB limit for writable files in FCSR (FAT on traditional GBA flash cards), but most memory card adapters (SuperCard, M3, R4, etc.) let you use a gigabyte or more of files.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#134337 - jonnyhilly - Thu Jul 12, 2007 4:40 pm</h4>
    <div class="postbody"><span class="postbody">tepples, thanks for all that cool info.
<br/>
Yes, I want to draw, english, kana, and kanji characters.  utf-8 encoding.
<br/>
bitmap font. (CKJ ideograms)
<br/>
<br/>
I have the file system working already, so more than 4mb should be OK, but the main problem will be kanji database as it is bigger than 4mb, so I'd have to load it in parts at a time. Can the file system do partial file loads ? 
<br/>
e.g. specify file to load, +start offset, +length to load and destination addr to copy to.
<br/>
I guess that wouldn't be a problem
<br/>
<br/>
thanks again</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#134430 - tepples - Fri Jul 13, 2007 2:33 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>jonnyhilly wrote:</b></span></td> </tr> <tr> <td class="quote">I have the file system working already, so more than 4mb should be OK, but the main problem will be kanji database as it is bigger than 4mb, so I'd have to load it in parts at a time. Can the file system do partial file loads ? e.g. specify file to load, +start offset, +length to load and destination addr to copy to.</td> </tr></table><span class="postbody">
<br/>
No problem: fopen(), fseek(), fread(), fseek(), fread(), fseek(), fread(), fclose().<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#134433 - jonnyhilly - Fri Jul 13, 2007 2:51 am</h4>
    <div class="postbody"><span class="postbody">sweet!
<br/>
np then
<br/>
thanks</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#134635 - jonnyhilly - Sun Jul 15, 2007 2:00 am</h4>
    <div class="postbody"><span class="postbody">OK, I got alot of stuff working now....
<br/>
2 rotation screens setup in mode MODE_5_2D
<br/>
some sprite rendering routines sorted out, with some transparency and palette FX. 
<br/>
Overlaid text screen for some debug printf's
<br/>
<br/>
But there is one strange thing....
<br/>
the vram for the main text screen and the Extended background seem to use up the same space ? and corrupt each other.
<br/>
<br/>
What should I do about this ?  move the text screen some place else ?
<br/>
(not sure how to do this)
<br/>
or scroll the background up to hide the corruption (seems cheap)
<br/>
<br/>
help appreciated, thanks
<br/>
<br/>
	videoSetMode(MODE_5_2D | DISPLAY_BG2_ACTIVE | DISPLAY_BG1_ACTIVE);
<br/>
	videoSetModeSub(MODE_5_2D | DISPLAY_BG3_ACTIVE);
<br/>
<br/>
	vramSetMainBanks(VRAM_A_MAIN_BG_0x6000000,VRAM_B_MAIN_BG_0x6020000,
<br/>
			VRAM_C_SUB_BG_0x6200000,VRAM_D_LCD); 
<br/>
<br/>
	// set up  bitmap backgrounds  8 bit paletted	
<br/>
	BG2_CR = BG_BMP8_256x256;
<br/>
	SUB_BG3_CR = BG_BMP8_256x256;
<br/>
<br/>
	//setup the text background
<br/>
	BG1_CR = BG_MAP_BASE(31);	//???	what does this do ?
<br/>
<br/>
	//clear the 2 rotation screens
<br/>
	memset(topScreen,0,256*256);
<br/>
	memset(botScreen,0,256*256);	
<br/>
<br/>
	//consoleInitDefault((u16*)SCREEN_BASE_BLOCK_SUB(31), (u16*)CHAR_BASE_BLOCK_SUB(0), 16);
<br/>
	consoleInitDefault((u16*)SCREEN_BASE_BLOCK(31), (u16*)CHAR_BASE_BLOCK(0), 16);
<br/>
	iprintf("Test Text!...\n");
<br/>
	iprintf("Debug Print Info...\n");</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135005 - jonnyhilly - Thu Jul 19, 2007 9:53 am</h4>
    <div class="postbody"><span class="postbody">ok sorted this out by just moving the BG screen down a bit 32 pixels.
<br/>
The text screen seems to fit into the 32 pixels VRAM at the top nicely.
<br/>
<br/>
I just add the offset to my Sprite Blit routine so its all transparent.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
