<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Exceeding 128 Sprite Limit - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Exceeding 128 Sprite Limit</h2>
<div id="posts">
<div class="post">
    <h4>#168512 - manycowsmoo - Sat May 02, 2009 3:29 am</h4>
    <div class="postbody"><span class="postbody">I'm working on developing a port of Cultris (free multiplayer tetris) for the DS. I've looked at Patater's guide as a basis and that worked out great. The problem is, it says there's a sprite limit of 128. However, Cultris has 10 columns and 18 rows for a max of 180 pieces/sprites.
<br/>
<br/>
I've done some research and it looks like my options are use write to the OAM between frames or use the 3D mode and set up my sprites through that. But, I'm not sure how to do either of these. Could someone explain it to me or send me a tutorial/example?
<br/>
<br/>
Thanks for the help! :D</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168514 - Dwedit - Sat May 02, 2009 3:32 am</h4>
    <div class="postbody"><span class="postbody">Simple answer: Don't use sprites.
<br/>
Unless you need pieces which jiggle around or elaborately jump off when they're cleared, you can use background tiles for placed pieces.
<br/>
If you aren't using a piece size which is a multiple of 8, you can still use affine backgrounds to get sizes which aren't multiples of 8.
<br/>
<br/>
Edit: I just looked at the game.
<br/>
I see that the pieces jump down line by line after you clear lines below them.  This effect can still be done with background tiles by varying the scroll position line by line, but it's tricky, and easier to do with sprites.
<br/>
Your choices are either to use the 3D hardware to get more sprites, or use sprite multiplexing like on the GBA.
<br/>
<br/>
Piece shadows look tricky to do, since the DS only has full transparency in 3D mode.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168521 - headspin - Sat May 02, 2009 12:17 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dwedit wrote:</b></span></td> </tr> <tr> <td class="quote">Piece shadows look tricky to do, since the DS only has full transparency in 3D mode.</td> </tr></table><span class="postbody">
<br/>
<br/>
I wonder if he could use the BLEND_CR register with the BLEND_ALPHA bit set. He might be able to do it by using priorties so only the "shadow" sprites are blended.<br/>_________________<br/><a class="postlink" href="http://headsoft.com.au/index.php?category=warhawk" target="_blank">Warhawk DS</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=mmll" target="_blank">Manic Miner: The Lost Levels</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=tdg" target="_blank">The Detective Game</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168522 - AxemRed - Sat May 02, 2009 2:16 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dwedit wrote:</b></span></td> </tr> <tr> <td class="quote">Piece shadows look tricky to do, since the DS only has full transparency in 3D mode.</td> </tr></table><span class="postbody">
<br/>
You can get per-pixel alpha blending if you also draw the background layer(s) with the 3d hardware.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168523 - a128 - Sat May 02, 2009 3:06 pm</h4>
    <div class="postbody"><span class="postbody">Multiplexing sprites on DS
<br/>
<br/>
<a href="http://blea.ch/wiki/index.php/Thsprite" target="_blank">http://blea.ch/wiki/index.php/Thsprite</a><br/>_________________<br/>"Hey! It compiles! Ship it!"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168524 - hacker013 - Sat May 02, 2009 3:38 pm</h4>
    <div class="postbody"><span class="postbody">you could use ulibrary,  a 2d library which uses the 3d engine.<br/>_________________<br/><a class="postlink" href="http://imetal.nl/" target="_blank">Website / Blog</a>
<br/>
<br/>
Let the nds be with you.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168548 - manycowsmoo - Mon May 04, 2009 5:15 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for the quick replies! My current goal is to get a very basic GUI done and then get the game up and running. After that I can add in all the fancy effects.
<br/>
<br/>
So to do shadows, I would pretty much need use the 3D hardware?
<br/>
<br/>
Also, if I were to use the 3D hardware, does that have any disadvantages rather than using sprite multiplexing? The only thing I can think of is it would use more power thus less battery life and I could only use one screen at a time (not an issue).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168553 - Miked0801 - Mon May 04, 2009 9:43 pm</h4>
    <div class="postbody"><span class="postbody">If you can use the 3D hardware for sprites.  The system is MUCH more flexible than straight 2D and allows for better alpha and other effects that 2D just can't handle.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168560 - Echo49 - Tue May 05, 2009 10:39 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Miked0801 wrote:</b></span></td> </tr> <tr> <td class="quote">and allows for better alpha and other effects that 2D just can't handle.</td> </tr></table><span class="postbody">
<br/>
Do you have any information on the alpha? If I fade at different rates two separate quads that are overlapping, unless their z values are differing by about 0.003f or more they tend to fight for who appears on top (eg. flickering).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168562 - Miked0801 - Tue May 05, 2009 6:39 pm</h4>
    <div class="postbody"><span class="postbody">Per pixel alpha rocks.  A3I5 mode and A5I3 allow you to do some awesome blend effects.  That is in addition to full poly alpha.
<br/>
<br/>
On Z fighting, in a 2D scene, put it in Orthomode and don't move things around in  much.  That should take care of any roundoff flickering.
<br/>
<br/>
(P.S. - I'm using official devkit libs and such.  I am not at all familiar with homebrew libs in this area.)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
