<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Debug Output in No$Gba (nds files) - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Debug Output in No$Gba (nds files)</h2>
<div id="posts">
<div class="post">
    <h4>#150095 - RickA - Tue Jan 29, 2008 10:03 pm</h4>
    <div class="postbody"><span class="postbody">Is there any way to use the debug output functionality in No$Gba when developing homebrew DS programs?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#150103 - Dwedit - Wed Jan 30, 2008 12:21 am</h4>
    <div class="postbody"><span class="postbody">I know that some of the devkitpro sample programs emit output to NO$GBA.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#150129 - a128 - Wed Jan 30, 2008 9:40 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dwedit wrote:</b></span></td> </tr> <tr> <td class="quote">I know that some of the devkitpro sample programs emit output to NO$GBA.</td> </tr></table><span class="postbody">
<br/>
<br/>
Via iprintf to the  console which is on the subscreen by default on most examples</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#150207 - eKid - Thu Jan 31, 2008 7:07 am</h4>
    <div class="postbody"><span class="postbody">Here's my routine for no$ debug messages.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
@--------------------------------------------
<br/>
@ no$gba debug output function
<br/>
@--------------------------------------------
<br/>
 
<br/>
.global nocashMessage
<br/>
 
<br/>
.text
<br/>
.thumb
<br/>
.align
<br/>
 
<br/>
.thumb_func
<br/>
@--------------------------------------------
<br/>
nocashMessage:  @ params = { string }
<br/>
@--------------------------------------------
<br/>
 
<br/>
@ max string length == 120 bytes
<br/>
 
<br/>
@----------------------------
<br/>
@ copy string into buffer
<br/>
@----------------------------
<br/>
 
<br/>
        ldr     r1,=1f          @ get buffer address
<br/>
        mov     r2, #30         @ max length = 120
<br/>
3:      ldrb    r3, [r0,#0]     @ load character
<br/>
        strb    r3, [r1,#0]     @ store character
<br/>
        cmp     r3, #0          @ character == NULL?
<br/>
        beq     3f              @ yes, send message
<br/>
        ldrb    r3, [r0,#1]     @ load character
<br/>
        strb    r3, [r1,#1]     @ store character
<br/>
        cmp     r3, #0          @ character == NULL?
<br/>
        beq     3f              @ yes, send message
<br/>
        ldrb    r3, [r0,#2]     @ load character
<br/>
        strb    r3, [r1,#2]     @ store character
<br/>
        cmp     r3, #0          @ character == NULL?
<br/>
        beq     3f              @ yes, send message
<br/>
        ldrb    r3, [r0,#3]     @ load character
<br/>
        strb    r3, [r1,#3]     @ store character
<br/>
        cmp     r3, #0          @ character == NULL?
<br/>
        beq     3f              @ yes, send message
<br/>
        add     r0, #4          @ increment read position
<br/>
        add     r1, #4          @ increment write position
<br/>
        sub     r2, #1          @ decrement word counter
<br/>
        bne     3b              @ loop if &lt; 120 characters
<br/>
 
<br/>
@---------------------------
<br/>
@ send message to no$
<br/>
@---------------------------
<br/>
 
<br/>
3:      mov     r12,r12 @ first ID
<br/>
        b       2f      @ skip the text section
<br/>
        .hword  0x6464  @ second ID
<br/>
        .hword  0       @ flags
<br/>
1:
<br/>
        .space  120     @ data
<br/>
2:      bx      lr      @ exit
<br/>
 
<br/>
@--------------------------------------------
<br/>
.pool
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Just put that in a ".s" file and assemble it with the project. 
<br/>
Then from C you can do stuff like:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
extern void nocashMessage( char* );
<br/>
 
<br/>
//---------------------------------------------------------------------------------
<br/>
int main(void) {
<br/>
//---------------------------------------------------------------------------------
<br/>
    ...
<br/>
 
<br/>
    nocashMessage( "%zeroclks%" );
<br/>
    consoleInitDefault((u16*)SCREEN_BASE_BLOCK_SUB(31), (u16*)CHAR_BASE_BLOCK_SUB(0), 16);
<br/>
    nocashMessage( "%lastclks% cycles for console init" );
<br/>
 
<br/>
    ...
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I find the %zeroclks% %lastclks% parameters very useful for profiling. There's a few more parameters you can use too.
<br/>
<a href="http://nocash.emubase.de/gbahlp.htm#debugmessages" target="_blank">http://nocash.emubase.de/gbahlp.htm#debugmessages</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#150218 - RickA - Thu Jan 31, 2008 2:32 pm</h4>
    <div class="postbody"><span class="postbody">That works beautifully! Thanks a lot eKid.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#150238 - josath - Thu Jan 31, 2008 9:55 pm</h4>
    <div class="postbody"><span class="postbody">I just tried this, and it doesn't quite work for me. The no$gba window opens when I call it, but it just adds a bunch of blank lines.
<br/>
Example: <a href="http://h.davr.org/nodebug.png" target="_blank">http://h.davr.org/nodebug.png</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#150254 - eKid - Fri Feb 01, 2008 5:16 am</h4>
    <div class="postbody"><span class="postbody">It might not work with GBA projects because code is usually ran from the cartridge (read only). It will still work if it's a multiboot file though (everything is copied to RAM). The code is kind of self-modifying (it just copies the string content into itself), so it needs to be in a writable memory section. This isn't really a problem with DS since you have to copy all code into memory first.
<br/>
To fix for GBA you can change
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">.text</td> </tr></table><span class="postbody">
<br/>
to
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">.section ".iwram", "ax", %progbits</td> </tr></table><span class="postbody">
<br/>
This will put the code in the IWRAM (internal work ram) section so it can modify the string contents.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#150260 - josath - Fri Feb 01, 2008 7:33 am</h4>
    <div class="postbody"><span class="postbody">It was in a DS project that I had the problem...maybe it's my no$gba likes to spit out blank lines?
<br/>
<br/>
Could you provide a precompiled .nds which has some no$gba debug messages which I can test? thanks</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#150261 - eKid - Fri Feb 01, 2008 8:13 am</h4>
    <div class="postbody"><span class="postbody">Here, <a href="http://ekid.nintendev.com/nocashprint.nds" target="_blank">http://ekid.nintendev.com/nocashprint.nds</a>
<br/>
It prints a message from both CPUs.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#150274 - a128 - Fri Feb 01, 2008 12:30 pm</h4>
    <div class="postbody"><span class="postbody">Your are talking about the No$GBA debug version of this great emulator?!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#150275 - RickA - Fri Feb 01, 2008 12:40 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>a128 wrote:</b></span></td> </tr> <tr> <td class="quote">Your are talking about the No$GBA debug version of this great emulator?!</td> </tr></table><span class="postbody">
<br/>
<br/>
I was. So not the free version, but the cheap homebrew version with assemblylevel debugging.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#150284 - nipil - Fri Feb 01, 2008 3:11 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>RickA wrote:</b></span></td> </tr> <tr> <td class="quote">I was. So not the free version, but the cheap homebrew version with assemblylevel debugging.</td> </tr></table><span class="postbody">
<br/>
I ordered the same version on 25/01 via paypal, emailed the author about it too, and haven't received any feedback yet, just the paypal validation email. I'm quite impatient to get my hands on it, and i wonder what's happening... In the meantime, i'm learning to wait ;)
<br/>
<br/>
<span style="font-style: italic">Edit: right after posting this, i took a look at my paypal account, and just saw that the money was removed from my bank account on 29/01. it should arrive soon !</span><br/>_________________<br/>NDS Lite Gold/Silver, MK5/R4DS, MSI PC54G2, D-Link DI-624</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#150483 - nipil - Tue Feb 05, 2008 4:30 pm</h4>
    <div class="postbody"><span class="postbody">Out of topic, but i anwser my previous post.
<br/>
Martin replied me today about the home-debugger version.
<br/>
I'll test it asap when i'm back home. Happy happy happy !
<br/>
Now i "just" have to learn how to use the beast =)<br/>_________________<br/>NDS Lite Gold/Silver, MK5/R4DS, MSI PC54G2, D-Link DI-624</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
