<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>How do i make sure what i develop works on different carts? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > How do i make sure what i develop works on different carts?</h2>
<div id="posts">
<div class="post">
    <h4>#151309 - sowee - Sat Feb 23, 2008 6:35 am</h4>
    <div class="postbody"><span class="postbody">Hello, a program i'm testing currently works on Acekard RPG, M3DS Real, and even slot-2 Supercards. What i don't understand is why it doesn't seem to work on an M3DS Simply, and i'm assuming it also won't work on an R4. I tried dldi patching the binary, because i used libfat fopen and fread methods, but it still hangs up.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151322 - Jesse - Sat Feb 23, 2008 11:20 am</h4>
    <div class="postbody"><span class="postbody">One tip is to make sure you program is _not_ patched when trying to run them on M3S/R4. Some auto-patching cards have trouble with programs prepatched for other cards.
<br/>
<br/>
Also, it's been pointed out that M3S/R4 loaders doesn't clear the memory before launching apps, so make sure you are not using any uninitialized variables.<br/>_________________<br/><a href="http://www.collectingsmiles.com/colors" target="_blank">http://www.collectingsmiles.com/colors</a> &amp; <a href="http://www.collectingsmiles.com/hyena" target="_blank">http://www.collectingsmiles.com/hyena</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151327 - Cydrak - Sat Feb 23, 2008 1:52 pm</h4>
    <div class="postbody"><span class="postbody">It's not just RAM... watch out for hardware state. x_@
<br/>
<br/>
I make rather heavy use of the IPC. It worked great on my SCLite, but on my friend's M3CF, the message queue had a coronary! Some investigation turned up the apparent cause: data sitting in the FIFO, which I didn't put there. :|
<br/>
<br/>
How about an older one: I usually test over wifi. After moving some graphics around, I noticed a garbage layer that wouldn't go away. Quite odd, since I had most blending and BGs disabled. Turned out my downloader didn't clear the VRAM settings--nor did I, so the code blissfully put C right over bank H.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151347 - simonjhall - Sat Feb 23, 2008 11:12 pm</h4>
    <div class="postbody"><span class="postbody">I've noticed that flash cards seems to initialise the system differently. I've found that on some M3 simplys/R4s (could be firmware version thing) that the FIFO doesn't get set up the same as other cards.
<br/>
<br/>
Sticking</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">REG_IPC_FIFO_CR = IPC_FIFO_ENABLE | IPC_FIFO_SEND_CLEAR;</td> </tr></table><span class="postbody">at the top of my ARM7 main sorted my baby out.
<br/>
But yeah there are lots of tiny differences between the flash cards which are super annoying. Luckily now most of these problems have gone away. There are lots of differences between the RAM interface of the slot-2 cards, though.<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151348 - Cydrak - Sat Feb 23, 2008 11:33 pm</h4>
    <div class="postbody"><span class="postbody">Maybe there's something else I missed... but I had the SEND_CLEAR and it didn't seem to be enough for me. Hard to tell--I don't have access to the card in question. Word-of-mouth debugging. :-)
<br/>
<br/>
The solution I ended up with, has me clearing both the send and receive (by SEND_CLEAR, then a FIFO_RX loop), with some syncs to avoid races.
<br/>
<span style="font-size: 9px; line-height: normal">(For maximal hilarity, the RX before TX then gave me problems (endless incoming zeroes) on NO$GBA. So now I kick a single TX through beforehand. Only time and testing will tell if that holds up!)</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151353 - sowee - Sun Feb 24, 2008 2:11 am</h4>
    <div class="postbody"><span class="postbody">Thanks for the tips :D, my program also uses the IPC, although i already have REG_IPC_FIFO_CR = IPC_FIFO_ENABLE | IPC_FIFO_SEND_CLEAR | IPC_FIFO_RECV_IRQ as part of the arm7 main, still checking for what the cause might be, i hope its just some variable i forgot to initialize hehe</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151364 - silent_code - Sun Feb 24, 2008 4:22 pm</h4>
    <div class="postbody"><span class="postbody">it would be nice to have a function like "clear Hardware(void)" that sets the nds in a known and documented state. is there anything like this in libnds (obviously not, ain't it)?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151373 - tepples - Sun Feb 24, 2008 8:37 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>silent_code wrote:</b></span></td> </tr> <tr> <td class="quote">it would be nice to have a function like "clear Hardware(void)" that sets the nds in a known and documented state.</td> </tr></table><span class="postbody">
<br/>
The GBA BIOS had RegisterRamReset(). I can guess that the only reason this was taken out of the DS ARM7 BIOS and DS ARM9 BIOS was to make life more difficult for homebrewers.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151377 - HyperHacker - Sun Feb 24, 2008 9:26 pm</h4>
    <div class="postbody"><span class="postbody">Or because they decided it wouldn't be necessary and the space would be better used for other functions.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151482 - silent_code - Wed Feb 27, 2008 6:26 pm</h4>
    <div class="postbody"><span class="postbody">&lt;OFFTOPIC&gt;or they were like: "oh, how can we make it print even *MORE* money?"&lt;/OT&gt; &lt;goofy/&gt;
<br/>
<br/>
well, there sould be something like that in libnds. at least i've made a note on my todo list for my basecode. i'll post it, once i gather enough info about *everything* hw reset related (that should take a while and hopefully someone else will have done that already by the time i get along to it! ;^p )</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151487 - Cydrak - Wed Feb 27, 2008 7:38 pm</h4>
    <div class="postbody"><span class="postbody">I noticed an attempt in CVS:
<br/>
<a class="postlink" href="http://devkitpro.cvs.sourceforge.net/devkitpro/libnds/source/arm9/initSystem.c?revision=1.5&amp;view=markup" target="_blank">initSystem.c (r1.5)</a>
<br/>
<br/>
I think it's called from the crt0... of course, there is more to clear, but those are the basic things. There's stuff like irqInit() and glInit(), too. And sound doesn't need much help. In my case I have modules handling things on a higher level anyway (sound, power, rtc, fifo, efs, sram, etc). But those go beyond libnds, so it could be seen as an question of time and scope...
<br/>
<br/>
The BIOSes seem to have at least half a KB free. However, putting the init in firmware (and/or libs) was probably more flexible. Haven't we seen this with wifi and power chipsets already?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151493 - Noda - Wed Feb 27, 2008 9:43 pm</h4>
    <div class="postbody"><span class="postbody">Does anyone is aware of some special problems with G6/M3 real cards? because a lot of users are complaining that my homebrew stick on the fat init function on these cards :/ (no dldi patch is applied by default to the binary)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
