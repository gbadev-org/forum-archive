<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>multiple backgrounds - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > multiple backgrounds</h2>
<div id="posts">
<div class="post">
    <h4>#58931 - ventilo - Thu Oct 27, 2005 11:48 am</h4>
    <div class="postbody"><span class="postbody">Hi everybody,
<br/>
<br/>
Sorry, I'm a noob so it is probably a dumb question, but.... I cannot see the way for multiple backgrounds.... using mode 5, I set the following:
<br/>
<br/>
videoSetMode(MODE_5_2D | DISPLAY_SPR_1D_LAYOUT | DISPLAY_SPR_ACTIVE | DISPLAY_BG2_ACTIVE | DISPLAY_BG3_ACTIVE);
<br/>
vramSetBankA(VRAM_A_MAIN_BG_0x6000000);
<br/>
vramSetBankB(VRAM_B_MAIN_BG_0x6020000);
<br/>
vramSetBankC(VRAM_C_SUB_BG);
<br/>
vramSetBankD(VRAM_D_LCD);
<br/>
vramSetBankE(VRAM_E_MAIN_SPRITE);
<br/>
BG2_CR = BG_BMP16_256x256 | BG_BMP_BASE(0) | BG_PRIORITY(1);
<br/>
BG3_CR = BG_BMP16_256x256 | BG_BMP_BASE(16 /* times 16k */) | BG_PRIORITY(2);
<br/>
<br/>
then if I write bitmaps to BG_GFX or to BG_BMP_RAM(0) I see them, however if I write bitmaps to BG_BMP_RAM(16) I do not see anything
<br/>
<br/>
Please can you explain how to write to either background ? How to display both ? which is rendered "on top" of the other ? does it depend on bg priority ?
<br/>
<br/>
Ventilo<br/>_________________<br/>Firstname's Y.A.N.N..... yet another NDS noob :o)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#58935 - strager - Thu Oct 27, 2005 12:29 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ventilo wrote:</b></span></td> </tr> <tr> <td class="quote">then if I write bitmaps to BG_GFX or to BG_BMP_RAM(0) I see them, however if I write bitmaps to BG_BMP_RAM(16) I do not see anything
<br/>
<br/>
Please can you explain how to write to either background ? How to display both ? which is rendered "on top" of the other ? does it depend on bg priority ?
<br/>
<br/>
Ventilo</td> </tr></table><span class="postbody">
<br/>
<br/>
"I do not see anything"
<br/>
Do you mean that the upper layer is not displayed?  Or the bottom layer is not shown at all?
<br/>
<br/>
"does it depend on bg priority"
<br/>
Yes, it does.  Backgrounds with a higher priority are rendered first, thus are shown "behind" everything with a lower priority.
<br/>
<br/>
Make sure you are not setting the alpha bit for the top layer, so that the bottom layer is visible.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#58958 - ventilo - Thu Oct 27, 2005 4:48 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for the answer
<br/>
<br/>
I was assuming the other way for the priorities, however the problem remains.
<br/>
<br/>
I just write one bitmap, either at BG_BMP_RAM(0) or at BG_BMP_RAM(16), i.e. I wish to write to BG2 or to BG3. It works for the former but not for the latter ("I do not see anything"), hence I guess BG3 is not writable at BG_BMP_RAM(16) ?
<br/>
<br/>
Next thing will be to display both backgrounds at the same time :o)<br/>_________________<br/>Firstname's Y.A.N.N..... yet another NDS noob :o)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#58959 - dovoto - Thu Oct 27, 2005 4:55 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">BG3_CR = BG_BMP16_256x256 | BG_BMP_BASE(16 /* times 16k */) | BG_PRIORITY(2); 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
should it not be
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">BG3_CR = BG_BMP16_256x256 | BG_BMP_BASE(8 /* times 16k */) | BG_PRIORITY(2); 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
size of background bmp:
<br/>
256x256x2 = 128KB 
<br/>
<br/>
bmp base:
<br/>
8 x 16KB = 128 KB
<br/>
<br/>
you have:
<br/>
16x16KB = 256KB (which is above vram bank B the way you have it mapped currently)
<br/>
<br/>
It is early and it is never good to do the math in my head so maybe i am just misstaken...<br/>_________________<br/><a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#58961 - ventilo - Thu Oct 27, 2005 4:56 pm</h4>
    <div class="postbody"><span class="postbody">How right you are, many thanks
<br/>
<br/>
Ventilo<br/>_________________<br/>Firstname's Y.A.N.N..... yet another NDS noob :o)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#67993 - Zhen - Sat Jan 21, 2006 10:43 pm</h4>
    <div class="postbody"><span class="postbody">I have a similar problem, I need the mode 5 to combine a framebuffer with sprites and tile maps. But in order to get space for put in the tile data I reserve two vramBanks, the first one to tiles and the second one to put the framebuffer.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   videoSetMode( MODE_5_2D /*| DISPLAY_BG0_ACTIVE */| DISPLAY_BG2_ACTIVE );
<br/>
    vramSetBankA( VRAM_A_MAIN_BG_0x6000000 );
<br/>
    vramSetBankB( VRAM_B_MAIN_BG_0x6020000 );
<br/>
    //BG0_CR = BG_PRIORITY(0) | BG_MAP_BASE( 31 ) | BG_TILE_BASE( 0 ) | BG_256_COLOR | BG_32x32;
<br/>
    BG2_CR = BG_PRIORITY(0) | BG_BMP_BASE( 8 ) | BG_BMP16_256x256;
<br/>
<br/>
    m_bufferMain = (uint16*)BG_BMP_RAM( 8 );
<br/>
   
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
The problem is that when i use BG_BMP_BASE( 0 ) as framebuffer it is well . But when i use BG_BMP_BASE( 8 ) as framebuffer I see nothing.
<br/>
<br/>
It's really possible to combine in mode 5 sprites + tiles + framebuffer? whats is the correct layout and cofiguration of memory banks?
<br/>
I use dsemu-0.4.9 to test my code.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
