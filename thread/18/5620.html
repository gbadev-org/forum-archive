<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>rotate object in 3d? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > rotate object in 3d?</h2>
<div id="posts">
<div class="post">
    <h4>#41708 - chrissieboy - Sun May 01, 2005 12:42 pm</h4>
    <div class="postbody"><span class="postbody">Hi im busy with 3d on nds now.
<br/>
<br/>
But there is a function rotateX for the camera, but can't find in the lib the function to rotate objects. Does anyone know how i can do this?
<br/>
<br/>
Because i want to make a boat that moves, but i can only control it with the camera.
<br/>
<br/>
also i can move it with moving the verticies, so the boat can move left or right, or up and down. But i want the boat to turn with left and right, and accelerate with up.
<br/>
<br/>
thanx for your help !!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#41752 - Ethos - Sun May 01, 2005 5:37 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define LUT_SIZE (512)
<br/>
#define LUT_MASK (0x1FF)
<br/>
void glRotatef32 (f32 angle, f32 x, f32 y, f32 z) {
<br/>
     f32 v[3];
<br/>
     f32 sine = SIN[f32toint(divf32(mulf32(angle ,intof32(LUT_SIZE)),intof32(360))) &amp; LUT_MASK];
<br/>
     f32 cosine = COS[f32toint(divf32(mulf32(angle ,intof32(LUT_SIZE)),intof32(360))) &amp; LUT_MASK];
<br/>
     f32 cos_off = intof32 (1) - cosine;
<br/>
<br/>
   v[0] = x;
<br/>
   v[1] = y;
<br/>
   v[2] = z;
<br/>
    
<br/>
    normalizef32 (v);
<br/>
    
<br/>
   f32 xy = mulf32(v[0], v[1]);
<br/>
   f32 xz = mulf32(v[0], v[2]);
<br/>
   f32 yz = mulf32(v[1], v[2]);
<br/>
   f32 xs = mulf32(v[0], sine);
<br/>
   f32 ys = mulf32(v[1], sine);
<br/>
   f32 zs = mulf32(v[2], sine);
<br/>
<br/>
     MATRIX_MULT4x4 = mulf32(mulf32(v[0], v[0]), cos_off) + cosine;
<br/>
     MATRIX_MULT4x4 = mulf32(xy, cos_off) + zs;
<br/>
     MATRIX_MULT4x4 = mulf32(xz, cos_off) - ys;
<br/>
     MATRIX_MULT4x4 = 0;
<br/>
<br/>
     MATRIX_MULT4x4 = mulf32(xy, cos_off) - zs;
<br/>
     MATRIX_MULT4x4 = mulf32(mulf32(v[1], v[1]), cos_off) + cosine;
<br/>
     MATRIX_MULT4x4 = mulf32(yz, cos_off) + xs;
<br/>
     MATRIX_MULT4x4 = 0;
<br/>
  
<br/>
     MATRIX_MULT4x4 = mulf32(xz, cos_off) + ys;
<br/>
     MATRIX_MULT4x4 = mulf32(yz, cos_off) - xs;
<br/>
     MATRIX_MULT4x4 = mulf32(mulf32(v[2], v[2]), cos_off) + cosine;
<br/>
     MATRIX_MULT4x4 = 0;
<br/>
  
<br/>
     MATRIX_MULT4x4 = 0;
<br/>
     MATRIX_MULT4x4 = 0;
<br/>
     MATRIX_MULT4x4 = 0;
<br/>
     MATRIX_MULT4x4 = intof32 (1);
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
That is a rotate function.
<br/>
<br/>
Maybe this should be in ndslib...(well something like this), get moving dovoto ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#41931 - chrissieboy - Tue May 03, 2005 10:55 am</h4>
    <div class="postbody"><span class="postbody">GREAT! thanx! if im home i try to use it!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#41958 - dovoto - Tue May 03, 2005 8:02 pm</h4>
    <div class="postbody"><span class="postbody">Dont you just switch to model view rotate scale and translate your object, draw it...pop the stack and repeate?  the rotate, scale, translate functions have nothing to do with the camera...they operate on the current matrix (even the texture matrix if in texture mode).
<br/>
<br/>
I may just be totaly confused.<br/>_________________<br/><a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#41967 - dankydoo - Tue May 03, 2005 9:09 pm</h4>
    <div class="postbody"><span class="postbody">Dovoto,
<br/>
<br/>
You are right the glRotatef, glTranslatef, and glScalef functions all affect the model matrix, or the models defined in world space, the matrix created by gluLookAt() takes care of the camera by createing the view matrix.  Then they are post mutliplied.  Dovoto, are these functions being done in hardware?
<br/>
<br/>
dankydoo</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#41973 - dovoto - Tue May 03, 2005 9:52 pm</h4>
    <div class="postbody"><span class="postbody">Yes these are being done in hardware, the ds has specific fifo commands for rotation and scaling.  The code pasted above should work fine although it is a bit unecessary (i think).  
<br/>
<br/>
And i bellieve all matrix operations operate on the current modes current matrix.  Camera operations are still model view as far as i know...but i do know they work on the texture matricies as well.
<br/>
<br/>
I am somewhat 3D illiterate so I should probably not be doing the GL port ;)  But it seems to work well enough for now with only a few bug reports comming in.<br/>_________________<br/><a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#41979 - Ethos - Tue May 03, 2005 10:37 pm</h4>
    <div class="postbody"><span class="postbody">How do you suggest then to rotate off a vector (0,1,1) at an angle then??
<br/>
<br/>
Do three rotations off 3 calculated angles?
<br/>
<br/>
(I myself use the other functions for vectors (0,0,1), (0,1,0), and (0,0,1) for speed purposes)</span><span class="gensmall"><br/><br/>Last edited by Ethos on Tue May 03, 2005 10:40 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#41982 - dankydoo - Tue May 03, 2005 10:39 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>dovoto wrote:</b></span></td> </tr> <tr> <td class="quote">Yes these are being done in hardware, the ds has specific fifo commands for rotation and scaling.  The code pasted above should work fine although it is a bit unecessary (i think).  
<br/>
.</td> </tr></table><span class="postbody">
<br/>
<br/>
cool...the ds is a neat little machine...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>dovoto wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
And i bellieve all matrix operations operate on the current modes current matrix.  Camera operations are still model view as far as i know...but i do know they work on the texture matricies as well..</td> </tr></table><span class="postbody">
<br/>
<br/>
yes, all camera operations should be done in mocelview mode, not perspective mode....doing camera operations in perspective mode can affect lighting, fog, and some other things....
<br/>
<br/>
As far as I know, the only things that you wanna do while in perspective are glPerspective/glFrustum/glOrtho... and prolly glLoadIdentity()
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>dovoto wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
I am somewhat 3D illiterate so I should probably not be doing the GL port ;)  But it seems to work well enough for now with only a few bug reports comming in.</td> </tr></table><span class="postbody">
<br/>
<br/>
it does seem to work very well so far from what I read in the forums, I will have to take a look at it....
<br/>
<br/>
dankydoo</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#41984 - tepples - Tue May 03, 2005 10:44 pm</h4>
    <div class="postbody"><span class="postbody">Try this: <ol type="1"><li>Set up view and projection matrices. </li><li>For each object: <ol type="1"><li>Push the model-view matrix. </li><li>Set the model matrix. </li><li>Draw the object. </li><li>Pop the model-view matrix. </li></ol> </li><li>Finish rendering. </li></ol> Would that work?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#41988 - Ethos - Tue May 03, 2005 10:55 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>dovoto wrote:</b></span></td> </tr> <tr> <td class="quote">Yes these are being done in hardware, the ds has specific fifo commands for rotation and scaling. </td> </tr></table><span class="postbody">
<br/>
<br/>
Where is the FIFO rotate?? That is why I made this function because I saw ndslib using matrix multi for rotates....</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#41998 - LOUD NOISES - Tue May 03, 2005 11:58 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>dovoto wrote:</b></span></td> </tr> <tr> <td class="quote">Yes these are being done in hardware, the ds has specific fifo commands for rotation and scaling.  The code pasted above should work fine although it is a bit unecessary (i think).  
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Although the glRotateX/Y/Z functions work well enough, it's pretty useful to be able to rotate about an arbitrary axis. 
<br/>
<br/>
Aside from the lack of glRotatef32(), the only thing really bugging me with the library right now is the glTranslate3f32 function. Normally it's simply glTranslatef (or glTranslated) unlike functions like glVertex3f and glTexCoord2f, so I keep forgetting that extra 3. It's not really that hard for me to just make a macro to fix that, but I thought it might be worth changing in a future release.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#42000 - Ethos - Wed May 04, 2005 12:12 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define f32tot16(n)            ((t16)(n &gt;&gt; 8))
<br/>
#define f32tov16(n)            (n)
<br/>
#define f32tov10(n)            ((v10)(n &gt;&gt; 3))
<br/>
<br/>
void glTexCoord2f32(f32 u, f32 v) {
<br/>
   glTexCoord2t16(f32tot16 (u), f32tot16 (v));
<br/>
}
<br/>
<br/>
void glVertex3f32 (f32 x, f32 y, f32 z) {
<br/>
   glVertex3v16(f32tov16(x), f32tov16(y), f32tov16(z));
<br/>
}
<br/>
<br/>
void glTranslatef32 (f32 x, f32 y, f32 z) {
<br/>
  MATRIX_TRANSLATE = x;
<br/>
  MATRIX_TRANSLATE = y;
<br/>
  MATRIX_TRANSLATE = z;
<br/>
}
<br/>
<br/>
void glScalef32 (f32 x, f32 y, f32 z) {
<br/>
  MATRIX_SCALE = x;
<br/>
  MATRIX_SCALE = y;
<br/>
  MATRIX_SCALE = z;
<br/>
}
<br/>
<br/>
void glNormal3f32 (f32 x, f32 y, f32 z) {
<br/>
   glNormal(NORMAL_PACK(f32tov10(x),f32tov10(y),f32tov10(z)));
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
That covers the rest of the basics...us OpenGL people are particular it seems :P</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#42016 - bluescrn - Wed May 04, 2005 7:46 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Try this: <ol type="1"><li>Set up view and projection matrices. </li><li>For each object: <ol type="1"><li>Push the model-view matrix. </li><li>Set the model matrix. </li><li>Draw the object. </li><li>Pop the model-view matrix. </li></ol> </li><li>Finish rendering. </li></ol> Would that work?</td> </tr></table><span class="postbody">
<br/>
<br/>
Unfortunately, the matrix push/pop functions don't work in the current version of iDeaS, as they seem to use the hardware's matrix stack(s)....  (works fine on HW, though)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#42021 - Ethos - Wed May 04, 2005 1:26 pm</h4>
    <div class="postbody"><span class="postbody">Yup, right now I wouldn't suggest using ideas for 3D testing...actually my demos will not run on ideas because of some texture problems and a rotation problem.  But as far as emulators go...I luv it :)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
