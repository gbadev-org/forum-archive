<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>videoGL feature request: glDeleteTextures() - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > videoGL feature request: glDeleteTextures()</h2>
<div id="posts">
<div class="post">
    <h4>#118592 - melw - Wed Feb 14, 2007 1:53 pm</h4>
    <div class="postbody"><span class="postbody">Currently only way of clearing textures is to use glResetTextures(), which resets all the textures. For changing a single texture this is not very convenient, so how about implementing OpenGL-like glDeleteTextures(int size, int *textures) function in libnds?
<br/>
<br/>
I do have already a workaround for this, just wanted to throw in an idea... would make things tad easier.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#118595 - simonjhall - Wed Feb 14, 2007 2:00 pm</h4>
    <div class="postbody"><span class="postbody">Can I vote for this feature too please?
<br/>
At the moment (for my menus) I snapshot the entire texture state, show the menu, then restore the texture state when the menu is exitted. It's a bit of an arse, and a proper delete function would be so much more convenient...<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#118601 - silent_code - Wed Feb 14, 2007 3:17 pm</h4>
    <div class="postbody"><span class="postbody">you got my vote, too. it's not that great of a task to do yourself, but a consistent, standard implementation into libnds would be nice.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119028 - FireSlash - Mon Feb 19, 2007 5:01 am</h4>
    <div class="postbody"><span class="postbody">The "correct" way to do this is to load ALL textures into memory, then switch the texture by changing the <span style="font-weight: bold">glBindTexture();</span> call to match the texture you want.
<br/>
<br/>
I see your point. Your method would allow more video memory to be used by freeing items not displayed on the screen at that frame. However, this generates an additional load on the CPU as it now has to re-generate the GL texture every time one of these events occurs... On a FAT device this would be a crippling effect. It may work on flash devices better, but the initial flaw associated with re-generating the texture from it's original format remains, and will probably cause unwanted side effects. I ran into similar issues with my own homebrew when i attempted a similar Load on Demand style of texture management.
<br/>
<br/>
<span style="font-weight: bold">HOWEVER</span>
<br/>
<br/>
<a class="postlink" href="http://www.opengl.org/documentation/specs/man_pages/hardcopy/GL/html/gl/deletetextures.html" target="_blank">glDeleteTextures</a> IS a OpenGL 1.1 function, and it's implementation may assist in porting.<br/>_________________<br/><a class="postlink" href="http://www.fireslash.net" target="_blank">FireSlash.net</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119039 - tepples - Mon Feb 19, 2007 6:58 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>FireSlash wrote:</b></span></td> </tr> <tr> <td class="quote">The "correct" way to do this is to load ALL textures into memory, then switch the texture by changing the glBindTexture(); call to match the texture you want.</td> </tr></table><span class="postbody">
<br/>
But what if one of the textures is a movie, which obviously cannot be completely decoded to VRAM at once?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Your method would allow more video memory to be used by freeing items not displayed on the screen at that frame. However, this generates an additional load on the CPU as it now has to re-generate the GL texture every time one of these events occurs</td> </tr></table><span class="postbody">
<br/>
Except in the case that the textures are stored or generated in the GL format.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119076 - melw - Mon Feb 19, 2007 2:23 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>FireSlash wrote:</b></span></td> </tr> <tr> <td class="quote">The "correct" way to do this is to load ALL textures into memory, then switch the texture by changing the <span style="font-weight: bold">glBindTexture();</span> call to match the texture you want.
<br/>
<br/>
I see your point. Your method would allow more video memory to be used by freeing items not displayed on the screen at that frame. However, this generates an additional load on the CPU as it now has to re-generate the GL texture every time one of these events occurs...</td> </tr></table><span class="postbody">
<br/>
<br/>
Well, in a perfect world, if all the textures fit into memory there's no problem at all. But I think it's quite common where you have various scenes using different textures - perhaps some of them are same, some are not. Or you're using some of the banks for post-processing effects, or subscreen - there's lot of ways to run out of texture memory.
<br/>
<br/>
To me it seems like a waste of CPU time to call glResetTextures() and load everything again instead of, say calling glDeleteTextures() for one texture we don't need anymore and bind then the needed new texture after that.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119082 - kusma - Mon Feb 19, 2007 2:42 pm</h4>
    <div class="postbody"><span class="postbody">You can save memory be uploading a NULL-texture (zero width and height). Yes, it's a hack, but it should work. At least on a real GL-implementation, but then again glDeleteTextures() should exist too ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119459 - gabebear - Fri Feb 23, 2007 4:59 am</h4>
    <div class="postbody"><span class="postbody">I'm [&lt;thinking&gt;] about just removing the automatic texture memory allocation stuff (a.k.a. glTextImage2D() ) or moving it into a separate GL compatibility file. 
<br/>
<br/>
The code is already long and complicated and there isn't a "good" way to delocate texture memory. If you were only loading/unloading textures of the same size it would be easy to write a good glDeleteTextures(), but otherwise glDeleteTextures() needs to deal with memory fragmentation and libnds is never going to defrag texture memory for you.
<br/>
<br/>
glTextImage2D is really just there as a crutch to get people by with simple code. Managing your own texture memory is the way to go.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119599 - silent_code - Sat Feb 24, 2007 4:41 pm</h4>
    <div class="postbody"><span class="postbody">a good way to handle texture "deletion" is to replace (overwrite) unused items with a new one of the same size, so you don't have to free and then reallocate memory. at least that used to be common practice on the pc. there are several algorithms for this purpose.
<br/>
<br/>
OFFTOPIC: is it correct, that textures need to be rotated 90? ccw, or is it just my messy code?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119618 - gabebear - Sat Feb 24, 2007 8:39 pm</h4>
    <div class="postbody"><span class="postbody">Silent_code, that probably is the best solution but memory fragmentation will still probably occur and waste precious video memory. If glDeleteTextures() ever gets implemented it would do something like this, but you still probably shouldn't use it.
<br/>
<br/>
About the 90 degree texture rotation, it's not your messy code, it's libnds's. In the stable version of libnds the texture cords are swapped . The swapped coords along with the DS's and OpenGL's coordinate system that starts from the bottom left instead of the top left and it appears that textures are rotated 90 degrees, but really they are getting swapped around their main diagonal and then flipped on the horizontal. If you want correct texture coords grab libnds from CVS, you will also want to grab the latest examples from CVS as some other stuff has changed</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119927 - silent_code - Tue Feb 27, 2007 3:24 pm</h4>
    <div class="postbody"><span class="postbody">yeah, i just saw that somewhere else. obviously the uv coordinates are swapped. silly me, not seeing this. ;^p
<br/>
though, there's no problem in just swapping uvs on mesh loading to "correct" this. i'm used to the upside down thing, anyway. ;^D
<br/>
<br/>
again, we need glDeleteTextures() for full texture memory control and as a standard for all libnds homebrew!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#120282 - Payk - Fri Mar 02, 2007 8:26 am</h4>
    <div class="postbody"><span class="postbody">I more or less agree to that sentence: "Well, in a perfect world, if all the textures fit into memory there's no problem at all"
<br/>
<br/>
If you use 8bit textures you got damn many textures.
<br/>
I guess deleting one out of it has some problems.
<br/>
<br/>
First one is that all pointers which are pointing to that vram location need to be set to 0 or coder has to really know about it.
<br/>
<br/>
Second one is that it may be neececary to move all textures which were behind it into that gap AND update those pointers too.
<br/>
<br/>
<br/>
<br/>
Well there was a time when i was playing arround with something like a swap bank. Its a quite silly thing and just was for playing arround.
<br/>
If you track down the location of you loaded texture and wanna ovveride it, it wont work directly. You need to unlock textureram, refill texture with new content and lock the bank again. But while doing that, the screen gets black. A work arround was a swap system. 2 Banks holding 100% same content and just one is used at once. The other can be changed. If that was done you just need to swap the pointers(like doublebuffering). But that eats much vram and i decided to do it just as it should be used. But maybe there is a way to avoid the screen to get black while lock/unlocking texture banks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#120302 - tepples - Fri Mar 02, 2007 2:31 pm</h4>
    <div class="postbody"><span class="postbody">There is a way to avoid blanking the screen when replacing textures: try doing it during a time when the screen is already blank, such as the vertical blanking interval.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
