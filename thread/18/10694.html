<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Console with another BG on subscreen - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Console with another BG on subscreen</h2>
<div id="posts">
<div class="post">
    <h4>#96875 - omaremad - Sun Aug 06, 2006 3:26 am</h4>
    <div class="postbody"><span class="postbody">Ok here is what im trying to do:
<br/>
<br/>
1-have a console on the subscreen.
<br/>
2-have a second bg exrot or not that is fullscreen
<br/>
<br/>
i tried using tiled bg's for the second back ground but it looked very corrupted, probably because i had too many tiles(the console works fine on its own, the bg is fine on its own and the char blocks/ map block dont overlap etc.....)
<br/>
<br/>
so i attempted the exrot method using vram offsets since a 256*256 exrot takes the whole 128kb per vram bank.
<br/>
<br/>
this would have worked with vram offsetting but!
<br/>
it appears that vram bank c is the only one that can be mapped to the sub BG's while A,B,D can be mapped easily to the main BG.
<br/>
<br/>
lcd swap i hear you say....
<br/>
<br/>
I am also running 3d on the main core so i have to use the subscreen.
<br/>
maybe my font is too large? (custom font example)i spent way too long tweaking this...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#96876 - tepples - Sun Aug 06, 2006 3:30 am</h4>
    <div class="postbody"><span class="postbody">Can you provide a memory map of what things go where in bank C (like VBA's Tile Viewer)? Do any DS emulators support this? How many colors is your full-screen background, and how many colors are your font tiles? 16, 256, or thousands?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#96883 - knight0fdragon - Sun Aug 06, 2006 4:46 am</h4>
    <div class="postbody"><span class="postbody">you forgot about maps EFGH&amp;I,  , both H and I  can be mapped to sub screen
<br/>
<br/>
<br/>
do something like this
<br/>
<br/>
place  VRAM_C_SUB_BG_0x6220000 where you normally declare  your VRAMC
<br/>
<br/>
<br/>
vramSetBankH(VRAM_H_SUB_BG);
<br/>
<br/>
have your console screen point to 0 and char point to 1
<br/>
<br/>
then in your BG#_CR add | BG_BMP_RAM_SUB(5)<br/>_________________<br/><a href="http://www.myspace.com/knight0fdragonds" target="_blank">http://www.myspace.com/knight0fdragonds</a>
<br/>
<br/>
MK DS FC: Dragon 330772 075464 
<br/>
AC WW FC: Anthony SamsClub 1933-3433-9458 
<br/>
MPFH: Dragon 0215 4231 1206</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#96922 - omaremad - Sun Aug 06, 2006 4:42 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for that but i cant get the sub screen exrot to work(console does now thanks)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   vramSetMainBanks(VRAM_A_MAIN_BG, VRAM_B_TEXTURE,VRAM_C_SUB_BG_0x6220000, VRAM_D_TEXTURE);
<br/>
   //Kinda complex vram setup but i dont like tiled graphics much
<br/>
<br/>
<br/>
<br/>
<br/>
   //Hardware start
<br/>
   videoSetMode(MODE_5_3D | DISPLAY_BG2_ACTIVE);
<br/>
   videoSetModeSub(MODE_5_2D|DISPLAY_BG0_ACTIVE|DISPLAY_BG2_ACTIVE);
<br/>
<br/>
<br/>
   //BGS"S tidided
<br/>
   BG2_CR = BG_BMP16_256x256 | BLEND_ALPHA | BG_PRIORITY(3)|BG_WRAP_ON;
<br/>
   BG0_CR =BG_PRIORITY(3)|BLEND_ALPHA;
<br/>
<br/>
<br/>
     // Set translations
<br/>
    BG2_XDX = 1&lt;&lt;8;
<br/>
     BG2_XDY = 0;
<br/>
     BG2_YDX = 0;
<br/>
     BG2_YDY = 1&lt;&lt;8;
<br/>
     BG2_CY = 0;
<br/>
     BG2_CX = 0;
<br/>
<br/>
<br/>
   JPEG_DecompressImage((uint8*)gbfs_get_obj(&amp;data_gbfs, "om.jpg", NULL), BG_GFX, 256, 256);
<br/>
<br/>
   BLEND_CR = (2&lt;&lt;6) | BLEND_DST_BG2 | BLEND_SRC_BG0;
<br/>
   BLEND_AB = 15 | (15&lt;&lt;8);
<br/>
<br/>
<br/>
<br/>
<br/>
   vramSetBankH(VRAM_H_SUB_BG);
<br/>
   SUB_BG0_CR = BG_MAP_BASE(31);
<br/>
   //
<br/>
   SUB_BG2_CR = BG_BMP16_256x256| BG_BMP_RAM_SUB(1);
<br/>
<br/>
<br/>
   JPEG_DecompressImage((uint8*)gbfs_get_obj(&amp;data_gbfs, "om.jpg", NULL), (uint16*)BG_BMP_RAM_SUB(1), 256, 256);
<br/>
   BG_PALETTE_SUB[255] = RGB15(31,31,31);   //by default font will be rendered with color 255
<br/>
<br/>
   //consoleInit() is a lot more flexible but this gets you up and running quick
<br/>
   consoleInitDefault((u16*)SCREEN_BASE_BLOCK_SUB(31), (u16*)CHAR_BASE_BLOCK_SUB(0), 16);</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
top screen displays 3d on bg0 and an exrot on bg2
<br/>
bottom has console running on bankH bg0
<br/>
exrot running on bankC next offset which is 0x62200
<br/>
<br/>
is any of this code wrong
<br/>
note this cast  (uint16*)BG_BMP_RAM_SUB(1)
<br/>
<br/>
i used it to get it to compile, would this affect the output(i see a grey exrot which is good bc my image contains grey)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#96954 - knight0fdragon - Mon Aug 07, 2006 12:05 am</h4>
    <div class="postbody"><span class="postbody">no...... you would want bmp ram to go to 6, not 1, and that address would be 0x0622-4000, the address of H would be 0x0620-0000, thus you want to point bmpram at 5, which is the start of the pointer to vram C<br/>_________________<br/><a href="http://www.myspace.com/knight0fdragonds" target="_blank">http://www.myspace.com/knight0fdragonds</a>
<br/>
<br/>
MK DS FC: Dragon 330772 075464 
<br/>
AC WW FC: Anthony SamsClub 1933-3433-9458 
<br/>
MPFH: Dragon 0215 4231 1206</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#96957 - omaremad - Mon Aug 07, 2006 12:11 am</h4>
    <div class="postbody"><span class="postbody">ooouch my roter crashed an i couldnt post that code was wrong, thatnks for your guidance it helped my understand allot.
<br/>
<br/>
well the vram c is at 0x62000
<br/>
the bgmpram ofsset is in 0x400's so 5 *400 =2000
<br/>
+60000
<br/>
62000
<br/>
<br/>
:)
<br/>
<br/>
the screen was also grey because i didnt set the second affine matrix (i only done it for the main screen</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#96959 - omaremad - Mon Aug 07, 2006 12:14 am</h4>
    <div class="postbody"><span class="postbody">Ok just to make sure
<br/>
<br/>
the console is mapped to H
<br/>
<br/>
screen block =0
<br/>
char block=1
<br/>
<br/>
exrot
<br/>
bmp(5)
<br/>
<br/>
is this correct?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#99023 - jonezer4 - Sat Aug 19, 2006 2:53 am</h4>
    <div class="postbody"><span class="postbody">I've been struggling for some time with a simliar problem to this. If anyone could help it'd be extremely appreciated.
<br/>
<br/>
First of all, I'm using an 8-bit, 256 x 256 image for my background. Shouldn't this only take up half of vRAM C, leaving plenty of room to store console data? For some reason I can't get both to fit in C.
<br/>
<br/>
That said, I've tried what's been explained here and I cannot get the console to print correctly. The image in BG3 displays fine, but the console text (BG0) is all messed up. What am I doing wrong?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
vramSetMainBanks(VRAM_A_MAIN_BG_0x6000000, VRAM_B_MAIN_SPRITE,
<br/>
                     VRAM_C_SUB_BG_0x6200000, VRAM_D_SUB_SPRITE);
<br/>
                
<br/>
   vramSetBankH(VRAM_H_SUB_BG); //32 kb
<br/>
<br/>
                
<br/>
 
<br/>
  //Use main Screen (bottom) to display player cards
<br/>
  videoSetMode(MODE_5_2D | DISPLAY_BG3_ACTIVE
<br/>
                     | DISPLAY_SPR_ACTIVE
<br/>
                     | DISPLAY_SPR_1D    
<br/>
                     );      
<br/>
                     
<br/>
   BG3_CR = BG_BMP8_256x256 | BG_BMP_BASE(0) | BG_PRIORITY(3);
<br/>
   
<br/>
<br/>
    // Use the sub screen (top) as background with image and sprites
<br/>
  videoSetModeSub(MODE_5_2D | DISPLAY_BG0_ACTIVE //text
<br/>
                     |DISPLAY_BG3_ACTIVE //image
<br/>
                     | DISPLAY_SPR_ACTIVE
<br/>
                     | DISPLAY_SPR_1D    //this is used when in tile mode
<br/>
                     );         
<br/>
            
<br/>
<br/>
<br/>
         
<br/>
   ////////////////set up text background////////////////////
<br/>
                BG_PALETTE_SUB[0] = RGB15(2,2,25); //background color
<br/>
   SUB_BG0_CR = BG_MAP_BASE(0) | BG_PRIORITY(1);//use bg1 for the text
<br/>
   BG_PALETTE_SUB[255] = RGB15(31,0,0); //font color
<br/>
<br/>
<br/>
   consoleInitDefault((u16*)SCREEN_BASE_BLOCK_SUB(0), (u16*)CHAR_BASE_BLOCK_SUB(1), 16);
<br/>
  
<br/>
<br/>
  ///////////////set up bitmap background
<br/>
   SUB_BG3_CR = BG_BMP8_256x256 | BG_BMP_RAM_SUB(5)  | BG_PRIORITY(3);      
<br/>
         
<br/>
<br/>
   dmaCopy(bgTop_bin, BG_GFX_SUB, bgTop_bin_size);
<br/>
   dmaCopy(bgTopPal_bin, BG_PALETTE_SUB, bgTopPal_bin_size);
<br/>
<br/>
   dmaCopy(bgBottom_bin, BG_GFX, bgBottom_bin_size);
<br/>
   dmaCopy(bgBottomPal_bin, BG_PALETTE, bgBottomPal_bin_size);
<br/>
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#99025 - knight0fdragon - Sat Aug 19, 2006 3:00 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>jonezer4 wrote:</b></span></td> </tr> <tr> <td class="quote">I've been struggling for some time with a simliar problem to this. If anyone could help it'd be extremely appreciated.
<br/>
<br/>
First of all, I'm using an 8-bit, 256 x 256 image for my background. Shouldn't this only take up half of vRAM C, leaving plenty of room to store console data? For some reason I can't get both to fit in C.
<br/>
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
if it is 8 bit color, then it is 64k, if it is 16bit color, it is 128k
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>jonezer4 wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
That said, I've tried what's been explained here and I cannot get the console to print correctly. The image in BG3 displays fine, but the console text (BG0) is all messed up. What am I doing wrong?
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
vramSetMainBanks(VRAM_A_MAIN_BG_0x6000000, VRAM_B_MAIN_SPRITE,
<br/>
                     VRAM_C_SUB_BG_0x6200000, VRAM_D_SUB_SPRITE);
<br/>
                
<br/>
   vramSetBankH(VRAM_H_SUB_BG); //32 kb
<br/>
<br/>
                
<br/>
 
<br/>
  //Use main Screen (bottom) to display player cards
<br/>
  videoSetMode(MODE_5_2D | DISPLAY_BG3_ACTIVE
<br/>
                     | DISPLAY_SPR_ACTIVE
<br/>
                     | DISPLAY_SPR_1D    
<br/>
                     );      
<br/>
                     
<br/>
   BG3_CR = BG_BMP8_256x256 | BG_BMP_BASE(0) | BG_PRIORITY(3);
<br/>
   
<br/>
<br/>
    // Use the sub screen (top) as background with image and sprites
<br/>
  videoSetModeSub(MODE_5_2D | DISPLAY_BG0_ACTIVE //text
<br/>
                     |DISPLAY_BG3_ACTIVE //image
<br/>
                     | DISPLAY_SPR_ACTIVE
<br/>
                     | DISPLAY_SPR_1D    //this is used when in tile mode
<br/>
                     );         
<br/>
            
<br/>
<br/>
<br/>
         
<br/>
   ////////////////set up text background////////////////////
<br/>
                BG_PALETTE_SUB[0] = RGB15(2,2,25); //background color
<br/>
   SUB_BG0_CR = BG_MAP_BASE(0) | BG_PRIORITY(1);//use bg1 for the text
<br/>
   BG_PALETTE_SUB[255] = RGB15(31,0,0); //font color
<br/>
<br/>
<br/>
   consoleInitDefault((u16*)SCREEN_BASE_BLOCK_SUB(0), (u16*)CHAR_BASE_BLOCK_SUB(1), 16);
<br/>
  
<br/>
<br/>
  ///////////////set up bitmap background
<br/>
   SUB_BG3_CR = BG_BMP8_256x256 | BG_BMP_RAM_SUB(5)  | BG_PRIORITY(3);      
<br/>
         
<br/>
<br/>
   dmaCopy(bgTop_bin, BG_GFX_SUB, bgTop_bin_size);
<br/>
   dmaCopy(bgTopPal_bin, BG_PALETTE_SUB, bgTopPal_bin_size);
<br/>
<br/>
   dmaCopy(bgBottom_bin, BG_GFX, bgBottom_bin_size);
<br/>
   dmaCopy(bgBottomPal_bin, BG_PALETTE, bgBottomPal_bin_size);
<br/>
<br/>
</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
<br/>
I believe one of the things needed in the sub CR is BG_COLOR_256 or something like that
<br/>
<br/>
also you are copying the background to the wrong place in memory, you want to do  dmaCopy(bgTop_bin, &amp;BG_GFX_SUB[0x20000], bgTop_bin_size);
<br/>
<br/>
also you want to point VRAMC to VRAM_C_SUB_BG_0x6220000 not VRAM_C_SUB_BG_0x6200000<br/>_________________<br/><a href="http://www.myspace.com/knight0fdragonds" target="_blank">http://www.myspace.com/knight0fdragonds</a>
<br/>
<br/>
MK DS FC: Dragon 330772 075464 
<br/>
AC WW FC: Anthony SamsClub 1933-3433-9458 
<br/>
MPFH: Dragon 0215 4231 1206</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#99029 - jonezer4 - Sat Aug 19, 2006 3:59 am</h4>
    <div class="postbody"><span class="postbody">Knight, thanks a ton for your speedy reply.
<br/>
<br/>
I've implemented your recommended changes but now I'm getting no console font and my image is coming through very wrong. I probably messed something up along the way.  Here's the current code...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
vramSetMainBanks(VRAM_A_MAIN_BG_0x6000000, VRAM_B_MAIN_SPRITE,
<br/>
                    VRAM_C_SUB_BG_0x6220000, VRAM_D_SUB_SPRITE);
<br/>
                
<br/>
   vramSetBankH(VRAM_H_SUB_BG);
<br/>
                
<br/>
 
<br/>
  //Use main Screen (bottom) for image
<br/>
  videoSetMode(MODE_5_2D | DISPLAY_BG3_ACTIVE
<br/>
                     | DISPLAY_SPR_ACTIVE
<br/>
                     | DISPLAY_SPR_1D    //this is used when in tile mode
<br/>
                     );      
<br/>
                     
<br/>
   BG3_CR = BG_BMP8_256x256 | BG_BMP_BASE(0) | BG_PRIORITY(3);
<br/>
   
<br/>
<br/>
    // Use the sub screen (top) for output
<br/>
  videoSetModeSub(MODE_5_2D | DISPLAY_BG0_ACTIVE //text
<br/>
                     |DISPLAY_BG3_ACTIVE //image
<br/>
                     | DISPLAY_SPR_ACTIVE
<br/>
                     | DISPLAY_SPR_1D    //this is used when in tile mode
<br/>
                     );         
<br/>
            
<br/>
<br/>
<br/>
         
<br/>
   ////////////////set up text background////////////////////
<br/>
  SUB_BG0_CR = BG_MAP_BASE(0) | BG_PRIORITY(0) | BG_COLOR_256 ;//use bg0 for the text
<br/>
   BG_PALETTE_SUB[255] = RGB15(31,0,0); //font color
<br/>
<br/>
      
<br/>
<br/>
   consoleInitDefault((u16*)SCREEN_BASE_BLOCK_SUB(0), (u16*)CHAR_BASE_BLOCK_SUB(1), 16);
<br/>
  
<br/>
<br/>
  ///////////////set up our bitmap background///////////////////////
<br/>
<br/>
   SUB_BG3_CR = BG_BMP8_256x256 | BG_BMP_RAM_SUB(5)  | BG_PRIORITY(3);      
<br/>
<br/>
<br/>
   dmaCopy(bgTop_bin, &amp;BG_GFX_SUB[0x20000], bgTop_bin_size);
<br/>
   dmaCopy(bgTopPal_bin, BG_PALETTE_SUB, bgTopPal_bin_size);
<br/>
<br/>
   dmaCopy(bgBottom_bin, BG_GFX, bgBottom_bin_size);
<br/>
   dmaCopy(bgBottomPal_bin, BG_PALETTE, bgBottomPal_bin_size);</td> </tr></table><span class="postbody">
<br/>
<br/>
If you don't mind me asking, why do you map the VRAM to 0x6220000 and not the standard 0x6200000?
<br/>
<br/>
Also, since I'm not using anywhere near all of VRAM C's bank, would it stand to reason that I can omit the H bank?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#99386 - knight0fdragon - Mon Aug 21, 2006 6:09 am</h4>
    <div class="postbody"><span class="postbody">I made a quick sample of how to do tile and bmp at the same time
<br/>
<br/>
you can find it here  <a href="http://hyperclubbingfriends.yourfreewebspace.com/Knight0fDragon/" target="_blank">http://hyperclubbingfriends.yourfreewebspace.com/Knight0fDragon/</a><br/>_________________<br/><a href="http://www.myspace.com/knight0fdragonds" target="_blank">http://www.myspace.com/knight0fdragonds</a>
<br/>
<br/>
MK DS FC: Dragon 330772 075464 
<br/>
AC WW FC: Anthony SamsClub 1933-3433-9458 
<br/>
MPFH: Dragon 0215 4231 1206</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
