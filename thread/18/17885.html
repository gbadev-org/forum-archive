<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>multipalettes - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > multipalettes</h2>
<div id="posts">
<div class="post">
    <h4>#177599 - PypeBros - Sun Sep 09, 2012 8:07 pm</h4>
    <div class="postbody"><span class="postbody">Hello, all.
<br/>
<br/>
I've (at least) reached the point where I'll start <a class="postlink" href="http://sylvainhb.blogspot.be/2012/09/vramelcd.html" target="_blank">add multi-palette support</a> (aka extended palettes) to my game edition tools. I think I've understood most of how VRAM_E bank can be used, but I'm likely to need multi-colors only on *one* of the planes, so using VRAM_E could be some kind of waste here, esp. since there could be some (textured) 3D joining the game later on.
<br/>
<br/>
So I was wondering whether one of the 16K VRAM bank could be used as follow:
<br/>
- slot 0 would provide 16 palettes (offset 0x0000 to 0x1FFF) for BG2
<br/>
- slot 1 would provide 8 palettes for BG1 (offset 0x2000 to 0x2FFF) and 8 palettes for BG3 (offset 0x3000 to 0x3FFF).
<br/>
- I'd use the OFS bits of BG1CNT to force it use the same slots as BG3.
<br/>
- BG0 actually don't need palettes since it's the 3D stuff.
<br/>
<br/>
I'm gonna give it a try, but since I might do it wrong, if something has messed with that already, I'd be more than happy to listen, too ;)
<br/>
<br/>
Cheers.<br/>_________________<br/><a class="postlink" href="http://sylvainhb.blogspot.com/p/sprite-editor.html" target="_blank"> SEDS: Sprite Edition on DS</a> :: <a class="postlink" href="http://sylvainhb.blogspot.com/search/label/modplayer" target="_blank">modplayer</a></span><span class="gensmall"><br/><br/>Last edited by PypeBros on Mon Sep 10, 2012 10:40 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#177600 - sverx - Sun Sep 09, 2012 10:16 pm</h4>
    <div class="postbody"><span class="postbody">Yes, you can use extended palettes using a single 16KB VRAM bank.
<br/>
You can find an example I wrote on my tutorial <a class="postlink" href="http://wcms.teleion.it/users/cgq/nds/tutorial/a3.html" target="_blank">here</a> (the tutorial it's in Italian but the code is simple)<br/>_________________<br/><a class="postlink" href="http://bit.ly/yiQrz9" target="_blank">libXM7</a>|<a class="postlink" href="http://bit.ly/yJwcOo" target="_blank">NDS programming tutorial (Italiano)</a>|<a class="postlink" href="http://disjointedstudio.blogspot.com/" target="_blank">Waimanu DS / GBA</a>|<a class="postlink" href="http://adshomebrewersdiary.blogspot.com" target="_blank">A DS Homebrewer's Diary</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177601 - PypeBros - Mon Sep 10, 2012 9:34 am</h4>
    <div class="postbody"><span class="postbody">thanks for the link, sverx. I'm not surprised that *you* investigated the topic already :)
<br/>
<br/>
Btw, I read on your tutorial "- nel modo rotazionale a 256 colori viene usata sempre e solo la palette standard dei background, anche quando le palette estese sono attive." which I understand as "ROTSCALE backgrounds still use BG_PALETTE, whatever the DISPLAY_BG_EXT_PALETTE dictates". Do you know whether that stays true for "extended" rot/scale layers (which iirc still have 16 bit per tile, including a place for palette selection) or just the legacy "affine" layers (which, iirc, have only access to 256 tiles, and no tile swapping either) ?
<br/>
<br/>
I also see you use vramSetBankG (VRAM_G_BG_EXT_PALETTE_SLOT23); ... I had in mind that it would indeed be the way to use 16K extended palettes on 4 layers, as layers 2 and 3 have no control on the "slots" they're going to use. 
<br/>
<br/>
Anyway, I'm gonna extend your tutorial code with BG2 and figure out :)<br/>_________________<br/><a class="postlink" href="http://sylvainhb.blogspot.com/p/sprite-editor.html" target="_blank"> SEDS: Sprite Edition on DS</a> :: <a class="postlink" href="http://sylvainhb.blogspot.com/search/label/modplayer" target="_blank">modplayer</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177602 - sverx - Mon Sep 10, 2012 11:03 am</h4>
    <div class="postbody"><span class="postbody">'Normal' rot/scale backgrounds cannot use extended palettes, so they'll keep on using the colors defined in the standard palette.
<br/>
'Extended' rot/scale backgrounds CAN use extended palettes.
<br/>
Check <a href="http://nocash.emubase.de/gbatek.htm#dsvideoextendedpalettes" target="_blank">http://nocash.emubase.de/gbatek.htm#dsvideoextendedpalettes</a> :)
<br/>
<br/>
Then you can use either VRAM Bank F or G if you only need 16KB of extended palette space. Here's the list of all the <a class="postlink" href="http://wcms.teleion.it/users/cgq/nds/tutorial/vram_modes.html" target="_blank">VRAM modes</a>, again from my -quite old now- tutorial. I hope that makes it clearer :)<br/>_________________<br/><a class="postlink" href="http://bit.ly/yiQrz9" target="_blank">libXM7</a>|<a class="postlink" href="http://bit.ly/yJwcOo" target="_blank">NDS programming tutorial (Italiano)</a>|<a class="postlink" href="http://disjointedstudio.blogspot.com/" target="_blank">Waimanu DS / GBA</a>|<a class="postlink" href="http://adshomebrewersdiary.blogspot.com" target="_blank">A DS Homebrewer's Diary</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177603 - PypeBros - Mon Sep 10, 2012 12:20 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sverx wrote:</b></span></td> </tr> <tr> <td class="quote">'Extended' rot/scale backgrounds CAN use extended palettes.
<br/>
Check <a href="http://nocash.emubase.de/gbatek.htm#dsvideoextendedpalettes" target="_blank">http://nocash.emubase.de/gbatek.htm#dsvideoextendedpalettes</a> :)
<br/>
</td> </tr></table><span class="postbody">
<br/>
Oh! now I see it!
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
BG Extended Palette enabled in DISPCNT Bit 30, when enabled,
<br/>
<br/>
 standard palette --&gt; ...
<br/>
                      256-color tiles (with 8bit bgmap entries) (rot/scal)
<br/>
...
<br/>
 extended palette --&gt; 256-color tiles (with 16bit bgmap entries)(<span style="font-weight: bold">text,rot/scal</span>)
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Thanks for sharing your knowledge. For some reason, no matter how much I re-read entries in gbatek, I never manage to infer as much as I should out of it... that's pretty frustrating &gt;_&lt;<br/>_________________<br/><a class="postlink" href="http://sylvainhb.blogspot.com/p/sprite-editor.html" target="_blank"> SEDS: Sprite Edition on DS</a> :: <a class="postlink" href="http://sylvainhb.blogspot.com/search/label/modplayer" target="_blank">modplayer</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177604 - sverx - Mon Sep 10, 2012 1:46 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>PypeBros wrote:</b></span></td> </tr> <tr> <td class="quote">... no matter how much I re-read entries in gbatek, I never manage to infer as much as I should out of it...</td> </tr></table><span class="postbody">
<br/>
<br/>
The same to me too. Each time I read it again, I find something I had missed.
<br/>
<br/>
edit: Congratulations on your NEO Retro Coding Compo 2012 silver medal :)<br/>_________________<br/><a class="postlink" href="http://bit.ly/yiQrz9" target="_blank">libXM7</a>|<a class="postlink" href="http://bit.ly/yJwcOo" target="_blank">NDS programming tutorial (Italiano)</a>|<a class="postlink" href="http://disjointedstudio.blogspot.com/" target="_blank">Waimanu DS / GBA</a>|<a class="postlink" href="http://adshomebrewersdiary.blogspot.com" target="_blank">A DS Homebrewer's Diary</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177605 - PypeBros - Mon Sep 10, 2012 3:01 pm</h4>
    <div class="postbody"><span class="postbody">[quote="sverx"]</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>PypeBros wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
edit: Congratulations on your NEO Retro Coding Compo 2012 silver medal :)</td> </tr></table><span class="postbody">
<br/>
<br/>
eh ... thanks. I wasn't aware they had finally completed the evaluation. Hopefully, that could help with the broken hardware issues :)<br/>_________________<br/><a class="postlink" href="http://sylvainhb.blogspot.com/p/sprite-editor.html" target="_blank"> SEDS: Sprite Edition on DS</a> :: <a class="postlink" href="http://sylvainhb.blogspot.com/search/label/modplayer" target="_blank">modplayer</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
