<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>2D-in-3D: overcoming z-fighting, other questions - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > 2D-in-3D: overcoming z-fighting, other questions</h2>
<div id="posts">
<div class="post">
    <h4>#143276 - Hyouko - Fri Oct 19, 2007 2:51 am</h4>
    <div class="postbody"><span class="postbody">Hello, all; bit of a noob here, working on a simple-ish homebrew game with libnds and devkitARM.  As I have some past experience with OpenGL, I figured I'd try to base my engine on that, and it's working well enough so far.  I ran into the same z-fighting issue with depth-test that several others have come across in the past, and I've implemented a simple hack to get around it.  Two questions regarding that: has anybody figured out a more elegant way to get around the depth test, and (if not) what's the smallest incremental change in depth that will register?  (I'm presently using 1000th of a unit, which works, but some of the sprites are noticeably off by one pixel).
<br/>
<br/>
On a different note - can anybody recommend a decent Linux-based tool for saving DS textures?  I'm currently using the psptex GIMP plugin, which can save to a 5551 raw format - it works, but I'd like to be able to use sprites with a proper alpha channel and take advantage of the smaller paletted texture formats available.  I've found a tool from NomadTeam that could do this, but it's apparently Windows-only at present.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143293 - ingramb - Fri Oct 19, 2007 8:36 am</h4>
    <div class="postbody"><span class="postbody">Not 100% sure if this is your problem, but if you set an orthographic projection (rather than perspective), then a given poly's depth will have no effect on its pixel size.  This may make your question about depth resolution less important.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143359 - Peter - Sat Oct 20, 2007 9:06 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Hyouko wrote:</b></span></td> </tr> <tr> <td class="quote">has anybody figured out a more elegant way to get around the depth test</td> </tr></table><span class="postbody">
<br/>
I read a common approach is to use a modified projection matrix (with slightly changed znear/zfar values) to render polys where you know they lie on the same plane with another poly. For example for bullets on walls.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Hyouko wrote:</b></span></td> </tr> <tr> <td class="quote">and (if not) what's the smallest incremental change in depth that will register?  (I'm presently using 1000th of a unit, which works, but some of the sprites are noticeably off by one pixel).</td> </tr></table><span class="postbody">
<br/>
Depth buffer usually ranges from 0..1 or 0..0x7fff in fixed point. The scene depth is projected into the depth buffer, so when you setup your project matrix, znear=5, zfar=20 the depth buffer has to deal with a range of 15units. Where zdepth=0 is at the near plane and zdepth 0x7fff (the 15th unit) is the far plane.
<br/>
<br/>
However, the z-buffer doesn't have a linear distribution of its depth-values, it's more accurate closer to the near plane and loses accuaracy the more it comes to the far plane.
<br/>
The formula to compute the depth value(copied from <a class="postlink" href="http://en.wikipedia.org/wiki/Z-buffering" target="_blank">wikipedia</a>).
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
z' = (far + near / far - near) + 1/z * (-2 * far + near / far - near)
<br/>
</td> </tr></table><span class="postbody">
<br/>
I guess this makes it rather hard to give a "working depth value which will register" at every possible depth in this case.
<br/>
<br/>
What you could try is to use the w-buffer. The w-buffer has distrubuted its depth values linearily across the whole depth-range, so you can calculate depending on your scene depth how many units you have to move an object to make a change in the depth buffer. But the resolution closer at the near plane is not as good as for the z-buffer.
<br/>
<br/>
Hope it makes sense :)<br/>_________________<br/>Kind Regards,
<br/>
Peter</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
