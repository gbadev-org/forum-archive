<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>sprite problem after upgrading libnds (and devkit) [SOLVED] - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > sprite problem after upgrading libnds (and devkit) [SOLVED]</h2>
<div id="posts">
<div class="post">
    <h4>#153152 - silent_code - Tue Mar 25, 2008 7:05 pm</h4>
    <div class="postbody"><span class="postbody">hi guys!
<br/>
<br/>
can anyone tell me what is wrong with this code??? no$ tells me it's causing an error. commenting it out will yield no errors, but one right before the first line of code in main - what about that?
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
j = 0;
<br/>
<br/>
for(i = 0; i &lt; 256; i++)
<br/>
SPRITE_PALETTE[i] = ((uint16*)sprites_pal_bin)[i]; // works
<br/>
<br/>
for(i = 0; i &lt; 512; i++, j++)
<br/>
//      SPRITE_GFX[j] = ((u16*)player8_img_bin)[i]; // does not work
<br/>
      SPRITE_GFX[j] = (uint16)(4 &lt;&lt; 8 | 4); // doesn't eighter!
<br/>
<br/>
// at this point no$ shows 513 errors, then, no more are generated throughout the rest of the code!
<br/>
<br/>
// all this works:
<br/>
for(i = 0; i &lt; 256; i++)
<br/>
BG_PALETTE[i] = ((uint16*)bg8_pal_bin)[i];
<br/>
<br/>
for(i = 0; i &lt; bg8_img_bin_size / (sizeof(uint32)); i++)
<br/>
((uint32*)SCREEN_BASE_BLOCK(0))[i] = ((uint32*)bg8_img_bin)[i];
<br/>
</td> </tr></table><span class="postbody">
<br/>
it all worked before i upgraded to the most recent tools and libs.
<br/>
<br/>
backgrounds will show, palettes (bg and sprite) will load and work without trouble, the only problem is that sprite graphics data can't be writen, but i'm sure NOT writing bytes, but halfwords!
<br/>
<br/>
i know i could use dma etc., but i want to know WHY this doesn't work!
<br/>
<br/>
btw: my vram setup:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
videoSetMode(MODE_5_2D |
<br/>
      DISPLAY_SPR_ACTIVE |
<br/>
      DISPLAY_BG3_ACTIVE |
<br/>
      DISPLAY_BG2_ACTIVE |
<br/>
      DISPLAY_SPR_1D);
<br/>
<br/>
vramSetMainBanks(VRAM_A_MAIN_BG_0x06000000,
<br/>
      VRAM_B_MAIN_SPRITE,
<br/>
      VRAM_C_SUB_BG_0x06200000,
<br/>
      VRAM_D_LCD);
<br/>
</td> </tr></table><span class="postbody">
<br/>
i don't get it!
<br/>
<br/>
any help is appreciated! :^D
<br/>
thanks!
<br/>
<br/>
ps: dualis' debugging tools show that indeed *NOTHING* is written to SPRITE_GFX! all pixels are set to 0!
<br/>
<br/>
EDIT: CRAP!!! i need to check j!!! ... okay, j is propperly initialized with 0, so that's not the problem!</span><span class="gensmall"><br/><br/>Last edited by silent_code on Wed Mar 26, 2008 2:24 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#153157 - Miked0801 - Tue Mar 25, 2008 8:17 pm</h4>
    <div class="postbody"><span class="postbody">Double check your define for SPRITE_GFX.  If it's pointing at an odd, unaligned address or is cast incorrectly, then that would explain why no$ is grumbling.  Also, for sanity's sake, please use parenthesis on your or/shifts.  The Order of Presidence on those is not what you expect.
<br/>
<br/>
Also, make sure that the area of memory that SPRITE_GFX is pointing at is enabled and/or in the correct video mode for the operation.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153162 - silent_code - Tue Mar 25, 2008 9:58 pm</h4>
    <div class="postbody"><span class="postbody">thanks! your post is totally valid... i changed the code a bit for testing to see if *anything* will go, so the usual lisp (for those who don't know: "Lots of Irritating Superfluous Parentheses") got left out. ;^) even assigning a single value won't work. i'm using 4bit sprites, btw.
<br/>
<br/>
as stated before, it worked just before switching libnds (and devkit, but that shouldn't really be the problem). in another project, i compiled with the same setup, but that was using the dma halfword transfer, things are okay.
<br/>
<br/>
define from libnds, file "memory.h", line 80:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define SPRITE_GFX         ((uint16*)0x6400000)
<br/>
</td> </tr></table><span class="postbody">
<br/>
gbatek says:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">06400000h  VRAM - Engine A, OBJ VRAM (max 256KB)</td> </tr></table><span class="postbody">
<br/>
which is pretty much the same...
<br/>
<br/>
also my first line in main is:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
powerON(POWER_ALL_2D);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
so, what's wrong? i *never* has such problems! (no$ always reportet 0/1 error for this code - total, that is!)
<br/>
<br/>
can anyone confirm that?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153167 - wintermute - Tue Mar 25, 2008 11:24 pm</h4>
    <div class="postbody"><span class="postbody">use VRAM_B_MAIN_BG_0x06040000.
<br/>
<br/>
Dovoto rearranged the default macros a little bit and they're not quite what you expect.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153176 - silent_code - Wed Mar 26, 2008 1:28 am</h4>
    <div class="postbody"><span class="postbody">i'll try that, thank you! :^)
<br/>
but what i still don't understand is, why do the other memory areas work as expected? i guess this is subject to change, isn't it?
<br/>
<br/>
EDIT: still nothing... :^(
<br/>
now i have:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
vramSetMainBanks(VRAM_A_MAIN_BG_0x06000000,
<br/>
         VRAM_B_MAIN_BG_0x06040000,
<br/>
         VRAM_C_SUB_BG_0x06200000,
<br/>
         VRAM_D_LCD);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
i'll try to replace SPRITE_GFX with 0x06040000 and use the vram setup i had before.
<br/>
<br/>
EDIT2: again, nothing.
<br/>
<br/>
i'm out of ideas... any other suggestions?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153179 - silent_code - Wed Mar 26, 2008 2:05 am</h4>
    <div class="postbody"><span class="postbody">i stripped it down to this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
#include &lt;nds.h&gt;
<br/>
<br/>
int main(void)
<br/>
{
<br/>
   powerON(POWER_ALL_2D);
<br/>
   irqInit();
<br/>
<br/>
   videoSetMode(   MODE_5_2D |
<br/>
               DISPLAY_SPR_ACTIVE |
<br/>
               DISPLAY_BG3_ACTIVE |
<br/>
               DISPLAY_BG2_ACTIVE |
<br/>
               DISPLAY_SPR_1D);
<br/>
<br/>
   vramSetMainBanks(   VRAM_A_MAIN_BG_0x06000000,
<br/>
                  VRAM_B_MAIN_SPRITE,
<br/>
                  VRAM_C_SUB_BG_0x06200000,
<br/>
                  VRAM_D_LCD);
<br/>
<br/>
   videoSetModeSub(MODE_0_2D);
<br/>
   vramSetBankC(VRAM_C_SUB_BG_0x06200000);
<br/>
<br/>
   for(uint16 i = 0; i &lt; 256; i++)
<br/>
      SPRITE_PALETTE[i] = (uint16)(0x0F0F &amp; i | i); // ... for the fun of it
<br/>
<br/>
   for(uint16 i = 0; i &lt; 512; i++)
<br/>
      SPRITE_GFX[i] = (uint16)0x1234;
<br/>
<br/>
   while(true);
<br/>
<br/>
   return(0);
<br/>
}
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
still i get nothing written to SPRITE_GFX (palette works as usually) and 513 errors... if i comment the relevant code segment just the usual single error (???) is reported.
<br/>
<span style="font-size: 24px; line-height: normal">???</span></span><span class="gensmall"><br/><br/>Last edited by silent_code on Wed Mar 26, 2008 2:10 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#153181 - tepples - Wed Mar 26, 2008 2:10 am</h4>
    <div class="postbody"><span class="postbody">Does this work?
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">vramSetMainBanks(VRAM_A_MAIN_BG_0x06000000,
<br/>
         VRAM_B_MAIN_SPRITE_0x06400000,
<br/>
         VRAM_C_SUB_BG_0x06200000,
<br/>
         VRAM_D_LCD);</td> </tr></table><span class="postbody"><br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153182 - wintermute - Wed Mar 26, 2008 2:11 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">use VRAM_B_MAIN_BG_0x06040000.
<br/>
<br/>
Dovoto rearranged the default macros a little bit and they're not quite what you expect.</td> </tr></table><span class="postbody">
<br/>
<br/>
I'm an idiot, copy, paste &amp; post without checking, sorry
<br/>
<br/>
VRAM_B_MAIN_SPRITE_0x06400000 is what I meant
<br/>
<br/>
<span style="font-size: 7px; line-height: normal">damn you tepples, just beat me to it :P</span><br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153184 - silent_code - Wed Mar 26, 2008 2:20 am</h4>
    <div class="postbody"><span class="postbody">GREAT!
<br/>
<br/>
THANKS A LOT, both of you! :?)
<br/>
<br/>
it works, perfectly! so after all, it was incorrect mapping. i knew it had to be, but i haven't done any nds screwing in months, so i wasn't really up to date and didn't know about those changes.
<br/>
<br/>
you have saved me hours of looking through header files.
<br/>
<br/>
thank you, again! :^D
<br/>
<br/>
ps: now i can finally go to bed... it's 2:19am over here. ;?D
<br/>
<br/>
EDIT: now i see the damn thing was mapped to the first offset by default, instead of being mapped without offset!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153185 - silent_code - Wed Mar 26, 2008 2:24 am</h4>
    <div class="postbody"><span class="postbody">PPPS: my girlfriend left me, can you guys fix that, too?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153187 - tepples - Wed Mar 26, 2008 2:41 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>silent_code wrote:</b></span></td> </tr> <tr> <td class="quote">PPPS: my girlfriend left me, can you guys fix that, too?</td> </tr></table><span class="postbody">
<br/>
Maybe you need a new animal girlfriend in DS land. I can help you fix that.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153189 - silent_code - Wed Mar 26, 2008 3:01 am</h4>
    <div class="postbody"><span class="postbody">no new one, i want the old one back... :^C
<br/>
i like animals, though.
<br/>
(what does that even mean, tepples?)
<br/>
<br/>
back on topic: what about the initial error no$ keeps reporting (put in a while(true); at the very beginning of main())?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153191 - wintermute - Wed Mar 26, 2008 5:01 am</h4>
    <div class="postbody"><span class="postbody">offtopic: why did she leave you? I had to promise mine I'd spend a bit less time on the computer &amp; more quality time with her.
<br/>
<br/>
ontopic: no$ complains about endless loops that drain the battery<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153214 - silent_code - Wed Mar 26, 2008 2:38 pm</h4>
    <div class="postbody"><span class="postbody">&lt;OT&gt; wasn't because of me or something i did. she's "lost" her feelings... but i really think it's because she's got a NPD (google that), then add ignorance and intolerance to that. she even told me, she might need some professional help - although she doesn't know about NPDs. well, in fact, i don't understand it at all. i'm very sad and still love her and all, because she *can* be such a beautiful person, if she allowed herself.&lt;/OT&gt;
<br/>
<br/>
hm, interesting. i usually ignore that error and no$ tells me everything is good. it's just that there's the total of "one" errors.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153252 - tepples - Thu Mar 27, 2008 2:11 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>silent_code wrote:</b></span></td> </tr> <tr> <td class="quote">no new one, i want the old one back... :^C
<br/>
i like animals, though.
<br/>
(what does that even mean, tepples?)</td> </tr></table><span class="postbody">
<br/>
<a class="postlink" href="http://en.wikipedia.org/wiki/Animal_Crossing:_Wild_World" target="_blank">Wiki wiki wiki</a>.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153266 - silent_code - Thu Mar 27, 2008 1:41 pm</h4>
    <div class="postbody"><span class="postbody">ha, ha, ha! :^D
<br/>
i don't think ACWW will do me any good, but willingnes counts, so tepples, you get a "+" for sympathy (in a sims-sim). ;^)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
