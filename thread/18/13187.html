<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>powering off the ds from software? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > powering off the ds from software?</h2>
<div id="posts">
<div class="post">
    <h4>#128576 - spinal_cord - Sat May 12, 2007 11:03 pm</h4>
    <div class="postbody"><span class="postbody">Just wondering, is there a simple way to switch off the ds within software? I want to add a switch off feature to something I'm working on, and I haven't got a clue how to do it.
<br/>
<br/>
Any help?<br/>_________________<br/>I'm not a boring person, it's just that boring things keep happening to me.
<br/>
<a class="postlink" href="http://spinal.dizidesigns.co.uk/" target="_blank">Homepage</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#128577 - Lick - Sat May 12, 2007 11:07 pm</h4>
    <div class="postbody"><span class="postbody">int temp = readPowerManagement(PM_CONTROL);
<br/>
writePowerManagement(PM_CONTROL, temp | BIT(6)); // BIT(6): 0=on, 1=off
<br/>
<br/>
This is on the ARM7 of course.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#128578 - Sunray - Sat May 12, 2007 11:23 pm</h4>
    <div class="postbody"><span class="postbody">Does it matter what you write except bit 6? I mean, the DS will switch off :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#128579 - Lick - Sat May 12, 2007 11:53 pm</h4>
    <div class="postbody"><span class="postbody">It probably doesn't matter, because the PowerManagement states won't survive a powercycle anyway. But I gave the "full example" because powering-off isn't the only thing those functions do and it's important to know that with all other changes, you have to make sure you only change the bits you intend to change. (This is a general rule, not just for these values.)
<br/>
<br/>
int mask = BIT(6) | BIT(5);
<br/>
int old = readPowerManagement(PM_CONTROL) <span style="font-weight: bold">&amp; ~mask</span>;
<br/>
writePowerManagement(PM_CONTROL, old | BIT(6)); 
<br/>
<br/>
Note that this is the ultimate way to change the bit, because as you can see BIT(5) needs to be 0 after this snippet. If you don't mask the old value, and you know how the |-operator doesn't clear the bit, BIT(5) will still be 1 if it was 1 before. So it's important to mask the "potentially changed" bits to 0. 
<br/>
<br/>
<span style="font-weight: bold">old|new</span>
<br/>
// without masking
<br/>
1|1=1 //yes
<br/>
1|0=1 //no
<br/>
<br/>
// masked
<br/>
0|1=1 //yes
<br/>
0|0=0 //yes
<br/>
<br/>
Anyway, I used way too much time explaning something very logical.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#128599 - spinal_cord - Sun May 13, 2007 10:49 am</h4>
    <div class="postbody"><span class="postbody">How do I do this in palib? I don't yet know the difference between arm7/arm9. (sorry)<br/>_________________<br/>I'm not a boring person, it's just that boring things keep happening to me.
<br/>
<a class="postlink" href="http://spinal.dizidesigns.co.uk/" target="_blank">Homepage</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#128603 - Lick - Sun May 13, 2007 11:42 am</h4>
    <div class="postbody"><span class="postbody">Is there a way to program the ARM7 in Palib? (In other words, can you have two main-functions? One for ARM9, other for ARM7)<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#128607 - ThomasS - Sun May 13, 2007 1:24 pm</h4>
    <div class="postbody"><span class="postbody">No, it's not possible to program the arm7 with PALib, but you can abuse the PA_Screenlight function (PALib - arm7) to write the Poweroff flag.
<br/>
<br/>
To call this function by the arm9, use:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">// Turns off the DS.
<br/>
extern inline void PA_Shutdown()
<br/>
{
<br/>
   IPC-&gt;aux |= BIT(6);   // libnds arm7 code: #define PM_POWER_DOWN        BIT(6)
<br/>
}</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#128609 - spinal_cord - Sun May 13, 2007 1:32 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lick wrote:</b></span></td> </tr> <tr> <td class="quote">Is there a way to program the ARM7 in Palib? (In other words, can you have two main-functions? One for ARM9, other for ARM7)</td> </tr></table><span class="postbody">
<br/>
<br/>
Nope, just the one main.c (I assume arm9 only?) is this one of the reasons some people don't like palib?
<br/>
<br/>
[edit] It worked, thanks guys![/edit]<br/>_________________<br/>I'm not a boring person, it's just that boring things keep happening to me.
<br/>
<a class="postlink" href="http://spinal.dizidesigns.co.uk/" target="_blank">Homepage</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#128617 - tondopie - Sun May 13, 2007 2:46 pm</h4>
    <div class="postbody"><span class="postbody">so is there anyway to call this funciton on the ARM9 even though the ARM7 handles this?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#128622 - Sunray - Sun May 13, 2007 3:38 pm</h4>
    <div class="postbody"><span class="postbody">Yes, with FIFO IPC commands.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
