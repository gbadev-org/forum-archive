<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Gl problem with ortho/frustum - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Gl problem with ortho/frustum</h2>
<div id="posts">
<div class="post">
    <h4>#54593 - Extreme Coder - Tue Sep 20, 2005 6:40 pm</h4>
    <div class="postbody"><span class="postbody">Hi there.
<br/>
I needed a glortho function, but since there isnt one, i took the one Dovoto at irc gave me:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
//---------------------------------------------------------------------------------
<br/>
void glOrtho3f32(f32 left, f32 right, f32 bottom, f32 top, f32 near, f32 far) {
<br/>
//---------------------------------------------------------------------------------
<br/>
   glMatrixMode(GL_PROJECTION);
<br/>
 
<br/>
   MATRIX_LOAD4x4 = divf32(intof32(2), right - left);     
<br/>
   MATRIX_LOAD4x4 = 0;  
<br/>
   MATRIX_LOAD4x4 = 0;      
<br/>
   MATRIX_LOAD4x4 = divf32(right + left, right - left);
<br/>
 
<br/>
   MATRIX_LOAD4x4 = 0;  
<br/>
   MATRIX_LOAD4x4 = divf32(intof32(2), top - bottom);     
<br/>
   MATRIX_LOAD4x4 = 0;    
<br/>
   MATRIX_LOAD4x4 = divf32(top + bottom, top - bottom); 
<br/>
 
<br/>
   MATRIX_LOAD4x4 = 0;  
<br/>
   MATRIX_LOAD4x4 = 0;  
<br/>
   MATRIX_LOAD4x4 = -divf32(intof32(-2), far - near);     
<br/>
   MATRIX_LOAD4x4 = divf32(far + near, far - near);
<br/>
 
<br/>
   MATRIX_LOAD4x4 = 0;  
<br/>
   MATRIX_LOAD4x4 = 0;  
<br/>
   MATRIX_LOAD4x4 = 0;  
<br/>
   MATRIX_LOAD4x4 = floatof32(-1.0F);
<br/>
 
<br/>
   glStoreMatrix(0);
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
And I use it in my program like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
/****************************************
<br/>
 *       NDS NeHe Lesson 06             *
<br/>
 *       Author: Dovoto               *
<br/>
 ****************************************/
<br/>
<br/>
// include your ndslib
<br/>
#include &lt;nds.h&gt;
<br/>
#include &lt;malloc.h&gt;
<br/>
//needed to load pcx files
<br/>
#include &lt;nds/arm9/image.h&gt;
<br/>
#include "drunkenlogo_pcx.h"
<br/>
<br/>
//Glortho3f32 function in the same post above
<br/>
//---------------------------------------------------------------------------------
<br/>
void glOrtho(float left, float right, float bottom, float top, float near, float far) {
<br/>
//---------------------------------------------------------------------------------
<br/>
glOrtho3f32(floatof32(left), floatof32(right), floatof32(bottom), floatof32(top),floatof32(near), floatof32(far));
<br/>
}
<br/>
<br/>
int DrawGLScene();
<br/>
<br/>
int   texture[1];         // Storage For One Texture ( NEW )
<br/>
<br/>
void image8to16(sImage* img)
<br/>
 {
<br/>
    int i;
<br/>
<br/>
    u16* temp = (u16*)malloc(img-&gt;height*img-&gt;width*2);
<br/>
    
<br/>
    for(i = 0; i &lt; img-&gt;height * img-&gt;width; i++)
<br/>
       temp[i] = img-&gt;palette[img-&gt;data8[i]] | (1&lt;&lt;15);
<br/>
<br/>
    img-&gt;data16 = temp;
<br/>
 }
<br/>
<br/>
int LoadGLTextures()                           // Load PCX files And Convert To Textures
<br/>
{
<br/>
   sImage pcx;                //////////////(NEW) and different from nehe.
<br/>
<br/>
   //load our texture
<br/>
   loadPCX((u8*)drunkenlogo_pcx, &amp;pcx);
<br/>
   
<br/>
   image8to16(&amp;pcx);
<br/>
<br/>
   glGenTextures(1, &amp;texture[0]);
<br/>
   glBindTexture(0, texture[0]);
<br/>
   glTexImage2D(0, 0, GL_RGB, TEXTURE_SIZE_128 , TEXTURE_SIZE_128, 0, TEXGEN_TEXCOORD, pcx.data8);
<br/>
<br/>
   return TRUE;
<br/>
}
<br/>
<br/>
int main()
<br/>
{   
<br/>
   // Turn on everything
<br/>
   powerON(POWER_ALL);
<br/>
   
<br/>
   irqInit();
<br/>
   irqEnable(IRQ_VBLANK);
<br/>
   
<br/>
   // Setup the Main screen for 3D 
<br/>
   videoSetMode(MODE_0_3D);
<br/>
   vramSetBankA(VRAM_A_TEXTURE);                        //NEW  must set up some memory for textures
<br/>
<br/>
   // Set our viewport to be the same size as the screen
<br/>
   glViewPort(0,0,255,191);
<br/>
   
<br/>
   // Specify the Clear Color and Depth 
<br/>
   glClearColor(0,0,0);
<br/>
   glClearDepth(0x7FFF);
<br/>
   
<br/>
   LoadGLTextures();
<br/>
   while (1) 
<br/>
   {
<br/>
      scanKeys();
<br/>
      // Reset the screen and setup the view
<br/>
      glReset();
<br/>
      //gluPerspective(i, 256.0/192.0,0.1, 100);
<br/>
      glOrtho(0,256,192,0,0,1);
<br/>
      glColor3f(1,1,1);
<br/>
      
<br/>
      glPushMatrix();
<br/>
      
<br/>
      glMatrixMode(GL_TEXTURE);
<br/>
      glIdentity();
<br/>
<br/>
      
<br/>
      glMatrixMode(GL_MODELVIEW);
<br/>
      
<br/>
      //ds specific, several attributes can be set here   
<br/>
      glPolyFmt(POLY_ALPHA(31) | POLY_CULL_NONE);
<br/>
      
<br/>
      // Set the current matrix to be the model matrix
<br/>
      glMatrixMode(GL_MODELVIEW);
<br/>
      
<br/>
      //Push our original Matrix onto the stack (save state)
<br/>
      glPushMatrix();   
<br/>
<br/>
      DrawGLScene();
<br/>
      
<br/>
      // Pop our Matrix from the stack (restore state)
<br/>
      glPopMatrix(1);
<br/>
<br/>
      // flush to screen   
<br/>
      glFlush();
<br/>
   
<br/>
   }
<br/>
   
<br/>
   return 0;
<br/>
}
<br/>
<br/>
int DrawGLScene()                                 // Here's Where We Do All The Drawing
<br/>
{
<br/>
   glLoadIdentity();                           // Reset The View
<br/>
   glTranslatef(0,0,0);
<br/>
<br/>
   glBindTexture(GL_TEXTURE_2D, texture[0]);
<br/>
<br/>
   glBegin(GL_QUADS);
<br/>
      // Front Face
<br/>
      glTexCoord2f(0, 0); glVertex3f( 0,  0, 0.0);
<br/>
      glTexCoord2f(1, 0); glVertex3f(10,  0, 0.0);
<br/>
      glTexCoord2f(1, 1); glVertex3f(10, 10, 0.0);
<br/>
      glTexCoord2f(0, 1); glVertex3f( 0, 10, 0.0);
<br/>
   glEnd();
<br/>
   return TRUE;         
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
But i get black screens. I tried changing glOrtho(0,256,192,0,0,1); to glOrtho(0,256,192,0,-1,1);, yet same results. And i changed glVertex's z coordinate aswell, no luck.
<br/>
Does anyone know whats wrong with this code?
<br/>
Or if you think the problem is with the function, then whats wrong when i use glfrustum with the same arguments and get the same results?
<br/>
Oh, and please, add a working Glortho function in the next libnds:D
<br/>
<br/>
<br/>
Thanks so much in advance.</span><span class="gensmall"><br/><br/>Last edited by Extreme Coder on Wed Sep 21, 2005 1:42 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#54658 - duencil - Wed Sep 21, 2005 10:04 am</h4>
    <div class="postbody"><span class="postbody">Did you try setting near to a small positive value instead of 0?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#54668 - Extreme Coder - Wed Sep 21, 2005 1:39 pm</h4>
    <div class="postbody"><span class="postbody">well, something like 0.1? I tried that, and I supposed I must change the vertex coordinates to 0.1. Doesnt work. 
<br/>
If someone thinks the mistake is with the function, then can someone tell me how is glFrustum supposed to work? i tried the same arguments, same results.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#54673 - wintermute - Wed Sep 21, 2005 3:10 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Extreme Coder wrote:</b></span></td> </tr> <tr> <td class="quote">Hi there.
<br/>
<br/>
Oh, and please, add a working Glortho function in the next libnds:D
<br/>
<br/>
Thanks so much in advance.</td> </tr></table><span class="postbody">
<br/>
<br/>
done :)
<br/>
<br/>
<a href="http://www.devkitpro.org/" target="_blank">http://www.devkitpro.org/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#54678 - duencil - Wed Sep 21, 2005 4:23 pm</h4>
    <div class="postbody"><span class="postbody">The function in libnds is correct after all.</span><span class="gensmall"><br/><br/>Last edited by duencil on Tue Jan 17, 2006 8:15 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#54693 - Extreme Coder - Wed Sep 21, 2005 6:06 pm</h4>
    <div class="postbody"><span class="postbody">Thanks wintermute and duencil, I'm gonna test now that stuff, and will edit or reply with the results:D.
<br/>
<br/>
<br/>
Thanks so much,
<br/>
Extreme Coder</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#54983 - LunarCrisis - Sat Sep 24, 2005 4:44 am</h4>
    <div class="postbody"><span class="postbody">What I always do for ortho projections is a call to glLoadIdentity, which gives you an ortho with the range -1, 1 mapped to the screen in both the X and Y direction, then scale it from there.<br/>_________________<br/>If a tree falls in the forest and no one is there to hear it, why the heck do you care?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#73817 - acox - Tue Feb 28, 2006 6:09 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Extreme Coder wrote:</b></span></td> </tr> <tr> <td class="quote">Thanks wintermute and duencil, I'm gonna test now that stuff, and will edit or reply with the results:D.
<br/>
<br/>
<br/>
Thanks so much,
<br/>
Extreme Coder</td> </tr></table><span class="postbody">
<br/>
<br/>
So was there any resolution to this issue?
<br/>
<br/>
What is the status of devkitPro on this?
<br/>
<br/>
Does the ortho frustum func work and are there any gotchas?<br/>_________________<br/><a class="postlink" href="http://www.btinternet.com/~ahcox/GBA/" target="_blank">3D on GBA</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#73853 - Extreme Coder - Tue Feb 28, 2006 1:00 pm</h4>
    <div class="postbody"><span class="postbody">Yes, glortho works well on devkitpro now, but depth sorting doesnt work at all:( hope this is soon fixed</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
