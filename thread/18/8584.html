<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>RAMBANKS AGAIN - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > RAMBANKS AGAIN</h2>
<div id="posts">
<div class="post">
    <h4>#71826 - Payk - Tue Feb 14, 2006 7:08 pm</h4>
    <div class="postbody"><span class="postbody">u16* frontBuffer = (u16*)(0x06000000);
<br/>
will point to a vrambank which is opened like:
<br/>
VRAM_D_MAIN_BG_0x6000000
<br/>
<br/>
ok so how can i make a buffer for both screens (each of them with own buffer)
<br/>
<br/>
beacause VRAM_D_SUB_BG_0x6000000
<br/>
will just bring an error. hmhmh... is there no way to map it to sub_screen for framebuffering ?
<br/>
<br/>
THANX</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#71834 - realstar - Tue Feb 14, 2006 7:49 pm</h4>
    <div class="postbody"><span class="postbody">I think something like this should work but I use
<br/>
extended rotation backgrounds so I am not sure.
<br/>
<br/>
// Setup a framebuffer for MAIN
<br/>
videoSetMode(MODE_FB0);
<br/>
<br/>
// Map vramA as MAIN
<br/>
vramSetBankA(VRAM_A_MAIN_BG_0x6000000);
<br/>
<br/>
// Setup a framebuffer for SUB
<br/>
videoSetModeSub(MODE_FB0);
<br/>
<br/>
// Map vramC as SUB
<br/>
vramSetBankC(VRAM_C_SUB_BG);
<br/>
<br/>
// pointers to buffers
<br/>
u16* frontBuffer  = (u16*) BG_GFX;     // 0x6000000
<br/>
u16* frontBuffer2 = (u16*) BG_GFX_SUB; // 0x6200000
<br/>
<br/>
You can find a good description of the modes
<br/>
available and vram mapping here:
<br/>
<a href="http://tobw.net/dswiki/index.php?title=Graphic_modes" target="_blank">http://tobw.net/dswiki/index.php?title=Graphic_modes</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#71840 - Payk - Tue Feb 14, 2006 8:49 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code"> 
<br/>
u16* frontBuffer = (u16*) BG_GFX;// 0x6000000 
<br/>
u16* frontBuffer2 = (u16*) BG_GFX_SUB; // 0x6200000 
<br/>
<br/>
    vramSetMainBanks(   VRAM_A_MAIN_SPRITE,        //A and B maped consecutivly as sprite memory
<br/>
                        VRAM_B_MAIN_SPRITE,        //this gives us 256KB which is the max
<br/>
                        VRAM_C_SUB_BG,     //map C to bg for touchscreen
<br/>
                        VRAM_D_MAIN_BG_0x6000000); //map D to background memory
<br/>
<br/>
 
<br/>
  //Window screen 
<br/>
   videoSetMode(  MODE_3_2D | 
<br/>
                   DISPLAY_SPR_ACTIVE |    //turn on sprites
<br/>
                   DISPLAY_SPR_2D |        //this is used when in tile mode
<br/>
                   DISPLAY_SPR_1D_BMP |    //and this in bitmap mode
<br/>
                   DISPLAY_BG3_ACTIVE); 
<br/>
    BG3_CR = BG_BMP16_256x256;
<br/>
    BG3_XDX = 1 &lt;&lt; 8;
<br/>
    BG3_XDY = 0;
<br/>
    BG3_YDX = 0;
<br/>
    BG3_YDY = 1 &lt;&lt; 8;
<br/>
    BG3_CX = 0;
<br/>
    BG3_CY = 0;
<br/>
       for(int iy = 0; iy &lt; 196 ; iy++)
<br/>
            for(int ix = 0; ix &lt; 256 ; ix++)
<br/>
                frontBuffer[iy * 256 + ix] = bg1[iy * 256 + ix] | BIT(15);
<br/>
<br/>
  //Touchscreen
<br/>
    videoSetModeSub(MODE_0_2D | DISPLAY_BG0_ACTIVE);
<br/>
   SUB_BG0_CR = BG_BMP16_256x256;
<br/>
               
<br/>
       for(int iy = 0; iy &lt; 196 ; iy++)
<br/>
            for(int ix = 0; ix &lt; 256 ; ix++)
<br/>
                frontBuffer2[iy * 256 + ix] = bg1[iy * 256 + ix] | BIT(15);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
ok i dont needed framerbuffer. i set up all like that. there comes a LCDSWAP() later. so touchscreen is here the top screen in reality. but doesnt matter. on touchscreen (here is it topscreen) gives just whitescreen and other screen with sprites runs fine. so Why SUB_BG0 is not visible (and note i use same picture for both screens (just for now) so its not because of pic)
<br/>
THANX (and i read the artcicle and tryed out...)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#71843 - Payk - Tue Feb 14, 2006 9:05 pm</h4>
    <div class="postbody"><span class="postbody">Forget it i set up correctly now thanx anyway that link is QL</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
