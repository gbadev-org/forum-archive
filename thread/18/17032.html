<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Problem with textures and color of objects - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Problem with textures and color of objects</h2>
<div id="posts">
<div class="post">
    <h4>#171889 - magge - Thu Dec 31, 2009 4:19 pm</h4>
    <div class="postbody"><span class="postbody">hello guys,
<br/>
<br/>
i'm new to this board and have started developing a starfox like game for the ds.
<br/>
<br/>
i create my spaceships with simple glvertex commands with tiangles or quads. like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void ShipOne::drawShip(){
<br/>
  glColor3f(0.1,0.3,1.0);
<br/>
   glBegin(GL_TRIANGLES);
<br/>
   
<br/>
   //upper Left
<br/>
   glVertex3f(0.0,0.2,0.0);
<br/>
   glVertex3f(0.0,0.0,-1.0);
<br/>
   glVertex3f(-0.5,0.0,0.4);
<br/>
   
<br/>
   //upper right
<br/>
   glVertex3f(0.0,0.2,0.0);
<br/>
   glVertex3f(0.0,0.0,-1.0);
<br/>
   glVertex3f(0.5,0.0,0.4);
<br/>
            
<br/>
            ...
<br/>
       glEnd();
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
i have a showroom at the beginning of the game to look at the ships. they have the color that i assigned to them.
<br/>
<br/>
now comes the part i can't understand. i created a raw image .bin file with gfx2gba and used the code parts from the example "textured quad" from the devkitpro package. i do this in the main method concerning textures:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
            glEnable(GL_TEXTURE_2D);
<br/>
   vramSetBankA(VRAM_A_TEXTURE);
<br/>
<br/>
   glGenTextures(1, &amp;textureID);
<br/>
   glBindTexture(0, textureID);
<br/>
   glTexImage2D(0, 0, GL_RGB, TEXTURE_SIZE_256 , TEXTURE_SIZE_256, 0, TEXGEN_TEXCOORD, (u8*)space_bin);   
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
to draw the textured quad which should stay still in the background of my scene, i do this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
  void drawTexturedPlane(){
<br/>
  glPushMatrix();
<br/>
  glPolyFmt(POLY_ALPHA(31) | POLY_CULL_BACK);
<br/>
  glTranslatef(0.0,0.0,-2.0);
<br/>
  glScalef(8.0,8.0,8.0);
<br/>
  glBindTexture(0, textureID);
<br/>
  glColor3f(1.0,1.0,1.0);
<br/>
  //draw the obj
<br/>
   glBegin(GL_QUAD);
<br/>
      //glNormal(NORMAL_PACK(0,inttov10(-1),0));
<br/>
         GFX_TEX_COORD = (TEXTURE_PACK(0, inttot16(256)));
<br/>
         glVertex3v16(floattov16(-0.5),   floattov16(-0.5), 0 );
<br/>
   
<br/>
         GFX_TEX_COORD = (TEXTURE_PACK(inttot16(256),inttot16(256)));
<br/>
         glVertex3v16(floattov16(0.5),   floattov16(-0.5), 0 );
<br/>
   
<br/>
         GFX_TEX_COORD = (TEXTURE_PACK(inttot16(256), 0));
<br/>
         glVertex3v16(floattov16(0.5),   floattov16(0.5), 0 );
<br/>
<br/>
         GFX_TEX_COORD = (TEXTURE_PACK(0,0));
<br/>
         glVertex3v16(floattov16(-0.5),   floattov16(0.5), 0 );
<br/>
      
<br/>
      glEnd();
<br/>
      
<br/>
      glPopMatrix(1);
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
but whenever i draw this quad (which looks just like it should), i have the problem, that the darker the texture itself (a space texture with a lot of black in my case) leads to the occurance, that all objects rendered into the same scene as the quad change its color to black or close to black. they just seem to lose their color information.
<br/>
<br/>
this is my complete display function:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   glPolyFmt(POLY_ALPHA(31) | POLY_CULL_NONE);
<br/>
   glMatrixMode(GL_MODELVIEW);
<br/>
   glLoadIdentity();
<br/>
<br/>
   gluLookAt(0.0,0.0,3.0,0.0,0.0,0.0,0.0,1.0,0.0);
<br/>
   
<br/>
   glPushMatrix();
<br/>
   glTranslatef(current_ship.getShipX(),current_ship.getShipY(),0.0);
<br/>
   glRotateX(rotX);
<br/>
   glRotateZ(rotZ);
<br/>
   if(current_ship.getShipId()==1){
<br/>
    ShipOne sh=static_cast&lt;ShipOne&gt;(current_ship);
<br/>
    sh.drawShip();
<br/>
   }else if(current_ship.getShipId()==2){
<br/>
    ShipTwo sh=static_cast&lt;ShipTwo&gt;(current_ship);
<br/>
    sh.drawShip();
<br/>
  }
<br/>
  glPopMatrix(1);
<br/>
  
<br/>
  drawTexturedPlane();
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
would be great if anyone knew what was going on with it. i mean it is strange that the brighter the texture itself, the less color information gets lost from my spaceship. i just don't understand why the texture affects the ship's color at all.
<br/>
and until i disable GL_TEXTURE_2D, the ships color stays black. when i disable textures, then it gets it's original color black.
<br/>
i do not use lighting.
<br/>
<br/>
i'm thankful for any help.
<br/>
<br/>
cya</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171892 - headspin - Thu Dec 31, 2009 6:45 pm</h4>
    <div class="postbody"><span class="postbody">Not sure why this would happen if you have no lights? Do you have POLY_CULL_BACK set?
<br/>
<br/>
BTW The Nitro Texture Converter included with NitroEngine can convert graphics to all of the non-compressed texture formats.
<br/>
<br/>
<a href="http://antoniond.drunkencoders.com/nitroengine.html" target="_blank">http://antoniond.drunkencoders.com/nitroengine.html</a>
<br/>
<br/>
<span style="font-weight: bold">mod edit: please link to info pages not directly to archives</span><br/>_________________<br/><a class="postlink" href="http://headsoft.com.au/index.php?category=warhawk" target="_blank">Warhawk DS</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=mmll" target="_blank">Manic Miner: The Lost Levels</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=tdg" target="_blank">The Detective Game</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171906 - kusma - Fri Jan 01, 2010 2:21 pm</h4>
    <div class="postbody"><span class="postbody">You're experiencing state leaks. Try to call "glDisable(GL_TEXTURE_2D);" at the start of ShipOne::drawShip() (before glBegin).
<br/>
<br/>
edit: oh, and you need to call "glEnable(GL_TEXTURE_2D)" again when drawing the textured plane.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171919 - headspin - Sat Jan 02, 2010 7:03 am</h4>
    <div class="postbody"><span class="postbody"><span style="font-weight: bold">mod edit: please link to info pages not directly to archives</span>
<br/>
<br/>
Is this in the <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=9484" target="_blank">rules</a> <span style="font-weight: bold">WinterMute</span>? I'm guessing it was you as no other mod has ever stated this in the 7 odd years I've been a member here. And what about all the hundreds of other direct links on this forum like the third post in this <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=16955" target="_blank">thread</a>? Seems like you've got your work cut out for you if that's the case!<br/>_________________<br/><a class="postlink" href="http://headsoft.com.au/index.php?category=warhawk" target="_blank">Warhawk DS</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=mmll" target="_blank">Manic Miner: The Lost Levels</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=tdg" target="_blank">The Detective Game</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171923 - magge - Sat Jan 02, 2010 1:31 pm</h4>
    <div class="postbody"><span class="postbody">hey, thanks for the help so far. but it still doesn't work. it only works when i texture_2d is disabled and not enabled again after drawing simple non textured polygons like my spaceship.
<br/>
so in my display function i draw the ship and then the plane. therefore the textures are enabled again before glflush is called. if i draw the textured plane first, then textures are disabled when flush is called, so i have no textures at all. but this is weird since opengl is state based.
<br/>
<br/>
when i switch back to my showroom where there are no textures so far, i disable texture 2d and everything looks good.
<br/>
<br/>
i'm pretty confused here. thanks again.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171926 - elhobbs - Sat Jan 02, 2010 10:00 pm</h4>
    <div class="postbody"><span class="postbody">there is no need to glDisable/glEnable textures if you use polys with and without textures. glEnable(GL_TEXTURE_2D) once to initialize the hardware then call glBindTexture(0, 0) if you do not want a texture applied.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171928 - magge - Sat Jan 02, 2010 11:55 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>elhobbs wrote:</b></span></td> </tr> <tr> <td class="quote">there is no need to glDisable/glEnable textures if you use polys with and without textures. glEnable(GL_TEXTURE_2D) once to initialize the hardware then call glBindTexture(0, 0) if you do not want a texture applied.</td> </tr></table><span class="postbody">
<br/>
THANK YOU, perfect. it works. i did not know that one has to execute that line even though no texture is applied to this object.
<br/>
<br/>
thanks for all the help.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171930 - kusma - Sun Jan 03, 2010 2:51 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>elhobbs wrote:</b></span></td> </tr> <tr> <td class="quote">there is no need to glDisable/glEnable textures if you use polys with and without textures. glEnable(GL_TEXTURE_2D) once to initialize the hardware then call glBindTexture(0, 0) if you do not want a texture applied.</td> </tr></table><span class="postbody">
<br/>
From an OpenGL-perspective (not NiroGL, so this post is only me ranting), this is just so wrong that it hurts.
<br/>
<br/>
The enable-flags for each texture target is checked in a specified order, to detect if there's texturing enabled for a texture unit. For NitroGL (or, really... "something a bit more OpenGL-ish on Nintendo DS"), that would only be GL_TEXTURE_2D.
<br/>
<br/>
glBindTexture(0, 0) should simply generate an GL_INVALID_ENUM error, as zero is not an accepted texture target.
<br/>
<br/>
glBindTexture(GL_TEXTURE_2D, 0) (I'm assuming this is what you meant and/or a bizarre side-effect of NiroGL-enum overlaps) would bind texture-name zero to the GL_TEXTURE_2D target, but this isn't really what we want either. Texture-name zero is the default-texture, and can very much contain texture images, so it is not equal to disabling the texture unit.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171949 - elhobbs - Mon Jan 04, 2010 3:05 am</h4>
    <div class="postbody"><span class="postbody">gl_texture_2d is only used for compatibility on the ds. Passing 0 to glbindtexture works just as well. I did this intentionally. And relax this is not a full OpenGL implementation it is just there to help people get started with 3d on the ds.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171961 - kusma - Mon Jan 04, 2010 1:45 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>elhobbs wrote:</b></span></td> </tr> <tr> <td class="quote">And relax this is not a full OpenGL implementation it is just there to help people get started with 3d on the ds.</td> </tr></table><span class="postbody">
<br/>
I did specify that it was just rant, didn't I? And no, it's not "a full OpenGL implementation", it's not an OpenGL implementation at all. To be allowed to call yourself an OpenGL implementation, you need to join the ARB (or the GLES group at Khronos for OpenGL ES), pay some money, and pass the conformancy tests. NiroGL wouldn't be anywhere near passing.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
