<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Japanese Fonts ? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > Japanese Fonts ?</h2>
<div id="posts">
<div class="post">
    <h4>#133713 - jonnyhilly - Sun Jul 08, 2007 1:50 am</h4>
    <div class="postbody"><span class="postbody">Hi, I'm interested in coding something up that can print text in both english and Japanese (Katakana, Hiragana and Kanji characters)
<br/>
So I guess I'd need a Unicode font or something ?
<br/>
<br/>
any ideas where I could get a unicode-utf-8 font, with all the other languages' graphics stripped out, so its just english and Japanese ?
<br/>
<br/>
Is there any support in DS libs for printing Unicode characters or fonts ?
<br/>
if so what type of encoding does it use ?
<br/>
<br/>
any help appreciated.
<br/>
Thanks</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#133718 - masscat - Sun Jul 08, 2007 2:14 am</h4>
    <div class="postbody"><span class="postbody"><a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=13061" target="_blank">Lick has ported FreeType2</a> to the DS. Otherwise write some PC software to convert TrueType into some other format for you to use.
<br/>
<br/>
As for free Japanese fonts, have a look at a <a class="postlink" href="http://packages.debian.org/stable/x11/ttf-kochi-mincho" target="_blank">Linux distribution</a> for possibilities.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#133734 - Dwedit - Sun Jul 08, 2007 6:38 am</h4>
    <div class="postbody"><span class="postbody">There's always the <a class="postlink" href="http://packages.ubuntu.com/edgy/x11/unifont" target="_blank">GNU Unifont</a>, if you don't mind spreading the viral GPL over your code.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#133808 - abszero - Sun Jul 08, 2007 10:10 pm</h4>
    <div class="postbody"><span class="postbody">If you're not really set on using Unicode as your text encoding, you could try using a BDF font - that's what I'm using.  They're (generally) pixel fonts and so are often optimized for small screens like on the DS.  
<br/>
<br/>
<a href="http://palm.roguelife.org/cjkos/" target="_blank">http://palm.roguelife.org/cjkos/</a> gives a good overview of what's out there.  M+ in particular is nice because it's public domain IIRC ( <a href="http://mplus-fonts.sourceforge.jp/mplus-bitmap-fonts/design/index.html" target="_blank">http://mplus-fonts.sourceforge.jp/mplus-bitmap-fonts/design/index.html</a> ) .</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#133852 - jonnyhilly - Mon Jul 09, 2007 8:36 am</h4>
    <div class="postbody"><span class="postbody">yeah, a bdf is the best thing I've found so far.
<br/>
I'm kinda stuck with Unicode utf-8 as the kanji database I am using is in that format, though I guess I could convert from one format to another... 
<br/>
<br/>
I did find one unicode bdf font with 19208 characters for an x-wondows system... but it might work OK. I dunno
<br/>
<a href="http://www.cl.cam.ac.uk/~mgk25/ucs-fonts.html" target="_blank">http://www.cl.cam.ac.uk/~mgk25/ucs-fonts.html</a>
<br/>
Though I can't even see what the font looks like till I code it up.
<br/>
...which is slightly worrying
<br/>
<br/>
thanks for the links
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>abszero wrote:</b></span></td> </tr> <tr> <td class="quote">If you're not really set on using Unicode as your text encoding, you could try using a BDF font - that's what I'm using.  They're (generally) pixel fonts and so are often optimized for small screens like on the DS.  
<br/>
<br/>
<a href="http://palm.roguelife.org/cjkos/" target="_blank">http://palm.roguelife.org/cjkos/</a> gives a good overview of what's out there.  M+ in particular is nice because it's public domain IIRC ( <a href="http://mplus-fonts.sourceforge.jp/mplus-bitmap-fonts/design/index.html" target="_blank">http://mplus-fonts.sourceforge.jp/mplus-bitmap-fonts/design/index.html</a> ) .</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#133865 - masscat - Mon Jul 09, 2007 11:19 am</h4>
    <div class="postbody"><span class="postbody">You can make your own bitmap fonts from fonts files supported by libfreetype using ttf2bdf (under linux) or write your own converter.
<br/>
Here is a program that dumps the first 128 characters at a given height in my own custom format. Feel free to adapt it as you please should it be useful:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include &lt;stdint.h&gt;
<br/>
#include &lt;stdlib.h&gt;
<br/>
#include &lt;stdio.h&gt;
<br/>
#include &lt;string.h&gt;
<br/>
<br/>
#include &lt;ft2build.h&gt;
<br/>
#include FT_FREETYPE_H
<br/>
<br/>
<br/>
static void
<br/>
dump_bitmap( uint8_t char_num, const char *font_name,
<br/>
        FT_Bitmap *bitmap, FT_Glyph_Metrics *metrics,
<br/>
        FT_Int left, FT_Int top) {
<br/>
  /*printf( "row %d, width %d, pitch %d, num_grays %d, pixel_mode %d, palette_mode %d\n",
<br/>
     bitmap-&gt;rows, bitmap-&gt;width, bitmap-&gt;pitch, bitmap-&gt;num_grays, bitmap-&gt;pixel_mode,
<br/>
     bitmap-&gt;palette_mode);*/
<br/>
<br/>
  /*printf( "metrics:\n"
<br/>
     "width %d, height %d, bearing x %d, bearing y %d, "
<br/>
     "advance %d\n",
<br/>
     metrics-&gt;width, metrics-&gt;height, metrics-&gt;horiBearingX,
<br/>
     metrics-&gt;horiBearingY, metrics-&gt;horiAdvance);*/
<br/>
<br/>
  /*printf( "left %d, top %d\n", left, top);*/
<br/>
<br/>
  if ( isprint( char_num)) {
<br/>
    printf( "/* '%c' 0x%x\n", (char)char_num, char_num);
<br/>
  }
<br/>
  else {
<br/>
    printf( "/* 0x%x\n", char_num);
<br/>
  }
<br/>
  printf( " *\n");
<br/>
<br/>
  if ( bitmap-&gt;pixel_mode == FT_PIXEL_MODE_MONO) {
<br/>
    int y;
<br/>
<br/>
    for ( y = 0; y &lt; bitmap-&gt;rows; y++) {
<br/>
      uint8_t *bitmap_row = &amp;bitmap-&gt;buffer[ y * bitmap-&gt;pitch];
<br/>
      int x;
<br/>
<br/>
      printf(" * ");
<br/>
<br/>
      for ( x = 0; x &lt; bitmap-&gt;width; x++) {
<br/>
   int bits_index = x / 8;
<br/>
   uint8_t bits = bitmap_row[bits_index];
<br/>
   uint8_t mask = 0x80 &gt;&gt; ( x % 8);
<br/>
<br/>
   if ( bits &amp; mask)
<br/>
     printf("*");
<br/>
   else
<br/>
     printf("-");
<br/>
      }
<br/>
      printf("\n");
<br/>
    }
<br/>
  }
<br/>
<br/>
  if ( bitmap-&gt;pixel_mode == FT_PIXEL_MODE_MONO) {
<br/>
    int y;
<br/>
<br/>
    printf( " */\n");
<br/>
    printf( "static unsigned char\n");
<br/>
    printf( "%s_%d_bitmap[] = {\n", font_name, char_num);
<br/>
    printf( "\t%d, %d", bitmap-&gt;width, bitmap-&gt;rows);
<br/>
<br/>
    for ( y = 0; y &lt; bitmap-&gt;rows; y++) {
<br/>
      uint8_t *bitmap_row = &amp;bitmap-&gt;buffer[ y * bitmap-&gt;pitch];
<br/>
      int x;
<br/>
<br/>
      printf( ",\n\t");
<br/>
<br/>
      for ( x = 0; x &lt; (bitmap-&gt;width + 7) / 8; x++) {
<br/>
   uint8_t bits = bitmap_row[x];
<br/>
<br/>
   if ( x != 0)
<br/>
     printf( ", ");
<br/>
<br/>
   printf( "0x%x", bits);
<br/>
      }
<br/>
    }
<br/>
    printf("\n");
<br/>
<br/>
<br/>
    printf( "};\n");
<br/>
<br/>
    printf( "static struct font_glyph\n");
<br/>
    printf( "%s_%d_font_glyph = {\n", font_name, char_num);
<br/>
    printf( "\t%s_%d_bitmap,\n", font_name, char_num);
<br/>
    printf( "\t%d, /* top */\n", top);
<br/>
    printf( "\t%d, /* left */\n", left);
<br/>
    printf( "\t%d /* advance */\n", metrics-&gt;horiAdvance &gt;&gt; 6);
<br/>
    printf( "};\n\n");
<br/>
  }
<br/>
}
<br/>
<br/>
<br/>
#define NUM_CHARS 128
<br/>
<br/>
<br/>
int
<br/>
main( int argc, char *argv[]) {
<br/>
  int pixel_size;
<br/>
  int max_top = 0;
<br/>
  FT_Error error;
<br/>
  FT_Library library;
<br/>
  FT_Face face;
<br/>
  int i;
<br/>
  int max_size = 0;
<br/>
<br/>
  char font_name[50];
<br/>
  char filename[200];
<br/>
  const char *post_name;
<br/>
<br/>
  if ( argc != 3) {
<br/>
    fprintf( stderr, "USAGE: %s &lt;font_file&gt; &lt;bitmap_height&gt;\n", argv[0]);
<br/>
    exit( EXIT_FAILURE);
<br/>
  }
<br/>
<br/>
  pixel_size = atoi( argv[2]);
<br/>
<br/>
  error = FT_Init_FreeType( &amp;library);
<br/>
<br/>
  if ( error) {
<br/>
    fprintf( stderr, "Failed to init freetype lib (%d)\n", error);
<br/>
    exit( EXIT_FAILURE);
<br/>
  }
<br/>
<br/>
  error = FT_New_Face( library, argv[1], 0, &amp;face);
<br/>
<br/>
  if ( error) {
<br/>
    fprintf( stderr, "Failed to create face (%d) from font file %s\n",
<br/>
        error, argv[1]);
<br/>
    FT_Done_FreeType( library);
<br/>
    exit( EXIT_FAILURE);
<br/>
  }
<br/>
<br/>
  error = FT_Set_Pixel_Sizes( face, 0, pixel_size);
<br/>
  if ( error) {
<br/>
    fprintf( stderr, "Failed (%d) to set pixel size to %d\n",
<br/>
        error, pixel_size);
<br/>
    FT_Done_FreeType( library);
<br/>
    exit( EXIT_FAILURE);
<br/>
  }
<br/>
<br/>
  post_name = FT_Get_Postscript_Name( face);
<br/>
  for ( i = 0; i &lt; strlen(post_name); i++) {
<br/>
    font_name[i] = toupper( post_name[i]);
<br/>
  }
<br/>
  font_name[i] = '\0';
<br/>
<br/>
  fprintf( stderr, "Dumping font file \"%s\" as %d bitmap characters\n",
<br/>
      argv[1], pixel_size);
<br/>
  fprintf( stderr, "Face name is \"%s\"\n", post_name);
<br/>
<br/>
<br/>
  printf("#ifndef _FONT_%s_%d_H_\n", font_name, pixel_size);
<br/>
  printf("#define _FONT_%s_%d_H_ 1\n\n", font_name, pixel_size);
<br/>
<br/>
  FT_Int major, minor, patch;
<br/>
  FT_Library_Version( library, &amp;major, &amp;minor, &amp;patch);
<br/>
<br/>
  printf("/*\n");
<br/>
  printf(" * Bitmap font create from font %s character size %d\n", post_name, pixel_size);
<br/>
  printf(" * created using %s using FreeType library %d.%d.%d\n", argv[0], major, minor, patch);
<br/>
  printf(" */\n\n");
<br/>
<br/>
  printf("#include \"font_structs.h\"\n\n");
<br/>
<br/>
  /*
<br/>
   * Load and render the glyph
<br/>
   */
<br/>
  for ( i = 0; i &lt; NUM_CHARS; i++) {
<br/>
    error = FT_Load_Char( face, i,
<br/>
           FT_LOAD_RENDER | FT_LOAD_TARGET_MONO);
<br/>
<br/>
    if ( error) {
<br/>
      if ( isprint( i)) {
<br/>
   fprintf( stderr, "Failed (%d) to load character '%c' (%d)\n",
<br/>
       error, (char)i, i);
<br/>
      }
<br/>
      else {
<br/>
   fprintf( stderr, "Failed (%d) to load character %d\n",
<br/>
       error, i);
<br/>
      }
<br/>
      //FT_Done_FreeType( library);
<br/>
      //exit( EXIT_FAILURE);
<br/>
    }
<br/>
    else {
<br/>
      /* dump the bitmap */
<br/>
      dump_bitmap( i, post_name, &amp;face-&gt;glyph-&gt;bitmap, &amp;face-&gt;glyph-&gt;metrics,
<br/>
                   face-&gt;glyph-&gt;bitmap_left, face-&gt;glyph-&gt;bitmap_top);
<br/>
<br/>
      if ( face-&gt;glyph-&gt;bitmap_top &gt; max_top) {
<br/>
        max_top = face-&gt;glyph-&gt;bitmap_top;
<br/>
      }
<br/>
      if ( face-&gt;glyph-&gt;bitmap.rows &gt; max_size) {
<br/>
        max_size = face-&gt;glyph-&gt;bitmap.rows;
<br/>
      }
<br/>
    }
<br/>
  }
<br/>
<br/>
  /*
<br/>
   * collect all the glyphs together in an array
<br/>
   */
<br/>
  printf("static struct font_glyph *\n");
<br/>
  printf("font_%s_%d_glyphs[%d] = {\n",
<br/>
    post_name, pixel_size, NUM_CHARS);
<br/>
  for ( i = 0; i &lt; NUM_CHARS; i++) {
<br/>
    if ( i != 0)
<br/>
      printf(",\n");
<br/>
<br/>
    printf("\t&amp;%s_%d_font_glyph", post_name, i);
<br/>
  }
<br/>
  printf("\n};\n\n");
<br/>
<br/>
  /*
<br/>
   * Create the font structure
<br/>
   */
<br/>
  printf( "struct bitmap_font\n");
<br/>
  printf( "font_%s_%d = {\n", post_name, pixel_size);
<br/>
  printf( "\t/* font glyphs */\n");
<br/>
  printf( "\tfont_%s_%d_glyphs,\n", post_name, pixel_size);
<br/>
  printf( "\t/* requested glyph size */\n");
<br/>
  printf( "\t%d,\n", pixel_size);
<br/>
  printf( "\t/* actual glyph size */\n");
<br/>
  printf( "\t%d,\n", max_size);
<br/>
  printf( "\t/* number of glyphs in font */\n");
<br/>
  printf( "\t%d,\n", NUM_CHARS);
<br/>
  printf( "\t/* the max top value in font */\n");
<br/>
  printf( "\t%d\n", max_top);
<br/>
  printf("};\n\n");
<br/>
<br/>
<br/>
  printf("\n#endif /* End of _FONT_%s_%d_H_ */\n", font_name, pixel_size);
<br/>
<br/>
  FT_Done_FreeType( library);
<br/>
}</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#134233 - sgeos - Wed Jul 11, 2007 8:51 pm</h4>
    <div class="postbody"><span class="postbody">k14.bdf is a nice bitmap Japanese font.  Google: k14.bdf and you should find it eventually.  I suspect that it lives somewhere on all *nix distributions, but I could be wrong.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
