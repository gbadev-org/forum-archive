<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Keeping binary data in ROM - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Keeping binary data in ROM</h2>
<div id="posts">
<div class="post">
    <h4>#141753 - conejoroy - Sat Sep 29, 2007 9:44 am</h4>
    <div class="postbody"><span class="postbody">Hello all ^.^
<br/>
<br/>
I've a simple question: how do I tell the compiler/linker that some binary data (like unsigned char data[] = { 0x01, 0x02, 0x82, etc... }) 
<br/>
should be kept in ROM; that is, not loaded into RAM with the whole program?
<br/>
<br/>
Furthermore, can I access that pointer directly in my program? 
<br/>
I mean unsigned char a = data[1]; or maybe copy some part to RAM like this:
<br/>
<br/>
unsigned char* ram_p = new unsigned char[4];
<br/>
memcpy (ram_p, data, 4)
<br/>
<br/>
I know it sounds soo newbie =S but i'll really appreciate any help...
<br/>
<br/>
<br/>
PS: I saw the example makefile uses bin2o.. but it doesn't do what I want, am I right ._.?
<br/>
<br/>
Thanks =)!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141755 - keldon - Sat Sep 29, 2007 10:46 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">unsigned char data[] = { 0x01, 0x02, 0x82, etc... }</td> </tr></table><span class="postbody">
<br/>
You can access that array directly in your program.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141758 - M3d10n - Sat Sep 29, 2007 1:25 pm</h4>
    <div class="postbody"><span class="postbody">For SLOT-1 devices: you can't. At least not in the way you want. The whole ARM9 binary is loaded into RAM, so such array would be loaded too. You need to use libFAT and load your binary data from an external file stored on the card's filesystem.
<br/>
(That's how commercial games do it, BTW).
<br/>
<br/>
With SLOT-2 you still have direct access to whatever data is appended to the ROM, so it's possible to do it that way, but you should avoid that if you want compatibility with SLOT-1.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141765 - Peter - Sat Sep 29, 2007 3:59 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>conejoroy wrote:</b></span></td> </tr> <tr> <td class="quote">I've a simple question: how do I tell the compiler/linker that some binary data (like unsigned char data[] = { 0x01, 0x02, 0x82, etc... }) 
<br/>
should be kept in ROM; that is, not loaded into RAM with the whole program?</td> </tr></table><span class="postbody">
<br/>
I guess it's not possible, because the NDS does not have ROM. The way to go is probably to store it into a file.<br/>_________________<br/>Kind Regards,
<br/>
Peter</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141810 - conejoroy - Sun Sep 30, 2007 11:42 am</h4>
    <div class="postbody"><span class="postbody">Thanks everyone for the replies ^^
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>M3d10n wrote:</b></span></td> </tr> <tr> <td class="quote">For SLOT-1 devices: you can't. At least not in the way you want. The whole ARM9 binary is loaded into RAM, so such array would be loaded too. You need to use libFAT and load your binary data from an external file stored on the card's filesystem.
<br/>
(That's how commercial games do it, BTW).</td> </tr></table><span class="postbody">
<br/>
<br/>
So the official SDK also has a filesystem to retrieve files? by how much it differs from libFAT? I mean... libFAT is a standard way to do this (maybe an improvement using rw capacity on flash cards?) or just a workaround to a "propietary" filesystem? that filesystem also has "files" stored everywhere on the cartridge ROM? or an official game, by means of that filesystem, embeds everything on a single .nds? 
<br/>
<br/>
(that reminds me of some old DOS games; they stored datafiles way beyond the end of the .exe itself; reading read-only data by opening the very same .exe... commercial games more or less do the same or I'm very wrong?)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>M3d10n wrote:</b></span></td> </tr> <tr> <td class="quote">With SLOT-2 you still have direct access to whatever data is appended to the ROM, so it's possible to do it that way, but you should avoid that if you want compatibility with SLOT-1.</td> </tr></table><span class="postbody">
<br/>
<br/>
Yes, I've R4DS, so SLOT-2 is out of the question.
<br/>
<br/>
Thanks again =)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141825 - tepples - Sun Sep 30, 2007 4:10 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>conejoroy wrote:</b></span></td> </tr> <tr> <td class="quote">So the official SDK also has a filesystem to retrieve files?</td> </tr></table><span class="postbody">
<br/>
Yes. It's been called several names: <a class="postlink" href="http://nocash.emubase.de/gbatek.htm#dscartridgenitroromfilesystem" target="_blank">NitroROM</a>, NitroFAT, NitroFS, etc. after "Nitro" which is the name for the official DS development kit.
<br/>
<br/>
Point of terminology: I don't really like the name "NitroFAT" anymore. What GBATEK calls its "FAT" is more like an inode table than it is like the linked chain of cluster numbers used by Microsoft's FAT file system.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">by how much it differs from libFAT?</td> </tr></table><span class="postbody">
<br/>
NitroFS is read-only for most of the cart and read-write for a single file of fixed size (that is, the EEPROM).
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I mean... libFAT is a standard way to do this (maybe an improvement using rw capacity on flash cards?)</td> </tr></table><span class="postbody">
<br/>
Chishm's <a class="postlink" href="http://chishm.drunkencoders.com/libfat/" target="_blank">libfat</a> is the library that allows fopen() and friends to work on an ordinary FAT or FAT32 file system on a CF or SD card.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">or an official game, by means of that filesystem, embeds everything on a single .nds?</td> </tr></table><span class="postbody">
<br/>
A .nds file is like a .iso file: it contains a boot sector (the ARM9 and ARM7 binaries) and a set of files for a program to read. Homebrew .nds files and DS Download Play demos just have the "boot sector" with no files.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">(that reminds me of some old DOS games; they stored datafiles way beyond the end of the .exe itself; reading read-only data by opening the very same .exe... commercial games more or less do the same or I'm very wrong?)</td> </tr></table><span class="postbody">
<br/>
You'd be correct. I made a <a class="postlink" href="http://www.pineight.com/gba/#gbfs" target="_blank">tool for appending an asset archive to a GBA program</a> several years ago, and it still works on a DS with some SLOT-2 cards (such as SuperCard and M3).
<br/>
<br/>
One reason that more DS homebrew doesn't work this way is that nobody has figured out how the SLOT-1 and SLOT-2 cards' .nds loaders pass argv[0] to the program. This means that .nds files generally have to either hardcode the path in the .nds, search the entire card for the assets every time they run, or search once and overwrite part of the .nds. It's rumored that wintermute <span style="font-style: italic">might</span> be working on a more robust argv[0] for devkitARM R21.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Yes, I've R4DS, so SLOT-2 is out of the question.</td> </tr></table><span class="postbody">
<br/>
If you have a microSD adapter in SLOT-1, such as R4 or GnM, then libfat is the best option.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142026 - conejoroy - Wed Oct 03, 2007 10:51 am</h4>
    <div class="postbody"><span class="postbody">Thanks tepples, I'll use libfat =)
<br/>
<br/>
Just one more question... is it possible to develop and test a program that uses libfat on an emulator? or shoud I use gbfs instead while the program is in development or testing?
<br/>
<br/>
Thanks again =)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142028 - tepples - Wed Oct 03, 2007 11:47 am</h4>
    <div class="postbody"><span class="postbody">FCSR is libfat's answer to GBFS and should work on any emulator or SLOT-2 card that supports ds.gba (PassMe format) files.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142031 - alekmaul - Wed Oct 03, 2007 2:59 pm</h4>
    <div class="postbody"><span class="postbody">EFS-LIB can be a good try for such things too with SLOT-1 devices :)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
