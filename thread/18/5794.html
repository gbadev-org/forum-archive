<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>IPC_PEN_DOWN question - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > IPC_PEN_DOWN question</h2>
<div id="posts">
<div class="post">
    <h4>#43356 - Mr Snowflake - Sun May 22, 2005 6:49 pm</h4>
    <div class="postbody"><span class="postbody">Why is this working:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">     
<br/>
   if(!(IPC-&gt;buttons &amp; IPC_PEN_DOWN))
<br/>
         consolePrintf("Touched!    ");
<br/>
      else
<br/>
         consolePrintf("Not touched!");
<br/>
</td> </tr></table><span class="postbody">
<br/>
I expected it to work like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   if(IPC-&gt;buttons &amp; IPC_PEN_DOWN)
<br/>
         consolePrintf("Touched!    ");
<br/>
      else
<br/>
         consolePrintf("Not touched!");</td> </tr></table><span class="postbody">
<br/>
Which would be more natural!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#43357 - Mollusk - Sun May 22, 2005 7:27 pm</h4>
    <div class="postbody"><span class="postbody">Maybe it should be PEN_UP then...
<br/>
<br/>
IF you look at the ndstech, for the keys, it says </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Each key normally reads as 1, becomming zero when depressed</td> </tr></table><span class="postbody">
<br/>
<br/>
(<a class="postlink" href="http://www.bottledlight.com/ds/index.php/Misc/KeyInput" target="_blank">http://www.bottledlight.com/ds/index.php/Misc/KeyInput</a>)
<br/>
<br/>
So that's just how the DS works...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#43364 - Darkain - Sun May 22, 2005 8:00 pm</h4>
    <div class="postbody"><span class="postbody">this is how the GBA always worked for key presses..  it was a natural move to the DS.  (as i always say, i should code demos for the GBA before DS, as the GBA is much more well documented)<br/>_________________<br/>-=- Darkain Dragoon -=-
<br/>
<a class="postlink" href="http://www.darkain.com" target="_blank">http://www.darkain.com</a>
<br/>
<a class="postlink" href="http://ds.darkain.com/hack" target="_blank">DarkStar</a> for <a class="postlink" href="http://ds.darkain.com" target="_blank">Nintendo DS</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#43368 - Maverick - Sun May 22, 2005 8:12 pm</h4>
    <div class="postbody"><span class="postbody">The reason is, on the GBA the KEYS register was defined as:
<br/>
<br/>
#define KEYS *(u16*)0x04000130
<br/>
<br/>
The register was full of 1's and the bits turned to 0's when a key was pressed.
<br/>
<br/>
This can be therefor reversed by defining it as:
<br/>
<br/>
#define KEYS ~(*(u16*)0x04000130)
<br/>
<br/>
This is the same on the DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#43369 - Darkain - Sun May 22, 2005 8:19 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Maverick wrote:</b></span></td> </tr> <tr> <td class="quote">The reason is, on the GBA the KEYS register was defined as:
<br/>
<br/>
#define KEYS *(u16*)0x04000130
<br/>
<br/>
The register was full of 1's and the bits turned to 0's when a key was pressed.
<br/>
<br/>
This can be therefor reversed by defining it as:
<br/>
<br/>
#define KEYS ~(*(u16*)0x04000130)
<br/>
<br/>
This is the same on the DS.</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
A) you want 
<br/>
#define KEYS (~(*(u16*)0x04000130))
<br/>
not
<br/>
#define KEYS ~(*(u16*)0x04000130)
<br/>
<br/>
B) doing this adds an additional step every time you read key presses... while this may not seem important now, some people ARE speed freaks and dont like having the extra 2 or 3 ASM instructiosn to test for key presses. ;)  plus, its common to compare it against a previous key settting from last poll, so you would need to test one normal and one inverse anyways, so it makes no difference
<br/>
if ( (lastState &amp; KEY_SELECT) &amp;&amp; (!(inputState &amp; KEY_SELECT)) ) {<br/>_________________<br/>-=- Darkain Dragoon -=-
<br/>
<a class="postlink" href="http://www.darkain.com" target="_blank">http://www.darkain.com</a>
<br/>
<a class="postlink" href="http://ds.darkain.com/hack" target="_blank">DarkStar</a> for <a class="postlink" href="http://ds.darkain.com" target="_blank">Nintendo DS</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#43376 - Mr Snowflake - Sun May 22, 2005 9:23 pm</h4>
    <div class="postbody"><span class="postbody">That explains :) I understand now :) Ty you all</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
