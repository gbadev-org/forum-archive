<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>text on mode 5? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > text on mode 5?</h2>
<div id="posts">
<div class="post">
    <h4>#168891 - iainprice - Mon Jun 01, 2009 7:56 pm</h4>
    <div class="postbody"><span class="postbody">Can you draw text over an image on a screen?
<br/>
<br/>
I am using mode 5:
<br/>
videoSetModeSub(MODE_5_2D);
<br/>
<br/>
Do I need similar to this:
<br/>
consoleInit(0, 1, BgType_Text4bpp, BgSize_T_256x256, 31, 0, 0, 0);
<br/>
<br/>
as:
<br/>
consoleDemoInit();
<br/>
<br/>
is not happy
<br/>
<br/>
which settings do I need please?
<br/>
<br/>
Thanks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168916 - SteveH - Tue Jun 02, 2009 2:20 pm</h4>
    <div class="postbody"><span class="postbody">What type of text are you after?
<br/>
<br/>
As my graphical console replacement was wrote using MODE_5_2D to test everything.
<br/>
<br/>
If your only after putting up simple scores, etc then you can role your own text ourput code, or use one of the two consoles available (mine, or the one that comes with libnds).
<br/>
<br/>
Out of the 3 options I think the best one would be to use mine, mind you it uses a 16-bit bitmap (at the moment), and background 3 (I think its possible to change the order the backgrounds are drawn).  The reason I'm saying this is that you can use a custom font (some are provided) and there is a font editor available but it's for DOS16 (wrote in pascal), I've got a bmp2bmf converter wrote, but it needs a couple of minor issues fixed before I release it as it's rather limited at the moment.
<br/>
<br/>
My post on the forums is <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=16678" target="_blank">here </a>and you can visit my blog for more information / screen shots <a class="postlink" href="http://www.stevensprogsite.co.uk/blog/" target="_blank">here</a>
<br/>
<br/>
Edit - I forgot to actually answer your question:
<br/>
And according to the libnds docs what you have put is nearly correct:
<br/>
<br/>
consoleInit(NULL, 1, BgType_Text4bpp, BgSize_T_256x256, 31, 0, false, false); // Assuming your using the sub screen.
<br/>
<br/>
Just make sure that your map base and tile base are set to the correct values so that you don't overwrite any of your screen.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168948 - iainprice - Thu Jun 04, 2009 7:43 pm</h4>
    <div class="postbody"><span class="postbody">Am still having issues... I hate layers and memory blocks.....
<br/>
<br/>
<br/>
vramSetBankA(VRAM_A_TEXTURE);
<br/>
vramSetBankB(VRAM_B_TEXTURE_SLOT1);
<br/>
vramSetBankC(VRAM_C_SUB_BG);
<br/>
vramSetBankD(VRAM_D_TEXTURE_SLOT2);
<br/>
vramSetBankE(VRAM_E_MAIN_BG);
<br/>
vramSetBankF(VRAM_F_MAIN_SPRITE);
<br/>
videoSetMode(MODE_5_2D | MODE_0_3D);
<br/>
videoSetModeSub(MODE_5_2D);
<br/>
consoleInit(NULL, 1, BgType_Text8bpp, BgSize_T_256x256, 31, 0, false, false);
<br/>
//layer, type, size, offset, 0forbmp 1fortile
<br/>
bg3  = bgInit(3, BgType_Bmp8, BgSize_B8_256x256, 0,0);
<br/>
bg2s = bgInitSub(2, BgType_Bmp8, BgSize_B8_256x256, 3,0);
<br/>
bg3s = bgInitSub(3, BgType_Bmp8, BgSize_B8_256x256, 6,0);
<br/>
printf("Test");
<br/>
bgSetPriority(bg0s, 3);
<br/>
bgSetPriority(bg1s, 2);
<br/>
bgSetPriority(bg2s, 1);
<br/>
bgSetPriority(bg3s, 0);
<br/>
<br/>
<br/>
any ideas? how do i shuffle things?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168955 - SteveH - Fri Jun 05, 2009 12:03 pm</h4>
    <div class="postbody"><span class="postbody">Err I don't think you can mix MODE_5_2D &amp; MODE_0_3D... as they give different output options - you can only have MODE_X_2D or MODE_x_3D AFAIK...
<br/>
<br/>
And that's as far as my 3D knowledge goes XD</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168956 - sverx - Fri Jun 05, 2009 2:06 pm</h4>
    <div class="postbody"><span class="postbody">right! I didn't notice that
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">videoSetMode(MODE_5_2D | MODE_0_3D);</td> </tr></table><span class="postbody">
<br/>
before... maybe you meant to
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">videoSetMode(MODE_5_3D);</td> </tr></table><span class="postbody">
<br/>
?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168959 - iainprice - Fri Jun 05, 2009 5:30 pm</h4>
    <div class="postbody"><span class="postbody">The 2d and 3d means I can have srites on a 3d screen, anyway, the main screen works fine, it's the sub screen where I want to display a graphic and then use a font over the top, either custom or standard, don't mind....
<br/>
<br/>
Any suggetsions for layers/memory to make sub screen work?
<br/>
<br/>
Thanks</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168983 - sverx - Mon Jun 08, 2009 9:09 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>iainprice wrote:</b></span></td> </tr> <tr> <td class="quote">Any suggetsions for layers/memory to make sub screen work?</td> </tr></table><span class="postbody">
<br/>
<br/>
128 KB (VRAM bank C) should be enough for console output and a 256x256 8 bit BMP... maybe you're just assigning wrong offsets... check 'where' the consoleInit locates the maps and the tiles in the VRAM.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#169028 - iainprice - Tue Jun 09, 2009 10:50 pm</h4>
    <div class="postbody"><span class="postbody">Can anyone just give me a snippet that displays an image on the bottom screen in mode 5 and then puts console text over top? I'll piece it togther into mine later :) Thanks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#169216 - iainprice - Tue Jun 23, 2009 9:23 pm</h4>
    <div class="postbody"><span class="postbody">Still having problems....
<br/>
<br/>
image displayed.
<br/>
<br/>
text displayed.
<br/>
<br/>
band of rubbish across screen about 2/3 way down and some palette corruption.... any ideas?
<br/>
<br/>
[code]
<br/>
vramSetBankA(VRAM_A_TEXTURE);
<br/>
vramSetBankB(VRAM_B_TEXTURE_SLOT1);
<br/>
vramSetBankC(VRAM_C_SUB_BG);
<br/>
vramSetBankD(VRAM_D_TEXTURE_SLOT2);
<br/>
vramSetBankE(VRAM_E_MAIN_BG);
<br/>
vramSetBankF(VRAM_F_MAIN_SPRITE);
<br/>
vramSetBankG(VRAM_G_LCD);
<br/>
videoSetMode(MODE_5_2D | MODE_0_3D);
<br/>
videoSetModeSub(MODE_5_2D);
<br/>
bg3  = bgInit(3, BgType_Bmp8, BgSize_B8_256x256, 0,0);
<br/>
bg2s = bgInitSub(2, BgType_Bmp8, BgSize_B8_256x256, 3,0);
<br/>
bg3s = bgInitSub(3, BgType_Bmp8, BgSize_B8_256x256, 6,0);
<br/>
<br/>
dmaCopy(titleBitmap, bgGetGfxPtr(bg3),  256*192);
<br/>
dmaCopy(mainmenuBitmap, bgGetGfxPtr(bg3s), 256*192);
<br/>
<br/>
consoleInit(0,1, BgType_Text4bpp, BgSize_T_256x256, 31,0, false, true);
<br/>
[/code]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#169217 - SteveH - Tue Jun 23, 2009 9:26 pm</h4>
    <div class="postbody"><span class="postbody">That band of rubbish is the console's tile set - I take it it's a blue-ish lines approx 3-4 pixels in height?
<br/>
<br/>
You just need to move the console map and tile base around, I can not give the exact numbers to use as it will be different for each user.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#169218 - iainprice - Tue Jun 23, 2009 9:59 pm</h4>
    <div class="postbody"><span class="postbody">Do you mean 0x60000 etc on the vram?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#169219 - SteveH - Tue Jun 23, 2009 10:36 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>iainprice wrote:</b></span></td> </tr> <tr> <td class="quote">Do you mean 0x60000 etc on the vram?</td> </tr></table><span class="postbody">
<br/>
<br/>
No I mean that you will have to play around with the 31,0 in the following line:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
consoleInit(0,1, BgType_Text4bpp, BgSize_T_256x256, 31,0, false, true);</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#169220 - iainprice - Tue Jun 23, 2009 10:54 pm</h4>
    <div class="postbody"><span class="postbody">Thanks, will try......</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#169470 - silent_code - Tue Jul 14, 2009 3:37 pm</h4>
    <div class="postbody"><span class="postbody">I don't know whether or not this is still an issue, so I'll try to help anyway. :^)
<br/>
<br/>
This is the console setup I use in the currently unreleased version of my VSD (you can download an older version from my web page):
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">PrintConsole *pConsole = consoleInit(NULL, 0, BgType_Text8bpp, BgSize_T_256x256, 0, 1, false, false);</td> </tr></table><span class="postbody">
<br/>
<br/>
I use a custom font, so you will have to flip the appropriate flag in that call.
<br/>
<br/>
This is the background configuration I use to display regular 8x8 8bpp (the default font is 4bpp color, don't forget to set that in the console and background setup) color text in front of an 8bpp color image, with VRAM bank C assigned to the sub-engine's backgrounds (nothing fancy):
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">videoSetModeSub(MODE_5_2D);
<br/>
<br/>
bgs0id = bgInitSub(0, BgType_Text8bpp, BgSize_T_256x256, 0, 1);
<br/>
<br/>
bgs3id = bgInitSub(3, BgType_Bmp8, BgSize_B8_256x256, 2, 0);</td> </tr></table><span class="postbody">
<br/>
<br/>
If you do not need access to BG0 via the identifier, you don't need to set it up, the console initialization should do it for you.
<br/>
<br/>
I hope that helps.
<br/>
<br/>
Regards,
<br/>
<br/>
Rob
<br/>
<br/>
<br/>
PS: Even though the last VSD release was meant to be the final one, I am preparing a new one with a few fixes, some new features and most importantly, compatibility with the new libnds and toolchain. I should be able to release it this week, as all I'm doing now is to clean up the code and reorganize it slightly.<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
