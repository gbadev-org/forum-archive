<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>How to control content of color palettes - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > How to control content of color palettes</h2>
<div id="posts">
<div class="post">
    <h4>#171446 - MichaelMossman - Thu Nov 19, 2009 8:14 pm</h4>
    <div class="postbody"><span class="postbody">There's a lot of help about how to choose and select 16-colour palettes but I can't find any reference about how to control exactly what goes into each palette.
<br/>
<br/>
Are these pre-determined ? If so, how do I choose the selection I want ?
<br/>
<br/>
Or are they able to be defined by program ? If so, how ?
<br/>
<br/>
Finally, on this subject, what is the actual format of each palette  (i.e How do I know which colour is in which slot ? ).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171449 - Drovor - Thu Nov 19, 2009 9:02 pm</h4>
    <div class="postbody"><span class="postbody">I think its just an area of memory that you need to initialize.  This is a snippet which sets a palette that I got <a class="postlink" href="http://forums.devkitpro.org/viewtopic.php?f=6&amp;t=1359" target="_blank">here</a>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   videoSetModeSub(MODE_5_2D);
<br/>
   vramSetBankH(VRAM_H_SUB_BG);
<br/>
   vramSetBankI(VRAM_I_SUB_BG_0x06208000);
<br/>
   int SubPtr = bgInitSub(2, BgType_Bmp8, BgSize_B8_256x256, 0, 0);
<br/>
   for(int i=0; i &lt; 256; i++)
<br/>
   {
<br/>
      BG_PALETTE_SUB[i] = RGB15(i &amp; 0x1F, i &amp; 0x1F, i &amp; 0x1F);
<br/>
   }
<br/>
   u16 *SubData = bgGetGfxPtr(SubPtr);
<br/>
   for(int y=0; y &lt; 128; y++)
<br/>
   {
<br/>
      for(int x=0; x &lt; 192 / 2; x++)
<br/>
         SubData[x + y * 192 / 2] = ((x * 2) &amp; 0xFF) | (((x * 2 + 1) &lt;&lt; 8) &amp; 0xFF00);
<br/>
   } </td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171450 - Dwedit - Thu Nov 19, 2009 9:06 pm</h4>
    <div class="postbody"><span class="postbody">There are standard palettes, and extended palettes.  I'll just be talking about standard palettes here.
<br/>
<br/>
There are four 256 color palettes, first one for backgrounds, then one for sprites, then another background and sprite palette for the secondary screen.  Each entry in the palette is 15-bit rgb (like xBBBBBGGGGGRRRRR).  The most significant bit is not used in the palette.  You can also think of it as Red, Green, and Blue being in the range of 0-31, and the formula for a color is Blue*1024 + Green*32 + Red.
<br/>
<br/>
The standard palette for background is located in memory at address 0x05000000, and the sprite palette is 512 bytes later.  Add 1024 to an address to get the palette for the secondary screen.
<br/>
<br/>
LibNDS defines the arrays BG_PALETTE, BG_PALETTE_SUB, SPRITE_PALETTE, and SPRITE_PALETTE_SUB for your convenience, as well as macros to calculate RGB values.  So you'd just use code like BG_PALETTE[4] = RGB15(15,31,4);<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171455 - headspin - Fri Nov 20, 2009 2:06 am</h4>
    <div class="postbody"><span class="postbody">If you use grit to convert graphics you can just dmaCopy() the generated palette to VRAM.
<br/>
<br/>
Eg.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">dmaCopy(MyImagePal, BG_PALETTE, MyImagePalLen);</td> </tr></table><span class="postbody"><br/>_________________<br/><a class="postlink" href="http://headsoft.com.au/index.php?category=warhawk" target="_blank">Warhawk DS</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=mmll" target="_blank">Manic Miner: The Lost Levels</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=tdg" target="_blank">The Detective Game</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171459 - sverx - Fri Nov 20, 2009 10:20 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>MichaelMossman wrote:</b></span></td> </tr> <tr> <td class="quote">There's a lot of help about how to choose and select 16-colour palettes but I can't find any reference about how to control exactly what goes into each palette.</td> </tr></table><span class="postbody">
<br/>
<br/>
If you use 16 colors tiled background and/or 16 colors sprites, then you should know that you'll be using only the first 16 colors of each palette (BG, SPRITE, SUB_BG, SUB_SPRITE) if you do not set the extended palette flag(s) when setting the video mode.
<br/>
<br/>
But if you want to use more palettes, you do set these flags and these arrays will be 16 palettes of 16 colors each, and you'll choose which palette to use for a sprite, for instance, with ATTR2_PALETTE(n).
<br/>
<br/>
I'm not sure about BGs, I think all of them will share the same 16 palettes, in contrast of the 16x256 colors palettes PER BG that you get using additional VRAM banks.
<br/>
<br/>
(sorry for my bad English in this post, sometimes it's really hard for me to explain properly...)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171460 - Dwedit - Fri Nov 20, 2009 7:48 pm</h4>
    <div class="postbody"><span class="postbody">Um, what?  You don't need extended palettes to select which 16 color palette a BG tile or sprite uses.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171490 - sverx - Mon Nov 23, 2009 12:43 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dwedit wrote:</b></span></td> </tr> <tr> <td class="quote">Um, what?  You don't need extended palettes to select which 16 color palette a BG tile or sprite uses.</td> </tr></table><span class="postbody">
<br/>
<br/>
Oh... you mean I don't need to activate them (the flag in the video mode) or you just mean I don't need to allocate a VRAM bank?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171493 - SteveH - Mon Nov 23, 2009 1:21 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sverx wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dwedit wrote:</b></span></td> </tr> <tr> <td class="quote">Um, what?  You don't need extended palettes to select which 16 color palette a BG tile or sprite uses.</td> </tr></table><span class="postbody">
<br/>
<br/>
Oh... you mean I don't need to activate them (the flag in the video mode) or you just mean I don't need to allocate a VRAM bank?</span></td> </tr></table><span class="postbody">
<br/>
<br/>
sverx if your using 16 colour spites or backgrounds then you have 16 palettes using the standard 256 palette tables.
<br/>
<br/>
For tiles, the top 4 bits of the u16 decides what palette to use
<br/>
For sprites IIRC there's an option for the palette number (0-15).
<br/>
<br/>
Palette 0 is 0-15 of the palette table
<br/>
Palette 1 is 16-31 of the palette table
<br/>
Palette 2 is 32-48 of the palette table
<br/>
...
<br/>
Palette 15 is 240-255 of the palette table
<br/>
<br/>
So you don't need to use extended palettes (they are good for using multiple 256 colour palettes mind you) or even set them up in the BG control registers.  Which also free's up those VRAM banks for other uses...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171495 - sverx - Mon Nov 23, 2009 4:00 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>SteveH wrote:</b></span></td> </tr> <tr> <td class="quote">So you don't need to use extended palettes (they are good for using multiple 256 colour palettes mind you) or even set them up in the BG control registers.  Which also free's up those VRAM banks for other uses...</td> </tr></table><span class="postbody">
<br/>
<br/>
Oh, I see now... I thought I had to set the corresponding bits anyway, just like when using 256 color palettes, even if I knew I wouldn't have to allocate any VRAM bank for 16 bits extended palettes.
<br/>
<br/>
Thanks for that clarification :)
<br/>
<br/>
[it'll be using those very same 16 palettes for all the 4 BGs, right?]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171504 - SteveH - Mon Nov 23, 2009 8:45 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sverx wrote:</b></span></td> </tr> <tr> <td class="quote">[it'll be using those very same 16 palettes for all the 4 BGs, right?]</td> </tr></table><span class="postbody">
<br/>
<br/>
Yes I believe that is the case</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
