<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>libnds Install Script for Linux - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > libnds Install Script for Linux</h2>
<div id="posts">
<div class="post">
    <h4>#169934 - RyanFox - Sun Aug 16, 2009 8:04 am</h4>
    <div class="postbody"><span class="postbody"><span style="font-weight: bold">The latest version of this script can be found at <a class="postlink" href="http://www.eng.uwaterloo.ca/~rcfox/dokuwiki/doku.php?id=devkitarm_libnds_installer_for_linux_osx" target="_blank">here</a>.</span>
<br/>
<br/>
Hey guys,
<br/>
I'm not sure if anyone's already done this (a quick search revealed nothing), but I wrote myself an install script for libnds, devkitARM, etc.
<br/>
<br/>
When it's run, it will check Sourceforge for the latest files, download them, install into the proper directory structure (under the current directory) and then add lines to ~/.bashrc to set up the environment variables.
<br/>
<br/>
I've only tested this on my own computer, so I make no guarantees for it.
<br/>
<br/>
Edit: Apparently, I didn't test well enough, as I just found a bug. Now it should work. :)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#!/usr/bin/perl
<br/>
use strict;
<br/>
use warnings;
<br/>
use LWP::Simple;
<br/>
use List::Util qw(maxstr);
<br/>
use Date::Manip;
<br/>
<br/>
my $arch = `uname -m`; chomp($arch);
<br/>
my $os = "linux";
<br/>
<br/>
my $pages_base = "http://sourceforge.net/projects/devkitpro/files";
<br/>
my $download_base = "http://downloads.sourceforge.net/project/devkitpro";
<br/>
<br/>
my @pages =
<br/>
(
<br/>
 "devkitARM",
<br/>
 "libnds",
<br/>
 "default%20arm7",
<br/>
 "maxmod",
<br/>
 "dswifi",
<br/>
 "libfat",
<br/>
 "filesystem",
<br/>
 "examples_%20nds",
<br/>
);
<br/>
<br/>
print "Downloading the latest Nintendo DS development tool chain files...\n\n";
<br/>
<br/>
foreach my $page (@pages)
<br/>
{
<br/>
    my %options;
<br/>
    my $page_data;
<br/>
<br/>
    # If we don't get the page, try again twice more.
<br/>
    for(my $i = 0; $i &lt; 3; ++$i)
<br/>
    {
<br/>
        $page_data = get("$pages_base/$page");
<br/>
        if ($page_data)
<br/>
        {
<br/>
            last;
<br/>
        }
<br/>
    }
<br/>
    if (!$page_data)
<br/>
    {
<br/>
        print "Failed 3 attempts to access $pages_base/$page.\n";
<br/>
    }
<br/>
<br/>
    my @content = split(/\n/,$page_data);
<br/>
    
<br/>
    foreach(@content)
<br/>
    {
<br/>
        if (/title="\/(.*($arch)?.*($os)?.*tar.*):\s* released on (.*)"/ &amp;&amp; !/src/ &amp;&amp; !/gba/ &amp;&amp; !/ogc/)
<br/>
        {
<br/>
            my $key = ParseDate($4);
<br/>
            my $val = $1;
<br/>
<br/>
            # Replace spaces to work properly in the URL.
<br/>
            $val =~ s/ /%20/g;
<br/>
<br/>
            $options{$key} = $val;
<br/>
        }
<br/>
    }
<br/>
<br/>
    `wget -c -nc $download_base/$options{maxstr(keys %options)}`;
<br/>
}
<br/>
<br/>
my $current_dir = `pwd`; chomp($current_dir);
<br/>
<br/>
print "Extracting downloaded archives...\n";
<br/>
<br/>
print `tar -xvjf devkitARM*.tar.bz2`;
<br/>
<br/>
mkdir "libnds";
<br/>
chdir "libnds";
<br/>
<br/>
my @files = ("libnds", "libfat", "dswifi", "maxmod", "default_arm7", "libfilesystem");
<br/>
foreach(@files)
<br/>
{
<br/>
    print `tar -xvjf ../$_*.tar.bz2`;
<br/>
}
<br/>
<br/>
chdir "..";
<br/>
mkdir "examples";
<br/>
chdir "examples";
<br/>
mkdir "ds";
<br/>
chdir "ds";
<br/>
print `tar -xvjf ../../nds-examples*.tar.bz2`;
<br/>
<br/>
`echo "export DEVKITPRO=$current_dir" &gt;&gt; ~/.bashrc`;
<br/>
`echo "export DEVKITARM=\\\$DEVKITPRO/devkitARM" &gt;&gt; ~/.bashrc`;
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"><br/><br/>Last edited by RyanFox on Thu Sep 10, 2009 4:01 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#169939 - gauauu - Sun Aug 16, 2009 10:21 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for posting that.  I always forget to grab default_arm7 and get annoyed when I try to set it all up under linux.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#169961 - zazery - Wed Aug 19, 2009 1:20 am</h4>
    <div class="postbody"><span class="postbody">I've been manually downloading and building everything from source. Next time I need to install or update I will certainly try this script. Thanks for sharing.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#170019 - wintermute - Sat Aug 22, 2009 12:54 pm</h4>
    <div class="postbody"><span class="postbody">Interesting.
<br/>
<br/>
I have been trying to put together a universal installer that works on linux/OSX/win but it's going pretty slowly. Your script looks like it might be helpful in the meantime.
<br/>
<br/>
You might want to try parsing <a href="http://devkitpro.sourceforge.net/devkitProUpdate.ini" target="_blank">http://devkitpro.sourceforge.net/devkitProUpdate.ini</a> instead of scraping the SF pages - we did that with the original installer to obtain a list of mirrors but SF kept reworking the pages and breaking the code.
<br/>
<br/>
The toolchain archives are uploaded as devkitARM-&lt;version&gt;-&lt;OS&gt;.tar.bz2
<br/>
<br/>
devkitARM_r26-i686-linux.tar.bz2
<br/>
devkitARM_r26-osx.tar.bz2
<br/>
devkitARM_r26-x86_64-linux.tar.bz2
<br/>
<br/>
you should be able to detect host OS, parse the devkitARM version from the ini file &amp; then build an appropriate filename. OSX has perl installed by default but not wget, you can use curl there though. The windows installer also deletes the devkitARM folder on updates to avoid cruft from the old toolchains building up in there.
<br/>
<br/>
If you're willing then I'd be happy to upload an updated script as an official interim method of installing on linux/OSX.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#170051 - RyanFox - Mon Aug 24, 2009 9:53 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for the suggestions. I hadn't considered treating the architecture as part of the OS. That would make it easier to add in the OSX part. I also wasn't sure of how to detect if the user was running OSX. uname says "Linux" on Linux, but apparently for some OSX users, it says "Darwin"? That seemed like something that might change between versions, and I couldn't find anything definitive, so I just left it out.
<br/>
<br/>
Also, that INI file you linked to would be very useful. I was having a hard time trying to figure out how to treat the version numbers until I saw that there was a part in the HTML that included the date. I agree that scraping the HTML isn't the best way of doing it, but it was the only way I could find.
<br/>
<br/>
The use of wget and tar could be replaced with libraries written entirely in Perl (I was sort of being lazy by using system calls when I wrote the script), and then all of the dependencies could be packaged together (using <a class="postlink" href="http://search.cpan.org/~autrijus/PAR-0.85_01/script/pp" target="_blank">pp</a>) with a Perl interpreter so that it looks like a single executable. That way, the same code could be used across each platform. You would still need to make the individual packages on the respective platforms though.
<br/>
<br/>
I chose to leave the downloaded archives so that if you run the script again, it will a) not re-download the files if they haven't changed; and b) continue downloading the files if they were interrupted. There are other ways of doing these, but again, I was lazy. :P
<br/>
<br/>
By all means, feel free to use this script on the main website. I'm happy to contribute.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#170056 - RyanFox - Tue Aug 25, 2009 4:49 am</h4>
    <div class="postbody"><span class="postbody">New version!
<br/>
<br/>
This will now check the <a class="postlink" href="http://devkitpro.sourceforge.net/devkitProUpdate.ini" target="_blank">devkitProUpdate.ini</a> file for file information, rather than scraping the Sourceforge pages, and removes the dependencies on wget and tar (and bash).
<br/>
<br/>
It should also be friendly with OSX and Windows, but I can't test them at the moment.
<br/>
<br/>
There is a way to programatically add environment variables in Windows, but it involves adding to the registry, so I haven't had a chance to play with that. All of the necessary information is in comments there though, if anyone wants to fill in that gap.
<br/>
<br/>
I'm also going to see about getting some packages for those who don't want to get the script's dependencies themselves.
<br/>
<br/>
In the meantime, if you need to install a dependency, you should be able to do it by running these commands on the command line:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">cpan Config::INI::Reader
<br/>
cpan Archive::Tar</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#!/usr/bin/perl
<br/>
use strict;
<br/>
use warnings;
<br/>
use Cwd;
<br/>
use LWP::Simple;
<br/>
use Config::INI::Reader;
<br/>
use Archive::Tar;
<br/>
<br/>
# Used to figure out which files to get, based on the user's OS
<br/>
my $original_extension = '.exe';
<br/>
my $new_extension = '.tar.bz2';
<br/>
my $os = lc($^O);
<br/>
if ($os eq 'linux')
<br/>
{
<br/>
    my $arch = `uname -m`; chomp($arch);
<br/>
    $os = $arch.'-'.$os;
<br/>
}
<br/>
elsif ($os eq 'darwin')
<br/>
{
<br/>
    $os = 'osx';
<br/>
}
<br/>
elsif ($os eq 'mswin32' || $os eq 'cygwin')
<br/>
{
<br/>
    $os = 'win32';
<br/>
    $new_extension = '.exe';
<br/>
}
<br/>
else
<br/>
{
<br/>
    die "There are no libnds binaries available for your operating system.\n";
<br/>
}
<br/>
<br/>
# Parse the INI file into a hash
<br/>
my $ini = get('http://devkitpro.sourceforge.net/devkitProUpdate.ini') or die "Unable to access the devkitPro website.\n";
<br/>
$ini =~ s/win32/$os/g;
<br/>
$ini =~ s/$original_extension/$new_extension/g;
<br/>
my %ini_hash = %{Config::INI::Reader-&gt;read_string($ini)};
<br/>
<br/>
# Files to download for NDS development
<br/>
# Note: The script currently depends on devkitARM and ndsexamples being first and second in this array.
<br/>
my @files =
<br/>
    (
<br/>
     'devkitARM',
<br/>
     'ndsexamples',
<br/>
     'libnds',
<br/>
     'libndsfat',
<br/>
     'maxmodds',
<br/>
     'dswifi',
<br/>
     'defaultarm7',
<br/>
     'filesystem',
<br/>
    );
<br/>
<br/>
# Base URL for all files
<br/>
my $download_base = $ini_hash{devkitProUpdate}{URL};
<br/>
<br/>
# Download each file
<br/>
foreach(@files)
<br/>
{
<br/>
    print "Downloading $_ v$ini_hash{$_}{Version}...\n";
<br/>
    my $file = $ini_hash{$_}{File};
<br/>
    my $url = "$download_base/$file";
<br/>
    mirror($url,$file) or die $!;
<br/>
}
<br/>
<br/>
my $f;
<br/>
<br/>
# Extract devkitARM into its own directory
<br/>
$f = $ini_hash{shift(@files)}{File};
<br/>
print "Extracting $f...\n";
<br/>
Archive::Tar-&gt;extract_archive("$f",1);
<br/>
<br/>
# Extract the examples into their own directory
<br/>
mkdir 'examples';
<br/>
chdir 'examples';
<br/>
mkdir 'ds';
<br/>
chdir 'ds';
<br/>
$f = $ini_hash{shift(@files)}{File};
<br/>
print "Extracting $f...\n";
<br/>
Archive::Tar-&gt;extract_archive("../../$f",1);
<br/>
chdir '../..';
<br/>
<br/>
# Extract all of the libraries under the 'libnds' directory
<br/>
# devkitARM and ndsexamples have been removed from this array by the shift() function.
<br/>
mkdir 'libnds';
<br/>
chdir 'libnds';
<br/>
foreach(@files)
<br/>
{
<br/>
    $f = $ini_hash{$_}{File};
<br/>
    print "Extracting $f...\n";
<br/>
    Archive::Tar-&gt;extract_archive("../$f",1);
<br/>
}
<br/>
chdir '..';
<br/>
<br/>
# Either set up the user's environment variables, or tell him to do so.
<br/>
my $current_dir = getcwd;
<br/>
if ($os eq 'win32' &amp;&amp; 0) # The &amp;&amp; 0 part will cause this to fail, until I figure out the registry stuff.
<br/>
{
<br/>
# Add DEVKITPRO and DEVKITARM environment variables to the registry, using the module found here:
<br/>
# http://search.cpan.org/perldoc?Win32::TieRegistry
<br/>
# The values go in HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Session Manager\Environment
<br/>
# From http://msdn.microsoft.com/en-us/library/ms682653%28VS.85%29.aspx
<br/>
# (Ew, MSDN. I feel dirty!)
<br/>
}
<br/>
elsif ($ENV{SHELL} =~ /bash/)
<br/>
{
<br/>
    my $home = $ENV{HOME};
<br/>
    
<br/>
    print "\nAdding environment variables to $home/.bashrc:\n";
<br/>
    print "  export DEVKITPRO=$current_dir\n";
<br/>
    print "  export DEVKITARM=\$DEVKITPRO/devkitARM\n";
<br/>
<br/>
    open my $bashrc, "&gt;&gt;$home/.bashrc" or die $!;
<br/>
    print $bashrc "export DEVKITPRO=$current_dir\n";
<br/>
    print $bashrc "export DEVKITARM=\$DEVKITPRO/devkitARM\n";
<br/>
    close $bashrc;
<br/>
}
<br/>
else
<br/>
{
<br/>
    print "\nPlease set up the following environment variables for your shell:\n";
<br/>
    print "  DEVKITPRO=$current_dir\n";
<br/>
    print "  DEVKITARM=\$DEVKITPRO/devkitARM\n";
<br/>
}</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#170215 - shadowghost21 - Tue Sep 08, 2009 10:12 pm</h4>
    <div class="postbody"><span class="postbody">I most appreciate this script! From what I can see from the compiled and <span style="font-style: italic">correctly</span> installed chain, I see that missed one small thing, compiling the arm7 binary. Oops. This thing works like a charm, again thank for all the work!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#170230 - RyanFox - Thu Sep 10, 2009 3:59 am</h4>
    <div class="postbody"><span class="postbody">FYI, I've made a page for the script here: <a class="postlink" href="http://www.eng.uwaterloo.ca/~rcfox/dokuwiki/doku.php?id=devkitarm_libnds_installer_for_linux_osx" target="_blank">http://www.eng.uwaterloo.ca/~rcfox/dokuwiki/doku.php?id=devkitarm_libnds_installer_for_linux_osx</a>
<br/>
<br/>
It will always have my latest version of the script, since it's linking to the file in SVN.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
