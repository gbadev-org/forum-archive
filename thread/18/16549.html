<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Dinamic linking in whatever way the DS can... - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Dinamic linking in whatever way the DS can...</h2>
<div id="posts">
<div class="post">
    <h4>#167629 - Emmanuel - Sat Mar 21, 2009 1:36 am</h4>
    <div class="postbody"><span class="postbody">In C++...
<br/>
<br/>
So, I have my homebrew project... and code is all placed on RAM at startup... normally, with 4mb this is not much of an issue... but I want to add hundreds of characters as different as I can make them, so, they will use different code...
<br/>
<br/>
Now, I think this is solved by DLL... the objects of each Character are linked at runtime, and so, I only use the RAM when they are called...
<br/>
<br/>
But, I've heard DLL doesn't work on the DS... I guess due to a lack of an OS...
<br/>
<br/>
So, I need a way to load into ram ONLY the code for the characters, stages, items, input types, etc... that I will use... Why? Because we have plans to add lots of them... as most as we can, and we can add more in 2gb than in 4mb....</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167630 - Dwedit - Sat Mar 21, 2009 1:46 am</h4>
    <div class="postbody"><span class="postbody">I think devkitarm allows you to use overlays, but only to a limited extent.  Although they can have the correct location in memory, There is no built-in way to have the overlays separate from the binary so that the RAM is free.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167631 - Emmanuel - Sat Mar 21, 2009 2:01 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dwedit wrote:</b></span></td> </tr> <tr> <td class="quote">I think devkitarm allows you to use overlays, but only to a limited extent.  Although they can have the correct location in memory, There is no built-in way to have the overlays separate from the binary so that the RAM is free.</td> </tr></table><span class="postbody">
<br/>
Overlays require that I know the size right? In that case... C++ would not be useful... I'd had to convert to ASM right? o_o
<br/>
<br/>
So, I divide the program in Overlays... of a size calculated by the largest object of that type...
<br/>
<br/>
So, it would be in my case:
<br/>
4 characters
<br/>
1 Stage
<br/>
X items at a time (unknown for now)
<br/>
3 inputTypes most (Owner, CPU, and External Human -Ds to Ds comm-
<br/>
<br/>
I would need to set the starting places in RAM for those overlays, and load from the file system into that address
<br/>
<br/>
Right?
<br/>
<br/>
But, at linking time, how do I make it so the linker "links" the code without it being actually linked into the code (epic confusion: so the code knows the functions exist)
<br/>
<br/>
One example: Hypothetical
<br/>
Loading for one character
<br/>
My overlay is at RAM 0
<br/>
I use a function to load the code into it... I guess through a pointer (can I even set a pointer manually? I know there's no OS to stop me though...)
<br/>
So, with an If I decide which file to load...
<br/>
<br/>
And then, how do I tell my source the GeneralCharacter object source is there?
<br/>
<br/>
How would calling the functions from there go?
<br/>
<br/>
*Using C++, and virtual functions for the cases where they are different*</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167632 - nanou - Sat Mar 21, 2009 2:07 am</h4>
    <div class="postbody"><span class="postbody">Whoa... do you really expect to exhaust 4MB with code? How complex is this character behavior? Surely there's going to be a lot of common code between them...<br/>_________________<br/>- nanou</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167633 - Emmanuel - Sat Mar 21, 2009 2:13 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>nanou wrote:</b></span></td> </tr> <tr> <td class="quote">Whoa... do you really expect to exhaust 4MB with code? How complex is this character behavior? Surely there's going to be a lot of common code between them...</td> </tr></table><span class="postbody">
<br/>
<br/>
It's a SSB clone for the DS... sure, they have common code, but the specials are different... and we would like to add 100+
<br/>
Stages are close to being completely the same though...
<br/>
Items are all different...
<br/>
<br/>
And, if I keep adding stuff, this will pop-up.... and changing later once everything is done is harder....</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167634 - nanou - Sat Mar 21, 2009 2:27 am</h4>
    <div class="postbody"><span class="postbody">Honestly I doubt that would take a significant amount of code in proportion to the engine. The engine should  handle all the physics, and the character-specific code is basically small scripts that deal with animations and character states and whatnot. The scripts should be fairly small (there was a discussion here a while ago about rolling your own interpreters for that kind of thing.) You can even treat them as data, and load them in separately with no fussing with overlays.<br/>_________________<br/>- nanou</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167635 - Emmanuel - Sat Mar 21, 2009 2:38 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>nanou wrote:</b></span></td> </tr> <tr> <td class="quote">The scripts should be fairly small (there was a discussion here a while ago about rolling your own interpreters for that kind of thing.) You can even treat them as data, and load them in separately with no fussing with overlays.</td> </tr></table><span class="postbody">
<br/>
Well... I think I'll have to go with interpreting... or just keep going... and hope for the best.... 
<br/>
<br/>
Btw, how does DSLinux is? Can it run a game especifically designed for it as a normal DS game? Can it DLL? :P I'm stubborn... and it does seem like the easiest alternative...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167637 - DiscoStew - Sat Mar 21, 2009 3:08 am</h4>
    <div class="postbody"><span class="postbody">Think you could give a few examples that you believe require different sets of code? It's just my belief that in practically all situations, a generalized set of code that can do different stuff with different sets of data is overall better than having individual sets of code for every little thing.<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167638 - Emmanuel - Sat Mar 21, 2009 3:32 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>DiscoStew wrote:</b></span></td> </tr> <tr> <td class="quote">Think you could give a few examples that you believe require different sets of code? It's just my belief that in practically all situations, a generalized set of code that can do different stuff with different sets of data is overall better than having individual sets of code for every little thing.</td> </tr></table><span class="postbody">
<br/>
Umm... so far... nope... maybe just the Special attacks, but even those are similar...
<br/>
<br/>
Sometimes I'm just a bit too greedy on resources</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167640 - DiscoStew - Sat Mar 21, 2009 3:53 am</h4>
    <div class="postbody"><span class="postbody">Heh, are you in that state of mind that you want to be prepared "if" things get a bit too different? :P<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167653 - hacker013 - Sat Mar 21, 2009 11:06 am</h4>
    <div class="postbody"><span class="postbody">You can try to use DSLI (DS Library Interface) made by elhobbs
<br/>
<br/>
<a href="http://forum.gbadev.org/viewtopic.php?t=16119&amp;postdays=0&amp;postorder=asc&amp;start=15" target="_blank">http://forum.gbadev.org/viewtopic.php?t=16119&amp;postdays=0&amp;postorder=asc&amp;start=15</a><br/>_________________<br/><a class="postlink" href="http://imetal.nl/" target="_blank">Website / Blog</a>
<br/>
<br/>
Let the nds be with you.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167674 - Emmanuel - Sat Mar 21, 2009 9:32 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>hacker013 wrote:</b></span></td> </tr> <tr> <td class="quote">You can try to use DSLI (DS Library Interface) made by elhobbs
<br/>
<br/>
<a href="http://forum.gbadev.org/viewtopic.php?t=16119&amp;postdays=0&amp;postorder=asc&amp;start=15" target="_blank">http://forum.gbadev.org/viewtopic.php?t=16119&amp;postdays=0&amp;postorder=asc&amp;start=15</a></td> </tr></table><span class="postbody">
<br/>
<br/>
It looks just like what I need... but... the file is no longer downloadable... too much time not being downloaded TT_TT
<br/>
Do you have a copy?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167689 - hacker013 - Sun Mar 22, 2009 11:55 am</h4>
    <div class="postbody"><span class="postbody">Yes, I have posted a mirror in the other topic. I hope you can use it.<br/>_________________<br/><a class="postlink" href="http://imetal.nl/" target="_blank">Website / Blog</a>
<br/>
<br/>
Let the nds be with you.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167719 - josath - Mon Mar 23, 2009 6:08 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Emmanuel wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>hacker013 wrote:</b></span></td> </tr> <tr> <td class="quote">You can try to use DSLI (DS Library Interface) made by elhobbs
<br/>
<br/>
<a href="http://forum.gbadev.org/viewtopic.php?t=16119&amp;postdays=0&amp;postorder=asc&amp;start=15" target="_blank">http://forum.gbadev.org/viewtopic.php?t=16119&amp;postdays=0&amp;postorder=asc&amp;start=15</a></td> </tr></table><span class="postbody">
<br/>
<br/>
It looks just like what I need... but... the file is no longer downloadable... too much time not being downloaded TT_TT
<br/>
Do you have a copy?</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Don't use this. It's the wrong solution for you. You'll just be wasting your time and so on.
<br/>
<br/>
I really doubt you'll get anywhere close to 4mb of code, the majority of your space will be used up by data. If you really need lots of super complex moves by all your characters, then the next best thing to use would be simple scripts, as mentioned above. Or perhaps build a custom data format that describes how moves work.  
<br/>
<br/>
As also mentioned before, if you find yourself repeating code over and over that is similar, but with small changes, then you should refactor that so it's not repeated, it will take up less space then.
<br/>
<br/>
But really, overlays, dynamic libraries, etc are just going to cause you a HUGE headache. 
<br/>
<br/>
PS: another think hacker013 forgot to mention, is that DLSI is GPL, meaning if you use it, you would be required to release all your code as GPL as well.
<br/>
<br/>
PPS: in general I wouldn't listen to hacker013 too much, he is too inexperienced to trust his advice in complex topics like this.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167720 - hacker013 - Mon Mar 23, 2009 6:53 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>josath wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
PS: another think hacker013 forgot to mention, is that DLSI is GPL, meaning if you use it, you would be required to release all your code as GPL as well.
<br/>
<br/>
PPS: in general I wouldn't listen to hacker013 too much, he is too inexperienced to trust his advice in complex topics like this.</td> </tr></table><span class="postbody">
<br/>
<br/>
I have added information about that on the download page -_-'' . And that second thingy, why do you think that?<br/>_________________<br/><a class="postlink" href="http://imetal.nl/" target="_blank">Website / Blog</a>
<br/>
<br/>
Let the nds be with you.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167722 - elhobbs - Mon Mar 23, 2009 7:57 pm</h4>
    <div class="postbody"><span class="postbody">dsli is most likely not the best solution for this problem - not to mention that the code that hacker013 sent you a link to has a serious flaw as I pointed out in the thread on the subject. in addition there is no native debugger support this type of code. while it is not impossible to debug it is quite difficult and time consuming.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167723 - hacker013 - Mon Mar 23, 2009 8:46 pm</h4>
    <div class="postbody"><span class="postbody">If many have problems with dynamic linking why has libnds then not a sort of dynamic linking support?<br/>_________________<br/><a class="postlink" href="http://imetal.nl/" target="_blank">Website / Blog</a>
<br/>
<br/>
Let the nds be with you.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167724 - elhobbs - Mon Mar 23, 2009 9:06 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>hacker013 wrote:</b></span></td> </tr> <tr> <td class="quote">If many have problems with dynamic linking why has libnds then not a sort of dynamic linking support?</td> </tr></table><span class="postbody">has anyone made a strong case for why libnds should have this functionality? I have not seen anything compelling.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167725 - DiscoStew - Mon Mar 23, 2009 9:08 pm</h4>
    <div class="postbody"><span class="postbody">Just because some people have problems with it doesn't mean it's a necessary feature that should be looked into.
<br/>
<br/>
To be serious, I highly doubt that even companies developing DS applications would use it.<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167734 - elwing - Tue Mar 24, 2009 10:27 am</h4>
    <div class="postbody"><span class="postbody">the only use of dynamic linking would be for plugins... and/or mods for games... not really usefull seen the audience of DS homebrew... you're not writing the new half-life...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167736 - hacker013 - Tue Mar 24, 2009 3:15 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>elwing wrote:</b></span></td> </tr> <tr> <td class="quote">the only use of dynamic linking would be for plugins... and/or mods for games... not really usefull seen the audience of DS homebrew... you're not writing the new half-life...</td> </tr></table><span class="postbody">
<br/>
not yet ... :)<br/>_________________<br/><a class="postlink" href="http://imetal.nl/" target="_blank">Website / Blog</a>
<br/>
<br/>
Let the nds be with you.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167738 - Emmanuel - Tue Mar 24, 2009 10:34 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>elwing wrote:</b></span></td> </tr> <tr> <td class="quote">the only use of dynamic linking would be for plugins... and/or mods for games... not really usefull seen the audience of DS homebrew... you're not writing the new half-life...</td> </tr></table><span class="postbody">
<br/>
Umm... actually I was thinking on adding that sort of stuff :P
<br/>
<br/>
well... you are right... and, I don't feel like releasing source yet, so I won't use it...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167744 - elwing - Wed Mar 25, 2009 9:37 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Emmanuel wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>elwing wrote:</b></span></td> </tr> <tr> <td class="quote">the only use of dynamic linking would be for plugins... and/or mods for games... not really usefull seen the audience of DS homebrew... you're not writing the new half-life...</td> </tr></table><span class="postbody">
<br/>
Umm... actually I was thinking on adding that sort of stuff :P
<br/>
<br/>
well... you are right... and, I don't feel like releasing source yet, so I won't use it...</span></td> </tr></table><span class="postbody">
<br/>
<br/>
hehe, don't follow strictly my gloomy talks, feel free to implement a plugin system in whatever app you are making :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167747 - hacker013 - Wed Mar 25, 2009 4:22 pm</h4>
    <div class="postbody"><span class="postbody">And if you make a working one, maybe you can release that with a good license voor nds homebrewers.<br/>_________________<br/><a class="postlink" href="http://imetal.nl/" target="_blank">Website / Blog</a>
<br/>
<br/>
Let the nds be with you.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167753 - albinofrenchy - Thu Mar 26, 2009 4:28 am</h4>
    <div class="postbody"><span class="postbody">My two cents here: This is a radically different problem to solve than overlays. With most straight-up plugin architectures, you don't have to care about RAM usage so much. If we accept the 4mb limit, we simply could load a binary file of assembly, search it for entry points and save those memory addresses as functional pointers.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167770 - Lazy1 - Thu Mar 26, 2009 7:09 pm</h4>
    <div class="postbody"><span class="postbody">Why not compile scripts into bytecode and write a virtual machine to interpret the instructions?
<br/>
This way you could write the scripts and interpreter on the PC for proper debugging before porting anything over.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167771 - Dwedit - Thu Mar 26, 2009 8:19 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>albinofrenchy wrote:</b></span></td> </tr> <tr> <td class="quote">My two cents here: This is a radically different problem to solve than overlays. With most straight-up plugin architectures, you don't have to care about RAM usage so much. If we accept the 4mb limit, we simply could load a binary file of assembly, search it for entry points and save those memory addresses as functional pointers.</td> </tr></table><span class="postbody">
<br/>
<br/>
And also hope that the code is position independent.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167779 - albinofrenchy - Fri Mar 27, 2009 5:27 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dwedit wrote:</b></span></td> </tr> <tr> <td class="quote">And also hope that the code is position independent.</td> </tr></table><span class="postbody">
<br/>
<br/>
You mean, like in respect to having far vs short jumps? Can't think of any other issues. I don't think this would crop up really though; you'd compile the two things separately and setup everything as function pointers. Am I missing something?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167784 - elhobbs - Fri Mar 27, 2009 12:39 pm</h4>
    <div class="postbody"><span class="postbody">yes, I believe you need to something about the base address.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
