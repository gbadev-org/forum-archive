<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Filling the screen with one colour? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > Filling the screen with one colour?</h2>
<div id="posts">
<div class="post">
    <h4>#118445 - Kheldar - Tue Feb 13, 2007 3:10 pm</h4>
    <div class="postbody"><span class="postbody">I've just started writing code for the DS and am trying to make a rain effect for the hell of it. I've got rain working fine and now I want to add lightning as well.
<br/>
<br/>
I want to randomly decide if lightning should start, then quickly change the background colour from black through grey to white then back again. I've got the random chance done but my fillScreen() function it seems way to slow. It causes rain not to be drawn to random parts of the screen (I assume I'm talking too long in the Vblank to finish drawing?)
<br/>
<br/>
This is how I'm filling the screen with a colour:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void fillScreen()
<br/>
{
<br/>
   int i;
<br/>
<br/>
   for(i = 0; i &lt; 256 * 192; i++)
<br/>
   {
<br/>
      VRAM_A[i] = RGB15(0,0,0);
<br/>
   }
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
Is there a way I could just fill the whole of VRAM with one colour (like memset?) instead of doing it per pixel? Do I need double buffering?
<br/>
<br/>
Thankyou!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#118449 - Lick - Tue Feb 13, 2007 3:55 pm</h4>
    <div class="postbody"><span class="postbody">I think you can use the Master Brightness for this matter. BRIGHTNESS and SUB_BRIGHTNESS.
<br/>
<br/>
You can check out <a class="postlink" href="http://lickr.org/files/nds/lickfade2.zip" target="_blank">this demo</a> I wrote recently.<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#118451 - Sausage Boy - Tue Feb 13, 2007 4:01 pm</h4>
    <div class="postbody"><span class="postbody">If you have a background and vram to spare, you can just fill it once, hide it, and show it when you need to. A tiled background would be very suitable for this purpose.
<br/>
<br/>
I must admit that using the brightness stuff for this is much cooler, if it's an effect like that you want. But, I think It could get annoying if it happens all the time.<br/>_________________<br/>"no offense, but this is the gayest game ever"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#118469 - Mighty Max - Tue Feb 13, 2007 7:40 pm</h4>
    <div class="postbody"><span class="postbody">There is also a brightness in/decrease in the special color effect control.
<br/>
<br/>
This allows you to create black or white filled rectangles of any size in 4 register writes.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#118473 - tepples - Tue Feb 13, 2007 7:44 pm</h4>
    <div class="postbody"><span class="postbody">What kind of background are you using? You may be able to draw the sky by changing BG_PALETTE[0].<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#118555 - GrizzlyAdams - Wed Feb 14, 2007 6:05 am</h4>
    <div class="postbody"><span class="postbody">theres a function that should probably be in libnds:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#ifdef ARM9
<br/>
#define DMA_FILL(n) (*(vuint32*)(0x040000E0+(4*n)))
<br/>
 
<br/>
void dmaFill(uint8 channel, const void *Dest, u16 Value, uint32 Size) {
<br/>
   DMA_FILL(channel) = Value;
<br/>
   DMA_SRC(channel) = (uint32)&amp;DMA_FILL(channel);
<br/>
   DMA_DEST(channel) = (uint32)Dest;
<br/>
   DMA_CR(channel) = DMA_COPY_HALFWORDS | DMA_SRC_FIX | (Size&gt;&gt;1);
<br/>
   while(DMA_CR(channel) &amp; DMA_BUSY);
<br/>
}
<br/>
#else
<br/>
void dmaFill(uint8 channel, const void *Dest, u16 Value, uint32 Size) {
<br/>
   u16 Source = Value;
<br/>
   DMA_SRC(channel) = (uint32)&amp;Source;
<br/>
   DMA_DEST(channel) = (uint32)Dest;
<br/>
   DMA_CR(channel) = DMA_COPY_HALFWORDS | DMA_SRC_FIX | (Size&gt;&gt;1);
<br/>
   while(DMA_CR(channel) &amp; DMA_BUSY);
<br/>
}
<br/>
#endif
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I'm not 100% sure if this is correct or not. I've used the ARM7 version a few times and it seemed to work ok, but it turns out the cache will be involved if you use main ram for the fixed source. The DMA_FILL(n) is supposed to be used specifically for dma fills from the arm9 according to GBATEK.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#118562 - Mighty Max - Wed Feb 14, 2007 8:23 am</h4>
    <div class="postbody"><span class="postbody">It's just my humble opinion, but setting up DMA transfers and then just going into busy waiting on the CPU is a bit ... wasting.
<br/>
<br/>
A stm-loop should fill faster anyways.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#118622 - GrizzlyAdams - Wed Feb 14, 2007 9:10 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">It's just my humble opinion, but setting up DMA transfers and then just going into busy waiting on the CPU is a bit ... wasting.
<br/>
<br/>
A stm-loop should fill faster anyways.</td> </tr></table><span class="postbody">
<br/>
<br/>
Seeing as I've based this function on the DMA functions already in libnds, I'm the wrong person to tell.  I just added the fixed source address version.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
