<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>vram settings for BG_BMP8_1024x512 ? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > vram settings for BG_BMP8_1024x512 ?</h2>
<div id="posts">
<div class="post">
    <h4>#55874 - GPFerror - Mon Oct 03, 2005 5:41 pm</h4>
    <div class="postbody"><span class="postbody">what should my vramSetMainBanks be set to for BG_BMP8_1024x512 on main screen and consoleprinting on sub screen?
<br/>
<br/>
should this work ?  vramSetMainBanks(VRAM_A_MAIN_BG_0x6000000, VRAM_B_MAIN_BG_0x6020000, VRAM_C_SUB_BG , VRAM_D_LCD);
<br/>
<br/>
thanks,
<br/>
Troy(GPF)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#55883 - GPFerror - Mon Oct 03, 2005 7:32 pm</h4>
    <div class="postbody"><span class="postbody">ok found out on irc that 1024X512 requires 4 banks so i guess i use something like this
<br/>
<br/>
vramSetMainBanks(VRAM_A_MAIN_BG,VRAM_B_MAIN_BG,VRAM_C_MAIN_BG,VRAM_D_MAIN_BG);
<br/>
<br/>
but then I get no sub background for consoleprinting.
<br/>
<br/>
so if I do this
<br/>
	vramSetBankE(VRAM_H_SUB_BG);
<br/>
	vramSetBankF(VRAM_I_LCD);
<br/>
<br/>
how do I change my 
<br/>
<br/>
SUB_BG0_CR = BG_MAP_BASE(31);
<br/>
consoleInitDefault((u16*)SCREEN_BASE_BLOCK_SUB(31), (u16*)CHAR_BASE_BLOCK_SUB(0), 16);
<br/>
<br/>
so that it uses a different bank?
<br/>
<br/>
thanks</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#55989 - GPFerror - Wed Oct 05, 2005 6:32 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>GPFerror wrote:</b></span></td> </tr> <tr> <td class="quote">ok found out on irc that 1024X512 requires 4 banks so i guess i use something like this
<br/>
<br/>
vramSetMainBanks(VRAM_A_MAIN_BG,VRAM_B_MAIN_BG,VRAM_C_MAIN_BG,VRAM_D_MAIN_BG);
<br/>
<br/>
but then I get no sub background for consoleprinting.
<br/>
<br/>
so if I do this
<br/>
	vramSetBankE(VRAM_H_SUB_BG);
<br/>
	vramSetBankF(VRAM_I_LCD);
<br/>
<br/>
how do I change my 
<br/>
<br/>
SUB_BG0_CR = BG_MAP_BASE(31);
<br/>
consoleInitDefault((u16*)SCREEN_BASE_BLOCK_SUB(31), (u16*)CHAR_BASE_BLOCK_SUB(0), 16);
<br/>
<br/>
so that it uses a different bank?
<br/>
<br/>
thanks</td> </tr></table><span class="postbody">
<br/>
<br/>
ok I even tried this and its still not working for 1024X512
<br/>
<br/>
               vramSetMainBanks(VRAM_A_MAIN_BG, VRAM_B_MAIN_BG, VRAM_C_MAIN_BG, VRAM_D_MAIN_BG);
<br/>
	vramSetBankH(VRAM_H_SUB_BG);
<br/>
	vramSetBankI(VRAM_I_LCD);
<br/>
<br/>
SUB_BG0_CR = BG_MAP_BASE(8);
<br/>
consoleInitDefault((u16*)SCREEN_BASE_BLOCK_SUB(8), (u16*)CHAR_BASE_BLOCK_SUB(0), 16);
<br/>
<br/>
        BG3_CR = BG_BMP8_1024x512;
<br/>
        BG3_XDX = ((width / 256) &lt;&lt; 8) | (width % 256) ;
<br/>
        BG3_XDY = 0; 
<br/>
        BG3_YDX = 0;
<br/>
        BG3_YDY = ((height / 192) &lt;&lt; 8) | ((height % 192) + (height % 192) / 3) ;
<br/>
<br/>
and console printing is working again , but im just getting a black background on other screen.
<br/>
<br/>
Anyone here every use BG_BMP8_1024x512 successfully? can you post your setup code.
<br/>
<br/>
Thanks,
<br/>
Troy(GPF)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#56001 - pepsiman - Wed Oct 05, 2005 11:18 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>GPFerror wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
ok I even tried this and its still not working for 1024X512
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">BG3_CR = BG_BMP8_1024x512;</td> </tr></table><span class="postbody">
<br/>
im just getting a black background on other screen.
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
1024X512 needs mode 6.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">videoSetMode(6);</td> </tr></table><span class="postbody">
<br/>
Mode 6 uses BG2, not BG3.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">BG2_CR = BG_BMP8_1024x512;</td> </tr></table><span class="postbody">
<br/>
See <a href="http://dualis.1emulation.com/dsti.html" target="_blank">http://dualis.1emulation.com/dsti.html</a> for details.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#56057 - GPFerror - Wed Oct 05, 2005 8:34 pm</h4>
    <div class="postbody"><span class="postbody">ok thanks, pepsiman that fixed the black screen problem , but Im now running into an issue of where the screen is not being scaled correctly, the screen on the right half is black, and the left is overlapped by what should be on the right side. 
<br/>
<br/>
Here is my sample code that im using, with a 1024X512 bmp file of a nintendo ds converted to bin.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include &lt;nds.h&gt;
<br/>
#include &lt;nds/arm9/console.h&gt;
<br/>
#include &lt;stdio.h&gt; 
<br/>
#include "nintendo_ds_img_bin.h"
<br/>
#include "nintendo_ds_pal_bin.h"
<br/>
int main(void)
<br/>
{
<br/>
   powerON(POWER_ALL); 
<br/>
   videoSetMode(MODE_6_2D | DISPLAY_BG2_ACTIVE );
<br/>
<br/>
   videoSetModeSub(MODE_0_2D | DISPLAY_BG0_ACTIVE);
<br/>
<br/>
    vramSetMainBanks(VRAM_A_MAIN_BG,VRAM_B_MAIN_BG,VRAM_C_MAIN_BG,VRAM_D_MAIN_BG);
<br/>
   vramSetBankH(VRAM_H_SUB_BG);
<br/>
   vramSetBankI(VRAM_I_LCD); 
<br/>
<br/>
    SUB_BG0_CR = BG_MAP_BASE(8);
<br/>
<br/>
   BG_PALETTE_SUB[255] = RGB15(31,31,31);
<br/>
<br/>
   consoleInitDefault((u16*)SCREEN_BASE_BLOCK_SUB(8), (u16*)CHAR_BASE_BLOCK_SUB(0), 16);
<br/>
<br/>
   iprintf("\x1b[5;2H1024X512 8 bit color demo"); 
<br/>
<br/>
   BG2_CR = BG_BMP8_1024x512;
<br/>
<br/>
   int width=1024;
<br/>
   int  height=512;
<br/>
<br/>
        BG2_XDX = ((width / 256) &lt;&lt; 8) | (width % 256) ;
<br/>
        BG2_XDY = 0; 
<br/>
        BG2_YDX = 0;
<br/>
        BG2_YDY = ((height / 192) &lt;&lt; 8) | ((height % 192) + (height % 192) / 3) ;
<br/>
        BG2_CX = 0;
<br/>
        BG2_CY = 0; 
<br/>
<br/>
   lcdSwap();
<br/>
<br/>
   dmaCopy(nintendo_ds_img_bin, BG_GFX, 1024*512);
<br/>
   dmaCopy(nintendo_ds_pal_bin, BG_PALETTE, 256*2);
<br/>
<br/>
 while(1)swiWaitForVBlank(); 
<br/>
   return 0;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
<a href="http://gpf.dcemu.co.uk/files/ten24byfive12.jpg">[Images not permitted - Click here to view it]</a>
<br/>
<br/>
Same thing is happening on hardware too. Is the scaling code different for mode6?
<br/>
<br/>
if I use a diffent bmp thats 512X512 then it renders correctly but the right half of the screen is black also.
<br/>
<br/>
also if I switch it to use a bmp thats 512X1024 and switch the above code to this
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   BG2_CR = BG_BMP8_512x1024;
<br/>
   int height=1024;
<br/>
   int  width=512;</td> </tr></table><span class="postbody">
<br/>
<br/>
it renders correctly horizontally, but the bottom half of the screen is black.
<br/>
<br/>
thanks,
<br/>
Troy</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#56065 - GPFerror - Wed Oct 05, 2005 9:04 pm</h4>
    <div class="postbody"><span class="postbody">according to <a href="http://dualis.1emulation.com/dsti.html" target="_blank">http://dualis.1emulation.com/dsti.html</a>
<br/>
<br/>
libnds video.h has the defines backwards
<br/>
<br/>
#define BG_BMP8_1024x512 0
<br/>
#define BG_BMP8_512x1024 BIT(14)
<br/>
<br/>
should be
<br/>
<br/>
#define BG_BMP8_1024x512 BIT(14)
<br/>
#define BG_BMP8_512x1024 0
<br/>
<br/>
and that has fixed the above problem , so I can now render a 1024X512 8bit bmp.
<br/>
<br/>
thanks again.
<br/>
Troy</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
