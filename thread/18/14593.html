<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>3D Exporter for NDS? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > 3D Exporter for NDS?</h2>
<div id="posts">
<div class="post">
    <h4>#146095 - S7ARBVCK - Wed Nov 28, 2007 10:25 pm</h4>
    <div class="postbody"><span class="postbody">Hey, Folks,
<br/>
<br/>
I'm an old-skool (professional) GBA Coder, and I decided I'd like to get into NDS coding just as a hobby. Loads of really useful information here!
<br/>
<br/>
Anyway - my primary area of interest is in 3D on NDS. Has anyone written a converter for 3D files (particularly 3DS or MAX files) or an exporter for Max?
<br/>
<br/>
If not, how are you guys getting your models into your NDS games?
<br/>
<br/>
Thanks, in advance for any help!
<br/>
<br/>
SB</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146123 - M3d10n - Thu Nov 29, 2007 3:29 am</h4>
    <div class="postbody"><span class="postbody">At least two posters made converters which can generate DS display lists and are available for download. 
<br/>
<br/>
But it isn't that hard to load models on the DS. If you use immediate mode you can render theorically any file format you got the specs for. It's like drawing models in OpenGL. Using LibFAT you can open files using standard fopen/fread/fclose.
<br/>
<br/>
The display list thing is just a way to pack drawing commands into a buffer which can be DMA'ed into the graphics chip, saving a bit CPU time. Since it's just an array of 32-bit integers, you can conveniently store it in a file.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146193 - S7ARBVCK - Fri Nov 30, 2007 10:27 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>M3d10n wrote:</b></span></td> </tr> <tr> <td class="quote">At least two posters made converters which can generate DS display lists and are available for download. 
<br/>
<br/>
But it isn't that hard to load models on the DS. If you use immediate mode you can render theorically any file format you got the specs for. It's like drawing models in OpenGL. Using LibFAT you can open files using standard fopen/fread/fclose.
<br/>
<br/>
The display list thing is just a way to pack drawing commands into a buffer which can be DMA'ed into the graphics chip, saving a bit CPU time. Since it's just an array of 32-bit integers, you can conveniently store it in a file.</td> </tr></table><span class="postbody">
<br/>
<br/>
Thanks, man - that's a really useful reply! :) Pleased to see the DMA dumping of graphics data has carried across from GBA. 
<br/>
<br/>
My reason for asking about an exporter is for 3 reasons, though - 
<br/>
<br/>
1) There is a lot of unnecessary guff in 3D Model files (3DS is probably what I'd be using) which isn't needed when you have a closed system (the DS)
<br/>
2) Even though I have documentation on the 3DS Model file format, I'd have no idea how to generate the strips of quads I believe it's possible to do with the DS (understand the theory, don't really understand what describes a valid strip)
<br/>
3) I was planning to use Multi-Sub materials in 3DS Max to do my texturing - this is probably a lot more difficult if you don't have an exporter to handle the necessary conversion, as I understand that the NDS only supports one texture per model, right?
<br/>
<br/>
Anyway - thanks for the heads up about being able to use any format. Don't suppose you could point me in the direction of a) Some information about the construction of Draw Lists and b) where I might be able to find the downloadable exporters you speak of?
<br/>
<br/>
Thanks very much, so far! :)
<br/>
<br/>
SB</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146196 - kusma - Fri Nov 30, 2007 10:48 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>S7ARBVCK wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
3) I was planning to use Multi-Sub materials in 3DS Max to do my texturing - this is probably a lot more difficult if you don't have an exporter to handle the necessary conversion, as I understand that the NDS only supports one texture per model, right?
<br/>
</td> </tr></table><span class="postbody">
<br/>
Luckily, 3DS Max already have the render to texture support needed to make a baked material out of any complex one. It is better to use this directly because it allows more artist-control, yet is simple to use.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146326 - M3d10n - Sun Dec 02, 2007 8:51 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>S7ARBVCK wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
1) There is a lot of unnecessary guff in 3D Model files (3DS is probably what I'd be using) which isn't needed when you have a closed system (the DS)
<br/>
</td> </tr></table><span class="postbody">
<br/>
Instead of loading the 3DS files directly on the DS, you could write an offline tool that converts them into a binary format that is easier for you to render (as example, you could store the vertex coordinates in the correct fixed point format that way).
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>S7ARBVCK wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
2) Even though I have documentation on the 3DS Model file format, I'd have no idea how to generate the strips of quads I believe it's possible to do with the DS (understand the theory, don't really understand what describes a valid strip)</td> </tr></table><span class="postbody">
<br/>
Don't bother with strips (or even quad strips) before you get to draw triangles/quads first. I recommend you grab GLUT and do a small OpenGL app to render your model. You can then port the code the DS without much trouble and you'll have better debugging tools and a faster development cycle while coding it.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>S7ARBVCK wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
3) I was planning to use Multi-Sub materials in 3DS Max to do my texturing - this is probably a lot more difficult if you don't have an exporter to handle the necessary conversion, as I understand that the NDS only supports one texture per model, right?</td> </tr></table><span class="postbody">
<br/>
<br/>
I think you're confusing multiple materials with multitexturing. The first one means having different textures on different triangles. The 2nd one means having multiple, layered, textures on a single triangle.
<br/>
<br/>
The DS doesn't support multiple textures. But of course you can use different textures on different triangles: 
<br/>
- bind a texture
<br/>
- draw all polygons which use it
<br/>
- bind another texture
<br/>
- draw all polygons which use it
<br/>
- etc.
<br/>
<br/>
When loading/converting a model file, you do this by storing polygons in a different list for each material. Some people refer to that as a "primitive" (a bunch of polygons which shares the same material).
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>S7ARBVCK wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Anyway - thanks for the heads up about being able to use any format. Don't suppose you could point me in the direction of a) Some information about the construction of Draw Lists and b) where I might be able to find the downloadable exporters you speak of?</td> </tr></table><span class="postbody">
<br/>
<br/>
One of the LibNDS examples has a short make up of a display list. LibNDS has a bunch of macros for creating the display list data.
<br/>
<br/>
There is an display list exporter for Maya: <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=11828&amp;highlight=exporter" target="_blank">http://forum.gbadev.org/viewtopic.php?t=11828&amp;highlight=exporter</a>
<br/>
<br/>
This .X converter:
<br/>
<a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=5665&amp;highlight=exporter" target="_blank">http://forum.gbadev.org/viewtopic.php?t=5665&amp;highlight=exporter</a>
<br/>
<br/>
If you look for the original Maya Exporter thread you'll find lots of info on building the display lists. But basically, they are a list of 32-bit integers. 
<br/>
<br/>
The first item in the array is the list size (number of 32-bit ints in it) minus 1. This is used by the glCallList() command, to know how much data it must pass using the DMA.
<br/>
<br/>
Then you write 4 8-bit command IDs packed in a uint32 (they start with FIFO_ and there is a macro to convert nearly any GPU call into a command ID, look into the libnds display_list example), and write the data for each command (all packed in 32-bit ints)
<br/>
<br/>
Some commands need more data then others. As example, the data for a FIFO_TEX_COORD command is two 16-bit values (U and V) which are packed into a single 32-bit int (so it only uses 1 "slot" in the display list). But the FIFO_VERTEX16 command (vertex coordinate) needs 3 16-bit values, so X and Y are packed in an int and Z goes into another. Size the data must be 32-bits aligned, the Z component gets padded to fill 32-bits.
<br/>
<br/>
I wrote my own converter, which unfortunately I can't release (yet), which converts FBX files into my own mini-format (which uses display lists plus some header info, like texture names and etc). When converting I use a vector to accumulate the commands headers and data, and when the list is complete I write the size at its beginning.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
