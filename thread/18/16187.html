<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>crash on glTranslate* [SOLVED] - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > crash on glTranslate* [SOLVED]</h2>
<div id="posts">
<div class="post">
    <h4>#164429 - JYC376 - Sat Nov 01, 2008 7:09 am</h4>
    <div class="postbody"><span class="postbody">So my 3d game has this really strange bug  where if I try to call glTranslatef/glTranslate3f32 in a certain part of my code, it would freeze...Same goes with the glRotate* and glScale*
<br/>
<br/>
I know that I'm inside the 16-cube, and I'm not pushing too many matrices, because if I don't call any of those functions it won't crash.
<br/>
<br/>
...Anyone had the same problem?
<br/>
<br/>
If someone wants to check out the source: <a class="postlink" href="http://www.zshare.net/download/507345386db7c455/" target="_blank">n-echo_src-10-31-08.zip - 0.18MB</a>
<br/>
<br/>
EDIT: PUT THE APPS FOLDER AT ROOT AS WELL!
<br/>
<br/>
The offending function is draw_character in echo_gfx.cpp (line 185).  It should crash with the first glTranslatef (before drawing the square), but it will work with just the last glTranslatef (at the end of the function) or no translate at all.
<br/>
<br/>
????
<br/>
<br/>
Thanks.</span><span class="gensmall"><br/><br/>Last edited by JYC376 on Sun Nov 02, 2008 5:56 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#164445 - elhobbs - Sun Nov 02, 2008 12:04 am</h4>
    <div class="postbody"><span class="postbody">I did not have a problem with glTranslate but I did have problems with the menu drawing code in main.cpp on line 683 - here is the change I made</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">while(each_file &lt; files-&gt;num_files)//NUM_FILES_DISPLAYED)</td> </tr></table><span class="postbody">I also added </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">defaultExceptionHandler();</td> </tr></table><span class="postbody">to the main function. this dumps the registers on an exception - you can then use PC and LR and the map file to see where the exception occurs.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164448 - JYC376 - Sun Nov 02, 2008 5:57 am</h4>
    <div class="postbody"><span class="postbody">Thanks for solving that loader bug!
<br/>
<br/>
Anyways, this glTranslate bug ended up being from both Tinyxml and the amount of vertexes I was using...I have to cut the amount down then.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164452 - elhobbs - Sun Nov 02, 2008 5:06 pm</h4>
    <div class="postbody"><span class="postbody">I have never had the ds freeze from too many vertices. the rendering will get all screwy - skipping triangles and some other odd artifacts on the screen, but no freezing.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164453 - JYC376 - Sun Nov 02, 2008 6:39 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>elhobbs wrote:</b></span></td> </tr> <tr> <td class="quote">I have never had the ds freeze from too many vertices. the rendering will get all screwy - skipping triangles and some other odd artifacts on the screen, but no freezing.</td> </tr></table><span class="postbody">
<br/>
<br/>
Well, apparently I jammed it full...
<br/>
<br/>
Or I have a weird memory bug.  But it was solved when I stopped drawing so many vertexes</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164456 - silent_code - Sun Nov 02, 2008 8:33 pm</h4>
    <div class="postbody"><span class="postbody">I say it's a bug, not the hardware. I have ... well, "stressed" it many times and the only "reward" I got was 6 hz rendering (not from rendering, though - this is impossible, I guess... even in immediate mode rendering, I haven't reached below 30 hz, yet) and geometry disappearing, like it should.
<br/>
<br/>
No freezes - ever!
<br/>
<br/>
Fixing it by reducing the data set is probably an indicator for a memory management (or the lack of it, depending of the implementation) related bug.<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164493 - JYC376 - Tue Nov 04, 2008 4:13 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>silent_code wrote:</b></span></td> </tr> <tr> <td class="quote">I say it's a bug, not the hardware. I have ... well, "stressed" it many times and the only "reward" I got was 6 hz rendering (not from rendering, though - this is impossible, I guess... even in immediate mode rendering, I haven't reached below 30 hz, yet) and geometry disappearing, like it should.
<br/>
<br/>
No freezes - ever!
<br/>
<br/>
Fixing it by reducing the data set is probably an indicator for a memory management (or the lack of it, depending of the implementation) related bug.</td> </tr></table><span class="postbody">
<br/>
<br/>
As much as I hate to admit it, you're probably right.  Well, back to Valgrind =(.
<br/>
<br/>
TinyXml has also been acting strangely, with bad_alloc errors popping up...I'll probably switch to RapidXml</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164497 - kusma - Tue Nov 04, 2008 10:23 am</h4>
    <div class="postbody"><span class="postbody">sounds to me like you're dealing with good old memory starvation...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164512 - Cydrak - Tue Nov 04, 2008 10:17 pm</h4>
    <div class="postbody"><span class="postbody">I guess I'll chime in and say that heavy scenes are fine here, too.
<br/>
<br/>
It *is* possible to kill the GPU, though. What seems to do it is dangling vertices: having an "open" poly when you call glFlush(). After that it freezes hard, and future gl*() calls will wait forever (search GBAtek for SWAP_BUFFERS).
<br/>
<br/>
There are several ways to manage this--corrupt display lists, soft-booting the DS from an interrupt whilst drawing... I guess generic stack/memory bugs too. But with those you're likely to hang yourself anyway...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>JYC376 wrote:</b></span></td> </tr> <tr> <td class="quote">TinyXml has also been acting strangely, with bad_alloc errors popping up...I'll probably switch to RapidXml</td> </tr></table><span class="postbody">
<br/>
If you know you're within RAM limits, bad_alloc can be a sign of heap corruption. I've gotten that before. :/ (That, or it's just really bad fragmentation, since there is only 4MB, and with no virtual addressing, the data can't be moved.) 
<br/>
<br/>
Also, you may already know this, but watch out for your stack, it's slightly under 16K... any libraries that play fast and loose with local arrays could die all too easily. Reasonable recursion should be fine, so long as there aren't any large C++ locals/temporaries causing stack bloat...</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
