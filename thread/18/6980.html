<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Sleep mode - has anyone got it to work? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Sleep mode - has anyone got it to work?</h2>
<div id="posts">
<div class="post">
    <h4>#55240 - agentq - Mon Sep 26, 2005 10:25 pm</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
I'm trying to implement sleep mode when the lid is closed on the DS.  I've got it pretty much working, but it seems that if I leave the DS suspended for more than about 5 minutes, it's completely screwed up when it resumes.
<br/>
<br/>
Sometimes the screens are swapped, other times the sound just loops.  Sometimes it just resets, but not to the point where you can actually use it again.
<br/>
<br/>
If I close the lid and reopen it within a few seconds it suspends fine and seems ok.
<br/>
<br/>
I've looked at Moonshell, which I assumed used this feature, but it seems that it just turns the LCD backlights off, and doesn't suspend the CPUs.  I would imagine this would not extend the battery life all that much.
<br/>
<br/>
I've had a go at setting up a timer interrupt to wake things up every 30 secs and go to sleep again, but I can't get this to work, and don't know if I even need to!
<br/>
<br/>
Can anyone help me?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#55270 - josath - Tue Sep 27, 2005 7:27 am</h4>
    <div class="postbody"><span class="postbody">I would think turning off the backlights, as well as the screens  themselves (and otherstuff, see REG_POWER or whatever) would cut most battery usage. Then you can make the cpu sleep, by calling swiWaitForVblank or something, that shouldn't use up much cpu.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#55271 - agentq - Tue Sep 27, 2005 8:14 am</h4>
    <div class="postbody"><span class="postbody">That was my backup plan, but I'm not sure it would be as good as the real sleep mode.  Apparently the battery is meant to last for two weeks, which means it's got to be around 3% of the power during sleep compared to running.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#55275 - Fatnickc - Tue Sep 27, 2005 9:10 am</h4>
    <div class="postbody"><span class="postbody">Two weeks of 'average play'. The actual battery life is ~10 hours, but the two weeks figure comes out of how foten they think you're going to play for.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#55341 - TJ - Tue Sep 27, 2005 9:13 pm</h4>
    <div class="postbody"><span class="postbody">He means 2 weeks in sleep.
<br/>
<br/>
The DS is supposed to last 2 weeks in sleep mode (assuming fully charged battery and full sleep).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#55355 - agentq - Tue Sep 27, 2005 11:29 pm</h4>
    <div class="postbody"><span class="postbody">I've written a sleep mode which halts the ARM7 waiting on the lid open interrupt.  The ARM7 then signals to the ARM9 to wake up using the IPC.  The ARM9 wakes up each Vblank to check to see if it's been told to wake, then goes back to sleep.  I suppose the ARM9 could wait on an interrupt initiated by the ARM7 if I wanted rather than waking each frame.
<br/>
<br/>
The screens and sound amp are both off.
<br/>
<br/>
I'm going to leave it overnight and see if it survives.
<br/>
<br/>
EDIT: It survived fine.  No red light either, and my DS was about half charged.  I think.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
