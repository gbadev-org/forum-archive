<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>trouble compiling with libnds and devkitpro - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > trouble compiling with libnds and devkitpro</h2>
<div id="posts">
<div class="post">
    <h4>#126592 - yaazz - Wed Apr 25, 2007 1:35 am</h4>
    <div class="postbody"><span class="postbody">Hello all, I am new at your site, and am having trouble compiling with libnds. I use Kubuntu, and this is the output from the terminal
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
afreddin@afreddin-desktop:~/Manual/DSspace$ make
<br/>
Splash.bin
<br/>
bin2s /home/afreddin/Manual/DSspace/data/Splash.bin | arm-eabi-as -mthumb -mthumb-interwork -o Splash.o
<br/>
echo "extern const u8" `(echo Splash.bin | sed -e 's/^\([0-9]\)/_\1/' | tr . _)`"_end[];" &gt; `(echo Splash.bin | tr . _)`.h
<br/>
echo "extern const u8" `(echo Splash.bin | sed -e 's/^\([0-9]\)/_\1/' | tr . _)`"[];" &gt;&gt; `(echo Splash.bin | tr . _)`.h
<br/>
echo "extern const u32" `(echo Splash.bin | sed -e 's/^\([0-9]\)/_\1/' | tr . _)`_size";" &gt;&gt; `(echo Splash.bin | tr . _)`.h
<br/>
StarField.bin
<br/>
bin2s /home/afreddin/Manual/DSspace/data/StarField.bin | arm-eabi-as -mthumb -mthumb-interwork -o StarField.o
<br/>
echo "extern const u8" `(echo StarField.bin | sed -e 's/^\([0-9]\)/_\1/' | tr . _)`"_end[];" &gt; `(echo StarField.bin | tr . _)`.h
<br/>
echo "extern const u8" `(echo StarField.bin | sed -e 's/^\([0-9]\)/_\1/' | tr . _)`"[];" &gt;&gt; `(echo StarField.bin | tr . _)`.h
<br/>
echo "extern const u32" `(echo StarField.bin | sed -e 's/^\([0-9]\)/_\1/' | tr . _)`_size";" &gt;&gt; `(echo StarField.bin | tr . _)`.h
<br/>
linking DSspace.elf
<br/>
/home/afreddin/devkitpro/devkitARM/bin/../lib/gcc/arm-eabi/4.1.1/../../../../arm-eabi/lib/thumb/ds_arm9_crt0.o: In function `CIDLoop':
<br/>
ds_arm9_crt0.s:(.init+0x218): undefined reference to `main'
<br/>
collect2: ld returned 1 exit status
<br/>
make[1]: *** [/home/afreddin/Manual/DSspace/DSspace.elf] Error 1
<br/>
make: *** [build] Error 2
<br/>
afreddin@afreddin-desktop:~/Manual/DSspace$
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
As you can see, it ends when trying to link DSspace.elf, with DSspace being the name of the directory. Anyone know how to fix this? thanks</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#126594 - tepples - Wed Apr 25, 2007 2:03 am</h4>
    <div class="postbody"><span class="postbody">What .c files are inside the ARM9 source folder? Does any of them have a main() function?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#126604 - yaazz - Wed Apr 25, 2007 2:47 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
afreddin@afreddin-desktop:~/Manual/DSspace$ ls -l
<br/>
total 44
<br/>
drwxr-xr-x 2 afreddin afreddin 4096 2007-04-24 09:25 build
<br/>
drwxr-xr-x 2 afreddin afreddin 4096 2007-04-24 09:15 data
<br/>
drwxr-xr-x 2 afreddin afreddin 4096 2007-04-24 05:09 gfx
<br/>
-rw-r-xr-- 1 afreddin afreddin 1101 2007-04-24 09:17 main.cpp
<br/>
-rw-r-xr-- 1 afreddin afreddin 1097 2007-04-24 04:58 main.cpp~  *Backup
<br/>
-rw-r--r-- 1 afreddin afreddin 5147 2007-04-24 09:12 Makefile
<br/>
-rw-r--r-- 1 afreddin afreddin 5291 2006-09-23 19:16 Makefile~    *backup
<br/>
-rw-r--r-- 1 afreddin afreddin   98 2007-04-23 11:24 Splash_bin.h
<br/>
-rw-r--r-- 1 afreddin afreddin  107 2007-04-23 11:24 StarField_bin.h
<br/>
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#126605 - Lick - Wed Apr 25, 2007 2:56 am</h4>
    <div class="postbody"><span class="postbody">Could you post your Makefile?<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#126609 - yaazz - Wed Apr 25, 2007 3:12 am</h4>
    <div class="postbody"><span class="postbody">the makefile came from this tutorial 
<br/>
<a class="postlink" href="http://www.double.co.nz/nintendo_ds/nds_develop1.html" target="_blank">http://www.double.co.nz/nintendo_ds/nds_develop1.html</a>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
#---------------------------------------------------------------------------------
<br/>
.SUFFIXES:
<br/>
#---------------------------------------------------------------------------------
<br/>
<br/>
ifeq ($(strip $(DEVKITARM)),)
<br/>
$(error "Please set DEVKITARM in your environment. export DEVKITARM=&lt;path to&gt;devkitARM)
<br/>
endif
<br/>
<br/>
include $(DEVKITARM)/ds_rules
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# TARGET is the name of the output
<br/>
# BUILD is the directory where object files &amp; intermediate files will be placed
<br/>
# SOURCES is a list of directories containing source code
<br/>
# INCLUDES is a list of directories containing extra header files
<br/>
#---------------------------------------------------------------------------------
<br/>
TARGET		:=	$(shell basename $(CURDIR))
<br/>
BUILD		:=	build
<br/>
SOURCES		:=	gfx source data  
<br/>
INCLUDES	:=	include build
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# options for code generation
<br/>
#---------------------------------------------------------------------------------
<br/>
ARCH	:=	-mthumb -mthumb-interwork
<br/>
<br/>
# note: arm9tdmi isn't the correct CPU arch, but anything newer and LD
<br/>
# *insists* it has a FPU or VFP, and it won't take no for an answer!
<br/>
CFLAGS	:=	-g -Wall -O2\
<br/>
 			-mcpu=arm9tdmi -mtune=arm9tdmi -fomit-frame-pointer\
<br/>
			-ffast-math \
<br/>
			$(ARCH)
<br/>
<br/>
CFLAGS	+=	$(INCLUDE) -DARM9
<br/>
CXXFLAGS	:= $(CFLAGS) -fno-rtti -fno-exceptions
<br/>
<br/>
ASFLAGS	:=	-g $(ARCH)
<br/>
LDFLAGS	=	-specs=ds_arm9.specs -g $(ARCH) -mno-fpu -Wl,-Map,$(notdir $*.map)
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# any extra libraries we wish to link with the project
<br/>
#---------------------------------------------------------------------------------
<br/>
LIBS	:= -lnds9
<br/>
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# list of directories containing libraries, this must be the top level containing
<br/>
# include and lib
<br/>
#---------------------------------------------------------------------------------
<br/>
LIBDIRS	:=	$(LIBNDS)
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# no real need to edit anything past this point unless you need to add additional
<br/>
# rules for different file extensions
<br/>
#---------------------------------------------------------------------------------
<br/>
ifneq ($(BUILD),$(notdir $(CURDIR)))
<br/>
#---------------------------------------------------------------------------------
<br/>
<br/>
export OUTPUT	:=	$(CURDIR)/$(TARGET)
<br/>
<br/>
export VPATH	:=	$(foreach dir,$(SOURCES),$(CURDIR)/$(dir))
<br/>
export DEPSDIR	:=	$(CURDIR)/$(BUILD)
<br/>
<br/>
CFILES		:=	$(foreach dir,$(SOURCES),$(notdir $(wildcard $(dir)/*.c)))
<br/>
CPPFILES	:=	$(foreach dir,$(SOURCES),$(notdir $(wildcard $(dir)/*.cpp)))
<br/>
SFILES		:=	$(foreach dir,$(SOURCES),$(notdir $(wildcard $(dir)/*.s)))
<br/>
BINFILES	:=	$(foreach dir,$(SOURCES),$(notdir $(wildcard $(dir)/*.bin)))
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# use CXX for linking C++ projects, CC for standard C
<br/>
#---------------------------------------------------------------------------------
<br/>
ifeq ($(strip $(CPPFILES)),)
<br/>
#---------------------------------------------------------------------------------
<br/>
	export LD	:=	$(CC)
<br/>
#---------------------------------------------------------------------------------
<br/>
else
<br/>
#---------------------------------------------------------------------------------
<br/>
	export LD	:=	$(CXX)
<br/>
#---------------------------------------------------------------------------------
<br/>
endif
<br/>
#---------------------------------------------------------------------------------
<br/>
<br/>
export OFILES	:=	$(BINFILES:.bin=.o) \
<br/>
					$(CPPFILES:.cpp=.o) $(CFILES:.c=.o) $(SFILES:.s=.o)
<br/>
<br/>
export INCLUDE	:=	$(foreach dir,$(INCLUDES),-I$(CURDIR)/$(dir)) \
<br/>
					$(foreach dir,$(LIBDIRS),-I$(dir)/include) \
<br/>
					$(foreach dir,$(LIBDIRS),-I$(dir)/include) \
<br/>
					-I$(CURDIR)/$(BUILD)
<br/>
<br/>
export LIBPATHS	:=	$(foreach dir,$(LIBDIRS),-L$(dir)/lib)
<br/>
<br/>
.PHONY: $(BUILD) clean
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
$(BUILD):
<br/>
	@[ -d $@ ] || mkdir -p $@
<br/>
	@make --no-print-directory -C $(BUILD) -f $(CURDIR)/Makefile
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
clean:
<br/>
	@echo clean ...
<br/>
	@rm -fr $(BUILD) $(TARGET).elf $(TARGET).nds $(TARGET).arm9 $(TARGET).ds.gba 
<br/>
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
else
<br/>
<br/>
DEPENDS	:=	$(OFILES:.o=.d)
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# main targets
<br/>
#---------------------------------------------------------------------------------
<br/>
$(OUTPUT).nds	: 	$(OUTPUT).arm9
<br/>
$(OUTPUT).arm9	:	$(OUTPUT).elf
<br/>
$(OUTPUT).elf	:	$(OFILES)
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
%.o	:	%.bin
<br/>
#---------------------------------------------------------------------------------
<br/>
	@echo $(notdir $&lt;)
<br/>
	$(bin2o)
<br/>
<br/>
<br/>
-include $(DEPENDS)
<br/>
<br/>
#---------------------------------------------------------------------------------------
<br/>
endif
<br/>
#---------------------------------------------------------------------------------------
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#126617 - Lick - Wed Apr 25, 2007 3:26 am</h4>
    <div class="postbody"><span class="postbody">Try avoiding that tutorial, since it's really old and most of the time incompatible with the latest libraries.
<br/>
<br/>
Go <a class="postlink" href="http://sourceforge.net/project/showfiles.php?group_id=114505&amp;package_id=159894" target="_blank">here</a> and download the official examples. In the examples you will find template-projects, that you can copy and rename to your own project.
<br/>
<ul><li>/templates/arm9 - use this if you only want to program the arm9 cpu. (You should use this one!)
<br/>
</li><li>/templates/arm9lib - use this if you want to create library (lib*.a) files.
<br/>
</li><li>/templates/combined - advanced template, code for arm9 cpu and arm7 cpu.
<br/>
</li><li>/templates/dldi - for writing DLDI drivers.</li></ul>
<br/>
You should use the first one. Just copy "/templates/arm9" from the examples and rename it to "myprojectname".
<br/>
<br/>
The examples also provide all the necessary basics like display graphics, capturing input and playing sound. Just examine the code, copy it, customize it and learn it.<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#126626 - yaazz - Wed Apr 25, 2007 4:46 am</h4>
    <div class="postbody"><span class="postbody">I replaced the source in main.c with my main.cpp file, and now it is starting to compile, but ends when it says somethign should be a void, instead of an INT 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
#include &lt;nds.h&gt;
<br/>
#include "StarField_bin.h"
<br/>
#include "Splash_bin.h"
<br/>
<br/>
<br/>
void initVideo();
<br/>
void initBackgrounds();
<br/>
void	displaySplash();
<br/>
void	displayStarField();
<br/>
<br/>
int main(void){
<br/>
	//turn on 2d core 
<br/>
	powerON(POWER_ALL_2D);
<br/>
<br/>
	//turn on the 2d core
<br/>
	irqInit();
<br/>
	irqSet(IRQ_VBLANK,0);
<br/>
<br/>
	initVideo();
<br/>
	initBackgrounds();
<br/>
<br/>
	displaySplash();
<br/>
	displayStarField();
<br/>
	return 0;
<br/>
}
<br/>
<br/>
void initVideo(){
<br/>
	/*map vram to display a BG on each screen, and then give some memory for sprites */
<br/>
	vramSetMainBanks( //map A and B to main background memory, this gives us 256KB which is good for 16bit graphics
<br/>
			  VRAM_A_MAIN_BG_0x6000000,
<br/>
			  VRAM_B_MAIN_BG_0x6020000,
<br/>
			  // map c to sub background memory
<br/>
			  VRAM_C_SUB_BG_0x6200000,
<br/>
			  //map d to lcd free space
<br/>
			  VRAM_D_LCD);
<br/>
<br/>
//set bank E for use with sprites, this gives us 64KB to use for sprites, which is the max space 1024 tiles takes up in 256 color mode
<br/>
vramSetBankE(VRAM_E_MAIN_SPRITE);
<br/>
<br/>
//set the video mode on the main screen 
<br/>
videoSetMode( MODE_5_2D | DISPLAY_SPR_ACTIVE | DISPLAY_BG3_ACTIVE | DISPLAY_SPR_1D);
<br/>
<br/>
//set the video mode on the sub screen
<br/>
videoSetModeSub ( MODE_5_2D | DISPLAY_BG3_ACTIVE );
<br/>
<br/>
<br/>
}
<br/>
<br/>
void initBackgrounds(){
<br/>
	//setup extended rotation backgrounds on main as a 16bit color background
<br/>
	BG3_CR = BG_BMP16_256x256 | BG_BMP_BASE(0) | BG_PRIORITY(3);
<br/>
	//attributes of the affine transformation matrix
<br/>
	BG3_XDX = 1 &lt;&lt; 8; //scale X
<br/>
	BG3_XDY = 0; //Rotation X
<br/>
	BG3_YDX = 0; //Rotation Y	
<br/>
	BG3_YDY = 1 &lt;&lt; 8; //Rotation Y
<br/>
	BG3_CX = 0; //Translation X
<br/>
	BG3_CY = 0; //Translation Y
<br/>
<br/>
	//setup extended rotation backgrounds on sub as a 16bit color background
<br/>
	SUB_BG3_CR = BG_BMP16_256x256 | BG_BMP_BASE(0) | BG_PRIORITY(3);
<br/>
	//attributes of the affine transformation matrix
<br/>
	SUB_BG3_XDX = 1 &lt;&lt; 8; //scale X
<br/>
	SUB_BG3_XDY = 0; //Rotation X
<br/>
	SUB_BG3_YDX = 0; //Rotation Y	
<br/>
	SUB_BG3_YDY = 1 &lt;&lt; 8; //Rotation Y
<br/>
	SUB_BG3_CX = 0; //Translation X
<br/>
	SUB_BG3_CY = 0; //Translation Y
<br/>
}
<br/>
<br/>
void displaySplash(){
<br/>
	dmaCopy(Splash_bin,BG_BMP_RAM_SUB(0),Splash_bin_size);
<br/>
	//the memory for sub BG is BG_BMP_RAM_SUB(0)
<br/>
}
<br/>
<br/>
void displayStarField(){
<br/>
	dmaCopy(StarField_bin,BG_BMP_RAM(0),StarField_bin_size);
<br/>
	//the memory for main BG is BG_BMP_RAM_(0)
<br/>
}
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
and here is the output 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
afreddin@afreddin-desktop:~/nds-examples-20070327/templates/arm9$ make
<br/>
main.cpp
<br/>
arm-eabi-g++ -MMD -MP -MF /home/afreddin/nds-examples-20070327/templates/arm9/build/main.d -g -Wall -O2 -march=armv5te -mtune=arm946e-s -fomit-frame-pointer -ffast-math -mthumb -mthumb-interwork -I/home/afreddin/nds-examples-20070327/templates/arm9/include -I/home/afreddin/devkitpro/libnds/include -I/home/afreddin/nds-examples-20070327/templates/arm9/build -DARM9 -fno-rtti -fno-exceptions -c /home/afreddin/nds-examples-20070327/templates/arm9/source/main.cpp -o main.o
<br/>
/home/afreddin/nds-examples-20070327/templates/arm9/source/main.cpp: In function 'void displaySplash()':
<br/>
/home/afreddin/nds-examples-20070327/templates/arm9/source/main.cpp:72: error: invalid conversion from 'int' to 'void*'
<br/>
/home/afreddin/nds-examples-20070327/templates/arm9/source/main.cpp:72: error:   initializing argument 2 of 'void dmaCopy(const void*, void*, uint32)'
<br/>
/home/afreddin/nds-examples-20070327/templates/arm9/source/main.cpp: In function 'void displayStarField()':
<br/>
/home/afreddin/nds-examples-20070327/templates/arm9/source/main.cpp:77: error: invalid conversion from 'int' to 'void*'
<br/>
/home/afreddin/nds-examples-20070327/templates/arm9/source/main.cpp:77: error:   initializing argument 2 of 'void dmaCopy(const void*, void*, uint32)'
<br/>
make[1]: *** [main.o] Error 1
<br/>
make: *** [build] Error 2
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#126627 - Lick - Wed Apr 25, 2007 4:47 am</h4>
    <div class="postbody"><span class="postbody">BG_BMP_RAM(0) -&gt; (void*)BG_BMP_RAM(0)
<br/>
<br/>
BG_BMP_RAM_SUB(0) -&gt; (void*)BG_BMP_RAM_SUB(0)<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#126629 - yaazz - Wed Apr 25, 2007 4:58 am</h4>
    <div class="postbody"><span class="postbody">Yeah I thought that was the problem, since BG_BMP_RAM_SUB(0) is an address, but when Ido this, it tells me "undefined reference to Splash_bin, and "undefined reference to Splash_bin_size" (i have starfield commented out at the moment. 
<br/>
<br/>
<br/>
Splash_bin, is of course a graphics file, and the .h looks like this
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
extern const u8 Splash_bin_end[];
<br/>
extern const u8 Splash_bin[];
<br/>
extern const u32 Splash_bin_size;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
This is out of the other libnds tutorial as you have probably guessed</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#126630 - Lick - Wed Apr 25, 2007 5:11 am</h4>
    <div class="postbody"><span class="postbody">Remember what I said earlier, about the official templates? (If not, you can always scroll up, hehe.)  It's not only the code in "main.cpp" that matters. It's the whole directory structure + Makefile. As you can see, if those aren't compatible with each other, the (linking) errors will pop out like spam.
<br/>
<br/>
So once again, you're better off using the official templates as base.<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
