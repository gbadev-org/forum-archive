<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>64x64 background maps becomes 4x32x32 - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > 64x64 background maps becomes 4x32x32</h2>
<div id="posts">
<div class="post">
    <h4>#47764 - LOst? - Wed Jul 13, 2005 4:36 am</h4>
    <div class="postbody"><span class="postbody">I have a big problem. I want to use 64x64 tiles backgrounds. But when I copy my map (which is a linear array) into BG_MAP_RAM (anything), the background seems to be divided into 4 sections, and I don't know why, or how to fix it without pro help.
<br/>
<br/>
So how do I do? Is there any limitations in the VRAM memory? Or is it Map Ed I shouldn't trust?<br/>_________________<br/><span style="font-style: italic">Exceptions are fun</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#47767 - gladius - Wed Jul 13, 2005 5:02 am</h4>
    <div class="postbody"><span class="postbody">The 64x64 backgrounds are stored as 4 32x32 contiguous sections in vram.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#47769 - tepples - Wed Jul 13, 2005 5:05 am</h4>
    <div class="postbody"><span class="postbody">Gladius is correct. In text mode, a 64x64 tile map is divided into four 32x32 tile quadrants. This has been the case since the NES. In rotation mode, on the other hand, maps of all sizes are linear and have been so since the Super NES.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#47770 - dovoto - Wed Jul 13, 2005 5:18 am</h4>
    <div class="postbody"><span class="postbody">Tile map width can not exeed 32 tiles in memory.  This is a hardware limitation that also exists in GBA.  So any background larger than 32x32 is actualy composed of 32x32 chunks.  
<br/>
<br/>
To over come this you need to map your linear array onto this chunked array.
<br/>
<br/>
64x32 Map in VRAM
<br/>
<br/>
1,   2,......31    1024, 1025....1055
<br/>
32, 33,....63    1056, 1057....1087
<br/>
.                    .
<br/>
.                    .
<br/>
...........1024   ...................2048
<br/>
<br/>
<br/>
not sure if this makes things any clearer...I have some simple code from an unfinished demo series i started a long while back.
<br/>
<a class="postlink" href="http://rafb.net/paste/results/fk68mX95.html" target="_blank">http://rafb.net/paste/results/fk68mX95.html</a> Line 74 or so is were the copy occurs.[/code]<br/>_________________<br/><a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#47771 - dovoto - Wed Jul 13, 2005 5:21 am</h4>
    <div class="postbody"><span class="postbody">Oh...and please dont use that method for actualy loading your maps :) It is ment only to supplement an explanation of the mapping.  It is much better to either pre-compute your map or at least copy in 32 tiles at a time.<br/>_________________<br/><a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#47781 - LOst? - Wed Jul 13, 2005 12:03 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>dovoto wrote:</b></span></td> </tr> <tr> <td class="quote">Oh...and please dont use that method for actualy loading your maps :) It is ment only to supplement an explanation of the mapping.  It is much better to either pre-compute your map or at least copy in 32 tiles at a time.</td> </tr></table><span class="postbody">
<br/>
Thanks. Do I have to change the MAP base after I have copied in 32x32 tiles? Or is it only the order of the map tiles I have to think about here?<br/>_________________<br/><span style="font-style: italic">Exceptions are fun</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#47785 - rize - Wed Jul 13, 2005 3:07 pm</h4>
    <div class="postbody"><span class="postbody">In the control register, you certainly dont' change the map base.  Now your vram pointer, you might increment that to the base you're loading if it makes sense to decrease computation.
<br/>
<br/>
dovoto and company: As for precomputing the map's location, is that possible with a dynamic streaming tilemap into a 64x32 space?  I suppose it is, but is it really worth precomputing the location (wastes space instead of cycles)?  Right now I'm using a complex looking scheme in real-time that requires me to take the modulus of  my "software" tilemap's index with the hardware space's dimensions to get a hardware mapping, and then further map that into the blocked tilemap memory using the computation below:
<br/>
<br/>
I'm using tilemaps larger than 64x64 and dynamically streaming the contents into a 64x32 space (64x32 being the smallest map large enough to display one full screen plus one additional row and column of tiles).
<br/>
<br/>
LOst: anyway, I'm calculating indexes like this:  for indices x and y into a straightforwrd 64x32 tilemap, get the hardware indices like so:
<br/>
<br/>
if (x &gt;= 32) index = 1024 + x-32 + y*32;
<br/>
else index = x + y*32;
<br/>
<br/>
32x64 is similar:
<br/>
<br/>
if (y &gt;= 32) index = 1024 + x + (y-32)*32;
<br/>
else index = x + y*32;
<br/>
<br/>
For 64x64 you'd need to deal with four quadrants by combining the previous two if's like so:
<br/>
<br/>
offset = 0;
<br/>
<br/>
if (x &gt;= 32) {
<br/>
offset = 1024; //32x32, the size of one block
<br/>
hx = x-32;
<br/>
}
<br/>
else hx = x;
<br/>
<br/>
if (y &gt;= 32) {
<br/>
offset += 2048; //add two blocks to the previous offset
<br/>
hy = y-32;
<br/>
}
<br/>
else hy = y;
<br/>
<br/>
//offset jumps to the base, x and y index it
<br/>
index = offset + x + y*32;
<br/>
vram_map_base[index] = software_map[x][y];
<br/>
<br/>
Or something like that.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
