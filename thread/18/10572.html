<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Global constructors don't show up - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Global constructors don't show up</h2>
<div id="posts">
<div class="post">
    <h4>#95274 - agentq - Fri Jul 28, 2006 3:56 pm</h4>
    <div class="postbody"><span class="postbody">Hi,  I've been compiling a program with DevkitArm r19a, and it seems to crash in the global constructors before reaching main().  I commented out the following lines in ds_arm9_crt0.s in order to test this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#ldr   r3, =__libc_init_array   @ global constructors
<br/>
#bl   _call_via_r3</td> </tr></table><span class="postbody">
<br/>
<br/>
After that, my program's main() function runs fine, but global objects don't have their constructor called.
<br/>
<br/>
I now need to know where the global contructors are in the program to find the one that has the problem.  I have previously used a map file generated with -Wl,-Map,map.txt and looked in the .ctors section, but this time the section appears to be empty:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">.ctors          0x0217aa3c        0x0
<br/>
 *crtbegin.o(.ctors)
<br/>
 *(EXCLUDE_FILE(*crtend.o) .ctors)
<br/>
 *(SORT(.ctors.*))
<br/>
 *(.ctors)
<br/>
                0x0217aa3c                . = ALIGN (0x4)
<br/>
<br/>
.dtors          0x0217aa3c        0x0
<br/>
 *crtbegin.o(.dtors)
<br/>
 *(EXCLUDE_FILE(*crtend.o) .dtors)
<br/>
 *(SORT(.dtors.*))
<br/>
 *(.dtors)
<br/>
                0x0217aa3c                . = ALIGN (0x4)</td> </tr></table><span class="postbody">
<br/>
<br/>
Does anyone know why this would be?  There are definately global constructors in the program.  When I build ScummVM, this section lists the object files which contain global static objects.
<br/>
<br/>
Or perhaps anyone knows of a better way to find these?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#95370 - agentq - Sat Jul 29, 2006 2:13 am</h4>
    <div class="postbody"><span class="postbody">I was just being stupid, and looking in the wrong section.
<br/>
<br/>
In case anyone's interested, it was .init_array I was after.  The .o files listed in here are the ones that have global constructors.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">.init_array     0x0213a73c       0x2c
<br/>
 *(.init_array)
<br/>
 .init_array    0x0213a73c        0x4 c:/ndsdev/devkitpro/devkitarm/bin/../lib/gcc/arm-eabi/4.1.1/crtbegin.o
<br/>
 .init_array    0x0213a740        0x4 cache.o
<br/>
 .init_array    0x0213a744        0x4 demo.o
<br/>
 .init_array    0x0213a748        0x4 director.o
<br/>
 .init_array    0x0213a74c        0x4 extend.o
<br/>
 .init_array    0x0213a750        0x4 lisp_gc.o
<br/>
 .init_array    0x0213a754        0x4 main.o
<br/>
 .init_array    0x0213a758        0x4 specache.o
<br/>
 .init_array    0x0213a75c        0x4 statbar.o
<br/>
 .init_array    0x0213a760        0x4 image.o
<br/>
 .init_array    0x0213a764        0x4 specs.o
<br/>
                0x0213a768                PROVIDE (__init_array_end, .)
<br/>
                0x0213a768                PROVIDE (__fini_array_start, .)
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Yay for fixing bugs at 2:15 in the morning!</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
