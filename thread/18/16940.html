<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Saving game data - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Saving game data</h2>
<div id="posts">
<div class="post">
    <h4>#171018 - gauauu - Wed Oct 28, 2009 7:27 pm</h4>
    <div class="postbody"><span class="postbody">Split from <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=16935&amp;start=65" target="_blank">here</a>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sverx wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>gauauu wrote:</b></span></td> </tr> <tr> <td class="quote">For NDS, you need to write to the filesystem using libfat, which comes with libnds.  Once you do, it's mostly as easy as writing files to any filesystem.  If you need more help, start a new thread about it and we'll discuss there.
<br/>
<br/>
For GBA, I just now answered genecyst's question about it here:
<br/>
<a class="postlink" href="http://forum.gbadev.org/viewtopic.php?p=171011#171011" target="_blank">http://forum.gbadev.org/viewtopic.php?p=171011#171011</a></td> </tr></table><span class="postbody">
<br/>
<br/>
Thanks! Isn't there anything on the NDS like what's on the GBA? I mean, is there a way to implement a save using no filesystems? How do the commercial titles do, then???</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Commercial titles use different types of cartridges than homebrew.  I'm not sure how they do it, but it's definitely different.  The problem is that our carts are generally adapters to SD cards with a filesystem.   A loader loads the actual rom into the DS memory when you start.  So there's really no place/way of storing data other than using the file system to read/write the SD card.  
<br/>
<br/>
It would be possible (and not too difficult) to make a library that abstracts some of that away, but it would still be happening under the covers, and as it's actually pretty easy to read/write using the file system, it doesn't seem to be very necessary.
<br/>
<br/>
I have example code of doing so if you are interested.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171021 - vuurrobin - Wed Oct 28, 2009 8:01 pm</h4>
    <div class="postbody"><span class="postbody">don't official ds cards have some kind of rom chip to save stuff on? isn't that what the eeprom is for?
<br/>
<br/>
<br/>
flashcards don't have this memory, because then games would overwrite eachother save data. instead, if somebody tries to save data to this memory, they stream the data to the filesytem.
<br/>
<br/>
<br/>
however, this shouldn't be used by homebrewgames because you rely on a workaround of the loader, and that may not always work (some loaders don't support it, others encript the file, ect). not to mention that you try to write to memory that you know that doesn't exists.
<br/>
<br/>
<br/>
ds homebrew games should just use the filesystem in one way or another (you can use efs to save the data inside the nds file, but that still needs the filesystem)<br/>_________________<br/>my blog:
<br/>
<a href="http://vuurrobin.100webcustomers.com/" target="_blank">http://vuurrobin.100webcustomers.com/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171051 - sverx - Thu Oct 29, 2009 11:17 am</h4>
    <div class="postbody"><span class="postbody">Thanks both, it's much clearer now :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171080 - Azenris - Fri Oct 30, 2009 7:40 pm</h4>
    <div class="postbody"><span class="postbody">Hi I was actually just starting to have some save data, is that the idea then to just have a file on the card for your game like "MySave.bin" etc. I just wrote
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">// =================================================================================
<br/>
// SaveGame:
<br/>
bool CGame::ACCOUNT_INFO::SaveGame(void)
<br/>
{
<br/>
   if (g_pGame-&gt;FileSystemOK())
<br/>
   {
<br/>
      FILE *pFile = fopen("RedTempleSaveData.bin", "wb");            // open the file
<br/>
      
<br/>
      if (pFile != NULL)
<br/>
      {
<br/>
         fseek(pFile, 0, SEEK_SET);                           // seek the the file start
<br/>
         fwrite((void*)this, sizeof(ACCOUNT_INFO), 1, pFile);      // read all the data into the account
<br/>
         fclose(pFile);                                    // close the file
<br/>
<br/>
         return true;
<br/>
      }
<br/>
      else
<br/>
      {
<br/>
         ASSERT(0, "Failed To Save")
<br/>
         return false;                                    // an error occured
<br/>
      }
<br/>
   }
<br/>
<br/>
   return false;
<br/>
}
<br/>
<br/>
// =================================================================================
<br/>
// LoadGame:
<br/>
bool CGame::ACCOUNT_INFO::LoadGame(void)
<br/>
{
<br/>
   if (g_pGame-&gt;FileSystemOK())
<br/>
   {
<br/>
      FILE *pFile = fopen("RedTempleSaveData.bin", "rb");            // open the file
<br/>
      
<br/>
      if (pFile != NULL)
<br/>
      {
<br/>
         fseek(pFile, 0, SEEK_SET);                           // seek the the file start
<br/>
         fread((void*)this, sizeof(ACCOUNT_INFO), 1, pFile);         // read all the data into the account
<br/>
         fclose(pFile);                                    // close the file
<br/>
<br/>
         return true;
<br/>
      }
<br/>
      else
<br/>
      {
<br/>
         return false;                                    // no save file
<br/>
      }
<br/>
   }
<br/>
<br/>
   return false;
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
Seems to work so far, hope im not doing sommet that will damage someones card !<br/>_________________<br/><a class="postlink" href="http://sacredpotion.blogspot.com/" target="_blank"><span style="color: red">My Homebrew Games</span></a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171082 - gauauu - Fri Oct 30, 2009 9:19 pm</h4>
    <div class="postbody"><span class="postbody">Also, one thing that bit me:  don't name your save file (yourRomName).sav   (ie I first used anguna.sav for my save file)
<br/>
<br/>
Certain cards use this file internally, and it'll cause all sorts of problems.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171085 - vuurrobin - Fri Oct 30, 2009 9:55 pm</h4>
    <div class="postbody"><span class="postbody">and, to avoid cluttering up the root of the memory card, use DATA/yourgame/yourgame.sav to save your savedata, or something like it.<br/>_________________<br/>my blog:
<br/>
<a href="http://vuurrobin.100webcustomers.com/" target="_blank">http://vuurrobin.100webcustomers.com/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171089 - a128 - Sat Oct 31, 2009 9:17 am</h4>
    <div class="postbody"><span class="postbody">compress youre save data....i.e. using LZ77<br/>_________________<br/>"Hey! It compiles! Ship it!"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171091 - gauauu - Sat Oct 31, 2009 3:19 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>a128 wrote:</b></span></td> </tr> <tr> <td class="quote">compress youre save data....i.e. using LZ77</td> </tr></table><span class="postbody">
<br/>
<br/>
Here, I wouldn't necessarily always agree.  If you're only saving a tiny bit of data (which should often be the case), then it's not worth the effort.  
<br/>
<br/>
Anguna would save:
<br/>
-your location
<br/>
-your stats (health (and max), armor, attack, money) (5 ints)
<br/>
-Your inventory (an int for 1 each of about 6 items)
<br/>
-Game state flags (About 150 of them.  I used a full int even though it was wasteful)
<br/>
-Flags for each enemy to determine if you've fought it or not (about 30)
<br/>
-A checksum 
<br/>
<br/>
So that's around 200 ints.  Most ds writable cards are huge (500 megs to a few gigs?).  Compression just seems like a waste of time.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171092 - a128 - Sat Oct 31, 2009 3:49 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>gauauu wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<br/>
So that's around 200 ints.  Most ds writable cards are huge (500 megs to a few gigs?).  Compression just seems like a waste of time.</td> </tr></table><span class="postbody">
<br/>
<br/>
This quote perfectly shows ....with huge memory  no one cares to optimize things. this is sad 
<br/>
<br/>
writing less data ...is faster ....good for your life of the card  too!
<br/>
.and reading less data is faster too.
<br/>
<br/>
I post a LZ77 compressor/decompressor is you like...because I use this to save /load my data on the NDS<br/>_________________<br/>"Hey! It compiles! Ship it!"</span><span class="gensmall"><br/><br/>Last edited by a128 on Sat Oct 31, 2009 3:55 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#171093 - Dwedit - Sat Oct 31, 2009 3:52 pm</h4>
    <div class="postbody"><span class="postbody">It depends on what you are using to save.  If you have an SD card, go ahead and save 8 gigs of crap.
<br/>
<br/>
But if you are using a real cartridge, your save storage is far more limited.  In the Nintendo 64 era, most games used 512 byte EEPROM saves, though 2KB EEPROM, 32KB SRAM, and 128KB Flash was also available.
<br/>
On the GBA, saves were either 128 byte EEPROM, 4K EEPROM, 32 KB SRAM, 64 KB FLASH, or occasionally 128KB FLASH.
<br/>
On the DS, save sizes range from 512 byte EEPROM to 512KB Flash.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171094 - a128 - Sat Oct 31, 2009 3:58 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dwedit wrote:</b></span></td> </tr> <tr> <td class="quote">It depends on what you are using to save.  If you have an SD card, go ahead and save 8 gigs of crap.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Thx to Dwedit who cares about save sizes.<br/>_________________<br/>"Hey! It compiles! Ship it!"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171095 - vuurrobin - Sat Oct 31, 2009 5:04 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>a128 wrote:</b></span></td> </tr> <tr> <td class="quote">with huge memory no one cares to optimize things. </td> </tr></table><span class="postbody">
<br/>
<br/>
IMO, there is a difference with optimising your savedata and compressing your savedata. if you use ints just to store a boolean value, then sure go ahead and optimise it so it stores boolean values in a byte or a bit. 
<br/>
<br/>
I wouldn't start thinking about compressing savadate until it is <span style="font-style: italic">at least</span> a few kb. anything below that is just not necessary. remember that (de)compressing also takes time and that you may not save that much memory by compressing.
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>a128 wrote:</b></span></td> </tr> <tr> <td class="quote">I post a LZ77 compressor/decompressor is you like...because I use this to save /load my data on the NDS</td> </tr></table><span class="postbody">
<br/>
<br/>
doesn't the DS have some bios functions for LZ77 compression.
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dwedit wrote:</b></span></td> </tr> <tr> <td class="quote">If you have an SD card, go ahead and save 8 gigs of crap.</td> </tr></table><span class="postbody">
<br/>
<br/>
and be prepared to get alot of emails because users can't store both your game and another game on there SD card at the same time, or that they need a bigger SD card just to play your game.
<br/>
<br/>
if users have a big SD card, they useally want to store alot of games, not a single game with a freaking big savedata (but I doubt that any homebrew game will have savedata bigger than an mb)<br/>_________________<br/>my blog:
<br/>
<a href="http://vuurrobin.100webcustomers.com/" target="_blank">http://vuurrobin.100webcustomers.com/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171096 - gauauu - Sat Oct 31, 2009 5:07 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dwedit wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
But if you are using a real cartridge, your save storage is far more limited.  </td> </tr></table><span class="postbody">
<br/>
<br/>
Which is why I prefaced this by mentioned writable homebrew nds carts.  If you have tighter constraints, then it might make sense to compress.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
This quote perfectly shows ....with huge memory no one cares to optimize things. this is sad
<br/>
<br/>
writing less data ...is faster ....good for your life of the card too!
<br/>
.and reading less data is faster too. </td> </tr></table><span class="postbody">
<br/>
<br/>
I prefer finishing things to unnecessary optimization ;-)  (Not to say you wouldn't finish, but I wouldn't if I optimized things that didn't need it)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171097 - a128 - Sat Oct 31, 2009 7:18 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>vuurrobin wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<br/>
doesn't the DS have some bios functions for LZ77 compression.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
only for decompressing ....or did i missed somethink?!<br/>_________________<br/>"Hey! It compiles! Ship it!"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171100 - vuurrobin - Sun Nov 01, 2009 12:18 am</h4>
    <div class="postbody"><span class="postbody">no I think you're right. sorry, my mistake &lt;insertEmbarrisingSmilieHereAsSoonAsTheForumsAllowSmilies&gt;<br/>_________________<br/>my blog:
<br/>
<a href="http://vuurrobin.100webcustomers.com/" target="_blank">http://vuurrobin.100webcustomers.com/</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
