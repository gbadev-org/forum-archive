<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Is there Z-testing when using glOrtho? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Is there Z-testing when using glOrtho?</h2>
<div id="posts">
<div class="post">
    <h4>#111010 - simonjhall - Sun Dec 03, 2006 4:51 pm</h4>
    <div class="postbody"><span class="postbody">I don't want to have any perspective correction or anything when rendering my graphics so I've been using
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">glOrtho(-6, 5, 3.5f, -4.5, 1.0f, 0x7fff);</td> </tr></table><span class="postbody">
<br/>
to get my stuff on the screen. It's all fitting on the screen just fine but there's *nothing* that I can do to get Z-testing to work.
<br/>
<br/>
If I just draw two triangles and play with the z co-ords of the vertices the triangle which is drawn last is always drawn on top. This goes for any value of z-near and z-far. In fact if I change the z of the vertices to be behind the camera they'll still be drawn!
<br/>
<br/>
If I replace the ortho call with
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">gluPerspective(35, 256.0 / 192.0, 1.0f, 0x7fff);</td> </tr></table><span class="postbody">
<br/>
everything looks perfectly fine and triangles come out in the proper depth order. The perspective projection makes stuff look slightly wrong though.
<br/>
<br/>
Am I missing something here?<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111013 - Sunray - Sun Dec 03, 2006 5:36 pm</h4>
    <div class="postbody"><span class="postbody">Take a look at SWAP_BUFFERS here <a href="http://nocash.emubase.de/gbatek.htm#ds3ddisplaycontrol" target="_blank">http://nocash.emubase.de/gbatek.htm#ds3ddisplaycontrol</a>
<br/>
Then look at glFlush() in videoGL.inl (or something) and you will notice that libnds doesn't do what you want to do. GLX_FLUSH = 0; will probably work better.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111045 - simonjhall - Sun Dec 03, 2006 8:32 pm</h4>
    <div class="postbody"><span class="postbody">Right, I tried all sorts of things using that flush command (and the docs on the site) but whatever I tried still gave me the same whack results. In the end I'm using a perspective projection, but with a really small FOV in order to minimise the errors.
<br/>
<br/>
I'll eventually build my own orthographic matrix, but this'll do for now...<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111060 - Sunray - Sun Dec 03, 2006 9:36 pm</h4>
    <div class="postbody"><span class="postbody">Strange. My platform game (with mixed 2D/3D kinda like NSMB) uses orthographic projection and it works perfectly.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111078 - Goosey - Sun Dec 03, 2006 11:36 pm</h4>
    <div class="postbody"><span class="postbody">I was able to get this working by replacing my glFlush with the GFX_FLUSH = 0;... but there was one tricky part. My glOrthof32 command uses a zNear of 0 and a zFar of -1000, but when constructing polygons I use 0 for near and 1000 for farthest. Not sure where the sign is getting flipped (perhaps I should set a camera?) but it works so I am forging ahead. :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111168 - silent_code - Mon Dec 04, 2006 5:11 pm</h4>
    <div class="postbody"><span class="postbody">usually i wouldn't reccomend using 0 for near clipping, but 1, as well as a positive far clipping value. though i haven't tried ortho on the nds myself (only using perspective atm).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111307 - Rajveer - Tue Dec 05, 2006 4:52 pm</h4>
    <div class="postbody"><span class="postbody">EDIT: sorry I didnt read above. Using GFX_FLUSH = 0; worked for me too. For the far and near clip planes, using</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">glOrthof32(0, 256, 0, 192, 0.1, 1000);</td> </tr></table><span class="postbody"> works for me (without setting the camera position), after which I can draw a full screen quad with </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   glVertex3v16(0, 0, -1); 
<br/>
   glVertex3v16(0, 192, -1); 
<br/>
   glVertex3v16(256, 192, -1);
<br/>
   glVertex3v16(256, 0, -1); </td> </tr></table><span class="postbody">
<br/>
<br/>
Changing the z-coordinate changes its "layer", so drawing something with -2 will mean its drawn behind what I showed.
<br/>
<br/>
Sorry if you knew this/already tried it :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111314 - simonjhall - Tue Dec 05, 2006 5:30 pm</h4>
    <div class="postbody"><span class="postbody">I'm gonna check this stuff out proper-like once my kits gets flashed again as there must have been something obvious that I missed out.
<br/>
OR the lack of z-buffer was a hint than my DS was about to die :-)<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
