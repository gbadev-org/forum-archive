<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Want to write text over an image in sub background - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Want to write text over an image in sub background</h2>
<div id="posts">
<div class="post">
    <h4>#144176 - koala33 - Mon Oct 29, 2007 10:53 pm</h4>
    <div class="postbody"><span class="postbody">Hi all! 
<br/>
<br/>
I'm just starting some DS programming in order to learn great stuff 
<br/>
on this nice machine. 
<br/>
<br/>
My first test was : 
<br/>
1- draw 3D in the top screen (main) 
<br/>
2- draw text (printf chars) over an image (256x192x8bits with palette) 
<br/>
in the sub background 
<br/>
<br/>
the first item was done, the second one generates fuzzy stuff :weirds pixels over the first part of my background image. 
<br/>
<br/>
VRAM config is the following: 
<br/>
vramSetMainBanks(VRAM_A_TEXTURE,VRAM_B_TEXTURE,VRAM_C_SUB_BG, VRAM_D_TEXTURE); 
<br/>
<br/>
I've tried several things, but none work. 
<br/>
<br/>
Does somebody can post a sample code to do this kind of effect ? 
<br/>
<br/>
thx.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144177 - silent_code - Mon Oct 29, 2007 11:02 pm</h4>
    <div class="postbody"><span class="postbody">well, i did it in my volume shadows demo. check my page (www button under my post). the sources are there. i guess you'll have to look into main9.cpp. it has all to do with base blocks etc. read them up in tonc (it's by cern, so look for his page).
<br/>
<br/>
ps: there'll be an update sometime soon. ;^D
<br/>
<br/>
EDIT:
<br/>
<br/>
WELCOME TO THE SCENE! :^D
<br/>
<br/>
some excerpts to ease your life a bit. (it's very likely you'll have to adjust the values.)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   vramSetBankC(VRAM_C_SUB_BG_0x06260000);
<br/>
   vramSetBankE(VRAM_E_MAIN_BG);   // BEWARE: LIBNDS USES E FOR TEXTURE PALETTES BY DEFAULT
<br/>
<br/>
// ...
<br/>
<br/>
   videoSetModeSub(MODE_5_2D | DISPLAY_BG0_ACTIVE | DISPLAY_BG3_ACTIVE);
<br/>
   SUB_BG0_CR = BG_256_COLOR | BG_MAP_BASE(31) | BG_TILE_BASE(4);
<br/>
   SUB_BG3_CR = BG_BMP8_256x256 | BG_PRIORITY(3);
<br/>
<br/>
   SUB_BG3_XDX = 1 &lt;&lt; 8; //scale x
<br/>
   SUB_BG3_XDY = 0; //rotation x
<br/>
   SUB_BG3_YDX = 0; //rotation y
<br/>
   SUB_BG3_YDY = 1 &lt;&lt; 8; //scale y
<br/>
   SUB_BG3_CX = 0; //translation x
<br/>
   SUB_BG3_CY = 128; //translation y
<br/>
<br/>
// after loading the palette:
<br/>
<br/>
// loading a custom font
<br/>
<br/>
   consoleInit((u16*)font_image, (u16*)CHAR_BASE_BLOCK_SUB(4), 95, 32, (u16*)SCREEN_BASE_BLOCK_SUB(31), 0, 8);
<br/>
<br/>
   for(u16 i = 0; i &lt; imgSize; i++)
<br/>
   {
<br/>
      ((uint32*)CHAR_BASE_BLOCK_SUB(4))[i] = ((uint32*)font_image)[i];
<br/>
   }
<br/>
<br/>
<br/>
// loading the bg image
<br/>
<br/>
   for(u16 i = 0; i &lt; imgSize; i++)
<br/>
   {
<br/>
      ((uint32*)SCREEN_BASE_BLOCK_SUB(0))[i] = ((uint32*)bg_image)[i];
<br/>
   }
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
works for me.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144219 - koala33 - Tue Oct 30, 2007 10:31 am</h4>
    <div class="postbody"><span class="postbody">Thank you silent_code, 
<br/>
<br/>
but i've tried your code and it does not work with my code/data.
<br/>
I don't understant all block_base/char_base stuff, could you explain more 
<br/>
precisely ?
<br/>
<br/>
I think there is some mismatch values for memory map : tile againt full bitmap.
<br/>
<br/>
For whatever purpose it may serve, I put my code on shared space, 
<br/>
available from the following link: 
<br/>
<a class="postlink" href="http://www.4shared.com/dir/4386040/1fb1ad27/sharing.html" target="_blank">http://www.4shared.com/dir/4386040/1fb1ad27/sharing.html</a>
<br/>
<br/>
<br/>
thx.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144238 - silent_code - Tue Oct 30, 2007 4:47 pm</h4>
    <div class="postbody"><span class="postbody">i'll have a look at it as soon as i set up my dev environment on the new computer (vista). can't promisse you anything, though! :^C</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
