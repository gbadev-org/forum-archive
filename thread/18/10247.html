<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>How to boost throughput of 2D graphics? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > How to boost throughput of 2D graphics?</h2>
<div id="posts">
<div class="post">
    <h4>#91333 - Dark Knight ez - Thu Jul 06, 2006 2:29 pm</h4>
    <div class="postbody"><span class="postbody">Hey everyone.
<br/>
<br/>
Having gotten tiled backgrounds to work, I was kind of dissapointed that even though I assigned a 128kb VRAM to them, I could only use the first 64kb (as is the case on GBA). That is, my quick tests indicated this. If someone can tell (and show) me otherwise, please do so.
<br/>
<br/>
It wouldn't be so much of a concern, if it weren't for the fact that I need to output more graphics, and doing this only via the sprites would not be enough. I will most likely need to display more than 128 tiles of graphics.
<br/>
<br/>
My question to you all is this:
<br/>
How can I boost the throughput of 2D graphics?
<br/>
- Am I wrong, and can more graphics be stored in the VRAM bank and utilized by the tiled backgrounds? If I could utilize the entire 128kb for backgrounds, my problem would be solved.
<br/>
- Is it possible to use an affine background as framebuffer (to complement sprites) in the 64kb not utilized currently by the regular tiled backgrounds? I have seen an affine background used as a framebuffer, but can it be relocated to the last 64kb of the 128kb VRAM?
<br/>
<br/>
I know I could probably use the screen-capture functionality, but I'd rather not have to worry about displaying one frame, while the DS is already busy doing logic and such of the next frame.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#91340 - parrot_ - Thu Jul 06, 2006 4:02 pm</h4>
    <div class="postbody"><span class="postbody">With tiles you've got a limit of 1024. For sprites, reuse them :). Keep a map of all their positions and when their positions are in the visible area of your map move the sprites X &amp; Y, or you could write a dynamic sprite allocator.<br/>_________________<br/>Squak! etc.
<br/>
<a class="postlink" href="http://squakly.wordpress.com" target="_blank">My Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#91341 - Dark Knight ez - Thu Jul 06, 2006 4:19 pm</h4>
    <div class="postbody"><span class="postbody">It is only logical that I only show the sprites or tiles in the visible area of my map.
<br/>
I am just saying that having available "only" 64kb of graphics for the backgrounds I can not display units and other objects as well on the backgrounds as tiles. They do not fit in the 64 kb along with background and structures graphics.
<br/>
<br/>
And displaying all the units and other objects could still be not enough if shown as sprites, because of the limitation of 128 sprites at a time on a screen.
<br/>
<br/>
So... for backgrounds I would've prefered more storage for graphics,
<br/>
and for sprites I would've prefered more possible to display at a given time.
<br/>
Thus my question.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#91349 - tepples - Thu Jul 06, 2006 4:53 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dark Knight ez wrote:</b></span></td> </tr> <tr> <td class="quote">limitation of 128 sprites at a time on a screen.</td> </tr></table><span class="postbody">
<br/>
What limitation? You can rewrite OAM during horizontal blanking (as seen in BulletGBA and Super Puzzle Fighter II), or you can use the 3D engine for 1,500 additional quads on one screen.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#91352 - Dark Knight ez - Thu Jul 06, 2006 5:00 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">You can rewrite OAM during horizontal blanking</td> </tr></table><span class="postbody">
<br/>
Perfect. That should give me more than enough room to work with.
<br/>
Thank you for your input, tepples.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#91375 - dovoto - Thu Jul 06, 2006 8:16 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dark Knight ez wrote:</b></span></td> </tr> <tr> <td class="quote">It is only logical that I only show the sprites or tiles in the visible area of my map.
<br/>
I am just saying that having available "only" 64kb of graphics for the backgrounds I can not display units and other objects as well on the backgrounds as tiles. They do not fit in the 64 kb along with background and structures graphics.
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
You have an extra two bits to control the graphics offset for tiled backgrounds on the DS.  Instead of only 16 possibilities for the start offset available on the GBA (often referred to as char base block or tile base block) you now have 64.  Each represents 16KB of memory enabling you to offset into 256KB of video ram from a single background.  
<br/>
<br/>
You are still limited to 1024 tiles per layer (due to the tile index size of 10 bits) and so, can only access 64KB of tile graphics per layer (without some trickery.
<br/>
<br/>
At most you will have 825 unique tiles visible on any given layer (33 x  25 tiles) so this is not much of a limitation.  A dynamic map renderer which loads tile graphics into memory keeping track of which tiles are in use and dynamically loading needed ones while unloading ones not on screen will allow you to render any possible tile combination.  This is very common and although not trivial to do efficiently it is also not terribly difficult.
<br/>
<br/>
As far as 128 sprites you are pretty much out of luck there, you must either sort them by Y each frame and inject them at the appropriate place in the hblank..not all that practical if you need much more than 128 sprites --especially if you use many rotated, scaled sprites-- since you will likely exceed scan line limits as the DS can only display so many sprites per scan line.  Or, you can use the 3D system to display the objects which is more flexable but does not work as well for rotated and scaled sprites (texture coordinates get shifted slightly and make a one to one mapping of texture to sprite cumbersome when the sprite is rotated).
<br/>
<br/>
At least sprite graphics memory no longer is mapped to same location as background graphics memory.  Also the DS supports extended graphics memory for sprites which eliminates the 32KB graphics limitation of the GBA (up to 256KB in 1D mapping mode).<br/>_________________<br/><a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#91404 - Dark Knight ez - Fri Jul 07, 2006 12:30 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">You have an extra two bits to control the graphics offset for tiled backgrounds on the DS. Instead of only 16 possibilities for the start offset available on the GBA (often referred to as char base block or tile base block) you now have 64. Each represents 16KB of memory enabling you to offset into 256KB of video ram from a single background. </td> </tr></table><span class="postbody">
<br/>
Ah. I was trying to use graphics located at the last 64kb of VRAM bank A for a background while still having its charblock located at offset 0. You're saying I could relocate it to the last 64 kb of VRAM bank A, which would give me 128 kb (minus the size of the maps) to work with. If that's possible, I probably won't have to deal with HBlank interrupts, which would be nice. Thank you for the reply.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">You are still limited to 1024 tiles per layer</td> </tr></table><span class="postbody">
<br/>
I don't see any reason to go beyond 256x256 (32x32) backgrounds. Thus that should be fine.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#91432 - tepples - Fri Jul 07, 2006 5:37 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dark Knight ez wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">You are still limited to 1024 tiles per layer</td> </tr></table><span class="postbody">
<br/>
I don't see any reason to go beyond 256x256 (32x32) backgrounds.</span></td> </tr></table><span class="postbody">
<br/>
Other than that if you horizontally scroll, a single tile will be split on the side? Ever played <span style="font-style: italic">Super Mario Bros. 3</span> on an NES (or emulator) and looked at the far right side of the screen?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#91462 - Dark Knight ez - Fri Jul 07, 2006 9:23 am</h4>
    <div class="postbody"><span class="postbody">Horizontally scrolling will be done in steps of 16 pixels (the "tiles" of which the RTS gameplay will exist out of). This rules out such a problem, although scrolling will be considered less smooth.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#91474 - silent_code - Fri Jul 07, 2006 12:00 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Ever played <span style="font-style: italic">Super Mario Bros. 3</span> on an NES (or emulator) and looked at the far right side of the screen?</td> </tr></table><span class="postbody">
<br/>
<br/>
ever played the first nes zelda? ;) it often had the problem, that you would see when new tiles are being written to the map... even vertically :(
<br/>
<br/>
i hope your 16 px scrolling will be ok for you, otherwise you will have to use a bigger map (512 x 256 is the next step, right?). i imagine it (16 px steps) to be a bit choppy for a rts :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#91482 - Dark Knight ez - Fri Jul 07, 2006 1:14 pm</h4>
    <div class="postbody"><span class="postbody">It's not at all that choppy, plus it has its benefits. In fact, I believe most (oldschool) RTS games implemented a similiar scrolling.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
