<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Problems with sprite rotation - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Problems with sprite rotation</h2>
<div id="posts">
<div class="post">
    <h4>#136349 - Phantaseur - Tue Jul 31, 2007 8:31 pm</h4>
    <div class="postbody"><span class="postbody"><a class="postlink" href="http://imageshack.us" target="_blank"></a><a href="http://img61.imageshack.us/img61/2525/reqmg0.png">[Images not permitted - Click here to view it]</a>
<br/>
I have problems with sprite rotation. Example is on picture. I'm making simple snake game, there is example of rotation of snake's head on picture, I have correct image just when there is no rotation, in other cases I have some elements of sprite missed.
<br/>
When rotating 90 degrees there is last column of pixels in sprite missed and sprite moved one pixel right; in case of 180 &amp; 270 degrees there are same problems. 
<br/>
For initialization of rotation I used next code:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   for(int i=0;i&lt;4;i++){   
<br/>
      snrot[i].hdx = COS[i*128 &amp; 0x1FF] &gt;&gt; 4;
<br/>
      snrot[i].hdy = SIN[i*128 &amp; 0x1FF] &gt;&gt; 4;
<br/>
      snrot[i].vdx = -snrot[i].hdy;
<br/>
      snrot[i].vdy = snrot[i].hdx;</td> </tr></table><span class="postbody">0 - no rotation, 1 - 90 degees, 2 - 180 degrees, 3 - 270 degrees.
<br/>
For displaying sprite:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   snspr[0].attribute[0] = ATTR0_COLOR_256 | ATTR0_ROTSCALE | (hy*8&amp;0x0ff);
<br/>
   snspr[0].attribute[1] = ATTR1_ROTDATA(rd) | ATTR1_SIZE_8 | (hx*8&amp;0x01ff);
<br/>
   snspr[0].attribute[2] = 0;
<br/>
<br/>
   for(int j=0;j&lt;8*4;j++)
<br/>
      SPRITE_GFX[j+0]=(snakehead[2*j+1]&lt;&lt;8)|snakehead[2*j];</td> </tr></table><span class="postbody">rd depends of orientation of head (can be 0,1,2 or 3), hy &amp; hx are coordinates of snakehead in cell units, not in pixels.
<br/>
<br/>
What I have to do to get correctly rotated images?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#136359 - masscat - Tue Jul 31, 2007 9:20 pm</h4>
    <div class="postbody"><span class="postbody">The centre of rotation for a 8x8 sprite is the 5th pixel along and down rather than the centre of the sprite (the interval between the 4th and 5th pixel).
<br/>
This leads to you loosing the left and bottom edges of your sprite when rotating.
<br/>
To avoid this you can restrict you sprites to 7x7 centred about the 5th pixel.
<br/>
<br/>
See <a class="postlink" href="http://www.coranac.com/tonc/text/affobj.htm" target="_blank">TONC</a> for more affine info.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#136362 - tepples - Tue Jul 31, 2007 9:59 pm</h4>
    <div class="postbody"><span class="postbody">Sprites on the GBA and DS rotate about the center pixel, which is (4, 4) in an 8x8 pixel sprite.
<br/>
<br/>
You can use the same workaround that developers used on NES and Super NES (which had flipping but not rotation): Hand-draw the cels that point north and east, and use only 180 degree sprite flipping (no rotation matrix). Or rotate the sprite cels in software, storing the east cels and creating the north cels from that.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#136440 - Phantaseur - Wed Aug 01, 2007 9:04 pm</h4>
    <div class="postbody"><span class="postbody">But why they did it such way?
<br/>
Didn't they think it's unapplicable and useless?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#136444 - masscat - Wed Aug 01, 2007 9:28 pm</h4>
    <div class="postbody"><span class="postbody">Because they did - there may be some hardware design reason for it. The 2D engine of the NDS is a functionally nearly the same as the GBA (so the design reason may be historic).
<br/>
<br/>
You can rotate and scale sprite like objects (textured polygons) using the 3D hardware on the NDS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#136479 - knight0fdragon - Thu Aug 02, 2007 5:44 am</h4>
    <div class="postbody"><span class="postbody">couldnt he also double the size of the canvas, allowing that extra row to show<br/>_________________<br/><a href="http://www.myspace.com/knight0fdragonds" target="_blank">http://www.myspace.com/knight0fdragonds</a>
<br/>
<br/>
MK DS FC: Dragon 330772 075464 
<br/>
AC WW FC: Anthony SamsClub 1933-3433-9458 
<br/>
MPFH: Dragon 0215 4231 1206</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#136480 - LiraNuna - Thu Aug 02, 2007 5:53 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>knight0fdragon wrote:</b></span></td> </tr> <tr> <td class="quote">couldnt he also double the size of the canvas, allowing that extra row to show</td> </tr></table><span class="postbody">
<br/>
<br/>
The graphics would still be off by 1px, though.<br/>_________________<br/>Private property.
<br/>
Violators will be shot, survivors will be shot again.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
