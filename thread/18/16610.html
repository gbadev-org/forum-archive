<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>EEPROM Problems - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > EEPROM Problems</h2>
<div id="posts">
<div class="post">
    <h4>#168235 - Conutmonky - Thu Apr 16, 2009 9:51 am</h4>
    <div class="postbody"><span class="postbody">Hello world,
<br/>
<br/>
So I am working on saving my game using the EEPROM. I have looked through the forum and found some posts about not using it, but I want to try and so here is what i'm doing:
<br/>
<br/>
	uint8 writeBuffer[6] = "Hello";
<br/>
	uint8 readBuffer[6];
<br/>
	cardWriteEeprom(0, writeBuffer, sizeof(writeBuffer), 2);
<br/>
	cardReadEeprom(0, readBuffer, sizeof(readBuffer), 2);
<br/>
	iprintf("Data is :%s or :%s \n", readBuffer, writeBuffer);
<br/>
<br/>
So the idea was just something very simple. First off, I know the last argument for the Eeprom functions is "type" but i'm not sure which type they are referring to (I think different size eeprom). I also read that many emulators don't support eeprom, but the posts were old and i'm not sure if that is still true considering my  emulator has save options to configure for eeprom. 
<br/>
<br/>
Also, the first argument is the address I believe, and I thought I read 0 would be the beginning of the eeprom but perhaps that isn't true. Should I be getting a file generated from my emulator when I do the cardWriteEeprom?
<br/>
<br/>
I was hoping for either some ideas, or a good place to look, or some help fixing up my code just to get something basic written and retrieved.
<br/>
<br/>
Thanks,
<br/>
Mike</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168378 - josath - Sun Apr 26, 2009 6:12 am</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
EEPROM is only for commercial game carts. The eeprom functions will not work for homebrew in 90% of the flashcarts, so you should not use them. Instead you should use libfat, and create a file on the card. Basically you call fatInitDefault(), and then use the standard C file I/O functions, fopen, fwrite, fread, fclose, etc.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168432 - spinal_cord - Wed Apr 29, 2009 6:56 am</h4>
    <div class="postbody"><span class="postbody">[Hijack] (sorry)
<br/>
<br/>
I am also having eeprom problems, but in conjunction with FAT. I am trying to backup eeprom to a file, but if I  init fat before reading the eeprom, the fat functions don't work. However if I do it after reading the eeprom it works fine.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   fatInitDefault();
<br/>
<br/>
   int cardtype=cardmeGetType();
<br/>
<br/>
   if(cardtype==-1){PA_OutputText(0,3,4,"No card or No EEPROM");}
<br/>
//   if(cardtype==0) {PA_OutputText(0,3,4,"Unknown save type");}
<br/>
//   if(cardtype==1) {PA_OutputText(0,3,4,"You have Save Type 1");}
<br/>
//   if(cardtype==2) {PA_OutputText(0,3,4,"You have Save Type 2");}
<br/>
   if(cardtype==3) {PA_OutputText(0,3,4,"You have Save Type 3");
<br/>
   int i=0;
<br/>
   for (i = 0; i &lt; 262144; i += 8192) {
<br/>
      cardmeReadEeprom(i, saveData + i, 8192, 3);
<br/>
      PA_OutputText(0,3,4,"%d/262144      ",i);
<br/>
   }
<br/>
      PA_OutputText(0,3,4,"Done!                      ",i);
<br/>
<br/>
   PA_OutputText(0,3,5,"Problem."); // if you read this, it crashed :(
<br/>
   
<br/>
   FILE *fp;
<br/>
   fp=fopen("test.dat", "wb");
<br/>
   if(fp){
<br/>
      PA_OutputText(0,3,4,"File Open");
<br/>
      for (i = 0; i &lt; 262144; i += 1) {
<br/>
         fwrite(saveData+i, 1, 1, fp); //8192
<br/>
         PA_OutputText(0,3,5,"%d/262144      ",i); // Just to show something happening
<br/>
      }
<br/>
      fclose(fp);
<br/>
      PA_OutputText(0,3,5,"File Closed");
<br/>
   }
<br/>
} // savetype == 3
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Can anyone suggest what the problem might be? I would really like to restore eeprom from a file also, but not being able to use fat sorta rules that out :(<br/>_________________<br/>I'm not a boring person, it's just that boring things keep happening to me.
<br/>
<a class="postlink" href="http://spinal.dizidesigns.co.uk/" target="_blank">Homepage</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168433 - josath - Wed Apr 29, 2009 7:11 am</h4>
    <div class="postbody"><span class="postbody">What flashcart are you using, is it slot-1 or slot-2, and what DS game cart are you using?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168472 - spinal_cord - Wed Apr 29, 2009 8:17 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>josath wrote:</b></span></td> </tr> <tr> <td class="quote">What flashcart are you using, is it slot-1 or slot-2, and what DS game cart are you using?</td> </tr></table><span class="postbody">
<br/>
<br/>
Currently, i'm trying to use a neoflash mk5, which is a slot-1 card with 2mbit eeprom. Your eepinator (that was you wasn't it?) works fine, so I at least know what it <span style="font-style: italic">should</span> work.<br/>_________________<br/>I'm not a boring person, it's just that boring things keep happening to me.
<br/>
<a class="postlink" href="http://spinal.dizidesigns.co.uk/" target="_blank">Homepage</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168504 - josath - Fri May 01, 2009 10:57 pm</h4>
    <div class="postbody"><span class="postbody">So...you're trying to read from the eeprom inside the mk5, and write to the SD card inside the mk5? That seems pointless, so I must be missing something here.
<br/>
<br/>
Most likely it's not working because the mk5 does something funny, maybe you need some proprietary unlock codes to switch between eeprom and fat usage correctly</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168513 - Conutmonky - Sat May 02, 2009 3:31 am</h4>
    <div class="postbody"><span class="postbody">Alright, with much remorse I will indeed use libfat. Are there any emulators that work with libfat for testing purposes? I tried no$gba and desmume and they both give errors on fatInitDefault. Or should I just do my testing, etc. on a DS?
<br/>
<br/>
Thanks,
<br/>
Mike</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168517 - dantheman - Sat May 02, 2009 6:29 am</h4>
    <div class="postbody"><span class="postbody">The FCSR process lets you build a virtual FAT12 filesystem with your files packed inside, which is appended to the rom file.  This lets you test apps that use Libfat in emulators like no$gba.  Just make sure you search the forums here for a program Dwedit made called AddToDiskImage which is more stable than the "bfi.exe" program normally used to inject files into the FAT12 filesystem.
<br/>
<br/>
Something else you can try:  iDeaS has DLDI support for the R4.  Patch your game with the R4 DLDI file and select the appropriate option in the iDeaS menu.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
