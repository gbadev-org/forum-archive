<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>SWI troubles, still :-( - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > SWI troubles, still :-(</h2>
<div id="posts">
<div class="post">
    <h4>#123876 - SpacedCowboy - Sun Apr 01, 2007 2:16 am</h4>
    <div class="postbody"><span class="postbody">I've got gdb/desmume working on my mac (see <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=12818" target="_blank">previous post</a>), but I'm still having problems with SWI statements... Can anyone take a peek at the following gdb session, and see if they've come across something similar ? I just don't get it :-(
<br/>
<br/>
I step through up until the call to testSWI(), then stepi through that call, and it seems to just completely ignore the swi statement (!)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
(gdb) step
<br/>
main () at template.c:49
<br/>
49          testSWI();
<br/>
Current language:  auto; currently c
<br/>
(gdb) stepi
<br/>
49          testSWI();
<br/>
(gdb) 
<br/>
0x0200028c      49         testSWI();
<br/>
(gdb) 
<br/>
0x02004ed4 in __testSWI_from_thumb ()
<br/>
(gdb) 
<br/>
0x02004ed4 in __testSWI_from_thumb ()
<br/>
(gdb) 
<br/>
0x02004ed8 in __testSWI_change_to_arm ()
<br/>
(gdb) 
<br/>
0x02004ed8 in __testSWI_change_to_arm ()
<br/>
(gdb) 
<br/>
testSWI () at init.s:126
<br/>
126             swi             0x8b8b8b
<br/>
Current language:  auto; currently asm
<br/>
(gdb) 
<br/>
127         bx      lr
<br/>
(gdb) 
<br/>
127         bx      lr
<br/>
(gdb) 
<br/>
main () at template.c:50
<br/>
50          setUpScreen();
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
the assembly for 'testSWI' is defined as:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
testSWI:
<br/>
   swi      0x8b8b8b
<br/>
   bx       lr
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
... what I expected to happen was for the pc to be set to 0x08 and the ARM to jump through my vector to my handler code. I have that working for interrupts, the arm9 just doesn't seem to be processing SWI code (!)
<br/>
<br/>
Here's another gdb session, where I put a breakpoint at 0x08 (the SWI vector) and nothing gets called. When I put a 2nd breakpoint at 0x18 (the IRQ vector) that stops because I have VBLANK interrupts enabled...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
(gdb) break *0x08
<br/>
Breakpoint 1 at 0x8
<br/>
(gdb) target remote localhost:20001
<br/>
Remote debugging using localhost:20001
<br/>
_start () at ds_arm9_itcm0000_crt0.s:13
<br/>
13          mov     r0, #0x04000000         @ IME = 0; 
<br/>
Current language:  auto; currently asm
<br/>
(gdb) continue
<br/>
Continuing.
<br/>
^C
<br/>
Program received signal SIGINT, Interrupt.
<br/>
0x0200125a in _vfiprintf_r ()
<br/>
(gdb) break *0x18
<br/>
Breakpoint 2 at 0x18
<br/>
(gdb) continue
<br/>
Continuing.
<br/>
<br/>
Breakpoint 2, 0x00000018 in ?? ()
<br/>
(gdb) disass 0x00 0x20
<br/>
Dump of assembler code from 0x0 to 0x20:
<br/>
0x00000000:     b       0x24
<br/>
0x00000004:     b       0x28
<br/>
0x00000008:     b       0x64
<br/>
0x0000000c:     b       0x2c
<br/>
0x00000010:     b       0x30
<br/>
0x00000014:     andeq   r0, r0, r0
<br/>
0x00000018:     b       0x3c
<br/>
0x0000001c:     b       0x34
<br/>
End of assembler dump.
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
So, I don't really see why SWI isn't working when the vector 16-bytes further on works fine. I was wondering if it was something to do with the arm/thumb routines that gcc seems to be jumping through... There is a call to testSWI in the inner loop of the test-app, by the way, so it ought to be jumping to the SWI vector over and over again! 
<br/>
<br/>
Any help appreciated :-)
<br/>
<br/>
Simon</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123883 - SpacedCowboy - Sun Apr 01, 2007 3:38 am</h4>
    <div class="postbody"><span class="postbody">I had originally set the background to mode-0, not mode-5, so my (debugging) blue dot wasn't appearing. As soon as I rectified that, the blue-dot appears on-screen in the non-gdb version of desmume (and on the hardware itself). It doesn't appear on-screen with the gdb-version of desmume :-(
<br/>
<br/>
So, it looks as though it was an issue with gdb and the version of desmume that understands remote debugging via gdb, or somehow it screwed up because it's compiled for a Mac.
<br/>
<br/>
Well, at least I have SWI working, even if I can't debug them ....
<br/>
<br/>
Simon.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123947 - masscat - Sun Apr 01, 2007 11:35 pm</h4>
    <div class="postbody"><span class="postbody">I have posted a reply in your <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=12818" target="_blank">other thread</a>.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
