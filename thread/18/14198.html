<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>DS to DS communication: need tests - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > DS to DS communication: need tests</h2>
<div id="posts">
<div class="post">
    <h4>#141176 - phhusson - Sat Sep 22, 2007 11:33 pm</h4>
    <div class="postbody"><span class="postbody">Hi there,
<br/>
I searched a bit for direct DS to DS communication (without any AP or any other wifi device) and looks like nobody did.
<br/>
So I tried to do some, I succeeded to send some home made wifi packets from the DS to my computer in Monitor mode, but I didn't success in sending packets from my computer...
<br/>
So I need someone owning two DSes (or someone who knows someone else having a DS too) to test my library:
<br/>
Here's a sample binary: <a class="postlink" href="http://phhusson.free.fr/ChatNifi.nds" target="_blank">http://phhusson.free.fr/ChatNifi.nds</a> and source code available at <a class="postlink" href="http://phhusson.free.fr/ChatNifi.tar" target="_blank">http://phhusson.free.fr/ChatNifi.tar</a>
<br/>
<br/>
To test it simply start the two DS (you can do that with only one linker, starting the app then putting the linker in the other DS), and launch the app.
<br/>
Now press A or B and see what happens on other DS
<br/>
<br/>
More technicaly speaking:
<br/>
Channel is hardcoded to 5, "Known" packets are show on bottom screen, unknown on the top one.
<br/>
At the moment i suppose all packets with BSSID starting by 99 are known ones (I will make it better later).
<br/>
So I'm pretty sure sending packets works (you can check it with any wifi sniffer), now i would like to know if it works (if pressed A you will see plop, if B you will see NON).
<br/>
Note if someone wants to use it to make a direct DS-DS game, you can use the lib.c file, the functions name are enough explicit.
<br/>
What you send with SendMessage should appear as is in getPackets on other side.
<br/>
It should work without any problem with much than 2 DS (if it works with 2).
<br/>
<br/>
So please try it and leave a comment to know if it works or not, and if not i'd like to have a wifi dump of channel 5 during the test.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141182 - spinal_cord - Sun Sep 23, 2007 12:35 am</h4>
    <div class="postbody"><span class="postbody">Just tried it, I only got "Got unknown packet from 255:255" a bunch of times down the screen.
<br/>
<br/>
Nothing happened when I pressed A or B. Does it matter that I was in range of my AP?<br/>_________________<br/>I'm not a boring person, it's just that boring things keep happening to me.
<br/>
<a class="postlink" href="http://spinal.dizidesigns.co.uk/" target="_blank">Homepage</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141190 - zazery - Sun Sep 23, 2007 2:54 am</h4>
    <div class="postbody"><span class="postbody">I tried it using the following equipment:
<br/>
<br/>
DS1: Nintendo DS firmware v1, flashme, GBAMPv2
<br/>
DS2: Nintendo DS Lite, R4DS
<br/>
<br/>
I'm seeing the same result as spinal_cord. I did notice DS1 is receiving twice as many packets compared to DS2 though. Probably due to the different hardware.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141194 - dantheman - Sun Sep 23, 2007 3:21 am</h4>
    <div class="postbody"><span class="postbody"><a href="http://forum.gbadev.org/viewtopic.php?t=11946" target="_blank">http://forum.gbadev.org/viewtopic.php?t=11946</a> may help some.  The last few pages have the latest downloads, though I don't know if source is included or not.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141230 - simonjhall - Sun Sep 23, 2007 10:09 am</h4>
    <div class="postbody"><span class="postbody">Sorry man - three DS' here (one old phat, one new phat, one old lite) and three screens covered in the 255:255 message, regardless of however many DS' have been turned on or had their buttons pressed etc!
<br/>
I am sitting right next to an AP which is turned on though - will this make any difference?<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141236 - melw - Sun Sep 23, 2007 11:47 am</h4>
    <div class="postbody"><span class="postbody">No luck here either.
<br/>
<br/>
I did some tests with the source, changing destination MAC address to broadcast and the sniffer I used (CommView for WiFi / Win32) recognized everything the DS sent as 802.2 protocol packets (src MAC corresponding the DS, dest MAC being "broadcast"). This because the broadcast messages sent from my AP did go through to the DS's.
<br/>
<br/>
It seems like the packets sent by DS just never reach the PacketCaptureHandler in the other end. Something wrong with the packets, channel or transfer speed?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141237 - moncul - Sun Sep 23, 2007 12:33 pm</h4>
    <div class="postbody"><span class="postbody">you  may have the same problem as me. The promiscuous mode is not really a promiscuous mode :
<br/>
- if not associated to an AP, you'll only get beacon frames.
<br/>
- if associaed with AP, you'll get all
<br/>
<br/>
you can tweak with some register values to get more traffic being unassociated, but i never succeeded in capturing ALL traffic (for instance : the WEP-encrypted one i needed for aircrack).
<br/>
a bit more info here :
<br/>
<a class="postlink" href="http://www.1emulation.com/forums/index.php?showtopic=22649" target="_blank">http://www.1emulation.com/forums/index.php?showtopic=22649</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141238 - melw - Sun Sep 23, 2007 12:50 pm</h4>
    <div class="postbody"><span class="postbody">Another pointer: You will indeed receive beacon frames, also from other DS's. In other words, first a beacon frame should be sent, received and ACK'ed before proceeding further.
<br/>
<br/>
I checked what kind of beacons commercial DS games send and you can get your initial packets through by changing framehdr[0] to 0x80 and using broadcast SSID (0xff all of your BSSID), both from and to DS MAC address can be set to the MAC address of the sending DS. I don't know if this is according to 802.11 specifications, but at least this is how the New Super Mario Brothers sends local wireless game beacons. 
<br/>
<br/>
See also <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?p=140003#140003" target="_blank">MightyMax's tips</a> on this subject.
<br/>
<br/>
Edit: I don't have right now time to test this any further, but here's a modified and unfinished test application based on phhusson's code, sending beacon frames (non-PAlib + recognizes DS from sender MAC address): <a class="postlink" href="http://dicewars.drunkencoders.com/ChatNifi2.nds" target="_blank">nds</a> + <a class="postlink" href="http://dicewars.drunkencoders.com/ChatNifi2.zip" target="_blank">sources</a>.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141244 - phhusson - Sun Sep 23, 2007 2:17 pm</h4>
    <div class="postbody"><span class="postbody">Ok, Great thanks for tests, informations and new source code.
<br/>
If i remember good, sgstair once said to make a connect/disconnect to a fake AP to be able to make a sort of BSSID filtering (which is what i want too so each game could have a different BSSID and won't cause problems), and to get non-beacon packets i suppose.
<br/>
I will try to code it (and i will see if my packet injection does actually works ....).
<br/>
<br/>
But i wonder: it seems the acknowledge about direct DS to DS coding is enough, so why nobody wrote a true DS2DS network library ?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141245 - moncul - Sun Sep 23, 2007 2:36 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>phhusson wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
But i wonder: it seems the acknowledge about direct DS to DS coding is enough, so why nobody wrote a true DS2DS network library ?</td> </tr></table><span class="postbody">
<br/>
<br/>
well. i only have one DS (and i'm not sure to succeed too !)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141249 - calcprogrammer1 - Sun Sep 23, 2007 3:45 pm</h4>
    <div class="postbody"><span class="postbody">I'll test it later today, my friend also has a Games n' Music.  He has a DS Lite with new WiFi, though, so if it uses old WiFi library it probably won't work at all.<br/>_________________<br/>DS Firmware 1, Datel Games n' Music card / Chism's FW hacked GBA MP v2 CF
<br/>
<br/>
There's no place like 127.0.0.1.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141259 - phhusson - Sun Sep 23, 2007 4:45 pm</h4>
    <div class="postbody"><span class="postbody">Don't even try mine calcprogrammer1 it would be a waste of time.
<br/>
But you can try the one of melw.
<br/>
For the DSWifi version it should be right.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141273 - Mighty Max - Sun Sep 23, 2007 7:10 pm</h4>
    <div class="postbody"><span class="postbody">I can share my little test i had created when i first poked the wifi recently. The code is an ugly copy&amp;paste from different resources on the PC side (its PC to DS without AP, but you should have no problem to create the same packets from the DS for DS2DS
<br/>
<br/>
Start off, by using the wifime driver for the ralink. There is a echo example on receiving/sending data. The main.cpp now looks
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
// windows
<br/>
#include &lt;windows.h&gt;
<br/>
#include &lt;ntddndis.h&gt;
<br/>
// standard
<br/>
#include &lt;conio.h&gt;
<br/>
#include &lt;stdio.h&gt;
<br/>
// other
<br/>
#include "device.h"
<br/>
<br/>
#define BIGENDIAN(n)      ((((unsigned long)(n) &gt;&gt; 24) &amp; 0xFF) | (((unsigned long)(n) &gt;&gt; 8) &amp; 0xFF00) | (((unsigned long)(n) &lt;&lt; 8) &amp; 0xFF0000) | (((unsigned long)(n) &lt;&lt; 24) &amp; 0xFF000000))
<br/>
<br/>
<br/>
<br/>
#define CRC32POLY 0x04C11DB7 /* CRC-32 Polynom */
<br/>
#define CRC32POLYREV 0xEDB88320 /* CRC-32 Polynom, umgekehrte Bitfolge */
<br/>
   
<br/>
int datastream[]={1,0,0,0,1,1,0,0};
<br/>
int databits=8;
<br/>
   
<br/>
unsigned int crc32; /* Shiftregister */
<br/>
unsigned int crc32_rev ; /* Shiftregister */
<br/>
void calc_crc32(int bit)
<br/>
{   
<br/>
   int hbit;       
<br/>
   hbit=(crc32 &amp; 0x80000000) ? 1 : 0;
<br/>
   if (hbit != bit)
<br/>
      crc32=(crc32&lt;&lt;1) ^ CRC32POLY;
<br/>
   else
<br/>
      crc32=crc32&lt;&lt;1;
<br/>
}
<br/>
<br/>
void calc_crc32_rev(int bit)
<br/>
   {   int lbit;
<br/>
       lbit=crc32_rev &amp; 1;
<br/>
       if (lbit != bit)
<br/>
            crc32_rev=(crc32_rev&gt;&gt;1) ^ CRC32POLYREV;
<br/>
       else
<br/>
            crc32_rev=crc32_rev&gt;&gt;1;
<br/>
   }
<br/>
<br/>
<br/>
//------------------------------------------------------------------------------
<br/>
void DeviceReadPacketCallback( PDEVICE_INFO lpDeviceInfo, PUCHAR lpBufferData, ULONG dwBufferSize)
<br/>
{
<br/>
   PUCHAR lpFrameData;
<br/>
   ULONG dwFrameSize;
<br/>
   BOOL bOK;
<br/>
   // visual indicator that we received something
<br/>
   printf( ".");
<br/>
   // skip avs wlan header
<br/>
   if (*(ULONG*)(lpBufferData + 0) == _byteswap_ulong( 0x80211001))
<br/>
   {
<br/>
      lpFrameData = lpBufferData + _byteswap_ulong( *(ULONG*)(lpBufferData + 4));
<br/>
      dwFrameSize = dwBufferSize - _byteswap_ulong( *(ULONG*)(lpBufferData + 4));
<br/>
   }
<br/>
   else
<br/>
   {
<br/>
      lpFrameData = lpBufferData + 0;
<br/>
      dwFrameSize = dwBufferSize - 0;
<br/>
   }
<br/>
   // write packet
<br/>
//   bOK = DeviceWritePacket( lpDeviceInfo, lpFrameData, dwFrameSize);
<br/>
   if ((lpFrameData[1] == 0) &amp;&amp; (lpFrameData[0] == 0x80))
<br/>
   {
<br/>
//      return ;
<br/>
   }
<br/>
   printf("RECV: \n") ;
<br/>
   crc32 = 0 ;
<br/>
   crc32_rev = ~0 ;
<br/>
   for (int i=0;i&lt;dwFrameSize-4;i++)
<br/>
   {
<br/>
      printf("%02X",lpFrameData[i]) ;
<br/>
      for (int q=0;q&lt;8;q++)
<br/>
      {
<br/>
         calc_crc32_rev((lpFrameData[i] &amp; (1&lt;&lt;q))!=0) ;
<br/>
         calc_crc32((lpFrameData[i] &amp; (1&lt;&lt;q))!=0) ;
<br/>
      }
<br/>
   }
<br/>
   printf("\nCRC: %X / %X / %X\n",crc32,~crc32_rev, *(unsigned long *)(lpFrameData + dwFrameSize-4)) ;
<br/>
   printf("\n") ;
<br/>
}
<br/>
<br/>
void SendHelloWorld(PDEVICE_INFO lpDeviceInfo)
<br/>
{
<br/>
   UCHAR frame[] = {   0x08,0x02,00,00,               /* data */
<br/>
                  0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,      /* to */
<br/>
                  0x12,0x34,0x56,0x78,0x9A,0xBC,      /* from */
<br/>
                  0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,      /* bss */
<br/>
                  0x00,0x00,
<br/>
                  0xAA,0xAA,0x03,0x00,0x00,0x00,0x08,0xff, /* snap, protocol 0x08FF (unknwon, but in ip related) */
<br/>
                  'H','e','l','l','o',',',' ','W','o','r','l','d',0,
<br/>
                  0,0,0,0   /* crc */
<br/>
               } ;
<br/>
<br/>
   int dwFrameSize = sizeof(frame) ;
<br/>
   PUCHAR lpFrameData = &amp;frame[0] ;
<br/>
   crc32 = 0 ;
<br/>
   crc32_rev = ~0 ;
<br/>
   for (int i=0;i&lt;dwFrameSize-4;i++)
<br/>
   {
<br/>
      printf("%02X",lpFrameData[i]) ;
<br/>
      for (int q=0;q&lt;8;q++)
<br/>
      {
<br/>
         calc_crc32_rev((lpFrameData[i] &amp; (1&lt;&lt;q))!=0) ;
<br/>
         calc_crc32((lpFrameData[i] &amp; (1&lt;&lt;q))!=0) ;
<br/>
      }
<br/>
   }
<br/>
<br/>
   *(unsigned long *)(frame+sizeof(frame)-4) = ~crc32_rev ;
<br/>
<br/>
   if (!DeviceWritePacket(lpDeviceInfo,frame,sizeof(frame)))
<br/>
   {
<br/>
      printf("failed to send") ;
<br/>
   } else {
<br/>
      printf("#") ;
<br/>
   }
<br/>
}
<br/>
<br/>
//------------------------------------------------------------------------------
<br/>
int main( int argc, char *argv[])
<br/>
{
<br/>
   BOOL bOK;
<br/>
   DEVICE_INFO DeviceInfo;
<br/>
   UCHAR mac[6];
<br/>
   int key;
<br/>
   USHORT ver[4];
<br/>
   // application title
<br/>
   printf( "\n");
<br/>
   //
<br/>
   ZeroMemory( &amp;DeviceInfo, sizeof( DeviceInfo));
<br/>
   // find device
<br/>
   bOK = DeviceFind( &amp;DeviceInfo, 0);
<br/>
   if (!bOK)
<br/>
   {
<br/>
      printf( "DeviceFind() failed\n");
<br/>
      return 0;
<br/>
   }
<br/>
   // get driver version
<br/>
   memset( ver, 0, sizeof( ver));
<br/>
   bOK = DeviceGetDriverVersion( &amp;DeviceInfo, ver);
<br/>
   if (!bOK) printf( "DeviceGetDriverVersion() failed\n");
<br/>
   // device info
<br/>
   printf( "Device Description = %s\n", DeviceInfo.Description);
<br/>
   printf( "Device Hardware ID = %s\n", DeviceInfo.HardwareID);
<br/>
   printf( "Device Location    = %s\n", DeviceInfo.Location);
<br/>
   printf( "Driver Version     = %d.%d.%d.%d\n", ver[0], ver[1], ver[2], ver[3]);
<br/>
   printf( "\n");
<br/>
   // open device
<br/>
   bOK = DeviceOpen( &amp;DeviceInfo);
<br/>
   if (!bOK)
<br/>
   {
<br/>
      printf( "DeviceOpen() failed\n");
<br/>
      return 0;
<br/>
   }
<br/>
   // set packet filter
<br/>
   bOK = DeviceSetPacketFilter( &amp;DeviceInfo, NDIS_PACKET_TYPE_PROMISCUOUS);
<br/>
   if (!bOK) printf( "DeviceSetPacketFilter() failed\n");
<br/>
   // get mac address
<br/>
   memset( &amp;mac[0], 0, sizeof( mac));
<br/>
   bOK = DeviceGetMacAddress( &amp;DeviceInfo, mac);
<br/>
   if (!bOK) printf( "DeviceGetMacAddress() failed\n");
<br/>
   // set channel
<br/>
   bOK = DeviceSetChannel( &amp;DeviceInfo, 10);
<br/>
   if (!bOK) printf( "DeviceSetChannel() failed\n");
<br/>
   // install ReadPacket callback function
<br/>
   bOK = DeviceSetReadPacketCallback( &amp;DeviceInfo, DeviceReadPacketCallback);
<br/>
   if (!bOK) printf( "DeviceSetReadPacketCallback() failed\n");
<br/>
   // start receive thread
<br/>
   bOK = DeviceThreadReceiveStart( &amp;DeviceInfo);
<br/>
   if (!bOK) printf( "DeviceThreadReceiveStart() failed\n");
<br/>
   // wait for key
<br/>
   printf( "Press [x] to abort\n");
<br/>
   key = 0;
<br/>
   while (key != 'x')
<br/>
   {
<br/>
      Sleep( 10);
<br/>
      if (kbhit()) key = getch();
<br/>
      switch (key)
<br/>
      {
<br/>
         case 'h':
<br/>
            SendHelloWorld(&amp;DeviceInfo) ;
<br/>
            key = 0 ;
<br/>
            break ;
<br/>
      }
<br/>
   }
<br/>
   // stop receive thread
<br/>
   bOK = DeviceThreadReceiveStop( &amp;DeviceInfo);
<br/>
   if (!bOK) printf( "DeviceThreadReceiveStop() failed\n");
<br/>
   // remove packet filter
<br/>
   bOK = DeviceSetPacketFilter( &amp;DeviceInfo, 0);
<br/>
   if (!bOK) printf( "DeviceSetPacketFilter() failed\n");
<br/>
   // close device
<br/>
   bOK = DeviceClose( &amp;DeviceInfo);
<br/>
   if (!bOK) printf( "DeviceClose() failed\n");
<br/>
   // exit
<br/>
   return 0;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
The other files are not modified.
<br/>
<br/>
<br/>
For the DS side, use <a href="http://mightymax.org/libwifi.nds" target="_blank">http://mightymax.org/libwifi.nds</a> . [A] switches the channels. Select Channel 10 on the DS. A keypress on [h] on the PC should send the "Hello World" on channel 10 string to the DS displaying it there. (At least it works here :D)
<br/>
<br/>
You may change the text in the frame and have the changed text displayed on the DS.
<br/>
<br/>
However, there are still problems with the receiving, sometimes the wifi hardware seems not to initialize correctly. Usually switching through the channels fixes this. 
<br/>
<br/>
There should be no problem in sending the frame[] from another DS.
<br/>
<br/>
Hope that helps.
<br/>
<br/>
PS: The libwifi.ds logs all transfers (receive &amp; transmit) in the file. "Wifi.apc" a hexeditor helps here, its not a valid wireshark capture format even if it says so by the extention. [START] stops the receiving/logging and finalizes the file<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141285 - zazery - Sun Sep 23, 2007 8:27 pm</h4>
    <div class="postbody"><span class="postbody">Some interesting results with melw's modifications. Both DS's can receive and transmit messages. If I left a DS on for around 5 minutes, it would no longer receive messages. It was still able to transmit messages. Here is the output of both DS's sending and receiving one packet.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">DS1:
<br/>
Hello DS dev'rs
<br/>
<a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a>
<br/>
checking wifi preinit...
<br/>
wifi preinit done
<br/>
wifi enabled
<br/>
channel set
<br/>
own mac:   0: 9:BF: A:DE:E1
<br/>
DS data from: 0:19:FD:83:CA:55: plop?
<br/>
Send message 'plop'
<br/>
send raw tx frame
<br/>
<br/>
DS2:
<br/>
Hello DS dev'rs
<br/>
<a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a>
<br/>
checking wifi preinit...
<br/>
wifi preinit done
<br/>
wifi enabled
<br/>
channel set
<br/>
own mac:   0:19:FD:83:CA:55
<br/>
Send message 'plop'
<br/>
send raw tx frame
<br/>
DS data from: 0: 9:BF: A:DE:E1</td> </tr></table><span class="postbody">
<br/>
It is picking up packets from my Wii which has Connect24 turned on. For example:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">DS data from: 0:17:AB:46:4F: 1:</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141294 - yellowstar - Sun Sep 23, 2007 9:17 pm</h4>
    <div class="postbody"><span class="postbody">I tested it,(melw's mod)
<br/>
but it didn't work right either.
<br/>
<br/>
It wouldn't boot correctly with my DS-X.
<br/>
So, I tried using DS Organize,
<br/>
to boot it.(via crishm's loader)
<br/>
That worked.(But, the top screen was white.)
<br/>
(The only thing on any of the WiFi channels were
<br/>
the DSes.)
<br/>
<br/>
Here's what happened when I tested
<br/>
it with a original DS, and a DS Lite.
<br/>
<br/>
After either system sent 2 packets,
<br/>
they stopped sending the packets correctly.
<br/>
That is, they weren't detected by the other DS.
<br/>
<br/>
<br/>
Here's what happened when I tested it
<br/>
with the same setup as above,(a original DS and a Lite.)
<br/>
except with an additional,
<br/>
original DS.
<br/>
<br/>
After one DS sent one or two packets,
<br/>
it stopped sending them correctly.
<br/>
That is, they didn't get detected by
<br/>
the other systems.
<br/>
<br/>
But, after that happened,
<br/>
when I tried sending packets on
<br/>
the other systems,
<br/>
it did the same thing.
<br/>
<br/>
It kept going this way.
<br/>
That is, one DS stopped sending correctly,
<br/>
then tried the others,
<br/>
they did the same,
<br/>
and the first one did the same,
<br/>
and so on.</span><span class="gensmall"><br/><br/>Last edited by yellowstar on Mon Oct 01, 2007 7:40 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#141296 - melw - Sun Sep 23, 2007 9:23 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>phhusson wrote:</b></span></td> </tr> <tr> <td class="quote">But i wonder: it seems the acknowledge about direct DS to DS coding is enough, so why nobody wrote a true DS2DS network library ?</td> </tr></table><span class="postbody">
<br/>
Don't know about the rest, but personally I don't have much of experience in network programming, and previously estimates on getting homebrew DS to DS networking done varied from hard to impossible, which again didn't encourage on working on this. :)
<br/>
<br/>
But perhaps we can pull this together... At least I'm willing to help wherever I can. Continuing the tests when time permits.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>zazery wrote:</b></span></td> </tr> <tr> <td class="quote">It is picking up packets from my Wii which has Connect24 turned on.</td> </tr></table><span class="postbody">
<br/>
Ahhah. Yes, of course. MAC address in Nintendo range doesn't always mean it's a DS sending data.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141300 - phhusson - Sun Sep 23, 2007 10:20 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>melw wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>phhusson wrote:</b></span></td> </tr> <tr> <td class="quote">But i wonder: it seems the acknowledge about direct DS to DS coding is enough, so why nobody wrote a true DS2DS network library ?</td> </tr></table><span class="postbody">
<br/>
Don't know about the rest, but personally I don't have much of experience in network programming, and previously estimates on getting homebrew DS to DS networking done varied from hard to impossible, which again didn't encourage on working on this. :)
<br/>
<br/>
But perhaps we can pull this together... At least I'm willing to help wherever I can. Continuing the tests when time permits.
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
My experience in network programming isn't big either,and i never tried to put a game to network, but many homebrew games are already networked (like dicewars or quake ds), and i think they only need a simple way to send and retrieve packets multicasted and unicasted to DSes. The only problems i see are to succeed to retrieve all packets of a BSSID (or more if we filter after), then we will "just" need to add optional ACK support (checksum are already hardware managed \o/), and i guess it won't be that hard. But we would first can do things without it (for instance with quake, it usually uses UDP which has the same problems than wifi, packet loss but checksums automatically checked/formated).
<br/>
So your actual code could be enough for quake DS (mm right it would need more filtering).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141323 - Opus - Mon Sep 24, 2007 2:37 am</h4>
    <div class="postbody"><span class="postbody">Sorry, wrong topic.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141328 - calcprogrammer1 - Mon Sep 24, 2007 3:51 am</h4>
    <div class="postbody"><span class="postbody">I tried at my friend's house, but it didn't work.  It just kept saying something about 255:255 (I forget what it said) but pressing A and B didn't do anything.
<br/>
<br/>
My DS:
<br/>
DS "Phat" (silver) Firmware Version 1, release-week
<br/>
Datel Games n' Music with stock 128MB microSD
<br/>
<br/>
His DS:
<br/>
DS Lite (black) DS Lite Firmware, "incompatible" WiFi chipset
<br/>
Datel Games n' Music with SanDisk 1GB microSD<br/>_________________<br/>DS Firmware 1, Datel Games n' Music card / Chism's FW hacked GBA MP v2 CF
<br/>
<br/>
There's no place like 127.0.0.1.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141342 - melw - Mon Sep 24, 2007 9:03 am</h4>
    <div class="postbody"><span class="postbody">I played around with the test application a bit: <a class="postlink" href="http://dicewars.drunkencoders.com/ChatNifi2.nds" target="_blank">updated nds download</a>. This version breaks the 802.11 protocol in many ways, thus no source update. But at least some data does get through.
<br/>
<br/>
A - send a beacon frame
<br/>
B - send a 802.2 data frame (only possible when a connection is been made between 2 DS's)
<br/>
<br/>
I'll go reading 802.3 SNAP specifications next... MightyMax, any chance of sharing you libwifi.nds source?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141356 - ThomasS - Mon Sep 24, 2007 2:21 pm</h4>
    <div class="postbody"><span class="postbody">melw, your latest test works on my DSs, however each of them can receive (after sending 1 becon frame with A) only 5 data frames sent with B from the other, then nothing more is received. Anyways, keep up the great work!
<br/>
<br/>
Hardware:
<br/>
2 silver "Phat" DS, both with Supercard SD<br/>_________________<br/>&lt;<a class="postlink" href="http://palib.info/forum/modules/newbb/viewtopic.php?viewmode=flat&amp;type=&amp;topic_id=3108&amp;forum=10" target="_blank">dsFont</a>&gt; &lt;<a class="postlink" href="http://palib.info/forum/modules/newbb/viewtopic.php?topic_id=2451&amp;forum=9" target="_blank">Game Collection</a>&gt;</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141358 - melw - Mon Sep 24, 2007 2:43 pm</h4>
    <div class="postbody"><span class="postbody">Follow-up questions for MightyMax: I tried your modified wifime echo main... But can't get any of the packets sent from there to show up in the DS end. If I send exactly same kind of data frame from DS, the PC app picks up the frame, but again no other DS seem to be receiving it.
<br/>
<br/>
The above behavior when using my own source in DS end, libwifi.nds keeps crashing constantly for me. Are there any specific DS wifi settings that should be used here?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141360 - Mighty Max - Mon Sep 24, 2007 4:48 pm</h4>
    <div class="postbody"><span class="postbody">I had no problem receiving the dataframes sent by the DS. (once the CRC was correctly, otherwise the DS rejected the frames)e
<br/>
<br/>
I have packed the sources as-is to <a href="http://mightymax.org/libwifi.rar" target="_blank">http://mightymax.org/libwifi.rar</a> .<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141372 - phhusson - Mon Sep 24, 2007 8:06 pm</h4>
    <div class="postbody"><span class="postbody">Do we really need to implement 802.11 ?
<br/>
I mean just some hacks would be enough.
<br/>
As the one from melw with beacons, even if it would be better to have some hardware filtering using BSSID (i will take a look for it)
<br/>
Note:Mighty Max's code is interesting in understanding 802.11</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141378 - Mighty Max - Mon Sep 24, 2007 8:47 pm</h4>
    <div class="postbody"><span class="postbody">It is at least partly needed in order to not break devices in range following the standard. Espacially in breadcasts try to ensure that no device might disinterprete your packets.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141391 - phhusson - Mon Sep 24, 2007 10:27 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">It is at least partly needed in order to not break devices in range following the standard. Espacially in breadcasts try to ensure that no device might disinterprete your packets.</td> </tr></table><span class="postbody">
<br/>
Hum right,will there be any problem if we use a "false" broadcast bssid ? (for example i thaught of using 99:98:97:XX:XX:XX which would be 00:00:00 for game discovery, first XX:XX identify the game and last digits sets a room).
<br/>
<br/>
I look deeper in DSWifi source code and it looks like that was i read from sgstair is true: the only way in DSWifi to change current BSSID (by default it's FF:FF:FF:FF:FF that's why it only gets beacon packets) is to fake a connection in adhoc not to send false open auth, or a normal connection which would be closed just after opening it to avoid too many auth packets, if wifi doesn't gets down the bssid will remain.
<br/>
So this Q&amp;D workaround is possible, another would be to patch dswifi, which wouldn't be that hard i think but at the moment I don't really know how to synchronise arm7 and arm9</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141430 - melw - Tue Sep 25, 2007 10:59 am</h4>
    <div class="postbody"><span class="postbody">Yes, sending beacons and broadcasts all the time might mess up wireless networks. What I tried in that nifichat2.nds shouldn't be done and it won't work for steady connections anyways. Broadcasts are just for advertising that you're alive and waiting for a connection - the rest should go according to set protocols.
<br/>
<br/>
Phhusson, Then again at least beacon broadcasts with bssid set to source MAC go through. That should be enough for the receiving end to set the bssid accordingly and continue from there. I don't think using false broadcast id's would help in the long run anyways - just filtering the non-Nintendo MAC's out should be enough.
<br/>
<br/>
Currently I feel like banging my head into a thick wall, zero progress in getting any DS to DS packets going through, where as DS to PC works - it may be indeed that the DS wifi (either the library or hardware) is discarding packets right away. The CRC for the frame is calculated and should be correct (compared the PC echo frames to what DS is sending), but obviously I'm doing something else wrong.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141466 - HyperHacker - Tue Sep 25, 2007 10:34 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>melw wrote:</b></span></td> </tr> <tr> <td class="quote">I don't think using false broadcast id's would help in the long run anyways - just filtering the non-Nintendo MAC's out should be enough.</td> </tr></table><span class="postbody">But what happens when they add new ranges? Every time Nintendo changes the wifi hardware, they change the MAC range.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141497 - melw - Wed Sep 26, 2007 8:57 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>melw wrote:</b></span></td> </tr> <tr> <td class="quote">I don't think using false broadcast id's would help in the long run anyways - just filtering the non-Nintendo MAC's out should be enough.</td> </tr></table><span class="postbody">But what happens when they add new ranges? Every time Nintendo changes the wifi hardware, they change the MAC range.</span></td> </tr></table><span class="postbody">
<br/>
There are currently 11 known ranges which are registered to Nintendo. I haven't really followed this from the beginning, but I'd assume they were registered quite a while ago, and there won't be any other MAC address ranges to be used besides the ones listed below. Out of these 11 ranges I've seen so far 7 in use for Nintendo DS. 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">00:09:BF:XX:XX:XX
<br/>
00:16:56:XX:XX:XX
<br/>
00:17:AB:XX:XX:XX
<br/>
00:19:1D:XX:XX:XX
<br/>
00:19:FD:XX:XX:XX
<br/>
00:1A:E9:XX:XX:XX
<br/>
00:1B:7A:XX:XX:XX
<br/>
00:1B:EA:XX:XX:XX
<br/>
00:1C:BE:XX:XX:XX
<br/>
00:1D:BC:XX:XX:XX
<br/>
00:1E:35:XX:XX:XX
<br/>
</td> </tr></table><span class="postbody">
<br/>
(<a class="postlink" href="http://standards.ieee.org/regauth/oui/oui.txt" target="_blank">source</a>)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141521 - phhusson - Wed Sep 26, 2007 5:32 pm</h4>
    <div class="postbody"><span class="postbody">I got some results, i succeed to receive packets with a specific BSSID, but only non data packets ...
<br/>
It seems DS hardware filter it, but i don't understand why, i should miss a Wifi register but don't know which one :/
<br/>
<br/>
(If anyone is interested by a little C program for linux to inject homemade packets, just ask me)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141529 - Mighty Max - Wed Sep 26, 2007 6:27 pm</h4>
    <div class="postbody"><span class="postbody">Check my sources espacially the wifi init, i did some modification to the method described on akkit.
<br/>
<br/>
One is to listen in mode 3 upfrom the start (dswifi starts in mode 2) and not only when trying to connect. Also changed are values to a register that is thought to be some kind of filter select (Base+0x0D0)
<br/>
<br/>
I have also disabled the stats (base + 0x1AE) alltogether, as their IRQ was often the last thing i was regognizing before the receiving went silent.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141629 - phhusson - Thu Sep 27, 2007 8:31 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">Check my sources espacially the wifi init, i did some modification to the method described on akkit.
<br/>
<br/>
One is to listen in mode 3 upfrom the start (dswifi starts in mode 2) and not only when trying to connect. Also changed are values to a register that is thought to be some kind of filter select (Base+0x0D0)
<br/>
<br/>
I have also disabled the stats (base + 0x1AE) alltogether, as their IRQ was often the last thing i was regognizing before the receiving went silent.</td> </tr></table><span class="postbody">
<br/>
I will try, but is there a meaning of this 3 or 2 ?
<br/>
Looking at dswifi source code it sets it to 2 at start and that's all, so it should work without it
<br/>
And accoding to <a href="http://www.akkit.org/info/dswifi.htm" target="_blank">http://www.akkit.org/info/dswifi.htm</a>
<br/>
" The bottom 3 bits of this register specify a software mode for wifi operation (may be related to hardware but a correlation has not yet been found)"
<br/>
But the 0D0 looks interesting.
<br/>
Another thanks for all your informations :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141695 - Mighty Max - Fri Sep 28, 2007 1:57 pm</h4>
    <div class="postbody"><span class="postbody">I decided to try and work with the code i have atm and create a "Lobby library" for homebrew to meet up and communicate for games/apps.
<br/>
<br/>
For this i have included the NDS sources into a PC-Project with the HAL exchanged to use the wifime-card. I <span style="font-style: italic">hope</span> to have a first working demo soon, that should also work for two or more DSes.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141699 - melw - Fri Sep 28, 2007 4:32 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">I decided to try and work with the code i have atm and create a "Lobby library"</td> </tr></table><span class="postbody">
<br/>
Good luck! I lost my nerves working on this and went back finishing the Dicewars DS multiplayer version instead... However I'm more than willing to help with testing if needed (have 3 DS's and a PC laptop with Ralink card over here).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141706 - Mighty Max - Fri Sep 28, 2007 7:16 pm</h4>
    <div class="postbody"><span class="postbody">Ok, found another thing that let's the DS filter pakets out.
<br/>
<br/>
Sounds logical now (and stupid to ignore until now), but it was something that got me problems when sending on non-busy channels, which is now solved:
<br/>
<br/>
When sending raw frames via ralink, make sure to update the sequence number, otherwise every paket following the first received will be ignored until one station sends a paket with a different seqaence ID.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141775 - Mighty Max - Sat Sep 29, 2007 7:16 pm</h4>
    <div class="postbody"><span class="postbody">Can someone test <a href="http://mightymax.org/libwifi.nds" target="_blank">http://mightymax.org/libwifi.nds</a> ?
<br/>
<br/>
It works relyable here now for the ralink&lt;-&gt;ds, but i have no way to check for ds&lt;-&gt;ds (I got myself a second DS, but no mean to flash it)
<br/>
<br/>
The app, when launched on only one DS should show a black screen with a letter counting up in the upper right corner. Depending on if there is traffic or not on channel 7, the letter should change every second and faster.
<br/>
<br/>
When the app is started on another DS at the same time, they both should regognize each other, and tell the name of the other DS (The username to be exact. In my case "Mighty Max" and "RALINK" <a href="http://mightymax.org/IMG00008.jpg">[Images not permitted - Click here to view it]</a>)
<br/>
<br/>
If one DS goes silent for 4 seconds the station should timeout on the other DS, and if restarted reappear again.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141776 - Tets - Sat Sep 29, 2007 7:35 pm</h4>
    <div class="postbody"><span class="postbody">Works reliably with my DS and my brother's.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141777 - ThomasS - Sat Sep 29, 2007 7:35 pm</h4>
    <div class="postbody"><span class="postbody">It works in most (~60 - 70%) cases, the names of the DS are correctly displayed. But in other cases nothing happens at all, only the counter is shown. Unfortunately I couldn't find a pattern for when this happens.
<br/>
<br/>
Tested with 2 Supercard SD's in 2 "Phat" silver DS.<br/>_________________<br/>&lt;<a class="postlink" href="http://palib.info/forum/modules/newbb/viewtopic.php?viewmode=flat&amp;type=&amp;topic_id=3108&amp;forum=10" target="_blank">dsFont</a>&gt; &lt;<a class="postlink" href="http://palib.info/forum/modules/newbb/viewtopic.php?topic_id=2451&amp;forum=9" target="_blank">Game Collection</a>&gt;</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141778 - Mighty Max - Sat Sep 29, 2007 7:41 pm</h4>
    <div class="postbody"><span class="postbody">Thank you both. That is at least one step further.
<br/>
<br/>
ThomasS's problem is something that happened also before here. (But i thought this was solved) I need to find a way to tell if the wifi core is really listening.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141782 - phhusson - Sat Sep 29, 2007 10:34 pm</h4>
    <div class="postbody"><span class="postbody">Hum what have you changed in initialisation since your last source code ?
<br/>
<br/>
The first one doesn't work while the last nds app you gave works, and i use exactly same packet generator with same configuration (just rebooted the DS).
<br/>
(And my app only still only gets non-data packets)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141786 - melw - Sun Sep 30, 2007 12:13 am</h4>
    <div class="postbody"><span class="postbody">Tried 3 times in a row with 3 different DS's, also shutting down random DS and switching it back on testing timeouts - everything worked flawlessly and each device recognizing the others.
<br/>
<br/>
Tested with:
<br/>
- DS Phat, GBAMP/SD
<br/>
- DS Lite, M3 Perfect Lite
<br/>
- DS Lite, R4DS
<br/>
<br/>
Looking good!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141805 - Mighty Max - Sun Sep 30, 2007 9:19 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>phhusson wrote:</b></span></td> </tr> <tr> <td class="quote">Hum what have you changed in initialisation since your last source code ?
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Alltho i was playing with some other RX Filter Registers,  the one you are using has no changes in the init code. What's changed is the way the data is retrieved from the mac memory, and the IDing of the sent packets.
<br/>
<br/>
From some quick look, base+0DA seems i.e. to be some kind of selector which data is to be written in to the mac memory on receive. (Don't nail me on this, it was just an impression i got without looking too deep)
<br/>
<br/>
<br/>
---
<br/>
<br/>
Btw, i still need to find a way for the ipc code im using right now to use the uncached mirror without the cached mirror corrupting the data when it is accessed near the messaging struct.
<br/>
<br/>
Disabling the cache alltogether, like it is now, is no option for an lib to be used in release apps/games.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141812 - Mighty Max - Sun Sep 30, 2007 11:45 am</h4>
    <div class="postbody"><span class="postbody">I got another test ready <a href="http://mightymax.org/libwifi.nds" target="_blank">http://mightymax.org/libwifi.nds</a>
<br/>
<br/>
I added a mean to send to one DS only instead of broadcasting like it is done to announce the DS to all others.
<br/>
<br/>
With [up],[down] select the DS/Station to send to, press [a],[b],[x],[y] to send a message "Key [*] was pressed" to the selected DS.
<br/>
<br/>
If all works, only the selected DS should show the message, and the others should keep silent.
<br/>
<br/>
:edit: There is no flow control yet, all messages are "fire and forget" atm, so msg loss shouldn't wonder ;)<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141814 - spinal_cord - Sun Sep 30, 2007 11:57 am</h4>
    <div class="postbody"><span class="postbody">It worked fine, but I only have two ds's, so I don't know about any data being sent to other ones.<br/>_________________<br/>I'm not a boring person, it's just that boring things keep happening to me.
<br/>
<a class="postlink" href="http://spinal.dizidesigns.co.uk/" target="_blank">Homepage</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141815 - melw - Sun Sep 30, 2007 11:57 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">I got another test ready <a href="http://mightymax.org/libwifi.nds" target="_blank">http://mightymax.org/libwifi.nds</a>
<br/>
<br/>
I added a mean to send to one DS only instead of broadcasting like it is done to announce the DS to all others.
<br/>
<br/>
With [up],[down] select the DS/Station to send to, press [a],[b],[x],[y] to send a message "Key [*] was pressed" to the selected DS.
<br/>
<br/>
If all works, only the selected DS should show the message, and the others should keep silent.</td> </tr></table><span class="postbody">
<br/>
(Same test setup as before - 3 DS's) Sending data works, but the data gets through always to both 2 other DS's no matter what destination has been selected.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141818 - Mighty Max - Sun Sep 30, 2007 12:08 pm</h4>
    <div class="postbody"><span class="postbody">OK, thank you.
<br/>
Guess simple filtering by the software should solve that then.
<br/>
<br/>
:edit: arg! some debug stuff was left there, making all sent 802.11 packets broadcasts<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141819 - Mighty Max - Sun Sep 30, 2007 12:17 pm</h4>
    <div class="postbody"><span class="postbody">Please try again (same link: <a href="http://mightymax.org/libwifi.nds" target="_blank">http://mightymax.org/libwifi.nds</a> )
<br/>
<br/>
The packets should now addressed correct, so that using the hardware filter should work (at least it does so when i fake a third DS i send to on the PC application)<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141820 - melw - Sun Sep 30, 2007 12:33 pm</h4>
    <div class="postbody"><span class="postbody">Works!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141821 - Mighty Max - Sun Sep 30, 2007 12:40 pm</h4>
    <div class="postbody"><span class="postbody">Great!
<br/>
Thank you again. 
<br/>
<br/>
Now i got to start working on the "need to deliver" streams and several helpers (like to transfer more data then matching in one frame and such)<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141828 - zazery - Sun Sep 30, 2007 5:21 pm</h4>
    <div class="postbody"><span class="postbody">It works for me as well. We should probably run some tests with 3-8 DS . I'm part of the DS/homebrew club at my university so I can probably make this test happen. Would this binary support that many DS or should I wait for another one?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141829 - Lick - Sun Sep 30, 2007 5:30 pm</h4>
    <div class="postbody"><span class="postbody">Great work Mighty Max and everyone else. Seems like we're going to have some kind of revolution in the homebrew scene soon! ;D<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141830 - Mighty Max - Sun Sep 30, 2007 5:42 pm</h4>
    <div class="postbody"><span class="postbody">There is no build-in limitation in the software. What works for 3 DSes _should_ also work for a dozen. (Tho you can never be sure ;) )
<br/>
<br/>
But it would be nice to know that it works/doesn't work anyways. I thank everyone testing :D
<br/>
<br/>
The now following steps however will take time without seeing much changes: 
<br/>
- cleaning up the code from the debug/testing hacks
<br/>
- fixing the allready known bugs and finding new ones
<br/>
- detecting/avoiding the wifi-lockup
<br/>
- exchange the IPC functions (I think at least some of the lockups come from here)
<br/>
<br/>
The "need to deliver" problem is solved, to the point that every sent data is received at least once (except for a station timing out). Fragmentation &amp; multiple receives are not handled properly yet<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141832 - tepples - Sun Sep 30, 2007 5:53 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lick wrote:</b></span></td> </tr> <tr> <td class="quote">Seems like we're going to have some kind of revolution in the homebrew scene soon! ;D</td> </tr></table><span class="postbody">
<br/>
Wii'd need to get past the digital signature first before we can have a <a class="postlink" href="http://en.wikipedia.org/wiki/Wii#Name" target="_blank">revolution</a> in the homebrew scene. Unlike the DS, the Wii gets remote firmware upgrades, and we can expect PSP-style cat-and-mouse.
<br/>
<br/>
Another problem with multiplayer DS homebrew is that you still need to launch, eject card, launch in order to get more than one DS going. But given how long the instructions for doing this on GBAs have been up on pocketnes.org, this shouldn't be too much of a problem, right?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141840 - melw - Sun Sep 30, 2007 7:59 pm</h4>
    <div class="postbody"><span class="postbody">Keep up the good work! When this software gets further I can take some flash adapters and a laptop with wmb and go into a local IGDA pub meeting (always swarming with game dev's and DS's). Would be great to try how this works with as many DS's as possible. :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141853 - yellowstar - Sun Sep 30, 2007 9:26 pm</h4>
    <div class="postbody"><span class="postbody">Worked well for me!
<br/>
(Same setup as above,
<br/>
with two original DSes, and a Lite)
<br/>
<br/>
This time it booted correctly on
<br/>
my DS-X.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141868 - Lick - Sun Sep 30, 2007 11:41 pm</h4>
    <div class="postbody"><span class="postbody">I was thinking of a file browser with sharing feature. =)<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141909 - HyperHacker - Mon Oct 01, 2007 2:37 pm</h4>
    <div class="postbody"><span class="postbody">Maybe an ad-hoc version of Moonlight's wifi voice chat? It'd be like Pictochat with less suck.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141911 - Sektor - Mon Oct 01, 2007 3:04 pm</h4>
    <div class="postbody"><span class="postbody">If you are close enough for ad-hoc, just walk to your friend and chat, you don't need a microphone.  It will be good for multiplayer games.<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><a class="postlink" href="http://gtamp.com/DS" target="_blank">GTAMP.com/DS</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141932 - Mighty Max - Mon Oct 01, 2007 8:14 pm</h4>
    <div class="postbody"><span class="postbody">Today's info update:
<br/>
- changing the underlying IPC made it more stable.
<br/>
- the receive lockdown has been resolved
<br/>
- there is still a problem with transmit at random times. I am trying to work out why by dumping the registers. By the look of it, it seems that there is neither a transmit complete IRQ is cast nor the TXLOC's enable flag removed. The earliest occurance was after 0x78 sends, the latest after 0x8D7 transmits. Trying to figure it out ...
<br/>
<br/>
:edit: seems that register base+0x25C is non zero as soon as this happens. All register dumps while sent was working showed it as 0.
<br/>
:edit^2: resetting the TX CNT/TX Locs on that value seems to do the trick. I can now send until something else goes wrong (i got a memleak somewhere), i just wonder why this doesn't happen in dswifi / what i am doing wrong in the first place<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141984 - Mighty Max - Tue Oct 02, 2007 8:29 pm</h4>
    <div class="postbody"><span class="postbody">I have still lockdowns on send, which will now resolve due to the error check after some seconds. This is not very suitable for serious use.
<br/>
<br/>
Maybe someone finds the problem with my send i am blind for.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void WIFI_SendRAW(char *buffer, int length)
<br/>
{
<br/>
   // wait until there is an slot available
<br/>
   while ((WIFI_REGISTER(WIFI_TXLOC1) &amp; 0x8000) &amp;&amp; (WIFI_REGISTER(WIFI_TXLOC2) &amp; 0x8000))
<br/>
   {
<br/>
      // if there is a sent lockdown, reset sends
<br/>
      // looks to work, but takes a few secs?
<br/>
      if (WIFI_REGISTER(0x25C))
<br/>
      {
<br/>
         WIFI_REGISTER(WIFI_TXLOC1) = 0x0000 ;
<br/>
         WIFI_REGISTER(WIFI_TXLOC2) = 0x0000 ;
<br/>
         WIFI_REGISTER(WIFI_TXLOC3) = 0x0000 ;
<br/>
         WIFI_REGISTER(WIFI_TXCNT) = 0x0000 ;
<br/>
         WIFI_REGISTER(WIFI_TXCNT) = 0xFFFF ;
<br/>
         WIFI_REGISTER(WIFI_TXCNT) = 0x0000 ;
<br/>
      }
<br/>
   }
<br/>
   // don't send while beaconing
<br/>
   while (REG_IF &amp; 0x8000)      // pre beacon irq happened (but not handled)
<br/>
   {
<br/>
      if (REG_IF &amp; 0x4000)   // beacon was done (and also not handled)
<br/>
      {
<br/>
         REG_IF |= 0xC000 ;
<br/>
      }
<br/>
   }
<br/>
   // check first send slot
<br/>
   if (!(WIFI_REGISTER(WIFI_TXLOC1) &amp; 0x8000))
<br/>
   {
<br/>
      WIFI_REGISTER(WIFI_RETRYLIMIT) = 7 ;
<br/>
      // init header
<br/>
      int i ;
<br/>
      for (i=0;i&lt;8;i+=2)
<br/>
         WIFI_REGISTER(WIFI_MEMORY + i) = 0x0000 ;
<br/>
      WIFI_REGISTER(WIFI_MEMORY +  8) = 0x000A ;
<br/>
      WIFI_REGISTER(WIFI_MEMORY + 10) = length + 4 ;
<br/>
      // copy payload
<br/>
      for (i = 0; i &lt; length ; i+=2)
<br/>
      {
<br/>
         WIFI_REGISTER(WIFI_MEMORY + 12 + i) = ((unsigned short *)buffer)[i/2] ;
<br/>
      }
<br/>
      // place for CRC
<br/>
      for (;i&lt;length + 4;i+=2)         
<br/>
      {
<br/>
         WIFI_REGISTER(WIFI_MEMORY + 12 + i) = 0x0000 ;
<br/>
      }
<br/>
      // enable slot, start sending of slot
<br/>
      WIFI_REGISTER(WIFI_TXLOC1) = 0x8000 ;
<br/>
      WIFI_REGISTER(WIFI_TXCNT) |= 0x01 ;
<br/>
   } else if (!(WIFI_REGISTER(WIFI_TXLOC2) &amp; 0x8000))
<br/>
   {
<br/>
      // send slot 2
<br/>
      WIFI_REGISTER(WIFI_RETRYLIMIT) = 7 ;
<br/>
      // init header
<br/>
      int i ;
<br/>
      for (i=0;i&lt;8;i+=2)
<br/>
         WIFI_REGISTER(WIFI_MEMORY + i + 0x300) = 0x0000 ;
<br/>
      WIFI_REGISTER(WIFI_MEMORY +  8 + 0x300) = 0x000A ;
<br/>
      WIFI_REGISTER(WIFI_MEMORY + 10 + 0x300) = length + 4 ;
<br/>
      // copy payload
<br/>
      for (i = 0; i &lt; length ; i+=2)      
<br/>
      {
<br/>
         WIFI_REGISTER(WIFI_MEMORY + 12 + i + 0x300) = ((unsigned short *)buffer)[i/2] ;
<br/>
      }
<br/>
      // place for CRC
<br/>
      for (;i&lt;length + 4;i+=2)         
<br/>
      {
<br/>
         WIFI_REGISTER(WIFI_MEMORY + 12 + i + 0x300) = 0x0000 ;
<br/>
      }
<br/>
      // enable slot, start sending of slot
<br/>
      WIFI_REGISTER(WIFI_TXLOC2) = 0x8300 ;
<br/>
      WIFI_REGISTER(WIFI_TXCNT) |= 0x04 ;
<br/>
   }
<br/>
}
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141999 - yellowstar - Tue Oct 02, 2007 10:55 pm</h4>
    <div class="postbody"><span class="postbody"><span style="font-weight: bold">EDIT: Never mind, the following bug has been fixed
<br/>
in the updated version. So, it works like it is supposed to, again.</span>
<br/>
<br/>
I have found a bug.
<br/>
<br/>
Same setup as above.(one Lite, two originals)
<br/>
<br/>
The Lite was running Juglak's WMB Host.
<br/>
<br/>
The others were running this program.
<br/>
<br/>
Once the Lite was running,
<br/>
I restarted the other DSes.
<br/>
<br/>
Here's the problem:
<br/>
With a DS running the WMB Host in range,
<br/>
when the DS starts up,
<br/>
it fails to detect the other DS.(in this program)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142011 - HyperHacker - Wed Oct 03, 2007 3:09 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Sektor wrote:</b></span></td> </tr> <tr> <td class="quote">If you are close enough for ad-hoc, just walk to your friend and chat, you don't need a microphone.</td> </tr></table><span class="postbody">If you're in the same room.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142119 - Mighty Max - Thu Oct 04, 2007 7:06 pm</h4>
    <div class="postbody"><span class="postbody">I think i found that bastard that locked up transmitting while cleaning up the wifi_hal.c
<br/>
<br/>
<a href="http://mightymax.org/libwifi.nds" target="_blank">http://mightymax.org/libwifi.nds</a> should be more stable now and not break after a fast sent row of frames. ([SELECT] triggers a non acked send 60times a second (vblank). The stream used for this is not shown on the other DS, but the work indicator should count the packets up, other keys as previous)
<br/>
<br/>
I _think_ it was caused by me ORing the TXCNT Register with the tx-slot to be used which triggered a "try to send slot" also on the other channels that were still set in TXCNT (i.e. from flushing all sends on init) and finally reaching a tx error threshold. Also the TX location for TXLOC2 was falsely set *oups*
<br/>
<br/>
:edit:
<br/>
Btw the filter setting needed to get data frames is indeed in 0x0D0.:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define WIFI_RXFILTER      0x00D0
<br/>
// RXFILTER:
<br/>
#define WIFI_RXFILTERDATA      BIT(11)
<br/>
#define WIFI_RXFILTERBEACON      BIT(0)
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142156 - Puyo - Fri Oct 05, 2007 12:36 pm</h4>
    <div class="postbody"><span class="postbody">Just a note. Yesterday Martin Korth (author of no$gba) updated his <a class="postlink" href="http://nocash.emubase.de/gbatek.htm" target="_blank">gbatek</a> with the latest information, which includes huge update on wifi hardware. 
<br/>
<br/>
Hope it helps in any way. I think a lot of people, including me, interested in seeing a working library. Thanks for your hard work guys.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142159 - Mighty Max - Fri Oct 05, 2007 1:44 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for the hint. I still was using an cached version *g*
<br/>
<br/>
I should contact him with my findings. I got some more register info he hasn't in it yet.
<br/>
<br/>
<br/>
Btw, if anyone has a spare nopass ....
<br/>
It's a shame that no console/modding shop has any DS related things beside Stylus replaces and such around here.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142160 - dualscreenman - Fri Oct 05, 2007 2:22 pm</h4>
    <div class="postbody"><span class="postbody">I'm sure Martin would be happy with any extra info. A lot of exciting work is going on here for both homebrew and emulation. :)
<br/>
<br/>
Oh, and I'm in GBAtek. (ARDS/CBDS documentation) ^_^ I can die a happy man now... or something. Actually I think I'll stay in the world of the living for the time being. Heh.
<br/>
<br/>
Sorry, I digress. Anywho...
<br/>
Keep up the good work guys!<br/>_________________<br/></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>dualscreenman wrote:</b></span></td> </tr> <tr> <td class="quote">What about Gaim DS? Gaim pretty much has support for all IM programs.</td> </tr></table><span class="postbody"> </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">"Goshdammit, the DS is not a Gaim-boy! It's a third pillar!"</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142174 - Mighty Max - Fri Oct 05, 2007 7:51 pm</h4>
    <div class="postbody"><span class="postbody">I have set up a subversion repository for the testapplication
<br/>
<br/>
You can find it at <a href="svn://91.184.39.23/svn/repos/libwifi" target="_blank">svn://91.184.39.23/svn/repos/libwifi</a>
<br/>
<br/>
It is not yet a library as the name suggests, it's just the source of the NDS i have previously posted. The cleanup is at an early stage, there are dozent of places where i tested settings, replaced code, left code commented out / unused, used dirty ways to do things etc.
<br/>
<br/>
It's just to share the information i've found/finding out right now. If someone wants to add to it and thus needs write access, leave me a message.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142236 - Mighty Max - Sat Oct 06, 2007 7:46 pm</h4>
    <div class="postbody"><span class="postbody">The source has been converted into a library. 
<br/>
The previous .nds file has been converted into an example on how to use/compile against the lib.
<br/>
<br/>
It still misses functions to manage rooms (join/leave/advertise/sendTo/inforetrieve) and a lot of checks against failures, but it should be at least usefull enough for a first test from all the app/game developers out there.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142240 - yellowstar - Sat Oct 06, 2007 8:30 pm</h4>
    <div class="postbody"><span class="postbody">I have found a bug.
<br/>
<br/>
Whenever you press Start,(dosen't matter if other DSes were
<br/>
detected or not)
<br/>
it crashes.
<br/>
<br/>
By crash,
<br/>
I mean an exception.
<br/>
(White text on red background, with the 'Guru Meditation Error' title)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142242 - Mighty Max - Sat Oct 06, 2007 8:39 pm</h4>
    <div class="postbody"><span class="postbody">Yes., thanks. This shouldn't happen anymore with the version on SVN.
<br/>
<br/>
It was just my lazyness that didn't let me adjust the read buffer for the dump register debug-function ;) Nonetheless after the crash you should have a 4kB "REG.DMP" file showing the lowest wifi registers (non action mirror)<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142371 - Mighty Max - Mon Oct 08, 2007 8:06 pm</h4>
    <div class="postbody"><span class="postbody">Basic room management (create, join, sendTo) has been implemented, and is now nearly ready for the first DS&lt;-&gt;DS game. I think of a simple pong game as an example. At this time i think i'll put the first binaries up on a http webserver together with the pong's source as an example on how to use the lobby.
<br/>
<br/>
Due to generously donations (thanks from here again!) i will be able to test all these things myself soon.
<br/>
<br/>
Suggestions from developers are welcome. (Need functions,fixes,etc?)<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142375 - Jesse - Mon Oct 08, 2007 8:10 pm</h4>
    <div class="postbody"><span class="postbody">Is there a problem using this together with dswifi? While doing a quick test to integrate this, they collided pretty badly.
<br/>
<br/>
I'm soo looking forward in getting this up and running... :)<br/>_________________<br/><a href="http://www.collectingsmiles.com/colors" target="_blank">http://www.collectingsmiles.com/colors</a> &amp; <a href="http://www.collectingsmiles.com/hyena" target="_blank">http://www.collectingsmiles.com/hyena</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142376 - Mighty Max - Mon Oct 08, 2007 8:20 pm</h4>
    <div class="postbody"><span class="postbody">Yes. It's not compatible with dswifi.
<br/>
<br/>
This is partly caused by functions that are named equally in both libs (this is one easy solvable one) and due to the fact that they both use the same hardware in a different way, which is a lot more difficult to solve.
<br/>
<br/>
From my side it shouldn't be difficult to keep the liblobby inactive when it isn't used, but from the things i've seen and read, it is quite more difficult to stop &amp; reinit dswifi.
<br/>
<br/>
I'll put on/off switches for the HAL into the todo list.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142400 - simonjhall - Mon Oct 08, 2007 11:06 pm</h4>
    <div class="postbody"><span class="postbody">So...can I give this a whirl yet? ;-)<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142440 - Mighty Max - Tue Oct 09, 2007 5:24 am</h4>
    <div class="postbody"><span class="postbody">Go and have fun.
<br/>
<br/>
You might want to replace the IPC_* functions to use your ipc in quake, but from the rest, it perfoms much more well then i thought when we exchanged PMs.
<br/>
<br/>
(Does'nt mean that there isn't still a ton of things to do)<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142499 - Mighty Max - Tue Oct 09, 2007 6:38 pm</h4>
    <div class="postbody"><span class="postbody">The problem with double function names when linking against dswifi should been resolved. It should now be at least prossible to decide at runtime whether the lobby of the dswifi should be used (alltho it is not _yet_ possible to switch to the other once the decission was made)
<br/>
<br/>
If there are still problems, leave me a note.
<br/>
<br/>
Not much else today.
<br/>
<br/>
<br/>
Ah btw simon,
<br/>
If you are using a different IPC system. Make sure the messages transfered are word aligned. (Forgot this the post made this morning. 
<br/>
using Send802.3snap and setting a protocol listener to snap might be all you need. I think quake does all the other fancy protocol things itself already (wasn't it IPX originally?)<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142513 - simonjhall - Tue Oct 09, 2007 10:33 pm</h4>
    <div class="postbody"><span class="postbody">Err...dunno what it is that I'm doing wrong, but I can't get anything to happen!
<br/>
Phusson's original ad-hoc demos from a few pages ago worked (for a few frames) but the demo program you put on the previous page didn't do anything on the four DS' that I tried (two old phats, one new phat, one old lite). One of the old phats would give a guru meditation whenever the first button pressed was start. Nice red screen btw ;-)
<br/>
<br/>
I also tried the example program from the svn repo and I only get one "last received text" string...then nothing else. Fearing I'd messed up the build process, I copied the bulk of the code into Quake (I use my own makefile system) but still the same result...
<br/>
<br/>
So...what am I doing wrong?! If I'm doing nothing wrong, what can I do to help?<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142537 - Mighty Max - Wed Oct 10, 2007 5:20 am</h4>
    <div class="postbody"><span class="postbody">I had tightened the RXFILTER and the modify on send settings between the working and non working versions. Maybe that is what broke it for you.
<br/>
(I am currently still checking against a ralink)
<br/>
<br/>
I have updated the SVN with a version with the old settings in these registers.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142554 - melw - Wed Oct 10, 2007 10:16 am</h4>
    <div class="postbody"><span class="postbody">The latest svn version works quite well with the previous test scenario (2 Lite's, 1 DS Phat) - however the old DS model seems slow with recognizing the other DS's and receiving/sending while the communication between the Lite's has no visual lag. I experienced this slowness on the Phat model also in the previous svn update from yesterday but not from the tests before the svn-era.
<br/>
<br/>
When I have time, I'll give this library a go with Dicewars DS.
<br/>
<br/>
Mighty, do you still need a Nopass? I have a few unused Passkey's over here (both version 1 and 2).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142584 - Lynx - Wed Oct 10, 2007 4:27 pm</h4>
    <div class="postbody"><span class="postbody">melw, he's all set for hardware.  ;)<br/>_________________<br/><a class="postlink" href="http://www.ndshb.com" target="_blank">NDS Homebrew Roms &amp; Reviews</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142587 - Mighty Max - Wed Oct 10, 2007 4:55 pm</h4>
    <div class="postbody"><span class="postbody">hmm, there shouldn't been a slowdown between lite and normal DSes, beside initializing RF/BB chips they should act the same.
<br/>
<br/>
However, the update has under the premise that no packet gets dropped in the air a worst case latency of around 1 second. However if the hardware fails to send, it will try the next update a second later. This could indeed be very noticeable in noisy environment.
<br/>
<br/>
I also changed the transmitting speed to 2mbit (was hardcoded to 1mbit in the first tests) maybe the older DS have more problems (read as: increased packet loss) to receive the updates at that speed (The ralink allways sends at 1mibt). I'll investigate if broadcasting in 1mbit will reduce this problem. And offcourse decrese the timespan for the next update. (To make it less noticeable)
<br/>
<br/>
<br/>
As for the nopass: see Lynx's post. Thanks again lynx.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142667 - Jesse - Thu Oct 11, 2007 1:30 pm</h4>
    <div class="postbody"><span class="postbody">I've implemented this into Colors! now. Does this means Colors! is the first Wi-Fi ad-hoc homebrew (apart from the Mighty Max's example) for the DS? Whee! :)
<br/>
<br/>
<a href="http://www.collectingsmiles.com/colors/colors_adhoctest.rar" target="_blank">http://www.collectingsmiles.com/colors/colors_adhoctest.rar</a>
<br/>
<br/>
Anyway. It's a _very_ basic implementation in a stripped debug-version of Colors!. It also lacks the room support (don't let the icons fool you) and I assume it will totally crash and burn for more than two consoles, but still... It sort of works! :)<br/>_________________<br/><a href="http://www.collectingsmiles.com/colors" target="_blank">http://www.collectingsmiles.com/colors</a> &amp; <a href="http://www.collectingsmiles.com/hyena" target="_blank">http://www.collectingsmiles.com/hyena</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142668 - Jesse - Thu Oct 11, 2007 1:42 pm</h4>
    <div class="postbody"><span class="postbody">So. Some observations and some feedback for our hero Mighty Max!
<br/>
<br/>
It seems that some data is lost and some data is received multiple times. That can be seen in the log when running the program. I guess that multiple receives is a bug and that my implementation should handle dropped data?
<br/>
<br/>
Some feedback on the lib:
<br/>
* You should include an "if C++ then extern "C"" in the headers like most other C libraries. It took me a while figure out why it wouldn't link.
<br/>
* The MessageQueue class is nice and I wish there was something like it in libnds. The problem is that I'm not sure how I can send and receive custom data as long as that is active.
<br/>
* Running LWIFI_IPC_UpdateNOIRQ in the main loop on Arm7 gives me trouble. It blocks for a second at the time and I currently run other things there that need much lower latencies.
<br/>
* Feel free to fix the 'tinI' style warnings using constants like 0x74696e49 instead. :)<br/>_________________<br/><a href="http://www.collectingsmiles.com/colors" target="_blank">http://www.collectingsmiles.com/colors</a> &amp; <a href="http://www.collectingsmiles.com/hyena" target="_blank">http://www.collectingsmiles.com/hyena</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142674 - Mighty Max - Thu Oct 11, 2007 3:44 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Jesse wrote:</b></span></td> </tr> <tr> <td class="quote">So. Some observations and some feedback for our hero Mighty Max!
<br/>
<br/>
It seems that some data is lost and some data is received multiple times. That can be seen in the log when running the program. I guess that multiple receives is a bug and that my implementation should handle dropped data?
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I didn't come to document much yet. Streams with an ID lower then 0x8000 are acknowledged, so that there should not be any data loss. If the data was not acked until the next vblank, it is rerequested.  (And thus probably received twice). The double receive is somethinething i need to filter, yes.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<br/>
Some feedback on the lib:
<br/>
* You should include an "if C++ then extern "C"" in the headers like most other C libraries. It took me a while figure out why it wouldn't link.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Should be in most. However i need to update the headers anyways atm the global includes are the one from the project. instead they should only reveal what's needed.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
* The MessageQueue class is nice and I wish there was something like it in libnds. The problem is that I'm not sure how I can send and receive custom data as long as that is active.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
You can use your own IPC, as long as with IPC_GetMessage/IPC_SendMessage data can be received/send word aligned. You can replace the functions or maybe i'll include a "CTM" message for a custom IPC you can get a callback for.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
* Running LWIFI_IPC_UpdateNOIRQ in the main loop on Arm7 gives me trouble. It blocks for a second at the time and I currently run other things there that need much lower latencies.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Didn't think about that. Allways had the default template in mind. I will add a switch for this behaviour. The blocking happens if there is a transmit waiting to be put in one of the hardware slots. Also it is always waiting for at least one message to be received. Will definately be changed.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
* Feel free to fix the 'tinI' style warnings using constants like 0x74696e49 instead. :)</td> </tr></table><span class="postbody">
<br/>
<br/>
Yepp. They are annoying ;) used them to replace the string comparison. i could have used simplier constants but i was too lazy yet.
<br/>
<br/>
<br/>
<br/>
Thanks for the feedback. Gonna work the points down.
<br/>
<br/>
<br/>
:edit:
<br/>
- multiple character in constant warning
<br/>
- arm7 update function blocking when no message is to be received
<br/>
have been addressed.
<br/>
I have also added a callback (see IPC_SetCustomCallback) for all IPC messages that are not handled by the lib. This way you can use the included IPC for transfering custom data.  Be sure that the lobby is initiated first.
<br/>
<br/>
:edit^2:
<br/>
i think i found something causing a to-be-acked frame not correctly put into the "awaiting ack" list. Got to make the lists irq safe ;)<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142741 - ThomasS - Fri Oct 12, 2007 2:55 pm</h4>
    <div class="postbody"><span class="postbody">I'll use this library for the cooperative mode in my Lode Runner game. Thanks for your great work!
<br/>
<br/>
However, before the players can play with each other, the whole level has to be transferred from one DS to the other, and this causes some problems because of this bug:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Jesse wrote:</b></span></td> </tr> <tr> <td class="quote">It seems that some data is lost and some data is received multiple times.</td> </tr></table><span class="postbody">
<br/>
<br/>
I've modified your example code to test this. It now sends 200 bytes of data when the user presses A and displays the sent / received data graphically and in bytes. The more often the same data arrives, the longer the 'X' row gets vertically (it's intended that one DS only sends and the other one only receives).
<br/>
Theoretically, the output should be the same on both DS, however, it seems that almost all packets get received at least two times, some even seven (or more) times!
<br/>
When you hold B while pressing A, the data is sent on stream 0x8000 so that no acknowledge is done. Then it works almost perfectly, only a few packets get lost.
<br/>
<br/>
I hope this helps to improve it. Here is the code I used in the arm9 template.c:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include "nds.h"
<br/>
#include &lt;nds/arm9/console.h&gt; //basic print funcionality
<br/>
#include &lt;stdio.h&gt;
<br/>
<br/>
#include "MessageQueue.h"
<br/>
#include "802.11.h"
<br/>
#include "lobby.h"
<br/>
#include &lt;fat.h&gt;
<br/>
#include &lt;malloc.h&gt;
<br/>
#include &lt;string.h&gt;
<br/>
<br/>
int receivedMsg[32];
<br/>
u32 received;
<br/>
u32 sent;
<br/>
<br/>
void VBlankIRQ(void)
<br/>
{
<br/>
   REG_IF = IRQ_VBLANK ;
<br/>
   IPC_RcvCompleteCheck() ;
<br/>
   LOBBY_Update() ;
<br/>
}
<br/>
<br/>
void receiveText(unsigned char *data, int length, LPLOBBY_USER from)
<br/>
{
<br/>
   int i;
<br/>
   char string[256];
<br/>
   
<br/>
   received += length;
<br/>
   
<br/>
   if (data[0] &gt; 31)
<br/>
   {
<br/>
      printf("\x1b[6;1HTransfer error: %d!  ", data[0]);
<br/>
      return;
<br/>
   }
<br/>
   for (i = 1; i &lt; 200; i++)
<br/>
   {
<br/>
      if (data[0] != data[i])
<br/>
      {
<br/>
         printf("\x1b[6;1HTransfer error 2!    ");
<br/>
         return;
<br/>
      }
<br/>
   }
<br/>
   
<br/>
   sprintf(string, "\x1b[%d;%dHX", 8 + receivedMsg[data[0]], data[0]);
<br/>
   printf(string);
<br/>
   receivedMsg[data[0]] = (receivedMsg[data[0]] + 1) % (24 - 8);
<br/>
}
<br/>
<br/>
<br/>
int main(void) 
<br/>
{
<br/>
   received = 0;
<br/>
   sent = 0;
<br/>
   memset(receivedMsg, 0, sizeof(receivedMsg));
<br/>
<br/>
   REG_EXMEMCNT=0xe800;
<br/>
<br/>
   powerON(POWER_ALL);
<br/>
   REG_IME = 0 ;
<br/>
   REG_IE = 0 ;
<br/>
   REG_IF = 0xFFFF ;
<br/>
<br/>
   videoSetMode(0);   //not using the main screen
<br/>
   videoSetModeSub(MODE_0_2D | DISPLAY_BG0_ACTIVE);   //sub bg 0 will be used to print text
<br/>
   vramSetBankC(VRAM_C_SUB_BG);
<br/>
<br/>
   SUB_BG0_CR = BG_MAP_BASE(31);
<br/>
<br/>
   BG_PALETTE_SUB[255] = RGB15(31,31,31);   //by default font will be rendered with color 255
<br/>
<br/>
   //consoleInit() is a lot more flexible but this gets you up and running quick
<br/>
   consoleInitDefault((u16*)SCREEN_BASE_BLOCK_SUB(31), (u16*)CHAR_BASE_BLOCK_SUB(0), 16);
<br/>
   
<br/>
<br/>
   defaultExceptionHandler() ;
<br/>
<br/>
   irqInit() ;
<br/>
<br/>
   // Startup IPC engine
<br/>
   IPC_Init() ;
<br/>
   IPC_SetMsgCompleteCallback(&amp;IPC_RcvCompleteCheck) ;
<br/>
<br/>
   // usual VBlank
<br/>
   irqSet(IRQ_VBLANK,&amp;VBlankIRQ) ;
<br/>
   irqEnable(IRQ_VBLANK) ;
<br/>
<br/>
   consoleClear() ;
<br/>
   
<br/>
   int selected = 0 ;
<br/>
<br/>
   LOBBY_Init() ;
<br/>
   LOBBY_SetStreamHandler(0x0001,&amp;receiveText) ;
<br/>
   LOBBY_SetStreamHandler(0x8000,&amp;receiveText) ;
<br/>
<br/>
   while (1) 
<br/>
   {
<br/>
      /* handle input */
<br/>
      int max = LOBBY_GetNumberOfKnownUsers() ;
<br/>
      scanKeys() ;
<br/>
      if (keysDown() &amp; KEY_DOWN)
<br/>
      {
<br/>
         selected++ ;
<br/>
      }
<br/>
      if (keysDown() &amp; KEY_UP)
<br/>
      {
<br/>
         selected-- ;
<br/>
      }
<br/>
      if (max &gt; 0) selected %= max ;
<br/>
      
<br/>
      // Send 200 bytes of data
<br/>
      if (keysDown() &amp; KEY_A)
<br/>
      {
<br/>
         static int dataID = 0;
<br/>
         char data[200];
<br/>
         char string[256];
<br/>
         
<br/>
         memset(data, dataID, 200);
<br/>
         
<br/>
         sprintf(string, "\x1b[8;%dHX", dataID);
<br/>
         printf(string);
<br/>
         
<br/>
         if (keysHeld() &amp; KEY_B)
<br/>
            LOBBY_SendToUser(LOBBY_GetUserByID(selected), 0x8000, (void*)data , 200) ;
<br/>
         else
<br/>
            LOBBY_SendToUser(LOBBY_GetUserByID(selected), 0x0001, (void*)data , 200) ;
<br/>
<br/>
         dataID = (dataID + 1) % 32;
<br/>
         sent += 200;
<br/>
      }
<br/>
      
<br/>
      printf("\x1b[7;1dHrecv: %d send: %d  ", received, sent);
<br/>
      
<br/>
      /* display all users */
<br/>
      int i ;
<br/>
      printf("\x1b[0;0H") ;
<br/>
      for (i = 0;i&lt;max;i++)
<br/>
      {
<br/>
         LPLOBBY_USER user = LOBBY_GetUserByID(i) ;
<br/>
         if (i==selected)
<br/>
         {
<br/>
            printf("-&gt;%s (%s)       \n",LOBBY_GetUserName(user),LOBBY_IsTimedOut(user)?"TIMEOUT":"OK") ;
<br/>
         } else
<br/>
         {
<br/>
            printf("  %s (%s)       \n",LOBBY_GetUserName(user),LOBBY_IsTimedOut(user)?"TIMEOUT":"OK") ;
<br/>
         }
<br/>
      }
<br/>
<br/>
      swiWaitForVBlank() ;
<br/>
   }
<br/>
   return 0;
<br/>
}
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/>&lt;<a class="postlink" href="http://palib.info/forum/modules/newbb/viewtopic.php?viewmode=flat&amp;type=&amp;topic_id=3108&amp;forum=10" target="_blank">dsFont</a>&gt; &lt;<a class="postlink" href="http://palib.info/forum/modules/newbb/viewtopic.php?topic_id=2451&amp;forum=9" target="_blank">Game Collection</a>&gt;</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142742 - Mighty Max - Fri Oct 12, 2007 3:07 pm</h4>
    <div class="postbody"><span class="postbody">It is in the todo list since i first implemented the acknowledging
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
// ToDo: need to implement a way to prevent double receiving due to resending of non acked
<br/>
//       data
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I guess the priority of this has just increased ;)
<br/>
The lib currently doesn't remember which messages have been received. And i am unsure what amount of messages to remember as received (hword each) per user would be suitable. Maybe i can limit it by "all messages that are not older then x vblanks"<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142756 - Jesse - Fri Oct 12, 2007 7:24 pm</h4>
    <div class="postbody"><span class="postbody">I've updated my archive for the people wanting to test it out.
<br/>
<br/>
Some new feedback:
<br/>
* Custom IPC messages works nice. You forgot to pipe it through on the Arm9 side though.
<br/>
* The CPU doesn't block on Arm7 when calling LWIFI_IPC_UpdateNOIRQ anymore. Great!
<br/>
* In the updated version the normal wifi-stuff even works as long as you don't initialize the ad-hoc wifi by pressing a room icon. Yay!
<br/>
* You forgot to declare LOBBY_Shutdown in lobby.h
<br/>
<br/>
Other than that, things seem to work as before. I'm still don't receive about 20% of the messages, which is the primary problem for me. I looked at the room functions, but I didn't really get how they were supposed to work since you don't seem to get an ID after creating one. I guess I could get the room by sending in myself as a user, but I guess that is not how it is supposed to work?
<br/>
<br/>
Edit: By the way. Are you supposed to reserve a stream-id for your application?<br/>_________________<br/><a href="http://www.collectingsmiles.com/colors" target="_blank">http://www.collectingsmiles.com/colors</a> &amp; <a href="http://www.collectingsmiles.com/hyena" target="_blank">http://www.collectingsmiles.com/hyena</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142757 - Jesse - Fri Oct 12, 2007 7:34 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">I have also added a callback (see IPC_SetCustomCallback) for all IPC messages that are not handled by the lib. This way you can use the included IPC for transfering custom data.  Be sure that the lobby is initiated first.</td> </tr></table><span class="postbody">
<br/>
Err. I just saw the last sentence. I don't do that and it still works. Do I do anything wrong? :)<br/>_________________<br/><a href="http://www.collectingsmiles.com/colors" target="_blank">http://www.collectingsmiles.com/colors</a> &amp; <a href="http://www.collectingsmiles.com/hyena" target="_blank">http://www.collectingsmiles.com/hyena</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142760 - Mighty Max - Fri Oct 12, 2007 8:39 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Jesse wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Some new feedback:
<br/>
* Custom IPC messages works nice. You forgot to pipe it through on the Arm9 side though.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Thanks. Fixed.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
* The CPU doesn't block on Arm7 when calling LWIFI_IPC_UpdateNOIRQ anymore. Great!
<br/>
* In the updated version the normal wifi-stuff even works as long as you don't initialize the ad-hoc wifi by pressing a room icon. Yay!
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
:)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
* You forgot to declare LOBBY_Shutdown in lobby.h
<br/>
</td> </tr></table><span class="postbody">
<br/>
The Shutdown has not been done now. There only is this unworth placeholder.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Other than that, things seem to work as before. I'm still don't receive about 20% of the messages, which is the primary problem for me. 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I will work on it this weekend.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
I looked at the room functions, but I didn't really get how they were supposed to work since you don't seem to get an ID after creating one. I guess I could get the room by sending in myself as a user, but I guess that is not how it is supposed to work?
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
You can only be in one room at a time. After you have received the userinfo callback USERINFO_ROOMCHANGE, you can retreive the own room with the ID = ROOMID_MYROOM or with LOBBY_GetRoomByUser with yourself (USERID_MYSELF)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Edit: By the way. Are you supposed to reserve a stream-id for your application?</td> </tr></table><span class="postbody">
<br/>
<br/>
Well, you should be carefull when you send to stations you don't know. I was planning to add a game/appcode to the rooms to identify those who will follow the same concepts (And thus will know what which id is for them)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Do I do anything wrong? :)
<br/>
</td> </tr></table><span class="postbody">
<br/>
Nope. I was sleepy and din't want to add troubles by something i forgot to mention. The complete init was the safest way to say be sure to have the IPC iniated.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142785 - Mighty Max - Sat Oct 13, 2007 10:26 am</h4>
    <div class="postbody"><span class="postbody">Could you check multiple and loss packet receive out again please?
<br/>
<br/>
I have added a basic multiple filter (remembering the last 20 IDs received per user) and something i *think* will stop the packet loss.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142786 - ThomasS - Sat Oct 13, 2007 11:25 am</h4>
    <div class="postbody"><span class="postbody">It seems that almost all messages are now received exactly 2 times, some one time. I also got a "Transfer error 2!" in my code on one DS (but I don't know if that is due to the update).<br/>_________________<br/>&lt;<a class="postlink" href="http://palib.info/forum/modules/newbb/viewtopic.php?viewmode=flat&amp;type=&amp;topic_id=3108&amp;forum=10" target="_blank">dsFont</a>&gt; &lt;<a class="postlink" href="http://palib.info/forum/modules/newbb/viewtopic.php?topic_id=2451&amp;forum=9" target="_blank">Game Collection</a>&gt;</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142788 - Mighty Max - Sat Oct 13, 2007 11:45 am</h4>
    <div class="postbody"><span class="postbody">What is a "Transfer error 2"?<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142789 - Jesse - Sat Oct 13, 2007 12:22 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">Could you check multiple and loss packet receive out again please?</td> </tr></table><span class="postbody">
<br/>
There is no difference for me as far as I can tell. I still drop about 20% for small bursts, and it seems to increase to almost 50% while sending a 4 byte packet each vblank.<br/>_________________<br/><a href="http://www.collectingsmiles.com/colors" target="_blank">http://www.collectingsmiles.com/colors</a> &amp; <a href="http://www.collectingsmiles.com/hyena" target="_blank">http://www.collectingsmiles.com/hyena</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142790 - ThomasS - Sat Oct 13, 2007 12:35 pm</h4>
    <div class="postbody"><span class="postbody">My code from above outputs "Transfer Error 2!" when the content of a received packet does not match what should be received (every byte in a single packet should have the same value):
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
   for (i = 1; i &lt; 200; i++)
<br/>
   {
<br/>
      if (data[0] != data[i])
<br/>
      {
<br/>
         printf("\x1b[6;1HTransfer error 2!    ");
<br/>
         return;
<br/>
      }
<br/>
   } 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Packet loss with the 0x8000 stream is for me about 1%:
<br/>
One DS sent 44800 bytes, the other received 44400.<br/>_________________<br/>&lt;<a class="postlink" href="http://palib.info/forum/modules/newbb/viewtopic.php?viewmode=flat&amp;type=&amp;topic_id=3108&amp;forum=10" target="_blank">dsFont</a>&gt; &lt;<a class="postlink" href="http://palib.info/forum/modules/newbb/viewtopic.php?topic_id=2451&amp;forum=9" target="_blank">Game Collection</a>&gt;</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142791 - Mighty Max - Sat Oct 13, 2007 1:49 pm</h4>
    <div class="postbody"><span class="postbody">@Jesse,
<br/>
<br/>
ok thanks. I'll try to reproduce it.
<br/>
<br/>
@ThomasS, 
<br/>
Ahh. That sounds like i should re-think about how to determinate a packet was completely sent before filling the buffer again. Actually it seems that the current method changes the content of a packet with a new one while it is still in sending state in the TXSLOT ... interesting.
<br/>
<br/>
<br/>
:edit: the more i think about it, the more i think that this might actualy the root of both problems:
<br/>
Given the situation of two packets A,B are sent, and the corruption happens just after the messageID of packet A, the content of packet B is sent under the ID of A. Resulting in sending twice the content of B, but never the one of A. Unless the corrupted one gets rerequested.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142792 - Mighty Max - Sat Oct 13, 2007 3:16 pm</h4>
    <div class="postbody"><span class="postbody">I have hopefully fixed the TX corruption. *pressing thumbs*
<br/>
<br/>
Learned: The TX-Enable bit in the TX Slot hw-register is cleared already before the packet is through.
<br/>
<br/>
:eidt:
<br/>
Learned TXINFO register is also not useable for it. Changed to reg 0x0B6 (TXBUSY in gbatek)
<br/>
<br/>
:edit^2:
<br/>
I am now receiving also twice in about 10% of cases.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142793 - Jesse - Sat Oct 13, 2007 3:44 pm</h4>
    <div class="postbody"><span class="postbody">Crash and burn with the latest code. I'm not sure what happens but only a few packages goest through and the program seems to crash. A guess would be that the arm7 locks up, since it still prints out other arm9 debug info even though the program is unresponsive. Also, the example.nds prints out hex-numbers for a while if I press the buttons, but also stops responding after a few presses.<br/>_________________<br/><a href="http://www.collectingsmiles.com/colors" target="_blank">http://www.collectingsmiles.com/colors</a> &amp; <a href="http://www.collectingsmiles.com/hyena" target="_blank">http://www.collectingsmiles.com/hyena</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142796 - Mighty Max - Sat Oct 13, 2007 3:56 pm</h4>
    <div class="postbody"><span class="postbody">I found this too. And have updated the SVN after the post was created. (At the :edit:)
<br/>
<br/>
I have modified the example localy to reproduce your problem, and it seems that the loss might related to the IPC code. (i.e. arm7 malloc failing) i'll try to  resolve this by a feedback on the IPC send (ala OK malloc succeeded -&gt; continue)<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142801 - Mighty Max - Sat Oct 13, 2007 5:26 pm</h4>
    <div class="postbody"><span class="postbody">OK, one of the problems was just plain stupid by me. (The double receive)
<br/>
However i still didn't find the reason for the loss of frames, but im searching.
<br/>
<br/>
:edit: an update on the missing packets problem
<br/>
There seems to be a problem with the packet IDs. Somehow wrong values are set, and i am currently trying to figure out why. This looks like the reason for the loss, as this is making the acking *MOO* ;)
<br/>
<br/>
:edit^2:
<br/>
Traced it further :removed:
<br/>
<br/>
:edit^3:
<br/>
Ok. tracked one thing down. There was a situation where a ack wait would be overwritten, thus probably not be requested again. However there seems to be another thing, that leaves some data not to be acked and endlessly rerequested.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142812 - Mighty Max - Sat Oct 13, 2007 8:19 pm</h4>
    <div class="postbody"><span class="postbody">OK, missing packets have been resolved (i think)
<br/>
One typo, one missing assignment. Total number of involved characters in this problem: 23 (evil!)
<br/>
<br/>
Please note: Alltho now every packet is received in acked streams, it does not mean that they come in-order. The last sent message might be received first in the worst case.
<br/>
<br/>
Reordering will be done later. For today i close the DS.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142813 - MechaBouncer - Sat Oct 13, 2007 8:45 pm</h4>
    <div class="postbody"><span class="postbody">I just found this topic today and nearly fell out of my chair. This is awesome! Thank you so much for working on this. To think at long last we will start seeing homebrew ad-hoc DS apps makes me giddy. Thank you so much! ^_^<br/>_________________<br/>Cobalt/Black NDSL
<br/>
CycloDS Evolution (firmware 1.55 BETA 3) and EZFlash 3-in-1
<br/>
Kingston SD-C02G JAPAN 2GB MicroSD
<br/>
MoonShell 1.71, DSOrganize 3.1129, QuakeDS Pre3, ScummVM DS 0.11.1, Pocket Physics 0.6, OpenTyrian DS 0.3</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142834 - Mighty Max - Sun Oct 14, 2007 10:43 am</h4>
    <div class="postbody"><span class="postbody">Thanks for the heads up :)
<br/>
<br/>
The SVN (revision 40) has been updated with OOO-Management. Meaning that all packets in acked streams should be received in the same order they are sent. The ordering is done per user.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142844 - Jesse - Sun Oct 14, 2007 3:11 pm</h4>
    <div class="postbody"><span class="postbody">All data is received without duplications now. Nice!
<br/>
But there is some new problems. There seems to be a lot of lag. Small data bursts (meaning small strokes in Colors!) seems to go through with up to a second lag. Bigger strokes seems to lock things up much more. The sender seems to block if the receiver gets too far behind (somewhere around 50 bytes in the outgoing buffer). This happens becuase the receiver seems to choke with bigger data blocks, and can later be released after up to 20 seconds.
<br/>
<br/>
Edit: It's reproducable on the example-app as well if you mash all four buttons at the same time.<br/>_________________<br/><a href="http://www.collectingsmiles.com/colors" target="_blank">http://www.collectingsmiles.com/colors</a> &amp; <a href="http://www.collectingsmiles.com/hyena" target="_blank">http://www.collectingsmiles.com/hyena</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142848 - Mighty Max - Sun Oct 14, 2007 4:25 pm</h4>
    <div class="postbody"><span class="postbody">Yes i know. 
<br/>
There is a lot of optimizing place. However sending on each vblank might allways get troubles, as packets (Resends &amp; normal sends) accumulate because the resends/updates are done on vblank too.
<br/>
<br/>
I will optimize the order resends are send out, and drop of equal message sends (when a resend is to bedone while there is still one in the send queue) This should reduce the problem.
<br/>
<br/>
Nevertheless, sending bursts of few bytes packets is a lot of wasted overhead ;)<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142852 - Mighty Max - Sun Oct 14, 2007 5:04 pm</h4>
    <div class="postbody"><span class="postbody">I have changed the worst things (still some remaining) so that the lag should be reduced by a good amount.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142866 - Jesse - Sun Oct 14, 2007 7:37 pm</h4>
    <div class="postbody"><span class="postbody">Hmm. There was no improvement as far as I can see. The sender still blocks, and there is a big delay on receiving. Basically, for each input in my program (which is read after vblank), I broadcast the draw command which is a block of 4 bytes. What I see on the receiver is that it receives some data and then usually lag out on the few last commands. The common behaviour for example a 5 vblank stroke is that I receive the 4 first commands really fast and the last one after 2 seconds. I understand that the way I send data may not be optimal on the low-level network side, but it's good from my perspective to send things out as soon as possible, since I (in theory) get minimal latency.<br/>_________________<br/><a href="http://www.collectingsmiles.com/colors" target="_blank">http://www.collectingsmiles.com/colors</a> &amp; <a href="http://www.collectingsmiles.com/hyena" target="_blank">http://www.collectingsmiles.com/hyena</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142876 - Mighty Max - Sun Oct 14, 2007 8:23 pm</h4>
    <div class="postbody"><span class="postbody">- I have disabled the IPC-Feedback again, in the hope that this might be the cause in your app (It was reducing bandwidth of the IPC)
<br/>
- I have increased the interval until a packet is resend. This should also reduce the piling up problem, on the cost of 32ms / resend retry.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
I broadcast the draw command
<br/>
</td> </tr></table><span class="postbody">
<br/>
LOBBY_Broadcast should not work on acked streams at all.
<br/>
<br/>
If you send the 4 Bytes only, i think the lag will never be reduced to a level you are not recognizing it by getting two different images. The sending DS will allways execute the command before the receiving DS. Both images will be drawn slightly difference each time.
<br/>
<br/>
I'd recomment using timestamps to the commands, so that both DSes will execute the commands coming from different sources in the same order.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142893 - yellowstar - Sun Oct 14, 2007 9:25 pm</h4>
    <div class="postbody"><span class="postbody">Don't mean to hijack this topic or anything,
<br/>
but I have a problem with SVN.(I have a Win98 and XP)
<br/>
<br/>
I can't find any SVN clients.
<br/>
The graphical Win32 project,(Tortoise)
<br/>
dosen't work on either of my computers.
<br/>
<br/>
The offical command-line
<br/>
binarys seem to work.
<br/>
But,
<br/>
I don't want to use that.
<br/>
<br/>
Obviously,
<br/>
since I can't access SVN,
<br/>
I can't test and use the examples and library(s).
<br/>
<br/>
<br/>
<br/>
As for this project:
<br/>
<br/>
Download Play is one of the things
<br/>
that should be on the to-do list.
<br/>
<br/>
Of course,
<br/>
it dosen't need done untill after
<br/>
these problems are fixed.(lag and ect)
<br/>
<br/>
To do this,
<br/>
there would need to be a way
<br/>
to have the library users
<br/>
able to customize the value of the framehead,
<br/>
sequence number, and other vars.
<br/>
<br/>
Also,
<br/>
there would need to be a way
<br/>
for the lib users
<br/>
to send out an ACK.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142895 - Mighty Max - Sun Oct 14, 2007 10:03 pm</h4>
    <div class="postbody"><span class="postbody">I am using TortoiseSVN with the repository, so it should work.
<br/>
<br/>
The lib is not meant to be compatible with the official download &amp; play games. There are other projects that are trying exactly this (See Juglak's WMB)
<br/>
<br/>
However it should be no problem to provide the homebrew binary in a room, so that a player can join a game after downloading the image.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142904 - Jesse - Sun Oct 14, 2007 10:48 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">- I have disabled the IPC-Feedback again, in the hope that this might be the cause in your app (It was reducing bandwidth of the IPC)
<br/>
<br/>
- I have increased the interval until a packet is resend. This should also reduce the piling up problem, on the cost of 32ms / resend retry.</td> </tr></table><span class="postbody">
<br/>
Yes.  It works much better now. The problems are still there though, with the sender starting to slow down (small blocks I guess) after stress sending for more than a second. Also, the receiver behaves as before but to a less extent, with the last packages almost always lagging behind a second or so. A future feature-request would be to have a non-blocking mode where a SendToUser command may fail if the outgoing buffer is full (if that is what happens).
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">I broadcast the draw command</td> </tr></table><span class="postbody">
<br/>
Sorry, my mistake. I use LOBBY_SendToUser.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">The sending DS will allways execute the command before the receiving DS. Both images will be drawn slightly difference each time.</td> </tr></table><span class="postbody">
<br/>
Of course. I've been thinking of how the syncronization should be done best but I've not picked a direction yet. But that's my problem. :)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">If you send the 4 Bytes only, i think the lag will never be reduced to a level you are not recognizing it by getting two different images. .</td> </tr></table><span class="postbody">
<br/>
I've been thinking on this some more, and it should be possible for me to buffer the data on the sender, without getting any noticably higher latency. Any recommended packet-sizes in mind?<br/>_________________<br/><a href="http://www.collectingsmiles.com/colors" target="_blank">http://www.collectingsmiles.com/colors</a> &amp; <a href="http://www.collectingsmiles.com/hyena" target="_blank">http://www.collectingsmiles.com/hyena</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142905 - Mighty Max - Sun Oct 14, 2007 11:12 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
A future feature-request would be to have a non-blocking mode where a SendToUser command may fail if the outgoing buffer is full (if that is what happens). 
<br/>
</td> </tr></table><span class="postbody">
<br/>
What happens there is that the sender checks the message buffer if the message to place in there next is already in the message buffer. That it slows down so much is a sign, that the messagebuffer grows big.
<br/>
<br/>
If i would allow a send to fail, we'd just have an eqal to unacked streams.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Jesse wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">If you send the 4 Bytes only, i think the lag will never be reduced to a level you are not recognizing it by getting two different images. .</td> </tr></table><span class="postbody">
<br/>
I've been thinking on this some more, and it should be possible for me to buffer the data on the sender, without getting any noticably higher latency. Any recommended packet-sizes in mind?</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Well, i was already thinking on merging messages while they are in the send queue if they belong to the same user, reducing the overhead. If that is done, the size shouldn't matter, as many small packets would share the costs of overhead.
<br/>
<br/>
In numbers:
<br/>
The 802.11 frame header and FCS is 28 Bytes. The 802.3 snap 8 Bytes and the lobby adds another 8 Bytes. So that the data sent by the sender is 44 Bytes + payload. The receiving DS returns an ack which payload of 8 Bytes. 
<br/>
<br/>
Total transfered bytes = 44 + 52 + payload Bytes
<br/>
<br/>
So that with 4 Byte payloads we have a overhead:payload ratio of 24:1<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142910 - Jesse - Mon Oct 15, 2007 12:26 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">If i would allow a send to fail, we'd just have an eqal to unacked streams.</td> </tr></table><span class="postbody">
<br/>
Well, the idea was that I would know it had failed and could resend it later without stalling the whole program, but it may not be relevant if it's not really blocking and is just taking time.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">Total transfered bytes = 44 + 52 + payload Bytes</td> </tr></table><span class="postbody">
<br/>
Ok. I'm starting to see what you are getting at. :)
<br/>
By the way. What kinds of transfer-speeds do you think we will be able to get?<br/>_________________<br/><a href="http://www.collectingsmiles.com/colors" target="_blank">http://www.collectingsmiles.com/colors</a> &amp; <a href="http://www.collectingsmiles.com/hyena" target="_blank">http://www.collectingsmiles.com/hyena</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142911 - yellowstar - Mon Oct 15, 2007 12:36 am</h4>
    <div class="postbody"><span class="postbody">Thank's Mighty,
<br/>
I tried downloading and installing again,
<br/>
and this time it worked!
<br/>
<br/>
Sorry,
<br/>
I didn't know this lib isn't mean't
<br/>
to use download play.
<br/>
<br/>
I was wondering about transfer speeds,
<br/>
too.
<br/>
<br/>
EDIT:
<br/>
How do I download everything?(on this respistory,
<br/>
with the aforemetchioned program)
<br/>
(Minus the source)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142933 - Mighty Max - Mon Oct 15, 2007 8:54 am</h4>
    <div class="postbody"><span class="postbody">I have no idea about the bandwidth yet.
<br/>
It might even be, that the IPC limits the bandwidth more then the actual wifi. 
<br/>
<br/>
@yellowstar: the only binaries in the SVN is the lib itself (liblobby7d.a / liblobby9d.a). Use make to build the example. Make sure devkitpro will find the includes/libs
<br/>
<br/>
I think i have a good idea how to allow many short messages with much less overhead. The plan is to not put the packets into the send queue directly, but using the resend at vblank to combine small packets that are collected in the need-to-be-acked cache into larger ones (using multiple lobby-chunks in one snap frame)
<br/>
<br/>
Today campus-life starts again, so it can take a bit ;)<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142970 - ThomasS - Mon Oct 15, 2007 6:42 pm</h4>
    <div class="postbody"><span class="postbody">I think I've found more problems:
<br/>
- Try my code from above, send one or more unreliable messages (by holding B while pressing A), then no more reliable message (sent by pressing A) is received (but still unreliable messages).
<br/>
- If only sending reliable messages, after ~1 1/2 rows of "X" it gets slower until it almost stands. This happens only if you send from both DS at the same time and hit the button relatively fast. Perhaps this is the result of too much re-sending if I understand it correctly that you just filter double messages out instead of reducing the amount of re-sends.
<br/>
<br/>
I'm using revision 45.<br/>_________________<br/>&lt;<a class="postlink" href="http://palib.info/forum/modules/newbb/viewtopic.php?viewmode=flat&amp;type=&amp;topic_id=3108&amp;forum=10" target="_blank">dsFont</a>&gt; &lt;<a class="postlink" href="http://palib.info/forum/modules/newbb/viewtopic.php?topic_id=2451&amp;forum=9" target="_blank">Game Collection</a>&gt;</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142979 - Mighty Max - Mon Oct 15, 2007 8:20 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ThomasS wrote:</b></span></td> </tr> <tr> <td class="quote">I think I've found more problems:
<br/>
- Try my code from above, send one or more unreliable messages (by holding B while pressing A), then no more reliable message (sent by pressing A) is received (but still unreliable messages).
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
This sounds like one of the DSes went shortly into a timeout. would not yet reset the OOO-processing on the opposing side, resulting in a long wait for the next expected msg, but allways receives the packetIDs from the start again. (Or the other way around)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
- If only sending reliable messages, after ~1 1/2 rows of "X" it gets slower until it almost stands. This happens only if you send from both DS at the same time and hit the button relatively fast. Perhaps this is the result of too much re-sending if I understand it correctly that you just filter double messages out instead of reducing the amount of re-sends.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
This slowdown can be massively reduced by hashing the messages, so that the comparison gets _much_ faster (espacially if all messages are of the same length). But i think i will go a different way anyways, but this will take a bit atm. Need to catch a good start on campus right now.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142997 - yellowstar - Mon Oct 15, 2007 11:41 pm</h4>
    <div class="postbody"><span class="postbody">I have found out I need to use save as and export for downloading.
<br/>
<br/>
I have found some bugs.
<br/>
<br/>
That crash error is back.(the exception(white text on red background))
<br/>
Pressing Select causes it.
<br/>
<br/>
I tested with two original DSes.(didn't know were the Lite was,
<br/>
will test again with it later)
<br/>
<br/>
When I started pressing two keys on one DS,(A and B)
<br/>
eventually there was a difference between
<br/>
the sent and received numbers on both systems.
<br/>
This difference was 2.
<br/>
<br/>
When I started pressing 4 keys on one DS,
<br/>
eventually the difference went upto 3,
<br/>
but eventually it went backto 2.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143102 - yellowstar - Tue Oct 16, 2007 9:56 pm</h4>
    <div class="postbody"><span class="postbody">I have tested with all systems.(both originals and a Lite)
<br/>
<br/>
My one DS quit receiving from the other DSes after
<br/>
I mashed all the buttons for a little bit.
<br/>
<br/>
When the R key is held down,
<br/>
the system says the message
<br/>
was sent, but it isn't received on the target DS.
<br/>
<br/>
The 2 message difference was probably caused
<br/>
by the 2 messages sent at the start of the program.
<br/>
<br/>
The rest of the difference could have been caused
<br/>
by holding down R.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143140 - Mighty Max - Wed Oct 17, 2007 7:45 am</h4>
    <div class="postbody"><span class="postbody">In the latest SVN there are still some problems with the transmit. This turns out to be a bit more difficult then it looks in the first place. This results in a lot more problems dropped at sending as needed to, espacially if they are going out in short time.
<br/>
<br/>
The worst stupidity bug in there resulting in doublte transmitting of some and dropping some other packets is fixed in the SVN. This however does not fix your described problems yet.
<br/>
<br/>
<br/>
I will also need to test IPC performance. More and more i think a lot of trouble is caused there...<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143167 - Mighty Max - Wed Oct 17, 2007 5:59 pm</h4>
    <div class="postbody"><span class="postbody">Some interesting numbers on the IPC subsystem.
<br/>
<br/>
<br/>
IPC Performance Test
<br/>
Test A (100 frames each, active filling &amp; irq triggered)
<br/>
Framesize - kB/s
<br/>
<ul>
<br/>
<li>8 =&gt; 195.3kB/s
<br/>
</li><li>16 =&gt; 390.6kB/s
<br/>
</li><li>32 =&gt; 520.8kB/s
<br/>
</li><li>64 =&gt; 694.4kB/s
<br/>
</li><li>128 =&gt; 694.4kB/s
<br/>
</li><li>256 =&gt; 609.8kB/s
<br/>
</li><li>512 =&gt; 171.2kB/s
<br/>
</li><li>1024 =&gt; 155.5kB/s
<br/>
</li></ul>
<br/>
(Notes: The higher speed of the  16-256Byte frames is most likely due to cache. The slow speed of 8, 16 compared to the other small packets is - i think - due to the overhead/payload ratio, as every frame is prefixed by 4 Bytes)
<br/>
<br/>
Test B (100 frames each, IRQ triggered filling only)
<br/>
<ul>
<br/>
<li>8 =&gt; 97.7kB/s
<br/>
</li><li>16 =&gt; 120.2kB/s
<br/>
</li><li>32 =&gt; 135.9kB/s
<br/>
</li><li>64 =&gt; 142.0kB/s
<br/>
</li><li>128 =&gt; 145.3kB/s
<br/>
</li><li>256 =&gt; 147.9kB/s
<br/>
</li><li>512 =&gt; 148.4kB/s
<br/>
</li><li>1024 =&gt; 145.1kB/s
<br/>
</li></ul>
<br/>
<br/>
These numbers are after a fix in the IPC system. Completely unpolled IPC transfers in the SVN atm has a speed of 0.0kB ;) but i can only commit this patch when the other code giving me troubles atm is fixed too.
<br/>
<br/>
At least it shows, that the IPC shouldn't be the bottleneck (yet)<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143184 - Mighty Max - Wed Oct 17, 2007 8:20 pm</h4>
    <div class="postbody"><span class="postbody">The SVN has had a huge update. 
<br/>
<br/>
Larger bursts still cause problems (from delay to syncing out=stopped receive) when the messageamount per vblank tops the collector's size, but short bursts did not cause any problems anymore on my testing setup. 
<br/>
<br/>
Short bursts in this case are bursts with (messageCount * 8 + sizeof(4-Byte-padded-payloads))  &lt; 500
<br/>
<br/>
Some of the problems are still caused by the transmit routines. When sending from a system i know that works perfectly (ralink) the lobby responds instantly even on long bursts, so that i have to assume that i am still harvesting problems there.
<br/>
<br/>
I.e. i don't really understand why the wait for WIFI_TXBUSY bits to clear causes a complete lockup (the busy bit never resetting)<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143189 - Jesse - Wed Oct 17, 2007 11:30 pm</h4>
    <div class="postbody"><span class="postbody">I tried the update and it's much better. It's seems to be more responsive and as you say, short bursts are usually transmitted almost instantly.
<br/>
<br/>
I still have the receiver choking up after a while and I noticed something strange. If I turn off the sender when the receiver have started to choke the data still keeps dripping in. I got one or two packets each second for 20 seconds. I'm not sure if that is what you expected. :)<br/>_________________<br/><a href="http://www.collectingsmiles.com/colors" target="_blank">http://www.collectingsmiles.com/colors</a> &amp; <a href="http://www.collectingsmiles.com/hyena" target="_blank">http://www.collectingsmiles.com/hyena</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143207 - Mighty Max - Thu Oct 18, 2007 6:33 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Jesse wrote:</b></span></td> </tr> <tr> <td class="quote">If I turn off the sender when the receiver have started to choke the data still keeps dripping in. I got one or two packets each second for 20 seconds. I'm not sure if that is what you expected. :)</td> </tr></table><span class="postbody">
<br/>
<br/>
Actually this is VERY interesting. Thanks for the report.
<br/>
Think i'll need to enhance the IPC testcases when i return from the courses today.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143258 - Mighty Max - Thu Oct 18, 2007 8:49 pm</h4>
    <div class="postbody"><span class="postbody">It seems that there are actually a lot of things going wrong at the IPC level.
<br/>
<br/>
There was another stupid bug fixed in the CVS, and a workaround for troubles i need to still find the reason.
<br/>
<br/>
This should make larger bursts work better. 
<br/>
In a short test, a continous send of 11 bytes payload every vblank failed not before the 1597th packet, which is a good improve against the previos reaction to vblank sending.
<br/>
<br/>
As i now know where the problem got to be, the next problems should be solveable. However, i still need to find the actual missprogramming/typo.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143259 - Jesse - Thu Oct 18, 2007 9:28 pm</h4>
    <div class="postbody"><span class="postbody">I tried the update. The receiver seems to instantly stop receiving and/or crash randomly. Also, once an IPC message was passed to the CustomCallback on Arm9 without me sending it.<br/>_________________<br/><a href="http://www.collectingsmiles.com/colors" target="_blank">http://www.collectingsmiles.com/colors</a> &amp; <a href="http://www.collectingsmiles.com/hyena" target="_blank">http://www.collectingsmiles.com/hyena</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143260 - Mighty Max - Thu Oct 18, 2007 9:47 pm</h4>
    <div class="postbody"><span class="postbody">There has been a new IPCTAG_ECHO that will return the packet to the arm9 instantly, and cause a callback if it gets received again. If you used this number as an own tag, this might have caused the unexpected receive.
<br/>
<br/>
Because of the bug that has to be somewhere in the IPC, sending custom IPC messages might trigger it too, causing the crashes. If you could post me the Register content the of pc,lr and the stackvalues on the crashes (red screen of death) together with the .map file (strip the things you don't want to share), this would help alot to locate the failing code<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143262 - Jesse - Thu Oct 18, 2007 10:21 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">There has been a new IPCTAG_ECHO that will return the packet to the arm9 instantly, and cause a callback if it gets received again. If you used this number as an own tag, this might have caused the unexpected receive.</td> </tr></table><span class="postbody">Nope. I only use commands going from 0xf0 - 0xf4.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">Because of the bug that has to be somewhere in the IPC, sending custom IPC messages might trigger it too, causing the crashes. </td> </tr></table><span class="postbody">I'm not sending any custom message during this time, so that's not it.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">If you could post me the Register content the of pc,lr and the stackvalues on the crashes (red screen of death) together with the .map file (strip the things you don't want to share), this would help alot to locate the failing code</td> </tr></table><span class="postbody">I have no idea how to do that, sorry. I've never bother with trying to get any kind of debugger up and running.<br/>_________________<br/><a href="http://www.collectingsmiles.com/colors" target="_blank">http://www.collectingsmiles.com/colors</a> &amp; <a href="http://www.collectingsmiles.com/hyena" target="_blank">http://www.collectingsmiles.com/hyena</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143263 - Mighty Max - Thu Oct 18, 2007 10:27 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Jesse wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">If you could post me the Register content the of pc,lr and the stackvalues on the crashes (red screen of death) together with the .map file (strip the things you don't want to share), this would help alot to locate the failing code</td> </tr></table><span class="postbody">I have no idea how to do that, sorry. I've never bother with trying to get any kind of debugger up and running.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Take a look in the folder your arm9 build-files are in. There should be a file with the ending .map which just tells what info is stored at which place in ram.
<br/>
<br/>
On the red crash-screen, the registers are labeled. Just manually copy &amp; paste ;)
<br/>
<br/>
This way i can see which function is crashing, and out of which context it is called. I have tried my best to provoke a crash in the examples but i couldn't reproduce it yet.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143264 - Jesse - Thu Oct 18, 2007 10:31 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">On the red crash-screen, the registers are labeled. Just manually copy &amp; paste ;)</td> </tr></table><span class="postbody">
<br/>
I'm always running on actual hardware, so I'm not sure what you mean. I've never seen a red crash-screen.<br/>_________________<br/><a href="http://www.collectingsmiles.com/colors" target="_blank">http://www.collectingsmiles.com/colors</a> &amp; <a href="http://www.collectingsmiles.com/hyena" target="_blank">http://www.collectingsmiles.com/hyena</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143266 - Mighty Max - Thu Oct 18, 2007 10:52 pm</h4>
    <div class="postbody"><span class="postbody">OK. that's no problem.
<br/>
<br/>
If you wondering what i'm on about (and this might help you too maybe)
<br/>
When running on the hardware, set an exception handler i.e. by "defaultExceptionHandler();". Whenever a memory location is accessed (code read, data read, data write) what does not exist, the DS will then show the red screen showing what happened where, instead of just crashing. This works for the arm9 only, because of the cp15 memory protection unit which is not present on the arm7.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143267 - Jesse - Thu Oct 18, 2007 10:59 pm</h4>
    <div class="postbody"><span class="postbody">Well there you go! For once I've spent too much time working on the actual application and not the toolset behind it. :)
<br/>
<br/>
EDIT: Ok. It seems like there is no arm9 exception generated. I can easily get the receiver to lock up (or at least stop generating input) after around a 100 4-byte packages. When the receiver is locked up and if I continue to send data the sender goes slower and slower until it locks up as well.<br/>_________________<br/><a href="http://www.collectingsmiles.com/colors" target="_blank">http://www.collectingsmiles.com/colors</a> &amp; <a href="http://www.collectingsmiles.com/hyena" target="_blank">http://www.collectingsmiles.com/hyena</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143297 - melw - Fri Oct 19, 2007 9:54 am</h4>
    <div class="postbody"><span class="postbody">I finally got the time needed and started testing with the library... One obvious thing that came to my mind: Shouldn't there be a flag or an option for broadcasting your own ID? From the traditional server-client point of view what is needed is that only server broadcasts it's id while it's accepting new users and clients connect to the server only. Currently LOBBY_Update() is broadcasting every 1/6 second (assuming it's called in vblank), right?
<br/>
<br/>
In other words, what I'm after on a library level:
<br/>
- Server: LOBBY_CreateRoom(), start broadcasting now
<br/>
- Client 1-n: see only server broadcasting, LOBBY_JoinRoom()
<br/>
- Server: when max. users have joined to room, stop broadcasting OR if we decide that we're e.g. starting a game, stop broadcasting manually
<br/>
<br/>
Perhaps this could be as an alternative to the current "all users broadcast all the time" approach? LOBBY_StartBroadcast() / LOBBY_StopBroadcast() or passing a flag to LOBBY_Update()?
<br/>
<br/>
PS. MessageQueue.h is still missing #ifdef __cplusplus... I don't like SVN merging files all the time. :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143301 - Mighty Max - Fri Oct 19, 2007 10:33 am</h4>
    <div class="postbody"><span class="postbody">Well the transport layers (802.11, the lobby-message-delivery) are peer-to-peer and can not that easily be exchanged against server-client designs in a mobile environment without troubles.
<br/>
<br/>
If something goes wrong (noise, distance etc) with the "server" at session level only this one session will stop working. If the server/client design is implemented at the transport layers (broadcasts), the whole network will go down, which is something i want to prevent. If two groups are playing beneath each other i don't want that if group A stops playing (thus stops the server) will break group B's game.
<br/>
<br/>
The current design of the arm9 triggered broadcasts will be a thing to be changed for automatic broadcasting via beacon slot. But i will still need to broadcast the user's presence and capabilities (Just like in real 802.11 ad-hoc mode every station beacons)<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143305 - melw - Fri Oct 19, 2007 10:52 am</h4>
    <div class="postbody"><span class="postbody">Ok. You have valid points there. Although I don't see how two groups playing at the same time would break each others games. Each game has of course an own server as the DS starting the game acts like it.
<br/>
<br/>
Well, it's easy to disregard the unneeded broadcast messages in user code, so this isn't a problem of any sorts.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143306 - Mighty Max - Fri Oct 19, 2007 10:58 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>melw wrote:</b></span></td> </tr> <tr> <td class="quote">Although I don't see how two groups playing at the same time would break each others games. Each game has of course an own server as the DS starting the game acts like it.</td> </tr></table><span class="postbody">
<br/>
<br/>
The lower layers (where the broadcast is needed for) does not know about games. A hierarchy would therefor apply to all or none.
<br/>
<br/>
<br/>
The layer for the rooms actually does allready act the way (only server broadcasts) you suggested btw. Only if the DS is a room-Owner, the room-info are appended to the broadcast.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143308 - Mighty Max - Fri Oct 19, 2007 11:27 am</h4>
    <div class="postbody"><span class="postbody">Maybe i should do a clean restart.
<br/>
<br/>
I already thought about doing some more checks on what which hardware register does and the meaning of some flags. When i arrive home today, lynx's great help should have arrived that makes this possible.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143310 - melw - Fri Oct 19, 2007 11:46 am</h4>
    <div class="postbody"><span class="postbody">Could you also make a small example of how rooms should be used? Browsing the library source gives some idea, but I still fail to do something as simple as listing the available rooms.
<br/>
<br/>
Edit: Having slept over this, I realized how the user callback works. Here's a small room example that works otherwise, but the room owner never realizes that there's a room (even if you try to join manually (SELECT) and send messages to a room (X &amp; Y)). Any pointers on what I'm doing wrong here?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include "nds.h"
<br/>
#include &lt;nds/arm9/console.h&gt; //basic print funcionality
<br/>
#include &lt;stdio.h&gt;
<br/>
<br/>
#include "safe_malloc.h"
<br/>
#include "MessageQueue.h"
<br/>
#include "802.11.h"
<br/>
#include "lobby.h"
<br/>
#include &lt;fat.h&gt;
<br/>
#include &lt;malloc.h&gt;
<br/>
#include &lt;string.h&gt;
<br/>
<br/>
LPLOBBY_USER roomOwner = NULL;
<br/>
<br/>
void VBlankIRQ(void)
<br/>
{
<br/>
   REG_IF = IRQ_VBLANK ;
<br/>
   IPC_RcvCompleteCheck() ;
<br/>
   LOBBY_Update() ;
<br/>
}
<br/>
<br/>
void receiveUser(unsigned char *data, int length, LPLOBBY_USER from)
<br/>
{
<br/>
   printf("user msg %s: %s\n", LOBBY_GetUserName(from), (char*)data);
<br/>
}
<br/>
<br/>
void receiveRoom(unsigned char *data, int length, LPLOBBY_USER from)
<br/>
{
<br/>
   printf("room msg %s: %s\n", LOBBY_GetUserName(from), (char*)data);
<br/>
}
<br/>
<br/>
void userCallback(LPLOBBY_USER user, unsigned long reason)
<br/>
{
<br/>
   switch(reason)
<br/>
   {
<br/>
      case USERINFO_REASON_REGOGNIZE:
<br/>
         printf("user callback: %s recognized\n", LOBBY_GetUserName(user));
<br/>
      break;
<br/>
      case USERINFO_REASON_TIMEOUT:
<br/>
         printf("user callback: %s timeout\n", LOBBY_GetUserName(user));
<br/>
      break;
<br/>
      case USERINFO_REASON_RETURN:
<br/>
         printf("user callback: %s returned\n", LOBBY_GetUserName(user));
<br/>
      break;
<br/>
      case USERINFO_REASON_ROOMCREATED:
<br/>
         printf("user callback: %s created a room\n", LOBBY_GetUserName(user));
<br/>
         roomOwner = user;
<br/>
      break;
<br/>
      case USERINFO_REASON_ROOMCHANGE:
<br/>
         printf("user callback: %s changed a room\n", LOBBY_GetUserName(user));
<br/>
      break;
<br/>
   }
<br/>
}
<br/>
<br/>
int main(void) 
<br/>
{
<br/>
   REG_EXMEMCNT=0xe800;
<br/>
<br/>
   powerON(POWER_ALL);
<br/>
   REG_IME = 0 ;
<br/>
   REG_IE = 0 ;
<br/>
   REG_IF = 0xFFFF ;
<br/>
<br/>
   videoSetMode(0);   //not using the main screen
<br/>
   videoSetModeSub(MODE_0_2D | DISPLAY_BG0_ACTIVE);   //sub bg 0 will be used to print text
<br/>
   vramSetBankC(VRAM_C_SUB_BG);
<br/>
<br/>
   SUB_BG0_CR = BG_MAP_BASE(31);
<br/>
<br/>
   BG_PALETTE_SUB[255] = RGB15(31,31,31);   //by default font will be rendered with color 255
<br/>
<br/>
   //consoleInit() is a lot more flexible but this gets you up and running quick
<br/>
   consoleInitDefault((u16*)SCREEN_BASE_BLOCK_SUB(31), (u16*)CHAR_BASE_BLOCK_SUB(0), 16);
<br/>
   
<br/>
<br/>
   defaultExceptionHandler() ;
<br/>
<br/>
   irqInit() ;
<br/>
<br/>
   // Startup IPC engine
<br/>
   IPC_Init() ;
<br/>
   IPC_SetMsgCompleteCallback(&amp;IPC_RcvCompleteCheck) ;
<br/>
<br/>
   // usual VBlank
<br/>
   irqSet(IRQ_VBLANK,&amp;VBlankIRQ) ;
<br/>
   irqEnable(IRQ_VBLANK) ;
<br/>
<br/>
   consoleClear() ;
<br/>
   
<br/>
   int selected = 0 ;
<br/>
<br/>
   LOBBY_Init() ;
<br/>
   LOBBY_SetStreamHandler(0x0001,&amp;receiveUser);
<br/>
   LOBBY_SetStreamHandler(0x0002,&amp;receiveRoom);
<br/>
   LOBBY_SetUserInfoCallback(&amp;userCallback);
<br/>
<br/>
   printf("init done\n");
<br/>
   
<br/>
   while (1) 
<br/>
   {
<br/>
      /* handle input */
<br/>
      int max = LOBBY_GetNumberOfKnownUsers() ;
<br/>
      scanKeys() ;
<br/>
      if (keysDown() &amp; KEY_DOWN)
<br/>
      {
<br/>
         selected++ ;
<br/>
         if (max &gt; 0) selected %= max ;
<br/>
         printf("selected [%d]: %s\n", selected, LOBBY_GetUserName(LOBBY_GetUserByID(selected)));
<br/>
      }
<br/>
      if (keysDown() &amp; KEY_UP)
<br/>
      {
<br/>
         selected-- ;
<br/>
         if (max &gt; 0) selected %= max ;
<br/>
         printf("selected [%d]: %s\n", selected, LOBBY_GetUserName(LOBBY_GetUserByID(selected)));
<br/>
      }
<br/>
      if (keysDown() &amp; KEY_START)
<br/>
      {
<br/>
         printf("create room\n");
<br/>
         LOBBY_CreateRoom("LOBBY",8);
<br/>
         roomOwner = LOBBY_GetUserByID(USERID_MYSELF);
<br/>
      }
<br/>
      if (keysDown() &amp; KEY_A)
<br/>
      {
<br/>
         printf("send a to user %s\n", LOBBY_GetUserName(LOBBY_GetUserByID(selected)));
<br/>
         LOBBY_SendToUser(LOBBY_GetUserByID(selected),0x0001,(unsigned char *)"Key [A] pressed.",17) ;
<br/>
      }
<br/>
      if (keysDown() &amp; KEY_B)
<br/>
      {
<br/>
         printf("send b to user %s\n", LOBBY_GetUserName(LOBBY_GetUserByID(selected)));
<br/>
         LOBBY_SendToUser(LOBBY_GetUserByID(selected),0x0001,(unsigned char *)"Key [B] pressed.",17) ;
<br/>
      }
<br/>
      if (keysDown() &amp; KEY_X)
<br/>
      {
<br/>
         if(roomOwner!=NULL)
<br/>
         {
<br/>
            printf("send x to room %s\n", LOBBY_GetUserName(roomOwner));
<br/>
            LPLOBBY_ROOM room = LOBBY_GetRoomByUser(roomOwner);
<br/>
            LOBBY_SendToRoom(room,0x0002,(unsigned char *)"Key [X] pressed.",17) ;
<br/>
         }
<br/>
      }
<br/>
      if (keysDown() &amp; KEY_Y)
<br/>
      {
<br/>
         if(roomOwner!=NULL)
<br/>
         {
<br/>
            printf("send y to room %s\n", LOBBY_GetUserName(roomOwner));
<br/>
            LPLOBBY_ROOM room = LOBBY_GetRoomByUser(roomOwner);
<br/>
            LOBBY_SendToRoom(room,0x0002,(unsigned char *)"Key [Y] pressed.",17) ;
<br/>
         }
<br/>
      }
<br/>
      if (keysDown() &amp; KEY_SELECT)
<br/>
      {
<br/>
         if(roomOwner!=NULL)
<br/>
         {
<br/>
            printf("join room hosted by %s\n", LOBBY_GetUserName(roomOwner));
<br/>
            LPLOBBY_ROOM room = LOBBY_GetRoomByUser(roomOwner);
<br/>
            LOBBY_JoinRoom(room);
<br/>
         }
<br/>
      }
<br/>
      swiWaitForVBlank() ;
<br/>
   }   
<br/>
<br/>
   return 0;
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143365 - simonjhall - Sat Oct 20, 2007 1:10 pm</h4>
    <div class="postbody"><span class="postbody">Wotcha, I just checked out and built the example, but I still ain't getting a single packet received by either of the DS' I tested...
<br/>
Since I could be messing up the build process, reckon you could send me a pre-built nds that I could try?<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143369 - Mighty Max - Sat Oct 20, 2007 1:49 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>melw wrote:</b></span></td> </tr> <tr> <td class="quote">Could you also make a small example of how rooms should be used? Browsing the library source gives some idea, but I still fail to do something as simple as listing the available rooms.
<br/>
<br/>
Edit: Having slept over this, I realized how the user callback works. Here's a small room example that works otherwise, but the room owner never realizes that there's a room (even if you try to join manually (SELECT) and send messages to a room (X &amp; Y)). Any pointers on what I'm doing wrong here?</td> </tr></table><span class="postbody">
<br/>
<br/>
You are doing wrong nothing.
<br/>
<br/>
The room creator is instantly roommember #0. It is not (yet) causing a callback. I was in the middle of implementing rooms when the receive problems started, so the knife is still sticking in the room-code ;)
<br/>
<br/>
SendToUser, SendToRoom etc are never received by the sender. 
<br/>
<br/>
There are a lot of things missing here, including the gameid for the room, leaving/destroying rooms, etc.
<br/>
<br/>
@simon: I have uploaded the example to <a href="http://mightymax.org/example.nds" target="_blank">http://mightymax.org/example.nds</a> .<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143370 - simonjhall - Sat Oct 20, 2007 1:57 pm</h4>
    <div class="postbody"><span class="postbody">Still nothing :-(
<br/>
Is there something that I should be doing? I'm running it on one DS with my M3 Simply, unplugging it, plugging it into another DS and turning it on, then jabbing all the buttons on each DS. I've tried using my other flash cards too, no difference.
<br/>
One thing I've noticed that when I run it on my gbamp when the program starts it says 0 packets received, 0 packets sent. When I start it on the M3 it always says 0 packets received, 2 packets sent. Uh...<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143371 - Mighty Max - Sat Oct 20, 2007 2:13 pm</h4>
    <div class="postbody"><span class="postbody">Hmm, that is weird.
<br/>
Does the normal wifi-stuff work for you?
<br/>
<br/>
Does anyone else have problems receiving anything?<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143372 - simonjhall - Sat Oct 20, 2007 2:19 pm</h4>
    <div class="postbody"><span class="postbody">Yeah, normal wifi works fine for me, plus Phusson's original test program (which hung up after a few messages) worked too...<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143373 - Mighty Max - Sat Oct 20, 2007 2:47 pm</h4>
    <div class="postbody"><span class="postbody">The postman just arrived.
<br/>
<br/>
I can confirm, that on the M3 Simply (equal to R4DS) the sent packets number starts at 2. I'll investigate why that is. But it is receiving the other station.
<br/>
<br/>
I'll check if i can come up with some explanation why it does not work for you/ or a test to show find the difference causing the problem.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143374 - simonjhall - Sat Oct 20, 2007 3:09 pm</h4>
    <div class="postbody"><span class="postbody">Err, more interestingness - we got all the DS' in my house together, and they all work fine! In fact the two DS' that I have worked fine when it was just them running....so I go upstairs...and they no longer work. Uh-huh.
<br/>
It seems that the closer I get to the wifi antenna on my computer the worse the connection gets. Is this to be expected?
<br/>
<br/>
Ten seconds later I get a call up the stairs "is your Internet connection working?" :-)<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143375 - Mighty Max - Sat Oct 20, 2007 3:18 pm</h4>
    <div class="postbody"><span class="postbody">Erm, ooookay.
<br/>
<br/>
The protocol shouldn't interfere with regular 802.11 nodes, but depending on the traffic that is allready in the air ...
<br/>
<br/>
Try using a different channel. There is no function for this yet, but you can change it by modifying the channel=7 line in LOBBY_Init()<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143378 - simonjhall - Sat Oct 20, 2007 4:25 pm</h4>
    <div class="postbody"><span class="postbody">Ah, interesting. Ok my home's wifi seems to be running on channel 9. If I remember 802.11 from uni, channel 7 and channel 9 overlap - right? I changed the channel to 1 and and it worked first time! Any chance of you exposing the channel number in lobby_init()?
<br/>
When I was using channel 7 I was occasionally getting a runaway detection of packets on one of my DS when it was near my AP. I had assumed it was picking up packets from that, yet when I turned off the second DS the runaway on DS #1 would stop.
<br/>
<br/>
One thing I have noticed is that often an 'extra' DS will be detected, when there isn't one. The further away you go the more fake DS' appear. Can anything be done about this?
<br/>
<br/>
Again kudos on the good work done here :-D<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143379 - Mighty Max - Sat Oct 20, 2007 4:41 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>simonjhall wrote:</b></span></td> </tr> <tr> <td class="quote">Ah, interesting. Ok my home's wifi seems to be running on channel 9. If I remember 802.11 from uni, channel 7 and channel 9 overlap - right? I changed the channel to 1 and and it worked first time! Any chance of you exposing the channel number in lobby_init()?
<br/>
When I was using channel 7 I was occasionally getting a runaway detection of packets on one of my DS when it was near my AP. I had assumed it was picking up packets from that, yet when I turned off the second DS the runaway on DS #1 would stop.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I wanted to test on LOBBY_Init the channel with either already a DS sending on or if not, choosing the least used channel. But channel change often failed on the ralink.
<br/>
Exposing the channel select shouldn't be of any problem.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
One thing I have noticed is that often an 'extra' DS will be detected, when there isn't one. The further away you go the more fake DS' appear. Can anything be done about this?
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I have noticed this too again. I get "." recognized sometimes. There is evidence that this is caused by some data corruption within my code again. I'm searching.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Again kudos on the good work done here :-D</td> </tr></table><span class="postbody">
<br/>
Thanks, but right now it is in an awfull bad state.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143387 - melw - Sat Oct 20, 2007 5:39 pm</h4>
    <div class="postbody"><span class="postbody">Mighty Max, I found a small bug - in LOBBY_SendToRoom() the code would never sent to any other user than the room owner:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">// outside users can only send to room leader
<br/>
if (room != &amp;currentLobby-&gt;room)
<br/>
</td> </tr></table><span class="postbody">
<br/>
Changing above line to following fixed the problem:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">if (room != currentLobby-&gt;myself.room) 
<br/>
</td> </tr></table><span class="postbody">
<br/>
I don't know if this is the actual cause or result of another bug, but at least this is how I got 3 DS's in same room and sending group messages to each other working.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143439 - simonjhall - Sun Oct 21, 2007 4:26 pm</h4>
    <div class="postbody"><span class="postbody">I've been integrating your wifi stuff into QDS and have a few questions about this lobby stuff:
<br/>
<br/>
- What's the difference between LOBBY_SendToAll and LOBBY_Broadcast? Neither seems to do anything for me and instead I have to do a for loop with LOBBY_GetNumberOfKnownUsers and LOBBY_SendToUser to do what I want...
<br/>
- Is there any verfication of the packets that are sent? eg some kind of checksum, or should I add code to do that myself?
<br/>
- I've noticed that sometimes one DS isn't noticed by the other one - is there some way to send out a message saying "I'm here, notice me!" ;-)
<br/>
- do messages get sent instantly, or are they queued? If they are, how long will they live in the buffer before sent off (assuming no more data appears)?
<br/>
- after I do a LOBBY_SendToUser, am I right in assuming that I can change the data after this call, since that function takes a copy of the data?
<br/>
<br/>
Ta :-D
<br/>
<br/>
Btw, doing an update every vblank is too infrequent for me, so for kicks I moved it to the hblank. However, doing this locks it up...errr....<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143440 - Mighty Max - Sun Oct 21, 2007 5:18 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>simonjhall wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
- What's the difference between LOBBY_SendToAll and LOBBY_Broadcast? Neither seems to do anything for me and instead I have to do a for loop with LOBBY_GetNumberOfKnownUsers and LOBBY_SendToUser to do what I want...
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
LOBBY_SendToAll, should do exactly this: iterate through all known user and trigger a send to them. LOBBY_Broadcast will send out a message to all MACs (MAC Address "FFFFFFFFFFFF")
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
- Is there any verfication of the packets that are sent? eg some kind of checksum, or should I add code to do that myself?
<br/>
</td> </tr></table><span class="postbody">
<br/>
There is a checksum within the 802.11 frame, which is checked on receive. However there isn't one for the encapsuled data. When the sending/receive works (and not have software errors) no further verification should be needed.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
- I've noticed that sometimes one DS isn't noticed by the other one - is there some way to send out a message saying "I'm here, notice me!" ;-)
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
This message is broadcasted every 10th time LOBBY_Update is called.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
- do messages get sent instantly, or are they queued? If they are, how long will they live in the buffer before sent off (assuming no more data appears)?
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Non-acked-Messages are sent instantly. Acked messages will be collected and sent on the next LOBBY_Update.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
- after I do a LOBBY_SendToUser, am I right in assuming that I can change the data after this call, since that function takes a copy of the data?
<br/>
</td> </tr></table><span class="postbody">
<br/>
Yes you can. the message is appended to the needed header, and put into a cache.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Btw, doing an update every vblank is too infrequent for me, so for kicks I moved it to the hblank. However, doing this locks it up...errr....</td> </tr></table><span class="postbody">
<br/>
<br/>
The timings are defined relative to the vblank atm. Meaning that broadcasting, timeouts, resending etc are fastened by 263 times, which is expected to make troubles ;)<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143453 - Mighty Max - Sun Oct 21, 2007 10:25 pm</h4>
    <div class="postbody"><span class="postbody">The point where the data corrupts has been found, the reason not :/
<br/>
<br/>
Alltho there is 0x0C00 bytes available for sent in the current setup, using tx slot #3 (0x800-0xBFF) seems to cause the problem.... disabled this slot for sending again.
<br/>
<br/>
I'll need to implement some handshaking (resynching the to-be-expected packetID) to fix problem of stalling after the connection timed out from one side only.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143539 - melw - Tue Oct 23, 2007 4:06 pm</h4>
    <div class="postbody"><span class="postbody">This is far from finished, but as I had to take my development laptop to warranty service today (for a change), I decided to put online a small work-in-progress of Dicewars DS using Mighty's library: <a class="postlink" href="http://dicewars.drunkencoders.com/beta/" target="_blank">http://dicewars.drunkencoders.com/beta/</a>
<br/>
<br/>
As stated on the linked page, this is still very much unfinished, but at least it's possible to play 2 player games. With 3 players I started to have severe timeout problems - somehow it looks like that one of the DS's (the one joining in last? not 100% sure) has more latency and starts to miss messages after a while.
<br/>
<br/>
I hope to be able to resume work on this soon again.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143546 - Mighty Max - Tue Oct 23, 2007 6:42 pm</h4>
    <div class="postbody"><span class="postbody">Nice :)
<br/>
<br/>
It works so far, that tha game is shared between the players. 
<br/>
But the actual game does not start then (maybe i am missing the trigger?)
<br/>
<br/>
---
<br/>
<br/>
I've found and fixed a very annoying bug btw. The irony: the better the connection the worse the lockup. 
<br/>
It shows that the better the connection was the less went through :p
<br/>
The acks caused an ack, caused an ack .... so that after some time the whole system was busy with only sending acks over and over.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143548 - MechaBouncer - Tue Oct 23, 2007 7:09 pm</h4>
    <div class="postbody"><span class="postbody">Thus causing the DS itself to go *ACK* and die? Sounds like these DSes need some coughdrops so they're not acking all over each other.
<br/>
<br/>
<br/>
<br/>
<br/>
Okay, I'm done now. XD<br/>_________________<br/>Cobalt/Black NDSL
<br/>
CycloDS Evolution (firmware 1.55 BETA 3) and EZFlash 3-in-1
<br/>
Kingston SD-C02G JAPAN 2GB MicroSD
<br/>
MoonShell 1.71, DSOrganize 3.1129, QuakeDS Pre3, ScummVM DS 0.11.1, Pocket Physics 0.6, OpenTyrian DS 0.3</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143553 - tepples - Tue Oct 23, 2007 8:08 pm</h4>
    <div class="postbody"><span class="postbody">"Ack ack ack, ack ack ack ack."
<br/>
-- Martians from <a class="postlink" href="http://en.wikipedia.org/wiki/Mars_Attacks%21" target="_blank"><span style="font-style: italic">Mars Attacks!</span> (1996)</a>
<br/>
<br/>
TFTP <a class="postlink" href="http://en.wikipedia.org/wiki/Sorcerer%27s_Apprentice_Syndrome" target="_blank">used to have this problem</a>.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143554 - Mighty Max - Tue Oct 23, 2007 8:26 pm</h4>
    <div class="postbody"><span class="postbody">A very nice movie btw. I love it :D
<br/>
<br/>
The ack's were not by design causing a re-ack (The chunk is placed within the no-ack streams), but a bug caused the FCS of the ack to be missread as the next chunk start, and thus sending the new ack. 
<br/>
<br/>
Lynx's help is really starting to help a lot. Independently capturing the traffic between the now flashed second DS and the original one showed another problem. Out of one collected frame containing multiple to-be-acked chunks only two were acked ... i'll go back to trace it down now<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143556 - melw - Tue Oct 23, 2007 8:47 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">It works so far, that tha game is shared between the players. 
<br/>
But the actual game does not start then (maybe i am missing the trigger?)
<br/>
</td> </tr></table><span class="postbody">
<br/>
It should be possible to play games if only the amount of players is set regarding how many DS's you have in use. Set  max. players value same as min. players, as remaining slots will be filled with CPU players otherwise - with missing AI code - no dice :). The game will start when minimum number of players have joined and are all marked ready (click lower right arrow or press 'A').</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143557 - Mighty Max - Tue Oct 23, 2007 8:55 pm</h4>
    <div class="postbody"><span class="postbody">Works perfectly this way :) (NDSL vs NDS)
<br/>
<br/>
The one losing is missing a "Haha! You lost!" screen *g*<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143587 - yellowstar - Wed Oct 24, 2007 3:09 am</h4>
    <div class="postbody"><span class="postbody">I am attempting to make a 2-player pong game.
<br/>
<br/>
I have finished the connecting part.
<br/>
<br/>
It dosen't use rooms.(too incomplete)
<br/>
Instead, it uses the players for connecting.
<br/>
<br/>
It pretends that the first player detected is
<br/>
the only other player there.
<br/>
<br/>
This works well.(I didn't test with a third DS.)
<br/>
<br/>
One problem is,
<br/>
the host detects all other players.(even hosts)
<br/>
(I didn't test this, this is what would probably happen.)
<br/>
Another thing is,
<br/>
it detects the players before they choose wether
<br/>
they want to be a host or client.
<br/>
Obviously, it should only be after that,
<br/>
and for only the clients.
<br/>
(I tried to get around those problems,(the players would "broadcast" what they are(host/client),
<br/>
and the players would remove all the players in te list, except for the opposite.
<br/>
(client-host host-client))
<br/>
(but the code for the structs wouldn't compile.)
<br/>
<br/>
Here's how I sync the systems for connecting.(the systems are already connected,(each has
<br/>
the others LPLOBBY_USER pointer)
<br/>
this is just for sync and to confirm the other is still there.)
<br/>
<br/>
The host sends a message to the client.(this message is same as the client's message)
<br/>
The host waits on the client for the response.
<br/>
<br/>
The client waits for the message from the host.
<br/>
Once the message is received,
<br/>
it replys to the host.(it sends the same message backto the host)
<br/>
<br/>
They are now synced.
<br/>
<br/>
The problem with the way I do it is,
<br/>
I have the players press A to start connecting.
<br/>
(I have the giveup time for a long time,(the time it takes the player to stop sending
<br/>
the message, and quit.)
<br/>
but it needs to be shorter so the players know when his opponet quit.)
<br/>
(It would be nice if there would be a function in the lib which would take care of this,
<br/>
but that can wait till after these bugs are fixed.)
<br/>
<br/>
Don't expect much graphics-wise.
<br/>
For the the connecting part,
<br/>
it is console.
<br/>
<br/>
For the actual game,
<br/>
it will have backgrounds and basic sprites.
<br/>
<br/>
After all,
<br/>
the point is to see that it actually works.(this game and the lib)
<br/>
And for reporting bugs otherwise.
<br/>
(I might add better graphics later,
<br/>
but console and better graphics wouldn't look good.)
<br/>
<br/>
<br/>
<br/>
By the way,
<br/>
what does the REG_EX(E)MEMCNT
<br/>
assignment do in the example?
<br/>
<br/>
(I'm using R 48 for this game.
<br/>
(I'm not sure if this is the most recent revision.))
<br/>
<br/>
download
<br/>
<a href="http://members.iglide.net/ticeandsons/yellowstar/yell_pong.zip" target="_blank">http://members.iglide.net/ticeandsons/yellowstar/yell_pong.zip</a>
<br/>
(includes the source and binarys)
<br/>
(the yell stands for yellowstar)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143606 - Mighty Max - Wed Oct 24, 2007 1:48 pm</h4>
    <div class="postbody"><span class="postbody">The SVN server is back up (after crash), dunno if anyone noticed ;)
<br/>
<br/>
I have again reduced the load on the channel caused by a transfer stream pushing a lot of ack's (one for each chunk) onto the channel. Instead there should be a collected ack for a transfer frame of collected chunks now.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143610 - Jesse - Wed Oct 24, 2007 3:57 pm</h4>
    <div class="postbody"><span class="postbody">Any idea of what is causing my problems? I've updated to new versions but the problem doesn't seem to change. I've updated the adhoc-test if you want to check it out.
<br/>
<a href="http://www.collectingsmiles.com/colors/colors_adhoctest.rar" target="_blank">http://www.collectingsmiles.com/colors/colors_adhoctest.rar</a><br/>_________________<br/><a href="http://www.collectingsmiles.com/colors" target="_blank">http://www.collectingsmiles.com/colors</a> &amp; <a href="http://www.collectingsmiles.com/hyena" target="_blank">http://www.collectingsmiles.com/hyena</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143612 - Mighty Max - Wed Oct 24, 2007 5:16 pm</h4>
    <div class="postbody"><span class="postbody">I've just tested it between a NDSL and a NDS with a capture running on the PC:
<br/>
<br/>
If started on the DSL or NDSL alone, using the R4DS, the DS starts to broadcast the userinfo after the room is select. 
<br/>
If I start it via GBAMP on the DSL colors locks up as soon as the room is selected. No message leaves the DS.
<br/>
<br/>
When started both from the R4DS, it works fine in the first, but after a bit of painting, the sending of the transfer steam stops completely. Even the the packets send from the other station are not replied to. (So it is not a probelm with IDs getting out of sync)
<br/>
The broadcasts will still flow.
<br/>
<br/>
The only reason the lobby would stop sending anything to the user would be a timeout, but as both DSes are still broadcasting their ID, there is no hint that this happens. Can you check if the users are timing out?
<br/>
<br/>
Another thing would be a problem with the receive on the DS that stops responding resulting in a timeout. This might be caused by a getting low on memory on the arm7.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143613 - Jesse - Wed Oct 24, 2007 5:35 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">The only reason the lobby would stop sending anything to the user would be a timeout, but as both DSes are still broadcasting their ID, there is no hint that this happens. Can you check if the users are timing out?</td> </tr></table><span class="postbody">
<br/>
Yes, that seems to happen.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">Another thing would be a problem with the receive on the DS that stops responding resulting in a timeout. This might be caused by a getting low on memory on the arm7.</td> </tr></table><span class="postbody">
<br/>
Seems resonable. The receiver seems to receive its messages slower and slower until it stops receiving. Still, since input is working correctly on it, the arm7 isn't locked up.
<br/>
<br/>
Edit: I managed to reproduce the timeout even if all data I sent managed to get through to the receiver, which seems a bit weird to me.
<br/>
Edit2: Uploaded a version with the debug-log turned off, so you can see the users and timeouts. (not that it gives you any information you don't already know).<br/>_________________<br/><a href="http://www.collectingsmiles.com/colors" target="_blank">http://www.collectingsmiles.com/colors</a> &amp; <a href="http://www.collectingsmiles.com/hyena" target="_blank">http://www.collectingsmiles.com/hyena</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143620 - Mighty Max - Wed Oct 24, 2007 8:21 pm</h4>
    <div class="postbody"><span class="postbody">I can reproduce this situation now.
<br/>
<br/>
Only need to find out what happens.
<br/>
What i checked is the memory issue. I've made the arm7 to one-ipc-only so i am not filling the limited memory up with received dataframes and it still happens :/<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143702 - melw - Thu Oct 25, 2007 1:17 pm</h4>
    <div class="postbody"><span class="postbody">Got my laptop back from the warranty service (new display, yay!) Noticed that latest version has room id's, game versions and LOBBY_LeaveRoom() implemented, in other words just about everything I was lacking for my game room implementation - thanks for the update!
<br/>
<br/>
Unfortunately the current svn version is very unstable for me. Especially when 3rd DS powers up, one of the other DS's will crash 3/4 of the times (upper screen red, lower screen white). However no register data is printed unlike with previous crashes. And yes, defaultExceptionHandler() is being set. I also updated to devkitARM R21 + latest libnds at the same time.
<br/>
<br/>
I'll try to debug this more later tonight, hopefully I can isolate then a test case...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143719 - Mighty Max - Thu Oct 25, 2007 4:16 pm</h4>
    <div class="postbody"><span class="postbody">The SVN uploaded should fix a lot of the instablility.
<br/>
<br/>
- intermixed frames are silently dropped now, as the FCS is now created before the frame is put into the HW and the hardware FCS was disabled
<br/>
- there was a function called nested in some cases (Another receive completed before a receive reply was triggered) this caused data corruption in the received frames.
<br/>
<br/>
I was able to complete 5 runs of an lobby example (which is not yet in the svn) transfering 150kB &amp; exchanging 600 acked frames each. Before the last two fixes, i rarely was able to complete one run.
<br/>
<br/>
:edit:
<br/>
After testing with bigger files (5.14MB) im observing a different problem now. I'm transfering an average of about 1MB before that happens on the receiver's side.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"><br/><br/>Last edited by Mighty Max on Thu Oct 25, 2007 5:25 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#143720 - Lick - Thu Oct 25, 2007 4:26 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">I was able to complete 5 runs of an lobby example (which is not yet in the svn) transfering 150kB &amp; exchanging 600 acked frames each. Before the last two fixes, i rarely was able to complete one run.</td> </tr></table><span class="postbody">
<br/>
Sounds like there's quite an improvement there! Good job! Let's hope it runs fine on other's hardware as well.<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143730 - Jesse - Thu Oct 25, 2007 6:38 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">The SVN uploaded should fix a lot of the instablility.</td> </tr></table><span class="postbody">
<br/>
I got the timeout even sooner after this update. :/
<br/>
Any ideas?<br/>_________________<br/><a href="http://www.collectingsmiles.com/colors" target="_blank">http://www.collectingsmiles.com/colors</a> &amp; <a href="http://www.collectingsmiles.com/hyena" target="_blank">http://www.collectingsmiles.com/hyena</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143741 - Mighty Max - Thu Oct 25, 2007 8:01 pm</h4>
    <div class="postbody"><span class="postbody">Hmm, this is unexpected.
<br/>
<br/>
None of the changes should have a noticeable impact on the response times. It is however a bit heavier on the local memory usage of the arm9 (as each rcv callback gets it's own receive buffer, but it is free'd on leaving each callback) It shouldn't have an impact on the arm7 memory usage.
<br/>
<br/>
Did you update your adhoc test colors, so i can take a look?
<br/>
<br/>
:edit: 
<br/>
The problem mentioned earlier (which used to be at about 1MB) seems to be only a problem of receiving on the DS. The more traffic is on air, the faster this happens. The outgoing data remains working.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143753 - Mighty Max - Thu Oct 25, 2007 9:10 pm</h4>
    <div class="postbody"><span class="postbody">Actually, i think i've found that bastard of a bug that caused the receive locking up. I'm doing some more tests before putting it on the SVN.
<br/>
<br/>
It seems i missed something when resetting the IF registers in the irq handler:
<br/>
<br/>
When resetting IF.bit24, all WIFI_IF bits needs to be deactivated at one time too. When i was receiving another frame (thus getting IF &amp;IE !=0) while i was still processing another irq (TX complete, etc) this failed, and the wifi irq never was triggered again.
<br/>
<br/>
3MB transfered with no problems right now. Testing more *g*
<br/>
<br/>
:edit: crashed with a red screen of death, after returning from a malloc with 0 @ 3.7MB (so most likely only a mem leak in the transfer app). No problem so far, but i want to get through the complete file once before commiting<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143764 - Jesse - Thu Oct 25, 2007 9:49 pm</h4>
    <div class="postbody"><span class="postbody">Looking forward to it. Let me know if still you want me to update the adhoctest.<br/>_________________<br/><a href="http://www.collectingsmiles.com/colors" target="_blank">http://www.collectingsmiles.com/colors</a> &amp; <a href="http://www.collectingsmiles.com/hyena" target="_blank">http://www.collectingsmiles.com/hyena</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143765 - Mighty Max - Thu Oct 25, 2007 9:55 pm</h4>
    <div class="postbody"><span class="postbody">I've commited it, as it the only crashes i could get now was the mem leak.
<br/>
The memleak got to be somewhere in LOBBY_SendToUser and it's helping functions. It does not happen for small frames as far as i observed (only the DS sending 512+12 Byte chunks has this problem)
<br/>
<br/>
If you still get the lockups, a updated adhoctest would be good :D
<br/>
<br/>
<br/>
:edit: the mem leak has been resolved, it was nearly holdung up a big red sign, and i still missed it on the first look-through<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143776 - Jesse - Thu Oct 25, 2007 10:37 pm</h4>
    <div class="postbody"><span class="postbody">Wonderful! It works flawless for me now. I'll better get started on getting all the features in there!<br/>_________________<br/><a href="http://www.collectingsmiles.com/colors" target="_blank">http://www.collectingsmiles.com/colors</a> &amp; <a href="http://www.collectingsmiles.com/hyena" target="_blank">http://www.collectingsmiles.com/hyena</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143777 - Jesse - Thu Oct 25, 2007 10:42 pm</h4>
    <div class="postbody"><span class="postbody">I've updated the adhoctest just because I'm so happy right now. Next steps for me is to trying to figure out how to synchronize strokes properly. There is some small input stutter which probably comes from the wifi doing work on the arm7 core, but that's probably easily solved from my side. Also, I'm going to dig into doing a proper room implementation. But that's for tomorrow.<br/>_________________<br/><a href="http://www.collectingsmiles.com/colors" target="_blank">http://www.collectingsmiles.com/colors</a> &amp; <a href="http://www.collectingsmiles.com/hyena" target="_blank">http://www.collectingsmiles.com/hyena</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143779 - Mighty Max - Thu Oct 25, 2007 11:09 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Jesse wrote:</b></span></td> </tr> <tr> <td class="quote">I've updated the adhoctest just because I'm so happy right now. Next steps for me is to trying to figure out how to synchronize strokes properly. There is some small input stutter which probably comes from the wifi doing work on the arm7 core, but that's probably easily solved from my side. Also, I'm going to dig into doing a proper room implementation. But that's for tomorrow.</td> </tr></table><span class="postbody">
<br/>
<br/>
Great!
<br/>
<br/>
Yes. The arm7 does get into a short blocking, when it receieves some data (it is making sure the data is sent to the arm9 before continuing) and it will wait on Sends passed from the arm9 until they are put into the HW queue.
<br/>
<br/>
But those were things i implemented as a "to be sure nothing happens here" and can be reversed to some degree.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143780 - melw - Thu Oct 25, 2007 11:14 pm</h4>
    <div class="postbody"><span class="postbody">Excellent! Updated the svn, compiled, tested and just finished a 3 player game of Dicewars DS using the library for the first time. No crashes, no timeouts, looks like all the previous problems are gone for now. I need to still work on the game-side implementation, but now I'm very optimistic about next version being fully ad-hoc playable. :)
<br/>
<br/>
Great work, again!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143784 - Lick - Thu Oct 25, 2007 11:33 pm</h4>
    <div class="postbody"><span class="postbody">Idea #1: pong.
<br/>
Idea #2: two-player platformer where p1 controls the character and attacks the monsters, and p2 finishes puzzles and draw routes so p1 can go further.
<br/>
<br/>
Wouldn't Pong be an excellent tutorial for the DStoDS library?<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143785 - Mighty Max - Thu Oct 25, 2007 11:41 pm</h4>
    <div class="postbody"><span class="postbody">*listens to the first mp3 file &gt;4MB transfered via <b style="color:#FFA34F">liblobby</b>*
<br/>
"Die Toten Hosen - Nur zu Besuch" (Just for a visit)
<br/>
<br/>
<br/>
:D
<br/>
<br/>
<br/>
Yes, i thought about pong also, but since i have not much knowledge about programming tiled 2D on the DS, and Yellowstar starting a pong, i'm not starting on this.
<br/>
<br/>
There is still a lot of things to do on the lib itself. Just the worst bugs have been resolved. And some Documentation need to be done too ;)<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143792 - MechaBouncer - Fri Oct 26, 2007 12:42 am</h4>
    <div class="postbody"><span class="postbody">I had an idea for a Front Mission (turn-based strategy with customizable giant robots) clone using local and/or online play, but lost interest in it because of an actual Front Mission release for the DS (that, and I have yet to actually write anything for the DS since I spend more time playing with homebrew or commercial games &gt;_&lt;). Regardless, I think a game like that would work very well for this too.<br/>_________________<br/>Cobalt/Black NDSL
<br/>
CycloDS Evolution (firmware 1.55 BETA 3) and EZFlash 3-in-1
<br/>
Kingston SD-C02G JAPAN 2GB MicroSD
<br/>
MoonShell 1.71, DSOrganize 3.1129, QuakeDS Pre3, ScummVM DS 0.11.1, Pocket Physics 0.6, OpenTyrian DS 0.3</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143812 - adamrgolf - Fri Oct 26, 2007 9:43 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Jesse wrote:</b></span></td> </tr> <tr> <td class="quote">I've updated the adhoctest just because I'm so happy right now. Next steps for me is to trying to figure out how to synchronize strokes properly. There is some small input stutter which probably comes from the wifi doing work on the arm7 core, but that's probably easily solved from my side. Also, I'm going to dig into doing a proper room implementation. But that's for tomorrow.</td> </tr></table><span class="postbody">
<br/>
<br/>
Jesse, you are amazing.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143813 - adamrgolf - Fri Oct 26, 2007 9:48 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Jesse wrote:</b></span></td> </tr> <tr> <td class="quote">I've updated the adhoctest just because I'm so happy right now. Next steps for me is to trying to figure out how to synchronize strokes properly. There is some small input stutter which probably comes from the wifi doing work on the arm7 core, but that's probably easily solved from my side. Also, I'm going to dig into doing a proper room implementation. But that's for tomorrow.</td> </tr></table><span class="postbody">
<br/>
<br/>
Also, I may have just missed it, but did you leave out calibration from the latest adhoc test?
<br/>
<br/>
EDIT: Jesse, you should start a adhoctest bug thread, i feel bad posting here. Just wanted to let you know the latest adhoc test has problems after shutting and reopening the ds. The first time i got just a black screen and the ds was locked up. Then I restarted the ds to try it again and this time it brought the colors menu back, but i could not choose anything, it was locked up. OK bye! Thanks!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143818 - Jesse - Fri Oct 26, 2007 10:55 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>adamrgolf wrote:</b></span></td> </tr> <tr> <td class="quote">Also, I may have just missed it, but did you leave out calibration from the latest adhoc test?</td> </tr></table><span class="postbody">
<br/>
Well, yes. It was not meant to be used for anything other than just testing out the core part of libwifi, and I haven't really cared about anything else. Since that seems to be resolved now, I'll go work on integrating this properly into Colors!. Once that is done I'll probably post a more proper version in the Colors! thread for some feedback.
<br/>
<br/>
(and thanks for the bugreport, I'll keep a look out for it)<br/>_________________<br/><a href="http://www.collectingsmiles.com/colors" target="_blank">http://www.collectingsmiles.com/colors</a> &amp; <a href="http://www.collectingsmiles.com/hyena" target="_blank">http://www.collectingsmiles.com/hyena</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143820 - adamrgolf - Fri Oct 26, 2007 11:04 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Jesse wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>adamrgolf wrote:</b></span></td> </tr> <tr> <td class="quote">Also, I may have just missed it, but did you leave out calibration from the latest adhoc test?</td> </tr></table><span class="postbody">
<br/>
Well, yes. It was not meant to be used for anything other than just testing out the core part of libwifi, and I haven't really cared about anything else. Since that seems to be resolved now, I'll go work on integrating this properly into Colors!. Once that is done I'll probably post a more proper version in the Colors! thread for some feedback.
<br/>
<br/>
(and thanks for the bugreport, I'll keep a look out for it)</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Sounds great, thanks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143829 - ThomasS - Fri Oct 26, 2007 1:29 pm</h4>
    <div class="postbody"><span class="postbody">With the latest version, I can finally play some levels in Lode Runner cooperatively without a lockup! That's really great, thanks a lot!
<br/>
It could be that my arm7 mp3 decoding code interfers sometimes with liblobby, as I got very strange things (the game slowing down extremely on one DS and reacting strange) in a level with a specific background (= specific music), but that's likely to be more a problem of my arm7 code.
<br/>
Now I need to code a better synchronization of the game states ... ;-)<br/>_________________<br/>&lt;<a class="postlink" href="http://palib.info/forum/modules/newbb/viewtopic.php?viewmode=flat&amp;type=&amp;topic_id=3108&amp;forum=10" target="_blank">dsFont</a>&gt; &lt;<a class="postlink" href="http://palib.info/forum/modules/newbb/viewtopic.php?topic_id=2451&amp;forum=9" target="_blank">Game Collection</a>&gt;</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143835 - Jesse - Fri Oct 26, 2007 3:54 pm</h4>
    <div class="postbody"><span class="postbody">Enumerating rooms currently seems like a pain and there is currently no way to be sure they are coming in a consistent order. A LOBBY_GetRoomByName or a LOBBY_GetNumberOfKnownRooms would make my day.
<br/>
<br/>
Edit: I needed this because I want my app to have 4 predefined public rooms. I can solve this by storing the roomid in the version:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">unsigned int ID = LOBBY_GetRoomGameVersion(room);
<br/>
Version = ID &amp; 0x3fff;
<br/>
if(Version == Colors_iVersion)
<br/>
{
<br/>
   unsigned int iRoom = ID &gt;&gt; 14;</td> </tr></table><span class="postbody">
<br/>
<br/>
Btw, there is a bug in the SVN where the LOBBY_GetRoomGameVersion reports the GameCode instead:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">unsigned short LOBBY_GetRoomGameVersion(LPLOBBY_ROOM room)
<br/>
{
<br/>
   if (!room) return 0 ;
<br/>
   return room-&gt;gameCode ;
<br/>
}</td> </tr></table><span class="postbody"><br/>_________________<br/><a href="http://www.collectingsmiles.com/colors" target="_blank">http://www.collectingsmiles.com/colors</a> &amp; <a href="http://www.collectingsmiles.com/hyena" target="_blank">http://www.collectingsmiles.com/hyena</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143841 - Mighty Max - Fri Oct 26, 2007 6:16 pm</h4>
    <div class="postbody"><span class="postbody">Erm yes, copy&amp;paste ;)
<br/>
<br/>
I was thinking about a 
<br/>
LOBBY_FindRoomByGame(unsigned short gameCode, LPLOBBY_ROOM anchor) ;
<br/>
to iterate through rooms.
<br/>
<br/>
The GetNumberOfKnownRooms will be added too.
<br/>
Btw, you can workaround it yet with GetRoomByID until the returned value is null.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143851 - yellowstar - Fri Oct 26, 2007 8:30 pm</h4>
    <div class="postbody"><span class="postbody">I have a question about the lib and the rooms:
<br/>
<br/>
How does a host
<br/>
detect when a client has joined its room?
<br/>
<br/>
Or do I have to do that myself?(a way
<br/>
to have the host detect joined clients.(via messages))</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143854 - Mighty Max - Fri Oct 26, 2007 8:49 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yellowstar wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
How does a host
<br/>
detect when a client has joined its room?
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
When a user joins the room, a userinfo callback is generated with the parameter USERINFO_ROOMCHANGE. You can tell it is your room, by checking via LOBBY_GetRoomByUser.
<br/>
<br/>
Another way would be to monitor the number of users in your room.
<br/>
<br/>
Your room is allways LOBBY_GetRoomByID(ROOMID_MYROOM)
<br/>
<br/>
<br/>
If you have some other way to get feedback on roomjoins in mind, let me know.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144125 - melw - Mon Oct 29, 2007 12:00 pm</h4>
    <div class="postbody"><span class="postbody">The latest revision in svn seems to be somehow broken - after initialization I get almost immediately user timeouts, after first sent message or even before that. First I suspected something to be wrong with my game code, but compiling the svn example with the latest lib had the same problem. Reverting back to revision 60 (25/10/07) fixed these timeout problems for me.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144134 - Mighty Max - Mon Oct 29, 2007 1:14 pm</h4>
    <div class="postbody"><span class="postbody">Hmm. that is weird. The only thing changed that is related to sending/timeout is the change of the broadcast interval. ("I am here") to twice every second.
<br/>
<br/>
The rest are only the find room routines.
<br/>
<br/>
Does it work again if you use rev61 with the old timeout settings? (Line 27 of lobby.c -&gt; change back from 30 to 10)<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144136 - melw - Mon Oct 29, 2007 1:39 pm</h4>
    <div class="postbody"><span class="postbody">Ok, it was only the precompiled library giving this problem. When I compiled the library myself from the r61 svn source there was no problem at all (tested with various broadcast intervals, too). I also noticed that when I compile the library myself, the liblobby9d.a is 78kb, but the version in svn is only 75kb. liblobby7d.a seems to be identical both in svn and when compiled locally.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144137 - Mighty Max - Mon Oct 29, 2007 1:47 pm</h4>
    <div class="postbody"><span class="postbody">Oh, ok.
<br/>
<br/>
That is my fault. I had previously tested something. And guess i didn't make it before commiting<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144148 - Mighty Max - Mon Oct 29, 2007 5:00 pm</h4>
    <div class="postbody"><span class="postbody">Next Version will have some performance monitoring to find the bottlenecks. ... 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
Function LOBBY_AckStreamHandler(0):
<br/>
   calls            : 1833
<br/>
  [Including subcall times]
<br/>
      total clocks   : 2033768 cycles
<br/>
      total time      : 60.6841673700 msecs
<br/>
      clocks per call   : 1109 cycles
<br/>
      time per call   : 0.0330906680 msecs
<br/>
  [Pure times]
<br/>
      total clocks   : 444643 cycles
<br/>
      total time      : 13.2673885280 msecs
<br/>
      clocks per call   : 242 cycles
<br/>
      time per call   : 0.0072208671 msecs
<br/>
<br/>
Function LOBBY_AddDataToAck(1):
<br/>
   calls            : 2047
<br/>
  [Including subcall times]
<br/>
      total clocks   : 1788840 cycles
<br/>
      total time      : 53.3759337142 msecs
<br/>
      clocks per call   : 873 cycles
<br/>
      time per call   : 0.0260488306 msecs
<br/>
  [Pure times]
<br/>
      total clocks   : 1788840 cycles
<br/>
      total time      : 53.3759337142 msecs
<br/>
      clocks per call   : 873 cycles
<br/>
      time per call   : 0.0260488306 msecs
<br/>
<br/>
Function LOBBY_AddToAckCache(2):
<br/>
   calls            : 3064
<br/>
  [Including subcall times]
<br/>
      total clocks   : 660655 cycles
<br/>
      total time      : 19.7128180765 msecs
<br/>
      clocks per call   : 215 cycles
<br/>
      time per call   : 0.0064152332 msecs
<br/>
  [Pure times]
<br/>
      total clocks   : 660655 cycles
<br/>
      total time      : 19.7128180765 msecs
<br/>
      clocks per call   : 215 cycles
<br/>
      time per call   : 0.0064152332 msecs
<br/>
<br/>
Function LOBBY_AlreadyReceived(3):
<br/>
   calls            : 6128
<br/>
  [Including subcall times]
<br/>
      total clocks   : 32325883 cycles
<br/>
      total time      : 964.5491985096 msecs
<br/>
      clocks per call   : 5275 cycles
<br/>
      time per call   : 0.1573970005 msecs
<br/>
  [Pure times]
<br/>
      total clocks   : 32325883 cycles
<br/>
      total time      : 964.5491985096 msecs
<br/>
      clocks per call   : 5275 cycles
<br/>
      time per call   : 0.1573970005 msecs
<br/>
<br/>
Function LOBBY_BroadcastID(5):
<br/>
   calls            : 442
<br/>
  [Including subcall times]
<br/>
      total clocks   : 2887819 cycles
<br/>
      total time      : 86.1675921394 msecs
<br/>
      clocks per call   : 6533 cycles
<br/>
      time per call   : 0.1949335742 msecs
<br/>
  [Pure times]
<br/>
      total clocks   : 2884071 cycles
<br/>
      total time      : 86.0557582138 msecs
<br/>
      clocks per call   : 6525 cycles
<br/>
      time per call   : 0.1946948679 msecs
<br/>
<br/>
Function LOBBY_ClearAckCache(6):
<br/>
   calls            : 9794
<br/>
  [Including subcall times]
<br/>
      total clocks   : 970122 cycles
<br/>
      total time      : 28.9467853842 msecs
<br/>
      clocks per call   : 99 cycles
<br/>
      time per call   : 0.0029539911 msecs
<br/>
  [Pure times]
<br/>
      total clocks   : 970122 cycles
<br/>
      total time      : 28.9467853842 msecs
<br/>
      clocks per call   : 99 cycles
<br/>
      time per call   : 0.0029539911 msecs
<br/>
<br/>
Function LOBBY_FlushAckCache(10):
<br/>
   calls            : 4897
<br/>
  [Including subcall times]
<br/>
      total clocks   : 22922815 cycles
<br/>
      total time      : 683.9776916793 msecs
<br/>
      clocks per call   : 4680 cycles
<br/>
      time per call   : 0.1396432156 msecs
<br/>
  [Pure times]
<br/>
      total clocks   : 1481499 cycles
<br/>
      total time      : 44.2054026194 msecs
<br/>
      clocks per call   : 302 cycles
<br/>
      time per call   : 0.0090111648 msecs
<br/>
<br/>
Function LOBBY_FlushCollector(11):
<br/>
   calls            : 2833
<br/>
  [Including subcall times]
<br/>
      total clocks   : 12994698 cycles
<br/>
      total time      : 387.7396184591 msecs
<br/>
      clocks per call   : 4586 cycles
<br/>
      time per call   : 0.1368384160 msecs
<br/>
  [Pure times]
<br/>
      total clocks   : 12971951 cycles
<br/>
      total time      : 387.0608867871 msecs
<br/>
      clocks per call   : 4578 cycles
<br/>
      time per call   : 0.1365997096 msecs
<br/>
<br/>
Function LOBBY_GetRoomByMAC(17):
<br/>
   calls            : 324
<br/>
  [Including subcall times]
<br/>
      total clocks   : 134142 cycles
<br/>
      total time      : 4.0025684244 msecs
<br/>
      clocks per call   : 414 cycles
<br/>
      time per call   : 0.0123530537 msecs
<br/>
  [Pure times]
<br/>
      total clocks   : 134142 cycles
<br/>
      total time      : 4.0025684244 msecs
<br/>
      clocks per call   : 414 cycles
<br/>
      time per call   : 0.0123530537 msecs
<br/>
<br/>
Function LOBBY_GetRoomByUser(18):
<br/>
   calls            : 1166
<br/>
  [Including subcall times]
<br/>
      total clocks   : 450488 cycles
<br/>
      total time      : 13.4417933561 msecs
<br/>
      clocks per call   : 386 cycles
<br/>
      time per call   : 0.0115175815 msecs
<br/>
  [Pure times]
<br/>
      total clocks   : 441391 cycles
<br/>
      total time      : 13.1703543962 msecs
<br/>
      clocks per call   : 378 cycles
<br/>
      time per call   : 0.0112788751 msecs
<br/>
<br/>
Function LOBBY_GetRoomGameCode(19):
<br/>
   calls            : 1166
<br/>
  [Including subcall times]
<br/>
      total clocks   : 405785 cycles
<br/>
      total time      : 12.1079321025 msecs
<br/>
      clocks per call   : 348 cycles
<br/>
      time per call   : 0.0103837263 msecs
<br/>
  [Pure times]
<br/>
      total clocks   : 401321 cycles
<br/>
      total time      : 11.9747339584 msecs
<br/>
      clocks per call   : 344 cycles
<br/>
      time per call   : 0.0102643731 msecs
<br/>
<br/>
Function LOBBY_GetUserByID(21):
<br/>
   calls            : 57931
<br/>
  [Including subcall times]
<br/>
      total clocks   : 22594315 cycles
<br/>
      total time      : 674.1758121232 msecs
<br/>
      clocks per call   : 390 cycles
<br/>
      time per call   : 0.0116369346 msecs
<br/>
  [Pure times]
<br/>
      total clocks   : 22408313 cycles
<br/>
      total time      : 668.6258297756 msecs
<br/>
      clocks per call   : 386 cycles
<br/>
      time per call   : 0.0115175815 msecs
<br/>
<br/>
Function LOBBY_GetUserByMAC(22):
<br/>
   calls            : 15023
<br/>
  [Including subcall times]
<br/>
      total clocks   : 3369883 cycles
<br/>
      total time      : 100.5515594646 msecs
<br/>
      clocks per call   : 224 cycles
<br/>
      time per call   : 0.0066837778 msecs
<br/>
  [Pure times]
<br/>
      total clocks   : 3369883 cycles
<br/>
      total time      : 100.5515594646 msecs
<br/>
      clocks per call   : 224 cycles
<br/>
      time per call   : 0.0066837778 msecs
<br/>
<br/>
Function LOBBY_GetUsername(24):
<br/>
   calls            : 3
<br/>
  [Including subcall times]
<br/>
      total clocks   : 186 cycles
<br/>
      total time      : 0.0055499227 msecs
<br/>
      clocks per call   : 62 cycles
<br/>
      time per call   : 0.0018499742 msecs
<br/>
  [Pure times]
<br/>
      total clocks   : 186 cycles
<br/>
      total time      : 0.0055499227 msecs
<br/>
      clocks per call   : 62 cycles
<br/>
      time per call   : 0.0018499742 msecs
<br/>
<br/>
Function LOBBY_HandleAck(25):
<br/>
   calls            : 2059
<br/>
  [Including subcall times]
<br/>
      total clocks   : 1589125 cycles
<br/>
      total time      : 47.4167788419 msecs
<br/>
      clocks per call   : 771 cycles
<br/>
      time per call   : 0.0230053246 msecs
<br/>
  [Pure times]
<br/>
      total clocks   : 1589125 cycles
<br/>
      total time      : 47.4167788419 msecs
<br/>
      clocks per call   : 771 cycles
<br/>
      time per call   : 0.0230053246 msecs
<br/>
<br/>
Function LOBBY_Init(26):
<br/>
   calls            : 1
<br/>
  [Including subcall times]
<br/>
      total clocks   : 101505 cycles
<br/>
      total time      : 3.0287360254 msecs
<br/>
      clocks per call   : 101505 cycles
<br/>
      time per call   : 3.0287360254 msecs
<br/>
  [Pure times]
<br/>
      total clocks   : 100231 cycles
<br/>
      total time      : 2.9907220389 msecs
<br/>
      clocks per call   : 100231 cycles
<br/>
      time per call   : 2.9907220389 msecs
<br/>
<br/>
Function LOBBY_OOOEnqueReceived(30):
<br/>
   calls            : 2046
<br/>
  [Including subcall times]
<br/>
      total clocks   : 79939896 cycles
<br/>
      total time      : 2385.2701136035 msecs
<br/>
      clocks per call   : 39071 cycles
<br/>
      time per call   : 1.1658119821 msecs
<br/>
  [Pure times]
<br/>
      total clocks   : 79932783 cycles
<br/>
      total time      : 2385.0578738188 msecs
<br/>
      clocks per call   : 39067 cycles
<br/>
      time per call   : 1.1656926290 msecs
<br/>
<br/>
Function LOBBY_PrepareCollector(31):
<br/>
   calls            : 2833
<br/>
  [Including subcall times]
<br/>
      total clocks   : 521484 cycles
<br/>
      total time      : 15.5601928719 msecs
<br/>
      clocks per call   : 184 cycles
<br/>
      time per call   : 0.0054902461 msecs
<br/>
  [Pure times]
<br/>
      total clocks   : 521484 cycles
<br/>
      total time      : 15.5601928719 msecs
<br/>
      clocks per call   : 184 cycles
<br/>
      time per call   : 0.0054902461 msecs
<br/>
<br/>
Function LOBBY_RecvCallback(32):
<br/>
   calls            : 5220
<br/>
  [Including subcall times]
<br/>
      total clocks   : 151458754 cycles
<br/>
      total time      : 4519.2708201650 msecs
<br/>
      clocks per call   : 29015 cycles
<br/>
      time per call   : 0.8657580984 msecs
<br/>
  [Pure times]
<br/>
      total clocks   : 4423981 cycles
<br/>
      total time      : 132.0040454199 msecs
<br/>
      clocks per call   : 847 cycles
<br/>
      time per call   : 0.0252730350 msecs
<br/>
<br/>
Function LOBBY_RecvChunk(33):
<br/>
   calls            : 4897
<br/>
  [Including subcall times]
<br/>
      total clocks   : 120597857 cycles
<br/>
      total time      : 3598.4343045271 msecs
<br/>
      clocks per call   : 24626 cycles
<br/>
      time per call   : 0.7347978263 msecs
<br/>
  [Pure times]
<br/>
      total clocks   : 4089948 cycles
<br/>
      total time      : 122.0370705835 msecs
<br/>
      clocks per call   : 835 cycles
<br/>
      time per call   : 0.0249149754 msecs
<br/>
<br/>
Function LOBBY_RememberReceived(34):
<br/>
   calls            : 2046
<br/>
  [Including subcall times]
<br/>
      total clocks   : 389906 cycles
<br/>
      total time      : 11.6341298332 msecs
<br/>
      clocks per call   : 190 cycles
<br/>
      time per call   : 0.0056692758 msecs
<br/>
  [Pure times]
<br/>
      total clocks   : 389906 cycles
<br/>
      total time      : 11.6341298332 msecs
<br/>
      clocks per call   : 190 cycles
<br/>
      time per call   : 0.0056692758 msecs
<br/>
<br/>
Function LOBBY_ResendUnacked(35):
<br/>
   calls            : 2833
<br/>
  [Including subcall times]
<br/>
      total clocks   : 15882340 cycles
<br/>
      total time      : 473.9019292205 msecs
<br/>
      clocks per call   : 5606 cycles
<br/>
      time per call   : 0.1672734758 msecs
<br/>
  [Pure times]
<br/>
      total clocks   : 1528546 cycles
<br/>
      total time      : 45.6092048339 msecs
<br/>
      clocks per call   : 539 cycles
<br/>
      time per call   : 0.0160828404 msecs
<br/>
<br/>
Function LOBBY_RoomStreamCallback(36):
<br/>
   calls            : 1
<br/>
  [Including subcall times]
<br/>
      total clocks   : 7113 cycles
<br/>
      total time      : 0.2122397847 msecs
<br/>
      clocks per call   : 7113 cycles
<br/>
      time per call   : 0.2122397847 msecs
<br/>
  [Pure times]
<br/>
      total clocks   : 339 cycles
<br/>
      total time      : 0.0101151816 msecs
<br/>
      clocks per call   : 339 cycles
<br/>
      time per call   : 0.0101151816 msecs
<br/>
<br/>
Function LOBBY_SendToRoom(38):
<br/>
   calls            : 2046
<br/>
  [Including subcall times]
<br/>
      total clocks   : 6788257 cycles
<br/>
      total time      : 202.5500076402 msecs
<br/>
      clocks per call   : 3317 cycles
<br/>
      time per call   : 0.0989736210 msecs
<br/>
  [Pure times]
<br/>
      total clocks   : 1323469 cycles
<br/>
      total time      : 39.4900570296 msecs
<br/>
      clocks per call   : 646 cycles
<br/>
      time per call   : 0.0192755379 msecs
<br/>
<br/>
Function LOBBY_SendToUser(39):
<br/>
   calls            : 5111
<br/>
  [Including subcall times]
<br/>
      total clocks   : 26429295 cycles
<br/>
      total time      : 788.6050725799 msecs
<br/>
      clocks per call   : 5171 cycles
<br/>
      time per call   : 0.1542938179 msecs
<br/>
  [Pure times]
<br/>
      total clocks   : 24403619 cycles
<br/>
      total time      : 728.1623566844 msecs
<br/>
      clocks per call   : 4774 cycles
<br/>
      time per call   : 0.1424480152 msecs
<br/>
<br/>
Function LOBBY_SendViaCollector(40):
<br/>
   calls            : 2692
<br/>
  [Including subcall times]
<br/>
      total clocks   : 837612 cycles
<br/>
      total time      : 24.9929130555 msecs
<br/>
      clocks per call   : 311 cycles
<br/>
      time per call   : 0.0092797094 msecs
<br/>
  [Pure times]
<br/>
      total clocks   : 837612 cycles
<br/>
      total time      : 24.9929130555 msecs
<br/>
      clocks per call   : 311 cycles
<br/>
      time per call   : 0.0092797094 msecs
<br/>
<br/>
Function LOBBY_SetStreamHandler(41):
<br/>
   calls            : 3
<br/>
  [Including subcall times]
<br/>
      total clocks   : 2338 cycles
<br/>
      total time      : 0.0697619312 msecs
<br/>
      clocks per call   : 779 cycles
<br/>
      time per call   : 0.0232440310 msecs
<br/>
  [Pure times]
<br/>
      total clocks   : 2338 cycles
<br/>
      total time      : 0.0697619312 msecs
<br/>
      clocks per call   : 779 cycles
<br/>
      time per call   : 0.0232440310 msecs
<br/>
<br/>
Function LOBBY_SetUserInfoCallback(42):
<br/>
   calls            : 1
<br/>
  [Including subcall times]
<br/>
      total clocks   : 637 cycles
<br/>
      total time      : 0.0190069932 msecs
<br/>
      clocks per call   : 637 cycles
<br/>
      time per call   : 0.0190069932 msecs
<br/>
  [Pure times]
<br/>
      total clocks   : 637 cycles
<br/>
      total time      : 0.0190069932 msecs
<br/>
      clocks per call   : 637 cycles
<br/>
      time per call   : 0.0190069932 msecs
<br/>
<br/>
Function LOBBY_Shutdown(43):
<br/>
   calls            : 1
<br/>
  [Including subcall times]
<br/>
      total clocks   : 999 cycles
<br/>
      total time      : 0.0298084556 msecs
<br/>
      clocks per call   : 999 cycles
<br/>
      time per call   : 0.0298084556 msecs
<br/>
  [Pure times]
<br/>
      total clocks   : 999 cycles
<br/>
      total time      : 0.0298084556 msecs
<br/>
      clocks per call   : 999 cycles
<br/>
      time per call   : 0.0298084556 msecs
<br/>
<br/>
Function LOBBY_Update(44):
<br/>
   calls            : 13716
<br/>
  [Including subcall times]
<br/>
      total clocks   : 22230013 cycles
<br/>
      total time      : 663.3056619678 msecs
<br/>
      clocks per call   : 1620 cycles
<br/>
      time per call   : 0.0483380362 msecs
<br/>
  [Pure times]
<br/>
      total clocks   : 3459854 cycles
<br/>
      total time      : 103.2361406078 msecs
<br/>
      clocks per call   : 252 cycles
<br/>
      time per call   : 0.0075192501 msecs
<br/>
<br/>
Function LOBBY_UpdateRoom(45):
<br/>
   calls            : 1
<br/>
  [Including subcall times]
<br/>
      total clocks   : 6774 cycles
<br/>
      total time      : 0.2021246031 msecs
<br/>
      clocks per call   : 6774 cycles
<br/>
      time per call   : 0.2021246031 msecs
<br/>
  [Pure times]
<br/>
      total clocks   : 5202 cycles
<br/>
      total time      : 0.1552188050 msecs
<br/>
      clocks per call   : 5202 cycles
<br/>
      time per call   : 0.1552188050 msecs
<br/>
<br/>
Function LOBBY_UpdateUser(46):
<br/>
   calls            : 323
<br/>
  [Including subcall times]
<br/>
      total clocks   : 286484 cycles
<br/>
      total time      : 8.5481937983 msecs
<br/>
      clocks per call   : 886 cycles
<br/>
      time per call   : 0.0264367284 msecs
<br/>
  [Pure times]
<br/>
      total clocks   : 263165 cycles
<br/>
      total time      : 7.8523946222 msecs
<br/>
      clocks per call   : 814 cycles
<br/>
      time per call   : 0.0242883713 msecs
<br/>
<br/>
Function LOBBY_UserResetTimeout(49):
<br/>
   calls            : 5220
<br/>
  [Including subcall times]
<br/>
      total clocks   : 373986 cycles
<br/>
      total time      : 11.1591041938 msecs
<br/>
      clocks per call   : 71 cycles
<br/>
      time per call   : 0.0021185189 msecs
<br/>
  [Pure times]
<br/>
      total clocks   : 373986 cycles
<br/>
      total time      : 11.1591041938 msecs
<br/>
      clocks per call   : 71 cycles
<br/>
      time per call   : 0.0021185189 msecs
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"><br/><br/>Last edited by Mighty Max on Mon Oct 29, 2007 9:38 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#144152 - melw - Mon Oct 29, 2007 5:43 pm</h4>
    <div class="postbody"><span class="postbody">Mighty Max, Do you have any suggestions on how to handle FIFO for own usage when using the Lobby library? In my game I disabled the sounds after starting the Lobby implementation because the FIFO was reserved... Now I'm trying to get things back beeping, but the end result is that either the lobby or sounds don't work at the same time, depending on which (my sound fifo setup or arm9 ipc_init()) is called first.
<br/>
<br/>
I noticed you have something like customIPCCallback in the library code - is this something could be used for passing sound playback commands from arm9 to arm7? If so, a small example would be appreciated. :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144153 - Mighty Max - Mon Oct 29, 2007 6:13 pm</h4>
    <div class="postbody"><span class="postbody">Yes, the ipc system requires exclusive access to the fifo hardware.
<br/>
<br/>
The IPC system will get some change in the future to seperate it from the liblobby. For now you can just set a custom callback and send messages to the other side.
<br/>
<br/>
Atm you can simply use
<br/>
IPC_SetCustomCallback(IPC_CUSTOMCALLBACK_PROC callback) ;
<br/>
to set a callback, which will receieve any message the other side sends with
<br/>
IPC_SendMessage(char *data,unsigned long length) ;
<br/>
The first u32 in the message has to be &gt;8 (as this is the tag the wifi code identifies the commands)
<br/>
<br/>
The include is "MessageQueue.h"<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144168 - melw - Mon Oct 29, 2007 9:40 pm</h4>
    <div class="postbody"><span class="postbody">Thanks! Custom IPC callbacks are working nicely now. (Having still problems with the sound playback being cut.) Edit: Got lobby and sounds working 100% at the same time.
<br/>
<br/>
One major thing left to do: Sgstair wifi and lobby lib in the same build. Would be optimal if player could go from internet game to local wireless game and other way around. Well, back to coding...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144282 - yellowstar - Wed Oct 31, 2007 2:57 am</h4>
    <div class="postbody"><span class="postbody">I am almost done with my Pong game.
<br/>
All that's left is Wireless.(and bugs)
<br/>
(By the way, scores are displayed in console
<br/>
on sub screen, game on main.
<br/>
Due to a problem with console not working
<br/>
on main.)
<br/>
(Will implement non-console scores later.)
<br/>
<br/>
The opponet's bat
<br/>
is choppy.(On the recieving DS.)
<br/>
<br/>
Other things are out of sync,
<br/>
but that's my problem.
<br/>
(Only bat movement messages are sent
<br/>
at the moment)
<br/>
<br/>
<span style="font-weight: bold">EDIT:</span>
<br/>
I am using R 60.
<br/>
Has the aforementioned problems
<br/>
been resolved?
<br/>
<br/>
<span style="font-weight: bold">EDIT2:</span>
<br/>
There are more problems.
<br/>
<br/>
Sometimes,
<br/>
the opponets bat(on the recieving DS)
<br/>
would be behind.
<br/>
It would still follow the wanted movement.
<br/>
<br/>
In the worst case,
<br/>
the opponets bat
<br/>
wouldn't move at all.
<br/>
<br/>
<span style="font-weight: bold">EDIT3:</span>
<br/>
Another problem:
<br/>
<br/>
Sometimes there is some lag.
<br/>
Both DSes,(at least I think it's both)
<br/>
slow down.
<br/>
The max is about one second.
<br/>
<br/>
(By the way,
<br/>
I got the scores in sync.)
<br/>
(They don't get updated at exactly
<br/>
the same moment.)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144302 - melw - Wed Oct 31, 2007 9:32 am</h4>
    <div class="postbody"><span class="postbody">You need to be prepared for choppy networking. It doesn't matter what the reason is. Even if the lobby library was 100% perfect, for example the users can be too much apart from each other or there's other traffic on the channel distracting the sent messages.
<br/>
<br/>
To the actual question - how to achieve smooth gameplay in your case? There's a handful of options you can choose from:
<br/>
<ul>
<br/>
- synchronize time between the DS's in the beginning and timestamp your messages.
<br/>
- interpolate the movement between frames
<br/>
- don't send data every frame, rather send when something happens (bat starts moving/stops, hits a ball, etc.), and also then send game parameters (bat speed, ball speed, ball direction), not just static values (bat/ball coordinates). this makes interpolating values a lot easier. in between you can sync the data just to be sure.
<br/>
- draw stuff on screen with couple frames of lag compared to your actual gametime to allow the other end to catch up.
<br/>
</ul>
<br/>
btw. I once did a Pong for Series 60 phones using Bluetooth (one of the most horrifyin coding experiences in my life :) That was the wonkiest networking I've dealt with, now doing things with the lobby lib life seems whole lot of easier...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144350 - yellowstar - Wed Oct 31, 2007 9:52 pm</h4>
    <div class="postbody"><span class="postbody">It's obvious I never did any networking stuff
<br/>
before...(I read I few tutorials,
<br/>
but I couldn't actually do them due to
<br/>
no network and Dial-Up.)
<br/>
<br/>
I'll try your suggestions melw,
<br/>
and if those fail,
<br/>
I guess I'll search gamedev and the Internet.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144426 - yellowstar - Thu Nov 01, 2007 9:54 pm</h4>
    <div class="postbody"><span class="postbody">Thanks melw.
<br/>
Thanks to your second suggestion,
<br/>
I have gotten the bats to
<br/>
move smoothly now.
<br/>
<br/>
Now,
<br/>
I'm having troubles with scores
<br/>
being out of sync.
<br/>
(Hopefully I can figure it out.
<br/>
If not, I'll try searching the Inet.)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144429 - MechaBouncer - Thu Nov 01, 2007 10:04 pm</h4>
    <div class="postbody"><span class="postbody">That's certainly odd. I would think it would be simple enough to sync them up each time a player scored since you have to wait a little anyway. Is it something that alternates between players or is one keeping correct score consistently while the other side is not?<br/>_________________<br/>Cobalt/Black NDSL
<br/>
CycloDS Evolution (firmware 1.55 BETA 3) and EZFlash 3-in-1
<br/>
Kingston SD-C02G JAPAN 2GB MicroSD
<br/>
MoonShell 1.71, DSOrganize 3.1129, QuakeDS Pre3, ScummVM DS 0.11.1, Pocket Physics 0.6, OpenTyrian DS 0.3</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144433 - Mighty Max - Thu Nov 01, 2007 10:14 pm</h4>
    <div class="postbody"><span class="postbody">Well, i guess he is playing a game on both DS and only correcting the positions on the other one.
<br/>
<br/>
@Yellowstar, 
<br/>
Let the hoster control the game. Do not calculate misses/hits and thus points on both DSes.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144437 - yellowstar - Thu Nov 01, 2007 10:42 pm</h4>
    <div class="postbody"><span class="postbody">I think I fixed the out of sync scores.
<br/>
(I can't be sure until I test it with somebody else)
<br/>
<br/>
The way I am doing it at the moment, is this:
<br/>
No messages for scoring are sent.
<br/>
Instead, both systems decide
<br/>
when a point is scored,
<br/>
based on where the bats and ball are.
<br/>
<br/>
This game is getting very
<br/>
close to completion/release.(minus bugs and such)
<br/>
<br/>
<span style="font-weight: bold">EDIT:</span>
<br/>
<br/>
@Mighty Max:
<br/>
I was doing the latter...
<br/>
I was having both systems
<br/>
tell the other when it scored a point.</span><span class="gensmall"><br/><br/>Last edited by yellowstar on Thu Nov 01, 2007 10:47 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#144438 - Mighty Max - Thu Nov 01, 2007 10:46 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yellowstar wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
The way I am doing it at the moment, is this:
<br/>
No messages for scoring are sent.
<br/>
Instead, both systems decide
<br/>
when a point is scored,
<br/>
based on where the bats and ball are.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Keep in mind that the ball's properties (position, direction, speed) and the bat's properties (position) are _never_ in complete sync. This setup will produce different results on both DSes by design on a real game (There will be the situation that one DS counts a score and on the other DS the ball was just catched)<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144440 - yellowstar - Thu Nov 01, 2007 11:00 pm</h4>
    <div class="postbody"><span class="postbody">Well,
<br/>
that made the problem worse.(the score difference between
<br/>
the systems were large.)
<br/>
<br/>
Time to come
<br/>
up with a differen't mechism.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144441 - MechaBouncer - Thu Nov 01, 2007 11:03 pm</h4>
    <div class="postbody"><span class="postbody">Perhaps you could handle it that when the ball is travelling in one direction, the player it's travelling to is handling the ball mechanics and sending position and direction information to the other DS, then it flips when going the other direction. That way, the person having to return the ball doesn't get screwed by the offhand chance that the ball position wasn't synched well enough. Does that sound reasonable?<br/>_________________<br/>Cobalt/Black NDSL
<br/>
CycloDS Evolution (firmware 1.55 BETA 3) and EZFlash 3-in-1
<br/>
Kingston SD-C02G JAPAN 2GB MicroSD
<br/>
MoonShell 1.71, DSOrganize 3.1129, QuakeDS Pre3, ScummVM DS 0.11.1, Pocket Physics 0.6, OpenTyrian DS 0.3</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144442 - Mighty Max - Thu Nov 01, 2007 11:04 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yellowstar wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<span style="font-weight: bold">EDIT:</span>
<br/>
<br/>
@Mighty Max:
<br/>
I was doing the latter...
<br/>
I was having both systems
<br/>
tell the other when it scored a point.</td> </tr></table><span class="postbody">
<br/>
<br/>
You misunderstood me. Do NOT make both sides work the same. This will not work. There needs one instance that has the last word on all decisions. (It's just like persons, when they are both the same urge to have the last word, they will argue or going into a "whatever!" state ;) )
<br/>
<br/>
Have one and always the same DS counting the scores. Have the same DS deciding whether the ball was hit. Do not calculate the hit on the other DS for any other reason then to hide lag from the displaying (precalculation which is superseeded by the host)<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144534 - yellowstar - Sat Nov 03, 2007 3:44 pm</h4>
    <div class="postbody"><span class="postbody">I have decided to start a new topic,
<br/>
dealing with the <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=14453" target="_blank">issues</a> I am having with this.
<br/>
(link is a link to the topic)
<br/>
<br/>
I will post there soon about more issues
<br/>
I'm having.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144864 - melw - Thu Nov 08, 2007 1:37 pm</h4>
    <div class="postbody"><span class="postbody">A small question about room gamecodes: Should the gamecode unique per game, not by game session? Say, there's 2 different Pong games going on and they share the same gamecode but another player is searching for Dicewars games and has a different gamecode to all the Pong players?
<br/>
<br/>
A follow-up question if this assumption is correct: How to define gamecodes so that they are indeed unique? Developers reserve codes for their projects and just count on nobody else using the same gamecode? Checking room name, gamecode and game version combinations would work too...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144867 - Mighty Max - Thu Nov 08, 2007 3:38 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>melw wrote:</b></span></td> </tr> <tr> <td class="quote">A small question about room gamecodes: Should the gamecode unique per game, not by game session? Say, there's 2 different Pong games going on and they share the same gamecode but another player is searching for Dicewars games and has a different gamecode to all the Pong players?
<br/>
</td> </tr></table><span class="postbody">
<br/>
Unique per game, not per session.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
A follow-up question if this assumption is correct: How to define gamecodes so that they are indeed unique? Developers reserve codes for their projects and just count on nobody else using the same gamecode? Checking room name, gamecode and game version combinations would work too...
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I am well aware of possible collisions. However i don't feel able to manage a gamecode registry.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145007 - melw - Sat Nov 10, 2007 11:53 am</h4>
    <div class="postbody"><span class="postbody">Room functionality suggestion: Include either a flag to a room if it's visible to the masses or a room "state" that can be queried (waiting for players / playing a game) Possible reasons for not wanting to broadcast the room info: there's a game going on -&gt; thus it shouldn't be possible to join the room, or for example max. amount of players are already in the room. In either way, something like LOBBY_SetRoomVisibility(LPLOBBY_ROOM room, bool visible) that could be called by the room owner.
<br/>
<br/>
If I wanted to make small changes / improvements in the library (like this) myself, how should I proceed? Send patches against the latest svn revision? At least I can understand if you don't want to give svn write access to anybody else..</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145009 - Mighty Max - Sat Nov 10, 2007 12:08 pm</h4>
    <div class="postbody"><span class="postbody">Just PM me a username and the desired password and ill add you to the svnserve's passwd.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145105 - melw - Sun Nov 11, 2007 5:46 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for the svn access! Added LOBBY_GetRoomName() and LOBBY_SetRoomVisibility() - the latter is WIP, but is mostly working already. I also added a small room_example template for testing all kinds of room related functionality.
<br/>
<br/>
New bugs found while testing: with LOBBY_GetRoomGameCode/Version() only the room owner seem to get the right values. Any ideas what's wrong here?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145106 - Mighty Max - Sun Nov 11, 2007 5:54 pm</h4>
    <div class="postbody"><span class="postbody">The room's details are distributed on a acked stream. (See LOBBY_RoomStreamCallback case 1)
<br/>
<br/>
I never thought on changing the version/gamecode after others joined. To update this setting on the other room member, a new roominfo message has to be produced.
<br/>
<br/>
I think i'm gonna do this in the evening.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145107 - pas - Sun Nov 11, 2007 6:36 pm</h4>
    <div class="postbody"><span class="postbody">Just a quick question: may it be possible to make a small file transfer app for proof of concept purpurose ?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145115 - melw - Sun Nov 11, 2007 7:58 pm</h4>
    <div class="postbody"><span class="postbody">pas: There's a file sharing example in the <a class="postlink" href="svn://91.184.39.23/svn/repos/libwifi" target="_blank">svn</a>.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145127 - Mighty Max - Sun Nov 11, 2007 10:15 pm</h4>
    <div class="postbody"><span class="postbody">The issue with a corrupted gamecode/version has been resolved.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145144 - melw - Mon Nov 12, 2007 12:21 am</h4>
    <div class="postbody"><span class="postbody">Thanks for the fixes, again. I'm still experiencing random crashes when toggling the room visibility bit, but enough testing for tonight... Looking good, nevertheless!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145220 - pas - Mon Nov 12, 2007 9:30 pm</h4>
    <div class="postbody"><span class="postbody">What to do exactly with that link ? Quick explanation is enough.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145222 - Mighty Max - Mon Nov 12, 2007 9:36 pm</h4>
    <div class="postbody"><span class="postbody">The link is to a subversion repository. Browse the repository with the SVN Client of your choice (i.e. TortoiseSVN) and checkout  the file_sharing folder from the sources.
<br/>
<br/>
SVN is used (like CVS) as a version control system. Allowing to team up over the same source base.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145239 - pas - Mon Nov 12, 2007 11:47 pm</h4>
    <div class="postbody"><span class="postbody">Thanks. I'll try that tomorrow.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145290 - pas - Tue Nov 13, 2007 8:49 pm</h4>
    <div class="postbody"><span class="postbody">OK, I downloaded it using Tortoise, but how can I compile it ? I tried using the build.bat and the stuff PA_Lib provides, and copied the whole file_sharing content in on of the folders (I removed the non necessary files before ofcourse. 
<br/>
<br/>
If I'm doing something terrible wrong and don't understand what to do please tell me.
<br/>
<br/>
Pas</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145293 - Mighty Max - Tue Nov 13, 2007 9:52 pm</h4>
    <div class="postbody"><span class="postbody">The example doesn't require PAlib, and - while i haven't tested it myself - afaik PAlib messes with the devkitpro/libnds installation, so don't use it for this example.
<br/>
<br/>
Install the files in the "lib"("include") folder somewhere the linker(compiler) will find them. Run make within the example folder and it will build the .nds and .ds.gba files<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145346 - melw - Wed Nov 14, 2007 10:38 am</h4>
    <div class="postbody"><span class="postbody">Some news from the testing front: Yesterday I attended <a class="postlink" href="http://igda.fi/" target="_blank">IGDA Finland chapter</a> November gathering, aiming to get as many DS owners to playing and testing the lobby library as possible. Altogether we played something like 3 hours, using the latest ad-hoc test version of Dicewars DS. At most there was 7 players in the game, and we also tried playing multiple games at the same time (3 players per game or so).
<br/>
<br/>
The conclusion: No stability issues (there was one game crash, but I'm pretty sure it's in my game code, not in the lobby library). No timeouts when playing physically around the same table, data flowed always as expected to all directions. On the problem side, there was one DS (black European Lite with R4DS) that refused at some point to receive the room created callbacks, even after trying to boot various times. In a later game it worked again. Also, after completing a game, the leaving / joining rooms somehow got always mixed and in practice we had to reboot all the DS's to start a new game. I'm not yet sure if I have some bugs in the game code regarding this, but I think at least part of the problems are on the lobby library side. Also, number of players in a room after leaving a room did't get updated to all players correctly, often showing too many players for a room.
<br/>
<br/>
Lastly, changing player names in the game had no effect, since the lobby library uses automatically the username from firmware. How about adding LOBBY_SetUserName(char *) to the library?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145350 - Mighty Max - Wed Nov 14, 2007 11:26 am</h4>
    <div class="postbody"><span class="postbody">Well this is good to hear, i hope you all had fun playing :D
<br/>
<br/>
The one DS that did not receive the room updates is probably one, that was restarted after it was talking already a bit with the room owner. I am still missing a handshake to reset comunications between two DSes. 
<br/>
<br/>
Leaving &amp; joining needs a lot of work still.
<br/>
<br/>
The student symposium is done for me in 3 weeks counted from yesterday. At this point my available time should incease noticeable ;)<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145374 - thoduv - Wed Nov 14, 2007 4:13 pm</h4>
    <div class="postbody"><span class="postbody">I watched this libary code, and it seems to be amazingly good work !
<br/>
The only problem that prevents me from using it is the fact that FIFO system can't be changed. I hope you'll "fix" this soon, so it can be more widely used ! :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145379 - Lick - Wed Nov 14, 2007 5:33 pm</h4>
    <div class="postbody"><span class="postbody">Couldn't you implement an LOBBY_Update() function, just like Wifi_Update().<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145388 - Mighty Max - Wed Nov 14, 2007 7:37 pm</h4>
    <div class="postbody"><span class="postbody">Thank you Thoduv.
<br/>
<br/>
I think i will seperate the IPC part out of the lib into it's own, so it can be exchanged and/or used with other purposes. This requires some work to be put into the IPC part before, so it will need to wait a bit.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145461 - melw - Thu Nov 15, 2007 11:28 pm</h4>
    <div class="postbody"><span class="postbody">I've added a small pong game example to the svn. Cleaned up the code a bit from the previous version, fixed stuttering bats, ball speed increases now during the game and there's a score display. It's partially documented, too.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145465 - Lick - Fri Nov 16, 2007 12:24 am</h4>
    <div class="postbody"><span class="postbody">I've already requested it, but I think I should ask again: can the library not be moved to a public SVN? (Google Code, SourceForge or whatever)
<br/>
<br/>
Perhaps it's just me, but I find a web-browsable repository incredibly useful.<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145486 - Mighty Max - Fri Nov 16, 2007 11:21 am</h4>
    <div class="postbody"><span class="postbody">Moving to a different SVN/CVS provider is no option for me.
<br/>
Installing WebSVN on top of the current subversion repository can be done at some time.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145488 - Mighty Max - Fri Nov 16, 2007 1:59 pm</h4>
    <div class="postbody"><span class="postbody">I have added a bugtracker to the server as a first step
<br/>
<br/>
<a href="http://91.184.39.23/.mantis/" target="_blank">http://91.184.39.23/.mantis/</a><br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145511 - Sh4wn - Fri Nov 16, 2007 11:18 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lick wrote:</b></span></td> </tr> <tr> <td class="quote">I've already requested it, but I think I should ask again: can the library not be moved to a public SVN? (Google Code, SourceForge or whatever)
<br/>
<br/>
Perhaps it's just me, but I find a web-browsable repository incredibly useful.</td> </tr></table><span class="postbody">
<br/>
<br/>
+1. :)<br/>_________________<br/><a href="http://www.return1.net" target="_blank">http://www.return1.net</a> :)
<br/>
<a class="postlink" href="http://www.return1.net/site/pp" target="_blank">Pocket Physics Sharing Site</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145512 - sonny_jim - Fri Nov 16, 2007 11:33 pm</h4>
    <div class="postbody"><span class="postbody">Is anyone working on a DLDI file manager that could use this code to send files to and from DS's without a router (ie adhoc)?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145514 - yellowstar - Fri Nov 16, 2007 11:39 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Sh4wn wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lick wrote:</b></span></td> </tr> <tr> <td class="quote">I've already requested it, but I think I should ask again: can the library not be moved to a public SVN? (Google Code, SourceForge or whatever)
<br/>
<br/>
Perhaps it's just me, but I find a web-browsable repository incredibly useful.</td> </tr></table><span class="postbody">
<br/>
<br/>
+1. :)</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Same here.(My primary dev PC dosen't have any SVN
<br/>
clients which work.)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145531 - Mighty Max - Sat Nov 17, 2007 10:08 am</h4>
    <div class="postbody"><span class="postbody"><a href="http://91.184.39.23/svn/wsvn/liblobby/" target="_blank">http://91.184.39.23/svn/wsvn/liblobby/</a>
<br/>
<br/>
Should help you then ;)<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145545 - yellowstar - Sat Nov 17, 2007 6:12 pm</h4>
    <div class="postbody"><span class="postbody">How do I export a directory,(WebSVN)
<br/>
without having to download
<br/>
everything manually?(That is,
<br/>
download the whole directory,
<br/>
and everything in it.)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145546 - tepples - Sat Nov 17, 2007 7:13 pm</h4>
    <div class="postbody"><span class="postbody">Have you tried installing SVN client software on your computer? Or do you not own the computer that you use?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145547 - Mighty Max - Sat Nov 17, 2007 7:13 pm</h4>
    <div class="postbody"><span class="postbody">There isn't.
<br/>
You can browse the SVN via the webinterface for a quick look/search. That is it.
<br/>
<br/>
For a full SVN client, install a full SVN client!
<br/>
<br/>
There isn't any system that will allow an automatic checkout via html because this is simply a too high risk. You wouldn't want any html page to write files of it's own choice on your HDD, would you?<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145548 - tepples - Sat Nov 17, 2007 7:14 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">There isn't any system that will allow an automatic checkout via html because this is simply a too high risk. You wouldn't want any html page to write files of it's own choice on your HDD, would you?</td> </tr></table><span class="postbody">
<br/>
Ideally, checking out a whole folder through the web would package it into a .zip/.tgz/.7z file.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145549 - Mighty Max - Sat Nov 17, 2007 7:25 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Ideally, checking out a whole folder through the web would package it into a .zip/.tgz/.7z file.</td> </tr></table><span class="postbody">
<br/>
<br/>
A checkout does more then downloading the files. It creates a working copy, 
<br/>
which includes ability to update&amp;merge changes. And as far as i know there isn't any SVN client which can operat over compressed files.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145551 - yellowstar - Sat Nov 17, 2007 7:58 pm</h4>
    <div class="postbody"><span class="postbody">Here's my <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=14373" target="_blank">topic</a> about my Win98 SVN client troubles.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145605 - melw - Sun Nov 18, 2007 11:34 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for the updates, great work once again! Changing own name works as expected and roominfo seems to be now up to date.
<br/>
<br/>
One more request: When last user (room owner) has left the room, the room still stays available for everyone. A place for a library function for deleting/destroying rooms (only for room owner)?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145920 - Puyo - Sun Nov 25, 2007 6:41 pm</h4>
    <div class="postbody"><span class="postbody">Yesterday I had a chance to test the library. Tested on 2 DS Lites.
<br/>
<br/>
Pong seems to be working great, connection is stable, though sometimes paddle movement glitched. Could be some interference with local hotspots?
<br/>
<br/>
Next, file sharing app. It acted strange, almost always throwing red screen few seconds after launch on second DS. Can`t seem to reproduce that now with only one DS. Anyway, I didn`t knew that it requires specific file to work, pressing B button. That produces red screen too.  Now I fixed all warnings in code and added file selection screen. I can provide changes.
<br/>
<br/>
Still, really excited to see it all working. Nice job, Mighty Max!
<br/>
<br/>
P.S. melw, I couldn`t find version of dicewars with local wifi or maybe it is still unreleased?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145926 - melw - Sun Nov 25, 2007 7:58 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Puyo wrote:</b></span></td> </tr> <tr> <td class="quote">P.S. melw, I couldn`t find version of dicewars with local wifi or maybe it is still unreleased?</td> </tr></table><span class="postbody">
<br/>
It's still an experimental beta version, <a class="postlink" href="http://dicewars.drunkencoders.com/beta/" target="_blank">download available here</a>.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146070 - wildex999 - Wed Nov 28, 2007 12:02 pm</h4>
    <div class="postbody"><span class="postbody">Hm... I don't know if this is like it should be, but I've tried two versions of this now.
<br/>
<br/>
First i tried downloading latest SVN(You should put the link on first page, or post it now and then) And compiled some of the examples.
<br/>
<br/>
First i tried Room-example. I put it into my EZFlash III, booted up my Phat-DS with V7 firmware. It got in, and found my name as Windirt, and not as Wildex999. I continued in and made a room, it said "Windirt changed room", but the green lamp didn't flash as it would on a normal game. I booted up my packet catcher on my PC, and it couldn't detect the DS(It does on everything else)
<br/>
Then after a little while I got a red screen with a lot of text.
<br/>
<br/>
Then i tried pong, same problem, but without the red screen, it doesn't seem to start up the wireless.
<br/>
<br/>
Then i tried to use WiFiMe to upload it directly to memory and start it. This time it got my name right, but still not luck on the Wireless starting.
<br/>
<br/>
<br/>
I then tried dicewars beta, and same there, wireless doesn't start up.
<br/>
<br/>
Is this a known problem, or is it just me?<br/>_________________<br/>EZ Flash III - Flashme V7 - NDS V1 xD - NDS Tunneling, anyone?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146073 - Mighty Max - Wed Nov 28, 2007 3:24 pm</h4>
    <div class="postbody"><span class="postbody">The wifi core is working even then the light is not flashing. 
<br/>
If the DSes see each other, the wifi is started anbd working.
<br/>
<br/>
This is basically because the wifi core and the flashing led rely on complete different interfaces, it is usually used to indicate the wifi activity by design of the user interface.
<br/>
<br/>
I try to not use uop hardware resources in general. If a game later wants the user to identify it's doing multiplayer games by flashing the light, then it is it's own choice to do so.
<br/>
<br/>
<br/>
The Username is taken out of the structure in memory, chances are that the EZ-Flash III loader overwrites/invalidates/replaces this data.
<br/>
<br/>
<br/>
The Red-Screen-of-Death on the file sharing example is triggered, when there is no "hosted.tst" file accessible through the patched DLDI driver.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146074 - wildex999 - Wed Nov 28, 2007 3:46 pm</h4>
    <div class="postbody"><span class="postbody">ok, thanks for the answer :) Just started to wonder when it didn't flash where it should usually do =P
<br/>
<br/>
I got red screen on the room example.<br/>_________________<br/>EZ Flash III - Flashme V7 - NDS V1 xD - NDS Tunneling, anyone?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146334 - yellowstar - Sun Dec 02, 2007 10:30 pm</h4>
    <div class="postbody"><span class="postbody">It would be nice if you, Mighty Max,
<br/>
would add a function to easily enable/disable
<br/>
the blinking LED for wireless.
<br/>
(This would be optional for the programs,
<br/>
they could just call this function to enable it.)
<br/>
(Last time I tried to change the LED state,
<br/>
the screens got turned off, also.
<br/>
And I still haven't fixed it.
<br/>
That was in a non-<b style="color:#FFA34F">liblobby</b> app.)
<br/>
<br/>
There should be a LOBBY_GetUserMAC function.
<br/>
(After all, there is a LOBBY_GetUserByMAC function)
<br/>
<br/>
Documentation for Multicast should
<br/>
be added.(the interface that download play
<br/>
can be added through)
<br/>
(I'm not going to attempt writing a Download Play lib.)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146339 - Noda - Sun Dec 02, 2007 11:27 pm</h4>
    <div class="postbody"><span class="postbody">to disable blinking:
<br/>
<br/>
on the arm7: 
<br/>
writePowerManagement(PM_CONTROL_REG, ~PM_LED_BLINK &amp; readPowerManagement(PM_CONTROL_REG));
<br/>
<br/>
to enable it:
<br/>
writePowerManagement(PM_CONTROL_REG, PM_LED_BLINK | readPowerManagement(PM_CONTROL_REG));</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146342 - Lick - Sun Dec 02, 2007 11:36 pm</h4>
    <div class="postbody"><span class="postbody">Remember to turn off interrupts before accessing the PowerManagement and turn it back on afterwards.<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146345 - yellowstar - Mon Dec 03, 2007 12:43 am</h4>
    <div class="postbody"><span class="postbody">Thank's, it works!(This is my old
<br/>
Sleep app.
<br/>
It still has that bug with the arm9 not waking up.)
<br/>
<br/>
The writePM function
<br/>
call was writing to the PM,
<br/>
without using any read data.
<br/>
<br/>
This means,
<br/>
PM was being overwritten
<br/>
with only one thing set.
<br/>
Everything else was disabled and ect.
<br/>
<br/>
<span style="font-weight: bold">EDIT:</span>
<br/>
I have gotten my Sleep app to work.
<br/>
(Except for some noise when opening/closing.)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146422 - melw - Mon Dec 03, 2007 11:55 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Puyo wrote:</b></span></td> </tr> <tr> <td class="quote">Next, file sharing app. It acted strange, almost always throwing red screen few seconds after launch on second DS. Can`t seem to reproduce that now with only one DS. Anyway, I didn`t knew that it requires specific file to work, pressing B button. That produces red screen too.  Now I fixed all warnings in code and added file selection screen. I can provide changes.</td> </tr></table><span class="postbody">
<br/>
Puyo: Your changes are now also in svn. Nice work! With the file selector the app is getting already quite useful. Now if someone made it into a full-fledged application, with possibility to send files both ways, selecting multiple files or directories at once, some GUI etc. :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146491 - yellowstar - Tue Dec 04, 2007 9:34 pm</h4>
    <div class="postbody"><span class="postbody">I have an idea to speed up wireless
<br/>
transfers.(Any transfer should work with this.)
<br/>
(I never got around to attempt to implement this.)
<br/>
<br/>
The host would send a batch of messages,
<br/>
each would be a size of 512 bytes.
<br/>
<br/>
The total messages sent per batch
<br/>
would be 10.(This can be adjusted until <b style="color:#FFA34F">liblobby</b> has problems with that.)
<br/>
<br/>
Each message would have an id.(Or something like the 802.11 sequence number)
<br/>
This id would be incremented every message.
<br/>
It starts out at zero.
<br/>
Max is 255.(byte)
<br/>
(This number gets reset to zero when it hits max.)
<br/>
<br/>
The client recieves this batch.
<br/>
<br/>
It checks the id's of the messages.
<br/>
<br/>
If it detects that message(s)
<br/>
were missed,
<br/>
it asks the host to resend these messages.
<br/>
<br/>
This process repeats,
<br/>
until all the missed messages were recieved.
<br/>
<br/>
This process repeats,
<br/>
until the transfer is done.
<br/>
<br/>
<br/>
<br/>
Reasons why I can't try this:
<br/>
<br/>
1. I don't have 2 cards which work.
<br/>
(My old GnM microSD adapter seems broke.)
<br/>
<br/>
(I could write a test app to test this out.)
<br/>
(The host would read a large file into memory and send it,
<br/>
while the client would download it.)
<br/>
<br/>
(Would be nice if I could get a wireless transfer
<br/>
app on my GnM. I could somewhat use it.)
<br/>
<br/>
2.
<br/>
I'm not doing much homebrew right now.
<br/>
(I went back to my SFB game.)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146496 - Mighty Max - Tue Dec 04, 2007 10:49 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yellowstar wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
If it detects that message(s)
<br/>
were missed,
<br/>
it asks the host to resend these messages.
<br/>
<br/>
This process repeats,
<br/>
until all the missed messages were recieved.
<br/>
<br/>
This process repeats,
<br/>
until the transfer is done.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
How would you do this, when the last sent packet is the one missed? You'd need to know that there is another packet to be received before it even gets created ....
<br/>
<br/>
####
<br/>
<br/>
Collecting smaller messages however is already done. Check the sources or some pages back. (LOBBY_SendTo* is internally using LOBBY_SendViaCollector on acked streams)<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146499 - yellowstar - Tue Dec 04, 2007 11:33 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
How would you do this, when the last sent packet is the one missed? You'd need to know that there is another packet to be received before it even gets created ....
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
The client would check if there's a difference between
<br/>
packet id's, and if the last received packet was
<br/>
really the last packet.(via ids and the total packets per batch)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Collecting smaller messages however is already done. Check the sources or some pages back. (LOBBY_SendTo* is internally using LOBBY_SendViaCollector on acked streams)
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
So,
<br/>
does that mean I could send each batch,
<br/>
without worrying about some being missed?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146520 - Mighty Max - Wed Dec 05, 2007 8:33 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yellowstar wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
How would you do this, when the last sent packet is the one missed? You'd need to know that there is another packet to be received before it even gets created ....
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
The client would check if there's a difference between
<br/>
packet id's, and if the last received packet was
<br/>
really the last packet.(via ids and the total packets per batch)
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
<br/>
You wouldn't notice a difference in the IDs if it was the last packet. Because to notice it you'd need to receive the last sent ID, which you failed to receive.
<br/>
The number of total packets is not known for the lib, and usualy not even known for the app (i.e. relying on user input)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Collecting smaller messages however is already done. Check the sources or some pages back. (LOBBY_SendTo* is internally using LOBBY_SendViaCollector on acked streams)
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
So,
<br/>
does that mean I could send each batch,
<br/>
without worrying about some being missed?</span></td> </tr></table><span class="postbody">
<br/>
<br/>
This means that the lib does this work, independendly of the packets semantics.
<br/>
If you have semantical related data, you as the programmer should keep them in least packets as possible for the programers sanity.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146561 - yellowstar - Wed Dec 05, 2007 11:03 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
You wouldn't notice a difference in the IDs if it was the last packet. Because to notice it you'd need to receive the last sent ID, which you failed to receive.
<br/>
The number of total packets is not known for the lib, and usualy not even known for the app (i.e. relying on user input)
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I know that.
<br/>
<br/>
It would add up the total packets recieved,
<br/>
and the missed packets,(based on the id differences)
<br/>
and compare the result with the
<br/>
total number of packets per batch.
<br/>
(the number it is supposed to be.)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
if(total_recieved_packets + missed_diff_packets != PACKETS_PER_BATCH)
<br/>
//Ask the host to resend missed packets
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146566 - Mighty Max - Thu Dec 06, 2007 12:10 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yellowstar wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
and the missed packets,(based on the id differences)
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
The thing im trying to point out is, that there are situations where no such difference is recognized alltho there is still data to be received. 
<br/>
The receiver can not predict the sends in general.
<br/>
<br/>
One might be able to do this in a specific situation, but that doesn't help for a lib that should cover the most cases possible
<br/>
<br/>
<br/>
Take the following situation: there are two blocks going to send. the first (A)contains 3 parts, the second (B) is one part:
<br/>
<br/>
Sender sends A1,A2,A3,B1
<br/>
Receiver gets A1,A2,A3, nothing
<br/>
<br/>
How can the receiver tell that B1 is missed, when it's length was not known at the time A finished?
<br/>
<br/>
Or even easier: You have an app that want's to transfers only one message. How can the receiver predict when the paket was send but not received, so it can request a resend?
<br/>
<br/>
<br/>
<br/>
.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146568 - yellowstar - Thu Dec 06, 2007 1:11 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yellowstar wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
and the missed packets,(based on the id differences)
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
The thing im trying to point out is, that there are situations where no such difference is recognized alltho there is still data to be received. 
<br/>
The receiver can not predict the sends in general.
<br/>
<br/>
One might be able to do this in a specific situation, but that doesn't help for a lib that should cover the most cases possible
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
<br/>
So,
<br/>
you mean this is(might be)
<br/>
a issue in the lib?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Or even easier: You have an app that want's to transfers only one message. How can the receiver predict when the paket was send but not received, so it can request a resend?
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Maybe the program/lib
<br/>
could send a "warning packet",
<br/>
and the receiver would know,
<br/>
from this packet that
<br/>
there is another packet to be recieved.
<br/>
If the actual packet isn't recieved,
<br/>
it could ask the sender for a resend.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146580 - Mighty Max - Thu Dec 06, 2007 7:27 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yellowstar wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<br/>
So,
<br/>
you mean this is(might be)
<br/>
a issue in the lib?
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
No it's not an issue with the lib, as the lib works different to this approach
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yellowstar wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<br/>
Maybe the program/lib
<br/>
could send a "warning packet",
<br/>
and the receiver would know,
<br/>
from this packet that
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
And you need to know whether this "warning" was received, or resend the warning, in which case you could simply repeat the actual message until it was received and answered, like it is done right now.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146604 - yellowstar - Thu Dec 06, 2007 7:23 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yellowstar wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<br/>
So,
<br/>
you mean this is(might be)
<br/>
a issue in the lib?
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
No it's not an issue with the lib, as the lib works different to this approach
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
<br/>
So,
<br/>
you want to know a better way
<br/>
to handle missed messages.(in the lib)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yellowstar wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<br/>
Maybe the program/lib
<br/>
could send a "warning packet",
<br/>
and the receiver would know,
<br/>
from this packet that
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
And you need to know whether this "warning" was received, or resend the warning, in which case you could simply repeat the actual message until it was received and answered, like it is done right now.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Yes, that would need done with that idea...
<br/>
<br/>
As, I said,
<br/>
I don't have much experience/knowledge with networking.
<br/>
<br/>
So,
<br/>
the client,(in the transfer app)
<br/>
would just need to wait for
<br/>
all the messages to be recieved?(in the batch)
<br/>
<br/>
If so,
<br/>
could the app rely on the lib
<br/>
to have the packets it the correct order?
<br/>
(Without relying on the ids?)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146607 - mufunyo - Thu Dec 06, 2007 8:23 pm</h4>
    <div class="postbody"><span class="postbody">Heh... This discussion is quite funny to read. You're tackling the problem backwards. You know how TCP/IP handles this? The *sender* keeps track of which packets arrived, not the *receiver*.
<br/>
<br/>
Consider this (very high packet loss) scenario:
<br/>
<br/>
Sender sends packets 1,2,3,4,5 and 6
<br/>
Receiver receives packets 1,4 and 6
<br/>
Receiver ACKnowledges packets 1,4 and 6
<br/>
Sender realises that only packets 1,4 and 6 have arrived, and resends packets 2,3 and 5.
<br/>
Receiver receives packets 3 and 5.
<br/>
Receiver ACKnowledges packets 3 and 5.
<br/>
Sender realises that only packets 3 and 5 of the resend have been received, and resends packet 2.
<br/>
Receiver receives packet 2.
<br/>
Receiver ACKnowledges packet 2.
<br/>
All packets have now been received.
<br/>
<br/>
Everybody is happy *yaay*.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146608 - MechaBouncer - Thu Dec 06, 2007 8:27 pm</h4>
    <div class="postbody"><span class="postbody">You also didn't mention the possibility that the sender didn't receive all the ACKs. In which case, it would resend packets that were already received. Then the receiver would send ACKs for all that it got. The problem lies in whether the original sender gets all the ACKs, otherwise it'll keep sending stuff even if it's already been received.<br/>_________________<br/>Cobalt/Black NDSL
<br/>
CycloDS Evolution (firmware 1.55 BETA 3) and EZFlash 3-in-1
<br/>
Kingston SD-C02G JAPAN 2GB MicroSD
<br/>
MoonShell 1.71, DSOrganize 3.1129, QuakeDS Pre3, ScummVM DS 0.11.1, Pocket Physics 0.6, OpenTyrian DS 0.3</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146609 - mufunyo - Thu Dec 06, 2007 8:34 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>MechaBouncer wrote:</b></span></td> </tr> <tr> <td class="quote">You also didn't mention the possibility that the sender didn't receive all the ACKs. In which case, it would resend packets that were already received. Then the receiver would send ACKs for all that it got. The problem lies in whether the original sender gets all the ACKs, otherwise it'll keep sending stuff even if it's already been received.</td> </tr></table><span class="postbody">
<br/>
So? I'd rather have some redundant data, than missing data. That's how it works. It's a tried and tested method; if the sender doesn't receive all ACK packets, it resends packets that have already been received. The receiver then ACKs those again and discards them immediately afterwards. It's a small price to pay for always getting your data in pristine condition. It's just like packet checksums. The data portion of a packet might be received without corruption, but the packet checksum could be corrupted. In that case, the packet has to be re-sent, even though the data was okay. But if you didn't have a checksum, you wouldn't have a way to know if the data was okay in the first place, so again, you pay this small price in order to get uncorrupted data.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146627 - yellowstar - Thu Dec 06, 2007 10:44 pm</h4>
    <div class="postbody"><span class="postbody">Here's an estimate on the transfer rate
<br/>
for this method:
<br/>
<br/>
~307,200(307 KiloBytes, 200 bytes)
<br/>
<br/>
( (packet size=512) X (packets_per_batch=10) ) X (batches_transfered_per_second= ~60) = 307,200
<br/>
(The 60 is 60 vblanks, for this estimate)
<br/>
<br/>
Of course,
<br/>
when the packets per batch changes,
<br/>
that number can change significantly.
<br/>
<br/>
Note that this number may be very inaccurate.
<br/>
<br/>
<br/>
This is because of the time spent
<br/>
waiting to send/receive the next batch.
<br/>
(The svn transfer app spends alot of time on this)
<br/>
<br/>
To make this more accurate,
<br/>
somebody needs to do the following:
<br/>
<br/>
Could somebody
<br/>
post the average amount of time,(or vblanks)
<br/>
that is spent on waiting on to send/receive,
<br/>
in the transfer app in svn?
<br/>
(I can't do this myself because of previously
<br/>
posted reasons.)
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
So, 
<br/>
the client,(in the transfer app) 
<br/>
would just need to wait for 
<br/>
all the messages to be recieved?(in the batch) 
<br/>
<br/>
If so, 
<br/>
could the app rely on the lib 
<br/>
to have the packets it the correct order? 
<br/>
(Without relying on the ids?)
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I know that the lib puts the packets in order.
<br/>
<br/>
I just want to make sure I can do this.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146706 - yellowstar - Fri Dec 07, 2007 10:50 pm</h4>
    <div class="postbody"><span class="postbody">Apparently,
<br/>
there wouldn't be much point
<br/>
in an app attempting to
<br/>
handle missed packets,
<br/>
as the lib already handles this.
<br/>
<br/>
So,
<br/>
I could have the client,(in the transfer app)
<br/>
wait for the whole batch to be recieved,
<br/>
write to the file, and continue?
<br/>
<br/>
<br/>
I'm trying to make a test demo
<br/>
of this method.
<br/>
<br/>
But,
<br/>
I'm having problems.
<br/>
<br/>
One issue, is, the player names
<br/>
are retreived incorrectly. Instead,
<br/>
they are blank.
<br/>
<br/>
Another problem:(Probably something in my app though)
<br/>
An crash is happening.(Red screens of Death)
<br/>
It seems to be a fat crash.
<br/>
I removed the init fat call,
<br/>
but that didn't fix it.
<br/>
I might be writing to fat
<br/>
somewhere...(arm-eabi_addr2line is failing to find the
<br/>
code which crashed it.)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146707 - Mighty Max - Fri Dec 07, 2007 10:55 pm</h4>
    <div class="postbody"><span class="postbody">Keep in mind that the callbacks are interrupting and thus need to take care of resources (i.e. filestructs) are not beeing used while already in use. 
<br/>
<br/>
This is one of the reasons i kept the file sharing so simple and doing one packet at a time in the first place (alltho the lib has advanced since then)<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146713 - yellowstar - Fri Dec 07, 2007 11:19 pm</h4>
    <div class="postbody"><span class="postbody">I have out the hard way
<br/>
not to flush files during a transfer.
<br/>
(With my NiFi EEP app. Disabling interrupts didn't do anything
<br/>
in this case.)
<br/>
(Nothing ever got written with calling that during the transfer.)
<br/>
<br/>
I wasn't thinking about
<br/>
interrupts for my debug files.
<br/>
(That's the only thing my
<br/>
app might be writing to.)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146765 - MechaBouncer - Sat Dec 08, 2007 11:41 pm</h4>
    <div class="postbody"><span class="postbody">You know, I've been curious about this. I was under the impression that this library used traditional WiFi protocols to connect the DS's together, but is this actually sending the frames in the same non-routable way that NiFi does? I guess what I'm really wondering is if NiFi has been cracked to the point that the packets could be captured for tunneling (although it would most likely require custom wireless card drivers to really happen)? Thanks.<br/>_________________<br/>Cobalt/Black NDSL
<br/>
CycloDS Evolution (firmware 1.55 BETA 3) and EZFlash 3-in-1
<br/>
Kingston SD-C02G JAPAN 2GB MicroSD
<br/>
MoonShell 1.71, DSOrganize 3.1129, QuakeDS Pre3, ScummVM DS 0.11.1, Pocket Physics 0.6, OpenTyrian DS 0.3</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146766 - tepples - Sat Dec 08, 2007 11:50 pm</h4>
    <div class="postbody"><span class="postbody">I seem to remember that tunneling raw Ni-Fi packets was tried, but it ended up that too many Ni-Fi games relied on sub-10 millisecond pings, which is probably never achievable between residential endpoints over the public Internet.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146769 - MechaBouncer - Sun Dec 09, 2007 12:23 am</h4>
    <div class="postbody"><span class="postbody">That's certainly understandable. I was always curious why this never went any further. Thanks!<br/>_________________<br/>Cobalt/Black NDSL
<br/>
CycloDS Evolution (firmware 1.55 BETA 3) and EZFlash 3-in-1
<br/>
Kingston SD-C02G JAPAN 2GB MicroSD
<br/>
MoonShell 1.71, DSOrganize 3.1129, QuakeDS Pre3, ScummVM DS 0.11.1, Pocket Physics 0.6, OpenTyrian DS 0.3</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146773 - masscat - Sun Dec 09, 2007 12:51 am</h4>
    <div class="postbody"><span class="postbody">Whilst trying to develop a PC base WMB client I found that there appeared to be hard timing requirements for the window in which the client had to send its replies. I could not meet these (this is assuming that I was doing everything else correctly) so the host lost interest and dropped its connection. On your desktop there can be lots of delays between the hardware seeing a packet and your program getting it (and similarly for the transmit), like the OS being off doing something else. These delays can even be hardware related, USB based hardware will not send you a packet until it is polled by the host controller.
<br/>
On the DS you do not have such problems. You can get an interrupt as soon as a packet arrives. The reply can then be formed and sent out in a timely manner. This reply (in the case of WMB) can be "I am a bit busy at the moment I will send a proper reply shortly".
<br/>
<br/>
There is a difference between the WiFi packet (802.11 based - similar for WMB/NiFi packets and normal Wireless LAN packets) and what the packet contains. WiFi packets are not routable, they just get transmitted on the air. All receiving stations (may - because the air is not a reliable medium) see the packet and if it for them they will examine and use its contents. The contents can be just about anything, maybe an IP packet that will then be routed off towards its destination.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146774 - yellowstar - Sun Dec 09, 2007 12:51 am</h4>
    <div class="postbody"><span class="postbody">According to the lr register,
<br/>
and arm-eabi-addr2line,
<br/>
it's not a fat crash.
<br/>
<br/>
Instead,
<br/>
It's crashing at some safe malloc code.
<br/>
(In my small lib.)
<br/>
<br/>
What is the lr register,
<br/>
anyway?(and sp reg)
<br/>
<br/>
<span style="font-weight: bold">EDIT:</span>
<br/>
Fixed typo.(Before I said
<br/>
sp, I changed it to lr.)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146901 - yellowstar - Mon Dec 10, 2007 11:23 pm</h4>
    <div class="postbody"><span class="postbody">When will Multicast be documented?
<br/>
(Functionality for DP)
<br/>
<br/>
I attempted to figure it out,
<br/>
but nothing.
<br/>
<br/>
802.11.h dosen't have any functions
<br/>
which use the multicast fuction pointer.
<br/>
(Neither does any of the other headers)
<br/>
<br/>
Is 802.3snap.h
<br/>
an internal header?
<br/>
I tried to use the functions
<br/>
and function pointer in that,
<br/>
but nothing.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#147290 - melw - Tue Dec 18, 2007 12:11 am</h4>
    <div class="postbody"><span class="postbody">Mighty Max, semester over yet? :) Have been peeking at bug tracker every now and then, but it's been bit silent over there lately...
<br/>
<br/>
As this thread is getting way too long for people to follow, how about setting up a web page or Wiki for the wireless lobby library? This could answer lot of questions at once and at minimum provide download links and other useful information. Such as:
<br/>
<ul>* development status / news
<br/>
* <a class="postlink" href="svn://91.184.39.23/svn/repos/libwifi" target="_blank">svn</a> / <a class="postlink" href="http://91.184.39.23/svn/wsvn/liblobby/" target="_blank">browse web svn</a>
<br/>
* direct downloads for the latest lib / source
<br/>
* bug reporting / <a class="postlink" href="http://91.184.39.23/.mantis/" target="_blank">bug tracker</a>
<br/>
* library documentation
<br/>
* list of used / reserved gamecodes</ul></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#147293 - thegamefreak0134 - Tue Dec 18, 2007 2:40 am</h4>
    <div class="postbody"><span class="postbody">OK, I just read a great deal of this forum post in one sitting, so forgive me if my eyes are glazing over a little bit...
<br/>
<br/>
Do I understand correctly that the functions in the library allow for sending and recieving of "messages" that may or may not get broken down into multiple "packets"? If so, do I also understand that the library itself takes care of making absolutely sure the message arrives at the client end if at all possible, in which case the programmer using said library would simply have to handle a lost message as a signal from the library function, and handle timeouts as a given series of lost messages?
<br/>
<br/>
If I've not lost my head, this seems like it could really be useful. I just want to be sure before I go off wondering why stuff does not work. In the worst case scenario, I would like to see if I could re-create a better form of pictochat on the DS, in homebrew form.
<br/>
<br/>
-thegamefreak<br/>_________________<br/>What if the hokey-pokey really is what it's all about?
<br/>
<br/>
[url=http:/www.darknovagames.com/index.php?action=recruit&amp;clanid=1]Support Zeta on DarkNova![/url]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#147333 - yellowstar - Tue Dec 18, 2007 11:16 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>thegamefreak0134 wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Do I understand correctly that the functions in the library allow for sending and recieving of "messages" that may or may not get broken down into multiple "packets"? If so, do I also understand that the library itself takes care of making absolutely sure the message arrives at the client end if at all possible, in which case the programmer using said library would simply have to handle a lost message as a signal from the library function, and handle timeouts as a given series of lost messages?
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
The lib takes care of sending and
<br/>
making sure that the packets are received correctly.
<br/>
The program just needs to send the packet,(and setup a stream callback, for receiving packets)
<br/>
and the lib takes care of the rest.
<br/>
<br/>
You aren't told what packets are missed
<br/>
when a timeout happens.
<br/>
A timeout happens when some internal packets
<br/>
aren't received from any user for a while.
<br/>
You are blocked from sending packets when
<br/>
a timeout happens.(blocked from sending packets
<br/>
to the timed out user)
<br/>
I don't know if the lib resends missed packets due to timeouts.
<br/>
Somebody else should reply to that.(Mighty Max?)
<br/>
<br/>
<br/>
I'm working on rewriting my pong game
<br/>
from scratch.
<br/>
It will use a modified version of my lib,
<br/>
because of a major bug and previous problems.
<br/>
(This version of my lib will be included in the source,
<br/>
so no need to download the source separately)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#147590 - yellowstar - Mon Dec 24, 2007 1:49 am</h4>
    <div class="postbody"><span class="postbody">I'm working on a test program for this idea.
<br/>
<br/>
But, it has problems. This time it made to 20,480 bytes.(20.5 Kilo bytes)
<br/>
Some data packets are then missed, and because of that, the host quits on the client, and fires a communication error. All the wait code in this test app waits for 60 vblanks before quiting on the other system.(Includes data transfer)
<br/>
The client can't send the reply packet because of the missed packets in that timeframe, and that causes the host to quit on it.
<br/>
<br/>
Sadly, only 1 batch is finished about every second. The total bytes per second is 5120... That's next no improvement over the SVN file transfer speed...
<br/>
<br/>
Maybe I could send all data packets on a separate non-acked stream, and handle the packets with the aforementioned method, or the TCP/IP method.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#148970 - yellowstar - Sat Jan 12, 2008 9:10 pm</h4>
    <div class="postbody"><span class="postbody">I finished implementing that TCP/IP code, minus bugs.(I didn't use anything for reference, other than the post about the TCP/IP protocol)
<br/>
<br/>
But, it won't work. The client keeps firing ACKs for one packet.
<br/>
One DS thinks it finished a batch, while the other thinks otherwise.
<br/>
<br/>
This would be a lot easier if I could find an implementation of the TCP/IP protocol...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#149124 - thoduv - Tue Jan 15, 2008 6:08 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yellowstar wrote:</b></span></td> </tr> <tr> <td class="quote">I finished implementing that TCP/IP code, minus bugs.(I didn't use anything for reference, other than the post about the TCP/IP protocol)
<br/>
<br/>
But, it won't work. The client keeps firing ACKs for one packet.
<br/>
One DS thinks it finished a batch, while the other thinks otherwise.
<br/>
<br/>
This would be a lot easier if I could find an implementation of the TCP/IP protocol...</td> </tr></table><span class="postbody">
<br/>
lwip ? I read it has alignment issues on DS, but perhaps it's worth trying again ?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#149231 - Shot - Thu Jan 17, 2008 12:34 am</h4>
    <div class="postbody"><span class="postbody">File transfer using melw's program, built with latest devkitpro 16/1/08
<br/>
<br/>
22:34 - Started file transfer - electroplankton.nds (trimmed by evotools)
<br/>
13,861,376 bytes total
<br/>
<br/>
22:47 - Check of progress reveals average transfer rate at ~4600 bytes/s
<br/>
<br/>
23:20 - Started getting very sluggish
<br/>
done ~12,385,000 bytes
<br/>
"sluggish" = roughly 500 bytes in 12 seconds
<br/>
receiving DS repeatedly timing out i assume - "Liz timed out" stated on the sending DS screen
<br/>
<br/>
23:24 - Speed has picked up again, no idea why. I don't know of anything changing in this time, other than soem people getting home. Who knows, maybe they had some wifi broadcasting equipment on them ^^
<br/>
<br/>
23:30 - File transfer completed - not displayed in any meaningful way on sending DS. Receiving DS displays same bytes received as total file size. I guess I just have to turn them off now.
<br/>
<br/>
Average transfer speed over duration ~4125 bytes/second. Surely that's lower than anyone expected.
<br/>
<br/>
The game loads fine and works perfectly as far as I can tell. I wouldn't like to try that with a 128mb rom though!
<br/>
<br/>
For information of others: Test was conducted on 2 DS lites (no idea what version of firmware, but neither was bought immediately after dslite release) sat side by side. They were never moved during the test, and there are no access points or other wireless hardware in range that I know of. Both DSs are using CyclopsDS Evolution v2 with MicroSD.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#149698 - yellowstar - Thu Jan 24, 2008 3:57 am</h4>
    <div class="postbody"><span class="postbody">I'm thinking it might be a packet corruption problem.
<br/>
<br/>
It seems liblobby doesn't care if packets are corrupted on non-acked streams. After all, they are, quote,"fire and forget".
<br/>
<br/>
What does 802.11b use for checksums? Also, I would like some links to some web pages on how to calculate these checksums.
<br/>
<br/>
Sometime I should find out what happens when I set the packets per batch to one...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#150107 - yellowstar - Wed Jan 30, 2008 1:54 am</h4>
    <div class="postbody"><span class="postbody">I have found out how to send out packets for Download Play/Multicast.(The receiving task still remains however)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">Send802_11(unsigned char *data, int length);</td> </tr></table><span class="postbody">
<br/>
<br/>
All packets, including "normal" packets and packets sent this way, are not detected by the wifi_lib_test packet capture, and Packet Capture code based Juglak's WMB Host code.
<br/>
<br/>
My code has a minor bug: The DP ad name and description are wrong. But, it must be a bug in my code.
<br/>
<br/>
Note that packets sent with this are raw. That means you must set the from and to MACs, sequence number...(With the 802.11 structs and ect)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#150244 - nipil - Fri Feb 01, 2008 12:05 am</h4>
    <div class="postbody"><span class="postbody">Good evening. I just read the 19 pages of this thread, and it's really intersting. The amount of work done in the timeframe is impressive. Now that i'm some sort of noob when it comes to wifi, i have some questions, which are hopefuly simple enough not to bother you :
<br/>
<br/>
- i think i got it that lobby lib is for ad-hoc connection mode, ie means you don't need any standard PC/Routeur access point.
<br/>
<br/>
- what's the use of libwifi ? speak to standard PC/Routeur access point using protocol compliant 802.11/Wifi or anything similar? 
<br/>
<br/>
- ni-fi lib hacking is for DS internet connectivity ? What's the interest in this, except it's closed protocol ? I don't get what ni-fi is used for, if libwifi is available.
<br/>
<br/>
- what kind of protocol/lib is download play based on ? If it's ni-fi, then i answered my previous question ?
<br/>
<br/>
- how is the lobby lib behaving towards "standard" PC/Routeur wifi access ? I live in a residential area, and using the wifi-cfg test app from svsip, i could receive from about 10 different networks... I mean, i don't really care if i disturb their reception (just kiding) but i would hate that because of this i couldn't use this lib.
<br/>
<br/>
- Capture: i have a ralink/wmb-compatible card, which i tested using wmb and official demos. I could install any of the standard driver or the wmb one. on the software side, i have no problems using Wireshark et al, but <span style="font-style: italic">i have conceptual problems to get a view on how i should configure my interface and averything related to wireless capture</span>. I would love if anyone could give me any hint on this (either windows or linux, though i installed my nds environment on windows).
<br/>
<br/>
Just to say it, while i think i'm quite skilled when it comes to wired network administration,  programming, and architecture, i never steped in the wireless train. Until i bought one (then a second) DS, and now, I'm learning ;)
<br/>
<br/>
Currently, and from the homebrew programming point of view, i'm having trouble distinguishing between the various current wi-fi projects out there. <span style="font-style: italic">I would be happy to get some insight on who is who and which do what</span>, if my questioning above is completely false.
<br/>
<br/>
Thanks in advance.
<br/>
<br/>
And once again, i'm awesomely impressed by what you guys (and gals maybe, dunno ;) did on this project. Eternal kudos to you all.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#150256 - yellowstar - Fri Feb 01, 2008 5:26 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>nipil wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
- i think i got it that lobby lib is for ad-hoc connection mode, ie means you don't need any standard PC/Routeur access point.
<br/>
</td> </tr></table><span class="postbody">
<br/>
Correct. It's like doing multi-player on official games. More like Multi-Card multicard multi-player mode at the moment, however.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>nipil wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
- what's the use of libwifi ? speak to standard PC/Routeur access point using protocol compliant 802.11/Wifi or anything similar? 
<br/>
<br/>
- ni-fi lib hacking is for DS internet connectivity ? What's the interest in this, except it's closed protocol ? I don't get what ni-fi is used for, if libwifi is available.
<br/>
</td> </tr></table><span class="postbody">
<br/>
libwifi has been renamed to liblobby. It only does NiFi, and it always was that way. NiFi is not internet. It's like doing multi player, as previously stated. The dswifi library is used for "normal" homebrew Wifi.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>nipil wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
- what kind of protocol/lib is download play based on ? If it's ni-fi, then i answered my previous question ?
<br/>
</td> </tr></table><span class="postbody">
<br/>
NiFi.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>nipil wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
- how is the lobby lib behaving towards "standard" PC/Routeur wifi access ? I live in a residential area, and using the wifi-cfg test app from svsip, i could receive from about 10 different networks... I mean, i don't really care if i disturb their reception (just kiding) but i would hate that because of this i couldn't use this lib.
<br/>
</td> </tr></table><span class="postbody">
<br/>
The problems with wireless networks/Wifi APs/Access Points has been fixed a good while ago. Nobody has had any problems in this aspect since then. In other words, you can use any of the liblobby programs/games and the above wouldn't be affected.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>nipil wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
- Capture: i have a ralink/wmb-compatible card, which i tested using wmb and official demos. I could install any of the standard driver or the wmb one. on the software side, i have no problems using Wireshark et al, but <span style="font-style: italic">i have conceptual problems to get a view on how i should configure my interface and averything related to wireless capture</span>. I would love if anyone could give me any hint on this (either windows or linux, though i installed my nds environment on windows).
<br/>
</td> </tr></table><span class="postbody">
<br/>
Well, I never could try this myself because I don't have a wireless card...(I'm going to need it in about 2 months however...)
<br/>
But, as stated in another topic, search this forum for "capturing packets".
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>nipil wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Currently, and from the homebrew programming point of view, i'm having trouble distinguishing between the various current wi-fi projects out there. <span style="font-style: italic">I would be happy to get some insight on who is who and which do what</span>, if my questioning above is completely false.
<br/>
</td> </tr></table><span class="postbody">
<br/>
sgstair documented most of the Wifi hardware, and is the author of dswifi.
<br/>
(At least I think he did most of it...)
<br/>
Juglak wrote the first,(And probably the only)
<br/>
WMB host for DS. Firefly wrote the WMB drivers for PC Ralink wireless cards.
<br/>
phusson was the person whom started this DS-to-DS project.
<br/>
And of course, Mighty Max!(Whom is obviously the current author of the lib)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#150271 - Jesse - Fri Feb 01, 2008 10:53 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yellowstar wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>nipil wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
- how is the lobby lib behaving towards "standard" PC/Routeur wifi access ? I live in a residential area, and using the wifi-cfg test app from svsip, i could receive from about 10 different networks... I mean, i don't really care if i disturb their reception (just kiding) but i would hate that because of this i couldn't use this lib.
<br/>
</td> </tr></table><span class="postbody">
<br/>
The problems with wireless networks/Wifi APs/Access Points has been fixed a good while ago. Nobody has had any problems in this aspect since then. In other words, you can use any of the liblobby programs/games and the above wouldn't be affected.</span></td> </tr></table><span class="postbody">
<br/>
True for liblobby I hope, but I still have problems when using dswifi (the access point networking library) with it bogging down some routers in some special cases. It probably doesn't affect any other router than the one you are connected to and I haven't tested the latest version 0.3.4 yet.<br/>_________________<br/><a href="http://www.collectingsmiles.com/colors" target="_blank">http://www.collectingsmiles.com/colors</a> &amp; <a href="http://www.collectingsmiles.com/hyena" target="_blank">http://www.collectingsmiles.com/hyena</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#150276 - nipil - Fri Feb 01, 2008 1:29 pm</h4>
    <div class="postbody"><span class="postbody">Thanks the for the information. There is something i don't get in what you said here : </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yellowstar wrote:</b></span></td> </tr> <tr> <td class="quote">libwifi has been renamed to liblobby. It only does NiFi, and it always was that way. NiFi is not internet. It's like doing multi player, as previously stated. The dswifi library is used for "normal" homebrew Wifi.</td> </tr></table><span class="postbody">
<br/>
<br/>
As I understand it, liblobby and nifi shre the same goal : local multiplayer.
<br/>
<br/>
But when you say "it only does nifi", does it mean that liblobby uses the exact same protocol (called nifi afaik) or that they just share the final usage goal ?
<br/>
<br/>
ie. is liblobby a kind of reverse engineered nifi-local-multiplayer, or a completely distinct mean to do multiplayer, without any link to the actual nifi protocol ?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#150306 - nipil - Fri Feb 01, 2008 7:47 pm</h4>
    <div class="postbody"><span class="postbody">I just got raw packet capture working, using Debian Etch, RT2500 source driver, and wireshark. Pretty neat. Kismet is working too, but that's not the point. I played with wifi_lib test (from Stephen Stair, v0.3.4) and i managed to grab the packets the DS sends (i saw Beacon frames, Authentication, Acknowledgement, association request, so i guess it works properly ;)
<br/>
<br/>
Btw, no message from MightyMax since Dec 13. Guess he's on holiday ;)<br/>_________________<br/>NDS Lite Gold/Silver, MK5/R4DS, MSI PC54G2, D-Link DI-624</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#150313 - yellowstar - Fri Feb 01, 2008 8:52 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>nipil wrote:</b></span></td> </tr> <tr> <td class="quote">Thanks the for the information. There is something i don't get in what you said here : <table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yellowstar wrote:</b></span></td> </tr> <tr> <td class="quote">libwifi has been renamed to liblobby. It only does NiFi, and it always was that way. NiFi is not internet. It's like doing multi player, as previously stated. The dswifi library is used for "normal" homebrew Wifi.</td> </tr></table><span class="postbody">
<br/>
<br/>
As I understand it, liblobby and nifi shre the same goal : local multiplayer.
<br/>
<br/>
But when you say "it only does nifi", does it mean that liblobby uses the exact same protocol (called nifi afaik) or that they just share the final usage goal ?
<br/>
<br/>
ie. is liblobby a kind of reverse engineered nifi-local-multiplayer, or a completely distinct mean to do multiplayer, without any link to the actual nifi protocol ?</span></td> </tr></table><span class="postbody">
<br/>
That's correct, both this lib and NiFi share the same goal.
<br/>
When I said, <span style="font-style: italic">it only does Nifi</span>, I meant only local wireless, no Internet. liblobby and Nifi just have the same final usage goal, not the exact same protocol.
<br/>
<span style="font-style: italic">is liblobby a kind of reverse engineered nifi-local-multiplayer</span>
<br/>
That's correct.
<br/>
<br/>
Homebew and official games can't communicate with this library, however. It should be possible to do this once Multicast/Download Play works correctly.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#150314 - Cid2Mizard - Fri Feb 01, 2008 8:54 pm</h4>
    <div class="postbody"><span class="postbody">Where is the liblobby ?<br/>_________________<br/><a href="http://www.nintendomax.com" target="_blank">www.nintendomax.com</a> 100% Hack 0% Warez</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#150316 - yellowstar - Fri Feb 01, 2008 9:19 pm</h4>
    <div class="postbody"><span class="postbody">liblobby, the source, and all the examples, are in SVN.
<br/>
<br/>
<br/>
Click <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?p=142174#142174" target="_blank">here</a> for the the original post about SVN.
<br/>
Actual Link: <a href="svn://91.184.39.23/svn/repos/libwifi" target="_blank">svn://91.184.39.23/svn/repos/libwifi</a>
<br/>
<br/>
Click <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?p=145531#145531" target="_blank">here</a> for the post about WebSVN.
<br/>
Actual Link: <a href="http://91.184.39.23/svn/wsvn/liblobby/" target="_blank">http://91.184.39.23/svn/wsvn/liblobby/</a>
<br/>
<br/>
Click <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?p=145488#145488" target="_blank">here</a> for the post about the bugtracker.
<br/>
Actual Link: <a href="http://91.184.39.23/.mantis/" target="_blank">http://91.184.39.23/.mantis/</a>
<br/>
<br/>
To use SVN, you need a SVN client, such as TortoiseSVN. WebSVN is so
<br/>
you can browse and download/export/checkout files from SVN with your web browser. But unfortunately you have to download each file one-at-a-time with WebSVN.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151878 - adamrgolf - Thu Mar 06, 2008 10:02 am</h4>
    <div class="postbody"><span class="postbody">Just curious how the colors_adhoctest is going?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151923 - MechaBouncer - Thu Mar 06, 2008 6:24 pm</h4>
    <div class="postbody"><span class="postbody">So I finally got around to playing someone in the adhoc version of DiceWars DS and must say that it was awesome! The game remained quite stable and worked really well. Too bad we weren't able to finish our match before he had to leave, but it was great fun while it lasted.<br/>_________________<br/>Cobalt/Black NDSL
<br/>
CycloDS Evolution (firmware 1.55 BETA 3) and EZFlash 3-in-1
<br/>
Kingston SD-C02G JAPAN 2GB MicroSD
<br/>
MoonShell 1.71, DSOrganize 3.1129, QuakeDS Pre3, ScummVM DS 0.11.1, Pocket Physics 0.6, OpenTyrian DS 0.3</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151968 - nio101 - Fri Mar 07, 2008 8:36 am</h4>
    <div class="postbody"><span class="postbody">Hello,
<br/>
<br/>
Just to put it in a nutshell : is liblobby currently usable to do ad-hoc communication between 2 or more NDS ?
<br/>
<br/>
If not, what is still to be figured out ?
<br/>
<br/>
Thanks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152020 - melw - Sat Mar 08, 2008 1:07 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>nio101 wrote:</b></span></td> </tr> <tr> <td class="quote">Just to put it in a nutshell : is liblobby currently usable to do ad-hoc communication between 2 or more NDS ?</td> </tr></table><span class="postbody">
<br/>
Short answer: yes.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>nio101 wrote:</b></span></td> </tr> <tr> <td class="quote">If not, what is still to be figured out ?</td> </tr></table><span class="postbody">
<br/>
Longer answer: Mighty Max has hinted the whole library would need a rewrite for compatibility and stability reasons. Also the helper functions in current library, such as room handling is unfinished and partially lacking proper implementation.
<br/>
<br/>
I had stability issues with the latest svn release, but it looks like Mighty Max hasn't worked on this project since December... However there is also a bug tracker and most severe bugs are known, so if anyone has the time, interest and skills to work on this, the source is there waiting for updates. Otherwise checking out a few revisions old version of the library may work better.
<br/>
<br/>
While testing last time, we could play and complete an ad-hoc game of Dicewars DS with 7 players / DS's locally. So in that sense the library is definitely functional and usable.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152023 - nio101 - Sat Mar 08, 2008 2:02 pm</h4>
    <div class="postbody"><span class="postbody">Ok.
<br/>
<br/>
Do you know specifically which liblobby release/version is used by Dicewars?
<br/>
<br/>
Thanks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152028 - wintermute - Sat Mar 08, 2008 3:34 pm</h4>
    <div class="postbody"><span class="postbody">If you haven't already used this library in your project it's probably not a good idea to start using it now.
<br/>
<br/>
Updates are in progress to libnds, dswifi and the devkitARM project build system which will unfortunately cause many issues with liblobby. There are some plans to provide this sort of functionality later but the people with the skills to provide it are currently lacking the time to do it.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152029 - nio101 - Sat Mar 08, 2008 4:02 pm</h4>
    <div class="postbody"><span class="postbody">Ok, thanks for the advice... I'll wait &amp; see ! ^^</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152036 - yellowstar - Sat Mar 08, 2008 6:57 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>melw wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Short answer: yes.
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>nio101 wrote:</b></span></td> </tr> <tr> <td class="quote">If not, what is still to be figured out ?</td> </tr></table><span class="postbody">
<br/>
Longer answer: Mighty Max has hinted the whole library would need a rewrite for compatibility and stability reasons.
<br/>
<br/>
I had stability issues with the latest svn release</span></td> </tr></table><span class="postbody">
<br/>
Same here with crashing.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152076 - iprice - Sun Mar 09, 2008 12:48 pm</h4>
    <div class="postbody"><span class="postbody">I am still trying to make WMB_Host arm7 happy with the setup for <b style="color:#FFA34F">liblobby</b> arm7.... anyone else trying? anyone else got any joy?
<br/>
<br/>
I can get both working fine on their own but due to IPC and WIFI issues I am having trouble combining.....  :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152090 - melw - Sun Mar 09, 2008 8:00 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>nio101 wrote:</b></span></td> </tr> <tr> <td class="quote">Do you know specifically which <b style="color:#FFA34F">liblobby</b> release/version is used by Dicewars?</td> </tr></table><span class="postbody">
<br/>
The latest released public beta (0.4.3) uses <b style="color:#FFA34F">liblobby</b> svn revision from the same date (November 13th, 2007, probably svn r65). Currently unreleased version (0.4.4) has updates on various areas, but is unstable probably because of the latest <b style="color:#FFA34F">liblobby</b> version used. After that I was waiting for <b style="color:#FFA34F">liblobby</b> updates and got distracted by other projects. I plan to return on this later on when I have more time in my hands... What was/is in the works is getting <b style="color:#FFA34F">liblobby</b> and sgstair's wifilib working in the same build (one after another, not simultaneously).
<br/>
<br/>
IIRC the library got unstable somewhere after svn revision 70, and r67 (the one adding LOBBY_SetOwnUserName()) was more stable than the latest one.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#156483 - simonjhall - Sat May 10, 2008 4:11 pm</h4>
    <div class="postbody"><span class="postbody">Whatever happened to the development of this library? Is anyone maintaining / developing an ad-hoc solution for the DS? This thread had some really promising results! And what happened to MM?<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#156489 - yellowstar - Sat May 10, 2008 6:30 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>simonjhall wrote:</b></span></td> </tr> <tr> <td class="quote">And what happened to MM?</td> </tr></table><span class="postbody">
<br/>
I went to his web site, and the contact link has his E-Mail address. Somebody should try to contact him... As for what happened to the dev of this library, it seems once Mighty Max left, nobody has attempted anything...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#156512 - tepples - Sat May 10, 2008 10:32 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yellowstar wrote:</b></span></td> </tr> <tr> <td class="quote">As for what happened to the dev of this library, it seems once Mighty Max left, nobody has attempted anything...</td> </tr></table><span class="postbody">
<br/>
It likely has something to do with wintermute warning all of us about big changes to the ARM7 in the next libnds.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#156528 - iprice - Sun May 11, 2008 8:58 am</h4>
    <div class="postbody"><span class="postbody">I can get nice solutions that are quite stable for sending a game file thanks to yellow star.... and in game ad-hoc is OK and fairly stable but to get them both working together is tricky. - and if ARM7 is changing big-time then I hope it does soon so we can see what's going on..... any date on a release?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#156656 - melw - Mon May 12, 2008 8:32 am</h4>
    <div class="postbody"><span class="postbody">Personally I'm waiting for the next libnds update to see what gets broken and probably then make a new branch of <b style="color:#FFA34F">liblobby</b> for the latest dKA/libnds if Mighty Max is still absent.
<br/>
<br/>
I don't think anyone is able or willing to do major bug fixing besides Mighty Max. At least the inner workings of the library is beyond my programming skills. I know Sgstair has something cooking, but I'm willing to bet the next Dswifi library is not coming too soon. :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#159400 - ize - Mon Jun 30, 2008 8:30 am</h4>
    <div class="postbody"><span class="postbody">Just to let you guys know, we have just released a game, RetroRocket, which uses <b style="color:#FFA34F">liblobby</b>.
<br/>
It was announced here: <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=15740" target="_blank">http://forum.gbadev.org/viewtopic.php?t=15740</a>
<br/>
<br/>
Official page: <a class="postlink" href="http://retrorocketgame.org/" target="_blank">http://retrorocketgame.org/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#159866 - melw - Mon Jul 07, 2008 8:29 pm</h4>
    <div class="postbody"><span class="postbody">Ize, Just out of interest - what <b style="color:#FFA34F">liblobby</b> version are you using and if there's any fixes compared to svn version what they were?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160292 - yellowstar - Sun Jul 13, 2008 7:53 pm</h4>
    <div class="postbody"><span class="postbody">It appears no changes were made. In the source code I didn't see any files for <b style="color:#FFA34F">liblobby</b> modifications.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#161510 - ize - Tue Aug 05, 2008 12:46 pm</h4>
    <div class="postbody"><span class="postbody">We are using the most recent <b style="color:#FFA34F">liblobby</b>, no modifications. We are missing some important functions, but it works fine for most situations.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#161768 - dantheman - Wed Aug 13, 2008 7:50 pm</h4>
    <div class="postbody"><span class="postbody">The latest version of TetAttDS uses <b style="color:#FFA34F">liblobby</b> as well as far as I'm aware.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#161933 - bentendo - Tue Aug 19, 2008 5:13 pm</h4>
    <div class="postbody"><span class="postbody">I want to be able to sync start the play button on two instances of moonshell. It appears to be possible with <b style="color:#FFA34F">Liblobby</b> but I don't know anything about it?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#161934 - elhobbs - Tue Aug 19, 2008 6:35 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>bentendo wrote:</b></span></td> </tr> <tr> <td class="quote">I want to be able to sync start the play button on two instances of moonshell. It appears to be possible with <b style="color:#FFA34F">Liblobby</b> but I don't know anything about it?</td> </tr></table><span class="postbody">I think you may have a bigger obstacle in trying to compile moonshell. In any case there are examples with <b style="color:#FFA34F">liblobby</b>. I would think that dswifi would be a better bet though it may be quite difficult to hook either one of the libraries into the behemoth that is moonshell.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#161974 - Mohammad - Thu Aug 21, 2008 11:50 pm</h4>
    <div class="postbody"><span class="postbody">I can't download SVN, has anyone zipped it :?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#162386 - yellowstar - Mon Sep 01, 2008 6:29 pm</h4>
    <div class="postbody"><span class="postbody"><a class="postlink" href="http://members.iglide.net/ticeandsons/yellowstar/liblobbyR67.zip" target="_blank">This</a> is a archive of <b style="color:#FFA34F">liblobby</b> SVN revision 67, the last stable revision of <b style="color:#FFA34F">liblobby</b>. Source and library binaries are included, along with the examples.(<b style="color:#FFA34F">Liblobby</b>'s source was slightly modified to fix some compiler warnings)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164469 - mytheric - Mon Nov 03, 2008 7:03 pm</h4>
    <div class="postbody"><span class="postbody">Hi, 
<br/>
<br/>
I used <b style="color:#FFA34F">liblobby</b> to create a walkie-talkie for the Nintendo DS-Lite. During the process, I noticed performance problems that seemed to originate in the hardware FIFO based ARM7-ARM9 IPC. Rewriting this IPC using shared memory instead of hardware FIFO seemed to resolve the performance issue. 
<br/>
<br/>
I'm not  sure the performance issue was real or was caused by an error in my deployment (first DS project), but I read about comparable performance issues on this forum. Can anyone (melw?) help me get in contact with the <b style="color:#FFA34F">liblobby</b> maintainer? If my changes are usable, I would like to see them merged.
<br/>
<br/>
(http://home.kabelfoon.nl/~moongies/nds_en.html)
<br/>
<br/>
Eric.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164490 - Sektor - Tue Nov 04, 2008 1:49 am</h4>
    <div class="postbody"><span class="postbody">Clickable link: <a href="http://home.kabelfoon.nl/~moongies/nds_en.html" target="_blank">http://home.kabelfoon.nl/~moongies/nds_en.html</a>
<br/>
<br/>
Nice job on the walkietalkie, it works surprisingly well.<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><a class="postlink" href="http://gtamp.com/DS" target="_blank">GTAMP.com/DS</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164615 - mytheric - Mon Nov 10, 2008 1:30 am</h4>
    <div class="postbody"><span class="postbody">Thank you Sektor. The audio synchronization wasn't as rock solid as I wanted however, because I somehow couldn't use an absolute audio index. 
<br/>
<br/>
Just found out that that problem had to do with another performance bottleneck in <b style="color:#FFA34F">Liblobby</b>: software based CRC calculation. After switching to hardware CRC the ARM7 load decreased significantly. 
<br/>
<br/>
Using software CRC (as the latest <b style="color:#FFA34F">liblobby</b> SVN does) isn't something you do without good reason, it is possible that my change reintroduces known issues unknown to me.
<br/>
<br/>
Details about the <b style="color:#FFA34F">liblobby</b> changes are in the walkie-talkie v0.2 source on my website, see the README (or mail me for a complete <b style="color:#FFA34F">liblobby</b> snapshot).
<br/>
<br/>
Still hoping that there is someone out there that can help me to get in contact with a <b style="color:#FFA34F">Liblobby</b> maintainer...
<br/>
<br/>
Eric.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#169465 - iainprice - Mon Jul 13, 2009 8:21 pm</h4>
    <div class="postbody"><span class="postbody">Any luck with using newest <b style="color:#FFA34F">liblobby</b> with newest libs in devkitpro?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#169824 - hacker013 - Wed Aug 05, 2009 11:35 am</h4>
    <div class="postbody"><span class="postbody">Any progress on this ?<br/>_________________<br/><a class="postlink" href="http://imetal.nl/" target="_blank">Website / Blog</a>
<br/>
<br/>
Let the nds be with you.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
