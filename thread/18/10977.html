<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>setting a singlt tile on a rotbg? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > setting a singlt tile on a rotbg?</h2>
<div id="posts">
<div class="post">
    <h4>#100514 - spinal_cord - Mon Aug 28, 2006 12:03 pm</h4>
    <div class="postbody"><span class="postbody">Can someone tell me how to place a single tile on a rot background? I'm using PALib but it doesn't have a function to do that. The game im working on requires a scaled background with the abilit to change some of the tiles. PALib can only change tiles of regular tiles backgrounds, not rotating/scaled ones.
<br/>
<br/>
Can someone please help me?<br/>_________________<br/>I'm not a boring person, it's just that boring things keep happening to me.
<br/>
<a class="postlink" href="http://spinal.dizidesigns.co.uk/" target="_blank">Homepage</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100519 - gmiller - Mon Aug 28, 2006 12:19 pm</h4>
    <div class="postbody"><span class="postbody">Not sure about this but from looking at the code you just need to do the tiles the standard way.  The rotation and scaling effect the bg but the tile mapping and stuff (map manipulation) is the same for both.  The background size choices are differnent between rot and non-rot (text) backgounds.  On the GBA the map layout is different as well but I have not spent that much time on the DS yet to know more.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100524 - spinal_cord - Mon Aug 28, 2006 12:57 pm</h4>
    <div class="postbody"><span class="postbody">It messes up when i do it the normal way, it sets the tile 2*x,2*y instead of x,y.<br/>_________________<br/>I'm not a boring person, it's just that boring things keep happening to me.
<br/>
<a class="postlink" href="http://spinal.dizidesigns.co.uk/" target="_blank">Homepage</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100599 - josath - Mon Aug 28, 2006 10:11 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>spinal_cord wrote:</b></span></td> </tr> <tr> <td class="quote">It messes up when i do it the normal way, it sets the tile 2*x,2*y instead of x,y.</td> </tr></table><span class="postbody">
<br/>
That seems pretty easy to fix, just divide x and y by 2?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100606 - tepples - Mon Aug 28, 2006 10:41 pm</h4>
    <div class="postbody"><span class="postbody">Then how do you set the odd tiles?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100628 - spinal_cord - Tue Aug 29, 2006 12:17 am</h4>
    <div class="postbody"><span class="postbody">I cant, I tried x/2,y/2, but all that did was set half the number of tiles still exevry second tile.
<br/>
<br/>
surely someone can do this without palib? molusc suggests i edit the normal tile function to do rotbg suff. he said something about the rotbg values being 8bit instead of 16bit. but thats way over my head.<br/>_________________<br/>I'm not a boring person, it's just that boring things keep happening to me.
<br/>
<a class="postlink" href="http://spinal.dizidesigns.co.uk/" target="_blank">Homepage</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100630 - gmiller - Tue Aug 29, 2006 12:33 am</h4>
    <div class="postbody"><span class="postbody">The tile map for non-rotational background is 16 bits per entry with low order 10 bit for the tile number the high order 4 bits for which 16 color palette to use.  The other two bits are for flipping the tile horiz./vert.  For rotation background the map is 8 bits per entry and all 8 bits are the tile number and there are no other bits so only 256 color and no horz/vert flipping allowed.  Now I took this from the GBA so there may be differences for the system running in DS mode but this does not seem be be the case from my reading of the code.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100657 - spinal_cord - Tue Aug 29, 2006 10:05 am</h4>
    <div class="postbody"><span class="postbody">But what code do I use to set a single tile (without using palib)?<br/>_________________<br/>I'm not a boring person, it's just that boring things keep happening to me.
<br/>
<a class="postlink" href="http://spinal.dizidesigns.co.uk/" target="_blank">Homepage</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100680 - gmiller - Tue Aug 29, 2006 5:04 pm</h4>
    <div class="postbody"><span class="postbody">I think this will work as an addition for the PALIB
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
inline void PA_SetRotMapTile(u8 screen, u8 bg_select, s16 x, s16 y, u16 tile_number) {
<br/>
u16 hold, *where;
<br/>
tile_number = tile_number &amp; 0x00FF;
<br/>
// Calculate offset into rotational background map x + (y*32) ... tile is 8x8 and each pixel is 8 bits to 32  bytes wide
<br/>
where = (u16*)(PA_bgmap[screen][bg_select] + ((x)) + ((y) &lt;&lt; 5));
<br/>
// Get current value as 16 bit but we only have 8 bits per pixes (must be written as 16 bit)
<br/>
hold = *where;
<br/>
// Odd or even (high or low byte
<br/>
if ((x &amp; 1) == 0)
<br/>
  hold = (hold &amp; 0xFF00) | tile_number; // change low order byte
<br/>
else
<br/>
  hold = (hold &amp; 0x00FF) | (tile_number &lt;&lt; 8); // change high order byte
<br/>
*where = hold; // save as 16 bit, as required by hardware
<br/>
}
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I can't test it yet on my system so the offset calculation may be off.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100690 - gmiller - Tue Aug 29, 2006 8:08 pm</h4>
    <div class="postbody"><span class="postbody">The line:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
where = (u16*)(PA_bgmap[screen][bg_select] + ((x)) + ((y) &lt;&lt; 5));
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I think is wrong, I believe it should be:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
where = (u16*)(PA_bgmap[screen][bg_select] + (((x) + ((y) &lt;&lt; 5)) &gt;&gt; 1);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Since the map for a rotational bg is an array of char the x/y offset is in bytes so in an array of shorts it's offset is half.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100785 - gmiller - Wed Aug 30, 2006 2:41 pm</h4>
    <div class="postbody"><span class="postbody">Sorry for the screup I was thinking 16 color palette and that can't be with rotational BG.  so the line should be:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
where = (u16*)(PA_bgmap[screen][bg_select] + (((x) + ((y) &lt;&lt; 6)) &gt;&gt; 1);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Since a tile is 8x8 (so 64 pixles) and there are 2 per short, to get the index requires us to figure the offset in pixels and then divide by to to get the subscript.  I did test the algorithm but not this code.  I do not use PAlib so it took some time to look through the code to see what was being done.  Of course then I screwed up the offset calculation.  Some days I am not much help.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100880 - spinal_cord - Thu Aug 31, 2006 10:08 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>gmiller wrote:</b></span></td> </tr> <tr> <td class="quote">Some days I am not much help.</td> </tr></table><span class="postbody">
<br/>
You have been more help than enyone else I have asked (thankyou).
<br/>
<br/>
The offset seems to be a little off, I don't know much about whats going on in the routine, so i cant fix it myself.
<br/>
<br/>
my map should be like this
<br/>
<a href="http://www.freewebs.com/spinal_cord/images/Image2.gif">[Images not permitted - Click here to view it]</a>
<br/>
but its turning out like this
<br/>
<a href="http://www.freewebs.com/spinal_cord/images/Image1.gif">[Images not permitted - Click here to view it]</a>
<br/>
<br/>
[edit]
<br/>
the line should be
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">where = (u16*)(PA_bgmap[screen][bg_select] + (x + (y &lt;&lt; 5))); </td> </tr></table><span class="postbody">
<br/>
<br/>
Thankyou, you may have helped a small minority of PALib users that wish to use a RotBg.<br/>_________________<br/>I'm not a boring person, it's just that boring things keep happening to me.
<br/>
<a class="postlink" href="http://spinal.dizidesigns.co.uk/" target="_blank">Homepage</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100887 - gmiller - Thu Aug 31, 2006 12:40 pm</h4>
    <div class="postbody"><span class="postbody">damn .. my first "guess" was right ... who would have guessed.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
