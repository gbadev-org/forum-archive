<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Text on sub screen with background - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Text on sub screen with background</h2>
<div id="posts">
<div class="post">
    <h4>#104475 - smoggie83 - Fri Sep 29, 2006 4:10 pm</h4>
    <div class="postbody"><span class="postbody">I am trying to display text above a background but no matter what i try it wont display any text that i tell it too! any ideas anyone?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include &lt;nds.h&gt;
<br/>
<br/>
#include &lt;nds/arm9/console.h&gt; 
<br/>
#include &lt;stdio.h&gt;
<br/>
<br/>
//make file automaticaly makes a header file for access
<br/>
//to the binary data in any file ending in .bin that is in
<br/>
//the data folder.  It also links in that data to your project
<br/>
<br/>
#include "drunkenlogo_bin.h"
<br/>
#include "palette_bin.h"
<br/>
<br/>
#include "diceRoll_bin.h"
<br/>
#include "diceRollPalette_bin.h"
<br/>
<br/>
#include "players_bin.h"
<br/>
#include "playersPalette_bin.h"
<br/>
<br/>
enum { CONTINUOUS, SINGLE } TouchType = CONTINUOUS;
<br/>
<br/>
volatile int frame = 0;
<br/>
<br/>
//---------------------------------------------------------------------------------
<br/>
void Vblank() {
<br/>
//---------------------------------------------------------------------------------
<br/>
   frame++;
<br/>
}
<br/>
<br/>
void initVideo() {
<br/>
   //enable vram and map it to the right places
<br/>
    vramSetMainBanks(   VRAM_A_MAIN_BG_0x6000000,      //map A and B to main background memory
<br/>
                        VRAM_B_LCD,
<br/>
                        VRAM_C_SUB_BG_0x6200000,      //map C to sub background memory
<br/>
                        VRAM_D_LCD                  //map D to LCD free space
<br/>
                  //allows adjacent banks to overflow into D if a bug like that was ever to occur
<br/>
                        );
<br/>
   
<br/>
   //map a bank for use with sprites
<br/>
   //vramSetBankE(VRAM_E_MAIN_SPRITE); //mapping E to main sprites gives us 64k for sprites
<br/>
   //(64k is the max space that 1024 tiles take up in 256 color mode)
<br/>
   
<br/>
   //set the video mode
<br/>
    videoSetMode(  MODE_5_2D |    
<br/>
                   DISPLAY_BG3_ACTIVE     //turn on background 3
<br/>
               );
<br/>
   
<br/>
   videoSetModeSub(MODE_5_2D | DISPLAY_BG0_ACTIVE | DISPLAY_BG3_ACTIVE | DISPLAY_SPR_1D   );
<br/>
}
<br/>
<br/>
<br/>
void initBackgrounds() {
<br/>
<br/>
   //setup exrot bg 3 on main as a 16bit color background
<br/>
   BG3_CR = BG_BMP8_256x256 ;
<br/>
   //attributes of the affine translation matrix
<br/>
   BG3_XDX = 1 &lt;&lt; 8; //scale x
<br/>
   BG3_XDY = 0; //rotation x
<br/>
   BG3_YDX = 0; //rotation y
<br/>
   BG3_YDY = 1 &lt;&lt; 8; //scale y
<br/>
   BG3_CX = 0; //translation x
<br/>
   BG3_CY = 0; //translation y
<br/>
   
<br/>
   //setup exrot bg 3 on sub
<br/>
   SUB_BG3_CR = BG_BMP8_256x256 ;
<br/>
   //attributes of the affine translation matrix
<br/>
   SUB_BG3_XDX = 1 &lt;&lt; 8; //scale x
<br/>
   SUB_BG3_XDY = 0; //rotation x
<br/>
   SUB_BG3_YDX = 0; //scale y
<br/>
   SUB_BG3_YDY = 1 &lt;&lt; 8; //scale y
<br/>
   SUB_BG3_CX = 0; //translation x
<br/>
   SUB_BG3_CY = 0; //translation y
<br/>
}
<br/>
<br/>
int main(void) {
<br/>
//---------------------------------------------------------------------------------
<br/>
   int min_x  = 4096 , min_y  = 4096, max_x  = 0, max_y   = 0;
<br/>
   int min_px = 4096 , min_py = 4096, max_px = 0 , max_py = 0;
<br/>
   touchPosition touch;
<br/>
<br/>
<br/>
   powerON(POWER_ALL); 
<br/>
   
<br/>
   //initialise the interrupt system
<br/>
   irqInit();
<br/>
   //install our simple vblank handler
<br/>
   irqSet(IRQ_VBLANK, Vblank);
<br/>
   //enable the interrupt
<br/>
   irqEnable(IRQ_VBLANK);
<br/>
   
<br/>
   //set the mode for 2 text layers and two extended background layers
<br/>
   initVideo();
<br/>
<br/>
   ///////////////set up our bitmap background///////////////////////
<br/>
   initBackgrounds();
<br/>
   
<br/>
   
<br/>
   // black backdrop
<br/>
   BG_PALETTE[0]=RGB15(0,0,0);
<br/>
   SUB_BG0_CR = BG_COLOR_256;//use bg0 for the text
<br/>
   //SUB_BG0_CR = BG_MAP_BASE(31);
<br/>
   BG_PALETTE[255] = RGB15(200,0,0);//by default font rendered with color 255
<br/>
   
<br/>
   //consoleInit() is a lot more flexible but this gets you up and running quick
<br/>
   consoleInitDefault((u16*)SCREEN_BASE_BLOCK(31), (u16*)CHAR_BASE_BLOCK(0), 16);
<br/>
<br/>
   dmaCopy(drunkenlogo_bin, BG_GFX, 256*192);
<br/>
   dmaCopy(palette_bin, BG_PALETTE, 256*2);
<br/>
   
<br/>
   dmaCopy(drunkenlogo_bin, BG_GFX_SUB, 256*192);
<br/>
   dmaCopy(palette_bin, BG_PALETTE_SUB, 256*2);
<br/>
   
<br/>
   while(1) {
<br/>
      swiWaitForVBlank();
<br/>
      
<br/>
      // read the button states
<br/>
      scanKeys();
<br/>
<br/>
      // read the touchscreen coordinates
<br/>
      touch=touchReadXY();
<br/>
      
<br/>
      int pressed = keysDown();   // buttons pressed this loop
<br/>
      int held = keysHeld();      // buttons currently held
<br/>
<br/>
      // Right Shoulder button toggles the mode
<br/>
      if ( pressed &amp; KEY_R) TouchType ^= SINGLE;
<br/>
      
<br/>
      iprintf("\xTEST TEXT HERE!!!");
<br/>
      
<br/>
      if ( TouchType == SINGLE &amp;&amp; !(pressed &amp; KEY_TOUCH) ) continue;
<br/>
<br/>
      if ( !(held &amp; KEY_TOUCH) || touch.x == 0 || touch.y == 0) continue;
<br/>
      
<br/>
      if ( touch.x &gt; max_x)      max_x = touch.x;
<br/>
      if ( touch.y &gt; max_y)      max_y = touch.y;
<br/>
      if ( touch.px &gt; max_px)   max_px = touch.px;
<br/>
      if ( touch.py &gt; max_py)   max_py = touch.py;
<br/>
<br/>
      if ( touch.x &lt; min_x)      min_x = touch.x;
<br/>
      if ( touch.y &lt; min_y)      min_y = touch.y;
<br/>
      if ( touch.px &lt; min_px)   min_px = touch.px;
<br/>
      if ( touch.py &lt; min_py)   min_py = touch.py;
<br/>
   }
<br/>
<br/>
   return 0;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Cheers
<br/>
<br/>
Dave</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104477 - psycorpse - Fri Sep 29, 2006 4:45 pm</h4>
    <div class="postbody"><span class="postbody">are you trying to use the top screen or bottom screen?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104478 - smoggie83 - Fri Sep 29, 2006 4:49 pm</h4>
    <div class="postbody"><span class="postbody">i was wanting the text displayed on the bottom screen as that is where the interface and questions will come up in my project.
<br/>
<br/>
thanks in advance</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104480 - psycorpse - Fri Sep 29, 2006 5:08 pm</h4>
    <div class="postbody"><span class="postbody">Change your code to this and tell me what it does 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
SUB_BG0_CR = BG_MAP_BASE(31) | BG_PRIORITY(0);
<br/>
BG_PALETTE_SUB[255] = RGB(31, 31, 31);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
you also need (adding_SUB to the blocks):
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">consoleInitDefault((u16*)SCREEN_BASE_BLOCK_SUB(31), (u16*)CHAR_BASE_BLOCK_SUB(0), 16);</td> </tr></table><span class="postbody">
<br/>
<br/>
you need to change your sub bg 3 to priority(1)  and change the BASE()
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">SUB_BG3_CR = BG_BMP8_256x256 | BG_BMP_BASE(8) | BG_PRIORITY(1) ;</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104482 - knight0fdragon - Fri Sep 29, 2006 5:24 pm</h4>
    <div class="postbody"><span class="postbody">also your dmaCopy to the BG_PALETTE_SUB is also going to screw up with your text color, so stick the BG_PALETTE_SUB[255] = blah after that for now<br/>_________________<br/><a href="http://www.myspace.com/knight0fdragonds" target="_blank">http://www.myspace.com/knight0fdragonds</a>
<br/>
<br/>
MK DS FC: Dragon 330772 075464 
<br/>
AC WW FC: Anthony SamsClub 1933-3433-9458 
<br/>
MPFH: Dragon 0215 4231 1206</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104485 - smoggie83 - Fri Sep 29, 2006 5:50 pm</h4>
    <div class="postbody"><span class="postbody">cheers for the help. With them changes the background which for now is the same as the top screen doesnt display! i get a black background with the text on with a kindof red semi-transparent layer above it.[/img]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104488 - psycorpse - Fri Sep 29, 2006 5:58 pm</h4>
    <div class="postbody"><span class="postbody">Your image link didn't show up. Can you post a pic?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104491 - smoggie83 - Fri Sep 29, 2006 6:19 pm</h4>
    <div class="postbody"><span class="postbody">i dont have a site to upload to sorry, its something to do with these lines though 
<br/>
<br/>
SUB_BG0_CR = BG_MAP_BASE(31) | BG_PRIORITY(0);
<br/>
<br/>
and 
<br/>
<br/>
SUB_BG3_CR = BG_BMP8_256x256 | BG_BMP_BASE(8) | BG_PRIORITY(1) ;
<br/>
<br/>
i think its to do with the BASE part?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104492 - psycorpse - Fri Sep 29, 2006 6:27 pm</h4>
    <div class="postbody"><span class="postbody">Your right. It does have something to do with the BASE. I believe that you need to copy your background to 
<br/>
<br/>
dmaCopy(drunkenlogo_bin, (void*)BG_BMP_RAM_SUB(8), 256*192);
<br/>
<br/>
instead of
<br/>
<br/>
dmaCopy(drunkenlogo_bin, BG_GFX_SUB, 256*192);</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104575 - smoggie83 - Sat Sep 30, 2006 3:59 pm</h4>
    <div class="postbody"><span class="postbody">the text now displays no problem but there is still no background, the image isnt displayed at all. The new code is 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include &lt;nds.h&gt;
<br/>
<br/>
#include &lt;nds/arm9/console.h&gt; 
<br/>
#include &lt;stdio.h&gt;
<br/>
<br/>
//make file automaticaly makes a header file for access
<br/>
//to the binary data in any file ending in .bin that is in
<br/>
//the data folder.  It also links in that data to your project
<br/>
<br/>
#include "drunkenlogo_bin.h"
<br/>
#include "palette_bin.h"
<br/>
<br/>
#include "diceRoll_bin.h"
<br/>
#include "diceRollPalette_bin.h"
<br/>
<br/>
#include "players_bin.h"
<br/>
#include "playersPalette_bin.h"
<br/>
<br/>
enum { CONTINUOUS, SINGLE } TouchType = CONTINUOUS;
<br/>
<br/>
volatile int frame = 0;
<br/>
<br/>
//---------------------------------------------------------------------------------
<br/>
void Vblank() {
<br/>
//---------------------------------------------------------------------------------
<br/>
   frame++;
<br/>
}
<br/>
<br/>
void initVideo() {
<br/>
   //enable vram and map it to the right places
<br/>
    vramSetMainBanks(   VRAM_A_MAIN_BG_0x6000000,      //map A and B to main background memory
<br/>
                        VRAM_B_LCD,
<br/>
                        VRAM_C_SUB_BG_0x6200000,      //map C to sub background memory
<br/>
                        VRAM_D_LCD                  //map D to LCD free space
<br/>
                  //allows adjacent banks to overflow into D if a bug like that was ever to occur
<br/>
                        );
<br/>
   
<br/>
   //map a bank for use with sprites
<br/>
   //vramSetBankE(VRAM_E_MAIN_SPRITE); //mapping E to main sprites gives us 64k for sprites
<br/>
   //(64k is the max space that 1024 tiles take up in 256 color mode)
<br/>
   
<br/>
   //set the video mode
<br/>
    videoSetMode(  MODE_5_2D |    
<br/>
                   DISPLAY_BG3_ACTIVE     //turn on background 3
<br/>
               );
<br/>
   
<br/>
   videoSetModeSub(MODE_5_2D | DISPLAY_BG0_ACTIVE | DISPLAY_BG3_ACTIVE   );
<br/>
}
<br/>
<br/>
<br/>
void initBackgrounds() {
<br/>
<br/>
   //setup exrot bg 3 on main as a 16bit color background
<br/>
   BG3_CR = BG_BMP8_256x256 ;
<br/>
   //attributes of the affine translation matrix
<br/>
   BG3_XDX = 1 &lt;&lt; 8; //scale x
<br/>
   BG3_XDY = 0; //rotation x
<br/>
   BG3_YDX = 0; //rotation y
<br/>
   BG3_YDY = 1 &lt;&lt; 8; //scale y
<br/>
   BG3_CX = 0; //translation x
<br/>
   BG3_CY = 0; //translation y
<br/>
   
<br/>
   //setup exrot bg 3 on sub
<br/>
   SUB_BG3_CR = BG_BMP8_256x256 | BG_BMP_BASE(8) | BG_PRIORITY(1) ;
<br/>
   //attributes of the affine translation matrix
<br/>
   SUB_BG3_XDX = 1 &lt;&lt; 8; //scale x
<br/>
   SUB_BG3_XDY = 0; //rotation x
<br/>
   SUB_BG3_YDX = 0; //scale y
<br/>
   SUB_BG3_YDY = 1 &lt;&lt; 8; //scale y
<br/>
   SUB_BG3_CX = 0; //translation x
<br/>
   SUB_BG3_CY = 0; //translation y
<br/>
}
<br/>
<br/>
int main(void) {
<br/>
//---------------------------------------------------------------------------------
<br/>
   int min_x  = 4096 , min_y  = 4096, max_x  = 0, max_y   = 0;
<br/>
   int min_px = 4096 , min_py = 4096, max_px = 0 , max_py = 0;
<br/>
   touchPosition touch;
<br/>
<br/>
<br/>
   powerON(POWER_ALL); 
<br/>
   
<br/>
   //initialise the interrupt system
<br/>
   irqInit();
<br/>
   //install our simple vblank handler
<br/>
   irqSet(IRQ_VBLANK, Vblank);
<br/>
   //enable the interrupt
<br/>
   irqEnable(IRQ_VBLANK);
<br/>
   
<br/>
   //set the mode for 2 text layers and two extended background layers
<br/>
   initVideo();
<br/>
<br/>
   ///////////////set up our bitmap background///////////////////////
<br/>
   initBackgrounds();
<br/>
   
<br/>
   // black backdrop
<br/>
   BG_PALETTE[0]=RGB15(0,0,0);
<br/>
   SUB_BG0_CR = BG_MAP_BASE(31) | BG_PRIORITY(0); ;//use bg0 for the text
<br/>
   
<br/>
   
<br/>
   //consoleInit() is a lot more flexible but this gets you up and running quick
<br/>
   consoleInitDefault((u16*)SCREEN_BASE_BLOCK_SUB(31), (u16*)CHAR_BASE_BLOCK_SUB(0), 16);
<br/>
<br/>
   dmaCopy(drunkenlogo_bin, BG_GFX, 256*192);
<br/>
   dmaCopy(palette_bin, BG_PALETTE, 256*2);
<br/>
   
<br/>
   dmaCopy(drunkenlogo_bin,  (void*)BG_BMP_RAM_SUB(8), 256*192);
<br/>
   dmaCopy(palette_bin, BG_PALETTE_SUB, 256*2);
<br/>
   
<br/>
   BG_PALETTE[255] = RGB15(31,31,31);//by default font rendered with color 255
<br/>
   iprintf("TEST TEXT HERE!!!");
<br/>
   while(1) {
<br/>
      swiWaitForVBlank();
<br/>
      
<br/>
      // read the button states
<br/>
      scanKeys();
<br/>
<br/>
      // read the touchscreen coordinates
<br/>
      touch=touchReadXY();
<br/>
      
<br/>
      int pressed = keysDown();   // buttons pressed this loop
<br/>
      int held = keysHeld();      // buttons currently held
<br/>
<br/>
      // Right Shoulder button toggles the mode
<br/>
      if ( pressed &amp; KEY_R) TouchType ^= SINGLE;
<br/>
      
<br/>
      
<br/>
      
<br/>
      if ( TouchType == SINGLE &amp;&amp; !(pressed &amp; KEY_TOUCH) ) continue;
<br/>
<br/>
      if ( !(held &amp; KEY_TOUCH) || touch.x == 0 || touch.y == 0) continue;
<br/>
      
<br/>
      if ( touch.x &gt; max_x)      max_x = touch.x;
<br/>
      if ( touch.y &gt; max_y)      max_y = touch.y;
<br/>
      if ( touch.px &gt; max_px)   max_px = touch.px;
<br/>
      if ( touch.py &gt; max_py)   max_py = touch.py;
<br/>
<br/>
      if ( touch.x &lt; min_x)      min_x = touch.x;
<br/>
      if ( touch.y &lt; min_y)      min_y = touch.y;
<br/>
      if ( touch.px &lt; min_px)   min_px = touch.px;
<br/>
      if ( touch.py &lt; min_py)   min_py = touch.py;
<br/>
   }
<br/>
<br/>
   return 0;
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104636 - psycorpse - Sun Oct 01, 2006 12:47 am</h4>
    <div class="postbody"><span class="postbody">I think that this is because you are filling the BG_PALLETE_SUB. Since you are filling up BG_PALLETE_SUB[0] with the dma copy you are telling it that the transparent color is something else. Take out the 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   dmaCopy(palette_bin, BG_PALETTE_SUB, 256*2);</td> </tr></table><span class="postbody">
<br/>
<br/>
and add
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">BG_PALETTE_SUB[255] = RGB15(31,31,31);</td> </tr></table><span class="postbody">
<br/>
<br/>
Let me know if this works and I will check again later tonight. Leaving for a couple of hours. I do think that this will work though.
<br/>
<br/>
Mike</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104698 - smoggie83 - Sun Oct 01, 2006 5:20 pm</h4>
    <div class="postbody"><span class="postbody">still no luck :s
<br/>
<br/>
Im completely stumped something like this should be so simple!! it only displays the background when i use dmaCopy(drunkenlogo_bin,  BG_GFX_SUB, 256*192); but then the text doesnt work - with the other suggestion only text works :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104709 - psycorpse - Sun Oct 01, 2006 7:43 pm</h4>
    <div class="postbody"><span class="postbody">Ok I was able to get this to work. The only problem is that I can only get it to work with the main screen. In this case the top. You could use this screen and just flip the screens so that it is in the bottom. I think that we didn't have the extra memory mapped as well as all the other changes. I have commented the changes that I have made to your existing code. My Comments are in:
<br/>
/*
<br/>
* comment here
<br/>
*/
<br/>
<br/>
Also the filp code is 
<br/>
lcdMainOnBottom();
<br/>
<br/>
You could try to load that around your videoSetMode() functions.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include &lt;nds.h&gt; 
<br/>
<br/>
#include &lt;nds/arm9/console.h&gt; 
<br/>
#include &lt;stdio.h&gt; 
<br/>
<br/>
//make file automaticaly makes a header file for access 
<br/>
//to the binary data in any file ending in .bin that is in 
<br/>
//the data folder.  It also links in that data to your project 
<br/>
<br/>
#include "drunkenlogo_bin.h" 
<br/>
#include "palette_bin.h" 
<br/>
<br/>
/* 
<br/>
* I didn't have this bin files so I commented them out
<br/>
*/
<br/>
<br/>
//#include "diceRoll_bin.h" 
<br/>
//#include "diceRollPalette_bin.h" 
<br/>
<br/>
//#include "players_bin.h" 
<br/>
//#include "playersPalette_bin.h" 
<br/>
<br/>
enum { CONTINUOUS, SINGLE } TouchType = CONTINUOUS; 
<br/>
<br/>
volatile int frame = 0; 
<br/>
<br/>
//--------------------------------------------------------------------------------- 
<br/>
void Vblank() { 
<br/>
//--------------------------------------------------------------------------------- 
<br/>
   frame++; 
<br/>
} 
<br/>
<br/>
void initVideo() { 
<br/>
   //enable vram and map it to the right places 
<br/>
<br/>
/*
<br/>
*  I added VRAM_B_MAIN_BG_0x602000
<br/>
*/
<br/>
<br/>
    vramSetMainBanks(   VRAM_A_MAIN_BG_0x6000000,      //map A and B to main background memory 
<br/>
                        VRAM_B_MAIN_BG_0x6020000, 
<br/>
                        VRAM_C_SUB_BG_0x6200000,      //map C to sub background memory 
<br/>
                        VRAM_D_LCD                  //map D to LCD free space 
<br/>
                  //allows adjacent banks to overflow into D if a bug like that was ever to occur 
<br/>
                        ); 
<br/>
    
<br/>
   //map a bank for use with sprites 
<br/>
   //vramSetBankE(VRAM_E_MAIN_SPRITE); //mapping E to main sprites gives us 64k for sprites 
<br/>
   //(64k is the max space that 1024 tiles take up in 256 color mode) 
<br/>
    
<br/>
   //set the video mode 
<br/>
<br/>
/*
<br/>
* I changed the videoSetModes to this
<br/>
*/
<br/>
<br/>
    videoSetMode(  MODE_5_2D | DISPLAY_BG0_ACTIVE |   
<br/>
                   DISPLAY_BG3_ACTIVE     //turn on background 3 
<br/>
               ); 
<br/>
    
<br/>
   videoSetModeSub(MODE_5_2D | DISPLAY_BG3_ACTIVE   ); 
<br/>
} 
<br/>
<br/>
<br/>
void initBackgrounds() { 
<br/>
<br/>
/*
<br/>
* I added | BG_BMP_BASE(8) | BG_PRIORITY(1)
<br/>
*/
<br/>
<br/>
   //setup exrot bg 3 on main as a 16bit color background 
<br/>
   BG3_CR = BG_BMP8_256x256 | BG_BMP_BASE(8) | BG_PRIORITY(1); 
<br/>
   //attributes of the affine translation matrix 
<br/>
   BG3_XDX = 1 &lt;&lt; 8; //scale x 
<br/>
   BG3_XDY = 0; //rotation x 
<br/>
   BG3_YDX = 0; //rotation y 
<br/>
   BG3_YDY = 1 &lt;&lt; 8; //scale y 
<br/>
   BG3_CX = 0; //translation x 
<br/>
   BG3_CY = 0; //translation y 
<br/>
<br/>
/*
<br/>
* I took off the SUB_ on BG0_CR
<br/>
*/
<br/>
   BG0_CR = BG_MAP_BASE(31) | BG_PRIORITY(0); //use bg0 for the text     
<br/>
<br/>
   //setup exrot bg 3 on sub 
<br/>
   SUB_BG3_CR = BG_BMP8_256x256 | BG_PRIORITY(1) ; 
<br/>
   //attributes of the affine translation matrix 
<br/>
   SUB_BG3_XDX = 1 &lt;&lt; 8; //scale x 
<br/>
   SUB_BG3_XDY = 0; //rotation x 
<br/>
   SUB_BG3_YDX = 0; //scale y 
<br/>
   SUB_BG3_YDY = 1 &lt;&lt; 8; //scale y 
<br/>
   SUB_BG3_CX = 0; //translation x 
<br/>
   SUB_BG3_CY = 0; //translation y 
<br/>
} 
<br/>
<br/>
int main(void) { 
<br/>
//--------------------------------------------------------------------------------- 
<br/>
   int min_x  = 4096 , min_y  = 4096, max_x  = 0, max_y   = 0; 
<br/>
   int min_px = 4096 , min_py = 4096, max_px = 0 , max_py = 0; 
<br/>
   touchPosition touch; 
<br/>
<br/>
<br/>
   powerON(POWER_ALL); 
<br/>
    
<br/>
   //initialise the interrupt system 
<br/>
   irqInit(); 
<br/>
   //install our simple vblank handler 
<br/>
   irqSet(IRQ_VBLANK, Vblank); 
<br/>
   //enable the interrupt 
<br/>
   irqEnable(IRQ_VBLANK); 
<br/>
    
<br/>
   //set the mode for 2 text layers and two extended background layers 
<br/>
   initVideo(); 
<br/>
<br/>
   ///////////////set up our bitmap background/////////////////////// 
<br/>
   initBackgrounds(); 
<br/>
    
<br/>
/*
<br/>
* I took off _SUB on both BLOCKS
<br/>
*/
<br/>
<br/>
   //consoleInit() is a lot more flexible but this gets you up and running quick 
<br/>
   consoleInitDefault((u16*)SCREEN_BASE_BLOCK(31), (u16*)CHAR_BASE_BLOCK(0), 16); 
<br/>
<br/>
/*
<br/>
* I changed BG_GFX to (void*)BG_BMP_RAM(8)
<br/>
*/
<br/>
<br/>
   dmaCopy(drunkenlogo_bin, (void*)BG_BMP_RAM(8), 256*192); 
<br/>
   dmaCopy(palette_bin, BG_PALETTE, 256*2); 
<br/>
    
<br/>
   dmaCopy(drunkenlogo_bin,  BG_GFX_SUB, 256*192); 
<br/>
   dmaCopy(palette_bin, BG_PALETTE_SUB, 256*2); 
<br/>
<br/>
/*
<br/>
* I changed the text color  to white
<br/>
*/
<br/>
   BG_PALETTE[255] = RGB15(31,31,31);//by default font rendered with color 255 
<br/>
<br/>
   iprintf("TEST TEXT HERE!!!"); 
<br/>
   while(1) { 
<br/>
      swiWaitForVBlank(); 
<br/>
       
<br/>
      // read the button states 
<br/>
      scanKeys(); 
<br/>
<br/>
      // read the touchscreen coordinates 
<br/>
      touch=touchReadXY(); 
<br/>
       
<br/>
      int pressed = keysDown();   // buttons pressed this loop 
<br/>
      int held = keysHeld();      // buttons currently held 
<br/>
<br/>
      // Right Shoulder button toggles the mode 
<br/>
      if ( pressed &amp; KEY_R) TouchType ^= SINGLE; 
<br/>
       
<br/>
       
<br/>
       
<br/>
      if ( TouchType == SINGLE &amp;&amp; !(pressed &amp; KEY_TOUCH) ) continue; 
<br/>
<br/>
      if ( !(held &amp; KEY_TOUCH) || touch.x == 0 || touch.y == 0) continue; 
<br/>
       
<br/>
      if ( touch.x &gt; max_x)      max_x = touch.x; 
<br/>
      if ( touch.y &gt; max_y)      max_y = touch.y; 
<br/>
      if ( touch.px &gt; max_px)   max_px = touch.px; 
<br/>
      if ( touch.py &gt; max_py)   max_py = touch.py; 
<br/>
<br/>
      if ( touch.x &lt; min_x)      min_x = touch.x; 
<br/>
      if ( touch.y &lt; min_y)      min_y = touch.y; 
<br/>
      if ( touch.px &lt; min_px)   min_px = touch.px; 
<br/>
      if ( touch.py &lt; min_py)   min_py = touch.py; 
<br/>
   } 
<br/>
<br/>
   return 0; 
<br/>
} 
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104771 - smoggie83 - Mon Oct 02, 2006 4:01 pm</h4>
    <div class="postbody"><span class="postbody">hey, thanks for the help! weird to get your head round but at least i can crack on with the rest of the project now! thanks again</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
