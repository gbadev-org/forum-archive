<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Several questions on making animated sprites - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Several questions on making animated sprites</h2>
<div id="posts">
<div class="post">
    <h4>#155002 - Polaris - Wed Apr 23, 2008 9:35 pm</h4>
    <div class="postbody"><span class="postbody">Recently I have been trying to make animated sprites and fortunately it wasn't much different from what I have originally envisioned. But still, I have several doubts about the whole thing.
<br/>
<br/>
<span style="font-weight: bold">First are the actual animation methods. I figured out two different ways of doing it. </span>
<br/>
<br/>
The first one was loading all the tiles for any given sprite, and then changing the tileIdx property of the SpriteEntry asociated with them to achieve the animation.
<br/>
The second method is very similar but instead of loading all the tiles at once, I just load the needed ones for each frame. So I end up doing a dmaCopy each time a frame goes by.
<br/>
<br/>
I'm assuming the first method is faster since it doesn't require to constantly make dmaCopy, but it also takes a lot more space in memory. Is the faster speed worth it? Or the difference is negligible?
<br/>
<br/>
<span style="font-weight: bold">With that out of the way I still don't know how should I use grit properly to convert my sprite sheets.</span>
<br/>
<br/>
In the small test i'm currently doing, I figured out I needed to place all the frames of my animation making a column rather than a row in my .png file, so that grit would tile it properly for any of the two previous methods to work.
<br/>
<br/>
Which commads should I use so that I can have grit tile the image properly, regardless of how I choose to draw the frames in my image file.
<br/>
<br/>
<span style="font-weight: bold">Lastly there is the issue of having a game entity use different animations from the same sprite sheet.  </span>
<br/>
<br/>
So I thought about it for a moment and after some research I figured I needed two things in order to make this. First I should know where each individual animation starts and where it finishes(in the sprite sheet) and second, a state machine so that I can manage more easiely the transitions between each animation.
<br/>
<br/>
The state machine part sounds great. What doesn't sound so great is having to look at the sprite sheets and taking note of the numbers of the frames each animation starts and ends with.
<br/>
<br/>
I'm pretty sure it's going to work. Each state would take care of setting the current beginFrame and endFrame and then with those two crucial numbers I could set up a very crud Animation Manager to handle the animation code for every sprite.
<br/>
<br/>
Still there is a voice in the back of my head, it's mumbling, I want to shut it, but I can't. It's saying "Hardcoding........".
<br/>
<br/>
What would be a better aproach to get different animations out of a single sprite sheet?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#155007 - SevenString - Wed Apr 23, 2008 10:06 pm</h4>
    <div class="postbody"><span class="postbody">Read in your sprite sheet (or a simplified version) from a fat text file or other similar mechanism at runtime, and parse it into your sprite animation data structure.
<br/>
<br/>
So your text file might say something like:
<br/>
<br/>
WALK_N       0 9
<br/>
WALK_NW    10 19
<br/>
WALK_W      20 29
<br/>
...
<br/>
...
<br/>
...
<br/>
ATTACK_N   80 89
<br/>
<br/>
<br/>
<br/>
and so on.
<br/>
<br/>
Read and parse through the lines of the animation sheet to load the various slots of your sprite structure with the proper frame values.
<br/>
<br/>
You could even get fancy and have a generic list structure in your sprite that allows you to add named animation types dynamically.  Then you aren't hardcoding ANYTHING, and each character (or other) sprite type can have its own unique set of animations.
<br/>
<br/>
Going this route would allow you to expand or change your animation sets without having to change any of your animation management code.<br/>_________________<br/><span style="font-style: italic">"Artificial Intelligence is no match for natural stupidity."</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#155009 - tepples - Wed Apr 23, 2008 10:10 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Polaris wrote:</b></span></td> </tr> <tr> <td class="quote">The first one was loading all the tiles for any given sprite, and then changing the tileIdx property of the SpriteEntry asociated with them to achieve the animation.
<br/>
The second method is very similar but instead of loading all the tiles at once, I just load the needed ones for each frame. So I end up doing a dmaCopy each time a frame goes by.
<br/>
<br/>
I'm assuming the first method is faster since it doesn't require to constantly make dmaCopy, but it also takes a lot more space in memory. Is the faster speed worth it? Or the difference is negligible?</td> </tr></table><span class="postbody">
<br/>
Lots of games use the second method, including Battletoads on the NES and Sonic and Kirby on the GBA. Back in the early days of the GBA scene, I wrote a <a class="postlink" href="http://www.pineight.com/gba/managing-sprite-vram.txt" target="_blank">white paper about the second method</a>. It still applies on the DS in 2D mode. But if you're using the 3D hardware to draw 2D sprites, the DS has a much smaller window of time to upload the textures.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#155031 - Polaris - Thu Apr 24, 2008 2:16 am</h4>
    <div class="postbody"><span class="postbody">Thanks for the input guys.
<br/>
<br/>
SevenString: That is what I feared. I have used parsers in the past, and more or less understand what their purpose is. But I really don't have a clue as to how I should write one. I guess I should start searching on that.
<br/>
<br/>
tepples: I believe that anything that was used for BattleToads for the NES is proof enough that it should be used once more!
<br/>
<br/>
If by this line anyone is still reading, remember that the second question hasn't been answered :P</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#155045 - M3d10n - Thu Apr 24, 2008 12:15 pm</h4>
    <div class="postbody"><span class="postbody">You can safely use DMA for loading the animation frames on demand. Just make sure to do some double buffering to avoid having the sprite being drawn to the screen mid-copy: have the sprite alternate display one frame while you copy the next one to a different address, then change the ID to display that and copy the next frame to the previous address.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
