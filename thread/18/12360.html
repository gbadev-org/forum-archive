<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>devkitARM r20 - .cpp & emulator issues [Solved] - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > devkitARM r20 - .cpp & emulator issues [Solved]</h2>
<div id="posts">
<div class="post">
    <h4>#117513 - JessTicular - Mon Feb 05, 2007 6:25 am</h4>
    <div class="postbody"><span class="postbody">G'day,
<br/>
<br/>
I've just updated to devkitARM r20 (and libnds 20070127) and I wanted to update all my projects to compile under these new dev kits.
<br/>
<br/>
However, when I try to compile any C++ based (rather than C based) project, it crashes both Dualis and the Hardware.
<br/>
<br/>
As an example, the 'Combined Template' will compile and run perfectly under the new kits, but if you change the files to .cpp instead of .c, they then crash the Editor and Hardware. This did not happen under r19a.
<br/>
<br/>
Any Ideas?
<br/>
<br/>
Cheers,
<br/>
Jess.<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="font-weight: bold">Nintendo DS &amp; Dominos :: <a class="postlink" href="http://dsdominos.sourceforge.net" target="_blank">DS Dominos</a></span>
<br/>
<a class="postlink" href="http://jt0.org" target="_blank">http://jt0.org</a></span></span><span class="gensmall"><br/><br/>Last edited by JessTicular on Mon Feb 05, 2007 2:30 pm; edited 2 times in total</span></div>    
</div>
<div class="post">
    <h4>#117527 - wintermute - Mon Feb 05, 2007 11:21 am</h4>
    <div class="postbody"><span class="postbody">Just tried that here.
<br/>
<br/>
With .cpp the arm7 core of the combined template fails due to a difference in handling of enum types between C++ &amp; C.
<br/>
<br/>
You can fix this by changing the parameter type of irqEnable in the libnds headers to u32 - this is what's being done in CVS currently, cast the parameter ( won't work when you update libnds again) or just enable the interrupts separately.
<br/>
<br/>
Tested the result in no$gba, dualis and hw. dualis doesn't crash here but doesn't quite work right ( this is due to the difference in IPC struct, much of which should have been removed long ago) , the others work fine.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117528 - JessTicular - Mon Feb 05, 2007 11:34 am</h4>
    <div class="postbody"><span class="postbody">Absolutely beautiful!
<br/>
<br/>
Thanks for that wintermute, like you said, it runs perfectly on Hardware, but a bit dodgy in Dualis, but I can live without that.
<br/>
<br/>
Cheers,
<br/>
Jess.<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="font-weight: bold">Nintendo DS &amp; Dominos :: <a class="postlink" href="http://dsdominos.sourceforge.net" target="_blank">DS Dominos</a></span>
<br/>
<a class="postlink" href="http://jt0.org" target="_blank">http://jt0.org</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117530 - MrD - Mon Feb 05, 2007 12:29 pm</h4>
    <div class="postbody"><span class="postbody">Have you tried it under no$, Jess?<br/>_________________<br/>Not active on this forum. For Lemmings DS help see its website.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117540 - JessTicular - Mon Feb 05, 2007 2:23 pm</h4>
    <div class="postbody"><span class="postbody">Yep, No$GBA 2.3 runs the rom just fine.
<br/>
<br/>
DeSmuME 0.4.0 runs it, but with some quirks (almost identical to Dualis used to).
<br/>
<br/>
Dualis 20.3 crashes still.
<br/>
<br/>
DSEmu 0.4.10 crashes.
<br/>
<br/>
iDeaS 1008c crashes.
<br/>
<br/>
And, Hardware runs it like it should.
<br/>
<br/>
:)
<br/>
<br/>
[EDIT]
<br/>
To clarify, I made the u32 change in libnds
<br/>
[/EDIT]<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="font-weight: bold">Nintendo DS &amp; Dominos :: <a class="postlink" href="http://dsdominos.sourceforge.net" target="_blank">DS Dominos</a></span>
<br/>
<a class="postlink" href="http://jt0.org" target="_blank">http://jt0.org</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117621 - Normmatt - Tue Feb 06, 2007 1:28 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>JessTicular wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
DeSmuME 0.4.0 runs it, but with some quirks (almost identical to Dualis used to).
<br/>
[/EDIT]</td> </tr></table><span class="postbody">
<br/>
<br/>
Why are you running such an OLD version of DeSmuME, the latest is v0.6.0 and has many many improvements over 0.4.0</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117640 - JessTicular - Tue Feb 06, 2007 8:25 am</h4>
    <div class="postbody"><span class="postbody">Because on <a class="postlink" href="http://www.desmume.com/" target="_blank">http://www.desmume.com/</a>, the latest version available is 0.4.0, is there anywhere else I should be looking for it?<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="font-weight: bold">Nintendo DS &amp; Dominos :: <a class="postlink" href="http://dsdominos.sourceforge.net" target="_blank">DS Dominos</a></span>
<br/>
<a class="postlink" href="http://jt0.org" target="_blank">http://jt0.org</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117643 - Firon - Tue Feb 06, 2007 8:33 am</h4>
    <div class="postbody"><span class="postbody"><a href="http://desmume.sourceforge.net/" target="_blank">http://desmume.sourceforge.net/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117646 - JessTicular - Tue Feb 06, 2007 9:27 am</h4>
    <div class="postbody"><span class="postbody">Cheers,
<br/>
<br/>
But 0.6.0 runs with almost identical quirks :P
<br/>
The main one being that it doesn't display Sprites properly.<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="font-weight: bold">Nintendo DS &amp; Dominos :: <a class="postlink" href="http://dsdominos.sourceforge.net" target="_blank">DS Dominos</a></span>
<br/>
<a class="postlink" href="http://jt0.org" target="_blank">http://jt0.org</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117658 - nio101 - Tue Feb 06, 2007 11:34 am</h4>
    <div class="postbody"><span class="postbody">Hello,
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
You can fix this by changing the parameter type of irqEnable in the libnds headers to u32 - this is what's being done in CVS currently, cast the parameter ( won't work when you update libnds again) or just enable the interrupts separately.</td> </tr></table><span class="postbody">
<br/>
<br/>
I've been looking at <a class="postlink" href="http://devkitpro.cvs.sourceforge.net/devkitpro/libnds/include/nds/" target="_blank">http://devkitpro.cvs.sourceforge.net/devkitpro/libnds/include/nds/</a>, but I couldn't find any fixed header...
<br/>
<br/>
Could you explain how to get the last cvs update, please ?
<br/>
<br/>
My combined .cpp project doesn't work anymore on dualis/desmume (no more stylus, quirks...)...
<br/>
<br/>
I need the dir functions provided by the last libfat working with r20, but I need my ROM to work on emulators too (can't debug code only on hardware).
<br/>
<br/>
As to you, will there be any lib fixes in the future, or will the emulators be updated for us to have a completed devkit/emulator toolchain ?
<br/>
<br/>
I need to take a decision to know if I have to come back to r19 and try some "dirent.h" solution...
<br/>
<br/>
Thanks for your answers...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117660 - JessTicular - Tue Feb 06, 2007 1:04 pm</h4>
    <div class="postbody"><span class="postbody"><a class="postlink" href="http://devkitpro.cvs.sourceforge.net/devkitpro/libnds/include/nds/interrupts.h?view=log" target="_blank">http://devkitpro.cvs.sourceforge.net/devkitpro/libnds/include/nds/interrupts.h?view=log</a>
<br/>
That's the latest version of the file you need to grab.
<br/>
<br/>
But, you can do it yourself - Simply change <span style="font-style: italic">irqEnable(IRQ_MASK irq)</span> in interrupts.h to <span style="font-style: italic">irqEnable(uint32 irq)</span><br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="font-weight: bold">Nintendo DS &amp; Dominos :: <a class="postlink" href="http://dsdominos.sourceforge.net" target="_blank">DS Dominos</a></span>
<br/>
<a class="postlink" href="http://jt0.org" target="_blank">http://jt0.org</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117666 - nio101 - Tue Feb 06, 2007 2:08 pm</h4>
    <div class="postbody"><span class="postbody">Thanks...
<br/>
<br/>
But even with this fix, I still have my problems with emulators and r20 :
<br/>
<br/>
Dualis : No more stylus...
<br/>
desmume 0.6 : Stylus OK, but totally bugged extended background...
<br/>
No$Gba : Stylus and ext. background OK, but no FAT emu (!)
<br/>
<br/>
Dualis doesn't seem to be updated anymore, but desmume is... I'll go and see if ext. background bugs are about to be fixed...?
<br/>
<br/>
Thanks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117668 - Mighty Max - Tue Feb 06, 2007 2:24 pm</h4>
    <div class="postbody"><span class="postbody">We (the desmume cvs team) are allways happy to receive example homebrew nds files (good if sourcecode is included) which show how hardware acts different then the emulator.
<br/>
<br/>
This way we can properly locate a bug/missing feature and fix the issue.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117669 - JessTicular - Tue Feb 06, 2007 2:32 pm</h4>
    <div class="postbody"><span class="postbody">nio101,
<br/>
<br/>
It's not surprising that the emulators are broken after such a large and new update has been released.
<br/>
<br/>
But, thankfully, we have developers like Mighty Max here who are trying to keep on top of things and make sure they work with all the latest binaries :)<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="font-weight: bold">Nintendo DS &amp; Dominos :: <a class="postlink" href="http://dsdominos.sourceforge.net" target="_blank">DS Dominos</a></span>
<br/>
<a class="postlink" href="http://jt0.org" target="_blank">http://jt0.org</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117704 - GPFerror - Tue Feb 06, 2007 7:40 pm</h4>
    <div class="postbody"><span class="postbody">use FCSR images appended to the .ds.gba, works in desmume and no$gba and probably a couple more emulators.
<br/>
<br/>
libfat has never worked for me in dualis, as soon as fatInitDefault() is called, dualis closes on me.
<br/>
<br/>
Troy(GPF)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117721 - nio101 - Tue Feb 06, 2007 10:44 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">We (the desmume cvs team) are allways happy to receive example homebrew nds files (good if sourcecode is included) which show how hardware acts different then the emulator.
<br/>
<br/>
This way we can properly locate a bug/missing feature and fix the issue.</td> </tr></table><span class="postbody">
<br/>
<br/>
Great!
<br/>
<br/>
I'll then clean my code to keep only what's problematic, and I soon as I can, I'll post some example along with r20 sourcecode on <a href="http://desmume.sourceforge.net/forums/..." target="_blank">http://desmume.sourceforge.net/forums/...</a>
<br/>
<br/>
Greetings !</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117778 - nio101 - Wed Feb 07, 2007 10:35 am</h4>
    <div class="postbody"><span class="postbody">Hello, the extended background example is there :
<br/>
<a class="postlink" href="http://sourceforge.net/project/showfiles.php?group_id=186024&amp;package_id=220479&amp;release_id=484529" target="_blank">http://sourceforge.net/project/showfiles.php?group_id=186024&amp;package_id=220479&amp;release_id=484529</a>
<br/>
<br/>
The relevant post is on <a class="postlink" href="http://desmume.sourceforge.net/forums/index.php?action=vthread&amp;forum=1&amp;topic=137" target="_blank">http://desmume.sourceforge.net/forums/index.php?action=vthread&amp;forum=1&amp;topic=137</a>
<br/>
<br/>
Thanks for your help!
<br/>
<br/>
EDIT : my MAIN_BG3 is defined as a BG_BMP8_512x512 background in the source code, but seems to be seen as a 1024x1024 background by Desmume (as stated in the Map Viewer)...
<br/>
It could expain why this particular background is not drawn correctly ?</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
