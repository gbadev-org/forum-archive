<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>3D and WiFi not happy together - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > 3D and WiFi not happy together</h2>
<div id="posts">
<div class="post">
    <h4>#140570 - Schmedly - Mon Sep 17, 2007 6:50 pm</h4>
    <div class="postbody"><span class="postbody">Okay, I'm still fairly new to the DS homebrew scene, but up to now I've had good luck. I have ported a skeleton of my 3D game which works fine on it's own, and I've also had no problems working with the small WiFi example. But, after using the WiFi template and adding my 3D source to the arm9 project, I no longer get any updates on the top screen (the 3D portion). The bottom screen still shows all my debug info and the frame counter, just no 3D  on the top screen.
<br/>
<br/>
NetworkInit() contains the same code as the WiFi sample (works fine and connects to AP) but does not call irqInit().
<br/>
<br/>
RenderInit() just does a bit of graphics setup.
<br/>
<br/>
RenderScene() does all the major drawing, and works perfectly in a project without the WiFi code.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int main()
<br/>
{   
<br/>
   videoSetMode(MODE_0_3D);
<br/>
   videoSetModeSub(MODE_0_2D | DISPLAY_BG0_ACTIVE);
<br/>
   vramSetMainBanks(VRAM_A_TEXTURE_SLOT0, VRAM_B_LCD, VRAM_C_LCD, VRAM_D_LCD);
<br/>
   vramSetBankC(VRAM_C_SUB_BG);
<br/>
   
<br/>
   SUB_BG0_CR = BG_MAP_BASE(31);
<br/>
   BG_PALETTE_SUB[255] = RGB15(31,31,31);
<br/>
<br/>
   consoleInitDefault((u16*)SCREEN_BASE_BLOCK_SUB(31), (u16*)CHAR_BASE_BLOCK_SUB(0), 16);
<br/>
<br/>
   iprintf("DemoApp\n");
<br/>
<br/>
   irqInit();
<br/>
   irqSet(IRQ_VBLANK, Vblank);
<br/>
   irqEnable(IRQ_VBLANK);
<br/>
<br/>
   NetworkInit();
<br/>
<br/>
   RenderInit();
<br/>
<br/>
   while (!quit) 
<br/>
   {
<br/>
      scanKeys();
<br/>
      keys = keysHeld();
<br/>
<br/>
      if((keys &amp; KEY_START)) quit = true;
<br/>
<br/>
      if((keys &amp; KEY_UP)) camera.Translate( Math::Vec3( 0.0f, 0.0f, -0.1f) );
<br/>
      if((keys &amp; KEY_DOWN)) camera.Translate( Math::Vec3( 0.0f, 0.0f, 0.1f) );
<br/>
      if((keys &amp; KEY_LEFT)) camera.MoveRight( -0.1f );
<br/>
      if((keys &amp; KEY_RIGHT)) camera.MoveRight( 0.1f );
<br/>
<br/>
      keys = keysDown();
<br/>
      if((keys &amp; KEY_SELECT))
<br/>
      {
<br/>
         mode++;
<br/>
         if( mode &gt; 1 )
<br/>
            mode = 0;
<br/>
      }
<br/>
<br/>
      if((keys &amp; KEY_X))
<br/>
      {
<br/>
         int numAP = Wifi_GetNumAP();
<br/>
<br/>
         if( numAP &gt; 0 )
<br/>
         {
<br/>
            iprintf("\x1b[10;0HAccess Points\n");
<br/>
            for( int i = 0; i &lt; numAP; ++i )
<br/>
            {
<br/>
               Wifi_AccessPoint myAP;
<br/>
               Wifi_GetAPData(i, &amp;myAP);
<br/>
               iprintf("%d:%s\n", i, myAP.ssid);
<br/>
            }
<br/>
         }
<br/>
      }
<br/>
<br/>
      touchXY=touchReadXY();
<br/>
<br/>
      Math::Vec3 camX( camera.frame.m[0], camera.frame.m[1], camera.frame.m[2] );
<br/>
      Math::Vec3 camY( camera.frame.m[4], camera.frame.m[5], camera.frame.m[6] );
<br/>
      Math::Vec3 camZ( camera.frame.m[8], camera.frame.m[9], camera.frame.m[10] );
<br/>
      Math::Vec3 camT( camera.frame.m[12], camera.frame.m[13], camera.frame.m[14] );
<br/>
<br/>
      Math::Vec3 lookAt = camT - camZ;
<br/>
<br/>
//      printf("\x1b[2;0HCamT:  %1.4f %1.4f %1.4f", camT.x, camT.y, camT.z);
<br/>
//      printf("\x1b[3;0HCamZ:  %1.4f %1.4f %1.4f", camZ.x, camZ.y, camZ.z);
<br/>
//      printf("\x1b[4;0HLook: %1.4f %1.4f %1.4f", lookAt.x, lookAt.y, lookAt.z);
<br/>
<br/>
      iprintf("\x1b[16;0HFrame = %d",frame);
<br/>
      iprintf("\x1b[17;0HTouch x = %04X, %04X\n", touchXY.x, touchXY.px);
<br/>
      iprintf("Touch y = %04X, %04X\n", touchXY.y, touchXY.py);   
<br/>
<br/>
      RenderScene();
<br/>
<br/>
      swiWaitForVBlank();
<br/>
   }
<br/>
   
<br/>
   return 0;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">[/code]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#140577 - josath - Mon Sep 17, 2007 9:23 pm</h4>
    <div class="postbody"><span class="postbody">Are you sure the wifi is causing the problem? does your 3d code work if you comment out the wifi commands?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#140593 - Schmedly - Mon Sep 17, 2007 11:59 pm</h4>
    <div class="postbody"><span class="postbody">If I comment out the WiFi calls it still doesn't produce any 3D. However, the 3D code works perfectly in a project that doesn't use any arm7 code. That's the main difference.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
