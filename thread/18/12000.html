<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Subpixel drawing - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Subpixel drawing</h2>
<div id="posts">
<div class="post">
    <h4>#112932 - Lazy1 - Thu Dec 21, 2006 6:49 pm</h4>
    <div class="postbody"><span class="postbody">I'm not sure if I understand it correctly, but I think it has to do with setting each pixels RGB intensity to act as 3 pixels.
<br/>
If that is true, would that give me a 1bit display size of 768x192?
<br/>
<br/>
That would be a good addition to Mini vMac DS since the entire width of the screen could be seen at once, that is if it would be bearable to look at.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112934 - Mighty Max - Thu Dec 21, 2006 7:25 pm</h4>
    <div class="postbody"><span class="postbody">Subpixel, does make use of the physical layout of the colors on the display.
<br/>
<br/>
From what i have observed by the different subpixelfont using apps, there is a big problem: There are different displays build into the different DSes, meaning a subpixel setup that works on one, doesnt work on the next.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112935 - Lazy1 - Thu Dec 21, 2006 7:36 pm</h4>
    <div class="postbody"><span class="postbody">Yeah, I heard that too - I think it's the later model fat DS and the DS Lite only.
<br/>
I guess a config option could be added to set the screen type, unless the display type can be detected.
<br/>
<br/>
One problem I see is that I use an 8bit indexed mode to display the screen currently, this is easy since all I need to do is lookup the 8 pixel byte into an array and get 2 u32s which I write to vram.
<br/>
<br/>
It would basically need to be roughly the same way since that method already takes 2ms and it's already capped out at 16fps under full load.
<br/>
Or maybe the cost of a larger display area is worth the cost of some performance.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112940 - tepples - Thu Dec 21, 2006 8:33 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">From what i have observed by the different subpixelfont using apps, there is a big problem: There are different displays build into the different DSes, meaning a subpixel setup that works on one, doesnt work on the next.</td> </tr></table><span class="postbody">
<br/>
And they're an R/B palette swap away from being universal, right?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112944 - Mighty Max - Thu Dec 21, 2006 8:50 pm</h4>
    <div class="postbody"><span class="postbody">I havent looked into it exactly. But the physical layout of pixels does not have to be a plain line RGB or BGR, do they?
<br/>
<br/>
A display might have the subpixels grouped in a quad:
<br/>
BG
<br/>
RB
<br/>
<br/>
That would render it impossible to get a horizontal resolution of 3*pixel<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112948 - Payk - Thu Dec 21, 2006 11:03 pm</h4>
    <div class="postbody"><span class="postbody">Could it also be ordered like a triangle?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112950 - simonjhall - Thu Dec 21, 2006 11:08 pm</h4>
    <div class="postbody"><span class="postbody">On cameras it's more like RGGB (I think it's RG on one row, then GB on another) due to the sensitivity of the eye to green. Have a look at bayer patterns on wikipedia. Dunno if the DS screen mimics this pattern.<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112953 - HyperHacker - Thu Dec 21, 2006 11:31 pm</h4>
    <div class="postbody"><span class="postbody">I've heard that it's possible on the DS just as it was on the GBA, but some older Phats use a different order for the bottom screen than for the top; newer ones and Lites use the same order as the older ones' top for both.
<br/>
<br/>
Subpixel rendering can sort of boost your horizontal resolution, but only for black and white images. Indeed it involves colour manipulation to make each pixel's R, B and G components act alone to form 1/3-pixel dots instead of entire pixels, but since they can only be one colour and are so small, they're of no real use for coloured images.
<br/>
<br/>
Windows XP's font rendering has Cleartype for LCDs which is subpixel rendering. Try it out and see what a difference it makes. I'd imagine just about every other OS with a GUI does too, assuming it's been updated since LCDs became popular.
<br/>
<br/>
Oh, and though it's not an issue on the DS, this has another advantage - on CRTs, there are no subpixels to manipulate, but you still end up with a nice antialiasing effect. Not as pretty as subpixels, but prettier than no antialiasing at all.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112964 - DekuTree64 - Fri Dec 22, 2006 12:32 am</h4>
    <div class="postbody"><span class="postbody">I seriously doubt that nintendo would ever use an LCD with entirely different subpixel arrangements, and a BGR/RGB switch should be fine for an emulator.
<br/>
<br/>
Check out the <a class="postlink" href="http://deku.gbadev.org/program/eternity-source.zip" target="_blank">source</a> from my <a class="postlink" href="http://deku.gbadev.org/program/eternity.zip" target="_blank">eternity demo</a> for some pretty fast subpixel rendering. Most of it is in SubPx.c, and the 1-bit to 8-bit render loop is in Math.s (search for RenderSubPx, and yes, it has nothing to do with math and I should be shot for putting everything in that one file).<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112965 - Lazy1 - Fri Dec 22, 2006 1:00 am</h4>
    <div class="postbody"><span class="postbody">I took a look in that file and I'll be honest and say I have no idea what is going on.
<br/>
I have enough asm knowledge to _maybe_ convert a small C function, but I cannot read it and understand what it's doing.
<br/>
<br/>
I keep trying to read that PDF on arm assembly, but I never remember to do it or I get bored half way through :/</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112967 - Lick - Fri Dec 22, 2006 1:07 am</h4>
    <div class="postbody"><span class="postbody">Deku, that's an awesome demo. @_@<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112975 - Lazy1 - Fri Dec 22, 2006 2:06 am</h4>
    <div class="postbody"><span class="postbody">My current drawing code is fairly simple, room for optimization but 2ms is fine for what it's doing (at least for now ).
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
__attribute__( ( section( ".itcm" ), long_call ) ) LOCALPROC HaveChangedScreenBuff(si4b top, si4b left, si4b bottom, si4b right)
<br/>
{
<br/>
   u8* octpix = ( u8* ) screencomparebuff;
<br/>
   u32* vram = ( u32* ) BG_GFX;
<br/>
   static int st = 0;
<br/>
   static int i = 0;
<br/>
<br/>
   //st = ( TIMER1_DATA + gTimerBaseMS );
<br/>
<br/>
   /*
<br/>
    * TODO:
<br/>
    * Rewrite, it's just too hacky.
<br/>
    */
<br/>
   for ( i = 0; i &lt; vMacScreenNumBytes; i++ ) {
<br/>
      *vram++ = OneToEightTable[ *octpix ][ 0 ];
<br/>
      *vram++ = OneToEightTable[ *octpix++ ][ 1 ];
<br/>
   }
<br/>
<br/>
   //UnusedParam(top);
<br/>
   //UnusedParam(left);
<br/>
   //UnusedParam(bottom);
<br/>
   //UnusedParam(right);
<br/>
<br/>
   //iprintf( "HaveChangedScreenBuff( ) took %d ms\n", ( ( TIMER1_DATA + gTimerBaseMS ) - st ) );
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I can't use a 16bit mode since all my vram is tied up with the 512x512 background.
<br/>
I thought of a few ways, but the pixels never line up properly to work in a LUT.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113001 - DekuTree64 - Fri Dec 22, 2006 8:08 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lazy1 wrote:</b></span></td> </tr> <tr> <td class="quote">I took a look in that file and I'll be honest and say I have no idea what is going on.</td> </tr></table><span class="postbody">
<br/>
Heh, it took me a few minutes to figure out what was happening, and I wrote it... But here's how it works. 
<br/>
<br/>
It's actually running in mode0, using 4-bit tiles, not mode4 as I previously thought. Around line 243 of SubPx.c, it generates a table used during the conversion from 1-bit to 4-bit. You index into the table with a 12 bit value (12 sub-pixels) to get a u16 (4 4-bit pixels).
<br/>
<br/>
The render loop converts 24 sub-pixels into 8 4-bit pixels per pass (one row of a tile). The conversion is actually done in 2 12-bit chunks, which are then ORed together and stored as a single u32.
<br/>
<br/>
The logic is basically: load 3 bytes from the sub-pixel buffer and OR each of them into a register, then convert the lower 24 bits of that register to 4-bit pixels and store them, then shift the register value down by 24 bits (retaining the upper byte for the next iteration).
<br/>
<br/>
Now that I think about it though, the shifting down part is kind of a waste of time if you're loading 3 bytes individually each iteration anyway. But if you unroll it 4 times, then I think you could load a u32 at a time which would be a lot faster.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lick wrote:</b></span></td> </tr> <tr> <td class="quote">Deku, that's an awesome demo. @_@</td> </tr></table><span class="postbody">
<br/>
Thanks :) Those were good times. One of these days I'll scrounge up enough free time to do some demo effects on the DS. Lots of fun new hardware and raw horsepower to play with compared to GBA.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113089 - Lazy1 - Fri Dec 22, 2006 10:48 pm</h4>
    <div class="postbody"><span class="postbody">I see, so I need to generate a 12bit LUT and use a 16 color mode to write the subpixels?
<br/>
<br/>
I think I understand, I'm not sure about writing to vram in tiled mode though.
<br/>
Do I treat vram as a linear framebuffer and setup the map a certain way to display the tiles in order?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113616 - Nintendo Maniac 64 - Fri Dec 29, 2006 5:45 am</h4>
    <div class="postbody"><span class="postbody">I'm not sure if this was ever answered, let alone if it even matters, but here...
<br/>
<br/>
Most DS phats have pixel arrangements of RGB on the top and BGR on bottom.
<br/>
<br/>
DS Lites have BGR on both screens.
<br/>
<br/>
The DS phats that have BGR on both screens probably have the "upgraded Lite screens", noting that Lites also have the BGR arrangement.  From this, we can assume they are the same ones that can use variable brightness settings with a hacked firmware, like how Lites do it naturally.  I believe these are DS phats that originally had firmware version 5.
<br/>
<br/>
NOTE: refirbished DS's usually have firmware upgrades to the newest version.  Such as my refurbished blue DS phat.  It had firmware version 5, yet I didn't have the variable brightness setting.  I believe my DS's firmware was originally a version 4 because I don't believe there were any version 3 phats that were blue.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117244 - Lazy1 - Fri Feb 02, 2007 8:29 pm</h4>
    <div class="postbody"><span class="postbody">Well, yesterday I tried to get subpixel drawing into Mini vMac without much luck.
<br/>
The result I got was a small screen of about half the DS's screen size repeated three times horizontally.
<br/>
Even still, each one was fairly readable but still broken.
<br/>
<br/>
Is there a way to do this sort of thing that I'm missing?
<br/>
Sorry for the lack of code since I deleted it, but I can always try writing it again.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117252 - DekuTree64 - Fri Feb 02, 2007 9:22 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lazy1 wrote:</b></span></td> </tr> <tr> <td class="quote">The result I got was a small screen of about half the DS's screen size repeated three times horizontally.</td> </tr></table><span class="postbody">
<br/>
Probably related to the fact that you're essentially tripling your horizontal resolution. If you're using the 1-bit backbuffer style, make sure the buffer is 3x the actual screen width.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117253 - Lazy1 - Fri Feb 02, 2007 9:24 pm</h4>
    <div class="postbody"><span class="postbody">Well, the emulated screen size is 512x342 if that means anything.
<br/>
Another issue someone brought up in IRC was that it may cause things to look stretched, is that true?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117254 - tepples - Fri Feb 02, 2007 9:24 pm</h4>
    <div class="postbody"><span class="postbody">Or use orange and blue as the primitives in your scaling algorithm.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117255 - Lazy1 - Fri Feb 02, 2007 9:25 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Or use orange and blue as the primitives in your scaling algorithm.</td> </tr></table><span class="postbody">
<br/>
<br/>
I don't have a scaling algorithm, or the cpu cycles to implement one.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
