<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Alpha blending quads - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Alpha blending quads</h2>
<div id="posts">
<div class="post">
    <h4>#171933 - headspin - Sun Jan 03, 2010 8:04 am</h4>
    <div class="postbody"><span class="postbody">How can you alpha blend a quad?
<br/>
<br/>
Turn on blend with glEnable(GL_BLEND); but there seems to be no glBlendFunc(). How is it done on the DS?<br/>_________________<br/><a class="postlink" href="http://headsoft.com.au/index.php?category=warhawk" target="_blank">Warhawk DS</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=mmll" target="_blank">Manic Miner: The Lost Levels</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=tdg" target="_blank">The Detective Game</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171935 - DiscoStew - Sun Jan 03, 2010 10:01 am</h4>
    <div class="postbody"><span class="postbody"><a href="http://nocash.emubase.de/gbatek.htm#ds3dpolygonattributes" target="_blank">http://nocash.emubase.de/gbatek.htm#ds3dpolygonattributes</a>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">40004A4h - Cmd 29h - POLYGON_ATTR - Set Polygon Attributes (W)
<br/>
<br/>
  0-3   Light 0..3 Enable Flags (each bit: 0=Disable, 1=Enable)
<br/>
  4-5   Polygon Mode  (0=Modulation,1=Decal,2=Toon/Highlight Shading,3=Shadow)
<br/>
  6     Polygon Back Surface   (0=Hide, 1=Render)  ;Line-segments are always
<br/>
  7     Polygon Front Surface  (0=Hide, 1=Render)  ;rendered (no front/back)
<br/>
  8-10  Not used
<br/>
  11    Depth-value for Translucent Polygons  (0=Keep Old, 1=Set New Depth)
<br/>
  12    Far-plane intersecting polygons       (0=Hide, 1=Render/clipped)
<br/>
  13    1-Dot polygons behind DISP_1DOT_DEPTH (0=Hide, 1=Render)
<br/>
  14    Depth Test, Draw Pixels with Depth    (0=Less, 1=Equal) (usually 0)
<br/>
  15    Fog Enable                            (0=Disable, 1=Enable)
<br/>
  16-20 Alpha      (0=Wire-Frame, 1..30=Translucent, 31=Solid)
<br/>
  21-23 Not used
<br/>
  24-29 Polygon ID (00h..3Fh, used for translucent, shadow, and edge-marking)
<br/>
  30-31 Not used
<br/>
<br/>
Writes to POLYGON_ATTR have no effect until next BEGIN_VTXS command.
<br/>
Changes to the Light bits have no effect until lighting is re-calculated by Normal command. The interior of Wire-frame polygons is transparent (Alpha=0), and only the lines at the polygon edges are rendered, using a fixed Alpha value of 31.</td> </tr></table><span class="postbody">
<br/>
<br/>
With using glPolyFmt() in libnds, use the inline function POLY_ALPHA() with a value between and including 0 and 31, and combine it will your other values. 0 means it will display the wireframe, but if you want it completely invisible, just don't draw the poly.<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171936 - headspin - Sun Jan 03, 2010 10:47 am</h4>
    <div class="postbody"><span class="postbody">Thanks I did try that but it didn't seem to work.. turns out you need to set glPolyFmt(POLY_ALPHA(n)); before calling glBegin(GL_QUAD);<br/>_________________<br/><a class="postlink" href="http://headsoft.com.au/index.php?category=warhawk" target="_blank">Warhawk DS</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=mmll" target="_blank">Manic Miner: The Lost Levels</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=tdg" target="_blank">The Detective Game</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171944 - DiscoStew - Sun Jan 03, 2010 8:02 pm</h4>
    <div class="postbody"><span class="postbody">Yes, it is required to be done before your glBegin call (or maybe you can do it between complete polys if you aren't changing with glBegin?). Were you attempting to change the alpha value at each vertex? If so, then expect disappointment, as it can't be done that way. The poly format is designed to affect the entire poly, not just parts of it.
<br/>
<br/>
If you still wanted to try per vertex alpha blending, you could try with textures.
<br/>
<br/>
<a href="http://nocash.emubase.de/gbatek.htm#ds3dtextureformats" target="_blank">http://nocash.emubase.de/gbatek.htm#ds3dtextureformats</a>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">Format 1: A3I5 Translucent Texture (3bit Alpha, 5bit Color Index)
<br/>
Each Texel occupies 8bit, the 1st Texel is located in 1st byte.
<br/>
<br/>
  Bit0-4: Color Index (0..31) of a 32-color Palette
<br/>
  Bit5-7: Alpha       (0..7; 0=Transparent, 7=Solid)
<br/>
<br/>
The 3bit Alpha value (0..7) is internally expanded into a 5bit Alpha value (0..31) as follows: Alpha=(Alpha*4)+(Alpha/2).
<br/>
<br/>
Format 6: A5I3 Translucent Texture (5bit Alpha, 3bit Color Index)
<br/>
Each Texel occupies 8bit, the 1st Texel is located in 1st byte.
<br/>
<br/>
  Bit0-2: Color Index (0..7) of a 8-color Palette
<br/>
  Bit3-7: Alpha       (0..31; 0=Transparent, 31=Solid)
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
You become limited to the number of colors for the texture when you incorporate the inclusion of an alpha value with these formats. With glTexImage2d() or glTexParameter() in libnds, you use the enum GL_RGB32_A3 or GL_RGB8_A5 to specify which format to use.<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171977 - headspin - Wed Jan 06, 2010 1:33 pm</h4>
    <div class="postbody"><span class="postbody">Okay I spoke too soon, this method doesn't seem to work on hardware. No alpha fading at all. It works in No$ though.
<br/>
<br/>
Here is how I'm doing it
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">glBindTexture(...);
<br/>
glColorTable(...);
<br/>
<br/>
// Set color to blue
<br/>
glColor3b(0, 0, 255);
<br/>
<br/>
for (...)
<br/>
{
<br/>
   glPolyFmt(POLY_ALPHA(...));
<br/>
<br/>
   glBegin(GL_QUAD);
<br/>
   
<br/>
   glPushMatrix();
<br/>
   
<br/>
   drawQuad(...);
<br/>
   
<br/>
   glPopMatrix(1);
<br/>
<br/>
   glEnd();
<br/>
}
<br/>
<br/>
// Set color back to white
<br/>
glColor3b(255, 255, 255);
<br/>
<br/>
glPolyFmt(POLY_ALPHA(31));</td> </tr></table><span class="postbody">
<br/>
<br/>
I'm sure it's something to do with the order or something like that?<br/>_________________<br/><a class="postlink" href="http://headsoft.com.au/index.php?category=warhawk" target="_blank">Warhawk DS</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=mmll" target="_blank">Manic Miner: The Lost Levels</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=tdg" target="_blank">The Detective Game</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171984 - ritz - Wed Jan 06, 2010 5:50 pm</h4>
    <div class="postbody"><span class="postbody">I have a feeling you may need to use POLY_ID() in your glPolyFmt() calls. Also, where is your glFlush()? Maybe it's a sorting issue... try diff params in your glFlush() call.
<br/>
<br/>
Just some thoughts.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171987 - headspin - Wed Jan 06, 2010 8:19 pm</h4>
    <div class="postbody"><span class="postbody">Thanks ritz I needed to turn on GL_BLEND using glEnable() and also use POLY_ID() to set the a unique Id for each quad I wanted a different alpha value.<br/>_________________<br/><a class="postlink" href="http://headsoft.com.au/index.php?category=warhawk" target="_blank">Warhawk DS</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=mmll" target="_blank">Manic Miner: The Lost Levels</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=tdg" target="_blank">The Detective Game</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
