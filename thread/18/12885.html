<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Bug in glGetFixed.... - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > Bug in glGetFixed....</h2>
<div id="posts">
<div class="post">
    <h4>#123950 - 3D_geek - Mon Apr 02, 2007 12:17 am</h4>
    <div class="postbody"><span class="postbody">In glGetFixed we have:
<br/>
<br/>
                case GL_GET_MATRIX_PROJECTION:
<br/>
                        glMatrixMode(GL_POSITION);
<br/>
                       .... 
<br/>
<br/>
and then:
<br/>
                case GL_GET_MATRIX_POSITION:
<br/>
                        glMatrixMode(GL_PROJECTION);
<br/>
                        ....
<br/>
<br/>
I kinda assume these are swapped!  I think there are other problems in that function also...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123969 - gabebear - Mon Apr 02, 2007 6:08 am</h4>
    <div class="postbody"><span class="postbody">Those parts of the function are correct, but there is one other big problem with that function; the clip matrix is named the modelview matrix. The position matrix is basically the equivalent of OpenGL's modelview.
<br/>
<br/>
I'm fixing this right now.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123970 - 3D_geek - Mon Apr 02, 2007 6:15 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>gabebear wrote:</b></span></td> </tr> <tr> <td class="quote">Those parts of the function are correct, but there is one other big problem with that function; the clip matrix is named the modelview matrix. The position matrix is basically the equivalent of OpenGL's modelview.
<br/>
<br/>
I'm fixing this right now.</td> </tr></table><span class="postbody">
<br/>
<br/>
The projection matrix gets the position matrix and the position matrix gets the projection...that's **RIGHT** !?!?   Surely not!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123971 - gabebear - Mon Apr 02, 2007 6:55 am</h4>
    <div class="postbody"><span class="postbody">I've been meaning to update the modelview name to clip. If you look at the function it makes sense; here is some of the code with updated names.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
case GL_GET_MATRIX_POSITION:
<br/>
   glMatrixMode(GL_PROJECTION);
<br/>
   glPushMatrix(); // save the current state of the projection matrix
<br/>
   glLoadIdentity(); // load a identity matrix into the projection matrix so that the clip matrix = position matrix
<br/>
   while(GFX_BUSY); // wait until the graphics engine has stopped to read matrixes
<br/>
   for(i = 0; i &lt; 16; i++) f[i] = MATRIX_READ_CLIP[i]; // read out the position matrix
<br/>
   glPopMatrix(1); // restore the projection matrix
<br/>
   break;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
The clip matrix is calculated by multiplying the projection matrix by the position matrix. If you want to read just one of these then you need to set the other matrix to identity.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#124044 - 3D_geek - Mon Apr 02, 2007 7:26 pm</h4>
    <div class="postbody"><span class="postbody">Ah - wait...I see the problem. It changes the glMatrixMode behind your back without restoring it...that's what's fscking me.  I was assuming it was giving me the wrong matrix - in fact it was leaving me altering the wrong matrix.
<br/>
<br/>
Mmm'K thanks!</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
