<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Boxtest x,y,z ?? (Solved, a bug in libnds?!!!) - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Boxtest x,y,z ?? (Solved, a bug in libnds?!!!)</h2>
<div id="posts">
<div class="post">
    <h4>#131121 - a128 - Mon Jun 11, 2007 10:22 am</h4>
    <div class="postbody"><span class="postbody">I have a question about the parameters for BoxTest (x,y,z,.....)
<br/>
<br/>
could it be that x,y,z is just the center of the box?
<br/>
<br/>
and that width and height and depth
<br/>
<br/>
is somethink like width= (abs(xmin)+abs(xmax) ) / 2?
<br/>
<br/>
The boxtest example in libnds just calculates boxtest using boxtest(xmin,ymin,zmin.....) but do not use it for culling tests.
<br/>
<br/>
I just ask because it's common for culling boxtests that you define the Center and the Size from that center point.</span><span class="gensmall"><br/><br/>Last edited by a128 on Mon Jun 18, 2007 8:05 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#131206 - a128 - Tue Jun 12, 2007 7:47 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>a128 wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<br/>
could it be that x,y,z is just the center of the box?
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
of course it must be positionX,positionY,positionZ 
<br/>
<br/>
so Width = Size/2
<br/>
<br/>
I will test that</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#131216 - a128 - Tue Jun 12, 2007 1:48 pm</h4>
    <div class="postbody"><span class="postbody">I calculate the Boxtest parameters 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
<br/>
x=MinX+PositionX
<br/>
y=....
<br/>
z=....
<br/>
 
<br/>
width=ABS(minX)+ABS(maxX)
<br/>
height=ABS(minY)+ABS(maxY)
<br/>
depth= same for Z
<br/>
    
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
it seems to work fine (NOTE: days later it turns out that this does not wokr at all)
<br/>
<br/>
x,y,z are  the position of the cube in view coords...but relative to the minima of the bounding box</span><span class="gensmall"><br/><br/>Last edited by a128 on Fri Jun 15, 2007 1:18 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#131231 - memoni - Tue Jun 12, 2007 7:43 pm</h4>
    <div class="postbody"><span class="postbody">I think your width calculation is not right. Try this instead:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">width = maxX - minX;</td> </tr></table><span class="postbody">
<br/>
<br/>
I wonder how you got that abs there. If you want half width, then divide by 2 :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#131267 - a128 - Wed Jun 13, 2007 10:56 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>memoni wrote:</b></span></td> </tr> <tr> <td class="quote">I think your width calculation is not right. Try this instead:
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">width = maxX - minX;</td> </tr></table><span class="postbody">
<br/>
<br/>
I wonder how you got that abs there. If you want half width, then divide by 2 :)</span></td> </tr></table><span class="postbody">
<br/>
<br/>
oh yes sure thats correct
<br/>
<br/>
my brain is dead :-)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#131425 - a128 - Fri Jun 15, 2007 1:18 pm</h4>
    <div class="postbody"><span class="postbody">this Boxtest(x,y,z,width,height,depth) method drives me insane
<br/>
<br/>
does anyone used this for culling?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#131633 - a128 - Mon Jun 18, 2007 8:05 am</h4>
    <div class="postbody"><span class="postbody">I guess now I have a working BoxTest
<br/>
<br/>
1) There is a bug in libnds
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
//---------------------------------------------------------------------------------
<br/>
int BoxTest(v16 x, v16 y, v16 z, v16 height, v16 width, v16 depth)
<br/>
//---------------------------------------------------------------------------------
<br/>
{
<br/>
  glPolyFmt(BIT(12) | BIT(13));
<br/>
  glBegin(GL_TRIANGLES);
<br/>
  glEnd();
<br/>
<br/>
  GFX_BOX_TEST = VERTEX_PACK(x, y);
<br/>
  GFX_BOX_TEST = VERTEX_PACK(z, height);
<br/>
  GFX_BOX_TEST = VERTEX_PACK(width, depth);
<br/>
<br/>
  while(GFX_STATUS &amp; BIT(0));
<br/>
<br/>
  return (GFX_STATUS &amp; BIT(1));
<br/>
}
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
should be regarding 
<br/>
<br/>
<a class="postlink" href="http://nocash.emubase.de/gbatek.htm#ds3dtests" target="_blank">http://nocash.emubase.de/gbatek.htm#ds3dtests</a>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
//---------------------------------------------------------------------------------
<br/>
int BoxTest(v16 x, v16 y, v16 z, v16 width, v16 height, v16 depth) //CHANGED
<br/>
//---------------------------------------------------------------------------------
<br/>
{
<br/>
  glPolyFmt(BIT(12) | BIT(13));
<br/>
  glBegin(GL_TRIANGLES);
<br/>
  glEnd();
<br/>
<br/>
  GFX_BOX_TEST = VERTEX_PACK(x, y);
<br/>
  GFX_BOX_TEST = VERTEX_PACK(z, width); //CHANGED
<br/>
  GFX_BOX_TEST = VERTEX_PACK(height, depth); //CHANGED
<br/>
<br/>
  while(GFX_STATUS &amp; BIT(0));
<br/>
<br/>
  return (GFX_STATUS &amp; BIT(1));
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
This seems to work fine.
<br/>
<br/>
---------
<br/>
2)  My models was scaled so they fit -7.99f.....7.99ff which is fine for that v16 fixpoint type
<br/>
<br/>
Since width,height,depht is also a v16 type this parameters must  not exceed 7.99 either.....so I scaled my model to 7.99f*0.5 so width,height,deepth is max. 7.99ff
<br/>
<br/>
now the boxtest works fine</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#131641 - a128 - Mon Jun 18, 2007 3:56 pm</h4>
    <div class="postbody"><span class="postbody">This is how I do the BoxTest ..even with modles bigger then +-7.99f
<br/>
<br/>
<br/>
1) Calc the min,max from the verticies
<br/>
2) Calc the scale and scale the model so the max vert is 7.99f/2
<br/>
and the max. size is 7.99f (important for BoxTest) 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code"> static const float BASE = 7.99f/2.0f;
<br/>
        // Set vertices to [(-BASE,-BASE,-BASE);(BASE,BASE,BASE)]
<br/>
       
<br/>
<br/>
       float scalex = (ABS(maxX) &gt; ABS(minX)) ? ABS(maxX) : ABS(minX) ; 
<br/>
<br/>
    float scaley = (ABS(maxY) &gt; ABS(minY)) ? ABS(maxY) : ABS(minY) ;
<br/>
<br/>
    float scalez = (ABS(maxZ) &gt; ABS(minZ)) ? ABS(maxZ) : ABS(minZ) ; 
<br/>
<br/>
<br/>
        float sc = MAX(MAX(scalex, scaley), scalez) / BASE;
<br/>
<br/>
        scale[nr]=sc;
<br/>
<br/>
   v = ob-&gt;vertices;
<br/>
<br/>
        for ( i = 0; i &lt; ob-&gt;num_vert; i++, v++) {
<br/>
<br/>
            float x = v-&gt;x;
<br/>
            float y = v-&gt;y;
<br/>
            float z = v-&gt;z;
<br/>
<br/>
            v-&gt;x = (x) / sc;
<br/>
            v-&gt;y = (y) / sc;
<br/>
            v-&gt;z = (z) / sc;
<br/>
<br/>
        }
<br/>
        
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
while Rendering I do
<br/>
<br/>
glTranslate(position of the model in world coords)
<br/>
glScale(scale)
<br/>
<br/>
x=minX/scale
<br/>
y=minY/scale
<br/>
z=minZ/scale
<br/>
<br/>
width=(maxX-minX)/scale
<br/>
height=(maxY-minY)/scale
<br/>
depth=(maxZ-minZ)/scale
<br/>
<br/>
//These paramters does not exceed 7.99f!!!!!!!
<br/>
if(BoxTest(x,y,z,width,height,depth)){
<br/>
<br/>
draw the model
<br/>
<br/>
}</span><span class="gensmall"><br/><br/>Last edited by a128 on Tue Jul 03, 2007 8:25 am; edited 2 times in total</span></div>    
</div>
<div class="post">
    <h4>#131656 - gabebear - Mon Jun 18, 2007 9:42 pm</h4>
    <div class="postbody"><span class="postbody">Cool, I'll add this to the list of stuff to fix. It's nice when it's an easy fix like this.
<br/>
<br/>
I started a new job and haven't had time for much else... sorry for the lack of progress on bugs lately.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#131953 - wintermute - Thu Jun 21, 2007 4:03 pm</h4>
    <div class="postbody"><span class="postbody">I can throw this one into CVS if you don't have the time to deal with it atm.
<br/>
<br/>
I'm hoping to roll another stable libnds fairly soon when I finalise devkitARM r21 so I'd like to make sure everything works as it should.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#134282 - a128 - Thu Jul 12, 2007 8:12 am</h4>
    <div class="postbody"><span class="postbody">this is still broken in libnds?!</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
