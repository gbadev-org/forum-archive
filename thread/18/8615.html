<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>int32 & Math coprocessor - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > int32 & Math coprocessor</h2>
<div id="posts">
<div class="post">
    <h4>#72280 - ishraam - Fri Feb 17, 2006 9:33 am</h4>
    <div class="postbody"><span class="postbody">I just went over &lt;math.h&gt; again, and, once again, saw the "div32(...)", "mod32(...)", "div64(...)", "mod64(...)", "sqrt32(...)" functions.
<br/>
<br/>
Since &lt;jtypes.h&gt; told me int32 is a signed int, I was wondering what was the difference between using a common 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
int div = 1223 / 333;
<br/>
</td> </tr></table><span class="postbody">
<br/>
and
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
int32 div = div32(1223,333);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Is the second version ("div32")  optimized (using the math coprocessor)? And the first version ("/") not ? (using the ARM x processor)?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#72321 - dovoto - Fri Feb 17, 2006 5:42 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ishraam wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Is the second version ("div32")  optimized (using the math coprocessor)? And the first version ("/") not ? (using the ARM x processor)?</td> </tr></table><span class="postbody">
<br/>
<br/>
That is correct.  Wintermute has "/' tied to the bios software divide routine on the arm7 and arm9 (i believe) so the only way to get hardware divide at the moment is to do it explicitly by invoking the math coprocessor (with div32 for instance).
<br/>
<br/>
Why he has not altered the arm9 "/" to use the hardware I am not certain but I am sure there is a good reason (it may just be a pain to implement it one way on the arm7 and another on the arm9).<br/>_________________<br/><a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#72336 - sajiimori - Fri Feb 17, 2006 7:47 pm</h4>
    <div class="postbody"><span class="postbody">Invoking the coprocessor involves changing its state, so it might be a little scary to have a seemingly innocent operator like / produce subtle side-effects that can break threaded code.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#72338 - dovoto - Fri Feb 17, 2006 7:56 pm</h4>
    <div class="postbody"><span class="postbody">eww...threaded code ;)<br/>_________________<br/><a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#72341 - DekuTree64 - Fri Feb 17, 2006 8:13 pm</h4>
    <div class="postbody"><span class="postbody">Normal interrupts too.
<br/>
<br/>
Just be sure you save the divider/square root regs at the start of your handler if you plan to use them, and set them back before you return.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#72386 - ishraam - Sat Feb 18, 2006 4:29 am</h4>
    <div class="postbody"><span class="postbody"><span style="font-weight: bold">dovoto </span>: 
<br/>
Ok, thanks :).
<br/>
<br/>
<span style="font-weight: bold">sajiimori </span>:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">produce subtle side-effects that can break threaded code</td> </tr></table><span class="postbody">
<br/>
Aww yeah right. 
<br/>
<br/>
But when you talk about threads, there's one thing that pops in my mind : <span style="font-weight: bold">mutex</span>. 
<br/>
They are usually together, but I can't remember having seen someone talking about mutex. Are there somewhere hidden in the dark or have I missed something ?
<br/>
<br/>
<span style="font-weight: bold">DekuTree64</span>:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">save the divider/square root regs at the start of your handler if you plan to use them, and set them back before you return.</td> </tr></table><span class="postbody">
<br/>
Ok thanks a lot. I will give this a try sooner or later. I'll keep focused on 3D for a little while, but will test it for sure.
<br/>
<br/>
It would be nice to have perf. comparison tests, between "float" and 'f32", and int's div32, etc and "normal" /, etc.
<br/>
I'll try to take some time for this.
<br/>
<br/>
BTW : are there any time() function or something that would help me in recording perf.?</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
