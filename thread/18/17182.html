<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>NDS and Zlib - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > NDS and Zlib</h2>
<div id="posts">
<div class="post">
    <h4>#173230 - Gryphon93 - Sun Mar 28, 2010 12:02 pm</h4>
    <div class="postbody"><span class="postbody">(Gulp... First post here...)
<br/>
<br/>
Hello, everyone! I wonder if anyone could tell me how to use the zlib in my DS projects. I want to compress some data in my app, but I don't know how to use zlib, especially when it's not a DLL (I've worked with the zlib-DLL earlier). I found the NDSZlib <a class="postlink" href="http://gpf.dcemu.co.uk/ndsSDL.shtml" target="_blank">here</a> and I guess it's that one I'm supposed to use. (Or can I use zlib from zlib.net directly?) I appreciate all your help! Thanks in advance!
<br/>
<br/>
PS. I've run make install, so it's installed .DS
<br/>
<br/>
Edit. Are there any devkitARM examples that uses zlib (or any other examples for the NDS)?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#173243 - wintermute - Sun Mar 28, 2010 8:48 pm</h4>
    <div class="postbody"><span class="postbody">It's probably best if you remove that zlib from your libnds directory, devkitARM has moved on quite considerably since those archives were put together.
<br/>
<br/>
Many libraries, like zlib, are in fact completely hardware independent and devkitARM is useful for any platform running on ARM processors. There's a brief explanation of building and installing normal autotools based libraries at <a href="http://wiki.devkitpro.org/index.php/portlibs" target="_blank">http://wiki.devkitpro.org/index.php/portlibs</a> which also links to the prebuilt archives hosted on sourceforge.
<br/>
<br/>
Using zlib on the DS is essentially identical to using it on any other platform although you'll obviously need to use libfat for file access.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#173280 - Gryphon93 - Mon Mar 29, 2010 7:13 pm</h4>
    <div class="postbody"><span class="postbody">Thanks. I'll remove the library I installed and follow your instructions. I want to use zlib to compress data in the memory, so I won't need libfat. The examples I've found only show how to compress files though, and I would like examples on how to compress data directly from the memory. It was a while since I used zlib, so I'm a bit rusty. Oh, I forgot to say that I used zlib for another language than C/C++, but I can't remember what language. So, this is something new I have to learn. All help is appreciated! (Learning how to use libraries aren't usually that hard though)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#173293 - sverx - Tue Mar 30, 2010 9:03 am</h4>
    <div class="postbody"><span class="postbody">check <a class="postlink" href="http://www.zlib.net/manual.html#Utility" target="_blank">compress()</a> :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#173298 - Gryphon93 - Tue Mar 30, 2010 7:29 pm</h4>
    <div class="postbody"><span class="postbody">Thanks a lot sverx, I'll try it out right away!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#173302 - headspin - Tue Mar 30, 2010 8:16 pm</h4>
    <div class="postbody"><span class="postbody">Here's a function I wrote for TDG
<br/>
<br/>
EDIT: Sorry didn't realize you wanted to _compress_ data in memory.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int decompressFileBuffer(const char *fileName, char *pBuffer, int bufferLen)
<br/>
{
<br/>
   FILE *pFile;
<br/>
   struct stat fileStat;
<br/>
   size_t result;
<br/>
<br/>
   pFile = fopen(fileName, "rb");
<br/>
   
<br/>
   if(pFile == NULL)
<br/>
      return 0;
<br/>
<br/>
   if(stat(fileName, &amp;fileStat) != 0)
<br/>
   {
<br/>
      fclose(pFile);
<br/>
      return 0;
<br/>
   }
<br/>
   
<br/>
   void *pZLibBuffer = malloc(fileStat.st_size);
<br/>
   
<br/>
   if(pZLibBuffer == NULL)
<br/>
   {
<br/>
      fclose(pFile);
<br/>
      return 0;
<br/>
   }
<br/>
<br/>
   result = fread(pZLibBuffer, 1, fileStat.st_size, pFile);
<br/>
   
<br/>
   if(result != (uint) fileStat.st_size)
<br/>
   {
<br/>
      free(pZLibBuffer);
<br/>
      fclose(pFile);
<br/>
      return 0;
<br/>
   }
<br/>
   
<br/>
   uLongf unCompSize = bufferLen;
<br/>
   uncompress((Bytef*)pBuffer, &amp;unCompSize, (const Bytef*) pZLibBuffer, fileStat.st_size);
<br/>
<br/>
   free(pZLibBuffer);
<br/>
   fclose(pFile);
<br/>
   
<br/>
   return result;
<br/>
}</td> </tr></table><span class="postbody"><br/>_________________<br/><a class="postlink" href="http://headsoft.com.au/index.php?category=warhawk" target="_blank">Warhawk DS</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=mmll" target="_blank">Manic Miner: The Lost Levels</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=tdg" target="_blank">The Detective Game</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#173303 - Gryphon93 - Tue Mar 30, 2010 8:34 pm</h4>
    <div class="postbody"><span class="postbody">No worries, headspin. It's a great example and I want to say thank you for it! It's nice and I may have use of it later on.
<br/>
<br/>
Edit:
<br/>
What am I supposed to write in the Makefile to include zlib? I've tried this
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#---------------------------------------------------------------------------------
<br/>
# any extra libraries we wish to link with the project
<br/>
#---------------------------------------------------------------------------------
<br/>
LIBS   := -libz -lnds9
<br/>
 
<br/>
 
<br/>
#---------------------------------------------------------------------------------
<br/>
# list of directories containing libraries, this must be the top level containing
<br/>
# include and lib
<br/>
#---------------------------------------------------------------------------------
<br/>
LIBDIRS   :=   $(PORTLIBS) $(LIBNDS)
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
But it doesn't work. The compiler says that it can't find libz. I can change it to something else, like libza, or something, and of course it doesn't work, but I can still compile the program just fine, without errors. Please help.
<br/>
<br/>
I downloaded the portlib from sourceforge and followed the instructions in the wiki as well as I could (like putting the library inside $(DEVKITPRO)/portlibs/arm/. I haven't used Makefiles before, so I'm not sure on how to do this.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#173313 - Sektor - Wed Mar 31, 2010 4:10 am</h4>
    <div class="postbody"><span class="postbody">LIBS	:= -lnds9 -lz<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><a class="postlink" href="http://gtamp.com/DS" target="_blank">GTAMP.com/DS</a></span></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
