<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Question about file system - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Question about file system</h2>
<div id="posts">
<div class="post">
    <h4>#90345 - wickedtrickster - Thu Jun 29, 2006 8:32 pm</h4>
    <div class="postbody"><span class="postbody">Hello,
<br/>
<br/>
I am trying to do a simple file system; I could use one of the current lib available, but the purpose is mainly for learning :)
<br/>
<br/>
From what I've read on DSTEK, the cartridge data is map from 0x08000000 to 0x09FFFFFF. So if I append data at the end of my .nds file, I should be able to retreive it at location 0x08000000 + .nds size - 0x200 (512 bytes header size). This works great on DUALIS, but doesn't work at all on my Nintendo DS. I did a small app which scan all memory between 0x08000000 and 0x09FFFFFF, on my DS it is full of 0 (zero).
<br/>
<br/>
I also took a look at the gbfs code. which scan the same memory address than my test, plus somewhere at the beginning of the 4M main memory (which I don't fully understand where it starts, and why it search there...).
<br/>
<br/>
I also look at chishm's fat librairy, but this isn't really what I want since I want the file system to also run on a gba card ! :)
<br/>
<br/>
Well I'm confused; any help on this topic would be greatly appreciated ! :)
<br/>
<br/>
Thank you,
<br/>
Ben.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#90348 - sniper - Thu Jun 29, 2006 8:43 pm</h4>
    <div class="postbody"><span class="postbody">You must set the bus master using:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">sysSetCartOwner( BUS_OWNER_ARM9 ); </td> </tr></table><span class="postbody">
<br/>
<br/>
Then the cartridge should be mapped in address space
<br/>
Some emulators handles the default bus master not correctly. So if you do not set this, it will work with the emulator but not with real hardware.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#90355 - wickedtrickster - Thu Jun 29, 2006 9:13 pm</h4>
    <div class="postbody"><span class="postbody">I'll try this :) Thanks for the answer !
<br/>
<br/>
EDIT: (Works great !)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#90381 - josath - Fri Jun 30, 2006 12:48 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wickedtrickster wrote:</b></span></td> </tr> <tr> <td class="quote"> plus somewhere at the beginning of the 4M main memory (which I don't fully understand where it starts, and why it search there...)</td> </tr></table><span class="postbody">
<br/>
<br/>
It scans there, because you can include the gbfs actually INSIDE the .nds, as opposed to appended. In this case, the gbfs would be loaded into RAM.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#90430 - chishm - Fri Jun 30, 2006 6:22 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wickedtrickster wrote:</b></span></td> </tr> <tr> <td class="quote">I also look at chishm's fat librairy, but this isn't really what I want since I want the file system to also run on a gba card ! :)</td> </tr></table><span class="postbody">
<br/>
Look harder, particularly at the FCSR driver. Even if you don't use it, it will give some hints for using a GBA cart.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#91139 - wickedtrickster - Tue Jul 04, 2006 8:50 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>josath wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wickedtrickster wrote:</b></span></td> </tr> <tr> <td class="quote"> plus somewhere at the beginning of the 4M main memory (which I don't fully understand where it starts, and why it search there...)</td> </tr></table><span class="postbody">
<br/>
<br/>
It scans there, because you can include the gbfs actually INSIDE the .nds, as opposed to appended. In this case, the gbfs would be loaded into RAM.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
I see, thanks for the clarification.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wickedtrickster wrote:</b></span></td> </tr> <tr> <td class="quote">I also look at chishm's fat librairy, but this isn't really what I want since I want the file system to also run on a gba card ! :)</td> </tr></table><span class="postbody">
<br/>
Look harder, particularly at the FCSR driver. Even if you don't use it, it will give some hints for using a GBA cart.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Ok, I will take a look at it. Seems like I have much more to learns.... :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#91165 - tepples - Wed Jul 05, 2006 12:43 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>josath wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wickedtrickster wrote:</b></span></td> </tr> <tr> <td class="quote"> plus somewhere at the beginning of the 4M main memory (which I don't fully understand where it starts, and why it search there...)</td> </tr></table><span class="postbody">
<br/>
It scans there, because you can include the gbfs actually INSIDE the .nds, as opposed to appended. In this case, the gbfs would be loaded into RAM.</span></td> </tr></table><span class="postbody">
<br/>
Actually, if you include the GBFS into the binary using bin2s, you <span style="font-style: italic">don't</span> use find_first_gbfs_file(). Instead, you use the symbol that bin2s provides, which by default is the filename with identifier-illegal characters replaced with underscores:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">extern const GBFS_FILE samples_gbfs;Â  // for file "samples.gbfs"</td> </tr></table><span class="postbody">
<br/>
The real reason that find_first_gbfs_file() scans the first 256 KB of EWRAM is that the library was originally developed for use with the GBA, where both ROM programs (like ds.gba) and multiboot programs (like .nds) used appending and find_first_gbfs_file(). In the case of a Nintendo DS program where you are sure that it is running from GBA ROM address space (as a ds.gba or a SuperCard .nds), you should skip the RAM search entirely by starting the search at the base of ROM space:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">find_first_gbfs_file((const void *)0x08000000)</td> </tr></table><span class="postbody"><br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
