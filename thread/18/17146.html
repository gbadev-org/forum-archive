<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Exit to Menu / Return to Firmware - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > Exit to Menu / Return to Firmware</h2>
<div id="posts">
<div class="post">
    <h4>#172916 - Stephanie - Thu Mar 11, 2010 4:25 pm</h4>
    <div class="postbody"><span class="postbody">I'm trying to make my homebrew programs return to the firmware menu in a simple and elegant way.
<br/>
<br/>
I've read with great interest through the information about HBMenu, and that works very well, in that I can test to see if the exit to menu function exists (if bootcode-&gt;bootsig != 0) then I can call exit(0) and that works perfectly.
<br/>
<br/>
When there is no exit to menu though, I want to be able to load &amp; execute the appropriate firmware file... for example I use an acekard so I want my program to be able to load/execute fat0:/akmenu4.nds
<br/>
<br/>
I've been able to use the directory example to learn how to scan the card's root directory, so I can look for the appropriate firmware files, but I don't know how to actually load or execute them. I know it can be done as I've seen other homebrews do this - like gbexploader, run it then hit B to cancel and it loads the firmware menu.
<br/>
<br/>
So I can figure out what is the correct file to return to the firmware, I just can't figure out what I need to do, to load/execute the desired file.
<br/>
<br/>
Is there a tutorial, or an example, on how to load&amp;run an NDS from within another NDS?
<br/>
<br/>
Thanks!
<br/>
<br/>
-Stephanie</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172917 - wintermute - Thu Mar 11, 2010 4:47 pm</h4>
    <div class="postbody"><span class="postbody">Don't test, just exit. We need to force the issue with card manufacturers rather than continue to implement workarounds. The signature stuff is intended only for use of launchers, not user code. I'm looking into a reset to DS firmware when the boot signature isn't present, not quite sure if that's possible yet.
<br/>
<br/>
AKAIO should support the exit to menu feature soon, Normmatt is also looking at pulling out the GUI for use with hbmenu.
<br/>
<br/>
The Homebrew Menu already does what you want.
<br/>
<br/>
PS: I'm off out to buy an LED to replace the bulb and switch in my fridge :p<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172918 - Stephanie - Thu Mar 11, 2010 5:30 pm</h4>
    <div class="postbody"><span class="postbody">Hi <span style="font-weight: bold">wintermute</span>, thanks for the super-quick response!
<br/>
<br/>
I've tried just using exit(0) but when the appropriate code isn't there, it just hangs. If nothing else I'd rather power off the DS than have it hang...
<br/>
<br/>
Thanks again!
<br/>
<br/>
-Stephanie</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172945 - sverx - Fri Mar 12, 2010 10:26 am</h4>
    <div class="postbody"><span class="postbody">I also think that turning off the DS would be a good idea if it's not possible to go back to the launcher... stating clearly in the homebrew webpage that the homebrew exits to the launcher if it's a good one and turns off the consolle if the launcher isn't a good one. With links to the good ones.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172984 - wintermute - Sun Mar 14, 2010 12:05 pm</h4>
    <div class="postbody"><span class="postbody">libnds 1.4.2 now powers off with no bootstub present. enjoy :)<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172985 - headspin - Sun Mar 14, 2010 12:12 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">AKAIO should support the exit to menu feature soon, Normmatt is also looking at pulling out the GUI for use with hbmenu.</td> </tr></table><span class="postbody">
<br/>
<br/>
If they add exit support to AKAIO and you put the GUI from AKAIO into hbmenu what will be the difference between the two?<br/>_________________<br/><a class="postlink" href="http://headsoft.com.au/index.php?category=warhawk" target="_blank">Warhawk DS</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=mmll" target="_blank">Manic Miner: The Lost Levels</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=tdg" target="_blank">The Detective Game</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172986 - vuurrobin - Sun Mar 14, 2010 12:31 pm</h4>
    <div class="postbody"><span class="postbody">AFAIK, AKAIO can play commersial games, and it only works on a few acecard flashcards. there are probably some more things different.<br/>_________________<br/>my blog:
<br/>
<a href="http://vuurrobin.100webcustomers.com/" target="_blank">http://vuurrobin.100webcustomers.com/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172987 - headspin - Sun Mar 14, 2010 12:33 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>vuurrobin wrote:</b></span></td> </tr> <tr> <td class="quote">AFAIK, AKAIO can play commersial games, and it only works on a few acecard flashcards. there are probably some more things different.</td> </tr></table><span class="postbody">
<br/>
<br/>
Do you think many people will use hbmenu if it doesn't support commercial games?<br/>_________________<br/><a class="postlink" href="http://headsoft.com.au/index.php?category=warhawk" target="_blank">Warhawk DS</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=mmll" target="_blank">Manic Miner: The Lost Levels</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=tdg" target="_blank">The Detective Game</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172989 - Stephanie - Sun Mar 14, 2010 4:04 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">libnds 1.4.2 now powers off with no bootstub present. enjoy :)</td> </tr></table><span class="postbody">
<br/>
<br/>
Sweet!  Thanks very much!
<br/>
<br/>
-Stephanie</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172990 - fincs - Sun Mar 14, 2010 4:58 pm</h4>
    <div class="postbody"><span class="postbody">I have found the following problems with the restart key combo (L+R+Sel+Start):
<br/>
If I'm using VRAM_C (consoleDemoInit) the background is cleared and it hangs.
<br/>
If no loader is present nothing happens. The latest version was supposed to power down the DS :\
<br/>
If none of the previous conditions are met it does return to the loader, but it takes around 10 seconds (the program meanwhile freezes).
<br/>
<br/>
All of this doesn't happen if I use exit() on the ARM9. Maybe there's a problem in the hook9from7 code?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172992 - wintermute - Sun Mar 14, 2010 8:48 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>headspin wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>vuurrobin wrote:</b></span></td> </tr> <tr> <td class="quote">AFAIK, AKAIO can play commersial games, and it only works on a few acecard flashcards. there are probably some more things different.</td> </tr></table><span class="postbody">
<br/>
<br/>
Do you think many people will use hbmenu if it doesn't support commercial games?</span></td> </tr></table><span class="postbody">
<br/>
<br/>
The basic point here is to encourage other card launchers to use the bootcode from hbmenu, extend hbmenu for their purposes, or add support for argv &amp; bootstub. Our launcher has no memory limits, provides a standard way to find the nds path and allows return to menu. 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>fincs wrote:</b></span></td> </tr> <tr> <td class="quote">I have found the following problems with the restart key combo (L+R+Sel+Start):
<br/>
If I'm using VRAM_C (consoleDemoInit) the background is cleared and it hangs.
<br/>
If no loader is present nothing happens. The latest version was supposed to power down the DS :\
<br/>
If none of the previous conditions are met it does return to the loader, but it takes around 10 seconds (the program meanwhile freezes).
<br/>
<br/>
All of this doesn't happen if I use exit() on the ARM9. Maybe there's a problem in the hook9from7 code?</td> </tr></table><span class="postbody">
<br/>
<br/>
Yeah sorry, I messed up the shutdown on the arm7 side, the delay is something peculiar I haven't figured out yet. Basically the arm9 needs to give VRAM &amp; slot1/slot2 access to the 7 which means that the 7 has to tell the 9 which then has to tell the 7, if that makes sense.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172993 - wintermute - Sun Mar 14, 2010 8:52 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Stephanie wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">libnds 1.4.2 now powers off with no bootstub present. enjoy :)</td> </tr></table><span class="postbody">
<br/>
<br/>
Sweet!  Thanks very much!
<br/>
<br/>
-Stephanie</span></td> </tr></table><span class="postbody">
<br/>
<br/>
And thank <span style="font-weight: bold">you</span>, much appreciated.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172994 - fincs - Sun Mar 14, 2010 8:57 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">Yeah sorry, I messed up the shutdown on the arm7 side, the delay is something peculiar I haven't figured out yet. Basically the arm9 needs to give VRAM &amp; slot1/slot2 access to the 7 which means that the 7 has to tell the 9 which then has to tell the 7, if that makes sense.</td> </tr></table><span class="postbody">
<br/>
Ok, I'll keep an eye on SVN.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172999 - elhobbs - Mon Mar 15, 2010 8:24 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">libnds 1.4.2 now powers off with no bootstub present. enjoy :)</td> </tr></table><span class="postbody">I think power off with a normal exit code is a good idea. however, under abnormal exit I think a hang is better solution. typically under an abnormal exit there is some sort of error code displayed. when the system shuts down it makes it hard to figure out what is going on. I could add a key press before calling exit... not sure how I feel about that though. any thoughts?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#173053 - wintermute - Thu Mar 18, 2010 12:53 am</h4>
    <div class="postbody"><span class="postbody">You'll like this, libnds 1.4.3 has a weak systemErrorExit function you can override in user code like this :-
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include &lt;nds.h&gt;
<br/>
#include &lt;stdio.h&gt;
<br/>
<br/>
void systemErrorExit(int rc) {
<br/>
   printf("exit with code %d\n",rc);
<br/>
<br/>
   while(1) {
<br/>
      swiWaitForVBlank();
<br/>
      scanKeys();
<br/>
      if (keysDown() &amp; KEY_A) break;
<br/>
   }
<br/>
   
<br/>
}
<br/>
<br/>
//---------------------------------------------------------------------------------
<br/>
int main(int argc, char **argv) {
<br/>
//---------------------------------------------------------------------------------
<br/>
   int i;
<br/>
<br/>
   consoleDemoInit();
<br/>
   
<br/>
   if ( argc == 0 ) {
<br/>
      printf("No arguments!\n");
<br/>
   } else {
<br/>
      for ( i = 0; i &lt; argc; i++) {
<br/>
         printf("arg %d, %s\n",i,argv[i]);
<br/>
      }
<br/>
   }
<br/>
   while(1) {
<br/>
      swiWaitForVBlank();
<br/>
      scanKeys();
<br/>
      if (keysDown() &amp; KEY_X) break;
<br/>
   }
<br/>
   return 42;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
exit(0) won't call the function &amp; it's a no op if you don't override it. This allows for setting up a console if you didn't do it in the main code or any other customisation you like.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#173055 - elhobbs - Thu Mar 18, 2010 2:28 am</h4>
    <div class="postbody"><span class="postbody">that works for me - thank you!</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
