<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>.nds vs libfat - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > .nds vs libfat</h2>
<div id="posts">
<div class="post">
    <h4>#148309 - iainprice - Fri Jan 04, 2008 3:35 pm</h4>
    <div class="postbody"><span class="postbody">I have a little program I am making.... it has md2 and bmp and pcx files.
<br/>
<br/>
I currrently use libfat and everything is happy. I wanted to link these files in so that it is easier to distribute but when I convert them to .bin and link into my .nds I run out of memory  :(
<br/>
<br/>
Is there a crafty way to link files into an .nds but without running out of memory?
<br/>
<br/>
Cheers.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#148311 - Bloodypriest - Fri Jan 04, 2008 3:50 pm</h4>
    <div class="postbody"><span class="postbody">Use <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=13195&amp;highlight=efs" target="_blank">EFS</a>. It allows you to put data files in the NitroFS portion of your .nds . Very easy to use.
<br/>
<br/>
Here's a wrapper function around EFS for file loading:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int LoadFile(char *fn,void **pbuf)
<br/>
{
<br/>
   EFS_FILE* file;
<br/>
<br/>
   file = EFS_fopen(fn);
<br/>
   if (file != 0) {
<br/>
      int psize = EFS_GetFileSize(file);
<br/>
      *pbuf = (void*)malloc(psize);
<br/>
<br/>
      EFS_fread(*pbuf, psize, 1, file);
<br/>
      EFS_fclose(file);
<br/>
<br/>
      return psize;
<br/>
   }
<br/>
<br/>
   *pbuf = 0;
<br/>
   return -1;
<br/>
</td> </tr></table><span class="postbody">
<br/>
Finally, you can also pre-convert your bmp and pcx files so you don't have to decode them every time you load them on the DS. Saves time.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#148353 - iainprice - Fri Jan 04, 2008 10:07 pm</h4>
    <div class="postbody"><span class="postbody">I have converted my program to use efs... looking good, but yes my bmp screens just take ages.... how can I convert them to open and display faster on efs?
<br/>
<br/>
Thanks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#148354 - Bloodypriest - Fri Jan 04, 2008 10:44 pm</h4>
    <div class="postbody"><span class="postbody">You could use gfx2gba or grit to convert them to tiles. The latter has less features but is more user-friendly. 
<br/>
<br/>
It would still be raw uncompressed bitmap data but it would save you the bmp decoding step. Also you would benefit from the tile rendering capabilities of the hardware which is way faster than rendering pixel by pixel.
<br/>
<br/>
BTW, what color-depth are your graphics? If I'm right, your bmps are probably saved in true-color format (RGB24). Converting them to paletted format (either 16 or 256 color) would make them a lot smaller and faster to load (GIMP, Paintshop PRO and Photoshop might help here).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#148356 - iainprice - Fri Jan 04, 2008 11:07 pm</h4>
    <div class="postbody"><span class="postbody">They are 256 but if I convert them surely I then compile them in rather than loading using efs?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#148360 - wintermute - Fri Jan 04, 2008 11:33 pm</h4>
    <div class="postbody"><span class="postbody">No, you don't have to. You can use grit to convert to a tiled format and outpit binary then put that in your file system.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#148362 - iainprice - Fri Jan 04, 2008 11:36 pm</h4>
    <div class="postbody"><span class="postbody">Would it be best to use a command line in a batch file to convert using grit? I am looking at the example file for grit but cannot get it to work in my make file  :(
<br/>
<br/>
Are there any nice examples of pcx/bmp convert and load?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#148363 - Bloodypriest - Fri Jan 04, 2008 11:47 pm</h4>
    <div class="postbody"><span class="postbody">Never tried to use grit in a makefile. I did all my conversions on the command-line by referring to the examples in the TONC tutorial.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#148397 - iainprice - Sat Jan 05, 2008 11:04 am</h4>
    <div class="postbody"><span class="postbody">I have converted files using grit.exe and no parameters.
<br/>
<br/>
I have put them in the build directory for now, I'll worry about efs later.
<br/>
<br/>
I have the following code:
<br/>
<br/>
[code]
<br/>
#include "flames.h"
<br/>
<br/>
videoSetModeSub(MODE_5_2D | DISPLAY_BG3_ACTIVE);
<br/>
<br/>
SUB_BLEND_CR = BLEND_FADE_BLACK | BLEND_SRC_BG3 | BLEND_DST_BACKDROP; 	
<br/>
SUB_BG3_CR = BG_BMP8_256x256;
<br/>
SUB_BG3_XDX = 1 &lt;&lt; 8;
<br/>
SUB_BG3_XDY = 0;
<br/>
SUB_BG3_YDX = 0;
<br/>
SUB_BG3_YDY = 1 &lt;&lt; 8;
<br/>
SUB_BG3_CX = 0;
<br/>
SUB_BG3_CY = 0 &lt;&lt; 8;
<br/>
<br/>
dmaCopy(flamesTiles, BG_GFX_SUB, 256*192);
<br/>
dmaCopy(flamesPal, BG_PALETTE_SUB, 256*2);
<br/>
[/code]
<br/>
<br/>
but get rubbish on the screen?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#148434 - Bloodypriest - Sat Jan 05, 2008 6:11 pm</h4>
    <div class="postbody"><span class="postbody">SUB_BG3_CR = BG_BMP8_256x256; would be your problem. This puts your exrot background in bitmap mode. 
<br/>
<br/>
You need to either use a standard rotation background or setup your exrot bg in tiled mode, the latter option allowing you to use 16-bit map entries.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
