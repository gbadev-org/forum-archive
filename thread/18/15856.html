<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Filtering touch screen jumping - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Filtering touch screen jumping</h2>
<div id="posts">
<div class="post">
    <h4>#160793 - Thor - Tue Jul 22, 2008 4:42 pm</h4>
    <div class="postbody"><span class="postbody">I'm porting my Java program <a class="postlink" href="http://www.artgrounds.com/57096" target="_blank">Sketcher</a> to C++ on the NDS. I'm using libnds and I notice that the touch screen coordinates sometimes jump. I'm looking for some way of filtering them out. Does anyone have suggestions?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160796 - silent_code - Tue Jul 22, 2008 5:00 pm</h4>
    <div class="postbody"><span class="postbody">When touching very slightly, (pseudo) random values may be returned. Try to test for a pressure threshold. Remember that pressure is not an officially supported feature.
<br/>
<br/>
You could also measure the square distance between two points and then choose to skip the new point, if the distance is over a certain threshold.<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160822 - josath - Wed Jul 23, 2008 1:19 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>silent_code wrote:</b></span></td> </tr> <tr> <td class="quote">When touching very slightly, (pseudo) random values may be returned. Try to test for a pressure threshold. Remember that pressure is not an officially supported feature.
<br/>
</td> </tr></table><span class="postbody">
<br/>
It's not officially supported because different DS's report the pressure values differently, and there's no easy way to calibrate it. So even if it works fine on your (the coder's) DS, it may work very poorly on other people's
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">You could also measure the square distance between two points and then choose to skip the new point, if the distance is over a certain threshold.</td> </tr></table><span class="postbody">
<br/>
This is a bad idea for a drawing program...means you can't scribble quickly, eg while shading in an area.
<br/>
<br/>
Another option is to disregard the first touch position after the pen is put down, and then disregard the last touch position just before the pen is lifted. This will solve the problem 80%-90% of the time, in my experience. 
<br/>
<br/>
Might want to look into the source of the few drawing apps out there, to see if they've done anything in particular.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160848 - Thor - Wed Jul 23, 2008 3:58 pm</h4>
    <div class="postbody"><span class="postbody">I tried measuring the distance between points, and it -does- give me the problem of killing quick strokes.
<br/>
<br/>
Measuring the pressure was mentioned, so I tried this as well. I found that ordinary pressure values are quite far removed from the values you typically get when the cursor jumps. Whereas regular values lie approximately in the range of 80 - 130, cursor jumps are typically well above 340.
<br/>
<br/>
I still get jumps but they're minor compared to what I had before. I figure there must be a way to catch these, as they are very easy to spot. I am thinking about measuring acceleration. The jumps are impossibly fast and a human hand could never accelerate that quickly. 
<br/>
<br/>
Or perhaps I could pair the square distance measurement with the pressure threshold.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160852 - Lazy1 - Wed Jul 23, 2008 6:30 pm</h4>
    <div class="postbody"><span class="postbody">Measure the touchscreen over 8 frames, 99% of jitter problems fixed for me anyways.
<br/>
I can PM you some code showing how I do it, but it's pretty messy and could be done better.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160853 - Thor - Wed Jul 23, 2008 6:36 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lazy1 wrote:</b></span></td> </tr> <tr> <td class="quote">I can PM you some code showing how I do it, but it's pretty messy and could be done better.</td> </tr></table><span class="postbody">
<br/>
I'm interested. Perhaps it's better to just give an explanation than code?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160855 - josath - Wed Jul 23, 2008 6:40 pm</h4>
    <div class="postbody"><span class="postbody">Does that mean it introduces an 8-frame lag between touching the screen and it being input into the application? Sounds like it might be annoying for a drawing app.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160861 - Lazy1 - Wed Jul 23, 2008 6:55 pm</h4>
    <div class="postbody"><span class="postbody">It might, I didn't notice it though.
<br/>
<br/>
All you need is an array of the touch coordinates of the last 8 frames, then your final position is the average of those 8.
<br/>
It also helps do discard small jumps like those between 1 to 2 pixels.
<br/>
<br/>
When the pen is first put down set all the array elements to the current touch spot and when it goes up set them all to 0.
<br/>
<br/>
Worked fine for me, but a drawing app may be different.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160863 - Thor - Wed Jul 23, 2008 7:37 pm</h4>
    <div class="postbody"><span class="postbody">I have tested to measure acceleration and it removes almost all the jumps. I keep 2 previous touch screen points and there is no lag.
<br/>
<br/>
Next, I'll try to combine this with cutting off wildly high pressure values (like before). Perhaps that will clean up the rest.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160866 - DekuTree64 - Wed Jul 23, 2008 8:15 pm</h4>
    <div class="postbody"><span class="postbody">In <a class="postlink" href="http://deku.gbadev.org/program/animanatee-1_3b-src.zip" target="_blank">Animanatee</a> (Input.c), I use the current state and 2 previous frames to detect jumps, which causes a lag of one frame (it's treated more like the previous, current, and future next frame).
<br/>
<br/>
Basically it does 4 major things:
<br/>
1) It discards the first frame's position, unless the screen was only touched for one frame. First position is often wrong, but feels unresponsive if a quick tap is ignored entirely.
<br/>
2) If the touch screen is only released for one frame, the release is ignored (position for the missing frame is replaced by the midpoint of the previous and next frames). Happens when not pressing hard enough.
<br/>
3) If the position jumps 16 pixels to the edge of the screen, the position is discarded (replaced by midpoint again). You shouldn't normally be able to reach all the way to the edge anyway, and that's where most jumps go to.
<br/>
4) If the position jumps "out and back" by more than 16 pixels, the position is discarded. This mostly happens when drawing lines at medium speed and fairly low pressure, you get a little spike off the side sometimes.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160867 - Thor - Wed Jul 23, 2008 8:37 pm</h4>
    <div class="postbody"><span class="postbody">Okay. Now I'm using both pressure (&gt; 340) and square acceleration (&gt; 576) as indicators and I can't provoke any jumps anymore. Anyone else care to test on their DS? <a class="postlink" href="http://www.server1.no/SketcherDS.zip" target="_blank">Here</a> is what I have so far. Draw on the bottom screen. The top screen is unused. Clear with X.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160870 - DekuTree64 - Wed Jul 23, 2008 9:30 pm</h4>
    <div class="postbody"><span class="postbody">Works pretty good on my brick. I only got it to jump once out of a couple minutes of trying. I was scribbling with light pressure near the top left corner, and it jumped to maybe 30 pixels from the bottom (slightly angled line, not straight down).
<br/>
<br/>
You might want to put in the special case for quick taps that I mentioned though. It seems to take a couple frames before it registers a touch, so for example it's tough to draw a dotted line.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160875 - Thor - Wed Jul 23, 2008 10:39 pm</h4>
    <div class="postbody"><span class="postbody">I have a special case for taps but it's not working for some reason. I have to move my stylus one pixel before keysHeld() or readTouchX() register anything.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160882 - kusma - Wed Jul 23, 2008 11:32 pm</h4>
    <div class="postbody"><span class="postbody">Works more or less flawlessly here, great work.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
