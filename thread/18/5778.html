<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>No sound on DS, Help! - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > No sound on DS, Help!</h2>
<div id="posts">
<div class="post">
    <h4>#43278 - newbiecoders - Sat May 21, 2005 11:32 am</h4>
    <div class="postbody"><span class="postbody">Help! Can someone send me some source code in the template format for compiling in Win32 with sound. I have tried absolutely everything and on DS hardware (using Flashme) I just can't get anything to come out the speaker. I know it says to "play a wave file" etc but is that a .wav file converted to a .o file or what!? Also I am having problems using the multi loader, all I get is two blank screens. Please help!!!!</span><span class="gensmall"><br/><br/>Last edited by newbiecoders on Mon May 23, 2005 2:04 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#43385 - PhoenixSoft - Sun May 22, 2005 10:29 pm</h4>
    <div class="postbody"><span class="postbody">Notice that 200 people have read your thread without replying to it.  Is this because they don't know the answer?  No.  It is because you are being so rude about the question.  Maybe if you took out all of those !s someone would consider answering your question.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#43397 - Darkain - Mon May 23, 2005 1:44 am</h4>
    <div class="postbody"><span class="postbody">we'd also be more helpful if you posted in-topic threads, instead of starting new ones.  if you are having issues w/ the multi-loader, try DESCRIBING what the issue is, and posting it in the multi-loader thread.  i cant just read your mind to figure out whats wrong with it.  ;)<br/>_________________<br/>-=- Darkain Dragoon -=-
<br/>
<a class="postlink" href="http://www.darkain.com" target="_blank">http://www.darkain.com</a>
<br/>
<a class="postlink" href="http://ds.darkain.com/hack" target="_blank">DarkStar</a> for <a class="postlink" href="http://ds.darkain.com" target="_blank">Nintendo DS</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#43401 - newbiecoders - Mon May 23, 2005 2:07 am</h4>
    <div class="postbody"><span class="postbody">Sorry, my English is bad! I'm using a win32 environment and am unable to play sounds at all. If anyone could send me a template with just one sound in, that plays I would be really really grateful. Sorry if I came across as rude. I'm just really really frustrated by the sound not working. Its the only thing I need to do. Thanks in advance...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#43402 - Darkain - Mon May 23, 2005 2:10 am</h4>
    <div class="postbody"><span class="postbody">if you are using an emulator, that is probably your problem<br/>_________________<br/>-=- Darkain Dragoon -=-
<br/>
<a class="postlink" href="http://www.darkain.com" target="_blank">http://www.darkain.com</a>
<br/>
<a class="postlink" href="http://ds.darkain.com/hack" target="_blank">DarkStar</a> for <a class="postlink" href="http://ds.darkain.com" target="_blank">Nintendo DS</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#43404 - newbiecoders - Mon May 23, 2005 2:18 am</h4>
    <div class="postbody"><span class="postbody">Sorry no. I'm actually using flashme. I try and play a sound and there is total silence. Sorry to be vague:
<br/>
<br/>
This is the code used at the beginning in the arm7 directory main.c:
<br/>
<br/>
SOUND_CR = SCHANNEL_ENABLE | SOUND_VOL(0x3F) ;
<br/>
<br/>
<br/>
SCHANNEL_CR(0) = SOUND_ENABLE | SOUND_VOL(0x3F);
<br/>
SCHANNEL_TIMER(0) = SOUND_FREQ(22050);
<br/>
SCHANNEL_SOURCE(0) = (u32)GETRAW(ROCKHIT);
<br/>
SCHANNEL_LENGTH(0) = GETRAWSIZE(ROCKHIT) &gt;&gt; 2;
<br/>
<br/>
Regards[/code]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#43405 - Darkain - Mon May 23, 2005 2:22 am</h4>
    <div class="postbody"><span class="postbody">SCHANNEL_ENABLE and SOUND_ENABLE  are swapped<br/>_________________<br/>-=- Darkain Dragoon -=-
<br/>
<a class="postlink" href="http://www.darkain.com" target="_blank">http://www.darkain.com</a>
<br/>
<a class="postlink" href="http://ds.darkain.com/hack" target="_blank">DarkStar</a> for <a class="postlink" href="http://ds.darkain.com" target="_blank">Nintendo DS</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#43406 - newbiecoders - Mon May 23, 2005 2:44 am</h4>
    <div class="postbody"><span class="postbody">Sorry mate. Still not working! This is my arm7 main.c source though:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
//////////////////////////////////////////////////////////////////////
<br/>
// Simple ARM7 stub (sends RTC, TSC, and X/Y data to the ARM 9)
<br/>
// -- joat
<br/>
// -- modified by Darkain and others
<br/>
//////////////////////////////////////////////////////////////////////
<br/>
<br/>
#include &lt;NDS/NDS.h&gt;
<br/>
<br/>
#include &lt;NDS/ARM7/BIOS.h&gt;
<br/>
#include &lt;NDS/ARM7/touch.h&gt;
<br/>
#include &lt;NDS/ARM7/clock.h&gt;
<br/>
<br/>
#include "shine.h"
<br/>
<br/>
//////////////////////////////////////////////////////////////////////
<br/>
<br/>
<br/>
#define TOUCH_CAL_X1 (*(vs16*)0x027FFCD8)
<br/>
#define TOUCH_CAL_Y1 (*(vs16*)0x027FFCDA)
<br/>
#define TOUCH_CAL_X2 (*(vs16*)0x027FFCDE)
<br/>
#define TOUCH_CAL_Y2 (*(vs16*)0x027FFCE0)
<br/>
#define SCREEN_WIDTH    256
<br/>
#define SCREEN_HEIGHT   192
<br/>
s32 TOUCH_WIDTH  = TOUCH_CAL_X2 - TOUCH_CAL_X1;
<br/>
s32 TOUCH_HEIGHT = TOUCH_CAL_Y2 - TOUCH_CAL_Y1;
<br/>
s32 TOUCH_OFFSET_X = ( ((SCREEN_WIDTH -60) * TOUCH_CAL_X1) / TOUCH_WIDTH  ) - 28;
<br/>
s32 TOUCH_OFFSET_Y = ( ((SCREEN_HEIGHT-60) * TOUCH_CAL_Y1) / TOUCH_HEIGHT ) - 28;
<br/>
<br/>
<br/>
//////////////////////////////////////////////////////////////////////
<br/>
<br/>
<br/>
void startSound(int sampleRate, const void* data, uint32 bytes, u8 channel=0, u8 vol=0x7F,  u8 pan=63, u8 format=0) {
<br/>
  SCHANNEL_TIMER(channel)  = SOUND_FREQ(sampleRate);
<br/>
  SCHANNEL_SOURCE(channel) = (uint32)data;
<br/>
  SCHANNEL_LENGTH(channel) = bytes;
<br/>
  SCHANNEL_CR(channel)     = SOUND_ENABLE | SOUND_ONE_SHOT | SOUND_VOL(vol) | SOUND_PAN(pan) | (format==1?SOUND_8BIT:SOUND_16BIT);
<br/>
}
<br/>
<br/>
<br/>
s8 getFreeSoundChannel() {
<br/>
  for (int i=0; i&lt;16; i++) {
<br/>
    if ( (SCHANNEL_CR(i) &amp; SOUND_ENABLE) == 0 ) return i;
<br/>
  }
<br/>
  return -1;
<br/>
}
<br/>
<br/>
<br/>
//////////////////////////////////////////////////////////////////////
<br/>
<br/>
<br/>
void InterruptHandler(void) {
<br/>
  static int heartbeat = 0;
<br/>
<br/>
  if (IF &amp; IRQ_VBLANK) {
<br/>
    uint16 but=0, x=0, y=0, xpx=0, ypx=0, z1=0, z2=0, batt=0, aux=0;
<br/>
    int t1=0, t2=0;
<br/>
    uint32 temp=0;
<br/>
    uint8 ct[sizeof(IPC-&gt;curtime)];
<br/>
<br/>
<br/>
    // Update the heartbeat
<br/>
    heartbeat++;
<br/>
<br/>
    // Read the X/Y buttons and the /PENIRQ line
<br/>
    but = XKEYS;
<br/>
    if (!(but &amp; 0x40)) {
<br/>
      // Read the touch screen
<br/>
      x = touchRead(TSC_MEASURE_X);
<br/>
      y = touchRead(TSC_MEASURE_Y);
<br/>
      xpx = ( ((SCREEN_WIDTH -60) * x) / TOUCH_WIDTH  ) - TOUCH_OFFSET_X;
<br/>
      ypx = ( ((SCREEN_HEIGHT-60) * y) / TOUCH_HEIGHT ) - TOUCH_OFFSET_Y;
<br/>
      z1 = touchRead(TSC_MEASURE_Z1);
<br/>
      z2 = touchRead(TSC_MEASURE_Z2);
<br/>
    }
<br/>
<br/>
    batt = touchRead(TSC_MEASURE_BATTERY);
<br/>
    aux  = touchRead(TSC_MEASURE_AUX);
<br/>
<br/>
    // Read the time
<br/>
    rtcGetTime((uint8 *)ct);
<br/>
    BCDToInteger((uint8 *)&amp;(ct[1]), 7);
<br/>
<br/>
    // Read the temperature
<br/>
    temp = touchReadTemperature(&amp;t1, &amp;t2);
<br/>
<br/>
    // Update the IPC struct
<br/>
    IPC-&gt;heartbeat = heartbeat;
<br/>
    IPC-&gt;buttons   = but;
<br/>
    IPC-&gt;touchX    = x;
<br/>
    IPC-&gt;touchY    = y;
<br/>
    IPC-&gt;touchXpx  = xpx;
<br/>
    IPC-&gt;touchYpx  = ypx;
<br/>
    IPC-&gt;touchZ1   = z1;
<br/>
    IPC-&gt;touchZ2   = z2;
<br/>
    IPC-&gt;battery   = batt;
<br/>
    IPC-&gt;aux       = aux;
<br/>
<br/>
    for(u32 i=0; i&lt;sizeof(ct); i++) {
<br/>
      IPC-&gt;curtime[i] = ct[i];
<br/>
    }
<br/>
<br/>
    IPC-&gt;temperature = temp;
<br/>
    IPC-&gt;tdiode1 = t1;
<br/>
    IPC-&gt;tdiode2 = t2;
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
  }
<br/>
<br/>
  // Acknowledge interrupts
<br/>
  IF = IF;
<br/>
}
<br/>
<br/>
<br/>
//////////////////////////////////////////////////////////////////////
<br/>
void LoadBin(const void * src, uint32 dst, int size) {
<br/>
  uint32 * ram = (uint32 *)dst;
<br/>
  uint32 * rom = (uint32 *)src;
<br/>
  for (; size &gt; 0; size -= 4) { *ram++ = *rom++; }
<br/>
}
<br/>
<br/>
int main(int argc, char ** argv) {
<br/>
  // Reset the clock if needed
<br/>
  rtcReset();
<br/>
<br/>
<br/>
<br/>
<br/>
  IPC-&gt;soundData = 0;
<br/>
<br/>
  // Set up the interrupt handler
<br/>
  IME = 0;
<br/>
  IRQ_HANDLER = &amp;InterruptHandler;
<br/>
  IE = IRQ_VBLANK;
<br/>
  IF = ~0;
<br/>
  DISP_SR = DISP_VBLANK_IRQ;
<br/>
  IME = 1;
<br/>
<br/>
  //enable sound
<br/>
  powerON(POWER_SOUND);
<br/>
  SCHANNEL_CR(0) = SOUND_ENABLE | SOUND_ONE_SHOT | SOUND_VOL(0x7F) | SOUND_PAN(63) | SOUND_8BIT);
<br/>
<br/>
  SCHANNEL_CR(0) = SCHANNEL_ENABLE | SOUND_VOL(0x7F);
<br/>
  SCHANNEL_TIMER(0) = SOUND_FREQ(22050);
<br/>
  SCHANNEL_SOURCE(0) = (u32)GETRAW(shine);
<br/>
  SCHANNEL_LENGTH(0) = GETRAWSIZE(shine) &gt;&gt; 2;
<br/>
<br/>
<br/>
<br/>
<br/>
  // Keep the ARM7 out of main RAM
<br/>
  while (1) swiWaitForVBlank();
<br/>
  return 0;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
shine is a binary file from audio_sampler. Although I tried a PCM wave converted into a .o file earlier.
<br/>
<br/>
Thanks in advance.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#43409 - Darkain - Mon May 23, 2005 3:24 am</h4>
    <div class="postbody"><span class="postbody">you didnt enable the sound on the system before you started to play audio:
<br/>
<br/>
<br/>
SOUND_CR = SOUND_ENABLE | SOUND_VOL(0x7F);
<br/>
<br/>
<br/>
just shove this near the begining of your main function before you play any sounds.  you only gotta call this once.<br/>_________________<br/>-=- Darkain Dragoon -=-
<br/>
<a class="postlink" href="http://www.darkain.com" target="_blank">http://www.darkain.com</a>
<br/>
<a class="postlink" href="http://ds.darkain.com/hack" target="_blank">DarkStar</a> for <a class="postlink" href="http://ds.darkain.com" target="_blank">Nintendo DS</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#43785 - newbiecoders - Thu May 26, 2005 8:15 pm</h4>
    <div class="postbody"><span class="postbody">Thanks Darkain, you're a legend! I finally fixed the issue. One last thing. I'm using the audio_sample example and I don't know how to convert the wave files to the bin files that actually play through the DS (such as shine.bin etc). Now I have a wav file, what do I do with it to get it into the right format.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#43791 - Darkain - Thu May 26, 2005 8:27 pm</h4>
    <div class="postbody"><span class="postbody">i'm using WaveStudio, that allows me to save WAV(E) files as raw PCM data w/o their headers.  i'm not sure what everyone else is using.<br/>_________________<br/>-=- Darkain Dragoon -=-
<br/>
<a class="postlink" href="http://www.darkain.com" target="_blank">http://www.darkain.com</a>
<br/>
<a class="postlink" href="http://ds.darkain.com/hack" target="_blank">DarkStar</a> for <a class="postlink" href="http://ds.darkain.com" target="_blank">Nintendo DS</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#43797 - newbiecoders - Thu May 26, 2005 9:02 pm</h4>
    <div class="postbody"><span class="postbody">Sorry to be a pain in the arse, but the sound I convert to raw, unsigned 8bit in Soundforge is just giving a very short split second burst of incorrect sound. Plus the file I've converted does not look at all similar in textpad to the sound shine.bin, which looks like a hex/bin file. Thanks in advance.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#43801 - josath - Thu May 26, 2005 9:28 pm</h4>
    <div class="postbody"><span class="postbody">it's not gonna look the same in a text editor, they are both binary files not meant to be viewed as text. since they are raw, they should have no identifiable strings also.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#43804 - newbiecoders - Thu May 26, 2005 10:15 pm</h4>
    <div class="postbody"><span class="postbody">Fair enough but I think I'm ending up with the wrong converted file, i'd have thought soundforge would convert it right!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#43806 - doublec - Thu May 26, 2005 10:37 pm</h4>
    <div class="postbody"><span class="postbody">Try using Sox:
<br/>
<br/>
<a href="http://sox.sourceforge.net/" target="_blank">http://sox.sourceforge.net/</a>
<br/>
<br/>
The following should convert a wav file to raw format:
<br/>
<br/>
sox test.wav test.raw
<br/>
<br/>
Chris.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#43826 - tepples - Fri May 27, 2005 2:23 am</h4>
    <div class="postbody"><span class="postbody">But what kind of raw? Signed or unsigned? 8- or 16-bit? Linear PCM or IMA ADPCM or something proprietary?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#43828 - doublec - Fri May 27, 2005 2:28 am</h4>
    <div class="postbody"><span class="postbody">You can specify or it will base it on the input file. See here:
<br/>
<br/>
<a href="http://linuxcommand.org/man_pages/soxexam1.html" target="_blank">http://linuxcommand.org/man_pages/soxexam1.html</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#43829 - josath - Fri May 27, 2005 2:28 am</h4>
    <div class="postbody"><span class="postbody">try different ones until it works?
<br/>
what i know is you need standard plain raw mono linear pcm. as for 8bit vs 16bit, you can do either as long as you set the sound register correctly, and for sample rate, you can do any, again set the register correctly.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#43858 - newbiecoders - Fri May 27, 2005 10:55 am</h4>
    <div class="postbody"><span class="postbody">Thanks guys. Funnily enough, the format that converts straight to the right format is aiff! Waves were playing incorrectly and I found that the aiff files are perfect.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#43859 - Darkain - Fri May 27, 2005 10:56 am</h4>
    <div class="postbody"><span class="postbody">could be signed vs unsigned problem as well, and correct bit-depth... 2 most common problems ive seen.  :)<br/>_________________<br/>-=- Darkain Dragoon -=-
<br/>
<a class="postlink" href="http://www.darkain.com" target="_blank">http://www.darkain.com</a>
<br/>
<a class="postlink" href="http://ds.darkain.com/hack" target="_blank">DarkStar</a> for <a class="postlink" href="http://ds.darkain.com" target="_blank">Nintendo DS</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
