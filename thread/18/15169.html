<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Graphic Problems - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Graphic Problems</h2>
<div id="posts">
<div class="post">
    <h4>#152225 - ben0bi - Wed Mar 12, 2008 3:53 am</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
I have some problems setting up the graphics properly:
<br/>
<br/>
i want to use 16bit direct draw.
<br/>
<br/>
Problems are the following:
<br/>
- if i do NOT clear the Buffer, everything goes well. But the pixels are not deleted then...(moving stars demo)
<br/>
- if i do clear the buffer, HALF of the screen will be blank.
<br/>
<br/>
- if i use doublebuffering, it WORKS - halfways.
<br/>
(on the emulator everything is good, but on the real machine, the 
<br/>
half picture is darker than the other half.)
<br/>
<br/>
- if i set the doublebuffer memory into the main buffer memory, the darker screen will be drawn correct.
<br/>
<br/>
PLEASE help me, i really am frustrated, since 3 day i try to set up a SIMPLE background to draw to...(no framebuffer please..) - and how do i use one background over another, thats the next big question.
<br/>
<br/>
here is my source:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
u16* g_pu16ActualDrawBuffer=NULL;
<br/>
bool actualBuffer=0;
<br/>
<br/>
int main(void)
<br/>
{
<br/>
   // irqs are nice
<br/>
   irqInit();
<br/>
   irqSet(IRQ_VBLANK, 0);
<br/>
<br/>
   bool actualBuffer=0;
<br/>
<br/>
   videoSetMode(MODE_5_2D | DISPLAY_BG3_ACTIVE);
<br/>
   vramSetBankA(VRAM_A_MAIN_BG_0x06000000);   
<br/>
   initConsole();
<br/>
<br/>
   BG3_XDY = 0;
<br/>
   BG3_XDX = 1 &lt;&lt; 8;
<br/>
   BG3_YDX = 0;
<br/>
   BG3_YDY = 1 &lt;&lt; 8;
<br/>
<br/>
   lcdMainOnBottom();
<br/>
<br/>
...
<br/>
<br/>
   while(1)
<br/>
   {
<br/>
      if(actualBuffer)
<br/>
      {
<br/>
         actualBuffer=false;
<br/>
         gfxSetDrawBuffer((u16*)BG_BMP_RAM(0));
<br/>
         BG3_CR = BG_BMP16_256x256 | BG_BMP_BASE(6);
<br/>
      }else{
<br/>
         actualBuffer=true;
<br/>
         gfxSetDrawBuffer((u16*)BG_BMP_RAM(6));
<br/>
         BG3_CR = BG_BMP16_256x256 | BG_BMP_BASE(0);
<br/>
      }
<br/>
      
<br/>
      gfxClear();
<br/>
      swiWaitForVBlank();
<br/>
...
<br/>
                       gfxSetPixel(10,10,RGB15(31,0,0))
<br/>
              }
<br/>
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void gfxClear(void)
<br/>
{
<br/>
   for(int i=0;i&lt;256*256;i++)
<br/>
      g_pu16ActualDrawBuffer[i]=RGB15(0,0,0)|BIT(15);
<br/>
}
<br/>
<br/>
void gfxSetDrawBuffer(u16* newBuffer)
<br/>
{
<br/>
   g_pu16ActualDrawBuffer=newBuffer;
<br/>
}
<br/>
<br/>
void gfxSetPixel(int pos,u16 color)
<br/>
{
<br/>
   if(g_pu16ActualDrawBuffer!=NULL)
<br/>
   {
<br/>
      g_pu16ActualDrawBuffer[pos]=color|BIT(15);
<br/>
   }
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void initConsole()
<br/>
{
<br/>
   videoSetModeSub(MODE_2_2D | DISPLAY_BG0_ACTIVE); 
<br/>
   vramSetBankC(VRAM_C_SUB_BG);
<br/>
            SUB_BG0_CR = BG_MAP_BASE(31);
<br/>
   BG_PALETTE_SUB[255] = RGB15(31,31,31);
<br/>
   consoleInitDefault((u16*)SCREEN_BASE_BLOCK_SUB(31), (u16*)CHAR_BASE_BLOCK_SUB(0), 16);
<br/>
<br/>
   iprintf("\n\n\tBenoWorks Unlimited presents a DS game.\n");
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
thanks in advance.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152277 - nce - Thu Mar 13, 2008 6:30 am</h4>
    <div class="postbody"><span class="postbody">long time I haven't played with that (and no time to check BG_BMP_BASE stuff )but:
<br/>
<br/>
a 16bit buffer for the screen should take a complete vram bank. ( 256*256*2 = 128Ko )
<br/>
If you want double buffer you need to set 2 vram bank... I guess.
<br/>
( you are just setting bankA )
<br/>
<br/>
-jerome-<br/>_________________<br/>-jerome-</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152278 - Cydrak - Thu Mar 13, 2008 7:31 am</h4>
    <div class="postbody"><span class="postbody">Bitmaps only need memory for what's shown, so for this case you need 256*192*16bit = 96kbyte per buffer. However, A still isn't enough for two...
<br/>
<br/>
Also, there's a limited amount of time to effect screen updates. You can't easily expect to clear and redraw the whole screen before end of vblank. Flicker, "tearing" and dropout is a sign the hardware caught up and shown your half-drawn image (probably mid-clear in your case). For double buffers this is no problem. Framerate may still suffer, drawing a whole game like this, but that's another story...</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
