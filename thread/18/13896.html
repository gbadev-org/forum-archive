<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Blow on DS mic - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > Blow on DS mic</h2>
<div id="posts">
<div class="post">
    <h4>#137261 - MChiz - Thu Aug 09, 2007 5:42 pm</h4>
    <div class="postbody"><span class="postbody">Hi all!!
<br/>
<br/>
I'm doing some tests on my DS and I'm dealing with trying to detect if anyone is blowing on the mic. I have achieved it by detecting how many times the wave clips on the lower limit and higher limit, but it not works as I'd like. If I hit the mic it does the tests and gives me as if I'm blowing. I checked the minigame from New Super Mario Bros ( the one where Yoshi must arrive at the top of the level with blows ) and the game doesn't accepts anything but blowing on the mic.
<br/>
I have searched on the web and it seems like Fast Fourier Transform is the solution. Apply it to the wave and see if there are signal on lows, mids and highs, but I don't know how to compute it and I suspect it would be too much expensive for the DS.
<br/>
<br/>
If anyone could help me I'd be very grateful.
<br/>
<br/>
Thanks a lot
<br/>
<br/>
EDIT: Sorry for my poor english =/
<br/>
<br/>
&lt; MChiz &gt;</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137263 - jetboy - Thu Aug 09, 2007 5:56 pm</h4>
    <div class="postbody"><span class="postbody">Usualy just adding input from the mic over fixed amount of time and checking if it gives you high enough value should be enough.<br/>_________________<br/>Colors! gallery -&gt; <a href="http://colors.collectingsmiles.com" target="_blank">http://colors.collectingsmiles.com</a>
<br/>
Any questions? Try <a href="http://colors.collectingsmiles.com/faq.php" target="_blank">http://colors.collectingsmiles.com/faq.php</a> first, or official forums <a href="http://forum.brombra.net" target="_blank">http://forum.brombra.net</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137265 - MChiz - Thu Aug 09, 2007 6:03 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for your fast answer, jetboy =)
<br/>
<br/>
I did it as you said, checking the upper and lower limits and it works, but hitting the mic, screaming, or things like that are detected as if I'm blowing, and in New Super Mario Bros it doesn't happen ( at the Yoshi's minigame ).
<br/>
Also I'd like to read the intensity of the blow ( soft or strong blow ), as an analogous value, not binary. With a soft blow the wave doesn't arrives too high ( in volume terms ).
<br/>
<br/>
Thanks for helping!!
<br/>
<br/>
&lt; MChiz &gt;</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137266 - jerbob92 - Thu Aug 09, 2007 6:22 pm</h4>
    <div class="postbody"><span class="postbody">why not take some sound samples if somebody is blowing hard or soft or middle and compare it to the input from the mic, is this possible?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137268 - Ant6n - Thu Aug 09, 2007 6:55 pm</h4>
    <div class="postbody"><span class="postbody">if there is a certain frequency associated with 'blowing', then you could try a fourier transform. Try recording a couple of 'blow's with the computer and analyze the frequency spectrum, maybe there's a pattern?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137326 - MChiz - Fri Aug 10, 2007 8:18 am</h4>
    <div class="postbody"><span class="postbody">I don't know if recording three kinds of blows will do the job, I think not because it would be difficult that two waves are equals ( aprox ). If you have an idea of how achieve it I would be very grateful that you post it here!! =)
<br/>
<br/>
About Ant6n's solution, yes, there is a pattern. A blow has in the three bands ( low, mids and highs ) the same ( aprox. ) volume, so I think it would be nice to implement this one, but I don't know how to do a fast fourier transform and I have my doubts if it is ok for a DS ( maybe too expensive? ). Even I would know how to implement FFT, I'm not sure about how to apply a FFT to a wave and get the spectrum of it. Have you implemented this on DS?
<br/>
<br/>
Thanks to all for helping me!!
<br/>
<br/>
&lt; MChiz &gt;</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137366 - tepples - Fri Aug 10, 2007 10:16 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>MChiz wrote:</b></span></td> </tr> <tr> <td class="quote">About Ant6n's solution, yes, there is a pattern. A blow has in the three bands ( low, mids and highs ) the same ( aprox. ) volume, so I think it would be nice to implement this one, but I don't know how to do a fast fourier transform and I have my doubts if it is ok for a DS ( maybe too expensive? ).</td> </tr></table><span class="postbody">
<br/>
If you want to analyze the distribution of lows, mediums, and highs, then perhaps an autoregressive model like that used in <a class="postlink" href="http://en.wikipedia.org/wiki/Linear_predictive_coding" target="_blank">linear predictive coding</a> (use Google or Wikipedia if you're not familiar) is best.
<br/>
<br/>
Linguists call blowing a <a class="postlink" href="http://en.wikipedia.org/wiki/Voiceless_bilabial_fricative" target="_blank">voiceless bilabial fricative</a>. Like other voiceless sounds, blowing lacks <a class="postlink" href="http://en.wikipedia.org/wiki/Pitch_%28music%29" target="_blank">pitch</a>.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137445 - Sweater Fish Deluxe - Sat Aug 11, 2007 9:40 pm</h4>
    <div class="postbody"><span class="postbody">I was looking into something similar a few months ago and made a post about it here as well and got pretty much the same answers, which seemed hopelessly vague to my weak mind.
<br/>
<br/>
I'd never heard of FFTs before, so I looked into them and found a program on The Code Project that used them for displaying a spectrograph.  Taking a look at that source code, I thought the actual FFT math should be quite within reason on a DS (there's lots of division, but as the author of the original program suggested, bitwise shifting could optimize it a lot if needed).  I never actually got as far as testing it out on the hardware, but since it's all math, it shouldn't be hard to drop that sample code into a test program and see what kind of processor time it eats.
<br/>
<br/>
What had me stalled was what to do next.  Assuming you could get the FFT done in real time in your game, how exactly would you compare the two datasets to see if they match?  Especially since they almost certainly wouldn't match perfectly.  Anything I can think of seems incredibly complicated--much more so than the FFT itself.  Lots of averaging and branching logic would have to involved, I think.
<br/>
<br/>
I'm a very very amateur programmer, though, so maybe there's a simple solution to this that I don't know about, though.
<br/>
<br/>
By the way, when establishing the base pattern to compare against, I would recommend recording them on the DS mic itself since it has very different properties and capabilities than whatever mic you have on your PC.
<br/>
<br/>
<br/>
...word is bondage...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137448 - tepples - Sat Aug 11, 2007 9:50 pm</h4>
    <div class="postbody"><span class="postbody">What you are doing is digital signal processing. Have you read through <a class="postlink" href="http://www.bores.com/courses/intro/" target="_blank">Bores Introduction to DSP</a>?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137472 - Dood77 - Sun Aug 12, 2007 5:26 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Linguists call blowing a <a class="postlink" href="http://en.wikipedia.org/wiki/Voiceless_bilabial_fricative" target="_blank">voiceless bilabial fricative</a>. Like other voiceless sounds, blowing lacks <a class="postlink" href="http://en.wikipedia.org/wiki/Pitch_%28music%29" target="_blank">pitch</a>.</td> </tr></table><span class="postbody">
<br/>
But, the sound you hear when someone is blowing is much different then the waveforms generated when someone blows on a microphone. I have no technological knowledge about microphones, but I assume they work similar to an ear drum; by capturing the fine vibrations of sound and transforming them into electric signals. When you blow on the mic, you're causing it to vibrate, not from sound, but from gas molecules pushing against the 'drum' as the spring of the drum resists the force of the blowing and causes it to vibrate.
<br/>
<br/>
...am I right about how all this works? :-/<br/>_________________<br/>If I use a term wrong or something then feel free to correct, I?m not much of a programmer.
<br/>
<span style="font-size: 9px; line-height: normal">
<br/>
Original DS Phat obtained on day of release + flashme v7
<br/>
Supercard: miniSD, Kingston 1GB, Kingston 2GB
<br/>
Ralink chipset PCI NIC
<br/>
</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137509 - Sweater Fish Deluxe - Sun Aug 12, 2007 9:06 pm</h4>
    <div class="postbody"><span class="postbody">Something like that, I guess.  However, in the case of blowing on a mic--or at least a cheap mic like the one in the DS--what you actually get is a lot of clipped waveforms that don't look at all like the proper waveforms of a blowing noise (such as you could obtain using a very high quality mic).
<br/>
<br/>
<br/>
...word is bondage...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137533 - Ant6n - Mon Aug 13, 2007 1:43 am</h4>
    <div class="postbody"><span class="postbody">well, the whole fft thing sounds awfully complicated. why not just do a fourier transform on a couple of frequencies (like 10) and check whether they are the same or something like that.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137538 - tepples - Mon Aug 13, 2007 3:10 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Sweater Fish Deluxe wrote:</b></span></td> </tr> <tr> <td class="quote">in the case of blowing on a mic--or at least a cheap mic like the one in the DS--what you actually get is a lot of clipped waveforms that don't look at all like the proper waveforms of a blowing noise (such as you could obtain using a very high quality mic).</td> </tr></table><span class="postbody">
<br/>
So if blowing in the DS microphone does cause a near rail-to-rail signal, then just look for an energy level (sum of squares of sample values over a given time period) over a threshold.
<br/>
<br/>
Ant6n: Yes, there is something like a Fourier transform on a small set of frequencies. It's called the <a class="postlink" href="http://en.wikipedia.org/wiki/Goertzel_algorithm" target="_blank">Goertzel algorithm</a>, based on a set of narrow band-pass filters, and it's often used to detect DTMF (Touch-Tone) presses. But I don't see how Goertzel could be applied to detect blowing.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137548 - MChiz - Mon Aug 13, 2007 9:41 am</h4>
    <div class="postbody"><span class="postbody">Sweater Fish Deluxe:
<br/>
Which datasets would you want to compare? My idea with FFT was to check if the wave has no pitch ( it is easy to say, of course... ). Anyway, how did you detect the blowing? Did you find a solution?
<br/>
<br/>
tepples:
<br/>
wow, you know a lot of interesting things. I'd like to know how would you detect a blow =)
<br/>
<br/>
I think I will use the 'clipping method'. I doesn't give bad results at all on the DS if you turn on the mic gain amp.
<br/>
<br/>
Really, thanks to all for your help =)
<br/>
<br/>
&lt; MChiz &gt;</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137586 - Sweater Fish Deluxe - Mon Aug 13, 2007 7:18 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Sweater Fish Deluxe wrote:</b></span></td> </tr> <tr> <td class="quote">in the case of blowing on a mic--or at least a cheap mic like the one in the DS--what you actually get is a lot of clipped waveforms that don't look at all like the proper waveforms of a blowing noise (such as you could obtain using a very high quality mic).</td> </tr></table><span class="postbody">
<br/>
So if blowing in the DS microphone does cause a near rail-to-rail signal, then just look for an energy level (sum of squares of sample values over a given time period) over a threshold.</span></td> </tr></table><span class="postbody">
<br/>
Yeah, I think that would work.  Specifically the "over a given time period" part.  I think that's all MChiz needs to add to his detection routine to get it to distinguish between blowing on the mic and tapping on it.
<br/>
<br/>
I didn't want to suggest that, though, because I hoped someone (else) would put in the work to get some actual detection routines that could distinguish between a number of basic sounds the player might make.
<br/>
<br/>
If all you're interested in is blowing/not blowing, I think looking for data over a certain threshold for a prolonged period would work.  (The signal may drop below that threshold briefly, of course, but not for longer than say 10 vblanks?)  If the player was screaming into the mic, that might cause a misdetection, of course. But I say if the player can keep screaming for long enough to accomplish the task in the game, just give it to 'em.
<br/>
<br/>
And no, MChiz, I never came up with a solution.  I wanted to be able to detect not just blowing, but also humming, whistling, yelping, etc.  I just decided that this stuff seemed too complicated to waste my time on since it was just a little idea I had for a game that I may or may not even ever finish up.
<br/>
<br/>
I do still think it would be really cool if someone who already has the idea of how DSP works could release sample code or even a lib or some functions for PAlib, because the mic is an important part of the DS and it would be nice if homebrewers could get more use out of it.
<br/>
<br/>
<br/>
...word is bondage...</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
