<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>NDS cache - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > NDS cache</h2>
<div id="posts">
<div class="post">
    <h4>#156385 - ProblemBaby - Fri May 09, 2008 6:33 am</h4>
    <div class="postbody"><span class="postbody">Hey
<br/>
<br/>
I'am wondering how to know if code and data is efficient cached or not?
<br/>
is it possible to manually control it? in my project i've written the time consuming parts in ASM (but most are still in C) but am still unsure if the cache is used in the most efficient way...
<br/>
<br/>
There are especially some code and data that I would like to make sure stays in cache during the whole process, is it possible to force it to do that?
<br/>
<br/>
if someone could explain how I should think when I want to optimize with the cache in mind it would be awesome!
<br/>
<br/>
thanks</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#156388 - Dwedit - Fri May 09, 2008 9:14 am</h4>
    <div class="postbody"><span class="postbody">If you want to control where stuff goes, forget about the cache.  Use fast DTCM and ITCM memory instead.  TCM has the same speed as cache, but it is not 'automatic' like a cache is.
<br/>
Cache is tiny, 8k code, 4k data.  ITCM (32k) and DTCM (16k) are much bigger.
<br/>
Most of the time you can ignore that a cache even exists.  But the existence of the cache really matters when you need to use DMA, since you need to flush the write cache before the RAM will read correct data.
<br/>
Only if your code exceeds the cache, will you notice when the cache isn't being helpful.
<br/>
Keeping data aligned to 32 byte boundaries may help improve cache performance.
<br/>
There are also non-cached mirrors of RAM, which are mostly useless.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#156400 - silent_code - Fri May 09, 2008 1:11 pm</h4>
    <div class="postbody"><span class="postbody">as they originally said when the cache was introduced: "think of it as a black box. code as usually, it will 'just work'."
<br/>
<br/>
Dwedit's tip should be of much more interest to you.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#156405 - tepples - Fri May 09, 2008 1:21 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dwedit wrote:</b></span></td> </tr> <tr> <td class="quote">Keeping data aligned to 32 byte boundaries may help improve cache performance.</td> </tr></table><span class="postbody">
<br/>
Would it be worth it to hack newlib malloc() to always return cache-aligned pointers?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#156406 - elhobbs - Fri May 09, 2008 1:27 pm</h4>
    <div class="postbody"><span class="postbody">there is an existing thread on malloc and alignment. 
<br/>
<a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=14744" target="_blank">http://forum.gbadev.org/viewtopic.php?t=14744</a>
<br/>
It already does return cache aligned addresses.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#156408 - pepsiman - Fri May 09, 2008 1:40 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>elhobbs wrote:</b></span></td> </tr> <tr> <td class="quote">there is an existing thread on malloc and alignment. 
<br/>
<a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=14744" target="_blank">http://forum.gbadev.org/viewtopic.php?t=14744</a>
<br/>
It already does return cache aligned addresses.</td> </tr></table><span class="postbody">
<br/>
That thread says malloc returns word aligned (32 bit, 4 byte) addresses, not cache aligned (32 byte) addresses.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#156414 - silent_code - Fri May 09, 2008 2:56 pm</h4>
    <div class="postbody"><span class="postbody">EDIT: this has been a stupid crap post, sorry!
<br/>
<br/>
ps @ pepsiman: you might want to change your post from reading "32 bit, 4 byte" to just "4 byte". along with "32 bytes" later (&lt;lol&gt; "32 bytes later", get it?), it confused me, thus the crap post happened, that hopefully nobody read! ;^)
<br/>
somehow, i guess i won't be the last one to be confused by that.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#156420 - Noda - Fri May 09, 2008 3:29 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dwedit wrote:</b></span></td> </tr> <tr> <td class="quote">Keeping data aligned to 32 byte boundaries may help improve cache performance.</td> </tr></table><span class="postbody">
<br/>
Would it be worth it to hack newlib malloc() to always return cache-aligned pointers?</span></td> </tr></table><span class="postbody">
<br/>
<br/>
just use memalign if you want 32-bytes aligned pointers ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#156675 - pepsiman - Mon May 12, 2008 4:03 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>silent_code wrote:</b></span></td> </tr> <tr> <td class="quote">somehow, i guess i won't be the last one to be confused by that.</td> </tr></table><span class="postbody">
<br/>
I was trying to clear up the 32 bits vs 32 bytes confusion.
<br/>
Guess I failed.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
