<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Heeelp!!! -lm doesn't work - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > Heeelp!!! -lm doesn't work</h2>
<div id="posts">
<div class="post">
    <h4>#159274 - Optimus - Sat Jun 28, 2008 4:13 pm</h4>
    <div class="postbody"><span class="postbody">There is a crazy problem I can't find what's the problem.
<br/>
<br/>
Simply I get the message "undefined reference to `sin'" but I have -lm in my makefile and I still get the same message..
<br/>
<br/>
..and by searching in your forum for people with the similar problem, their problem was solved by inserting -lm into their makefile. But only here when I do this, I still get the same problem :(
<br/>
<br/>
I even searched a lot of other crazy things, like changing the -L$ dir to some eabi dir and other subdirs. But I also get "undefined reference to __aeabi_idiv" if I do this. But I don't need to do this and the sin problem is still there.
<br/>
<br/>
I have installed the latest DevkitPro. I haven't made my makefile, I just downloaded from a site with NDS coding tutorials. I don't know much of what's going in on a makefile :P
<br/>
<br/>
In the main code I just #include &lt;math.h&gt; and then just use sin()
<br/>
Ok here is the makefile:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#---------------------------------------------------------------------------------
<br/>
.SUFFIXES:
<br/>
#---------------------------------------------------------------------------------
<br/>
ifeq ($(strip $(DEVKITARM)),)
<br/>
$(error "Please set DEVKITARM in your environment. export DEVKITARM=&lt;path to&gt;devkitARM")
<br/>
endif
<br/>
<br/>
include $(DEVKITARM)/ds_rules
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# BUILD is the directory where object files &amp; intermediate files will be placed
<br/>
# SOURCES is a list of directories containing source code
<br/>
# INCLUDES is a list of directories containing extra header files
<br/>
# DATA is a list of directories containing binary files
<br/>
# all directories are relative to this makefile
<br/>
#---------------------------------------------------------------------------------
<br/>
BUILD      :=   build
<br/>
SOURCES      :=   source  
<br/>
INCLUDES   :=   include
<br/>
DATA      :=
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# options for code generation
<br/>
#---------------------------------------------------------------------------------
<br/>
ARCH   :=   -mthumb -mthumb-interwork
<br/>
<br/>
CFLAGS   :=   -g -Wall -O3\
<br/>
          -march=armv5te -mtune=arm946e-s -fomit-frame-pointer\
<br/>
         $(ARCH)
<br/>
<br/>
CFLAGS   +=   $(INCLUDE) -DARM9
<br/>
CXXFLAGS   :=   $(CFLAGS) -fno-rtti -fno-exceptions
<br/>
<br/>
ASFLAGS   :=   -g $(ARCH) -march=armv5te -mtune=arm946e-s
<br/>
<br/>
LDFLAGS   =   -specs=ds_arm9.specs -g $(ARCH) -Wl,-Map,$(notdir $*.map) \
<br/>
         -lm
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# any extra libraries we wish to link with the project
<br/>
#---------------------------------------------------------------------------------
<br/>
LIBS   := -lnds9
<br/>
 
<br/>
#---------------------------------------------------------------------------------
<br/>
# list of directories containing libraries, this must be the top level containing
<br/>
# include and lib
<br/>
#---------------------------------------------------------------------------------
<br/>
LIBDIRS   :=   $(LIBNDS)
<br/>
 
<br/>
#---------------------------------------------------------------------------------
<br/>
# no real need to edit anything past this point unless you need to add additional
<br/>
# rules for different file extensions
<br/>
#---------------------------------------------------------------------------------
<br/>
ifneq ($(BUILD),$(notdir $(CURDIR)))
<br/>
#---------------------------------------------------------------------------------
<br/>
 
<br/>
export ARM9BIN   :=   $(TOPDIR)/$(TARGET).arm9
<br/>
export ARM9ELF   :=   $(CURDIR)/$(TARGET).arm9.elf
<br/>
export DEPSDIR := $(CURDIR)/$(BUILD)
<br/>
<br/>
export VPATH   :=   $(foreach dir,$(SOURCES),$(CURDIR)/$(dir)) \
<br/>
               $(foreach dir,$(DATA),$(CURDIR)/$(dir))
<br/>
 
<br/>
CFILES      :=   $(foreach dir,$(SOURCES),$(notdir $(wildcard $(dir)/*.c)))
<br/>
CPPFILES   :=   $(foreach dir,$(SOURCES),$(notdir $(wildcard $(dir)/*.cpp)))
<br/>
SFILES      :=   $(foreach dir,$(SOURCES),$(notdir $(wildcard $(dir)/*.s)))
<br/>
BINFILES   :=   $(foreach dir,$(DATA),$(notdir $(wildcard $(dir)/*.*)))
<br/>
 
<br/>
#---------------------------------------------------------------------------------
<br/>
# use CXX for linking C++ projects, CC for standard C
<br/>
#---------------------------------------------------------------------------------
<br/>
ifeq ($(strip $(CPPFILES)),)
<br/>
#---------------------------------------------------------------------------------
<br/>
   export LD   :=   $(CC)
<br/>
#---------------------------------------------------------------------------------
<br/>
else
<br/>
#---------------------------------------------------------------------------------
<br/>
   export LD   :=   $(CXX)
<br/>
#---------------------------------------------------------------------------------
<br/>
endif
<br/>
#---------------------------------------------------------------------------------
<br/>
<br/>
export OFILES   :=   $(addsuffix .o,$(BINFILES)) \
<br/>
               $(CPPFILES:.cpp=.o) $(CFILES:.c=.o) $(SFILES:.s=.o)
<br/>
 
<br/>
export INCLUDE   :=   $(foreach dir,$(INCLUDES),-I$(CURDIR)/$(dir)) \
<br/>
         $(foreach dir,$(LIBDIRS),-I$(dir)/include) \
<br/>
         -I$(CURDIR)/$(BUILD)
<br/>
 
<br/>
export LIBPATHS   :=   $(foreach dir,$(LIBDIRS),-L$(dir)/lib)
<br/>
 
<br/>
.PHONY: $(BUILD) clean
<br/>
 
<br/>
#---------------------------------------------------------------------------------
<br/>
$(BUILD):
<br/>
   @[ -d $@ ] || mkdir -p $@
<br/>
   @$(MAKE) --no-print-directory -C $(BUILD) -f $(CURDIR)/Makefile
<br/>
 
<br/>
#---------------------------------------------------------------------------------
<br/>
clean:
<br/>
   @echo clean ...
<br/>
   @rm -fr $(BUILD) *.elf *.nds* *.bin 
<br/>
 
<br/>
 
<br/>
#---------------------------------------------------------------------------------
<br/>
else
<br/>
 
<br/>
DEPENDS   :=   $(OFILES:.o=.d)
<br/>
 
<br/>
#---------------------------------------------------------------------------------
<br/>
# main targets
<br/>
#---------------------------------------------------------------------------------
<br/>
$(ARM9BIN)   :   $(ARM9ELF)
<br/>
   @$(OBJCOPY) -O binary $&lt; $@
<br/>
   @echo built ... $(notdir $@)
<br/>
<br/>
$(ARM9ELF)   :   $(OFILES)
<br/>
   @echo linking $(notdir $@)
<br/>
   @$(LD)  $(LDFLAGS) $(OFILES) $(LIBPATHS) $(LIBS) -o $@
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# you need a rule like this for each extension you use as binary data 
<br/>
#---------------------------------------------------------------------------------
<br/>
%.bin.o   :   %.bin
<br/>
#---------------------------------------------------------------------------------
<br/>
   @echo $(notdir $&lt;)
<br/>
   @$(bin2o)
<br/>
<br/>
<br/>
-include $(DEPENDS)
<br/>
 
<br/>
#---------------------------------------------------------------------------------------
<br/>
endif
<br/>
#---------------------------------------------------------------------------------------
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
It is for ARM9, there is also the ARM7 makefile inside which is similar but I won't paste this here too because it's already too big, except if you ask me to.
<br/>
<br/>
HELP!!!
<br/>
<br/>
(This problem is driving me crazy! Shouldn't by default basic math function work, in a devkitpro I installed and ready makefile, where I didn't touched anything? Even with -lm and #include &lt;math.h&gt; they still don't?)<br/>_________________<br/>Kode or Die!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#159278 - tepples - Sat Jun 28, 2008 5:32 pm</h4>
    <div class="postbody"><span class="postbody">The math library (&lt;math.h&gt;, -lm) implements various functions in floating-point arithmetic, using the 'float' and 'double' data types. But because the DS has no dedicated hardware to handle 'float' or 'double', any program that uses them has to implement operations on these types using a comparatively slow software library. This means floating-point arithmetic won't scale to large numbers of objects without a significant drop in frame rate. A lot of games use fixed-point arithmetic to work around this deficiency. So while you wait for someone to answer your specific question about libm.a in devkitARM, you could look through <a class="postlink" href="http://en.wikipedia.org/wiki/Fixed-point_arithmetic" target="_blank">Wikipedia's article about fixed-point arithmetic</a>.
<br/>
<br/>
Another thing you could try: Try putting -lm at the end of LIBS, right after -lnds9, not in LDFLAGS.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#159351 - Optimus - Sun Jun 29, 2008 6:11 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Another thing you could try: Try putting -lm at the end of LIBS, right after -lnds9, not in LDFLAGS.</td> </tr></table><span class="postbody">
<br/>
<br/>
Thanks! That was it :P
<br/>
Ugh.. I can feel stupid now. But I can continue coding at least ;)[/quote]<br/>_________________<br/>Kode or Die!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#159370 - kusma - Sun Jun 29, 2008 9:00 pm</h4>
    <div class="postbody"><span class="postbody">Oh man, don't tell me you're going to spam the scene with NDS plasmas now, Opti... :P</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#159380 - SiW - Sun Jun 29, 2008 10:54 pm</h4>
    <div class="postbody"><span class="postbody">haha, I just made the Optimus connection too :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#159414 - 0xtob - Mon Jun 30, 2008 1:52 pm</h4>
    <div class="postbody"><span class="postbody">Check out trig_lut.h in libnds which has lookup-tables for sin and cos. On the NDS, avoid floating point like the pest! Also avoid division and sqrt (there are special hardware functions for this).
<br/>
<br/>
Now give us that Led Blur NDS port :)<br/>_________________<br/><a class="postlink" href="http://blog.dev-scene.com/0xtob" target="_blank">http://blog.dev-scene.com/0xtob</a> | <a class="postlink" href="http://nitrotracker.tobw.net" target="_blank">http://nitrotracker.tobw.net</a> | <a class="postlink" href="http://dsmi.tobw.net" target="_blank">http://dsmi.tobw.net</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
