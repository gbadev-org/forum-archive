<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>BG0 versus framebuffer(FB0) - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > BG0 versus framebuffer(FB0)</h2>
<div id="posts">
<div class="post">
    <h4>#171386 - MichaelMossman - Tue Nov 17, 2009 5:59 pm</h4>
    <div class="postbody"><span class="postbody">Sorry to be a bit slow but I still can't get my head around the difference between normal background modes and framebuffer.
<br/>
<br/>
Why is it that I can address VRAM_A directly if using FB0 but not with BG0, using MODE_5_2D for example.
<br/>
<br/>
P.s. I really have read all the tutorials I can lay my hand on but maybe this is so basic that nobody thinks it needs explaining ?
<br/>
<br/>
Thanks, Mike</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171387 - DiscoStew - Tue Nov 17, 2009 7:03 pm</h4>
    <div class="postbody"><span class="postbody"><a href="http://nocash.emubase.de/gbatek.htm#dsmemorycontrolvram" target="_blank">http://nocash.emubase.de/gbatek.htm#dsmemorycontrolvram</a>
<br/>
<br/>
<br/>
The reason why you can address the VRAM in such a way is because of how the bank is being mapped. When using a framebuffer mode, in order for it to be displayed, the bank must be set to LCD mode, and that maps it to a specific address (like VRAM_A is at 6800000h). When using a background mode, the bank for which it uses must be set as a MAIN_BG (or SUB_BG for the sub screen), and that has a different mapped address to it (which starts at 6000000h for the main, or 6200000h for the sub). That doesn't necessarily mean that the banks in order A-D will start from there, as each bank can be reorganized, like bank D can start at 6000000h instead of bank A. It's all dependent on how you set it.
<br/>
<br/>
I hope that is what you were asking about.<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171389 - mukunda - Wed Nov 18, 2009 5:20 am</h4>
    <div class="postbody"><span class="postbody">Advantage of using a BG is you can still mix other graphics with it, and also apply affine transformations to the image.
<br/>
<br/>
Advantage of using a framebuffer is that you can display things from the VRAM in LCDC mode. Display capturing writes to VRAM banks in LCDC mode, so you can display a captured block instantly. You can also capture the normal main engine's graphics while displaying something else in framebuffer mode, or even make a blur effect by capture-blending the graphics to the LCDC block you are currently displaying.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171399 - MichaelMossman - Wed Nov 18, 2009 12:39 pm</h4>
    <div class="postbody"><span class="postbody">Sorry, let me be a little bit more specific.
<br/>
<br/>
I started with the simple Starts demo at :-
<br/>
<br/>
http//:www.dev-scene.com/NDS/Tutorials_Day_3 (Page 15 if you print it out or Frame Buffer 101 from the menu) 
<br/>
<br/>
This compiled and ran beautifully. I then removed the lines at :-
<br/>
<br/>
videoSetMode(MODE_FB0);
<br/>
vramSetBankA(VRAM_A_LCD);
<br/>
<br/>
and replaced them with :-
<br/>
<br/>
videoSetMode(MODE_5_2D | DISPLAY_BG0_ACTIVE); 
<br/>
vramSetBankA(VRAM_A_MAIN_BG_0x06000000);
<br/>
<br/>
Surely, this should now point VRAM_A to 0x0600:0000 ?
<br/>
(VRAM_A is where the Stars function writes to)
<br/>
<br/>
Anyway, this compiled without error but gave me a blank screen.
<br/>
<br/>
Is my logic still missing something vital ?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171401 - sverx - Wed Nov 18, 2009 12:54 pm</h4>
    <div class="postbody"><span class="postbody">BGs can be of different types (and should be set accordingly), maybe you want a bitmap one to replace a FrameBuffer. Then you should use BG2 or BG3 in MODE_5_2D (BG0 can't be a bitmap one).
<br/>
<br/>
You can try the 2nd example in my <a class="postlink" href="http://wcms.teleion.it/users/cgq/nds/tutorial/video.html" target="_blank">Nintendo DS 2D tutorial</a> (which is in Italian but you can just read the code there...)
<br/>
<br/>
Hope this helps</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171402 - Cearn - Wed Nov 18, 2009 1:05 pm</h4>
    <div class="postbody"><span class="postbody">VRAM_A doesn't actually point to what bank A is linked to. In video.h, it is defined like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define VRAM_A        ((u16*)0x6800000)/*!&lt; \brief  pointer to vram bank A mapped as LCD*/
<br/>
</td> </tr></table><span class="postbody">
<br/>
Note the comment. What VRAM_A actually point to is the location of the bank <span style="font-weight: bold">when mapped as LCD</span>. The memory locations are linked to the graphics type (Frame buffer, main/sub BG, main/sub OBJ), not the banks. I suppose a better name might have been VRAM_LCD_A to avoid the confusion.
<br/>
<br/>
This is how I try to look at the VRAM mapping.
<br/>
<br/>
The banks are more like memory modules than memory slots. There are a number of different capabilities(*) that VRAM can be used for: Frame buffer, main/sub BG/OBJ gfx/pal, texture gfx/pal or ARM7 RAM. These are the slots. The memory banks are memory modules that you can put into the slots, so that that capability can have memory to use. Some, but not all, of these slots have addressed attached, like 0600:0000 for main BG. When you're dealing with addressless capabilities, like textures, you insert the module into a slot that does have an address, write to it. You then disconnect the module and plug it back into where data to be used for.
<br/>
<br/>
<br/>
EDIT:
<br/>
<br/>
In case I misread the question and you're asking why the simple replacement doesn't work: backgrounds and frame buffers are completely different beasts. BGs need a little more work to set up. You need to set the video mode and banks, <span style="font-style: italic">and</span> enable the background, set-up the BG in REG_BG<span style="font-style: italic">n</span>CNT (and probably the affine/scrolling registers too). And, of course, fill the tile/map/bmp buffers with something. This is all covered later in Day 3.
<br/>
<br/>
<span style="font-size: 7px; line-height: normal">(*) term pending ...</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171406 - MichaelMossman - Wed Nov 18, 2009 2:04 pm</h4>
    <div class="postbody"><span class="postbody">Thank you, Cearn, that really helps.
<br/>
<br/>
You are correct in your last assumption. All I was trying to do was modify the demo so that I could actually write something to a background without getting all tied up with importing bitmaps. 
<br/>
<br/>
I just want to be able to create something on the screen, as a background, but do it by actually using drawing functions and not importing something else.
<br/>
<br/>
I need it to be a background and not a framebuffer as I then want to put something else into a different background, so as to go on top.
<br/>
<br/>
As I am still in the early stages of experimenting with simple steps, I thought that modifying an existing demo might be a sensible way to go forward but I just don't seem to be able to find a SIMPLE demo, which writes directly to a background without importing a bitmap.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171407 - sverx - Wed Nov 18, 2009 2:08 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>MichaelMossman wrote:</b></span></td> </tr> <tr> <td class="quote">I just don't seem to be able to find a SIMPLE demo, which writes directly to a background without importing a bitmap.</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include &lt;nds.h&gt;
<br/>
<br/>
int main(void) {
<br/>
<br/>
  vramSetBankC (VRAM_C_SUB_BG);
<br/>
  videoSetModeSub (MODE_4_2D | DISPLAY_BG3_ACTIVE);
<br/>
  REG_BG3CNT_SUB = BG_BMP16_256x256 | BG_BMP_BASE(0);
<br/>
  
<br/>
  REG_BG3PA_SUB = 1 &lt;&lt; 8;
<br/>
  REG_BG3PB_SUB = 0;
<br/>
  REG_BG3PC_SUB = 0;
<br/>
  REG_BG3PD_SUB = 1 &lt;&lt; 8;
<br/>
  
<br/>
  lcdMainOnTop ();
<br/>
  
<br/>
  while(1) {
<br/>
  
<br/>
    scanKeys();
<br/>
    
<br/>
    if (keysHeld() &amp; KEY_TOUCH) {
<br/>
     
<br/>
      touchPosition touch; touchRead(&amp;touch);
<br/>
      
<br/>
      BG_GFX_SUB [touch.py * SCREEN_WIDTH + touch.px] = RGB5(31,31,31) | BIT (15);
<br/>
    }
<br/>
<br/>
    swiWaitForVBlank();
<br/>
  }
<br/>
}</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171410 - mukunda - Wed Nov 18, 2009 2:47 pm</h4>
    <div class="postbody"><span class="postbody">Take note of the "| BIT(15)" part. framebuffer mode doesn't have this 'alpha' bit, which controls transparency in 16bit bitmap BG modes.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171413 - MichaelMossman - Wed Nov 18, 2009 4:15 pm</h4>
    <div class="postbody"><span class="postbody">Thank you, sverx.
<br/>
<br/>
Google has translated your text for me. The demo works fine. You're a star !
<br/>
<br/>
mukunda, your little postscript is much appreciated.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171415 - sverx - Wed Nov 18, 2009 4:32 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>MichaelMossman wrote:</b></span></td> </tr> <tr> <td class="quote">Google has translated your text for me.</td> </tr></table><span class="postbody">
<br/>
<br/>
Can't believe it's possible to understand any sentence in that translation! Ok, my English IS bad, but that translation is a joke! :D</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171416 - MichaelMossman - Wed Nov 18, 2009 6:03 pm</h4>
    <div class="postbody"><span class="postbody">Maybe not perfect, but good enough for me to get the general gist.
<br/>
<br/>
My basic questions have now been answered. Thank you very much.
<br/>
<br/>
Onwards and upwards, Mike</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
