<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>fread into vram - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > fread into vram</h2>
<div id="posts">
<div class="post">
    <h4>#142655 - ingramb - Thu Oct 11, 2007 8:20 am</h4>
    <div class="postbody"><span class="postbody">Is it safe to do this?  If a dldi driver did byte copies into the destination, this would fail.  Is this something that I should worry about?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142657 - chishm - Thu Oct 11, 2007 8:24 am</h4>
    <div class="postbody"><span class="postbody">DLDI drivers, as well as libfat and newlib, may write bytewise to the destination memory. You have no guarantees about the behaviour in this regard. Use a temporary buffer in main RAM instead.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142661 - Dwedit - Thu Oct 11, 2007 9:42 am</h4>
    <div class="postbody"><span class="postbody">The old gba_nds_fat does 16 bit alignment if your file buffer, destination, and seek position within the file are 16-bit aligned.  But I bet the new SD libraries probably use 8 bit writes since they use a serial protocol instead of reading 16-bit data off an IDE device.
<br/>
<br/>
I think that if you are reading in units of sectors or clusters, then it does direct reading to the target memory.  Otherwise it does a memcpy to the target.  That is really old data though, it might have changed.
<br/>
<br/>
Anyway, it's probably not reliable reading to 16 bit data.  (but I still do it anyway in my customized version of gba_nds_fat)<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142695 - ingramb - Fri Oct 12, 2007 12:30 am</h4>
    <div class="postbody"><span class="postbody">OK, thanks for the info.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I think that if you are reading in units of sectors or clusters, then it does direct reading to the target memory. Otherwise it does a memcpy to the target. That is really old data though, it might have changed.</td> </tr></table><span class="postbody">
<br/>
Are there any guidelines for optimizing libfat speed?  Like reading in blocks or 512 bytes or something?  My program does lots of streaming from the card, so fread time is very important to me.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142700 - tepples - Fri Oct 12, 2007 1:29 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ingramb wrote:</b></span></td> </tr> <tr> <td class="quote">Are there any guidelines for optimizing libfat speed?  Like reading in blocks or 512 bytes or something?  My program does lots of streaming from the card, so fread time is very important to me.</td> </tr></table><span class="postbody">
<br/>
Read as large of a unit as you can without missing the vblank. In my experience with <a class="postlink" href="http://www.pineight.com/gba/#cf_bench" target="_blank">speed tester</a>, reads that span a whole hardware block (which can be larger than a sector) or a whole file system cluster (usually 4 KiB on FAT32 file systems) are faster than reads of individual 512-byte sectors.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
