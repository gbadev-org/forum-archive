<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Problems(Bug) using 16x16 sprites - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > Problems(Bug) using 16x16 sprites</h2>
<div id="posts">
<div class="post">
    <h4>#171293 - seven - Thu Nov 12, 2009 3:53 pm</h4>
    <div class="postbody"><span class="postbody">Hello,
<br/>
<br/>
is there a known bug/problem using 16x16 sprites ?
<br/>
i am trying to use 16x16 sprites on my project and i found myself having the following problem :
<br/>
<br/>
if for example i am trying to display more than one 16x16 sprites on the screen is being displayed the first allocated sprite as many times as the number of sprites that i am trying to display .
<br/>
<br/>
i have even tried this on the example "bitmap_sprites" from "Graphics/Sprites/bitmap_sprites/" .
<br/>
<br/>
note that i am using SpriteColorFormat_Bmp format, so if you change in that tutorial example the sprites size from 32x32 to 16x16 and the format for all to SpriteColorFormat_Bmp you will see 3 red sprites instead of the 1red, 1green, 1blue ..
<br/>
<br/>
does anyone know anything about this ?
<br/>
<br/>
i should mention that this problem i have only when i am using 16x16 or 8x16 etc .. not for 32x32 ..
<br/>
<br/>
Thanks.</span><span class="gensmall"><br/><br/>Last edited by seven on Thu Nov 12, 2009 4:26 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#171294 - seven - Thu Nov 12, 2009 3:59 pm</h4>
    <div class="postbody"><span class="postbody">here would be the code from here but modified for 16x16 (if anyone is interested to check it out): <a href="http://www.devkitpro.org/libnds/a00007.html#a9" target="_blank">http://www.devkitpro.org/libnds/a00007.html#a9</a>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include &lt;nds.h&gt;
<br/>
#include &lt;stdio.h&gt;
<br/>
<br/>
//a simple sprite structure 
<br/>
//it is generally preferred to separate your game object
<br/>
//from OAM
<br/>
typedef struct  
<br/>
{
<br/>
   u16* gfx;
<br/>
   SpriteSize size;
<br/>
   SpriteColorFormat format;
<br/>
   int rotationIndex;
<br/>
   int paletteAlpha;
<br/>
   int x;
<br/>
   int y;
<br/>
}MySprite;
<br/>
<br/>
int main() {
<br/>
    //three sprites of differing color format
<br/>
   MySprite sprites[] = {
<br/>
      {0, SpriteSize_16x16, SpriteColorFormat_Bmp, -1, 15, 20, 15},
<br/>
      {0, SpriteSize_16x16, SpriteColorFormat_Bmp, -1, 15, 20, 80},
<br/>
      {0, SpriteSize_16x16, SpriteColorFormat_Bmp, -1, 15, 20, 136}
<br/>
   };
<br/>
<br/>
   videoSetModeSub(MODE_0_2D);
<br/>
<br/>
   consoleDemoInit();
<br/>
   
<br/>
   //initialize the sub sprite engine with 1D mapping 128 byte boundary
<br/>
   //and no external palette support
<br/>
   oamInit(&amp;oamSub, SpriteMapping_Bmp_1D_128, false);
<br/>
<br/>
   vramSetBankD(VRAM_D_SUB_SPRITE);
<br/>
   
<br/>
   //allocate some space for the sprite graphics
<br/>
   for(int i = 0; i &lt; 3; i++)
<br/>
      sprites[i].gfx = oamAllocateGfx(&amp;oamSub, sprites[i].size, sprites[i].format);
<br/>
   
<br/>
    dmaFillHalfWords(ARGB16(1,31,0,0), sprites[0].gfx, 16*16*2);
<br/>
   dmaFillHalfWords(ARGB16(1,0,31,0), sprites[1].gfx, 16*16*2);
<br/>
   dmaFillHalfWords(ARGB16(1,0,0,31), sprites[2].gfx, 16*16*2);
<br/>
<br/>
   //set index 1 to blue...this will be the 256 color sprite
<br/>
   SPRITE_PALETTE_SUB[1] = RGB15(0,31,0);
<br/>
   //set index 17 to green...this will be the 16 color sprite
<br/>
   SPRITE_PALETTE_SUB[16 + 1] = RGB15(0,0,31);
<br/>
<br/>
   while(1) {
<br/>
      for(int i = 0; i &lt; 3; i++) {
<br/>
         oamSet(
<br/>
            &amp;oamSub, //sub display 
<br/>
            i,       //oam entry to set
<br/>
            sprites[i].x, sprites[i].y, //position 
<br/>
            0, //priority
<br/>
            sprites[i].paletteAlpha, //palette for 16 color sprite or alpha for bmp sprite
<br/>
            sprites[i].size, 
<br/>
            sprites[i].format, 
<br/>
            sprites[i].gfx, 
<br/>
            sprites[i].rotationIndex, 
<br/>
            true, //double the size of rotated sprites
<br/>
            false, //don't hide the sprite
<br/>
            false, false, //vflip, hflip
<br/>
            false //apply mosaic
<br/>
         );
<br/>
      }
<br/>
      swiWaitForVBlank();
<br/>
      //send the updates to the hardware
<br/>
      oamUpdate(&amp;oamSub);
<br/>
   }
<br/>
   return 0;
<br/>
}</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171298 - sverx - Thu Nov 12, 2009 4:50 pm</h4>
    <div class="postbody"><span class="postbody">Looks like they're all sharing the same location in memory... check gfx* member.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171301 - seven - Thu Nov 12, 2009 5:37 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sverx wrote:</b></span></td> </tr> <tr> <td class="quote">Looks like they're all sharing the same location in memory... check gfx* member.</td> </tr></table><span class="postbody">
<br/>
<br/>
No, they're not using the same location in memory, already tested that .
<br/>
But couldn't figured exactly why, and why this happens just for 16x16 sprites size .</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171303 - seven - Thu Nov 12, 2009 6:52 pm</h4>
    <div class="postbody"><span class="postbody">"Looks like a bug in oamSet()
<br/>
The gfx pointers are all 512 bytes apart as they should be, but the gfx Index in OAM is 0 for all three sprites."
<br/>
<br/>
Any advices on how could this be fixed ?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171342 - headspin - Sat Nov 14, 2009 1:55 pm</h4>
    <div class="postbody"><span class="postbody">Looks like a bug in libnds to me. Perhaps make a bug report on the devkitARM forums?<br/>_________________<br/><a class="postlink" href="http://headsoft.com.au/index.php?category=warhawk" target="_blank">Warhawk DS</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=mmll" target="_blank">Manic Miner: The Lost Levels</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=tdg" target="_blank">The Detective Game</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
