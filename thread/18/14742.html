<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>3D rotation matrix stuff - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > 3D rotation matrix stuff</h2>
<div id="posts">
<div class="post">
    <h4>#147889 - iainprice - Sat Dec 29, 2007 11:10 pm</h4>
    <div class="postbody"><span class="postbody">I am making a 3d drive around game but am having problems with nice rotations.......
<br/>
<br/>
main loop:
<br/>
<br/>
[code]
<br/>
while(1)
<br/>
{
<br/>
	scanKeys();
<br/>
	u16 keys = keysHeld();
<br/>
	if((keys &amp; KEY_UP)) rotateX += 3;
<br/>
	if((keys &amp; KEY_DOWN)) rotateX -= 3;
<br/>
	if((keys &amp; KEY_LEFT)) rotateZ -= 3;
<br/>
	if((keys &amp; KEY_RIGHT)) rotateZ += 3;
<br/>
	if((keys &amp; KEY_A)) thrustspeed -= 0.01f;
<br/>
	if((keys &amp; KEY_B)) thrustspeed += 0.01f;
<br/>
<br/>
	//first - player
<br/>
	glPushMatrix();
<br/>
	glMatrixMode(GL_MODELVIEW);
<br/>
	RenderMD2Model(frame,0);
<br/>
	glPopMatrix(1);
<br/>
<br/>
	//second, third and track
<br/>
	glPushMatrix();
<br/>
	glRotateY(rotateX);
<br/>
	glRotateZ(rotateZ);
<br/>
	glTranslatef(thrustspeed,0.0,0.0);
<br/>
	glMatrixMode(GL_MODELVIEW);
<br/>
<br/>
	RenderMD2Model(frame,1);
<br/>
<br/>
	RenderMD2Model(frame,2);
<br/>
<br/>
	RenderTrack();
<br/>
<br/>
	glPopMatrix(1);
<br/>
	glFlush(0);
<br/>
}
<br/>
<br/>
[/code]
<br/>
<br/>
with the current order of things.... it draws the player, then rotates the track and other players so it appears that the player is rotating. If you move forwards it only goes along the axis, not the direction of the rotated matrix........
<br/>
<br/>
I know I could keep the track and players stationary and move the main player and camera but I thought that would be more maths intensive....
<br/>
<br/>
any ideas, comments.. suggestions?
<br/>
<br/>
cheers.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#147890 - Lick - Sat Dec 29, 2007 11:16 pm</h4>
    <div class="postbody"><span class="postbody">You'll need to keep track of the angle the camera/player is facing, and with that angle, use <a class="postlink" href="http://en.wikipedia.org/wiki/Trigonometry" target="_blank">trigonometry</a> (sinus, cosinus) to calculate the distance of x and y when the player presses forward. (Note: forward doesn't mean x+1 or y+1, but it's often x+0,.. AND y+0,..!)<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#147892 - iainprice - Sun Dec 30, 2007 12:11 am</h4>
    <div class="postbody"><span class="postbody">So keep a player.x, .y and .z for position and an angle and a distance moved.... then calculate a new x,y,z......
<br/>
<br/>
hmmm thought I might have to but wanted to try just using matrix stuff as it is quite fast and accurate.....</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#147897 - tepples - Sun Dec 30, 2007 2:13 am</h4>
    <div class="postbody"><span class="postbody">As I understand it, the hardware "matrix stuff" is designed for use with the graphics engine (the "view" in <a class="postlink" href="http://en.wikipedia.org/wiki/Model-view-controller" target="_blank">MVC design</a>), not the physics engine (the "model"). Keeping the physics and graphics separate will make it easier for you to maintain the software, especially on other platforms where you will need to rewrite the graphics.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#147908 - sajiimori - Sun Dec 30, 2007 7:21 am</h4>
    <div class="postbody"><span class="postbody">That's some weird code!  Here, start with this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
// A matrix that can be uploaded straight to the hardware.
<br/>
struct Matrix43
<br/>
{
<br/>
   Matrix33 axes;  // rotation
<br/>
   Vector3 trans;  // position
<br/>
};
<br/>
<br/>
// A 3D object.
<br/>
struct Object
<br/>
{
<br/>
   MD2* model;
<br/>
   Matrix43 mtx;
<br/>
};
<br/>
<br/>
// Given the orientation of a camera in world space,
<br/>
// produce a matrix that can be uploaded to the hardware
<br/>
// to view the world from the camera's perspective.
<br/>
void calculateViewMtx(const Matrix43* cam, Matrix43* inv)
<br/>
{
<br/>
   // Set inv-&gt;axes to the transpose of cam-&gt;axes,
<br/>
   // since we want the whole world to appear rotated
<br/>
   // by the opposite of the camera's rotation.
<br/>
<br/>
   // Set inv-&gt;trans to the opposite of cam-&gt;trans,
<br/>
   // for similar reasons.
<br/>
<br/>
   // Multiply inv-&gt;trans by inv-&gt;axes, since rotating
<br/>
   // the camera in place should cause all other objects
<br/>
   // to rotate around it.  Try seeing what happens if
<br/>
   // you skip this step!
<br/>
}
<br/>
<br/>
void drawScene(
<br/>
   const Matrix43* cam,
<br/>
   const Object* objs,
<br/>
   int numObjs)
<br/>
{
<br/>
   Matrix43 inv;
<br/>
   calculateViewMtx(cam, &amp;inv);
<br/>
<br/>
   for(int i = 0; i &lt; numOjbs; ++i)
<br/>
   {
<br/>
      // Load inv as the current matrix.
<br/>
      // Multiply the current matrix by objs[i].mtx.
<br/>
      // Draw objs[i].model.
<br/>
   }
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
