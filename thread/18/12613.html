<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Very basic thing...but I just CAN'T get it - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Very basic thing...but I just CAN'T get it</h2>
<div id="posts">
<div class="post">
    <h4>#120472 - Lupi - Sun Mar 04, 2007 1:27 am</h4>
    <div class="postbody"><span class="postbody">I have been like two entire days trying to figure this out, but I CAN'T.
<br/>
<br/>
The situation, I have loaded in memory a set of tiles, that represents the ASCII letters. The difference is that the first letter is the one with ASCII code 32.
<br/>
<br/>
I have made a class to read a vector of chars and make lines of text with / and ~ (this is not important I believe) the important part comes here. I want the text to be ready to be loaded in VRAM. So I have to "convert" char into u16. The pallette is the number 0, and I do not want tile flipping, so that's 0 too. For every char I'm adding to my class, I do this operation based on the string I'm "converting"
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">u16 letter = 0x00FF &amp; (string[i]-PRIMER_CHAR);</td> </tr></table><span class="postbody">
<br/>
string[i] is the single char I'm turning into a tile to be loaded later
<br/>
PRIMER_CHAR is the first char, 32
<br/>
letter is a variable of 16 bits
<br/>
<br/>
to load this on VRAM I have tried memcpy and DC_Flush + dmaCopy, BOTH of them works on emulator, NONE of them works on real Nintendo DS. 
<br/>
<br/>
WHAT is wrong?!. I'm desperate, I don't have a clue of what's going on or how to fix it, I don't know if the problem is the way I'm loading this into memory or the way I'm converting the char :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#120475 - tepples - Sun Mar 04, 2007 1:57 am</h4>
    <div class="postbody"><span class="postbody">You can try looking at the ARM9 source of <a class="postlink" href="http://www.pineight.com/ds/" target="_blank">AXE</a> to see a working example.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#120514 - Lick - Sun Mar 04, 2007 9:06 am</h4>
    <div class="postbody"><span class="postbody">could you give more code?<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#120519 - qw3rty - Sun Mar 04, 2007 9:41 am</h4>
    <div class="postbody"><span class="postbody">I doubt you would benefit from a DMA-transfer to copy ONE u16.
<br/>
The VRAM for TILE-BGs should be writeable all the time (no need to unlock or wait for V-Blank).
<br/>
<br/>
there's no need for the "letter" variable (include a check for "legal" letters !):
<br/>
<br/>
*(SCREEN_BASE_BLOCK(n) +x+y*32) = (u16)(string[i] - PRIMER_CHAR);
<br/>
<br/>
x,y is the column and line. (If I remember right every text-bg has a width of 32 tiles - the 512++ modes have multiple "pages")</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#120521 - knight0fdragon - Sun Mar 04, 2007 10:34 am</h4>
    <div class="postbody"><span class="postbody">there are issues when it comes to DMA transferring, try using memcpy and see if that works
<br/>
<br/>
qw3rty, in DS, you can have tiled areas larger then 32x32 (32,64,128.256) so your formula would not work for the larger ones.<br/>_________________<br/><a href="http://www.myspace.com/knight0fdragonds" target="_blank">http://www.myspace.com/knight0fdragonds</a>
<br/>
<br/>
MK DS FC: Dragon 330772 075464 
<br/>
AC WW FC: Anthony SamsClub 1933-3433-9458 
<br/>
MPFH: Dragon 0215 4231 1206</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#120526 - qw3rty - Sun Mar 04, 2007 12:31 pm</h4>
    <div class="postbody"><span class="postbody">My formula works, if you know how the NDS handles BG's bigger than 32x32
<br/>
<a href="http://www.thepernproject.com/tutorials/GBA/day_5.pdf" target="_blank">http://www.thepernproject.com/tutorials/GBA/day_5.pdf</a>
<br/>
<br/>
page n starts at line y=n*32.
<br/>
each page has 32 characters per line and 32 lines (256x256 pixels).
<br/>
page-layout for a 512x512 BG (64x64 tiles)
<br/>
<br/>
1  2
<br/>
3  4
<br/>
<br/>
<br/>
y = 33, x = 0 would map to 2nd page, 2nd line, first char.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#120535 - Lupi - Sun Mar 04, 2007 2:27 pm</h4>
    <div class="postbody"><span class="postbody">Well, the one that I obtained better results was with memcpy.
<br/>
<br/>
Normally I did the following:
<br/>
memcpy(vector_of_u16, Pointer, size_of_vector*2); I did double because it was two Bytes each position of the vector
<br/>
Then I added 32 to the position for the next line, and so on.
<br/>
<br/>
As always worked on emulator, but not on Hardware.
<br/>
<br/>
I followed qw3rty's tip and it works now!!!!
<br/>
I don't know why though, but THANKS!!! That was the only thing that stopped my project, even the Dialogue engine I did works now ^^
<br/>
<br/>
Thanks, and sorry for this stupid question, I have to learn more about DS Hardware :P</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#120625 - knight0fdragon - Mon Mar 05, 2007 1:26 am</h4>
    <div class="postbody"><span class="postbody">are you sure about this paging, because when I worked with 64x64 tiled backgrounds, 32 gives me (32,0) not (0,1)<br/>_________________<br/><a href="http://www.myspace.com/knight0fdragonds" target="_blank">http://www.myspace.com/knight0fdragonds</a>
<br/>
<br/>
MK DS FC: Dragon 330772 075464 
<br/>
AC WW FC: Anthony SamsClub 1933-3433-9458 
<br/>
MPFH: Dragon 0215 4231 1206</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#120642 - tepples - Mon Mar 05, 2007 3:47 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>knight0fdragon wrote:</b></span></td> </tr> <tr> <td class="quote">are you sure about this paging, because when I worked with 64x64 tiled backgrounds, 32 gives me (32,0) not (0,1)</td> </tr></table><span class="postbody">
<br/>
Text or rot/scale?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#120651 - knight0fdragon - Mon Mar 05, 2007 4:30 am</h4>
    <div class="postbody"><span class="postbody">it is a rotation scaling bg<br/>_________________<br/><a href="http://www.myspace.com/knight0fdragonds" target="_blank">http://www.myspace.com/knight0fdragonds</a>
<br/>
<br/>
MK DS FC: Dragon 330772 075464 
<br/>
AC WW FC: Anthony SamsClub 1933-3433-9458 
<br/>
MPFH: Dragon 0215 4231 1206</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#120652 - tepples - Mon Mar 05, 2007 5:18 am</h4>
    <div class="postbody"><span class="postbody">Text backgrounds are divided into 32x32 tile pages. Rot/scale backgrounds are not divided into pages.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#120700 - knight0fdragon - Mon Mar 05, 2007 5:49 pm</h4>
    <div class="postbody"><span class="postbody">well nothing was ever specified about it being a text background or not haha, just tiled<br/>_________________<br/><a href="http://www.myspace.com/knight0fdragonds" target="_blank">http://www.myspace.com/knight0fdragonds</a>
<br/>
<br/>
MK DS FC: Dragon 330772 075464 
<br/>
AC WW FC: Anthony SamsClub 1933-3433-9458 
<br/>
MPFH: Dragon 0215 4231 1206</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#120716 - qw3rty - Mon Mar 05, 2007 7:37 pm</h4>
    <div class="postbody"><span class="postbody">It was obvious, that  Lupi wanted to use text-bg, because he talked about horizontal and vertical flip, which is only possible in text-mode.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#120796 - knight0fdragon - Tue Mar 06, 2007 3:49 am</h4>
    <div class="postbody"><span class="postbody">you can use the rotation matrix to flip it vertically and horizontally, and I thought he said he doesnt want tile flipping<br/>_________________<br/><a href="http://www.myspace.com/knight0fdragonds" target="_blank">http://www.myspace.com/knight0fdragonds</a>
<br/>
<br/>
MK DS FC: Dragon 330772 075464 
<br/>
AC WW FC: Anthony SamsClub 1933-3433-9458 
<br/>
MPFH: Dragon 0215 4231 1206</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#120806 - HyperHacker - Tue Mar 06, 2007 5:31 am</h4>
    <div class="postbody"><span class="postbody">It's not much harder to draw flipped characters on a frame buffer than normal ones either.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
