<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Reinitializing wifi [SOLVED] - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Reinitializing wifi [SOLVED]</h2>
<div id="posts">
<div class="post">
    <h4>#139125 - melw - Sun Sep 02, 2007 10:45 am</h4>
    <div class="postbody"><span class="postbody">Does anyone have an idea why deinitilializing and then reinitializing the DS wifi won't work all the way? Even if the initialization seems to go through on a second time, no socket connections can be created afterwards.
<br/>
<br/>
A working solution:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
// ARM9 side, assuming ARM7 is straight from wifi_lib_test template
<br/>
void preinit_wifi() // call only once when firing up the wifi
<br/>
{
<br/>
   u32 Wifi_pass = Wifi_Init(WIFIINIT_OPTION_USELED);
<br/>
   REG_IPC_FIFO_TX = 0x12345678;
<br/>
   REG_IPC_FIFO_TX = Wifi_pass;
<br/>
      
<br/>
   *((volatile u16 *)0x0400010E) = 0; // disable timer3
<br/>
   
<br/>
   irqSet(IRQ_TIMER3, Timer_50ms); // setup timer IRQ
<br/>
   irqEnable(IRQ_TIMER3);
<br/>
      
<br/>
    Wifi_SetSyncHandler(arm9_synctoarm7); // tell wifi lib to use our handler to notify arm7
<br/>
<br/>
   *((volatile u16 *)0x0400010C) = (u16)-6553; // 6553.1 * 256 cycles = ~50ms;
<br/>
   *((volatile u16 *)0x0400010E) = 0x00C2; // enable, irq, 1/256 clock
<br/>
<br/>
   while(Wifi_CheckInit()==0)
<br/>
      swiWaitForVBlank();
<br/>
}
<br/>
<br/>
void init_wifi() // can be called each time
<br/>
{
<br/>
   Wifi_EnableWifi();
<br/>
   Wifi_AutoConnect();
<br/>
}
<br/>
<br/>
void uninit_wifi()
<br/>
{
<br/>
   Wifi_DisconnectAP();
<br/>
   Wifi_DisableWifi();
<br/>
}</td> </tr></table><span class="postbody"></span><span class="gensmall"><br/><br/>Last edited by melw on Mon Sep 03, 2007 9:25 am; edited 2 times in total</span></div>    
</div>
<div class="post">
    <h4>#139133 - DragonMinded - Sun Sep 02, 2007 4:06 pm</h4>
    <div class="postbody"><span class="postbody">Why would you want to de and re-init wifi?  It's meant to be init'd at the beginning of the software.  It doesn't connect or even activate until you associate with a hotspot, so just associate when you need, and then disconnect again.<br/>_________________<br/>Enter the mind of the dragon.
<br/>
<br/>
<a href="http://dragonminded.blogspot.com" target="_blank">http://dragonminded.blogspot.com</a>
<br/>
<br/>
Seriously guys, how hard is it to simply TRY something yourself?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#139134 - tepples - Sun Sep 02, 2007 4:13 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>DragonMinded wrote:</b></span></td> </tr> <tr> <td class="quote">Why would you want to de and re-init wifi?  It's meant to be init'd at the beginning of the software.</td> </tr></table><span class="postbody">
<br/>
To save wear and tear on the DS Lite's power switch. Does and should the following work?
<br/>
<ol type="1"><li>Start DSOrganize. </li><li>Use IRC, Web Browser, or Homebrew Database. </li><li>Return to the menu. </li><li>Launch a .nds that uses dswifi. </li></ol><br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#139137 - pas - Sun Sep 02, 2007 4:50 pm</h4>
    <div class="postbody"><span class="postbody">As far as I tried it, it works. DM, I still got no reply to my last mail (I mailed to <a href="mailto:shaun.taylor@gmail.com">shaun.taylor@gmail.com</a>) I just ask cause I can't be sure that you read it...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#139139 - melw - Sun Sep 02, 2007 4:57 pm</h4>
    <div class="postbody"><span class="postbody">What Tepples said. In a perfect world it would be nice if you could use wifi homebrew after another. DM: But yeah - for saving battery life, disconnecting from AP is probably already enough, so it's not that big deal.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#139163 - knight0fdragon - Mon Sep 03, 2007 1:15 am</h4>
    <div class="postbody"><span class="postbody">well, do you sync the wifi back up with the arm7 side when you reinitialize it?<br/>_________________<br/><a href="http://www.myspace.com/knight0fdragonds" target="_blank">http://www.myspace.com/knight0fdragonds</a>
<br/>
<br/>
MK DS FC: Dragon 330772 075464 
<br/>
AC WW FC: Anthony SamsClub 1933-3433-9458 
<br/>
MPFH: Dragon 0215 4231 1206</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#139185 - melw - Mon Sep 03, 2007 7:46 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>knight0fdragon wrote:</b></span></td> </tr> <tr> <td class="quote">well, do you sync the wifi back up with the arm7 side when you reinitialize it?</td> </tr></table><span class="postbody">
<br/>
Yes. The point was if you try to reinitialize the wifi all the way including Wifi_Init(), Wifi_Pass etc. the initialization itself goes through, but all the connections created after this fail.
<br/>
<br/>
Having slept over this, DM has a very valid point. There's no need to do more than disconnecting from the AP and disabling the Wifi_Timer(). In the beginning I tried this since having wifi enabled all the time sucked the DS battery empty in mere 2 hours.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#139188 - DragonMinded - Mon Sep 03, 2007 8:03 am</h4>
    <div class="postbody"><span class="postbody">OF COURSE booted homebrew works fine in DSO.  DSO init's the wifi before even showing the main screen.  The only thing going to a wifi enabled app does is associate and de-associate from an AP.  And from all the wifi-enabled homebrew that boots fine from DSO, I'd say it re-init's fine from new software.  So why is this even an issue?  It's MEANT to be called just once at the beginning.<br/>_________________<br/>Enter the mind of the dragon.
<br/>
<br/>
<a href="http://dragonminded.blogspot.com" target="_blank">http://dragonminded.blogspot.com</a>
<br/>
<br/>
Seriously guys, how hard is it to simply TRY something yourself?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#140646 - Jesse - Tue Sep 18, 2007 8:41 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for the info in this topic. I do still have one problem though, and that is that the LED never stops blinking. I checked the dswifi code, and there is code to do that, but I guess it never executes for me. Any ideas?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#140711 - melw - Wed Sep 19, 2007 12:46 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Jesse wrote:</b></span></td> </tr> <tr> <td class="quote">Thanks for the info in this topic. I do still have one problem though, and that is that the LED never stops blinking. I checked the dswifi code, and there is code to do that, but I guess it never executes for me. Any ideas?</td> </tr></table><span class="postbody">
<br/>
Wifi_DisableWifi() should stop the blinking, but if it doesn't you can always manually stop the wifi timer (irqDisable(IRQ_TIMER3) if using same source code from the wifi_lib_test template).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#140716 - Jesse - Wed Sep 19, 2007 1:52 pm</h4>
    <div class="postbody"><span class="postbody">My mistake. It works now. Thanks a bunch!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#140781 - knight0fdragon - Wed Sep 19, 2007 7:53 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>melw wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>knight0fdragon wrote:</b></span></td> </tr> <tr> <td class="quote">well, do you sync the wifi back up with the arm7 side when you reinitialize it?</td> </tr></table><span class="postbody">
<br/>
Yes. The point was if you try to reinitialize the wifi all the way including Wifi_Init(), Wifi_Pass etc. the initialization itself goes through, but all the connections created after this fail.
<br/>
<br/>
Having slept over this, DM has a very valid point. There's no need to do more than disconnecting from the AP and disabling the Wifi_Timer(). In the beginning I tried this since having wifi enabled all the time sucked the DS battery empty in mere 2 hours.</span></td> </tr></table><span class="postbody">
<br/>
I dont think you are getting my point, you need to init the Wifi on the arm 7 side again also, since this is your comment  // ARM9 side, assuming ARM7 is straight from wifi_lib_test template 
<br/>
<br/>
your arm7 is doing this
<br/>
<br/>
	// Keep the ARM7 out of main RAM
<br/>
	while (1) swiWaitForVBlank();
<br/>
<br/>
when you try to initialize it a second time,  which means you are missing some of the arm7 stuff needed to get the wifi going<br/>_________________<br/><a href="http://www.myspace.com/knight0fdragonds" target="_blank">http://www.myspace.com/knight0fdragonds</a>
<br/>
<br/>
MK DS FC: Dragon 330772 075464 
<br/>
AC WW FC: Anthony SamsClub 1933-3433-9458 
<br/>
MPFH: Dragon 0215 4231 1206</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
