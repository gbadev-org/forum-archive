<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Audio codec recommendations - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > Audio codec recommendations</h2>
<div id="posts">
<div class="post">
    <h4>#72394 - Lazy1 - Sat Feb 18, 2006 7:12 am</h4>
    <div class="postbody"><span class="postbody">Can someone reccommend an audio decoder which is small ( both in filesize and code size ) and can run on the arm7?
<br/>
I have tried lowmem tremor ( fixed point ogg decoder ) but that is too big and won't fit into the arm7 binary.
<br/>
<br/>
It must be run on the arm7 since the wolfenstein game logic and yet to be optimized software renderer take up all of the arm9's time.
<br/>
<br/>
I just looked at GSM but at anything less than 48000hz the music starts to sound bad and each song is still over 2mb ( registered wolf3d has 27 music tracks ).
<br/>
<br/>
Any suggestions on a decoder or docs on how to increase the max arm7 size are appreciated.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#72402 - gladius - Sat Feb 18, 2006 8:16 am</h4>
    <div class="postbody"><span class="postbody">Didn't wolfenstien use simple MIDI?  That should be really easy to emulate on the DS.  Just write a small MIDI player and grab some general midi samples that are ADPCM compressed for size and you are good to go.
<br/>
<br/>
The arm7 can access data from main 4 megabytes of ram, so you can store the samples there if neccesary as well.
<br/>
<br/>
I also see it has a SNES port.  You could always use my PocketSPC arm7 core :).  That way each song would only be 64k.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#72403 - Lazy1 - Sat Feb 18, 2006 8:59 am</h4>
    <div class="postbody"><span class="postbody">Nope, it used a different format ( IMF ).
<br/>
The SDL port I'm porting from comes with an OPL2 emulator but unfortunately it does not run on the DS.
<br/>
<br/>
Adplug can play/read imf files but uses the same emulator which had me converting the files on the PC first.
<br/>
It only takes a few seconds to convert each song and generally sounds good, nothing compared to a real soundblaster but still good.
<br/>
<br/>
I was really hoping to use ogg files, the size was good ( &lt; 600kb per song ) and the library had ARM optimizations.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#72408 - gladius - Sat Feb 18, 2006 10:38 am</h4>
    <div class="postbody"><span class="postbody">Oops, I see.  Well, IMF is a more complicated beast.  Doing OPL emulation on the arm7 is possible, although it might require some custom asm.
<br/>
<br/>
I took a quick glance at adplug and it seems that the OPL emulator isn't that complicated.  What prevents it from running on the DS?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#72410 - Lazy1 - Sat Feb 18, 2006 11:00 am</h4>
    <div class="postbody"><span class="postbody">It's been a while since I tried it but I believe a call to malloc() was failing.
<br/>
In addition I do not know ARM assembly, or the OPL specs so writing my own emulator is out :(
<br/>
<br/>
[EDIT]
<br/>
Oddly enough, it's initializing fine now - hmm, I wonder what was causing it to fail before.
<br/>
Oh well, now I gotta figure out how to use this thing :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#72441 - tepples - Sat Feb 18, 2006 4:51 pm</h4>
    <div class="postbody"><span class="postbody">The Super NES and Atari Jaguar versions of <span style="font-style: italic">Wolfenstein 3D</span> used what sounded like tracked music. Any modplayer should do the trick.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#72494 - Lazy1 - Sun Feb 19, 2006 12:27 am</h4>
    <div class="postbody"><span class="postbody">I'm porting the SDL version where the music is basically hardware adlib commands.
<br/>
I have looked at the OPL emulator and it looks like it could work on the ds but it is not documented very well.
<br/>
Also undocumented is the original music code that came with the SDL wolfenstein port, all the OPL commands are there but there are no comments saying what they do or why they're there.
<br/>
<br/>
I've looked into adlib programming but all the documents I've found either don't explain enough or expect you to already be an expert on sound.
<br/>
I can't give up on this either, if I get that OPL emulator working no sound conversion is needed on the PC side and everyone can have not only music but other digital sfx like picking up ammo, ect...
<br/>
<br/>
If anyone has worked with adlib sounds or the YM3812 directly let me know, I need help on this one.
<br/>
<br/>
Thanks for all the suggestions so far.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#72608 - Lazy1 - Mon Feb 20, 2006 11:31 am</h4>
    <div class="postbody"><span class="postbody">Well, I've looked at a few OPL examples but nothing helped me understand anything.
<br/>
I saw a lot of emulator projects that use the emulator, but all they need to do is redirect I/O accesses to it and don't have to know anything about the OPL chip itself.
<br/>
I did find an IMF player which worked by writing data to OPL registers, however my lack of sound knowledge caused the output to be only .45s long and just random noise.
<br/>
<br/>
Either I _somehow_ figure this out or find a suitable format to convert the music into - wolf3d won't have music or digitized sound.
<br/>
I just can't understand sound programming :(
<br/>
<br/>
Edit:
<br/>
_Some_ success, I managed to get recognizable music dumped into a .raw file. It's mostly there except it's extremely sensitive to timing and I have no idea how sound timing works, I'm only getting sound because I'm using hardcoded numbers which seem to be close.
<br/>
<br/>
Edit again:
<br/>
I tried getting the emulator running on the arm7 with no luck ( malloc failed ) and on the arm9 ( way too slow ).
<br/>
<br/>
So, it looks like some conversion is needed inorder for this to work.
<br/>
I looked at GSM again, although it gives a nice filesize it messes up the quieter tones.
<br/>
I still have to fix my imf-&gt;raw dumper since the OPL emulator was specifically modified to play things from wolf3d. Playing them through adplug has some really annoying side-effects.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
