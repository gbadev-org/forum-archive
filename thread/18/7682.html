<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>[help] How to write a program to load a rom then execute it? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > [help] How to write a program to load a rom then execute it?</h2>
<div id="posts">
<div class="post">
    <h4>#62662 - robot - Sun Dec 04, 2005 3:31 am</h4>
    <div class="postbody"><span class="postbody">Can anyone show me the steps that a program sould do to load a rom from SuperCard (CF or SD) then execute it just like the SC shell does. 
<br/>
<br/>
I already know how to use SuperCard I/O routines to read and write data from SC card. 
<br/>
<br/>
Thank you in advance.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62666 - Dwedit - Sun Dec 04, 2005 5:23 am</h4>
    <div class="postbody"><span class="postbody">I'm guessing you would read 256k off the card, disable the CF interface and enable the RAM, write 256k, then repeat.  To run it, jump to the ram.  Not sure if you need to set the stack pointer first or not.  Maybe instead of jumping, use the SWI reset call.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62668 - tepples - Sun Dec 04, 2005 5:27 am</h4>
    <div class="postbody"><span class="postbody">You may need to set up the virtual memory registers in the way that the program expects. Failure to do this is part of why the GBAMP can't run WMB demos.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62773 - robot - Mon Dec 05, 2005 5:27 pm</h4>
    <div class="postbody"><span class="postbody">It's me again, after take two days trial and error, I still can't make it.
<br/>
<br/>
I have load a rom into memory from SC SD, but I can't make it run.
<br/>
<br/>
Does a NDS rom (execution file) has some kind of relocation table, just like DOS or Windows execution file? Or I need to put the rom to specific address? 
<br/>
<br/>
Can anyone give me some example with full or part of source code? Even the example not designed for SC SD is also appreciated.
<br/>
<br/>
Many thanks in advance.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62775 - natrium42 - Mon Dec 05, 2005 5:41 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>robot wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Can anyone give me some example with full or part of source code? Even the example not designed for SC SD is also appreciated.</td> </tr></table><span class="postbody">
<br/>
There is Darkain's Multi-NDS source in ndslib (note: not in libnds). Also, you could look at ndsmall loader source (in assembly) in the libnds CVS.
<br/>
<br/>
The steps involved in loading a NDS:
<br/>
1. Clear memory
<br/>
2. Copy ARM7 and ARM9 binaries into memory
<br/>
3. Reset all registers to "initial" values (the hard part)
<br/>
4. Direct ARM9 to the entry point in ARM9 binary
<br/>
5. Direct ARM7 to the entry point in ARM7 binary
<br/>
<br/>
There could be some problems with parts 4 and 5 because some homebrews might rely on a certain timing there. So you need a way to synchronize CPU cores somehow so that they jump to entry points at about the same time.<br/>_________________<br/><a class="postlink" href="http://www.natrium42.com" target="_blank">www.natrium42.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62783 - robot - Mon Dec 05, 2005 6:57 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>natrium42 wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
There is Darkain's Multi-NDS source in ndslib (note: not in libnds). Also, you could look at ndsmall loader source (in assembly) in the libnds CVS.
<br/>
<br/>
The steps involved in loading a NDS:
<br/>
1. Clear memory
<br/>
2. Copy ARM7 and ARM9 binaries into memory
<br/>
3. Reset all registers to "initial" values (the hard part)
<br/>
4. Direct ARM9 to the entry point in ARM9 binary
<br/>
5. Direct ARM7 to the entry point in ARM7 binary
<br/>
<br/>
There could be some problems with parts 4 and 5 because some homebrews might rely on a certain timing there. So you need a way to synchronize CPU cores somehow so that they jump to entry points at about the same time.</td> </tr></table><span class="postbody">
<br/>
<br/>
Thanks, this information helps alot.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62805 - chishm - Tue Dec 06, 2005 12:00 am</h4>
    <div class="postbody"><span class="postbody">You may want to check out my <a class="postlink" href="http://chishm.drunkencoders.com/ndsmp" target="_blank">GBAMP firmware replacement</a>.
<br/>
<br/>
It is based on Darkain's loader, but I have fixed a few things with it. It also uses CF cards, so that is closer to what you want. In fact, all that is really needed to make it compatible is to change the CRT0 to remove the GBAMP stuff and then change the CF routines to SD routines<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"><br/><br/>Last edited by chishm on Mon Mar 20, 2006 3:23 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#62866 - robot - Tue Dec 06, 2005 4:26 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote">You may want to check out my <a class="postlink" href="http://www.geocities.com/chishm1/gbamp/ndsmp.zip" target="_blank">GBAMP firmware replacement</a>.
<br/>
<br/>
It is based on Darkain's loader, but I have fixed a few things with it. It also uses CF cards, so that is closer to what you want. In fact, all that is really needed to make it compatible is to change the CRT0 to remove the GBAMP stuff and then change the CF routines to SD routines</td> </tr></table><span class="postbody">
<br/>
<br/>
Thanks, this information is very useful. I have downloaded latest NDSLIB and devkitPro from sourceforge CVS.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
