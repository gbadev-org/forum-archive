<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>[lib] EFS Library v2.0 - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > [lib] EFS Library v2.0</h2>
<div id="posts">
<div class="post">
    <h4>#159186 - Noda - Thu Jun 26, 2008 5:04 pm</h4>
    <div class="postbody"><span class="postbody">Hi, along the release of the new 2.0 version of my EFS lib, I've decided to create a whole new post as the 10 pages old one has became quite hard to find information inside and because it now mostly contains outdated info.
<br/>
<br/>
<br/>
<span style="font-weight: bold">What is the EFS Lib?</span>
<br/>
<br/>
EFS (Embedded File System) is a new set of library / tools to manage files embedded within a NDS binary, like graphic / music / sound / config data, for example.
<br/>
Basically, it?s an appended file system like the old GBFS, but it has many more features and less limitations. It's also more standard, as it makes use of the NitroFS, using ndstool.
<br/>
<br/>
<br/>
<span style="font-weight: bold">What are the most important features of EFS Lib?</span>
<br/>
<br/>
- It works on all slot-1 &amp; 2 cards via DLDI patching, but also on GBA carts
<br/>
- It also works on emulators without any changes in the code
<br/>
- The NDS file path in the card is autodetected and stored within NDS, using unique ID generated by the EFS patcher. The file path is searched only on the first launch, and if the file has moved.
<br/>
- Support reading  &amp; writing file support [writing only works using DLDI]. For writing, space must be already allocated.
<br/>
- It has a complete devoptab integration, so it works the same way as libfat using standard C I/O functions.
<br/>
- It's very fast, and opening a file is way faster than with libfat
<br/>
<br/>
<br/>
<span style="font-weight: bold">How can the EFS Lib be useful for me?</span>
<br/>
<br/>
- You can store all the data (gfx, sfx, music, texts, scripts..) used by your project inside one tidy .nds
<br/>
- You can use way more than 4Mo of data in your program because the data stored inside the EFS is not loaded in RAM when your homebrew is loaded.
<br/>
- You can use it to retrieve the current path of your NDS to avoid the root bloating problem, and write external data in a relative path.
<br/>
- You can use it to test on emulators your existing programs that use libfat without changing anything and using complicated FCSR method, just init EFS as the default device, put your data in the efsroot folder and you're done
<br/>
<br/>
etc etc ;)
<br/>
<br/>
<br/>
<span style="font-weight: bold">Can you tell me more about the retrieval of current path?</span>
<br/>
<br/>
On compile time, space is allocated in your homebrew to store its current path, its unique ID and file size. File size and unique ID is filled by the EFS patcher, usually just after compilation in the makefile.
<br/>
<br/>
On the first launch, the file is quickly searched on whole card, for a match of the stored file size and ID. Once the file is found, its current path is written inside the file itself. The next time the homebrew is launched, this path is checked to verify if the file match ID &amp; file size: if it's the case, no need to search for the file again, we're good, otherwise it means that the file has moved then we go through the search again.
<br/>
<br/>
Q: But as argv is already supported by DKA to provide the current path, isn't your search method obsolete?
<br/>
<br/>
A: Yes, but for now, no existing homebrew loader makes use of that feature. But fortunately, when this will be supported, you'll just have to provide this path as an argument on EFS init, and instead of searching the card, EFS will check the path provided. So you don't have to worry of future problems with using EFS lib, it's already future-proof :)
<br/>
<br/>
<br/>
<span style="font-weight: bold">Download</span>
<br/>
<a class="postlink" href="http://noda.free.fr/nds/efs_lib_v2.0+example.zip" target="_blank">EFS Library + example</a>
<br/>
<a class="postlink" href="http://noda.free.fr/nds/efs_patcher_v1.0.zip" target="_blank">EFS Patcher v1.0 + source code</a></span><span class="gensmall"><br/><br/>Last edited by Noda on Mon Jun 30, 2008 11:18 am; edited 2 times in total</span></div>    
</div>
<div class="post">
    <h4>#159209 - tondopie - Fri Jun 27, 2008 12:12 am</h4>
    <div class="postbody"><span class="postbody">thank you Noda!<br/>_________________<br/><span style="font-weight: bold">Development Blog:</span> <a class="postlink" href="http://teendev.org" target="_blank">http://teendev.org</a>
<br/>
<span style="font-weight: bold">Homebrew Podcast:</span> <a class="postlink" href="http://homebrewcast.net" target="_blank">http://homebrewcast.net</a>
<br/>
<span style="font-weight: bold">Web Design:</span> <a class="postlink" href="http://xtendesign.net" target="_blank">http://xtendesign.net</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#159269 - hewenxie - Sat Jun 28, 2008 1:29 pm</h4>
    <div class="postbody"><span class="postbody">thanks very much! Noda.
<br/>
I meet the problem,
<br/>
I success load the example .nds on emulator, but failed loading on R4 and M3R. Is there need modify something?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#159290 - melw - Sat Jun 28, 2008 7:41 pm</h4>
    <div class="postbody"><span class="postbody">Great stuff! Feature set includes pretty much everything one could hope for -  I guess it's time for me to give EFS lib a try.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#159303 - silent_code - Sat Jun 28, 2008 11:41 pm</h4>
    <div class="postbody"><span class="postbody">Noda, could you anwser this "question"?
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I don't know how (EFS2.0) handle(s) external files, which is important for development, as you don't want to write a big ROM file to your card every time you need to test a new version. This is even more true when sending the .nds over WiFi.
<br/>
</td> </tr></table><span class="postbody">
<br/>
Do I need to write more?
<br/>
<br/>
Having writen that, I can only add, that I'll test EFS2.0 as soon as I get the chance to. Good job. :^)
<br/>
<br/>
(I hope eris isn't too upset about it. ;^) )<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#159305 - kusma - Sun Jun 29, 2008 12:00 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>silent_code wrote:</b></span></td> </tr> <tr> <td class="quote">Noda, could you anwser this "question"?
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I don't know how (EFS2.0) handle(s) external files, which is important for development, as you don't want to write a big ROM file to your card every time you need to test a new version. This is even more true when sending the .nds over WiFi.
<br/>
</td> </tr></table><span class="postbody">
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
<br/>
I know I'm not Noda, but if I've understood the lib correctly; it doesn't. If you want some more abstraction-features, you can add that yourself in your application during development-time (i.e attempting to load from efs: only if not found in fat: or something). What you're requesting isn't really a low-level file-system feature.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#159379 - SiW - Sun Jun 29, 2008 10:53 pm</h4>
    <div class="postbody"><span class="postbody">If I'm not mistaken, the devoptab integration means opening files via libfat is transparently supported, yes?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#159399 - Noda - Mon Jun 30, 2008 7:49 am</h4>
    <div class="postbody"><span class="postbody">SiW&gt; yes, you open files with EFS just like you do with libfat.
<br/>
<br/>
silent_code&gt; Simply switch from EFS to libfat, by using neutral path, ie:
<br/>
<br/>
"/data/mydata.txt"
<br/>
<br/>
then to use EFS or libfat, do at the beginning of your code chdir("efs:/"); or chdir("fat:/");</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#159404 - silent_code - Mon Jun 30, 2008 10:06 am</h4>
    <div class="postbody"><span class="postbody">@ Noda: That's exactly what I expected. Thanks. :^)<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#159439 - silent_code - Mon Jun 30, 2008 10:44 pm</h4>
    <div class="postbody"><span class="postbody">Sorry for the double post!
<br/>
<br/>
Do you know what size footprint EFS2.0 has compared to pure libfat?
<br/>
<br/>
Also, are there any known <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?p=159438#159438" target="_blank">path length problems</a>?<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#159449 - Noda - Tue Jul 01, 2008 8:07 am</h4>
    <div class="postbody"><span class="postbody">I guess the EFS footprint is &lt;size of libfat&gt; + a few kb (I'm not behind my own pc so I can't quickly check, I'll tell you later).
<br/>
<br/>
For the limitations (most are NitroFS limitations)
<br/>
<br/>
- filename lenght: 127 chars
<br/>
- full path lenght: 255 chars
<br/>
- num of files: 61440
<br/>
- num of dirs: 4096</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#159450 - silent_code - Tue Jul 01, 2008 10:39 am</h4>
    <div class="postbody"><span class="postbody">Thank you very much. :^)<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#159613 - SiW - Thu Jul 03, 2008 12:58 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>silent_code wrote:</b></span></td> </tr> <tr> <td class="quote">@ Noda: That's exactly what I expected.</td> </tr></table><span class="postbody">
<br/>
<br/>
Ditto, and thanks from me also.  If I ever have time to get back to my projects I'll make full use of this :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#159916 - oldschoolgamr - Tue Jul 08, 2008 6:22 am</h4>
    <div class="postbody"><span class="postbody">I managed to get EFS V1 working - but want to move to V2 so my project will work on emulators...
<br/>
<br/>
How do I do the following with the new version??? Thanks for any help in advance - long live the homebrew!
<br/>
<br/>
FIRST - I initiate EFS (emu's return "FAT failed to load" or freeze)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">while (efsload==0) {
<br/>
       if(fatInitDefault()) {
<br/>
           if(EFS_Init()) {
<br/>
            PA_OutputText(1,0,0, "Loaded File System. ");
<br/>
            efsload=1;
<br/>
         } 
<br/>
           else {
<br/>
            PA_OutputText(1,0,0, "EFS failed to load");
<br/>
            efsload=2;
<br/>
           }
<br/>
       } 
<br/>
      else {
<br/>
         PA_OutputText(1,0,0, "FAT failed to load");
<br/>
         efsload=2;
<br/>
       }
<br/>
     } </td> </tr></table><span class="postbody">
<br/>
<br/>
THEN - I read the gfx files from EFS and set up a buffer to use
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">//Opens a file and returns a pointer to its location in memory
<br/>
      char* open(char* location){
<br/>
         EFS_FILE* file = EFS_fopen(location);
<br/>
         char* buffer = (char*)malloc(EFS_GetFileSize(file));
<br/>
         EFS_fread(buffer,1,EFS_GetFileSize(file),file);
<br/>
         EFS_fclose(file);
<br/>
         PA_WaitForVBL();
<br/>
         return buffer;
<br/>
      }
<br/>
<br/>
         char* buffer_info; //= open("/Large_Info.bin");
<br/>
         char* buffer_map; //= open("/Large_Map.bin");
<br/>
         char* buffer_tiles; //= open("/Large_Tiles.bin");
<br/>
         char* buffer_pal; //= open("/Large_Pal.bin");</td> </tr></table><span class="postbody">
<br/>
<br/>
Then I can fill the buffer and load any image:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">buffer_info = open("/imageX_Info.bin");
<br/>
         buffer_map = open("/imageX_Map.bin");
<br/>
         buffer_tiles = open("/imageX_Tiles.bin");
<br/>
         buffer_pal = open("/imageX_Pal.bin");
<br/>
         tilesizenum=28032;
<br/>
         mapsizenum=768;                           
<br/>
         
<br/>
      PA_EasyBgLoadEx(1,//screen
<br/>
         3,//bg number
<br/>
         (u32 *)buffer_info,//info
<br/>
         buffer_tiles,//tiles
<br/>
         (u32) tilesizenum,//tile size (this is found in all_gfx.c)
<br/>
         buffer_map,//map
<br/>
         (u32) mapsizenum,//map size (this is found in all_gfx.c)
<br/>
         buffer_pal);//palette</td> </tr></table><span class="postbody">
<br/>
<br/>
Thanks again - hopefully someone can hold by hand through this...!</span><span class="gensmall"><br/><br/>Last edited by oldschoolgamr on Tue Jul 08, 2008 1:42 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#159924 - elhobbs - Tue Jul 08, 2008 12:47 pm</h4>
    <div class="postbody"><span class="postbody">I am not an efs expert and you may have messed up your post, but it looks like you are saying you use efs before you initialize it. If that is so then you probably want to do the init first.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#159925 - oldschoolgamr - Tue Jul 08, 2008 1:40 pm</h4>
    <div class="postbody"><span class="postbody">Oh - sorry - YES, I actually initialize it elsewhere when the program boots up so the order of the commands in the last post should be changed... I had done it a couple of different ways to allow dev bouncing during debug.
<br/>
<br/>
So what I really need is help making this work in V2... it works great in V1 with hardware, but not in emu...
<br/>
<br/>
I edited the original post to fix this confusion... EFS is initialized first... sorry.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160016 - Michoko - Wed Jul 09, 2008 9:12 am</h4>
    <div class="postbody"><span class="postbody">Well, I suppose you're almost there. The only thing to do to migrate is to use the standard C file functions (like fopen, fread, fclose...) instead of the previous specific EFS functions.
<br/>
<br/>
As an example, here is a function which loads a raw file into a buffer:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
u32 EFS_GetFileSize(FILE *file) {
<br/>
 u32 size;
<br/>
 
<br/>
 fseek(file, 0, SEEK_END);  
<br/>
 size = ftell(file);   
<br/>
 fseek(file, 0, SEEK_SET);  
<br/>
 
<br/>
 return(size);
<br/>
}
<br/>
<br/>
<br/>
// Loads a RAW file
<br/>
u8* LoadMediaFile(char* name)
<br/>
{
<br/>
 u8* buffer;
<br/>
 FILE* file;
<br/>
 u32 size
<br/>
<br/>
 file = fopen(name, "rb");
<br/>
 if(file != NULL) 
<br/>
 {
<br/>
     size = EFS_GetFileSize(file);
<br/>
     buffer = malloc(size);
<br/>
     fread(buffer, 1, size, file);
<br/>
     fclose(file);
<br/>
     return(buffer);  
<br/>
 }
<br/>
 else
<br/>
 {
<br/>
   return(NULL);
<br/>
 }
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Good luck
<br/>
<br/>
Michoko</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160021 - Bernie - Wed Jul 09, 2008 12:02 pm</h4>
    <div class="postbody"><span class="postbody">I've been trying to get EFSlib 2.0 to work with PAlib. Using a makefile from an older EFSlib example for PAlib, I got it somewhat working. Something's amiss though, because EFS fails to initialise on the hardware (but works in emulators), yet the libnds example works just fine.
<br/>
<br/>
I think that the problem has something to do with the makefile, which I uploaded here: <a class="postlink" href="http://www.origamihero.com/palibmakefile.rar" target="_blank">http://www.origamihero.com/palibmakefile.rar</a>
<br/>
<br/>
I've been comparing it to the makefile in the libnds example, but it turns out that this is quite a bit beyond my abilities. What could be missing? Thanks in advance for any help.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160057 - Zalo - Wed Jul 09, 2008 10:06 pm</h4>
    <div class="postbody"><span class="postbody">Hi. Before all, congratulations for the lib, it is exactly what I was lookng for just now
<br/>
<br/>
I have been trying to get it work, but I can't completelly do it. Maybe is because what I am trying is not posible. I want to make an application that loads its resources included in the nds but that has an option in game to load a file from the flash card.
<br/>
<br/>
I can only make it work with one of the two options:
<br/>
- Taking all the resources from the .nds (using chdir("efs:/"))
<br/>
- Taking all the resources from the flash card (using chdir("fat:/"))
<br/>
<br/>
The problem is with the initialization. To make it work loading from efs I have to do
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">EFS_Init(EFS_AND_FAT | EFS_DEFAULT_DEVICE, NULL);</td> </tr></table><span class="postbody">
<br/>
<br/>
But to make it work from the flash card I have to write this
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">fatInitDefault();
<br/>
EFS_Init(EFS_ONLY | EFS_DEFAULT_DEVICE, NULL);</td> </tr></table><span class="postbody">
<br/>
<br/>
Otherwise it won't work.
<br/>
<br/>
Anyway maybe It's something weird with the way I compile because I still have to use devKitArm_r20, with r_23 I can't list directories
<br/>
<br/>
Those something like that only happening to me?
<br/>
Can anybody try to write a mixed application reading both from the .nds and from the flash card? I'll really appreciate it ;)
<br/>
<br/>
Anyway, thanks for the lib it is wonderful!<br/>_________________<br/>-----
<br/>
Zalo</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160062 - Bernie - Wed Jul 09, 2008 10:47 pm</h4>
    <div class="postbody"><span class="postbody">Zalo: Hey, thanks! :) By the way, I've found another way, too:
<br/>
<br/>
The makefile line 'include $(DEVKITARM)/ds_rules'  caused efslib not to work for me on slot 1 cards, but replacing it with 'include $(DEVKITARM)/base_rules' works without the need for using EFS_ONLY. Strange.
<br/>
<br/>
Anyway, EFSlib 2.0 is awesome and works great! :D</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160111 - ChronoDK - Thu Jul 10, 2008 3:57 pm</h4>
    <div class="postbody"><span class="postbody">How do I append the efsroot folder to my .nds file?
<br/>
<br/>
I'm guessing the example does it through the makefile, but I'm not sure which lines I'm supposed to transfer to my own makefile. Maybe it can be done using command line stuff as well?
<br/>
<br/>
EDIT: Looks like I fixed it by adding "-d ./efsroot" to the ndstool command in the makefile.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160130 - Polaris - Thu Jul 10, 2008 7:28 pm</h4>
    <div class="postbody"><span class="postbody">This lib sounds really neat and from everyone's comments it seems like it is plain awesome, I got one problem though.
<br/>
<br/>
I don't understand squat about Makefiles :P If I'm using the arm9 Makefile that comes with devkitARM, what do I need to add and where to have this working?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160137 - ChronoDK - Thu Jul 10, 2008 8:57 pm</h4>
    <div class="postbody"><span class="postbody">As I noted above, I just added -d ./efsroot to the ndstool command in the makefile. That's line 25 when using the combined template from the libnds examples.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160140 - silent_code - Thu Jul 10, 2008 9:10 pm</h4>
    <div class="postbody"><span class="postbody">@ Polaris: Read tonc, it includes a small section on makefiles. Or browse any university's computer science site and download some slides. :^)
<br/>
<br/>
You could also read "propper" material about make, like the manual or documentation, of course. ;^)<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160147 - Polaris - Thu Jul 10, 2008 10:13 pm</h4>
    <div class="postbody"><span class="postbody">I'll have to read on some of that sooner or later. But not right now :)
<br/>
<br/>
After staring at the Makefiles for a while I think I got what needed to be copy and pasted, the combined Makefile is slighlty different to the separate ones, I guess because nothing needs to be merged. Everything went just right but a couple of messages caught my attention in the output window of Visual Studio.
<br/>
<br/>
The first which I think I should be worrying about says: <span style="font-weight: bold">"blablabla.nds does not have an EFS section"</span> that sounds troublesome, maybe it has something to do with not trying to Initialize the lib? I hope so. 
<br/>
<br/>
The second I think, might just be a mistake, it reads <span style="font-weight: bold">"*** Embedded File System ID patch tool v1.0 by Noda"</span>. The zip file states pretty clearly that it's <span style="font-weight: bold">v2.0</span>, probably just an inconsecuential mistake.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160171 - kiswa - Thu Jul 10, 2008 11:54 pm</h4>
    <div class="postbody"><span class="postbody">As I understand it, the library is V2.0 and the patcher is V1.0!
<br/>
<br/>
Speaking of which, I have not yet figured out how to compile the patcher for use in Linux.  Anyone help with that?
<br/>
<br/>
I'm trying to figure out how to make the makefile for it to compile in Linux, but that may take me a while....
<br/>
<br/>
EDIT:  Of course, I was being too complicated.  A simple "make efs" worked just fine. :|</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160257 - Polaris - Sat Jul 12, 2008 11:37 pm</h4>
    <div class="postbody"><span class="postbody">Turns out that line saying there was no EFS section on my .nds was there because I didn't initialised EFS. So I got everything working, after all it was just initializing EFS instead of libFat, no biggie.
<br/>
<br/>
I did noticed a couple of strange things in my working demo. 
<br/>
<br/>
The first, the files that I read using libFat weren't read properly by EFS, the program did managed to show the sprite but the colors were all screwed up. Using grit on the images again and using brand new, just like the last binary files, with no changes in the code got me correct results. It was nice that for once one of my ilogic solutions actually worked, but it still was pretty strange.
<br/>
<br/>
The second thing that just happened is that when I tried the .nds on hardware the sprite showed up, but with missing colors, the ones that were in place were ok though. I turned off my DS and tried loading the .nds again and the sprite was there in perfect form. Again, strange behaiviour. 
<br/>
<br/>
Any info on what might be happening?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160266 - tepples - Sun Jul 13, 2008 2:28 am</h4>
    <div class="postbody"><span class="postbody">Might the problem with colors have something to do with unaligned memory accesses?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160360 - ChronoDK - Mon Jul 14, 2008 3:53 pm</h4>
    <div class="postbody"><span class="postbody">My demo is only working in DeSmuME - not in No$GBA and not on hardware when using GBA Movie Player CF. All I get is a black screen. 
<br/>
<br/>
Any idea what could be causing this?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160365 - silent_code - Mon Jul 14, 2008 4:21 pm</h4>
    <div class="postbody"><span class="postbody">That's very little information, ChronoDK. No time for guesses atm.<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160375 - ChronoDK - Mon Jul 14, 2008 6:09 pm</h4>
    <div class="postbody"><span class="postbody">Sorry about that - I can of course show the code I'm using.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   EFS_Init(EFS_ONLY | EFS_DEFAULT_DEVICE, NULL);
<br/>
<br/>
/*videoSetModeSub(MODE_5_2D | DISPLAY_BG0_ACTIVE);
<br/>
   vramSetBankC(VRAM_C_SUB_BG);
<br/>
   SUB_BG0_CR = BG_MAP_BASE(31);
<br/>
   BG_PALETTE_SUB[255] = RGB15(31,31,31);
<br/>
   consoleInitDefault((u16*)SCREEN_BASE_BLOCK_SUB(31), (u16*)CHAR_BASE_BLOCK_SUB(0), 16);
<br/>
   
<br/>
   //Filestream
<br/>
   std::ifstream infile;
<br/>
   infile.open( "list_NPCs.txt" );
<br/>
   std::string str = ""; 
<br/>
   while ( std::getline(infile, str) ) {
<br/>
      std::cout &lt;&lt; str;
<br/>
   }*/
<br/>
<br/>
   lcdMainOnBottom();
<br/>
   videoSetMode( MODE_5_2D | DISPLAY_BG0_ACTIVE | DISPLAY_SPR_ACTIVE | DISPLAY_SPR_1D );   //Main screen uses mode 5 with sprites and one BG active
<br/>
   videoSetModeSub( MODE_5_2D | DISPLAY_BG0_ACTIVE );   //Sub screen has the same configuration
<br/>
   vramSetBankA(VRAM_A_MAIN_BG);                  //1 x 128kb for main background
<br/>
   vramSetBankB(VRAM_B_MAIN_SPRITE);               //1 x 128kb for main sprites
<br/>
   vramSetBankC(VRAM_C_SUB_BG);                  //1 x 128kb for sub background
<br/>
<br/>
   BG0_CR = BG_32x32 | BG_COLOR_256 | BG_MAP_BASE(0) | BG_TILE_BASE(1);
<br/>
   SUB_BG0_CR = BG_32x32 | BG_COLOR_256 | BG_MAP_BASE(0) | BG_TILE_BASE(1);
<br/>
<br/>
   //The address of the tile and map blocks 
<br/>
   u8* tileMemoryMain = (u8*)BG_TILE_RAM(1);
<br/>
   u16* mapMemoryMain = (u16*)BG_MAP_RAM(0);
<br/>
   u8* tileMemorySub = (u8*)BG_TILE_RAM_SUB(1);
<br/>
   u16* mapMemorySub = (u16*)BG_MAP_RAM_SUB(0);
<br/>
<br/>
   //Read BG0 palette file to memory
<br/>
   std::ifstream infile( "mainmenu_BG0_MAIN.pal.bin", std::ifstream::binary );
<br/>
   infile.read((char*)BG_PALETTE, 256 * 2);
<br/>
   infile.close();
<br/>
   infile.clear();
<br/>
<br/>
   //Read BG0 tiles from file to tile memory
<br/>
   infile.open( "mainmenu_BG0_MAIN.img.bin", std::ifstream::binary );
<br/>
   infile.seekg(0, std::ifstream::end);
<br/>
   long size = infile.tellg();
<br/>
   infile.seekg(0);
<br/>
   infile.read((char*)tileMemoryMain, size);
<br/>
   infile.close();
<br/>
   infile.clear();
<br/>
<br/>
   //Read BG0 map from file to map memory
<br/>
   infile.open( "mainmenu_BG0_MAIN.map.bin", std::ifstream::binary );
<br/>
   infile.read((char*)mapMemoryMain, 32 * 32 * 2);
<br/>
   infile.close();
<br/>
   infile.clear();
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
With the above code, all I get is a black screen on hardware and no$gba - it works in desmume. The code that is commented out works just fine in no$gba as well - it prints a lot of text from that file - but it does not work on hardware either.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160407 - ChronoDK - Tue Jul 15, 2008 8:55 am</h4>
    <div class="postbody"><span class="postbody">Hmm, the problem might not be EFS related actually. I think I'm not reading/writing stuff correctly. How and where should I use 16-bit reads/writes?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160420 - Bernie - Tue Jul 15, 2008 1:50 pm</h4>
    <div class="postbody"><span class="postbody">A quick question, if I may - is writing to files with EFS on emulators still not possible at the moment?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160426 - silent_code - Tue Jul 15, 2008 4:33 pm</h4>
    <div class="postbody"><span class="postbody">I hear it's possible, but you have to preallocate the files. I'm not sure, though.<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160455 - Polaris - Wed Jul 16, 2008 6:44 am</h4>
    <div class="postbody"><span class="postbody">According to Noda's first post that's precisely what you need to do. But it also says that you need DLDI support, so I guess that leaves emulators with no file writting, am I right?
<br/>
<br/>
tepples: Thanks for the tip, I think I solved my problem.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160460 - silent_code - Wed Jul 16, 2008 9:02 am</h4>
    <div class="postbody"><span class="postbody">... Unless FCSR does support file writing. ;^)
<br/>
(Which I don't know.)<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160478 - ChronoDK - Wed Jul 16, 2008 6:52 pm</h4>
    <div class="postbody"><span class="postbody">I'm definitely doing something wrong. I can open the files and I can read strings from text files, but when I try to copy stuff to VRAM I get a black screen on hardware. Can someone see what I'm doing wrong below? And how do I fix it?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
//Read BG0 palette file to memory
<br/>
   std::ifstream infile( "mainmenu_BG0_MAIN.pal.bin", std::ifstream::binary );
<br/>
   for (int i = 0; i &lt; 256; i++) {
<br/>
      u16* x = 0;
<br/>
      infile.read((char*)x, 2);
<br/>
      BG_PALETTE[i] = *x;
<br/>
   }
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160479 - elhobbs - Wed Jul 16, 2008 7:28 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ChronoDK wrote:</b></span></td> </tr> <tr> <td class="quote">I'm definitely doing something wrong. I can open the files and I can read strings from text files, but when I try to copy stuff to VRAM I get a black screen on hardware. Can someone see what I'm doing wrong below? And how do I fix it?
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
//Read BG0 palette file to memory
<br/>
   std::ifstream infile( "mainmenu_BG0_MAIN.pal.bin", std::ifstream::binary );
<br/>
   for (int i = 0; i &lt; 256; i++) {
<br/>
      u16* x = 0;
<br/>
      infile.read((char*)x, 2);
<br/>
      BG_PALETTE[i] = *x;
<br/>
   }
<br/>
</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">u16* x = 0</td> </tr></table><span class="postbody"> x should be a buffer to read data into, you have it pointing at a null pointer. I am surprised this does not give an access violation and die. a quick hack would be</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">//Read BG0 palette file to memory 
<br/>
   std::ifstream infile( "mainmenu_BG0_MAIN.pal.bin", std::ifstream::binary ); 
<br/>
   for (int i = 0; i &lt; 256; i++) { 
<br/>
      u16 x; 
<br/>
      infile.read((char*)&amp;x, 2); 
<br/>
      BG_PALETTE[i] = x; 
<br/>
   } 
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160489 - ChronoDK - Wed Jul 16, 2008 8:43 pm</h4>
    <div class="postbody"><span class="postbody">Whow, newbie mistake! Thank you! Backgrounds work on hardware now. Unfortunately, sprites wont work using that method. Is there a quick hack to fix this one as well? 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
//The sprite and palette memory adresses
<br/>
   u16* spritePalMain = SPRITE_PALETTE;
<br/>
   u16* spriteMemMain = SPRITE_GFX;
<br/>
<br/>
   //Read sprite palette file to memory
<br/>
   infile.open( (path + m_sprite + ".pal.bin").c_str(), std::ifstream::binary );
<br/>
   for (int i = 0; i &lt; 16; i++) {
<br/>
      u16 x = 0;
<br/>
      infile.read((char*)&amp;x, 2);
<br/>
      spritePalMain[i + (m_palIndex * 16)] = x;
<br/>
   }
<br/>
   infile.close();
<br/>
   infile.clear();
<br/>
<br/>
//Read sprite data from file to sprite memory
<br/>
   infile.open( (path + m_sprite + ".img.bin").c_str(), std::ifstream::binary );
<br/>
   infile.seekg(0, std::ifstream::end);
<br/>
   long size = infile.tellg();
<br/>
   infile.seekg(0);
<br/>
    for (int i = 0; i &lt; size/2; i++) {
<br/>
      u16 x = 0;
<br/>
      infile.read((char*)&amp;x, 2);
<br/>
      spriteMemMain[i + (m_tileIndex * 16)] = x;
<br/>
   }
<br/>
   infile.close();
<br/>
   infile.clear();
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160496 - silent_code - Wed Jul 16, 2008 8:57 pm</h4>
    <div class="postbody"><span class="postbody">Random, unrelated tip:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">      uint16 *spritePalMain = &amp;SPRITE_PALETTE[(m_palIndex * 16)];
<br/>
      ...
<br/>
      for (int i = 0; i &lt; 16; i++) {
<br/>
      u16 x = 0;
<br/>
      infile.read((char*)&amp;x, 2);
<br/>
      *spritePalMain++ = x; // I am very sleepy and I don't know, if that line would cause trouble - at least not off my head and not right now. Split the increment when it doesn't work as expected.
<br/>
   } </td> </tr></table><span class="postbody">
<br/>
(Untested, but you sure get the idea - it should be faster.)
<br/>
<br/>
EDIT: Yes, there should be some dereferencing. :^D
<br/>
<br/>
And what exactly does not work? How do your "corrupted" sprites look like?<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"><br/><br/>Last edited by silent_code on Wed Jul 16, 2008 11:41 pm; edited 2 times in total</span></div>    
</div>
<div class="post">
    <h4>#160500 - DensitY - Wed Jul 16, 2008 9:41 pm</h4>
    <div class="postbody"><span class="postbody">Are your source sprites in tile format already? (assuming your loading 1D tiled Sprites). 
<br/>
<br/>
data must be stored in 8x8 tiles in 1d Tiled mode. so say you had 32x32 sprite, you'd read take the first 2 lines of that and store that in a 8x8 tile box, rince repeat (with a 32x32 sprite you'd end up with 4x4 blocks of 8x8 tiles).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160502 - silent_code - Wed Jul 16, 2008 9:52 pm</h4>
    <div class="postbody"><span class="postbody">... Or let grit export it propperly. ;^)<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160503 - ChronoDK - Wed Jul 16, 2008 10:05 pm</h4>
    <div class="postbody"><span class="postbody">So embarrassing... I forgot to remove that null pointer mistake from my animation code as well. It works now. Thanks everyone, and sorry about that...
<br/>
<br/>
I am using grit and 1D sprites by the way.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160504 - DensitY - Wed Jul 16, 2008 10:08 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
*spritePalMain++ = x;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
just noticed it should of been that lolol..</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160506 - ChronoDK - Wed Jul 16, 2008 10:24 pm</h4>
    <div class="postbody"><span class="postbody">Yep ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160507 - Apache Thunder - Wed Jul 16, 2008 10:26 pm</h4>
    <div class="postbody"><span class="postbody">EFS sounds great. I want to use this to make for example an existing NDS application access EFS instead of DLDI (aka access storage device). How do I do this?
<br/>
<br/>
Does this require me to edit the source code of the application I want to use this (like Moonshell for example, I want to add EFS to that).
<br/>
<br/>
If only adding EFS was as simple as DLDI patching a rom.
<br/>
<br/>
This would prove usefull since I am using the WMB app that yellowstar modded (original app made by Juglak). The rom I send to the client won't have storage device to use obvoisly since it will be in the DS's internal ram only. No other devices attached, so I would like to get that rom to be completly self-contained using EFS.
<br/>
<br/>
the FCSR method is the only method I know of right now that doesn't involve source code edits of the NDS program inquestion. Right now it looks like EFS is even more a mess to work with then FCSR method simply because I won't beable to compile some apps. Like Moonshell for example. Its source code is too much of a mess to recompile, so I won't beable to do any source code changes to it.
<br/>
<br/>
I tried the EFS patcher, but it complains about the NDS not having a "EFS Section"
<br/>
<br/>
Perhaps you can make a "EFS DLDI Driver" so that a DLDI capable app can access its efs area instead of the device its running on. Playing with the source code of the app is out of the question for me, since there is a lot of apps out there that won't compile without significant source code changes. I lack any programming knowledge for the DS, so this will be impossible for me.<br/>_________________<br/>Sig under construction...Please check back after the sun explodes....</span><span class="gensmall"><br/><br/>Last edited by Apache Thunder on Fri Jul 18, 2008 10:00 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#160511 - silent_code - Wed Jul 16, 2008 11:46 pm</h4>
    <div class="postbody"><span class="postbody">@ AT: You should inform yourself about libfat, DLDI and EFS before setting yourself such a task. Many of your questions can be answered by the existing descriptions and FAQs. ;^)
<br/>
FCSR is a DLDI driver for use with libfat, whereas EFS can be considered an alternative to libnds.
<br/>
Replacing libfat with EFS isn't exactly a platform specific programming task. I believe it's rather trivial to move from libfat to EFS, especially as both can be present in a single program... ;^)<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160518 - Apache Thunder - Thu Jul 17, 2008 4:11 am</h4>
    <div class="postbody"><span class="postbody">Well it isn't trivial at all if I wanted to do this with Moonshell or DSOrganize! The source code for that uses really old devkitarm and it would be a pain to get all that to compile right and still keep the new version of DevkitARM for the modern source coded apps. 
<br/>
<br/>
I still have no idea what version is required to compile Moonshell/DSOrganize, and as far as I know there is no place on the internet that I can even find the source code for the last version of Moonshell. (the author's homepage no longer works)
<br/>
<br/>
And quite frankly, its not worth finding the old version of DevkitARM and installing it along side the new one (without braking anything) just to compile a few selective apps.
<br/>
<br/>
To us "non-coders", simply compiling the source code can be a pain in ass!
<br/>
<br/>
So I request that someone make a EFS DLDI driver for libfat!<br/>_________________<br/>Sig under construction...Please check back after the sun explodes....</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160529 - silent_code - Thu Jul 17, 2008 9:50 am</h4>
    <div class="postbody"><span class="postbody">Oh, I was just talking about replacing the filesystem handling libraries, not upgrading anything. That are two different tasks. Sure you would have either to get an old version of the libs and devkit (that is not a problem, if you have a good IDE) or update the codebase, but even that can all be done in a few hours or days, depending on your skills.
<br/>
<br/>
If you are not a programmer, then don't set yourself such tasks. Maybe you know somebody who can help you with his programming knowledge?
<br/>
Or you start small and learn to program.
<br/>
<br/>
If I had the time, I'd give it a shot. Sorry. :^/
<br/>
<br/>
Again: Don't mix up things that don't belong together! I doubt it is possible to make anything like a EFS DLDI driver... that doesn't make any sense to me. EFS and libfat are two distinctive filesystem handling libraries!
<br/>
<br/>
And what do you want to use MS / DSO for anyway? I doubt you can do very much with a (max.) 3.75MB ROM including the filesystem. Especially knowing the size of DSO (around 8MB) and MS (around 1.4MB).<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#162847 - kiswa - Sun Sep 14, 2008 4:25 am</h4>
    <div class="postbody"><span class="postbody">I have a problem with using EFSlib 2 in Linux.
<br/>
<br/>
I compile my code under Windows XP and it works great.  Exactly the same code under Linux and EFS fails to initialize.  I don't know what else is different between the two besides the EFS Patcher.
<br/>
<br/>
Anyone have any ideas?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#162950 - kiswa - Tue Sep 16, 2008 11:50 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>kiswa wrote:</b></span></td> </tr> <tr> <td class="quote">I have a problem with using EFSlib 2 in Linux.
<br/>
<br/>
I compile my code under Windows XP and it works great.  Exactly the same code under Linux and EFS fails to initialize.  I don't know what else is different between the two besides the EFS Patcher.
<br/>
<br/>
Anyone have any ideas?</td> </tr></table><span class="postbody">
<br/>
<br/>
I've narrowed it down to the EFS patcher.  I took the .nds file that wasn't working and used the Windows EFS patcher on it.  It then ran on hardware.
<br/>
<br/>
Anyone have a Linux EFS patcher known to work that they could upload?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163003 - kiswa - Thu Sep 18, 2008 12:59 pm</h4>
    <div class="postbody"><span class="postbody">Really?  Nothing for two days....
<br/>
<br/>
I can't believe no one else has had trouble compiling EFS stuff on Linux.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163011 - kusma - Thu Sep 18, 2008 3:36 pm</h4>
    <div class="postbody"><span class="postbody">kiswa: This might be a stupid question, but are your CPU 64 bit (Core2 CPUs are), and in that case have you tried to compile the patcher with gcc's -m32 flag?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163017 - kiswa - Thu Sep 18, 2008 7:41 pm</h4>
    <div class="postbody"><span class="postbody">It's an old laptop that barely runs Linux, so no, not dual core or x64.
<br/>
<br/>
That said, all I did was </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">make efs</td> </tr></table><span class="postbody"> and it seemed to work.  Should I have done something different?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163250 - mml - Sat Sep 27, 2008 9:02 am</h4>
    <div class="postbody"><span class="postbody">Found an array overrun :P
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">source/efs_lib.c: In function 'EFS_Init':
<br/>
source/efs_lib.c:551: warning: array subscript is above array bounds</td> </tr></table><span class="postbody">
<br/>
<br/>
Here's the relevant snippet:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">        // if nds file is found, open it and read the header
<br/>
        if(found) {
<br/>
***            char buffer[5];
<br/>
<br/>
            nds_file = open(efs_path, O_RDWR);
<br/>
<br/>
            // check for if a loader is present
<br/>
            lseek(nds_file, EFS_LOADERSTROFFSET, SEEK_SET);
<br/>
***            read(nds_file, buffer, 6);
<br/>
***            buffer[7] = '\0';</td> </tr></table><span class="postbody">
<br/>
<br/>
Any particular reason that buffer is declared as only 5 chars long?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163482 - gauauu - Fri Oct 03, 2008 3:35 am</h4>
    <div class="postbody"><span class="postbody">License question:  I see that the EFS patcher is GPL'd, but the library itself doesn't seem to specify a license.  Is there a certain license I need to follow to use it?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164966 - Chase-san - Thu Dec 04, 2008 11:24 am</h4>
    <div class="postbody"><span class="postbody">I seem to have a problem, the nds I compile runs fine on the emu, but it fails to run on the hardware.. Any idea why this happens?
<br/>
<br/>
I do patch it with the EFS patcher and dldi tool. I have tried it with only efs and only the dldi, same result.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165007 - silent_code - Fri Dec 05, 2008 10:14 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Chase-san wrote:</b></span></td> </tr> <tr> <td class="quote">I seem to have a problem, the nds I compile runs fine on the emu, but it fails to run on the hardware.. Any idea why this happens?
<br/>
<br/>
I do patch it with the EFS patcher and dldi tool. I have tried it with only efs and only the dldi, same result.</td> </tr></table><span class="postbody">
<br/>
This is way to generic. There are a lot of possible causes, that have nothing to do with EFS, but can lock up the hardware.
<br/>
<br/>
Make sure you check all your settings twice and use some printouts to the console to find out where the problem manifests.
<br/>
<br/>
Good luck.<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165084 - Chase-san - Tue Dec 09, 2008 2:48 pm</h4>
    <div class="postbody"><span class="postbody">I had already done all of that, really I think it may just be not finding the nds file on the fs. But i'll do some further research (or switch to gbfs).
<br/>
<br/>
EDIT: I figured it out, thanks though.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165101 - silent_code - Tue Dec 09, 2008 9:36 pm</h4>
    <div class="postbody"><span class="postbody">What was the problem?<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165242 - robertre2 - Sun Dec 14, 2008 7:13 pm</h4>
    <div class="postbody"><span class="postbody">Fixed EFS problem in linux.
<br/>
<br/>
Replace line 149 of efs.c with
<br/>
new_id = rand()%65536;
<br/>
(original was new_id=rand();)
<br/>
<br/>
The problem is that in Windows the maximum random number is 2^16 instead of 2^32. This results in two bytes in the file not being equal to zero.
<br/>
<br/>
This fixes the problem in Linux (at least it did for me).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165323 - tepples - Wed Dec 17, 2008 6:07 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>robertre2 wrote:</b></span></td> </tr> <tr> <td class="quote">The problem is that in Windows the maximum random number is 2^16 instead of 2^32. This results in two bytes in the file not being equal to zero.
<br/>
<br/>
This fixes the problem in Linux (at least it did for me).</td> </tr></table><span class="postbody">
<br/>
If you're relying on assumptions about implementation-defined behavior, you can detect problems earlier with compile-time assertions. This macro creates a line of code that fails to compile if expr is false:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define CTASSERT(name, expr) extern char name[(expr) ? 1 : -1]</td> </tr></table><span class="postbody">
<br/>
If expr is false, it makes an array whose size is negative, causing the compiler to stop and spit out a diagnostic. You use it like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include &lt;limits.h&gt;
<br/>
#include &lt;stdlib.h&gt;
<br/>
CTASSERT(cta_eightBitChars, CHAR_BIT == 8);
<br/>
CTASSERT(cta_randMax16, RAND_MAX &lt;= 65535);</td> </tr></table><span class="postbody"><br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165649 - ritz - Thu Jan 01, 2009 7:41 pm</h4>
    <div class="postbody"><span class="postbody">Any info on the EFS lib being updated to work with devkitARM 24?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165650 - zazery - Thu Jan 01, 2009 9:04 pm</h4>
    <div class="postbody"><span class="postbody">I am using EFS Lib 2.0 with devkitARM r24 and libnds 1.3.1 and have not run into any problems. I have noticed the array overrun that mml reported and a couple warnings about incompatible pointer types but that is it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165653 - ritz - Fri Jan 02, 2009 12:48 am</h4>
    <div class="postbody"><span class="postbody">I fixed those things too, but I guess my real question is if the author is still around doing updates/releases or if I should just continue to modify my own copy of the library.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165796 - MaesterRowen - Wed Jan 07, 2009 5:59 am</h4>
    <div class="postbody"><span class="postbody">Hey guys, I am just getting onboard with this library and I have run into a snag unfortunately.
<br/>
<br/>
Hardware I am using:
<br/>
CycloDS Evoluvtion 
<br/>
I have an 8gb SDHC card
<br/>
<br/>
<br/>
My problem is that the EFS_Init function is hanging on the "searchdirectory()" function.  The code works fine on an emulator, but on the hardware, it'll hang.
<br/>
<br/>
<br/>
Now I am curious, if this is just an extremely slow search, or maybe I have a problem elsewhere that I am overlooking.  I have had the program running for about 5 minutes now, and it hasnt found anything, so that leads me to believe something fishy is going on.
<br/>
<br/>
If anyone else has experienced this problem, do you think you could offer some help?
<br/>
<br/>
Thanks!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165797 - ritz - Wed Jan 07, 2009 6:13 am</h4>
    <div class="postbody"><span class="postbody">I had the exact same problem, I changed my code to use opendir and readdir (thx elhobbs). Works just fine now. Here's the post about it:
<br/>
<a href="http://forum.gbadev.org/viewtopic.php?p=165695#165695" target="_blank">http://forum.gbadev.org/viewtopic.php?p=165695#165695</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165798 - MaesterRowen - Wed Jan 07, 2009 7:03 am</h4>
    <div class="postbody"><span class="postbody">I am not sure I completely understand the changes required (still relatively new, so bear with me:).
<br/>
<br/>
I need to change the diropen(".") to opendir(".")?
<br/>
<br/>
What do I change to readdir?
<br/>
<br/>
Thanks ^_^</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165800 - MaesterRowen - Wed Jan 07, 2009 7:35 am</h4>
    <div class="postbody"><span class="postbody">Actually, scratch the top comment.  I figured it out.  I had to basically re-write the SearchDirectory Function to work with the new commands.  Pretty simple when following the libfat example.
<br/>
<br/>
Thanks for pointing me to the right direction.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167469 - headspin - Fri Mar 13, 2009 2:17 am</h4>
    <div class="postbody"><span class="postbody">Has anyone got this working on a GBA Movie Player? When I run the demo I get "EFS init OK!" "Found NDS path: GBA ROM" then I press the A button and it goes into a loop saying
<br/>
<br/>
FILE: /, size: xxxxx bytes
<br/>
<br/>
Where xxxxx bytes keeps incrementing and then resetting back to zero.
<br/>
<br/>
I also tried a custom demo which runs fine on No$ but goes to a black screen on the MP.<br/>_________________<br/><a class="postlink" href="http://headsoft.com.au/index.php?category=warhawk" target="_blank">Warhawk DS</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=mmll" target="_blank">Manic Miner: The Lost Levels</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=tdg" target="_blank">The Detective Game</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167475 - NinjaCoder - Fri Mar 13, 2009 10:06 am</h4>
    <div class="postbody"><span class="postbody">if i'm just going to load data fom the EFS is it better to just use the GBFS that comes whit devkit pro, or is it recomended to still use EFSLIB?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167477 - headspin - Fri Mar 13, 2009 1:39 pm</h4>
    <div class="postbody"><span class="postbody">So here are some tests of my demo (which loads an image into a buffer and dma's it to both screens) and the official directory demo included with EFS
<br/>
<br/>
No$GBA - Both work
<br/>
R4 - Mine doesn't work (black screens), but the dir demo does work
<br/>
M3 - Both work
<br/>
DSLink - Both don't work (white screens)
<br/>
MP - Both don't work (some image flickers on for a moment then black) / the dir demo does as described in my previous post
<br/>
<br/>
I'm really confused about it not working on the R4.<br/>_________________<br/><a class="postlink" href="http://headsoft.com.au/index.php?category=warhawk" target="_blank">Warhawk DS</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=mmll" target="_blank">Manic Miner: The Lost Levels</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=tdg" target="_blank">The Detective Game</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167494 - headspin - Sat Mar 14, 2009 7:37 am</h4>
    <div class="postbody"><span class="postbody">It seems the problem I was having was because of the new libfat in devkitARM r25. For anyone else who would like to use EFS in r25 you can download an updated example from <a class="postlink" href="http://members.iinet.net.au/~freeaxs/nds/efs_lib.zip" target="_blank">here</a>.
<br/>
<br/>
Incidently I didn't need to change to use opendir or readdir but the following code in efs_lib.h
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">// defines
<br/>
#define EFS_MAXPATHLEN  768
<br/>
#define EFS_MAXNAMELEN  128
<br/>
<br/>
// the NDS file path, dynamically set by the lib
<br/>
extern char efs_path[EFS_MAXPATHLEN];</td> </tr></table><span class="postbody">
<br/>
<br/>
If anyone can say for sure if I should move to use opendir and readdir instead please let me know. But AFAIK the above fixes the problem although it still does not work on the GBA Movie Player.<br/>_________________<br/><a class="postlink" href="http://headsoft.com.au/index.php?category=warhawk" target="_blank">Warhawk DS</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=mmll" target="_blank">Manic Miner: The Lost Levels</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=tdg" target="_blank">The Detective Game</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167496 - headspin - Sat Mar 14, 2009 5:39 pm</h4>
    <div class="postbody"><span class="postbody">EDIT: Okay it seems like EFS works with all the flash carts I've tried now, except for the GBA Movie Player.<br/>_________________<br/><a class="postlink" href="http://headsoft.com.au/index.php?category=warhawk" target="_blank">Warhawk DS</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=mmll" target="_blank">Manic Miner: The Lost Levels</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=tdg" target="_blank">The Detective Game</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167646 - renatobs - Sat Mar 21, 2009 7:10 am</h4>
    <div class="postbody"><span class="postbody">Hi. I?m a brazilian developer ( newby ) and my english is not good but I think that you?ll understand me. I?m developing a remake of the game and I already have a lot of thing of the game finished, but now I need to use LIBFAT to imrpoved my "cart space". 
<br/>
I have read a lot about EFS but I?m very confused with a lot of things. I have studied the exemples and I could got some ideias. Does not the EFS working in NO$GBA ?! In my real NDS with EZFlashV the most of them are working... Need I to do some special thing to these files working on No$gba ? 
<br/>
My main problem now is that I?m putting "mp3" files in my game. I?m using the AS_Lib ( that is so fantastic ) and I can play "mp3" and "sound efeccts" together without problems. These is excelent !!! But now I can?t do more things cuz the cart became almost 4Mb. I need to put the "Mp3" files out of RAM, using the "Mp3 Strem Player". Unfortunaly NODA is out ( I guess ) cuz I can?t a answer from him. Then I?d like a help from someone here, cuz "you are a kind of GOD?s of development in NDS". 
<br/>
Well, these are my problems:
<br/>
<br/>
- I need that someone detect what?s happen with "AS_Lib" that it can?t play "MP3 stream" by "FAT" or "ESF_FAT" ;
<br/>
<br/>
- In the case that I can?t solve this problem, is there some way to play the MP3 change these in the RAM ? The Direct Play of AS_Lib play a MP3 from RAM, but when I compile the code, the compiler create 2 files from MP3 ( *.o and *.h ), one have the codes of MP3 and other the headers with name and size. How could I change these in the RAM ? Creating a volatile array and put there a mp3 to play ?!?
<br/>
<br/>
- If I have a "image" file converted by "pcx2gba" with a "data" and "pal" arrays, how can I put these in a FAT dir, read and put in VRAM, for exemple ?! Usually I use the "swicopy" or "dmacopy" with a pointer to tranfer the arrays to VRAM, but the files are in RAM, included in the code, and them get space of.
<br/>
<br/>
I don?t know if I wrote understandably... If not, sorry !! Please, I need some help and i?ll be so grateful !!!
<br/>
<br/>
Thanks !!
<br/>
<br/>
PS.: here is my game: 
<br/>
- <a href="http://br.youtube.com/watch?v=oHwqK46bE50" target="_blank">http://br.youtube.com/watch?v=oHwqK46bE50</a>
<br/>
- <a href="http://forums.shiningforcecentral.com/index.php?showtopic=12564" target="_blank">http://forums.shiningforcecentral.com/index.php?showtopic=12564</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167652 - headspin - Sat Mar 21, 2009 10:59 am</h4>
    <div class="postbody"><span class="postbody">To get EFS lib working with the latest version of devkitARM you should download my updated version <a class="postlink" href="http://members.iinet.net.au/~freeaxs/nds/efs_lib.zip" target="_blank">here</a>. You will need to copy the mp3's to the efsroot folder and reference them as "/MyFolder/MySong.mp3". If you have them in the root of efsroot then just use "/MySong.mp3".
<br/>
<br/>
One other change I forgot to do in my update is in efs_lib.c you should put
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">"efs_path:                                                                              \n"
<br/>
"   .skip   768             @ Path of the rom                                           \n"</td> </tr></table><span class="postbody">
<br/>
<br/>
The reason for this is the max file length changed in the latest versions of fatlib and because of this the SearchDirectory function would fail to find the .nds file.
<br/>
<br/>
Now to access the your mp3's you can use
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">file = fopen("/MySong.mp3","rb");</td> </tr></table><span class="postbody">
<br/>
<br/>
And now you can use standard functions from stdio.h to read the file into a buffer to play or you can stream the music from the buffer and refill it using timers. Just be aware that fseek can be a bit slow so I would just use fread() instead and avoid fseek if you can. fread() will move the file pointer the amount of bytes read so you should not need to fseek().
<br/>
<br/>
ndstool attaches the files in efsroot to the end of the ROM so you will not get an .o or .h created. And yes it should work fine in No$GBA as well as on any card with dldi support.<br/>_________________<br/><a class="postlink" href="http://headsoft.com.au/index.php?category=warhawk" target="_blank">Warhawk DS</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=mmll" target="_blank">Manic Miner: The Lost Levels</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=tdg" target="_blank">The Detective Game</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167661 - renatobs - Sat Mar 21, 2009 2:06 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for your help. But, I still have problems with AS_Lib... when I turn on the option to use EFS lib or only FAT, this don?t work... the compiler work with the FAT option, but the MP3 don?t play, and the compiler don?t work with EFS cuz I receive a error message about the variable "mp3file" that have some problem with EFS... ASL_Lib only work with "DirectPlay" mode, that read the mp3 from RAM... then "StreamPlay", tha use FAT/EFS mode don?t  work...
<br/>
And about the tiles background reading from FAT, could you help me with some ideia !!! I have a pointer like "u8* tileMemory  = ( u8*)BG_TILE_RAM(1);" where I use like a pointer to put a tiles of background. I?d like to put the information (data) of tiles in a directory and after read and put there. Could I put a "data[]" and "pal[]" in a file inside a directory (FAT) and read after ?!?
<br/>
<br/>
Sorry for my english !!!
<br/>
<br/>
<br/>
Thanks again for your help !!!
<br/>
<br/>
PS.: for me ( and I think that for some other people ) is very important a help to AS_Lib... NODA is responsible by AS_Lib and EFS_lib, but he?s out a long time... Any help with AS_lib will be great !!!!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167800 - renatobs - Sat Mar 28, 2009 5:31 pm</h4>
    <div class="postbody"><span class="postbody">Hi. I?m a brazilian developer ( newby ) and my english is not good but I think that you?ll understand me. I?m developing a remake of the game and I already have a lot of thing of the game finished, but now I need to use LIBFAT to imrpoved my "cart space". 
<br/>
I have read a lot about Chishm FAT but I?m very confused with a lot of things. I have studied the exemples and I could got some ideias. Does not the EFS working in NO$GBA ?! In my real NDS with EZFlashV the most of them are working... Need I to do some special thing to these files working on No$gba ? 
<br/>
My main problem now is that I?m putting "mp3" files in my game. I?m using the AS_Lib ( that is so fantastic ) and I can play "mp3" and "sound efeccts" together without problems. These is excelent !!! But now I can?t do more things cuz the cart became almost 4Mb. I need to put the "Mp3" files out of RAM, using the "Mp3 Strem Player". Unfortunaly NODA is out ( I guess ) cuz I can?t a answer from him. Then I?d like a help from someone here, cuz "you are a kind of GOD?s of development in NDS". 
<br/>
Well, these are my problems: 
<br/>
<br/>
- I need that someone detect what?s happen with "AS_Lib" that it can?t play "MP3 stream" by "FAT", "ESF_FAT" or try change to "Chishm FAT"; 
<br/>
<br/>
- In the case that I can?t solve this problem, is there some way to play the MP3 change these in the RAM ? The Direct Play of AS_Lib play a MP3 from RAM, but when I compile the code, the compiler create 2 files from MP3 ( *.o and *.h ), one have the codes of MP3 and other the headers with name and size. How could I change these in the RAM ? Creating a volatile array and put there a mp3 to play ?!? 
<br/>
<br/>
- If I have a "image" file converted by "pcx2gba" with a "data" and "pal" arrays, how can I put these in a Chishm FAT dir, read and put in VRAM, for exemple ?! Usually I use the "swicopy" or "dmacopy" with a pointer to tranfer the arrays to VRAM, but the files are in RAM, included in the code, and them get space of. 
<br/>
<br/>
I don?t know if I wrote understandably... If not, sorry !! Please, I need some help and i?ll be so grateful !!! 
<br/>
<br/>
Thanks !! 
<br/>
<br/>
PS.: here is my game: 
<br/>
- <a href="http://br.youtube.com/watch?v=oHwqK46bE50" target="_blank">http://br.youtube.com/watch?v=oHwqK46bE50</a>
<br/>
- <a href="http://forums.shiningforcecentral.com/index.php?showtopic=12564" target="_blank">http://forums.shiningforcecentral.com/index.php?showtopic=12564</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167809 - josath - Sun Mar 29, 2009 5:35 am</h4>
    <div class="postbody"><span class="postbody">renatobs, can you please stop posting the same exact message everywhere? You've posted it at least three times now.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167816 - renatobs - Sun Mar 29, 2009 2:50 pm</h4>
    <div class="postbody"><span class="postbody">sorry...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168184 - Jesse - Tue Apr 14, 2009 6:30 am</h4>
    <div class="postbody"><span class="postbody">I just wanted to confirm the EFSlib with the changes posted by headspin works well with the latest version of libnds.<br/>_________________<br/><a href="http://www.collectingsmiles.com/colors" target="_blank">http://www.collectingsmiles.com/colors</a> &amp; <a href="http://www.collectingsmiles.com/hyena" target="_blank">http://www.collectingsmiles.com/hyena</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168389 - Jesse - Mon Apr 27, 2009 1:16 am</h4>
    <div class="postbody"><span class="postbody">I ran into a new problem though. When EFSlib searches directories it eats up 1648 bytes of the stack for each recursion, and crashes when the 16k stack runs out. I guess it would be best to change that code to dynamically allocate memory instead.<br/>_________________<br/><a href="http://www.collectingsmiles.com/colors" target="_blank">http://www.collectingsmiles.com/colors</a> &amp; <a href="http://www.collectingsmiles.com/hyena" target="_blank">http://www.collectingsmiles.com/hyena</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168415 - a128 - Tue Apr 28, 2009 4:46 pm</h4>
    <div class="postbody"><span class="postbody">Is EFSlib faster then 
<br/>
<br/>
<a class="postlink" href="http://blea.ch/wiki/index.php/Nitrofs" target="_blank">http://blea.ch/wiki/index.php/Nitrofs</a>
<br/>
<br/>
from eris?! 
<br/>
<br/>
The good think about NitroFS is that it hooks to the interface of fread, fopen and so on....<br/>_________________<br/>"Hey! It compiles! Ship it!"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168423 - zazery - Tue Apr 28, 2009 10:13 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>a128 wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
The good think about NitroFS is that it hooks to the interface of fread, fopen and so on....</td> </tr></table><span class="postbody">
<br/>
<br/>
I have not used NitroFS so I can't comment on speed but EFS allows you to use fread, fopen etc.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168431 - headspin - Wed Apr 29, 2009 5:17 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>a128 wrote:</b></span></td> </tr> <tr> <td class="quote">Is EFSlib faster then 
<br/>
<br/>
<a class="postlink" href="http://blea.ch/wiki/index.php/Nitrofs" target="_blank">http://blea.ch/wiki/index.php/Nitrofs</a>
<br/>
<br/>
from eris?! 
<br/>
<br/>
The good think about NitroFS is that it hooks to the interface of fread, fopen and so on....</td> </tr></table><span class="postbody">
<br/>
<br/>
I just tried replacing EFS with NitroFS for my game and didn't notice any speed difference. The only thing I don't like about NitroFS is you have to pass the full path to your NDS file while EFS searches the card to find it.
<br/>
<br/>
NitroFS is being integrated into devkitARM so it will become the standard. The path to the nds will be available using argv but until more cards implement this I will be using EFS. But it's very easy to go from EFS to NitroFS anyway (took me a couple of minutes to swap them over).
<br/>
<br/>
Both use hooks to fread/fopen so they are practically the same. Infact it looks like quite a bit of code has been "borrowed" from NitroFS.<br/>_________________<br/><a class="postlink" href="http://headsoft.com.au/index.php?category=warhawk" target="_blank">Warhawk DS</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=mmll" target="_blank">Manic Miner: The Lost Levels</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=tdg" target="_blank">The Detective Game</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168664 - melw - Thu May 14, 2009 6:49 am</h4>
    <div class="postbody"><span class="postbody">I noticed that EFS lib didn't work anymore with either of my M3SD adapters (SLOT-2), even when using the updated version from Headspin. While I'm not sure where this bug comes from, moving the EFS_AND_FAT check right in the beginning of EFS_Init() function fixed this for me:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">// initialize the file system
<br/>
int EFS_Init(int options, char *path) {
<br/>
<br/>
    bool found = false;
<br/>
<br/>
    // init libfat if requested
<br/>
    if(options &amp; EFS_AND_FAT) {
<br/>
        if(!fatInitDefault())
<br/>
            return false;
<br/>
    }
<br/>
<br/>
    ...
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Change tested and confirmed to work with R4DS, M3SD Lite and M3SD.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#169328 - veubeke - Fri Jul 03, 2009 12:00 pm</h4>
    <div class="postbody"><span class="postbody">For anyone who wants to know. It took me some debugging to find out that my 64bit binary of the efspatcher doesn't work (it seems to produce IDs that are too big). So anyone with a 64bit linux might want to use wine or a 32bit version.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
