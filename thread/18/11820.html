<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Building an OS(Was:Dynamically loading & executing code) - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Building an OS(Was:Dynamically loading & executing code)</h2>
<div id="posts">
<div class="post">
    <h4>#110497 - OOPMan - Tue Nov 28, 2006 10:33 pm</h4>
    <div class="postbody"><span class="postbody">I'm interested in learning about whether or not it would be possible to dynamically load and execute
<br/>
code from an external binary in a running homebrew program. Now, given that we have DSLinux and Moonshell
<br/>
seems to have a plugin system I'm pretty sure it's possible, but I'm not too sure how it's done (And I
<br/>
know that what applies to DSLinux in this regard does not necessarily apply to bare-metal homebrew anyway)
<br/>
<br/>
So, could anyone point me in the direction of some useful resources on the subject. I know tepples 
<br/>
mentioned the use of overlays in another thread a while back. Does anyone have information on 
<br/>
using these?
<br/>
<br/>
On the coding side, I'd imagine some assembler is necessary in order to cause a running program to
<br/>
start executing binary code that has been loaded into an area of memory from an external file. Can anyone
<br/>
give me any information on the kind of assembler need to do so?
<br/>
<br/>
Mainly I'm just looking for information. The idea of a "plugin" framework for code was mentioned in another
<br/>
thread and I'm interested to find out just how feasible such a thing is...<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"><br/><br/>Last edited by OOPMan on Thu Dec 21, 2006 3:56 pm; edited 3 times in total</span></div>    
</div>
<div class="post">
    <h4>#110499 - tepples - Tue Nov 28, 2006 10:37 pm</h4>
    <div class="postbody"><span class="postbody">First read up on the ELF file format.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110500 - Lick - Tue Nov 28, 2006 10:40 pm</h4>
    <div class="postbody"><span class="postbody">Load up the binary to &lt;address&gt; and jump to that address. If you provide a specific return address, then the binary can jump back when it's done. I think that's the hard part.<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110506 - tepples - Tue Nov 28, 2006 10:59 pm</h4>
    <div class="postbody"><span class="postbody">But then we'll need a separate &lt;address&gt; for each piece of code that can be loaded at once. An ELF reader would allow loading a given piece of code at any &lt;address&gt;.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110508 - Sausage Boy - Tue Nov 28, 2006 11:04 pm</h4>
    <div class="postbody"><span class="postbody">ELF has relocation tables and stuff. The basic process is to find the code, relocate the code and run it. Sounds reasonably simple to me, but I guess it gets more complicated than that.<br/>_________________<br/>"no offense, but this is the gayest game ever"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110517 - tepples - Wed Nov 29, 2006 12:13 am</h4>
    <div class="postbody"><span class="postbody">That is, unless you compile your code with gcc option -fPIC . This will result in "position independent code" that runs slower but runs from any address. Mac OS 1 through 7 used this.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110526 - sasq - Wed Nov 29, 2006 12:52 am</h4>
    <div class="postbody"><span class="postbody">Unless the code you load uses no libraries itself (including libc) you have big problems. You can either link each binary statically which will waste huge amounts of memory (every plugin in a music player statically linked) or you need to create a very sophisticated dynamic library loader that handles dependencies between dynamic libraries with versions etc etc.
<br/>
<br/>
I think this is best left to operating systems.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110529 - tepples - Wed Nov 29, 2006 1:00 am</h4>
    <div class="postbody"><span class="postbody">Then the DS needs an operating system.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110565 - OOPMan - Wed Nov 29, 2006 7:56 am</h4>
    <div class="postbody"><span class="postbody">Thanks for all the useful info guys...
<br/>
<br/>
Hmmmm, so, we have a bit of a toss-up, though...
<br/>
<br/>
Either statically link all the plugins (Yech) or write a funky
<br/>
dynamic linking loader (Ouch)...
<br/>
<br/>
Hmmmm...<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110580 - Sausage Boy - Wed Nov 29, 2006 3:32 pm</h4>
    <div class="postbody"><span class="postbody">The last time I tried -fPIC with devkitPro, it didn't like me at all.
<br/>
<br/>
I think the wasted space from using statically link files is not nearly big enough to make up for the work of writing a dynamic library loader. If every program shares about 100kb of code, and you have 3 programs open, it means 300kb. Not too bad.<br/>_________________<br/>"no offense, but this is the gayest game ever"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110586 - OOPMan - Wed Nov 29, 2006 4:46 pm</h4>
    <div class="postbody"><span class="postbody">Hmmmm, maybe so, but it could add up, although it does depend on how many modules you have loaded at once. Also, it would be very very wasteful for ultra-small blocks of code :-(
<br/>
<br/>
The dynamic loader might be a better idea in the long run. I don't think one need go the whole hog and write and OS though, since the aim is to implement a modular code loading system, rather than provide all the functions of an OS...<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110594 - tepples - Wed Nov 29, 2006 7:14 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>OOPMan wrote:</b></span></td> </tr> <tr> <td class="quote">The dynamic loader might be a better idea in the long run. I don't think one need go the whole hog and write and OS though, since the aim is to implement a modular code loading system, rather than provide all the functions of an OS...</td> </tr></table><span class="postbody">
<br/>
But once you've implemented a modular code loading system, a memory manager, a file system module, a way for modules to share interrupts, a way for modules to share input, and a way for modules to share the screen, you <span style="font-style: italic">have</span> implemented an operating system kernel.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110596 - sajiimori - Wed Nov 29, 2006 7:27 pm</h4>
    <div class="postbody"><span class="postbody">There are two basic problems to solve for dynamically loaded modules: calling out of the module, and calling into the module.  It's not hard to solve them -- the real work is making it convenient and as automated as possible.
<br/>
<br/>
Calling out is pretty easy: enumerate all the functions that you want to be available, make a table of function pointers matching that enumeration, and have every module link in stub functions (that match the signatures of the shared functions) that index into the table to jump to the real code.
<br/>
<br/>
The stubs may not know where the table is, but it's easy to solve that by writing a software interrupt handler.  Just put the function index to be called in r12 or something, then call the interrupt to execute it.
<br/>
<br/>
Calling into a module is similar: enumerate all the exported functions, put a table of offsets to those functions at the beginning of the module's binary, then write statically-linked stubs (matching the signature of the module's functions) that index into the table to jump into the module.
<br/>
<br/>
You'll surely want to automate the generation of the enumerations, tables, and stubs.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111134 - Inopia - Mon Dec 04, 2006 9:53 am</h4>
    <div class="postbody"><span class="postbody">@tepples: I agree the DS needs an OS. How about something like <a href="http://prex.sourceforge.net/" target="_blank">http://prex.sourceforge.net/</a> ? It already has a GBA port. If you look at <a href="http://prex.sourceforge.net/devel.html" target="_blank">http://prex.sourceforge.net/devel.html</a> under 'Work completed', you can see it has Elf relocation.
<br/>
<br/>
It has multitasking and multithreading, small kernel memory footprint (&lt;25k), no-mmu mode, and remote debugging services. I've looked at the source a bit, and it seems easy enough to write new device drivers.
<br/>
<br/>
I don't know enough about the DS hardware to do the port myself, but I think that if the scene wants to produce a viable multitasking platform for homebrew it's an option worth considering. Personally, I think a real operating system is the next step :P (and yes, dslinux is an OS, but not really tailored for the DS or at all usable right now)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111140 - OOPMan - Mon Dec 04, 2006 10:35 am</h4>
    <div class="postbody"><span class="postbody">Yes, given the discussion that this thread has spawned you are quite probably correct Inopia. It's interesting to see that PREX has a DS version...
<br/>
<br/>
Of course, there are other Real-Time OS'es out there, so it might be worth looking around, as it's quite possible there's another more mature project with ARM support...<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111150 - lyptt - Mon Dec 04, 2006 1:15 pm</h4>
    <div class="postbody"><span class="postbody">I'd like to see an OS act as a replacement for the default firmware, the only problem is that an OS may be a lot larger than the space available for the firmware, although the GBA version of PREX is only around 65kb, which might work out pretty well if a similar filesize could be achieved for a DS version.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111151 - Inopia - Mon Dec 04, 2006 1:17 pm</h4>
    <div class="postbody"><span class="postbody">OOPMan: prex doesn't have a DS port yet, but it should be easy enough to adapt the GBA port.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111152 - OOPMan - Mon Dec 04, 2006 1:45 pm</h4>
    <div class="postbody"><span class="postbody">I think replacing the basic firmware with an OS might be more trouble than it's worth, considering that DSLinux runs just fine from a media adapter anyway...
<br/>
<br/>
Also, it would make getting your DS repaired a big problem, in the event of hardware failure...
<br/>
<br/>
Inopia, I meant to say GBA version :-) Bleh, my word failure...<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111156 - kusma - Mon Dec 04, 2006 2:05 pm</h4>
    <div class="postbody"><span class="postbody">Inopia: hey man, good to see you are still alive! Still doing gba/ds-dev?
<br/>
<br/>
Onto the topic: Dynamic code relocation is really useful on it's own, especially for the GBA where you constantly battle the limits of IWRAM. IMO it would be really interesting to see an automated relocator. I have done a really basic one myself (using a script parsing objdump-output to know the size of symbols), but it requires manual setup all over and isn't really safe.
<br/>
<br/>
I haven't done any DS development myself yet, so I don't know about the real need for a ds-relocator.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111435 - Inopia - Wed Dec 06, 2006 4:12 pm</h4>
    <div class="postbody"><span class="postbody">Hey kusma &lt;3! Not really active atm, but I'm keeping my eye on how things are going. 
<br/>
<br/>
I think the main idea of having something like prex is that it supports multithreading/multitasking, not to mention that you'd not have to reboot your DS everytime you would want to switch programs :) Writing a device driver for the framebuffer would be straightforward enough, and would open up possibilities for a simple window manager :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111451 - OOPMan - Wed Dec 06, 2006 6:31 pm</h4>
    <div class="postbody"><span class="postbody">The thing I would worry about with an OS is how much of the hardware it conceals. A big problem with DSLinux at the moment is that various elements of the DS's hardware are not really accessible under it in the same fashion they are under normal DS development...
<br/>
<br/>
No doubt this could be solved with proper device drivers, but still, it's something to look out for...
<br/>
<br/>
After all, at the moment DSLinux programs only have access to one screen, which is a bit of a downer...<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111519 - Darkflame - Thu Dec 07, 2006 5:54 am</h4>
    <div class="postbody"><span class="postbody">prex looks quite interesting.
<br/>
Seems crazy imo, to try to replace the ds's own firmware with anything too much, however :p<br/>_________________<br/><a class="postlink" href="http://www.rateoholic.co.uk/RateoholicResults.php#SEARCHFOR=&amp;TYPE=VideoGame%25&amp;BY=darkflame&amp;ORDER=hyb_down&amp;ST=0" target="_blank">Darkflames Reviews</a>    --   
<br/>
Make your own at;
<br/>
<a class="postlink" href="http://www.rateoholic.co.uk" target="_blank"> Rateoholic:Reviews for anything, by anyone.</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111547 - Inopia - Thu Dec 07, 2006 4:11 pm</h4>
    <div class="postbody"><span class="postbody">I don't think prex or dslinux should be replacements for the firmware, but they would be a nice platform for homebrew. 
<br/>
<br/>
As for hardware exposure, different drivers for the different pieces of flash hardware would be really nice for brewers. They wouldn't have to keep releasing new versions of their programs every time a new piece of kit hits the market.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111558 - tyraen - Thu Dec 07, 2006 6:15 pm</h4>
    <div class="postbody"><span class="postbody">Not that I know a whole lot about the subject, but from the Prex FAQ:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<span style="font-weight: bold"><span style="font-size: 14px; line-height: normal">Q. Does it support multi-processor systems?</span></span>
<br/>
No. Currently, Prex is designed only for uni-processor systems because of its performance and simplicity. OK, we know recent processor trend is moving to multi-core. This is one of our discussion item.
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111577 - OOPMan - Thu Dec 07, 2006 11:03 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for quoting that tyraen. That was something that I had some reservations about as well...<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111591 - Inopia - Fri Dec 08, 2006 2:00 am</h4>
    <div class="postbody"><span class="postbody">Yeah, not being able to use the ARM7 is a downside :/</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111607 - OOPMan - Fri Dec 08, 2006 8:53 am</h4>
    <div class="postbody"><span class="postbody">I don't think DSLinux allows actual usage of the ARM7 either. I know it makes use of it itself for input, etc, but I don't know if any DSL programs can access it...<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111654 - sajiimori - Fri Dec 08, 2006 7:01 pm</h4>
    <div class="postbody"><span class="postbody">When an OS claims support for multiple CPUs, that has certain connotations that don't apply to the DS.  In particular, it implies that the OS is going to automatically divide up tasks to be done on each CPU.
<br/>
<br/>
For the purposes of OS development, the DS isn't a multi-processor <b style="color:#FFA34F">system</b>, so it really doesn't matter if the OS supports that.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111656 - Mighty Max - Fri Dec 08, 2006 7:52 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
For the purposes of OS development, the DS isn't a multi-processor <b style="color:#FFA34F">system</b>, so it really doesn't matter if the OS supports that.</td> </tr></table><span class="postbody">
<br/>
I disagree
<br/>
<br/>
OK, SMP is the popular way for multiprocessing (and relatively easy to handle for an OS), but unix derivates have been supporting asymetric processing power and hardware access for some time now. 
<br/>
<br/>
Even from windows family there is an OS for runing on complete asymetric (and no remote memory access) systems: WinCCS 2003<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111672 - OOPMan - Fri Dec 08, 2006 10:43 pm</h4>
    <div class="postbody"><span class="postbody">You known, I was actually thinking about the libMPI work you're doing right now Max in connection with this thread.
<br/>
<br/>
While the ARM7 may not recieve the Lion's share of <b style="color:#FFA34F">system</b> resources of the bat, you've illustrated quite well with your libMPI stuff that parallelisation can work nicely on the DS.
<br/>
<br/>
On the other hand, let's just look at what happens if this hypothetical OS decides to ignore the ARM7. It will still be running an ARM7 binary in order to support input and sound. Which means that code written for said OS would have two choices (Simplistically speaking anyway): Treat the DS as a uni-processor <b style="color:#FFA34F">system</b>, or overwrite the OS's ARM7 binary with its own when it's loaded.
<br/>
<br/>
The first scenario would, in my opinion, remove a certain element of flexibility that DS coding provides, while the second would probably just plain be a bad bad idea :-)
<br/>
<br/>
I'd prefer it if an OS for the DS did support some kind of custom ARM7 binary, since the ARM7 is an integral part of the DS and obfuscating it's functionality via the OS would be a bit sad, in my opinion...<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111674 - HyperHacker - Fri Dec 08, 2006 10:56 pm</h4>
    <div class="postbody"><span class="postbody">Well there'll have to be a kernel running on the ARM9, and obviously we'd need to run other applications' code on it at the same time. Why is this not feasible with ARM7?
<br/>
<br/>
Since ARM7 represents 33% of the system's processing power it's not really a good idea to just have it doing simple I/O. I'd think primarily it would be used by the OS alone, but would have routines to do CPU-heavy things like audio decoding, advanced math, etc, and the apps' ARM9 routines could call upon it to do these without needing any routines of their own running on ARM7. If it's necessary, apps could load some code (think kernel modules) into it as well. Maybe just write "add-on" apps that are ARM7 only that are always loaded, adding more APIs like this; for example write an MP3 decoder app that the OS would load at bootup, and then any app can have ARM7 decode an MP3.
<br/>
<br/>
In other words, ARM9 would have the kernel (loading apps into memory, file I/O, etc) and applications, ARM7 would have the API (functions apps can actually use while simultaneously doing whatever else, just as SNES games used the SuperFX, and expandable by these modules) and whatever parts of the kernel can't run on ARM9 (touch screen, wifi I/O, etc).<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111725 - Inopia - Sat Dec 09, 2006 1:58 pm</h4>
    <div class="postbody"><span class="postbody">I agree with hyperhacker, nothing to add.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111739 - OOPMan - Sat Dec 09, 2006 6:27 pm</h4>
    <div class="postbody"><span class="postbody">Thing is, the ARM7 is still a CPU and I feel that locking it down and forcing it to do one set thing (Even if that set thing is actually a group of important things) would be a bit of a loss, in terms of flexibility...
<br/>
<br/>
It might be better if the ARM7 OS side contained only a very small micro-framework of some kind with everything else ARM7 destined being loaded and unloaded as needed. To be more explicit: The OS's ARM7 stuff could also be largely modular, thus allowing other programs as much access to the ARM7 as they desire. Or as little, if they choose to rely on the default OS ARM7 modules.
<br/>
<br/>
Thing is, I don't think it's good to, for example, always load an MP3 decoder or any other set module into the ARM7. One might be working on a homebrew app that does not make use of sound, or at least MP3s, in any major way. In which case loadng an MP3 decoder, or any other unused modules onto the ARM7 would be wasteful...<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111755 - OOPMan - Sat Dec 09, 2006 9:39 pm</h4>
    <div class="postbody"><span class="postbody">Hmmmm, here's something of interest...
<br/>
<br/>
It's an RTOS called <a class="postlink" href="http://www.rtems.com/" target="_blank">RTEMS</a>...
<br/>
<br/>
Pertinent features from our standpoint would be:
<br/>
<ul>
<br/>
<li>Support for ARM7 and above
<br/>
</li><li>Multi-processor support
<br/>
</li><li>TCP/IP stack
<br/>
</li><li>GDB support
<br/>
</li><li>FAT support
<br/>
</li><li>The usual OS bells and whistles (Multi-tasking, etc...)
<br/>
</li><li>Python for scripting :-)
<br/>
</li></ul>
<br/>
<br/>
Apparently it was originally designed with missiles in mind :-)
<br/>
<br/>
I'm going to do some more looking :-)<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111764 - lyptt - Sat Dec 09, 2006 11:07 pm</h4>
    <div class="postbody"><span class="postbody">That's mainly what real time operating systems are used for ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111779 - HyperHacker - Sun Dec 10, 2006 12:50 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>OOPMan wrote:</b></span></td> </tr> <tr> <td class="quote">Thing is, the ARM7 is still a CPU and I feel that locking it down and forcing it to do one set thing (Even if that set thing is actually a group of important things) would be a bit of a loss, in terms of flexibility...
<br/>
<br/>
It might be better if the ARM7 OS side contained only a very small micro-framework of some kind with everything else ARM7 destined being loaded and unloaded as needed. To be more explicit: The OS's ARM7 stuff could also be largely modular, thus allowing other programs as much access to the ARM7 as they desire. Or as little, if they choose to rely on the default OS ARM7 modules.
<br/>
<br/>
Thing is, I don't think it's good to, for example, always load an MP3 decoder or any other set module into the ARM7. One might be working on a homebrew app that does not make use of sound, or at least MP3s, in any major way. In which case loadng an MP3 decoder, or any other unused modules onto the ARM7 would be wasteful...</td> </tr></table><span class="postbody">
<br/>
You're right, there's no need to have ARM7 the modules loaded at all times. It'd be nice, though, if they were separate from the program itself, so another program can load one up and use it without having to run the first program. For example, you might make a JPEG-decoding module to go with an image viewer, and then a web browser could load and use this module without the image viewer running.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111780 - Inopia - Sun Dec 10, 2006 12:55 am</h4>
    <div class="postbody"><span class="postbody">I thought PS2's were used for missles?
<br/>
<br/>
Anyway, I wouldn't care too much about direct ARM7 support. We can sit around and dream up millions of features and sketch ideal situations, but in the end it's all about feasability. 
<br/>
<br/>
Something like prex is easy to port because the GBA port is there, relatively little work is needed to get it to run on DS. We can work from there. I suppose a device driver for the ARM7, where you can upload code and call them from the ARM9 would be one simple enough solution, although crude.
<br/>
<br/>
Porting RTEMS looks like a whole lot more work to me. It looks like a good OS because it supports multiprocessors, but I don't know if it has a no-mmu mode. I wonder if the extra effort is worth it.
<br/>
<br/>
I vote for simplicity. In that respect, PREX is still my favorite. Any other suggestions?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111793 - Darkflame - Sun Dec 10, 2006 6:23 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I thought PS2's were used for missles?</td> </tr></table><span class="postbody">
<br/>
<br/>
Yes,but they couldnt do real-time weapon change ;)<br/>_________________<br/><a class="postlink" href="http://www.rateoholic.co.uk/RateoholicResults.php#SEARCHFOR=&amp;TYPE=VideoGame%25&amp;BY=darkflame&amp;ORDER=hyb_down&amp;ST=0" target="_blank">Darkflames Reviews</a>    --   
<br/>
Make your own at;
<br/>
<a class="postlink" href="http://www.rateoholic.co.uk" target="_blank"> Rateoholic:Reviews for anything, by anyone.</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111799 - OOPMan - Sun Dec 10, 2006 8:58 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Inopia wrote:</b></span></td> </tr> <tr> <td class="quote">I thought PS2's were used for missles?
<br/>
<br/>
Anyway, I wouldn't care too much about direct ARM7 support. We can sit around and dream up millions of features and sketch ideal situations, but in the end it's all about feasability. 
<br/>
<br/>
Something like prex is easy to port because the GBA port is there, relatively little work is needed to get it to run on DS. We can work from there. I suppose a device driver for the ARM7, where you can upload code and call them from the ARM9 would be one simple enough solution, although crude.
<br/>
<br/>
Porting RTEMS looks like a whole lot more work to me. It looks like a good OS because it supports multiprocessors, but I don't know if it has a no-mmu mode. I wonder if the extra effort is worth it.
<br/>
<br/>
I vote for simplicity. In that respect, PREX is still my favorite. Any other suggestions?</td> </tr></table><span class="postbody">
<br/>
<br/>
As I see it, since both OSes support the ARM architecture and both lack the necessary device drivers, etc for the various DS-specific elements we need access to, they're both in largely the same category when it comes to ease-of-portability.
<br/>
<br/>
I don't think jury-rigging GBA PREX to run on the DS would be a good thing. It's designed with ARM7 GBA in mind, not ARM9 + ARM 7 DS.
<br/>
<br/>
To be honest, none of these OS'es make me entirely happy, at a glance. They all provide a lot of features, et al, but quite possibly they provide too many features. Things we don't need, or want, will be there regardless, which is a pain.
<br/>
<br/>
Also, as I see it, the key problem with developing on OS for DS homebrew could be illustrated by the case of DSLinux. DSLinux is a great OS for the DS. It has a great featureset and it works well, thanks to the hard work put in by many of the DSL people. However, we haven't seen hordes of bare-metal homebrew developers jumping ship to go and write their software on DSLinux. As I see it, this is a result of the fact that coding for DSLinux is more like coding for Linux than like coding for the DS. Hence, most current homebrew programs can not simply be modified slightly and recompiled to run under DSLinux. 
<br/>
<br/>
This is what worries me about trying to port and existing OS like PREX or RTEMs. It's quite possible that we'd end up in a similar situation, with an OS that works great, but no actual support from homebrew developers who aren't very keen on re-writing their applications extensively to function with the OSes framework.
<br/>
<br/>
In this context, a lightweight custom OS might, in fact, be a better idea, if it allowed for as little monkeying with existing code to get said code working within the OS as possible. Of course, the flip side of all that is that it might end up being a very hack-ish system to work within. 
<br/>
<br/>
Any thoughts on this people?<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111830 - Inopia - Sun Dec 10, 2006 8:12 pm</h4>
    <div class="postbody"><span class="postbody">I refuse to leave my position about PREX :) I think it's absolutely cute and tiny. I don't see too many useless features, really. The thing I think is very important in choosing something to port is memory usage. I don't know how well DSLinux fares in that department, but I like that 25k statement.
<br/>
<br/>
But back on topic, I do think you have a very good point there, oop. Maybe we shouldn't focus our efforts into porting an os, but maybe we should look into making development for DSLinux easier. I am thinking about tutorials, drivers, graphics shiz etc. Maybe we should focus on getting a tiny X server working? When we have a tiny x, we can start looking for a tiny gui toolkit (gtk is probably a bit too bloated:)
<br/>
<br/>
Whatever we do, I agree with oop on the acceptance issue.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111844 - OOPMan - Sun Dec 10, 2006 10:25 pm</h4>
    <div class="postbody"><span class="postbody">Erm, it's not that DSLinux development is difficult. DSLinux development is pretty much like development for Linux anywhere, just in a resource constrained environment...
<br/>
<br/>
See, part of the problem with porting a pre-existing OS geared towards existing embedded systems is that the DS is not quite like the majority of embedded systems such OSes usually run on...
<br/>
<br/>
For example, unlike most embedded systems the DS has:
<br/>
<ul>
<br/>
<li>Two screens. One is more normal. Hell, a lot of embedded systems don't even have any screens...
<br/>
</li><li>Touch display. A bit more common I think, but still not ultra-common
<br/>
</li><li>2D and 3D graphics hardware. Not common at all.
<br/>
</li><li>Sound hardware. Not ultra-common either.
<br/>
</li><li>Two processors in an asymetric configuration
<br/>
</li></ul>
<br/>
<br/>
Now, if I have made any glaringingly erroneous statements there, please let me know, since I can not claim to be an expert in embedded system.
<br/>
<br/>
At a glance, however, the above list is part of the reason why porting an existing OS, even a good one, might never give us the kind of development flexibility we require.
<br/>
<br/>
PREX does look nice in many ways, but the lack of multi-processor support is not something that could really just be hacked around. Hacks are usually ugly and can break things in the long run.
<br/>
<br/>
*sigh*
<br/>
<br/>
There are so many sides to all, this though. I mean, writing a 100% custom OS would involve re-inventing the wheel, even if only on a small scale. However, the results could be good and doing so would probably allow for maximum integration with existing homebrew...
<br/>
<br/>
Possibly it's a pipe dream, but I really do think that a situation in which any homebrew apps that want to run under the OS need to be drastically modified at the source level is a situation to avoid. In essence, the OS should be virtually invisible to the app running on top of it...<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111851 - Inopia - Sun Dec 10, 2006 11:59 pm</h4>
    <div class="postbody"><span class="postbody">I don't question the fact that a custom OS would be better, I just don't think it would be worth it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111858 - Lynx - Mon Dec 11, 2006 2:19 am</h4>
    <div class="postbody"><span class="postbody">Is the topic still about dynamically loading and executing code?
<br/>
<br/>
Wouldn't the ideal solution be part of DevKitPro and it do all the work for us?  I mean, if your going to require an OS to be running, then just use DSLinux and your done..  But I think most people would like it to be part of their NDS Game/App, not require an OS to do the work.
<br/>
<br/>
Again, did I miss something or did this topic head way off into left field?<br/>_________________<br/><a class="postlink" href="http://www.ndshb.com" target="_blank">NDS Homebrew Roms &amp; Reviews</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111866 - tepples - Mon Dec 11, 2006 3:57 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lynx wrote:</b></span></td> </tr> <tr> <td class="quote">Is the topic still about dynamically loading and executing code?</td> </tr></table><span class="postbody">
<br/>
Almost, because any <span style="font-style: italic">robust</span> solution for loading modules would quickly become an operating system.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111869 - HyperHacker - Mon Dec 11, 2006 4:19 am</h4>
    <div class="postbody"><span class="postbody">What's with DS coders being afraid to do any actual work? Ports this, hacks that. No port is going to work as well as a new OS built from the ground up with the DS in mind, and trying to work with one is going to be a pain. DSLinux isn't unpopular because people don't want to write programs for it; it's unpopular because it's difficult to use. Using a command line on a touch screen with a 4x6 font is a pain in the butt, and being a port means it's still far from completion because it's a port of something not at all suited to the DS.
<br/>
<br/>
Of course we can take ideas/code from existing programs or even base something off them; no sense re-inventing the wheel. But I think writing a new OS specifically for the DS is the way to go.
<br/>
<br/>
Also, while the idea of allowing existing programs to run with few changes is appealing, I think it'd signifigantly hurt useability. These programs all expect to be able to do whatever they want because nothing else will be running. How do you plan to manage several different programs running at once that all want the display hardware set up a specific way and want to use the entire screen? If we drop this idea (not like people can't still run these apps separate from the OS) we can easily manage the graphic resources by giving each program, for example, a 256x182 buffer to draw on and drawing the focussed one on the screen leaving 10 pixels for a taskbar or similar.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111873 - OOPMan - Mon Dec 11, 2006 8:58 am</h4>
    <div class="postbody"><span class="postbody">Your third paragraph sums up my the flip side of getting stuff to run with as few changes as possible quite nicely HyperHacker :-)
<br/>
<br/>
While I do think it would be nice if existing stuff could be ported with as little trouble as possible, I also realise that it's not likely to be a clean solution.
<br/>
<br/>
With regards to screen usage, I personally would rather see each app allowed full screen area, while allowing the usage of an "Arcane Key Combo (TM)" to bring up the OS's interface for task management, etc...
<br/>
<br/>
Hmmmmmmmm, as long as coding for this hypothetical OS were largely as straight forward as coding bare-metal under devkitPro, I think it would probably seem some support.
<br/>
<br/>
What would people really like to see in a DS OS?<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111893 - Inopia - Mon Dec 11, 2006 1:42 pm</h4>
    <div class="postbody"><span class="postbody">I agree with hyperhacker on the second issue, wich should be very doable. I do however disagree on the first subject. I think writing something from the ground up is way too ambitious. If you want to do it, you have my blessing, but personally I won't wait around for it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111894 - OOPMan - Mon Dec 11, 2006 3:15 pm</h4>
    <div class="postbody"><span class="postbody">Maybe not as ambitious as you think, Inopia...
<br/>
<br/>
While writing an OS is no light task, the fact that it would be written for a fixed platform would ease certain difficulties (HW config worries). Similarly, the aim of keeping things relatively minimal and modular would reduce the workload somewhat and allow it to be approached in a more organised fashion...
<br/>
<br/>
At least, that's what I'm guessing :-)
<br/>
<br/>
I think the key element of this OS for the DS would be the framework for loading, managing and executing modular code. Numerous other OS elements would slot into that framework as ordinary modules or, possibly, as priviledged modules. Come to think of it, though, that sounds rather obvious...<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111941 - Ollie - Tue Dec 12, 2006 12:07 am</h4>
    <div class="postbody"><span class="postbody">Well, i've not got a DS yet and won't have one for a few weeks yet. 
<br/>
<br/>
Still, as far as i can tell everyones being one extreme or the other. Some are saying that a new OS is too ambitious and shouldn't be waited for, others say it is something we could try to do - with various multi-tasking and blah blah.
<br/>
<br/>
I'm not an expert whatsoever, so correct me if i'm wrong but as far as i understand.. Everything starts somewhere.
<br/>
<br/>
Theres no way that people will just sit there, plan an OS for the DS with full features... and code it. Well i tell a lie, there ARE ways to do so if your REALLY dedicated and commited. But it'd take a fair amount.
<br/>
<br/>
I was thinking, that SURELY it'd be better to start small and work up. Yes "starting small" would probably make the system inflexible for later upgrading with new features. So this means a re-write, well actually thats great! Yes it means effort, boo hoo, it'd still mean the "OS" was steadily growing.
<br/>
<br/>
I was thinking, wouldn't it be feasible to begin with, to just have some kind of basic file system or something with each "file" just being plain old DS commands, no OS API stuff. Now imagine loading up the "OS" and seeing a scrolling menu of icons. You scroll to your application, double tap it... it loads. It takes the file and loads a command and the next (XYZ) commands after it into some pre-determined execution section of memory. It keeps executing memory and loading commands from the file the program is stored it.
<br/>
<br/>
Sure it'd only run one program at a time, but it'd be capable of running a program. So far what i've described is identical to media devices like GBAMP or whatever (i think), which is not quite what i had in mind. So to clarrify, you'd have an escape code that exited the current program and returned to the OS without restarting the GBA.
<br/>
<br/>
Your probably all thinking "Well fat lot of good that is", well your probably right. But it's a start. If you think about what that actually involes, your probably looking at an FAT file system, a system for loading code into some memory for execution, executing it, periodically loading the next chunks of code from the filesystem into the execution memory - whilst continually checking for the escape sequence to return to an application.
<br/>
<br/>
I've rambled on about this for far too long, and it probably isn't very sensible, but i'm afraid i've never homebrewed - i only program C++ on the computer. I'm just speaking using what i can understand as a normal developer. I hope i haven't wasted your time with you reading this, but i thought it was a useful opinion worth contributing! ^_^</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111943 - HyperHacker - Tue Dec 12, 2006 12:17 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>OOPMan wrote:</b></span></td> </tr> <tr> <td class="quote">What would people really like to see in a DS OS?</td> </tr></table><span class="postbody">
<br/>
Multitasking and a nice consistent API for things like drawing and working the hardware. I think using OS functions instead of directly accessing the hardware registers would be better in this case, as it helps ensure programs don't mess eachother up and allows for a sort of wrapper that could help make things easier to code. (For example, the OS would already have routines to draw simple shapes and GUI elements, and grabbing input from the microphone could be as simple as OS_ReadMic(BitRate, Buffer, BufferLength) or something along those lines.)
<br/>
<br/>
Since the DS is a fixed system and we wouldn't be expecting a lot of features, I don't think it'd be as much work as people seem to think. I'd start working on it now, actually, but I've already got 4954379 projects on the go and don't know near enough about relocatable code/modules to actually implement the whole loading programs from disk part. If someone does that, though, I'd be glad to pitch in designing and implementing the API.
<br/>
<br/>
One interesting issue that comes to mind is security. The lack of an MMU makes it difficult to implement memory protection (any program could read/write any part of memory, muck with hardware registers, turn the system off etc), and on the DS this may not be a big problem anyway. Though I wonder if the MPU could be used for this? Or would that be too slow/difficult to be feasible?<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111957 - Lynx - Tue Dec 12, 2006 1:18 am</h4>
    <div class="postbody"><span class="postbody">So, commercial DS games have an OS?  Maybe I'm clueless, but don't commercial DS games do what we "want"?  Or maybe what everyone else wants, isn't what I'd want..<br/>_________________<br/><a class="postlink" href="http://www.ndshb.com" target="_blank">NDS Homebrew Roms &amp; Reviews</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111963 - DekuTree64 - Tue Dec 12, 2006 2:08 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lynx wrote:</b></span></td> </tr> <tr> <td class="quote">So, commercial DS games have an OS?  Maybe I'm clueless, but don't commercial DS games do what we "want"?  Or maybe what everyone else wants, isn't what I'd want..</td> </tr></table><span class="postbody">
<br/>
Commercial games have a bunch of library code that they have to use (which includes support for loading overlays), but no dynamic relocation of code.
<br/>
<br/>
I think what OOPMan originally wanted is a simple DLL loader. Nothing to do with memory management, nothing to do with multitasking, just a library to load in an ELF file to a given address and allow you to call functions in it.
<br/>
<br/>
Unfortunately I have no experience writing dynamic linkers so I don't know how difficult that would be to write. But if the ELF format can give you the info to relocate a block of position-independent code, it really doesn't seem that difficult.
<br/>
<br/>
That said, the only thing it would really accomplish is saving memory on code that's not currently in use. While this would actually be useful in most commercial games I've worked on, there aren't many homebrew projects out there that are large enough to have a significant amount of code not being used at a given time.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111989 - OOPMan - Tue Dec 12, 2006 9:18 am</h4>
    <div class="postbody"><span class="postbody">Hmmmm, some pretty cool new posts...
<br/>
<br/>
Ollie: I do understand the key point of what you're saying, which is start small and build things up. However, I don't think doing so in a fashion that would require the OS to be re-written from the ground up every time a significant new feature is added would be a good way to go. Also, I think talk of menus, etc are rather premature and don't actually have much to do with the OS itself at all. These are shell-related topics that would be dealt with when the OS's shell was developed. 
<br/>
<br/>
Hyperhacker: Nice points. I also think multi-tasking would be an important feature. Multi-threading would also be an important feature to consider in an environment that supports multi-tasking.
<br/>
<br/>
The API idea is also good. After all, relying on 100% direct hardware access when an OS and possibly other apps are running in the background would probably lead to trouble (Conflicts over HW resources, etc...). Whatever the API might be, however, I don't think it should be high-level. A high-level API would likely slow things down a lot, which is not good. In other words, the API should try to remain as simple as possible. It should not be much more difficult to write programs under the OS than it is under DKP. Keeping this in mind, abstract functions to handle drawing are not really something I would put on the table. Providing clear access to the HW, even in an abstracted fashion, would be better. In other words, think SDL, rather than Allegro, design-wise...
<br/>
<br/>
Memory management is an issue I myself was wondering about. For example, I had the idea that when a program under the OS is ready for release it's compiled with a spec about the min/max memory space it needs to run in. That way, when the OS loads code it could pre-allocate software all the memory it needs to work in from the get-go. One a PC or other large machine this would be wasteful, but on the DS it might help to ensure that programs don't violate each other's memory, etc. However, whether such an idea is even do-able without an MMU is something I don't know. I do know that DSLinux faces similar issues and at the moment exists with no real memory protection system.
<br/>
<br/>
Thinking about it, the memory alloction idea above *might* work if all the memory allocation functions, etc, went via the OS. That way the OS could ensure that when a program requests memory it gets memory allocated from within it's designated "block" and is unable to request more memory than is in the block. Still, it wouldn't do anything about the simple fact thatb a program could use pointers to completely fry any and all of the memory...
<br/>
<br/>
Hmmmmmm...
<br/>
<br/>
Deku: While the topic was originally following the subject of writing something very similar to a DLL loader it has kind of spread out from there. Tepples pointed out that in order to ensure the loader functioned correctly and well a lot of additional memory mangement functions, etc would need to be implemented anyway and that doing so would, in essence, involve a lot of work analogous to the development of an actual OS. So, yah, we kind of moved on to discussing the development of a homebrew OS from there :-)<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112012 - HyperHacker - Tue Dec 12, 2006 1:23 pm</h4>
    <div class="postbody"><span class="postbody">N64 games used a simple OS AFAIK, so I imagine DS games would too.
<br/>
<br/>
Your memory management idea might help to stop memory fragmentation if nothing else. The DS does have a memory protection unit that can trigger exceptions when certain memory ranges are accessed, so it's more a question of whether switching protected ranges every time you switch threads and enter/exit userspace.
<br/>
<br/>
An SDL-like graphics system is the idea I was going for, but there's not much reason not to throw in some simple routines for drawing/filling simple shapes and drawing common GUI elements. This could go well with the ARM7 kernel modules idea (though this might be better done on ARM9 since it's faster); if a program needs advanced drawing routines it can just load the appropriate module, and then it's not taking up memory when not in use.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112025 - Ollie - Tue Dec 12, 2006 4:07 pm</h4>
    <div class="postbody"><span class="postbody">Yeah OOPMan, the use of an interface was basically just a visualisation of the simplest interface that could be started with. As opposed to a command-line-interface. If it was command line, starting a program would be "guess the exact filename of the program you want to run, no that's wrong, keep trying..."
<br/>
<br/>
DSLinux probably suffers from this, although i haven't tried it yet. I hope to as soon as i get a DS and the homebrew stuff &gt;:]
<br/>
<br/>
Also OOPMan, i suppose recoding it wouldn't be a "great" thing, but it would give the opportunity to iron out the code and keep it neat, because you'll have a known knowledge of how to achieve something because you've already achieved it once before. So you could use the old code to look at, giving you something to base off of and make it neat. Etc etc...
<br/>
<br/>
As i've been told, if you love your code, re-write it :P</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112028 - OOPMan - Tue Dec 12, 2006 5:04 pm</h4>
    <div class="postbody"><span class="postbody">Ollie: Thing is, the shell is not really a core element of the OS, unless you're going to approach things from a Windows angle of "Integrate your shell/GUI into you kernel", which is a mixed bag.
<br/>
<br/>
Like I said, the whole shell thing is secondary. The OS comes first, the shell is basically just an app that runs within the OS to ease the user experience. While this may not be the case with Windows, I think it would be good if this were the case with a homebrew DS OS.
<br/>
<br/>
The point you make about re-coding does have some validity. Hopefully, however, by keeping the individual OS components as simple and light-weight as possible, extensive recoding would be less necessary.
<br/>
<br/>
HyperHacker: Was the N64 OS an actual OS? I never owned an N64 (Or any console prior to the DS in fact :-) so I don't know. Did it remain running in the background while the N64 game executed?
<br/>
<br/>
The memory organisation idea is based somewhat on some stuff wrt to virtual memory that we handled in CSC last year. Of course, keeping in mind that virtual memory is not possible on the DS, this is why the idea may have some flaws.
<br/>
<br/>
The MPU sounds like it could be useful though :-)
<br/>
<br/>
With regards to the graphics system, etc, things are a bit mixed. As I said above, I don't think any graphics routines stuff you be linked in at the core kernel level. The OS should provide clear access to as much of the HW as safely possible though, so it would be possible for a basic drawing module to be loaded for use by other applications, like you said.
<br/>
<br/>
From where I'm sitting it looks like the ideal homebrew DS OS would be built as either a micro-kernel or an exo-kernel/nano-kernel. 
<br/>
<br/>
I personally think that an exo-kernel style system would be more interesting to work with and would have the added benefit of allowing more direct HW access than most other options. I'm probably going to take a look at L4 to get a better idea of how well this would work...
<br/>
<br/>
There is a downside to these approaches though, in that micro-kernels and the like can be a bit system intensive, which would not be good on the DS...
<br/>
<br/>
Thoughts, anyone?<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112036 - Mighty Max - Tue Dec 12, 2006 6:38 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>OOPMan wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
The memory organisation idea is based somewhat on some stuff wrt to virtual memory that we handled in CSC last year. Of course, keeping in mind that virtual memory is not possible on the DS, this is why the idea may have some flaws.
<br/>
<br/>
The MPU sounds like it could be useful though :-)
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Why do ppl still think it is impossible?
<br/>
<br/>
Partition the 4MB into blocks. A user process only has access to its code, and some of the data blocks by the MPU regions. Whenever a data abort due to region miss happens, retrieve the address of the data accessed.
<br/>
<br/>
With that address check whether this data is still in the 4MB main ram, and change a region to allow access to that range of data. Or, if the memory was used otherwise (like beeing used for the mirror) inbetween swap the blocks content with your blockdevice (i.e. m3 ram or cfcard etc)
<br/>
<br/>
With the main ram mirroring every 4MB, you can reuse one pysical memory range at the different mirrors of this:
<br/>
<br/>
The block at 0x02000000 and the one at 0x02400000 i.e. can be used to address two completely different datasets, even if they point at the same physical memory we can seperate their access. We can just not access both at the very same time. For these accesses that alternate between such related regions some kind of caching would be required (instead of doing slow cf card accesses on every read/write) but thats very doable.
<br/>
<br/>
This way each process can address 16MB  (4 mirrors of 4MB main ram) of virtual memory. And a different process might get an own set of these pages ...
<br/>
<br/>
And its not much slower to access these virtual pages when you only have to switch(which is indeed slow) pages every 64/128/256 or more kB<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112045 - OOPMan - Tue Dec 12, 2006 8:32 pm</h4>
    <div class="postbody"><span class="postbody">Hmmmm, that sounds pretty interesting Max...
<br/>
<br/>
Just to check and see if I've gotten the right end of the stick...
<br/>
<br/>
You're suggesting that we use the additional memory provided by certain cards to provide software with access to a seemingly contigious block of memory, much the same as DSLinux does, right?
<br/>
<br/>
If what you're talking about is the above, then yes, it's very much doable, as has been demonstrated by DSLinux's ability to provide 36mb of addressable memory at once.
<br/>
<br/>
However, actual virtual memory that makes use of paging to and from a much slower form of media (Such as an HDD or the media inserted into a media adapyer) to provide the illusion of near limitless memory (Barring overheads, of course) is, I believe, still not possible specifically due to the lack of an MMU. DSLinux has been unable to implement true virtual memory for this reason. In fact, the closest anyone has come is, if I recall the post on the DSL forums, developing a software emulation of an MMU that did provide the requisite functionality. As you can guess, however, this solution proved unusably slow by a few orders of magnitude.
<br/>
<br/>
Is a large contigious memory area possible, provided a device toting extra RAM is plugged into slot-2? Yes, we know this already.
<br/>
<br/>
Is true virtual memory possible? Not as far as I know. This is, unless I'm completely wrong, an actual hardware limitation that we can do nothing about.
<br/>
<br/>
Anyone else want to back me up on this?<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112050 - Mighty Max - Tue Dec 12, 2006 9:23 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>OOPMan wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Is a large contigious memory area possible, provided a device toting extra RAM is plugged into slot-2? Yes, we know this already.
<br/>
<br/>
Is true virtual memory possible? Not as far as I know. This is, unless I'm completely wrong, an actual hardware limitation that we can do nothing about.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I think you misunderstood my explanation, so a bit more visual:
<br/>
<a href="http://mightymax.org/virtual16mb.gif">[Images not permitted - Click here to view it]</a>
<br/>
<br/>
It really doesnt matter where the pages are stored when a page has to replaced for accessing the main ram through a mirror (and tho addressing a different page at the same physical address)
<br/>
<br/>
So you have a 16MB virtual address space pointing to a managed 4MB of physical memory.
<br/>
<br/>
When i got some time i can do a techdemo to show you this is possible on the gbamp which has no extra ram. The thing i mentioned the extra ram of m3 was just that copying ram&lt;-&gt;ram is much faster the cf&lt;-&gt;ram
<br/>
<br/>
<br/>
:edit: Actually i allready made a techdemo on the gbamp to create a virtual ramspace in gba addressspace, but this was by manually relocating access instead of abusing the "natural" relocation by the ram mirrors. You can find the source here: <a href="http://mightymax.org/paging.zip" target="_blank">http://mightymax.org/paging.zip</a><br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"><br/><br/>Last edited by Mighty Max on Tue Dec 12, 2006 9:42 pm; edited 2 times in total</span></div>    
</div>
<div class="post">
    <h4>#112054 - OOPMan - Tue Dec 12, 2006 9:36 pm</h4>
    <div class="postbody"><span class="postbody">I would very much like to see a tech demo of this Max, as it sounds really interesting and cool if it does indeed work...
<br/>
<br/>
I wondered myself whether or not I might be mis-understanding you somewhat and it looks like this was the case :-)
<br/>
<br/>
Anyway, hopefully you will be able to provide a tech demo, as I think it would be a very cool thing to see in action...<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112056 - simonjhall - Tue Dec 12, 2006 9:37 pm</h4>
    <div class="postbody"><span class="postbody">@Max:
<br/>
I did this very same thing on my gbamp to do memory-mapped files. It was slow as ants! And even without the actual file access bit.
<br/>
<br/>
With regular virtual memory, when you get a fault you copy a chunk of data into your real memory and then map that whole chunk into the memory space. That way when you access that address again it just works. If you use this trapping out-of-bounds exceptions method every time you access that address it'll cause a fault - unless you change all pointers to point at this new memory location (which isn't feasible).
<br/>
<br/>
There are other ways of doing it however where you can treat the local memory like a cache, but they're not tremendously fast either. They do avoid incurring an overhead every time that you access some fancy memory though - although there is a penalty when you first access that address.<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112057 - OOPMan - Tue Dec 12, 2006 9:51 pm</h4>
    <div class="postbody"><span class="postbody">Hmmmm, thanks for that simon. Clears things up even more...
<br/>
<br/>
On the subject of memory, I do not think that the hypothetical DS OS should rely on the user being a SC/M3/G6 user and hence having access to an additional 32mb of memory.
<br/>
<br/>
While I can understand why this was necessary with DSLinux (Given it's Linux roots, etc, a lot of the apps and the OS itself carry a rather large memory footprint by our standards) I think it would be better, performance wise and efficiency wise to code said hypothetical DS OS on the basis that the system only has 4mb of physical RAM to work with. 
<br/>
<br/>
The reasons for this are varied. For a start, most existing homebrew apps are fairly small, in terms of actual memory space used (The exception being those unpleasant apps that use GBFS and similar injected filesystems). Hence, having access to 36mb of RAM is not quite as vital.
<br/>
<br/>
Coding the OS with only 4mb of memory in mind would also allow to to be used on a wider range of devices, including the various slot-1 devices out there (This could actually greatly increase the compatibility of slot-1 devices with homebrew if the OS, in some way or other, abstracted the existence of the slot-1/slot-2 device).
<br/>
<br/>
Efficiency-wise, I think it would be a good thing as well. For a start, the additional RAM provided by the SC/M3/G6 is slower to access and allowing the OS to access the memory in a fashion contigious with the 4mb of main RAM would require the 8-bit write problem to be addressed in much the same fashion as DSLinux did (Toolchain modifications, general but unavoidable performance hit to all memory as a result of mod). Also, having less memory space to work in would encourage the OS developers and people developing apps for the OS to code their software as modular and efficiently as possible in terms of memory-usage, etc. There is such a thing as too much of a good thing :-)
<br/>
<br/>
If needs be a plugin module to provide some form of access to the additional RAM could be written as well, allowing something of the best of both worlds, one hopes. (Although this might prove a pipe dream...)
<br/>
<br/>
Anyway, just some tangent thoughts, since we were chatting about memory :-)<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112062 - Mighty Max - Tue Dec 12, 2006 10:17 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>simonjhall wrote:</b></span></td> </tr> <tr> <td class="quote">@Max:
<br/>
I did this very same thing on my gbamp to do memory-mapped files. It was slow as ants! And even without the actual file access bit.
<br/>
<br/>
With regular virtual memory, when you get a fault you copy a chunk of data into your real memory and then map that whole chunk into the memory space. That way when you access that address again it just works. If you use this trapping out-of-bounds exceptions method every time you access that address it'll cause a fault - unless you change all pointers to point at this new memory location (which isn't feasible).</td> </tr></table><span class="postbody">
<br/>
<br/>
Yes, thats why i approched it this time as pages which are in the mirrors, another access to that page will not again cause the swapping, until one of it other mirrors was accessed. This removes the handling to once in a page, instead of ones per access like i did before.
<br/>
<br/>
Lets make an example, i use 512kBpages. Over all 4 mirrors of wram. When i access a non present page the first time at 0x02600000, the wram at 0x02200000, is saved, and the data that should be at 0x02600000 gets loaded to the physical address 0x02200000, the region of the stored mem is changed for the new address. The next access to 0x02600004 will not cause an exception, therefor no slowdown will happen.
<br/>
<br/>
Due to the mirroreffect will map 0x02600004 to 0x02200004 where the data actually is, without the need of more software actions. Until one of the other 3 mirrors is accessed again.
<br/>
<br/>
If you have 1 region to allow all access for priviledged mode to every memory space, you got 7 regions left to access 7*512 = 3.5MB simultaneous without needing to doing any of the swapping, while you can use the longest since requested region when the next swapping needs to be done.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112067 - simonjhall - Tue Dec 12, 2006 10:34 pm</h4>
    <div class="postbody"><span class="postbody">Oh my god that is so crafty! I see now - nice!
<br/>
If you tell the MPU to protect a certain part of memory, is that memory protected in all mirrored versions, or just the one?<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112068 - Mighty Max - Tue Dec 12, 2006 10:36 pm</h4>
    <div class="postbody"><span class="postbody">In just one, it handles the mirrors as it would be an own ram. Thats the way how you can seperate between allowed and disallowed accesses to the same physical ram<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112075 - HyperHacker - Wed Dec 13, 2006 12:17 am</h4>
    <div class="postbody"><span class="postbody">As far as GBA-slot memory, ideally the OS would make this transparent much like DSLinux. However I think the 8-bit write problem would make this either too slow or too difficult to be feasible. Perhaps the OS offers a special version of malloc() that uses GBA-slot memory if available and falls back to main RAM otherwise. Programs can then use this and assume the allocated buffer is in GBA ROM (or even check the pointer to see), and avoid using 8-bit writes. Time-critical code and ports can continue using standard malloc() which will allocate from main RAM only.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>OOPMan wrote:</b></span></td> </tr> <tr> <td class="quote">Like I said, the whole shell thing is secondary. The OS comes first, the shell is basically just an app that runs within the OS to ease the user experience. While this may not be the case with Windows, I think it would be good if this were the case with a homebrew DS OS.</td> </tr></table><span class="postbody">
<br/>
Kernel/shell separation is good but on a DS OS, chances are the shell is going to be running at all times, so integrating it with the kernel can give a speed boost which is important on such a low-power system.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Was the N64 OS an actual OS? I never owned an N64 (Or any console prior to the DS in fact :-) so I don't know. Did it remain running in the background while the N64 game executed?</td> </tr></table><span class="postbody">
<br/>
The N64 console only had a simple bootROM that loads 1MB from the cartridge, does a checksum on it, and executes it, and provides some exception handling routines. Turning it on without a cartridge only gave a blank screen. The "OS" if it can even be called that is built into each game and basically just provides multithreading, simple exception handling, and probably routines for things like playing sounds and displaying graphics. Some games used relocatable code extensively but I'm not sure the OS handled this.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112106 - OOPMan - Wed Dec 13, 2006 8:41 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">As far as GBA-slot memory, ideally the OS would make this transparent much like DSLinux. However I think the 8-bit write problem would make this either too slow or too difficult to be feasible. Perhaps the OS offers a special version of malloc() that uses GBA-slot memory if available and falls back to main RAM otherwise. Programs can then use this and assume the allocated buffer is in GBA ROM (or even check the pointer to see), and avoid using 8-bit writes. Time-critical code and ports can continue using standard malloc() which will allocate from main RAM only.</td> </tr></table><span class="postbody">
<br/>
<br/>
Interesting point. Do we have any idea what kind of a performance hit the 8-bit write solution used in DSLinux has? I know there is some loss, but I've not encountered any concrete info yet.
<br/>
<br/>
The custom malloc() is an interesting idea, though...
<br/>
<br/>
Anyone else have any thoughts on whether this would be a viable solution...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">Kernel/shell separation is good but on a DS OS, chances are the shell is going to be running at all times, so integrating it with the kernel can give a speed boost which is important on such a low-power system.</td> </tr></table><span class="postbody">
<br/>
<br/>
A good point, yes. Still, if a micro-kernel type OS was used, then it would probably be a bad thing nevertheless. Mach kinda illustrated that integrating too many things into a micro-kernel caused a big hit in performance.
<br/>
<br/>
Also, I'm just not sure it would be necessary to integrate if the OS was written properly and ran well. After all, if the shell is simply a program running on top of the OS, then ensuring that any program running on the OS is able to execute as effectively and efficiently as possible will, as a result, ensure the shell executes nicely as well...
<br/>
<br/>
If the shell was integrated into the kernel, it would probably pay dividends to make sure as much of it was unloadable as possible, especially if it was an intensive graphical shell.
<br/>
<br/>
Shell-wise, I'd be quite happy with something like the SC menu, although maybe with a few extras (Clock, brightness settings and so forth...).
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">The N64 console only had a simple bootROM that loads 1MB from the cartridge, does a checksum on it, and executes it, and provides some exception handling routines. Turning it on without a cartridge only gave a blank screen. The "OS" if it can even be called that is built into each game and basically just provides multithreading, simple exception handling, and probably routines for things like playing sounds and displaying graphics. Some games used relocatable code extensively but I'm not sure the OS handled this.</td> </tr></table><span class="postbody">
<br/>
<br/>
Interesting. I did see mention on the Wikipedia that certain embedded OSes are actually statically linked into the programs they help run. It sounds like the N64 used this method :-)<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112116 - masscat - Wed Dec 13, 2006 11:43 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>OOPMan wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">The N64 console only had a simple bootROM that loads 1MB from the cartridge, does a checksum on it, and executes it, and provides some exception handling routines. Turning it on without a cartridge only gave a blank screen. The "OS" if it can even be called that is built into each game and basically just provides multithreading, simple exception handling, and probably routines for things like playing sounds and displaying graphics. Some games used relocatable code extensively but I'm not sure the OS handled this.</td> </tr></table><span class="postbody">
<br/>
<br/>
Interesting. I did see mention on the Wikipedia that certain embedded OSes are actually statically linked into the programs they help run. It sounds like the N64 used this method :-)</span></td> </tr></table><span class="postbody">
<br/>
Having the OS and application in a single binary (or single logical unit) means that it can be tested as a single unit. And, assuming there are no hardware changes, the application will always run as expected (neglecting bugs).
<br/>
This approach is the best approach for products that have a fixed functionality and are not trying to provide general purpose computing platform.
<br/>
<br/>
If the OS and application are separated then testing becomes harder as making changes to one may break the other. This can become rather nasty with the OS (or dynamically linked library) supporting old interfaces for older applications and applications supporting different features depending on what OS version is running. Any desktop OS gives an example of this problem with applications breaking and the OS growing as it supports new and legacy features. Also different versions of the OS may have different resource requirements, therefore an app that ran under version 1.0 of the OS may not run under version 2.0 as the OS has used more memory (a real problem on the DS).
<br/>
If you want to load a number of random applications at the same time then you have little choice but to keep the apps and OS separate.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112175 - sasq - Thu Dec 14, 2006 12:32 am</h4>
    <div class="postbody"><span class="postbody">Seems like it would work - allthough it's not ideal since every access that goes to a different page has to trigger an exception and execution of code to figure out which page was accessed and to see if it is valid (Since the limited number of protection areas means you need to move around one (or maybe a few)  small RW area(s) on top of a large area with no access).
<br/>
<br/>
But for linear accesses it shouldn't be too slow.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112221 - Mighty Max - Thu Dec 14, 2006 3:05 pm</h4>
    <div class="postbody"><span class="postbody">Less talking, more acting ;)
<br/>
<br/>
<br/>
I've started to implement some of the things we needed, here is the overall setup im using, maybe someone has some corrections or addons to the setup.
<br/>
<br/>
1. I've done a very simple cooperative multitasking, to seperate priviledged routines from user mode routines.
<br/>
<br/>
2. All system (system mode) calls use one of the undefined instructions (we cant use swi) with r0 set as the function value, r1-r3 as parameters. Currently i got the following system calls implemented:
<br/>
 - SYSCALL_IDLE - no param, will switch to the next thread
<br/>
 - SYSCALL_CREATETHREAD(entryPoint,stacksize,passed param) - will create a USR mode thread
<br/>
 - SYSCALL_EXITTHREAD(retval) - will release thread from shedule and switch to next thread
<br/>
 - SYSCALL_MALLOC,SYSCALL_FREE - threadsafe mallocs/frees of pageable memory pool
<br/>
<br/>
3. Memory-Regions:
<br/>
 - Priviledged (only the system thread) can access every memory. It does not trap an exception when accessing a blended out page, therefor has to make sure that the data is available before accessing it
<br/>
 - Usermode can only access 6x512kB regions in the mainram, when accessing something else, the memory-blender is triggered. Access to HW registers and VRAM is (atm) allowed for R/W 
<br/>
= 8 Regions (full Regionsset)
<br/>
<br/>
4. ThreadManagement Memory: after the systemn init, a huge amount of the TCM is free (not used as stack anymore). This memory is used as a non-paged memory pool for threadcontext and threadlist storages. It can only accessed by the system thread, and will never be swapped out.
<br/>
<br/>
<br/>
Got to do the paged memory pool checks now (IsPagePresent,StorePage,RestorePage, UpdateRegionsForPage).
<br/>
<br/>
Problems i encountered yet: Due to the special purpose memory locations, the wram is allready fragmented (as this memory is preserved in all mirrors). Some space is to be reserved to be non paged in mainram too (currently first 512kB) because the system mode code has to be present at any time.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112223 - OOPMan - Thu Dec 14, 2006 3:39 pm</h4>
    <div class="postbody"><span class="postbody">Hmmmmm, looks pretty good Max...
<br/>
<br/>
Are you planning to move the co-op multi-tasking to pre-emptive at any point?
<br/>
<br/>
Any thoughts on what you're going to do about IPC and the DS's two processors?
<br/>
<br/>
What about the code? Mostly assembler or mostly C, so far?
<br/>
<br/>
So far it's looking pretty micro-kernel-ish, just lacking the IPC stuff yet :-)
<br/>
<br/>
Anyway, nice to see that someone is actually putting some code in place :-)<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112224 - OOPMan - Thu Dec 14, 2006 3:50 pm</h4>
    <div class="postbody"><span class="postbody">On a bit of a tangent, but still OS related. I grabbed L4::Pistachio Embedded and took a brief look at it. They do, indeed, seem to have support for the ARM architecture, but all of the existing ports seem to be for ARMs with a MMU. I've emailed the project's porting officer to get his opinion on how viable L4 would be on the NDS, given that we lack an MMU.
<br/>
<br/>
Anyway, if I get a reply, I'll post it, assuming there's anything interesting in it :-)<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112225 - Mighty Max - Thu Dec 14, 2006 3:52 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>OOPMan wrote:</b></span></td> </tr> <tr> <td class="quote">Hmmmmm, looks pretty good Max...
<br/>
<br/>
Are you planning to move the co-op multi-tasking to pre-emptive at any point?
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Yes i am, but thats something at the end of the ptriority list. The plan is to have syscall check if it was called from within a IRQ and set the return point and register values from the irq stack data. However the current irq dispatcher of ndslib isn't compatible to that.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Any thoughts on what you're going to do about IPC and the DS's two processors?
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
The base of the code im currently using was intended as the solution for the MPIlib problem i posted about. the arm7 will however not be able to do the virtual memory trick.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
What about the code? Mostly assembler or mostly C, so far?
<br/>
</td> </tr></table><span class="postbody">
<br/>
Mostly C, beside cp15 interaction and exception dispatcher.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112228 - masscat - Thu Dec 14, 2006 4:12 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">2. All system (system mode) calls use one of the undefined instructions (we cant use swi) with r0 set as the function value, r1-r3 as parameters. Currently i got the following system calls implemented:
<br/>
 - SYSCALL_IDLE - no param, will switch to the next thread
<br/>
 - SYSCALL_CREATETHREAD(entryPoint,stacksize,passed param) - will create a USR mode thread
<br/>
 - SYSCALL_EXITTHREAD(retval) - will release thread from shedule and switch to next thread
<br/>
 - SYSCALL_MALLOC,SYSCALL_FREE - threadsafe mallocs/frees of pageable memory pool</td> </tr></table><span class="postbody">
<br/>
Can you not use SWI if you set up your own exception vectors at memory 0x0000000 (i.e. in the ITCM) and set the ARM to use the low vectors. You would have to pass any Nintendo used values to the Nintendo code though.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112229 - Mighty Max - Thu Dec 14, 2006 4:48 pm</h4>
    <div class="postbody"><span class="postbody">I was thinking on using itcm for a different purpose. 
<br/>
<br/>
(To lay it over the non-moveable memory space when accessing the mirrors of them. i.e. over the accessed mirror where i.e. the bios stack for exceptions is, so i got a continous memory at least over the mirrors)
<br/>
<br/>
But i got to think about this solution some more.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112252 - masscat - Thu Dec 14, 2006 10:21 pm</h4>
    <div class="postbody"><span class="postbody">The ITCM address is fixed at 0x00000000. The result of writing values other than 0x00000 as the region base are unpredictable according to the ARM946E-S tech ref manual.
<br/>
The DTCM region base can be set to whatever you like.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112254 - Ant6n - Thu Dec 14, 2006 10:31 pm</h4>
    <div class="postbody"><span class="postbody">I wonder what programs would one run in a DS. My wild guess is that there are pda-like things on one hand and games on the other. For the first kind possible slowdowns due to virtual memory tricks shouldnt be that much of an issue, for the 2nd kind everything should go as fast and big as possible. But how many other programs should actively run in the background when you are running a game? I think, none.
<br/>
As far as I can see, when you have an OS on the DS, it would make sense to have a card with memory to be actually able to run multiple programs from.
<br/>
So what I am suggesting is to create two modes that software can run in; one that shares resources and memory with other programs and is not necessarily as fast, but multiple programs can do something at the same time and might even share the screen in some fashion; and another that forces all the other programs to be stored on drive/external ram, pauses all thier processes, gives access to all (almost) memory and all the resources. When the 'game' terminates, all the little programs are loaded back and come back to live.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112265 - Mighty Max - Thu Dec 14, 2006 10:58 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>masscat wrote:</b></span></td> </tr> <tr> <td class="quote">The ITCM address is fixed at 0x00000000. The result of writing values other than 0x00000 as the region base are unpredictable according to the ARM946E-S tech ref manual.
<br/>
The DTCM region base can be set to whatever you like.</td> </tr></table><span class="postbody">
<br/>
<br/>
Oh, havent seen that paragraph.
<br/>
<br/>
Got to check some things, afaik devkitPro sets ITCM to 0x01000000 in crt0 and ndslib stores irq dispatcher as well as irq table there. It seems to work. oO
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
Linker script and memory map
<br/>
                0x01000000                __itcm_start = 0x1000000
<br/>
<br/>
...
<br/>
<br/>
 .itcm          0x01000000       0xc8 c:/devkitPro/libnds/lib\libnds9.a(interrupts.o)
<br/>
                0x01000000                irqTable
<br/>
 .itcm          0x010000c8       0xd8 c:/devkitPro/libnds/lib\libnds9.a(interruptDispatcher.o)
<br/>
                0x010000c8                IntrMain
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112272 - OOPMan - Thu Dec 14, 2006 11:15 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ant6n wrote:</b></span></td> </tr> <tr> <td class="quote">I wonder what programs would one run in a DS. My wild guess is that there are pda-like things on one hand and games on the other. For the first kind possible slowdowns due to virtual memory tricks shouldnt be that much of an issue, for the 2nd kind everything should go as fast and big as possible. But how many other programs should actively run in the background when you are running a game? I think, none.
<br/>
As far as I can see, when you have an OS on the DS, it would make sense to have a card with memory to be actually able to run multiple programs from.
<br/>
So what I am suggesting is to create two modes that software can run in; one that shares resources and memory with other programs and is not necessarily as fast, but multiple programs can do something at the same time and might even share the screen in some fashion; and another that forces all the other programs to be stored on drive/external ram, pauses all thier processes, gives access to all (almost) memory and all the resources. When the 'game' terminates, all the little programs are loaded back and come back to live.</td> </tr></table><span class="postbody">
<br/>
<br/>
It's user choice whether to run multiple apps at once or to run a single app at once. The OS should not place restrictions on how many apps can run, etc, as this is more a matter of common sense. The only restrictions that the OS should impose in this respect should be hardware restrictions (Eg, Refusing to load a new app if no memory is available, etc...)
<br/>
<br/>
I do not see screen sharing among multiple apps running at once (In other words, a window system with multiple running apps each getting their own window) as being a priority due to the small display size. A better bet would to allow task flipping between the "graphics" thread of each app.
<br/>
<br/>
Whatever the case may be, talk of things such as windowing systems, etc seems rather premature to me, and quite possibly not all that important really. If the OS itself ends up being poorly written (I'm not taking a dig at you Max, just in case it could be construed that I am :-) then a windowing system will not save it.
<br/>
<br/>
While I think it is far to early to really discuss much about things like GUI systems, etc, I do feel, in general, that a windowing system in the style of X.org or the MS-Windows  manner, is not really very appropriate for the DS, taking into account the various HW limitations around. I feel that each app would obtain better peformance on the graphics side by recieving locked access to the GUI hardware. Applications that wish to run in the background (Music players, etc...) should be multi-thread so that the graphics run in a separate thread to whatever background processes occur. 
<br/>
<br/>
But, like I said, it's a bit early for such grand talk...<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112284 - Ant6n - Fri Dec 15, 2006 12:13 am</h4>
    <div class="postbody"><span class="postbody">i wasnt talking so much about windowing system as about how to share resources, because it seems that sharing memory etc and page flipping might slow things down a lot. That's why i say make it possible to have programs that pause everything and grant access to all resources and then you don't need to slow them down with stuff like virtual memory.
<br/>
If one has an OS for the DS but can't run games because they run too slow in an emulated mmu, thatn this would defeat the purpose of an dsos</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112290 - GPFerror - Fri Dec 15, 2006 12:45 am</h4>
    <div class="postbody"><span class="postbody">why not improve dslinux with some of the features that you have listed?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112293 - tepples - Fri Dec 15, 2006 12:50 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ant6n wrote:</b></span></td> </tr> <tr> <td class="quote">I wonder what programs would one run in a DS. My wild guess is that there are pda-like things on one hand and games on the other. For the first kind possible slowdowns due to virtual memory tricks shouldnt be that much of an issue, for the 2nd kind everything should go as fast and big as possible. But how many other programs should actively run in the background when you are running a game? I think, none.</td> </tr></table><span class="postbody">
<br/>
What about a Vorbis player? Factoring that out into a separate process allows the menu .nds and the game .nds to use the same music code.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112297 - masscat - Fri Dec 15, 2006 1:10 am</h4>
    <div class="postbody"><span class="postbody">With regard to the ITCM location in the memory map:
<br/>
<br/>
From what I can remember of the start up code the size of the ITCM gets set to 32MBytes so that it gets mirrored to 0x01000000 (and many other places). The base is still at zero though. Not sure why it was done this way, maybe Nintendo did it and it just got copied.
<br/>
Using the default MPU settings the region 0x00000000 to 0x00FFFFFF is not declared and therefore causes an exception if read or written. But if you do set up the MPU to cover it you get to see the ITCM happily sitting at 0x00000000.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112303 - HyperHacker - Fri Dec 15, 2006 1:53 am</h4>
    <div class="postbody"><span class="postbody">In terms of applications running simultaneously, I could see myself using the following all at once:
<br/>
-Music player
<br/>
-Notepad*
<br/>
-Web browser, IRC, or text editor
<br/>
<br/>
*If the music player supports AAC+ streaming, then I'd be listening to my favourite station and copying the names of songs that I like into a text file so I can later seek them out and buy them. On Windows, I copy them from the station's web site which has a dynamic Now Playing box, as it's easier than copying from Winamp.
<br/>
This brings up another point to consider much farther down the road - we'll need a clipboard.
<br/>
<br/>
<br/>
As for the interface, I've shared my thoughts on this before, but since you probably don't all remember and I've made some minor improvements, here they are again.
<br/>
<br/>
Each screen would be put into 2D mode 5, with the layers divided up like so:
<br/>
1 (lowest): Desktop background/icons and/or debug info like Moonshell.
<br/>
2: Application graphics area.
<br/>
3: Child windows.
<br/>
4: Menus and keyboard.
<br/>
<br/>
Windowing/display:
<br/>
Layer 2 is the primary application graphics area. No windows are used here. Each program can request zero to two displays which are up to 256x182 bitmaps stored in RAM. Each screen shows one display as well as a 256x10 status bar at the top which is used to choose which display is shown.
<br/>
The status bar on the top screen shows the title of the top display and the current time and temperature. The status bar on the bottom screen shows the title of the bottom display and three buttons. The first button displays the system menu from which you can switch displays, open or close programs, shut down the system, etc. The second swaps screens - the top display is moved to the bottom and vice-versa so it can be touch. The status bars do not switch places (or else you'd have no way to switch back). The third toggles the keyboard.
<br/>
Programs can create windows of any size that fits on the screen, which are displayed on layer 3. Due to limited resources this is best used for small or short-lived things like popup dialogs, floating tool boxes, etc. This works like Moonshell's windowing system, though ideally the title bars would be a bit smaller. Each window is bound to a specific display and appears only above that display.
<br/>
Menus and the keyboard are drawn on layer 4. Programs' menu bars are displayed below the status bar.
<br/>
<br/>
I might draw a quick mockup later, but for now I've got to get going.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112306 - Firon - Fri Dec 15, 2006 2:48 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<br/>
*If the music player supports AAC+ streaming, then I'd be listening to my favourite station and copying the names of songs that I like into a text file so I can later seek them out and buy them. </td> </tr></table><span class="postbody">
<br/>
<br/>
Speaking of HE-AAC,  I'm sure that can be done on the DS by compiling faad2 with low power SBR enabled (no parametric stereo in this mode, so you can't use DI.FM's 24k streams).
<br/>
I don't know if the DS has enough power (at least without some optimization) to use SBR in normal mode, which would also allow PS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112353 - Mighty Max - Fri Dec 15, 2006 3:06 pm</h4>
    <div class="postbody"><span class="postbody">Ok, changing it to ITCM is some work.
<br/>
<br/>
First implementation of the "new bios":
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">.arm
<br/>
<br/>
.global ITCM_Code
<br/>
.global ITCM_End
<br/>
<br/>
// registers in FIQ we use to store pointer to currect threadcontext(tc) and the threadlistentry (tl)
<br/>
tc .req r12
<br/>
tl .req r11
<br/>
<br/>
// defines
<br/>
.equ    MODE_SYS, 0x1F
<br/>
.equ   MODE_USR, 0x10
<br/>
.equ   MODE_FIQ, 0x11
<br/>
.equ   MODE_IRQ, 0x12
<br/>
.equ   MODE_SVC, 0x13
<br/>
.equ   MODE_ABT, 0x17
<br/>
.equ   MODE_UND, 0x1B
<br/>
<br/>
ITCM_Code:
<br/>
   reset:
<br/>
      B reset_code
<br/>
   undefined:
<br/>
      B undefined_code
<br/>
   softwarei:
<br/>
      B softwarei_code
<br/>
   codeabort:
<br/>
      B abort_code
<br/>
   dataabort:
<br/>
      B abort_code
<br/>
      .word 0
<br/>
   irq:
<br/>
      B irq_code
<br/>
   fiq:
<br/>
      B fiq_code
<br/>
      
<br/>
   // address = 0x00000020
<br/>
   swi_c_handler:
<br/>
      .word      0
<br/>
   // address = 0x00000024
<br/>
   data_c_handler:
<br/>
      .word      0
<br/>
   
<br/>
   reset_code:                  // no reset yet, halt system
<br/>
      B reset_code
<br/>
   
<br/>
   undefined_code:
<br/>
      B undefined_code         // no undefined instruction handler
<br/>
            
<br/>
   softwarei_code:               // swi:
<br/>
      STMDB r13!,{r0-r12,r14}      //   store registers
<br/>
      BL store_context         //   store thread context
<br/>
      LDR r12,=0x00000020      
<br/>
      LDR r12,[r12]            //   load irq_c_handler
<br/>
      CMP r12,#0         
<br/>
      MOVNE r14,r15            //   call it if it isnt 0
<br/>
      BXNE r12 
<br/>
      BL restore_context         //   restore thread context
<br/>
      LDMIA r13!,{r0-r12,r14}      //   restor registers
<br/>
      MOVS r15,lr               //   return
<br/>
      
<br/>
   abort_code:                  
<br/>
      B abort_code            // no data abort handler yet
<br/>
      
<br/>
   irq_code:
<br/>
      SWI 0xFFFFFF            // we do irq handling in svc (so we can do taskswitches by irq)
<br/>
      SUBS r15,r14,#4            //   return
<br/>
      
<br/>
   fiq_code:
<br/>
      B fiq_code
<br/>
      
<br/>
//   The expected layout of threadcontext, it could be better. It was defined in respect to UND switches
<br/>
//
<br/>
//   typedef struct THREADCONTEXT {
<br/>
//      unsigned long      bios_stack,
<br/>
//                     bios_return,
<br/>
//                     r11,r10,r9,r8,r7,r6,r5,r4,r3,r2,r1,r0,
<br/>
//                     r13,r14,r15,
<br/>
//                     r12,
<br/>
//                     cpsr,
<br/>
//                     cp15_status ;
<br/>
//   } THREADCONTEXT, *LPTHREADCONTEXT ;      
<br/>
      
<br/>
   store_context:
<br/>
      STMDB r13!,{r14}
<br/>
      BL receive_threadcontext
<br/>
      
<br/>
      CMP r0,#0
<br/>
      LDMEQIA r13!,{r14}
<br/>
      BXEQ lr
<br/>
      
<br/>
      
<br/>
      // bios stack &amp; bios return is not to save anymore, as we dont use the old bios anymore
<br/>
      ADD r0,r0,#8
<br/>
      
<br/>
      // store r11 - r0 in reverse order, the values are on stack 
<br/>
      LDR r1,[r13,#0x30]
<br/>
      STMIA r0!,{r1}
<br/>
      LDR r1,[r13,#0x2C]
<br/>
      STMIA r0!,{r1}
<br/>
      LDR r1,[r13,#0x28]
<br/>
      STMIA r0!,{r1}
<br/>
      LDR r1,[r13,#0x24]
<br/>
      STMIA r0!,{r1}
<br/>
      LDR r1,[r13,#0x20]
<br/>
      STMIA r0!,{r1}
<br/>
      LDR r1,[r13,#0x1C]
<br/>
      STMIA r0!,{r1}
<br/>
      LDR r1,[r13,#0x18]
<br/>
      STMIA r0!,{r1}
<br/>
      LDR r1,[r13,#0x14]
<br/>
      STMIA r0!,{r1}
<br/>
      LDR r1,[r13,#0x10]
<br/>
      STMIA r0!,{r1}
<br/>
      LDR r1,[r13,#0x0C]
<br/>
      STMIA r0!,{r1}
<br/>
      LDR r1,[r13,#0x08]
<br/>
      STMIA r0!,{r1}
<br/>
      LDR r1,[r13,#0x04]
<br/>
      STMIA r0!,{r1}
<br/>
      
<br/>
      // load previous mode r13,r14 and store them to [r0] and following
<br/>
      MRS r3,spsr
<br/>
      AND r2,r3,#0x1F
<br/>
      CMP r2,#MODE_USR
<br/>
      LDREQ r2,=MODE_SYS
<br/>
      MRS r3,cpsr
<br/>
      BIC r3,r3,#0x1F
<br/>
      ORR r2,r2,r3
<br/>
      MRS r3,cpsr
<br/>
      MSR cpsr,r2
<br/>
   
<br/>
      STMIA r0!,{r13}
<br/>
      STMIA r0!,{r14}
<br/>
      
<br/>
      MSR cpsr,r3 
<br/>
      
<br/>
      // store return address as previous mode r15
<br/>
      LDR r1,[r13,#0x38]
<br/>
      STMIA r0!,{r1}
<br/>
      // store r12
<br/>
      LDR r1,[r13,#0x34]
<br/>
      STMIA r0!,{r1}
<br/>
      
<br/>
      // store saved psr (CPSR of thread)
<br/>
      MRS r1,spsr
<br/>
      STMIA r0!,{r1}
<br/>
      
<br/>
      // cp15_status is ignored as we dont change it
<br/>
      ADD r0,r0,#4
<br/>
      
<br/>
      LDMIA r13!,{r14}
<br/>
      BX lr
<br/>
   restore_context:
<br/>
      STMDB r13!,{r14}
<br/>
      BL receive_threadcontext
<br/>
      
<br/>
      CMP r0,#0
<br/>
      LDMEQIA r13!,{r14}
<br/>
      BXEQ lr
<br/>
      
<br/>
      // bios stack &amp; bios return is not to save anymore, as we dont use the old bios anymore
<br/>
      ADD r0,r0,#8
<br/>
<br/>
      // restore r11 - r0 from reverse order, the values are on stack 
<br/>
      LDMIA r0!,{r1}
<br/>
      STR r1,[r13,#0x30]
<br/>
      LDMIA r0!,{r1}
<br/>
      STR r1,[r13,#0x2C]
<br/>
      LDMIA r0!,{r1}
<br/>
      STR r1,[r13,#0x28]
<br/>
      LDMIA r0!,{r1}
<br/>
      STR r1,[r13,#0x24]
<br/>
      LDMIA r0!,{r1}
<br/>
      STR r1,[r13,#0x20]
<br/>
      LDMIA r0!,{r1}
<br/>
      STR r1,[r13,#0x1C]
<br/>
      LDMIA r0!,{r1}
<br/>
      STR r1,[r13,#0x18]
<br/>
      LDMIA r0!,{r1}
<br/>
      STR r1,[r13,#0x14]
<br/>
      LDMIA r0!,{r1}
<br/>
      STR r1,[r13,#0x10]
<br/>
      LDMIA r0!,{r1}
<br/>
      STR r1,[r13,#0x0C]
<br/>
      LDMIA r0!,{r1}
<br/>
      STR r1,[r13,#0x08]
<br/>
      LDMIA r0!,{r1}
<br/>
      STR r1,[r13,#0x04]
<br/>
      
<br/>
      // set previous mode r13,r14 from [r0] and following
<br/>
      
<br/>
      // caution: we need to have a valid spsr before doing this!
<br/>
      // spsr was stored 0x10 bytes later
<br/>
      LDR r3,[r0,#0x10]
<br/>
      AND r2,r3,#0x1F
<br/>
      CMP r2,#MODE_USR
<br/>
      LDREQ r2,=MODE_SYS
<br/>
      MRS r3,cpsr
<br/>
      BIC r3,r3,#0x1F
<br/>
      ORR r2,r2,r3
<br/>
      MRS r3,cpsr
<br/>
      MSR cpsr,r2
<br/>
   
<br/>
      LDMIA r0!,{r13}
<br/>
      LDMIA r0!,{r14}
<br/>
      
<br/>
      MSR cpsr,r3 
<br/>
      
<br/>
      // restore return address as previous mode r15
<br/>
      LDMIA r0!,{r1}
<br/>
      STR r1,[r13,#0x38]
<br/>
      // restore r12
<br/>
      LDMIA r0!,{r1}
<br/>
      STR r1,[r13,#0x34]
<br/>
      
<br/>
      // restore saved psr (CPSR of thread)
<br/>
      LDMIA r0!,{r1}
<br/>
      MSR spsr,r1
<br/>
      
<br/>
      // cp15_status is ignored as we dont change it
<br/>
      ADD r0,r0,#4
<br/>
      
<br/>
      
<br/>
      LDMIA r13!,{r14}
<br/>
      BX lr ;
<br/>
      
<br/>
      
<br/>
   // thread context/list ptrs are stored in a banked fiq register, which is persistent
<br/>
   receive_threadcontext:
<br/>
      MRS r1,CPSR
<br/>
      BIC r0,r1,#0x1F
<br/>
      ORR r0,r0,#MODE_FIQ
<br/>
      MSR CPSR,r0
<br/>
      MOV r0,tc
<br/>
      MSR CPSR,r1
<br/>
      BX lr
<br/>
ITCM_End:
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
:edit: biggest bugs removed ;)
<br/>
<br/>
:edit^2:
<br/>
Old featureset works again. <a class="postlink" href="http://mightymax.org/virtual16.nds" target="_blank">.NDS file</a> (does not run in dualis or desmume)
<br/>
<br/>
This ITCM trick (Thanks masscat) solves the problem with allready fractioned on startup memoryspace already. Don't need to cover the UND vector now *g*
<br/>
<br/>
Time to seperate loader code from servicing code now and store that outside WRAM.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112452 - Mighty Max - Sat Dec 16, 2006 3:38 pm</h4>
    <div class="postbody"><span class="postbody">After some fighting the irq-&gt;swi mapping, preemptive taskswitching works now too.
<br/>
<br/>
But i got a design question for you all:
<br/>
Shall a user mode program be able to receive irq ownership? (Thus lifting priviledges, unable to access virtual mem directly)
<br/>
Or shall an irq trigger the creation of a sub-thread to handle the irq (stack intense)
<br/>
Or shall only system mode drivers be able to access irqs?<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112453 - wintermute - Sat Dec 16, 2006 4:07 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>masscat wrote:</b></span></td> </tr> <tr> <td class="quote">With regard to the ITCM location in the memory map:
<br/>
<br/>
From what I can remember of the start up code the size of the ITCM gets set to 32MBytes so that it gets mirrored to 0x01000000 (and many other places). The base is still at zero though. Not sure why it was done this way, maybe Nintendo did it and it just got copied.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
It's done this way so that null pointers cause exceptions. If I had placed the itcm code at 0 rather than using one of the mirrors then using null pointers would just overwrite itcm code and cause random errors. This way memory at 0 is protected and causes an immediate fault.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112455 - OOPMan - Sat Dec 16, 2006 4:43 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">After some fighting the irq-&gt;swi mapping, preemptive taskswitching works now too.
<br/>
<br/>
But i got a design question for you all:
<br/>
Shall a user mode program be able to receive irq ownership? (Thus lifting priviledges, unable to access virtual mem directly)
<br/>
Or shall an irq trigger the creation of a sub-thread to handle the irq (stack intense)
<br/>
Or shall only system mode drivers be able to access irqs?</td> </tr></table><span class="postbody">
<br/>
<br/>
I would go for the option offering the best perfomance/reliability payoff. Alas, since I don't know that much about the technical side of what you're talking about, I can't pick it out of the list.
<br/>
<br/>
But, yeah, I'd say go for the option that gives running programs the best peformance.<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112483 - Mighty Max - Sat Dec 16, 2006 8:54 pm</h4>
    <div class="postbody"><span class="postbody">Ok, the code is a bit ugly on some things. (i.e. mem alloc)
<br/>
<br/>
But at least everyone is able to play around a bit on the code: <a class="postlink" href="http://mightymax.org/virtual16.zip" target="_blank">Source</a>
<br/>
<br/>
The user mode threads now have no access to the hw registers or VRAM. The only way to output right now is a swi to print a char at x,y. 
<br/>
<br/>
The ndslib console and iprintf were removed for the space it frees. The 27kB it takes now fit into the SIWRAM. Into the few left kB the usermode library loader has to fit.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112620 - Mighty Max - Mon Dec 18, 2006 7:15 pm</h4>
    <div class="postbody"><span class="postbody">Now everything is in siwram or itcm. Beside the IPC (set by the ARM7 i havent touched yet) the complete wram area is free and cleaned to zero.
<br/>
<br/>
<a href="http://mightymax.org/inswram.png">[Images not permitted - Click here to view it]</a>
<br/>
<br/>
Im a bit lazy right now, i should have started on the linker allready to build usermode executables for the system. But promised, will do that.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112622 - OOPMan - Mon Dec 18, 2006 7:20 pm</h4>
    <div class="postbody"><span class="postbody">Nice :-) There's even a system clock already :-)<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112624 - Mighty Max - Mon Dec 18, 2006 7:39 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>OOPMan wrote:</b></span></td> </tr> <tr> <td class="quote">Nice :-) There's even a system clock already :-)</td> </tr></table><span class="postbody">
<br/>
<br/>
Just temporary, i was playing around. System clock should be a user mode program, meaning removal from the core.
<br/>
<br/>
The bar beside is more interesting, it shows used/free DTCM and virtRAM.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112849 - Mighty Max - Wed Dec 20, 2006 8:41 pm</h4>
    <div class="postbody"><span class="postbody">I have isolated the problem with running the code on desmume (and sent the patch to the sf.net desmume maintainer)
<br/>
<br/>
There is still a problem somewhere, causing a false jump after some time. But the first seconds work just fine. The RTC transfer code has a problem too.
<br/>
<br/>
<a class="postlink" href="http://mightymax.org/virtual16_gbfs.zip" target="_blank">GBFS Version with custom built Desmume</a>
<br/>
<br/>
<a href="http://mightymax.org/printscreen.png">[Images not permitted - Click here to view it]</a><br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112909 - Ollie - Thu Dec 21, 2006 2:06 pm</h4>
    <div class="postbody"><span class="postbody">Are you guys actually writing a DS OS or am i just seeing things? XD</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112910 - OOPMan - Thu Dec 21, 2006 2:10 pm</h4>
    <div class="postbody"><span class="postbody">Mighty Max is indeed working on something of that sort :-)<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112911 - Mighty Max - Thu Dec 21, 2006 2:35 pm</h4>
    <div class="postbody"><span class="postbody">It's at least a proof of concept, and i will release its source and documentation when done, so someone can create a real OS from it.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112938 - Mighty Max - Thu Dec 21, 2006 8:22 pm</h4>
    <div class="postbody"><span class="postbody">After finding that bug that caused troubles with corrupting ITCM when accessing a swapped out page, the 16MB virtual addressspace is working like a charm :D
<br/>
<br/>
A usermode program can now use the mirrors as they were independend ram places:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void usrMain(void) {
<br/>
   unsigned long addr = malloc(0x900000) ;   /* assign 9 MB */
<br/>
   /* both write access the same physical memory */
<br/>
   *(volatile unsigned long *)(addr + 0x00500000) = 0xE12FFF1E ;    /* write something into the physical ram at (addr + 0x00500000) &amp; 0x23FFFFF */ 
<br/>
   *(volatile unsigned long *)(addr + 0x00100000) = 0 ;          /* write something into the physical ram at (addr + 0x00100000) &amp; 0x23FFFFF */ 
<br/>
   /* but the paging will backup the mirrors content while another mirror is accessed */
<br/>
   if (*(volatile unsigned long *)(addr + 0x00500000) != 0xE12FFF1E) {
<br/>
      printString(0,100,"Failed to write value!") ;
<br/>
   } else {
<br/>
      printString(0,100,"Write value success") ;
<br/>
   } ;
<br/>
   
<br/>
   while (1) syscall(SYSCALL_IDLE) ;
<br/>
} ;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Results in a nice "Write value success" :D (Only problem: this again breaks compatibility with emulators, as they dont handle region access rights)
<br/>
<br/>
<br/>
Means i have nothing left but to implement a loader for usermode programs :)<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112939 - Lick - Thu Dec 21, 2006 8:32 pm</h4>
    <div class="postbody"><span class="postbody">Couldn't this have been done with a C/C++ system? Why an OS?<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112941 - Sausage Boy - Thu Dec 21, 2006 8:37 pm</h4>
    <div class="postbody"><span class="postbody">If I understand this correctly, the OS is the whole point, not the memory mapping system.<br/>_________________<br/>"no offense, but this is the gayest game ever"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112942 - Mighty Max - Thu Dec 21, 2006 8:38 pm</h4>
    <div class="postbody"><span class="postbody">I dont get what you want to say lick.
<br/>
It are just a bunch of C files, donated with two small .s files.
<br/>
<br/>
:edit:
<br/>
Ahh, no it wouldnt. In the normal state, many memory spaces are hardcoded for a special purpose in the ds bios. Therefor a code that takes care of all these things will need to reimplement nearly every function (irqs, swi, etc) again, which is euqally to setup &amp; manage the DS's resources. Before executing the payload. Meaning it would have to be defined as an os.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112943 - Lick - Thu Dec 21, 2006 8:45 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Sausage Boy wrote:</b></span></td> </tr> <tr> <td class="quote">If I understand this correctly, the OS is the whole point, not the memory mapping system.</td> </tr></table><span class="postbody">
<br/>
Would be nice if that memory mapping system would be available seperately.. 
<br/>
<br/>
Mighty Max: never mind, hehe. Good job! Keep at it!<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112949 - OOPMan - Thu Dec 21, 2006 11:06 pm</h4>
    <div class="postbody"><span class="postbody">Lick, I think what Max is basically saying is that the effort of implementing the OS-provided features on a per-program basis would be rather a lot of effort...
<br/>
<br/>
With any luck Max's work will, at the very least, provide a solid foundation for any further OS-like efforts on the DS (Excluding DSLinux, of course, since that's already pretty feature complete...)
<br/>
<br/>
I think the general aim is to produce a light-weight OS that restricts individual programs as little as possible while also providing various useful features to the application programmer (Memory mapping for example) that would be troublesome to implement in a per program basis.
<br/>
<br/>
In other words the combination of HW + OS + SW should allow for extra flexibility in application programming than the plain HW + SW style currently in use. 
<br/>
<br/>
Well, anyway, that's my hope :-)<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112954 - HyperHacker - Thu Dec 21, 2006 11:38 pm</h4>
    <div class="postbody"><span class="postbody">I'm not sure I understand what you're doing with memory mapping here. You've given each program 16MB of virtual memory, and upon accessing it, the paging system automatically switches some things so that that memory region points to some arbitrary spot in main RAM? So two programs can use the same addresses, which actually point to some unmapped space, and they'll really be accessing two separate regions of main RAM? OK, but what happens when you run out of memory? For that matter why 16MB when there's only 4MB to map it to, or did you implement GBA slot expansion already?<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112966 - Mrshlee - Fri Dec 22, 2006 1:01 am</h4>
    <div class="postbody"><span class="postbody">Pipe dream - Any chance of fake multitasking?
<br/>
<br/>
Using a SC, hit a trigger and it dumps the RAM and DTCM onto the Cart ram and loads the OS code back into the main memory.. select an additional program and that boots.. 
<br/>
<br/>
Trigger between the two programs with delay for I/O or something - depends if this would work for the OS-Aware applications or standard homebrew if we can trigger the IRQs without patching the unmodified homebrew releases..
<br/>
<br/>
<br/>
I remember thinking about the possibility of a hardware based OS for DS.
<br/>
placed ARM7 cpu and some ram onto a cart. DSMEM style. keep an active running OS on the cart at all time to handle memory and everything else.
<br/>
<br/>
Have the DS boot into the GBA cart OS and switch between programs on the DS and on the Cart.<br/>_________________<br/><a class="postlink" href="http://MrShlee.com/" target="_blank">MrShlee.com</a>
<br/>
Projects
<br/>
<a class="postlink" href="http://dev-scene.com/" target="_blank">Dev-Scene</a>
<br/>
<a class="postlink" href="http://MyTechpedia.com/" target="_blank">MyTechpedia</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112977 - Mighty Max - Fri Dec 22, 2006 2:33 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mrshlee wrote:</b></span></td> </tr> <tr> <td class="quote">Pipe dream - Any chance of fake multitasking?
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Is running preemptive as well as cooperative.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Using a SC, hit a trigger and it dumps the RAM and DTCM onto the Cart ram and loads the OS code back into the main memory.. select an additional program and that boots.. 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
No need to. User mode programs have no direct control over anything other then wram and its mirrors. They can't overwrite anything vital. (ok right now they can, as siwram is still flagged for usermode access, but thats gonna change)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Trigger between the two programs with delay for I/O or something - depends if this would work for the OS-Aware applications or standard homebrew if we can trigger the IRQs without patching the unmodified homebrew releases..
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Different programs is something it is not aware yet. It shares one memoryset for all usermode threads.
<br/>
<br/>
It is not supposed to run .nds files. These would need control over the hardware they are not allowed to. Allready the very first action the default crt0 does would get it killed, as hw register access (REG_IME) is not allowed.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
For that matter why 16MB when there's only 4MB to map it to, or did you implement GBA slot expansion already?</td> </tr></table><span class="postbody">
<br/>
<br/>
There are 4 mirrors of 4MB wram (16MB addressrange for 4MB physical mem)
<br/>
<br/>
Let us play with the example code. 
<br/>
There are 256 Bytes reserved for the user thread stack in wram: 
<br/>
0x02000000 - 0x020000FF
<br/>
Also the 9MB allocated:
<br/>
0x02000100 - 0x029000FF
<br/>
<br/>
At startup there are 6 user mode regions set:
<br/>
0x02000000 - 512kB
<br/>
0x02080000 - 512kB
<br/>
0x02100000 - 512kB
<br/>
0x02180000 - 512kB
<br/>
0x02200000 - 512kB
<br/>
0x02280000 - 512kB
<br/>
<br/>
The first write:
<br/>
address 0x02000100 + 0x00500000 is accessed. There is no region mapped at this address, so there is a abort happening. In the abort, the memory from (mirror0-page2) 0x02100000 from the pysical address 0x02100000 is saved to disc. The memory (mirror1-page2) 0x02500000 is loaded to the physical address 0x02100000. And region2 base address is set to 0x02500000.
<br/>
<br/>
The write now happens to 0x02500100. It does no longer cause an abort. Due to the hardware mirroring, the physical address 0x02100100 will be changed.
<br/>
<br/>
Now the second write.
<br/>
To 0x02100100 will cause an abort, as this region no longer exists. The page 0x02500000 will be saved (from physical 0x02100000) and the old mirror0 page2 will be loaded again. The region is set to 0x02100000. The value 0 is written to the physical address 0x02100100. While the stored value on disc keeps intact.
<br/>
<br/>
On the read now the same things as in the first write will happen. 
<br/>
You can read now  the value you stored to 0x02500100 at 0x02500100. Even tho the physical address was used to store something else inbetween.
<br/>
<br/>
<br/>
Thats the worstcase btw, alternating access shifted 4,8 or 12MB will allways produce a backup/restore cycle. Everything involving different physical memory regions does happen a lot faster. (homebrew that will never access more then 4 mb will never experience the slowdown)<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112996 - HyperHacker - Fri Dec 22, 2006 6:56 am</h4>
    <div class="postbody"><span class="postbody">Saved to disk? As in a swap file? Not a good thing with flash memory. :-/<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113016 - Lick - Fri Dec 22, 2006 11:54 am</h4>
    <div class="postbody"><span class="postbody">If the programmer uses the memory mapping system wisely, he will try to access the same region as much as possible, and swap as little as possible. 
<br/>
<br/>
It would be cool if the OS would stop an application from starting if the RAM is fewer than what the application will us. Though the application will somehow need to specify the amount it needs.<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113018 - OOPMan - Fri Dec 22, 2006 12:17 pm</h4>
    <div class="postbody"><span class="postbody">Well, assuming programs come pre-packaged (Not as .NDS files but in a similar format adjusted for the OS) then packages that are overly large will be rejected.
<br/>
<br/>
Those apps relying on dynamically allocated memory, on the other hand, will fail when Malloc() tosses an error....Hmmmmm, that introduces the problem of cleaning up behind those apps...<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113019 - Mighty Max - Fri Dec 22, 2006 12:29 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">Saved to disk? As in a swap file? Not a good thing with flash memory. :-/</td> </tr></table><span class="postbody">
<br/>
<br/>
We should remove the complete fatlibs. Rewriting the very same fat sectors is not good for flash *shruggs*
<br/>
<br/>
The pagesize is choosen to keep the swapcount as low as possible, and the file is not resized dynamically, which reduces the  write load on filemanagement sectors of fat. And a caching system will reduce the load further.
<br/>
<br/>
Plus you dont have to use the feature, you can still run with the 4MB.
<br/>
<br/>
Also keep in mind that we got non-flash CF soltuions around. microdrives should handle swapping just like any other hdd.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"><br/><br/>Last edited by Mighty Max on Fri Dec 22, 2006 12:41 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#113020 - Mighty Max - Fri Dec 22, 2006 12:34 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>OOPMan wrote:</b></span></td> </tr> <tr> <td class="quote">Well, assuming programs come pre-packaged (Not as .NDS files but in a similar format adjusted for the OS) then packages that are overly large will be rejected.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Current plan is to have an .elf loader. (meaning a lot of work tho)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Those apps relying on dynamically allocated memory, on the other hand, will fail when Malloc() tosses an error....Hmmmmm, that introduces the problem of cleaning up behind those apps...</td> </tr></table><span class="postbody">
<br/>
<br/>
Malloc will be done by the individual program (later via a user mode lib) out of the allocated heap for the program. After a program dies/exits, simply all heapspace tagged with the programs context will be free'd.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113023 - OOPMan - Fri Dec 22, 2006 12:55 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Plus you dont have to use the feature, you can still run with the 4MB.</td> </tr></table><span class="postbody">
<br/>
<br/>
That's good, at least...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Also keep in mind that we got non-flash CF soltuions around. microdrives should handle swapping just like any other hdd.</td> </tr></table><span class="postbody">
<br/>
<br/>
Hmmmm, isn't there only one micro-drive solution? Doesn't it suck?
<br/>
<br/>
I think it would be better to target swapping for the various devices out there offering memory (SC,M3,G6,etc) rather than the lone(?) micro-drive solution...<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113025 - Mighty Max - Fri Dec 22, 2006 1:10 pm</h4>
    <div class="postbody"><span class="postbody">I had mentioned the use of sdram solutions(Opera-card, m3, sc) allready earlier. I just got none of them, so i am developing the cf version first.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113026 - OOPMan - Fri Dec 22, 2006 1:24 pm</h4>
    <div class="postbody"><span class="postbody">You're on a GBAMP then, right?<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113027 - Mighty Max - Fri Dec 22, 2006 1:27 pm</h4>
    <div class="postbody"><span class="postbody">Correct.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113033 - chishm - Fri Dec 22, 2006 1:50 pm</h4>
    <div class="postbody"><span class="postbody">Modern Flash memory cards use write balancing algorithms to prevent wearing of any particular sector. I think people worry too much about the wear on their cards.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113048 - OOPMan - Fri Dec 22, 2006 3:12 pm</h4>
    <div class="postbody"><span class="postbody">Also, 1gb sticks are not very expensive anymore either :-)<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113051 - Mighty Max - Fri Dec 22, 2006 3:19 pm</h4>
    <div class="postbody"><span class="postbody">I still work on a 64MB card from 1998 (was bundeled witha vga resolution digicam that is long gone)<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113125 - Inopia - Sat Dec 23, 2006 12:27 pm</h4>
    <div class="postbody"><span class="postbody">Hey chism, haven't seen you around for a while :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113147 - Mighty Max - Sat Dec 23, 2006 6:35 pm</h4>
    <div class="postbody"><span class="postbody">Dynamically loading a usermode routine now works for the first time.
<br/>
<br/>
The example usermode program (<a class="postlink" href="http://mightymax.org/main_dle.zip" target="_blank">Source</a>) is loaded from disc and executed.
<br/>
<br/>
Play around with it a bit with it (changing strings, location etc). It is not documented yet in any way (not even comments in source). The Version with loader and the example (which loads main.dle from root dir) can be found at: <a href="http://mightymax.org/Virtual16.zip" target="_blank">http://mightymax.org/Virtual16.zip</a>
<br/>
<br/>
It will not use any swapping (except you build a &gt;4MB .dle file :D)<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113149 - OOPMan - Sat Dec 23, 2006 7:22 pm</h4>
    <div class="postbody"><span class="postbody">Very nice. I'll test this on my SC a little later and see what happens...
<br/>
<br/>
At the moment no$gba doesn't like it at all while dualis starts okay but doesn't load the file (Because I haven't set it up properly yet...)
<br/>
<br/>
I still need to grab your fixed version of Desmume...
<br/>
<br/>
Anyway, nice work man :-)<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113150 - Mighty Max - Sat Dec 23, 2006 7:28 pm</h4>
    <div class="postbody"><span class="postbody">Desmume wont run it because of using the old fatlib. (It will load but fail to find main.dle)
<br/>
Dualis wont run it because it does not support alternative swi vectors
<br/>
<br/>
no$cash ... no clue. I dont use it.
<br/>
<br/>
So far it should only be working on these hardwares solutions:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define SUPPORT_NMMC      // comment out this line to remove Neoflash MK2 MMC Card support
<br/>
#define SUPPORT_MPCF      // comment out this line to remove GBA Movie Player support
<br/>
#define SUPPORT_M3CF      // comment out this line to remove M3 Perfect CF support
<br/>
#define SUPPORT_SCCF      // comment out this line to remove Supercard CF support
<br/>
#define SUPPORT_SCSD      // comment out this line to remove Supercard SD support
<br/>
#define SUPPORT_FCSR      // comment out this line to remove GBA Flash Cart support
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
<br/>
I need something to load <b style="color:#FFA34F">system</b> mode drivers at runtime later. And a kernel that checks gbfs space for such a driver or the main.dle<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113152 - OOPMan - Sat Dec 23, 2006 7:34 pm</h4>
    <div class="postbody"><span class="postbody">Hmmmm, well, I guess we'll see what it thinks of my SC:miniSD then :-)<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113201 - Ollie - Sun Dec 24, 2006 10:55 am</h4>
    <div class="postbody"><span class="postbody">Post back how well it does, OOPMan, i'm getting a supercard MiniSD and i want to see if it works. I'm really interested in this thread, i don't understand it all, but i'm interested! XD</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113203 - OOPMan - Sun Dec 24, 2006 11:20 am</h4>
    <div class="postbody"><span class="postbody">Ouch. Bad news. It works less well on my SC:miniSD than it does on Dualis!!!!
<br/>
<br/>
The gbfs version loads up but starts flickering like crazy and doesn't get display the loading progress bar thing or the info bar at the bottom of the screen.
<br/>
<br/>
The non-gbfs version doesn't flicker, but doesn't display the loading bar or the bottom screen bar. It ssems to get to the point that it should and does display the "memory setup" line, but does nothing...
<br/>
<br/>
Hmmmmm...<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113205 - Mighty Max - Sun Dec 24, 2006 11:54 am</h4>
    <div class="postbody"><span class="postbody">Where exactly do these problems occure?
<br/>
<br/>
On the gbfs version:
<br/>
What exactly is flickering? When you say the info bar is not displayed. Is the screen prepared for the info display before (like the bar is there but without content)? Or is still the default console showing?
<br/>
<br/>
On the normal version: what is the last line given out?
<br/>
<br/>
<br/>
---
<br/>
<br/>
Do you know if the old SC:sd driver works with SC:minisd?<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113207 - OOPMan - Sun Dec 24, 2006 12:33 pm</h4>
    <div class="postbody"><span class="postbody">With the GBFS version:
<br/>
<br/>
Flickering starts as soon as the rom loads. Text displayed:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Loading kernel ...
<br/>
protection base
<br/>
siwram set
<br/>
siwram test
<br/>
loaded
<br/>
executing</td> </tr></table><span class="postbody">
<br/>
<br/>
And that's it. No loading bar, no status bar :-(
<br/>
<br/>
This happens when I load the ROM via the SC firmware, Moonshell  or DSO Blue 2.3
<br/>
<br/>
With the non-GBFS version:
<br/>
<br/>
No flicker, text displayed:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Loading kernel ...
<br/>
filesystem init
<br/>
proection base
<br/>
siwram set
<br/>
siwram test
<br/>
loaded 28528 bytes
<br/>
executing</td> </tr></table><span class="postbody">
<br/>
<br/>
And that's it again. No loading bar, no status bar. As with above, this happens no matter how I load the binary...
<br/>
<br/>
On Dualis I see a slight bit of graphics corruption for a second and then the following text:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">itcm setup
<br/>
memory setup
<br/>
<b style="color:#FFA34F">system</b> thread</td> </tr></table><span class="postbody">
<br/>
<br/>
The loading bar displays and the status bar displays...
<br/>
<br/>
Which version of devkitPro are you working on and what FAT library are you using?<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113209 - Mighty Max - Sun Dec 24, 2006 12:46 pm</h4>
    <div class="postbody"><span class="postbody">OK, yes i know now what's causing this.
<br/>
<br/>
I will make a pure gbfs version. That should make it run on desmume again, and solve your troubles for now.
<br/>
<br/>
The current _gbfs version only uses gbfs for the kernel loader, but not within the kernel itself. So the fat driver lockup takes down the kernel on trying to initialize.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113211 - OOPMan - Sun Dec 24, 2006 12:56 pm</h4>
    <div class="postbody"><span class="postbody">I look forward to testing it :-)<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113217 - Mighty Max - Sun Dec 24, 2006 3:19 pm</h4>
    <div class="postbody"><span class="postbody">Pure GBFS vresion (and some bugs fixed)
<br/>
<a href="http://mightymax.org/virtual16_gbfs.rar" target="_blank">http://mightymax.org/virtual16_gbfs.rar</a>
<br/>
<br/>
Works again in desmume (on the fixed/ current CVS version) :D
<br/>
<br/>
Unfortunally with binary data included its a bit difficult to play around. Dynamically loaded fix data ;) 
<br/>
<br/>
<br/>
/me is out for chrismas
<br/>
Everyone out there, have some nice days!<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113218 - Ollie - Sun Dec 24, 2006 4:25 pm</h4>
    <div class="postbody"><span class="postbody">Hey, i thought this little thing i found on Ken Perlin's webpage could be an interesting concept for a DS <b style="color:#FFA34F">operating</b> <b style="color:#FFA34F">system</b>. I just remembered i can't link directly on here can i?
<br/>
<br/>
Well try and find it, it's an interesting java applet demonstrating a very nifty little idea which might work nicely for a DS <b style="color:#FFA34F">operating</b> <b style="color:#FFA34F">system</b> _somehow_.
<br/>
<br/>
If you google Ken Perlin's webpage (it'll probably be found easily), and scroll down to the row of images that is titled "ideas". On that row, the third image in, click it and it will take you to a java applet about "Whiteboard". This java applett is a simple application that gives you a drawing board, you can draw onto it simply using left click, typing puts text where you've last clicked on the screen.
<br/>
<br/>
But the main nifty part is that, you can embed programs onto the white board. You type in the program name, hit the escape key and it loads it onto the whiteboard. Whilst still giving you the ability to infinately pan the screen around and zoom.
<br/>
<br/>
This might make a nifty idea for interacting with multiple programs on a DS, possibly. I just thought that via your OS or not, it'd make a nifty idea for the DS :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113219 - ghaxaq - Sun Dec 24, 2006 4:49 pm</h4>
    <div class="postbody"><span class="postbody">Hi mighty max..I tried out your OS(the last version you released) and it works on my SC-CF..It shows a small user bar and some text, and it also detects the stylus position..it is showing to be some kickass although it cannot do nothing till now..maybe sooner it will make something useful.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113224 - OOPMan - Sun Dec 24, 2006 5:53 pm</h4>
    <div class="postbody"><span class="postbody">The new GBFS version works on my SC:miniSD
<br/>
<br/>
When I first loaded it up it locked as soon as I touched the touchscreen, but when I tried a second time it worked fine. Not sure what caused that...<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113269 - Mighty Max - Mon Dec 25, 2006 7:00 pm</h4>
    <div class="postbody"><span class="postbody"><a href="http://mightymax.org/virtual16_gbfs.rar" target="_blank">http://mightymax.org/virtual16_gbfs.rar</a> now does disable sound/screen on lid-close.
<br/>
<br/>
(Just a minor feature while trying to help in the thread <a href="http://forum.gbadev.org/viewtopic.php?t=12011" target="_blank">http://forum.gbadev.org/viewtopic.php?t=12011</a>)<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113271 - OOPMan - Mon Dec 25, 2006 7:13 pm</h4>
    <div class="postbody"><span class="postbody">Hmmm, by the way, I managed to get that lock-up again. I *think* it happens if you hit the touchscreen too soon after V16 has booted...
<br/>
<br/>
I'm not sure though...
<br/>
<br/>
It's a little infrequent and hard to guess why it's happening...<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113272 - Mighty Max - Mon Dec 25, 2006 7:19 pm</h4>
    <div class="postbody"><span class="postbody">Should be also solved. I didnt have that problem myself, but i was not resetting the fifo data on startup, so remaining words (probably due to the SC loader) in the fifo hardware could cause a hangup (infinite waiting for replies)<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113273 - OOPMan - Mon Dec 25, 2006 7:26 pm</h4>
    <div class="postbody"><span class="postbody">Okay, I'll give it a spin and see if I can lock it up :-)<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113427 - Inopia - Wed Dec 27, 2006 8:01 pm</h4>
    <div class="postbody"><span class="postbody"><a href="http://ecos.sourceware.org/about.html" target="_blank">http://ecos.sourceware.org/about.html</a>
<br/>
<br/>
how about this?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113429 - OOPMan - Wed Dec 27, 2006 8:04 pm</h4>
    <div class="postbody"><span class="postbody">Check back through the thread. The general agreement was that porting an existing RTOS (Such as eCos, Prex or FreeRTOS) would probably be less than optimal...
<br/>
<br/>
However, feel free to give it a shot...<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"><br/><br/>Last edited by OOPMan on Wed Dec 27, 2006 8:43 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#113434 - Mighty Max - Wed Dec 27, 2006 8:23 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Inopia wrote:</b></span></td> </tr> <tr> <td class="quote">http://ecos.sourceware.org/about.html
<br/>
<br/>
how about this?</td> </tr></table><span class="postbody">
<br/>
<br/>
eCos expects an MMU. The DS only has an MPU.
<br/>
<br/>
<br/>
:edit:
<br/>
btw, some nice weird bugs fixed. Did you know, that the instruction &amp; data caches are very resistant against powering the DS off? *g* That caused me some troubles when the gbfs version jumped to addresses from the non gbfs version and vice versa when shutting down and starting the other. Repeated starts of the same version then made it working again.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113484 - HyperHacker - Thu Dec 28, 2006 5:07 am</h4>
    <div class="postbody"><span class="postbody">Interesting. This could be used to exchange data between games, like Banjo-Tooie was supposed to do.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113506 - Inopia - Thu Dec 28, 2006 10:55 am</h4>
    <div class="postbody"><span class="postbody">You guys seem to be making progress!  
<br/>
<br/>
For the gui, I suggest using a hardware abstraction layer. If the new OS has some form of interprocess communication like unix sockets, we could employ the same model as X on unix. When you think about it, it's actually very natural for our purposes. 
<br/>
<br/>
The first layer could be a hardware abstraction layer that manages the sound, graphics and so forth. Usermode programs can request exclusive access to each, but if a lock is obtained the lock may be released by the abstraction layer at any time (to facilitate task switching between two programs that both use the 3D hardware for instance). This would ofcourse require mutual exclusion mechanisms.
<br/>
<br/>
Running in the background we can have usermode programs that provide easy access to these resources. For the sound we could have a soundmixer, and for graphics and input sometiming like an X server. 
<br/>
<br/>
X servers are really quite simple, all they really do is manage windows on the screen on the behalf of usermode programs that connect to it. The X server captures input (buttons and stylus in our case) and generates events on the client programs. Client programs receive a piece of memory they can paint into. For simplicity, we could build the window manager into the X server. The window manager is the piece that draws the borders around windows and makes them draggable. We have two screens, so it would seem natural to me to use them as if they were two desktops, switching between them with some key combo.
<br/>
<br/>
Finally, on top of our X-like server, we could put a gui toolkit. There already are a lot of lightweight solutions available we could perhaps adapt. But this is really the responsibility of the client programs, not the OS.
<br/>
<br/>
Now if a game wants to use both screens, it can simply request a lock on the graphics hardware, wich it is granted as soon as it becomes the 'active' process (this has nothing to do with task scheduling, it's just a bit indicating wich process is currently in the user's face, like task switching with alt+tab on windows) . When the user switches back to the OS, the x-server regains the lock on the graphics hardware and the screen is restored.
<br/>
<br/>
Oh, and we need a screencapture feature so people can post screenshots of their desktops, just like in the good old days :P</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113507 - nornagon - Thu Dec 28, 2006 11:31 am</h4>
    <div class="postbody"><span class="postbody">I hate to be all doom and gloom, but... I think this is a fairly useless pursuit.
<br/>
<br/>
My reason: speed. If I'm writing a game, a toy, a tool, or whatever, I'm going to, sooner or later, run up against a point at which the OS simply can't perform at the speed I need it to. As an example, I've spent the last few days trying to optimise my World of Sand app, and I've managed about four more fps. Which brings it up to a total of 6 fps when the screen's completely full of fairly processing-intensive materials.
<br/>
<br/>
If there's an OS in the way, what hope do I have of getting decent speed out of the DS? What does having an OS provide in terms of benefits to the (seasoned) programmer? Why is it so hard to turn off the DS in order to start a different app/game? What real benefits does having an OS net the user?
<br/>
<br/>
I appreciate the coolness of the thing, but I'm skeptical of its practicality and usefulness.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113508 - Mighty Max - Thu Dec 28, 2006 11:43 am</h4>
    <div class="postbody"><span class="postbody">If an program aquires exclusive access to the vram and threadshedule (setting all others into waiting) there should be no slowdown at all, while retaining the advantage of having dynamically loaded modules. Where code can be loaded and released into the program when needed. 
<br/>
<br/>
A lot of programs around here tho are far away from beeing that cpu intense and use swiWaitForVBlank. Which can be simply replaced with idle() and alowing another few instances of it to run without loosing speed.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113509 - OOPMan - Thu Dec 28, 2006 11:58 am</h4>
    <div class="postbody"><span class="postbody">Nornagon, haven't you encountered the concept of a Real-Time OS before?
<br/>
<br/>
An RTOS is designed with exactly the kind of issues you raised in mind. In other words, a good RTOS will do its very best to hinder performance as little as possible.
<br/>
<br/>
RTOSes are used in a huge variety of time-critical systems on a variety of embedded systems and the best of them have been very good at what they do...
<br/>
<br/>
It's easy to think "Windows" when you think of an OS. As a model OS, though, Windows is a pretty poor point-of-reference. It does a very good job of choking <b style="color:#FFA34F">system</b> resources and reducing <b style="color:#FFA34F">system</b> performance.
<br/>
<br/>
Asking what benefits an OS can provide, on the other hand, is a little silly. By providing an abstraction layer between hardware and software the OS allows software to benefit from various features that, if implemented on a per-program basis can be trouble-some to implement well. By providing a standard way to perform certain tasks, such as accessing <b style="color:#FFA34F">system</b> resources and so forth the OS makes the job of the application programmer that much easier, reducing the workload involved in performing a variety of simple yet important tasks. 
<br/>
<br/>
I appreciate your skepticism, though. This is precisely why the aim is to produce something DS-specific, light-weight and fast.
<br/>
<br/>
I do not think an OS is a useless pursuit. Computing history has illustrated, as far as I can see, that on any sufficiently complex computer <b style="color:#FFA34F">system</b> a well-written OS can provide more in the way of benefits than problems. Is the DS a sufficiently complex systems? Yes. It may seem puny compared to the PC sitting on your desktop, but it's still a great deal more powerful than the <b style="color:#FFA34F">system</b> that flew the Apollo space modules and pretty much any computer produced prior to 1980.
<br/>
<br/>
In some ways this all links into the PALib vs. libnds argument in another thread. Both high-level and low-level have their pros and cons. The trick is to achieve an optimal balance between the two factors...<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113510 - Inopia - Thu Dec 28, 2006 12:09 pm</h4>
    <div class="postbody"><span class="postbody">The key lies in designing a layered <b style="color:#FFA34F">system</b>, this allows lazy programmers that care less about speed to quickly develop their products, and lets hackers obtain locks for low level access to do some cycle fucking.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113525 - ghaxaq - Thu Dec 28, 2006 3:59 pm</h4>
    <div class="postbody"><span class="postbody">An OS will be useful to display applications on your media as icons and make them clickable for easier access, and could also support plugins, and maybe in built apps..thus collects all your needs in one app by linking to external applications that are frequently used without the need to turn on and off your DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113588 - nornagon - Fri Dec 29, 2006 2:00 am</h4>
    <div class="postbody"><span class="postbody">I see a lot of people in this thread trying to suggest GUI ideas for this OS... they want it to have a window manager, a gui toolkit, app multiplexing, blah blah.
<br/>
<br/>
Yes, it's a lot like the libnds vs. PAlib debate. If I can't get at the hardware and do what I want with it without risk of fucking other things up, that's limiting me. And, fyi, I'm working on something right now that gets to the point where swiWaitForVBlank()ing slows it down signifigantly. It also uses the arm7 for some parallel processing stuff, time-critical.
<br/>
<br/>
I think it's a very closed-minded viewpoint to say, "Well a lot of apps spend time idling in swiWaitForVBlank(), so it's fine to replace that with important OS stuff." You run up against a wall when you come across apps that, gasp, <span style="font-style: italic">actually push the hardware</span>.
<br/>
<br/>
More power to you if you can manage to write something that comes within 95% of the speed of the DS without the OS and manages to provide some signifigant benefit. But I don't think that's easy, and I think using an OS--same as using PAlib--makes life easy when you start off, but you end up hitting a performance wall and there's nothing you can do about it without either severely hacking PAlib (or the OS) or just dropping PAlib (or the OS) and just hammering the registers yourself.
<br/>
<br/>
One thing I think a DS-specific OS might actually work for is the purpose that DSLinux currently provides -- that is, IRC, web browsing, music playing, SSH, etc. Miscellaneous tasks that are often performed in parallel to one another. But I think for more critical applications, it just Doesn't Work?.
<br/>
<br/>
It'll be interesting to see where this goes, though :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113598 - tepples - Fri Dec 29, 2006 2:20 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>nornagon wrote:</b></span></td> </tr> <tr> <td class="quote">One thing I think a DS-specific OS might actually work for is the purpose that DSLinux currently provides -- that is, IRC, web browsing, music playing, SSH, etc. Miscellaneous tasks that are often performed in parallel to one another. But I think for more critical applications, it just Doesn't Work?.</td> </tr></table><span class="postbody">
<br/>
A lot of DSOrganize users looking for a successor would take issue with your suggestion that IRC, music playing, text editing, and the like aren't "critical" to their enjoyment of the DS.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113599 - sajiimori - Fri Dec 29, 2006 2:29 am</h4>
    <div class="postbody"><span class="postbody">Bottom line: Is the OS going to have anything that it <span style="font-style: italic">must</span> do every game loop (or periodically for that matter)?
<br/>
<br/>
If you can answer "no" to that, then nornagon can have 100% of the CPU cycles per game loop, end of story.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113601 - simonjhall - Fri Dec 29, 2006 2:57 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">Bottom line: Is the OS going to have anything that it <span style="font-style: italic">must</span> do every game loop (or periodically for that matter)?
<br/>
<br/>
If you can answer "no" to that, then nornagon can have 100% of the CPU cycles per game loop, end of story.</td> </tr></table><span class="postbody">Quoted for truth :-D
<br/>
<br/>
Time to read up on real-time OSes - they've been developed for many years for a world where couting clock cycles matters.
<br/>
I think some people in this thread are looking for a PDA app for the DS, not an OS.<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113606 - nornagon - Fri Dec 29, 2006 4:52 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>nornagon wrote:</b></span></td> </tr> <tr> <td class="quote">One thing I think a DS-specific OS might actually work for is the purpose that DSLinux currently provides -- that is, IRC, web browsing, music playing, SSH, etc. Miscellaneous tasks that are often performed in parallel to one another. But I think for more critical applications, it just Doesn't Work?.</td> </tr></table><span class="postbody">
<br/>
A lot of DSOrganize users looking for a successor would take issue with your suggestion that IRC, music playing, text editing, and the like aren't "critical" to their enjoyment of the DS.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Read again. I said for <span style="font-style: italic">more critical</span> applications -- i.e, ones that require more raw power than the others enumerated.
<br/>
<br/>
So, (and this might've been mentioned earlier in the thread; I haven't read thoroughly) what does the OS actually <span style="font-style: italic">do</span>?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113609 - GPFerror - Fri Dec 29, 2006 5:05 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>GPFerror wrote:</b></span></td> </tr> <tr> <td class="quote">why not improve dslinux with some of the features that you have listed?</td> </tr></table><span class="postbody">
<br/>
<br/>
as dslinux has been brought up again, and my question from page 6 was missed/ignored , I will ask it again :)
<br/>
<br/>
thanks,
<br/>
Troy(GPF)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113611 - nornagon - Fri Dec 29, 2006 5:14 am</h4>
    <div class="postbody"><span class="postbody">@GPFerror: I'm not an expert, but from what I can tell it would be a lot trickier to pare down the dslinux kernel into something that can both run at the speed it needs to and retain compatability with existing dslinux stuff. It's easier to get something workable if we start from the beginning.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113631 - Mighty Max - Fri Dec 29, 2006 10:20 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>nornagon wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
I think it's a very closed-minded viewpoint to say, "Well a lot of apps spend time idling in swiWaitForVBlank(), so it's fine to replace that with important OS stuff." You run up against a wall when you come across apps that, gasp, <span style="font-style: italic">actually push the hardware</span>.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
You really misunderstood me there. idle() does not give the OS time to do things. Actually it doesnt do anything there, but give other threads time to run. If you are the exclusive running thread. idle() does nothing and can be simply ignored.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">what does the OS actually do?</td> </tr></table><span class="postbody">
<br/>
Provide means to share the system resources.
<br/>
(for now)
<br/>
- memory
<br/>
- cputime
<br/>
- gfx
<br/>
(to be done)
<br/>
- libraries
<br/>
- files
<br/>
And ability to start/stop applications
<br/>
<br/>
Meaning, that app, that can set up (start) by itself and does not want to share anything because it pushes the hardware to its limit, doesnt need the service. So why should it be run with the service?<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113638 - nornagon - Fri Dec 29, 2006 12:04 pm</h4>
    <div class="postbody"><span class="postbody">So when I call idle(), does the OS guarantee that control will be returned to my app within a certain amount of time?
<br/>
<br/>
Also -- why do you need to run multiple apps at once on the DS? Unless, like I said before, it's for IRC/SSH/etc., which dslinux does pretty decently.
<br/>
<br/>
It'd be nice, though, if the OS would catch the 'lid closing' interrupt and go to sleep :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113640 - lyptt - Fri Dec 29, 2006 12:16 pm</h4>
    <div class="postbody"><span class="postbody">I think it'd be quite handy, the possibility of closing apps on the DS without powering off is a good feature by itself, I think being forced to power off each time you want to run a new program is really user-unfriendly.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113644 - simonjhall - Fri Dec 29, 2006 12:36 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>lyptt wrote:</b></span></td> </tr> <tr> <td class="quote">I think being forced to power off each time you want to run a new program is really user-unfriendly.</td> </tr></table><span class="postbody">Yeah, that's very true. Plus it'd decrease the chances of me blowing a third fuse on my DS :-D<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113646 - Mighty Max - Fri Dec 29, 2006 12:37 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>nornagon wrote:</b></span></td> </tr> <tr> <td class="quote">So when I call idle(), does the OS guarantee that control will be returned to my app within a certain amount of time?
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Depends on the setting right now. Whether or not preemptive mode is enabled. In pure cooperative, the time needed to return depends only on the time other threads need to get along the next idle.
<br/>
<br/>
In preemptive the timeslots can be sized relatively to the amount of threads running, meaning that the preemptive taskswitch into the thread occures before a constant maximum time passed.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Also -- why do you need to run multiple apps at once on the DS? Unless, like I said before, it's for IRC/SSH/etc., which dslinux does pretty decently.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I dont know. Why do you need to run multiple apps on other platforms? Its the decission of the user i'd think. 
<br/>
Actually i am not very optimistic to that. I just like to do things like that.
<br/>
(DS)Linux has the disadvantage (and its also its advantage) of having all that stuff around it. Even for uClinux my personal opinion is: bloated.
<br/>
But im not familiar enough with the structure to work directly there and Mess with the things we dont need and only eat resources.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
It'd be nice, though, if the OS would catch the 'lid closing' interrupt and go to sleep :)</td> </tr></table><span class="postbody">
<br/>
<br/>
It works quite smooth now, alltho i'm not quite sure if the decission to go into sleep should be done by the kernel or be result of usermode threads to reply for an event and call for the sleep, so it can "pause" correctly (as i.e. the RTC and thus time will still continue)<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113650 - OOPMan - Fri Dec 29, 2006 1:37 pm</h4>
    <div class="postbody"><span class="postbody">Damn, a lot of interesting posts since I last checked the thread :-)
<br/>
<br/>
My opinions on some of the points raised:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Nornagon wrote:</b></span></td> </tr> <tr> <td class="quote">I see a lot of people in this thread trying to suggest GUI ideas for this OS... they want it to have a window manager, a gui toolkit, app multiplexing, blah blah.</td> </tr></table><span class="postbody">
<br/>
<br/>
Okay, this is one point I personally keep stressing again and again. GUI != OS. There are people posting ideas for GUI-based OSes but my personal hope is that Max will pretty much ignore  most of that stuff. I personally don't think a complex GUI system is very suitable for the DS overall. At the moment I think it's more important to write an actual OS, rather than try and integrate all kinds of extraneous features into the kernel that will cause the kind of problems you worry about, namely reduced performance.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Nornagon wrote:</b></span></td> </tr> <tr> <td class="quote">Yes, it's a lot like the libnds vs. PAlib debate. If I can't get at the hardware and do what I want with it without risk of fucking other things up, that's limiting me. And, fyi, I'm working on something right now that gets to the point where swiWaitForVBlank()ing slows it down signifigantly. It also uses the arm7 for some parallel processing stuff, time-critical.</td> </tr></table><span class="postbody">
<br/>
<br/>
I think you've missed part of the point behind Max's V16 experiment. I do believe his aim is specifically not produce an OS, or the base of an OS, that conceals hardware functionality. In other words, V16 is not trying to abstract the underlying hardware of the DS, something which ports of more platform generic OSes (Linux, Prex, etc...) would do in the aims of platform portability. Precisely because the OS is being programmed with ONLY the DS in mind is significent, as it means the OS will be able to expose the underlying hardware with much greater ease, allowing people programming under the OS to keep using the large majority of their funky tricks with few or no changes...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Nornagon wrote:</b></span></td> </tr> <tr> <td class="quote">More power to you if you can manage to write something that comes within 95% of the speed of the DS without the OS and manages to provide some signifigant benefit. But I don't think that's easy, and I think using an OS--same as using PAlib--makes life easy when you start off, but you end up hitting a performance wall and there's nothing you can do about it without either severely hacking PAlib (or the OS) or just dropping PAlib (or the OS) and just hammering the registers yourself.</td> </tr></table><span class="postbody">
<br/>
<br/>
Using an OS does not necessarily make things any easer. Arguably, programming software that functions well in a multi-threaded, multi-processing environment is actually more difficult than just programming software that runs in an exclusive mode.
<br/>
<br/>
The performance wall on computer systems is not so much a case of CPU processing limits as I/O throughput limits. One thing taught in the the CSC lectures I attended on the subject of system and CPU design was that CPU cycles are "cheap". In other words, performance is usually limited more by I/O and I/O-related processing than anything else. While the DS is a rather clever little system, I personally doubt it is quite so funky that the effect I/O has on performance can be ignored. But why am I talking about this anyway? Simple. Blaming the OS for poor performance is an easy thing, but it's not always the right thing. In the case in poorly written OSes, such as Windows, it may be true. However, a custom-designed, light-weight OS for the DS designed with maximum application performance in mind is less likely to be a source of poor performance than I/O operations performed by the applications themselves.
<br/>
<br/>
Let's just take two scenarios. You're running apps for your DS under this hypothetical OS. 
<br/>
<br/>
In case one, you're running numerous applications at once, including at least one "performance hog". Will the peformance oriented app peformance more poorly? Quite possibly. In a case such as this, however, the user should know better than try and running, say, QuakeDS, Moonshell playing MP3s and NDSMail all at once. The combined I/O requirements are sure to cause poor performance in all the applications, regardless of how the OS schedules resources. 
<br/>
<br/>
In case two, you're running QuakeDS and nothing else. Will QuakeDS perform poorly simply because it's being run in an environment with an OS? No, not necessarily. In such a case there will probably only be 2 "programs" running at once: The application and the OS. If the OS has been written in such a fashion that it does it's very best to impact application performance as little as possible then it's rather unlikely that QuakeDS will crash an burn simply because it is being run under an OS. If this were true then technologies such as virtualisation would be simply unfeasible, no matter what tricks were played. However, it is not true and blaming poor performance on the OS is, in this case, a cop-out.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Nornagon wrote:</b></span></td> </tr> <tr> <td class="quote">One thing I think a DS-specific OS might actually work for is the purpose that DSLinux currently provides -- that is, IRC, web browsing, music playing, SSH, etc. Miscellaneous tasks that are often performed in parallel to one another. But I think for more critical applications, it just Doesn't Work™.</td> </tr></table><span class="postbody">
<br/>
<br/>
As I explained above, running a single "critical" application by itself under the OS will not fail simply because said application is being run under an OS.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Nornagon wrote:</b></span></td> </tr> <tr> <td class="quote">@GPFerror: I'm not an expert, but from what I can tell it would be a lot trickier to pare down the dslinux kernel into something that can both run at the speed it needs to and retain compatability with existing dslinux stuff. It's easier to get something workable if we start from the beginning.</td> </tr></table><span class="postbody">
<br/>
<br/>
This is <span style="font-weight: bold">exactly</span> the point I made myself with regards to DSLinux. DSLinux is nice. It's cool that we can actually run Linux on the DS. However, DSLinux is more Linux than DS and hence software running under DSLinux just sees the DS as pretty much any generic embedded system running uClinux.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Nornagon wrote:</b></span></td> </tr> <tr> <td class="quote">So when I call idle(), does the OS guarantee that control will be returned to my app within a certain amount of time?</td> </tr></table><span class="postbody">
<br/>
<br/>
As long as the OS supports pre-emption, yes. 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Nornagon wrote:</b></span></td> </tr> <tr> <td class="quote">Also -- why do you need to run multiple apps at once on the DS? Unless, like I said before, it's for IRC/SSH/etc., which dslinux does pretty decently.</td> </tr></table><span class="postbody">
<br/>
<br/>
Here we come to the crux of the problem. Why not just do it under DSLinux? There are a couple of reasons, but the first and foremost, as I stated above, is that DSLinux is more Linux than DS. Meaning that it's a nice thing to work with if you want to port existing Linux applications with minimal fuss or create new appications within an environment that is specifically Linux. On the other hand, if you want to create software that is designed with the DS in mind then DSLinux is not a good choice. it abstracts the hardware in such a fashion that the DS appears to be just another genetic computer with keyboard, mouse, display and wifi. Linux's portability is both a pro and a con. On the one hand it makes porting existing code easy and ensures that various system components can be relied on to work in a certain way, reagrdless of the underlying hardware (Keyboard, mouse, display, wifi, file systems, etc, etc). On the other hand, though, it's portability does a good job of completely concealing the underlying features of the DS itself. The only "program" in DSLinux that can actually see the DS for what it is the OS itself. This is, make no mistake, more of a loss than a gain, given that the DS is a fixed platform and thus does not benefit greatly from Linux's inherent portability, which makes more sense if one's aim is to produce an OS and software for that OS that runs on a variety of platforms.
<br/>
<br/>
Make no mistake, an OS for the DS is a good thing. Some people thinking of the benefits are concerned with various aspects such as GUIs and Window Systems that could be described, at best, as being "shallow" concerns. These are not the true benefits of the OS. The benefits of the OS come in at a rather lower level and are by no means ingsignificent.
<br/>
<br/>
Support for shared code (Ie. dynamically linked libraries) could make a very very big difference in application programming. Shared code allows programs to be reduced in size overall and pared down to a more modular form. It also allows for easier recitification of problems in software and shared code alike. A problem with the application does not require a rebuild of the shared code anda a problem with shared code can be fixed without having to rebuild every single application that relies on the shared code.
<br/>
<br/>
File system and device management is another important area that stands to benefit. At the moment DS development is hindered by the conflict between gba_nds_fat and libfat. Some developers work with gba_nds_fat, or one of it's numerous peculiar variants (Another problem in itself), and older version of devkitPro while other developers make use of libfat and use the more recent version of devkirPro. This is not a good thing. It segments the developer community and makes it rather more difficult for source code to be shared and adapted, where said soure code relies on one or the other library. Allowing the OS to handle the underlying access to media devices could reap numerous benefits. Developers need not worry about which library to use and which version of devkitPro they need. Both users and developers could also expect better support for SLOT-1 devices without it coming at the cost of reduced support for SLOT-2 devices. The overall effect of this could be significant. Assuming popular applaications such as Moonshell, DSOrganize and more could be adapted to the OS without too much trouble, said apps and many others could be guaranteed to work correctly, regardless of the underlying media adapter.
<br/>
<br/>
To me these two points are highly significant and the first was the seed of this entire topic :-)
<br/>
<br/>
Anyway, so, my thoughts :-)<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113657 - nornagon - Fri Dec 29, 2006 2:35 pm</h4>
    <div class="postbody"><span class="postbody">Unification of code is a good thing, agreed. It'd be nice to be able to link against, say, a shared MP3/OGG/MOD/S3M/etc. playing library, or a jpg/png library.
<br/>
<br/>
The reason I'm confused is: Why has multithreading become a part of this? It's not an attempt to replace DSLinux, with its SSH and IRC and multitasking capabilities, right? The aim is to provide a very thin compatability layer for programs -- essentially, flashcart access unification. The rest of the DS hardware stays the same; no need to provide a compatibility layer.
<br/>
<br/>
Where are the I/O bottlenecks on the DS? The cache on the arm9 is pretty good at fixing up ram access bottlenecks, and the only other I/O points are touchscreen/buttons and the displays -- to which access is very fast anyway. More time is spent processing than displaying or reading input. Oh, and flashcart access -- but that should be only during load/save operations, and shouldn't be a performance problem.
<br/>
<br/>
By "Doesn't Work" I don't mean the thing doesn't work at all -- I mean it's too slow to be usable.
<br/>
<br/>
<br/>
So, the reason to have an OS is essentially for shared and dynamically linked code. Which is a Good Thing, because it lets the shared code be updated independently of individual applications. Stuff like touchscreen accuracy, flashcart access, compression/decompression, and mixing. Nice. But why do we need to multithread? Would it not be enough to provide the application with an OS call to unload itself, letting the OS take control again so the user can load another app? There's no need for multitasking, as far as I can see.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113662 - OOPMan - Fri Dec 29, 2006 3:22 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>nornagon wrote:</b></span></td> </tr> <tr> <td class="quote">Unification of code is a good thing, agreed. It'd be nice to be able to link against, say, a shared MP3/OGG/MOD/S3M/etc. playing library, or a jpg/png library.
<br/>
<br/>
The reason I'm confused is: Why has multithreading become a part of this? It's not an attempt to replace DSLinux, with its SSH and IRC and multitasking capabilities, right? The aim is to provide a very thin compatability layer for programs -- essentially, flashcart access unification. The rest of the DS hardware stays the same; no need to provide a compatibility layer.</td> </tr></table><span class="postbody">
<br/>
<br/>
Er, no, the aim is actually to write an OS :-) A thin compatibility layer is an option, yes, but a thin compatibility layer would probably become Yet Another NDS Library. Some people might use it, some people might not. Of course, the same could be said of an OS I guess :-0 However, it is possible that the benefits of an OS would encourage great adoption than that of Yet Another Library...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Where are the I/O bottlenecks on the DS? The cache on the arm9 is pretty good at fixing up ram access bottlenecks, and the only other I/O points are touchscreen/buttons and the displays -- to which access is very fast anyway. More time is spent processing than displaying or reading input. Oh, and flashcart access -- but that should be only during load/save operations, and shouldn't be a performance problem.</td> </tr></table><span class="postbody">
<br/>
<br/>
Unfortunately there are pretty much always bottlenecks, even with the use of caches and other useful features to reduce their impact. Optical computing might change all that, but that's not quite at production level just yet :-)
<br/>
<br/>
The key I/O bottleneck I was referring to was media device access. Pretty much all homebrew uses media devices to some extent and in the more complex ones I/O bottlenecks are a problem (Example: Nitrotracker was virtually unusable on SC-devices due to an I/O problem in the fat library used that made directory listing horribly slow). While I appreciate that some homebrew (Such as World of Sand ;-) rely more on the CPUs than anything else, one has to think of the worst case scenario when taking into account problems of various kind (I/O or not...)
<br/>
<br/>
I think it's safe to say that media devices on the DS, while more sprightly than HDDs, are not quite at the level yet where they can be ignored as a source of I/O bottlenecks.
<br/>
<br/>
Possibly I didn't explain the "cpu cycles are cheap" concept as well as I could have. In the above quote you state "More time is spent processing than displaying or reading input". While this is perhaps technically true, it's also somewhat simplistic. CPU cycles are plentiful, even on a low-power processor such as the ARM7/9. Wasting a few here and there to support the underlying functions of an OS is not nearly as huge a performance hog as those cycles spent handling I/O from various devices. In other words, the processor time spent on I/O is more of a worry than processor time spent in purely internal CPU operations. I/O is pretty much always the bottleneck. Unless the OS is doing a lot of I/O of its own, which is definitely not the aim of the game, it's effect on performance should not be nearly as terrible as you imagine.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">So, the reason to have an OS is essentially for shared and dynamically linked code. Which is a Good Thing, because it lets the shared code be updated independently of individual applications. Stuff like touchscreen accuracy, flashcart access, compression/decompression, and mixing. Nice. But why do we need to multithread? Would it not be enough to provide the application with an OS call to unload itself, letting the OS take control again so the user can load another app? There's no need for multitasking, as far as I can see.</td> </tr></table><span class="postbody">
<br/>
<br/>
Why do we need to multi-thread in the OS? There are a couple of important reasons for this. 
<br/>
<br/>
One is to ensure that applications using multi-threading do so in a predictable fashion. If every app used it's own multi-threading library then multi-threading would most likely not be reliable or predictable.
<br/>
<br/>
Another reason was significant in the early history of multi-tasking version of UNIX that did not support multi-threading (Linux went through this stage as well). By not supporting multi-threading at the OS level one forces developers to use application-level multi-threading libraries. While these can function well, they nevertheless function within the context of a single thread of execution within the OS. Essentially, their multi-threading is artificial and this significantly reduces the benefits of multi-threading.
<br/>
<br/>
In the context of the DS we have other reasons as well. 
<br/>
<br/>
For one, unless someone decides to write a single monolithic media application that plays music, performs file I/O and integrates whatever other arbitrary features users desire then the idea of an OS that lacks multi-tasking and multi-threading falls down. If such an app is not written, users will inevitably become frustrated. They want to do tasks X, Y and Z and app A, rather the load app A to perform task A, app B to perform task Y and app to perform task Z in a linear or possibly alternating fashion.
<br/>
<br/>
Put another way. A multi-threading, multi-tasking DS OS would allow someone out there to devote their development time to writing a file I/O application while someone else writes a dedicated music player. The developers of each app are able to pursue their aims as completely as they desire, while the users are able to run either app or even both apps at the same time, secure in the knowledge that the OS will ensure that neither app interferes with the other.
<br/>
<br/>
In other words, it reduces the work individual developers have to do to support certain features users deem necessary (Eg, Performing file I/O while listening to music). 
<br/>
<br/>
What happens when you don't have multi-threading and multi-tasking to support this? Take a look at DSO and Moonshell. Whenever you change directories music playback stutters. This is mostly likely due to the application being single-threaded and thus is unable to perform file I/O and music playback in an alternating (Ie. Multi-threaded) fashion. 
<br/>
<br/>
Is it possible to rectifiy this problem? Yes. As explained above. File I/O is a costly operation, where as the music playback is likely to be more CPU intensive than anything else. By threading the file I/O and the music playback you are able to allow the user to seemingly play music and perform file I/O at the same time. This satisfies the user's desire to do both, even though the tasks themselves are executing linearly.
<br/>
<br/>
Implementing such multi-threading on a per-application basis is costly however. On the other hand, writing multi-threaded code in the knowledge that the large majority the work involved in getting such code to work well is handled by the OS makes it easier for individual developers to take the plunge and multi-thread their code.
<br/>
<br/>
There are probably many more reasons I could pull out of the sack, but I'll only lay down one more.
<br/>
<br/>
The DS is an asymmetric, dual-processor system. However, I'm guessing that a significant number of developers out there (This applies to the PALib crowd especially, I'm guessing) treat it as a uni-processor system, relying on a pre-supplied ARM7 binary to handle various tasks (Sound, Wifi, Input, etc...). While this may be an easy way to dip one's toe in the water with regards to coding for the DS, it's not without it's problems. For a start, it's wasteful. Both Mighty Max and Hermes have illustrated that it is possible to run generic code on both the ARM7 and the ARM9 at the same time. Why then does a large body of the homebrew developer scene largely ignore at least one of the processors? I'd imagine it's because the work involved in getting an individual program to use the ARM7 and the ARM9 in a useful, stable fashion is difficult. 
<br/>
<br/>
Here is where the OS can prove useful. By supporting both the DS's peculiar hardware and multi-tasking and multi-threading it could allow for better general usage of both processors at the same time. In a nutshell, it could improve efficiency.
<br/>
<br/>
In my opinion, support for multi-threading and multi-tasking is essential. To ignore one or the other would lax.
<br/>
<br/>
With regards to implementing the OS as an application that loads and unloads completely as required, I have to ask what the point is. If the OS is optional, why use it? After the OS has been unloaded applications are free to use the hardware as if the OS had never been loaded in the first place. This makes the OS itself rather pointless, in my opinion. Whatever memory organisation it's pursued while likely disappear and the various other features it could provide (Multi-threading, multi-tasking, etc) would be pointless to implement. In essence, your suggestion in this regard would be a bad idea, as the benefits offered over bare-metal coding would be few and, quite likely, trivial. To put it another way: libcartreset already does this. Duplicating it's role would be a bad idea.<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113664 - tepples - Fri Dec 29, 2006 3:32 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>nornagon wrote:</b></span></td> </tr> <tr> <td class="quote">Also -- why do you need to run multiple apps at once on the DS? Unless, like I said before, it's for IRC/SSH/etc., which dslinux does pretty decently.</td> </tr></table><span class="postbody">
<br/>
OOPMan made some excellent points. As I see it, DSLinux's lack of a GUI is another big reason. Some people think it would be easier to start from scratch than to shoehorn uCLinux + X + app into 4 MiB (for M2, SC Rumble, or SLOT-1 cards). In addition, an OS designed for running games would make it easy to add background music to your game by running a Vorbis player in the background.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>OOPMan wrote:</b></span></td> </tr> <tr> <td class="quote">At the moment DS development is hindered by the conflict between gba_nds_fat and libfat. Some developers work with gba_nds_fat, or one of it's numerous peculiar variants (Another problem in itself), and older version of devkitPro while other developers make use of libfat and use the more recent version of devkirPro. This is not a good thing.</td> </tr></table><span class="postbody">
<br/>
The issue is that the most recent binary version of devkitPro isn't compatible with all the features of libfat due to lack of space in the devoptab, and wintermute has given no indication that he has made <span style="font-style: italic">any</span> progress toward devkitPro R20.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>nornagon wrote:</b></span></td> </tr> <tr> <td class="quote">Why has multithreading become a part of this? It's not an attempt to replace DSLinux, with its SSH and IRC and multitasking capabilities, right? The aim is to provide a very thin compatability layer for programs -- essentially, flashcart access unification.</td> </tr></table><span class="postbody">
<br/>
Isn't that what DLDI is for?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113678 - Inopia - Fri Dec 29, 2006 6:03 pm</h4>
    <div class="postbody"><span class="postbody">@oopman: I agree with you that we shouldn't start cramming GUI stuff into the kernel, that's why I proposed these things should be in user mode.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113690 - OOPMan - Fri Dec 29, 2006 7:47 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Inopia wrote:</b></span></td> </tr> <tr> <td class="quote">@oopman: I agree with you that we shouldn't start cramming GUI stuff into the kernel, that's why I proposed these things should be in user mode.</td> </tr></table><span class="postbody">
<br/>
<br/>
Don't worry, I wasn't singling you out :-) There have been other GUI related posts but I would have to say your recent one was rather more grounded in reality than some ;-)
<br/>
<br/>
When it comes to GUIs my preferred system would be a CLI with natural language recognition and auto-completion. Maybe not realistic, especially not on a system like the DS, but fun for sure :-)<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113694 - Mighty Max - Fri Dec 29, 2006 8:31 pm</h4>
    <div class="postbody"><span class="postbody">I'm currently cleaning up and commenting the sources for the kernel. There are a several ToDo's in there. That should make it possible for everyone to take a look and extract the features wanted.
<br/>
<br/>
Virtual Memory and the threading basics are complete, dynamically loading is still in a testing state. So grab you knifes and prepare to cut the parts out ;)<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113696 - OOPMan - Fri Dec 29, 2006 9:11 pm</h4>
    <div class="postbody"><span class="postbody">Nice work Max. Hope to take a look at sources once they're released :-)<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113722 - Mighty Max - Fri Dec 29, 2006 11:46 pm</h4>
    <div class="postbody"><span class="postbody">I have packed the whole project folder into <a href="http://mightymax.org/virtual16.zip" target="_blank">http://mightymax.org/virtual16.zip</a>
<br/>
<br/>
Some copies in the makefiles are hardcoded to /F/ (copies to my CompactFlash) you might want to remove thos copies. Other then this, please report back when you have problems compiling.
<br/>
<br/>
Folders/Parts:
<br/>
- arm7: arm7 binary that starts with the loader and will be used from the kernel
<br/>
- arm9/arm9_gbfs: simply loads the .knl into siwram and jumps to it.
<br/>
- kernel: the arm9 kernel, doing all the nasty stuff
<br/>
- userMode: contains the main.dle template, and the .o(elf) =&gt; .dle converter
<br/>
- virt_16: data needed on the CF card by the FAT version<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113724 - nornagon - Sat Dec 30, 2006 1:06 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>OOPMan wrote:</b></span></td> </tr> <tr> <td class="quote">The key I/O bottleneck I was referring to was media device access.</td> </tr></table><span class="postbody">
<br/>
<br/>
... Which should really only be used in short spurts, such as loading/saving or directory browsing.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>OOPMan wrote:</b></span></td> </tr> <tr> <td class="quote">CPU cycles are plentiful, even on a low-power processor such as the ARM7/9. Wasting a few here and there to support the underlying functions of an OS is not nearly as huge a performance hog as those cycles spent handling I/O from various devices.</td> </tr></table><span class="postbody">
<br/>
<br/>
So what you're saying is that the OS will be fast due to the fact that it does no flashcart I/O in and of itself. Okay.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>OOPMan wrote:</b></span></td> </tr> <tr> <td class="quote">One is to ensure that applications using multi-threading do so in a predictable fashion. If every app used it's own multi-threading library then multi-threading would most likely not be reliable or predictable.</td> </tr></table><span class="postbody">
<br/>
<br/>
... But multithreading apps that don't use the OS would still work fine without the OS. If an app neads multithreading, it uses a multithreading library. The multithreading libraries available work.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>OOPMan wrote:</b></span></td> </tr> <tr> <td class="quote">By not supporting multi-threading at the OS level one forces developers to use application-level multi-threading libraries.</td> </tr></table><span class="postbody">
<br/>
Which works just fine without an OS.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>OOPMan wrote:</b></span></td> </tr> <tr> <td class="quote">For one, unless someone decides to write a single monolithic media application that plays music, performs file I/O and integrates whatever other arbitrary features users desire</td> </tr></table><span class="postbody">
<br/>
<br/>
... like DSLinux...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>OOPMan wrote:</b></span></td> </tr> <tr> <td class="quote">then the idea of an OS that lacks multi-tasking and multi-threading falls down. If such an app is not written, users will inevitably become frustrated. They want to do tasks X, Y and Z and app A, rather the load app A to perform task A, app B to perform task Y and app to perform task Z in a linear or possibly alternating fashion.</td> </tr></table><span class="postbody">
<br/>
<br/>
Or they could use DSLinux. Which works fine. (Though still requires a little wizardry.)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>OOPMan wrote:</b></span></td> </tr> <tr> <td class="quote">Is it possible to rectifiy this problem? Yes. As explained above. File I/O is a costly operation, where as the music playback is likely to be more CPU intensive than anything else. By threading the file I/O and the music playback you are able to allow the user to seemingly play music and perform file I/O at the same time. This satisfies the user's desire to do both, even though the tasks themselves are executing linearly.</td> </tr></table><span class="postbody">
<br/>
<br/>
So is the user playing music and reading an ebook at the same time, or is he (she) using an ebook reader that plays music? The difference between multitasking and multithreading is one that should be made (I seem to have failed at that, I'll try harder next time :P)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>OOPMan wrote:</b></span></td> </tr> <tr> <td class="quote">Implementing such multi-threading on a per-application basis is costly however. On the other hand, writing multi-threaded code in the knowledge that the large majority the work involved in getting such code to work well is handled by the OS makes it easier for individual developers to take the plunge and multi-thread their code.</td> </tr></table><span class="postbody">
<br/>
<br/>
How many apps benefit from multithreading? So far as I can see, the uses would be pretty limited: it could be used for background encodes/decodes, and it could be used to perform file i/o while doing other things. There are other uses, but most of them much less useful than those two.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>OOPMan wrote:</b></span></td> </tr> <tr> <td class="quote">The DS is an asymmetric, dual-processor system. However, I'm guessing that a significant number of developers out there (This applies to the PALib crowd especially, I'm guessing) treat it as a uni-processor system, relying on a pre-supplied ARM7 binary to handle various tasks (Sound, Wifi, Input, etc...). While this may be an easy way to dip one's toe in the water with regards to coding for the DS, it's not without it's problems. For a start, it's wasteful. Both Mighty Max and Hermes have illustrated that it is possible to run generic code on both the ARM7 and the ARM9 at the same time. Why then does a large body of the homebrew developer scene largely ignore at least one of the processors? I'd imagine it's because the work involved in getting an individual program to use the ARM7 and the ARM9 in a useful, stable fashion is difficult.</td> </tr></table><span class="postbody">
<br/>
<br/>
Having recently done just that, I can vouch for its difficulty. The trick, though, is not just getting code to run on the arm7 (and shuttle data back and forth in just the right manner), it's also making sure your parallelism works right. I'll draw from my experience with World of Sand: I moved processing of some of the field to the arm7. Essentially, I split the field in two every frame and handed one chunk to the arm7, letting the arm9 do the rest. Then I'd run the algo over the bit in the middle, and display the result. The problem was that, due to the way the algorithm works, the top part of the field always has to be run *after* the bottom part; there's no way of having both processors working on the same frame at the same time. The solution (thanks sgstair) is to have the arm7 actually process the <span style="font-style: italic">next</span> frame, while the arm9 is processing the current one, so by the time the arm9 finishes processing this frame, there's always some data left for it from the arm7 which it can continue on from.
<br/>
<br/>
You'll admit that's not very easily genericizable.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>OOPMan wrote:</b></span></td> </tr> <tr> <td class="quote">In my opinion, support for multi-threading and multi-tasking is essential. To ignore one or the other would lax.</td> </tr></table><span class="postbody">
<br/>
Multi-threading, I see now, is pretty essential. I'm still skeptical about the usefulness of multitasking.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">With regards to implementing the OS as an application that loads and unloads completely as required...</td> </tr></table><span class="postbody">
<br/>
<br/>
D'oh, you missed what I was saying -- I meant, provide the app with a callout to the OS that unloads <span style="font-style: italic">the app</span> and lets the user select another app. That means you don't have to poweroff, which people seem to hate doing for some reason.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113727 - Sausage Boy - Sat Dec 30, 2006 1:56 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">D'oh, you missed what I was saying -- I meant, provide the app with a callout to the OS that unloads the app and lets the user select another app. That means you don't have to poweroff, which people seem to hate doing for some reason.</td> </tr></table><span class="postbody">
<br/>
<br/>
But what happens when you want to listen to music and play a nice little game of tetris at the same time?<br/>_________________<br/>"no offense, but this is the gayest game ever"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113737 - nornagon - Sat Dec 30, 2006 5:45 am</h4>
    <div class="postbody"><span class="postbody">Chances are the tetris game has background music.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113738 - Firon - Sat Dec 30, 2006 6:09 am</h4>
    <div class="postbody"><span class="postbody">But what if you don't like the game's music? :P</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113743 - nornagon - Sat Dec 30, 2006 6:52 am</h4>
    <div class="postbody"><span class="postbody">Better hope it comes with source.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113746 - HyperHacker - Sat Dec 30, 2006 8:25 am</h4>
    <div class="postbody"><span class="postbody"><span style="font-weight: bold">Why multitask?</span>
<br/>
So we can, uh, do multiple tasks at once. For example, play music while reading text files, or copy between multiple instances of some sort of editor. I don't know how many times people have whined that Moonshell and DSO are only able to do one thing at a time.
<br/>
<br/>
<span style="font-weight: bold">Why not use DSLinux?</span>
<br/>
It's not practical. DSLinux was only meant as a tech demo to say "hey, we can run Linux on the DS", much like the <a class="postlink" href="http://www.embeddedarm.com/news/netbsd_toaster.htm" target="_blank">NetBSD Toaster</a>. It's akward to use and doesn't do a lot of things well; for example, last time I tried to play an MP3 it only played one of every 8 seconds and would crash the OS if I mistyped the file name.
<br/>
<br/>
<span style="font-weight: bold">Why dynamic link?</span>
<br/>
One, it saves space. Two, it eliminates the problem that Program X doesn't work with Card Y because Card Y is brand new and Program X was abandoned months ago. Similarly, if Program X has some sort of touch-screen problem for example, updating a file fixes it and all other programs, even if the original author isn't around anymore.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>nornagon wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>OOPMan wrote:</b></span></td> </tr> <tr> <td class="quote">The key I/O bottleneck I was referring to was media device access.</td> </tr></table><span class="postbody">
<br/>
<br/>
... Which should really only be used in short spurts, such as loading/saving or directory browsing.</span></td> </tr></table><span class="postbody">
<br/>
Should, but can't always. MP3 players, for example, generally stream the file from disk as buffering ~3.5MB of it into memory at a time would take ages, meaning slow start-up times and a long pause every time the buffer is emptied. Try DSOrganize's streaming audio feature for an example of how well this works.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113756 - nornagon - Sat Dec 30, 2006 9:52 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote"><span style="font-weight: bold">Why multitask?</span>
<br/>
So we can, uh, do multiple tasks at once. For example, play music while reading text files, or copy between multiple instances of some sort of editor. I don't know how many times people have whined that Moonshell and DSO are only able to do one thing at a time.</td> </tr></table><span class="postbody">
<br/>
<br/>
But is that a feature that will draw homebrew developers into developing with this OS?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote"><span style="font-weight: bold">Why not use DSLinux?</span>
<br/>
It's not practical. DSLinux was only meant as a tech demo to say "hey, we can run Linux on the DS", much like the <a class="postlink" href="http://www.embeddedarm.com/news/netbsd_toaster.htm" target="_blank">NetBSD Toaster</a>. It's akward to use and doesn't do a lot of things well; for example, last time I tried to play an MP3 it only played one of every 8 seconds and would crash the OS if I mistyped the file name.</td> </tr></table><span class="postbody">
<br/>
<br/>
DSLinux works very well for what I use it for (mostly); that is, SSH, IRC and web browsing with links. There's the occasional hiccup but less every week.
<br/>
<br/>
[quote="HyperHacker]<span style="font-weight: bold">Why dynamic link?</span>
<br/>
One, it saves space.[/quote]
<br/>
<br/>
Uh, what? Where does it save space, on your SD card? You're honestly worried about the few extra kB of space per program that linking statically consumes? On a 256MB+ card? Come again?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">Two, it eliminates the problem that Program X doesn't work with Card Y because Card Y is brand new and Program X was abandoned months ago. Similarly, if Program X has some sort of touch-screen problem for example, updating a file fixes it and all other programs, even if the original author isn't around anymore.</td> </tr></table><span class="postbody">
<br/>
<br/>
Agreed, a good thing.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">Should, but can't always. MP3 players, for example, generally stream the file from disk as buffering ~3.5MB of it into memory at a time would take ages, meaning slow start-up times and a long pause every time the buffer is emptied. Try DSOrganize's streaming audio feature for an example of how well this works.</td> </tr></table><span class="postbody">
<br/>
<br/>
Okay, fair. How can this easily be put in a multithreading context? Are you just going to read the data during VDraw or when the program's otherwise idle?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113759 - Mighty Max - Sat Dec 30, 2006 10:35 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Uh, what? Where does it save space, on your SD card? You're honestly worried about the few extra kB of space per program that linking statically consumes? On a 256MB+ card? Come again?
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
When loaded every statical linked binary has to be in main ram for cards like the gbamp or slot-1 soltutions. There is no need to have a mpeg decoder when not playing mpegs, no need for a menucode where the menu is disabled, no need for having the games AI code when in menu etc ... that can easily sum up several 100kB.
<br/>
<br/>
And then there are those apps you talked about that really pushes the DS hardware. RAM is an expensive resource on the DS. Just think about why there is an Opera Card
<br/>
<br/>
<br/>
<br/>
And actually, i dont try to draw anyone to use this. I really don't care if anyone will use it later. Im doing this to proof it to myself that i'm able to do so. (See the my first post within this thread and the attraction of the impossible/difficult to do decently to me)<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113760 - Firon - Sat Dec 30, 2006 10:39 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Two, it eliminates the problem that Program X doesn't work with Card Y because Card Y is brand new and Program X was abandoned months ago.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
DLDI pretty much solves that problem.</span><span class="gensmall"><br/><br/>Last edited by Firon on Sat Dec 30, 2006 1:07 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#113766 - nornagon - Sat Dec 30, 2006 12:51 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">And actually, i dont try to draw anyone to use this. I really don't care if anyone will use it later. Im doing this to proof it to myself that i'm able to do so. (See the my first post within this thread and the attraction of the impossible/difficult to do decently to me)</td> </tr></table><span class="postbody">
<br/>
<br/>
Ahhhhh, well then, that makes it a completely different beast. Doing things Because You Can is cool; I was thinking you were doing this with the view of getting homebrew coders to use it near-universally.
<br/>
<br/>
I'm interested to see what happens :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113776 - tepples - Sat Dec 30, 2006 3:28 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>nornagon wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>OOPMan wrote:</b></span></td> </tr> <tr> <td class="quote">For one, unless someone decides to write a single monolithic media application that plays music, performs file I/O and integrates whatever other arbitrary features users desire</td> </tr></table><span class="postbody">
<br/>
... like DSLinux...</span></td> </tr></table><span class="postbody">
<br/>
Some operating systems are light. Other operating systems are heavy. Because this project is lighter than DSLinux, it is more feasible to put a GUI on top of the basics and have it all fit into 4 MB for people who have a GBA Movie Player or SuperCard Rumble series, or people who have a SLOT-1 card and live in those territories where the Opera browser is not released.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Or they could use DSLinux. Which works fine. (Though still requires a little wizardry.)</td> </tr></table><span class="postbody">
<br/>
How much more RAM would be needed to get X working on DSLinux? As I see it, the point of this project is not to create a GUI itself but to create an operating system that leaves enough room in RAM for a GUI.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">So is the user playing music and reading an ebook at the same time, or is he (she) using an ebook reader that plays music?</td> </tr></table><span class="postbody">
<br/>
Applets in the Java platform implement an interface that extends java.lang.Thread. Mac OS 1 through 6 used a similar interface for the cooperatively-multitasked "desk accessory" apps that were available on its start menu. (Mac OS 7 and later put each desk accessory in its own process and generalized the start menu to cover shortcuts to any application.)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">The difference between multitasking and multithreading is one that should be made (I seem to have failed at that, I'll try harder next time :P)</td> </tr></table><span class="postbody">
<br/>
Linux has no difference. At one point in Linux's development, threads were merely processes that shared memory.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">How many apps benefit from multithreading? So far as I can see, the uses would be pretty limited: it could be used for background encodes/decodes, and it could be used to perform file i/o while doing other things. There are other uses, but most of them much less useful than those two.</td> </tr></table><span class="postbody">
<br/>
Games can use background tasks to decompress textures that they have loaded. They can use background tasks to compute . I believe <span style="font-style: italic">The Ur-Quan Masters</span> does the latter, as it's a port from the thread-heavy 3DO operating system.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>OOPMan wrote:</b></span></td> </tr> <tr> <td class="quote">I'd imagine it's because the work involved in getting an individual program to use the ARM7 and the ARM9 in a useful, stable fashion is difficult.</td> </tr></table><span class="postbody">
<br/>
Having recently done just that, I can vouch for its difficulty. The trick, though, is not just getting code to run on the arm7 (and shuttle data back and forth in just the right manner), it's also making sure your parallelism works right.</span></td> </tr></table><span class="postbody">
<br/>
You're right that a lot of homebrew developers have little experience in programming where multiple threads cooperate closely. For one thing, most of them have only one CPU in their machines, as dual core x86 CPUs are comparatively recent. But it's good practice, as one needs to think parallel to hope of getting a job at a company with a console devkit.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Multi-threading, I see now, is pretty essential. I'm still skeptical about the usefulness of multitasking.</td> </tr></table><span class="postbody">
<br/>
Multitasking is useful in this OS for the same reason it is useful in DSLinux. We're just trying to get it done using less RAM.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>nornagon wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Firon wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>nornagon wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Sausage Boy wrote:</b></span></td> </tr> <tr> <td class="quote">But what happens when you want to listen to music and play a nice little game of tetris at the same time?</td> </tr></table><span class="postbody">
<br/>
Chances are the tetris game has background music.</span></td> </tr></table><span class="postbody">
<br/>
But what if you don't like the game's music? :P</span></td> </tr></table><span class="postbody">
<br/>
Better hope it comes with source.</span></td> </tr></table><span class="postbody">
<br/>
As far as I can tell, no Tetris? product has come with source code. And yes, a lot of people over on <a class="postlink" href="http://www.tetrisconcept.com/forum/index.php" target="_blank">TC</a> hate listening to the <span style="font-style: italic">Tetris DS</span> remix of <span style="font-style: italic">Super Mario Bros.</span> over and over.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">Similarly, if Program X has some sort of touch-screen problem for example, updating a file fixes it and all other programs, even if the original author isn't around anymore.</td> </tr></table><span class="postbody">
<br/>
That's a good thing in general, but operating system maintainers have to watch out for the DLL hell problem. If subsequent versions of the operating system change the interface's semantics behind an application's back, the application will misbehave.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>nornagon wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">Why dynamic link?
<br/>
One, it saves space.</td> </tr></table><span class="postbody">
<br/>
Uh, what? Where does it save space, on your SD card? You're honestly worried about the few extra kB of space per program that linking statically consumes?</span></td> </tr></table><span class="postbody">
<br/>
It saves space in RAM. If you need one font at a given point but not another, you can unload the fonts you're using to save memory. Likewise, if you need the rich text editor library at a given point, but you don't need the Vorbis decoder library, you can unload the Vorbis decoder to make more room for the rich text editor. Likewise with the Vorbis decoder vs. the MP3 decoder vs. the MOD decoder.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>nornagon wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">MP3 players, for example, generally stream the file from disk</td> </tr></table><span class="postbody">
<br/>
Okay, fair. How can this easily be put in a multithreading context? Are you just going to read the data during VDraw or when the program's otherwise idle?</span></td> </tr></table><span class="postbody">
<br/>
As of right now, Luminesweeper's GSM streaming and decoding run during  unused time in vdraw.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113802 - Mighty Max - Sat Dec 30, 2006 9:19 pm</h4>
    <div class="postbody"><span class="postbody">For the ones that test in Desmume, i located (but didnt exactly pin down) another bug in it, handling STM/LDM with writeback including the writeback register (like LDMIA sp! {....,sp,...})
<br/>
<br/>
Causing the asm() sections (which use such instructions in the overhead) in main.dle to create a sp corruption that will cause false jumpes and a reset request after some time.
<br/>
<br/>
Unfortunally the attribute naked does not  create naked asm code, but instead tries to write at a then uninitialized r11 .... anyhow, the fix:
<br/>
<br/>
Replace these functions:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
void __attribute((naked)) printChar__(void) {
<br/>
   asm volatile (
<br/>
      ".word 0xE1A03002   \n" /* mov r3,r2 using that creates a header? in devkitARM, so hide opcode in .word */
<br/>
      ".word 0xE1A02001   \n" /* mov r2,r1 */
<br/>
      ".word 0xE1A01000   \n" /* mov r1,r0 */
<br/>
      ".word 0xE3A00001   \n" /* ldr r0,=1 */
<br/>
      "swi 0x010101   \n"
<br/>
   ) ;
<br/>
   asm volatile (
<br/>
      "BX lr         \n"
<br/>
   ) ;
<br/>
} 
<br/>
typedef void (*printChar_Type)(int x,int y,char ch) ;
<br/>
printChar_Type printChar = (printChar_Type)&amp;printChar__ ;
<br/>
<br/>
/* createThread
<br/>
   will call system service swi
<br/>
      function r0 = 3
<br/>
         r1 = entrypoint of the thread
<br/>
         r2 = size of ram to be reserved for stack
<br/>
         r3 = parameter passed to the entrypoint
<br/>
*/
<br/>
//void __attribute((naked)) createThread(unsigned long entryPoint,unsigned long stacksize,unsigned long param) {
<br/>
void __attribute((naked)) createThread__(void) {
<br/>
   asm volatile (
<br/>
      ".word 0xE1A03002   \n" /* mov r3,r2 using that creates a header? in devkitARM, so hide opcode in .word */
<br/>
      ".word 0xE1A02001   \n" /* mov r2,r1 */
<br/>
      ".word 0xE1A01000   \n" /* mov r1,r0 */
<br/>
      ".word 0xE3A00003   \n" /* ldr r0,=3 */
<br/>
      "swi 0x00      \n"
<br/>
   ) ;
<br/>
   asm volatile (
<br/>
      "BX lr         \n"
<br/>
   ) ;
<br/>
} ;
<br/>
typedef void (*createThread_Type)(unsigned long entryPoint,unsigned long stacksize,unsigned long param) ;
<br/>
createThread_Type createThread = (createThread_Type)&amp;createThread__ ;
<br/>
<br/>
void __attribute((naked)) idle(void)  {
<br/>
   asm volatile(
<br/>
      "ldr r0,=0      \n"
<br/>
      "swi 0x00      \n"
<br/>
      "BX lr         \n"
<br/>
   ) ;
<br/>
} ;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
That's just for desmume compatibility right now. If you don't use them with desmume, you are fine with the old version.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113824 - wintermute - Sun Dec 31, 2006 1:43 am</h4>
    <div class="postbody"><span class="postbody">You'd be much better off placing these functions in .s files where the compiler can't interfere with them.
<br/>
<br/>
I assume by header you mean a function prologue.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113837 - HyperHacker - Sun Dec 31, 2006 4:59 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">Similarly, if Program X has some sort of touch-screen problem for example, updating a file fixes it and all other programs, even if the original author isn't around anymore.</td> </tr></table><span class="postbody">
<br/>
That's a good thing in general, but <b style="color:#FFA34F">operating</b> <b style="color:#FFA34F">system</b> maintainers have to watch out for the DLL hell problem. If subsequent versions of the <b style="color:#FFA34F">operating</b> <b style="color:#FFA34F">system</b> change the interface's semantics behind an application's back, the application will misbehave.</span></td> </tr></table><span class="postbody">
<br/>
Simple solution: Don't do this. If you're writing the library, write your functions such that they continue to work as expected with old versions. If you're writing an app that uses it, <span style="font-weight: bold">DO NOT RELY ON OBVIOUSLY INCORRECT BEHAVIOUR</span>. You'd think this would be common sense...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>nornagon wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">Why dynamic link?
<br/>
One, it saves space.</td> </tr></table><span class="postbody">
<br/>
Uh, what? Where does it save space, on your SD card? You're honestly worried about the few extra kB of space per program that linking statically consumes?</span></td> </tr></table><span class="postbody">
<br/>
It saves space in RAM. If you need one font at a given point but not another, you can unload the fonts you're using to save memory. Likewise, if you need the rich text editor library at a given point, but you don't need the Vorbis decoder library, you can unload the Vorbis decoder to make more room for the rich text editor. Likewise with the Vorbis decoder vs. the MP3 decoder vs. the MOD decoder.</span></td> </tr></table><span class="postbody">
<br/>
Yes, but I was actually referring to the cards themselves. I have 28 .nds files on my card, which means 27 redundant copies of at least the libnds routines. If these apps use FAT then that's additional redundant copies of gba_nds_fat and/or libfat. If you add up all the various libraries and shared routines/resources DS apps use, and have a fair number of them, you could be looking at at least a few hundred KB. On such small cards (as little as 32MB) it's not uncommon to be pressed for space; with a 128MB card, a very small subset of my music collection filled it almost entirely, leaving about 1MB free at any given time.
<br/>
<br/>
<br/>
BTW, I forgot to mention last time... people keep expecting a fancy GUI, windowing <b style="color:#FFA34F">system</b>, etc... that's not going to happen, but some form of GUI is necessary. I've already explained how I think it should be done, but I'll point out a key factor again: On a 256x192 screen, a windowing <b style="color:#FFA34F">system</b> is impractical. Apps should simply have zero to two 256x192 areas to draw in, minus however much space the shell uses for a taskbar/whatever, and possibly windows tied to these for things like toolboxes (effectively child windows that are only visible above the app's display area).<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113844 - tepples - Sun Dec 31, 2006 7:21 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><b style="color:#FFA34F">operating</b> <b style="color:#FFA34F">system</b> maintainers have to watch out for the DLL hell problem. If subsequent versions of the <b style="color:#FFA34F">operating</b> <b style="color:#FFA34F">system</b> change the interface's semantics behind an application's back, the application will misbehave.</td> </tr></table><span class="postbody">
<br/>
Simple solution: Don't do this. If you're writing the library, write your functions such that they continue to work as expected with old versions. If you're writing an app that uses it, <span style="font-weight: bold">DO NOT RELY ON OBVIOUSLY INCORRECT BEHAVIOUR</span>. You'd think this would be common sense...</span></td> </tr></table><span class="postbody">
<br/>
What is obvious to one may not be obvious to another. Developers rely on behaviors, not knowing that they are incorrect. Look at Windows backward compatibility to see a hack on top of a hack on top of a hack.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I have 28 .nds files on my card, which means 27 redundant copies of at least the libnds routines. If these apps use FAT then that's additional redundant copies of gba_nds_fat and/or libfat. If you add up all the various libraries and shared routines/resources DS apps use, and have a fair number of them, you could be looking at at least a few hundred KB. On such small cards (as little as 32MB) it's not uncommon to be pressed for space</td> </tr></table><span class="postbody">
<br/>
Nowadays, 32 MB isn't common except for pure NOR cards in SLOT-2. More common are NAND cards an order of magnitude or more bigger. I can pick up 1 GB SD card for under $22 (incl. sales tax) at an office supply store. I've upped my storage, so up yours ;-)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">On a 256x192 screen, a windowing <b style="color:#FFA34F">system</b> is impractical. Apps should simply have zero to two 256x192 areas to draw in, minus however much space the shell uses for a taskbar/whatever, and possibly windows tied to these for things like toolboxes (effectively child windows that are only visible above the app's display area).</td> </tr></table><span class="postbody">
<br/>
I agree, for the most part. But there should be a provision for toolboxes that can slide in or fade in on demand. If anything, pull-down menus are exactly that.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113846 - Mighty Max - Sun Dec 31, 2006 8:46 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">You'd be much better off placing these functions in .s files where the compiler can't interfere with them.
<br/>
<br/>
I assume by header you mean a function prologue.</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
Yes, and i would, but at the current state of the dynamical loading just a single .o file is loaded, and putting it in an own .s file would create a second .o ;)<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113871 - tepples - Sun Dec 31, 2006 5:45 pm</h4>
    <div class="postbody"><span class="postbody">You can compile several .c files to assembly language (gcc -S D5.c -o D5.s) and then compile multiple .s files into one .o file.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113878 - Mighty Max - Sun Dec 31, 2006 6:24 pm</h4>
    <div class="postbody"><span class="postbody">Thanks Tepples 
<br/>
<br/>
... i should really read up on the command line options / Makefiles :D
<br/>
<br/>
<br/>
<br/>
:edit: just added prefetch abort code to my local desmume (and ofcourse sent the changes in again) hope to get swapping working on desmume at some time too, instead of the dirty behaviour to detect desmume and the gba romspace as wram replacement. And it massively helps to debug :D<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113892 - wintermute - Sun Dec 31, 2006 8:35 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">You'd be much better off placing these functions in .s files where the compiler can't interfere with them.
<br/>
<br/>
I assume by header you mean a function prologue.</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
Yes, and i would, but at the current state of the dynamical loading just a single .o file is loaded, and putting it in an own .s file would create a second .o ;)</span></td> </tr></table><span class="postbody">
<br/>
<br/>
It's reasonably easy to write a loader for fully linked relocatable code - chishm uses such a <b style="color:#FFA34F">system</b> for the dldi patching.
<br/>
<br/>
Personally I'd think writing a loader for an elf format object would be a bit more hassle.
<br/>
<br/>
Then again you're going to have to deal with shared objects for this <b style="color:#FFA34F">system</b> I guess?<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113921 - chishm - Mon Jan 01, 2007 4:51 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">It's reasonably easy to write a loader for fully linked relocatable code - chishm uses such a <b style="color:#FFA34F">system</b> for the dldi patching.</td> </tr></table><span class="postbody">
<br/>
Unfortunately, none of the libraries included with DevkitARM are compiled for postion-independence (-fPIC). This makes relocating anything that has a large reliance on them (including C++ code -- the global constructor and destructor functions aren't position-independent) non-trivial. Also, the current link-sripts need fixing for EABI compiled position-independent code.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114068 - Mighty Max - Wed Jan 03, 2007 2:08 pm</h4>
    <div class="postbody"><span class="postbody">Probably better to do so, yes. The .o <b style="color:#FFA34F">system</b> was easiest to check right now without digging deep into the specs/ld scripts.
<br/>
<br/>
<br/>
Anyhow, i have the last days worked on the arm7 side of the <b style="color:#FFA34F">system</b>. Access to wram is a bit difficult now, as the arm7 doesnt know which page is blended at the physical address, like the arm9 does. It could be solved by mutexes, but this would slow down the memory swapping.
<br/>
<br/>
Theefor i decided to use VRAM to extend the memory available on the arm7 from 32 to 160kB. The wifi recvs are stored there and can be swapped to the arm9 by xchanging the allocation for Bank C vs Bank D (one is allways arm9 0x06040000, the other arm7 blended) ... could be done by one also (hold arm7 while vram is not blended in) , but wanted to have as much speed as possible for now (as im trying to get a wifi stack done).<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114072 - nornagon - Wed Jan 03, 2007 3:32 pm</h4>
    <div class="postbody"><span class="postbody">@Mighty Max: So what if we need that vram for, you know, displaying things? :)
<br/>
<br/>
I'm interested in getting some dynamic code loading stuff happening for <a class="postlink" href="http://2-2-dihexanol.net/blog/nds/WorldOfSand.html" target="_blank">World of Sand</a> in order to manage interchangeable physics systems. It's pretty tricky to manage on my own; how feasible would it be for me to hook into this OS of yours to do that?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114076 - Mighty Max - Wed Jan 03, 2007 5:01 pm</h4>
    <div class="postbody"><span class="postbody">I should have put more hints to "for now" ;) 
<br/>
Page lockdowns and <b style="color:#FFA34F">system</b> level pagechecking on access are not done yet done, so using wram access from arm7 would have produced more errors then what i expect it to help me remotely debug the <b style="color:#FFA34F">system</b>.
<br/>
<br/>
I would recomment a scripting <b style="color:#FFA34F">system</b> (i.e. lua) for your purpose. The speed malus can easily avoided for the sand, as you want to do the same processing to a lot of object instances.
<br/>
<br/>
I would declare c functions for calculating over the set of all particles of one kind (like SIMD instructions) and have the script just call these functions to process them all at a single run. (the few calls the script has to make shouldnt take too much time)
<br/>
<br/>
This would allow you to not only have dynamically loaded physics but also to change the physics on the fly.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114088 - HyperHacker - Wed Jan 03, 2007 10:12 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Nowadays, 32 MB isn't common except for pure NOR cards in SLOT-2. More common are NAND cards an order of magnitude or more bigger. I can pick up 1 GB SD card for under $22 (incl. sales tax) at an office supply store. I've upped my storage, so up yours ;-)</td> </tr></table><span class="postbody">
<br/>
Lol. Where are you shopping? 1GB cards are still bloody expensive everywhere I've been in Canada.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114089 - Rockviech - Wed Jan 03, 2007 10:23 pm</h4>
    <div class="postbody"><span class="postbody">look at ebay, 2gb mini sd 30? here</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114097 - tyraen - Wed Jan 03, 2007 11:35 pm</h4>
    <div class="postbody"><span class="postbody">Check <span style="font-weight: bold">[Please ask SimonB to make a topic in <a class="postlink" href="http://forum.gbadev.org/viewforum.php?f=13" target="_blank">Retailer Feedback</a> for this retailer. -- MOD]</span>
<br/>
<br/>
I see a 1GB there for &lt;$50, mind you there's tax and shipping.  If you're on their newsletter I find they often have pretty nice deals, especially on SD where it's fairly old now.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114107 - tepples - Thu Jan 04, 2007 1:28 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">I can pick up 1 GB SD card for under $22 (incl. sales tax) at an office supply store. I've upped my storage, so up yours ;-)</td> </tr></table><span class="postbody">
<br/>
Lol. Where are you shopping?</span></td> </tr></table><span class="postbody">
<br/>
Sorry. Apart from the obvious "how do I run roms?", "where are you shopping?" is the most commonly asked question that we aren't allowed to answer:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>SimonB wrote:</b></span></td> </tr> <tr> <td class="quote">No promotion of any retailer outside the Retailer Feedback forum.</td> </tr></table><span class="postbody">
<br/>
That's why I answer so generically.
<br/>
<br/>
I also shop in the United States, which has a (slightly) more valuable dollar.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114121 - nornagon - Thu Jan 04, 2007 5:18 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">I would recomment a scripting system (i.e. lua) for your purpose. The speed malus can easily avoided for the sand, as you want to do the same processing to a lot of object instances.
<br/>
<br/>
I would declare c functions for calculating over the set of all particles of one kind (like SIMD instructions) and have the script just call these functions to process them all at a single run. (the few calls the script has to make shouldnt take too much time)
<br/>
<br/>
This would allow you to not only have dynamically loaded physics but also to change the physics on the fly.</td> </tr></table><span class="postbody">
<br/>
<br/>
Ahem. Good luck getting a lua function to run over 49,152 pixels twenty times a second on the DS. It's just not going to work like that.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114135 - Mighty Max - Thu Jan 04, 2007 11:32 am</h4>
    <div class="postbody"><span class="postbody">Read again nornagon: you need a lua script that runs ... what 10 instructions once for ALL particles at once.
<br/>
<br/>
Iterate for the set, not for the particle in lua. Applying the given math by the lua to all would be the job of the c code.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114143 - nornagon - Thu Jan 04, 2007 2:55 pm</h4>
    <div class="postbody"><span class="postbody">My 'particles' are just pixels, nothing more. I keep a 42K (192*256*2bytes) buffer and iterate over that in different ways (left-to-right/right-to-left) and perform an action of some kind based on the palette index of the pixel. The action usually involves some calls to a random number generator and a few if statements, followed by a couple of memory sets and a return. I'm not quite sure what your direction is in telling me to use lua.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114146 - Mighty Max - Thu Jan 04, 2007 3:58 pm</h4>
    <div class="postbody"><span class="postbody">You are currently iterating like (PseudoCode)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
for (x=0;...;x++) {
<br/>
   for (x=0;...;x++) {
<br/>
      calculationStep0(x,y) ;
<br/>
      ....
<br/>
      calculationStepN(x,y) ;
<br/>
   }
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Doing lua at that point for calculationSteps is not suitable, yes.
<br/>
<br/>
However instead of doing all pixels complete in one iteration step, you can  do a single step in the calculation for all pixels before doing the next step.
<br/>
<br/>
I.e. lets say you defined the following c functions to walk through all pixels:
<br/>
- Set,Add,Sub,Mul,Div Constant
<br/>
- Set,Add,Sub,Mul,Div Component
<br/>
- SelectAll,SelectMatching(component,compareValue,relation)
<br/>
<br/>
now the lua script could look like 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
function FRAME(num)
<br/>
    AddConstant(YComponent,-9.81)               -- apply linear gravity
<br/>
    SelectMatchin(YComponent,0,LESS_THEN)  -- if Y &lt; 0
<br/>
    SetConstant(YComponent,0)                     -- dont move further
<br/>
    SelectMatchin(YComponent,0,GREATER_THEN)  -- if Y &gt;0
<br/>
    AddComponent(XComponent,Randomizer) -- do random move 
<br/>
end
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
It is still more work for the DS to do (multiple looping through the same dataset) but it is much faster then doing the lua for every pixel and allows modifying the physics without access to a compiler. 
<br/>
<br/>
For loading precompiled i'd point to chishm's method atm. Or just simply reserve a set region, and compile+link the physic functions to use that not changing base address. (You just need to create the specs/ld and crt0)<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114215 - nornagon - Fri Jan 05, 2007 12:00 pm</h4>
    <div class="postbody"><span class="postbody">The pixels have no velocity. They only thing they have is color and a 'knowledge' of the eight pixels immediately surrounding them.
<br/>
<br/>
My code looks more like this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void calculate(u8* buf) {
<br/>
  static bool counter = false;
<br/>
  for (int y = 190; y &gt; 0; y--)
<br/>
    for (int x = counter?1:254; counter?x&lt;255:x&gt;0; counter?x++:x--)
<br/>
      doWorkOn(buf, x, y);
<br/>
  counter = !counter;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
That's just a rough approximation, but it's more or less how things happen.
<br/>
<br/>
I've decided to go the path of dynamic recompilation, though. Doesn't seem that hard now that some people have told me how to do it :P</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121119 - SpacedCowboy - Fri Mar 09, 2007 4:18 am</h4>
    <div class="postbody"><span class="postbody">So, this looked really interesting, but seems to have withered away ? Are people still working on it ?
<br/>
<br/>
Just curious :-)
<br/>
<br/>
Simon</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121133 - OOPMan - Fri Mar 09, 2007 11:09 am</h4>
    <div class="postbody"><span class="postbody">Well, Might Max released the course to his V16 proto-OS, but I think he's been a bit busy of late and isn't planning to take V16 too much further...
<br/>
<br/>
I recently moved and am getting settled in a new job, so the only DS-related things I've been doing of late have been pretty minor and low-turbulence :-)
<br/>
<br/>
As for the others, I'm not sure :-)
<br/>
<br/>
I STILL want to implement an exokernel on the DS at some point though, but I need to learn a lot more about OS programming before I can do that :-)<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121196 - SpacedCowboy - Sat Mar 10, 2007 3:05 am</h4>
    <div class="postbody"><span class="postbody">So I was interested, but not really following technically what was being said. Where does one find the technical docs for controlling things like 'mirroring', the memory-management unit (the MPU ?), etc. Are these ARM-specific things, or NDS-specific ones ? (respectively, easy to find docs on, and not-necessarily-easy :-) 
<br/>
<br/>
I'm assuming that mirroring is just the same RAM appearing in different memory locations, but it sounds like there's some control being exerted over it, to our advantage, which is intriguing...
<br/>
<br/>
You're all using devices that use the GBA port, right ? I'm currently using a DS-X cartridge, and don't seem to have access to the GBA memory area... Perhaps I ought to get an M-3/G-6 (or whatever the current best-way-to-do-it-is. Suggestions welcome :-)
<br/>
<br/>
Simon.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121595 - OOPMan - Tue Mar 13, 2007 10:17 am</h4>
    <div class="postbody"><span class="postbody">Hmmmm, well, I think the mirroring was a clever thing which Might Max worked out himself, so you'd probably want to talk to him about it.
<br/>
<br/>
As for more general NDS hardware stuff, various resources are available. Specifically for the NDS, we have the hardware specs over at GBATek.
<br/>
<br/>
With regards to the ARM, there are various books and manuals available that detail programming for ARM-based systems.
<br/>
<br/>
With regards to devices, no, things have diversified a lot, so having a DS-X is no longer a bad thing. With regards to the OS thing, nothing Max did with V16 actually required a SLOT-2 device...<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121713 - SpacedCowboy - Wed Mar 14, 2007 6:33 am</h4>
    <div class="postbody"><span class="postbody">Ok, so I started to try and understand what's going on here in the 'virtual16' code. Hoping MightyMax can chime in and help me ... I've done assembly-programming before (a couple of decades ago!) but never ARM assembly. I guess this is as good a way as any to start :-) 
<br/>
<br/>
I was looking at swi.s, and the thread-store/restore registers code, specifically:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
      ...
<br/>
      // store r11 - r0 in reverse order, the values are on stack 
<br/>
      LDR r1,[r13,#0x30]
<br/>
      STMIA r0!,{r1}
<br/>
      LDR r1,[r13,#0x2C]
<br/>
      STMIA r0!,{r1}
<br/>
      LDR r1,[r13,#0x28]
<br/>
      STMIA r0!,{r1}
<br/>
      LDR r1,[r13,#0x24]
<br/>
      STMIA r0!,{r1}
<br/>
      LDR r1,[r13,#0x20]
<br/>
      STMIA r0!,{r1}
<br/>
      LDR r1,[r13,#0x1C]
<br/>
      STMIA r0!,{r1}
<br/>
      LDR r1,[r13,#0x18]
<br/>
      STMIA r0!,{r1}
<br/>
      LDR r1,[r13,#0x14]
<br/>
      STMIA r0!,{r1}
<br/>
      LDR r1,[r13,#0x10]
<br/>
      STMIA r0!,{r1}
<br/>
      LDR r1,[r13,#0x0C]
<br/>
      STMIA r0!,{r1}
<br/>
      LDR r1,[r13,#0x08]
<br/>
      STMIA r0!,{r1}
<br/>
      LDR r1,[r13,#0x04]
<br/>
      STMIA r0!,{r1}
<br/>
      
<br/>
      // load previous mode r13,r14 and store them to [r0] and following
<br/>
      MRS r3,spsr
<br/>
      AND r2,r3,#0x1F
<br/>
      CMP r2,#MODE_USR
<br/>
      LDREQ r2,=MODE_SYS
<br/>
      MRS r3,cpsr
<br/>
      BIC r3,r3,#0x1F
<br/>
      ORR r2,r2,r3
<br/>
      MRS r3,cpsr
<br/>
      MSR cpsr,r2
<br/>
   
<br/>
      STMIA r0!,{r13}
<br/>
      STMIA r0!,{r14}
<br/>
      
<br/>
      MSR cpsr,r3 
<br/>
      
<br/>
      // store return address as previous mode r15
<br/>
      LDR r1,[r13,#0x38]
<br/>
      STMIA r0!,{r1}
<br/>
      // store r12
<br/>
      LDR r1,[r13,#0x34]
<br/>
      STMIA r0!,{r1}
<br/>
      ...
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I have a question about that. Given that the thread-storage structure is...
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
//   typedef struct THREADCONTEXT {
<br/>
//      unsigned long      bios_stack,
<br/>
//                     bios_return,
<br/>
//                     r11,r10,r9,r8,r7,r6,r5,r4,r3,r2,r1,r0,
<br/>
//                     r13,r14,r15,
<br/>
//                     r12,
<br/>
//                     cpsr,
<br/>
//                     cp15_status ;
<br/>
//   } THREADCONTEXT, *LPTHREADCONTEXT ;      
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
... it looks to me as though the storage of r12 ought to be from offset 0x3C, not 0x34, right ? From interpreting the way he's using the offsets, 0 appears to be at the top of the structure, (bios_stack), so r12 ought to be *after* r15, not before it ?
<br/>
<br/>
The thing is, that if that is right, he'd be over-writing r14 (the link register), and if you do that, I'd expect chaos to ensue. Obviously, it does actually work, so I'm wrong - I just don't see why [sigh]. I'm confused, and I thought I was starting with the simple stuff  :-( I'm going to bed :-)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121721 - OOPMan - Wed Mar 14, 2007 8:34 am</h4>
    <div class="postbody"><span class="postbody">Hehehehe, yeah, those ARM manuals could come in use around about now...
<br/>
<br/>
There's also a very good ARM assembly tutorial that's linked to from the stickied Tutorials thread.
<br/>
<br/>
Good luck. Hopefully Max will chime in and help you. You could always PM him though ;-)<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121729 - strager - Wed Mar 14, 2007 10:53 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>SpacedCowboy wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
      ...
<br/>
      // store r11 - r0 in reverse order, the values are on stack 
<br/>
      LDR r1,[r13,#0x30]
<br/>
      STMIA r0!,{r1}
<br/>
      [snip]
<br/>
      LDR r1,[r13,#0x04]
<br/>
      STMIA r0!,{r1}
<br/>
      
<br/>
      [snip]
<br/>
      
<br/>
      // store return address as previous mode r15
<br/>
      LDR r1,[r13,#0x38]
<br/>
      STMIA r0!,{r1}
<br/>
      // store r12
<br/>
      LDR r1,[r13,#0x34]
<br/>
      STMIA r0!,{r1}
<br/>
      ...
<br/>
</td> </tr></table><span class="postbody">
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
//   typedef struct THREADCONTEXT {
<br/>
//      unsigned long      bios_stack,
<br/>
//                     bios_return,
<br/>
//                     r11,r10,r9,r8,r7,r6,r5,r4,r3,r2,r1,r0,
<br/>
//                     r13,r14,r15,
<br/>
//                     r12,
<br/>
//                     cpsr,
<br/>
//                     cp15_status ;
<br/>
//   } THREADCONTEXT, *LPTHREADCONTEXT ;      
<br/>
</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
<br/>
Notice how the first two LDR instructions I didn't cut: They load r11 and r0.  The first, r11, would be expected to load from an offset of 0x08, right?  Well, it seems that the THREADCONTENT pointer is already offset by four (thus the bios_stack is at -0x04).  Since the entire structure is shifted four bytes forward, the offset of r12 would be 0x38, as the offset of r15 would be 0x34.  I think the author kinda switch those last two comments; either that, or I'm wrong and am reading this code wrong.  Hey, it's very early in the morning and I haven't eaten since Monday.  xD
<br/>
<br/>
Hope you find your problem,
<br/>
Strager Neds</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121761 - SpacedCowboy - Wed Mar 14, 2007 5:15 pm</h4>
    <div class="postbody"><span class="postbody">Fresh eyes in the morning ... I think I see what's going on now. Of course as soon as you see it, it's blindingly obvious [blush] :-)
<br/>
<br/>
store_context: is being called from 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
            
<br/>
   softwarei_code:                 // swi:
<br/>
      STMDB r13!,{r0-r12,r14}      //   store registers
<br/>
      MRS r7,CPSR
<br/>
      ORR r7,r7,#0xC0
<br/>
      MSR CPSR,r7                  //   disable irq/fiq while system mode (will be unset when MOVS r15,r14)
<br/>
      BL store_context             //   store thread context
<br/>
      ...
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
... so the offsets are due to the STMDB statement a few opcodes before the call to store_context. r12 is indeed 1 word deeper in the stack than r11 (0x34), and r14 is the PC from the caller of softwarei_code (assuming it's been jump-and-linked, which I guess is the case), and is positioned at the next word (0x38). 
<br/>
<br/>
I was confusing the source and destination addresses - r0 is just stepping through the thread-context struct, r1 is indexing out of the stack...
<br/>
<br/>
Note to self - wait until the morning before posting in future :-)
<br/>
<br/>
Simon.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153969 - anomalous_underdog - Tue Apr 08, 2008 7:41 pm</h4>
    <div class="postbody"><span class="postbody">have you guys checked out the source code for moonshell's msp plugin sdk? that's a working example of how to make a .nds file act as a dll.
<br/>
<br/>
<a href="http://mdxonlinemirror.dyndns.org/moonshell/files/moonshellpluginv51sdk.7z" target="_blank">http://mdxonlinemirror.dyndns.org/moonshell/files/moonshellpluginv51sdk.7z</a>
<br/>
<br/>
if you look at your moonshell plugins folder, you'll see some .msp files, they're actually just .nds files renamed. they don't have a int main() function so they're not meant to be called directly.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153990 - Creebo - Wed Apr 09, 2008 1:02 am</h4>
    <div class="postbody"><span class="postbody">Why would you bump this? It's a year old :/</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153991 - Darkflame - Wed Apr 09, 2008 1:12 am</h4>
    <div class="postbody"><span class="postbody">Moonshells plugs are just nds files? 
<br/>
Thats news to me...so, in theory,it might be possible to extend moonshells format support?<br/>_________________<br/><a class="postlink" href="http://www.rateoholic.co.uk/RateoholicResults.php#SEARCHFOR=&amp;TYPE=VideoGame%25&amp;BY=darkflame&amp;ORDER=hyb_down&amp;ST=0" target="_blank">Darkflames Reviews</a>    --   
<br/>
Make your own at;
<br/>
<a class="postlink" href="http://www.rateoholic.co.uk" target="_blank"> Rateoholic:Reviews for anything, by anyone.</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#154002 - anomalous_underdog - Wed Apr 09, 2008 8:48 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Darkflame wrote:</b></span></td> </tr> <tr> <td class="quote">Moonshells plugs are just nds files? 
<br/>
Thats news to me...so, in theory,it might be possible to extend moonshells format support?</td> </tr></table><span class="postbody">
<br/>
<br/>
yup, I was surprised myself when I found out. look at the source code link I gave. he's got some really weird makefiles there, somewhat similar to what you guys are discussing
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Creebo wrote:</b></span></td> </tr> <tr> <td class="quote">Why would you bump this? It's a year old :/</td> </tr></table><span class="postbody">
<br/>
<br/>
Its a worthy cause. I approve of the DS having standardized homebrew launching code. I really hate it when I have to power off, then power on again just to switch to a different app, then do the same thing just to get back to what I was working on.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#154008 - thoduv - Wed Apr 09, 2008 10:34 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Darkflame wrote:</b></span></td> </tr> <tr> <td class="quote">Moonshells plugs are just nds files? 
<br/>
Thats news to me...so, in theory,it might be possible to extend moonshells format support?</td> </tr></table><span class="postbody">
<br/>
No, they're not "nds files": they have a different header, are linked with a different linkscript, are compiled with different options (namely -fPIC, which allows code to be run from any place in memory) and have a different behavior (communicate with main program via callbacks).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#154018 - anomalous_underdog - Wed Apr 09, 2008 3:08 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>thoduv wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Darkflame wrote:</b></span></td> </tr> <tr> <td class="quote">Moonshells plugs are just nds files? 
<br/>
Thats news to me...so, in theory,it might be possible to extend moonshells format support?</td> </tr></table><span class="postbody">
<br/>
No, they're not "nds files": they have a different header, are linked with a different linkscript, are compiled with different options (namely -fPIC, which allows code to be run from any place in memory) and have a different behavior (communicate with main program via callbacks).</span></td> </tr></table><span class="postbody">
<br/>
<br/>
well then "nds" may not have been an accurate word to describe what I meant. i mean .msp files are simply arm compiled executable binary files, the same way .nds files are. of course they'd have a different makefile and options, they're meant to be called by other processes.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#161897 - hacker013 - Sun Aug 17, 2008 7:24 pm</h4>
    <div class="postbody"><span class="postbody">I want to try to continue this project but when i try to compile it (have ported it to devkitARM r23) it gives an error that he don't knows the command "elf2dle" that is a program, and when i want to run it as a standalone windows gives an error that the config of that program is wrong. Can somebody help me with this??
<br/>
<br/>
EDIT:
<br/>
<br/>
I have it now that the compiler sees the program elf2dle and now it says: execvp: elf2dle: bad file number.
<br/>
<br/>
does anyone knows a solution for this??<br/>_________________<br/><a class="postlink" href="http://imetal.nl/" target="_blank">Website / Blog</a>
<br/>
<br/>
Let the nds be with you.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
