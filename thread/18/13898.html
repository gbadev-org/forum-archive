<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>sprintf() works on emulator but not hardware? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > sprintf() works on emulator but not hardware?</h2>
<div id="posts">
<div class="post">
    <h4>#137292 - Jeremysr - Thu Aug 09, 2007 11:24 pm</h4>
    <div class="postbody"><span class="postbody">I just got my M3 DS Simply but when I ran my program (which worked perfectly fine on Desmume) it froze while starting. I found out that it froze when I called sprintf() to change numbers into strings. Anyone know why this is happening or how else I should convert ints to strings?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137304 - tepples - Fri Aug 10, 2007 12:36 am</h4>
    <div class="postbody"><span class="postbody">So you only care about ints, not floats. In this case, you can use siprintf, which is smaller than sprintf but does not handle floats. Does it still crash then? And are you sure that you are allocating a buffer and not overflowing it?
<br/>
<br/>
Without seeing your code, I can't make more specific suggestions.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137308 - Jeremysr - Fri Aug 10, 2007 1:27 am</h4>
    <div class="postbody"><span class="postbody">siprintf() didn't work and I'm not sure what you meant by "allocating a buffer and not overflowing it".
<br/>
<br/>
But here's my code (with redundant parts taken out):
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void updateProgram(int *program, int start, int selected) {
<br/>
   int i = 0, count = 0, y = 0, x = 0;
<br/>
   char num_str[20];
<br/>
   char clear_str[6] = {31,31,31,31,31,'\0'};
<br/>
   
<br/>
   for (i = start; i &lt; start+6; i++) {
<br/>
      count++;
<br/>
      siprintf(num_str, "%s%d", 10, i);
<br/>
      printString(clear_str, 20, count * 9 + 10, SCREEN_BOTTOM);
<br/>
      printString(num_str, 20, count * 9 + 10, SCREEN_BOTTOM);
<br/>
   }
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137310 - kusma - Fri Aug 10, 2007 2:02 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Jeremysr wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">siprintf(num_str, "%s%d", 10, i);
<br/>
</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
Eh? treating the number 10 as a pointer to a string, and printing it? Sure that's a good idea? It will most likely give you some non-0 data, perhaps more than 20 of them - giving you a nice little stack-corruption. So I guess that's your issue :)
<br/>
<br/>
What are you really trying to do with that line?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137311 - Lordus - Fri Aug 10, 2007 2:04 am</h4>
    <div class="postbody"><span class="postbody">I am not exactly sure what you want to do there, but it cannot work like this.
<br/>
<br/>
with "%s%d", siprintf is expecting another string as the first argument, in other words a memory address pointing to the first character of a terminated string. 
<br/>
<br/>
Do you want to write the number 10 there? Then you can do
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
// stupid, but just to show how it would work
<br/>
siprintf(num_str, "%s%d", "10", i); 
<br/>
// or better
<br/>
siprintf(num_str, "10%d", i); 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
But maybe you should better describe, what you really want to do.
<br/>
<br/>
Edit: ah too slow ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137313 - Jeremysr - Fri Aug 10, 2007 2:12 am</h4>
    <div class="postbody"><span class="postbody">I'm kind of new to C and just searched Google how to convert an int to a string. I just copied that code without understanding the function and as I said it worked great on Desmume. I thought the 10 meant base-10 actually. :P
<br/>
<br/>
All I want to do is take an integer and store it in a string so I can print it with my printString() function.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137333 - masscat - Fri Aug 10, 2007 9:47 am</h4>
    <div class="postbody"><span class="postbody">To do that simply use:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">siprintf(num_str, "%d", i);</td> </tr></table><span class="postbody">
<br/>
The '%d' conversion specifier converts the integer i into its base 10 string representation.
<br/>
<br/>
The reason that the code works under Desmume but not on hardware is that Desmume does not emulate the ARM9 protection unit (yet). On hardware the protection unit is configured, by default, to disallow access to memory from 0x00000000 to 0x01000000.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137373 - Jeremysr - Fri Aug 10, 2007 11:54 pm</h4>
    <div class="postbody"><span class="postbody">masscat: I tried it but ran into a new problem - my M3 Simply wouldn't load the .nds file. It says "Loading..." but the progress bar is real slow and after a couple minutes it just stops at about 40%. But when I comment out the siprintf() lines, it loads right away and works great (except for displaying the numbers of course.) I also noticed that the .nds file jumps from about 99KB to about 85KB when I commented out those lines.
<br/>
<br/>
I'll probably just (try to) write my own function to disply numbers...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137377 - DragonMinded - Sat Aug 11, 2007 12:38 am</h4>
    <div class="postbody"><span class="postbody">I would recommend against siprintf.  In my trying to use it, all it did was increase the binary a few kb and output wrong information.<br/>_________________<br/>Enter the mind of the dragon.
<br/>
<br/>
<a href="http://dragonminded.blogspot.com" target="_blank">http://dragonminded.blogspot.com</a>
<br/>
<br/>
Seriously guys, how hard is it to simply TRY something yourself?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137380 - wintermute - Sat Aug 11, 2007 2:09 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>DragonMinded wrote:</b></span></td> </tr> <tr> <td class="quote">I would recommend against siprintf.  In my trying to use it, all it did was increase the binary a few kb and output wrong information.</td> </tr></table><span class="postbody">
<br/>
<br/>
Not sure why you feel qualified to judge considering you're still using a toolchain that is spectacularly out of date.
<br/>
<br/>
In almost every case where I've had reports of library functions failing it has been a problem with the code. I'm not saying that the latest toolchain is 100% bug free but user error is still the number one cause of problems.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137391 - DragonMinded - Sat Aug 11, 2007 6:12 am</h4>
    <div class="postbody"><span class="postbody">Well you were the one that is currently updating the code to r20, and may I remind you that it's on infinite hiatus until r21 is out, so there's not much I can do is there?<br/>_________________<br/>Enter the mind of the dragon.
<br/>
<br/>
<a href="http://dragonminded.blogspot.com" target="_blank">http://dragonminded.blogspot.com</a>
<br/>
<br/>
Seriously guys, how hard is it to simply TRY something yourself?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137393 - wintermute - Sat Aug 11, 2007 6:38 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>DragonMinded wrote:</b></span></td> </tr> <tr> <td class="quote">Well you were the one that is currently updating the code to r20, and may I remind you that it's on infinite hiatus until r21 is out, so there's not much I can do is there?</td> </tr></table><span class="postbody">
<br/>
<br/>
I offered to make the attempt to get DSO working with a more recent toolchain, I have it building with r21 but unfortunately I need to concentrate on other things right now.
<br/>
<br/>
The point I was trying to make here is that your experience of siprintf has no relevance and recommending that people not use it is simply FUD. Given that the code worked on an emulator and not on hardware would imply that the problem is related to memory use rather than a problem with the library code itself.
<br/>
<br/>
Masscat nailed the memory problem. The M3 problem is odd but probably something related to patching rather than any fault with the toolchain.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137397 - phonymike - Sat Aug 11, 2007 7:17 am</h4>
    <div class="postbody"><span class="postbody">call me conservative, but I always reinvent the wheel and write my own stuff :)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
//should be able to do this, it converts a u8 into ascii, so like 0xFF would be "255\0" or 24 would be "024\0" I believe
<br/>
//printString(hex2dec(number), 20, count * 9 + 10, SCREEN_BOTTOM); 
<br/>
//quick stuff for the gba actually
<br/>
<br/>
char dec[3];     //make sure this is global
<br/>
<br/>
char* hex2dec(u8 hex){
<br/>
 u8 tmp=0;
<br/>
 dec[0] = 0;
<br/>
 dec[1] = 0;
<br/>
 tmp = hex;
<br/>
<br/>
 while(tmp &gt; 99){
<br/>
  dec[0]++;             //fill the hundreds
<br/>
  tmp -= 100;
<br/>
 }
<br/>
<br/>
 while(tmp &gt; 9){
<br/>
  dec[1]++;           //fill the tens
<br/>
  tmp -= 10;
<br/>
 }
<br/>
<br/>
 dec[0] += 48;            //hundreds to ASCII
<br/>
 dec[1] += 48;            //tens to ASCII
<br/>
 dec[2] = tmp + 48;       //sets the ones into ASCII
<br/>
 dec[3] = 0;              //sets the '\0' so no string bugs crop up
<br/>
<br/>
 return dec;
<br/>
}</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
