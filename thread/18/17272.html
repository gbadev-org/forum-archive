<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Blanking background - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Blanking background</h2>
<div id="posts">
<div class="post">
    <h4>#174196 - JackUzi - Sun May 23, 2010 8:45 am</h4>
    <div class="postbody"><span class="postbody">Well, on the home stretch now. :) The only problem I have left is that the part of the bottom screen that doesn't contain the keyboard is garbled. I presume I need to initialise the bit of memory that it is mapped to or something, but the more I read on this the less I know...
<br/>
<br/>
This is the code I'm using at the moment to start the app:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
    vramSetBankA(VRAM_A_MAIN_BG);
<br/>
    vramSetBankC(VRAM_C_SUB_BG);
<br/>
<br/>
    videoSetMode(MODE_0_2D);
<br/>
    videoSetModeSub(MODE_0_2D);
<br/>
<br/>
    consoleInit(&amp;topScreen, 3, BgType_Text4bpp, BgSize_T_256x256, 31, 0, true, true);
<br/>
    consoleInit(&amp;bottomScreen, 3, BgType_Text4bpp, BgSize_T_256x256, 31, 0, false, true);
<br/>
    consoleSelect(&amp;topScreen);
<br/>
<br/>
    keyboardInit(kbd, 3, BgType_Text4bpp, BgSize_T_256x256, 31, 0, false, true);
<br/>
    keyboardShow();
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
The top screen is fine, just a plain text console, and the lower half of the bottom screen is fine too, the nice on-screen keyboard. It is just the area above the keyboard on the bottom screen that contains the garbage. Originally I was hoping to use that space to output more text, but at this stage I would be happy for it to be just plain black.
<br/>
<br/>
Can anyone tell me what I am doing wrong?
<br/>
<br/>
Regards,
<br/>
Stuart</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#174255 - JackUzi - Wed May 26, 2010 3:36 am</h4>
    <div class="postbody"><span class="postbody">If any kind/ brave soul wants to have an experiment with this (I've tried every combination of everything I can think of...), here is a short compilable test that demonstrates the problem:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
int main(void) {
<br/>
 
<br/>
    Keyboard *kbd = NULL;
<br/>
    PrintConsole topScreen;
<br/>
    PrintConsole bottomScreen;
<br/>
<br/>
    vramSetBankA(VRAM_A_MAIN_BG);
<br/>
    vramSetBankC(VRAM_C_SUB_BG);
<br/>
<br/>
    videoSetMode(MODE_0_2D);
<br/>
    videoSetModeSub(MODE_0_2D);
<br/>
<br/>
    consoleInit(&amp;topScreen, 3, BgType_Text4bpp, BgSize_T_256x256, 31, 0, true, true);
<br/>
    consoleInit(&amp;bottomScreen, 3, BgType_Text4bpp, BgSize_T_256x256, 31, 0, false, true);
<br/>
<br/>
    keyboardInit(kbd, 2, BgType_Text4bpp, BgSize_T_256x256, 30, 0, false, true);
<br/>
    keyboardShow();
<br/>
<br/>
    consoleSelect(&amp;topScreen);
<br/>
    printf("Top screen okay.\nGarbage above keyboard.\n");
<br/>
    while (1) {};
<br/>
}</td> </tr></table><span class="postbody"></span><span class="gensmall"><br/><br/>Last edited by JackUzi on Wed May 26, 2010 11:08 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#174257 - relminator - Wed May 26, 2010 4:08 am</h4>
    <div class="postbody"><span class="postbody">Don't quote me on this but from my experiments, VRAM bank C is used by the console fonts.<br/>_________________<br/><a href="http://rel.betterwebber.com" target="_blank">http://rel.betterwebber.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#174259 - elhobbs - Wed May 26, 2010 5:46 am</h4>
    <div class="postbody"><span class="postbody">It looks like the keyboard VRAM and the bottomscreen VRAM overlap - 31,0 and 30,0 - both are loading tiles at 0 for the sub screen. You are loading the keyboard last so it is not garbled.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#174264 - elhobbs - Wed May 26, 2010 7:01 am</h4>
    <div class="postbody"><span class="postbody">try this
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">    consoleInit(&amp;bottomScreen, 3, BgType_Text4bpp, BgSize_T_256x256, 14, 0, false, true); 
<br/>
<br/>
    keyboardInit(kbd, 2, BgType_Text4bpp, BgSize_T_256x256, 31, 2, false, true); 
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#174268 - JackUzi - Wed May 26, 2010 11:22 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>elhobbs wrote:</b></span></td> </tr> <tr> <td class="quote">try this
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">    consoleInit(&amp;bottomScreen, 3, BgType_Text4bpp, BgSize_T_256x256, 14, 0, false, true); 
<br/>
<br/>
    keyboardInit(kbd, 2, BgType_Text4bpp, BgSize_T_256x256, 31, 2, false, true); 
<br/>
</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
<br/>
I appreciate the suggestion, but alas just more cyan and white speckles. I tired putting the keyboard on 14 and leaving the bottom console on 31 and that had more black, but still stripes through it.
<br/>
<br/>
Regards,
<br/>
Stuart</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#174269 - relminator - Wed May 26, 2010 1:44 pm</h4>
    <div class="postbody"><span class="postbody">Did you try this?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
vramSetBankD(VRAM_D_SUB_BG); 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
instead of 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
vramSetBankC(VRAM_C_SUB_BG); 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Bank C is somehow used by the console fonts. At least that's what my experiments tell me.<br/>_________________<br/><a href="http://rel.betterwebber.com" target="_blank">http://rel.betterwebber.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#174273 - elhobbs - Wed May 26, 2010 3:04 pm</h4>
    <div class="postbody"><span class="postbody">it may just be layer 0. you are using layers 2 and 3 for the keyboard and console respectively. not sure what you have planned for layer 0 but it is enabled using videoSetModeSub(MODE_0_2D);
<br/>
<br/>
I recommend that you try this out in desmume and use the layer, map, and tile tools to see how things are being laid out in vram.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#174292 - JackUzi - Thu May 27, 2010 12:43 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>relminator wrote:</b></span></td> </tr> <tr> <td class="quote">Did you try this?
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
vramSetBankD(VRAM_D_SUB_BG); 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
instead of 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
vramSetBankC(VRAM_C_SUB_BG); 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Bank C is somehow used by the console fonts. At least that's what my experiments tell me.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Sorry, I should have got back to you. I did try that but I get, "error: 'VRAM_D_SUB_BG' undeclared (first use in this function)"
<br/>
<br/>
Doing a grep through the libnds directory there appears to only be C, H and I for "_SUB_BG". I tried using H and I but then the keyboard didn't display at all.
<br/>
<br/>
Thanks,
<br/>
Stuart</span><span class="gensmall"><br/><br/>Last edited by JackUzi on Thu May 27, 2010 12:49 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#174294 - JackUzi - Thu May 27, 2010 12:49 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>elhobbs wrote:</b></span></td> </tr> <tr> <td class="quote">it may just be layer 0. you are using layers 2 and 3 for the keyboard and console respectively. not sure what you have planned for layer 0 but it is enabled using videoSetModeSub(MODE_0_2D);
<br/>
<br/>
I recommend that you try this out in desmume and use the layer, map, and tile tools to see how things are being laid out in vram.</td> </tr></table><span class="postbody">
<br/>
<br/>
I wasn't aware of the layer, map and title tools, so I'll look into those today. I don't have any plans for layer 0, it's just a plain console app and I was just cut-and-paste coding from the examples. Does this mean that I should set the video mode in a different way so that only layers 2 and 3 are active or that I should assign something to layer 0 to stop it being in an undefined state?
<br/>
<br/>
Thanks for your help, I really appreciate it,
<br/>
Stuart</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#174297 - elhobbs - Thu May 27, 2010 5:37 am</h4>
    <div class="postbody"><span class="postbody">I tested this out and I am not seeing any cyan and white speckles.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include &lt;nds.h&gt;
<br/>
#include &lt;stdio.h&gt;
<br/>
//---------------------------------------------------------------------------------
<br/>
int main(void) {
<br/>
   PrintConsole topScreen,bottomScreen;
<br/>
   Keyboard kbd;
<br/>
//---------------------------------------------------------------------------------
<br/>
    vramSetBankA(VRAM_A_MAIN_BG); 
<br/>
    vramSetBankC(VRAM_C_SUB_BG); 
<br/>
<br/>
    videoSetMode(MODE_0_2D); 
<br/>
    videoSetModeSub(MODE_0_2D); 
<br/>
<br/>
    consoleInit(&amp;topScreen, 3, BgType_Text4bpp, BgSize_T_256x256, 31, 0, true, true); 
<br/>
    consoleInit(&amp;bottomScreen, 3, BgType_Text4bpp, BgSize_T_256x256, 14, 0, false, true); 
<br/>
    consoleSelect(&amp;topScreen); 
<br/>
<br/>
    keyboardInit(&amp;kbd, 2, BgType_Text4bpp, BgSize_T_256x256, 31, 2, false, true); 
<br/>
    keyboardShow(); 
<br/>
<br/>
<br/>
    consoleSelect(&amp;topScreen); 
<br/>
   iprintf("top screen\nHello World!");
<br/>
    
<br/>
   consoleSelect(&amp;bottomScreen); 
<br/>
   iprintf("bottom screen\nHello World!");
<br/>
   
<br/>
   while(1) {
<br/>
      keyboardUpdate();
<br/>
      swiWaitForVBlank();
<br/>
   }
<br/>
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#174298 - JackUzi - Thu May 27, 2010 7:18 am</h4>
    <div class="postbody"><span class="postbody">Thank you for giving this a try. I compiled it and it runs perfectly on desmume, as does some versions of my original program, but gives the cyan and white pattern instead of the bottom screen text when running on actual DS hardware (in this case, a DSi XL with an M3i Zero)
<br/>
<br/>
Incidentally, one thing I have noticed with desmume is that although the text appears without any random pattern, the background of the bottom screen is grey. Using a different example such as the 'print_both_screens' example (that comes with devKitPro), both screens have a completely black background and it runs just fine on real hardware. This example doesn't display a keyboard however, as soon as the keyboard is added the problem appears.
<br/>
<br/>
Maybe I am out of luck in that this should work, but just doesn't with this particular card/ DS combination.
<br/>
<br/>
Thanks again,
<br/>
Stuart</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#174300 - samel - Thu May 27, 2010 11:42 am</h4>
    <div class="postbody"><span class="postbody">I think you have to check how much big are the tiles image [keyboard and text] because VRAM_BANK_C is 128Kb and it should contain 2 background [BgType_Text4bpp, BgSize_T_256x256] quite easly.
<br/>
<br/>
VRAM_BANK_D cannot be mapped for sub_bg
<br/>
<br/>
take a look here:
<br/>
<br/>
<a href="http://tobw.net/dswiki/index.php?title=Graphic_modes" target="_blank">http://tobw.net/dswiki/index.php?title=Graphic_modes</a>
<br/>
<br/>
VRAM_BANK_H and I can be mapped to sub_bg, but if i remember right they overlap .... too much time withoout ndsdev 8_(
<br/>
<br/>
Anyway, i've to admit that i've never used 
<br/>
consoleInit,consoleSelect,keyboardInit and keyboardShow so maybe i'm wrong</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#174301 - elhobbs - Thu May 27, 2010 1:37 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>JackUzi wrote:</b></span></td> </tr> <tr> <td class="quote">Thank you for giving this a try. I compiled it and it runs perfectly on desmume, as does some versions of my original program, but gives the cyan and white pattern instead of the bottom screen text when running on actual DS hardware (in this case, a DSi XL with an M3i Zero)Stuart</td> </tr></table><span class="postbody">I should have been clearer. this works fine on my DS Lite with an ezflavh v.
<br/>
<br/>
that being said - the libnds headers use these values to fit everything in the lower 64k of the vram bank without overlapping.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">    consoleInit(&amp;bottomScreen, 3, BgType_Text4bpp, BgSize_T_256x256, 22, 3, false, true); 
<br/>
<br/>
    keyboardInit(&amp;kbd, 2, BgType_Text4bpp, BgSize_T_256x256, 20, 0, false, true); 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
though, I suspect the issue may just be related to how the different cards leave the hardware in a different state.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#174306 - JackUzi - Fri May 28, 2010 3:09 am</h4>
    <div class="postbody"><span class="postbody">Hmmm, it certainly is starting to look like it is an M3i related issue which is a shame. Oh well, I'm starting to think that I might just use both screens for output and code up a chordal keyboard using all the buttons. There will be a bit of a learning curve when typing but with a bit of thoughtful optimisation it might be quite usable. At the very least it will be an interesting experiment.
<br/>
<br/>
Thanks again to everyone for your help,
<br/>
Stuart</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
