<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Does the card functions of NdsLib works or not ? [solved] - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Does the card functions of NdsLib works or not ? [solved]</h2>
<div id="posts">
<div class="post">
    <h4>#165930 - pilch - Tue Jan 13, 2009 2:22 pm</h4>
    <div class="postbody"><span class="postbody">Hi everyone,
<br/>
<br/>
I still don't know if the functions in card.h are working (my test failed, but it perhaps comes from my code).
<br/>
Does anyone achieve to read from the card <span style="font-weight: bold">with key 2 encrypted commands</span> AND <span style="font-weight: bold">without reinserting the card</span> ??
<br/>
Or does anyone know that it is <span style="font-style: italic">not possible</span> with NdsLib functions ?
<br/>
<br/>
I plan to reverse enginer a game to find how it acces the card (in fact I already started), but since it is <span style="font-weight: bold">very time consuming</span>, I would like to be sure these informations are not already known...
<br/>
<br/>
Thanks for help !</span><span class="gensmall"><br/><br/>Last edited by pilch on Wed Jan 14, 2009 5:30 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#165956 - chishm - Wed Jan 14, 2009 11:01 am</h4>
    <div class="postbody"><span class="postbody">You can only read the card for addresses above 0x8000 after it has passed the initialisation stage. Use the 0xB7 command in the following manner:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">cardParamCommand (CARD_CMD_DATA_READ, src, 
<br/>
   (portFlags &amp;~CARD_BLK_SIZE(7)) | CARD_ACTIVATE | CARD_nRESET | CARD_BLK_SIZE(1),
<br/>
   dest, CARD_DATA_BLOCK_SIZE);</td> </tr></table><span class="postbody">
<br/>
Here src is the offset address on the card, dest is the destination memory address and portFlags are the DS card flags specified by ndsHeader.cardControl13 (read from the card during initialisation, don't try using the flags from the running binary). This will read 512 bytes from the card.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165960 - pilch - Wed Jan 14, 2009 1:30 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote">You can only read the card for addresses above 0x8000 after it has passed the initialisation stage. Use the 0xB7 command in the following manner:
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">cardParamCommand (CARD_CMD_DATA_READ, src, 
<br/>
   (portFlags &amp;~CARD_BLK_SIZE(7)) | CARD_ACTIVATE | CARD_nRESET | CARD_BLK_SIZE(1),
<br/>
   dest, CARD_DATA_BLOCK_SIZE);</td> </tr></table><span class="postbody">
<br/>
Here src is the offset address on the card, dest is the destination memory address and portFlags are the DS card flags specified by ndsHeader.cardControl13 (read from the card during initialisation, don't try using the flags from the running binary). This will read 512 bytes from the card.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
I know that... but did you test it ?
<br/>
Did it work ?
<br/>
(I mean on real hardware, not on no$gba)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165962 - Maxxie - Wed Jan 14, 2009 2:00 pm</h4>
    <div class="postbody"><span class="postbody">Chishm is a trusted source on that. It will work.<br/>_________________<br/><a class="postlink" href="http://nintendods.desperate-programmers.com/doku.php?id=wireless_io_map" target="_blank">Trying  to bring more detail into understanding the wireless hardware</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165965 - pilch - Wed Jan 14, 2009 5:33 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote">You can only read the card for addresses above 0x8000 after it has passed the initialisation stage. Use the 0xB7 command in the following manner:
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">cardParamCommand (CARD_CMD_DATA_READ, src, 
<br/>
   (portFlags &amp;~CARD_BLK_SIZE(7)) | CARD_ACTIVATE | CARD_nRESET | CARD_BLK_SIZE(1),
<br/>
   dest, CARD_DATA_BLOCK_SIZE);</td> </tr></table><span class="postbody">
<br/>
Here src is the offset address on the card, dest is the destination memory address and portFlags are the DS card flags specified by ndsHeader.cardControl13 (read from the card during initialisation, don't try using the flags from the running binary). This will read 512 bytes from the card.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Wow, it works !
<br/>
Thanks a lot ! I was really stuck with this !
<br/>
Thanks Maxxie too :)
<br/>
<br/>
.. I wonder why my previous code failed, have to check it...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165987 - chishm - Thu Jan 15, 2009 10:53 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>pilch wrote:</b></span></td> </tr> <tr> <td class="quote">I know that... but did you test it ?
<br/>
Did it work ?
<br/>
(I mean on real hardware, not on no$gba)</td> </tr></table><span class="postbody">
<br/>
It's used in NitroHax so yes it's tested and works, but I guess you know that now.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
