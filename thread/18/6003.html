<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>GBA Mode from DS Bootloader? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > GBA Mode from DS Bootloader?</h2>
<div id="posts">
<div class="post">
    <h4>#45408 - cory1492 - Fri Jun 10, 2005 12:45 pm</h4>
    <div class="postbody"><span class="postbody">Anyone know how to do this yet? 
<br/>
<br/>
All I have tried so far is making it boot by using the gba file (specifically my f2a ultra carts bootloader) with a ds header, using the .gba as an arm7 binary like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">ndstool017.exe -c booter2.nds -7 f2a7.bin -r7 0x2000000 -e7 0x2000000</td> </tr></table><span class="postbody"> I using Darkains multibootloader/FS to attempt this, but all I have in front of me so far is white screens.
<br/>
<br/>
I have verified that the cart will read properly with its bootloader.gba even if the bootloader is located as the last rom on the cart (if you load it from the default bootloader that is) but I have no clue as to what preparations need to be made to load it properly once in DS mode...
<br/>
<br/>
Does the GBA header have loading address code like the DS header does? I cant seem to find a link to the GBA Tech docs right now...
<br/>
<br/>
Any point in the correct direction would be appreciated, all I have right now to work with is this:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">The following piece of code will make the DS go into GBA mode:
<br/>
    mov    r2, #0x40
<br/>
    ldr    r12, =0x11B8      @ call some routine in the bios
<br/>
    bx     r12
<br/>
</td> </tr></table><span class="postbody">from the NDStech wiki, but it doesnt say what routine is called, or what point/cart address it attempts to start from, and Im not entirely certain how to safely patch that assembly into a prebuilt rom like the standard bootloader...
<br/>
<br/>
What I do know for certain is that I have a way to flash the cart with whatever I want on it and in whatever order I would like it to be in, without using the standard flashing tool which forces things like the bootloader to be in certain places... which took some doing and is still going through some testing, and will likely mess up any in game resets (which BTW is really for only double jointed fingers on the DS anyway).
<br/>
<br/>
As a final question, is there a good list of opcodes for the ARM7 and 9 architectures (just asking so I dont have to sift through a wackload of PDFs with possibly wrong info for GBA/DS devving)
<br/>
<br/>
edit: just to answer my own question on opcodes before ppl start raving about searching, I found this info on the ARM9 here:
<br/>
<a href="http://forum.gbadev.org/viewtopic.php?t=4763&amp;highlight=opcodes" target="_blank">http://forum.gbadev.org/viewtopic.php?t=4763&amp;highlight=opcodes</a>
<br/>
and this on arm in general:
<br/>
<a href="http://www.arm.com/documentation/ARMProcessor_Cores/index.html" target="_blank">http://www.arm.com/documentation/ARMProcessor_Cores/index.html</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#45431 - josath - Fri Jun 10, 2005 5:24 pm</h4>
    <div class="postbody"><span class="postbody">When you use the code from the ndstech wiki to switch to gba mode, it starts executing at the beginning of the gba rom 0x08000000 (actually skips over the header), NOT from ram (0x02000000)
<br/>
<br/>
Ideally, what you'd do is use your carts bank/offset switching registers to make the beginning of gba rom (0x080..) point to a gba rom. this probably WONT work with gba menus/bootloaders, as they most likely expect themselves to be at the beginning of the rom and might get confused if they are not.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#45491 - tepples - Sat Jun 11, 2005 5:27 am</h4>
    <div class="postbody"><span class="postbody">And by that time, you're trying to do exactly what they're talking about in <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=5542" target="_blank">this topic</a>. Please take discussion there.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
