<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>loading texure by kosfs - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > loading texure by kosfs</h2>
<div id="posts">
<div class="post">
    <h4>#114518 - Xgame - Mon Jan 08, 2007 6:09 pm</h4>
    <div class="postbody"><span class="postbody">I whold like to load pcx texture by kosfs, but I prefer to use loadPCX(..). Can I do that or must I use a loader based on stdio funcion?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114521 - GPFerror - Mon Jan 08, 2007 6:51 pm</h4>
    <div class="postbody"><span class="postbody">you should be able to.
<br/>
something like this
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">FILE * pFile;
<br/>
int lSize;
<br/>
char* pcx_file;
<br/>
sImage pcx;
<br/>
  if ((pFile = fopen("test.pcx","rb")) == NULL){ fprintf(stderr, "Error opening file\n");}
<br/>
else
<br/>
{
<br/>
  fseek (pFile , 0 , SEEK_END);
<br/>
  lSize = ftell (pFile); 
<br/>
  rewind (pFile);
<br/>
 pcx_file= (char*) malloc (lSize);
<br/>
fread (pcx_file,1,lSize,pFile);
<br/>
fclose(pFile);
<br/>
loadPCX((u8*)pcx_file, &amp;pcx);
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
this should work with any filesytem that uses stdio functions.
<br/>
<br/>
Troy(GPF)
<br/>
<a href="http://gpf.dcemu.co.uk" target="_blank">http://gpf.dcemu.co.uk</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114627 - Xgame - Tue Jan 09, 2007 4:52 pm</h4>
    <div class="postbody"><span class="postbody">thank you but model don't "put"texture; .  I can't put texture or color over this model and I can't explain why. Model is black and for do that screenshoot i put behind a color quad. I tryed to put "glLoadIdentity() before drawing it, but nothing change. <a href="http://img483.imageshack.us/img483/1931/texturebugqh5.png">[Images not permitted - Click here to view it]</a> screenshot is done with ensata(nintendo ds official emulator) and is perfect like in ds.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114698 - HyperHacker - Wed Jan 10, 2007 5:58 am</h4>
    <div class="postbody"><span class="postbody">So, no matter what you do, your model remains black and textureless? Keep in mind polygon colours tend to be more of a tint for the textures; for example, if you have a grass texture on a yellow polygon, you get yellowish grass. On pure black polygons your texture won't appear at all.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114738 - Xgame - Wed Jan 10, 2007 3:39 pm</h4>
    <div class="postbody"><span class="postbody">but I can't put color in model. if i use glColor3f nothing happen. I just put color over model using glMaterialf. I think texture is really loaded because I can view it's size.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114744 - Vich - Wed Jan 10, 2007 4:33 pm</h4>
    <div class="postbody"><span class="postbody">Maybe you have to add a light to the scene?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114746 - Xgame - Wed Jan 10, 2007 4:37 pm</h4>
    <div class="postbody"><span class="postbody">no, i tryed but it didn't work</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114747 - Vich - Wed Jan 10, 2007 4:52 pm</h4>
    <div class="postbody"><span class="postbody">Maybe there's something with the material settings?
<br/>
I have these in my app at the moment:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
	//need to set up some material properties since DS does not have them set by default
<br/>
	glMaterialf(GL_AMBIENT, RGB15(16,16,16));
<br/>
	glMaterialf(GL_DIFFUSE, RGB15(16,16,16));
<br/>
	glMaterialf(GL_SPECULAR, BIT(15) | RGB15(8,8,8));
<br/>
	glMaterialf(GL_EMISSION, RGB15(16,16,16));
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Is the object still black when you don't enable the texture?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114799 - HyperHacker - Wed Jan 10, 2007 9:05 pm</h4>
    <div class="postbody"><span class="postbody">You were able to colour that quad behind it, so colour works. I suggest you disable everything else (materials, textures, etc), and if colour works then, turn them back on one at a time until it doesn't.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114914 - Xgame - Thu Jan 11, 2007 3:46 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Vich wrote:</b></span></td> </tr> <tr> <td class="quote">Maybe there's something with the material settings?
<br/>
I have these in my app at the moment:
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
	//need to set up some material properties since DS does not have them set by default
<br/>
	glMaterialf(GL_AMBIENT, RGB15(16,16,16));
<br/>
	glMaterialf(GL_DIFFUSE, RGB15(16,16,16));
<br/>
	glMaterialf(GL_SPECULAR, BIT(15) | RGB15(8,8,8));
<br/>
	glMaterialf(GL_EMISSION, RGB15(16,16,16));
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Is the object still black when you don't enable the texture?</span></td> </tr></table><span class="postbody">
<br/>
after doing that I put color in model. I can't really understand why it don't work, as HyperHacker said I'll tray to remove a lot of 3d stuff.
<br/>
EDIT
<br/>
i removed glNormal3f by drawing and colors now works, but texture dose not</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114916 - silent_code - Thu Jan 11, 2007 4:10 pm</h4>
    <div class="postbody"><span class="postbody">using glcolor works with textures, but you won't be able to light anything. to use lighting you need to set a material and *not* use glcolor.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114918 - Vich - Thu Jan 11, 2007 4:43 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>silent_code wrote:</b></span></td> </tr> <tr> <td class="quote">using glcolor works with textures, but you won't be able to light anything. to use lighting you need to set a material and *not* use glcolor.</td> </tr></table><span class="postbody">
<br/>
<br/>
Is it possible to first draw 3D in perspective mode with materials and lighting and then load identity matrices, disable lighting, start orthogonal projection and draw quads with a glColor?<br/>_________________<br/>[<a class="postlink" href="http://www.lifeisdigital.net" target="_blank">project website</a>] [<a class="postlink" href="http://www.kenvanhoeylandt.net" target="_blank">personal website</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114921 - Xgame - Thu Jan 11, 2007 5:31 pm</h4>
    <div class="postbody"><span class="postbody">I loaded the texture over model, but is there still a problem: texcoords are horrible wrong! look at the picture <a href="http://img444.imageshack.us/img444/1723/wrongtextureww3.png">[Images not permitted - Click here to view it]</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#115392 - Payk - Mon Jan 15, 2007 8:07 pm</h4>
    <div class="postbody"><span class="postbody">Well, as i already told you:
<br/>
You need to toggle ST coords and invert one:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
newS=Texturesize-T
<br/>
newT=S
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
That should help. I dont know which model you used but for md2 it helped alot! (thanx to webez at this point...i was totaly frustated after hours testing...)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#115475 - Xgame - Tue Jan 16, 2007 9:04 am</h4>
    <div class="postbody"><span class="postbody">I solved, the model was bugged(with other models work, but with the yoshi's one not!)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116335 - Payk - Wed Jan 24, 2007 3:13 pm</h4>
    <div class="postbody"><span class="postbody">XGame.
<br/>
It really depends.
<br/>
Milkshape does export texture coordinates on another way then 3DS-MAX does. And worst is when loading a md2 you can know if its that way or the other way. Thats why i renamed all models made with milkshape to mdm. So when over giving a filename to the loading function it just checks the last ucased letter to see how to load it. That works fine for me.
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">for (I = 0; I &lt; Models[num].header.num_tris; ++I){
<br/>
   for (j = 0; j &lt; 3; ++j){
<br/>
      if(texturereverse){
<br/>
         s = (float)Models[num].texcoords[Models[num].triangles[I].st[j]].s / Models[num].header.skinwidth;
<br/>
         t = (float)Models[num].texcoords[Models[num].triangles[I].st[j]].t / Models[num].header.skinheight;
<br/>
         Models[num].texcoords[Models[num].triangles[I].st[j]].s=floattot16(float(s)*widthheight);
<br/>
         Models[num].texcoords[Models[num].triangles[I].st[j]].t=floattot16(float(1-t)*widthheight);
<br/>
      }
<br/>
<br/>
      if(!texturereverse){
<br/>
         s = (float)Models[num].texcoords[Models[num].triangles[I].st[j]].s / Models[num].header.skinwidth;
<br/>
         t = (float)Models[num].texcoords[Models[num].triangles[I].st[j]].t / Models[num].header.skinheight;
<br/>
         Models[num].texcoords[Models[num].triangles[I].st[j]].s=floattot16(float(s)*widthheight);
<br/>
         Models[num].texcoords[Models[num].triangles[I].st[j]].t=floattot16(float(t)*widthheight);
<br/>
      }
<br/>
   
<br/>
   }
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
So if its a milkshape md2 texturereverse should be false.
<br/>
If it was made with quake modeler or 3d studio max it has to be true value.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
