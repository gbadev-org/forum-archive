<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>DS cartridge EEPROM help - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > DS cartridge EEPROM help</h2>
<div id="posts">
<div class="post">
    <h4>#51797 - bbennett69 - Tue Aug 23, 2005 4:25 pm</h4>
    <div class="postbody"><span class="postbody">Has anybody got the cardReadEeprom and cardWriteEeprom code working. 
<br/>
<br/>
Or can anybody help me in writing the code to read/write the DS save game.
<br/>
<br/>
Any help, pointers or any thing would help at this moment.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#52356 - DsPet - Tue Aug 30, 2005 12:55 am</h4>
    <div class="postbody"><span class="postbody">The NDSLIB cardReadEeprom and cardWriteEeprom routines are significantly broken.
<br/>
Even the #define for "CARD_CR1" is wrong.
<br/>
The NDSLIB versions won't work for larger chips (addrtype=3, like Nintendogs)
<br/>
<br/>
Here's a read version that works (including addrtype=3). The write version is much more complicated since the larger chip needs blocks to be erased first.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#undef CARD_CR1
<br/>
#define CARD_CR1       (*(vuint16*)0x040001A0) /*fixed*/
<br/>
<br/>
#define EepromWaitBusy()   while (CARD_CR1 &amp; /*BUSY*/0x80);
<br/>
<br/>
void fixed_cardReadEeprom(uint32 address, uint8 *data, uint32 length, uint32 addrtype)
<br/>
{
<br/>
    CARD_CR1 = /*E*/0x8000 | /*SEL*/0x2000 | /*MODE*/0x40;
<br/>
    CARD_EEPDATA = 0x03 | ((addrtype == 1) ? address&gt;&gt;8&lt;&lt;3 : 0);
<br/>
    EepromWaitBusy();
<br/>
<br/>
    if (addrtype == 3)
<br/>
    {
<br/>
        CARD_EEPDATA = (address &gt;&gt; 16) &amp; 0xFF;
<br/>
        EepromWaitBusy();
<br/>
    }
<br/>
    if (addrtype &gt;= 2)
<br/>
    {
<br/>
        CARD_EEPDATA = (address &gt;&gt; 8) &amp; 0xFF;
<br/>
        EepromWaitBusy();
<br/>
    }
<br/>
    CARD_EEPDATA = (address) &amp; 0xFF;
<br/>
    EepromWaitBusy();
<br/>
<br/>
    while (length &gt; 0)
<br/>
    {
<br/>
        CARD_EEPDATA = 0;
<br/>
        EepromWaitBusy();
<br/>
        *data++ = CARD_EEPDATA;
<br/>
        length--;
<br/>
    }
<br/>
    CARD_CR1 = /*MODE*/0x40;
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#52361 - The 9th Sage - Tue Aug 30, 2005 2:21 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>DsPet wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
The NDSLIB versions won't work for larger chips (addrtype=3, like Nintendogs)</td> </tr></table><span class="postbody">
<br/>
<br/>
Ah, I suspected Nintendogs used some kind of larger EEPROM.  I was trying to back up the save, just for the sake of backing it up, and it would see that the NDS Max Drive software just gets confused (that and it seems like Nintendogs would have a heck of a lot of data to store compared to many games)...either that or it just doesn't have enough space for the save, which I kind of doubt.<br/>_________________<br/>Now with 20% More Old Man from Zelda 1 than ever before!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#52368 - josath - Tue Aug 30, 2005 6:21 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>The 9th Sage wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>DsPet wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
The NDSLIB versions won't work for larger chips (addrtype=3, like Nintendogs)</td> </tr></table><span class="postbody">
<br/>
<br/>
Ah, I suspected Nintendogs used some kind of larger EEPROM.  I was trying to back up the save, just for the sake of backing it up, and it would see that the NDS Max Drive software just gets confused (that and it seems like Nintendogs would have a heck of a lot of data to store compared to many games)...either that or it just doesn't have enough space for the save, which I kind of doubt.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
How much space does the 'NDS Max Drive' have? Most games are 8KB i believe, with a couple being 0.5KB, but nintendogs is 512KB...quite a difference in size.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#52471 - The 9th Sage - Wed Aug 31, 2005 3:38 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>josath wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>The 9th Sage wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>DsPet wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
The NDSLIB versions won't work for larger chips (addrtype=3, like Nintendogs)</td> </tr></table><span class="postbody">
<br/>
<br/>
Ah, I suspected Nintendogs used some kind of larger EEPROM.  I was trying to back up the save, just for the sake of backing it up, and it would see that the NDS Max Drive software just gets confused (that and it seems like Nintendogs would have a heck of a lot of data to store compared to many games)...either that or it just doesn't have enough space for the save, which I kind of doubt.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
How much space does the 'NDS Max Drive' have? Most games are 8KB i believe, with a couple being 0.5KB, but nintendogs is 512KB...quite a difference in size.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Actually, you may be right there...not sure EXACTLY how much there is, but assuming all my saves are 8k, and from my calculation you could fit roughly 17 of them on there, that would be quite a bit less than 512kb, so you are right there.   Man, they really skimped on the space there I guess didn't they?<br/>_________________<br/>Now with 20% More Old Man from Zelda 1 than ever before!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#53550 - wintermute - Fri Sep 09, 2005 3:16 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>DsPet wrote:</b></span></td> </tr> <tr> <td class="quote">The NDSLIB cardReadEeprom and cardWriteEeprom routines are significantly broken.
<br/>
Even the #define for "CARD_CR1" is wrong.
<br/>
The NDSLIB versions won't work for larger chips (addrtype=3, like Nintendogs)
<br/>
<br/>
Here's a read version that works (including addrtype=3). The write version is much more complicated since the larger chip needs blocks to be erased first.
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
It would be appreciated if things like this were posted to the devkitPro bug tracker for libnds found here -&gt; <a href="http://sourceforge.net/tracker/?group_id=114505&amp;atid=668551" target="_blank">http://sourceforge.net/tracker/?group_id=114505&amp;atid=668551</a>
<br/>
<br/>
this particular code made it into CVS and will probably be in the next release.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
