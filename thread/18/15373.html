<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Antialiasing with 2 scaled backgrounds - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Antialiasing with 2 scaled backgrounds</h2>
<div id="posts">
<div class="post">
    <h4>#154372 - ingramb - Tue Apr 15, 2008 8:58 am</h4>
    <div class="postbody"><span class="postbody">I have a scaled tile background that I want to antialias.  I think I've seen references to a technique that emulators have used that involves adding a second background with the same image, and offsetting it slightly.
<br/>
<br/>
So I have 2 tile backgrounds on top of a 3d background.  I want to blend the tile backgrounds together, and then have that on top of the 3d background.  I can't seem to get the blend settings right.
<br/>
<br/>
I've tried: 
<br/>
BLEND_CR = BLEND_ALPHA | BLEND_SRC_BG2 | BLEND_SRC_BG3  BLEND_DST_BG0;
<br/>
BLEND_AB = (8 &lt;&lt; 0) | (16 &lt;&lt; 8);
<br/>
BG0_CR = BG_PRIORITY_1... //3d background
<br/>
BG2_CR = BG_PRIORITY_0... //blended tiles
<br/>
BG3_CR = BG_PRIORITY_0... //blended tiles
<br/>
This doesn't work.  I am not understanding how the blending hardware works.  Help?
<br/>
<br/>
[EDIT]
<br/>
Background 2 and 3 use different extended palette slots implicitly.  That was my blending problem.  So it kind of works now.  What is the most effective way to do the antialiasing?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#154391 - Lazy1 - Tue Apr 15, 2008 4:38 pm</h4>
    <div class="postbody"><span class="postbody">This thread may help you:
<br/>
<a href="http://forum.gbadev.org/viewtopic.php?t=12628&amp;highlight=jitter" target="_blank">http://forum.gbadev.org/viewtopic.php?t=12628&amp;highlight=jitter</a>
<br/>
<br/>
There are quite a few good methods in there on how to smooth out the hardware scaling.
<br/>
What I do is offset the X scroll register back and forth by 1 every hblank, this smooths a scaled 320x200 display very nicely.
<br/>
<br/>
The only drawback is you may notice some _slight_ flicker but that's only if you're really looking for it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#154399 - Cydrak - Tue Apr 15, 2008 6:20 pm</h4>
    <div class="postbody"><span class="postbody">Careful if you're using emulators--the hardware is unusual. In particular it only blends once.
<br/>
<br/>
The rule of thumb: transparency doesn't exist. So for every screen pixel, it picks the "top two" things: a visible, opaque SRC and a covered, opaque DST directly below it. If both match, it blends. Speaking of which, BLEND_ALPHA is kinda misleading. If you really want that, the weights should sum to 16, since the blend is just additive. <span style="font-size: 9px; line-height: normal">(Am I the only one who wishes they were signed...? Whatever happened to that cool SNES subtraction mode?)</span>
<br/>
<br/>
I would try:
<br/>
BLEND_CR = BLEND_ALPHA | BLEND_SRC_BG2 | BLEND_DST_BG3;
<br/>
BLEND_AB = (8 &lt;&lt; 0) | (8 &lt;&lt; 8);  // half and half
<br/>
BG2_CR = BG_PRIORITY_0... //blended tiles
<br/>
BG3_CR = BG_PRIORITY_1... //blended tiles 
<br/>
BG0_CR = BG_PRIORITY_2... //3d background
<br/>
<br/>
You can also add BLEND_SRC_BG3 and BLEND_DST_BG0, this *ought* to antialias along the transparent edges (blend over BG0, where BG2 and BG3 are not blending with each other), but I haven't specifically tried it so I could be wrong...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#154408 - ingramb - Tue Apr 15, 2008 8:17 pm</h4>
    <div class="postbody"><span class="postbody">Lazy1: Thanks, lot's of useful information there
<br/>
Cydrak: Yeah, those numbers are the ones that worked for me once I realized BG2 and BG3 use different extended palette slots.  I'll try your other suggestion after work.
<br/>
<br/>
Thanks guys!
<br/>
<br/>
Now another question...I'm just rendering 2d quads onto the 3d layer.  Are there any tricks antialias this when it scales down?  I imagine you could use the 3d capture hardware to blend 2 offset frames together, but I don't have the vram or the cycles for this.  Is there anything else that will work?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#154511 - M3d10n - Thu Apr 17, 2008 3:00 am</h4>
    <div class="postbody"><span class="postbody">You could jitter the texture coordinates using the texture matrix half a texel on each vblank, and let the LCD ghosting do the blending for you. If your texture is low-contrast, the flickering is pretty much unnoticeable.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
