<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>filecopy - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > filecopy</h2>
<div id="posts">
<div class="post">
    <h4>#151615 - darkchild - Sat Mar 01, 2008 3:37 pm</h4>
    <div class="postbody"><span class="postbody">can someone whip me up a file copying function?
<br/>
<br/>
I can't seem to get mine working :(
<br/>
<br/>
here's the code if you are interested:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int copyfile(char input[], char output[])
<br/>
{
<br/>
   bool error;
<br/>
   FILE *from, *to;
<br/>
   char ch;
<br/>
   
<br/>
   if((from = fopen(input, "rb"))==NULL) {
<br/>
    error = true;}
<br/>
   
<br/>
   
<br/>
   if (error == false) 
<br/>
   {
<br/>
      if((to = fopen(output, "wb"))==NULL)
<br/>
      {
<br/>
         error = true;
<br/>
      }
<br/>
    }
<br/>
<br/>
   if (error == false)
<br/>
   {
<br/>
      while(!feof(from)) 
<br/>
      {
<br/>
         ch = fgetc(from);
<br/>
         if(ferror(from)) 
<br/>
         {
<br/>
            error = true;
<br/>
         }
<br/>
      }
<br/>
      if (error == false)
<br/>
      {
<br/>
         if(!feof(from)){ fputc(ch, to); }
<br/>
      }
<br/>
      if(ferror(to)) 
<br/>
      {
<br/>
         error = true;
<br/>
      }
<br/>
      
<br/>
      fclose(from);
<br/>
      fclose(to);
<br/>
      
<br/>
   }
<br/>
   if (error == true) { return -1;} else { return 0; }
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
If you help, your name will be on the credits of my program (iFile)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151616 - Michoko - Sat Mar 01, 2008 3:57 pm</h4>
    <div class="postbody"><span class="postbody">Well, from the top of my head, you must put the writing of your bytes in the while loop.
<br/>
<br/>
So you have to put:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
      if (error == false) 
<br/>
      { 
<br/>
         if(!feof(from)){ fputc(ch, to); } 
<br/>
      } 
<br/>
      if(ferror(to)) 
<br/>
      { 
<br/>
         error = true; 
<br/>
      } 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
inside the while loop (currently it's outside). 
<br/>
<br/>
And you have to add to your while condition:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">while(!feof(from) &amp;&amp; (error == false)) </td> </tr></table><span class="postbody">
<br/>
<br/>
Bye
<br/>
Michoko</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151617 - darkchild - Sat Mar 01, 2008 4:26 pm</h4>
    <div class="postbody"><span class="postbody">thank you greatly for the help, but I am afraid I have bad news, it still doesn't work :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151618 - Michoko - Sat Mar 01, 2008 4:39 pm</h4>
    <div class="postbody"><span class="postbody">Hmm, difficult to figure out what's wrong with just "it doesn't work". :P
<br/>
It would be good to tell us how you call this function, and maybe use some debugging messages. Is the source file opening correctly?
<br/>
<br/>
Anyway you should initialize your "error" variable to false, since right now it could have any initial value :
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">bool error = false;</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151619 - spinal_cord - Sat Mar 01, 2008 4:44 pm</h4>
    <div class="postbody"><span class="postbody">Without error checking, this works...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void copy_file(char *input, char *output)
<br/>
{
<br/>
   FILE *from, *to;
<br/>
   char ch;
<br/>
   from = fopen(input, "rb");
<br/>
   to = fopen(output,"wb");
<br/>
      while(!feof(from)) 
<br/>
      {
<br/>
         ch = fgetc(from);
<br/>
         fputc(ch,to);
<br/>
      }
<br/>
   fclose(from);
<br/>
   fclose(to);
<br/>
}   
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/>I'm not a boring person, it's just that boring things keep happening to me.
<br/>
<a class="postlink" href="http://spinal.dizidesigns.co.uk/" target="_blank">Homepage</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151620 - darkchild - Sat Mar 01, 2008 4:56 pm</h4>
    <div class="postbody"><span class="postbody">thanks for the help, for the time being I added a simple verification:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int filecopy(char *input, char *output)
<br/>
{
<br/>
   FILE *from, *to;
<br/>
   char ch;
<br/>
   from = fopen(input, "rb");
<br/>
   to = fopen(output,"wb");
<br/>
   if ((from != NULL)&amp;( to!= NULL))
<br/>
   {
<br/>
      while(!feof(from)) 
<br/>
      {
<br/>
         ch = fgetc(from);
<br/>
         fputc(ch,to);
<br/>
         
<br/>
      }
<br/>
   }
<br/>
   else
<br/>
   {
<br/>
      return -1;
<br/>
   }
<br/>
   fclose(from);
<br/>
   fclose(to);
<br/>
}   </td> </tr></table><span class="postbody">
<br/>
<br/>
:) hope it works, if someone else has other verifications worth using, please tell me</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151622 - tepples - Sat Mar 01, 2008 5:34 pm</h4>
    <div class="postbody"><span class="postbody">Four holes I can see:
<br/>
<ol type="a"><li>What happens if 'from' is opened but an error prevents 'to' from opening, or vice versa? It would appear that the function leaks a file descriptor. </li><li>Do the strings in 'input' and 'output' get changed inside the function, or can they be qualified with const? </li><li>What is returned on a successful call? Is it predictable, or is it undefined (that is, just what happened to be in the first register when the function exits)? </li><li>And is it worth calling into cstdio twice for each byte, as opposed to chunks of at least 1 KiB? </li></ol>
<br/>
Untested; feel free to poke holes in it:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int copyfile(const char *inPath, const char *outPath) {
<br/>
  char buffer[1024];
<br/>
  FILE *infp;
<br/>
  FILE *outfp;
<br/>
  int returnValue = 0;
<br/>
<br/>
  infp = fopen(inPath, "rb");
<br/>
  if (!infp) {
<br/>
    return -1;
<br/>
  }
<br/>
  outfp = fopen(outPath, "wb");
<br/>
  if (!outfp) {
<br/>
    fclose(infp);
<br/>
    return -1;
<br/>
  }
<br/>
<br/>
  while(!feof(infp) &amp;&amp; returnValue &gt;= 0)
<br/>
  {
<br/>
    size_t nRead, nWritten;
<br/>
<br/>
    nRead = fread(buffer, 1, sizeof(buffer), infp);
<br/>
    if (ferror(infp)) {
<br/>
      returnValue = -1;
<br/>
    }
<br/>
    nWritten = fwrite(buffer, 1, nRead, outfp);
<br/>
    if (ferror(outfp)) {
<br/>
      returnValue = -1;
<br/>
    }
<br/>
  }
<br/>
  fclose(outfp);
<br/>
  fclose(infp);
<br/>
<br/>
  return returnValue;
<br/>
}</td> </tr></table><span class="postbody"><br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
