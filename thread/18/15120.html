<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Profiling - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Profiling</h2>
<div id="posts">
<div class="post">
    <h4>#151837 - nczempin - Wed Mar 05, 2008 8:35 pm</h4>
    <div class="postbody"><span class="postbody">To get acquainted with DS coding, I have started playing around with coding  Game of Life and optimizing the hell out of it, along the lines of Abrash's Black Book, chapters 17 and 18.
<br/>
<br/>
Once I had a working program, the next step for optimization was, of course, getting the code profiled.
<br/>
<br/>
I couldn't find a Profiler for the DS, so I guessed I had to hand-profile with using a timer (incidentally, why is the clock() function not implemented in libnds?).
<br/>
<br/>
In the medium term, I would like to be able to instrument and profile my code, on an Emulator or on a DS. Surely this would be useful to others too.
<br/>
<br/>
So, has anybody spent any sizable number of brain cells on how to get a profiler running for DS homebrew? Call-graph would be a good start, but a by-instruction like VTune would be cool too. Perhaps the ARM7 can be coerced into checking on its brother somehow, as any performance optimization is perhaps likely to focus on the ARM9 code.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151838 - silent_code - Wed Mar 05, 2008 9:10 pm</h4>
    <div class="postbody"><span class="postbody">simon has posted his profiler (the one he used for his quake port). look for it.
<br/>
(it's strange to write in english to a german, when one's living there, too! :^D )</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151842 - nczempin - Wed Mar 05, 2008 9:48 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>silent_code wrote:</b></span></td> </tr> <tr> <td class="quote">simon has posted his profiler (the one he used for his quake port). look for it.
<br/>
(it's strange to write in english to a german, when one's living there, too! :^D )</td> </tr></table><span class="postbody">
<br/>
<br/>
You'll get used to it ;-) We can always switch to German in any pms.
<br/>
<br/>
I'm actually from Berlin too (Friedenau), but have cancelled my lease; I will pack my stuff next week and drive down next weekend.
<br/>
<br/>
But enough of the private business ;-)
<br/>
<br/>
I'll go look for the quake profiler, I hope it's universal or can be adapted.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151845 - nczempin - Wed Mar 05, 2008 10:29 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>nczempin wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>silent_code wrote:</b></span></td> </tr> <tr> <td class="quote">simon has posted his profiler (the one he used for his quake port). look for it.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I'll go look for the quake profiler, I hope it's universal or can be adapted.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Hmm.
<br/>
<br/>
What I found in the <a class="postlink" href="http://quake.drunkencoders.com/downloads_how_to_play.html" target="_blank">DS quake I source code</a> (<a class="postlink" href="http://quake.drunkencoders.com/downloads/quakeds_source_271007_r3.zip" target="_blank">direct dl</a>) was this:
<br/>
<a class="postlink" href="http://www.logix.cz/michal/devel/CygProfiler/" target="_blank">CygProfiler</a>
<br/>
<br/>
While of course it would be nice to be able to profile your code without having to include actual call_profiler() lines, I guess it is a good enough start.
<br/>
<br/>
Only one thing bothers me: It saves the results as a file (like most profilers do), but I have heard problems with SD cards' filesystems being corrupted etc.
<br/>
<br/>
If there really are that many issues with FSs, perhaps one should just use what commercial cartridges do: save to the internal flash. Presumably, there are ways to do so in libnds and friends...
<br/>
<br/>
Of course for this profiler, I would have to change the source. Not wanting to change too many things at once, I'll try to get it working with the state-of-the-art FS-lib, whichever that is.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151881 - simonjhall - Thu Mar 06, 2008 10:54 am</h4>
    <div class="postbody"><span class="postbody">I stuck the files for this on the quake web site many moons ago (and put a link on gbadev, too)
<br/>
<a href="http://quake.drunkencoders.com/profiler/cyg-profile.c" target="_blank">http://quake.drunkencoders.com/profiler/cyg-profile.c</a>
<br/>
<a href="http://quake.drunkencoders.com/profiler/cyg-profile.h" target="_blank">http://quake.drunkencoders.com/profiler/cyg-profile.h</a>
<br/>
<a href="http://quake.drunkencoders.com/profiler/resolve" target="_blank">http://quake.drunkencoders.com/profiler/resolve</a> (rename this file to resolve.pl once you've downloaded it)
<br/>
<br/>
To use it, again I've put instructions in another thread on here, compile with -finstrument-functions -mpoke-function-name on the source that you want to instrument (don't do it to interrupt handlers, or stuff that does file access cos you'll get it stuck in a loop and run out of stack).
<br/>
Call cygprofile_begin() to set up the data structures, then call cygprofile_enable() to start instrumentation and then when you want to stop profiling your code (eg when you quit your program) call cygprofile_end(). Job done.
<br/>
<br/>
You do not need to do this for each function you want to profile - it will instrument every function called until you call cygprofile_end.
<br/>
<br/>
(btw you'll want to wiggle the code slightly to call your own file-writing and opening functions, plus you need to provide the number of hblanks since program start in 'hblanks')<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151886 - Dwedit - Thu Mar 06, 2008 11:23 am</h4>
    <div class="postbody"><span class="postbody">I once made a modified version of VisualBoyAdvance named "VBA_TEH_PROFILER", which counted the number of times each address was executed (up to 32 bit number).  Very useful for profiling ASM code.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151891 - simonjhall - Thu Mar 06, 2008 12:08 pm</h4>
    <div class="postbody"><span class="postbody">Oh man I would kill for one of those on the DS. I was considering writing something similar that ran on the real machine (eg you'd pass in a function pointer and it would then emulate and time that function). Not enough free time...<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151894 - nczempin - Thu Mar 06, 2008 12:46 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>simonjhall wrote:</b></span></td> </tr> <tr> <td class="quote">Oh man I would kill for one of those on the DS. I was considering writing something similar that ran on the real machine (eg you'd pass in a function pointer and it would then emulate and time that function). Not enough free time...</td> </tr></table><span class="postbody">
<br/>
<br/>
surely one of the open-source emus could be expanded in a collaborative effort?
<br/>
<br/>
and you'd just need to stretch the little free time out to a longer period.
<br/>
<br/>
There's nothing like a commercial deadline to get a project finished quickly, but there's nothing like a persistently improving open-source project to eventually catch up and surpass...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151996 - wintermute - Fri Mar 07, 2008 11:45 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">There's nothing like a commercial deadline to get a project finished quickly, but there's nothing like a persistently improving open-source project to eventually catch up and surpass...</td> </tr></table><span class="postbody">
<br/>
<br/>
Name one.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152011 - HyperHacker - Sat Mar 08, 2008 4:48 am</h4>
    <div class="postbody"><span class="postbody">7zip? Maybe?<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152017 - nczempin - Sat Mar 08, 2008 12:02 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">There's nothing like a commercial deadline to get a project finished quickly, but there's nothing like a persistently improving open-source project to eventually catch up and surpass...</td> </tr></table><span class="postbody">
<br/>
<br/>
Name one.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
devkitPro</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152135 - elhobbs - Mon Mar 10, 2008 3:30 pm</h4>
    <div class="postbody"><span class="postbody">not to discredit devkitarm or libnds, but I bet it is easier to develop for the DS using the nintendo toolchains and libraries. I will grant persistently improving, but I doubt that they surpass the official toolchains.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152137 - wintermute - Mon Mar 10, 2008 3:54 pm</h4>
    <div class="postbody"><span class="postbody">You've obviously never been a licensed Nintendo developer then :P
<br/>
<br/>
Seriously though, there are some aspects of devkitARM that are easier than the official tools, some places where we have more freedom and a few places that still need a lot of work. We certainly haven't surpassed those tools but we're definitely catching up.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152151 - nczempin - Mon Mar 10, 2008 7:38 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>nczempin wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">There's nothing like a commercial deadline to get a project finished quickly, but there's nothing like a persistently improving open-source project to eventually catch up and surpass...</td> </tr></table><span class="postbody">
<br/>
<br/>
Name one.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
devkitPro</span></td> </tr></table><span class="postbody">
<br/>
<br/>
With a bit of subconscious work, I have come up with a few more:
<br/>
ogg vorbis
<br/>
ext3 (ext4?)
<br/>
firefox
<br/>
netbeans
<br/>
eclipse
<br/>
xvid
<br/>
azureus
<br/>
tex
<br/>
<br/>
<br/>
I haven't seen the official devkits, so I can't really say what they are like. But I've read a post in one of these boards that claimed only one little thing was missing. If that missing piece really is a requirement, then someone will scratch that itch.
<br/>
<br/>
I also find it telling that apparently many commercial developers are willing to shell out for no$gba, when there is an official emulator out. Admittedly, no$gba is not an open-source project.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
