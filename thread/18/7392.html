<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>IRQ issues (was: Which versions of libnds/DevKitArm) - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > IRQ issues (was: Which versions of libnds/DevKitArm)</h2>
<div id="posts">
<div class="post">
    <h4>#59922 - bluescrn - Sat Nov 05, 2005 4:40 pm</h4>
    <div class="postbody"><span class="postbody">I've just reinstalled my dev env, with all the latest everything... Got the samples building, and some running, but can't get the 3D samples (in particular, textured_cube) to run on hardware...
<br/>
<br/>
Now I remember last time I set it up (about 3-4 months ago?) ndslib was a bit broken, and I had to roll back a couple of files from CVS and rebuild my own... but I was expecting that'd be all fixed by now?
<br/>
<br/>
I don't think it's just my install - the textured_cube sample has been confirmed not to work on hardware by another coder.
<br/>
<br/>
(edit - key input problem was swiWaitForVBlank() hanging on emulators)</span><span class="gensmall"><br/><br/>Last edited by bluescrn on Sat Nov 05, 2005 5:16 pm; edited 2 times in total</span></div>    
</div>
<div class="post">
    <h4>#59925 - crudhacker - Sat Nov 05, 2005 5:03 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>bluescrn wrote:</b></span></td> </tr> <tr> <td class="quote">- Key input doesn't seem to work in the emulators (bg_rotation, in both Dualis and iDeaS)</td> </tr></table><span class="postbody">
<br/>
<br/>
DS emulators are still kind of new and have bugs. Its best to run homebrew stuff on the real hardware(DS)<br/>_________________<br/>MKDS friend code-
<br/>
051599-251600
<br/>
PM me so i can add u
<br/>
<br/>
crack this encrypted message-
<br/>
BNSRIAYTNEDCLTFJQEZGNWDXHO
<br/>
key- skip first letter then skip 2,3 till 4 then go back down</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#59926 - bluescrn - Sat Nov 05, 2005 5:14 pm</h4>
    <div class="postbody"><span class="postbody">My problems seem interrupt related...  I'd forgot that swiWaitForVBlank() doesn't work on emulators - I'd previously used this instead:
<br/>
<br/>
#define REG_VCOUNT (*(vu16*)0x4000006)
<br/>
while(REG_VCOUNT!=192);
<br/>
while(REG_VCOUNT==192);
<br/>
<br/>
<br/>
But with the latest libnds, it seems to be the cause of problems with the textured_cube sample *on hardware* - if I remove the swiWaitForVblank(), then it works....</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#59927 - dovoto - Sat Nov 05, 2005 6:14 pm</h4>
    <div class="postbody"><span class="postbody">How are you booting the examples?  Is the nehe example or one of the others?
<br/>
<br/>
All of the nehe work for me on hardware using flashme and a flashcart but I have had one other person complain about the same issue.  If you could give me a bit more detail it would be appreciated.<br/>_________________<br/><a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#59937 - bluescrn - Sat Nov 05, 2005 7:55 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>dovoto wrote:</b></span></td> </tr> <tr> <td class="quote">How are you booting the examples?  Is the nehe example or one of the others?
<br/>
<br/>
All of the nehe work for me on hardware using flashme and a flashcart but I have had one other person complain about the same issue.  If you could give me a bit more detail it would be appreciated.</td> </tr></table><span class="postbody">
<br/>
<br/>
I just tried a random NeHe sample now (Lesson10), and it worked with no modifications.
<br/>
<br/>
I was trying the older samples, in particular the Drunken Coders 'textured_cube', which I knew used to work...   So it doesn't look like there's a real problem, just that that sample might need updating for recent versions of libnds?
<br/>
<br/>
I'm currently using WifiMe to boot the samples</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#59940 - dovoto - Sat Nov 05, 2005 8:08 pm</h4>
    <div class="postbody"><span class="postbody">hmm...i think i will just delete examples covered by nehe code...thanks for that<br/>_________________<br/><a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#59998 - LOst? - Sun Nov 06, 2005 4:32 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>bluescrn wrote:</b></span></td> </tr> <tr> <td class="quote">I've just reinstalled my dev env, with all the latest everything... Got the samples building, and some running, but can't get the 3D samples (in particular, textured_cube) to run on hardware...</td> </tr></table><span class="postbody">
<br/>
<br/>
I have a simular problem. I can only get my 3D app to run on hardware if I keep some code I am not using, and don't try to add anything. once I have changed anything in my code, no matter what it is, I get white screens on the real hardware. Works in emulator though. I wonder what this is all about? I have a version of libnds that dates back to the summer of 2005.
<br/>
<br/>
I just tried "Simple Tri" on my PassMe and Flashcart, and this code (unmodified example) failed to boot and gave me white screens:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include &lt;NDS.h&gt;
<br/>
<br/>
<br/>
int main()
<br/>
{   
<br/>
   
<br/>
   float rotateX = 0.0;
<br/>
   float rotateY = 0.0;
<br/>
<br/>
   powerON(POWER_ALL);
<br/>
<br/>
   //set mode 0, enable BG0 and set it to 3D
<br/>
   videoSetMode(MODE_0_3D);
<br/>
<br/>
   //irqs are nice
<br/>
   irqInitHandler(irqDefaultHandler);
<br/>
   irqSet(IRQ_VBLANK, 0);
<br/>
<br/>
   //this should work the same as the normal gl call
<br/>
   glViewPort(0,0,255,191);
<br/>
   
<br/>
   glClearColor(0,0,0);
<br/>
   glClearDepth(0x7FFF);
<br/>
   
<br/>
   
<br/>
   
<br/>
   while(1)      
<br/>
   {
<br/>
      glReset();
<br/>
   
<br/>
      //any floating point gl call is being converted to fixed prior to being implemented
<br/>
      gluPerspective(35, 256.0 / 192.0, 0.1, 40);
<br/>
<br/>
      gluLookAt(   0.0, 0.0, 1.0,      //camera possition 
<br/>
               0.0, 0.0, 0.0,      //look at
<br/>
               0.0, 1.0, 0.0);      //up
<br/>
<br/>
      glPushMatrix();
<br/>
<br/>
      //move it away from the camera
<br/>
      glTranslate3f32(0, 0, floatof32(-1));
<br/>
            
<br/>
      glRotateX(rotateX);
<br/>
      glRotateY(rotateY);
<br/>
      
<br/>
      
<br/>
      glMatrixMode(GL_MODELVIEW);
<br/>
<br/>
<br/>
<br/>
      //not a real gl function and will likely change
<br/>
      glPolyFmt(POLY_ALPHA(31) | POLY_CULL_NONE);
<br/>
<br/>
      if(!(KEYS &amp; KEY_UP)) rotateX += 3;
<br/>
      if(!(KEYS &amp; KEY_DOWN)) rotateX -= 3;
<br/>
      if(!(KEYS &amp; KEY_LEFT)) rotateY += 3;
<br/>
      if(!(KEYS &amp; KEY_RIGHT)) rotateY -= 3;
<br/>
      
<br/>
<br/>
      //draw the obj
<br/>
      glBegin(GL_TRIANGLE);
<br/>
         
<br/>
         glColor3b(31,0,0);
<br/>
         glVertex3v16(intov16(-1),intov16(-1),0);
<br/>
<br/>
         glColor3b(0,31,0);
<br/>
         glVertex3v16(intov16(1), intov16(-1), 0);
<br/>
<br/>
         glColor3b(0,0,31);
<br/>
         glVertex3v16(intov16(0), intov16(1), 0);
<br/>
         
<br/>
      glEnd();
<br/>
      
<br/>
      glPopMatrix(1);
<br/>
         
<br/>
      glFlush();
<br/>
<br/>
      //swi seems to be broken, will let you know when i get this POS figured out   
<br/>
      //swiWaitForVBlank();
<br/>
   }
<br/>
<br/>
   return 0;
<br/>
}//end main 
<br/>
</td> </tr></table><span class="postbody">
<br/>
This code has worked before. I wonder what my problem is? Any guesses?
<br/>
<br/>
<br/>
EDIT: It sure has nothing to do about the code. I change it all over, and it still won't boot. May be the side of the ROM file, or may have something to do with the Makefile settings. I really don't know. If I remove all OpenGL functions, it boots up correctly, but if I add just one random OpenGL function, GAME OVER!<br/>_________________<br/><span style="font-style: italic">Exceptions are fun</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#60026 - Didou - Sun Nov 06, 2005 11:11 am</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
I experimented asimilar problem in ReboNDS. It appeared to me that I had to replace
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">irqSet(IRQ_VBLANK, 0); </td> </tr></table><span class="postbody">
<br/>
<br/>
by
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void vblank_handler ()
<br/>
{
<br/>
}
<br/>
<br/>
irqInit () ;
<br/>
  irqSet (IRQ_VBLANK, vblank_handler) ;</td> </tr></table><span class="postbody">
<br/>
<br/>
I do not even call </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">irqInitHandler(irqDefaultHandler); </td> </tr></table><span class="postbody">
<br/>
<br/>
And then it works fine. You can grab my sources on my code-page (<a class="postlink" href="http://francois.pessaux.neuf.fr/creations.html" target="_blank">http://francois.pessaux.neuf.fr/creations.html</a>
<br/>
<br/>
-- Didou</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#60033 - LOst? - Sun Nov 06, 2005 3:07 pm</h4>
    <div class="postbody"><span class="postbody">I am downloading devkitARM r17 and the newest libNDS. I might get futher with them, or I may kill all my old projects by updating.
<br/>
<br/>
<br/>
EDIT:
<br/>
Didou, thank you! That solved the problem. At least what I have tested so far. And now I can use swiWaitForVBlank(); while using 3D, which will save battery time. Nice!<br/>_________________<br/><span style="font-style: italic">Exceptions are fun</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#60195 - LOst? - Mon Nov 07, 2005 11:56 pm</h4>
    <div class="postbody"><span class="postbody">Well, I still get white screen as soon as I try to add something. It's so irritating. Even when I delete the added things, I can sometimes get it to work, which already worked before.
<br/>
<br/>
So I guess I have to upload something that doesn't work so that people can analyse it.
<br/>
EDIT: Made a thread about the problem.<br/>_________________<br/><span style="font-style: italic">Exceptions are fun</span></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
