<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Chishm's DLDI loader in PALib [how to] - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Chishm's DLDI loader in PALib [how to]</h2>
<div id="posts">
<div class="post">
    <h4>#141433 - spinal_cord - Tue Sep 25, 2007 12:35 pm</h4>
    <div class="postbody"><span class="postbody">First of all, this way worked for me, I can not guarantee it will work for other people.
<br/>
<br/>
Getting Chishm's DLDI loader to work with PALib.
<br/>
<br/>
1. Copy the load.bin to your Data folder.
<br/>
2. Copy nds_loader_arm9.c and nds_loader_arm9.h to you your source folder.
<br/>
3. Add the following line to your main.c
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include "nds_loader_arm9.h"</td> </tr></table><span class="postbody">
<br/>
4. Navigate to the PALib arm7 folder (C:\devkitPro\PAlib\lib\arm7). Copy nds_loader_arm7.c and nds_loader_arm7.h to C:\devkitPro\PAlib\lib\arm7\
<br/>
5. Add the following line to the main.c
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include "nds_loader_arm7.h"</td> </tr></table><span class="postbody">
<br/>
6. Find the following line,</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void PA_VBL(void)</td> </tr></table><span class="postbody">, and place the collowing line after it.</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">runNdsLoaderCheck();</td> </tr></table><span class="postbody">
<br/>
7. Re-compile PALib by running C:\devkitPro\PAlib\fastbuild.bat
<br/>
8. Back in your project folder, replace the makefile with the following one modified by Jayenkai to handle the load.bin file forrectly.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
PROGNAME = PAlib
<br/>
OFILES   +=
<br/>
ADD_LIBS +=
<br/>
<br/>
PATH       := $(DEVKITARM)/bin:$(PATH)
<br/>
<br/>
ARM7BIN      := -7 $(PAPATH)/lib/arm7/arm7.bin
<br/>
TEXT1       := SPinal's MENU
<br/>
TEXT2       := using PAlib!
<br/>
TEXT3       := spinal.dizidesigns.co.uk
<br/>
ICON       := -b $(CURDIR)/../logo.bmp
<br/>
LOGO      := -o $(CURDIR)/../logo_wifi.bmp
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
.SUFFIXES:
<br/>
#---------------------------------------------------------------------------------
<br/>
ifeq ($(strip $(DEVKITARM)),)
<br/>
$(error "Please set DEVKITARM in your environment. export DEVKITARM=&lt;path to&gt;devkitARM)
<br/>
endif
<br/>
<br/>
<br/>
include $(DEVKITARM)/ds_rules
<br/>
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# TARGET is the name of the output, if this ends with _mb generates a multiboot image
<br/>
# BUILD is the directory where object files &amp; intermediate files will be placed
<br/>
# SOURCES is a list of directories containing source code
<br/>
# INCLUDES is a list of directories containing extra header files
<br/>
#---------------------------------------------------------------------------------
<br/>
TARGET   :=   $(shell basename $(CURDIR))
<br/>
BUILD      :=   build
<br/>
SOURCES   :=   gfx source
<br/>
INCLUDES   :=   include build
<br/>
DATA      :=   data
<br/>
<br/>
EXPORT_DIR := /c/ndsexamples/
<br/>
#---------------------------------------------------------------------------------
<br/>
# ARM7BIN is the path to an arm7 binary other than the default
<br/>
#   usage: ARM7BIN := -7 binaryName.bin
<br/>
#
<br/>
# ICON is the path to an icon to be used int the header plus text
<br/>
#   usage: ICON := -t iconName.bmp "text line one; text line 2; text line 3"
<br/>
# 
<br/>
#---------------------------------------------------------------------------------
<br/>
<br/>
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# options for code generation
<br/>
#---------------------------------------------------------------------------------
<br/>
ARCH   :=   -mthumb-interwork
<br/>
<br/>
# note: arm9tdmi isn't the correct CPU arch, but anything newer and LD
<br/>
# *insists* it has a FPU or VFP, and it won't take no for an answer!
<br/>
CFLAGS   :=   -g  -Wformat=2 -Winline -Wall -O2\
<br/>
<br/>
       -mcpu=arm946e-s -mtune=arm946e-s -fomit-frame-pointer\
<br/>
      -ffast-math \
<br/>
      $(ARCH)
<br/>
<br/>
CFLAGS   +=   $(INCLUDE) -DARM9 -I$(DEVKITPRO)/PAlib/include/nds
<br/>
<br/>
ASFLAGS   :=   -g $(ARCH)
<br/>
LDFLAGS   :=   -g $(ARCH) -mno-fpu -L$(DEVKITPRO)/PAlib/lib
<br/>
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# path to tools - this can be deleted if you set the path in windows
<br/>
#---------------------------------------------------------------------------------
<br/>
# export PATH      :=   /d/dev/ds/devkitARM_r11/bin:/bin
<br/>
 
<br/>
#---------------------------------------------------------------------------------
<br/>
# PATH to ndslib - just make a system variable called NDSLIBPATH and be done with it
<br/>
#---------------------------------------------------------------------------------
<br/>
# NDSLIBPATH   :=   /d/dev/ds/ndslib/
<br/>
 
<br/>
#---------------------------------------------------------------------------------
<br/>
# the prefix on the compiler executables
<br/>
#---------------------------------------------------------------------------------
<br/>
PREFIX         :=   arm-eabi-
<br/>
#---------------------------------------------------------------------------------
<br/>
# any extra libraries we wish to link with the project
<br/>
#---------------------------------------------------------------------------------
<br/>
LIBS   := -lfat -lnds9 -ldswifi9
<br/>
LIBSPA   := -lpa9
<br/>
 
<br/>
 
<br/>
#---------------------------------------------------------------------------------
<br/>
# list of directories containing libraries, this must be the top level containing
<br/>
# include and lib
<br/>
#---------------------------------------------------------------------------------
<br/>
LIBDIRS   :=   $(DEVKITPRO)/libnds
<br/>
LIBDIRPA   :=   $(PAPATH)
<br/>
 
<br/>
 
<br/>
#---------------------------------------------------------------------------------
<br/>
# no real need to edit anything past this point unless you need to add additional
<br/>
# rules for different file extensions
<br/>
#---------------------------------------------------------------------------------
<br/>
ifneq ($(BUILD),$(notdir $(CURDIR)))
<br/>
#---------------------------------------------------------------------------------
<br/>
 
<br/>
export OUTPUT   :=   $(CURDIR)/$(TARGET)
<br/>
 
<br/>
export VPATH   :=   $(foreach dir,$(SOURCES),$(CURDIR)/$(dir)) \
<br/>
               $(foreach dir,$(DATA),$(CURDIR)/$(dir))
<br/>
 
<br/>
export CC      :=   $(PREFIX)gcc
<br/>
export CXX      :=   $(PREFIX)g++
<br/>
export AR      :=   $(PREFIX)ar
<br/>
export OBJCOPY   :=   $(PREFIX)objcopy
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# use CXX for linking C++ projects, CC for standard C
<br/>
#---------------------------------------------------------------------------------
<br/>
export LD      :=   $(CXX)
<br/>
#export LD      :=   $(CC)
<br/>
 
<br/>
<br/>
CFILES      :=   $(foreach dir,$(SOURCES),$(notdir $(wildcard $(dir)/*.c)))
<br/>
CPPFILES   :=   $(foreach dir,$(SOURCES),$(notdir $(wildcard $(dir)/*.cpp)))
<br/>
SFILES      :=   $(foreach dir,$(SOURCES),$(notdir $(wildcard $(dir)/*.s)))
<br/>
PCXFILES   :=   $(foreach dir,$(SOURCES),$(notdir $(wildcard $(dir)/*.pcx)))
<br/>
PALFILES   :=   $(foreach dir,$(SOURCES),$(notdir $(wildcard $(dir)/*.pal)))
<br/>
RAWFILES   :=   $(foreach dir,$(SOURCES),$(notdir $(wildcard $(dir)/*.raw)))
<br/>
MAPFILES   :=   $(foreach dir,$(SOURCES),$(notdir $(wildcard $(dir)/*.map)))
<br/>
JPEGFILES   :=   $(foreach dir,$(SOURCES),$(notdir $(wildcard $(dir)/*.jpg)))
<br/>
MODFILES   :=   $(foreach dir,$(SOURCES),$(notdir $(wildcard $(dir)/*.mod)))
<br/>
GIFFILES   :=   $(foreach dir,$(SOURCES),$(notdir $(wildcard $(dir)/*.gif)))
<br/>
BMPFILES   :=   $(foreach dir,$(SOURCES),$(notdir $(wildcard $(dir)/*.bmp)))
<br/>
BINFILES   :=   $(foreach dir,$(DATA),$(notdir $(wildcard $(dir)/*.*)))
<br/>
<br/>
 
<br/>
export OFILES   :=   $(addsuffix .o,$(BINFILES)) \
<br/>
               $(MAPFILES:.map=.o) $(RAWFILES:.raw=.o) $(PALFILES:.pal=.o) $(PCXFILES:.pcx=.o) $(JPEGFILES:.jpg=.o) $(MODFILES:.mod=.o) $(GIFFILES:.gif=.o) $(BMPFILES:.bmp=.o)\
<br/>
               $(CPPFILES:.cpp=.o) $(CFILES:.c=.o) $(SFILES:.s=.o)
<br/>
 
<br/>
export INCLUDE   :=   $(foreach dir,$(INCLUDES),-I$(CURDIR)/$(dir)) \
<br/>
               $(foreach dir,$(LIBDIRS),-I$(dir)/include) \
<br/>
               $(foreach dir,$(LIBDIRS),-I$(dir)/include/nds) \
<br/>
               -I$(PAPATH)/include/nds\
<br/>
               -I$(CURDIR)/$(BUILD)
<br/>
 
<br/>
export LIBPATHS   :=   $(foreach dir,$(LIBDIRS),-L$(dir)/lib)
<br/>
export LIBPATHPA   :=   $(foreach dir,$(LIBDIRPA),-L$(dir)/lib)
<br/>
 
<br/>
.PHONY: $(BUILD) clean export
<br/>
 
<br/>
#---------------------------------------------------------------------------------
<br/>
$(BUILD):
<br/>
   @[ -d $@ ] || mkdir -p $@
<br/>
   @make --no-print-directory -C $(BUILD) -f $(CURDIR)/Makefile
<br/>
 
<br/>
#---------------------------------------------------------------------------------
<br/>
clean:
<br/>
   @echo clean ...$(TARGET)
<br/>
   @rm -fr $(BUILD) *.elf *.*ds*
<br/>
 
<br/>
export:
<br/>
   @echo exporting ...$(TARGET)
<br/>
   @cp *.nds $(EXPORT_DIR)/$(TARGET).nds
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
else
<br/>
 
<br/>
DEPENDS   :=   $(OFILES:.o=.d)
<br/>
 
<br/>
#---------------------------------------------------------------------------------
<br/>
# main targets
<br/>
#---------------------------------------------------------------------------------
<br/>
$(OUTPUT).ds.gba   :    $(OUTPUT).nds
<br/>
<br/>
$(OUTPUT).nds   :    $(OUTPUT).bin
<br/>
<br/>
$(OUTPUT).bin   :   $(OUTPUT).elf
<br/>
 
<br/>
$(OUTPUT).elf   :   $(OFILES)
<br/>
<br/>
<br/>
 
<br/>
#---------------------------------------------------------------------------------
<br/>
%.ds.gba: %.nds
<br/>
   @echo built ... $(notdir $@)
<br/>
   @dsbuild $&lt; 
<br/>
   @cp $(CURDIR)/../$(notdir $@) ../$(notdir $(OUTPUT)).sc.nds 
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
%.nds: %.bin
<br/>
   
<br/>
   @ndstool -c $@ -9 $(TARGET).bin $(ARM7BIN) $(LOGO) $(ICON) "$(TEXT1);$(TEXT2);$(TEXT3)"
<br/>
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
%.bin: %.elf
<br/>
   
<br/>
   @$(OBJCOPY) -O binary $(TARGET).elf $(TARGET).bin
<br/>
 
<br/>
#---------------------------------------------------------------------------------
<br/>
%.elf:
<br/>
   @echo $(LD)  $(LDFLAGS) -specs=ds_arm9.specs $(OFILES) $(LIBPATHPA) $(LIBSPA) $(LIBPATHS) $(LIBS) -o $(TARGET).elf
<br/>
   @$(LD)  $(LDFLAGS) -specs=ds_arm9.specs $(OFILES) $(LIBPATHPA) $(LIBSPA) $(LIBPATHS) $(LIBS) -o $(TARGET).elf
<br/>
 
<br/>
 
<br/>
 
<br/>
#---------------------------------------------------------------------------------
<br/>
# Compile Targets for C/C++
<br/>
#---------------------------------------------------------------------------------
<br/>
 
<br/>
<br/>
  
<br/>
#---------------------------------------------------------------------------------
<br/>
%.o : %.cpp
<br/>
   @echo $(notdir $&lt;)
<br/>
   @$(CXX) -MM $(CFLAGS) -o $*.d $&lt;
<br/>
   @$(CXX) $(CFLAGS) -c $&lt; -o$@
<br/>
 
<br/>
#---------------------------------------------------------------------------------
<br/>
%.o : %.c
<br/>
   @echo $(notdir $&lt;)
<br/>
   @$(CC) -MM $(CFLAGS) -o $*.d $&lt;
<br/>
   @$(CC)  $(CFLAGS) -c $&lt; -o$@
<br/>
 
<br/>
#---------------------------------------------------------------------------------
<br/>
%.o : %.s
<br/>
   @echo $(notdir $&lt;)
<br/>
   @$(CC) -MM $(CFLAGS) -o $*.d $&lt;
<br/>
   @$(CC)  $(ASFLAGS) -c $&lt; -o$@
<br/>
<br/>
 
<br/>
<br/>
 
<br/>
define bin2o_PA
<br/>
   cp $(&lt;) $(*).tmp
<br/>
   echo -n $$(( `cat $(*).tmp | wc -c` &amp; 3 )) | sed -e 's/0//g' | sed -e 's/1/000/g' | sed -e 's/2/00/g' | sed -e 's/3/0/g' &gt;&gt; $(*).tmp
<br/>
   $(OBJCOPY) -I binary -O elf32-littlearm -B arm \
<br/>
   --rename-section .data=.rodata \
<br/>
   --redefine-sym _binary_$*_tmp_start=$*\
<br/>
   --redefine-sym _binary_$*_tmp_end=$*_end\
<br/>
   --redefine-sym _binary_$*_tmp_size=$*_size\
<br/>
   $(*).tmp $(@)      
<br/>
   echo "extern const u8" $(*)"[];" &gt; $(*).h
<br/>
   echo "extern const u32" $(*)_size[]";" &gt;&gt; $(*).h
<br/>
   rm $(*).tmp
<br/>
endef
<br/>
 
<br/>
#---------------------------------------------------------------------------------
<br/>
%.o   :   %.pcx
<br/>
#---------------------------------------------------------------------------------
<br/>
   @echo $(notdir $&lt;)
<br/>
   @$(bin2o_PA)
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
%.o   :   %.raw
<br/>
#---------------------------------------------------------------------------------
<br/>
   @echo $(notdir $&lt;)
<br/>
   @$(bin2o_PA)
<br/>
 
<br/>
#---------------------------------------------------------------------------------
<br/>
%.bin.o   :   %.bin
<br/>
#---------------------------------------------------------------------------------
<br/>
   @echo $(notdir $&lt;)
<br/>
   @$(bin2o)
<br/>
   #  Jayenkai kicks ass!!!!
<br/>
   #  and Spinal rules! 
<br/>
 
<br/>
#---------------------------------------------------------------------------------
<br/>
%.o   :   %.pal
<br/>
#---------------------------------------------------------------------------------
<br/>
   @echo $(notdir $&lt;)
<br/>
   @$(bin2o_PA)
<br/>
 
<br/>
#---------------------------------------------------------------------------------
<br/>
%.o   :   %.map
<br/>
#---------------------------------------------------------------------------------
<br/>
   @echo $(notdir $&lt;)
<br/>
   @$(bin2o_PA)
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
%.o   :   %.mdl
<br/>
#---------------------------------------------------------------------------------
<br/>
   @echo $(notdir $&lt;)
<br/>
   @$(bin2o_PA)
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
%.o   :   %.jpg
<br/>
#---------------------------------------------------------------------------------
<br/>
   @echo $(notdir $&lt;)
<br/>
   @$(bin2o_PA)
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
%.o   :   %.mod
<br/>
#---------------------------------------------------------------------------------
<br/>
   @echo $(notdir $&lt;)
<br/>
   @$(bin2o_PA)
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
%.o   :   %.gif
<br/>
#---------------------------------------------------------------------------------
<br/>
   @echo $(notdir $&lt;)
<br/>
   @$(bin2o_PA)
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
%.o   :   %.bmp
<br/>
#---------------------------------------------------------------------------------
<br/>
   @echo $(notdir $&lt;)
<br/>
   @$(bin2o_PA)
<br/>
<br/>
 
<br/>
-include $(DEPENDS) 
<br/>
#---------------------------------------------------------------------------------------
<br/>
endif
<br/>
#---------------------------------------------------------------------------------------
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
10. To load a .nds in your code, just use following line.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">runNdsFile ("filename.nds");</td> </tr></table><span class="postbody">
<br/>
<br/>
Hope that helps some people.<br/>_________________<br/>I'm not a boring person, it's just that boring things keep happening to me.
<br/>
<a class="postlink" href="http://spinal.dizidesigns.co.uk/" target="_blank">Homepage</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142197 - tondopie - Sat Oct 06, 2007 1:00 am</h4>
    <div class="postbody"><span class="postbody">I just tried to test it out but...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">Makefile:153: *** missing separator.  Stop.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
EDIT: You must replace the indent spaces with TABs!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142207 - spinal_cord - Sat Oct 06, 2007 2:03 pm</h4>
    <div class="postbody"><span class="postbody">It works fine for me, I copied it directly from the makefile i'm using.<br/>_________________<br/>I'm not a boring person, it's just that boring things keep happening to me.
<br/>
<a class="postlink" href="http://spinal.dizidesigns.co.uk/" target="_blank">Homepage</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142246 - tondopie - Sat Oct 06, 2007 9:12 pm</h4>
    <div class="postbody"><span class="postbody">its still not working for me, I think it might be because I'm not loading from the root...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142827 - calcprogrammer1 - Sun Oct 14, 2007 5:33 am</h4>
    <div class="postbody"><span class="postbody">Compiling gives me this error:
<br/>
<br/>
Makefile(152): *** missing separator.  Stop.
<br/>
<br/>
Around line 152 is this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#---------------------------------------------------------------------------------
<br/>
$(BUILD):
<br/>
   @[ -d $@ ] || mkdir -p $@  //Line 152, gives error
<br/>
   @make --no-print-directory -C $(BUILD) -f $(CURDIR)/Makefile
<br/>
 
<br/>
#---------------------------------------------------------------------------------</td> </tr></table><span class="postbody">
<br/>
<br/>
What am I doing wrong?
<br/>
<br/>
EDIT: found about the tabs thing...but that's a LOT of tabs...
<br/>
<br/>
Why didn't you just post a link to the makefile?  Now I got to replace a LOT of tabs...
<br/>
...
<br/>
...
<br/>
<br/>
Now it gives me
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">make[1]: *** No rule to make target `copy.bmp.o', needed by `/c/devkitPro/Projects/DSFile2/DSFile2/DSFile2.elf'.  Stop.
<br/>
make: *** [build] Error 2</td> </tr></table><span class="postbody"><br/>_________________<br/>DS Firmware 1, Datel Games n' Music card / Chism's FW hacked GBA MP v2 CF
<br/>
<br/>
There's no place like 127.0.0.1.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142833 - spinal_cord - Sun Oct 14, 2007 10:39 am</h4>
    <div class="postbody"><span class="postbody">OK, here is my exact makefile, just remove the .txt extention.
<br/>
<br/>
<a class="postlink" href="http://www.geocities.com/spinal_cord/makefile.txt" target="_blank">http://www.geocities.com/spinal_cord/makefile.txt</a><br/>_________________<br/>I'm not a boring person, it's just that boring things keep happening to me.
<br/>
<a class="postlink" href="http://spinal.dizidesigns.co.uk/" target="_blank">Homepage</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142849 - tondopie - Sun Oct 14, 2007 4:33 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>calcprogrammer1 wrote:</b></span></td> </tr> <tr> <td class="quote">Compiling gives me this error:
<br/>
<br/>
Makefile(152): *** missing separator.  Stop.
<br/>
<br/>
Around line 152 is this:
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#---------------------------------------------------------------------------------
<br/>
$(BUILD):
<br/>
   @[ -d $@ ] || mkdir -p $@  //Line 152, gives error
<br/>
   @make --no-print-directory -C $(BUILD) -f $(CURDIR)/Makefile
<br/>
 
<br/>
#---------------------------------------------------------------------------------</td> </tr></table><span class="postbody">
<br/>
<br/>
What am I doing wrong?
<br/>
<br/>
EDIT: found about the tabs thing...but that's a LOT of tabs...
<br/>
<br/>
Why didn't you just post a link to the makefile?  Now I got to replace a LOT of tabs...
<br/>
...
<br/>
...
<br/>
<br/>
Now it gives me
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">make[1]: *** No rule to make target `copy.bmp.o', needed by `/c/devkitPro/Projects/DSFile2/DSFile2/DSFile2.elf'.  Stop.
<br/>
make: *** [build] Error 2</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
<br/>
in the future just replace 8 spaces with TABs and and put a .bmp before the .o in the makefile for what ever extension you have.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142864 - calcprogrammer1 - Sun Oct 14, 2007 7:12 pm</h4>
    <div class="postbody"><span class="postbody">Finally got DSFile to boot .nds from whatever it's patched for!
<br/>
<br/>
Now, is there a way to append the GBAMP's DLDI patch into the .nds itself?  I'd like to be able to boot from GBAMP using it, but I don't know how you would put the GBAMP's DLDI patch into the .nds and then call it using runNds().  Does anyone have any info on how that would work?<br/>_________________<br/>DS Firmware 1, Datel Games n' Music card / Chism's FW hacked GBA MP v2 CF
<br/>
<br/>
There's no place like 127.0.0.1.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142871 - spinal_cord - Sun Oct 14, 2007 8:19 pm</h4>
    <div class="postbody"><span class="postbody">I thought gbamp didnt need dldi?<br/>_________________<br/>I'm not a boring person, it's just that boring things keep happening to me.
<br/>
<a class="postlink" href="http://spinal.dizidesigns.co.uk/" target="_blank">Homepage</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142873 - calcprogrammer1 - Sun Oct 14, 2007 8:22 pm</h4>
    <div class="postbody"><span class="postbody">Chishm said (and my tests prove) that the loader (not libfat) requires a DLDI patch for every device.  Libfat works without it but the loader needs the DLDI.  I'd eventually like to include DLDI's for all libfat supported devices in the .nds itself, but I have no clue how to do this or if it's even possible.
<br/>
<br/>
It would be really cool if working DLDI's for all devices could be put into one .nds and have a loader that works on any combination of devices...but that'd probably be really hard.<br/>_________________<br/>DS Firmware 1, Datel Games n' Music card / Chism's FW hacked GBA MP v2 CF
<br/>
<br/>
There's no place like 127.0.0.1.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142883 - tondopie - Sun Oct 14, 2007 8:45 pm</h4>
    <div class="postbody"><span class="postbody">if you were just doing GBAMP here, just check with fat if the device in SLot-2 was a GBAMP then use the GBAMP .nds loading method. You can then also use a different method for SC and a different for method for M3. Those are the only cards with known internal loaders.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142887 - calcprogrammer1 - Sun Oct 14, 2007 8:58 pm</h4>
    <div class="postbody"><span class="postbody">How exactly do you check if the device is a GBAMP?  I've wanted to know this but I can't find any information on how to check what device is inserted.<br/>_________________<br/>DS Firmware 1, Datel Games n' Music card / Chism's FW hacked GBA MP v2 CF
<br/>
<br/>
There's no place like 127.0.0.1.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142890 - tondopie - Sun Oct 14, 2007 9:14 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">switch(DiscType())
<br/>
<br/>
   {
<br/>
<br/>
      case 0x4643504D: // gbamp
<br/>
<br/>
      {
<br/>
                   function();
<br/>
                }
<br/>
        }</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
something similar to that. There's a function in libfat to detect the disctype.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142891 - spinal_cord - Sun Oct 14, 2007 9:14 pm</h4>
    <div class="postbody"><span class="postbody">There is a post on the forum already about detecting wich flshcard is being used.
<br/>
<a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=14228&amp;highlight=detecting+flashcart" target="_blank">detecting flashcard</a>
<br/>
<br/>
I used it to use the gbamp loader instead of the dldi one if your using a gbamp. Like this...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
fatInitDefault();
<br/>
struct stat st;
<br/>
stat("/.", &amp;st); 
<br/>
int device_id = st.st_dev;
<br/>
<br/>
if(device_id==1178816589)
<br/>
         {
<br/>
            // Is GBAMP
<br/>
         }
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/>I'm not a boring person, it's just that boring things keep happening to me.
<br/>
<a class="postlink" href="http://spinal.dizidesigns.co.uk/" target="_blank">Homepage</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142896 - calcprogrammer1 - Sun Oct 14, 2007 10:03 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for that code, I wrote a little program to show the device ID of both slots (<a class="postlink" href="http://files.filefront.com/device+idnds/;8798033;/fileinfo.html" target="_blank">download here</a>).  It says:
<br/>
<br/>
Games n' Music is 1179929927
<br/>
GBAMP V2 CF is 1178816589
<br/>
<br/>
How hard is it to implement the GBAMP loader (and the SCCF, M3CF loaders eventually) in PAlib?  I'll try adding support for those later.<br/>_________________<br/>DS Firmware 1, Datel Games n' Music card / Chism's FW hacked GBA MP v2 CF
<br/>
<br/>
There's no place like 127.0.0.1.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142897 - tepples - Sun Oct 14, 2007 10:06 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>calcprogrammer1 wrote:</b></span></td> </tr> <tr> <td class="quote">I wrote a little program to show the device ID of both slots (<a class="postlink" href="http://files.filefront.com/device+idnds/;8798033;/fileinfo.html" target="_blank">download here</a>).  It says:
<br/>
<br/>
Games n' Music is 1179929927
<br/>
GBAMP V2 CF is 1178816589</td> </tr></table><span class="postbody">
<br/>
Convert to hexadecimal notation:
<br/>
GNM is 46544D47
<br/>
GBAMP is 4643504D
<br/>
<br/>
Convert ASCII codes to characters, reading right to left because the GBA CPU is little endian:
<br/>
GNM is "GMTF"
<br/>
GBAMP is "MPCF"<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142900 - spinal_cord - Sun Oct 14, 2007 10:10 pm</h4>
    <div class="postbody"><span class="postbody">our friend tondopie (aka teendev) posted a tut on palib forum.
<br/>
<a class="postlink" href="http://palib.info/forum/modules/newbb/viewtopic.php?topic_id=3515&amp;forum=2" target="_blank">here it is</a>
<br/>
<br/>
basically you use the following instead of the dldi code.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void bootGBAMPnds(void) {      
<br/>
      
<br/>
      REG_EXEMEMCNT &amp;= ~(0x8080);
<br/>
 
<br/>
             
<br/>
 
<br/>
       FILE *handle = fopen("filename.nds", "rb");
<br/>
       if(handle &lt; 0) {
<br/>
          iprintf("\nLoader has failed!\n");
<br/>
       }
<br/>
       //u32 fileCluster = GetFileCluster();
<br/>
<br/>
      struct stat st;
<br/>
      u32 cluster;
<br/>
<br/>
      stat("/filename.nds", &amp;st);
<br/>
<br/>
      cluster = st.st_ino; 
<br/>
       
<br/>
      fclose(handle);
<br/>
 
<br/>
       REG_EXEMEMCNT |= (0x8080);
<br/>
 
<br/>
       REG_IME = IME_DISABLE;   // Disable interrupts
<br/>
       REG_EXEMEMCNT |= (0x8080);  // ARM7 has access to GBA cart
<br/>
       *((vu32*)0x027FFFFC) = cluster;  // Start cluster of NDS to load
<br/>
       *((vu32*)0x027FFE04) = (u32)0xE59FF018;  // ldr pc, 0x027FFE24
<br/>
       *((vu32*)0x027FFE24) = (u32)0x027FFE04;  // Set ARM9 Loop address
<br/>
       swiSoftReset();  // Reset
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
[edit] Any ideas how I can empty as much memory as possible before attempting to load a .nds?<br/>_________________<br/>I'm not a boring person, it's just that boring things keep happening to me.
<br/>
<a class="postlink" href="http://spinal.dizidesigns.co.uk/" target="_blank">Homepage</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142915 - tondopie - Mon Oct 15, 2007 1:10 am</h4>
    <div class="postbody"><span class="postbody">look in the DSO or moonshell source. There are a few files about reseting memory. They use inline ASM for the most part.
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>calcprogrammer1 wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
How hard is it to implement the GBAMP loader (and the SCCF, M3CF loaders eventually) in PAlib?  I'll try adding support for those later.</td> </tr></table><span class="postbody">
<br/>
<br/>
The SCCF and M3CF ones are a little more difficult as you have to unlock RAM and such and transfer the bootstrap to RAM. I'll have those done soon hopefully. I'm disecting them from the DSO source to make them a bit easier to use. Eventually I might just compile a library with all of them.<br/>_________________<br/><span style="font-weight: bold">Development Blog:</span> <a class="postlink" href="http://teendev.org" target="_blank">http://teendev.org</a>
<br/>
<span style="font-weight: bold">Homebrew Podcast:</span> <a class="postlink" href="http://homebrewcast.net" target="_blank">http://homebrewcast.net</a>
<br/>
<span style="font-weight: bold">Web Design:</span> <a class="postlink" href="http://xtendesign.net" target="_blank">http://xtendesign.net</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143187 - calcprogrammer1 - Wed Oct 17, 2007 10:23 pm</h4>
    <div class="postbody"><span class="postbody">That code has bugs...
<br/>
<br/>
REG_EXEMEMCNT is undeclared, but I searched and found that it's actually REG_EXMEMCNT, so changing that seemed to fix it.<br/>_________________<br/>DS Firmware 1, Datel Games n' Music card / Chism's FW hacked GBA MP v2 CF
<br/>
<br/>
There's no place like 127.0.0.1.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143188 - tondopie - Wed Oct 17, 2007 10:38 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>calcprogrammer1 wrote:</b></span></td> </tr> <tr> <td class="quote">That code has bugs...
<br/>
<br/>
REG_EXEMEMCNT is undeclared, but I searched and found that it's actually REG_EXMEMCNT, so changing that seemed to fix it.</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
that is because I was uding libnds 01272007<br/>_________________<br/><span style="font-weight: bold">Development Blog:</span> <a class="postlink" href="http://teendev.org" target="_blank">http://teendev.org</a>
<br/>
<span style="font-weight: bold">Homebrew Podcast:</span> <a class="postlink" href="http://homebrewcast.net" target="_blank">http://homebrewcast.net</a>
<br/>
<span style="font-weight: bold">Web Design:</span> <a class="postlink" href="http://xtendesign.net" target="_blank">http://xtendesign.net</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
