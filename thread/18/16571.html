<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Geometry dissappearing when camera is close - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Geometry dissappearing when camera is close</h2>
<div id="posts">
<div class="post">
    <h4>#167851 - Kath - Tue Mar 31, 2009 5:26 pm</h4>
    <div class="postbody"><span class="postbody">I'm having a problem with quads disappearing when my camera gets close to them. <a class="postlink" href="http://img530.imageshack.us/img530/987/walls.png" target="_blank">This image</a> shows what I mean. On the left the wall quads are displayed, on the right after moving the camera forwards they disappear.
<br/>
<br/>
The quads are drawn directly in their positions (ie. not translated into position). I've tried various near clip plane values (0.1, 0.001) which hasn't helped. At the moment the walls are just one large quad from -4.0 to +4.0. Would it be better to split the wall into smaller polys? I thought the hardware would clip it for you?
<br/>
<br/>
Thanks in advance.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167853 - nanou - Tue Mar 31, 2009 7:09 pm</h4>
    <div class="postbody"><span class="postbody">What are you calling glPolyFmt() with? I think you might need to add POLY_CULL_NONE, or remove POLY_CULL_NEAR... but it's been a while since I've messed around with 3D so I could be way off.<br/>_________________<br/>- nanou</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167854 - Kath - Tue Mar 31, 2009 7:23 pm</h4>
    <div class="postbody"><span class="postbody">The walls are drawn with:
<br/>
<br/>
glPolyFmt( POLY_ID( 1 ) | POLY_ALPHA(31) | POLY_CULL_BACK );
<br/>
<br/>
I've tried POLY_CULL_NONE but it doesn't change anything (apart from drawing back polys).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167861 - nanou - Wed Apr 01, 2009 1:38 am</h4>
    <div class="postbody"><span class="postbody">Right I remember those fields now. I *was* way off.
<br/>
<br/>
GBAtek doesn't mention anything I could find about setting near plane behaviour, but lumps  it in with the rest, saying it does clipping. I haven't bumped into this problem but I'll be interested to know the answer.<br/>_________________<br/>- nanou</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167865 - TwentySeven - Wed Apr 01, 2009 10:42 am</h4>
    <div class="postbody"><span class="postbody">If I was going to call it off the top of my head, I wouldn't blame the raster hardware immediately for a block of geometry disapearing like that.
<br/>
<br/>
Are you absolutely sure thats not a code error?  Perhaps, something to do with your own culling code.
<br/>
<br/>
Also,  if not, paste your camera matrix setup.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167883 - Kath - Wed Apr 01, 2009 11:44 pm</h4>
    <div class="postbody"><span class="postbody">Hi, thanks for the replies so far.
<br/>
<br/>
I'm sure it's my code, somewhere, but I have no idea where or what. I'm not performing any culling at the moment. The camera simply uses gluLookAt() with it's position and lookat vectors with 0,1,0 as up. 
<br/>
<br/>
I semi-finished my particle system today and I noticed that I can move right up to the particles and they don't disappear. I'm going to try and subdivide the wall into a few smaller quads to see if that helps. Is there a limit to the size of a polygon?
<br/>
<br/>
I've uploaded a binary here: <a class="postlink" href="http://www.statusnine.net/uploads/mirror.nds" target="_blank">mirror.nds</a> (Works in no$gba, doesn't need patching.)
<br/>
<br/>
Edit: Camera movement is the dpad, it's a bit sensitive at the moment thinking about it so press lightly :p</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167885 - DiscoStew - Thu Apr 02, 2009 12:13 am</h4>
    <div class="postbody"><span class="postbody">Just by observance, whenever a polygon is to be clipped on the upper boundary of the screen (rather than the sides, or the bottom?), it instead disappears. It seems to happen with all of them except for the ground polygon. I'm not sure why that one disappears.<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167886 - TwentySeven - Thu Apr 02, 2009 12:39 am</h4>
    <div class="postbody"><span class="postbody">oh dear.  Checking the nds.. things are pretty buggered. 
<br/>
<br/>
We'll need source to be able to help any further.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167888 - nanou - Thu Apr 02, 2009 1:25 am</h4>
    <div class="postbody"><span class="postbody">You might want to start with checking whatever 3D settings or geometry you're recalculating every frame. Judging from the behavior of the .nds I'm almost certain it's a problem in there. 
<br/>
<br/>
Some things seem to be shifting on the spot (the columns near the mirror, for example) so maybe your geometry is just dancing around?<br/>_________________<br/>- nanou</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167894 - Kath - Thu Apr 02, 2009 1:02 pm</h4>
    <div class="postbody"><span class="postbody">Aha! 
<br/>
<br/>
I was using glViewport(0,0,255,<span style="font-weight: bold">192</span>); which should have been glViewport(0,0,255,<span style="font-weight: bold">191</span>); Now I've changed it everything appears correctly. Thank you for the observations, they led me back to the gl setup code :)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
