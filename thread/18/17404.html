<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>2d Tiled BG using 3d engine? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > 2d Tiled BG using 3d engine?</h2>
<div id="posts">
<div class="post">
    <h4>#175332 - brave_orakio - Thu Oct 28, 2010 2:18 am</h4>
    <div class="postbody"><span class="postbody">Has anybody done something like this? Something similar to the GBA tiled BG?
<br/>
<br/>
    If we were to emulate the GBA tile BG using 8x8 squares, we would quickly run out of polygons to use. Using 16x16 tiles is more manageable for the hardware. Don't know yet if I would run into problems later on if I started on this.
<br/>
<br/>
    What about you guys? Have you done something like this or is it not worth the effort to do this?<br/>_________________<br/>help me</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175333 - Dwedit - Thu Oct 28, 2010 2:33 am</h4>
    <div class="postbody"><span class="postbody">The GBA-like 2D hardware isn't good enough?<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175334 - brave_orakio - Thu Oct 28, 2010 4:37 am</h4>
    <div class="postbody"><span class="postbody">Not necessarily. But the 3d engine can do stuff the GBA like engine can't. 
<br/>
And also out of curiosity if anybody has tried this before and what the results were for them. 
<br/>
<br/>
I'm going to try to make my level builder be able to output some 3d engine NDS compatible data but I haven't yet decided in what format the design will be, like in 256x256(or slightly bigger) texture data or maybe in 16x16(or even 32x32) tiles and map data or maybe other formats as well.<br/>_________________<br/>help me</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175335 - headspin - Thu Oct 28, 2010 7:25 am</h4>
    <div class="postbody"><span class="postbody">I have done this. Design the levels in <a class="postlink" href="http://www.mapeditor.org/" target="_blank">Tiled</a> and just draw the level using quads. I use TinyXml to read the tmx file format. Here is a basic function for drawing a quad.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void drawQuad(float width, float height, int textureSize, int quadFlags)
<br/>
{
<br/>
    width = (width / 2.0F) + 0.001F;
<br/>
    height = (height / 2.0F) + 0.001F;
<br/>
    
<br/>
    GFX_TEX_COORD = (TEXTURE_PACK(quadFlags &amp; QUADFLAGS_HFLIP ? inttot16(textureSize) : 0, quadFlags &amp; QUADFLAGS_VFLIP ? 0 : inttot16(textureSize)));
<br/>
    glVertex3v16(floattov16(-width), floattov16(-height), 0);
<br/>
<br/>
    GFX_TEX_COORD = (TEXTURE_PACK(quadFlags &amp; QUADFLAGS_HFLIP ? 0 : inttot16(textureSize), quadFlags &amp; QUADFLAGS_VFLIP ? 0 : inttot16(textureSize)));
<br/>
    glVertex3v16(floattov16(width), floattov16(-height), 0);
<br/>
<br/>
    GFX_TEX_COORD = (TEXTURE_PACK(quadFlags &amp; QUADFLAGS_HFLIP ? 0 : inttot16(textureSize), quadFlags &amp; QUADFLAGS_VFLIP ? inttot16(textureSize) : 0));
<br/>
    glVertex3v16(floattov16(width), floattov16(height), 0);
<br/>
<br/>
    GFX_TEX_COORD = (TEXTURE_PACK(quadFlags &amp; QUADFLAGS_HFLIP ? inttot16(textureSize) : 0, quadFlags &amp; QUADFLAGS_VFLIP ? inttot16(textureSize) : 0));
<br/>
    glVertex3v16(floattov16(-width), floattov16(height), 0);
<br/>
}</td> </tr></table><span class="postbody"><br/>_________________<br/><a class="postlink" href="http://headsoft.com.au/index.php?category=warhawk" target="_blank">Warhawk DS</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=mmll" target="_blank">Manic Miner: The Lost Levels</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=tdg" target="_blank">The Detective Game</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175346 - wintermute - Fri Oct 29, 2010 12:40 am</h4>
    <div class="postbody"><span class="postbody">Relminator posted something rather interesting over on the devkitPro forums -&gt; <a href="http://devkitpro.org/viewtopic.php?f=6&amp;t=2215" target="_blank">http://devkitpro.org/viewtopic.php?f=6&amp;t=2215</a><br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175347 - brave_orakio - Fri Oct 29, 2010 2:52 am</h4>
    <div class="postbody"><span class="postbody">headspin, how big are the quads that you use to render the level? The amount of polygons the ds can render if I use smaller quads is always at the back of my mind!
<br/>
<br/>
Thanks for the info wintermute! It looks like reliminator is doing something similar, I should check out the code. Looking forward to the tutorial too!
<br/>
<br/>
edit: Is there any way to actually use multiple textures on a single huge quad? I checked about quads and texturing and it seems that 1 texture data for 1 quad unless we can use an interrupt to keep changing texture data but that seems to be a costly process<br/>_________________<br/>help me</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175352 - elhobbs - Fri Oct 29, 2010 1:46 pm</h4>
    <div class="postbody"><span class="postbody">you can only use a single texture per quad.
<br/>
<br/>
modifying a texture while it is in use is not practical - it would be nearly impossible to do anything useful. even then it would need to occur under very contrained conditions. theoretically, you could modify it during the horizontal blank period. Aside from the very small amount of time in which it could be modified it would be extremely difficult to determine which part to modify.
<br/>
<br/>
there is a z equal polygon attribute (forget what it is called) that can be used to draw the same quad over again with a different texture - for decal type effects. this can be combined with blending or the alpha channel texture formats for some interesting effects - it does cut into the poly limit though.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175366 - brave_orakio - Tue Nov 02, 2010 2:36 am</h4>
    <div class="postbody"><span class="postbody">Yeah, the poly limit is what prevents me from using anything smaller than 16x16. Even then, using 16x16 is still somewhat difficult to implement especially since my level builder was built around 8x8.<br/>_________________<br/>help me</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175367 - relminator - Tue Nov 02, 2010 7:21 am</h4>
    <div class="postbody"><span class="postbody">8x8 tiles for a level builder seems really strange(even with the fact that the DS engine uses 8x8).  It's too small for tiles.
<br/>
<br/>
Even with 8x8 tiles, you're only going to draw 768 tiles for a fullscreen level.  With the 3d engine, you could draw at least 1000 sprites (~1500) and that should be enough.
<br/>
<br/>
Though I would go for 16x16 tiles since it's kinda like the norm for scrolling engines.  Look at the scrolling example I posted.<br/>_________________<br/><a href="http://rel.betterwebber.com" target="_blank">http://rel.betterwebber.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175369 - brave_orakio - Wed Nov 03, 2010 2:03 am</h4>
    <div class="postbody"><span class="postbody">Well my level builder was originally built for the GBA thats why it uses tiles that are 8x8.
<br/>
<br/>
Right now I'm in the planning stage of what size of tiles to use for the DS 3d engine and I think 16x16 seems to be enough for say 2 BGs. It'll take roughly 512 polys if my computation is correct. Even if I have 3 BGs it will stiil be only a little less than 800 quads, which leaves roughly 600 - 700 polys for other things.
<br/>
<br/>
Of course, I'm hoping since its an output for the DS 3d engine, A lttile twaeking with that output and it should hopefully be compatible with other 3d engines like openGL.<br/>_________________<br/>help me</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175370 - relminator - Wed Nov 03, 2010 4:09 am</h4>
    <div class="postbody"><span class="postbody">Yes, the code you'll make should be compatible with any platform supporting OpenGL 1.1.
<br/>
<br/>
Your logic code does not even need to be changed.  It's only the GL based calls that needs abstracting (which isn't very hard to do).
<br/>
<br/>
Here's a Lin/Win renderer I made in another language (easily ported to C/C++).
<br/>
<br/>
<a href="http://imortisoft.no-ip.org/b2b/downloads/gl2d_tute_examples.zip" target="_blank">http://imortisoft.no-ip.org/b2b/downloads/gl2d_tute_examples.zip</a><br/>_________________<br/><a href="http://rel.betterwebber.com" target="_blank">http://rel.betterwebber.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175371 - sgeos - Wed Nov 03, 2010 4:57 pm</h4>
    <div class="postbody"><span class="postbody">Many 3D game levels are made on a grid and textured with old school pixel art.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175375 - Exophase - Thu Nov 04, 2010 10:15 pm</h4>
    <div class="postbody"><span class="postbody">Lots of games do this. For instance the Castlevania games by Konami; also Contra 4, which is awkward since it only applies to the top screen.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175377 - brave_orakio - Fri Nov 05, 2010 2:36 am</h4>
    <div class="postbody"><span class="postbody">Ah I see then it looks like I have the right idea then.
<br/>
<br/>
I thought maybe most would use a big 256x256 (or slightly bigger so the edge wont be seen) quad and just use a similar sized 32-bit or 8- bit image which is costlier in terms of memory(and decompression!).
<br/>
<br/>
A 16x16 tile will allow me to use 4-bit images which are easier to copy directly or decompress.<br/>_________________<br/>help me</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175403 - relminator - Mon Nov 15, 2010 8:34 am</h4>
    <div class="postbody"><span class="postbody">brave_orakio:
<br/>
<br/>
After conversing with zeromus on IRC, I've made my gl2d lib pretty much complete. All it needs is a good documentation and some example files.
<br/>
<br/>
What it can do:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">1. Textures are easy to load (one function call and your set)
<br/>
2. Able to use a spritesheet, tilesheet and/or single images.
<br/>
3. Any bitdepth that is supported by the DS can be used hand in hand ( ie. one sprite can be 16bpp, another can be 8bpp, another can be 4bpp ). Which means you don't have to mess with each sprites' palette  in order to use them hand in hand on a single frame.
<br/>
4. Used palettes are only limited by VRAM E (which is a lot)
<br/>
5. Can use more than 1 256 palette at any one time (Limited by Vram E's size)  The OAM is limited to just 1 256 palette.
<br/>
6. Very fast and a lot easier to use than the OAM.</td> </tr></table><span class="postbody">
<br/>
<br/>
I'll probably release it within this week if I get to do the examples and docs (probably a tutorial to boot).
<br/>
<br/>
* I've just refactored my Space Impakto game to use the lib and it still ran a t full speed with a lot of bullets on screen.<br/>_________________<br/><a href="http://rel.betterwebber.com" target="_blank">http://rel.betterwebber.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175411 - coreyh2 - Tue Nov 16, 2010 2:05 pm</h4>
    <div class="postbody"><span class="postbody">Is it going to have dual screen support like ?Library?<br/>_________________<br/><a class="postlink" href="http://nwvault.ign.com/View.php?view=NWN2ModulesEnglish.Detail&amp;id=245" target="_blank">Deadening 2</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175412 - sverx - Tue Nov 16, 2010 5:34 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>relminator wrote:</b></span></td> </tr> <tr> <td class="quote">5. Can use more than 1 256 palette at any one time (Limited by Vram E's size)  The OAM is limited to just 1 256 palette.</td> </tr></table><span class="postbody">
<br/>
<br/>
You mean OAM is limited to 16 palettes, using extended palettes of course.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175414 - brave_orakio - Wed Nov 17, 2010 5:46 am</h4>
    <div class="postbody"><span class="postbody">relminator:
<br/>
<br/>
Nice! Looking forward to it! 
<br/>
<br/>
Offtopic: I'm curious as to what Impakto means in your native language?<br/>_________________<br/>help me</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175428 - relminator - Fri Nov 19, 2010 6:09 am</h4>
    <div class="postbody"><span class="postbody">Here ya go...
<br/>
<br/>
<a href="http://devkitpro.org/viewtopic.php?f=25&amp;t=2333&amp;p=6177#p6177" target="_blank">http://devkitpro.org/viewtopic.php?f=25&amp;t=2333&amp;p=6177#p6177</a>
<br/>
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>coreyh2 wrote:</b></span></td> </tr> <tr> <td class="quote">Is it going to have dual screen support like ?Library?</td> </tr></table><span class="postbody">
<br/>
<br/>
Not internally but you can use all of libnds's existing calls so anyone can implement the video capture system himself.  I'm not too happy with the FPS reduction and the amount of VRAM usage in dual screen mode.
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sverx wrote:</b></span></td> </tr> <tr> <td class="quote">You mean OAM is limited to 16 palettes, using extended palettes of course.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
16 palettes of 16 color pals as I understand it.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>brave_orakio wrote:</b></span></td> </tr> <tr> <td class="quote">Nice! Looking forward to it!
<br/>
<br/>
Offtopic: I'm curious as to what Impakto means in your native language?
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Devil.  I just named it Space Impakto as a spoof of an old  nokia game.<br/>_________________<br/><a href="http://rel.betterwebber.com" target="_blank">http://rel.betterwebber.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175435 - sverx - Fri Nov 19, 2010 11:24 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>relminator wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sverx wrote:</b></span></td> </tr> <tr> <td class="quote">You mean OAM is limited to 16 palettes, using extended palettes of course.</td> </tr></table><span class="postbody">
<br/>
16 palettes of 16 color pals as I understand it.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
That's standard palette: 1pal x 256col or 16pal x 16col. DS can also display 256 color sprites using one of the 16 extended palettes, allocated to a VRAM bank (bank F or G for the MAIN display, bank I for the SUB display). You can activate it using bit 31 of the DISPCNT register. See <a class="postlink" href="http://nocash.emubase.de/gbatek.htm#dsvideobgmodescontrol" target="_blank">GBATek</a> :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175436 - relminator - Fri Nov 19, 2010 11:47 am</h4>
    <div class="postbody"><span class="postbody">Thanks, that's good to know. Still not as much as you can use with the 3d engine which would be the whole of VRAM F.<br/>_________________<br/><a href="http://rel.betterwebber.com" target="_blank">http://rel.betterwebber.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175437 - sverx - Fri Nov 19, 2010 3:36 pm</h4>
    <div class="postbody"><span class="postbody">And your library looks really promising :) I think I'll have a test on it, sooner or later.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175438 - relminator - Fri Nov 19, 2010 3:45 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sverx wrote:</b></span></td> </tr> <tr> <td class="quote">And your library looks really promising :) I think I'll have a test on it, sooner or later.</td> </tr></table><span class="postbody">
<br/>
<br/>
Thanks!  I really need more people to test it.  So far I am the only one stress testing it.<br/>_________________<br/><a href="http://rel.betterwebber.com" target="_blank">http://rel.betterwebber.com</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
