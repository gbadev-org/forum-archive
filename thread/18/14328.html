<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Problems with memmov - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Problems with memmov</h2>
<div id="posts">
<div class="post">
    <h4>#142922 - racerxdl - Mon Oct 15, 2007 4:25 am</h4>
    <div class="postbody"><span class="postbody">I have some problems with memmove, My Code:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   FILE* test = fopen ("rom.bin", "rb");
<br/>
   iprintf("\nInicializado.");
<br/>
   iprintf("\nDirecionando para 0x020000");
<br/>
   if(memmove(*(volatile int *)0x20F0000, test, 1177005))
<br/>
   {
<br/>
   iprintf("\nDirecionado.");
<br/>
   iprintf("\n\nArm7");
<br/>
   *(volatile int *)0x2900000 = 0xFFFF3210;
<br/>
   }else{ 
<br/>
   iprintf("Erro!!!!!!");
<br/>
   return 1;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
But it frezzes on memmove, I didnt receive the message "Direcionado".
<br/>
<br/>
I made something wrong?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142929 - wintermute - Mon Oct 15, 2007 6:16 am</h4>
    <div class="postbody"><span class="postbody">Try to avoid magic numbers.
<br/>
<br/>
0x02900000 isn't a valid address with the default MPU configuration and 0x20f0000 is fairly likely to be somewhere in the middle of libfat data, if not in your program itself. 
<br/>
<br/>
What is it you're trying to do?<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142974 - racerxdl - Mon Oct 15, 2007 7:47 pm</h4>
    <div class="postbody"><span class="postbody">I Trying to load the file and put the arm7 to execute it (the file its a rom made for arm7), but the libfat doesnt say the address of the opened file.
<br/>
<br/>
Its there another way to load a file and get arm7 to execute it?
<br/>
<br/>
My arm7 code:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include &lt;nds.h&gt;
<br/>
#include &lt;stdlib.h&gt;
<br/>
void reboot() {
<br/>
    irqDisable(IRQ_ALL);
<br/>
    *(vu32*)0x27FFE34 = 0x020F0000;
<br/>
    swiSoftReset();
<br/>
}
<br/>
int main() {
<br/>
while (*(volatile int *)0x2900000 != 0xFFFF3210);
<br/>
reboot();
<br/>
return 0;
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142977 - DragonMinded - Mon Oct 15, 2007 8:03 pm</h4>
    <div class="postbody"><span class="postbody">Look at chishm's launcher code.  It does just what you are asking about.<br/>_________________<br/>Enter the mind of the dragon.
<br/>
<br/>
<a href="http://dragonminded.blogspot.com" target="_blank">http://dragonminded.blogspot.com</a>
<br/>
<br/>
Seriously guys, how hard is it to simply TRY something yourself?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142985 - kusma - Mon Oct 15, 2007 9:32 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>racerxdl wrote:</b></span></td> </tr> <tr> <td class="quote">but the libfat doesnt say the address of the opened file.</td> </tr></table><span class="postbody">
<br/>
What do you mean "address of the opened file"? fopen() doesn't load the entire file into RAM, it provides you with a handle for use with fread(), which loads data from disk to RAM.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142994 - Rajveer - Mon Oct 15, 2007 11:05 pm</h4>
    <div class="postbody"><span class="postbody">This is my file loading function:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
FILE *file_Pointer; //Pointer to an opened file
<br/>
long file_Length; //Variable to store length of opened file
<br/>
<br/>
char* load_File(char* file_Location)
<br/>
{
<br/>
   //Open file location inputted, check if exists
<br/>
   file_Pointer = fopen(file_Location, "rb")
<br/>
<br/>
   //Find length of file
<br/>
   fseek(file_Pointer, 0L, SEEK_END);
<br/>
   file_Length = ftell(file_Pointer);
<br/>
   rewind(file_Pointer);
<br/>
<br/>
   //Create space for file storage in RAM, read into RAM and close filestream
<br/>
   char *mem = malloc(file_Length + 1);
<br/>
   fread(mem, file_Length, 1, file_Pointer);
<br/>
   
<br/>
   fclose(file_Pointer);
<br/>
   
<br/>
   return mem;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
The location of the file in RAM is mem, which is returned by the function into a character variable.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
