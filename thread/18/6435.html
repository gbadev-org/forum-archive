<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>redrawing the screen - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > redrawing the screen</h2>
<div id="posts">
<div class="post">
    <h4>#49396 - Sephiroth87 - Fri Jul 29, 2005 11:47 am</h4>
    <div class="postbody"><span class="postbody">hi there!
<br/>
i need to write a function that redraw the main screen 50 times per seconds, and while doing this, store the line being currently redrawn in somewhere, and this value need to be used in real time by another function...
<br/>
<br/>
i thought to do that by putting the first on the amr7 cpu, and the second on the arm9 one, but i've no idea on where to start from...
<br/>
<br/>
maybye smbdy could help me a little :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49397 - Mr Snowflake - Fri Jul 29, 2005 11:56 am</h4>
    <div class="postbody"><span class="postbody">You can't draw 50 frames per second, the hardware won't let you. It'll only display 60fps. You still can write 50fps to the framebuffer, but this won't be to good. And I believe there is a Vblank and an Hblank, so using the Hblank you can keep the currently redrawn line.
<br/>
In the main memory you can maloc some space for keeping the vars between both cpu's.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49398 - Sephiroth87 - Fri Jul 29, 2005 12:05 pm</h4>
    <div class="postbody"><span class="postbody">so i can't slow down my prog?
<br/>
<br/>
however, if i use the hblank, doens't it stops the execution until is over?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49399 - Mr Snowflake - Fri Jul 29, 2005 12:41 pm</h4>
    <div class="postbody"><span class="postbody">You can slow it down, but animations would look rather strange, with some frames, being the same as the previous. 
<br/>
AFAIK the hblank is an interupt, so if you use it, it'll hold the execution of the currently executed code and run the hblank control code.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49411 - Sephiroth87 - Fri Jul 29, 2005 4:02 pm</h4>
    <div class="postbody"><span class="postbody">but i need not to stop the code during the refresh...
<br/>
<br/>
the situation is:
<br/>
i'm trying to write a c64 emu...
<br/>
it has a refresh rate of 50fps, and a registry that holds the line currently drawn...
<br/>
so i have to refresh the screen and keep the emulation movin on...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49416 - tepples - Fri Jul 29, 2005 5:16 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Sephiroth87 wrote:</b></span></td> </tr> <tr> <td class="quote">i'm trying to write a c64 emu...
<br/>
it has a refresh rate of 50fps</td> </tr></table><span class="postbody">
<br/>
Commodore 64 units sold in the United States, Canada, Japan, and other NTSC regions have a 60 Hz refresh rate. Get the NTSC version working, and <span style="font-style: italic">then</span> get the European version working.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49419 - Mr Snowflake - Fri Jul 29, 2005 5:33 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Sephiroth87 wrote:</b></span></td> </tr> <tr> <td class="quote">i'm trying to write a c64 emu...
<br/>
</td> </tr></table><span class="postbody">
<br/>
Where did you find al the nescessary info? I've been searching a lot and didn't find..</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49451 - Sephiroth87 - Fri Jul 29, 2005 8:01 pm</h4>
    <div class="postbody"><span class="postbody">now that you note that, reading again docs, you are right, but, the problem doesn't change a lot in my opinion, i still don't see a solution...
<br/>
<br/>
howewer, i've tons of original old books of the c64, "almost" all the info that i need (and google is my second best friend xD)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49453 - sajiimori - Fri Jul 29, 2005 8:25 pm</h4>
    <div class="postbody"><span class="postbody">Don't worry about making it run full-speed right away.  Get it working, then think about timing later.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49454 - Sephiroth87 - Fri Jul 29, 2005 9:04 pm</h4>
    <div class="postbody"><span class="postbody">sigh, that doesn't help me a lot xD</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49461 - sajiimori - Fri Jul 29, 2005 10:34 pm</h4>
    <div class="postbody"><span class="postbody">I'm just saying that you may be getting ahead of yourself with this stuff about using both CPUs and monitoring scanlines and whatnot.  Just switch to bitmap mode and emulate in a plain manner to start, and think about fancy stuff later.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49465 - Sephiroth87 - Fri Jul 29, 2005 10:55 pm</h4>
    <div class="postbody"><span class="postbody">yeah, it's my intention, but without emulating this interrupt, kernal won't run...
<br/>
<br/>
so no emulation...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49532 - Sephiroth87 - Sat Jul 30, 2005 10:54 pm</h4>
    <div class="postbody"><span class="postbody">i've tried this thing...
<br/>
first i set up the interrupt handler...
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void InitInterruptHandler()
<br/>
{
<br/>
  IME = 0;
<br/>
  IRQ_HANDLER = on_irq;
<br/>
  IE = IRQ_HBLANK;
<br/>
  IF = ~0;
<br/>
  DISP_SR = DISP_HBLANK_IRQ;
<br/>
  IME = 1;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
to the hblank interrupts...
<br/>
then, i've put this...
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void on_irq() 
<br/>
{   
<br/>
  if(IF &amp; IRQ_HBLANK) {
<br/>
     for(i=0; i&lt;SCREEN_WIDTH*SCREEN_HEIGHT; i++)
<br/>
    {
<br/>
   videoBuffer[i]=color;
<br/>
   line=i/SCREEN_HEIGHT;
<br/>
    }
<br/>
    color++;
<br/>
    VBLANK_INTR_WAIT_FLAGS |= IRQ_HBLANK;
<br/>
    IF |= IRQ_HBLANK;
<br/>
  }
<br/>
  else {
<br/>
    IF = IF;
<br/>
  }
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
(it's not actually the emu code, just a little try...)
<br/>
<br/>
will this works? hblank occours 60 times a second?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49554 - tepples - Sun Jul 31, 2005 2:30 am</h4>
    <div class="postbody"><span class="postbody">Vblank occurs 60 times a second. Hblank occurs on every scanline.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49555 - sajiimori - Sun Jul 31, 2005 4:02 am</h4>
    <div class="postbody"><span class="postbody">I suggest emulating the interrupt in software until you get the hang of it.  That is, do not use DS interrupts to emulate C64 interrupts.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49563 - Sephiroth87 - Sun Jul 31, 2005 9:05 am</h4>
    <div class="postbody"><span class="postbody">ok, but i don't see any software way to run 2 routines toghether, cause refreshing the screen must be done while the emulating process is running...
<br/>
now i don't care of perfect timing and 60fps, but i'd like to see at least the mighty blue interface :P
<br/>
<br/>
edit: if i put the code in the vblank interrupt instead of the hblank, wont it works?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49585 - sajiimori - Sun Jul 31, 2005 6:46 pm</h4>
    <div class="postbody"><span class="postbody">When emulating, things that would be literally simultaneous on real hardware might be sequential on the emulator.  You don't literally have to refresh the screen and emulate the CPU at the same time.  You could pause CPU emulation after a certain number of cycles (emulated cycles, not DS ones), then run the refresh stuff, then resume the CPU.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
