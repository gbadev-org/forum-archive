<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>No ARM7 breakpoint instruction? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > No ARM7 breakpoint instruction?</h2>
<div id="posts">
<div class="post">
    <h4>#154189 - simonjhall - Sat Apr 12, 2008 7:09 pm</h4>
    <div class="postbody"><span class="postbody">I'm extending my debugger (again) in order for it to work on the ARM7, as well as the ARM9.
<br/>
<br/>
However, reading through the instruction set manual for the ARM7TDMI there doesn't seem to be a 'bkpt' instruction, like there is on the ARM9. Does anyone know the preferred way of getting the CPU into abort mode or whatever it takes to get the handler at 0x380FFDC to fire? I know I CAN get the handler to execute, I just want to know how you're meant to be doing it!<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#154197 - Dwedit - Sat Apr 12, 2008 8:03 pm</h4>
    <div class="postbody"><span class="postbody">NO$GBA uses mov r11,r11 into the breakpoint instruction.
<br/>
If you're not an emulator, then anything goes for triggering a breakpoint.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#154204 - silent_code - Sat Apr 12, 2008 9:48 pm</h4>
    <div class="postbody"><span class="postbody">i am sure simon is *NOT* an emulator! ;^p</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#154206 - simonjhall - Sat Apr 12, 2008 9:59 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>silent_code wrote:</b></span></td> </tr> <tr> <td class="quote">i am sure simon is *NOT* an emulator! ;^p</td> </tr></table><span class="postbody">THAT DOES NOT COMPUTE.<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#154207 - silent_code - Sat Apr 12, 2008 10:06 pm</h4>
    <div class="postbody"><span class="postbody">&lt;OT&gt;what is meaning of words "THAT DOES NOT COMPUTE."?  !(understand human information transmission). need: reloading speeeech module. short on memory.... please wait...
<br/>
<br/>
FATAL ERROR: Program terminated and returned status -3Î›07.
<br/>
<br/>
<br/>
did you develop a debugger that get's compiled into the rom? like a memory leak debugger or something? i'm quite interested on what ppl are doing in that area. my own (memory) "debugging" code is quite simple, it's really just the usual redefinition of new and delete etc.
<br/>
<br/>
... [moved to offtopic]
<br/>
<br/>
sorry for being totally offtopic. my head is going insane today! &lt;/OT&gt;
<br/>
<br/>
ps: i really don't understand your expression, but i'd like to. ;^)
<br/>
<br/>
<br/>
EDIT: thanks! actually, that's funny! :^)
<br/>
ah, now i remember - the wifi debugger! sorry, that i'm not much of a help.
<br/>
also, thanks for the response. i was thinking about testing the code with VS, but i hate switching habbits (for obvious reasons, i might add) as much as i hate switching compilers. going away from my long term favorite ide very recently was a pain (although c::b is really cool!) - moving back to VS (used it in the old 6.0 days) so short after that would mean total system shutdown. ;^)
<br/>
i was hoping i could get some hints that went in another direction. never mind.
<br/>
i guess i'll have this post moved into a more general (coding) section and try it there.</span><span class="gensmall"><br/><br/>Last edited by silent_code on Sat Apr 12, 2008 11:26 pm; edited 2 times in total</span></div>    
</div>
<div class="post">
    <h4>#154213 - simonjhall - Sat Apr 12, 2008 10:38 pm</h4>
    <div class="postbody"><span class="postbody">Haha!
<br/>
I'm actually shocked that there's a wikipedia page on this: <a href="http://en.wikipedia.org/wiki/Does_not_compute" target="_blank">http://en.wikipedia.org/wiki/Does_not_compute</a>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Does not compute, and variations on it, was a phrase often spoken by computers, robots and other artificial intelligences in science fiction works of the 1960s to 1980s. The phrase indicated cognitive dissonance on the part of the device, conventionally leading to its self-destruction.</td> </tr></table><span class="postbody">and</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">It was then popularised in Lost In Space (1965), along with "Affirmative!", "Warning! Warning!" and, of course, "Danger, Will Robinson!"</td> </tr></table><span class="postbody">
<br/>
Anyway with your problem I have no idea. Sounds like an MT problem to me! If you think it's compiler/toolchain related, you could always try recompiling with Visual Studio instead?
<br/>
<br/>
Back on-topic :-)
<br/>
Having an anything-goes way of forcing an abort seems a bit of a crap design - what did the designers of the chip expect people to do when debugging their code? Undefined instructions? Data aborts?
<br/>
I'm rewriting the DS-side of the wireless debugger I wrote back in '06 to support all the things I never got round to doing and I'm happy-ish with the ARM9 side; I'm just expanding it to support ARM7. Should be a lot harder to do as it's gonna need some IPC just to do printf!
<br/>
<br/>
One thing I don't like with the existing thing I've written though is that there doesn't seem to be a good way of capturing the machine state upon an abort. Since the link register and stack pointer are banked (as we're in abort mode) you've got to return to user mode to recapture these. But then once you're in user mode you can't get back into abort mode (to handle the event) without abort-ing again (as user mode is unprivileged).
<br/>
<br/>
I really hate ARM assembler.<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#154218 - Dwedit - Sat Apr 12, 2008 11:20 pm</h4>
    <div class="postbody"><span class="postbody">Forget that user mode exists, and go straight to system mode.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#154219 - simonjhall - Sat Apr 12, 2008 11:22 pm</h4>
    <div class="postbody"><span class="postbody">Is that the mode that your average program runs in?<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#154221 - Cydrak - Sat Apr 12, 2008 11:57 pm</h4>
    <div class="postbody"><span class="postbody">FIQ, Aborts, and Undefined all lead to the same BIOS trap and to 0x380FFDC, right?
<br/>
<br/>
ARM's manual explicitly calls out Undef as a way to add "extra" instructions (or emulation of missing ones). So if you want a breakpoint, that would seem to be the sanctioned one. How were you doing it? Is there even a way to trigger real aborts on the ARM7 side?
<br/>
<br/>
There are two ways around the banking, actually. First is to switch modes--that's what System (0x1F) is for, it's privileged but it shares the User (0x10) bank. Or rather, you could say they're both un-banked.
<br/>
<br/>
The other is LDM/STM Rn, {...}^ (no writeback, and no R15). ARM has this to say:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">... the User bank registers are transferred rather than the register bank corresponding to the current mode. This is useful for saving the user state on process switches. Base write-back should not be used ... [and] ... care must be taken not to read from a banked register during the following cycle ... .</td> </tr></table><span class="postbody">
<br/>
In fact I'm not sure the BIOS (nor devkitARM) even use User mode. Don't they leave you in System anyway? That would make privilege a non-issue.
<br/>
<br/>
That's if I understand all this, of course. Still, I love my ARM; the only fun thing about x86 is all that SIMD stuff, if you ask me. :&gt;</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
