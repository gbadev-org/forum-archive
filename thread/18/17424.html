<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Test mesh normals - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Test mesh normals</h2>
<div id="posts">
<div class="post">
    <h4>#175523 - Scribe - Mon Dec 13, 2010 1:11 am</h4>
    <div class="postbody"><span class="postbody">Hi guys,
<br/>
<br/>
I've just written for the most part an FBX to DS friendly CallList file converter, however, my normals are all a mess, I'm using a simple cube for my first test with normals that line up with a plane (so one component is always 1), I've confirmed that they are being converted to the v10 format correctly but I'm getting about half a face out of my entire cube showing, there's no issue if I turn my normals off, any ideas?
<br/>
<br/>
call list code:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
            // Write Tex-Coord
<br/>
            meshFile-&gt;Write( (UInt32)TEXTURE_PACK(floatToFixed164( vertex.GetAt( 0 ) ), floatToFixed164( vertex.GetAt( 1 ) )) );
<br/>
            // Write vertex
<br/>
            meshFile-&gt;Write( (UInt32)VERTEX_PACK(floatToFixed3212( vertex.GetAt( 0 ) ), floatToFixed3212( vertex.GetAt( 1 ) )) );
<br/>
            meshFile-&gt;Write( (UInt32)VERTEX_PACK(floatToFixed3212( vertex.GetAt( 2 ) ), 0) );
<br/>
            // Write Normal
<br/>
            meshFile-&gt;Write( (UInt32)NORMAL_PACK(floatToFixed1010( normal.GetAt( 0 ) ), floatToFixed1010( normal.GetAt( 1 ) ), 
<br/>
               floatToFixed1010( normal.GetAt( 2 ) )) );
<br/>
<br/>
            // Write next command pack
<br/>
            if( mesh-&gt;GetPolygonCount()*3 - i &gt; 1 )
<br/>
            {
<br/>
               meshFile-&gt;Write( (UInt32)FIFO_COMMAND_PACK( FIFO_TEX_COORD, FIFO_VERTEX16, FIFO_NORMAL, FIFO_NOP ) );
<br/>
//..................
<br/>
   // Floating-point to fixed point 10-bit (10-bit fractional) convertion
<br/>
   private: fbxShort1 floatToFixed1010( fbxDouble1 floatingPoint )
<br/>
   {
<br/>
      const static fbxInteger1 factor = 1 &lt;&lt; 9;
<br/>
<br/>
      if( floatingPoint &gt; 0.998 )
<br/>
      {
<br/>
         return (fbxShort1)0x1FF;
<br/>
      }
<br/>
      else
<br/>
      {
<br/>
         return static_cast&lt;fbxShort1&gt;(floatingPoint*factor);
<br/>
      }
<br/>
   }
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
I greatly appreciate any help.
<br/>
Many thanks[/code]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175531 - Rexhunter99 - Wed Dec 15, 2010 10:47 am</h4>
    <div class="postbody"><span class="postbody">My first post! :D and the first reply to the topic!
<br/>
<br/>
Hi Scribe, now I'm still learning the libNDS library, but I think I can try and offer a hand of help here.  I just made my own model testing application in Win32 and OpenGL so I can make sure my models are working and correct before I slap them into my game project for the DS and cry when it doesn't work for some seemingly random reason.
<br/>
<br/>
Okay as for your code, not sure what syntax it is but it looks like you are mistreating the NORMAL_PACK macro.  NORMAL_PACK packs three v10 variables (normals, x,y,z) into a single 32-bit variable, off the top of my head it only uses 30 bits and ignores the last 2... don't quote me though.
<br/>
<br/>
So basically to use NORMAL_PACK, you have to convert your floating-point normal co-ords to the v10 format using the macro floattov10() and then pump the three resulting short integers into the NORMAL_PACK macro.  This is how I did it in 3dsMax 2010's maxscript.
<br/>
<br/>
Also this sounds like it could be a DS-issue with the call-list, since I don't know ALL the details I won't assume anything yet.
<br/>
This is also why I ignore the call-list feature, I prefer pumping the raw data in via glNormal,glTexCoord,glColor and glVertex :)<br/>_________________<br/><a class="postlink" href="http://crocfanforum.forumotion.com/programming-f7/croc-ds-he-s-back-t28.htm" target="_blank"></a><a href="http://img411.imageshack.us/img411/4229/dscroclife2.gif">[Images not permitted - Click here to view it]</a> - Move over Mario... Cruise by Crash... Croc Rocks!</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
