<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>file to memory - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > file to memory</h2>
<div id="posts">
<div class="post">
    <h4>#163850 - hacker013 - Mon Oct 13, 2008 7:30 pm</h4>
    <div class="postbody"><span class="postbody">hey everybody,
<br/>
<br/>
How do I read a File to memory and that it located memory if i not give a pointer to an existing located memory? A code example please.
<br/>
<br/>
gr,
<br/>
<br/>
hacker013<br/>_________________<br/><a class="postlink" href="http://imetal.nl/" target="_blank">Website / Blog</a>
<br/>
<br/>
Let the nds be with you.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163852 - tepples - Mon Oct 13, 2008 8:00 pm</h4>
    <div class="postbody"><span class="postbody">Is the size of the file (in bytes) known in advance?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163855 - hacker013 - Mon Oct 13, 2008 8:55 pm</h4>
    <div class="postbody"><span class="postbody">no<br/>_________________<br/><a class="postlink" href="http://imetal.nl/" target="_blank">Website / Blog</a>
<br/>
<br/>
Let the nds be with you.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163857 - Lazy1 - Mon Oct 13, 2008 9:24 pm</h4>
    <div class="postbody"><span class="postbody">You can get the file size by calling <a class="postlink" href="http://linux.die.net/man/2/stat" target="_blank">stat()</a> and checking the st_size member of the stat struct you passed.
<br/>
<br/>
Example:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include &lt;sys/stat.h&gt;
<br/>
<br/>
void Blah( void ) {
<br/>
   struct stat st;
<br/>
<br/>
   if ( stat( "your_file_name", &amp;st ) == 0 ) {
<br/>
      // st.st_size contains the file size in bytes
<br/>
      // Do stuff here
<br/>
   }
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Once you have your file size you can allocate the required memory using malloc() and read it in using fopen(), fread(), ect...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163858 - elhobbs - Mon Oct 13, 2008 9:27 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">FILE* pFile;
<br/>
unsigned char *file_data;
<br/>
size_t file_size;
<br/>
<br/>
//open the file 
<br/>
pFile = fopen(file_name,"rb");
<br/>
if(pFile == 0)
<br/>
{
<br/>
   //unable to open file
<br/>
   //do something
<br/>
}
<br/>
   
<br/>
//find the file length
<br/>
fseek (pFile, 0, SEEK_END);
<br/>
file_size = ftell(pFile);
<br/>
<br/>
//alocate a buffer to hold the data
<br/>
file_data = (unsigned char *) malloc (file_size);
<br/>
<br/>
//reset the file position
<br/>
fseek (pFile, 0, SEEK_SET);
<br/>
<br/>
//read the data into the buffer
<br/>
fread (file_data, 1, file_size, pFile);
<br/>
<br/>
//close the file
<br/>
fclose (pFile);
<br/>
</td> </tr></table><span class="postbody">here is some code to read a file into a dynamically allocated buffer. you will probably want to add some error checking code...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163871 - Lazy1 - Tue Oct 14, 2008 3:37 am</h4>
    <div class="postbody"><span class="postbody">You don't need to seek to the end of the file to get the length though, you can call fstat which is the same as stat() but works on an already opened file handle.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
