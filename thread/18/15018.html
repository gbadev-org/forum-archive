<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>looping sound? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > looping sound?</h2>
<div id="posts">
<div class="post">
    <h4>#150858 - iprice - Wed Feb 13, 2008 6:40 pm</h4>
    <div class="postbody"><span class="postbody">The example in devkit does not let you loop the sound. How can you call arm9 code to set channel 0 to repeating? I have tried a function in arm7 and an extern call from arm9........
<br/>
<br/>
I want a certain tune to loop but other samples not to. As I call the looping tune first I assume it will always use channel 0.
<br/>
<br/>
Any suggestions?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#150861 - silent_code - Wed Feb 13, 2008 8:01 pm</h4>
    <div class="postbody"><span class="postbody">have you checked gbatek?
<br/>
<a class="postlink" href="http://nocash.emubase.de/gbatek.htm" target="_blank">http://nocash.emubase.de/gbatek.htm</a>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">40004x0h - NDS7 - SOUNDxCNT - Sound Channel X Control Register (R/W)
<br/>
...
<br/>
Bit27-28  Repeat Mode  (0=Manual, 1=Loop Infinite, 2=One-Shot, 3=Prohibited)</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#150863 - Dwedit - Wed Feb 13, 2008 8:04 pm</h4>
    <div class="postbody"><span class="postbody">What is the difference between 0=manual and 2=one shot?<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#150864 - iprice - Wed Feb 13, 2008 8:15 pm</h4>
    <div class="postbody"><span class="postbody">How do I access ARM7 code from ARM9?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#150866 - tepples - Wed Feb 13, 2008 8:35 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>iprice wrote:</b></span></td> </tr> <tr> <td class="quote">How do I access ARM7 code from ARM9?</td> </tr></table><span class="postbody">
<br/>
You write an ARM9 program, you write an ARM7 program, and you have the ARM9 program tell the ARM7 program what to do.
<br/>
<br/>
As far as I can tell, if you use the ARM9 template, you don't get much if any control of looping. You could use the combined template and change the sound code.
<br/>
<br/>
<br/>
EDIT: finish an incomplete sentence<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"><br/><br/>Last edited by tepples on Thu Feb 14, 2008 3:11 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#150867 - DekuTree64 - Wed Feb 13, 2008 8:45 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dwedit wrote:</b></span></td> </tr> <tr> <td class="quote">What is the difference between 0=manual and 2=one shot?</td> </tr></table><span class="postbody">
<br/>
One-shot stops after the length you specify. Manual just plays forever until it goes off the end of memory and probably crashes the system, like the GBA sound DMA.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>iprice wrote:</b></span></td> </tr> <tr> <td class="quote">How do I access ARM7 code from ARM9?</td> </tr></table><span class="postbody">
<br/>
Usually communication is done using shared memory or the IPC FIFO registers (I wrote a nice system for this which you can get from <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=13430" target="_blank">this post</a>). For looping sounds, you do need something more than the libnds play sound function, because you need some way to stop it later. Granted, that could be as simple as a "stop all sounds" function if you're only changing music on level transitions or something.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#150868 - silent_code - Wed Feb 13, 2008 8:49 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">How do I access ARM7 code from ARM9?
<br/>
</td> </tr></table><span class="postbody">
<br/>
i haven't done it, yet, but there's a inter-processor communication fifo. that's the way to go, iirc.
<br/>
<br/>
there's one or two sound libs around the forum, check out how they do it (sources or mail the author.)
<br/>
<br/>
about the difference between manual and one-shot... dunno. ;^p you've got to try it out!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#150888 - iprice - Thu Feb 14, 2008 11:22 am</h4>
    <div class="postbody"><span class="postbody">Is there a way of starting a sound with arm9 code but having extra parameters such as looping and/or channel select?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#150905 - Dwedit - Thu Feb 14, 2008 6:08 pm</h4>
    <div class="postbody"><span class="postbody">You can't loop sound if you are using the default ARM7 binary.  The default ARM7 binary is garbage.
<br/>
You can see the source code to the default ARM7 binary in "C:\devkitPro\examples\nds\templates\combined\arm7".  Note that it ORs "sound_one_shot" onto anything you pass in, and only tries to play sounds at the beginning of vblank.
<br/>
<br/>
I suggest you switch your project to build both ARM7 and ARM9 binaries.  Then I recommend you use <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?p=132370#132370" target="_blank">DekuTree64's IPC library</a>, which works great for me.
<br/>
<br/>
I'll edit this post with a quick "How To" for the IPC library.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
