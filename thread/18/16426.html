<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Loading gfx from FAT, source code or tutorial?[solved] - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Loading gfx from FAT, source code or tutorial?[solved]</h2>
<div id="posts">
<div class="post">
    <h4>#166493 - Emmanuel - Sun Feb 08, 2009 9:31 pm</h4>
    <div class="postbody"><span class="postbody">Can someone post some code here loading a grit gfx from FAT? I'm TOTALLY clueless how to do it myself... the libnds example just shows the directory structure... any tutorial would also be welcome... I don't even know how I should make my directory structure to work properly...</span><span class="gensmall"><br/><br/>Last edited by Emmanuel on Tue Feb 10, 2009 1:39 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#166497 - ChronoDK - Sun Feb 08, 2009 10:23 pm</h4>
    <div class="postbody"><span class="postbody">Maybe this will help you get started. This is how I load sprites from FAT. I'm sure someone is able to write better and faster code - and if so, please show us :)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   //The sprite and palette memory addresses
<br/>
   u16* spritePalMain = &amp;SPRITE_PALETTE[m_palIndex * 16];
<br/>
   u16* spriteMemMain = &amp;SPRITE_GFX[m_tileIndex * 16];
<br/>
<br/>
   //Read sprite palette file to memory
<br/>
   infile.open( ("/coolsprite.pal.bin").c_str(), std::ifstream::binary );
<br/>
   for (int i = 0; i &lt; 16; i++) {
<br/>
      u16 x = 0;
<br/>
      infile.read((char*)&amp;x, 2);
<br/>
      spritePalMain[i] = x;
<br/>
   }
<br/>
   infile.close();
<br/>
   infile.clear();
<br/>
   
<br/>
   //Read sprite data from file to sprite memory
<br/>
   infile.open( ("/coolsprite.img.bin").c_str(), std::ifstream::binary );
<br/>
   infile.seekg(0, std::ifstream::end);
<br/>
   long size = infile.tellg();
<br/>
   infile.seekg(0);
<br/>
    for (int i = 0; i &lt; size/2; i++) {
<br/>
      u16 x = 0;
<br/>
      infile.read((char*)&amp;x, 2);
<br/>
      spriteMemMain[i] = x;
<br/>
   }
<br/>
   infile.close();
<br/>
   infile.clear();
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#166524 - Emmanuel - Mon Feb 09, 2009 11:40 am</h4>
    <div class="postbody"><span class="postbody">I stilll don't get how opening a file lets the program know it's variables...
<br/>
for example:
<br/>
I include
<br/>
#include "title_up.h"
<br/>
<br/>
and in the code I:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">dmaCopyHalfWords(DMA_CHANNEL,
<br/>
                     title_upBitmap, /* This variable is generated for us by
<br/>
                                       * grit. */
<br/>
                     (uint8 *)BG_BMP_RAM_SUB(0), /* Our address for main
<br/>
                                               * background 3 */
<br/>
                     title_upBitmapLen); /* This length (in bytes) is generated
<br/>
                                           * from grit. */</td> </tr></table><span class="postbody">
<br/>
<br/>
How does reading from fat tells the program those variables:
<br/>
title_upBitmap and title_upBitmapLen
<br/>
<br/>
please help, I don't want to use PAlib due to something that is so basic...
<br/>
<br/>
which includes will I need? can someone post more source? like perhaps a full source file that loads gfx from FAT? and generates a working .nds... which file type should I have grit export into?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#166535 - elhobbs - Mon Feb 09, 2009 2:23 pm</h4>
    <div class="postbody"><span class="postbody">that is because it doesn't. ChronoDK posted code that shows reading from a file. your example is for using grit or a similiar application that preprocesses the graphic file and embeds it in the nds file as data - the header file is generated by the tool.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#166556 - ChronoDK - Mon Feb 09, 2009 6:29 pm</h4>
    <div class="postbody"><span class="postbody">I can give you more code. These are just snippets taken out - some includes and hardware init functions are missing, but inserting it into your own project should be doable. Just place the files you want to load at the root of your flashcart. The ones I'm using below are 8-bit bitmaps converted with grit.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include &lt;fat&gt;
<br/>
#include &lt;fstream&gt;
<br/>
<br/>
   fatInitDefault()
<br/>
<br/>
   videoSetMode( MODE_5_2D | DISPLAY_BG2_ACTIVE | DISPLAY_SPR_ACTIVE | DISPLAY_SPR_1D );
<br/>
   vramSetBankA(VRAM_A_MAIN_BG);
<br/>
   vramSetBankB(VRAM_B_MAIN_BG);
<br/>
<br/>
   //File path
<br/>
   std::string path = "/";
<br/>
<br/>
   //Main BG2
<br/>
   int bg2 = bgInit(2, BgType_Bmp8, BgSize_B8_512x512, 0, 0);
<br/>
   bgSetPriority(bg2, 1 );
<br/>
   REG_BG2PA = 1 &lt;&lt; 8; REG_BG2PB = 0; REG_BG2PC = 0; REG_BG2PD = 1 &lt;&lt; 8; REG_BG2X = 0; REG_BG2Y = 0; 
<br/>
<br/>
   //Read BG2 palette file to memory
<br/>
   std::ifstream infile( (path + "my512x512bitmap.pal.bin").c_str(), std::ifstream::binary );
<br/>
   u16 color = 0;
<br/>
   for (int i = 0; i &lt; 256; i++) {
<br/>
      infile.read((char*)&amp;color, 2);
<br/>
      BG_PALETTE[i] = color;
<br/>
   }
<br/>
   infile.close();
<br/>
   infile.clear();
<br/>
<br/>
   //Read 8-bit 512x512 256 color bitmap from file
<br/>
   u16* buffer = (u16*)bgGetGfxPtr( bg2 );
<br/>
   infile.open( (path + "my512x512bitmap.img.bin").c_str(), std::ifstream::binary );
<br/>
   for(int iy = 0; iy &lt; 512; iy++) {
<br/>
      for(int ix = 0; ix &lt; 512 / 2; ix++) {
<br/>
         u16 x = 0;
<br/>
         infile.read((char*)&amp;x, 2);
<br/>
         buffer[ix + iy * 256] = x;
<br/>
      }
<br/>
   }
<br/>
   infile.close();
<br/>
   infile.clear();
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#166580 - Emmanuel - Tue Feb 10, 2009 1:39 pm</h4>
    <div class="postbody"><span class="postbody">Thanks, now I got it</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
