<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>ARM7 has little memory? [SOLVED] - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > ARM7 has little memory? [SOLVED]</h2>
<div id="posts">
<div class="post">
    <h4>#46482 - strager - Sat Jun 25, 2005 9:49 pm</h4>
    <div class="postbody"><span class="postbody"><span style="font-weight: bold">Origional post</span>:
<br/>
I am writing an emulator for the DS (surprise, surprise), and I am having a problem.  It has been stumping me for the past few days, so I've decided that posting here would be my last resort.  Here't goes:
<br/>
<br/>
Since the ARM7 has some extra memory the ARM9 does not have (I don't want to go into the *TCM), I decided that it should take charge of memory.  However, this isn't going too well.  The problem occurs when I have about 8 Kilobytes of memory allocated to an array (static or dynamic), the linker complains about not enough memory in .iwram and piles up errors about overlapping sections.  I've tried numberous things, such as forcing it to specific sections with the result of the linker refusing to think that there are such sections (.ewram, .sbss), and editing the lnkscript (risky, and didn't work).
<br/>
<br/>
Thanks in advance for the help.
<br/>
<br/>
<span style="font-weight: bold">Edit 1</span>: [Half-way] solved, thanks to gladius.  How I got it half-way fixed:
<br/>
Changed "iwram" to "ewram" in the .rodata section of the lnkscript.
<br/>
The problem was caused by my constant array (512KB) that had slipped my mind.  It was being put in iwram where it could not fit.
<br/>
<br/>
<span style="font-weight: bold">Edit 2</span>: It links OK, but now it bloats my binary.  I have no clue why this would happen, other than the raw data appearing first, then padding to fill the rest of the memory (- mirrors?), then the actual data.  It resulted in a ~24MB file, or ~0x01800000.  0x0200000 + 0x01800000 = 0x03800000, or the end of EXRAM.  I wonder why this occurs.  If anyone has knowledge of lnkscript syntax and can fix this, please, help me out.
<br/>
<br/>
<span style="font-weight: bold">Edit 3</span>: I have confirmed that this is the case (read Edit 2).
<br/>
<br/>
<span style="font-weight: bold">Edit 4</span>: This should have been in Edit 3; I have found out that the lnkscript in fact wants to load the code into EXRAM.  I had thought it always went into main RAM.  I need to know how I could move the text section over to the main RAM with my .rodata.  Replacing iwram with ewram does not work this time.
<br/>
<br/>
<span style="font-weight: bold">Edit 5</span>: DOH!  I had no idea that main RAM was shared by both CPUs.  This spoils my plan. :(  No matter, I'll just stash everything in the ARM9.
<br/>
<br/>
<span style="font-style: italic"><span style="font-weight: bold">This problem has been solved.</span></span></span><span class="gensmall"><br/><br/>Last edited by strager on Sun Jun 26, 2005 3:07 pm; edited 5 times in total</span></div>    
</div>
<div class="post">
    <h4>#46489 - IxthusTiger - Sun Jun 26, 2005 2:43 am</h4>
    <div class="postbody"><span class="postbody">for emulating on the DS or for emulating the DS?
<br/>
<br/>
If the former, and if you don't mind that I ask, what are you emulating?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46490 - strager - Sun Jun 26, 2005 3:19 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>IxthusTiger wrote:</b></span></td> </tr> <tr> <td class="quote">for emulating on the DS or for emulating the DS?
<br/>
<br/>
If the former, and if you don't mind that I ask, what are you emulating?</td> </tr></table><span class="postbody">
<br/>
<br/>
1) On.
<br/>
2) None of your business. :P
<br/>
3) There is no #6.
<br/>
<br/>
And yes, your post was really helpful to my problem.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
