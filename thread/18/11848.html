<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>fatlib linking problems (devkitPro 19b) - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > fatlib linking problems (devkitPro 19b)</h2>
<div id="posts">
<div class="post">
    <h4>#110935 - gho - Sun Dec 03, 2006 1:19 am</h4>
    <div class="postbody"><span class="postbody">Hi there ,
<br/>
<br/>
I am trying to get started with nds programming and thought that messing with fat access would be a good idea, for most of the better apps write to a media.
<br/>
<br/>
Unfortunately the latest version of devkitPro + fatlib does not work for me in the following special case:
<br/>
<br/>
If I try to compile a source which contains something like
<br/>
<br/>
fatInit(4, true)
<br/>
<br/>
I get the following error messages:
<br/>
<br/>
&gt; "make" 
<br/>
linking test.elf
<br/>
d:/devkitPro/libnds/lib\libfat.a(io_njsd.o): In function `_NJSD_init':
<br/>
e:/projects/devkitPro/libfat/nds/../source/disc_io/io_njsd.c:127: undefined reference to `irqDisable'
<br/>
d:/devkitPro/libnds/lib\libfat.a(io_njsd.o): In function `_NJSD_readSectors':
<br/>
e:/projects/devkitPro/libfat/nds/../source/disc_io/io_njsd.c:487: undefined reference to `cardPolledTransfer'
<br/>
e:/projects/devkitPro/libfat/nds/../source/disc_io/io_njsd.c:500: undefined reference to `cardPolledTransfer'
<br/>
e:/projects/devkitPro/libfat/nds/../source/disc_io/io_njsd.c:513: undefined reference to `cardPolledTransfer'
<br/>
e:/projects/devkitPro/libfat/nds/../source/disc_io/io_njsd.c:490: undefined reference to `cardPolledTransfer'
<br/>
e:/projects/devkitPro/libfat/nds/../source/disc_io/io_njsd.c:521: undefined reference to `cardPolledTransfer'
<br/>
d:/devkitPro/libnds/lib\libfat.a(io_njsd.o):e:/projects/devkitPro/libfat/nds/../source/disc_io/io_njsd.c:524: more undefined references to `cardPolledTransfer' follow
<br/>
d:/devkitPro/libnds/lib\libfat.a(io_nmmc.o): In function `_Neo_SelectMMC':
<br/>
e:/projects/devkitPro/libfat/nds/../source/disc_io/io_nmmc.c:106: undefined reference to `cardWriteCommand'
<br/>
collect2: ld returned 1 exit status
<br/>
make[1]: *** [/d/Projects/test/test.elf] Error 1
<br/>
"make": *** [build] Error 2
<br/>
<br/>
I downloaded the current cvs code and compiled the library myself after commenting out the broken directory stuff 
<br/>
<br/>
(dir_iter_t* _FAT_diropen_r(...), etc.) 
<br/>
<br/>
and changing some things in io_njsd.c, e.g. line 487 
<br/>
<br/>
(cardPolledTransfer (0xA1406000, tmp, BYTES_PER_READ, (u8*) _NJSD_read_cmd);) 
<br/>
<br/>
which might have been the cause for that undefined reference thing.
<br/>
<br/>
I compiled the library and replaced the default libfat.a and fat.h budled with devkitPro, but when trying to compile the fatinit() test program I got the same error messages from the compiler again. 
<br/>
<br/>
What is striking: My installation directory is not
<br/>
<br/>
e:/projects/devkitPro
<br/>
<br/>
but
<br/>
<br/>
d:/devkitpro
<br/>
<br/>
I am brand new to all that and certainly not a professional programmer, and have no clue what's going on here, or even if this is the right forum, but others might run into this problem as well, so I thought it would be a good  idea to share.
<br/>
<br/>
Thanks for your time.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110938 - Puyo - Sun Dec 03, 2006 1:46 am</h4>
    <div class="postbody"><span class="postbody">Hi. The problem is that you probably added libfat after libnds in your makefile. Change that and "make clean - make" the project. No need to recompile the whole library.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110941 - gho - Sun Dec 03, 2006 2:15 am</h4>
    <div class="postbody"><span class="postbody">Wow, thanks Puyo! That made my night!
<br/>
<br/>
Just tried the character read/write test - code from "chishm's libfat thread" with supercard lite micro sd. Works like a charm with the current CVS source.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
