<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>glLight AND vertex color at once ? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > glLight AND vertex color at once ?</h2>
<div id="posts">
<div class="post">
    <h4>#101985 - ikaris - Sat Sep 09, 2006 2:56 pm</h4>
    <div class="postbody"><span class="postbody">I have a display list that I created using my Maya exporter.
<br/>
<br/>
When I view the model with NO glLight in the scene, and my PolyFmt like this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">glPolyFmt(POLY_ALPHA(31) | POLY_CULL_NONE);</td> </tr></table><span class="postbody">
<br/>
<br/>
I can see all of my vertex color on the model.  Every vertex can be a different color if I like.
<br/>
<br/>
However, as soon as I add add a light:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">glPolyFmt(POLY_ALPHA(31) | POLY_CULL_NONE | POLY_FORMAT_LIGHT0);
<br/>
glLight(0, RGB15(31,31,31) , floattov10(0.67), floattov10(-0.75), floattov10(1.0));</td> </tr></table><span class="postbody">
<br/>
<br/>
All I can see is my model in shades of black and white, not multiplying or adding with the vertex color !
<br/>
<br/>
Is there a way to choose how the vertex color will be blended with the glLight ?
<br/>
<br/>
Thanks !</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102004 - sajiimori - Sat Sep 09, 2006 7:30 pm</h4>
    <div class="postbody"><span class="postbody">No, the DS can't do it, unless someone has a hack of some kind.  Turn off all lights while rendering vertex colored models.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102022 - Lick - Sat Sep 09, 2006 10:43 pm</h4>
    <div class="postbody"><span class="postbody">You need to set up a material. I can't garantee that it will work.
<br/>
<br/>
For unique colors on each vertex, I have no idea.<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102028 - sajiimori - Sat Sep 09, 2006 11:21 pm</h4>
    <div class="postbody"><span class="postbody">Are you making things up, Lick?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102030 - ikaris - Sat Sep 09, 2006 11:35 pm</h4>
    <div class="postbody"><span class="postbody">I have a material, thats no problem... i can make the WHOLE object a given color with the material.
<br/>
<br/>
But I wanted something per vertex...
<br/>
<br/>
I can live without it tho, unless someone comes up with something brilliant !</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102033 - Lick - Sun Sep 10, 2006 12:37 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">Are you making things up, Lick?</td> </tr></table><span class="postbody">
<br/>
<br/>
Nope. Coming from a Direct3D background, I simply figured that OpenGL (even the DS version) probably used a similar method to display lit objects, that is, using materials that react on lights.
<br/>
This tutorial explains it (D3D) <a class="postlink" href="http://www.two-kings.de/tutorials/dxgraphics/dxgraphics06.html" target="_blank">http://www.two-kings.de/tutorials/dxgraphics/dxgraphics06.html</a> (Scroll all the way down, it will have a short snippet of code that sets up the material.)
<br/>
<br/>
As it seems from the reply above, this is indeed how it works. But like I said, I have no idea how to do per-vertex color combined with light. Only per-object. I thought I made that clear in my previous post, though.<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102041 - DekuTree64 - Sun Sep 10, 2006 4:18 am</h4>
    <div class="postbody"><span class="postbody">You may be able to do it by changing the material diffuse color per-vertex. I've never actually tried it though.
<br/>
<br/>
As I understand it, the vertex normal command is what does all the lighting calculations, and comes up with a final vertex color which is then stored to an internal register.
<br/>
The vertex color command is basically to set that register directly, if you want to do precalculated lighting, or custom software lighting calculations (this might actually be the best way to go, although you'd be modifying the display list, so the 'original' colors would have to be stored elsewhere. Not to mention the normals).<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102046 - sajiimori - Sun Sep 10, 2006 5:07 am</h4>
    <div class="postbody"><span class="postbody">Yeah, modifying vertex colors on the fly -- essentially doing lighting in software -- is probably the best/only way on DS.
<br/>
<br/>
Can material changes be embedded in a display list?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102063 - Sausage Boy - Sun Sep 10, 2006 12:11 pm</h4>
    <div class="postbody"><span class="postbody">I'd think so. GBATEK has a <a class="postlink" href="http://nocash.emubase.de/gbatek.htm#ds3diomap" target="_blank">list of geometry commands</a>. Libnds doesn't let you use all of them in display lists though (probably for a good reason), there's a list somewhere around the middle of videoGL.h.<br/>_________________<br/>"no offense, but this is the gayest game ever"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#103366 - silent_code - Thu Sep 21, 2006 10:46 am</h4>
    <div class="postbody"><span class="postbody">normally in openGL, when you're doing lighting your glColor settings get overwritten, but it is possible to keep that color with another state (have to look it up) so you end up having your favorite vertex colors lit by colored lighting ;)
<br/>
<br/>
but on the nds it depends on if that state is available or not. if it wasn't you prbably are better off doing your own lighting or using textures.
<br/>
<br/>
i found it: if you have enabled GL_LIGHTING, enable GL_COLOR_MATERIAL and your glColor will be modulated by the light color and the diffuse texture.
<br/>
<br/>
hope that makes things clear.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#103373 - ikaris - Thu Sep 21, 2006 12:48 pm</h4>
    <div class="postbody"><span class="postbody">Where do you enable it ?
<br/>
<br/>
When I look up GL_LIGHTING in videoGL.h, I get this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define GL_LIGHTING    1   // no idea what this is for / who defined it</td> </tr></table><span class="postbody">
<br/>
<br/>
Not the most confidence-inspiring comment :)
<br/>
<br/>
I also can't find GL_COLOR_LIGHTING in videoGL.h, nor can I find it in the NDSLib reference
<br/>
<br/>
<a class="postlink" href="http://www.drunkencoders.com/documents/DS/ndslib.htm" target="_blank">http://www.drunkencoders.com/documents/DS/ndslib.htm</a>
<br/>
<br/>
(Although there are a lot of things missing from it anyway)
<br/>
<br/>
Can you post some sample code as to how one would activate the feature ?
<br/>
<br/>
Thanks !</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#103383 - PypeBros - Thu Sep 21, 2006 2:17 pm</h4>
    <div class="postbody"><span class="postbody">i'd be starting from dovoto's NDS NeHe Lesson 07 (found on drunkencoders) if i had to work this out ... keeping the code, but using a glColor() instead of glTextureBind().<br/>_________________<br/><a class="postlink" href="http://sylvainhb.blogspot.com/p/sprite-editor.html" target="_blank"> SEDS: Sprite Edition on DS</a> :: <a class="postlink" href="http://sylvainhb.blogspot.com/search/label/modplayer" target="_blank">modplayer</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#103392 - Lick - Thu Sep 21, 2006 3:28 pm</h4>
    <div class="postbody"><span class="postbody">I'm guessing that either the 3D component of libnds is lacking (a lot!) or that the DS simply doesn't have this feature. Which would be awful.<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#103398 - silent_code - Thu Sep 21, 2006 4:08 pm</h4>
    <div class="postbody"><span class="postbody">note: this is *real* PC OpenGL code:
<br/>
<br/>
glEnable(GL_LIGHTING);
<br/>
glEnable(GL_COLOR_MATERIAL);
<br/>
<br/>
...
<br/>
<br/>
same goes for glDisable(...);
<br/>
<br/>
also note, that you should not mixup ndslib and libnds. afaik ndslib is outdated and discontinued.
<br/>
<br/>
i neither know if libnds supports GL_COLOR_MATERIAL (NOT GL_COLOR_-&gt;LIGHTING&lt;- !!!) nor do i know if it has some equivalent. best thing to do would be to kindly ask dovoto or the other guys that developed and maintain libnds about such a feature.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#134806 - route66 - Tue Jul 17, 2007 1:57 am</h4>
    <div class="postbody"><span class="postbody">GL_COLOR_MATERIAL is not defined.  Is this supported by the NDS?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#134809 - relpats_eht - Tue Jul 17, 2007 3:58 am</h4>
    <div class="postbody"><span class="postbody">Please don't revive year old topics.
<br/>
<br/>
Yes, using glMaterial.<br/>_________________<br/>- relpats_eht</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#134914 - a128 - Wed Jul 18, 2007 8:25 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>silent_code wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<br/>
i found it: if you have enabled GL_LIGHTING, enable GL_COLOR_MATERIAL and your glColor will be modulated by the light color and the diffuse texture.
<br/>
<br/>
hope that makes things clear.</td> </tr></table><span class="postbody">
<br/>
<br/>
Yout must enable Bit15
<br/>
<br/>
40004C0h - Cmd 30h - DIF_AMB - MaterialColor0 - Diffuse/Ambient Reflect. (W)
<br/>
....
<br/>
15    Set Vertex Color (0=No, 1=Set Diffuse Reflection Color as Vertex Color)
<br/>
<br/>
do do that</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157755 - Synthetic - Wed May 28, 2008 11:40 pm</h4>
    <div class="postbody"><span class="postbody">Does anyone have a sample of working code with bit15 &amp; textures?  I'm trying to do something similar, and I've managed to get it working with just vertex colors and lighting, but when I try to add texture coordinates the lighting becomes uniform regardless of normals.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
