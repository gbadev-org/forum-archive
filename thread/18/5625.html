<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>What is the DS's memory hierarchy? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > What is the DS's memory hierarchy?</h2>
<div id="posts">
<div class="post">
    <h4>#41767 - rize - Sun May 01, 2005 7:56 pm</h4>
    <div class="postbody"><span class="postbody">I'm pretty sure I read that the ARM9 has a 16K Instruction and 16K data cache.  What about the ARM7?  I also thought I remembered reading that there is a L2 cache shared by the two, but maybe that's crazy talk.  It's got 4MB of main memory right?
<br/>
<br/>
I checked the tech docs at bottledlight and didn't see the info in any obvious place.
<br/>
<br/>
Also, does anyone know anything about the prefetching hardware?  Does it have any?  Can the software (via the compiler optimization or via explicit compiler hints) suggest a prefetch?
<br/>
<br/>
How would it handle the fetching of a 1KB static sized array (say a look up table or buffer of fixed size)?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#41774 - DekuTree64 - Sun May 01, 2005 9:01 pm</h4>
    <div class="postbody"><span class="postbody">You can prefetch things into the cache with the pld insruction (same as ldr, but doesn't actually load, and always takes 1 cycle), but that only loads one cache line, which is 32 bytes. According to <a class="postlink" href="http://www.arm.com/pdfs/DDI0155A_946ES.pdf" target="_blank">http://www.arm.com/pdfs/DDI0155A_946ES.pdf</a> section 3.4, you can lock down portions of the cache to keep data there, which could be used to prefetch 32 bytes at a time and lock them. It seems to have some strange requirements though, like running the program from non-cachable memory. The protection unit controls which regions are cachable.
<br/>
<br/>
Anyway, it would be easier to just have a 'cache' area in DTCM to copy larger chunks of temporary data into.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#41801 - rize - Mon May 02, 2005 12:23 am</h4>
    <div class="postbody"><span class="postbody">Thanks.  Sounds complex (which isn't unexpected).
<br/>
<br/>
I'll bookmark this and try it if I'm having performance problems with this array.
<br/>
<br/>
I'd still like to know the size of all the caches and whether or not there is an L2 if anyone knows.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#41830 - DekuTree64 - Mon May 02, 2005 7:44 am</h4>
    <div class="postbody"><span class="postbody">You can ask the ARM9 how big its caches and TCM are. Check the CP15 section of that doc.
<br/>
<br/>
Do be careful when using the cache though, it doesn't mix well with direct hardware access. Like, if you fiddle with some data, and then DMA it somewhere, it may still be in the cache. DMA only sees the 'real' memory, so it will copy the data from BEFORE you fiddled with it. To fix that, you need to flush the data out of the cache before doing a DMA on it. 
<br/>
<br/>
And of course, enabling cache on VRAM or IO registers is pretty much asking for crazy problems with things not showing up :)<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#41883 - mike260 - Mon May 02, 2005 7:38 pm</h4>
    <div class="postbody"><span class="postbody">Has anyone tried putting the stack into DCTM?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#41898 - rize - Mon May 02, 2005 10:07 pm</h4>
    <div class="postbody"><span class="postbody">Well, I at least wanted to be aware of the cache sizes even if I didn't try to do anything intentionally with them.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
