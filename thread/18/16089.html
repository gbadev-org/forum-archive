<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Timers, keysDownRepeat and keysDown questions [solved] - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Timers, keysDownRepeat and keysDown questions [solved]</h2>
<div id="posts">
<div class="post">
    <h4>#163293 - dsbeginner - Sun Sep 28, 2008 10:54 pm</h4>
    <div class="postbody"><span class="postbody">Hi everyone,
<br/>
<br/>
I have my DSL since a while and only recently found out about homebrew. I was intrigued right away and finally got around to fiddle with it myself.
<br/>
<br/>
Now that I've played with some code and tested it in iDeaS, there are a few things that aren't quite working as I expected them to. Ok, so my C++ skills are rather limited and rusty at best, and I obviously have to get my head around libnds first. I searched the forum, finding a lot of cool and smart stuff, but none that helped me with my problems. Maybe someone could point out to me what I'm doing wrong?
<br/>
<ol type="1">
<br/>
<li> How do you set up a timer, using just libnds functions? I thought it should work with </li></ol></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">irqSet(IRQ_TIMER0, on_irq);</td> </tr></table><span class="postbody"> but that doesn't seem to do anything for me. However </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">IRQ_HANDLER = on_irq;</td> </tr></table><span class="postbody"> does the job perfectly. So while my timer does work as expected, writing to the memory directly feels odd.
<br/>
<br/>
<li> </li></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">keysDown() &amp; KEY_L</td> </tr></table><span class="postbody"> doesn't trigger in my code. Ever. No matter how I press the L button. It only seems to work with keysHeld(). </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">keysDown() &amp; KEY_A</td> </tr></table><span class="postbody"> in the same place works as expected. So it's not about the code around it, just the key, it seems.
<br/>
<br/>
<li> </li></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">keysDownRepeat() &amp; KEY_UP</td> </tr></table><span class="postbody"> works fine. But I can't get any of the other D-pad diretions to work with keysDownRepeat(), only with keysDown().
<br/>
<br/>
Thanks for reading, I hope someone can help me out.
<br/>
<br/>
</span><span class="gensmall"><br/><br/>Last edited by dsbeginner on Mon Sep 29, 2008 6:22 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#163294 - mml - Sun Sep 28, 2008 11:13 pm</h4>
    <div class="postbody"><span class="postbody">Assuming you're doing all your input processing once per frame, then you need to also call scanKeys() exactly once per frame in order to use keysDown()/keysUp()/keysHeld().  
<br/>
<br/>
keysDown, keysUp and keysHeld will reset next time scanKeys is called, so you should not call scanKeys again until you have processed all the input you cared about, because otherwise you will miss keysDown and keysUp events.  keysHeld feels more persistant since it will continue returning the same data over and over again as long as the same keys are held.
<br/>
<br/>
I haven't touched timers at all, but the usual way of setting up an interrupt handler requires irqInit(), irqSet() and irqEnable().  Have a look at those functions and it should get you going.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163295 - dsbeginner - Sun Sep 28, 2008 11:46 pm</h4>
    <div class="postbody"><span class="postbody">Hey, thanks for your response (and so quick).
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>mml wrote:</b></span></td> </tr> <tr> <td class="quote">Assuming you're doing all your input processing once per frame, then you need to also call scanKeys() exactly once per frame in order to use keysDown()/keysUp()/keysHeld().  
<br/>
<br/>
keysDown, keysUp and keysHeld will reset next time scanKeys is called, so you should not call scanKeys again until you have processed all the input you cared about, because otherwise you will miss keysDown and keysUp events.  keysHeld feels more persistant since it will continue returning the same data over and over again as long as the same keys are held.</td> </tr></table><span class="postbody">
<br/>
<br/>
That's what I'm doing... I hope. Simplified:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
keysSetRepeat(60, 60);
<br/>
while(1) {
<br/>
   scanKeys();
<br/>
   if (keysDownRepeat() &amp; KEY_UP) { ... }
<br/>
   if (keysDownRepeat() &amp; KEY_DOWN) { ... }
<br/>
   if (keysDown() &amp; KEY_A) { ... }
<br/>
   if (keysDown() &amp; KEY_L){ ... }
<br/>
   swiWaitForVBlank();
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
KEY_UP works fine, KEY_DOWN not. KEY_A works, KEY_L not. Beats me :(
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>mml wrote:</b></span></td> </tr> <tr> <td class="quote">I haven't touched timers at all, but the usual way of setting up an interrupt handler requires irqInit(), irqSet() and irqEnable().  Have a look at those functions and it should get you going.</td> </tr></table><span class="postbody">
<br/>
I thought it should work something like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   irqInit();
<br/>
   TIMER0_DATA = TIMER_FREQ_1024(1);
<br/>
   TIMER0_CR = TIMER_ENABLE | TIMER_DIV_1024 | TIMER_IRQ_REQ;
<br/>
   irqSet(IRQ_TIMER0, on_irq);
<br/>
   irqEnable(IRQ_TIMER0);
<br/>
</td> </tr></table><span class="postbody">
<br/>
But as said above, irqSet doesn't seem to do the right thing. If instead I use </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">IRQ_HANDLER = on_irq;</td> </tr></table><span class="postbody"> then it works and the function on_irq is triggered with every timer tick. Not sure what I'm missing.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163296 - elhobbs - Mon Sep 29, 2008 12:37 am</h4>
    <div class="postbody"><span class="postbody">keysDown() returns a bitmask for all of the keys that have just been pressed down - kind of like a keydown event it does not indicate when a button is held - that is what keysHeld() is for. so, save the result of keyDown() value to a variable and test that for each key.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163297 - dsbeginner - Mon Sep 29, 2008 1:08 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>elhobbs wrote:</b></span></td> </tr> <tr> <td class="quote">so, save the result of keyDown() value to a variable and test that for each key.</td> </tr></table><span class="postbody">
<br/>
<br/>
If I understood it correctly, then keyDown() returns the same result until scanKeys() is called again. So besides maybe a slight performance increase, I don't see how storing the result to a local variable before making the bitmask checks could affect my problem (and from what I tried, it doesn't).
<br/>
<br/>
But thanks for trying to help. Any other ideas?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163299 - gauauu - Mon Sep 29, 2008 3:07 am</h4>
    <div class="postbody"><span class="postbody">What are you doing with the value you get from this?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
keysDown() &amp; KEY_L
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I ask because I had the same problem.   My problem was based on using a bool type.  Libnds defines a bool as an enum with two values, false and true.  Which means if you set a bool value to 8, which normally in C evaluates to a true value, it can evaluate as false.  (see <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=15986" target="_blank">this thread</a>).
<br/>
<br/>
Which means that if you do:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
bool isLHeld()
<br/>
{
<br/>
   return keysDown() &amp; KEY_L;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
It won't be correct.  You'd have to do something like:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
bool isLHeld()
<br/>
{
<br/>
   return keysDown() &amp; KEY_L ? true : false;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
In my case, up, down, left, right, A and B worked.  L, R, Y, and B failed.  Which sounds a lot like your issue....</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163304 - mml - Mon Sep 29, 2008 10:08 am</h4>
    <div class="postbody"><span class="postbody">Does something like this make any difference?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   if (keysDownRepeat() &amp; KEY_UP == KEY_UP) { ... } 
<br/>
   if (keysDownRepeat() &amp; KEY_DOWN == KEY_DOWN) { ... } 
<br/>
   if (keysDown() &amp; KEY_A == KEY_A) { ... } 
<br/>
   if (keysDown() &amp; KEY_L == KEY_L){ ... } </td> </tr></table><span class="postbody">
<br/>
<br/>
Also, are you in C or C++?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163310 - dsbeginner - Mon Sep 29, 2008 1:19 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>gauauu wrote:</b></span></td> </tr> <tr> <td class="quote">You'd have to do something like:
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
bool isLHeld()
<br/>
{
<br/>
   return keysDown() &amp; KEY_L ? true : false;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
In my case, up, down, left, right, A and B worked.  L, R, Y, and B failed.  Which sounds a lot like your issue....</span></td> </tr></table><span class="postbody">
<br/>
<br/>
That did it. In fact I was storing the result of the check to a 'bool' variable first. Thanks a lot. But does the solution feel cumbersome only to me?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>mml wrote:</b></span></td> </tr> <tr> <td class="quote">Does something like this make any difference?
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   if (keysDownRepeat() &amp; KEY_UP == KEY_UP) { ... } 
<br/>
   if (keysDownRepeat() &amp; KEY_DOWN == KEY_DOWN) { ... } 
<br/>
   if (keysDown() &amp; KEY_A == KEY_A) { ... } 
<br/>
   if (keysDown() &amp; KEY_L == KEY_L){ ... } </td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
After changing it to this, it stopped working altogether. That puzzled me until I realized that == is stronger than &amp; so I changed it to
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   if ((keysDownRepeat() &amp; KEY_DOWN) == KEY_DOWN) { ... } </td> </tr></table><span class="postbody"> but that didn't make a difference to the original version. So no improvement here it seems. keysDownRepeat still only works with KEY_UP.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>mml wrote:</b></span></td> </tr> <tr> <td class="quote">Also, are you in C or C++?</td> </tr></table><span class="postbody">
<br/>
<br/>
I thought I'm in C++, but after playing with some #ifdef's, it turns out I'm in C (and have no idea how to change that, or what the implications are).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163317 - gauauu - Mon Sep 29, 2008 3:08 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>dsbeginner wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
That did it. In fact I was storing the result of the check to a 'bool' variable first. Thanks a lot. But does the solution feel cumbersome only to me?
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Well, you should also be able to do:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
bool isLHeld()
<br/>
{
<br/>
   return ((keysDown() &amp; KEY_L) &gt; 0);
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
Which is slightly less cumbersome.
<br/>
<br/>
But yes, I agree.  I've found the enum'd bool to be rather a pain (as opposed to just typedef'ing bool as an int, and #define true and false).  It seems to me that the disadvantages of it tend to outweigh the advantages.  But the libnds authors are better programmers than I, so I'm guessing there's some good reason I'm not aware of as to why it is preferable to do it as an enum.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163320 - elhobbs - Mon Sep 29, 2008 3:49 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>gauauu wrote:</b></span></td> </tr> <tr> <td class="quote">But yes, I agree.  I've found the enum'd bool to be rather a pain (as opposed to just typedef'ing bool as an int, and #define true and false).  It seems to me that the disadvantages of it tend to outweigh the advantages.  But the libnds authors are better programmers than I, so I'm guessing there's some good reason I'm not aware of as to why it is preferable to do it as an enum.</td> </tr></table><span class="postbody">a couple of reasons would be: it allows the compiler to typecheck better and you can use autocomplete in some IDEs on enums. also, #defines can be hard to debug so it may be more of a habit to use enums - just conjecture on my part on the last bit though.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163323 - dsbeginner - Mon Sep 29, 2008 4:50 pm</h4>
    <div class="postbody"><span class="postbody">I just found a solution to my keysDownRepeat problem:
<br/>
<br/>
First I had this code, which didn't work:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   if (keysDownRepeat() &amp; KEY_RIGHT) { ... }
<br/>
   if (keysDownRepeat() &amp; KEY_LEFT)  { ... }
<br/>
   if (keysDownRepeat() &amp; KEY_UP)    { ... }
<br/>
   if (keysDownRepeat() &amp; KEY_DOWN)  { ... }
<br/>
</td> </tr></table><span class="postbody">
<br/>
It works now like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   uint32 repeated_keys = keysDownRepeat();
<br/>
   if (repeated_keys &amp; KEY_RIGHT) { ... }
<br/>
   if (repeated_keys &amp; KEY_LEFT)  { ... }
<br/>
   if (repeated_keys &amp; KEY_UP)    { ... }
<br/>
   if (repeated_keys &amp; KEY_DOWN)  { ... }
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
So apparently, different from the other keys-functions, keysDownRepeat returns different results when called more than once between two scanKeys. I wonder if that's intended.
<br/>
<br/>
Now my last issue (for now, heh) is that with the timer.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163327 - elhobbs - Mon Sep 29, 2008 5:40 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>dsbeginner wrote:</b></span></td> </tr> <tr> <td class="quote">Now my last issue (for now, heh) is that with the timer.</td> </tr></table><span class="postbody"> here is the code I use to setup the timer for dswifi - it causes the Wifi_timer_50ms function to be called at approximately 50ms intervals</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">TIMER3_CR = 0;//disable timer 3
<br/>
irqSet(IRQ_TIMER3, Wifi_timer_50ms); // setup timer IRQ
<br/>
irqEnable(IRQ_TIMER3);
<br/>
TIMER3_CR=TIMER_ENABLE|TIMER_DIV_256|TIMER_IRQ_REQ;
<br/>
TIMER3_DATA=TIMER_FREQ_256(20);</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163328 - Lazy1 - Mon Sep 29, 2008 5:53 pm</h4>
    <div class="postbody"><span class="postbody">My code for a timer that counts milliseconds, actually it uses 2 timers but I'm sure someone has a more efficient one.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
static volatile u32 TimerBaseMS = 0;
<br/>
<br/>
static void IRQTimer1( void ) {
<br/>
   TimerBaseMS+= 65536;
<br/>
}
<br/>
<br/>
// get time in milliseconds
<br/>
int Timer_GetMS( void ) {
<br/>
   return TimerBaseMS + TIMER1_DATA;
<br/>
}
<br/>
<br/>
void Timer_Init( void ) {
<br/>
   irqSet( IRQ_TIMER1, IRQTimer1 );
<br/>
   irqEnable( IRQ_TIMER1 );
<br/>
   
<br/>
   TIMER0_CR = TIMER_ENABLE | TIMER_DIV_1;
<br/>
   TIMER0_DATA = 32768;
<br/>
   
<br/>
   TIMER1_CR = TIMER_ENABLE | TIMER_CASCADE | TIMER_IRQ_REQ;
<br/>
   TIMER1_DATA = 0;
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163329 - dsbeginner - Mon Sep 29, 2008 6:22 pm</h4>
    <div class="postbody"><span class="postbody">Okay, apparently my problem wasn't the call of irqSet(), but the irq handling function itself. I took it from <a class="postlink" href="http://www.double.co.nz/nintendo_ds/nds_develop8.html" target="_blank">http://www.double.co.nz/nintendo_ds/nds_develop8.html</a> without really understanding what e.g. VBLANK_INTR_WAIT_FLAGS is for.
<br/>
<br/>
Removing the if's and register assignments did the trick.
<br/>
<br/>
Thanks all!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163333 - Cydrak - Mon Sep 29, 2008 7:23 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>dsbeginner wrote:</b></span></td> </tr> <tr> <td class="quote">Okay, apparently my problem wasn't the call of irqSet(), but the irq handling function itself. I took it from <a href="http://www.double.co.nz/nintendo_ds/nds_develop8.html" target="_blank">http://www.double.co.nz/nintendo_ds/nds_develop8.html</a> without really understanding what e.g. VBLANK_INTR_WAIT_FLAGS is for. </td> </tr></table><span class="postbody">
<br/>
Erk! Well, yes, that is a problem... it looks to me like some of that page is outright wrong--most notably the explanation/code for REG_IF and VBLANK_INTR_WAIT_FLAGS. :|
<br/>
<br/>
Anyhow, if you use irqInit()/irqSet()/etc, libnds sets its own IRQ_HANDLER to call your functions. It also does a fair amount of stuff behind the scenes so you shouldn't have to touch anything IRQ-related (including the flags) unless you know what you're doing.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163540 - a128 - Sat Oct 04, 2008 4:35 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>elhobbs wrote:</b></span></td> </tr> <tr> <td class="quote"> here is the code I use to setup the timer for dswifi - it causes the Wifi_timer_50ms function to be called at approximately 50ms intervals<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">TIMER3_CR = 0;//disable timer 3
<br/>
irqSet(IRQ_TIMER3, Wifi_timer_50ms); // setup timer IRQ
<br/>
irqEnable(IRQ_TIMER3);
<br/>
TIMER3_CR=TIMER_ENABLE|TIMER_DIV_256|TIMER_IRQ_REQ;
<br/>
TIMER3_DATA=TIMER_FREQ_256(20);</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
<br/>
I guess you are right (as I tested your code) but I do not get it why it's every 50ms
<br/>
<br/>
OK.
<br/>
<br/>
1000ms / 50 ms = 20
<br/>
<br/>
but why you do we have to use the prescaler </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">TIMER_DIV_256?!</td> </tr></table><span class="postbody">
<br/>
<br/>
I thought 1000ms/50ms = 20 has to be with  </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">TIMER_DIV_1?!</td> </tr></table><span class="postbody">
<br/>
<br/>
i.e. a 1ms timer is setup with </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">TIMER_FREQ(1000)</td> </tr></table><span class="postbody">
<br/>
<br/>
so a 50ms timer has to be </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">TIMER_FREQ(1000/50)  ?!</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163542 - gauauu - Sat Oct 04, 2008 6:01 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>elhobbs wrote:</b></span></td> </tr> <tr> <td class="quote"> it allows the compiler to typecheck better </td> </tr></table><span class="postbody">
<br/>
<br/>
Except unfortunately, in the issue that me and dsbeginner and I were having, GCC <span style="font-style: italic">doesn't</span> complain, which makes the issue harder to debug.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163548 - eKid - Sat Oct 04, 2008 7:09 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>a128 wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<br/>
but why you do we have to use the prescaler
<br/>
</td> </tr></table><span class="postbody">
<br/>
The macro does (2^25) / x, (2^25)/20 is bigger than 16 bits (1677721), so you need a /256 prescaler to divide the counter by 256 so it fits within 16 bits (6553)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
i.e. a 1ms timer is setup with <table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">TIMER_FREQ(1000)</td> </tr></table><span class="postbody">
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
<br/>
This fits in 16 bits so no prescaler needed ((2^25)/1000 = ~33554)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163563 - elhobbs - Sun Oct 05, 2008 1:49 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>gauauu wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>elhobbs wrote:</b></span></td> </tr> <tr> <td class="quote"> it allows the compiler to typecheck better </td> </tr></table><span class="postbody">
<br/>
<br/>
Except unfortunately, in the issue that me and dsbeginner and I were having, GCC <span style="font-style: italic">doesn't</span> complain, which makes the issue harder to debug.</span></td> </tr></table><span class="postbody">in C it doesn't help. In C++ it does.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163571 - a128 - Sun Oct 05, 2008 8:18 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>eKid wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
This fits in 16 bits so no prescaler needed ((2^25)/1000 = ~33554)</td> </tr></table><span class="postbody">
<br/>
<br/>
Great Thanks.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
