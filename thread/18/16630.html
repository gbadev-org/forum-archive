<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>meta tiling? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > meta tiling?</h2>
<div id="posts">
<div class="post">
    <h4>#168421 - Tommmie - Tue Apr 28, 2009 8:59 pm</h4>
    <div class="postbody"><span class="postbody">ok, so i tried to get meta tiles working, but they do it for 50%(it is cut down half the height, my function(it's a 256x256 bg):
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">unsigned short vrammap[1024];
<br/>
<br/>
void initmetabg(void){
<br/>
<br/>
   int ix, iy; // teller variabelen
<br/>
<br/>
   int meta, dest; // locatie variabelen
<br/>
<br/>
      
<br/>
   for(iy = 0; iy &lt; 16; iy++)// nu zijn er maar 16 tiles(meta!)
<br/>
   {
<br/>
      for(ix = 0; ix &lt; 16; ix++) // hier geld hetzelfde
<br/>
      {
<br/>
<br/>
      meta = testscrnMetaMap[(iy * 16) + ix]; // reken uit welke metatile gecopieerd moet worden
<br/>
<br/>
      dest = (iy * 16 * 2) + (ix * 2);       // reken de beginplek in de vrammap uit
<br/>
<br/>
      vrammap[dest + 0]    =        testscrnMetaTiles[meta * 4 + 0]; 
<br/>
 
<br/>
      vrammap[dest + 1]    =    testscrnMetaTiles[meta * 4 + 1];
<br/>
<br/>
      vrammap[dest + 32]    =   testscrnMetaTiles[meta * 4 + 2];
<br/>
<br/>
      vrammap[dest + 33]    =    testscrnMetaTiles[meta * 4 + 3];
<br/>
      
<br/>
      }
<br/>
   }
<br/>
<br/>
<br/>
<br/>
}</td> </tr></table><span class="postbody">[/code]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168422 - DiscoStew - Tue Apr 28, 2009 9:48 pm</h4>
    <div class="postbody"><span class="postbody">I think when calculating "dest", it should be
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">dest = (iy * 32 * 2) + (ix * 2);</td> </tr></table><span class="postbody">
<br/>
<br/>
A 256x256 bg is composed of 32x32 tiles, so for each row, you jump a total of 32 tiles, but because you are constructing a scene made with 16x16 pixel meta tiles, you have to make an additional jump of 32 tiles to skip the 2nd row of the placed meta tiles. So, just replace the "16" with "32"<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168551 - Tommmie - Mon May 04, 2009 8:14 pm</h4>
    <div class="postbody"><span class="postbody">thanks discostew! worked finally. but now something else, but related to meta tiles: I want to have a dynamic scrolling bg with meta tiles. So i have an 512x256 bg init in my code an i copy some riows or colums of the bg when needed. but i have this function now for adding a column, but there is something wrong(I can't find it, already 3 days searching), namely the bgś will be cut down in half as in the last post. 
<br/>
<br/>
this copy's a colum into the vrammap of the bg when needed:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">unsigned short vrammap[2048];
<br/>
unsigned short metatiles[24];
<br/>
unsigned short metamap[512];
<br/>
<br/>
<br/>
<br/>
void metacpy(int pos, const u16 * meta){
<br/>
<br/>
vramblock[pos + 0]     =    mmap[(*meta) * 4 + 0];
<br/>
vramblock[pos + 1]    =    mmap[(*meta) * 4 + 1];
<br/>
vramblock[pos + 32]     =    mmap[(*meta) * 4 + 2];
<br/>
vramblock[pos + 33]    =    mmap[(*meta) * 4 + 3];
<br/>
<br/>
}
<br/>
<br/>
void  bg_metacolcpy(int tx, int ty, int bg, int width)
<br/>
{
<br/>
   
<br/>
   int iy;
<br/>
<br/>
        int vramX = (u32) (tx / 16) % 32; // because the bg i have inited is 32 meta tiles wide
<br/>
<br/>
   int vramY = (u32) (ty / 16) % 16; // the same, but now the bg is 16 meta tiles high
<br/>
   
<br/>
   
<br/>
   vramX = (vramX / 16) * 32 * 32 + (vramX % 16) * 2; // first iḿ calculating if i have to copy it in the second block of the map and then i'm adding the extra tiles
<br/>
   
<br/>
   int pos = (vramY * 32 * 2  + vramX); // integer to destination
<br/>
<br/>
   const u16 * metatile = &amp;map[tx / 16 + ((ty / 16) * 32)];
<br/>
   
<br/>
<br/>
<br/>
   for(iy = vramY; iy &lt; 16; iy++)
<br/>
<br/>
   
<br/>
   {
<br/>
      
<br/>
      metacpy(pos, metatile);
<br/>
      metatile+= width;
<br/>
      pos += 64;   // 2 rijen verder(meta tile is 16 pixels hoog!
<br/>
   }
<br/>
<br/>
   pos -= 1024;
<br/>
<br/>
   for(iy = 0; iy &lt; vramY; iy++)
<br/>
<br/>
   {
<br/>
      metacpy(pos, metatile);
<br/>
      metatile += width;
<br/>
      pos += 64;
<br/>
   }
<br/>
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168554 - DiscoStew - Mon May 04, 2009 10:40 pm</h4>
    <div class="postbody"><span class="postbody">When dealing with Text BGs, you need to understand that it is sectioned off into 32x32 blocks, like so...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">256x256
<br/>
*****
<br/>
* 0 *
<br/>
*****
<br/>
<br/>
512x256
<br/>
*********
<br/>
* 0 * 1 *
<br/>
*********
<br/>
<br/>
256x512
<br/>
*****
<br/>
* 0 *
<br/>
*****
<br/>
* 1 *
<br/>
*****
<br/>
<br/>
512x512
<br/>
*********
<br/>
* 0 * 1 *
<br/>
*********
<br/>
* 2 * 3 *
<br/>
*********</td> </tr></table><span class="postbody">
<br/>
<br/>
For 256x256, there's no problem. With 512x256, you need to think of the entire thing as 2 256x256 blocks connected horizontally. Editting a tile in column 0 to 31 is like editting a tile in a regular 256x256 BG, but editting a tile in column 32 to 63, you have to add an entire BG block's worth of tiles, which would be 32x32 tiles. In 256x512, they are connected vertically, but the method to editting this type of BG isn't much different from a 256x256, because it is extended vertically. With 512x512...well, you get the idea.<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168556 - Dwedit - Tue May 05, 2009 12:56 am</h4>
    <div class="postbody"><span class="postbody">If your metatiles are not aligned to a 2x2 boundary, you will get incorrect behavior when you go off the edge.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168561 - Tommmie - Tue May 05, 2009 2:55 pm</h4>
    <div class="postbody"><span class="postbody">solved it, was the init function to load the first tiles of the bg. but thanks for the help!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168865 - Tommmie - Mon Jun 01, 2009 8:04 am</h4>
    <div class="postbody"><span class="postbody">my fault it's already solved</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
