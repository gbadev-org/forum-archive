<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>libfat / no$gba / fopen() always fails - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > libfat / no$gba / fopen() always fails</h2>
<div id="posts">
<div class="post">
    <h4>#161422 - ZeroSum - Sun Aug 03, 2008 4:27 am</h4>
    <div class="postbody"><span class="postbody">I've used <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?p=121089#121089" target="_blank">this post</a> to setup my build so I can test libfat apps using no$gba. The no$gba version can't seem to fopen() any files at all though.
<br/>
<br/>
I make the image from the C:\files folder which contains 'testdir', 'testdir2' and 'test.txt'. Then build using the modified makefile, all of this works fine. My test app currently tries to get the current working directory, check what files are in it, then attempts to load test.txt and output it's contents. This works fine on hardware but on no$gba it can't seem to open the file.
<br/>
<br/>
The output of my test app when using no$gba is:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">Init fat: Success.
<br/>
Getting CWD... fat:/
<br/>
diropen() success.
<br/>
 DIR: testdir
<br/>
 DIR: testdir2
<br/>
FILE: test.txt
<br/>
Could not load file. </td> </tr></table><span class="postbody">
<br/>
<br/>
As you can see the files/folders seem to exist yet fopen() always fails. I've tried using 'fat:/test.txt', '/test.txt', './test.txt' etc. as the filename to fopen() none of them open.
<br/>
<br/>
Anyone have any idea whats going wrong? Thanks for reading.
<br/>
<br/>
Edit:
<br/>
Solved just after posting. Removing the directory listing code allows me to open files. Dwedit's <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=15902" target="_blank">post</a> about dirnext() corrupting the stack seems to be it.[/url]</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
