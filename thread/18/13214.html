<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Visblockers, bounding boxes, etc? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Visblockers, bounding boxes, etc?</h2>
<div id="posts">
<div class="post">
    <h4>#128836 - LoTekK - Tue May 15, 2007 8:29 pm</h4>
    <div class="postbody"><span class="postbody">Ok, I'm admittedly not a programmer, certainly not of the caliber to consider touching C. I'm an artist, who has a DS project somewhat mapped out, but I'm not going to be looking for a programmer until I've got something mocked up. In other words, I'm getting to work on not only mapping out the main gameplay mechanics, but also building the main art assets that will be in use.
<br/>
<br/>
My main question right now is, taking into account the 2000 tris at 60fps hardware limit, would I have to worry too much about visblockers/bounding boxes? I would assume they won't factor into the 2000 tri limit, but how much of a hit to resource allocation/management would something like that be?
<br/>
<br/>
Thanks in advance for your patience.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#128917 - silent_code - Wed May 16, 2007 7:12 pm</h4>
    <div class="postbody"><span class="postbody">what exactly was your question?
<br/>
<br/>
the hardware can display scenes made of about 7k vertices using a limited amount of different primitve types (triangles, quats, strips etc, amount depends on what primitives are used). that is after clipping and all. so, it's the max amount of geometry you'll see in a frame. anything above that simply won't be displayed (at least that's what i have experienced).
<br/>
<br/>
there are some registers / memory locations that tell you how much geometry was pushed during the last update. search the forum for it (i'd tell you if i were at home and had internet and a computer that is not currently being serviced ;^D ).
<br/>
<br/>
as you might already know, you *can* have scenes that have much more geometry. just use some algorithm to determine what parts of the scene are visible at any given time.
<br/>
<br/>
hope that helps.
<br/>
<br/>
ps: sorry, i sort of am in a bad mood right now. you know, people asking about an n64 emulator for nds and stuff... ;^p</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#128923 - gabebear - Wed May 16, 2007 7:38 pm</h4>
    <div class="postbody"><span class="postbody">Testing using the 3D hardware on the DS doesn't eat into the poly/vertex limits.
<br/>
<br/>
BoxTesting takes 103 Cycles(contrast with 8 cycles to specify a vertex). Remember that if the box you are testing is completely inside the viewing volume the test will be wrong. There is already support for this in libnds with a good example. 
<br/>
<br/>
Position Testing takes 9 cycles and gives you the location of a point after being transformed by the clip-matrix. This can be useful for lots of crud(the w-val is how far the point is from the camera). There is already support for this in libnds, but the only example that uses it is the picking example.
<br/>
<br/>
List of commands and the # of cycles they take:
<br/>
<a href="http://nocash.emubase.de/gbatek.htm#ds3diomap" target="_blank">http://nocash.emubase.de/gbatek.htm#ds3diomap</a>
<br/>
<br/>
Testing using the DS 3D hardware:
<br/>
<a href="http://nocash.emubase.de/gbatek.htm#ds3dtests" target="_blank">http://nocash.emubase.de/gbatek.htm#ds3dtests</a>
<br/>
<br/>
I think most people doing this stuff right now aren't using the 3D hardware to do it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#128928 - LoTekK - Wed May 16, 2007 7:52 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for the pointers, and sorry, I wasn't too sure how clear my question was. :) I sort of have a rudimentary understanding of the actual visible polygons (backface culling, etc), but the main question was concerning <span style="font-weight: bold">in</span>visible geometry used for, say, collision boxes.
<br/>
<br/>
Let's say I have a scene, and for the purpose of this example, we'll assume that I've currently maxed out the visible polygons/verts. Within this scene, I have, among other things, a tree and a missile. Each of these has invisible collision geometry (eg, bounding box). Now, being that the collision boxes are invisible, they presumably won't count towards the hardware visible vert/poly limit(?), but will I be able to use the invisible geometry for, say, collision checks, among other things?
<br/>
<br/>
Again, these are questions that I'm asking from a non-programmer point of view, primarily to get a better gauge on what sort of limits I need to work within while I am putting together my art assets, so I hope you'll bear with me. :)
<br/>
<br/>
<span style="font-style: italic">edit:</span>
<br/>
Oops, didn't see gabebear's post. I didn't totally understand your post, but from what I <span style="font-style: italic">did</span> gather of it, you basically answered my question above, in that invisible geom <span style="font-style: italic">is</span> available for position checks and, presumably, collision checks?
<br/>
<br/>
Oh and, thanks for those links. They certainly look useful, and while they're almost completely above my head at this point, I'm sure it'll click eventually. :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#128932 - silent_code - Wed May 16, 2007 8:15 pm</h4>
    <div class="postbody"><span class="postbody">as far as i can tell you, they don't count. as i said before, only visible, post clipping primitives count. also, afaik, backfaces don't count, either.
<br/>
<br/>
i can't remember how the hw test was done, but normally you don't use graphics geometry for bb-cd. again, i may be wrong in the case of the nds and i don't have time to look it up right now. but i being named "box testing", i guess you don't use actual geometry, but just some maximum and minimum values relative to a point in space.
<br/>
<br/>
all you have to be aware of is, like gabebear wrote, the processing time (cycles) consumed by the operation. if you (or your future programmer) can do it faster in software, you should leave the hw test.
<br/>
<br/>
NOTE @all: another interesting questions is if the test is done in parallel with other (main loop) instructions running on the arm9. that would mean, if it was, you could issue a test and while the hw was testing, you could do some other game logic stuff. that would cut down the 103 cycles penalty for hw testing. i imagine the test is done by the 3d engine.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#128933 - LoTekK - Wed May 16, 2007 8:22 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for the help again, I think that pretty much cleared up the main concern I had (ie, whether I was going to have to take bounding boxes/collision boxes into account when putting together my art assets).
<br/>
<br/>
Your last point is an interesting one, and if you feel like continuing that line of thought, please feel free. I don't know nearly enough to actually contribute usefully, but it does look like an interesting discussion. :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#128955 - gabebear - Thu May 17, 2007 2:04 am</h4>
    <div class="postbody"><span class="postbody">The 3D engine tests run in parallel; you check the the GXSTATUS register to figure out when it's ready.
<br/>
<a href="http://nocash.emubase.de/gbatek.htm#ds3dstatus" target="_blank">http://nocash.emubase.de/gbatek.htm#ds3dstatus</a>
<br/>
<br/>
I'm not sure how feasible it would be to use the 3D engine for collision testing. I guess it should be possible, but it's not going to be faster than doing it yourself.
<br/>
<br/>
The boxtest should work well for figuring out what parts of a level need to be drawn, especially if you are messing with the camera much.
<br/>
<br/>
The position test is useful in all sorts of situations when you need to figure out what object is closer to the camera. Sure... you could do it yourself, but position testing does it all for you.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#128980 - LoTekK - Thu May 17, 2007 11:00 am</h4>
    <div class="postbody"><span class="postbody">Thanks gabebear, that'll be useful info for future use. :)
<br/>
<br/>
I had another (possibly-annoying) question. From what I understand, culling of backfacing polies is handled by the programmer when writing up the engine, correct? Now, for animated meshes (as opposed to, say, static environment props), is backface culling normally done, or would that not be worth the effort in terms of processing cycles?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#128989 - tepples - Thu May 17, 2007 12:02 pm</h4>
    <div class="postbody"><span class="postbody">As far as I can tell, the hardware is capable of culling back-facing polygons.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#128997 - silent_code - Thu May 17, 2007 12:58 pm</h4>
    <div class="postbody"><span class="postbody">that is right. culled primitives don't "count" and won't be processed any further. although it still costs to set these up and do the culling, i don't think it'd be much faster than the hw when done in software.
<br/>
thanks for the info gabebear! and you're right, one should use it mainly for visibility checking, althouhg cd could also be done with it. but as noone has done it yet (afaik), we really don't know.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#129091 - LoTekK - Fri May 18, 2007 7:35 pm</h4>
    <div class="postbody"><span class="postbody">Thanks again for the helpful responses, and for being patient. :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#129123 - gabebear - Sat May 19, 2007 4:07 am</h4>
    <div class="postbody"><span class="postbody">The only time I know that the DS's 3D engine can't cull back-faces correctly is when you use poorly defined quads(a.k.a. non-planar quads; where all four points aren't on a single plane). Culled faces don't count in the total so you almost always want back-face culling turned on.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#129147 - tepples - Sat May 19, 2007 5:31 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>gabebear wrote:</b></span></td> </tr> <tr> <td class="quote">Culled faces don't count in the total so you almost always want back-face culling turned on.</td> </tr></table><span class="postbody">
<br/>
Except in those cases where part of a mesh is supposed to be double-sided.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#129826 - LoTekK - Sun May 27, 2007 7:00 pm</h4>
    <div class="postbody"><span class="postbody">Had another question. :]
<br/>
Is occlusion handled automatically by hardware, or would that have to be coded by the programmer? For example, let's say I have a two-storey building, and want a player to be able to hide and show the second storey. When the second storey is visible, I'd like the occluded portions of the first storey (which will be most of it) to not eat into the 2048-polygon limit (ie, per-poly occlusion culling).
<br/>
<br/>
Thanks again.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#129829 - tepples - Sun May 27, 2007 8:11 pm</h4>
    <div class="postbody"><span class="postbody">Completely occluded front-facing polygons still take up space in geometry RAM. You will want to handle occlusion culling in software, using techniques such as space partitioning or portals. You can also render the first floor and other far-away objects with lower-detail models.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#129835 - LoTekK - Sun May 27, 2007 9:11 pm</h4>
    <div class="postbody"><span class="postbody">Tepples, once again, thank you. I'm definitely glad that while not supported natively in hardware, it's still possible to occlusion cull for my specific needs (at the rate I'm going, I doubt a lower lod for lower levels would be enough to keep the polycount down :p).
<br/>
<br/>
For natively rendering quads, (and I couldn't really determine with any certainty from reading through the <a class="postlink" href="http://nocash.emubase.de/gbatek.htm" target="_blank">tech specs</a>), do the quads have to be planar, or can they be non-planar as long as they don't cross verts or form obtuse angles? If they can be non-planar, that'll ease back on a fair bit of geo memory.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#129838 - tepples - Mon May 28, 2007 12:30 am</h4>
    <div class="postbody"><span class="postbody">Make all quads planar, or they will bite you in the butt once you view them edge-on. Luckily, any ellipsoid can be modeled fairly well with 24 planar quads.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#129846 - LoTekK - Mon May 28, 2007 5:16 am</h4>
    <div class="postbody"><span class="postbody">For the most part, my quads will be planar. However, a good portion of the ground may be non-planar. If there's effectively no chance of seeing them edge-on, since this is going to be a strategy game with a 3/4 camera view and limited terrain elevation changes.
<br/>
<br/>
Would quads still be a bad way to go in this case, or would they be ok?</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
