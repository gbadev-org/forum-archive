<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>DSwifi TCP errors - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > DSwifi TCP errors</h2>
<div id="posts">
<div class="post">
    <h4>#151295 - kusma - Fri Feb 22, 2008 9:14 pm</h4>
    <div class="postbody"><span class="postbody">I'm having some issues with some data sent from a DS-client over a socket and to a PC-server does not reach the server for a very long time (more than 10 seconds usually). This only seems to happen to a special kind of 5 bytes big sync-packet. My first suspicion was that this was due to nagling, and my first attempt was to set TCP_NODELAY on the socket (as <a class="postlink" href="http://en.wikipedia.org/wiki/Nagles_algorithm" target="_blank">Wikipedia suggests</a>). However, it seems that IPPROTO_TCP and TCP_NODELAY is not defined in <b style="color:#FFA34F">dswifi</b>.
<br/>
<br/>
This lead me to believing that nagling wasn't supported in <b style="color:#FFA34F">dswifi</b>, so I looked for other issues. So, I fired up Wireshark (a TCP packet debugger), and I saw that the packets seemed to be attempted to be sent when I expected them to. BUT! Wireshark reported lots of problems when those specific packets were sent! The issues seems to start with a TCP Out of  order, and continue with TCP Dup ACKs and TCP Retransmissions. Then, a bit later, when the server sends a two-byte packet, the client sends back one big packet containing all the data that failed (due to the errors described above).
<br/>
<br/>
Now, has anyone experienced anything similar? This looks more and more like a bug in <b style="color:#FFA34F">DSwifi</b> to me, and if it is, does anyone know a work-around? Also, does anyone know if <b style="color:#FFA34F">DSwifi</b> does nageling, and if so, is it possible to turn it off?
<br/>
<br/>
edit: removed a ' in the link so the bbcode parser would understand the link.</span><span class="gensmall"><br/><br/>Last edited by kusma on Sun Dec 21, 2008 6:54 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#151320 - TwentySeven - Sat Feb 23, 2008 11:10 am</h4>
    <div class="postbody"><span class="postbody">I ran into exactly this issue.
<br/>
<br/>
<br/>
I gave up and went with udp.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151323 - masscat - Sat Feb 23, 2008 11:52 am</h4>
    <div class="postbody"><span class="postbody">You can hack the effect of TCP_NODELAY easily (well you could against CVS source dated 2006-10-10). See my <a class="postlink" href="http://masscat.afraid.org/ninds/debug_stub.php#dswifi_hack" target="_blank">GDB stub page</a>. This does mean that TCP_NODELAY is set for all TCP sockets.
<br/>
<br/>
In an old version of <b style="color:#FFA34F">dswifi</b> (I do not know if it is still present) I did find a problem with TCP data retransmission (see <a class="postlink" href="http://www.1emulation.com/forums/index.php?showtopic=19677" target="_blank">here</a>) for which I put together an experimental fix.
<br/>
Again the patch is against an old version of <b style="color:#FFA34F">dswifi</b> and, as stated in the linked thread, it is not a complete fix (and not tested much either).</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
