<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>DMA on the ARM7 and ARM9 - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > DMA on the ARM7 and ARM9</h2>
<div id="posts">
<div class="post">
    <h4>#40056 - Darkain - Thu Apr 14, 2005 8:19 pm</h4>
    <div class="postbody"><span class="postbody">ARM9 DMA.  Async?  Guess not.  :(
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">    int i = 0;
<br/>
    dmaCopyWordsAsynch(2, DarkStar2_Map,  &amp;BG_GFX[20480], 90112);
<br/>
    dmaCopyWordsAsynch(3, DarkStar2_Map,  &amp;BG_GFX_SUB[20480], 90112);
<br/>
    while ( dmaBusy(2) &amp; dmaBusy(3) ) { i++; }
<br/>
 
<br/>
    char str[32];
<br/>
    itoa(i, str);
<br/>
    printTitle(str);
<br/>
  
<br/>
outputs 0</td> </tr></table><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">    int i = 0;
<br/>
    dmaCopyWordsAsynch(3, DarkStar2_Map,  &amp;BG_GFX_SUB[20480], 90112);
<br/>
    while (dmaBusy(3)) i++;
<br/>
 
<br/>
    char str[32];
<br/>
    itoa(i, str);
<br/>
    printTitle(str);
<br/>
 
<br/>
outputs 0</td> </tr></table><span class="postbody">
<br/>
the first test was to check to see if the two channels would be active at the same time.  i tried both a logical AND and a logical OR operation on testing, and it always returned 0.  The second test is to see if the CPU was even active during a DMA transfer, which apparently it isnt, sadly  :(
<br/>
<br/>
Next, onwards to ARM7 DMA testing!!  I modified the ARM7 boot loader to use DMA isntead of copying bytes manually in code.  dayum, is it much faster to boot now!  :D
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">  dmaCopyWords(0, GETRAW(arm9_bin), (void*)0x02004000, GETRAWSIZE(arm9_bin));
<br/>
  dmaCopyWords(0, GETRAW(arm7_bin), (void*)0x02380000, GETRAWSIZE(arm7_bin));
<br/>
FAILS!!
<br/>
 
<br/>
  dmaCopyWords(1, GETRAW(arm9_bin), (void*)0x02004000, GETRAWSIZE(arm9_bin));
<br/>
  dmaCopyWords(1, GETRAW(arm7_bin), (void*)0x02380000, GETRAWSIZE(arm7_bin));
<br/>
FAILS!!
<br/>
 
<br/>
  dmaCopyWords(2, GETRAW(arm9_bin), (void*)0x02004000, GETRAWSIZE(arm9_bin));
<br/>
  dmaCopyWords(2, GETRAW(arm7_bin), (void*)0x02380000, GETRAWSIZE(arm7_bin));
<br/>
FAILS!!
<br/>
 
<br/>
  dmaCopyWords(3, GETRAW(arm9_bin), (void*)0x02004000, GETRAWSIZE(arm9_bin));
<br/>
  dmaCopyWords(3, GETRAW(arm7_bin), (void*)0x02380000, GETRAWSIZE(arm7_bin));
<br/>
WORKS!!</td> </tr></table><span class="postbody">
<br/>
As we can see from this series of tests, it appears that the ARM7 still has DMA access restrictions much like it did on the GBA.  For more info on the DMA as it was on GBA, check this out:  <a class="postlink" href="http://www.cs.rit.edu/~tjh8300/CowBite/CowBiteSpec.htm#DMA%20Source%20Registers" target="_blank">http://www.cs.rit.edu/~tjh8300/CowBite/CowBiteSpec.htm#DMA%20Source%20Registers</a>
<br/>
<br/>
<br/>
After the ARM7 test, i went back and did the ARM9 test again with all 4 DMA channels.  they all worked, and produced the same result.  so, from what i can tell so far, there isnt the same restrictions on the ARM9 DMA transfers as there is on the ARM7.<br/>_________________<br/>-=- Darkain Dragoon -=-
<br/>
<a class="postlink" href="http://www.darkain.com" target="_blank">http://www.darkain.com</a>
<br/>
<a class="postlink" href="http://ds.darkain.com/hack" target="_blank">DarkStar</a> for <a class="postlink" href="http://ds.darkain.com" target="_blank">Nintendo DS</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#40094 - FeaRog - Fri Apr 15, 2005 1:55 am</h4>
    <div class="postbody"><span class="postbody">Good info! Gives me a few more ideas to try with my DMAing of stuff when I get some more time to fiddle. Cheers!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#40097 - tepples - Fri Apr 15, 2005 2:35 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Darkain wrote:</b></span></td> </tr> <tr> <td class="quote">Next, onwards to ARM7 DMA testing!!  I modified the ARM7 boot loader to use DMA isntead of copying bytes manually in code.  dayum, is it much faster to boot now!  :D</td> </tr></table><span class="postbody">
<br/>
You could have got at least 80% of the the same speedup with an unrolled ldmia/stmia loop.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">As we can see from this series of tests, it appears that the ARM7 still has DMA access restrictions much like it did on the GBA.  For more info on the DMA as it was on GBA, check this out:  <a class="postlink" href="http://www.cs.rit.edu/~tjh8300/CowBite/CowBiteSpec.htm#DMA%20Source%20Registers" target="_blank">http://www.cs.rit.edu/~tjh8300/CowBite/CowBiteSpec.htm#DMA%20Source%20Registers</a></td> </tr></table><span class="postbody">
<br/>
All that seems to show is that DMA[0] can't copy from ROM. I can't see why DMA[1] and [2] would fail to copy from ROM. Perhaps it has something to do with GBA sound being disabled in DS mode.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
