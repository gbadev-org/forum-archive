<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>How do I make a textured lit quad display list? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > How do I make a textured lit quad display list?</h2>
<div id="posts">
<div class="post">
    <h4>#151207 - BovineFury - Wed Feb 20, 2008 11:57 pm</h4>
    <div class="postbody"><span class="postbody">I'm trying to make a group of textured quads that can be lit via a display list (glCallList()).  How is it done?  I've been trying to find some explanation of how this works, searched the forum, etc. 
<br/>
<br/>
Is there anywhere I can go to find a tutorial on how this works?  I've checked the devkitpro examples, but all it has is how to do a triangle with no normal or texturing.
<br/>
<br/>
I can't use a exporter because the list has to be generated in play.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151208 - nce - Thu Feb 21, 2008 12:23 am</h4>
    <div class="postbody"><span class="postbody">As soon as you have understood a to make a simple triangle with just position...
<br/>
<br/>
all other info works the same  way you push vertices on your list.  You can push normal and texture uvs too....
<br/>
<br/>
( you can even push your texture binding )<br/>_________________<br/>-jerome-</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151209 - BovineFury - Thu Feb 21, 2008 12:33 am</h4>
    <div class="postbody"><span class="postbody">Is there any specific order that things are supposed to be pushed? Normal before texture, etc?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151210 - BovineFury - Thu Feb 21, 2008 1:05 am</h4>
    <div class="postbody"><span class="postbody">For that matter, is there anywhere that explains anything about how the display lists are set up?
<br/>
<br/>
From the devkit triangle example:
<br/>
FIFO_COMMAND_PACK(FIFO_BEGIN, FIFO_COLOR, FIFO_VERTEX16, FIFO_COLOR).  I see two color commands.  Why?
<br/>
<br/>
Partway through the list is
<br/>
FIFO_COMMAND_PACK(FIFO_VERTEX16, FIFO_COLOR, FIFO_VERTEX16, FIFO_END)
<br/>
<br/>
Why?
<br/>
<br/>
I've been running google searches and coming up with 4-5 results, none of which are any help.  Is there any documentation that explains any of this?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151215 - M3d10n - Thu Feb 21, 2008 2:14 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>BovineFury wrote:</b></span></td> </tr> <tr> <td class="quote">For that matter, is there anywhere that explains anything about how the display lists are set up?</td> </tr></table><span class="postbody">
<br/>
<br/>
Do a search for "display lists" on this forum and you should find a thread which has nice info about them (I don't have the link myself, but I learned most of it there). But I'll try to help.
<br/>
<br/>
<br/>
A display list is a large array of u32's. You basically have 4 commands packed into a single u32, followed by the data for each command. Different commands need different amounts of data, or no data at all.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>BovineFury wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
From the devkit triangle example:
<br/>
FIFO_COMMAND_PACK(FIFO_BEGIN, FIFO_COLOR, FIFO_VERTEX16, FIFO_COLOR).  I see two color commands.  Why?
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
The macro FIFO_COMMAND_PACK() packs four u8 command IDs into a single u32 value. I'll translate that command sequence to immediate mode so you can read it better:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
1   glBegin();
<br/>
2   glColor();
<br/>
3   glVertex3v16();
<br/>
4   glColor();
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
When drawing each geometry vertex, the position (FIFO_VERTEX16 or glVertex3v16() call) is always the last one for each vertex, so lines 2 and 3 in the example above define the first vertex. The 2nd glColor() command will be applied to the next vertex.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>BovineFury wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Partway through the list is
<br/>
FIFO_COMMAND_PACK(FIFO_VERTEX16, FIFO_COLOR, FIFO_VERTEX16, FIFO_END)
<br/>
<br/>
Why?</td> </tr></table><span class="postbody">
<br/>
<br/>
Continuing from the previous commands...
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
5   glVertex3v16();
<br/>
6   glColor();
<br/>
7   glVertex3v16();
<br/>
8   glEnd();
<br/>
</td> </tr></table><span class="postbody">
<br/>
Line 5 ends the declaration of the 2nd vertex, then we have the 3rd vertex declared by lines 6 and 7. Line 8 closes the triangle.
<br/>
<br/>
Notice I didn't specify any parameters in the examples above. The command data is specified after the packed command. Here's a complete example:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
u32 triangle[] = 
<br/>
{
<br/>
   12,
<br/>
   FIFO_COMMAND_PACK(FIFO_BEGIN, FIFO_COLOR, FIFO_VERTEX16, FIFO_COLOR),
<br/>
   GL_TRIANGLE,
<br/>
   RGB15(31,0,0),
<br/>
   VERTEX_PACK(inttov16(-1),inttov16(-1)), VERTEX_PACK(0,0),
<br/>
   RGB15(0,31,0),
<br/>
   FIFO_COMMAND_PACK(FIFO_VERTEX16, FIFO_COLOR, FIFO_VERTEX16, FIFO_END),
<br/>
   VERTEX_PACK(inttov16(1),inttov16(-1)), VERTEX_PACK(0,0),
<br/>
   RGB15(0,0,31),
<br/>
   VERTEX_PACK(inttov16(0),inttov16(1)), VERTEX_PACK(0,0),
<br/>
};</td> </tr></table><span class="postbody">
<br/>
<br/>
This commands are executed in the following order:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
FIFO_BEGIN
<br/>
FIFO_COLOR
<br/>
FIFO_VERTEX16
<br/>
FIFO_COLOR
<br/>
FIFO_VERTEX16
<br/>
FIFO_COLOR
<br/>
FIFO_VERTEX16
<br/>
FIFO_END
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Using immediate mode, it would look like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
glBegin(GL_TRIANGLE);
<br/>
glColor(RGB15(31,0,0));
<br/>
glVertex3v16(inttov16(-1),inttov16(-1),0);
<br/>
glColor(RGB15(0,31,0));
<br/>
glVertex3v16(inttov16(1),inttov16(-1),0);
<br/>
glColor(RGB15(0,0,31));  
<br/>
glVertex3v16(inttov16(0),inttov16(1),0);
<br/>
glEnd();
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
The confusing thing is that FIFO_VERTEX16 needs <span style="font-weight: bold">two</span> data entries (you can only fit two 16-bit coordinates in a u32), while all other commands in the example only require one. That's why there are always two VERTEX_PACK() calls next to each other: the first one defines the X and Y coordinates, and the 3rd one defines the Z coordinate (I'm not sure you can also set the W coordinate - never tested it).
<br/>
<br/>
Notice that the FIFO_END command has no data. When you understand that each command needs a different number of u32 data fields to work, dealing with display lists becomes much easier.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151245 - BovineFury - Thu Feb 21, 2008 10:17 pm</h4>
    <div class="postbody"><span class="postbody">Thank you.  That was exactly what I needed to know.  Texturing and normals are up and running.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151255 - nce - Fri Feb 22, 2008 12:37 am</h4>
    <div class="postbody"><span class="postbody">I've learn a lot when I started my exporter from 3dsmax in reading this :
<br/>
<br/>
<br/>
<a class="postlink" href="http://nocash.emubase.de/gbatek.htm#ds3doverview" target="_blank">http://nocash.emubase.de/gbatek.htm#ds3doverview</a>
<br/>
Geometry Commands (can be invoked by Port Address, or by Command ID)  is the list of command you can use ( not all are working in display list I think ), and the number of parameter you'll have to send after.
<br/>
<br/>
and 
<br/>
<br/>
<a class="postlink" href="http://nocash.emubase.de/gbatek.htm#ds3dgeometrycommands" target="_blank">http://nocash.emubase.de/gbatek.htm#ds3dgeometrycommands</a>
<br/>
explain you how to build a display list ( unpacked or packed as in the ndslib exemple )<br/>_________________<br/>-jerome-</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
