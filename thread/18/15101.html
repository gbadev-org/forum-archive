<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>u32 is not unsigned int - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > u32 is not unsigned int</h2>
<div id="posts">
<div class="post">
    <h4>#151669 - HyperHacker - Mon Mar 03, 2008 3:00 am</h4>
    <div class="postbody"><span class="postbody">With the latest libNDS (unless the DKP updater is out of date) I'm getting warnings that I didn't get before about incompatible types when I pass (for example) u32 to something expecting unsigned int. Aren't they the same thing?<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151670 - Dwedit - Mon Mar 03, 2008 3:16 am</h4>
    <div class="postbody"><span class="postbody">You sure it's not some other modifier that's causing the error?  Unsigned int is most definitely the exact same thing as u32.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151671 - HyperHacker - Mon Mar 03, 2008 3:20 am</h4>
    <div class="postbody"><span class="postbody">I can't see what it would be. It's actually any time I use a pointer to one of these, e.g.:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">f:/dev/ds/src/bootmenu2/arm7/source/arm7.c:968: warning: passing argument 1 of 'touchReadTemperature' from incompatible pointer type
<br/>
f:/dev/ds/src/bootmenu2/arm9/source/menus.c:652: warning: format '%u' expects type 'unsigned int', but argument 3 has type 'u32'</td> </tr></table><span class="postbody">
<br/>
touchReadTemperature is defined:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">uint32 touchReadTemperature(int * t1, int * t2);</td> </tr></table><span class="postbody">and the line in question does this:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">s32 t1=0, t2=0;
<br/>
[...]
<br/>
IPC2-&gt;Temperature = touchReadTemperature(&amp;t1, &amp;t2);</td> </tr></table><span class="postbody">It complains about both arguments, I just didn't see the need to quote both warnings.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151674 - tepples - Mon Mar 03, 2008 4:31 am</h4>
    <div class="postbody"><span class="postbody">I seem to remember reading that newer libnds redefined u32 in terms of <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?p=144930#144930" target="_blank">uint32_t of C99's stdint.h, which Newlib defines as unsigned long int</a>, not unsigned int.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151677 - HyperHacker - Mon Mar 03, 2008 4:42 am</h4>
    <div class="postbody"><span class="postbody">Anything I can do about that then?<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151690 - nanou - Mon Mar 03, 2008 10:29 am</h4>
    <div class="postbody"><span class="postbody">Maybe switch to using unsigned int?
<br/>
<br/>
If that's not cool, you could always ignore the warnings or recast it manually when making the call (I prefer the latter.)
<br/>
<br/>
Or do you want to fix the definitions and maybe recompile the libs?<br/>_________________<br/>- nanou</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151691 - HyperHacker - Mon Mar 03, 2008 10:40 am</h4>
    <div class="postbody"><span class="postbody">Recasting just gives different warnings, and changing the libs doesn't seem like a good idea. Switching would mean having to change the type of nearly every variable in the program and break the habit of using those types (which are far more convenient), which is silly given they're supposed to be compatible anyway.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151692 - wintermute - Mon Mar 03, 2008 11:25 am</h4>
    <div class="postbody"><span class="postbody">What I've done for the next toolchain iteration is make stdint.h prefer int to long when both are 32 bit. The patch fragment follows
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
diff -Nbaur newlib-1.15.0/newlib/libc/include/stdint.h newlib-1.15.0-new/newlib/libc/include/stdint.h
<br/>
--- newlib-1.15.0/newlib/libc/include/stdint.h   Wed Aug 16 22:39:43 2006
<br/>
+++ newlib-1.15.0-new/newlib/libc/include/stdint.h   Tue Jan  8 04:11:30 2008
<br/>
@@ -79,13 +79,13 @@
<br/>
 #endif
<br/>
 #endif
<br/>
 
<br/>
-#if __have_long32
<br/>
-typedef signed long int32_t;
<br/>
-typedef unsigned long uint32_t;
<br/>
-#define __int32_t_defined 1
<br/>
-#elif __STDINT_EXP(INT_MAX) == 0x7fffffffL
<br/>
+#if __STDINT_EXP(INT_MAX) == 0x7fffffffL
<br/>
 typedef signed int int32_t;
<br/>
 typedef unsigned int uint32_t;
<br/>
+#define __int32_t_defined 1
<br/>
+#elif __have_long32
<br/>
+typedef signed long int32_t;
<br/>
+typedef unsigned long uint32_t;
<br/>
 #define __int32_t_defined 1
<br/>
 #elif __STDINT_EXP(SHRT_MAX) == 0x7fffffffL
<br/>
 typedef signed short int32_t;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
You could save this as stdint.patch somewhere then open an msys console &amp; cd to $(DEVKITARM)/arm-eabi. From there use the following command line to apply the patch.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
patch -p3 -i &lt;path to &gt;/stdint.patch
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
This will be already applied in devkitARM r22 which is currently waiting for me to figure out how to make the GBA linkscripts work with the latest binutils iteration.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151693 - nanou - Mon Mar 03, 2008 12:49 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">Recasting just gives different warnings,</td> </tr></table><span class="postbody">
<br/>
It's been a long while since I've had to work with really messy type conflicts in a similar situation. Does recasting through void clear the warnings? IIRC it won't mind if you recast to or from void. I think that's what I ended up doing.
<br/>
<br/>
OTOH, wintermute's solution is best: have the right people fix the libs and forget about it. Though if you haven't applied the patch yet it might be worth working it out so you'll know for the future.<br/>_________________<br/>- nanou</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151694 - nipil - Mon Mar 03, 2008 1:22 pm</h4>
    <div class="postbody"><span class="postbody">Use <span style="font-weight: bold">%lu</span> instead of %u.
<br/>
I think your problem is not about typecasting, but more about the type
<br/>
expectation of the *printf functions : ie you're passing a u32 which is
<br/>
defined as long something, *printf wants a long-something specifier.
<br/>
From the <a class="postlink" href="http://en.wikipedia.org/wiki/Printf#printf_format_placeholders" target="_blank">wikipedia</a> :
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Length can be omitted or be any of:
<br/>
    * 'hh' : For integer types, causes printf to expect an int sized integer argument which was promoted from a char.
<br/>
    * 'h' : For integer types, causes printf to expect a int sized integer argument which was promoted from a short.
<br/>
    * 'l' : (ell) For integer types, <span style="font-weight: bold">causes printf to expect a long sized integer</span> argument.
<br/>
    * 'll' : (ell ell) For integer types, causes printf to expect a long long sized integer argument.
<br/>
    * 'L' : For floating point types, causes printf to expect a long double argument.
<br/>
    * 'z' : For integer types, causes printf to expect a size_t sized integer argument.
<br/>
    * 'j' : For integer types, causes printf to expect a intmax_t sized integer argument.
<br/>
    * 't' : For integer types, causes printf to expect a ptrdiff_t sized integer argument.</td> </tr></table><span class="postbody"><br/>_________________<br/>NDS Lite Gold/Silver, MK5/R4DS, MSI PC54G2, D-Link DI-624</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152069 - HyperHacker - Sun Mar 09, 2008 6:39 am</h4>
    <div class="postbody"><span class="postbody">OK, <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?p=151692#151692" target="_blank">that patch</a> did the job, although I got a warning about it terminating partway through the file.
<br/>
<br/>
Related question, how do you "pack" a structure? I've got one that should be 56 bytes but is being padded out to 60. Everything I've tried or seen on Google doesn't work. __attribute__((packed)) and __attribute__((__packed__)) are ignored (it even tells me so), #pragma pack(1) appears to work but there's no way to restore it (pack, pack(0), pack(), pack(pop) etc are all ignored).<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152077 - tepples - Sun Mar 09, 2008 1:44 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">OK, that patch did the job, although I got a warning about it terminating partway through the file. Related question, how do you "pack" a structure?</td> </tr></table><span class="postbody">
<br/>
If you carefully arrange the fields in the struct, you won't need packing. Can you paste the structure definition so that we can try to optimize the order of fields? Or are you trying to use fread() to read user-provided binary files in a <span style="font-style: italic">de facto</span> standard file format that you can't change?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"> I've got one that should be 56 bytes but is being padded out to 60. Everything I've tried or seen on Google doesn't work. __attribute__((packed)) and __attribute__((__packed__)) are ignored (it even tells me so)</td> </tr></table><span class="postbody">
<br/>
<a class="postlink" href="http://publib.boulder.ibm.com/infocenter/tpfhelp/current/index.jsp?topic=/com.ibm.ztpf-ztpfdf.doc_put.cur/gtpm1/m1rhpkd.html" target="_blank">IBM lists a possible solution</a>.
<br/>
<br/>
<br/>
Will split soon.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
