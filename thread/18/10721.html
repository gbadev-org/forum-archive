<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Why DmaSet and DmaClear won't work on real nds? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > Why DmaSet and DmaClear won't work on real nds?</h2>
<div id="posts">
<div class="post">
    <h4>#97160 - cold_as_ice - Tue Aug 08, 2006 7:05 am</h4>
    <div class="postbody"><span class="postbody">Hello i've got a question about dmaset:
<br/>
<br/>
when i run this code:
<br/>
<br/>
DmaSet(VRAM_A,RGB(31,0,31),256 * 192);
<br/>
<br/>
it works on the emulator but somehow it crashes on the real hardware.
<br/>
can someone explain that. O yeah i already tried it with flushing cache memory.
<br/>
here's my code for dmaset since ndslib doens't have it:
<br/>
<br/>
void DmaSet(void *dest,int value,int len)
<br/>
{
<br/>
	DMA_SRC(DMACHANNEL) = (u32)&amp;value;
<br/>
	DMA_DEST(DMACHANNEL) = (u32)dest;
<br/>
	DMA_CR(DMACHANNEL) = DMA_COPY_HALFWORDS | DMA_SRC_FIX| ((len &gt;&gt; 1) &amp; ~1);
<br/>
	while(DMA_CR(3) &amp; DMA_BUSY);
<br/>
}</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#97162 - wintermute - Tue Aug 08, 2006 7:14 am</h4>
    <div class="postbody"><span class="postbody">The stack on the DS is placed in dtcm which is fast on chip memory for the arm9. The DMA hardware doesn't have access to this memory. Your code will place a temporary variable on the stack and attempt to DMA from that address. Try this instead.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void DmaSet(void *dest,int value,int len)
<br/>
{
<br/>
*(u16*)dest = value;
<br/>
DMA_SRC(DMACHANNEL) = (u32)dest;
<br/>
DMA_DEST(DMACHANNEL) = (u32)dest;
<br/>
DMA_CR(DMACHANNEL) = DMA_COPY_HALFWORDS | DMA_SRC_FIX| ((len &gt;&gt; 1) &amp; ~1);
<br/>
while(DMA_CR(3) &amp; DMA_BUSY);
<br/>
}
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#97218 - cold_as_ice - Tue Aug 08, 2006 6:25 pm</h4>
    <div class="postbody"><span class="postbody">Yeah it works:) Thank you very much!!</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
