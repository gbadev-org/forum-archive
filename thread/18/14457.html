<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>.bmp to sprite? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > .bmp to sprite?</h2>
<div id="posts">
<div class="post">
    <h4>#144573 - spinal_cord - Sun Nov 04, 2007 2:09 am</h4>
    <div class="postbody"><span class="postbody">Doesn't matter, fixed it. I have left the [fixed] code for anyone who wants it though. It loads a 16 colour 32x32 .bmp to a sprite.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
// Includes
<br/>
#include &lt;PA9.h&gt;       // Include for PA_Lib
<br/>
<br/>
void load_bmp_4_sprite(u8 sprite_number, char*filename);
<br/>
<br/>
unsigned short sprite0_Pal[16]; // temp palette for sprite
<br/>
unsigned char sprite0_Sprite[32*32]; // temp image for sprite
<br/>
<br/>
<br/>
// Function: main()
<br/>
int main(int argc, char ** argv)
<br/>
{
<br/>
   PA_Init();    // Initializes PA_Lib
<br/>
   PA_InitVBL(); // Initializes a standard VBL
<br/>
   
<br/>
   fatInitDefault(); //Initialise fat library
<br/>
<br/>
   load_bmp_4_sprite(0,"icon.bmp");// load icon.bmp to sprite array
<br/>
   PA_CreateSprite(0, 0, (void*)sprite0_Sprite, // Blank sprite !
<br/>
               OBJ_SIZE_32X32, // Sprite size
<br/>
               1, 0, // Sprite palette number
<br/>
               100, 0); // In the upper left corner
<br/>
<br/>
   PA_LoadSpritePal(0, // Screen
<br/>
               0, // Palette number
<br/>
               (void*)sprite0_Pal);   // Palette name
<br/>
 
<br/>
<br/>
   // Infinite loop to keep the program running
<br/>
   while (1)
<br/>
   {
<br/>
   
<br/>
      PA_WaitForVBL();
<br/>
   }
<br/>
   
<br/>
   return 0;
<br/>
} // End of main()
<br/>
<br/>
<br/>
<br/>
void load_bmp_4_sprite(u8 sprite_number, char *filename)
<br/>
{
<br/>
    FILE* testRead = fopen (filename, "rb"); //rb = read
<br/>
   if(testRead)
<br/>
   {
<br/>
   fseek(testRead, 54, SEEK_SET); // palette is 54 bytes from start of file
<br/>
   unsigned char col[4];
<br/>
   int temp;
<br/>
   for(temp=0; temp&lt;16; temp++) // read the palette info
<br/>
   {
<br/>
      fread(col, sizeof(char), 4, testRead);      
<br/>
      sprite0_Pal[temp]=PA_RGB(col[2]&gt;&gt;3,col[1]&gt;&gt;3,col[0]&gt;&gt;3);
<br/>
   }   
<br/>
   u8 row[16*32];
<br/>
   fread(row,sizeof(u8),512,testRead); // read the full icon directly from the file
<br/>
   int tile,x,y,tempx=0,tempy=0,width=16,smp=0;   
<br/>
   for (tile = 0; tile &lt; 16; tile++){
<br/>
   for (y = 0; y &lt; 8; y++){    
<br/>
      for (x = 0; x &lt;4; x++) {
<br/>
         temp = row[tempx + x + (31-(tempy+y))*width];
<br/>
         sprite0_Sprite[(tile &lt;&lt; 6) + (x*2) + (y &lt;&lt; 3)] = (temp&amp;240)&gt;&gt;4;
<br/>
         sprite0_Sprite[1+(tile &lt;&lt; 6) + (x*2) + (y &lt;&lt; 3)] = temp&amp;15;
<br/>
         smp++;
<br/>
      }
<br/>
   }// x
<br/>
   tempx += 4; 
<br/>
   if (tempx &gt;= width) {
<br/>
      tempy += 8;
<br/>
      tempx = 0;
<br/>
   }// y
<br/>
}// tile
<br/>
<br/>
   
<br/>
   fclose(testRead);
<br/>
   PA_CreateSprite(0, sprite_number, (void*)sprite0_Sprite, // Blank sprite !
<br/>
               OBJ_SIZE_32X32, // Sprite size
<br/>
               1, 0, // Sprite palette number
<br/>
               100, 0); // In the upper left corner
<br/>
<br/>
   PA_LoadSpritePal(0, // Screen
<br/>
               0, // Palette number
<br/>
               (void*)sprite0_Pal);   // Palette name
<br/>
<br/>
   }// end if testread   
<br/>
<br/>
}
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/>I'm not a boring person, it's just that boring things keep happening to me.
<br/>
<a class="postlink" href="http://spinal.dizidesigns.co.uk/" target="_blank">Homepage</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
