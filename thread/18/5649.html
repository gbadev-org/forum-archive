<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Better Touch Code - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Better Touch Code</h2>
<div id="posts">
<div class="post">
    <h4>#42096 - Pacifist - Thu May 05, 2005 9:26 pm</h4>
    <div class="postbody"><span class="postbody">I've been using Darkain's calibration code to read the touch-screen.
<br/>
<br/>
Like everyone else it works very well for me except that I get those shooting lines into the middle of the screen when using the darkstar paint program.
<br/>
<br/>
I've found a way to eliminate this effect in my own project using natrium42's under pressure code.
<br/>
<br/>
Instead of reading the DS's guess at if the pen is down 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
return( ((~IPC-&gt;buttons) &lt;&lt; 6) &amp; (1&lt;&lt;12) );
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
You roll your own touchPressed method by stealing natruims code straight out of his demo:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
int TouchPad::touchPressed()
<br/>
{ 
<br/>
   uint16 touchZ1 = IPC-&gt;touchZ1;
<br/>
   uint16 touchZ2 = IPC-&gt;touchZ2;
<br/>
   uint16 touchX = IPC-&gt;touchX;
<br/>
<br/>
   uint16 pressure = (touchX * touchZ2) / (64 * touchZ1) - touchX / 64;
<br/>
<br/>
   if( pressure &gt; 0 &amp;&amp; pressure &lt; MAX_PRESSURE )
<br/>
      return 1;
<br/>
   else
<br/>
      return 0;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Using a MAX_PRESSURE of 70 I get no anomolous readings and, strangely enough, a more sensitive touch pad.
<br/>
<br/>
I am worried that all the DS's are going to have different touch threshholds though and am curious about other people's findings with this code.
<br/>
<br/>
(when experimenting remember that lower numbers represent higher pressures)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#42110 - DaBigJHall - Fri May 06, 2005 3:08 am</h4>
    <div class="postbody"><span class="postbody">I tried something similar; I modified the ARM7 stub so it calculates the pressure and doesn't actually fill in the relevant members of the IPC unless 5 &lt; pressure &lt; 75.  One less thing for the ARM9 to do :D.  For some reason the shooting-lines-things were reading a pressure of 0, that's why I made a lower limit of 5.  Did you notice anything like this?  I wonder if it's just my DS, since the touch screen's a little scratched.<br/>_________________<br/>Yep, it's a signature.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#42116 - Pacifist - Fri May 06, 2005 6:13 am</h4>
    <div class="postbody"><span class="postbody">no I actually tested for that specifically.  
<br/>
<br/>
I was a little surprised that zero worked for me but I'll change it to 5 now that I know that isn't true of all DSs.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#42138 - Darkain - Fri May 06, 2005 5:20 pm</h4>
    <div class="postbody"><span class="postbody">the problem is that his code isnt correct.  between my two units, one of them has a NORMAL pressure of around 70 (and maxs around 90 for errors), and the other has normal around 20, and around 30 for errors.  i used to use his code, and everyone complained because the touch screen no longer worked.
<br/>
<br/>
its a nice theory, but bad in practice, sorries.  :(
<br/>
<br/>
[EDIT]
<br/>
in <a class="postlink" href="http://ds.darkain.com/hack" target="_blank">DarkStar</a>, in the debug screen, if you look at the top, you will see "TOUCH Z" followed by 2 numbers.  the first number is a pair of 16 bit values representing Z1 and Z2, the second value is the calculated pressure value using natriums code, for anyone curious (damn, i love that debug screen :)
<br/>
[/EDIT]<br/>_________________<br/>-=- Darkain Dragoon -=-
<br/>
<a class="postlink" href="http://www.darkain.com" target="_blank">http://www.darkain.com</a>
<br/>
<a class="postlink" href="http://ds.darkain.com/hack" target="_blank">DarkStar</a> for <a class="postlink" href="http://ds.darkain.com" target="_blank">Nintendo DS</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#42140 - Pacifist - Fri May 06, 2005 5:55 pm</h4>
    <div class="postbody"><span class="postbody">So natrium's formula is TI's pressure formula 
<br/>
<br/>
pressure = "resistance across the x-plate" * (touchX/4096) * ( (touchZ2/touchZ1)-1 )
<br/>
<br/>
multiplied by 64 and without the resistance across the x-plate.
<br/>
<br/>
Is it possible that the resistance would somehow normalize the pressure value between different DSs?
<br/>
<br/>
Presumably we don't have access to the pressure accross the x plate or natrium would have included it in his formula, correct?
<br/>
<br/>
Also, I assume the DS doesn't store callibration information for Z values.  :/
<br/>
<br/>
Using natrium's pressure formula just works so well I don't want to give it up.  It should be reasonably easy to callibrate a pressure based on the user navigating the start menus of a game.
<br/>
<br/>
Failing that the first few actions in gameplay could be used.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
