<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Not working .nds booter - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Not working .nds booter</h2>
<div id="posts">
<div class="post">
    <h4>#122973 - Lick - Sat Mar 24, 2007 1:35 am</h4>
    <div class="postbody"><span class="postbody"><a class="postlink" href="http://lickr.org/files/launcher.zip" target="_blank">http://lickr.org/files/launcher.zip</a>
<br/>
<br/>
I'm kind of stuck with this NDS file bootstub. It's supposed to be copied by the ARM9 to VRAM, then ran from ARM7. The bootstub itself will search for the DLDI section in Main RAM, and copy it over its own DLDI section that is in VRAM. Then it initializes FAT using the copied DLDI section, and it loads the requested file (currently static filename "launchee.nds").
<br/>
<br/>
The problem is that if FAT was initialized in the launcher, then the bootstub will magically stay at white screens. 
<br/>
If FAT was never initialized in the launcher, but there is a DLDI section (and you patch it correctly), the the bootstub WORKS. It successfully copies the Main RAM-DLDI to its own VRAM-DLDI and boots the "launchee.nds".
<br/>
I'm not really expecting someone to know how this bug can be fixed, but I'm just posting all the code, so someone could at least try.
<br/>
<br/>
And yes, I know that I could make the ARM9 run the bootstub and let the ARM7 idle, which is what MightyMax' exec_stub does. BUT I really want this to work as it fits perfectly into rebootlib in this form.
<br/>
<br/>
Thanks for reading.<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123025 - Diddl - Sat Mar 24, 2007 6:15 pm</h4>
    <div class="postbody"><span class="postbody">don't understand why ARM7 doesn't work in same manner as the ARM9. but why do you use this old gba_nds_fat solution? libfat works much better and much faster and more secure. gba_nds_fat has many bugs in it ...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123027 - GrizzlyAdams - Sat Mar 24, 2007 6:26 pm</h4>
    <div class="postbody"><span class="postbody">I'm thinking that there may be something in the dldi you are using thats modified when its initialized. try making a backup copy of the dldi in your arm9 main before you call fat init, then patch the arm7 stub with the backup on the arm9 before you hand it over to the arm7.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123048 - Lick - Sat Mar 24, 2007 9:19 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Diddl wrote:</b></span></td> </tr> <tr> <td class="quote">don't understand why ARM7 doesn't work in same manner as the ARM9. but why do you use this old gba_nds_fat solution? libfat works much better and much faster and more secure. gba_nds_fat has many bugs in it ...</td> </tr></table><span class="postbody">
<br/>
libfat gives me white screens with only having linked to it! It's because it uses malloc and the ARM7 doesn't play along. 
<br/>
<br/>
GrizzlyAdams: I will try that.<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123123 - Diddl - Sun Mar 25, 2007 10:39 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lick wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
libfat gives me white screens with only having linked to it! It's because it uses malloc and the ARM7 doesn't play along. </td> </tr></table><span class="postbody">
<br/>
<br/>
I believe it doesn't use malloc() if you don't use buffering (buffers = 0). in this case speed is slow like at gba_nds_fat, but it should work.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123127 - chishm - Sun Mar 25, 2007 11:07 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Diddl wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lick wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
libfat gives me white screens with only having linked to it! It's because it uses malloc and the ARM7 doesn't play along. </td> </tr></table><span class="postbody">
<br/>
<br/>
I believe it doesn't use malloc() if you don't use buffering (buffers = 0). in this case speed is slow like at gba_nds_fat, but it should work.</span></td> </tr></table><span class="postbody">
<br/>
It forces at least 2 cache sectors. Also, look at the source of libfat. You can remove its reliance on malloc by supplying your own allocator in mem_alloc.h. This won't remove the DKA reliance on malloc though.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
