<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>libnds: Why is swiSleep implemntd with swi 7 and not swi 1F? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > libnds: Why is swiSleep implemntd with swi 7 and not swi 1F?</h2>
<div id="posts">
<div class="post">
    <h4>#126517 - jdogalt - Tue Apr 24, 2007 1:06 am</h4>
    <div class="postbody"><span class="postbody">I may just be misreading code, but can someone (wintermute?) tell me why in 
<br/>
<br/>
libnds/source/common/biosCalls.s
<br/>
<br/>
that swiSleep is defined using swi 0x07?
<br/>
<br/>
It seems to me from reading the specs at neimod.com/dstek that swiSleep should be implemented as a cut and paste of how swiSwitchToGBAMode is implemented, but replacing the #0x40 with #0xC0.  (i.e. using swi 0x1F).
<br/>
<br/>
What confuses me even more, is the comments which read-
<br/>
<br/>
// swiSleep (swi 0x07)
<br/>
//    Same as swiSetHaltCR(0xC0)
<br/>
// swiSwitchToGBAMode (not a SWI)
<br/>
//    Same as swiSetHaltCR(0x40)
<br/>
// swiSetHaltCR (swi 0x1F)
<br/>
//    Writes a byte of the data to 0x04000301:8
<br/>
<br/>
I don't know where to begin.  Lets start with the "not a SWI" on swiSwitchToGBAMode, which from my reading of the code, absolutely is an swi 0x1F.  And then from there and the various reading of the code I can't see how swiSleep is different from swiSwitchToGBAMode.  And given the neimod.com/dstek specs, they would appear to me to be very similar sorts of things.
<br/>
<br/>
Now then, just to give some context and hope that I can get some help with my real problems...  What I'm trying to accomplish is to write a pager application for the NDS that is as efficient as possible.  So far, without using the above sleep (regardless of whether or not it is already implemented correctly), I can achieve 16 hours of battery life, doing an intrWait(arm9) for 10 seconds on the timers, and waking up and doing maybe 0.1 seconds of grabbing wifi packets.
<br/>
<br/>
However, given my testing of the Nintendogs pictochat search mode, I believe it should be possible to nearly double that.  I.e. I saw at least 28 hours of battery life in that mode.  (where it is doing more or less what I want- polling wifi while in as deep a sleep as possible, and alerting the user if an interesting network condition occurs)
<br/>
<br/>
Now, if someone wants to actually reverse engineer the nintendogs code to find out what its actually doing- well, I'd be seriously grateful.  But thats a bit more involved than I am currently skilled and wanting to go to.
<br/>
<br/>
Basically my plan now is to replace my intrWait, with swiSleep (as is, or I'll try reimplementing myself as a copy of the switchtogbamode_with_0xC0 since that seems like what it should be).  Does anybody happen to know if there is something wrong with that strategy?  Also, the neimod.com/dstek spec was vague about the arm9 going into low power mode, sort of suggesting it would happen automatically when the arm7 goes to deep sleep.
<br/>
<br/>
One other thought is- is it possible to run just on the arm7, and effectively leave the arm9 off?  At one point I thought I ran across something suggesting that the arm9 was what needed to control the vibration motor in my supercard-lite-microsd-rumble.  So I'm thinking that may not be really possible.
<br/>
<br/>
Anyway, if anyone has actually bothered to read this far, I bet you have some insight that will help me.  Please reply :)
<br/>
<br/>
Thanks,
<br/>
<br/>
(I did search the forum for swiSleep and found one interesting thread with code.  I'm certainly not at the point that I'm stuck and have nothing to try, but I'm hoping some guru out there might save me the trouble of going down a few more non-optimal or outright wrong paths).
<br/>
<br/>
-dmc/jdog</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#126519 - HyperHacker - Tue Apr 24, 2007 1:13 am</h4>
    <div class="postbody"><span class="postbody">The ARM7 should be able to control the rumble motor if you give it access to slot-2.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#126528 - jdogalt - Tue Apr 24, 2007 2:11 am</h4>
    <div class="postbody"><span class="postbody">I should mention, that I just looked at a few more surrounding lines of text on neimod.com/dstek, and they do explicitly mention the swi07 sleep.
<br/>
<br/>
But that begs the question-  What difference if any is there between swi07, and swi1F with an argument of 0xC0 ???
<br/>
<br/>
I suppose eventually I'll get around to exhaustively testing all the possibilities in my quest for efficiency.
<br/>
<br/>
Speaking of which- can anyone point me to any info on the possibility (or impossibility) of running code only on the arm7, and keeping the arm9 in a permanently lowest power mode (would just halting it accomplish that?).  If not, I can certainly think of a few ways to just try it out and measure the results myself.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
