<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Possible PSG bug in libnds and other audio questions... - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Possible PSG bug in libnds and other audio questions...</h2>
<div id="posts">
<div class="post">
    <h4>#167077 - Rotsiser_Mho - Sat Feb 28, 2009 8:25 am</h4>
    <div class="postbody"><span class="postbody">Hi all,
<br/>
<br/>
I'm brand new to DS development, so if my problem here is stupid, I apologize in advance.
<br/>
<br/>
I created a very tiny program to mess around with the PSG sound channels.  Unfortunately, it seems that no matter what I set the duty cycle to, it all sounds the same.  I've checked out the PSG capabilities in AXE so I know I can hear the difference, but that code seems a bit out of date (I'm assuming the hip new thing is to not write custom ARM7 code?).
<br/>
<br/>
In any case, here is how I have my code set up currently.  It's horrible, but I don't think I'm doing anything wrong.  If so, libnds is not correctly passing the duty cycle parameter on to the appropriate sound register.  Any thoughts?
<br/>
<br/>
Also, what would be the most efficient way to get a close approximation of the NES triangle wave?  Can the PSG come reasonably close?
<br/>
Thanks!
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
soundEnable();
<br/>
mySound1 = soundPlayPSG(DutyCycle_12, 2094,5, 64);
<br/>
mySound2 = soundPlayPSG(DutyCycle_87, 2094,5, 64);
<br/>
while(1)  {
<br/>
   scanKeys();
<br/>
   touchRead(&amp;touch);
<br/>
   if(keysHeld() &amp; KEY_TOUCH) {
<br/>
   if (touch.rawy &lt; 2000) {
<br/>
      if (touch.rawx &lt;= 760)
<br/>
         soundSetFreq(mySound1, 1047 * 2);
<br/>
      if ((touch.rawx &gt; 760) &amp;&amp; (touch.rawx &lt;= 1235))
<br/>
         soundSetFreq(mySound1, 1175 * 2);
<br/>
      if ((touch.rawx &gt; 1235) &amp;&amp; (touch.rawx &lt;= 1675))
<br/>
         soundSetFreq(mySound1, 1319 * 2);
<br/>
      if ((touch.rawx &gt; 1675) &amp;&amp; (touch.rawx &lt;= 2130))
<br/>
         soundSetFreq(mySound1, 1397 * 2);
<br/>
      if ((touch.rawx &gt; 2130) &amp;&amp; (touch.rawx &lt;= 2570))
<br/>
         soundSetFreq(mySound1, 1568 * 2);
<br/>
      if ((touch.rawx &gt; 2570) &amp;&amp; (touch.rawx &lt;= 3010))
<br/>
         soundSetFreq(mySound1, 1760 * 2);
<br/>
      if ((touch.rawx &gt; 3010) &amp;&amp; (touch.rawx &lt;= 3480))
<br/>
         soundSetFreq(mySound1, 1976 * 2);
<br/>
      if (touch.rawx &gt; 3480)
<br/>
         soundSetFreq(mySound1, 2093 * 2);
<br/>
      soundResume(mySound1);
<br/>
      soundPause(mySound2);
<br/>
      }
<br/>
   else {
<br/>
      if (touch.rawx &lt;= 760)
<br/>
         soundSetFreq(mySound2, 1047 * 2);
<br/>
      if ((touch.rawx &gt; 760) &amp;&amp; (touch.rawx &lt;= 1235))
<br/>
         soundSetFreq(mySound2, 1175 * 2);
<br/>
      if ((touch.rawx &gt; 1235) &amp;&amp; (touch.rawx &lt;= 1675))
<br/>
         soundSetFreq(mySound2, 1319 * 2);
<br/>
      if ((touch.rawx &gt; 1675) &amp;&amp; (touch.rawx &lt;= 2130))
<br/>
         soundSetFreq(mySound2, 1397 * 2);
<br/>
      if ((touch.rawx &gt; 2130) &amp;&amp; (touch.rawx &lt;= 2570))
<br/>
         soundSetFreq(mySound2, 1568 * 2);
<br/>
      if ((touch.rawx &gt; 2570) &amp;&amp; (touch.rawx &lt;= 3010))
<br/>
         soundSetFreq(mySound2, 1760 * 2);
<br/>
      if ((touch.rawx &gt; 3010) &amp;&amp; (touch.rawx &lt;= 3480))
<br/>
         soundSetFreq(mySound2, 1976 * 2);
<br/>
      if (touch.rawx &gt; 3480)
<br/>
         soundSetFreq(mySound2, 2093 * 2);
<br/>
      soundResume(mySound2);
<br/>
      soundPause(mySound1);
<br/>
      }
<br/>
   }
<br/>
else {
<br/>
      soundPause(mySound1);
<br/>
      soundPause(mySound2);
<br/>
   }
<br/>
   swiWaitForVBlank();
<br/>
}</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167078 - Dwedit - Sat Feb 28, 2009 10:08 am</h4>
    <div class="postbody"><span class="postbody">A NES triangle wave is a 32 byte looping waveform, consisting of 15 steps going up and down.  Just use the DS's normal sound channels for that.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
