<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>I need some input from DS coding gurus; - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > I need some input from DS coding gurus;</h2>
<div id="posts">
<div class="post">
    <h4>#153078 - NeX - Mon Mar 24, 2008 8:31 pm</h4>
    <div class="postbody"><span class="postbody">I'm back coding SandScape again.  I've decided to move the simulation to the ARM7 because of the reduced memory latencies.  I've got a fairly crude system working - is there a quicker/more efficient way of doing this?
<br/>
<br/>
ARM7 writes and reads VRAM bank D for high speed, low latency random access.
<br/>
<br/>
When it finishes its business, it copies the data to VRAM C.
<br/>
<br/>
ARM9 then gets access, and puts it on the screen.
<br/>
<br/>
ARM7 continues working on VRAM D, and VRAM C is handed back.  Repeat.
<br/>
<br/>
The data is roughly 50kb, so I don't think the IPC is really up to this.  This would be happening 30 times a second.  This looks to be the fastest way, if complicated.  I know it's working because I've got some ARM7 code changing the BG palette.<br/>_________________<br/><a class="postlink" href="http://www.mediafire.com/?cuyb10fzdz2" target="_blank">Strummer</a> or <a class="postlink" href="http://www.mediafire.com/?71zxcztscix" target="_blank">Drummer?</a>.  
<br/>
Or maybe you would rather play with sand? <a class="postlink" href="http://www.mediafire.com/?a05z5wmdvxm" target="_blank">Sandscape is for you in that case.</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153085 - NeX - Mon Mar 24, 2008 9:23 pm</h4>
    <div class="postbody"><span class="postbody">Also, is it possible to multiply a number by 32 using a bitshift?  It would really increase the speed referencing the reactions table.  I'm accessing my VRAM using a define:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define REACT ((u8*)0x0602DE20)</td> </tr></table><span class="postbody">
<br/>
<br/>
I am finding the entry like this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">REACT[(MyMaterial*32)+TheirMaterial];</td> </tr></table><span class="postbody">
<br/>
<br/>
But somehow that seems hacky.<br/>_________________<br/><a class="postlink" href="http://www.mediafire.com/?cuyb10fzdz2" target="_blank">Strummer</a> or <a class="postlink" href="http://www.mediafire.com/?71zxcztscix" target="_blank">Drummer?</a>.  
<br/>
Or maybe you would rather play with sand? <a class="postlink" href="http://www.mediafire.com/?a05z5wmdvxm" target="_blank">Sandscape is for you in that case.</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153086 - Dwedit - Mon Mar 24, 2008 9:24 pm</h4>
    <div class="postbody"><span class="postbody">Compilers automatically change multiplication by a power of 2 to a bitshift.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153087 - NeX - Mon Mar 24, 2008 9:27 pm</h4>
    <div class="postbody"><span class="postbody">Really?  Thanks.
<br/>
<br/>
One last question:  If I access memory using a boolean, i.e.:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define MOVED ((bool*)0x06021800)</td> </tr></table><span class="postbody">
<br/>
<br/>
Is it placing a bool at every address (and wasting 7 bits per entry) or compacting it quite nicely?<br/>_________________<br/><a class="postlink" href="http://www.mediafire.com/?cuyb10fzdz2" target="_blank">Strummer</a> or <a class="postlink" href="http://www.mediafire.com/?71zxcztscix" target="_blank">Drummer?</a>.  
<br/>
Or maybe you would rather play with sand? <a class="postlink" href="http://www.mediafire.com/?a05z5wmdvxm" target="_blank">Sandscape is for you in that case.</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153104 - TwentySeven - Mon Mar 24, 2008 11:48 pm</h4>
    <div class="postbody"><span class="postbody">sizeof(bool) == 1</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153107 - strager - Tue Mar 25, 2008 1:21 am</h4>
    <div class="postbody"><span class="postbody">Are you rendering to the VRAM bank as if it were a VRAM bank?  An idea: treat each of VRAM bank C and D as a framebuffer (e.g. GBA doublebuffer modes).  After each update, give the ARM7 access to one and the ARM9 (thus the GPU) access to the other.  No need to copy data or anything; just send a simple "ready" message from the ARM9 to signal the buffer switch.
<br/>
<br/>
Unless VRAM data is not maintained when switching CPU access.  That would ruin the whole idea.  =[</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153159 - Miked0801 - Tue Mar 25, 2008 8:50 pm</h4>
    <div class="postbody"><span class="postbody">Man I wish I could use the ARM7 for stuff.
<br/>
<br/>
Bools are usually defined as u32s or u8s.  You can manually set them up as bit-fields as needed, but there is a speed hit for doing this.  Don't bother unless you have an array.
<br/>
<br/>
You are using VRAM as a RAM buffer?  Ok.
<br/>
<br/>
Yes, compilers will change muls to shifts when it makes sense - but muls are cheap now 2-5 cycles depending on the MSBit of the operands.  Muls don't kill on DS, divides memory access, and cache misses do.
<br/>
<br/>
BTW, your array define has 2 inherent muls within it (depending on range), which shows just how often you have to multiply.
<br/>
<br/>
That's all I got at first glance.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
