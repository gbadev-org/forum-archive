<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Large sprite tile numbers, ie > 1023 - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > Large sprite tile numbers, ie > 1023</h2>
<div id="posts">
<div class="post">
    <h4>#141708 - NeX - Fri Sep 28, 2007 7:39 pm</h4>
    <div class="postbody"><span class="postbody">They don't seem to work... is this a limitation of the DS?  If so, what's the point of 4096 16-colour sprite tiles?  1024 loops back to 0, 1025 to 1.<br/>_________________<br/><a class="postlink" href="http://www.mediafire.com/?cuyb10fzdz2" target="_blank">Strummer</a> or <a class="postlink" href="http://www.mediafire.com/?71zxcztscix" target="_blank">Drummer?</a>.  
<br/>
Or maybe you would rather play with sand? <a class="postlink" href="http://www.mediafire.com/?a05z5wmdvxm" target="_blank">Sandscape is for you in that case.</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141716 - strager - Fri Sep 28, 2007 8:53 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>NeX wrote:</b></span></td> </tr> <tr> <td class="quote">They don't seem to work... is this a limitation of the DS?  If so, what's the point of 4096 16-colour sprite tiles?  1024 loops back to 0, 1025 to 1.</td> </tr></table><span class="postbody">
<br/>
<br/>
See bits 20 and 21 of DISPLAY_CR.  They specify the step of each index in an OAM sprite.  This only works for 1D mode, AFAIK.
<br/>
<br/>
Basically, you can calculate the address of the tile based on the index with something like:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define TILE_SIZE_BYTE (8 * 8 / 2) /* 16-color mode */
<br/>
//#define TILE_SIZE_BYTE (8 * 8) /* 256-color mode */
<br/>
<br/>
int boundary = (DISPLAY_CR &gt;&gt; 20) &amp; 3;
<br/>
u16 *address = (u16 *)((u8 *)sprite_data_base + index * (TILE_SIZE_BYTE &lt;&lt; boundary));
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I *think*.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>GBATEK wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">OBJ Tile Mapping (DISPCNT.4,20-21):
<br/>
<br/>
  Bit4  Bit20-21  Dimension Boundary Total ;Notes
<br/>
  0     x         2D        32       32K   ;Same as GBA 2D Mapping
<br/>
  1     0         1D        32       32K   ;Same as GBA 1D Mapping
<br/>
  1     1         1D        64       64K
<br/>
  1     2         1D        128      128K
<br/>
  1     3         1D        256      256K  ;Engine B: 128K max
<br/>
<br/>
TileVramAddress = TileNumber * BoundaryValue
<br/>
Even if the boundary gets changed, OBJs are kept composed of 8x8 tiles.
<br/>
<br/>
Bitmap OBJ Mapping (DISPCNT.6,5,22):
<br/>
Bitmap OBJs are 15bit Direct Color data, plus 1bit Alpha flag (in bit15).
<br/>
<br/>
  Bit6 Bit5 Bit22 Dimension    Boundary   Total ;Notes
<br/>
  0    0    x     2D/128 dots  8x8 dots   128K  ;Source Bitmap width 128 dots
<br/>
  0    1    x     2D/256 dots  8x8 dots   128K  ;Source Bitmap width 256 dots
<br/>
  1    0    0     1D           128 bytes  128K  ;Source Width = Target Width
<br/>
  1    0    1     1D           256 bytes  256K  ;Engine A only
<br/>
  1    1    x     Reserved
<br/>
<br/>
In 1D mapping mode, the Tile Number is simply multiplied by the boundary value.
<br/>
<br/>
  1D_BitmapVramAddress = TileNumber(0..3FFh) * BoundaryValue(128..256)
<br/>
  2D_BitmapVramAddress = (TileNo AND MaskX)*10h + (TileNo AND NOT MaskX)*80h
<br/>
<br/>
In 2D mode, the Tile Number is split into X and Y indices, the X index is located in the LSBs (ie. MaskX=0Fh, or MaskX=1Fh, depending on DISPCNT.5).</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141717 - NeX - Fri Sep 28, 2007 8:56 pm</h4>
    <div class="postbody"><span class="postbody">Goodness me, that's complicated.  I think I'll just manage my memory more efficiently...<br/>_________________<br/><a class="postlink" href="http://www.mediafire.com/?cuyb10fzdz2" target="_blank">Strummer</a> or <a class="postlink" href="http://www.mediafire.com/?71zxcztscix" target="_blank">Drummer?</a>.  
<br/>
Or maybe you would rather play with sand? <a class="postlink" href="http://www.mediafire.com/?a05z5wmdvxm" target="_blank">Sandscape is for you in that case.</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141724 - strager - Fri Sep 28, 2007 9:11 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>NeX wrote:</b></span></td> </tr> <tr> <td class="quote">Goodness me, that's complicated.  I think I'll just manage my memory more efficiently...</td> </tr></table><span class="postbody">
<br/>
<br/>
It's actually not too complicated.  If you only have 16x16 sized sprites, for example, you can set the boundary to 2 (which is * 4) so you can index them more easily without calculating the real index from the logical index.  Similarly, you can use 1 for 16x8 or 8x16 and 3 for 32x16 or 16x32.
<br/>
<br/>
If you had proper sprite support functions this would be simple, assuming not everything is hard-coded.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141737 - The_Perfection - Fri Sep 28, 2007 11:20 pm</h4>
    <div class="postbody"><span class="postbody"><a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=13901&amp;highlight=&amp;sid=3f3a60ba4fc7dbda92d430b01e6b2bbf" target="_blank">This thread</a> may be helpful.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
