<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Tiled Background - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Tiled Background</h2>
<div id="posts">
<div class="post">
    <h4>#102657 - Caladus - Fri Sep 15, 2006 11:20 pm</h4>
    <div class="postbody"><span class="postbody">I have been messing around with this and I just can't seem to get it to display.  I am using the same palette as my exrot, so I figure I don't have to mess with the palette.  I am trying to get it into VRam D, here is my code
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void setUpText() {
<br/>
   int mapbase = 7575;
<br/>
   int tilebase = 1515 + 1;
<br/>
   BG2_CR = BG_COLOR_16 | 
<br/>
          BG_32x32 |
<br/>
          BG_MAP_BASE(mapbase) | 
<br/>
          BG_TILE_BASE(tilebase) | 
<br/>
          BG_PRIORITY(2);
<br/>
   dmaCopy(MyFont_Bitmap, (uint16*)CHAR_BASE_BLOCK(tilebase), sizeof(MyFont_Bitmap));
<br/>
   for(int x = 0; x &lt; 32; x++){
<br/>
      for(int y = 0; y &lt; 24; y++){
<br/>
         ((uint16*)SCREEN_BASE_BLOCK(mapbase))[32*y+x] = 32;
<br/>
      }
<br/>
   }
<br/>
}</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102660 - Caladus - Fri Sep 15, 2006 11:25 pm</h4>
    <div class="postbody"><span class="postbody">I am very sorry.  In my haste I seem to have created another thread instead of replying in my current one.  I can't seem to find a way to remove this thread.  If a moderator sees this, please merge the two.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102673 - tepples - Fri Sep 15, 2006 11:55 pm</h4>
    <div class="postbody"><span class="postbody">This forum is a pretty much stock phpBB. In phpBB, unlike in some other forum software, moderators cannot merge topics. Sorry :(<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102675 - Caladus - Fri Sep 15, 2006 11:58 pm</h4>
    <div class="postbody"><span class="postbody">Oh well, I sappose I deserve to look like an idiot for not paying more attention.  Also, the values for the bases in my code should be 75 and 16.  Typo</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102686 - knight0fdragon - Sat Sep 16, 2006 3:28 am</h4>
    <div class="postbody"><span class="postbody">WHOA WHOA WHOA  some of your stuff is crazy
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
void setUpText() { 
<br/>
   uint16* mapbase = SCREEN_BASE_BLOCK(0); 
<br/>
   uint16* tilebase = CHAR_BASE_BLOCK(1); 
<br/>
   BG2_CR = BG_COLOR_16 | 
<br/>
          BG_32x32 | 
<br/>
          BG_MAP_BASE(0) | 
<br/>
          BG_TILE_BASE(1) | 
<br/>
          BG_PRIORITY(2); 
<br/>
   dmaCopy(MyFont_Bitmap, tilebase, sizeof(MyFont_Bitmap)); 
<br/>
   for(int x = 0; x &lt; 32; x++){ 
<br/>
      for(int y = 0; y &lt; 24; y++){ 
<br/>
         mapbase[32*y+x] = 32; 
<br/>
      } 
<br/>
   } 
<br/>
}
<br/>
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/><a href="http://www.myspace.com/knight0fdragonds" target="_blank">http://www.myspace.com/knight0fdragonds</a>
<br/>
<br/>
MK DS FC: Dragon 330772 075464 
<br/>
AC WW FC: Anthony SamsClub 1933-3433-9458 
<br/>
MPFH: Dragon 0215 4231 1206</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102741 - Caladus - Sat Sep 16, 2006 4:10 pm</h4>
    <div class="postbody"><span class="postbody">Thanks, that works wonderfully except that it writes data over the top of my exrot that is already taking up VRam A and B.  I am attempting to store the data in VRamD now.  I have been trying map = 75, tile = 15 for the base values, because 0x60000/0x4000 and 0x800 is 15 and 75.  Maybe my concept of this math is wrong, perhaps the values are hex.  I would be very greatful for the correct values to store this data in VRamD.  Once I see the values, I know it will all make sense.  Thanks</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102743 - Caladus - Sat Sep 16, 2006 4:49 pm</h4>
    <div class="postbody"><span class="postbody">Actually, its not working.  I have no idea what I am doing wrong
<br/>
I made a 8x760 bitmap, I put one character in each 8x8 pixel block.  I used the following line to convert it into a raw.c
<br/>
gfx2gba -fsrc -m -pDemoFont.pal -t8 DemoFont.bmp
<br/>
<br/>
I then used the section of code listed above.  The first character is blank, and when I put 0 in for the map values, the bg is transparent, which is good, but for every other value 1-95, I get things that I didn't draw.  Also, my 512x512 exrot which takes up VRam A and B has a section that is flawed, which I am assuming is the tile data being written over the 512 because the map and screen bases are not high enough.  This is so very frustrating, but I am determined to figure it out.  Any guidance would be very appreciated.
<br/>
<br/>
BTW, the prompt responces and time you have put into answering my questions is greatly appreciated knight0fdragon.  I know it must be hard helping newbies like me get on the right path, but every time I recieve a responce to a very frustrating question is like Christmas all over agian.  Thanks</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102747 - knight0fdragon - Sat Sep 16, 2006 5:54 pm</h4>
    <div class="postbody"><span class="postbody">You want this on the sub screen I am assuming
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   uint16* mapbase = SCREEN_BASE_BLOCK_SUB(0); 
<br/>
   uint16* tilebase = CHAR_BASE_BLOCK_SUB(1); 
<br/>
   BG2_CR_SUB = BG_COLOR_16 | 
<br/>
          BG_32x32 | 
<br/>
          BG_MAP_BASE(0) | 
<br/>
          BG_TILE_BASE(1) | 
<br/>
          BG_PRIORITY(2); 
<br/>
   dmaCopy(MyFont_Bitmap, tilebase, sizeof(MyFont_Bitmap)); 
<br/>
   for(int x = 0; x &lt; 32; x++){ 
<br/>
      for(int y = 0; y &lt; 24; y++){ 
<br/>
         mapbase[32*y+x] = 32; 
<br/>
      } 
<br/>
   } 
<br/>
}  
<br/>
<br/>
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/><a href="http://www.myspace.com/knight0fdragonds" target="_blank">http://www.myspace.com/knight0fdragonds</a>
<br/>
<br/>
MK DS FC: Dragon 330772 075464 
<br/>
AC WW FC: Anthony SamsClub 1933-3433-9458 
<br/>
MPFH: Dragon 0215 4231 1206</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102751 - Caladus - Sat Sep 16, 2006 6:14 pm</h4>
    <div class="postbody"><span class="postbody">I was hoping to have it on the main screen to show how sprites, exrots and tiled bgs can all go on the same screen.  Let me give you some more of my code to explain things better.
<br/>
<br/>
int main() {
<br/>
<br/>
    powerON(POWER_ALL_2D);
<br/>
<br/>
    irqInit();
<br/>
    irqSet(IRQ_VBLANK, vBlank);
<br/>
<br/>
    vramSetBankA(VRAM_A_MAIN_BG_0x6000000);
<br/>
    vramSetBankB(VRAM_B_MAIN_BG_0x6020000);
<br/>
    vramSetBankC(VRAM_C_SUB_BG_0x6200000);
<br/>
    vramSetBankD(VRAM_D_MAIN_BG_0x6060000);
<br/>
    vramSetBankE(VRAM_E_MAIN_SPRITE);
<br/>
    vramSetBankF(VRAM_F_MAIN_SPRITE);
<br/>
    vramSetBankG(VRAM_G_MAIN_SPRITE);
<br/>
    vramSetBankI(VRAM_I_LCD);
<br/>
<br/>
    videoSetMode(MODE_3_2D | 
<br/>
    	         DISPLAY_SPR_ACTIVE | 
<br/>
	         DISPLAY_BG3_ACTIVE | 
<br/>
	         DISPLAY_BG2_ACTIVE | 
<br/>
	         DISPLAY_SPR_1D);
<br/>
<br/>
   videoSetModeSub(MODE_3_2D | 				              DISPLAY_BG3_ACTIVE);
<br/>
<br/>
	BG3_CR = BG_BMP8_512x512 | BG_BMP_BASE(0) | BG_PRIORITY(3);
<br/>
	BG3_XDX = 1 &lt;&lt; 8; //scale x
<br/>
	BG3_XDY = 0; //rotation x
<br/>
	BG3_YDX = 0; //rotation y
<br/>
	BG3_YDY = 1 &lt;&lt; 8; //scale y
<br/>
	BG3_CX = 0; //translation x
<br/>
	BG3_CY = 0; //translation y
<br/>
<br/>
	SUB_BG3_CR = BG_BMP16_256x256 | BG_BMP_BASE(0) | BG_PRIORITY(3);
<br/>
	SUB_BG3_XDX = 1 &lt;&lt; 8; //scale x
<br/>
	SUB_BG3_XDY = 0; //rotation x
<br/>
	SUB_BG3_YDX = 0; //scale y
<br/>
	SUB_BG3_YDY = 1 &lt;&lt; 8; //scale y
<br/>
	SUB_BG3_CX = 0; //translation x
<br/>
	SUB_BG3_CY = 0; //translation y
<br/>
<br/>
	dmaCopy(Background1_bin, BG_GFX, 512 * 512);
<br/>
	dmaCopy(background1Pal_bin, BG_PALETTE, 256*2);
<br/>
	dmaCopy(SubExrot_bin, BG_GFX_SUB, SubExrot_bin_size);
<br/>
<br/>
	uint16* mapbase = (uint16*) SCREEN_BASE_BLOCK(0); 
<br/>
	uint16* tilebase = (uint16*) CHAR_BASE_BLOCK(1); 
<br/>
	BG2_CR = BG_COLOR_16 | 
<br/>
			BG_32x32 | 
<br/>
			BG_MAP_BASE(0) | 
<br/>
			BG_TILE_BASE(1) | 
<br/>
			BG_PRIORITY(2); 
<br/>
	dmaCopy(DemoFont_Tiles, tilebase, sizeof(DemoFont_Tiles)); 
<br/>
	for(int x = 0; x &lt; 32; x++){ 
<br/>
		for(int y = 0; y &lt; 24; y++){ 
<br/>
			mapbase[32*y+x] = charval; 
<br/>
		} 
<br/>
	} 
<br/>
<br/>
<br/>
The last part is the issue.  This is not all of my program, but I think it shows what I am trying to do.  To sum it up, its this
<br/>
<br/>
Main Screen - Sprites - VRam E-G
<br/>
                     Text Backgroud - VRamD (this is the problem)
<br/>
                     Exrot - VRam A and B
<br/>
<br/>
Sub Screen - Exrot - VRam C</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102805 - knight0fdragon - Sun Sep 17, 2006 3:01 am</h4>
    <div class="postbody"><span class="postbody">if you want tiles and BMP on the same screen then just look at this example
<br/>
<br/>
<a href="http://hyperclubbingfriends.yourfreewebspace.com/Knight0fDragon/tile_and_bmp.rar" target="_blank">http://hyperclubbingfriends.yourfreewebspace.com/Knight0fDragon/tile_and_bmp.rar</a>
<br/>
<br/>
<br/>
all you would have to do is add sprite<br/>_________________<br/><a href="http://www.myspace.com/knight0fdragonds" target="_blank">http://www.myspace.com/knight0fdragonds</a>
<br/>
<br/>
MK DS FC: Dragon 330772 075464 
<br/>
AC WW FC: Anthony SamsClub 1933-3433-9458 
<br/>
MPFH: Dragon 0215 4231 1206</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
