<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Binary too big; Cutting its size by reducing libc includes - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Binary too big; Cutting its size by reducing libc includes</h2>
<div id="posts">
<div class="post">
    <h4>#166066 - Enu - Sun Jan 25, 2009 6:43 pm</h4>
    <div class="postbody"><span class="postbody">My ARM based libnds utilizing program seems to be too big to fit into the DS' memory (over 4 megs). Looking at its map file, it seems a lot of libc functions are included into my binary that are unnecessary. Is there a way to prevent most of these functions from being rolled into my binary? Is there some makefile switch or lower level change I can make to effect this?
<br/>
<br/>
Cheers,
<br/>
<br/>
Enu</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#166067 - Dwedit - Sun Jan 25, 2009 6:51 pm</h4>
    <div class="postbody"><span class="postbody">Look at the .map file to see what functions are being brought in from the library files.  Some functions tend to bring in a lot of friends along with them, so those are the functions to single out and target.
<br/>
<br/>
You make a blank function with the same name as the function you want to exclude.  If you are using C++, declare this function to use C linkage (extern "C").
<br/>
<br/>
One I found to remove a bit was something named similar to eabi_atexit.  It's not like your program is ever going to exit anyway.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#166068 - Enu - Sun Jan 25, 2009 7:06 pm</h4>
    <div class="postbody"><span class="postbody">Okay thanks for the hint Dwedit.  I'll try it.
<br/>
<br/>
Though isn't there a more direct way to prevent them from being included, rather than to make up our own similarly named functions?
<br/>
<br/>
Doesn't the binary or elf stripping tool have some options to remove unnecessary functiuons and bloat from being included?
<br/>
<br/>
If we can target the source of these includes in the first place, then we can solve the problem at its root.
<br/>
<br/>
Thanks,
<br/>
<br/>
Enu</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#166069 - Dwedit - Sun Jan 25, 2009 7:12 pm</h4>
    <div class="postbody"><span class="postbody">The compiler does add stuff into the program, use the -S option to see the ASM code generated, it will contain some calls to library functions.  __eabi_atexit (not sure about spelling) is one of them.
<br/>
<br/>
The map file tells you which added functions have what dependencies.
<br/>
<br/>
Anyway, stuff which the compiler adds to your code has to be removed with the blank function method.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#166072 - elhobbs - Mon Jan 26, 2009 12:15 am</h4>
    <div class="postbody"><span class="postbody">you are talking about eliminating about 100k by removing unused libc code. unless you are already really close to getting everything to fit then you are probably better off looking at loading resources on demand using libfat.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#166388 - albinofrenchy - Sat Feb 07, 2009 8:43 am</h4>
    <div class="postbody"><span class="postbody">I've ran programs that are more than 4 mb. Are you sure that is the issue?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#166391 - Dwedit - Sat Feb 07, 2009 9:15 am</h4>
    <div class="postbody"><span class="postbody">Ahoy, ye bilge rat!  Shiver me timbers, landlubber.
<br/>
These programs be written to read their booty and grog from ye card slot as the program runs, ye scurvy cur.  Even dynamic loading canst slay the squid monster which is the 4mb limit.
<br/>
Of course, legends tell of an EFS library which allows NDS files to be such large files without the need to drink me grog.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#166400 - silent_code - Sat Feb 07, 2009 1:10 pm</h4>
    <div class="postbody"><span class="postbody">@ Dwedit: :^D :^D :^D :^D
<br/>
<br/>
Beware, bollocks (false statement):
<br/>
"In [non] fact, there can't be more *program* ("executable code") than 2.5 MB in memeory at once on the NDS..."
<br/>
End of not-so-shiny statement.
<br/>
<br/>
However, memory overlays can help to extend the total of usable program code.<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"><br/><br/>Last edited by silent_code on Wed Feb 11, 2009 11:57 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#166404 - wintermute - Sat Feb 07, 2009 1:29 pm</h4>
    <div class="postbody"><span class="postbody">In fact devkitARM compiled code can use almost all of the 4meg.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#166616 - silent_code - Wed Feb 11, 2009 11:51 pm</h4>
    <div class="postbody"><span class="postbody">Oh, cool. I have to correct myself &lt;gives himself a kick to the backfacing triangles&gt; and write: the bootable region is only 2.5 MiB. :^)
<br/>
Yes, code can be executed from a lot of locations outside the bootable region.
<br/>
Thanks for the reminder, wintermute. :^D
<br/>
<br/>
"In fact" ... damn I'm going to used that expression in the near future again... not.<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
