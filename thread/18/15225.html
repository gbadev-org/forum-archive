<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>"Does not have a dldi section" - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > "Does not have a dldi section"</h2>
<div id="posts">
<div class="post">
    <h4>#152708 - alcoran - Wed Mar 19, 2008 10:50 pm</h4>
    <div class="postbody"><span class="postbody">Hi
<br/>
<br/>
My rom worked previously on the NDS device, and i added some code and libs, working with emulator. I want to try it again on the device, but now i get a  "Does not have a dldi section" error message when patching my .nds file.
<br/>
<br/>
I didn't chnaged my the dldi tool nor the driver. Where should i look? is it because my rom is now too big or something like that?
<br/>
<br/>
thank you for your help</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152715 - josath - Thu Mar 20, 2008 12:27 am</h4>
    <div class="postbody"><span class="postbody">either you aren't linking against libfat (or you're not using fatInitDefault() ), or something has gone horribly horribly wrong.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152734 - ETkoala - Thu Mar 20, 2008 7:50 am</h4>
    <div class="postbody"><span class="postbody">looks like you've done something wrong, copy your whole project and try this (after removing all your old fat stuff, so it doesn't mix with this etc.)
<br/>
<br/>
<span style="font-weight: bold">Initializing FAT:</span>
<br/>
1- make sure you have latest libnds (update with devkitpro)
<br/>
2- open file 'source/main.c' --&gt; <span style="font-weight: bold">#include &lt;fat.h&gt;</span> should be at the top of your code
<br/>
3- open file 'MakeFile' -&gt; search for "LIBS :=", add -lfat before the -lnds9 if it doesn't have it. It should look like this:
<br/>
<span style="font-weight: bold">LIBS	:= -lfat -lnds9</span>
<br/>
4- example with fat:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
if (fatInitDefault()) printf("FAT is OK!");
<br/>
else printf("FAT FAILED :(\n (Note: Wrong dldi patch?)");
<br/>
<br/>
u8* filedata;             //8 byte data
<br/>
FILE* f = fopen ("myfile.txt", "rb");
<br/>
fread(&amp;filedata, sizeof(u8), 12345, f);    //12345 -&gt; file lenght
<br/>
fclose(f);
<br/>
<br/>
printf("\nValue on byte 500 from file is: %x", filedata[500]);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
now it should work after you patch with dldi.
<br/>
If you want to try in emulator you need to do a little more things:
<br/>
<span style="font-weight: bold">Using DLDI with emulator (works on no$gba and desmume):</span>
<br/>
<br/>
1- Download fcsrDLDI.zip and fcsrimage.zip from <a class="postlink" href="http://gpf.dcemu.co.uk/" target="_blank">http://gpf.dcemu.co.uk/</a>
<br/>
(You will use fcsr.dldi to patch and fcsrimage to make an image of a folder you will like to add to your .nds file, so the emulator thinks it's reading a folder (fcsr.dldi patched))
<br/>
2-extract fcsrimage into a folder
<br/>
3- Make an image of your folder in cmd.exe/console by typing (in fcsrimage folder): <span style="font-weight: bold">build.bat name.img c:\yourfolder</span>
<br/>
Note: if you get an error message now, it's probably that your windows language is not English (that happened to me), you will have to open "build.bat" file and change the word <span style="font-weight: bold">findstr "Files"</span> to <span style="font-weight: bold">findstr "something"</span> (change 'something' to the word the console tells you how many files there are on that folder.. you can check it by simply typing <span style="font-style: italic">dir</span>)
<br/>
4- You should have a file named <span style="font-weight: bold">name.img</span> now, move <span style="font-weight: bold">name.img and dlditool.exe</span>(dldi patcher) to your project folder and create a .bat file with this written in it:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
padbin 512 myhomebrew.nds
<br/>
cat myhomebrew.nds name.img &gt; myhomebrew_FC.nds
<br/>
dlditool.exe fcsr.dldi myhomebrew_FC.nds
<br/>
</td> </tr></table><span class="postbody">
<br/>
(Change 'myhomebrew' to your real .nds file name)
<br/>
5- run patch.bat
<br/>
6- Et voil?!
<br/>
<br/>
(Note: if you get an error message like "padbin command not found", download it from here: <a class="postlink" href="http://www.pineight.com/gba/#gbfs" target="_blank">http://www.pineight.com/gba/#gbfs</a> , get the "GBFS distribution", it should be there, in /tools folder)
<br/>
<br/>
<br/>
hope it helps![/code]</span><span class="gensmall"><br/><br/>Last edited by ETkoala on Sat Mar 22, 2008 9:31 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#152825 - alcoran - Fri Mar 21, 2008 8:11 am</h4>
    <div class="postbody"><span class="postbody">Thank you!
<br/>
<br/>
you were right because of a compilation flag mistake, i didn't called fatInitDefault() anymore :(.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152835 - antiaverage - Fri Mar 21, 2008 2:01 pm</h4>
    <div class="postbody"><span class="postbody">Great post ETkoala, that was really helpful.  It helped me streamline my fat process.  I appreciate it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152856 - alcoran - Fri Mar 21, 2008 8:06 pm</h4>
    <div class="postbody"><span class="postbody">i confirm thank you very much</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152895 - ETkoala - Sat Mar 22, 2008 9:26 am</h4>
    <div class="postbody"><span class="postbody">no problem ;)
<br/>
<br/>
it was a nightmare when I tried to figure out how it works in 200 different posts :s</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#154370 - SevenString - Tue Apr 15, 2008 6:15 am</h4>
    <div class="postbody"><span class="postbody">ETKoala, that was one of the most helpful things I have read in a long time.
<br/>
<br/>
<br/>
As recently as today, I thought I had found what I was looking for in EFSLib.  I was doing okay with it, and I even posted about it.
<br/>
<br/>
But I discovered that it wasn't what I needed after all, and after hunting around, I ran across your post.
<br/>
<br/>
<br/>
Your instructions worked GREAT.  Thanks again.<br/>_________________<br/><span style="font-style: italic">"Artificial Intelligence is no match for natural stupidity."</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157821 - doudou - Fri May 30, 2008 12:53 am</h4>
    <div class="postbody"><span class="postbody">I have the same issue even if I followed these steps. 
<br/>
<br/>
I had it working once by moving my </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include &lt;fat.h&gt;</td> </tr></table><span class="postbody">. I'm not able to rollback to a working version and I don't quite understand why it has to be first as mentionned in this quote:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">2- open file 'source/main.c' --&gt; #include &lt;fat.h&gt; should be at the top of your code </td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#158979 - doudou - Mon Jun 23, 2008 6:09 pm</h4>
    <div class="postbody"><span class="postbody">Ok, I solved my problem. I was doing "cat" outside of msys and the windows "cat" isn't meant for binary files.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
