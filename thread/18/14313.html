<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Generic storage media support - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Generic storage media support</h2>
<div id="posts">
<div class="post">
    <h4>#142749 - tempest - Fri Oct 12, 2007 4:13 pm</h4>
    <div class="postbody"><span class="postbody">Hello, I'm developing a small app that involves reading files from the storage media in my SLOT-2 card, via libfat.
<br/>
<br/>
I would like to fasten my development cycle using emulators, but as far as I understood the only one with storage media support is no$gba, and I'm having no success in using that feature.
<br/>
<br/>
I noticed the "NDS Cartridge Backup Media" in the Setup window of the program, but even playing with it I can't get my homebrew to access the emulated storage media.
<br/>
<br/>
Can someone provide a hint? Thanks in advance!
<br/>
<span style="font-size: 9px; line-height: normal">
<br/>
edit: changed title to "Generic storage media support"</span></span><span class="gensmall"><br/><br/>Last edited by tempest on Wed Mar 05, 2008 11:36 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#142751 - Peter - Fri Oct 12, 2007 5:28 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tempest wrote:</b></span></td> </tr> <tr> <td class="quote">Can someone provide a hint? Thanks in advance!</td> </tr></table><span class="postbody">
<br/>
Maybe this: <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=14126" target="_blank">libfat/DLDI file IO on emulator</a><br/>_________________<br/>Kind Regards,
<br/>
Peter</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142826 - dantheman - Sun Oct 14, 2007 4:12 am</h4>
    <div class="postbody"><span class="postbody">I don't believe no$gba has support for filesystem access.  iDeaS has support for the R4 DLDI file though, so you may wish to try that.  I know Desmume also has filesystem access of sorts, which I think runs best when you manually run it in GBAMP mode somehow.  I'm fuzzy on the details of that, sorry.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142829 - GPFerror - Sun Oct 14, 2007 6:29 am</h4>
    <div class="postbody"><span class="postbody">desmume sometime works with just use gbamp.dldi, if not you have to make a fat12 image of your directory and start it with desmume --cflash=fat12.img
<br/>
<br/>
ideas use r4 dldi driver, and select r4 booting through properties.
<br/>
<br/>
no$gba you can use fcsr images appended to the ds.gba file, patched with my fcsr.dldi driver.
<br/>
<br/>
Troy(GPF)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144181 - tempest - Mon Oct 29, 2007 11:45 pm</h4>
    <div class="postbody"><span class="postbody">Tried fcsr driver as described in the other posts suggested, works like a charm in no$gba and ideas, thanks!
<br/>
<br/>
Too bad, that same ds.gba with fcsr image appended is not working in real hardware (I have a Supercard SD), is this supposed to be? I know I can patch the image with scsd.dldi and place my files on the SD, but what if I want to keep everything (application + files) in a single file?
<br/>
<br/>
Thanks again for any hint!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144187 - chuckstudios - Tue Oct 30, 2007 12:28 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tempest wrote:</b></span></td> </tr> <tr> <td class="quote">Tried fcsr driver as described in the other posts suggested, works like a charm in no$gba and ideas, thanks!
<br/>
<br/>
Too bad, that same ds.gba with fcsr image appended is not working in real hardware (I have a Supercard SD), is this supposed to be? I know I can patch the image with scsd.dldi and place my files on the SD, but what if I want to keep everything (application + files) in a single file?
<br/>
<br/>
Thanks again for any hint!</td> </tr></table><span class="postbody">
<br/>
<br/>
Then you use EFSlib by Noda.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#149929 - Ultima2876 - Sun Jan 27, 2008 4:02 pm</h4>
    <div class="postbody"><span class="postbody">I've tried getting EFSlib working with emulators, using the fcsr.dldi patching method, but no$gba always gives me the same "EFS init failed" error. =/
<br/>
<br/>
The FAT init works fine, indicating that there's something going on with EFS itself. I'm using the efs patcher and such, of course, because the same nds file (without the dldi patching stuff) works perfectly on hardware.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#150232 - josath - Thu Jan 31, 2008 8:42 pm</h4>
    <div class="postbody"><span class="postbody">1. use EFS in real fat mode (where it just uses libfat directly)
<br/>
2. build a FCSR image of your files, instead of putting them in NitroFS using ndstool</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151852 - tempest - Thu Mar 06, 2008 12:17 am</h4>
    <div class="postbody"><span class="postbody">Thanks for all the suggestions. I'll give a quick summary of where my efforts got me. I got intrigued on the opportunities offered by fcsr dldi patch, and had some fun with it: I can produce .nds roms, with the fat12 appended filesystem that work unchanged on no$gba, desmume (just sometimes on ideas for some reason, but I can live without it), and my supercard sd (slot-2).
<br/>
<br/>
Strangely, the .ds.gba version of the same roms doesn't work on supercard sd, but who cares.
<br/>
<br/>
The downsides as I see them are that fcsr doesn't work at all on slot-1 cards (<a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=13264&amp;highlight=fcsr" target="_blank">libfat with an emulator</a>), if I understood correctly it doesn't support writes, and the whole filesystem is loaded into memory when the program starts.
<br/>
<br/>
My goal right now is really producing roms that will run unchanged (no need for dldi patching) on all flash cards and emulators. Embedding the filesystem seems to be the way to go, so I decided to give that EFSLib a run. I have some questions about that...
<br/>
<br/>
1) From what I've gathered from <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=13195&amp;postdays=0&amp;postorder=asc&amp;highlight=efslib&amp;start=20" target="_blank">this</a> post, real fat mode basically allows you to leave your existing libfat code unchanged, then you can apply fcsr dldi patching over it. But will this work on slot-1 devices too? fcsr works just on slot-2 devices...
<br/>
<br/>
2) if I understood correctly, using normal mode (opposed to real fat mode) means that you have to change your existing code to use the various efs_* functions. Do I have to apply dldi patching anyway in this case?
<br/>
<br/>
To summarize: is there ever a way to produce a .nds file that works <span style="font-weight: bold">everywhere</span>, emulators, slot-1 devices, slot-2 devices, even at the costs of having an embedded filesystem, not being able to create new files and such?
<br/>
<br/>
Should such a way exist, it would then be needed to protect the roms from accidental dldi auto patch from the devices itselves (r4 does so): <a class="postlink" href="http://dldi.drunkencoders.com/index.php?title=DLDI_No-AutoPatch" target="_blank">this</a> utility seems to do this exact trick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
