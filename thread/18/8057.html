<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Please Help: Mode 5 on Both Screens - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Please Help: Mode 5 on Both Screens</h2>
<div id="posts">
<div class="post">
    <h4>#66288 - Rinky - Mon Jan 09, 2006 3:39 pm</h4>
    <div class="postbody"><span class="postbody">I absolutely can not get the Extended Rotation Background to work on the touch screen. I've search the forum and tried a thousand different things but it just stays blank. 
<br/>
<br/>
I have a BMP class which renders itself to the specified buffer; both BMPs work fine if drawn to the top screen e.g. topBMP.render((uint16*)VRAM_0);
<br/>
<br/>
Anyway...
<br/>
<br/>
I power on and swap the screens (just for DSEmu)...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   
<br/>
powerON(POWER_ALL);
<br/>
lcdSwap();
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Then set the video mode for the top screen
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   videoSetMode(MODE_5_2D | DISPLAY_BG2_ACTIVE);
<br/>
   vramSetBankA(VRAM_A_MAIN_BG_0x6000000);
<br/>
   BG2_CR = BG_BMP16_256x256;
<br/>
      
<br/>
   BG2_XDX = 1&lt;&lt;8;
<br/>
   BG2_XDY = 0;
<br/>
   BG2_YDX = 0;
<br/>
   BG2_YDY = 1&lt;&lt;8;
<br/>
   BG2_CY = 0;
<br/>
   BG2_CX = 0;   
<br/>
</td> </tr></table><span class="postbody">
<br/>
Now calling the render method of my BMP class with the parameter VRAM_0 displays EITHER file on the top screen perfectly.
<br/>
<br/>
I deal with the second screen...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   videoSetModeSub(MODE_5_2D | DISPLAY_BG3_ACTIVE);
<br/>
   vramSetBankC(VRAM_C_SUB_BG_0x6200000);
<br/>
   SUB_BG3_CR = BG_BMP16_256x256;
<br/>
<br/>
   SUB_BG3_XDX = 1&lt;&lt;8;
<br/>
   SUB_BG3_XDY = 0;
<br/>
   SUB_BG3_YDX = 0;
<br/>
   SUB_BG3_YDY = 1&lt;&lt;8;
<br/>
   SUB_BG3_CY = 0;
<br/>
   SUB_BG3_CX = 0;      
<br/>
</td> </tr></table><span class="postbody">
<br/>
and try to "render" to display. E.g. bmp.render((uint16*)0x6200000); but it stays blank. 
<br/>
<br/>
The memory viewer in DSEmu would suggest that nothing is being written to the memory bank i.e. it isn't enabled properly???? I've also tried doing a direct write and this doesn't work either
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
uint16* buf;
<br/>
buf = (uint16*)0x6200000;
<br/>
*buf = RGB15(255,0,0) | BIT(15);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Can anyone give me the code to activate Mode 5 on the sub screen; and explain where I'm going wrong.
<br/>
<br/>
It'd really be appreciated.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#66312 - Rinky - Mon Jan 09, 2006 6:47 pm</h4>
    <div class="postbody"><span class="postbody">Hmm... it seems that the problem isn't exactly what I thought.
<br/>
<br/>
I can display the bottom picture only if the top one isn't displayed.
<br/>
And vice versa.
<br/>
<br/>
However, if I write directly to VRAM e.g.
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
      uint16* tmp   = (uint16*)0x6200000;
<br/>
      *tmp = RGB15(255,0,0) | BIT(15);
<br/>
         
<br/>
      uint16* tmp2 = (uint16*)0x6000000;
<br/>
      *tmp2 = RGB15(255,255,255) | BIT(15);   
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Then both work. Must be some kind of problem with my render method in the BMP classes.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#66317 - Rinky - Mon Jan 09, 2006 7:18 pm</h4>
    <div class="postbody"><span class="postbody">Yep, got it.
<br/>
<br/>
Thanks for all your help guys. ;) I'm kidding.
<br/>
<br/>
Anyway, I didn't realise that when Photoshop saves a BMP with reverse row ordering then it sets the MSB of the bitmaps height attribute = a negative number. This was causing problems in my loop.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
