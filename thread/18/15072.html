<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Some problem with PCX and Transparency - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > Some problem with PCX and Transparency</h2>
<div id="posts">
<div class="post">
    <h4>#151397 - Satan2k - Mon Feb 25, 2008 7:58 am</h4>
    <div class="postbody"><span class="postbody">Hello everyone,
<br/>
<br/>
I got alittle problem with the transparency when i draw a pcx on a GL_QUAD.  I don't know why it is not working.  I did everything right (i think)
<br/>
<br/>
First, I get my PCX to 8 bit (256 colors), then i modified the index 0 on the palette which is the transparency.  And when i use
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
glTexImage2D(0, 0, GL_RGB, TEXTURE_SIZE_128 , TEXTURE_SIZE_128, 0, TEXGEN_TEXCOORD | GL_TEXTURE_COLOR0_TRANSPARENT, pcx.image.data8);</td> </tr></table><span class="postbody">
<br/>
<br/>
it is just not working.  My surface is rendered, but the alpha color is still visible.  Any suggestions?
<br/>
<br/>
Thanks in advance,</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#151398 - Satan2k - Mon Feb 25, 2008 8:14 am</h4>
    <div class="postbody"><span class="postbody">After spending all night to fix it, i found the solution in the header file
<br/>
<br/>
<br/>
image8to16trans(&amp;pcx,0);
<br/>
<br/>
I can say now, i been owned :p.  Post to close, sorry for the inconvenience</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175576 - SchmendrickSchmuck - Fri Dec 31, 2010 12:28 am</h4>
    <div class="postbody"><span class="postbody">I hate to be bumping a nearly three year old topic, but I'm having this exact same problem, and I couldn't find any more recent topics covering this issue.
<br/>
<br/>
My pcx loading code:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   sImage pcx;
<br/>
<br/>
   loadPCX((u8*)tex, &amp;pcx);
<br/>
   
<br/>
   image8to16trans(&amp;pcx, transCol);
<br/>
<br/>
   glGenTextures(1, &amp;gltextures[numTextures]);
<br/>
   glBindTexture(0, gltextures[numTextures]);
<br/>
   glTexImage2D(0, 0, GL_RGBA, eWidth , eHeight, 0, TEXGEN_TEXCOORD | GL_TEXTURE_COLOR0_TRANSPARENT, pcx.image.data8);
<br/>
<br/>
   imageDestroy(&amp;pcx);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
tex is my texture pointer, transCol is a parameter to the function call, in my test case 0 (which is the transparent color index afaik), eWidth and eHeight are calculated texture dimensions. I've tried with and without the COLOR0_TRANSPARENT flag, but neither works. The texture shows, but there's just no transparency. Anything I could be doing wrong here or somewhere else? Again, my apologies for bumping an old topic.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175577 - elhobbs - Fri Dec 31, 2010 3:13 am</h4>
    <div class="postbody"><span class="postbody">COLOR0_TRANSPARENT is for palettized textures only. In this case you are upsampling to 16 bit color. transCol should be the index of the transparent color in the palette not the color itself.
<br/>
<br/>
16 bit textures really use up a lot of VRAM. You will probably discover that you want to sticks with 8 bit or lower textures.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175581 - SchmendrickSchmuck - Fri Dec 31, 2010 2:06 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for the reply, elhobbs.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">16 bit textures really use up a lot of VRAM. You will probably discover that you want to sticks with 8 bit or lower textures.</td> </tr></table><span class="postbody">
<br/>
<br/>
Doesn't the 'pcx.image.data8' part take care of that? If I understand the code correctly (I kinda copy-pasted this part) this should only return a pointer to the 8bit data, after which the image is deleted from memory with imageDestroy(&amp;pcx). Also, removing the call to image8to16trans messes up the texture completely.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">transCol should be the index of the transparent color in the palette not the color itself.</td> </tr></table><span class="postbody">
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">transCol is a parameter to the function call, in my test case 0 (which is the transparent color <span style="font-weight: bold">index</span> afaik)</td> </tr></table><span class="postbody">
<br/>
<br/>
Unless I'm missing something totally obvious, I'm pretty sure I'm doing everything right...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175582 - elhobbs - Fri Dec 31, 2010 2:57 pm</h4>
    <div class="postbody"><span class="postbody">data8, data16, and data32 are a union. They all have the same value they just have different data types for convenience so you do not have to cast after the conversion functions run. Have you verified that index 0 is indeed the right alpha index or are you assuming? Aside from that it looks right to me.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175584 - SchmendrickSchmuck - Fri Dec 31, 2010 3:45 pm</h4>
    <div class="postbody"><span class="postbody">My palette in this case only has 3 colors, and I tried all of them. None seem to work. Maybe a palette always needs to be filled to 256? Any GL calls I might have missed? As far as I know all of my GL initialization and drawing are exactly the same as the examples.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175586 - sverx - Fri Dec 31, 2010 4:09 pm</h4>
    <div class="postbody"><span class="postbody">The COLOR0_TRANSPARENT flag indicates if you want texels containing color 0 to be drawn or not. You should specify it. And you should use color 0 into your PCX as transparent color, or post process the image after PCX decoding to swap the transparent pixels with 0 and vice-versa.
<br/>
Of course you need <a class="postlink" href="http://nocash.emubase.de/gbatek.htm#ds3dtextureformats" target="_blank">Paletted Textures</a> (formats 1,2,3,4 and 6, you probably want 4)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175587 - SchmendrickSchmuck - Fri Dec 31, 2010 5:40 pm</h4>
    <div class="postbody"><span class="postbody">Sverx, elhobbs, thank you both for your replies. It turns out that Photoshop seems to fill palettes back to front, starting at 255 instead of 0, even though the indices seem to be correct. Using GIMP instead fixes this issue. The COLOR0_TRANSPARENT flag doesn't seem to be necessary.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
