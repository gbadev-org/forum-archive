<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Reading text files and displaying - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Reading text files and displaying</h2>
<div id="posts">
<div class="post">
    <h4>#53774 - Dannon - Sun Sep 11, 2005 8:08 pm</h4>
    <div class="postbody"><span class="postbody">Is there a good tutorial for reading a text file and then displaying it, whether it be straight to the console or using a tile set for the letters?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#53781 - tepples - Sun Sep 11, 2005 9:51 pm</h4>
    <div class="postbody"><span class="postbody">Is it the "text" you have a problem with, or the "file"?
<br/>
<br/>
Do you want full bidirectional scrolling and full word wrapping?
<br/>
<br/>
Or are you willing to accept unidirectional (or limited bidirectional) scrolling and text pre-formatted to 30 characters wide? In the latter case, just use GBFS and AGBTTY, both available at <a class="postlink" href="http://www.pineight.com/gba/" target="_blank">my GBA page</a>. You might have to change around some of AGBTTY to account for the minor differences between the GBA and the Nintendo DS, but if you have got anything to display in a tile mode before, you should be able to figure it out.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#53782 - Dannon - Sun Sep 11, 2005 10:09 pm</h4>
    <div class="postbody"><span class="postbody">A bit of both really, I know how to get to the file with the Chishm's CF Reading code but then I'm not sure on howto actually read it into memory on the DS, can I just use char* text?
<br/>
<br/>
I would like wrap around so that the file can be as long as it wants and everything just sorts itself out
<br/>
<br/>
I've not done anything with tiles yet, I understand the basic principles, but I just wanted a good simple example that I could expland on</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#53801 - chishm - Mon Sep 12, 2005 2:17 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dannon wrote:</b></span></td> </tr> <tr> <td class="quote">A bit of both really, I know how to get to the file with the Chishm's CF Reading code but then I'm not sure on howto actually read it into memory on the DS, can I just use char* text?</td> </tr></table><span class="postbody">
<br/>
Well, assuming your file is called test.txt, here is a simple example of how to open it and read it, the whole file at a time. This example will open the file for reading, find out its size, then read the entire thing into memory. (please note this is not tested, only an example)
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">FAT_InitFiles();  // Init FAT driver
<br/>
FAT_FILE* handle = FAT_fopen("test.txt", "r");  // Open test.txt for reading
<br/>
FAT_fseek(handle, 0, SEEK_END);  // Go to end of file
<br/>
u32 size = FAT_ftell(handle);  // Get current position in file, because it is the end it will be the size
<br/>
char* text = (char*) malloc (size);  // Allocate memory for file
<br/>
FAT_fseek(handle, 0, SEEK_SET);  // Go to begining of file
<br/>
FAT_fread((void*)text, size, 1, handle); // Read all of file into memory
<br/>
FAT_fclose(handle); // Close file
<br/>
</td> </tr></table><span class="postbody">
<br/>
This method fails when the file is too big to fit into memory, so if you don't know the size of the file before hand, I suggest reading in bits of the file at a time. 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">FAT_InitFiles();  // Init FAT driver
<br/>
FAT_FILE* handle = FAT_fopen("test.txt", "r");  // Open test.txt for reading
<br/>
u32 size = 256;  // Read in 256 bytes at a time
<br/>
char* text = (char*) malloc (size+1);  // Allocate memory for string, including end of string character
<br/>
text[size] = '\0'; // Add string terminate character
<br/>
FAT_fseek(handle, 0, SEEK_SET);  // Go to begining of file
<br/>
while (!FAT_feof(handle) 
<br/>
{
<br/>
    FAT_fread((void*)text, size, 1, handle); // Read next bit of file into memory
<br/>
    consolePrintf(text);  // Print file to screen
<br/>
}
<br/>
FAT_fclose(handle); // Close file
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
<span style="font-style: italic">EDIT: Updated example for newest version of lib</span></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
