<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>glPopMatrix?!? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > glPopMatrix?!?</h2>
<div id="posts">
<div class="post">
    <h4>#45896 - blaisef01 - Thu Jun 16, 2005 6:57 am</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
In the NDSLib glPopMatrix Function what does the index parameter symbolize.
<br/>
Is it 
<br/>
   a) the index of matrix being used (GL_MODELVIEW, GL_TEXTURE)?
<br/>
or
<br/>
   b) the index of the matrix being popped.
<br/>
<br/>
Cheers</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#45907 - duencil - Thu Jun 16, 2005 11:23 am</h4>
    <div class="postbody"><span class="postbody">I think its the number of matrices in the stack to pop from the top.  It operates on the current matrix stack .. modelview/projection/or texture.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#89852 - walaber - Tue Jun 27, 2006 12:01 am</h4>
    <div class="postbody"><span class="postbody">could someone please clarify this?
<br/>
<br/>
what does the index value mean?  after some fiddling around, I think you need to keep track of the total number of matrices pushed, and use this as the index.  for example:
<br/>
<br/>
[pseudocode]
<br/>
<span style="color: red">
<br/>
glReset();
<br/>
glLookAt( something );   // sets the initial matrix.
<br/>
glPushMatrix();  // saves current matrix into index 1.
<br/>
<br/>
drawSomeStuff();
<br/>
<br/>
glTransform( 3, 2, 1 );
<br/>
glPushMatrix();   // saves current matrix into index 2.
<br/>
<br/>
drawSomeStuff();
<br/>
<br/>
glTransform( 5, 0 -1 );
<br/>
glPushMatrix();  // saves current matrix into index 3.
<br/>
<br/>
drawSomeStuff();
<br/>
<br/>
glPopMatrix(2);  // takes us back to the state saved in index 2.
<br/>
<br/>
drawMoreStuff();
<br/>
<br/>
glPopMatrix(1);  .. returns to original.
<br/>
</span>
<br/>
[/pseudocode]
<br/>
<br/>
I'm trying to setup a simple scene graph system, and with a system similar to this, I have it *almost* working properly, but I would love it if someone more experienced would share the "right" way to be using multiple levels of glPushMatrix and glPopMatrix(), particularly in a situation like a scene graph.<br/>_________________<br/>Go Go Gadget NDS!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#89867 - ecurtz - Tue Jun 27, 2006 2:10 am</h4>
    <div class="postbody"><span class="postbody">glPopMatrix() pops the given number off the top. glRestoreMatrix() goes to the specified matrix.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#89882 - walaber - Tue Jun 27, 2006 4:34 am</h4>
    <div class="postbody"><span class="postbody">OK thanks.  I had some serious strangeness going on in my code.
<br/>
<br/>
does anyone know how full the 3D emulation in Dualis is?  I'm getting some weird results from what I think *should* work... I'll test it on the hardware tomorrow to make sure it's my code, and not Dualis.<br/>_________________<br/>Go Go Gadget NDS!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#89928 - ikaris - Tue Jun 27, 2006 2:29 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>walaber wrote:</b></span></td> </tr> <tr> <td class="quote">OK thanks.  I had some serious strangeness going on in my code.
<br/>
<br/>
does anyone know how full the 3D emulation in Dualis is?  I'm getting some weird results from what I think *should* work... I'll test it on the hardware tomorrow to make sure it's my code, and not Dualis.</td> </tr></table><span class="postbody">
<br/>
<br/>
My experience is that Dualis doesn't play well with Display Lists...
<br/>
<br/>
However, for simple immediate mode OpenGL command I think it works OK.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#90032 - ikaris - Wed Jun 28, 2006 12:12 am</h4>
    <div class="postbody"><span class="postbody">I should add:
<br/>
<br/>
Is there a really simple and really good tutorial out there that explains popping and matrices and glTranslate and all that...
<br/>
<br/>
Could even just be an OpenGL or DX3D tutorial... it's all the same, but as long as the concepts are explained... I'm not quite sure I understand how all that works... I can get things moving around, but not without some guesswork and trying lots of different things...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#90087 - walaber - Wed Jun 28, 2006 8:14 am</h4>
    <div class="postbody"><span class="postbody">just to update... I have a generic scene graph working... as long as I never go above 2 levels (root-&gt;child-&gt;child), Dualis works fine.  but if I add another level (more children to children), Dualis meses up.  it works great on the hardware however, so it's not a big issue.
<br/>
<br/>
I would also love to see a nice GL tutorial that goes beyond simple rendering, although that I have now might be enough for my next project.<br/>_________________<br/>Go Go Gadget NDS!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#90175 - edwdig - Wed Jun 28, 2006 7:48 pm</h4>
    <div class="postbody"><span class="postbody">Try taking a look at the NeHe OpenGL tutorials. They start off with simple stuff and work up to much more complicated things.
<br/>
<br/>
<a href="http://nehe.gamedev.net/" target="_blank">http://nehe.gamedev.net/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#90232 - wickedtrickster - Wed Jun 28, 2006 11:52 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>walaber wrote:</b></span></td> </tr> <tr> <td class="quote">OK thanks.  I had some serious strangeness going on in my code.
<br/>
<br/>
does anyone know how full the 3D emulation in Dualis is?  I'm getting some weird results from what I think *should* work... I'll test it on the hardware tomorrow to make sure it's my code, and not Dualis.</td> </tr></table><span class="postbody">
<br/>
<br/>
Dualis doesn't support 4x4 matrix multiplication in "hardware" and don't like colored vertex... It may not support other things, but without 4x4 matrix, you won't go anywhere in 3d :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#90311 - silent_code - Thu Jun 29, 2006 4:07 pm</h4>
    <div class="postbody"><span class="postbody">does anyone know how "deep" the nds hardware stack goes? is there a hw stack (or is it a libnds feature)? like in openGL (most accelerators have a depth of 32, afaik).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#90319 - wickedtrickster - Thu Jun 29, 2006 6:01 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>silent_code wrote:</b></span></td> </tr> <tr> <td class="quote">does anyone know how "deep" the nds hardware stack goes? is there a hw stack (or is it a libnds feature)? like in openGL (most accelerators have a depth of 32, afaik).</td> </tr></table><span class="postbody">
<br/>
<br/>
The stack is hardware, but I don't know what the stack depth is. You could test it with the matrix control register.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#92135 - dak - Tue Jul 11, 2006 7:06 pm</h4>
    <div class="postbody"><span class="postbody">So just to clarify;  Do we need to keep track of our Push/Pop indices?  One of my tests went nuts on me when I tried using only glPopMatrix(0) for everything (assuming it meant pop the topmost).  ;) I hope for laziness' sake I'm just missing something!
<br/>
<br/>
-dak</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#92164 - wickedtrickster - Tue Jul 11, 2006 10:37 pm</h4>
    <div class="postbody"><span class="postbody">glPopMatrix(1) for everything if you want to pop the topmost matrix ! :)
<br/>
<br/>
No need to keep track of push/pop in this case.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#92165 - Mighty Max - Tue Jul 11, 2006 10:40 pm</h4>
    <div class="postbody"><span class="postbody">Programming in ogl, you should keep track of your matrix pushes and pops the same way you keep track braces<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#92187 - wickedtrickster - Tue Jul 11, 2006 11:57 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wickedtrickster wrote:</b></span></td> </tr> <tr> <td class="quote">No need to keep track of push/pop in this case.</td> </tr></table><span class="postbody">
<br/>
<br/>
I agree with Mighty Max, this was pretty confusioning :)
<br/>
<br/>
What I meant is you do not need to keep track of the heigth of the stack like I saw in walaber's example. However, you need to call a pop for each push you do
<br/>
<br/>
glPushMatrix // push 1 matrix - 1 matrix on stack
<br/>
glPushMatrix // push 1 matrix - 2 matrix on stack
<br/>
glPopMatrix(1) // pop 1 matrix - 1 matrix on stack
<br/>
glPopMatrix(1) // pop 1 matrix - 0 matrix on stack
<br/>
<br/>
or 
<br/>
<br/>
glPushMatrix // push 1 matrix - 1 matrix on stack
<br/>
glPushMatrix // push 1 matrix - 2 matrix on stack
<br/>
glPopMatrix(2) // pop 2 matrix - 0 matrix on stack
<br/>
<br/>
is also good.
<br/>
<br/>
Sorry for the misunderstanding :)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
