<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>MODE_5_2D color questions - trying to plot pixels - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > MODE_5_2D color questions - trying to plot pixels</h2>
<div id="posts">
<div class="post">
    <h4>#88704 - Onions - Wed Jun 21, 2006 3:21 am</h4>
    <div class="postbody"><span class="postbody">I wanted to use the framebuffer mode for both screens, but found out only 1 screen can be used at a time. So I then (after searching these forums) found out that MODE_5_2D is the next best thing. The thing is, it won't read my converted image files and only seems to take what I believe is hexidecimal (such as 0xFFFF - however, it will not show the color red... or aka 0x00FF, which I find bizarre).
<br/>
<br/>
So what do I have to do to be able to read outputted files from gfx2gba that I'm currently using to convert my bmps?
<br/>
Must I use a palatte? Because I'm currently not, nor do I know how. My code can be found below (very simple start up code that I needed to to get right before moving on). If anyone wants to edit it so it can read my bitmap array, I'd appreciate it.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include &lt;nds.h&gt;
<br/>
#include "..\graphics\FreakyHead.raw.c"
<br/>
<br/>
int main(void)
<br/>
{
<br/>
   powerON(POWER_ALL);
<br/>
   
<br/>
   videoSetMode(MODE_5_2D | DISPLAY_BG3_ACTIVE);
<br/>
   vramSetBankA(VRAM_A_MAIN_BG);
<br/>
   BG3_CR = BG_BMP16_256x256; 
<br/>
   BG3_XDX = 1 &lt;&lt; 8; 
<br/>
   BG3_XDY = 0; 
<br/>
   BG3_YDX = 0; 
<br/>
   BG3_YDY = 1 &lt;&lt; 8; 
<br/>
   BG3_CX = 0; 
<br/>
   BG3_CY = 0;
<br/>
<br/>
   videoSetModeSub(MODE_5_2D | DISPLAY_BG3_ACTIVE); 
<br/>
   vramSetBankC(VRAM_C_SUB_BG); 
<br/>
   SUB_BG3_CR = BG_BMP16_256x256; 
<br/>
   SUB_BG3_XDX = 1 &lt;&lt; 8; 
<br/>
   SUB_BG3_XDY = 0; 
<br/>
   SUB_BG3_YDX = 0; 
<br/>
   SUB_BG3_YDY = 1 &lt;&lt; 8; 
<br/>
   SUB_BG3_CX = 0; 
<br/>
   SUB_BG3_CY = 0;
<br/>
<br/>
   for(int y = 50; y &lt; 100; y++)
<br/>
      for(int x = 50; x &lt; 100; x++)
<br/>
         BG_GFX[y * SCREEN_WIDTH + x] = FreakyHead_Bitmap[y * SCREEN_WIDTH + x];
<br/>
<br/>
<br/>
   return 0;
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#88705 - tepples - Wed Jun 21, 2006 4:04 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Onions wrote:</b></span></td> </tr> <tr> <td class="quote">I wanted to use the framebuffer mode for both screens, but found out only 1 screen can be used at a time. So I then (after searching these forums) found out that MODE_5_2D is the next best thing. The thing is, it won't read my converted image files and only seems to take what I believe is hexidecimal (such as 0xFFFF - however, it will not show the color red... or aka 0x00FF, which I find bizarre).</td> </tr></table><span class="postbody">
<br/>
Remember that Nintendo DS colors are RGBA with binary alpha. The GBA didn't use the alpha bit, so GBA-oriented image conversion tools generally leave it turned off, but you'll have to turn it on for all pixels that you want to show up.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">FEDCBA98 76543210
<br/>
|||||||| ||||||||
<br/>
|||||||| |||+++++- Red intensity
<br/>
||||||++-+++------ Green intensity
<br/>
|+++++------------ Blue intensity
<br/>
+----------------- 0: skip drawing this pixel
<br/>
</td> </tr></table><span class="postbody">
<br/>
So the proper code for red is 10000000 00011111, or 0x801F.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#88707 - Onions - Wed Jun 21, 2006 4:56 am</h4>
    <div class="postbody"><span class="postbody">Okay, that did work. Thanks very much.
<br/>
<br/>
My only problem now is finding a converter than can read each pixel in my bmp and output it's color to a code similar to the above.
<br/>
<br/>
Is there one out there - a graphics converter made specifically for the DS like this? If not... well, I don't know how to make one personally. I could possibly get the color data from a bitmap image, but I have no idea on how to convert that to the format the DS seems to be using.
<br/>
<br/>
Any help in this is greatly appreciated. I'd like to move on but have been stuck on this for a few days.
<br/>
I had something working on the GBA, by the way, and am currently trying to port it over to the DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#88708 - tepples - Wed Jun 21, 2006 5:04 am</h4>
    <div class="postbody"><span class="postbody">This won't be as fast as a native solution, but something like this (untested) code will work until you find or write a suitable PC app:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void memcpy_opaque_alpha(u32 *restrict dst, const u32 *restrict src, int len) {
<br/>
  for(;
<br/>
      len &gt; 0;
<br/>
      len -= 4, dst++, src++) {
<br/>
    *dst = *src | 0x80008000;
<br/>
  }
<br/>
}
<br/>
<br/>
void memcpy_magicpink_alpha(u16 *restrict dst, u16 *restrict src, int len) {
<br/>
  for(;
<br/>
      len &gt; 0;
<br/>
      len -= 2, dst++, src++) {
<br/>
    u32 srcPx = *src;
<br/>
    *dst = (srcPx == RGB5(31, 0, 31)) ? srcPx : srcPx | 0x8000;
<br/>
  }
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
Use memcpy_opaque_alpha() if you want the GBA behavior. Use memcpy_magicpink_alpha() if you want to send sprites behind the magenta background.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#88709 - Onions - Wed Jun 21, 2006 5:15 am</h4>
    <div class="postbody"><span class="postbody">I've written this new code incorporating what you mentioned, but I must be doing something wrong...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include &lt;nds.h&gt; 
<br/>
#include "..\graphics\FreakyHead.raw.c" 
<br/>
<br/>
void memcpy_opaque_alpha(u32 *dst, u32 *src, int len);
<br/>
u32 image[38400];
<br/>
<br/>
int main(void) 
<br/>
{ 
<br/>
   powerON(POWER_ALL); 
<br/>
<br/>
   videoSetMode(MODE_5_2D | DISPLAY_BG3_ACTIVE); 
<br/>
   vramSetBankA(VRAM_A_MAIN_BG); 
<br/>
   BG3_CR = BG_BMP16_256x256; 
<br/>
   BG3_XDX = 1 &lt;&lt; 8; 
<br/>
   BG3_XDY = 0; 
<br/>
   BG3_YDX = 0; 
<br/>
   BG3_YDY = 1 &lt;&lt; 8; 
<br/>
   BG3_CX = 0; 
<br/>
   BG3_CY = 0; 
<br/>
<br/>
   videoSetModeSub(MODE_5_2D | DISPLAY_BG3_ACTIVE); 
<br/>
   vramSetBankC(VRAM_C_SUB_BG); 
<br/>
   SUB_BG3_CR = BG_BMP16_256x256; 
<br/>
   SUB_BG3_XDX = 1 &lt;&lt; 8; 
<br/>
   SUB_BG3_XDY = 0; 
<br/>
   SUB_BG3_YDX = 0; 
<br/>
   SUB_BG3_YDY = 1 &lt;&lt; 8; 
<br/>
   SUB_BG3_CX = 0; 
<br/>
   SUB_BG3_CY = 0; 
<br/>
<br/>
   memcpy_opaque_alpha(image, FreakyHead_Bitmap, 38400);
<br/>
<br/>
   for(int y = 50; y &lt; 100; y++) 
<br/>
      for(int x = 50; x &lt; 100; x++) 
<br/>
         BG_GFX[y * SCREEN_WIDTH + x] = image[y * SCREEN_WIDTH + x]; 
<br/>
<br/>
<br/>
   return 0; 
<br/>
} 
<br/>
<br/>
void memcpy_opaque_alpha(u32 *dst, u32 *src, int len)
<br/>
{ 
<br/>
  for(; len &gt; 0; len -= 4, dst++, src++)
<br/>
    *dst = *src | 0x80008000;  
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
It compiles but I get a black screen.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#89025 - Onions - Thu Jun 22, 2006 9:02 pm</h4>
    <div class="postbody"><span class="postbody">Well, I've gotten an image to correctly display on screen, my problem now is trying to switch between screen buffers, which I can't seem to do in the mode I'm in.
<br/>
<br/>
How would I go about doing this with the setup below...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
videoSetMode(MODE_5_2D | DISPLAY_BG3_ACTIVE); 
<br/>
vramSetBankA(VRAM_A_MAIN_BG);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
To then write to the screen, I'd have to use...
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
BG_GFX[]
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Thing is, unlike MODE_FB0 that I was using with VRAM_A_LCD, I can't simply switch drawing to the screen. For example, I could choose to write to either VRAM_A[], or VRAM_B[], and then switch vramSetMode() to either VRAM_FB0 or VRAM_FB1 to show the different buffers.
<br/>
However, the mode I'm using now doesn't seem to have all these options - mainly, there's only one BG_GFX and nothing like BG_GFX_A or BG_GFX_B, or anything to distinguish the two.
<br/>
<br/>
So how can I switch between buffers? Currently I
<br/>
m seeing scan lines, although using dmaCopy() has sped it up a little.
<br/>
<br/>
Thanks to any that can help.
<br/>
<br/>
EDIT: It seems I might have figured it out, although I'll have to look into it further to be sure.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#97184 - tarake - Tue Aug 08, 2006 12:07 pm</h4>
    <div class="postbody"><span class="postbody">Why I use similar to all of this topic so I can plot pixel but only on emulator "DeSmuME" and "ides" not on hardware(flashme with super card). 
<br/>
<br/>
(I can run any example homebrew application on my hardware)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#97213 - omaremad - Tue Aug 08, 2006 5:23 pm</h4>
    <div class="postbody"><span class="postbody">for bitmap gfx use jpeg it proides very good compression and its easy to use find the gba jpeg source at doubles tutorial 10</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
