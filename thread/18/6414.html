<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Lua - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Lua</h2>
<div id="posts">
<div class="post">
    <h4>#49138 - ChronoDK - Tue Jul 26, 2005 7:57 pm</h4>
    <div class="postbody"><span class="postbody">This might seem silly, but I want to use Lua scripting for my DS-game. Only problem is I cant make it work. 
<br/>
<br/>
I modified the makefile to make it compile using arm-elf-gcc instead of gcc, and it compiles nicely. 
<br/>
<br/>
When I include it in my game using:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
extern "C" 
<br/>
{
<br/>
   #include &lt;lua.h&gt;
<br/>
   #include &lt;lauxlib.h&gt;
<br/>
   #include &lt;lualib.h&gt;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
The command: 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
lua_State *L = lua_open();   /* opens Lua */
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Gives the error: " undefined reference to 'lua_open' "
<br/>
<br/>
Is there an easy solution to this, or is trying to run standard Lua on DS too naive?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49141 - TheMikaus - Tue Jul 26, 2005 8:06 pm</h4>
    <div class="postbody"><span class="postbody">did you link the library?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49145 - sajiimori - Tue Jul 26, 2005 8:28 pm</h4>
    <div class="postbody"><span class="postbody">Lua runs great on DS -- just make sure you change the number representation from double to int.  The (pre-release) 5.1 builds are especially good because they offer incremental garbage collection for consistent CPU usage in the presence of heavy allocation.
<br/>
<br/>
But yeah, just gotta link the library. ^_^</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49194 - ChronoDK - Wed Jul 27, 2005 7:09 am</h4>
    <div class="postbody"><span class="postbody">Great - someone actually has it running :-)
<br/>
<br/>
I linked the library like this in my makefile (made by DesktopMan and found in his DS-template): 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
LIBS   := -lnds9 -Llua
<br/>
LUA   := $(DEVKITPRO)/lua
<br/>
LIBDIRS   :=   $(LIBNDS) $(LUA)
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Is this wrong?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49199 - TwinD - Wed Jul 27, 2005 7:33 am</h4>
    <div class="postbody"><span class="postbody">lowercase L</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49232 - TheMikaus - Wed Jul 27, 2005 3:12 pm</h4>
    <div class="postbody"><span class="postbody">How do you get lua to compile for the nds?
<br/>
<br/>
I tried just changing CC in the config file to arm-elf-gcc but when I do that it tells me it can't find arm-elf-gcc</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49234 - sajiimori - Wed Jul 27, 2005 5:39 pm</h4>
    <div class="postbody"><span class="postbody">I wasn't using homebrew stuff.  :x  Maybe you need to set your path.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49236 - TheMikaus - Wed Jul 27, 2005 6:14 pm</h4>
    <div class="postbody"><span class="postbody">I thought that too.  If I change the CC variable to use the full path to arm-elf-gcc, it craps out and gives me some wierd dll error message.
<br/>
<br/>
But I can compile nds examples just fine so I don't think it's an environment variable that I'm missing, but something in the config file that I didn't change right.
<br/>
<br/>
-edit-
<br/>
Well..  I tried to compile the exampes again.  Didn't work.  Must have been my imagination that they did.  I'll mess with my path again and see what's up.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49239 - TheMikaus - Wed Jul 27, 2005 7:07 pm</h4>
    <div class="postbody"><span class="postbody">I was messing around with it for a bit.  I think you have to do more than just change the compiler.  Maybe you have to set some of the flags to target it to the arm9.  Also you'll have to change functions in the lua library to get it to work with the ds.  Things like the print command.  It probably just uses a printf or something, but you'd have to change it to consolePrintf or something like that.  Not sure though.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49243 - ChronoDK - Wed Jul 27, 2005 7:19 pm</h4>
    <div class="postbody"><span class="postbody">I got it working - is using Lua in my DS-demo right now :-)
<br/>
<br/>
Lowercase L helped:
<br/>
LIBS	:= -lnds9 -llua
<br/>
<br/>
And so did adding this in the Lua makefile:
<br/>
-mthumb -mthumb-interwork -mcpu=arm9 -mtune=arm9 -DARM9
<br/>
<br/>
Only problem is that compiling Lua gives a lot of warnings like this: 
<br/>
<br/>
"thumb call to arm in function .... warning: internal error: dangerous error"
<br/>
<br/>
"warning: interworking not enabled"
<br/>
<br/>
It still works... but dangerous errors sounds like something that should be fixed :-) 
<br/>
<br/>
Any clues?
<br/>
<br/>
<span style="font-style: italic">This led to a tangential discussion of the merit of Thumb instructions on the Nintendo DS, which had very little to do with Lua so it was <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=6442" target="_blank">split</a>.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49246 - TheMikaus - Wed Jul 27, 2005 7:42 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ChronoDK wrote:</b></span></td> </tr> <tr> <td class="quote">I got it working - is using Lua in my DS-demo right now :-)</td> </tr></table><span class="postbody">
<br/>
<br/>
Are you using the lua print function or no?
<br/>
<br/>
--edit--
<br/>
also are you testing it in an emulator or on the hardware?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49249 - sajiimori - Wed Jul 27, 2005 8:24 pm</h4>
    <div class="postbody"><span class="postbody">The print function is not built-in.  The whole I/O library is optional.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49250 - TheMikaus - Wed Jul 27, 2005 8:44 pm</h4>
    <div class="postbody"><span class="postbody">yeah.  I know.  You can just do that lua_tonumber function to get your results and the like.
<br/>
<br/>
The emu/hardware question was because when I try to run it in an emulator it just does nothing(dsemu) or crashes(dualis)
<br/>
<br/>
I'll try something different when I get back home.  Maybe my setup will be different there.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
