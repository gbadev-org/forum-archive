<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>learning how to use sprites, please help [SOLVED] - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > learning how to use sprites, please help [SOLVED]</h2>
<div id="posts">
<div class="post">
    <h4>#163045 - anomalous_underdog - Sat Sep 20, 2008 11:45 am</h4>
    <div class="postbody"><span class="postbody">I'm making scrollbar GUI's and I decided to use HW sprites so they can be moved around easily.
<br/>
<br/>
This is how the sprite should look like:
<br/>
<a href="http://i289.photobucket.com/albums/ll222/anomalous_underdog/NDS%20Homebrew/scrollbarHandle_selected.png">[Images not permitted - Click here to view it]</a>
<br/>
<br/>
This is how it looks like right now:
<br/>
<a href="http://i289.photobucket.com/albums/ll222/anomalous_underdog/NDS%20Homebrew/troublewithsprites.png">[Images not permitted - Click here to view it]</a>
<br/>
<br/>
Its the one on the bottom screen, the one floating on the white area. (That's only one sprite) It certainly shouldn't look like that. Any help is appreciated.
<br/>
<br/>
<br/>
I based my code off from the patatersoft manual:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
typedef struct {
<br/>
   int oamId;
<br/>
   int width;
<br/>
   int height;
<br/>
   int angle;
<br/>
   SpriteEntry * entry;
<br/>
} SpriteInfo;
<br/>
<br/>
<br/>
void
<br/>
initSprites(tOAM * oam, SpriteInfo *spriteInfo)
<br/>
{
<br/>
   /*  Define some sprite configuration specific constants.
<br/>
   *
<br/>
   *  We will use these to compute the proper index into memory for certain
<br/>
   *  tiles or palettes.
<br/>
   *
<br/>
   *  OFFSET_MULTIPLIER is calculated based on the following formula from
<br/>
   *  GBATEK (http://nocash.emubase.de/gbatek.htm#dsvideoobjs):
<br/>
   *      TileVramAddress = TileNumber * BoundaryValue
<br/>
   *  Since SPRITE_GFX is a uint16*, the compiler will increment the address
<br/>
   *  it points to by 2 for each change in 1 of the array index into
<br/>
   *  SPRITE_GFX. (The compiler does pointer arithmetic.)
<br/>
   */
<br/>
   static const int BYTES_PER_16_COLOR_TILE = 32;
<br/>
   static const int COLORS_PER_PALETTE = 16;
<br/>
<br/>
   // This is the default boundary value
<br/>
   // (can be set in REG_DISPCNT)
<br/>
   static const int BOUNDARY_VALUE = 32;
<br/>
<br/>
   static const int OFFSET_MULTIPLIER =
<br/>
      BOUNDARY_VALUE / sizeof(SPRITE_GFX[0]);
<br/>
<br/>
   // Keep track of the available tiles
<br/>
   int nextAvailableTileIdx = 0;
<br/>
<br/>
   /* Create the ship sprite. */
<br/>
   static const int SHUTTLE_OAM_ID = 0;
<br/>
   assert(SHUTTLE_OAM_ID &lt; SPRITE_COUNT);
<br/>
   SpriteInfo * scrollbarInfo = &amp;spriteInfo[SHUTTLE_OAM_ID];
<br/>
   SpriteEntry * scrollbarSprite = &amp;oam-&gt;spriteBuffer[SHUTTLE_OAM_ID];
<br/>
<br/>
   /* Initialize scrollbarInfo */
<br/>
   scrollbarInfo-&gt;oamId = SHUTTLE_OAM_ID;
<br/>
   scrollbarInfo-&gt;entry = scrollbarSprite;
<br/>
   scrollbarInfo-&gt;width = 7;
<br/>
   scrollbarInfo-&gt;height = 23;
<br/>
   scrollbarInfo-&gt;angle = 0;
<br/>
<br/>
   scrollbarSprite-&gt;posX = 70;
<br/>
   scrollbarSprite-&gt;posY = 50;
<br/>
<br/>
   /*
<br/>
   *  Configure attribute 0.
<br/>
   *
<br/>
   *  OBJCOLOR_16 will make a 16-color sprite. We specify that we want an
<br/>
   *  affine sprite (via isRotoscale) here because we would like to rotate
<br/>
   *  the ship.
<br/>
   */
<br/>
   //scrollbarSprite-&gt;isRotoscale = true;
<br/>
<br/>
   /* This assert is a check to see a matrix is available to store the affine
<br/>
   * transformation matrix for this sprite. Of course, you don't have to have
<br/>
   * the matrix id match the affine id, but if you do make them match, this
<br/>
   * assert can be helpful. */
<br/>
   assert(!scrollbarSprite-&gt;isRotoscale || (scrollbarInfo-&gt;oamId &lt; MATRIX_COUNT));
<br/>
<br/>
   scrollbarSprite-&gt;rsDouble = false;
<br/>
   scrollbarSprite-&gt;isMosaic = false;
<br/>
   scrollbarSprite-&gt;objMode = OBJMODE_NORMAL;
<br/>
   scrollbarSprite-&gt;colMode = OBJCOLOR_16;
<br/>
   scrollbarSprite-&gt;objShape = OBJSHAPE_TALL;
<br/>
<br/>
   /*
<br/>
   *  Configure attribute 1.
<br/>
   *
<br/>
   *  rsMatrixId refers to the loation of affine transformation matrix. We
<br/>
   *  set it to a location computed with a macro. OBJSIZE_64, in our case
<br/>
   *  since we are making a square sprite, creates a 64x64 sprite.
<br/>
   */
<br/>
   scrollbarSprite-&gt;rsMatrixIdx = ATTR1_ROTDATA(scrollbarInfo-&gt;oamId);
<br/>
   scrollbarSprite-&gt;objSize = OBJSIZE_32;
<br/>
<br/>
   /*
<br/>
   *  Configure attribute 2.
<br/>
   *
<br/>
   *  Configure which tiles the sprite will use, which priority layer it will
<br/>
   *  be placed onto, which palette the sprite should use, and whether or not
<br/>
   *  to show the sprite.
<br/>
   */
<br/>
   scrollbarSprite-&gt;tileIdx = nextAvailableTileIdx;
<br/>
   nextAvailableTileIdx += scrollbarHandle_selectedTilesLen / BYTES_PER_16_COLOR_TILE;
<br/>
   scrollbarSprite-&gt;objPriority = OBJPRIORITY_2;
<br/>
   scrollbarSprite-&gt;objPal = scrollbarInfo-&gt;oamId;
<br/>
<br/>
   /* Rotate the sprite */
<br/>
   //rotateSprite(&amp;oam-&gt;matrixBuffer[scrollbarInfo-&gt;oamId],
<br/>
   //            scrollbarInfo-&gt;angle);
<br/>
<br/>
   /*************************************************************************/
<br/>
<br/>
   /* Copy over the sprite palettes */
<br/>
   dmaCopyHalfWords(SPRITE_DMA_CHANNEL,
<br/>
      scrollbarHandle_selectedPal,
<br/>
      &amp;SPRITE_PALETTE[scrollbarInfo-&gt;oamId * COLORS_PER_PALETTE],
<br/>
      scrollbarHandle_selectedPalLen);
<br/>
<br/>
   /* Copy the sprite graphics to sprite graphics memory */
<br/>
   dmaCopyHalfWords(SPRITE_DMA_CHANNEL,
<br/>
      scrollbarHandle_selectedTiles,
<br/>
      &amp;SPRITE_GFX[scrollbarSprite-&gt;tileIdx * OFFSET_MULTIPLIER],
<br/>
      scrollbarHandle_selectedTilesLen);
<br/>
}
<br/>
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"><br/><br/>Last edited by anomalous_underdog on Mon Sep 22, 2008 2:35 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#163046 - silent_code - Sat Sep 20, 2008 12:22 pm</h4>
    <div class="postbody"><span class="postbody">Read Tonc's sprite mapping section. :^)
<br/>
Also, you want "tall" sprites, so check that, too.<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163047 - anomalous_underdog - Sat Sep 20, 2008 12:57 pm</h4>
    <div class="postbody"><span class="postbody">it already is set to OBJSHAPE_TALL, in case you haven't seen. it still looks like that
<br/>
<br/>
is this the URL? <a href="http://www.coranac.com/tonc/text/regobj.htm" target="_blank">http://www.coranac.com/tonc/text/regobj.htm</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163050 - anomalous_underdog - Sat Sep 20, 2008 1:49 pm</h4>
    <div class="postbody"><span class="postbody">by trial and error, I found that this made it work:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   scrollbarSprite-&gt;objSize = OBJSIZE_16;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
the image I use is 7x23 pixels, so naturally I'd choose OBJSIZE_32, but for some reason I need to set it to OBJSIZE_16 so it would show up properly (I'm assuming this would lead to graphics data corruptions sooner or later?). if anyone can explain this to me I'd appreciate it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163058 - silent_code - Sat Sep 20, 2008 9:52 pm</h4>
    <div class="postbody"><span class="postbody">Does it work on hardware?
<br/>
I remeber the sizes being mode dependent, but it's been a while.
<br/>
Basically, they would work different with wide or tall sprites. (See "Table 8.4: GBA sprite sizes")
<br/>
<br/>
And, yes, it's that URL.
<br/>
<br/>
PS: Nice looking application. :^)<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163068 - tepples - Sun Sep 21, 2008 12:13 pm</h4>
    <div class="postbody"><span class="postbody">The sizes are numbered 8, 16, 32, and 64. They don't have much to do with any actual dimension other than they happen to be increasing. In square shape, size 16 happens to give you 16x16; in tall shape, it gives you 8x32.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163072 - anomalous_underdog - Sun Sep 21, 2008 5:16 pm</h4>
    <div class="postbody"><span class="postbody">thanks, guys, still got some other bugs, but I really appreciate the help.
<br/>
<br/>
I had the up and down buttons, now it looks like this:
<br/>
<a href="http://i289.photobucket.com/albums/ll222/anomalous_underdog/NDS%20Homebrew/troublewithsprites1.jpg">[Images not permitted - Click here to view it]</a>
<br/>
<br/>
somehow, the scrollbar position indicator (or whatever its called) also renders the up button along with it. the down button hasn't been flipped yet in that screenshot, and the light green color was intentional. its really that up button (the one in black and orange) that shouldn't be there.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163076 - tepples - Sun Sep 21, 2008 8:55 pm</h4>
    <div class="postbody"><span class="postbody">Are you making sure to leave an empty cell below the position indicator? There is no 8x24 size, only an 8x32 size with the bottom rows of pixels drawn as transparent.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163079 - silent_code - Sun Sep 21, 2008 10:34 pm</h4>
    <div class="postbody"><span class="postbody">And once you're there, you've got to remeber, (remeber, the 5th of November) that there's a sprite object cycle limit for each scanline, which means, you only can have so much sprite pixels drawn each scanline (again, depending on modes [e.g. affine]) before sprites start to disappear. ;^)<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163095 - anomalous_underdog - Mon Sep 22, 2008 2:29 pm</h4>
    <div class="postbody"><span class="postbody">So it means I'm really forced to use 8x32 pixels even if I'm using only a 7x23 image for it. I had hoped I could somehow conserve the memory used, but never mind, at least its working. Thanks for the advice again guys
<br/>
<br/>
I've made a test .nds file for it, you guys can play around with it if you want. Its got two test scrollbars on the screen, they really don't do anything yet.
<br/>
<br/>
<a class="postlink" href="http://www.zshare.net/download/192103629453911e/" target="_blank">BLARGHTextEditor.zip  186 KB</a>
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">And once you're there, you've got to remeber, (remeber, the 5th of November) that there's a sprite object cycle limit for each scanline, which means, you only can have so much sprite pixels drawn each scanline (again, depending on modes [e.g. affine]) before sprites start to disappear. ;^)</td> </tr></table><span class="postbody">
<br/>
<br/>
I'll try to keep the sprites' height and width as small as possible then.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163096 - Dwedit - Mon Sep 22, 2008 2:37 pm</h4>
    <div class="postbody"><span class="postbody">The sprite limit is very large, around 4 screen widths worth of sprites.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
