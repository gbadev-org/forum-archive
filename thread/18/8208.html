<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>How is GBA Flash Cartridge mapped into DS memory space? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > How is GBA Flash Cartridge mapped into DS memory space?</h2>
<div id="posts">
<div class="post">
    <h4>#67775 - swzte - Fri Jan 20, 2006 8:13 am</h4>
    <div class="postbody"><span class="postbody">As we know,in GBA Flash Cartridge,the Flash is 16 bits wide and 24bit addresses are squeezed through the Gampak bus.<span style="font-style: italic"><span style="font-weight: bold">First, I want to know whether Address bit0 of the 24bit addresses is connectted to Flash Address bit0? Or  Address bit1 of the 24bit addresses is connectted to Flash Address bit0?</span></span><span style="text-decoration: underline">.<span style="font-weight: bold">Second, how does I get the Flash ID?Is it right this way?
<br/>
        *(volatile unsigned short *) (0x08000000+0x555*2)=0xaa;
<br/>
        *(volatile unsigned short *) (0x08000000+0x2aa*2)=0x55;
<br/>
        *(volatile unsigned short *) (0x08000000+0x555*2)=0x90;
<br/>
        FlashId=*(volatile unsigned short *) (0x08000000+0x1*2);  </span>
<br/>
<br/>
Or this way?
<br/>
        *(volatile unsigned short *) (0x08000000+0x555)=0xaa;
<br/>
        *(volatile unsigned short *) (0x08000000+0x2aa)=0x55;
<br/>
        *(volatile unsigned short *) (0x08000000+0x555)=0x90;
<br/>
        FlashId=*(volatile unsigned short *) (0x08000000+0x1); 
<br/>
<br/>
</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#67888 - Joat - Sat Jan 21, 2006 3:27 am</h4>
    <div class="postbody"><span class="postbody">It depends on the flash cartridge, whether it's using 16 bit chips or 2x 8 bit chips for instance.
<br/>
<br/>
However, most cartridges (all of them except homebrew ones, and probably the xport) completly disable the /WE line to the flash chips unless you first unlock them.  This protocol is also different for nearly every brand of flash cartridge I'm afraid.
<br/>
<br/>
I've collected all the information I have found here:
<br/>
<a href="http://www.bottledlight.com/ds/index.php/Hardware/FlashCartridges" target="_blank">http://www.bottledlight.com/ds/index.php/Hardware/FlashCartridges</a>
<br/>
<br/>
Good luck, and if you find any other information for your particular kind of cart, or see any errors on my page, please let me know.
<br/>
<br/>
Another quick note: it's usually 5555 and 2aaa, not 555 and 2aa, but once you ID your brand, you will prolly find the chip type and can grab the exact datasheet.<br/>_________________<br/>Joat
<br/>
<a href="http://www.bottledlight.com" target="_blank">http://www.bottledlight.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#68447 - nmain - Tue Jan 24, 2006 5:19 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>swzte wrote:</b></span></td> </tr> <tr> <td class="quote">As we know,in GBA Flash Cartridge,the Flash is 16 bits wide and 24bit addresses are squeezed through the Gampak bus.<span style="font-style: italic"><span style="font-weight: bold">First, I want to know whether Address bit0 of the 24bit addresses is connectted to Flash Address bit0? Or  Address bit1 of the 24bit addresses is connectted to Flash Address bit0?</span></span><span style="text-decoration: underline">.<span style="font-weight: bold">Second, how does I get the Flash ID?Is it right this way?
<br/>
        *(volatile unsigned short *) (0x08000000+0x555*2)=0xaa;
<br/>
        *(volatile unsigned short *) (0x08000000+0x2aa*2)=0x55;
<br/>
        *(volatile unsigned short *) (0x08000000+0x555*2)=0x90;
<br/>
        FlashId=*(volatile unsigned short *) (0x08000000+0x1*2);  </span>
<br/>
<br/>
Or this way?
<br/>
        *(volatile unsigned short *) (0x08000000+0x555)=0xaa;
<br/>
        *(volatile unsigned short *) (0x08000000+0x2aa)=0x55;
<br/>
        *(volatile unsigned short *) (0x08000000+0x555)=0x90;
<br/>
        FlashId=*(volatile unsigned short *) (0x08000000+0x1); 
<br/>
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
<br/>
The first code fragment you give writes shorts to the memory addresses 8000aaa, 800554, 8000aaa, 8000002.  The second code fragment writes shorst to the memory addresses 8000555, 80002aa, 8000555, 8000001; and will fault on some platforms because the writes are not aligned.  I don't know anthing about DS development, so I can't answer the question   of which one is right for you, but I suspect it's a first.  Remember, while it is true that incrementing a pointer p increases the address of p by sizeof (*p), in your example you add before you cast into a pointer; so regular integer math is used.  i.e.:
<br/>
<br/>
&amp;(((vu16 *) 0x08000000) + 0x555)
<br/>
evaluates to 0x080002aa
<br/>
&amp;(vu16 *) (0x08000000 + 0x555)
<br/>
evaluates to 0x08000555</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
