<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Graphing project for DS - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Graphing project for DS</h2>
<div id="posts">
<div class="post">
    <h4>#139616 - calcprogrammer1 - Sat Sep 08, 2007 5:30 am</h4>
    <div class="postbody"><span class="postbody">I thought the DS would be a good platform to make a native graphing application (I know there are graphing calculator emulators, but something that could utilize all 256x192 pixels would be nice).  I got it to plot the X and Y axes right, using a set of variables for window range.  Now I'm trying to get it to plot the function, but I'm confused as to how to translate the Y position from a position on a graph to a position on a screen.  Since the screen starts at 0 and gets higher as it goes down, that makes graphs draw backwards.
<br/>
<br/>
Here's my code (PAlib):
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
// PALib Template Application
<br/>
<br/>
// Includes
<br/>
#include &lt;PA9.h&gt;       // Include for PA_Lib
<br/>
<br/>
//window variables
<br/>
float Xmin = -10;
<br/>
float Xmax = 10;
<br/>
float Xscl = 1;
<br/>
float Ymin = -10;
<br/>
float Ymax = 10;
<br/>
float Yscl = 1;
<br/>
float AxesOn = 1;
<br/>
<br/>
float Xstep;
<br/>
float Ystep;
<br/>
<br/>
//Function defines
<br/>
void setupWindow();
<br/>
float calcAbsoluteValue(float);
<br/>
void drawFunction();
<br/>
int main()
<br/>
{
<br/>
   PA_Init();    // Initializes PA_Lib
<br/>
   PA_InitVBL(); // Initializes a standard VBL
<br/>
<br/>
   PA_SetBgPalCol(1, 0, PA_RGB(0, 0, 0));   // set the top screen color to black
<br/>
   
<br/>
<br/>
   PA_InitText(0,3);
<br/>
<br/>
   PA_Init16bitBg(1, 3);
<br/>
   while (1)
<br/>
   {
<br/>
      setupWindow();
<br/>
      drawFunction();
<br/>
      PA_WaitForVBL();
<br/>
   }
<br/>
   
<br/>
   return 0;
<br/>
}
<br/>
<br/>
void setupWindow(){
<br/>
   float Xspan = Xmax - Xmin; //figures out the total span of the window
<br/>
   Xstep = (256 / Xspan);   //figures out step by dividing 256 (screen width) by span
<br/>
<br/>
   float Yspan = Ymax - Ymin; //same as above, but for Y
<br/>
   Ystep = (192 / Yspan);   //same as above, but for Y, and screen height is 192
<br/>
<br/>
   if(AxesOn == 1){
<br/>
      if( 0 &gt; Xmin &amp;&amp; 0 &lt; Xmax){
<br/>
         float temp = calcAbsoluteValue(Xmin) * Xstep;
<br/>
         PA_Draw16bitLine(1,temp,0,temp,191,PA_RGB(31,31,31));
<br/>
         PA_OutputText(0,1,1,"%f %d",temp,Xstep);
<br/>
      }
<br/>
      if( 0 &gt; Ymin &amp;&amp; 0 &lt; Ymax){
<br/>
         float temp = calcAbsoluteValue(Ymin) * Ystep;
<br/>
         PA_Draw16bitLine(1,0,temp,255,temp,PA_RGB(31,31,31));
<br/>
         PA_OutputText(0,1,2,"%f %d",temp,Ystep);
<br/>
      }
<br/>
   }
<br/>
}
<br/>
void drawFunction(){
<br/>
   for(int ctr = 0;ctr &lt; 256;ctr++){
<br/>
      float x = Xmin + (ctr / Xstep);
<br/>
      float y = x;
<br/>
      if( y &gt; Ymin &amp;&amp; y &lt; Ymax ){
<br/>
         
<br/>
         PA_Put16bitPixel(1,ctr,y,PA_RGB(31,31,31));
<br/>
   }
<br/>
}
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
float calcAbsoluteValue(float num){
<br/>
   if(num &gt; 0){
<br/>
      return num;
<br/>
   }else{
<br/>
      return -num;
<br/>
   }
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
I'm using float because I want it to be accurate (it doesn't need millisecond precise speed when it's only rendering one image every so often, or it will once I get around to an interface, if I ever get there).<br/>_________________<br/>DS Firmware 1, Datel Games n' Music card / Chism's FW hacked GBA MP v2 CF
<br/>
<br/>
There's no place like 127.0.0.1.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#139636 - tepples - Sat Sep 08, 2007 2:08 pm</h4>
    <div class="postbody"><span class="postbody"><span style="font-weight: bold">float:</span> Here, use of the 'float' or 'double' types is appropriate. Common graphing calculators run 8-bit CISC microprocessors (commonly Zilog Z80 or Freescale MC68000) at 10 MHz or less, and they too handle floats in software. The DS ARM9 CPU is 67 MHz on a 33.5 MHz front side bus. Unless <a class="postlink" href="http://gcc.gnu.org/wiki/Software_floating_point" target="_blank">GCC's float library</a> is horribly unoptimized, there should not be a speed problem.
<br/>
<br/>
<span style="font-weight: bold">PA_Put16bitPixel:</span> you might want to consider drawing a vertical line from the last seen y position to this y position, which will help once you start plotting functions whose derivative (slope) is greater than 1. If PALib doesn't have a vertical line function, they're dead easy to write.
<br/>
<br/>
<span style="font-weight: bold">y = x:</span> This is what you currently hardcode as the function to be plotted. What scripting language do you lpan on using to allow the user to define functions?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#139654 - calcprogrammer1 - Sat Sep 08, 2007 5:15 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><span style="font-weight: bold">float:</span> Here, use of the 'float' or 'double' types is appropriate. Common graphing calculators run 8-bit CISC microprocessors (commonly Zilog Z80 or Freescale MC68000) at 10 MHz or less, and they too handle floats in software. The DS ARM9 CPU is 67 MHz on a 33.5 MHz front side bus. Unless <a class="postlink" href="http://gcc.gnu.org/wiki/Software_floating_point" target="_blank">GCC's float library</a> is horribly unoptimized, there should not be a speed problem.</td> </tr></table><span class="postbody">
<br/>
<br/>
It hasn't been a problem so far, I have read a lot of posts saying that float is bad, and to use fixed point instead, but for a graphing system, accuracy is more important than speed (my TI 84 Plus SE w/ 15MHz Z80 graphs really slowly).
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<span style="font-weight: bold">PA_Put16bitPixel:</span> you might want to consider drawing a vertical line from the last seen y position to this y position, which will help once you start plotting functions whose derivative (slope) is greater than 1. If PALib doesn't have a vertical line function, they're dead easy to write.</td> </tr></table><span class="postbody">
<br/>
<br/>
It does have a line function, as used for the axes, but for vertical I just set the Y values to 0 and 191 and for horizontal I set the X values to 0 and 255.  I still don't get this, do you mean instead of drawing a pixel for each point, to draw a line from the last known point to the new point, store the new point as the last point, and calculate the new point, and repeat?  Now that you mention it, I think that's how the graphing calculators work, because you can turn down the resolution so it will graph faster, and it will have many lines instead of smooth curves.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"><span style="font-weight: bold">y = x:</span> This is what you currently hardcode as the function to be plotted. What scripting language do you lpan on using to allow the user to define functions?</td> </tr></table><span class="postbody">
<br/>
<br/>
I am unsure how to go about a user defined function.  The calculator has a function called exec() (maybe eval(), can't remember) that evaluates a string.  I would like a function similar to that, but if there's a library out there that can already do this, and is open source, I'd like to just use that.
<br/>
<br/>
<br/>
<br/>
Also, how do you do things such as sin(), cos(), and tan() in the DS, PAlib's functions are weird, returning 512 degrees or something, I want the real 360 degrees and/or radian measure a real calculator would give.<br/>_________________<br/>DS Firmware 1, Datel Games n' Music card / Chism's FW hacked GBA MP v2 CF
<br/>
<br/>
There's no place like 127.0.0.1.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#139659 - tepples - Sat Sep 08, 2007 6:29 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>calcprogrammer1 wrote:</b></span></td> </tr> <tr> <td class="quote">I am unsure how to go about a user defined function.  The calculator has a function called exec() (maybe eval(), can't remember) that evaluates a string.  I would like a function similar to that, but if there's a library out there that can already do this, and is open source, I'd like to just use that.</td> </tr></table><span class="postbody">
<br/>
There is Lua. Other people sing its praises, but I haven't tried it yet.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Also, how do you do things such as sin(), cos(), and tan() in the DS, PAlib's functions are weird, returning 512 degrees or something, I want the real 360 degrees and/or radian measure a real calculator would give.</td> </tr></table><span class="postbody">
<br/>
For float math, use #include &lt;math.h&gt; and link with -lm (libm.a).
<br/>
<br/>
In general, you could try prototyping this whole thing on a PC, where the publicly available debugging tools are more mature, and then porting it to DS once most of the calculation and graphing logic are stable.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#139696 - nornagon - Sun Sep 09, 2007 12:25 am</h4>
    <div class="postbody"><span class="postbody">You could see what gnuplot (or similar) does and steal that. You should do surface plotting, too!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#139713 - HyperHacker - Sun Sep 09, 2007 6:41 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>calcprogrammer1 wrote:</b></span></td> </tr> <tr> <td class="quote">It hasn't been a problem so far, I have read a lot of posts saying that float is bad, and to use fixed point instead, but for a graphing system, accuracy is more important than speed (my TI 84 Plus SE w/ 15MHz Z80 graphs really slowly).</td> </tr></table><span class="postbody">Float is only bad because it's slow without an FPU. That shouldn't matter for a calculator.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I still don't get this, do you mean instead of drawing a pixel for each point, to draw a line from the last known point to the new point, store the new point as the last point, and calculate the new point, and repeat?</td> </tr></table><span class="postbody">
<br/>
I think what he means is draw your graphs using lines, not pixels. For example, if you do this (pseudo-C):
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">y = 0;
<br/>
for(x=0; x=256; x++)
<br/>
{
<br/>
   DrawPixel(x, y);
<br/>
   y += 5;
<br/>
}</td> </tr></table><span class="postbody">You won't end up with a nice graph; you'll have a broken line. Instead, you should do something like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">oldx = 0;
<br/>
oldy = 0;
<br/>
y = 0;
<br/>
for(x=0; x=256; x++)
<br/>
{
<br/>
   DrawLine(oldx, oldy, x, y);
<br/>
   oldx = x;
<br/>
   oldy = y;
<br/>
   y += 5;
<br/>
}</td> </tr></table><span class="postbody">That way you'll have a nice smooth graph.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#139726 - calcprogrammer1 - Sun Sep 09, 2007 3:18 pm</h4>
    <div class="postbody"><span class="postbody">That makes sense, but the thing I am stuck with is how to graph the Y values correctly.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
DS:
<br/>
<br/>
0,0 ----------------------------------&gt; Positive X
<br/>
|
<br/>
|
<br/>
|
<br/>
|
<br/>
|
<br/>
|
<br/>
|
<br/>
V Positive Y
<br/>
<br/>
Graph:
<br/>
<br/>
                               ^ Positive Y
<br/>
                               |
<br/>
                               |                     
<br/>
                               |
<br/>
Negative X &lt;------------------------------------&gt; Positive X
<br/>
                               |
<br/>
                               |
<br/>
                               |
<br/>
                               V Negative Y
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
The X graphing is already implemented, but I'm unsure of how to graph the Y correctly.  I have Ymin (bottom), Ymax (top), Yspan (top minus bottom), Ystep (amount of pixels per 1 unit, it's 192 / Yspan I think).<br/>_________________<br/>DS Firmware 1, Datel Games n' Music card / Chism's FW hacked GBA MP v2 CF
<br/>
<br/>
There's no place like 127.0.0.1.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#139740 - HyperHacker - Sun Sep 09, 2007 6:27 pm</h4>
    <div class="postbody"><span class="postbody">You mean your graphs are upside-down because 0,0 on the DS is top left and you want it to be bottom left? That's simple, draw your pixels at X, 192 - Y. &gt;_&gt;<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#139751 - calcprogrammer1 - Sun Sep 09, 2007 8:12 pm</h4>
    <div class="postbody"><span class="postbody">That and also draw negative Y values correctly, and to a -10 to 10 scale.<br/>_________________<br/>DS Firmware 1, Datel Games n' Music card / Chism's FW hacked GBA MP v2 CF
<br/>
<br/>
There's no place like 127.0.0.1.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#139764 - Cearn - Mon Sep 10, 2007 12:04 am</h4>
    <div class="postbody"><span class="postbody">What you're trying to do here is map one coordinate space onto another. Say you have spaces <span style="font-style: italic">P</span> and <span style="font-style: italic">Q</span> (for the logical graph coordinates and the screen coordinates, respectively). Let <span style="font-weight: bold">p</span>=(px, py) and <span style="font-weight: bold">q</span>=(qx,qy) be points in these two systems. Since these are linear systems, the coordinates of <span style="font-weight: bold">p</span> and <span style="font-weight: bold">q</span> will be related via these equations:
<br/>
<br/>
qx = ax*px + bx
<br/>
qy = ay*py + by
<br/>
<br/>
Now take any two pairs of points in each system that map onto each other: <span style="font-weight: bold">p1</span>→<span style="font-weight: bold">q1</span> and <span style="font-weight: bold">p2</span>→<span style="font-weight: bold">q2</span>. For the <span style="font-style: italic">x</span> coordinate, you will have:
<br/>
<br/>
qx1 = ax*px1 + bx
<br/>
qx2 = ax*px2 + bx
<br/>
<br/>
and using a few simple substitutions you can find ax and bx:
<br/>
<br/>
ax = (qx2-qx1) / (px2-px1)
<br/>
bx = qx1 - (qx2-qx1)/(px2-px1)*px1
<br/>
<br/>
Finding ay and by works much the same way. 
<br/>
<br/>
The nice thing is that this process works regardless of what the points actually are, and it works for in both ways. Now, in your case you already know the two pairs of points: top-left and bottom right. For the top-left (<span style="font-weight: bold">q1</span> = (0,0)) you have <span style="font-weight: bold">p1</span> = (-10, 10); for the bottom right, it's <span style="font-weight: bold">q2</span> = (256,192) and <span style="font-weight: bold">p2</span> = (10, -10). Now all you have to do is fill in the numbers. Your setupWindow() already uses a special-case of the equations above, the math for the points of the graph itself is practically the same.
<br/>
<br/>
For practical use, it may help to keep the mapped points in memory somewhere and create two mapping functions that convert from logical→screen coordinates vice versa. You're already halfway there in terms of variables: Xmin, Ymin etc are essentially the logical part of the mapping, and Xstep and Ystep are what I've called ax and ay. Add the screen-part and the b's and you have enough for coordinate transformations for anything. Do it on the PC first to see if you got the math right and then port it. I'd even go as far as to say do it in a spreadsheet program first; they're practically made for this stuff.
<br/>
<br/>
For mode on how this stuff works, try <a class="postlink" href="http://www.google.com/search?q=mapping+mode" target="_blank">googling for 'mapping mode'</a>.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#139777 - calcprogrammer1 - Mon Sep 10, 2007 2:31 am</h4>
    <div class="postbody"><span class="postbody">Thanks for your post, Cearn, it is very informative...now I'll try to implement it.
<br/>
<br/>
Edit:
<br/>
<br/>
Implemented it, but it was drawing negative, so I added 192 - (the qy expression) to make it draw correctly, and I got this:
<br/>
<br/>
<a href="http://img530.imageshack.us/img530/8237/itworksvg9.jpg">[Images not permitted - Click here to view it]</a><br/>_________________<br/>DS Firmware 1, Datel Games n' Music card / Chism's FW hacked GBA MP v2 CF
<br/>
<br/>
There's no place like 127.0.0.1.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#139787 - calcprogrammer1 - Mon Sep 10, 2007 4:45 am</h4>
    <div class="postbody"><span class="postbody">Here's some more stuff I've done, added math.h to the includes so I could use some functions, and (hard coded, recompiling each time) produced these:
<br/>
<a href="http://img530.imageshack.us/img530/1791/graphds1jo8.jpg">[Images not permitted - Click here to view it]</a>
<br/>
<br/>
Now I need to know if there's a library that can execute a string, such as
<br/>
<br/>
Y= "(x+3)+5"
<br/>
Y= "sin(x)"
<br/>
Y= "sin(x)+1"
<br/>
Y= "x^3"
<br/>
<br/>
It would need to account for parentheses as well, so that 1+(5*2) would equal 11, not 12 (where you add 1 and 5 to get 6, then *2 to get 12).  I've seen libraries for PC apps, but would they implement into a DS application or not?<br/>_________________<br/>DS Firmware 1, Datel Games n' Music card / Chism's FW hacked GBA MP v2 CF
<br/>
<br/>
There's no place like 127.0.0.1.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#139801 - nornagon - Mon Sep 10, 2007 10:06 am</h4>
    <div class="postbody"><span class="postbody">Looking good. Now make it understand asymptotes and unmapped x-values (also multiple-mapped x-values, as in x = y?). :D</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#139831 - josath - Mon Sep 10, 2007 5:06 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>calcprogrammer1 wrote:</b></span></td> </tr> <tr> <td class="quote">It would need to account for parentheses as well, so that 1+(5*2) would equal 11, not 12 (where you add 1 and 5 to get 6, then *2 to get 12).  I've seen libraries for PC apps, but would they implement into a DS application or not?</td> </tr></table><span class="postbody">
<br/>
<br/>
If it's a portable library, with source code, it should be simple to port, if it doesn't have any OS-specific stuff.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#139832 - kusma - Mon Sep 10, 2007 5:12 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>calcprogrammer1 wrote:</b></span></td> </tr> <tr> <td class="quote">Now I need to know if there's a library that can execute a string, such as
<br/>
</td> </tr></table><span class="postbody">Check out: <a href="http://www.arstdesign.com/articles/expression_evaluation.html" target="_blank">http://www.arstdesign.com/articles/expression_evaluation.html</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#139930 - Corsix - Tue Sep 11, 2007 8:13 pm</h4>
    <div class="postbody"><span class="postbody">Lua is definately a viable choice for this. It has the upside of users potentially being able to define their own functions for use in graphs, and other such things that only a true language can give.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   viewport_t oViewport;
<br/>
   oViewport.fXMin = -8.0f;
<br/>
   oViewport.fXMax =  8.0f;
<br/>
   oViewport.fYMin = -6.0f;
<br/>
   oViewport.fYMax =  6.0f;
<br/>
<br/>
   equation_t oEquation[4];
<br/>
   LuaCalc oCalc;
<br/>
   oCalc.newEquation(&amp;oEquation[0], "x = sin(y)", g_iColours[0]);
<br/>
   oCalc.newEquation(&amp;oEquation[1], "y = tan(x)", g_iColours[1]);
<br/>
   oCalc.newEquation(&amp;oEquation[2], "y = min(sin(x), cos(x))", g_iColours[2]);
<br/>
   oCalc.newEquation(&amp;oEquation[3], "x &lt; y", g_iColours[3]);
<br/>
   
<br/>
   renderGraph(&amp;oViewport, oEquation, 4);</td> </tr></table><span class="postbody">
<br/>
<a class="postlink" href="http://img510.imageshack.us/img510/4933/image1nj9.png" target="_blank">Onscreen result</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#139955 - calcprogrammer1 - Wed Sep 12, 2007 1:00 am</h4>
    <div class="postbody"><span class="postbody">I looked into Lua but I don't want to write a script, I'm looking to write a real, .nds application, not a Lua script.
<br/>
<br/>
So, now I'm trying to implement an interface, and it's being stupid.  I have 10 sprites, 32x64 (2 frames, one normal, one selected), 256 colors.  If I load them all and draw them to the screen, it gives me an error about lack of RAM...how do you go about fixing this stupid thing?  The images are all buttons, with a gradient background.<br/>_________________<br/>DS Firmware 1, Datel Games n' Music card / Chism's FW hacked GBA MP v2 CF
<br/>
<br/>
There's no place like 127.0.0.1.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#139960 - calcprogrammer1 - Wed Sep 12, 2007 2:22 am</h4>
    <div class="postbody"><span class="postbody">Ok, I'm trying to use a library called ExprEval, written in C, with my program.  When I compile it, I get a bunch of errors such as:
<br/>
<br/>
error: pasting "__expr_sin" and "{" does not give a valid preprocessing token
<br/>
<br/>
In the library, there's a bunch of:
<br/>
<br/>
EXPR_FUNCTIONSOLVER(__expr_sin)
<br/>
{
<br/>
...
<br/>
}
<br/>
<br/>
where it defines functions I guess, but compiling it makes each one give an error.<br/>_________________<br/>DS Firmware 1, Datel Games n' Music card / Chism's FW hacked GBA MP v2 CF
<br/>
<br/>
There's no place like 127.0.0.1.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#139961 - sajiimori - Wed Sep 12, 2007 2:49 am</h4>
    <div class="postbody"><span class="postbody">Tepples and Corsix were not suggesting that you write your DS application in Lua.  The idea is to have your DS program <span style="font-style: italic">provide</span> Lua to users, as a way for them to program your calculator.
<br/>
<br/>
It's a perfectly viable option, and not especially hard to implement.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#139976 - Corsix - Wed Sep 12, 2007 7:56 am</h4>
    <div class="postbody"><span class="postbody">Go to lua.org, download the latest one, and copy the stuff from lua-5.1.2\source into your source/include folders. You may want to pop into luaconf.h and change it from using doubles to using floats. To then use lua in your program, you first need to include it:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">extern "C" {
<br/>
#include "lua.h"
<br/>
#include "lauxlib.h"
<br/>
#include "lualib.h"
<br/>
}</td> </tr></table><span class="postbody">For example, the LuaCalc constructor calls <a class="postlink" href="http://www.lua.org/manual/5.1/manual.html#luaL_newstate" target="_blank">luaL_newstate</a> to create a lua instance. The newEquation function calls <a class="postlink" href="http://www.lua.org/manual/5.1/manual.html#lua_load" target="_blank">lua_load</a> to load the string as a chunk (a function). It then does some magic to find out what the subject of the equation was, and finally drops the relevant callbacks into an equation_t structure. These callbacks call <a class="postlink" href="http://www.lua.org/manual/5.1/manual.html#lua_pcall" target="_blank">lua_pcall</a> to execute the chunk and get a result. Finally, the LuaCalc destructor calls <a class="postlink" href="http://www.lua.org/manual/5.1/manual.html#lua_close" target="_blank">lua_close</a>  to free the memory used by lua.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#140019 - calcprogrammer1 - Wed Sep 12, 2007 8:58 pm</h4>
    <div class="postbody"><span class="postbody">Ok, I'll try using Lua, I never heard of it but I guess it has math functions (?).
<br/>
<br/>
My other problem is for the interface, I had a problem loading different sprites for each button (1,2,3,4,5,6,7,8,9,0,.,+,-,/,*,=,etc) because the memory ran out, so I have blank buttons.  How would I go about drawing a label on each button.  I'd like to use 16c Text but since that is a background, sprites usually draw in front of backgrounds.
<br/>
<br/>
I've added what you told me to to the includes (I put the Lua files in /source), then I added this to my main loop:
<br/>
<br/>
int main()
<br/>
{
<br/>
PA_Init();
<br/>
PA_InitVBL();
<br/>
<br/>
PA_SetBgPalCol(1,0,PA_RGB(0,0,0));
<br/>
PA_Init16bitBg(1,3);
<br/>
initMenu();
<br/>
while(1)
<br/>
{
<br/>
checkMenu();
<br/>
viewport_t oViewport;
<br/>
oViewport.fXMin = -8.0f;
<br/>
oViewport.fXMax = 8.0f;
<br/>
oViewport.fYMin = -8.0f;
<br/>
oViewport.fYMax = 8.0f;
<br/>
equation_t oEquation[4];
<br/>
LuaCalc oCalc;
<br/>
oCalc.newEquation(&amp;oEquation[0], "x = sin(y)", g+iColours[0]);
<br/>
renderGraph(&amp;oViewport, oEquation, 4);
<br/>
PA_WaitForVBL();
<br/>
}
<br/>
}
<br/>
<br/>
but I get a bunch of stuff like:
<br/>
<br/>
'viewport_t' was not declared in this scope, 'oViewport was not declared in this scope, etc.<br/>_________________<br/>DS Firmware 1, Datel Games n' Music card / Chism's FW hacked GBA MP v2 CF
<br/>
<br/>
There's no place like 127.0.0.1.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#140030 - Corsix - Wed Sep 12, 2007 10:31 pm</h4>
    <div class="postbody"><span class="postbody">Thats because viewport_t, equation_t, LuaCalc and renderGraph are my own creations. I can share the code if you want.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#140042 - calcprogrammer1 - Thu Sep 13, 2007 12:23 am</h4>
    <div class="postbody"><span class="postbody">All I want is a function that I can use to evaluate strings, but it needs to support at least an X variable, so maybe like:
<br/>
<br/>
y = evalString("sin(x)+5(cos(X)^2)",x)
<br/>
<br/>
where the function would be like:
<br/>
<br/>
evalString(char* expression, float x){
<br/>
...
<br/>
...
<br/>
...
<br/>
}
<br/>
<br/>
the X variable would be used any place there's an X in the equation.
<br/>
<br/>
Could something along those lines be done with Lua (or anything else), and if you can, source code or an example would be nice, I've never used Lua so I have no clue what I'm supposed to do here.
<br/>
<br/>
I already have graphing, as you've seen in other examples, so I want to just use the one I already have, but I need an expression evaluator.<br/>_________________<br/>DS Firmware 1, Datel Games n' Music card / Chism's FW hacked GBA MP v2 CF
<br/>
<br/>
There's no place like 127.0.0.1.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#140045 - kusma - Thu Sep 13, 2007 12:38 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>calcprogrammer1 wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
evalString(char* expression, float x)
<br/>
</td> </tr></table><span class="postbody">
<br/>
To be honest, I'd rather do it like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">struct expression *parseExpression(const char *string);
<br/>
float evalExpression(struct expression, float x);</td> </tr></table><span class="postbody">
<br/>
This is because parsing text per iteration might be a little too slow, even for a graphic calculator (think navigation). Parse first, build a RPN-structure for the expression, and evaluate that given a set of constants. Look at the link I provided on the previous page for details on how to implement this.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#140054 - tepples - Thu Sep 13, 2007 1:25 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>calcprogrammer1 wrote:</b></span></td> </tr> <tr> <td class="quote">My other problem is for the interface, I had a problem loading different sprites for each button (1,2,3,4,5,6,7,8,9,0,.,+,-,/,*,=,etc)</td> </tr></table><span class="postbody">
<br/>
You could just make a full size alphanumeric keyboard. You'll need to anyway so that the user can enter formulas.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"> because the memory ran out, so I have blank buttons.  How would I go about drawing a label on each button.  I'd like to use 16c Text but since that is a background, sprites usually draw in front of backgrounds.</td> </tr></table><span class="postbody">
<br/>
Sprites with Z level 1 draw behind background layers with Z level 0. ("Z level" and "priority" are the same thing.)<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#140060 - calcprogrammer1 - Thu Sep 13, 2007 2:07 am</h4>
    <div class="postbody"><span class="postbody">I thought a good interface system would be a menu like system like graphing calculators give you, where you have the number buttons (big enough that you could tap with a fingertip if you want) and a bunch of side buttons, like Trig, Math, Test, Num, etc, where hitting Trig would bring up things like sin(), cos(), tan(), sec(), csc(), and cot() and Math would bring up things like iPart(), fPart(), int(), abs(), sqrt(), then I could always add a tab that brings up the PA keyboard if you choose to use that.
<br/>
<br/>
Does anyone know how to use Lua to evaluate an expression?  I get the idea of first converting it to a struct, then re-evaluating it, but I'd need commands that can do this.  Is there anything already made (sounds really hard, considering I've never heard of RPN or anything like that), else my interpretation would be really limited and simple (I could probably do a simple evaluation system like mentioned on that page, but parentheses would be confusing, as would functions).<br/>_________________<br/>DS Firmware 1, Datel Games n' Music card / Chism's FW hacked GBA MP v2 CF
<br/>
<br/>
There's no place like 127.0.0.1.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#140098 - Corsix - Thu Sep 13, 2007 4:00 pm</h4>
    <div class="postbody"><span class="postbody"><a href="http://www.corsix.org/misc/GraphPlotter.zip" target="_blank">http://www.corsix.org/misc/GraphPlotter.zip</a>
<br/>
<br/>
Included is the compiled .nds (enter equations like "y = x^2" and press enter), along with source code. See graph.h for definitions of the data structures, and LuaCalc.cpp for use of lua.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#140146 - calcprogrammer1 - Thu Sep 13, 2007 9:56 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for that, it works pretty well in the example, though I'm confused on how to implement it.
<br/>
<br/>
How do you actually read out a value?  Say I make a new equation like:
<br/>
<br/>
oCalc.newEquation(&amp;oEquation[0], "y=sin(x)", g_iColours[0]);
<br/>
<br/>
and I want to plug in for X to find Y, so how would I go about doing that?  I have absolutely no clue what's going on in the graph.h, with all the -&gt; stuff.  I'm looking to do something in simple C and PAlib, but if I can figure out how this works I'd use it.<br/>_________________<br/>DS Firmware 1, Datel Games n' Music card / Chism's FW hacked GBA MP v2 CF
<br/>
<br/>
There's no place like 127.0.0.1.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#140150 - Corsix - Thu Sep 13, 2007 10:51 pm</h4>
    <div class="postbody"><span class="postbody">Once you have an equation_t structure filled out(eg, by calling oCalc.newEquation), you can use it like so:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
float x,y;
<br/>
if(oEquation[0].m_eSubject == equation_t::S_X) // x = ...
<br/>
{
<br/>
    x = oEquation[0].m_fnPlotFunction(y, oEquation[0].m_pToken);
<br/>
    draw_point(x,y);
<br/>
}
<br/>
if(oEquation[0].m_eSubject == equation_t::S_Y) // y = ...
<br/>
{
<br/>
    y = oEquation[0].m_fnPlotFunction(x, oEquation[0].m_pToken);
<br/>
    draw_point(x,y);
<br/>
}
<br/>
if(oEquation[0].m_eSubject == equation_t::S_Mixed) // inequality
<br/>
{
<br/>
    if(oEquation[0].m_fnPlotFunctionMixed(x, y, oEquation[0].m_pToken))
<br/>
        draw_point(x,y);
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#140184 - calcprogrammer1 - Fri Sep 14, 2007 2:56 am</h4>
    <div class="postbody"><span class="postbody">&gt;.&lt; this is getting annoying.  Why can't I find just a simple evaluator...everything has to be all complex and stuff!
<br/>
<br/>
I added Lua to my program like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include "LuaCalc.h"
<br/>
<br/>
equation_t oEquation[1];
<br/>
LuaCalc oCalc;
<br/>
<br/>
float evaluateString(char* expression, float x){
<br/>
     oCalc.newEquation(&amp;oEquation[0],expression,PA_RGB(31,31,31));
<br/>
     float y = oEquation[0].m_fnPlotFunction(x,oEquation[0].m_pToken);
<br/>
     return y;
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
So, I go to compile, and I get this during Linking...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">c/devkitPro/Projects/graphing_example/graphing_example/source/eval.h(3): undefined reference to 'equation_t::equation_t()'</td> </tr></table><span class="postbody">
<br/>
<br/>
How can I fix this...at this rate it may just be best to start from scratch and write a simple evaluation thing...though it doesn't sound simple at all.<br/>_________________<br/>DS Firmware 1, Datel Games n' Music card / Chism's FW hacked GBA MP v2 CF
<br/>
<br/>
There's no place like 127.0.0.1.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#140229 - nornagon - Fri Sep 14, 2007 2:10 pm</h4>
    <div class="postbody"><span class="postbody">'undefined reference' means you forgot to link something into the final executable. (Maybe you even forgot to compile it!)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#140257 - calcprogrammer1 - Fri Sep 14, 2007 9:02 pm</h4>
    <div class="postbody"><span class="postbody">At that point..I have no clue...I clicked Rebuild and it did all the compiling stuff, then it gave me that.  Is it something to do with the makefile?  PAlib uses a weird makefile, so putting libraries in with it is really a pain, that's why I'm looking for a simple, one file method of doing this.<br/>_________________<br/>DS Firmware 1, Datel Games n' Music card / Chism's FW hacked GBA MP v2 CF
<br/>
<br/>
There's no place like 127.0.0.1.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#140258 - Corsix - Fri Sep 14, 2007 9:08 pm</h4>
    <div class="postbody"><span class="postbody">equation_t has a default constructor in graph.cpp, which I'm guessing you forgot to copy into one of your source files</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#140260 - calcprogrammer1 - Fri Sep 14, 2007 9:14 pm</h4>
    <div class="postbody"><span class="postbody">Ah, I only included graph.h.  I'll put graph.cpp in and see if it works.<br/>_________________<br/>DS Firmware 1, Datel Games n' Music card / Chism's FW hacked GBA MP v2 CF
<br/>
<br/>
There's no place like 127.0.0.1.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#140838 - calcprogrammer1 - Thu Sep 20, 2007 3:16 am</h4>
    <div class="postbody"><span class="postbody">I finally got my computer set back up, and I found the info I needed out of graph.c, just copied it into the other file, and it worked :)
<br/>
<br/>
Now to code an interface, I've already made most of the icons, but now to code.<br/>_________________<br/>DS Firmware 1, Datel Games n' Music card / Chism's FW hacked GBA MP v2 CF
<br/>
<br/>
There's no place like 127.0.0.1.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#140841 - Ant6n - Thu Sep 20, 2007 4:26 am</h4>
    <div class="postbody"><span class="postbody">I would use flex to parse expressions and build expression trees.
<br/>
the expression tree then would then represent a function, or just a mathematical expression (a function is just a parametrized expression, i.e. one with a variable in it)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
