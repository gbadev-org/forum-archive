<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>working Java for DS - pre-pre-alpha - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > working Java for DS - pre-pre-alpha</h2>
<div id="posts">
<div class="post">
    <h4>#136932 - josath - Mon Aug 06, 2007 5:12 pm</h4>
    <div class="postbody"><span class="postbody">I took <a class="postlink" href="http://www.torlus.com/index.php?2004/01/05/25-java4gba---a-java-virtual-machine-for-gba" target="_blank">Torlus's Java port for GBA</a> and modified it to work on NDS with DLDI.
<br/>
Currently there is no access to the NDS hardware, besides printing text.
<br/>
<br/>
To use this demo, place kvm.nds and all the *.class files on your flashcart. Run kvm.nds, then select a .class file to run. There are a few examples testing various stuff. LcdSwapTest.class is a very simple example to prove that it is feasible to interface with the DS hardware, once a Java KNI wrapper is written around libnds.
<br/>
<br/>
<a class="postlink" href="http://blog.davr.org/2007/08/08/java-for-nds/" target="_blank">Download alpha R2</a>
<br/>
<br/>
If you want to compile your own java files, make sure they target version 1.4 (I'm not sure all the features this supports, but it wont even start if you do 1.5 or higher). For example, this will compile Hello.java into Hello.class:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">javac -source 1.4 -target 1.4 Hello.java</td> </tr></table><span class="postbody">
<br/>
<br/>
Someone please tell me this is really dumb, before I waste too much time on it ;)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>JSensebe wrote:</b></span></td> </tr> <tr> <td class="quote">Java4DS: When PALib Just Isn't Slow or Clunky Enough?</td> </tr></table><span class="postbody">
<br/>
<br/>
-------
<br/>
UPDATE: Posted a new version, this includes a way to get input from the user, read files from FAT, and to display sprites onscreen.</span><span class="gensmall"><br/><br/>Last edited by josath on Wed Aug 08, 2007 5:39 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#136938 - Ant6n - Mon Aug 06, 2007 6:03 pm</h4>
    <div class="postbody"><span class="postbody">wouldn't it make more sense to compile java code to arm asm, using gcj or something?
<br/>
it makes sense to offer some java alternative, since school's these days put a lot more emphasis on that language; and thus there would be more possible developers.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#136940 - josath - Mon Aug 06, 2007 6:40 pm</h4>
    <div class="postbody"><span class="postbody">It might be more efficient, but maintaining a whole compiler is a lot more work, since I now have to target multiple differing platforms (PC -- windows, mac, etc), versus simply targeting the NDS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#136947 - Quirky - Mon Aug 06, 2007 8:10 pm</h4>
    <div class="postbody"><span class="postbody">With all due respect, you have gone the easy route ;-) A more challenging and future-proof solution, though a lot tougher, would have been to provide a DS layer for the current GPL code that works with the newer JDKs.
<br/>
<br/>
Perfectly fine to test the waters of course, it would be interesting to see what could be done with Java on the DS, but with no access to anything graphical it is a bit pointless. 
<br/>
<br/>
I'm not even sure what the best way to do the graphics would be - is there any sort of mobile swing available? Or an open GL type layer? Or some custom native classes? Custom native classes have to have their native bits compiled into the the embedded VM of course (no dynamic libraries on the DS). Plus testing would be tricky... PC "emulation" of the DS native classes for testing, providing PC builds of the embedded VM including these classes? It'd be a lot of work!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#136952 - magicdanw - Mon Aug 06, 2007 8:27 pm</h4>
    <div class="postbody"><span class="postbody">I like what I see so far!  I see you started implementing libnds (or PAlib?) functions as Java methods, which is very cool.  I'm curious how you did this, though.  I see you import nds.Video, but I don't see any nds class.  Did you compile the class into the VM?  If so, maybe you could release the source code so I or other people could try to implement more functionality based on your initial example?
<br/>
<br/>
Once again, great work!  Your ability to use makefiles is clearly superior to mine, since I was unable to even compile Java4gba in its original state!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#136956 - josath - Mon Aug 06, 2007 9:42 pm</h4>
    <div class="postbody"><span class="postbody">As far as interfacing with the hardware, I'll probably try to make a very basic wrapper over libnds using KNI (the light version of JNI), basically lets you call C functions from Java. I looked at MIDP (standardized library for gfx/input/sound in Java on mobile devices) briefly, but it looked like way too much work to port to the DS.
<br/>
<br/>
These libraries will be compiled into the VM (like all the other standard libraries). The downside to this is that you need the whole devkitARM setup and have to recompile the VM in order to add / make changes to the built in classes. 
<br/>
<br/>
As far as testing, you can simply run the DS KVM directly in an emulator on the PC (so no need to reimplement the native DS classes on the PC). It works quite well under iDeaS with the R4 DLDI emulation.
<br/>
<br/>
Here's my test nds/Video.java file:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">package nds;
<br/>
<br/>
public class Video {
<br/>
        public static native void lcdSwap();
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
And a corresponding Java_nds_Video.c:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include &lt;nds.h&gt;
<br/>
#include &lt;nds/arm9/video.h&gt;
<br/>
#include &lt;kni.h&gt;
<br/>
#include &lt;stdio.h&gt;
<br/>
<br/>
KNIEXPORT KNI_RETURNTYPE_VOID Java_nds_Video_lcdSwap() {
<br/>
    lcdSwap(); // this function is defined in libnds
<br/>
    KNI_ReturnVoid();
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
Right now I'm having trouble with the GC crashing when I do anything more complex than the above KNI, so I'll need to track that down before I can do any more.
<br/>
<br/>
My plan is to finish this basic wrapper, so people can at least load stuff into VRAM, read key input, and poke arbitrary hardware registers.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#136962 - magicdanw - Mon Aug 06, 2007 10:27 pm</h4>
    <div class="postbody"><span class="postbody">I think a nice feature for now would be to make a wrapper for PALib's keyboard routines, so that people can make functional console programs.  (anyone up for a good old text adventure?  :D)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#136963 - josath - Mon Aug 06, 2007 10:29 pm</h4>
    <div class="postbody"><span class="postbody">Java and PALib both suck too much, that combining them in a single app would cause some kind implosion and/or blackhole.
<br/>
<br/>
I dunno why I'm even doing this, it's not like Java really has any advantage over C++.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#136964 - magicdanw - Mon Aug 06, 2007 10:35 pm</h4>
    <div class="postbody"><span class="postbody">Lol.  The one advantage I can think of is that I know Java and I don't know C++.  And that Java programs that already exist could be ported to the DS if a good JVM were written for the DS.
<br/>
<br/>
If you don't want to do this, I understand why.  But could you post the source code and makefiles you use online?  I'd like to mess around with this, but I can't get my copy of the Java4gba source to compile at all...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137132 - lores - Wed Aug 08, 2007 9:23 am</h4>
    <div class="postbody"><span class="postbody">Hey josath
<br/>
<br/>
i wanted to do exactly the same but i didn't have the time.
<br/>
My plan is to port MIDP 2.0 to the DS, and possibly JSR-184 for 3D.
<br/>
As for MIDP 2.0: Some stuff is unimportant to me, Forms for example are for whinies ;)
<br/>
<br/>
Why am i interested in doing that? Because i'm a mobile games developer, developing in Java. I want to create DS games without having to worry (too much) about the DS's internals. I am used to create games for very limited devices, so are many other mobile game developers. If i could take my game, make minor or no changes and play it on the DS - that would be awesome.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137136 - melw - Wed Aug 08, 2007 9:53 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>lores wrote:</b></span></td> </tr> <tr> <td class="quote">Why am i interested in doing that? Because i'm a mobile games developer, developing in Java. I want to create DS games without having to worry (too much) about the DS's internals. I am used to create games for very limited devices, so are many other mobile game developers. If i could take my game, make minor or no changes and play it on the DS - that would be awesome.</td> </tr></table><span class="postbody">
<br/>
<br/>
You know, C/C++ and Java aren't that different in the end... In your case it would be probably a lot easier and more efficient to write a wrapper or bunch of defines where C and Java differ and use the same code base for both mobile and DS builds. Especially if you forget all Java-specific features the "porting" can be surprisingly easy. String implementation gives some headache and array definitions can be annoying, but that's mostly it. :)
<br/>
<br/>
Of course I'm not stopping you from porting MIDP2 nor JSR-184, but that might get sluggish in the end even with huge amount of work poured into making that happen.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137176 - josath - Wed Aug 08, 2007 4:12 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>melw wrote:</b></span></td> </tr> <tr> <td class="quote">Of course I'm not stopping you from porting MIDP2 nor JSR-184, but that might get sluggish in the end even with huge amount of work poured into making that happen.</td> </tr></table><span class="postbody">
<br/>
<br/>
Yes...MIDP2 itself is larger than the entire KVM, with much more platform-specific code, so it may be quite a task to port :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137183 - josath - Wed Aug 08, 2007 5:41 pm</h4>
    <div class="postbody"><span class="postbody">An update: I've written a wrapper around parts of libnds, there's enough there to load files from the flashcart, create sprites, and read user input.
<br/>
<br/>
I included a couple of example java files as well, so you can test it without compiling anything:
<br/>
<br/>
<a href="http://blog.davr.org/2007/08/08/java-for-nds/" target="_blank">http://blog.davr.org/2007/08/08/java-for-nds/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137211 - dantheman - Wed Aug 08, 2007 9:24 pm</h4>
    <div class="postbody"><span class="postbody">This looks really interesting to me.  I'm about to start an AP Computer Science class for my senior year of high school, which will be my first real introduction to programming for any system.  The class will be teaching Java, so it would be cool to be able to see the things I learn take form on the DS as well as on the computer.  Of course I realize there will be differences to take into account, but it should still be fun to use.
<br/>
<br/>
Wishing you the best of luck josath.
<br/>
<br/>
Just out of curiosity, could a text viewer be feasible in its current status?  You said it can now read files from a media card and always had the ability to print text, so would it be a simple matter to read a text file from the card and print its contents to the screen?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137215 - josath - Wed Aug 08, 2007 9:31 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>dantheman wrote:</b></span></td> </tr> <tr> <td class="quote">Just out of curiosity, could a text viewer be feasible in its current status?  You said it can now read files from a media card and always had the ability to print text, so would it be a simple matter to read a text file from the card and print its contents to the screen?</td> </tr></table><span class="postbody">
<br/>
<br/>
Yes, one of the included examples reads the first 20 bytes of 'test.txt' and displays it. Of course there are much better ds homebrew already written for reading text files.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137741 - Inopia - Wed Aug 15, 2007 8:23 am</h4>
    <div class="postbody"><span class="postbody">I think this is a very nice development. Java is my weapon of choice for anything non-embedded, and developing a solid VM has some uses.
<br/>
<br/>
First of all, if you can get MIDP to run, you can run Opera Mini. There's a an open source MIDP implementation on top of the standard Java libs called MicroEmulator (<a class="postlink" href="http://www.microemu.org" target="_blank">http://www.microemu.org</a>). There's also a bunch of MIDP games out there you can toy around with. 
<br/>
<br/>
Furthermore, a multithreading programming environment such as this makes is a lot easier to write simple networking programs. 
<br/>
<br/>
Don't stop working on this, it could be a lot of fun:)[/url]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#138229 - lores - Tue Aug 21, 2007 2:03 pm</h4>
    <div class="postbody"><span class="postbody">Hey josath, that's just awesome. Please continue your work on the libnds wrapper. With that wrapper you can create almost anything with java on the ds.
<br/>
<br/>
I would like to implement the MIDP lib on top of that to get my mobile stuff going on the DS.
<br/>
<br/>
Even if you're not interested in MIDP: Your wrapper will allow for easier homebrew development on the DS. Go go, josath!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#138230 - Lick - Tue Aug 21, 2007 2:54 pm</h4>
    <div class="postbody"><span class="postbody">May I suggest <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?p=134465#134465" target="_blank">melw's fileLocator</a> for avoiding root-chaos? 
<br/>
<br/>
Nice work by the way. I'm not much of a Java-guy but this project definitely shows its worth.<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
