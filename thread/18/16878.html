<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>function pointer not correct? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > function pointer not correct?</h2>
<div id="posts">
<div class="post">
    <h4>#170405 - Tommmie - Mon Sep 21, 2009 7:23 pm</h4>
    <div class="postbody"><span class="postbody">Hey everyone, 
<br/>
<br/>
I was executing this piece of code(it prints function pointers):
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include &lt;nds.h&gt;
<br/>
#include &lt;stdio.h&gt;
<br/>
<br/>
<br/>
int func1(int a)
<br/>
{
<br/>
  
<br/>
   return a;
<br/>
}
<br/>
 
<br/>
char func2(char b)
<br/>
{
<br/>
<br/>
   return 'b';
<br/>
}
<br/>
 
<br/>
int main()
<br/>
{
<br/>
<br/>
   consoleDemoInit();
<br/>
   fp ptr1;
<br/>
   
<br/>
   int temp1;
<br/>
   char temp2;
<br/>
   
<br/>
  
<br/>
   ptr1 = (fp) func1;
<br/>
   iprintf("pointer1 is: %d \n", (int)ptr1);
<br/>
   temp1 = ((int (*)(int)) ptr1)(1);
<br/>
   
<br/>
   ptr1 = (fp) func2;
<br/>
   iprintf("pointer2 is: %d \n", (int)ptr1);
<br/>
   temp2 = ((char (*)(char))ptr1)('a');
<br/>
   
<br/>
   printf("Received %d %c\n", temp1, temp2);
<br/>
   return 0;
<br/>
}</td> </tr></table><span class="postbody">
<br/>
and I noticed that the offsets which were displayed are not correctly, almost but not correct:(I looked in the .map file for the real offsets):
<br/>
<br/>
<span style="font-weight: bold">real offsets:</span>
<br/>
func1: 0x0200037c
<br/>
func2: 0x02000380
<br/>
<br/>
<span style="font-weight: bold">
<br/>
results of the program:</span>
<br/>
func1: 0x0200037D
<br/>
func2: 0x02000381
<br/>
<br/>
but why are the addresses just 1 more? can someone explain it?
<br/>
<br/>
thanks,
<br/>
<br/>
Tommmie[/code]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#170408 - Min - Mon Sep 21, 2009 8:36 pm</h4>
    <div class="postbody"><span class="postbody">The ARM9 ( and ARM7 ) processor used by the DS has two different sets of instructions; a 32 bit instruction set and a smaller 16 bit instruction set called Thumb. Your functions are compiled into Thumb code by default. The least significant bit of the address is used to tell the processor which instruction set to use, the bit is <span style="font-style: italic">set</span> for Thumb code thats why the addresses of your functions appear to be +1.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#170426 - Tommmie - Tue Sep 22, 2009 1:32 pm</h4>
    <div class="postbody"><span class="postbody">thanks min for the answer, I did not know that:)
<br/>
<br/>
(and about streaming, i got it working. I was so stupid that i didn't understood it:) now i have seeking pause etc. working)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
