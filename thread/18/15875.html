<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Problem with patching a project with fcsr.dldi - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Problem with patching a project with fcsr.dldi</h2>
<div id="posts">
<div class="post">
    <h4>#161064 - Lachsen - Sun Jul 27, 2008 3:24 pm</h4>
    <div class="postbody"><span class="postbody">Hi there,
<br/>
<br/>
I'm pretty new to DS Homebrew, I started just some days ago. Currently I try to create a project with libfat, but I have been stuck with that for quite some time, now.
<br/>
<br/>
I followed the steps from <a class="postlink" href="http://thoughtsfrommylife.com/article-755-File_Reading_On_the_DS_In_An_Emulator_and_on_the_DS" target="_blank">this site</a> to create a Project with libfat that should run on NO$GBA.
<br/>
<br/>
Now I have the problem, that I cannot patch the rom containing the filesystem.
<br/>
<br/>
Here is the Batch-File I use for building the project:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
@echo off
<br/>
set OLDDIR=%CD%
<br/>
<br/>
echo build Project
<br/>
<br/>
make
<br/>
<br/>
echo create Filesystem
<br/>
<br/>
cd ..\fs_builder\
<br/>
<br/>
CALL build %OLDDIR%\MyProject.img %OLDDIR%\files
<br/>
<br/>
chdir /d %OLDDIR%
<br/>
<br/>
echo connect Game with Filesystem
<br/>
<br/>
padbin 512 MyProject.ds.gba
<br/>
<br/>
cat MyProject.ds.gba MyProject.img &gt; MyProject_fs.ds.gba
<br/>
<br/>
dlditool fcsr.dldi MyProject_fs.ds.gba
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
When MyProject_fs.da.gba is patched with dlditool i get the following notice:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Dynamically Linked Disk Interface patch tool v1.24 by Michael Chisholm (Chishm)
<br/>
<br/>
Trying "fcsr.dldi"
<br/>
MyProject_fs.ds.gba does not have a DLDI section</td> </tr></table><span class="postbody">
<br/>
<br/>
<span style="font-weight: bold">One thing to note is, that the patching works, if I use the Rom without the filesystem (i.e. dlditool fcsr.dldi MyProject.ds.gba )</span>
<br/>
<br/>
I included the libfat library and called fatInitDefault() in the main function, so I think there should be a DLDI section...
<br/>
<br/>
I searched quite a while in this forum but didn't find any solution for this problem (on the other hand I really tend to miss many things), so that's why I'm asking.
<br/>
<br/>
Can anyone help me with this?
<br/>
<br/>
Thanks
<br/>
<br/>
Lachsen</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#161065 - Dark Knight ez - Sun Jul 27, 2008 3:36 pm</h4>
    <div class="postbody"><span class="postbody">Just patch before even padding the .ds.gba?<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><a class="postlink" href="http://amplituds.drunkencoders.com" target="_blank">AmplituDS website</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#161066 - Lachsen - Sun Jul 27, 2008 3:45 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dark Knight ez wrote:</b></span></td> </tr> <tr> <td class="quote">Just patch before even padding the .ds.gba?</td> </tr></table><span class="postbody">
<br/>
When I do this, the patching works, but when I start the resulting rom with no$gba I get the Message
<br/>
"The rom-image has crashed".
<br/>
So it's not running...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#161067 - Dwedit - Sun Jul 27, 2008 6:47 pm</h4>
    <div class="postbody"><span class="postbody">The FCSR patcher adds a useless 512 byte "loader" for flash cartridges.  I think it's completely useless since ndstool's generated NDS files already have a loader.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#161069 - silent_code - Sun Jul 27, 2008 8:32 pm</h4>
    <div class="postbody"><span class="postbody">@ Dwedit: But it should work.
<br/>
<br/>
@ Lachsen: With which OS do you work? I assume (bause you use cat) it's Linux, right?<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#161078 - tepples - Sun Jul 27, 2008 11:11 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>silent_code wrote:</b></span></td> </tr> <tr> <td class="quote">@ Dwedit: But it should work.
<br/>
<br/>
@ Lachsen: With which OS do you work? I assume (bause you use cat) it's Linux, right?</td> </tr></table><span class="postbody">
<br/>
'CALL' means it's probably a batch file for Windows Command Prompt. The 'cat' works because devkitPro Updater puts MSYS into %Path%, and MSYS provides a lot of "POSIX Shell and Utilities" programs such as 'cat'.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#161081 - silent_code - Sun Jul 27, 2008 11:27 pm</h4>
    <div class="postbody"><span class="postbody">@ tepples: Ok, you're right.
<br/>
<br/>
<br/>
Well, for me "copy /b" works all the time (I haven't even tried cat!) and I didn't have any issues with FCSR, yet. Only building the image caused broblems due to a localization issue in the batch file (I am on a german WinXP.)
<br/>
<br/>
Maybe you could try EFS 2.0 or NitroFS instead? They both run on hardware and in emulators with an appended file system (so, it's only one file - although that's a pro and a con - during development you don't want to write too much to your flash card every time you want to test on hardware... that brings us to the next point:), but you can still use libfat in parallel for accessing "regular" files.<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#161105 - Lachsen - Mon Jul 28, 2008 10:38 am</h4>
    <div class="postbody"><span class="postbody">Hi again!
<br/>
<br/>
Thanks for all the answers.
<br/>
<br/>
My OS is Windows XP (also german).
<br/>
<br/>
The reason I want to use libfat is to store additional data (like sounds and graphics) for a game separately, such that it's not loaded to Main Memory (which is limited by 4 MB afaik). So if there are other ways to do this, I'd try them as well.
<br/>
<br/>
So maybe I will have a look at this EFS/NitroFS ...
<br/>
But then I have no idea how you actually access the data without libfat. (Overall I'm still confused about accessing any data outside the program)
<br/>
<br/>
Is there any kind of example project with an file system (that is not loaded completely to Main Memory) out there, where I can see how accessing the files work? The only example project I found was one that uses gbfs... And as soon as I put too large files inside this filesystem I got an error, that some kind of memory limit was reached (I don't remember exactly what kind of memory, though) ...
<br/>
<br/>
@silent_code I had the same localization issues with the batch file. You mean that the string "File(s)" was searched, right?
<br/>
<br/>
Again, thanks for the answers
<br/>
<br/>
C ya
<br/>
<br/>
Lachsen</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#161106 - silent_code - Mon Jul 28, 2008 11:31 am</h4>
    <div class="postbody"><span class="postbody">EFS comes with an example project. Also, there is a simple example on libfat's official site.
<br/>
<br/>
You access data from a filesystem via the library's implementation of read and write (as well as others, like open, close, seek etc.) routines.
<br/>
I think all of the recent libraries have implemented standard C and C++ file access, so it works just as on the PC. The only difference is, that you have to initialize the libraries before accessing any files.
<br/>
<br/>
The appended filesystems don't get loaded into main memory, despite the fact that they are in one file with the executable(s).
<br/>
<br/>
The actual memory limit is below 4MB (like 3.7 or so) and minus the size of the executables and their data (static and dynamic, as well as the stack).
<br/>
<br/>
Regarding the batch issue: Yes, that's what I meant. :^)
<br/>
<br/>
Greetings.
<br/>
<br/>
PS: You should set your location to Germany, as this may solve some language issues (so that people don't assume you are a native speaker and go easy on you. :^) )<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
