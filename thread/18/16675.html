<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Help with saving/writing files - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > Help with saving/writing files</h2>
<div id="posts">
<div class="post">
    <h4>#168787 - Emmanuel - Sun May 24, 2009 8:45 am</h4>
    <div class="postbody"><span class="postbody">So, I want to save a simple .txt file, but:
<br/>
<br/>
1. I try to use EFS, so I have a .txt file with one row per variable with "00000" to have enough space when writing. It reads properly, but it doesn't write. Not on no$gba, not on my R4 in real DS.
<br/>
<br/>
2. I try to chdir to FAT, but it says chdir is not defined and I already tried including all sorts of headers, searched some code, and I still can't get it to be included.
<br/>
<br/>
Any help/ideas/suggestions? This is my code
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
bool SaveFile::readFile(char * path){
<br/>
   bool wasSuccessful = false;
<br/>
   
<br/>
   if(save != NULL){
<br/>
      fclose(save);
<br/>
      save = NULL;
<br/>
   }
<br/>
   save = fopen(path, "r");
<br/>
   if(save != NULL) {
<br/>
      int line = 0;
<br/>
      int value = 0;
<br/>
      while(fscanf(save, "%d", &amp;value) != EOF){
<br/>
         switch(line){
<br/>
            case MAXXSCROLL_LINE:
<br/>
               this-&gt;maxXScroll = value;
<br/>
               break;
<br/>
            case MAXYSCROLL_LINE:
<br/>
               this-&gt;maxYScroll = value;
<br/>
               break;
<br/>
            case XBORDER_LINE:
<br/>
               this-&gt;xBorder = value;
<br/>
               break;
<br/>
            case YBORDER_LINE:
<br/>
               this-&gt;yBorder = value;
<br/>
               break;
<br/>
            case MAXZOOM_LINE:
<br/>
               this-&gt;maxZoom = value;
<br/>
               break;
<br/>
            case MINZOOM_LINE:
<br/>
               this-&gt;minZoom = value;
<br/>
               break;
<br/>
            case MAXZOOMCHANGE_LINE:
<br/>
               this-&gt;maxZoomChange = value;
<br/>
               break;
<br/>
            case MINZOOMCHANGE_LINE:
<br/>
               this-&gt;minZoomChange = value;
<br/>
               break;
<br/>
            case GOOMBA_ON_LINE:
<br/>
               this-&gt;goomba = value;
<br/>
               break;
<br/>
         }
<br/>
         line++;
<br/>
      }
<br/>
<br/>
      fclose(save);
<br/>
      save = NULL;
<br/>
   }else{
<br/>
      iprintf("File NULL");
<br/>
   }
<br/>
<br/>
   return wasSuccessful;
<br/>
}
<br/>
<br/>
bool SaveFile::saveFile(){
<br/>
   bool wasSuccessful = false;
<br/>
<br/>
   if(save != NULL){
<br/>
      fclose(save);
<br/>
      save = NULL;
<br/>
   }
<br/>
   chdir("FAT:/");
<br/>
   string path = *efs_path + EFS_SAVE_PATH;
<br/>
   save = fopen(path.c_str(), "r");
<br/>
   if(save != NULL){
<br/>
      stringstream saveStream(stringstream::in | stringstream::out);
<br/>
      
<br/>
      saveStream &lt;&lt; 
<br/>
         maxXScroll &lt;&lt; endl &lt;&lt;
<br/>
         maxYScroll &lt;&lt; endl &lt;&lt;
<br/>
         xBorder &lt;&lt; endl &lt;&lt;
<br/>
         yBorder &lt;&lt; endl &lt;&lt;
<br/>
         maxZoom &lt;&lt; endl &lt;&lt;
<br/>
         minZoom &lt;&lt; endl &lt;&lt;
<br/>
         maxZoomChange &lt;&lt; endl &lt;&lt;
<br/>
         minZoomChange &lt;&lt; endl &lt;&lt;
<br/>
         goomba &lt;&lt; endl;
<br/>
      
<br/>
      int size = sizeof(saveStream.str().c_str());
<br/>
      fwrite(saveStream.str().c_str(), 1, size, save);
<br/>
      fclose(save);
<br/>
      save = NULL;
<br/>
   }
<br/>
<br/>
   return wasSuccessful;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
All the variables to save are ints except goomba which is a bool. saveFile() is called when you press A, Start or B to exit the options menu.
<br/>
<br/>
Here is the file in case it may be my cart or something:
<br/>
<a href="http://www.mediafire.com/file/2mz1d3rnz1m/clash.nds" target="_blank">http://www.mediafire.com/file/2mz1d3rnz1m/clash.nds</a>
<br/>
*Uploaded in mediafire, possible advertising.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168788 - headspin - Sun May 24, 2009 12:21 pm</h4>
    <div class="postbody"><span class="postbody">You opening the file for reading not writing. It should be
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">save = fopen(path.c_str(), "w+");</td> </tr></table><span class="postbody">
<br/>
<br/>
Also writing files does not work in No$ so you will need to test it on your R4.<br/>_________________<br/><a class="postlink" href="http://headsoft.com.au/index.php?category=warhawk" target="_blank">Warhawk DS</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=mmll" target="_blank">Manic Miner: The Lost Levels</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=tdg" target="_blank">The Detective Game</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168790 - Emmanuel - Sun May 24, 2009 2:38 pm</h4>
    <div class="postbody"><span class="postbody">-facepalm- And, I had spent hours trying to find what was wrong.
<br/>
<br/>
Also, I'd like to add that that sizeof didn't work. Just for the first value, probably because it returned the size of the pointer, not the data.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">fprintf(save, saveStream.str().c_str());</td> </tr></table><span class="postbody">
<br/>
This was used to fix it.
<br/>
Thanks
<br/>
<br/>
Still, I'd like to add an export option, so people can then import the save file when I release new compilations. So, how do I get that chdir working? Or how do I switch between FAT and EFS?</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
