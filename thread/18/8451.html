<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>How to manage vrams right - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > How to manage vrams right</h2>
<div id="posts">
<div class="post">
    <h4>#70476 - Payk - Mon Feb 06, 2006 8:12 pm</h4>
    <div class="postbody"><span class="postbody">ok i tried to have 16bit sprites and bg. it should map randompixels to bg and have some sprites (12 if it matter later more but not much more then 20 at size of 64_64)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   //turn everything on
<br/>
    powerON(POWER_ALL_2D);
<br/>
<br/>
    //irqs are nice
<br/>
   irqInit();
<br/>
   irqSet(IRQ_VBLANK, 0);
<br/>
    irqEnable(IRQ_VBLANK); 
<br/>
<br/>
    //enable vram and map it to the right places
<br/>
    vramSetMainBanks(   VRAM_A_MAIN_SPRITE,        //A and B maped consecutivly as sprite memory
<br/>
                        VRAM_B_MAIN_SPRITE,        //this gives us 256KB which is the max
<br/>
                        VRAM_C_MAIN_BG_0x6000000,  //map C to background memory
<br/>
                        VRAM_D_LCD                 //not using D
<br/>
                        ); 
<br/>
   
<br/>
   //set the video mode
<br/>
    videoSetMode(  MODE_0_2D | 
<br/>
                   DISPLAY_SPR_ACTIVE |    //turn on sprites
<br/>
                   DISPLAY_SPR_2D |        //this is used when in tile mode
<br/>
                   DISPLAY_SPR_1D_BMP |    //and this in bitmap mode
<br/>
                   DISPLAY_BG3_ACTIVE); 
<br/>
    
<br/>
   //turn down all sprites (0-127)
<br/>
   for(int i = 0; i &lt; 128; i++)
<br/>
   {
<br/>
      sprites[i].attribute[0] = 0; 
<br/>
      sprites[i].attribute[1] = 0;
<br/>
      sprites[i].attribute[2] = 0;
<br/>
    }
<br/>
   
<br/>
      BG3_CR = BG_BMP16_256x256;
<br/>
   
<br/>
   //these are rotation backgrounds so you must set the rotation attributes:
<br/>
    //these are fixed point numbers with the low 8 bits the fractional part
<br/>
    //this basicaly gives it a 1:1 translation in x and y so you get a nice flat bitmap
<br/>
        BG3_XDX = 1 &lt;&lt; 8;
<br/>
        BG3_XDY = 0;
<br/>
        BG3_YDX = 0;
<br/>
        BG3_YDY = 1 &lt;&lt; 8;
<br/>
    //our bitmap looks a bit better if we center it so scroll down (256 - 192) / 2 
<br/>
        BG3_CX = 0;
<br/>
        BG3_CY = 0;
<br/>
   u16* frontBuffer = (u16*)(0x06000000);
<br/>
   
<br/>
        for(int iy = 0; iy &lt; 196 ; iy++)
<br/>
            for(int ix = 0; ix &lt; 256 ; ix++)
<br/>
               frontBuffer[iy * 256 + ix] = rand() | BIT(15);
<br/>
                
<br/>
    //WaitForVblank
<br/>
      while(DISP_Y!=192);
<br/>
   while(DISP_Y==192);</td> </tr></table><span class="postbody">
<br/>
<br/>
untill here is no use of sprites but will be used later and they run perfect.
<br/>
but all i get on bg is black. ok i didnt forget the alphabit and all code is mixed up from to examples (Double_buffer and Sprite_bitmap i think)
<br/>
what did i wrong? thanx</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#70477 - Payk - Mon Feb 06, 2006 8:14 pm</h4>
    <div class="postbody"><span class="postbody">i also tried with dmacopy and also not to use that array which is linked to 0x60000000. i used bg_gfx[] also like in other examples.hmmh....</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#70481 - DekuTree64 - Mon Feb 06, 2006 8:56 pm</h4>
    <div class="postbody"><span class="postbody">BG3 is a text layer in mode 0, and only extended affine layers can do bitmap mode. Try mode 3, 4, or 5, BG3 is extended affine in those modes.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#70484 - Payk - Mon Feb 06, 2006 9:22 pm</h4>
    <div class="postbody"><span class="postbody">hey thanx dekotree64 !! i tried mode 3 and it runs perfectly!!!!!!!
<br/>
THANX THANX THANX
<br/>
ohh damn i tried all but not that. so here again THANX</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
