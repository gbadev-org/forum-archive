<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Invcos any ideas? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Invcos any ideas?</h2>
<div id="posts">
<div class="post">
    <h4>#43318 - iainprice - Sat May 21, 2005 10:37 pm</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
I could really do with a decent inv cos...searching through a table is my only idea at the moment. Anyone got any better ones?
<br/>
<br/>
Cheers.
<br/>
<br/>
Iain.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#43319 - strager - Sat May 21, 2005 10:53 pm</h4>
    <div class="postbody"><span class="postbody">All I know is that:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">RAD asin(u32 val)
<br/>
{
<br/>
    RAD ret;
<br/>
<br/>
    if(abs(value) != 1)
<br/>
        ret = atan(value / sqrt(1 - (value * value)));
<br/>
    else
<br/>
       ret = HALF_PI * sign(value);
<br/>
<br/>
    return(ret);
<br/>
};
<br/>
<br/>
RAD asin(u32 val)
<br/>
{
<br/>
    RAD ret;
<br/>
<br/>
    if(abs(val) != 1)
<br/>
        ret = HALF_PI - atan(val / sqrt(1 - (val * val)));
<br/>
    else
<br/>
       ret = PI * sign(val);
<br/>
<br/>
    return(ret);
<br/>
};
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
You may do a LUT for atan and sqrt, but maybe not.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#43321 - iainprice - Sat May 21, 2005 11:02 pm</h4>
    <div class="postbody"><span class="postbody">I presume one was acos and one was asin... but i still need atan for those two....</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#43325 - tepples - Sun May 22, 2005 3:18 am</h4>
    <div class="postbody"><span class="postbody">A lookup table followed by linear interpolation should be fast enough.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#43338 - strager - Sun May 22, 2005 11:47 am</h4>
    <div class="postbody"><span class="postbody">Yup.
<br/>
<br/>
You might want to populate a list of atan's, and luckily there's a bios function for that (and squareroot, too).  What I would do is make a little program for the GBA to call these functions, making a list in memory as you go.  Then extract that block of memory using the VBA memory editor (click save, then type in the number of bytes you want, IN HEX!!!).
<br/>
<br/>
That's what I would do.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#43378 - mike260 - Sun May 22, 2005 9:42 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>iainprice wrote:</b></span></td> </tr> <tr> <td class="quote">I could really do with a decent inv cos...searching through a table is my only idea at the moment. Anyone got any better ones?</td> </tr></table><span class="postbody">
<br/>
<br/>
Here's what I normally use:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">static const float ACOS_C0            =  HALF_PI;
<br/>
static const float ACOS_C1            = -0.213300989f;
<br/>
static const float ACOS_C2            =  0.077980478f;
<br/>
static const float ACOS_C3            = -0.02164095f;
<br/>
<br/>
float rr_poly_acos( float x )
<br/>
{
<br/>
   //Worst-case error ~= 0.002 degrees
<br/>
   //Function is exact at -1, 0 and 1
<br/>
<br/>
   if( x &gt;= 0.0f )
<br/>
   {
<br/>
      const float sx = SQRT( 1.0f - x );
<br/>
      const float px = ACOS_C0 + x*(ACOS_C1 + x*(ACOS_C2 + x*ACOS_C3));
<br/>
      ASSERT( SANE(sx) );
<br/>
      return( sx * px );
<br/>
   }
<br/>
   else
<br/>
   {
<br/>
      const float sx = SQRT( 1.0f + x );
<br/>
      const float px = ACOS_C0 - x*(ACOS_C1 - x*(ACOS_C2 - x*ACOS_C3));
<br/>
      ASSERT( SANE(sx) );
<br/>
      return( PI - (sx * px) );
<br/>
   }
<br/>
}
<br/>
<br/>
#define ACOS(x) rr_poly_acos(x)
<br/>
#define ASIN(x) (HALF_PI - ACOS(x))</td> </tr></table><span class="postbody">
<br/>
<br/>
It's floating-point, but it should convert over to fixed-point easily enough. Note that you can do the sqrt in parallel with calculating px, if you use the hardware sqrt.
<br/>
<br/>
BTW, there's a fairly easy way to create good approximations to functions using ms excel, I can post details if you're interested.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#133234 - a128 - Wed Jul 04, 2007 2:12 pm</h4>
    <div class="postbody"><span class="postbody">acos from WildMagic
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">static int32 FastInvCos (int32 fValue)
<br/>
{
<br/>
    int32 fRoot = sqrtf32(floattof32(1)-fValue);
<br/>
    int32 fResult = floattof32(-0.0187293f);
<br/>
    fResult = mulf32(fResult,fValue);
<br/>
    fResult += floattof32(0.0742610f);
<br/>
    fResult = mulf32(fResult,fValue);
<br/>
    fResult -= floattof32(0.2121144f);
<br/>
    fResult = mulf32(fResult,fValue);
<br/>
    fResult += floattof32(1.5707288f);
<br/>
    fResult = mulf32(fResult,fRoot);
<br/>
    return fResult;
<br/>
  }
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#133239 - kusma - Wed Jul 04, 2007 3:27 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>iainprice wrote:</b></span></td> </tr> <tr> <td class="quote">I could really do with a decent inv cos...searching through a table is my only idea at the moment. Anyone got any better ones?</td> </tr></table><span class="postbody">
<br/>
Use the crt one? Are you really doing so many acos-calls that the performance would be a problem?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#133261 - tepples - Wed Jul 04, 2007 9:01 pm</h4>
    <div class="postbody"><span class="postbody">Can you deal with using 1 KiB of RAM for a lookup table?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
