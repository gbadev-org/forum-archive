<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>DS to DS communication - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > DS to DS communication</h2>
<div id="posts">
<div class="post">
    <h4>#175895 - sverx - Fri Feb 25, 2011 12:10 pm</h4>
    <div class="postbody"><span class="postbody">I just didn't want to reply to <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=16394" target="_blank">this 2009 topic</a>, so I'm starting a new one...
<br/>
What's going on about DS to DS communication?
<br/>
So far I've read that liblobby isn't working, and that maybe there's a way to build up sort of a channel using raw wi-fi packets.
<br/>
Has anyone gone ahead? Any POC or sources that I can see?
<br/>
Thanks :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175897 - wintermute - Fri Feb 25, 2011 12:47 pm</h4>
    <div class="postbody"><span class="postbody">Nothing public exists yet.
<br/>
<br/>
There are unfortunately rather a lot of issues to deal with in attempting to provide this kind of functionality. All of the code people keep pointing to is broken in various "interesting" ways which vary from being completely unreliable to having the potential to render your whole wifi network completely unusable (quite possibly your neighbours too)
<br/>
<br/>
I have some code in test which provides some of the basics but I'm reluctant to share thanks to people jumping on hacky code and providing "tutorials" on how to use it to make the tools not work as expected. DSwifi is already creaking a bit with some hacks we put in to work around problems that were related to not fully understanding the hardware at the time the library was created. We're also now faced with supporting yet another wifi chipset in the DSi and that needs some thought to redesign the default arm7 code so it allows for the use of DSi features without losing the ability to run on a DS. devkitARM release 33 is also under test and should be available at some point in the not very distant future. 
<br/>
<br/>
Obviously the ideal situation is for sgstair to finish off some current projects needed to properly RE the wifi hardware and put together the new dswifi that's been promised for so long.
<br/>
<br/>
I do understand that lots of people want this but getting it right is an enormous challenge and provoking ill informed discussion tends to slow things down. We don't need or want several implementations coming from people who can't or won't make sure that their code can be integrated into the libraries provided by devkitPro. When that happens everybody loses.
<br/>
<br/>
What would probably help most is finding some people with a complete understanding of 802.11 standards and low level knowledge of wifi chipsets in general. Bear in mind that linux drivers still don't provide all the functionality of some chipsets due to the difficulty in obtaining the knowledge required to write the drivers.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175899 - TwentySeven - Fri Feb 25, 2011 1:02 pm</h4>
    <div class="postbody"><span class="postbody">Excellent post Wintermute, thankyou for the heads up.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175900 - sverx - Fri Feb 25, 2011 2:01 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">[...] to having the potential to render your whole wifi network completely unusable (quite possibly your neighbours too)</td> </tr></table><span class="postbody">
<br/>
<br/>
We could write jamming tools :D ;)
<br/>
<br/>
Thanks for the post, I hope we will have something to test soon.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175946 - sverx - Mon Mar 07, 2011 2:17 pm</h4>
    <div class="postbody"><span class="postbody">I was reading an article about Nintendo 3DS and I read it has an Atheros chip in it, for wi-fi. Is it possible that there's a similar chip in the DS and/or DSi too?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175949 - yellowstar - Mon Mar 07, 2011 8:40 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sverx wrote:</b></span></td> </tr> <tr> <td class="quote">I was reading an article about Nintendo 3DS and I read it has an Atheros chip in it, for wi-fi. Is it possible that there's a similar chip in the DS and/or DSi too?</td> </tr></table><span class="postbody">
<br/>
3DS uses a similar(if not identical) AR6001X wifi chipset to DSi.(don't remember the exact model for DSi wifi chipset) DS uses some unrelated proprietary chipset iirc.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175953 - wintermute - Tue Mar 08, 2011 4:22 pm</h4>
    <div class="postbody"><span class="postbody">DS has a Mitsumi MM3155, DS Lite has Mitsumi MM3128.
<br/>
<br/>
The DSi has both Mitsumi MM3128 and an Atheros AR6002.
<br/>
<br/>
Much work needs to be done before the Atheros chip can be supported, notably deciding on how best to arrange the arm7 code. I think we've probably gone as far as we can with DSi support in the current default arm7 binary and it's unlikely that camera and new wifi support can be squeezed in there without a serious detrimental effect on the utility of the code.
<br/>
<br/>
Right now I'm not entirely sure how Nintendo handle hybrid arm7 code - it looks like both binaries are loaded at startup but it's not clear whether the DSi arm7 is a simple extension of the DS arm7 code or if it's effectively a replacement. I suspect the best approach may be to build the default core with two segments with DSi specific code separated into a segment which ndstool extracts from the elf into the arm7i section of the nds container format.
<br/>
<br/>
Another big, big issue is that official DSi code contains traces of a commercial wpa supplicant, obviously used for WPA authentication and probably modified with protocols for Nintendo Zones.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175955 - sverx - Wed Mar 09, 2011 10:43 am</h4>
    <div class="postbody"><span class="postbody">Googling around I've seen there are no datasheets for those Mitsumi, I believe now I understand why there are still problems with it. (BTW I wonder if Mitsumi has ever made a similar chip with public datasheets, might be worth checking...).
<br/>
<br/>
Hopefully anyway Atheros specs are easier to find... again I've read around there are open implementations of drivers so it could be a good place to start...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I suspect the best approach may be to build the default core with two segments with DSi specific code separated into a segment which ndstool extracts from the elf into the arm7i section of the nds container format.</td> </tr></table><span class="postbody">
<br/>
<br/>
You mean we would probably have ndstool packing 2 distinct arm7 parts together with arm9 part?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175956 - elhobbs - Wed Mar 09, 2011 3:21 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sverx wrote:</b></span></td> </tr> <tr> <td class="quote">Googling around I've seen there are no datasheets for those Mitsumi, I believe now I understand why there are still problems with it. (BTW I wonder if Mitsumi has ever made a similar chip with public datasheets, might be worth checking...).
<br/>
</td> </tr></table><span class="postbody">I think the problems are also from the fact that dswifi was a work in progress - with lots of things being figured out while it was being written. sgstair has always said that it was a little bit of a mess that he intended to rewrite completely.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175957 - wintermute - Wed Mar 09, 2011 11:20 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sverx wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Hopefully anyway Atheros specs are easier to find... again I've read around there are open implementations of drivers so it could be a good place to start...
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Only Atheros docs I can find have big "DO NOT COPY" written across them :/
<br/>
<br/>
Also open implementations tend to be linux which tend to require all kinds of crap that isn't found on a bare metal system.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I suspect the best approach may be to build the default core with two segments with DSi specific code separated into a segment which ndstool extracts from the elf into the arm7i section of the nds container format.</td> </tr></table><span class="postbody">
<br/>
<br/>
You mean we would probably have ndstool packing 2 distinct arm7 parts together with arm9 part?</span></td> </tr></table><span class="postbody">
<br/>
<br/>
No, I mean a single arm7 binary which has a second part held in a different memory region that only gets loaded in DSi mode.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175958 - sverx - Thu Mar 10, 2011 4:45 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">I mean a single arm7 binary which has a second part held in a different memory region that only gets loaded in DSi mode.</td> </tr></table><span class="postbody">
<br/>
Wow! Seems a very good solution :) And this second part will contain Atheros chip specific code and other code that isn't needed on a (phat/lite) DS if I understand correctly. Unfortunately this doesn't help dswifi...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175966 - yellowstar - Fri Mar 11, 2011 7:07 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Right now I'm not entirely sure how Nintendo handle hybrid arm7 code - it looks like both binaries are loaded at startup but it's not clear whether the DSi arm7 is a simple extension of the DS arm7 code or if it's effectively a replacement.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Launcher/sysmenu loads the arm7/arm9 bins when it launches titles, and loads the arm9i/arm7i bins into memory when they exist. The arm7/arm9 crt0 then relocates the twl bins to the final VMA sections when the twl bins exist and when running in DSi-mode. The arm7i is not an replacement, it's an extension: code is executed in both the arm7 and arm7i.
<br/>
The SD card loader Sudokuhax uses loads the arm7i/arm9i binaries from boot.nds when those exist.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
I suspect the best approach may be to build the default core with two segments with DSi specific code separated into a segment which ndstool extracts from the elf into the arm7i section of the nds container format.
<br/>
</td> </tr></table><span class="postbody">
<br/>
Sounds good. :)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Another big, big issue is that official DSi code contains traces of a commercial wpa supplicant, obviously used for WPA authentication and probably modified with protocols for Nintendo Zones.
<br/>
</td> </tr></table><span class="postbody">
<br/>
NZone is just standard 802.11b wifi they only use cleartext/WEP with those, they send an encrypted <a class="postlink" href="http://dsibrew.org/wiki/Nintendo_Zone#Beacon_payload_format" target="_blank">beacon</a> which the client uses to determine which SSID+key to connect to.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
