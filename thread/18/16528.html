<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Memory Profilers - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Memory Profilers</h2>
<div id="posts">
<div class="post">
    <h4>#167337 - albinofrenchy - Mon Mar 09, 2009 11:38 am</h4>
    <div class="postbody"><span class="postbody">Are there any <a class="postlink" href="http://en.wikipedia.org/wiki/Memory_debugger" target="_blank">memory debugger</a> tools ported to the DS for leak detection? 
<br/>
<br/>
If not, anyone know a lightweight one? All I've used is valgrind and there is no way that will port.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167339 - samel - Mon Mar 09, 2009 1:23 pm</h4>
    <div class="postbody"><span class="postbody">I've one ... i'll send it by mail</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167413 - paladine - Wed Mar 11, 2009 4:51 am</h4>
    <div class="postbody"><span class="postbody">I wrote my own by implementing new and delete.  If you're interested, I could provide it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167748 - hacker013 - Wed Mar 25, 2009 4:28 pm</h4>
    <div class="postbody"><span class="postbody">Could you post it here?<br/>_________________<br/><a class="postlink" href="http://imetal.nl/" target="_blank">Website / Blog</a>
<br/>
<br/>
Let the nds be with you.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167768 - a128 - Thu Mar 26, 2009 5:35 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>hacker013 wrote:</b></span></td> </tr> <tr> <td class="quote">Could you post it here?</td> </tr></table><span class="postbody">
<br/>
<br/>
Yes, please post it here</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167852 - paladine - Tue Mar 31, 2009 5:43 pm</h4>
    <div class="postbody"><span class="postbody">Quick and dirty implemention.  Tracks total number of objects and entire allocated memory size.  Inserts a guard value at the end of the memory and checks against it when the memory is finally freed.  The only thing you'd have to implement to use this code is PrintStatusMessage(const char *fmt,...);
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#ifdef _DEBUG
<br/>
#define GUARD_VALUE 0xDEEDBEEF
<br/>
#define NEXT4ALIGN(x) ( (x + 3) &amp; ~0x3)
<br/>
static u32 total = 0;
<br/>
static u32 objects = 0;
<br/>
static u32 oid = 0;
<br/>
<br/>
void *operator new(size_t sz)
<br/>
{
<br/>
    u8 *mem = reinterpret_cast&lt;u8*&gt;(malloc(sz+12+3));
<br/>
    if (mem)
<br/>
    {
<br/>
        reinterpret_cast&lt;u32*&gt;(mem)[0] = sz; // insert size before data area
<br/>
        reinterpret_cast&lt;u32*&gt;(mem)[1] = ++oid; // insert allocation id before data area
<br/>
        mem += 8;
<br/>
        *reinterpret_cast&lt;u32*&gt;(mem+NEXT4ALIGN(sz)) = GUARD_VALUE; // insert guard value at end of memory
<br/>
        total += sz; // increment total size of allocations
<br/>
        ++objects;
<br/>
        PrintStatusMessage("Alloc: %p,%u,%u,%u,%u,%p\n",mem,oid,sz,objects,total,__builtin_return_address(0));
<br/>
    }
<br/>
    else
<br/>
    {
<br/>
        PrintStatusMessage("Failed allocate %u\n",sz);
<br/>
    }
<br/>
    return mem;
<br/>
<br/>
}
<br/>
<br/>
void operator delete(void *p) {
<br/>
    u32 sz = reinterpret_cast&lt;u32*&gt;(p)[-2]; // retrieve size from memory
<br/>
    u32 id = reinterpret_cast&lt;u32*&gt;(p)[-1]; // retrieve id
<br/>
    if (*reinterpret_cast&lt;u32*&gt;(reinterpret_cast&lt;u8*&gt;(p)+NEXT4ALIGN(sz)) != GUARD_VALUE) // check against guard value
<br/>
    {
<br/>
        PrintStatusMessage("MALLOC OVERFLOW!\n");
<br/>
    }
<br/>
    total -= sz; // update counter
<br/>
    --objects;
<br/>
    PrintStatusMessage("Free:  %p,%u,%u,%u,%u\n",p,id,sz,objects,total);
<br/>
    free(reinterpret_cast&lt;u8*&gt;(p)-8);
<br/>
}
<br/>
<br/>
void PrintMemoryStatistics()
<br/>
{
<br/>
    PrintStatusMessage("Objects: %u, sz: %u\n",objects,total);
<br/>
}
<br/>
#endif
<br/>
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167869 - hacker013 - Wed Apr 01, 2009 3:23 pm</h4>
    <div class="postbody"><span class="postbody">can you also release a c version ?<br/>_________________<br/><a class="postlink" href="http://imetal.nl/" target="_blank">Website / Blog</a>
<br/>
<br/>
Let the nds be with you.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167871 - paladine - Wed Apr 01, 2009 3:45 pm</h4>
    <div class="postbody"><span class="postbody">If you can't convert that from C++ to C, then you've got some problems.
<br/>
<br/>
I'll leave that exercise up to the reader.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
