<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Can't get code to run from GBA cart - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Can't get code to run from GBA cart</h2>
<div id="posts">
<div class="post">
    <h4>#81471 - HyperHacker - Sat Apr 29, 2006 10:45 am</h4>
    <div class="postbody"><span class="postbody">After about 4 hours of doing exactly the same thing that hbfirmware (which works) does to run DS code from the GBA slot, I've managed to get two white screens. I've tried everything I can think of about 6 times. Argh.
<br/>
<br/>
ARM9:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void Reboot()
<br/>
{
<br/>
   int i;
<br/>
   sysSetBusOwners(false, false, false); //All to ARM7
<br/>
   IPC-&gt;arm9desc = 0;
<br/>
   IPC-&gt;arm7data = PL_BLINKFAST;
<br/>
   IPC-&gt;arm7desc = A7_POWERLED;
<br/>
   while(IPC-&gt;arm9desc != A9_ACK) swiDelay(1);
<br/>
   IPC-&gt;arm9desc = 0;
<br/>
<br/>
   REG_IME=0;
<br/>
   REG_IE=0;
<br/>
   DISP_SR=0;
<br/>
   DISPLAY_CR=0;
<br/>
   SUB_DISPLAY_CR=0;
<br/>
   i=0;
<br/>
   swiFastCopy(&amp;i, (u32*)0x40000B0, 0x01000000 | (0x30&gt;&gt;2));
<br/>
<br/>
   //clear VRAM
<br/>
   POWER_CR=1;
<br/>
   VRAM_CR=0x80808080;
<br/>
   VRAM_E_CR=0x80;
<br/>
   VRAM_F_CR=0x80;
<br/>
   VRAM_G_CR=0x80;
<br/>
   VRAM_H_CR=0x80;
<br/>
   VRAM_I_CR=0x80;
<br/>
   i=0;
<br/>
   swiFastCopy(&amp;i, (u32*)0x6800000, 0x01000000 | (0xA4000&gt;&gt;2));
<br/>
   VRAM_CR=0;
<br/>
   VRAM_E_CR=0;
<br/>
   VRAM_F_CR=0;
<br/>
   VRAM_G_CR=0;
<br/>
   VRAM_H_CR=0;
<br/>
   VRAM_I_CR=0;
<br/>
<br/>
   POWER_CR=POWER_SWAP_LCDS | POWER_ALL_2D;
<br/>
   i=0;
<br/>
   swiFastCopy(&amp;i, (u32*)0x5000000, 0x01000000 | (0x800&gt;&gt;2));
<br/>
   i=0;
<br/>
   swiFastCopy(&amp;i, (u32*)0x7000000, 0x01000000 | (0x800&gt;&gt;2));
<br/>
<br/>
   IPC-&gt;arm9desc = 0;
<br/>
   IPC-&gt;arm7desc = A7_REBOOT;
<br/>
   *(u32*)0x27ffe24=0x027ffe28;
<br/>
   *(u32*)0x27ffe28=0xe51ff00c;
<br/>
   ((call0)0x27FFE28)();
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
ARM7
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">switch(T.arm7desc) //T is a copy of IPC
<br/>
{
<br/>
   case 0:
<br/>
   break;
<br/>
<br/>
<br/>
   case A7_REBOOT: //Reboot to GBA cart
<br/>
   REG_IME=REG_IE=0;
<br/>
<br/>
   SerialWaitBusy();
<br/>
   REG_SPICNT = SPI_ENABLE | SPI_DEVICE_POWER | SPI_BAUD_1MHz | SPI_CONTINUOUS;
<br/>
   REG_SPIDATA = 0;
<br/>
   SerialWaitBusy();
<br/>
   REG_SPICNT = SPI_ENABLE | SPI_DEVICE_POWER | SPI_BAUD_1MHz;
<br/>
   REG_SPIDATA = PM_BACKLIGHT_TOP | PM_BACKLIGHT_BOTTOM | PM_SOUND_PWR;
<br/>
<br/>
   POWER_CR=POWER_SOUND;
<br/>
   //swiChangeSoundBias(1,0x400); //Non-existant function &gt;_&gt;
<br/>
<br/>
   //reset DMA
<br/>
   i=0;
<br/>
   swiFastCopy(&amp;i, (u32*)0x40000B0, 0x01000000 | (0x30&gt;&gt;2));
<br/>
   swiDelay(100000);
<br/>
   ((call0)0x080000c0)();
<br/>
   break;</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
