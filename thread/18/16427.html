<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Multiple screen layers: help plz [solved] - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Multiple screen layers: help plz [solved]</h2>
<div id="posts">
<div class="post">
    <h4>#166494 - Pete_Lockwood - Sun Feb 08, 2009 10:00 pm</h4>
    <div class="postbody"><span class="postbody">So I've got some code working which is using tiles to put stuff to a single layer and I want to extend it to use 2 layers.  The code (below) is hacked from the advMultipleLayers libNds example.  It *does* work for *one* layer, i.e. poking values into map[] will get the DS to draw my tiles correctly.
<br/>
<br/>
When I remove the comments to attempt to use a second layer, however, I'm only able to get something to draw if I poke the exact same value into map[] and map2[] at the exact same offset.  I suspect this means I'm stupid and missing the plot somewhere.  Can someone point me in the right direction?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void InitScreen(void)
<br/>
{
<br/>
   videoSetMode(MODE_5_2D);
<br/>
   vramSetBankA(VRAM_A_MAIN_BG);
<br/>
   
<br/>
   int bg0 = bgInit(0, BgType_Text4bpp, BgSize_ER_256x256, 0,1);
<br/>
//   int bg1 = bgInit(1, BgType_Text4bpp, BgSize_ER_256x256, 1,1);
<br/>
   
<br/>
   bgSetPriority(bg0, 0);
<br/>
//   bgSetPriority(bg1, 1);
<br/>
   
<br/>
   // according to the sample code they magically share tiles and a palette
<br/>
   dmaCopy(tilesTiles, bgGetGfxPtr(bg0), sizeof(tilesTiles));
<br/>
   dmaCopy(tilesPal, BG_PALETTE, sizeof(tilesPal));
<br/>
<br/>
   map = (u16*)bgGetMapPtr(bg0);
<br/>
//   map2 = (u16*)bgGetMapPtr(bg1);
<br/>
}
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/>It's not an illusion, it just looks like one.</span><span class="gensmall"><br/><br/>Last edited by Pete_Lockwood on Thu Feb 12, 2009 1:03 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#166588 - dovoto - Tue Feb 10, 2009 6:51 pm</h4>
    <div class="postbody"><span class="postbody">That code looks good here.  
<br/>
<br/>
In responce to magically sharing things comment in your code:
<br/>
<br/>
-Backgrounds share palettes.  Each tile can access one of 16 palettes and these palettes can be either 16 color or 256 color depending on how you have things set up (Text4bpp use 16 16-color palettes).  
<br/>
<br/>
-They only share tiles because you are using the same tile graphics offset in bgInit().
<br/>
<br/>
Cant really tell from that code what your issue might be.<br/>_________________<br/><a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#166589 - Pete_Lockwood - Tue Feb 10, 2009 7:30 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for replying :)
<br/>
<br/>
Some more info, not sure if it'll help you work out where I'm going wrong..  I set up an extra palette entry to 'highlight' certain tiles at certain points in my game:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
    u16 highlight = RGB15(31,31,8);
<br/>
    *(BG_PALETTE + 16 + 15) = highlight;
<br/>
    *(BG_PALETTE_SUB + 16 + 15) = highlight;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
When I want to highlight the tile I add 1 &lt;&lt; 12 to the tile index to switch palette.  Again, this works fine if I'm just using a single layer.
<br/>
<br/>
When I move to the second layer and only write tiles to map[], the only time I see anything on the screen is when I'm applying my highlight.  When the tile is highlighted the tile's background takes on the highlight color but the foreground is see-through.
<br/>
<br/>
As I said, not sure if this helps at all.<br/>_________________<br/>It's not an illusion, it just looks like one.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#166590 - elhobbs - Tue Feb 10, 2009 7:50 pm</h4>
    <div class="postbody"><span class="postbody">you may want to try running in an emulator like desmume and looking at the layers, palettes, tiles, and maps in the respective object viewers and make sure they are being loaded in manner you are expecting.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#166594 - Pete_Lockwood - Wed Feb 11, 2009 3:20 am</h4>
    <div class="postbody"><span class="postbody">Sussed it out.  It was trauma with transparency.
<br/>
<br/>
Thanks for the help.<br/>_________________<br/>It's not an illusion, it just looks like one.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
