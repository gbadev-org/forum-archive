<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>ScummVM Touchscreen registers the wrong spot - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > ScummVM Touchscreen registers the wrong spot</h2>
<div id="posts">
<div class="post">
    <h4>#66086 - wonderworld - Sun Jan 08, 2006 3:46 am</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
I have got big trouble with ScummVM. When tapping the touchscreen, SCUMM registers the tap in the wrong place. 
<br/>
<br/>
___________
<br/>
<br/>
some button
<br/>
___________
<br/>
<br/>
<br/>
&gt;&gt; I have to click here to activate the button &lt;&lt;
<br/>
<br/>
<br/>
Because of this problem the games are unplayable for me.
<br/>
I can't reach every place in the inventory and i have to guess the
<br/>
right spot to click all the time. Starnage thing is i haven't read anything
<br/>
about that issue on any forum i have been visiting, so my last chance is,
<br/>
you guys can help me.
<br/>
<br/>
My Hardware:
<br/>
<br/>
Early DS silver
<br/>
M3 CF
<br/>
Console Software 14
<br/>
Scumm v.5
<br/>
<br/>
Thanks
<br/>
wonder</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#66092 - Critical_Impact - Sun Jan 08, 2006 5:00 am</h4>
    <div class="postbody"><span class="postbody">Have u tried calibrating your ds in the options screen?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#66097 - Puppet - Sun Jan 08, 2006 5:29 am</h4>
    <div class="postbody"><span class="postbody">I have a similar problem with my DS. YopYop sent me a touch screen app, and the touch screen worked perfectly with that. Hopefully the code in that app will be applied to ScummVM.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#66100 - wonderworld - Sun Jan 08, 2006 6:05 am</h4>
    <div class="postbody"><span class="postbody">Hey..
<br/>
In case you ment the DS-Firmware-Calibration, yes i did that.
<br/>
<br/>
In case you ment a calibration option inside SCUMM, no because i can't tap the "Options" button :)
<br/>
<br/>
Greets
<br/>
wonder</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#66123 - MatLeOuf - Sun Jan 08, 2006 11:16 am</h4>
    <div class="postbody"><span class="postbody">Hi!
<br/>
Have you looked at my last thread (<a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=7980" target="_blank">http://forum.gbadev.org/viewtopic.php?t=7980</a>)? I've got exactly the same problem as you, and duencil posted a hack that makes the screen much more precise. Unfortunately, you need to recompile the software, but I don't despair to see this hack included in the next release of libnds, if you can't compile things, I can send you the modified app (along with the unmodified one) for you to test and see if your problem gets solved.
<br/>
<br/>
YopYop also sent me his TouchTest program but, unfortunately, it didn't solve anything for me...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#66144 - wonderworld - Sun Jan 08, 2006 2:36 pm</h4>
    <div class="postbody"><span class="postbody">yes, that would be cool.
<br/>
I don't have the tools to compile by myself.
<br/>
<br/>
Just upload it to <a href="http://www.rapidshare.de" target="_blank">http://www.rapidshare.de</a> or some other free file hoster.
<br/>
Thanks a lot.
<br/>
<br/>
wonder</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#66153 - MatLeOuf - Sun Jan 08, 2006 3:38 pm</h4>
    <div class="postbody"><span class="postbody">No problem. Here is the modified software, along with the source code : <a class="postlink" href="http://rapidshare.de/files/10649024/TouchTest4.rar.html" target="_blank">http://rapidshare.de/files/10649024/TouchTest4.rar.html</a>
<br/>
And don't hesitate to give feedback ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#66191 - wonderworld - Sun Jan 08, 2006 10:50 pm</h4>
    <div class="postbody"><span class="postbody">hey yes, this touchscreen test seems to work fine for me.
<br/>
the ball i was moving was a little too big to tell that it's really 100% accurate, but it's definately much better then the tochscreen in SCUMM.
<br/>
<br/>
How does it happen that some DS units just work fine and others like mine have got big problems?
<br/>
<br/>
Is there a way to compile a new SCUMM with that updated library?
<br/>
<br/>
Greets
<br/>
wonder</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#66201 - duencil - Mon Jan 09, 2006 12:06 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wonderworld wrote:</b></span></td> </tr> <tr> <td class="quote">Is there a way to compile a new SCUMM with that updated library?</td> </tr></table><span class="postbody">
<br/>
<br/>
Just 2 lines in the measurement code need to be added and the source recompiled. I left instructions in the thread MatLeOuf linked to above. I tried recompiling ScummVM for DS for you, but it seems to depend on an older version of libnds than the one I use.  But I'm sure agentq will make the change if you ask on the ScummVM thread (<a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=7232" target="_blank">http://forum.gbadev.org/viewtopic.php?t=7232</a>) or PM him.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#66206 - agentq - Mon Jan 09, 2006 12:41 am</h4>
    <div class="postbody"><span class="postbody">ScummVM uses some very old code to read the touchscreen from before libnds had touchscreen reading code.  This was tweaked to give the correct values on my DS.  This may be what is causing problems for some people.  Other people have reported the touch screen being perfectly accurate in ScummVM.
<br/>
<br/>
I switched over to the libnds touchscreen code this morning, and it is noticably less accurate on my DS.  When I made the hack posted on this board to read the registers twice, it doesn't improve the touch screen accuracy at all.  Running the touchtest program on my DS also doesn't produce very good results.  Especially with the single shot mode, the ball's position frequently has no relation to where I touched.
<br/>
<br/>
So perhaps this isn't the solution.  Or perhaps it only improves it on some hardware revision, other then mine (I have an original silver DS bought on release day).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#66259 - NoMis - Mon Jan 09, 2006 10:09 am</h4>
    <div class="postbody"><span class="postbody">Version 0.4 worked very fine and accurate and it mostly took the clicks right. But since I updated to 0.5 it seems very inaccurate on my DS. 
<br/>
It's very noticeable in the menus where I often need like 5 clicks until I can select a savegame :(
<br/>
<br/>
Other than that the new version is just great. Sound is now very nice and the other improvements are also very good. Keep up the good work.
<br/>
<br/>
NoMis</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#66272 - Critical_Impact - Mon Jan 09, 2006 12:04 pm</h4>
    <div class="postbody"><span class="postbody">Mine works most of the time but sometimes it clicks on the other side of the screen.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#66429 - Puppet - Tue Jan 10, 2006 7:04 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>agentq wrote:</b></span></td> </tr> <tr> <td class="quote">ScummVM uses some very old code to read the touchscreen from before libnds had touchscreen reading code.  This was tweaked to give the correct values on my DS.  This may be what is causing problems for some people.  Other people have reported the touch screen being perfectly accurate in ScummVM.
<br/>
<br/>
I switched over to the libnds touchscreen code this morning, and it is noticably less accurate on my DS.  When I made the hack posted on this board to read the registers twice, it doesn't improve the touch screen accuracy at all.  Running the touchtest program on my DS also doesn't produce very good results.  Especially with the single shot mode, the ball's position frequently has no relation to where I touched.
<br/>
<br/>
So perhaps this isn't the solution.  Or perhaps it only improves it on some hardware revision, other then mine (I have an original silver DS bought on release day).</td> </tr></table><span class="postbody">
<br/>
<br/>
Would it be possible to switch between the two touchscreen codes? Maybe you could hold down a button when it's starting up or something to switch over to the alternative code.... would something like this be possible?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#66436 - duencil - Tue Jan 10, 2006 8:41 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>agentq wrote:</b></span></td> </tr> <tr> <td class="quote">I switched over to the libnds touchscreen code this morning, and it is noticably less accurate on my DS.  When I made the hack posted on this board to read the registers twice, it doesn't improve the touch screen accuracy at all.  Running the touchtest program on my DS also doesn't produce very good results.  Especially with the single shot mode, the ball's position frequently has no relation to where I touched.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I see from looking at your arm7 code that what you've you've tweaked is the conversion from touchscreen coordinates to pixel coordinates, presumable with values that obtain better results on your machine.  You should be able to preserve that behaviour with your custom code - my suggestion was just referring to modifying the previous raw reading of touchscreen coodinates. I found that adding a touchRead(TSC_MEASURE_X|1) before </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">x = touchRead(TSC_MEASURE_X);</td> </tr></table><span class="postbody"> and a touchRead(TSC_MEASURE_Y|1) before </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">y = touchRead(TSC_MEASURE_Y);</td> </tr></table><span class="postbody"> reduces interference in the measurements.   You may not notice any improvement - many units seem immune to the interference anyway, but if adding these lines doesn't affect you adversely, it will probably help others.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#66538 - wonderworld - Wed Jan 11, 2006 7:14 pm</h4>
    <div class="postbody"><span class="postbody">any chance that someone who is able to, could patch that
<br/>
code into the current version of SCUMM and offer it for download here?
<br/>
<br/>
I would do it by myself, but i really have got no idea how to do it...
<br/>
I would report of course if it fixed my problems....
<br/>
<br/>
I really want to meet the ALIEN MINDBENDERS again.
<br/>
<br/>
<br/>
Cheers
<br/>
wonder</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#66550 - wonderworld - Wed Jan 11, 2006 10:17 pm</h4>
    <div class="postbody"><span class="postbody">ok, i tried to compile it bymyself.
<br/>
had to adjust a lot of paths and stuff but now i am stuck....
<br/>
<br/>
<br/>
e:/desktop/scummvmds0-5src/scummvm/backends/ds/arm9/source/dsmain.h:17: error: 'vector' does not name a type</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#66556 - tepples - Wed Jan 11, 2006 10:52 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>agentq wrote:</b></span></td> </tr> <tr> <td class="quote">I switched over to the libnds touchscreen code this morning, and it is noticably less accurate on my DS.</td> </tr></table><span class="postbody">
<br/>
What happens when you wait before each read?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#66571 - duencil - Thu Jan 12, 2006 12:44 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wonderworld wrote:</b></span></td> </tr> <tr> <td class="quote">ok, i tried to compile it bymyself.
<br/>
had to adjust a lot of paths and stuff but now i am stuck....
<br/>
<br/>
<br/>
e:/desktop/scummvmds0-5src/scummvm/backends/ds/arm9/source/dsmain.h:17: error: 'vector' does not name a type</td> </tr></table><span class="postbody">
<br/>
vector was replaced by GLvector in later revisions of libnds
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>agentq wrote:</b></span></td> </tr> <tr> <td class="quote">I switched over to the libnds touchscreen code this morning, and it is noticably less accurate on my DS.</td> </tr></table><span class="postbody">
<br/>
What happens when you wait before each read?</span></td> </tr></table><span class="postbody">
<br/>
The touchRead() function does perform several waits itself. Also I did experiment with </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">touchRead(TSC_MEASURE_X);
<br/>
x = touchRead(TSC_MEASURE_X);</td> </tr></table><span class="postbody">
<br/>
instead of </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">touchRead(TSC_MEASURE_X|1);
<br/>
x=touchRead(TSC_MEASURE_X);</td> </tr></table><span class="postbody"> but that didn't help at all, which would suggest that its not just a timing issue or a simple case of reading the registers twice.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#67132 - wonderworld - Sun Jan 15, 2006 8:06 pm</h4>
    <div class="postbody"><span class="postbody">Ok, wasn't able to compile the patched version because i have got no idea about DS programming. Is there anything else i could try to make it work?
<br/>
I am really desperately waiting for a working SCUMM since October.
<br/>
<br/>
Tnx
<br/>
wonder</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#69471 - wonderworld - Tue Jan 31, 2006 12:00 am</h4>
    <div class="postbody"><span class="postbody">Ok,
<br/>
tried out something new today (WIN2DS).
<br/>
Exactly the same problem. Touchscreen is not aligned to the screen right.
<br/>
<br/>
So the error must be in some lib both programs are using!?
<br/>
<br/>
Greets wonder</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#69475 - wonderworld - Tue Jan 31, 2006 12:32 am</h4>
    <div class="postbody"><span class="postbody">Here, I made a pic of myself tapping key "1"...
<br/>
<br/>
<a href="http://img210.imageshack.us/my.php?image=img03141om.jpg" target="_blank">http://img210.imageshack.us/my.php?image=img03141om.jpg</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#72861 - VanillaIcee - Wed Feb 22, 2006 5:10 am</h4>
    <div class="postbody"><span class="postbody">Hey agentq, have you officially switched over to the libnds code? Is it possible to get a copy of this new code. Although since you are probably rewriting dsmain for the next version I can wait.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
