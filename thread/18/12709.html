<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Tips and warnings for using 3D Engine - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Tips and warnings for using 3D Engine</h2>
<div id="posts">
<div class="post">
    <h4>#121747 - Lick - Wed Mar 14, 2007 2:28 pm</h4>
    <div class="postbody"><span class="postbody">A topic to collect general knowledge for people using 3D Engine.
<br/>
<br/>
My tips:
<br/>
<br/>
- If you want to use a texture with alphabits, make sure that you <span style="font-size: 7px; line-height: normal">disabled anti-aliasing</span>(incorrect) and have rendered a polygon behind it. If there's no polygon behind it, all pixels with alpha will be entirely invisible.<span style="font-size: 9px; line-height: normal"> [related to silent_code's tip about glClearColor]</span>
<br/>
<br/>
- If you want to modulate texture color with vertex color, use glMaterialf(GL_EMISSION, RGB15(31,0,0));. Here, the texture will be modulated with red. Default should be 0x7FFF (white). 
<br/>
I use this for my font rendering. ;D
<br/>
<br/>
[edit]spelling..<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"><br/><br/>Last edited by Lick on Thu Mar 15, 2007 11:41 pm; edited 3 times in total</span></div>    
</div>
<div class="post">
    <h4>#121749 - simonjhall - Wed Mar 14, 2007 2:37 pm</h4>
    <div class="postbody"><span class="postbody">Good idea! A tips thread would be teh bonze.
<br/>
<br/>
Here's me:
<br/>
When you draw a transparent poly, the poly you draw behind it needs a different poly id (I'm sure)... Never had a problem with AA and transparency though!
<br/>
<br/>
Polygons with different ids give a cool edge-detected/wireframe look. For example, if I render a scene like normal but change the polygon id for ever poly, the scene gets rendered (like normal) but a wireframe gets overlaid onto the image on poly boundaries. Looks cool :-)
<br/>
<br/>
I've found that if you exceed the polygon limit then there's a good chance you'll get seriously weird graphical corruption (not just invisible polys). So avoid.<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121850 - silent_code - Thu Mar 15, 2007 8:19 am</h4>
    <div class="postbody"><span class="postbody">@Lick: this is a great idea!
<br/>
<br/>
- if you get wierd looking textures, try swapping the uvs.
<br/>
<br/>
- to set the propper clear color, don't use the function glClearColor(...) provided by libnds (true for realease 20 and preceeding), but set it in GFX_CLEAR_COLOR along with it's alpha value (e.g. GFX_CLEAR_COLOR = RGB15(0, 31, 0)  | (31 &lt;&lt; 16) | etc.). it needs to be opaque in order to make aa work. glClearColor(...) seems to only be changing bg palette entry 0 to the specified color, but again, that isn't the "clear plane" (as opposed to the "clear image", which is an alternative [i think it is enabled by setting bit 14 in gfx control or something and will replace the color buffer and depth buffer with images - both eat up each a whole vram bank - though useful for resident evil style games]).
<br/>
<br/>
- if you want full control over glEnable/Disable/Reset (e.g. being able to diable outlining etc.): copy and rename them, then redefine them, e.g.:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
static const uint16 constant_bits = 0; or GL_TEXTURE_2D | ((1&lt;&lt;12) | (1&lt;&lt;13);
<br/>
<br/>
static uint16 enable_bitsFIX = constant_bits;
<br/>
<br/>
void glEnableFIX(int bits)
<br/>
{
<br/>
   enable_bitsFIX |= bits | constant_bits;
<br/>
   GFX_CONTROL = enable_bitsFIX;
<br/>
}
<br/>
<br/>
etc.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
- polygons and vertices can share colors, so don't call glColor/Material for every vertex if not neccessary. transparency (set in poly format) is only on a per poly base, so don't try to set it for each vertex.
<br/>
<br/>
- use triangles (or triangle strips) instead of quads, when you get strange lighting. (sorry again, gabebear, my fault!)
<br/>
<br/>
- always leave a bit of space in poly and vertex ram to compensate for clipping. the geometry engine creates new vertices and polys when clipping, which are first saved into v/p ram and then rendered by the 3d engine.
<br/>
<br/>
more to be edited into this post.</span><span class="gensmall"><br/><br/>Last edited by silent_code on Mon Aug 20, 2007 12:47 pm; edited 2 times in total</span></div>    
</div>
<div class="post">
    <h4>#121960 - Dark Knight ez - Thu Mar 15, 2007 11:39 pm</h4>
    <div class="postbody"><span class="postbody">Important one:
<br/>
If you decide to use glNormal calls... make sure they come <span style="font-weight: bold">BEFORE</span> glColor calls. If you do it the other way around, the glColor might not work as you expect it to.<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><a class="postlink" href="http://amplituds.drunkencoders.com" target="_blank">AmplituDS website</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122507 - Dark Knight ez - Mon Mar 19, 2007 10:04 pm</h4>
    <div class="postbody"><span class="postbody">And another important one:
<br/>
libnds automaticly uses VRAM_E bank for texture palettes. So if you use 3D, stay away from using VRAM_E bank yourself. (I tried to use it for sprites on the main screen; had me stumped for two/three days).<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><a class="postlink" href="http://amplituds.drunkencoders.com" target="_blank">AmplituDS website</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122511 - simonjhall - Mon Mar 19, 2007 10:32 pm</h4>
    <div class="postbody"><span class="postbody">And a similar tip,
<br/>
if start your writing you app with consoleDemoInit and forget to change that at a later date, you'll only be able to get a hold of 384k of VRAM for textures!
<br/>
<br/>
So change to consoleInitDefault and use some smart params to relocate the console to a block that's less useful.
<br/>
<br/>
For instance, I've got my console set up like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   videoSetModeSub(MODE_0_2D | DISPLAY_BG0_ACTIVE);
<br/>
   vramSetBankH(VRAM_H_SUB_BG);
<br/>
   SUB_BG0_CR = BG_MAP_BASE(15) | BG_256_COLOR;
<br/>
      
<br/>
   BG_PALETTE_SUB[255] = RGB15(31,31,31);
<br/>
   
<br/>
   consoleInitDefault((u16*)SCREEN_BASE_BLOCK_SUB(15), (u16*)CHAR_BASE_BLOCK_SUB(0), 8);</td> </tr></table><span class="postbody">...so I've got my console in VRAM H which is 32k in size and can't be used for textures.
<br/>
<br/>
Thanks goes to elhobbs for the code. I've now got 512k for textures!<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122893 - qw3rty - Fri Mar 23, 2007 9:11 am</h4>
    <div class="postbody"><span class="postbody">Damn - I should've known earlier !
<br/>
I tried almost every upper VRAM-Bank, and could only get BankE working for the main-screen - which is a bank, that's also used by DS-GL (for texture-palettes)..I had to copy the opengl-texture routines and adapt them to use VRAM-F exclusively for palettes.
<br/>
<br/>
Edit : I just noticed, you use the SUB screen for the console...maybe vramE was indeed the only I could use for my needs</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122920 - Payk - Fri Mar 23, 2007 2:32 pm</h4>
    <div class="postbody"><span class="postbody">Here my tipp does come:
<br/>
If you want to use a wireframe model, enable AA and set alphablend to 0 (polyfmt). You can also let models slowly turn into a wireframe. The alphablend (0...31) value controls just the blending of the polygone it self, not the blending of the outlineborder (AA uses the outlineborder)
<br/>
<br/>
The wireframe lines should depend on texture if AA is enabled (that just works with r20 and cvs updated libnds afaik)
<br/>
<br/>
BTW: Even if your entiry model just has one polyID:
<br/>
When blending &lt;31 and AA is enabled you get a real wireframe thingy!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122970 - Touchstone - Sat Mar 24, 2007 1:11 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lick wrote:</b></span></td> </tr> <tr> <td class="quote">- If you want to use a texture with alphabits, make sure that you <span style="font-size: 7px; line-height: normal">disabled anti-aliasing</span>(incorrect) and have rendered a polygon behind it. If there's no polygon behind it, all pixels with alpha will be entirely invisible.</td> </tr></table><span class="postbody">
<br/>
If you set up blending between planes properly you can blend your 3D layer with any 2D layer behind it and does not need a polygon behind you AA polygons.<br/>_________________<br/>You can't beat our meat</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123130 - qw3rty - Sun Mar 25, 2007 11:22 am</h4>
    <div class="postbody"><span class="postbody">glBegin() and glEnd() seem to consume lots of CPU-time !
<br/>
<br/>
Use them as little as possible !
<br/>
<br/>
Or maybe the NDS-hardware can only render a limited amount of glBegin/End packets in one frame - I don't know exactly...</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
