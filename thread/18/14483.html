<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>determine libnds version - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > determine libnds version</h2>
<div id="posts">
<div class="post">
    <h4>#144903 - kusma - Fri Nov 09, 2007 12:57 am</h4>
    <div class="postbody"><span class="postbody">I'd really like to be able to (preferably compile-time) determine the version of the installed libnds in order to support both devkitARM r20 and r21 in the same source distribution. DSWifi has a header-file called dswifi_version.h, but there doesn't seem to be any set of macros to identify different versions of libnds (specifically, it's stuff like glViewPort -&gt; glViewport in videoGL.h I'd like to handle). Any clues?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144920 - wintermute - Fri Nov 09, 2007 7:09 am</h4>
    <div class="postbody"><span class="postbody">Why would you want to "support" an obsolete toolchain and library? That just runs the risk of ending up with the maintainance nightmare DSO and PAlib seem to have turned into.
<br/>
<br/>
I currently have release 22 fairly well under way, there are some more newlib tweaks for libfat and a couple of functions which don't quite work the way they're supposed to - nothing fatal, just unexpected return values. Do you plan on supporting 3 toolchain versions and 4 or more libnds versions in the same source distribution? What advantage would that give you?<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144928 - kusma - Fri Nov 09, 2007 9:43 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">Why would you want to "support" an obsolete toolchain and library?</td> </tr></table><span class="postbody">
<br/>
Because that allows one developer to work on getting the code compiling for a new toolchain-release while other coders on the project continues development normally. Yes, I could branch out the code to upgrade, and that's most likely what I'll end up doing.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144930 - wintermute - Fri Nov 09, 2007 10:29 am</h4>
    <div class="postbody"><span class="postbody">That's probably a fair point really. r20 to r21 isn't quite the same leap that r18 to r19 was though - most of the toolchain work this time round has been related to Vista compatibility and sorting out a couple of issues with the newlib patches relating to file IO.
<br/>
<br/>
As far as libnds goes the major changes that have a potential to effect code were the glViewport case fix and using stdint.h for the short typedefs ( u32, u16 et al )
<br/>
<br/>
For the former a simple #ifndef should suffice
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#ifndef glViewport
<br/>
#define glViewport glViewPort
<br/>
#endif
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
For some reason the newlib stdint.h appears to define uint32_t as unsigned long rather than unsigned int. Obviously they're equivalent on ARM but gcc likes to moan and this one seems to have caused a few issues for people who write inconsistent code where unsigned int and u32 are used interchangeably.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144932 - kusma - Fri Nov 09, 2007 10:44 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
For the former a simple #ifndef should suffice
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#ifndef glViewport
<br/>
#define glViewport glViewPort
<br/>
#endif
<br/>
</td> </tr></table><span class="postbody">
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
...But glViewport isn't a preprocessor-symbol, it's a static inline function and thus not visible to the preprocessor.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144933 - wintermute - Fri Nov 09, 2007 12:25 pm</h4>
    <div class="postbody"><span class="postbody">Heh, I'm an idiot.
<br/>
<br/>
Weirdly I've seen code that looks like it uses function prototypes in macros for cross platform code but never thought to question it.
<br/>
<br/>
I guess the gcc version would suffice for your needs atm. r20 was 4.1.1, r21 is 4.1.2. See <a href="http://gcc.gnu.org/onlinedocs/cpp/Common-Predefined-Macros.html" target="_blank">http://gcc.gnu.org/onlinedocs/cpp/Common-Predefined-Macros.html</a><br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144934 - kusma - Fri Nov 09, 2007 12:29 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">I guess the gcc version would suffice for your needs atm. r20 was 4.1.1, r21 is 4.1.2. See <a href="http://gcc.gnu.org/onlinedocs/cpp/Common-Predefined-Macros.html" target="_blank">http://gcc.gnu.org/onlinedocs/cpp/Common-Predefined-Macros.html</a></td> </tr></table><span class="postbody">
<br/>
Ah, yes, this will solve my problem! Thanks a lot!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144965 - tepples - Fri Nov 09, 2007 9:55 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">That's probably a fair point really. r20 to r21 isn't quite the same leap that r18 to r19 was though</td> </tr></table><span class="postbody">
<br/>
Verifying that this is the case...
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">[####################...................]
<br/>
0        25        50        75       100
<br/>
error in mb.gba support: will isolate and then report on sf.net/projects/devkitpro
<br/>
error in sf.net: waiting for password reset for account 'yerricde'</td> </tr></table><span class="postbody">
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">As far as libnds goes the major changes that have a potential to effect code were the glViewport case fix and using stdint.h for the short typedefs ( u32, u16 et al )</td> </tr></table><span class="postbody">
<br/>
Are there big changes that would affect custom ARM7 code? Should I rewrite my ARM7 code by copying my PSG code into a new copy of examples\nds\templates\combined\arm7\source\template.c ?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144979 - wintermute - Sat Nov 10, 2007 12:08 am</h4>
    <div class="postbody"><span class="postbody">I'm not entirely clear on what you're reporting here, have you encountered some problem with custom ARM7 code?
<br/>
<br/>
Checking the updates in the combined template would generally be a good idea. This last update has some extra code to put the DS in a known state &amp; starts the irq which tracks the RTC for the time functions.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144983 - tepples - Sat Nov 10, 2007 12:34 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">I'm not entirely clear on what you're reporting here, have you encountered some problem with custom ARM7 code?</td> </tr></table><span class="postbody">
<br/>
Nope. DS is pretty much fine so far, but there's a problem with GBA, and I'm waiting until I get a response from SourceForge.net password reset before I put it in DKP tracker. Or I could report it directly to you through PM or e-mail.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Checking the updates in the combined template would generally be a good idea. This last update has some extra code to put the DS in a known state &amp; starts the irq which tracks the RTC for the time functions.</td> </tr></table><span class="postbody">
<br/>
Done, and I fixed a problem with the new sound init code and the latest version of NO$GBA I could get my hands on. I had to &amp; ~BIT(6) in the write to power management control so that the emulated DS doesn't power itself off in the init code.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
