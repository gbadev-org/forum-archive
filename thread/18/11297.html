<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Software and Hardware - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Software and Hardware</h2>
<div id="posts">
<div class="post">
    <h4>#104317 - TheWopr - Thu Sep 28, 2006 12:57 am</h4>
    <div class="postbody"><span class="postbody">I'm sure this is one of the most complicated topics of the DS.  Taking your program that works fine on your computer and watching it fail on your DS.  I've run across this same problem, due to the lack of tutorials that talk about this, i was wondering if anyone could look over my code.  I commented just about everything to make it easy to understand. 
<br/>
<br/>
I'll go over what does work for now.  It does draw to the background in order to create the background color, blue.  It just receive input, restarting the game using select works and starting with start works too.  It doesn't draw the players though, maybe something with transparency? One more thing is that I'm testing this on an M3 SD phat.  And before people take the obvious answer, i did start of my program with 	powerON(POWER_ALL)
<br/>
<br/>
Heres a link to my code, feel free to look through it or even reuse if you want....<a class="postlink" href="http://rapidshare.de/files/34694164/WoprDS.zip.html" target="_blank">woprDS</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104321 - josath - Thu Sep 28, 2006 1:57 am</h4>
    <div class="postbody"><span class="postbody">When you draw to a 16bit background in mode 5, you need to set bit 15 if you want it to not be transparent. for example, replace this code:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">        for(int i = 0; i &lt; LENGTH; i++){
<br/>
                BG_GFX[(int)(player[i].getX() + ((int)player[i].getY()  )*256)    ] = player[i].getColor(); //Topleft pixel
<br/>
                BG_GFX[(int)(player[i].getX() + ((int)player[i].getY()  )*256) + 1] = player[i].getColor(); //Topright pixel
<br/>
                BG_GFX[(int)(player[i].getX() + ((int)player[i].getY()+1)*256)    ] = player[i].getColor(); //Botleft pixel
<br/>
                BG_GFX[(int)(player[i].getX() + ((int)player[i].getY()+1)*256) + 1] = player[i].getColor(); //Botright pixel
<br/>
        }
<br/>
</td> </tr></table><span class="postbody">
<br/>
with:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">        for(int i = 0; i &lt; LENGTH; i++){
<br/>
<br/>
                // it's probably faster to do this once instead of 4 times
<br/>
                int pixel = (int)player[i].getX() + 
<br/>
                                (int)player[i].getY()*256;
<br/>
<br/>
                // again, put it all in one statement to make it faster i guess
<br/>
                BG_GFX[pixel] = BG_GFX[pixel+1] 
<br/>
                  = BG_GFX[pixel+256] = BG_GFX[pixel+257] 
<br/>
                  = player[i].getColor() | BIT(15); // add in bit 15 to make it visible
<br/>
        }
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104325 - TheWopr - Thu Sep 28, 2006 2:30 am</h4>
    <div class="postbody"><span class="postbody">Wow &gt;.&lt; thats how i feel right now.  I even set the BIT(15) on earlier draw functions.  Thanks for finding that though, it always helps to get a second look.  That code should make things run faster though, thanks josath :D</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104330 - TheWopr - Thu Sep 28, 2006 2:47 am</h4>
    <div class="postbody"><span class="postbody">Ok your code made sense, but unfortunately it still does not draw the players   when i'm running it on hardware &gt;.&lt; any other ideas?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104336 - josath - Thu Sep 28, 2006 3:03 am</h4>
    <div class="postbody"><span class="postbody">try adding this code for the main bitmap background:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">        BG3_XDX = 1 &lt;&lt; 8;
<br/>
        BG3_XDY = 0;
<br/>
        BG3_YDX = 0;
<br/>
        BG3_YDY = 1 &lt;&lt; 8;
<br/>
    //our bitmap looks a bit better if we center it so scroll down (256 - 192) / 2
<br/>
        BG3_CX = 0;
<br/>
        BG3_CY = 0;
<br/>
</td> </tr></table><span class="postbody">
<br/>
these set up the scaling &amp; scrolling registers to default settings (offset:0,0, scaling: 100%x100%), perhaps the hardware has different defaults</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104400 - TheWopr - Thu Sep 28, 2006 6:35 pm</h4>
    <div class="postbody"><span class="postbody">Alright what you said makes sense, so i added it bu unfortunately it still doesn't work &gt;.&lt;, I don't really have any ideas, this is my first program for the DS after all, any more help would be great.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104401 - josath - Thu Sep 28, 2006 6:43 pm</h4>
    <div class="postbody"><span class="postbody">I can't see anything else obviously missing. my only suggestions are:
<br/>
1. make sure other homebrew works
<br/>
2. if you still can't figure it out, take one of the libnds or someone's example, make sure it works, then slowly add in your code into the example, making sure it works as you add each new piece.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104406 - TheWopr - Thu Sep 28, 2006 7:05 pm</h4>
    <div class="postbody"><span class="postbody">Ok i've been looking at other tutuorials and i've seen that some of them use VRAM_A[i] for their drawing function and some use BG_GFX[i], could this have anything to do with it?  And if so, whats the difference between them anyway.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104479 - TheWopr - Fri Sep 29, 2006 4:52 pm</h4>
    <div class="postbody"><span class="postbody">Anyone got any ideas? I can't really move forward with my project until I get it working on an actual DS</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104520 - josath - Sat Sep 30, 2006 1:35 am</h4>
    <div class="postbody"><span class="postbody">If you're really stuck, and there's nothing else you can do, I'd suggest you try my #2 as above.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104525 - knight0fdragon - Sat Sep 30, 2006 3:00 am</h4>
    <div class="postbody"><span class="postbody">I just tested your code, josath is correct, you need to set the affine matrix to its identity<br/>_________________<br/><a href="http://www.myspace.com/knight0fdragonds" target="_blank">http://www.myspace.com/knight0fdragonds</a>
<br/>
<br/>
MK DS FC: Dragon 330772 075464 
<br/>
AC WW FC: Anthony SamsClub 1933-3433-9458 
<br/>
MPFH: Dragon 0215 4231 1206</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
