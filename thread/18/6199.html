<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Seriously >.<;; Why isn't the DS DMA0, HDMA working li - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Seriously >.<;; Why isn't the DS DMA0, HDMA working li</h2>
<div id="posts">
<div class="post">
    <h4>#46932 - LOst? - Sat Jul 02, 2005 6:07 am</h4>
    <div class="postbody"><span class="postbody">I have worked for days now trying to find a way to port my 2D game to DS. The main problem is my scroll table. It is needed to update the scroll values at "this frame". The only thing that can do so is DMA channel 0. Also, the HDMA needs to use DMA0 with the flag DMA_START_HBL. But in DS ARM9, DMA channel 0 is just not updating immediately, and DMA_START_HBL doesn't give any output at all.
<br/>
<br/>
If you believe you can help me, I will give out the source in here. I only need a way to visually see if DMA channel 0 updated "this frame" and not "previous frame".
<br/>
<br/>
If no DMA_START_HBL or DMA channel 0 exist on the DS: Is there any other way to do 2D raster effects?
<br/>
<br/>
Thank you for replies!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46994 - LOst? - Sun Jul 03, 2005 4:52 am</h4>
    <div class="postbody"><span class="postbody">Seems like no one can answer.
<br/>
<br/>
I guess even if I get HDMA to work, to do it on both screens, you must have a SUB_DMA0. And there is no.
<br/>
<br/>
So the DS was not that well designed for 2D games I guess.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46999 - DekuTree64 - Sun Jul 03, 2005 5:50 am</h4>
    <div class="postbody"><span class="postbody">DMA0 should work fine, unless maybe if ndslib uses it for sending commands to the geometry FIFO, and you're doing 3D stuff? Be it that or something else, there must be some DMA task interrupting DMA1/2/3 if you use them, so you need to find out what that is and tell it to use a lower priority DMA.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#47000 - LOst? - Sun Jul 03, 2005 6:12 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>DekuTree64 wrote:</b></span></td> </tr> <tr> <td class="quote">DMA0 should work fine, unless maybe if ndslib uses it for sending commands to the geometry FIFO, and you're doing 3D stuff? Be it that or something else, there must be some DMA task interrupting DMA1/2/3 if you use them, so you need to find out what that is and tell it to use a lower priority DMA.</td> </tr></table><span class="postbody">
<br/>
<br/>
There might be something with ndslib. But remember I do the DMA from an interrupt.
<br/>
How do I found the code for ndslib? I only have the H files and the O files.
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
DekuTree64, have you ever got HDMA to work on the DS? If you can at least try one you will probably see my problem.
<br/>
If you find a solution, I will give you something... I will... hmm... give you... let's say something worth having.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#47003 - DekuTree64 - Sun Jul 03, 2005 6:29 am</h4>
    <div class="postbody"><span class="postbody">Yeah, I've used DMA1 for an HBlank scrolling wavy effect with no problems. Just set the DMA up during VBlank, to trigger on HBlank and repeat.
<br/>
<br/>
Are you doing something that requires you to actually start a fresh transfer during an HBlank interrupt? How much data are you transferring? Could be that you just don't have enough time.
<br/>
<br/>
Ndslib should include all the source, just grab the zip from drunkencoders.com if yours doesn't have it for some reason.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#47005 - LOst? - Sun Jul 03, 2005 6:41 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>DekuTree64 wrote:</b></span></td> </tr> <tr> <td class="quote">Yeah, I've used DMA1 for an HBlank scrolling wavy effect with no problems. Just set the DMA up during VBlank, to trigger on HBlank and repeat.
<br/>
<br/>
Are you doing something that requires you to actually start a fresh transfer during an HBlank interrupt? How much data are you transferring? Could be that you just don't have enough time.
<br/>
<br/>
Ndslib should include all the source, just grab the zip from drunkencoders.com if yours doesn't have it for some reason.</td> </tr></table><span class="postbody">
<br/>
<br/>
I'll send you my code with PM. Please take a look at it by using the real hardware. If you get it to work, or find any other bugs, I will be forever greatful!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#47012 - LOst? - Sun Jul 03, 2005 11:08 am</h4>
    <div class="postbody"><span class="postbody">This thread is closed now. The problem seemed to be in stopping the HDMA0 transfer before beginning the new frame. It now works on the real hardware, and DekuTree64 was the one finding the problem so all credits go to him!
<br/>
<br/>
Now, I have a DS to program!</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
