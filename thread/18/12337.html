<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Any way to hard-reset the DS? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Any way to hard-reset the DS?</h2>
<div id="posts">
<div class="post">
    <h4>#117288 - HyperHacker - Sat Feb 03, 2007 9:29 am</h4>
    <div class="postbody"><span class="postbody">I want to be able to exit from my program back to the DS firmware, as if I'd just turned it off and back on. Would just jumping to 0 on ARM7 and 0xFFFF0000 on ARM9 do (re-run the BIOS), or would I have to actually load the firmware into memory and execute it myself? Or is the power button the only way to do this?<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117290 - Lick - Sat Feb 03, 2007 10:34 am</h4>
    <div class="postbody"><span class="postbody">I think running the firmware in memory will work. You could try Chishm's unpacker on your own firmware dump, then include the unpacked fw as bin data and run it from your project, just to test if it works.
<br/>
You need to reset the Slot-1 (reinsert) and Slot-2 (cartreset or reinsert?) devices. I'm not sure how the firmware reacts on not being able to copy the headers from either of the devices. (Or maybe you'll just get gibberish headers, but that's not what you want right?)<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117292 - chishm - Sat Feb 03, 2007 10:52 am</h4>
    <div class="postbody"><span class="postbody">Won't work, unfortunately. The BIOS leaves magic values in RAM that the firmware needs, and I'm not sure what they are.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117310 - tepples - Sat Feb 03, 2007 8:00 pm</h4>
    <div class="postbody"><span class="postbody">Would A+B+Select+Start+NDSMP work to dump RAM to CF? If not, meaning that the FlashMe failsafe or NDSMP overwrites these areas, wouldn't it be possible to make a modified firmware that dumps RAM to CF and then runs the failsafe?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117331 - HyperHacker - Sat Feb 03, 2007 10:53 pm</h4>
    <div class="postbody"><span class="postbody">The failsafe shouldn't, it's just designed to pass control to user code ASAP. I'm almost positive NDSMP does though. LibNDS defines NDSHeader that's supposed to contain the DS card's header at bootup, but launching my programs either through WMB (which I think also does this for security) or NDSMP, there's nothing there. However, I can't read the card header again without reinserting it, so something has already done that and then discarded the results, which suggests NDSMP is overwriting them.
<br/>
<br/>
This is actually a bit of a problem as I was hoping to have my program be able to boot DS cards, but it can't read them unless you pop them in just before it loads up. :-/ Is there any chance we'll see a new version that doesn't do this? At this point it's really just another form of DRM, with the same old problems - hurts users (can't run a card booter without reinserting every time, which wears down the spring), not pirates (can use the many other tools available).<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117358 - chishm - Sun Feb 04, 2007 3:41 am</h4>
    <div class="postbody"><span class="postbody">NDSMP purposely clears EXRAM to give a clean boot environment for the binaries, especially when used in conjunction with a menu. It will also overwrite the NDS header with the header of the loaded ROM, as all other boot loaders do (or at least, should do). 
<br/>
<br/>
Even if it didn't, the secure area of the DS card is located somewhere in the first 64KiB of EXRAM, and this will almost certainly be overwritten by any loaded app. 
<br/>
<br/>
So long story short, it's possible, but it would require specialised NDSMP, ROM menu and loaded app to do.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117483 - HyperHacker - Mon Feb 05, 2007 2:16 am</h4>
    <div class="postbody"><span class="postbody">What do you mean by ROM menu? Like Supercard firmware? Surely the card's firmware could simply copy this info to some other unused RAM address. I thought there was a hacked NDSMP that did this somewhere.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117504 - chishm - Mon Feb 05, 2007 5:29 am</h4>
    <div class="postbody"><span class="postbody">As in MoonShell or whatever else is used to select the ROM to load. The easiest method to return to the DS menu is to power off the system. Even Nintendo uses this method.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117517 - knight0fdragon - Mon Feb 05, 2007 8:23 am</h4>
    <div class="postbody"><span class="postbody">lick doesnt your lovelite do this, or whatever you call the thing to do the passme reset<br/>_________________<br/><a href="http://www.myspace.com/knight0fdragonds" target="_blank">http://www.myspace.com/knight0fdragonds</a>
<br/>
<br/>
MK DS FC: Dragon 330772 075464 
<br/>
AC WW FC: Anthony SamsClub 1933-3433-9458 
<br/>
MPFH: Dragon 0215 4231 1206</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117522 - josath - Mon Feb 05, 2007 10:30 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote">As in MoonShell or whatever else is used to select the ROM to load. The easiest method to return to the DS menu is to power off the system. Even Nintendo uses this method.</td> </tr></table><span class="postbody">
<br/>
<br/>
Even in the firmware itself. It always struck me as sloppy coding, having to power-cycle to go from pictochat or settings back to main menu.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117545 - Lick - Mon Feb 05, 2007 3:05 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>knight0fdragon wrote:</b></span></td> </tr> <tr> <td class="quote">lick doesnt your lovelite do this, or whatever you call the thing to do the passme reset</td> </tr></table><span class="postbody">
<br/>
If this is a fullreset:
<br/>
<span style="color: darkblue">1) Clear/reset all memory/hardware.
<br/>
2) Reset NDS card (maybe impossible).
<br/>
3) Reset GBA cart.</span>
<br/>
<span style="color: green">4) Decrypt and decompress firmware.
<br/>
5) Run the firmware.</span>
<br/>
<span style="color: brown">4) ARM9 PassMe.
<br/>
5) ARM7 jump to GBA cart.</span>
<br/>
<br/>
<br/>
.. then libcartreset only does <span style="color: darkblue">3</span>,<span style="color: brown">4,5</span>. So that's how bad I need to update libcartreset to add step 1 (and rewrite the code).
<br/>
<br/>
josath: agreed. I was like: "Huh? How do I return to the [firmware] menu? Arghh!! I can't!"<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117575 - HyperHacker - Mon Feb 05, 2007 10:03 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote">As in MoonShell or whatever else is used to select the ROM to load. The easiest method to return to the DS menu is to power off the system. Even Nintendo uses this method.</td> </tr></table><span class="postbody">
<br/>
OK, well the app I'm making <span style="font-style: italic">is</span> the ROM loader*. Think GBA Booter, but able to run .nds files as well. :-) It's something you'd generally use as your _BOOT_MP.NDS or similar, so only FlashMe and NDSMP need to be dealt with. Eventually I hope to turn it into a firmware replacement. (BTW, is there anything special that the firmware needs to do to work, like initializing hardware? Or can I pretty much just drop my arm7.bin and arm9.bin in the appropriate places? Obviously I'm rather nervous about this idea.)
<br/>
<br/>
It probably won't be necessary to actually implement hard-rebooting, since I plan for it to do everything the firmware does except Pictochat, eliminating the need to use Nintendo's firmware at all. Obviously it won't do all these things from version 1 though, so if there were a simple way to add this feature, that'd be a nice tradeoff until it's no longer necessary.
<br/>
<br/>
Is NDSMP open-source? I could just modify it to copy the required info somewhere or just not overwrite it. For that matter how much space is available in the GBAMP firmware? It might be interesting to try replacing it; I remember someone mentioning the idea of embedding GBA-mode emulators in it but I don't think they made much progress.
<br/>
<br/>
*Despite the name, I don't intend to add any support for running backups. Don't associate it with r0mloader either. ;-)
<br/>
<br/>
BTW is there better code available for launching .nds files? Moonshell's code is really messy. I've only managed to extract the GBAMP code so far, and it's pretty simple because you really just call a routine in the device's firmware, obviously this won't work on other devices. :-/<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117594 - tepples - Mon Feb 05, 2007 10:38 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">It probably won't be necessary to actually implement hard-rebooting, since I plan for it to do everything the firmware does except Pictochat, eliminating the need to use Nintendo's firmware at all.</td> </tr></table><span class="postbody">
<br/>
Including a DS Download Play client? And are you planning on making a .nds chat program that uses the Pictochat protocol?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">*Despite the name, I don't intend to add any support for running backups. Don't associate it with r0mloader either. ;-)</td> </tr></table><span class="postbody">
<br/>
Or tying up hens?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117620 - chishm - Tue Feb 06, 2007 1:27 am</h4>
    <div class="postbody"><span class="postbody">Yes, NDSMP is open source. The source is included in the zip. BTW, it's distributed under GPL, so keep that in mind when releasing anything.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117632 - knight0fdragon - Tue Feb 06, 2007 3:19 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lick wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>knight0fdragon wrote:</b></span></td> </tr> <tr> <td class="quote">lick doesnt your lovelite do this, or whatever you call the thing to do the passme reset</td> </tr></table><span class="postbody">
<br/>
If this is a fullreset:
<br/>
<span style="color: darkblue">1) Clear/reset all memory/hardware.
<br/>
2) Reset NDS card (maybe impossible).
<br/>
3) Reset GBA cart.</span>
<br/>
<span style="color: green">4) Decrypt and decompress firmware.
<br/>
5) Run the firmware.</span>
<br/>
<span style="color: brown">4) ARM9 PassMe.
<br/>
5) ARM7 jump to GBA cart.</span>
<br/>
<br/>
<br/>
.. then libcartreset only does <span style="color: darkblue">3</span>,<span style="color: brown">4,5</span>. So that's how bad I need to update libcartreset to add step 1 (and rewrite the code).
<br/>
<br/>
josath: agreed. I was like: "Huh? How do I return to the [firmware] menu? Arghh!! I can't!"</span></td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
hmm well If you are using a flashcard with a multiboot menu, then some steps become pointless because the menu itself plays with mem / registers<br/>_________________<br/><a href="http://www.myspace.com/knight0fdragonds" target="_blank">http://www.myspace.com/knight0fdragonds</a>
<br/>
<br/>
MK DS FC: Dragon 330772 075464 
<br/>
AC WW FC: Anthony SamsClub 1933-3433-9458 
<br/>
MPFH: Dragon 0215 4231 1206</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117653 - HyperHacker - Tue Feb 06, 2007 10:54 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">It probably won't be necessary to actually implement hard-rebooting, since I plan for it to do everything the firmware does except Pictochat, eliminating the need to use Nintendo's firmware at all.</td> </tr></table><span class="postbody">
<br/>
Including a DS Download Play client? And are you planning on making a .nds chat program that uses the Pictochat protocol?</span></td> </tr></table><span class="postbody">
<br/>
I certainly wouldn't install a custom firmware without a Download Play client. It's how I test all my programs! I might try my hand at a standalone Pictochat client but I don't feel it's necessary.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">*Despite the name, I don't intend to add any support for running backups. Don't associate it with r0mloader either. ;-)</td> </tr></table><span class="postbody">
<br/>
Or tying up hens?</span></td> </tr></table><span class="postbody">
<br/>
No poultry was harmed in the making of this program, except the chicken I had for dinner last night.
<br/>
<br/>
chishm, thanks, I'll take a peek at the source hopefully sometime this week. (A few more important projects - ones with actual deadlines - may be cropping up.) I noticed though that my program itself is corrupting these values when I read data from files. Weird, but as long as I can just  grab it before it gets overwritten, I suppose it won't be an issue.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
