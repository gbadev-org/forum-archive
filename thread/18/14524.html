<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>512x512 8Bit background - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > 512x512 8Bit background</h2>
<div id="posts">
<div class="post">
    <h4>#145339 - AshaiRey - Wed Nov 14, 2007 8:49 am</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
Is it possible to have a 512x512 8bit background (not a tile Bg)
<br/>
<br/>
I've tried this on several way but i can't figure out how to do it or even if it's possible
<br/>
If this is possible then an example will be highly appreciated.<br/>_________________<br/>My personal ranting at blog.zoelen.net</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145349 - Lick - Wed Nov 14, 2007 11:24 am</h4>
    <div class="postbody"><span class="postbody">You'll need at least 256 KiB of VRAM for the screen you want the 512x512 8-bit background on. That background has to be an Extended Rotation background (see <a class="postlink" href="http://dev-scene.com/NDS/DOCgraphicmodes#Graphic_Modes" target="_blank">mode3-mode5</a>). You'll also need to set the BGx_CR to BG_BMP8_512x512. Because you're using an Extended Rotation background, you'll have to set the BGx_XDX, BGx_XDY, BGx_YDX, BGx_YDY, BGx_CX, and BGx_CY.
<br/>
<br/>
Also note that you can only write 16-bit (and 32-bit) values to the VRAM. 8-bit writes to the VRAM will give you visual abnormalities. So use bitshifting to create a temporary 16-bit value from two 8-bit values, then write to the VRAM.
<br/>
<br/>
If I have time, I can write an example later today, I don't have much time right now.<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145352 - AshaiRey - Wed Nov 14, 2007 11:57 am</h4>
    <div class="postbody"><span class="postbody">Thanks lick, i am looking forward to it.
<br/>
Ps, i've also PM-ed you some additional info.<br/>_________________<br/>My personal ranting at blog.zoelen.net</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145381 - NeX - Wed Nov 14, 2007 5:56 pm</h4>
    <div class="postbody"><span class="postbody">Eh... are you sure about that Lick?  I dmaCopied an 8-bit array straight to VRAM in SandScape.<br/>_________________<br/><a class="postlink" href="http://www.mediafire.com/?cuyb10fzdz2" target="_blank">Strummer</a> or <a class="postlink" href="http://www.mediafire.com/?71zxcztscix" target="_blank">Drummer?</a>.  
<br/>
Or maybe you would rather play with sand? <a class="postlink" href="http://www.mediafire.com/?a05z5wmdvxm" target="_blank">Sandscape is for you in that case.</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145385 - DragonMinded - Wed Nov 14, 2007 7:23 pm</h4>
    <div class="postbody"><span class="postbody">Yes, he's sure of it.  You cannot write 8bit to VRAM in arm9, only in arm7.<br/>_________________<br/>Enter the mind of the dragon.
<br/>
<br/>
<a href="http://dragonminded.blogspot.com" target="_blank">http://dragonminded.blogspot.com</a>
<br/>
<br/>
Seriously guys, how hard is it to simply TRY something yourself?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145392 - tepples - Wed Nov 14, 2007 8:39 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>NeX wrote:</b></span></td> </tr> <tr> <td class="quote">I dmaCopied an 8-bit array straight to VRAM in SandScape.</td> </tr></table><span class="postbody">
<br/>
You can use 16-bit or 32-bit copies to copy a properly aligned 8-bit array. I just looked in .../libnds/include/nds/dma.h, and the dmaCopy function appears to use 16-bit ("halfword") writes:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">static inline void dmaCopy(const void * source, void * dest, uint32 size) {
<br/>
   DMA_SRC(3) = (uint32)source;
<br/>
   DMA_DEST(3) = (uint32)dest;
<br/>
   DMA_CR(3) = DMA_COPY_HALFWORDS | (size&gt;&gt;1);
<br/>
   while(DMA_CR(3) &amp; DMA_BUSY);
<br/>
}
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145393 - M3d10n - Wed Nov 14, 2007 8:39 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>NeX wrote:</b></span></td> </tr> <tr> <td class="quote">Eh... are you sure about that Lick?  I dmaCopied an 8-bit array straight to VRAM in SandScape.</td> </tr></table><span class="postbody">
<br/>
<br/>
I think the DMA will work if your data is aligned to 16-bit.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145442 - NeX - Thu Nov 15, 2007 6:45 pm</h4>
    <div class="postbody"><span class="postbody">It's an 8-bit array hardcoded to the last megabyte of main RAM.  I haven't told it to use 16 bit anywhere.  In fact, I specify 8 bit even when copying the data.<br/>_________________<br/><a class="postlink" href="http://www.mediafire.com/?cuyb10fzdz2" target="_blank">Strummer</a> or <a class="postlink" href="http://www.mediafire.com/?71zxcztscix" target="_blank">Drummer?</a>.  
<br/>
Or maybe you would rather play with sand? <a class="postlink" href="http://www.mediafire.com/?a05z5wmdvxm" target="_blank">Sandscape is for you in that case.</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145450 - AshaiRey - Thu Nov 15, 2007 7:24 pm</h4>
    <div class="postbody"><span class="postbody">This is all quiet interesting but how do i display a 512x512 8bit image?<br/>_________________<br/>My personal ranting at blog.zoelen.net</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145454 - Jim e - Thu Nov 15, 2007 7:36 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>NeX wrote:</b></span></td> </tr> <tr> <td class="quote">It's an 8-bit array hardcoded to the last megabyte of main RAM.  I haven't told it to use 16 bit anywhere.  In fact, I specify 8 bit even when copying the data.</td> </tr></table><span class="postbody">If you dmacopied then the same issue isn't preset. The arm9 can only write 16bit to the vram.  DMA is separate from the cpu so it wont have that issue, however dma seems to also copy 16bit, so it doesn't really matter at all.
<br/>
<br/>
<br/>
Here's some example code. Some one correct me if I made a mistake.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">//Map to the start of the vram for the main screen
<br/>
   vramSetBankA(VRAM_A_MAIN_BG_0x06000000);
<br/>
<br/>
//Enable 3rd bg of main screen
<br/>
   videoSetMode( MODE_5_2D | DISPLAY_BG3_ACTIVE );
<br/>
<br/>
//The value in bg_bmp_base * 0x4000 says where in the vram the bmp is located
<br/>
   BG3_CR  = BG_BMP8_512x512  | BG_BMP_BASE(0x00) | BG_PRIORITY(3);
<br/>
<br/>
//No scaling.
<br/>
   BG3_XDX = 1&lt;&lt;8;
<br/>
   BG3_XDY = 0;
<br/>
   BG3_YDX = 0;
<br/>
   BG3_YDY = 1&lt;&lt;8;
<br/>
   BG3_CX  = 0;
<br/>
   BG3_CY  = 0;</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145464 - Lick - Fri Nov 16, 2007 12:21 am</h4>
    <div class="postbody"><span class="postbody"><a class="postlink" href="http://lickr.org/files/nds/bmp8_512x512.zip" target="_blank">bmp8_512x512.zip (21 KiB)</a>
<br/>
<br/>
The download contains an example of how to use 8-bit 512x512 bitmaps. It first fills the palette's 256 colors with rainbow values (using some imperfect algorithm I found on the web), then it fills the bitmap with indices to the palette. Use D-pad to move around.
<br/>
<br/>
(If you're not familiar with indexed bitmaps:
<br/>
if bitmap_byte_0 equals 12 then pixel_0 has palette_color_12's color.)<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145537 - AshaiRey - Sat Nov 17, 2007 12:25 pm</h4>
    <div class="postbody"><span class="postbody">Thx Lick!<br/>_________________<br/>My personal ranting at blog.zoelen.net</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
