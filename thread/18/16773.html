<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>want to stream audio within game - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > want to stream audio within game</h2>
<div id="posts">
<div class="post">
    <h4>#169503 - iainprice - Sat Jul 18, 2009 6:43 pm</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
I want to stream audio, either wav or mp3 within a game. I know there are some out there but they are very complicated and not easy to integrate into a game, they all seem to be stand alone.
<br/>
<br/>
Any ideas?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#169509 - hacker013 - Sun Jul 19, 2009 8:02 pm</h4>
    <div class="postbody"><span class="postbody">The wave streamer from discostew ?<br/>_________________<br/><a class="postlink" href="http://imetal.nl/" target="_blank">Website / Blog</a>
<br/>
<br/>
Let the nds be with you.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#169564 - iainprice - Thu Jul 23, 2009 9:04 pm</h4>
    <div class="postbody"><span class="postbody">Great bit of code.... have put it in game and it's working, I ma just converting it to work with efs
<br/>
<br/>
but... it messes up my sound effects, how can I play samples over the main music?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#169565 - Lazy1 - Thu Jul 23, 2009 9:50 pm</h4>
    <div class="postbody"><span class="postbody">I had that problem, if you are using maxmod you must lock some channels first if you plan on using libnds's sound playback functions.
<br/>
<a href="http://www.maxmod.org/ref/functions/mmLockChannels.html" target="_blank">http://www.maxmod.org/ref/functions/mmLockChannels.html</a>
<br/>
<br/>
[Edit]
<br/>
Though there is probably a better solution than that, maybe someone with a bit more experience can help you out.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#169566 - SteveH - Fri Jul 24, 2009 12:39 am</h4>
    <div class="postbody"><span class="postbody">Search this forum (the entire forum) for MS-ADPCM streamer or IMA-ADPCM streamer - there's some source code that will stream wav files from your card with little overhead - I'm looking at the MS-ADPCM at the moment, and it uses about 8 - 16 scanlines to stream the wav file.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#169573 - iainprice - Fri Jul 24, 2009 3:04 pm</h4>
    <div class="postbody"><span class="postbody">locking doesn't seem to make any difference at the moment.....</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#169804 - hacker013 - Tue Aug 04, 2009 1:19 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>SteveH wrote:</b></span></td> </tr> <tr> <td class="quote">Search this forum (the entire forum) for MS-ADPCM streamer or IMA-ADPCM streamer - there's some source code that will stream wav files from your card with little overhead - I'm looking at the MS-ADPCM at the moment, and it uses about 8 - 16 scanlines to stream the wav file.</td> </tr></table><span class="postbody">
<br/>
<br/>
he is already using that &gt;.&gt; the streamer from discostew but maybe his code can be alternated so for every next wave it will lock diffrent channels O_o<br/>_________________<br/><a class="postlink" href="http://imetal.nl/" target="_blank">Website / Blog</a>
<br/>
<br/>
Let the nds be with you.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#170458 - iainprice - Sun Sep 27, 2009 3:16 pm</h4>
    <div class="postbody"><span class="postbody">I am still having no joy with streaming sound and sound effects....
<br/>
<br/>
I use the adpcm streamer and build in a raw but the sound effect just makes a click and nothing else.....
<br/>
<br/>
[code]/***********************************************************
<br/>
 * ima-adpcm demo by Discostew
<br/>
 * player and decoder template by mukunda
<br/>
 ***********************************************************/
<br/>
<br/>
#include &lt;nds.h&gt;
<br/>
#include &lt;maxmod9.h&gt;
<br/>
#include &lt;fat.h&gt;
<br/>
#include "directory.h"
<br/>
#include "ima_adpcm.h"
<br/>
#include "rifle_raw.h"
<br/>
<br/>
IMA_Adpcm_Player player;
<br/>
bool player_loop = false;
<br/>
<br/>
char in_play[] = "|/-\\";
<br/>
int in_play_delay = 4;
<br/>
<br/>
bool dir_filetype = true;
<br/>
<br/>
int Execute_Directory_File( char *filename )
<br/>
{
<br/>
	return player.play( filename,  player_loop, false );
<br/>
}
<br/>
<br/>
/******************************************************
<br/>
 * main
<br/>
 *
<br/>
 * Program Entry Point
<br/>
 ******************************************************/
<br/>
int main(void) {
<br/>
	consoleDemoInit();
<br/>
	BG_PALETTE_SUB[0] = 13&lt;&lt;10;
<br/>
<br/>
	if( !fatInitDefault() ) {
<br/>
		iprintf( "FAT is required.\n" );
<br/>
		while(1) swiWaitForVBlank();
<br/>
	}
<br/>
<br/>
	mm_ds_system sys;
<br/>
	sys.mod_count = 0;
<br/>
	sys.samp_count = 0;
<br/>
	sys.mem_bank = 0;
<br/>
	sys.fifo_channel = FIFO_MAXMOD;
<br/>
	mmInit( &amp;sys );
<br/>
<br/>
	LLG_Directory directory( "wav", Execute_Directory_File );
<br/>
<br/>
	SetYtrigger( 0 );
<br/>
	irqEnable( IRQ_VCOUNT );
<br/>
<br/>
	int background_sine = 0;
<br/>
	int cur_in_play = 0;
<br/>
	int cur_in_play_delay = 0;
<br/>
	keysSetRepeat( 20, 3 );
<br/>
	swiWaitForVBlank();
<br/>
	while(1)
<br/>
	{
<br/>
		scanKeys();
<br/>
		int keysd = keysDown();
<br/>
		int keysr = keysDownRepeat();
<br/>
		if( keysd &amp; KEY_A ) {
<br/>
			directory.execute();
<br/>
		}
<br/>
<br/>
		if( keysd &amp; KEY_B ) {
<br/>
			player.stop();
<br/>
		}
<br/>
<br/>
		if( keysd &amp; KEY_X ) {
<br/>
			if( player.ispaused() )
<br/>
				player.resume();
<br/>
			else
<br/>
				player.pause();
<br/>
		}
<br/>
<br/>
		if( keysd &amp; KEY_Y ) {
<br/>
			player_loop = !player_loop;
<br/>
		}
<br/>
<br/>
		if( keysr &amp; KEY_UP ) {
<br/>
			directory.select_prior();
<br/>
		}
<br/>
<br/>
		if( keysr &amp; KEY_LEFT ) {
<br/>
//my bit to play sound effect
<br/>
			soundPlaySample(rifle_raw, SoundFormat_8Bit, rifle_raw_size, 11025, 127, 64, false, 0);
<br/>
		}
<br/>
<br/>
		if( keysr &amp; KEY_DOWN ) {
<br/>
			directory.select_next();
<br/>
		}
<br/>
<br/>
		if( keysHeld() &amp; KEY_L ) {
<br/>
		player.setvolume( player.getvolume() - 1 );
<br/>
		}
<br/>
		if( keysHeld() &amp; KEY_R ) {
<br/>
		player.setvolume( player.getvolume() + 1 );
<br/>
		}
<br/>
		if( keysd &amp; KEY_START ) {
<br/>
		directory.parent_dir();
<br/>
		}
<br/>
<br/>
		if( keysd &amp; KEY_SELECT ) {
<br/>
			dir_filetype = !dir_filetype;
<br/>
			if( dir_filetype )
<br/>
				directory.set_filter( "wav" );
<br/>
			else
<br/>
				directory.set_filter( "" );
<br/>
		}
<br/>
<br/>
		iprintf( "\x1b[23;0H%d  ", player.getvolume() );
<br/>
		iprintf( "\x1b[23;6H%s", ( dir_filetype ? "WAV files" : "All files" ));
<br/>
		iprintf( "\x1b[23;21H%s", ( player_loop ? "  Loop  " : "One shot" ));
<br/>
		if( player.isactive() ) {
<br/>
			iprintf( "\x1b[11;31H%c", ( player.ispaused() ? '-' : in_play[ cur_in_play ]));
<br/>
			cur_in_play_delay++;
<br/>
			if( cur_in_play_delay &gt;= in_play_delay )
<br/>
			{
<br/>
				cur_in_play_delay = 0;
<br/>
				cur_in_play++;
<br/>
				if( cur_in_play &gt;= 4 )
<br/>
					cur_in_play = 0;
<br/>
			}
<br/>
		}
<br/>
		else
<br/>
		{
<br/>
			iprintf( "\x1b[11;31H " );
<br/>
			cur_in_play_delay = 0;
<br/>
		}
<br/>
<br/>
		// wait until display line 0
<br/>
		swiIntrWait( 0, IRQ_VCOUNT );
<br/>
<br/>
		// update stream
<br/>
		player.update();
<br/>
<br/>
		// set backdrop to blueness (some lines were drawn with red to show cpu usage)
<br/>
		BG_PALETTE_SUB[0] = (12+(sinLerp(background_sine &amp; 65535)&gt;&gt;9))&lt;&lt;10;
<br/>
		background_sine += 200;
<br/>
<br/>
		swiWaitForVBlank();
<br/>
<br/>
		// set backdrop to RED
<br/>
		BG_PALETTE_SUB[0] = 0x1f;
<br/>
<br/>
	}
<br/>
<br/>
	return 0;
<br/>
}[/code]</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
