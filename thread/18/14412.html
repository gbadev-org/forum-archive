<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Playing wave files - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > Playing wave files</h2>
<div id="posts">
<div class="post">
    <h4>#143932 - kiwicode - Sat Oct 27, 2007 2:42 pm</h4>
    <div class="postbody"><span class="postbody">Hi all,
<br/>
<br/>
This week I've been trying to play wav files on a my nds application.
<br/>
As I've already done with images I don't want to link my data using headers generated by bin2o rule ( #include "blaster_raw.h" ).
<br/>
<br/>
For that reason I created a wave structure able to hold all the data inside my wav file.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#ifndef __WAV_H__
<br/>
#define __WAV_H__
<br/>
<br/>
#include &lt;gbfs.h&gt;
<br/>
<br/>
typedef struct
<br/>
{
<br/>
      char      chunkId[ 4 ];
<br/>
      uint32      chunkDataSize;
<br/>
      char      riffType[ 4 ];
<br/>
<br/>
}__attribute__ ((packed)) wav_header;
<br/>
<br/>
<br/>
typedef struct
<br/>
{
<br/>
      char      subChunkID[ 4 ];
<br/>
      uint32      subChunkSize;
<br/>
      uint16      audioFormat;
<br/>
      uint16      numChannels;
<br/>
      uint32      sampleRate;
<br/>
      uint32      byteRate;
<br/>
      uint16      blockAlign;
<br/>
      uint16      bitsPerSample;
<br/>
<br/>
}__attribute__ ((packed)) wav_file_info;
<br/>
<br/>
typedef struct
<br/>
{
<br/>
      char        data[ 4 ];
<br/>
      uint32      dataLength;
<br/>
      uint16      *wav_data;
<br/>
<br/>
   
<br/>
}__attribute__ ((packed)) data;
<br/>
<br/>
typedef struct
<br/>
{
<br/>
   wav_header      *pHeader;
<br/>
   wav_file_info   *pFileInfo;
<br/>
   data         *pData;
<br/>
<br/>
}__attribute__ ((packed)) wav_file;
<br/>
<br/>
extern wav_file *loadWav(const GBFS_FILE *file, 
<br/>
                   const char *name);
<br/>
<br/>
extern void displayWavInfo( wav_file* pFile );
<br/>
<br/>
#endif</td> </tr></table><span class="postbody">
<br/>
<br/>
and then I was hoping to play the sound effect with a couple of lines...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
wav_file *pWav = loadWav( &amp;data_gbfs, "alien.wav" );
<br/>
setGenericSound( 44100, 127, 64, 0 );         // let's set our sound format
<br/>
      
<br/>
      TransferSoundData alienSound = {
<br/>
               
<br/>
               ( u16 * )pWav-&gt;pData-&gt;wav_data,   // data pointer
<br/>
               pWav-&gt;pData-&gt;dataLength,          // data length
<br/>
               44100,                       // sample rate
<br/>
               127,                         // volume       
<br/>
               64,                           // pan
<br/>
               0                           // 16 bit
<br/>
      };
<br/>
<br/>
playSound( &amp;alienSound );
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
This is not working since I can just hear a strange buzzing sound from the speakers.
<br/>
<br/>
I read somewere that NDS wants signed sound data instead of unsigned but nothing seems to change.
<br/>
I would like to control sound through arm9 with these provided functions ( playSound etc. etc. ) that seem to work with "header-like" raw data.
<br/>
<br/>
Maybe I'm not handling wave data the right way, missing something somewhere..
<br/>
<br/>
Any ideas?
<br/>
<br/>
Thank you in advance,
<br/>
kiwicode</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143937 - kiwicode - Sat Oct 27, 2007 3:32 pm</h4>
    <div class="postbody"><span class="postbody">I've just solved my problem converting .wav file into .raw using sox!</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
