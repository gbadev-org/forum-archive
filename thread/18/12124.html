<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>consoleInit question - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > consoleInit question</h2>
<div id="posts">
<div class="post">
    <h4>#114687 - Vich - Wed Jan 10, 2007 1:54 am</h4>
    <div class="postbody"><span class="postbody">I have code like asserts that might get called before consoleInit is called. When this happens, the assert might call std::cout or iprintf to output a message. When this output is generated before consoleInit is done, the program breaks and consoleInit that is executed after that seems to fail.
<br/>
Can I detect - for example for the assert code - if consoleInit is called in an easy way?
<br/>
<br/>
(the less nice solution would be to create my own consoleInitProxy that stores a boolean to see if he has been called or not, but that would be a hack that I'd rather not do)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114709 - simonjhall - Wed Jan 10, 2007 8:44 am</h4>
    <div class="postbody"><span class="postbody">On other platforms I've used, assert calls abort which eventually calls exit. You could always register a function with atexit and put some console init/printf stuff in there...
<br/>
<br/>
Dumb question, but why don't you move the console init into somewhere earlier in your code? Or is the thing failing in a global constructor or something?<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114715 - Vich - Wed Jan 10, 2007 10:32 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>simonjhall wrote:</b></span></td> </tr> <tr> <td class="quote">On other platforms I've used, assert calls abort which eventually calls exit. You could always register a function with atexit and put some console init/printf stuff in there...
<br/>
<br/>
Dumb question, but why don't you move the console init into somewhere earlier in your code? Or is the thing failing in a global constructor or something?</td> </tr></table><span class="postbody">
<br/>
<br/>
I'll write down some extra info:
<br/>
I have 2 libraries:
<br/>
- COW: this is a system library with streaming, RTTI, serialization, containers and much more. It contains an cow::Initialize(params) call that can initialize one or more functions, like "INIT_PLATFORM".  When the platform gets initialized, the Nintendo DS console initialized.
<br/>
- AlterNova: this library uses COW and initializes it. It doesn't initialize INIT_PLATFORM, because it's a graphics engine and has it's own platform initializer. an::Initialize takes care of the platform init itself because it doesn't only need a console init, but also graphics init and a screen flip.
<br/>
<br/>
The problem is that between cow::Initialize and an::Initialize, there might be an assert that goes off. Since AlterNova calls cow::Initialize without the INIT_PLATFORM parameter(and handles that himself), any asserts inbetween the 2 init calls will make my console break indefinitely.
<br/>
<br/>
So, by default the console init happens at cow::initialize, which is early enough in the code to make everything work in all cases, but the problem is that any library/program must have the possibility to just ignore this call.
<br/>
<br/>
I hope this makes sense, since I'm still getting awake here :+
<br/>
<br/>
[edit]
<br/>
COW initialize:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void Initialize()
<br/>
{
<br/>
   powerON(POWER_ALL);
<br/>
<br/>
   // Set timer data
<br/>
   TIMER0_DATA   = 0;
<br/>
   TIMER1_DATA = 0;
<br/>
   TIMER0_CR   = TIMER_DIV_1024;
<br/>
   TIMER1_CR   = TIMER_CASCADE;
<br/>
<br/>
   // Second screen for 2D
<br/>
   // Sub BG0 will be used to print text
<br/>
   videoSetModeSub(MODE_0_2D | DISPLAY_BG0_ACTIVE);
<br/>
   vramSetBankC(VRAM_C_SUB_BG); 
<br/>
   SUB_BG0_CR = BG_MAP_BASE(31);
<br/>
   // Default font color is white
<br/>
   BG_PALETTE_SUB[255] = RGB15(31,31,31);
<br/>
<br/>
   irqInit();
<br/>
   irqSet(IRQ_VBLANK, 0);
<br/>
   irqEnable(IRQ_VBLANK);
<br/>
<br/>
   // We want the console on the lower screen
<br/>
   lcdSwap();
<br/>
<br/>
   consoleInitDefault((u16*)SCREEN_BASE_BLOCK_SUB(31), (u16*)CHAR_BASE_BLOCK_SUB(0), 16);
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
AlterNova init:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   // Main NDS init
<br/>
   powerON(POWER_ALL);
<br/>
<br/>
   // Set timer data
<br/>
   TIMER0_DATA   = 0;
<br/>
   TIMER1_DATA   = 0;
<br/>
   TIMER0_CR   = TIMER_DIV_1024;
<br/>
   TIMER1_CR   = TIMER_CASCADE;
<br/>
<br/>
   // Main screen for 3D
<br/>
   videoSetMode(MODE_0_3D);
<br/>
   // Second screen for 2D
<br/>
   videoSetModeSub(MODE_0_2D | DISPLAY_BG0_ACTIVE);   //sub bg 0 will be used to print text
<br/>
   vramSetBankC(VRAM_C_SUB_BG);
<br/>
   SUB_BG0_CR = BG_MAP_BASE(31);
<br/>
   BG_PALETTE_SUB[255] = RGB15(31,31,31);   //by default font will be rendered with color 255
<br/>
   // Init IRQ
<br/>
   irqInit();
<br/>
   irqSet(IRQ_VBLANK, 0);
<br/>
   irqEnable(IRQ_VBLANK);
<br/>
   // Swap screens
<br/>
   lcdSwap();
<br/>
   // Init console
<br/>
   consoleInitDefault((u16*)SCREEN_BASE_BLOCK_SUB(31), (u16*)CHAR_BASE_BLOCK_SUB(0), 16);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
[edit2] <span style="font-weight: bold">I think I know how to fix it, maybe this might work:</span>
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void Initialize(int param)
<br/>
{
<br/>
   // ALWAYS CALL THIS CODE ---&gt;
<br/>
<br/>
   powerON(POWER_ALL);
<br/>
<br/>
   // Set timer data
<br/>
   TIMER0_DATA   = 0;
<br/>
   TIMER1_DATA = 0;
<br/>
   TIMER0_CR   = TIMER_DIV_1024;
<br/>
   TIMER1_CR   = TIMER_CASCADE;
<br/>
<br/>
   consoleInitDefault((u16*)SCREEN_BASE_BLOCK_SUB(31), (u16*)CHAR_BASE_BLOCK_SUB(0), 16);
<br/>
<br/>
   //&lt;---
<br/>
<br/>
   if (param &amp; INIT_PLATFORM)
<br/>
   {
<br/>
      // Second screen for 2D
<br/>
      // Sub BG0 will be used to print text
<br/>
      videoSetModeSub(MODE_0_2D | DISPLAY_BG0_ACTIVE);
<br/>
      vramSetBankC(VRAM_C_SUB_BG);
<br/>
      SUB_BG0_CR = BG_MAP_BASE(31);
<br/>
      // Default font color is white
<br/>
      BG_PALETTE_SUB[255] = RGB15(31,31,31);
<br/>
<br/>
      irqInit();
<br/>
      irqSet(IRQ_VBLANK, 0);
<br/>
      irqEnable(IRQ_VBLANK);
<br/>
   }
<br/>
<br/>
   // We want the console on the lower screen
<br/>
   lcdSwap();
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
AlterNova init:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   // Init COW without INIT_PLATFORM
<br/>
   cow::Initialize(0);
<br/>
<br/>
   // Main screen for 3D
<br/>
   videoSetMode(MODE_0_3D);
<br/>
   // Second screen for 2D
<br/>
   videoSetModeSub(MODE_0_2D | DISPLAY_BG0_ACTIVE);   //sub bg 0 will be used to print text
<br/>
   vramSetBankC(VRAM_C_SUB_BG);
<br/>
   SUB_BG0_CR = BG_MAP_BASE(31);
<br/>
   BG_PALETTE_SUB[255] = RGB15(31,31,31);   //by default font will be rendered with color 255
<br/>
   // Init IRQ
<br/>
   irqInit();
<br/>
   irqSet(IRQ_VBLANK, 0);
<br/>
   irqEnable(IRQ_VBLANK);
<br/>
   // Swap screens
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I always presumed that consoleInit had to be after the videoSetModeStub, maybe it's not necessary? ... I'll test tonight :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114719 - kusma - Wed Jan 10, 2007 12:20 pm</h4>
    <div class="postbody"><span class="postbody">Use your own ASSERT-macro, with your own assert implementation. That way you'll be able to make sure you're in text-mode with the console inited properly before printing the error. Or if you want to keep it gcc-specific, you can implement __assert() yourself. Here's the signature gcc uses:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void __assert(const char *file, const int line, const char *msg)
<br/>
</td> </tr></table><span class="postbody">
<br/>
Just make sure it uses C linkage, and not C++.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114721 - Vich - Wed Jan 10, 2007 1:21 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>kusma wrote:</b></span></td> </tr> <tr> <td class="quote">Use your own ASSERT-macro, with your own assert implementation. That way you'll be able to make sure you're in text-mode with the console inited properly before printing the error. Or if you want to keep it gcc-specific, you can implement __assert() yourself. Here's the signature gcc uses:
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void __assert(const char *file, const int line, const char *msg)
<br/>
</td> </tr></table><span class="postbody">
<br/>
Just make sure it uses C linkage, and not C++.</span></td> </tr></table><span class="postbody">
<br/>
I'm already using my own assert macro. It's that macro that calls iprintf, but iprintf/cout doesn't know that iprintf doesn't work yet when consoleInit is not executed yet.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114737 - kusma - Wed Jan 10, 2007 3:32 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Vich wrote:</b></span></td> </tr> <tr> <td class="quote">I'm already using my own assert macro. It's that macro that calls iprintf, but iprintf/cout doesn't know that iprintf doesn't work yet when consoleInit is not executed yet.</td> </tr></table><span class="postbody">
<br/>
Well, make your ASSERT-macro call a function that sets it all up, just in case then?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114742 - wintermute - Wed Jan 10, 2007 4:22 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Vich wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
I always presumed that consoleInit had to be after the videoSetModeStub, maybe it's not necessary? ... I'll test tonight :)</td> </tr></table><span class="postbody">
<br/>
<br/>
No, it's not actually necessary to set the video mode before consoleInit.
<br/>
<br/>
It's probably perfectly reasonable to have your assert set the video mode and call consoleInit anyway, assuming you want to halt on asserts.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114743 - Vich - Wed Jan 10, 2007 4:30 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Vich wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
I always presumed that consoleInit had to be after the videoSetModeStub, maybe it's not necessary? ... I'll test tonight :)</td> </tr></table><span class="postbody">
<br/>
<br/>
No, it's not actually necessary to set the video mode before consoleInit.
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
Yeay ^^
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
It's probably perfectly reasonable to have your assert set the video mode and call consoleInit anyway, assuming you want to halt on asserts.</td> </tr></table><span class="postbody">
<br/>
<br/>
Why would I want my assert to set the video mode and consoleInit? That doesn't make sense to me since that's not assert's job. Plus, Assert is put in my COW library, while I want to override the video mode and console init through the AlterNova library that inherits/uses the COW library.
<br/>
[edit] Or was it a typo and you meant "COW library"(the library that holds the assert code) instead of "assert"? :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114751 - wintermute - Wed Jan 10, 2007 5:06 pm</h4>
    <div class="postbody"><span class="postbody">assert's job is to <span style="font-weight: bold">display</span> an error message.
<br/>
<br/>
If you need to set a video mode for that to happen then it kind of becomes assert's job really.
<br/>
<br/>
There are situations where all those programming rules you learn in academia go out the window - hint: the simplest approach to the problem is often the best.
<br/>
<br/>
When I use asserts I don't see anything particularly wrong with setting the video mode, initialising the console, displaying the error and halting the system.
<br/>
<br/>
The default exception handler in libnds does just that actually. I really wouldn't expect the user to have to initialise a console and have a specific video mode just for the sake of being able to see an error screen.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114756 - Vich - Wed Jan 10, 2007 5:22 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">assert's job is to <span style="font-weight: bold">display</span> an error message.
<br/>
<br/>
If you need to set a video mode for that to happen then it kind of becomes assert's job really.
<br/>
</td> </tr></table><span class="postbody">
<br/>
If it's job is to display something, why should it also initialize the system that allows to display things? Displaying and initializing it are two separate things. Of course they are related, but it's not assert's job to initialize some system. 
<br/>
<br/>
[edit] Plus, if I'd make output-related code do other stuff like initializing things, it could severely damage the cross-platform compatibility, because the program's flow wouldn't be the same on all platforms.
<br/>
Those 2 libraries currently have the exact same workflow on Windows/Linux/NintendoDS I'd like to keep it that way.
<br/>
<br/>
You do mean something like this, do you? Or is there a misunderstanding here?
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void assert(...)
<br/>
{
<br/>
    if (!is_console_initted)
<br/>
        initConsole()
<br/>
    // ... do assert stuff
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">There are situations where all those programming rules you learn in academia go out the window - hint: the simplest approach to the problem is often the best.</td> </tr></table><span class="postbody">
<br/>
That doesn't really count for me :P
<br/>
(I have no college/univ degree whatsoever)
<br/>
If a simple approach is a bad design, I don't code it. (unless there's no other way around it)
<br/>
If I'd do such things at work, my lead would fire me :)
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">When I use asserts I don't see anything particularly wrong with setting the video mode, initialising the console, displaying the error and halting the system.</td> </tr></table><span class="postbody">
<br/>
The library that controls the asserts normally initializes some systems when that library's init funcion is called, but this might be overwritten by the main application (that's a design decision).
<br/>
<br/>
library A -&gt; library B -&gt; main program
<br/>
The program uses library B. The program calls B::init(), B::Init() then calls A::init().
<br/>
A::init normally initializes the console(since it's a simple library) and the screen buffer for 2D graphics because it doesn't need more than that. However, library B needs more than 3D graphics, thus tells library A when initializing that he shouldn't initialize the graphics system of the Nintendo DS.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">The default exception handler in libnds does just that actually. I really wouldn't expect the user to have to initialise a console and have a specific video mode just for the sake of being able to see an error screen.</td> </tr></table><span class="postbody">
<br/>
I'm not using exception handlers at the moment. I thought I'd have to initialize a 2D video mode to have a console visible(because that's what the tutorial app showed me).
<br/>
<br/>
[edit] The real solution is to always call console init from the platform library(A) and then let the other init calls be done depending on what graphics mode the user wants from the DS (through library A::init or overwritten by library B::init).
<br/>
<br/>
eg. Some console app that uses platform library A will do something like this:
<br/>
A::init(STREAMING | PLATFORM);
<br/>
Some graphics app that uses graphics library B(and thus also A) will do something like this:
<br/>
A::init(STREAMING);
<br/>
B::init(PLATFORM);</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114764 - wintermute - Wed Jan 10, 2007 6:28 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Vich wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">assert's job is to <span style="font-weight: bold">display</span> an error message.
<br/>
<br/>
If you need to set a video mode for that to happen then it kind of becomes assert's job really.
<br/>
</td> </tr></table><span class="postbody">
<br/>
If it's job is to display something, why should it also initialize the system that allows to display things? Displaying and initializing it are two separate things. Of course they are related, but it's not assert's job to initialize some system. 
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
<br/>
This is an embedded system with no OS, if you want a display <span style="font-weight: bold">you</span> need to initialise it. Sometimes you just need to accept that there are situations where you can't separate things as much as you'd like.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114766 - Vich - Wed Jan 10, 2007 6:44 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Vich wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">assert's job is to <span style="font-weight: bold">display</span> an error message.
<br/>
<br/>
If you need to set a video mode for that to happen then it kind of becomes assert's job really.
<br/>
</td> </tr></table><span class="postbody">
<br/>
If it's job is to display something, why should it also initialize the system that allows to display things? Displaying and initializing it are two separate things. Of course they are related, but it's not assert's job to initialize some system. 
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
<br/>
This is an embedded system with no OS, if you want a display <span style="font-weight: bold">you</span> need to initialise it. Sometimes you just need to accept that there are situations where you can't separate things as much as you'd like.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Of course I have to do it, but I'd rather do it in the Init of my platform library when possible, because that's where it belongs. (and I now know that this is possible, because I can call consoleInit before any other 2D/3D graphics-related init calls)
<br/>
So I can perfectly separate it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114829 - josath - Thu Jan 11, 2007 12:06 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Vich wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Vich wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">assert's job is to <span style="font-weight: bold">display</span> an error message.
<br/>
<br/>
If you need to set a video mode for that to happen then it kind of becomes assert's job really.
<br/>
</td> </tr></table><span class="postbody">
<br/>
If it's job is to display something, why should it also initialize the system that allows to display things? Displaying and initializing it are two separate things. Of course they are related, but it's not assert's job to initialize some system. 
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
<br/>
This is an embedded system with no OS, if you want a display <span style="font-weight: bold">you</span> need to initialise it. Sometimes you just need to accept that there are situations where you can't separate things as much as you'd like.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Of course I have to do it, but I'd rather do it in the Init of my platform library when possible, because that's where it belongs. (and I now know that this is possible, because I can call consoleInit before any other 2D/3D graphics-related init calls)
<br/>
So I can perfectly separate it.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Go ahead and separate it, but then put the call to InitMyConsoleGFX() inside the Assert() function. Problem solved.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114832 - Vich - Thu Jan 11, 2007 12:15 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>josath wrote:</b></span></td> </tr> <tr> <td class="quote">Go ahead and separate it, but then put the call to InitMyConsoleGFX() inside the Assert() function. Problem solved.</td> </tr></table><span class="postbody">
<br/>
I fixed it by initting the console before any assert was called :)
<br/>
(initting the console couldn't be done before setting the video mode, I tried)<br/>_________________<br/>[<a class="postlink" href="http://www.lifeisdigital.net" target="_blank">project website</a>] [<a class="postlink" href="http://www.kenvanhoeylandt.net" target="_blank">personal website</a>]</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
