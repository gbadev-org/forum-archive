<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>libfat stalling 5 secs trying to mount empty Slot2 - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > libfat stalling 5 secs trying to mount empty Slot2</h2>
<div id="posts">
<div class="post">
    <h4>#159200 - fluff - Thu Jun 26, 2008 9:20 pm</h4>
    <div class="postbody"><span class="postbody">EDIT: Oh yeah, the issue I'm having is that fatInitDefault() takes about 5 seconds to complete.
<br/>
<br/>
Well, I mucked about a bit more and located the stalling lines in libfat.
<br/>
<br/>
This is from the libfat 20080530 source.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
disc.c:
<br/>
const IO_INTERFACE* _FAT_disc_gbaSlotFindInterface (void) {
<br/>
   [...]
<br/>
      fluff_debug_libfat2 = 10 + i;   //fluff: stalls for 5 secs with i == 7, i.e. with _io_m3sd
<br/>
      if ((ioInterfaces[i]-&gt;features &amp; FEATURE_SLOT_GBA) &amp;&amp; (ioInterfaces[i]-&gt;fn_startup())) {
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Or, broken down further still:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
io_m3sd.c:
<br/>
static bool _M3SD_initCard (void) {
<br/>
   [...]
<br/>
   if (!_M3SD_sendCommand (GO_IDLE_STATE, 0)) {   //fluff: stalls for ~1.5 seconds
<br/>
   [...]
<br/>
   return _SD_InitCard (_M3SD_cmd_6byte_response,
<br/>
            _M3SD_cmd_17byte_response,
<br/>
            true,
<br/>
            &amp;_M3SD_relativeCardAddress);   //fluff: stalls for ~4 seconds
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
My Slot2 is empty for the record. So does this delay happen to everyone or is it somehow a feature of my CycloDS?
<br/>
<br/>
I'm also wondering, is there any good reason to keep supporting non-DLDI adapters?
<br/>
<br/>
I would very much like to just rip out the M3SD (what's that anyway, all M3 adapters with SD cards?) support in the libfat I'm using... Would that mean trouble for a good portion of the hordes of fans my apps will no doubt receive, or can I do it in good conscience? :)
<br/>
<br/>
Commenting out all the Slot2 elements in ioInterfaces gives me a wonderful virtually instantaneous fatInitDefault experience... Plus I shave a chunk off the executable.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#159202 - tepples - Thu Jun 26, 2008 9:27 pm</h4>
    <div class="postbody"><span class="postbody">If you rip out M3SD support, all that means is that users of SLOT-2 M3 cards might need to use <a class="postlink" href="http://dldi.drunkencoders.com/index.php?title=M3_Adapter_%28SD_Card%29" target="_blank">DLDI</a>. Big whoop. There are DLDI files for all the cards with built-in drivers. As I understand it, you need to leave in the built-in drivers primarily for programs that can browse files from cards in both slots.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#159203 - fluff - Thu Jun 26, 2008 9:38 pm</h4>
    <div class="postbody"><span class="postbody">Superb. I see on that page there are DLDI drivers for the 2 built-in Slot1 cards as well. I'll happily kill everything non-DLDI then... Thanks!</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
