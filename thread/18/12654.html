<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>No$GBA / libfat /DLDI - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > No$GBA / libfat /DLDI</h2>
<div id="posts">
<div class="post">
    <h4>#121069 - Diddl - Thu Mar 08, 2007 5:20 pm</h4>
    <div class="postbody"><span class="postbody">Don't know if everyone works with No$GBA?
<br/>
<br/>
Is it possible to debug a .ds.gba with libfat (dldi) support?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121072 - GPFerror - Thu Mar 08, 2007 5:33 pm</h4>
    <div class="postbody"><span class="postbody">yeah with FCSR images(FAT12) appended to .ds.gba you can use libfat in No$GBA and desmume and ideas.
<br/>
<br/>
<a href="http://forum.gbadev.org/viewtopic.php?p=114090&amp;highlight=fcsr+dldi#114090" target="_blank">http://forum.gbadev.org/viewtopic.php?p=114090&amp;highlight=fcsr+dldi#114090</a>
<br/>
<br/>
Troy(GPF)
<br/>
<a href="http://gpf.dcemu.co.uk" target="_blank">http://gpf.dcemu.co.uk</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121074 - sirpoonga - Thu Mar 08, 2007 6:03 pm</h4>
    <div class="postbody"><span class="postbody">The dldi file doesn't exist?
<br/>
<br/>
Also, can you put a file into that filesystem?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121079 - Diddl - Thu Mar 08, 2007 6:54 pm</h4>
    <div class="postbody"><span class="postbody">ah cool, - thanks! 
<br/>
<br/>
would be nice to change something in no$gba to emulate a virtual slot 1 card with TF and FAT. or a slot 2 card with TF. then a virtual DLDI could do the interface ...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121082 - GPFerror - Thu Mar 08, 2007 7:04 pm</h4>
    <div class="postbody"><span class="postbody">not sure why directly linking isn't working any more for those files, but i have add them both to my left nav bar under Utilities. <a href="http://gpf.dcemu.co.uk" target="_blank">http://gpf.dcemu.co.uk</a>
<br/>
<br/>
fcsrimage.zip Creates a FAT12 image file from a directory for windows command line, also includes davr's code/shell scripts for linux that mine is based off of.
<br/>
<br/>
fcsrDLDI.zip dldi patch for .ds.gba files to read from appended FCSR image.
<br/>
<br/>
Troy(GPF)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121087 - sirpoonga - Thu Mar 08, 2007 7:58 pm</h4>
    <div class="postbody"><span class="postbody">Hmmm, fatinitdefault fails.
<br/>
<br/>
I just want to be clear on the setup.  Let's say I have come files in c:\files and my program is called program.nds.
<br/>
build program.img c:\files
<br/>
copy .img to folder with .nds.
<br/>
cat program.nds program.img &gt; program2.nds
<br/>
dlditool fcsr.dldi program2.nds
<br/>
<br/>
Does this look right?
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
G:\emu\fcsrimage&gt;dlditool.exe fcsr.dldi physics2.sc.nds
<br/>
Dynamically Linked Disk Interface patch tool v1.23 by Michael Chisholm (Chishm)
<br/>
<br/>
Trying "fcsr.dldi"
<br/>
Old driver:          Default (No interface)
<br/>
New driver:          FlashCartSRam
<br/>
<br/>
Position in file:    0x0000E4C0
<br/>
Position in memory:  0x0200E0C0
<br/>
Patch base address:  0xBF800000
<br/>
Relocation offset:   0x4280E0C0
<br/>
<br/>
Patched successfully
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121089 - GPFerror - Thu Mar 08, 2007 8:42 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sirpoonga wrote:</b></span></td> </tr> <tr> <td class="quote">Hmmm, fatinitdefault fails.
<br/>
<br/>
I just want to be clear on the setup.  Let's say I have come files in c:\files and my program is called program.nds.
<br/>
build program.img c:\files
<br/>
copy .img to folder with .nds.
<br/>
cat program.nds program.img &gt; program2.nds
<br/>
dlditool fcsr.dldi program2.nds
<br/>
<br/>
Does this look right?
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
G:\emu\fcsrimage&gt;dlditool.exe fcsr.dldi physics2.sc.nds
<br/>
Dynamically Linked Disk Interface patch tool v1.23 by Michael Chisholm (Chishm)
<br/>
<br/>
Trying "fcsr.dldi"
<br/>
Old driver:          Default (No interface)
<br/>
New driver:          FlashCartSRam
<br/>
<br/>
Position in file:    0x0000E4C0
<br/>
Position in memory:  0x0200E0C0
<br/>
Patch base address:  0xBF800000
<br/>
Relocation offset:   0x4280E0C0
<br/>
<br/>
Patched successfully
<br/>
</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
<br/>
have to use the ds.gba file or at least i've never had any luck with the .nds file
<br/>
<br/>
also must padbin the file also
<br/>
<br/>
padbin 512 program.ds.gba
<br/>
cat program.ds.gba program.img &gt; program2.ds.gba
<br/>
dlditool.exe fcsr.dldi program2.ds.gba
<br/>
<br/>
I usually add it to my makefile like this
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">$(TARGET).nds   :   $(TARGET).arm7 $(TARGET).arm9
<br/>
   ndstool   -c $(TARGET).nds -7 $(TARGET).arm7 -9 $(TARGET).arm9
<br/>
   dsbuild $(TARGET).nds
<br/>
   padbin 512 $(TARGET).ds.gba
<br/>
   cat $(TARGET).ds.gba duke.img  &gt; $(TARGET)_fs.ds.gba
<br/>
   dlditool fcsr.dldi $(TARGET)_fs.ds.gba
<br/>
   dlditool mpcf.dldi $(TARGET).nds</td> </tr></table><span class="postbody">
<br/>
<br/>
just find this section in the Makefile if you use the combined template Makefile and add the lines to it.
<br/>
<br/>
Troy(GPF)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121095 - sirpoonga - Thu Mar 08, 2007 9:03 pm</h4>
    <div class="postbody"><span class="postbody">Ahhh, it worked.  The .sc.nds is .ds.gba renamed for supercard.  Got it to init and find a file.  Sweet, this will help out alot.  
<br/>
<br/>
I need to add this to the makefile.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122969 - Tantrum - Sat Mar 24, 2007 12:51 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>GPFerror wrote:</b></span></td> </tr> <tr> <td class="quote">fcsrimage.zip Creates a FAT12 image file from a directory for windows command line, also includes davr's code/shell scripts for linux that mine is based off of.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Hi.  I'm getting the following error when I try and construct an image.  The error seems to be coming from BFI.EXE
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">InjectFile("stuff\woot5.txt") failed</td> </tr></table><span class="postbody">
<br/>
<br/>
Does anybody know what I'm doing wrong?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122972 - Tantrum - Sat Mar 24, 2007 1:27 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Tantrum wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>GPFerror wrote:</b></span></td> </tr> <tr> <td class="quote">fcsrimage.zip Creates a FAT12 image file from a directory for windows command line, also includes davr's code/shell scripts for linux that mine is based off of.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Hi.  I'm getting the following error when I try and construct an image.  The error seems to be coming from BFI.EXE
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">InjectFile("stuff\woot5.txt") failed</td> </tr></table><span class="postbody">
<br/>
<br/>
Does anybody know what I'm doing wrong?</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Ok, found it.  It seems that the minimum size for the img is set to 10k when the files don't exeed that size in total, but BFI doesn't have enough room to work and barfs.  I upped the 10000 in build.bat to 20000 and it works.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135784 - Schyzophrenic - Thu Jul 26, 2007 8:41 am</h4>
    <div class="postbody"><span class="postbody">Hi everyone, 
<br/>
<br/>
I tried FCSR DLDI driver, but I have a question about it.
<br/>
<br/>
Does this DLDI driver manage both read/write ? I am currently developping a homebrew with DLDI support. The code works fine on supercard but I don't see any file <span style="font-weight: bold">creation</span> (I am not talking about reading) when using no$gba.
<br/>
<br/>
Is there any special thing to do to enable writing? Where should the files be created ? And is it possible to write file through no$gba (like we do on hardware) ?
<br/>
<br/>
Thanks a lot for your help !</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135793 - Dwedit - Thu Jul 26, 2007 10:32 am</h4>
    <div class="postbody"><span class="postbody">I don't know about FCSR here, but I independently made something very similar.  I have hacked up gba_nds_fat to use the 64k of SRAM as writable space.  You have your big read only FAT disk image, then 'unify' it with SRAM.  The SRAM maintains a list of sectors which have changed from the disk image, so when you reads a sector, it either reads from SRAM or from ROM, and when you write to a sector, it writes to SRAM and updates the list of changed sectors.  You can store just under 63.5k worth of changed sectors after overhead.  This includes overhead coming from the directory entires sector, the FAT chain, and the file contents, so you can't fit a full 64k sized file there, but can store at least 60k worth of files safely.
<br/>
<br/>
Does FCSR also unify SRAM with the read only disk image, and perform writes the same way?
<br/>
<br/>
Note: watch out, NO$GBA limits SRAM size to 32k.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135794 - Schyzophrenic - Thu Jul 26, 2007 10:52 am</h4>
    <div class="postbody"><span class="postbody">The file I'd like to store is only a few kbs :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135823 - calcprogrammer1 - Thu Jul 26, 2007 6:14 pm</h4>
    <div class="postbody"><span class="postbody">I think Desmume has some sort of FAT Slot-2 emulation.  I used it to debug my file browser, it showed the list of files that were in the directory of the .nds file.  I was able to delete, but it wouldn't change directory.<br/>_________________<br/>DS Firmware 1, Datel Games n' Music card / Chism's FW hacked GBA MP v2 CF
<br/>
<br/>
There's no place like 127.0.0.1.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135825 - Ant6n - Thu Jul 26, 2007 6:35 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dwedit wrote:</b></span></td> </tr> <tr> <td class="quote">I don't know about FCSR here, but I independently made something very similar.  I have hacked up gba_nds_fat to use the 64k of SRAM as writable space.  You have your big read only FAT disk image, then 'unify' it with SRAM.  The SRAM maintains a list of sectors which have changed from the disk image, so when you reads a sector, it either reads from SRAM or from ROM, and when you write to a sector, it writes to SRAM and updates the list of changed sectors.  You can store just under 63.5k worth of changed sectors after overhead.
<br/>
...</td> </tr></table><span class="postbody">
<br/>
I've been looking for something like that, is there any way to get this (or something similar) working under libfat?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135833 - masscat - Thu Jul 26, 2007 6:58 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>calcprogrammer1 wrote:</b></span></td> </tr> <tr> <td class="quote">I think Desmume has some sort of FAT Slot-2 emulation.  I used it to debug my file browser, it showed the list of files that were in the directory of the .nds file.  I was able to delete, but it wouldn't change directory.</td> </tr></table><span class="postbody">
<br/>
Desmume simulates a GBAMP and attempts to create a FAT structure from the directory of the .nds file, as you say. There is no write support and, under Linux at least, it does get confused when using sub directories.
<br/>
There is also another mode that allows full read/write access (since version 0.7.1), again simulating a GBAMP. It uses a disk image file which you pass to desmume using the --cflash=&lt;path_to_disk_image_file&gt; command line option (both on Windows and Linux). You can find Java application for creating, reading and writing the disk image over on the <a class="postlink" href="http://forums.desmume.org/viewtopic.php?id=102" target="_blank">desmume forums</a>.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135837 - calcprogrammer1 - Thu Jul 26, 2007 7:27 pm</h4>
    <div class="postbody"><span class="postbody">On windows it seems to be able to write to that directory, (my pasting routine  showed up, maybe it didn't actually write anything though, but I think it deleted something too when I tested).  It doesn't change directories though.<br/>_________________<br/>DS Firmware 1, Datel Games n' Music card / Chism's FW hacked GBA MP v2 CF
<br/>
<br/>
There's no place like 127.0.0.1.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
