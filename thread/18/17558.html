<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>GDB, DeSmuME and breakpoints - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > GDB, DeSmuME and breakpoints</h2>
<div id="posts">
<div class="post">
    <h4>#176462 - Rajveer - Sun Jul 31, 2011 2:04 pm</h4>
    <div class="postbody"><span class="postbody">I have a project which compiles both for the Nintendo DS and Windows, so all of my debugging I've been doing in Visual C++. I've got a DS specific problem now and am trying to debug with DeSmuME and Insight, however Insight won't let me set breakpoints in many functions (including the one I'm trying to debug), only on lines of code with black horizontal lines next to them. From what I've read I should be able to put breakpoints wherever I want, so is this normal?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176463 - elhobbs - Sun Jul 31, 2011 3:45 pm</h4>
    <div class="postbody"><span class="postbody">you need to disable optimizations when compiling in order to set breakpoints on any line. You need to change your makefile CFLAGS. change -O2 to -O0 and remove -fomit-frame-pointer when building a debug build.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176464 - Rajveer - Sun Jul 31, 2011 6:03 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for the suggestion, I think I'm still doing something wrong though. I can set breakpoints wherever I want in my main.cpp file (each line that's not commented out has that black horizontal line next to it which allows me to set a breakpoint), but only a few of my other source files allow me to. In fact the source file that has the function to be debugged has lost all of those black lines, so I can't set a breakpoint anywhere in that file now. Here are my code gen options:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#---------------------------------------------------------------------------------
<br/>
# options for code generation
<br/>
#---------------------------------------------------------------------------------
<br/>
ARCH   :=   -mthumb -mthumb-interwork
<br/>
<br/>
CFLAGS   :=   -g -Wall -O0\
<br/>
          -march=armv5te -mtune=arm946e-s\
<br/>
         -ffast-math \
<br/>
         $(ARCH)
<br/>
<br/>
CFLAGS   +=   $(INCLUDE) -DARM9
<br/>
CXXFLAGS   :=   $(CFLAGS) -fno-rtti -fno-exceptions
<br/>
<br/>
ASFLAGS   :=   -g $(ARCH) -march=armv5te -mtune=arm946e-s
<br/>
<br/>
LDFLAGS   =   -specs=ds_arm9.specs -g $(ARCH) -Wl,-Map,$(notdir $*.map)</td> </tr></table><span class="postbody">
<br/>
<br/>
EDIT: The spacing is a bit messed up when I paste from my makefile.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176465 - elhobbs - Sun Jul 31, 2011 7:49 pm</h4>
    <div class="postbody"><span class="postbody">I am not sure if you are doing something wrong. I just opened one of my old projects in insight compiled with the same flags as you are using from a previous devkitarm install and it was working. I recompiled with the current devkitarm and I can no longer set breakpoints in insight.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176466 - wintermute - Sun Jul 31, 2011 9:56 pm</h4>
    <div class="postbody"><span class="postbody">You'll need a new Insight for latest devkitARM that I haven't got around to uploading yet. The arm-eabi-gdb included with devkitARM will work though<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176467 - wintermute - Sun Jul 31, 2011 9:59 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>elhobbs wrote:</b></span></td> </tr> <tr> <td class="quote">you need to disable optimizations when compiling in order to set breakpoints on any line. You need to change your makefile CFLAGS. change -O2 to -O0 and remove -fomit-frame-pointer when building a debug build.</td> </tr></table><span class="postbody">
<br/>
<br/>
Actually this is a myth, you can quite happily set breakpoints in optimised code. Stepping will look a little odd and some lines will be missing entirely since they're optimised out.
<br/>
<br/>
Switching to -O0 for debugging purposes is also rather pointless, you're not necessarily debugging the code that's breaking since it quite often only breaks on the higher optimisation levels.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176468 - Rajveer - Sun Jul 31, 2011 10:18 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for going to the effort of checking what was the cause elhobbs, and wintermute for confirming. I'll learn how to use GDB without a GUI, although shamefully I'll admit that I'm a GUI kinda guy :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176470 - elhobbs - Mon Aug 01, 2011 2:11 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>elhobbs wrote:</b></span></td> </tr> <tr> <td class="quote">you need to disable optimizations when compiling in order to set breakpoints on any line. You need to change your makefile CFLAGS. change -O2 to -O0 and remove -fomit-frame-pointer when building a debug build.</td> </tr></table><span class="postbody">
<br/>
<br/>
Actually this is a myth, you can quite happily set breakpoints in optimised code. Stepping will look a little odd and some lines will be missing entirely since they're optimised out.</span></td> </tr></table><span class="postbody">I was not trying to say that it is impossible in optimized code. I was trying to say that if you want to be able to stop on every line then disabling optimizations will allow that. it is hard to tell what someone's problem is from a few lines in a forum post - though Rajveer did say that it is missing from "many" functions but not all. it seemed like a good place to start.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Switching to -O0 for debugging purposes is also rather pointless, you're not necessarily debugging the code that's breaking since it quite often only breaks on the higher optimisation levels.</td> </tr></table><span class="postbody">that may be true for the code that you write, but the simpleton stuff that I write tends to fail just fine without optimations turned on.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176471 - Rajveer - Tue Aug 02, 2011 12:07 am</h4>
    <div class="postbody"><span class="postbody">I gave arm-ebai-gdb a shot today and I'm still having issues. I tried listing the beginning of various functions in different source files (with list <span style="font-style: italic">filename:function</span>), GDB correctly listed those functions where I could set a breakpoint in Insight. In the source files and functions where I was having problems before, it listed the beginnings of totally different functions (the ones I tried showed glCallList - I'm including videoGL.h in the source file, but not using glCallList in any of those functions). So does this mean that the debug symbols are messed up if arm-ebai-gdb is supposed to work?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176486 - wintermute - Thu Aug 04, 2011 10:46 pm</h4>
    <div class="postbody"><span class="postbody">I just uploaded the new insight builds, give those a shot.
<br/>
<br/>
Any chance you could send me a copy of your project to have a look &amp; see if I can figure out what's going on? Drop by IRC if you get a chance.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176489 - Rajveer - Sat Aug 06, 2011 1:02 am</h4>
    <div class="postbody"><span class="postbody">Awesome, the new Insight build works and I can step through my code, thanks a bunch :)
<br/>
<br/>
One thing, I get the horizontal lines next to my code but I can't set a breakpoint by clicking on them like I could in the older build. Although I was able to right click on the function name that needed debugging and choose set breakpoint, which set a red square on the first black line at the beginning of the function.
<br/>
<br/>
I could definately send you a copy if it will help with anything; since it works with the new Insight, do you still want it (maybe you want to see why it wasn't working with the older GDB)?</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
