<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Hermes eLIBS release 2 - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Hermes eLIBS release 2</h2>
<div id="posts">
<div class="post">
    <h4>#120816 - SpacedCowboy - Tue Mar 06, 2007 7:16 am</h4>
    <div class="postbody"><span class="postbody">Has anyone got the WiFi to work in their own programs ? I was trying to put together the simplest connect-to-the-wifi-network program by cutting down the 0WifiLoader example, but I'm running into problems figuring out just what you need to keep :-(
<br/>
<br/>
All I can get is a blank screen on startup. I can't see how to attach the code for main.cpp, so here's a  <a class="postlink" href="http://www.gornall.net/main_cpp.html" target="_blank">URL to the source-code I'm using</a>. It's pretty short :-)
<br/>
<br/>
On the "old" dswifi code, you had to have the arm7 running some code, and the arm9 running some code - that doesn't seem to be the case for the new dswifi lib (or maybe it's just hidden better), but the 0wifiloader example doesn't seem to have any arm7 code in it...
<br/>
<br/>
Anyway, if anyone can take a look and tell me what I'm doing wrong, I'd much appreciate it. I basically want wifi and threads, so this library would be perfect, if I could just get it to work...
<br/>
<br/>
Cheers,
<br/>
<br/>
Simon</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#120835 - OOPMan - Tue Mar 06, 2007 12:21 pm</h4>
    <div class="postbody"><span class="postbody">Why is this thread titled Hermes eLIBS release 2?
<br/>
<br/>
It seems to have nothing to do with Hermes' stuff and the poster certainly isn't Hermes...<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#120847 - SpacedCowboy - Tue Mar 06, 2007 5:32 pm</h4>
    <div class="postbody"><span class="postbody">Er, perhaps I'm mistaken then, or there are two Hermes, but I thought it was he who wrote eLIBS2 (the library formally known as multithread+esound), available at <a class="postlink" href="http://www.elotrolado.net/showthread.php?s=&amp;threadid=654466" target="_blank">this site</a>, and also mentioned in <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=11639&amp;postdays=0&amp;postorder=asc&amp;start=15" target="_blank">this forum</a>
<br/>
<br/>
This is the library that Hermes (?) has integrated dswifi with his multithreading library - which is exactly what I want (they both used TIMER3 previously. It looks as though he's converted the dswifi library to use TIMER2). 
<br/>
<br/>
Any help (even pointing me at the right 'Hermes' if that's the case) gratefully appreciated :-)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#120862 - Puyo - Tue Mar 06, 2007 9:30 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">but the 0wifiloader example doesn't seem to have any arm7 code in it...</td> </tr></table><span class="postbody">
<br/>
Actually it does &amp; nothing major changed since "old" wifi library.
<br/>
<br/>
You can use original wifi examples &amp; Hermes`s stuff together too.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#120880 - SpacedCowboy - Wed Mar 07, 2007 12:23 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Puyo wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Actually it does &amp; nothing major changed since "old" wifi library.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Ah, ok, yes there's ARM7 code in there, but in the WiFi examples for the original library, there's an arm7 directory with stuff like:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
int main()
<br/>
 ...
<br/>
 ...
<br/>
{ // sync with arm9 and init wifi
<br/>
        u32 fifo_temp;   
<br/>
<br/>
          while(1) { // wait for magic number
<br/>
        while(REG_IPC_FIFO_CR&amp;IPC_FIFO_RECV_EMPTY) swiWaitForVBlank();
<br/>
      fifo_temp=REG_IPC_FIFO_RX;
<br/>
      if(fifo_temp==0x12345678) break;
<br/>
        }
<br/>
        while(REG_IPC_FIFO_CR&amp;IPC_FIFO_RECV_EMPTY) swiWaitForVBlank();
<br/>
        fifo_temp=REG_IPC_FIFO_RX; // give next value to wifi_init
<br/>
        Wifi_Init(fifo_temp);
<br/>
        
<br/>
        irqSet(IRQ_FIFO_NOT_EMPTY,arm7_fifo); // set up fifo irq
<br/>
        irqEnable(IRQ_FIFO_NOT_EMPTY);
<br/>
        REG_IPC_FIFO_CR = IPC_FIFO_ENABLE | IPC_FIFO_RECV_IRQ;
<br/>
<br/>
        Wifi_SetSyncHandler(arm7_synctoarm9); // allow wifi lib to notify arm9
<br/>
  } // arm7 wifi init complete
<br/>
  ... 
<br/>
  ...
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
... which is the sort of thing I was looking for in Hermes' library and couldn't find. I thought it might be to do with him setting up that code in the library and using his RPC methods to do the work, but trying to factor out the "loader" part of the 0WifiLoader example to test that didn't work for me... The magic numbers (Hermes uses '2' and '4' from what I can gather) seem to have changed as well...
<br/>
<br/>
I'm still pretty new at this, and I'm only guessing at what the assembler code does - from your comment below, it looks as though that's nothing to do with the WiFi library (which is good to know)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Puyo wrote:</b></span></td> </tr> <tr> <td class="quote">You can use original wifi examples &amp; Hermes`s stuff together too.</td> </tr></table><span class="postbody">
<br/>
<br/>
Cool - I'll try that this evening :-)
<br/>
[/code]
<br/>
<br/>
Cheers
<br/>
   Simon</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#120907 - SpacedCowboy - Wed Mar 07, 2007 4:33 am</h4>
    <div class="postbody"><span class="postbody">So, thanks to Puyo suggesting I try the existing example programs, I've got the WiFi wifi_test_lib program running with a couple of threads in the background printing to the top screen, while the WiFi 'playwardriving' goes about its business on the bottom screen :-)
<br/>
<br/>
Some thoughts...
<br/>
<br/>
My test thread-funcs look like
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void threadFunc1(void *arg)
<br/>
   {
<br/>
   int count = 0;
<br/>
   char buf[128];
<br/>
   
<br/>
   while (1)
<br/>
      {
<br/>
      sprintf(buf, "Thread 1: %d\n", count);
<br/>
      printtop(buf);
<br/>
      count ++;
<br/>
      Sleep_Timer_Thread(25);      // 1 second
<br/>
      }
<br/>
   }
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
(ie: they don't do very much). They didn't do anything at all when they were scheduled with:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   int status = Create_Thread(THREAD_PRIORITY_NORMAL,
<br/>
                        threadFunc1, NULL,
<br/>
                        thrStack1, 4096*4);
<br/>
   if (status == THD_ERROR)
<br/>
      printtop("Error creating thread\n");
<br/>
   else
<br/>
      {
<br/>
      char buf[128];
<br/>
      sprintf(buf, "Thread created: %d\n", status);
<br/>
      printtop(buf);
<br/>
      }
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
... Once I'd changed the THREAD_PRIORITY_NORMAL to THREAD_PRIORITY_HIGH, I got both (2 identical threads) threads doing their thing. Even then, though, you'll notice that the delay in the Sleep_Timer_Thread() call is set to 25. I started off with that being 1000 (because the docs say the delay is expressed in milliseconds). I realised the scale was wrong when I just left the program running on the DS for a while (about 40 seconds) - the second pass through the loop occured, and the count=2 line was printed.
<br/>
<br/>
Anyway, multitasking, have WiFi, I'm happy :-)
<br/>
<br/>
Simon</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
