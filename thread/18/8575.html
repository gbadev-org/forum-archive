<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>[Fixed]Strange Behaviour ...HELP - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > [Fixed]Strange Behaviour ...HELP</h2>
<div id="posts">
<div class="post">
    <h4>#71755 - ishraam - Tue Feb 14, 2006 7:15 am</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
I've just had a strange problem : my app crashes because of a SEG FAULT caused by a "for(...)" whose max limit has been changed by... the hardware I guess (not me anyway!).
<br/>
<br/>
Just have a look at this (IT USES GBFS): 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void Mesh::LoadFromFile()
<br/>
{
<br/>
[...]
<br/>
for( uint32 curVert = 0; curVert &lt; this-&gt;numVertices; curVert ++)
<br/>
   { 
<br/>
      readstr(oneline); 
<br/>
      sscanf(oneline, "%f %f %f %f %f", &amp;x, &amp;y, &amp;z, &amp;u, &amp;v);
<br/>
      
<br/>
      iprintf(" d/%d)",curVert+1,numVertices); 
<br/>
      vertices[curVert].position   = AL_Vector3(x,y,z);       
<br/>
      vertices[curVert].tex      = AL_TexCoord(u,v);     
<br/>
      vertices[curVert].normal   = AL_Vector3(0.f,1.f,0.f);
<br/>
   } 
<br/>
 
<br/>
       return;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
When curVert is equal to this-&gt;numVertices, this-&gt;numVertices value get totally f**ed up. And of course &gt; seg fault.
<br/>
<br/>
I noticed that with enough "iprintf(...);" in this function, there's no problem anymore.
<br/>
So I thought "damn do I need a volatile or what ?". So I tried, but no difference.
<br/>
<br/>
Do you have any idea of what's the problem ???
<br/>
<br/>
EDIT :
<br/>
<br/>
I've played some more with the code. 
<br/>
Declaring "numVertices" as an int instead of a uint32 had no effect.
<br/>
<br/>
BUT, after having removed all of the "iprintf(...)" that were close to GL functions, the problem disappeared. 
<br/>
When I say "close to GL functions", I mean any other member function like a DrawNormals() that would have a simple 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">"iprintf("yo");" </td> </tr></table><span class="postbody">
<br/>
would cause the same error (in the same LoadFromFile() function!!)...
<br/>
<br/>
Event though the problem is "gone", I still cannot understand all this.
<br/>
And I definitely wanna understand, so here again :
<br/>
<br/>
Do you have any idea of what's the problem ???
<br/>
<br/>
EDIT ..AGAIN:
<br/>
<br/>
Daaamn!
<br/>
<br/>
I can't even add a member function to load a texture. It causes the same problem (and without any "iprintf(...)" around &gt; so I guess that's not related) : the member variable "numVertices" of my "Mesh" class gets changed during the loop.
<br/>
<br/>
That's driving me crazy!</span><span class="gensmall"><br/><br/>Last edited by ishraam on Wed Feb 15, 2006 8:48 am; edited 2 times in total</span></div>    
</div>
<div class="post">
    <h4>#71800 - ishraam - Tue Feb 14, 2006 4:19 pm</h4>
    <div class="postbody"><span class="postbody">Just to make things clear and short : The problem is still there.
<br/>
<br/>
If anyone has an idea as of why the value of this member variable "numVertices" gets changed, I'd be glad to hear(read) it ^_^.
<br/>
<br/>
I don't know if this might be related to GBFS, but it's the only piece of code where I'm using it.
<br/>
<br/>
If you have a little time, here is the whole  project.
<br/>
[url]
<br/>
<a href="http://alexandre.trog.free.fr/DS_workspace/AL_Project.zip" target="_blank">http://alexandre.trog.free.fr/DS_workspace/AL_Project.zip</a>
<br/>
[/url]
<br/>
<br/>
It's in : <span style="font-weight: bold">AL_Mesh.cpp</span>, func: <span style="font-style: italic">AL_Mesh::LoadFromFile(const char *)</span>
<br/>
<br/>
Note that it runs better on <span style="font-weight: bold">real hardware</span>.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#71868 - duencil - Wed Feb 15, 2006 12:29 am</h4>
    <div class="postbody"><span class="postbody">You might need to add range checking to your readstr function to prevent buffer overflows.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#71890 - HyperHacker - Wed Feb 15, 2006 4:22 am</h4>
    <div class="postbody"><span class="postbody">Yep, usually when you get weirdness like certain functions messing up unrelated things, it's caused by memory corruption.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#71913 - ishraam - Wed Feb 15, 2006 8:45 am</h4>
    <div class="postbody"><span class="postbody">I just checked a few things, (and implemented my file classes btw).
<br/>
<br/>
You were right : it looks like I modified the World.txt (provided in libnds examples) without noticing. So the number of  polys were wrong, the app tried to grab junk data, hence the memory corruption.
<br/>
<br/>
<br/>
<span style="font-weight: bold">Thank you</span> for your time, and help : I really appreciate it ^_^.
<br/>
I'm sorry to have bother you for something this stupid.
<br/>
<br/>
For some reason I was kinda persuaded that it was related to something specific to the NDS...
<br/>
<br/>
(I'd better stop coding past 4 am ... Looks like my mind is totally fucked up at that time of the day -_-)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
