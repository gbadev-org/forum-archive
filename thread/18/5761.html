<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Won't read touchscreen - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > Won't read touchscreen</h2>
<div id="posts">
<div class="post">
    <h4>#43086 - ANeo7782 - Wed May 18, 2005 11:18 pm</h4>
    <div class="postbody"><span class="postbody">I wrote a bit of code based on a couple other programs, and I absolutely cannot get my program to read touchscreen input. It absolutely loves to think there's input throughout the whole run, but it doesn't give me any valid values.
<br/>
<br/>
I'm using
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">if (((~IPC-&gt;buttons) &lt;&lt; 6) &amp; (1&lt;&lt;12)) {
<br/>
  x = ((IPC-&gt;touchX - 0x0113) / 14) &lt;&lt; 8;
<br/>
  y = ((IPC-&gt;touchY - 0x00E0) / 19) &lt;&lt; 8;
<br/>
}</td> </tr></table><span class="postbody">
<br/>
in a while loop and trying to go from there.<br/>_________________<br/>AndrewNeo - <span style="font-style: italic">Username disallowed.</span>
<br/>
<a class="postlink" href="http://dsdev.neocodenetworks.com" target="_blank">NCN DSDev Team Leader</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#43098 - josath - Thu May 19, 2005 1:40 am</h4>
    <div class="postbody"><span class="postbody">If you are basing your code of the newer ndslib, and you use the template arm7 binary, you can call IPC-&gt;touchXpx and IPC-&gt;touchYpx to get actual x &amp; y coordinates. If not, here is the touch calibration code:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
//////////////////////////////////////////////////////////////////////
<br/>
<br/>
<br/>
#define TOUCH_CAL_X1 (*(vs16*)0x027FFCD8)
<br/>
#define TOUCH_CAL_Y1 (*(vs16*)0x027FFCDA)
<br/>
#define TOUCH_CAL_X2 (*(vs16*)0x027FFCDE)
<br/>
#define TOUCH_CAL_Y2 (*(vs16*)0x027FFCE0)
<br/>
#define SCREEN_WIDTH    256
<br/>
#define SCREEN_HEIGHT   192
<br/>
s32 TOUCH_WIDTH  = TOUCH_CAL_X2 - TOUCH_CAL_X1;
<br/>
s32 TOUCH_HEIGHT = TOUCH_CAL_Y2 - TOUCH_CAL_Y1;
<br/>
s32 TOUCH_OFFSET_X = ( ((SCREEN_WIDTH -60) * TOUCH_CAL_X1) / TOUCH_WIDTH  ) - 28;
<br/>
s32 TOUCH_OFFSET_Y = ( ((SCREEN_HEIGHT-60) * TOUCH_CAL_Y1) / TOUCH_HEIGHT ) - 28;
<br/>
<br/>
<br/>
//////////////////////////////////////////////////////////////////////
<br/>
<br/>
    if (!(IPC-&gt;buttons &amp; 0x40)) { // pen is down
<br/>
      x = IPC-&gt;touchX;
<br/>
      y = IPC-&gt;touchY;
<br/>
      xpx = ( ((SCREEN_WIDTH -60) * x) / TOUCH_WIDTH  ) - TOUCH_OFFSET_X;
<br/>
      ypx = ( ((SCREEN_HEIGHT-60) * y) / TOUCH_HEIGHT ) - TOUCH_OFFSET_Y;
<br/>
    }
<br/>
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#43103 - Darkain - Thu May 19, 2005 3:10 am</h4>
    <div class="postbody"><span class="postbody">actually, to 1-up all of you... just get latest NDSLIB, and use IPC-touchXpx/Ypx... these are the pre-calculated pixel values.  plus, once we come up w/ a better algorithm for calculating pixel values, the most you would have to do to your code is recompile.  no other modifications would be needed.
<br/>
<br/>
nice n easy, eh?  ;)<br/>_________________<br/>-=- Darkain Dragoon -=-
<br/>
<a class="postlink" href="http://www.darkain.com" target="_blank">http://www.darkain.com</a>
<br/>
<a class="postlink" href="http://ds.darkain.com/hack" target="_blank">DarkStar</a> for <a class="postlink" href="http://ds.darkain.com" target="_blank">Nintendo DS</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#43107 - tepples - Thu May 19, 2005 5:38 am</h4>
    <div class="postbody"><span class="postbody">Does latest NDSLIB have a flag for when the coordinates have stabilized (as opposed to the widely-complained-about random lines in dspaint)?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#43162 - ANeo7782 - Thu May 19, 2005 6:47 pm</h4>
    <div class="postbody"><span class="postbody">I am using the very newest ndslib from CVS, and when I try to use touchX and touchY I get weird values, and touchXpx and touchYpx get 0 for both. Also, the ((~IPC-&gt;buttons) &lt;&lt; 6) &amp; (1&lt;&lt;12) code constantly returns true, even if I'm not touching the screen. I've only been able to test on an emulator (usually dualis) so far, but it's not registering nada when I click on the bottom (and touch works with other demos).
<br/>
<br/>
To me, it's almost like it's not processing the ARM7 code (I've been executing the ARM9/arm9.bin file, is that right?) because I couldn't get the RTC to return values either (though I may have just been doing that wrong.)<br/>_________________<br/>AndrewNeo - <span style="font-style: italic">Username disallowed.</span>
<br/>
<a class="postlink" href="http://dsdev.neocodenetworks.com" target="_blank">NCN DSDev Team Leader</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#43164 - tepples - Thu May 19, 2005 7:03 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ANeo7782 wrote:</b></span></td> </tr> <tr> <td class="quote">Also, the ((~IPC-&gt;buttons) &lt;&lt; 6) &amp; (1&lt;&lt;12) code constantly returns true, even if I'm not touching the screen. I've only been able to test on an emulator (usually dualis) so far [...] To me, it's almost like it's not processing the ARM7 code</td> </tr></table><span class="postbody">
<br/>
Dualis emulates the ARM9 and high-level-emulates the ARM7, which means that if the format of the IPC structure changes, Dualis won't notice and will continue to assume the old structure. Use iDeaS.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#43166 - ANeo7782 - Thu May 19, 2005 7:06 pm</h4>
    <div class="postbody"><span class="postbody">That'd be a good reason.. though I think with ideas I had trouble getting anything but the background to appear on the screen..<br/>_________________<br/>AndrewNeo - <span style="font-style: italic">Username disallowed.</span>
<br/>
<a class="postlink" href="http://dsdev.neocodenetworks.com" target="_blank">NCN DSDev Team Leader</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#43167 - dovoto - Thu May 19, 2005 7:35 pm</h4>
    <div class="postbody"><span class="postbody">Be sure and reinstall the startup files if you are using the newest cvs.  They were all out of synch for a few days causeing arm7 code to not exicute at all.<br/>_________________<br/><a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#43171 - Ethos - Thu May 19, 2005 7:57 pm</h4>
    <div class="postbody"><span class="postbody">Well I wouldn't use ideas with the newest CVS, it sorta crashes!! (or at least on my end)<br/>_________________<br/><a class="postlink" href="http://ethos.oddigytitanium.com" target="_blank">Ethos' Homepage (Demos/NDS 3D Tutorial)</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#43173 - ANeo7782 - Thu May 19, 2005 8:26 pm</h4>
    <div class="postbody"><span class="postbody">I'm using iDeaS 1.0.0.2, not from CVS. I'll download 1.0.0.4 and see if it makes a difference.
<br/>
<br/>
Edit: Okay, I can see top and bottom (it was probably an error in my code) but touchscreen still doesn't work..<br/>_________________<br/>AndrewNeo - <span style="font-style: italic">Username disallowed.</span>
<br/>
<a class="postlink" href="http://dsdev.neocodenetworks.com" target="_blank">NCN DSDev Team Leader</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
