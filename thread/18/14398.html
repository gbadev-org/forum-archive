<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>FAT PLAYER MOD - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > FAT PLAYER MOD</h2>
<div id="posts">
<div class="post">
    <h4>#143712 - Cid2Mizard - Thu Oct 25, 2007 3:22 pm</h4>
    <div class="postbody"><span class="postbody">I have a problem for create a FAT Player  .mod, when i opened my first .mod it's good but with the 2nd i have no sound and a bug.
<br/>
<br/>
When you touch the name of .mod, it's played... enjoy
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include &lt;PA9.h&gt;
<br/>
#include &lt;fat.h&gt;
<br/>
#include &lt;sys/dir.h&gt;
<br/>
#include &lt;stdio.h&gt;
<br/>
<br/>
#define MAX_FILENAME_LEN 256;
<br/>
void ManipFichier(int number);
<br/>
<br/>
char * buffer;
<br/>
<br/>
typedef struct{
<br/>
   char filename[100];
<br/>
   char name[100];
<br/>
   char ext[10];
<br/>
   u32 size;
<br/>
}  PAfiletype;
<br/>
PAfiletype files[50];
<br/>
<br/>
extern inline char PA_GetSmall(char letter){
<br/>
   if((letter &gt;= 'A')&amp;&amp;(letter &lt;= 'Z')) return (letter-'A'+'a');
<br/>
   return letter;
<br/>
}
<br/>
<br/>
s16 PA_FATSearchExt(DIR_ITER* dir, PAfiletype *filelist, char *ext){
<br/>
   s16 number = 0;
<br/>
   u8 i, j;
<br/>
   struct stat st;      
<br/>
      
<br/>
   while (dirnext(dir, filelist[number].filename, &amp;st) == 0) {
<br/>
      if(!(st.st_mode &amp; S_IFDIR)){
<br/>
<br/>
         i = 0;
<br/>
         while( filelist[number].filename[i]) i++;
<br/>
         while( filelist[number].filename[i-1] != '.') i--;
<br/>
         
<br/>
         u8 same = 1;
<br/>
         for(j = 0; ext[j]; j++) if(PA_GetSmall(ext[j]) !=  PA_GetSmall(filelist[number].filename[i+j])) same = 0; // not right extension
<br/>
         
<br/>
         if(same){
<br/>
         
<br/>
            for(j = 0; j &lt; i-1; j++) filelist[number].name[j] = filelist[number].filename[j];
<br/>
            filelist[number].name[j] = 0;
<br/>
            
<br/>
            for(i = 0; ext[i]; i++) filelist[number].ext[i] = ext[i];
<br/>
            filelist[number].ext[i] = 0;
<br/>
            
<br/>
            filelist[number].size = st.st_size;            
<br/>
            
<br/>
            number++;
<br/>
          }      
<br/>
      }   
<br/>
   }   
<br/>
   return number;
<br/>
}
<br/>
<br/>
void ManipFichier(int number)
<br/>
{
<br/>
   char * debut;
<br/>
   char * fin;
<br/>
   u32 modSize;
<br/>
   FILE * modFile;
<br/>
   strcpy(debut, "//mods//");
<br/>
   fin = files[number].filename;
<br/>
   strcat(debut, fin);
<br/>
<br/>
   PA_OutputText(1, 1, 4, "Nom : %s          ", files[number].filename);         
<br/>
         
<br/>
   modFile = fopen(debut, "rb");
<br/>
   fseek (modFile, 0 , SEEK_END);
<br/>
   modSize = ftell (modFile);
<br/>
   rewind (modFile);
<br/>
<br/>
   PA_OutputText(1, 1, 6, "Taille: %d          ", modSize);
<br/>
   PA_OutputText(1, 1, 12, "strcat: %s          ", debut);
<br/>
 
<br/>
   buffer = (char*) malloc (sizeof(char)*modSize);
<br/>
   PA_OutputSimpleText(1, 1, 8, "Copie mod au buffer");   
<br/>
<br/>
   fread (buffer,1,modSize,modFile);
<br/>
   fclose (modFile);
<br/>
<br/>
   PA_OutputSimpleText(1, 1, 10, "Complet Fichier Ferm?");
<br/>
<br/>
}
<br/>
<br/>
int main (void) {
<br/>
<br/>
   PA_Init();
<br/>
   PA_InitVBL();
<br/>
   PA_InitSound();
<br/>
<br/>
   PA_InitText(0, 0);
<br/>
   PA_InitText(1, 0);
<br/>
<br/>
   PA_WaitForVBL();
<br/>
<br/>
   fatInitDefault();
<br/>
<br/>
   s32 i;
<br/>
<br/>
   DIR_ITER* dir;
<br/>
   dir = diropen ("/Mods/");
<br/>
   u32 FileNumber = PA_FATSearchExt(dir, files, "mod");
<br/>
<br/>
   for (i = 0; i &lt; FileNumber; i++)  PA_OutputSimpleText(0, 0, 0 + i, files[i].filename);
<br/>
<br/>
   s16 nfile = 0;
<br/>
<br/>
   s32 k;
<br/>
   char filename[256] = "Mods/";
<br/>
   for(k = 0; k &lt; 200; k++) filename[k+5] = files[nfile].filename[k];
<br/>
   
<br/>
   u8 LectureEnCours=0;
<br/>
   
<br/>
   while(1)
<br/>
   {
<br/>
      if (Stylus.Newpress)
<br/>
      {
<br/>
         nfile = ((Stylus.Y)/8);
<br/>
         if(LectureEnCours==1)
<br/>
         {
<br/>
            PA_StopMod();
<br/>
            free(buffer);
<br/>
            LectureEnCours = 0;
<br/>
         }
<br/>
         
<br/>
         if (nfile &lt; 0) nfile = 0;
<br/>
         if (nfile &gt;= FileNumber-1) nfile = FileNumber-1;
<br/>
         PA_OutputText(1, 1, 2, "Numero :%d          ", nfile);
<br/>
                  
<br/>
         ManipFichier(nfile);
<br/>
         PA_OutputSimpleText(1, 1, 14, "Lecture du .mod");
<br/>
         PA_PlayMod(buffer); LectureEnCours = 1;         
<br/>
      }
<br/>
      
<br/>
      PA_WaitForVBL();
<br/>
   }
<br/>
      
<br/>
   return 0;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Where is my probl?me ?<br/>_________________<br/><a href="http://www.nintendomax.com" target="_blank">www.nintendomax.com</a> 100% Hack 0% Warez</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143783 - Cid2Mizard - Thu Oct 25, 2007 11:30 pm</h4>
    <div class="postbody"><span class="postbody">resolved and release on dev-fr.org<br/>_________________<br/><a href="http://www.nintendomax.com" target="_blank">www.nintendomax.com</a> 100% Hack 0% Warez</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
