<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>PRoblem using the TouchPad - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > PRoblem using the TouchPad</h2>
<div id="posts">
<div class="post">
    <h4>#63370 - dieudunet - Mon Dec 12, 2005 2:42 pm</h4>
    <div class="postbody"><span class="postbody">Hello guys,
<br/>
 I devellop a homebrew game with DevKitPro and i use the fonction TouchReadXY() to capture the x and y position of the touch pad on my DS
<br/>
<br/>
I do test with the Supercard SD and Superpass and i got near 30 pixel of errors
<br/>
<br/>
this means that when my stylus is on the bottom right corner, the position is 224,172
<br/>
<br/>
and on the upper left corner is 28, 20
<br/>
<br/>
i don't understand why ? i try lot of code download on the net and all do the same problem on my DS...
<br/>
<br/>
Do you know fromp where come the erros ? is it my DS that have a problem or in the libray LIBNDS the code don not word ???
<br/>
<br/>
I try to calibrate the screen but nothing change..
<br/>
<br/>
Please help , i going to be crazy</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63372 - Tobin - Mon Dec 12, 2005 3:15 pm</h4>
    <div class="postbody"><span class="postbody">This is a common problem, search the forum about this topic, but there is no real solution. The accuracy should be ok on the rest of the screen.
<br/>
<br/>
P.s.: Do you know Jean Dieudonne: Foundation of Modern Analysis?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63373 - dieudunet - Mon Dec 12, 2005 3:23 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Tobin wrote:</b></span></td> </tr> <tr> <td class="quote">This is a common problem, search the forum about this topic, but there is no real solution. The accuracy should be ok on the rest of the screen.
<br/>
<br/>
P.s.: Do you know Jean Dieudonne: Foundation of Modern Analysis?</td> </tr></table><span class="postbody">
<br/>
<br/>
Yeah i no him. it's a "Math?maticiens c?l?bres" :D
<br/>
<br/>
about touch pad, i don't find any good answer on the other topic. i copie lot of code to try diiferent way of capture for the Stylus but each time i got 30 pixels out....
<br/>
and near the center of the screen. the x,y are correct, and when i leave the center of the screen i beagin to lose precision
<br/>
<br/>
What is the origine of the problem.....
<br/>
<br/>
hellllllllpppppppppppppppp</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63375 - FloFri - Mon Dec 12, 2005 3:49 pm</h4>
    <div class="postbody"><span class="postbody">Do you use a screen protector? If yes remove it. The current code to access the touchscreen does not work correctly with a screen protector. I had the same problem.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63376 - dieudunet - Mon Dec 12, 2005 3:58 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>FloFri wrote:</b></span></td> </tr> <tr> <td class="quote">Do you use a screen protector? If yes remove it. The current code to access the touchscreen does not work correctly with a screen protector. I had the same problem.</td> </tr></table><span class="postbody">
<br/>
<br/>
i got one, i will try to remove it but i'm a surprise....it don't do anything on commercial game so why we got problem./.....</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63377 - Mollusk - Mon Dec 12, 2005 4:08 pm</h4>
    <div class="postbody"><span class="postbody">I'm surprised you didn't find any info doing a search... there are about 2 subjects like this each week, each ending up by 2 things :
<br/>
<br/>
1. The members telling you to remove the screen protector, because it works better without it
<br/>
<br/>
2. The guy who asked the question saying it does work better, but still not perfect, and adding that commercial games do not have that problem and that the touch code could be better...
<br/>
<br/>
It's a bit boring, I guess... why not put a sticky here ?<br/>_________________<br/>PAlib official forum : <a class="postlink" href="http://www.palib.info" target="_blank">http://www.palib.info</a>
<br/>
PAlib official tutorials: <a class="postlink" href="http://www.palib.info/wiki" target="_blank">http://www.palib.info/wiki</a>
<br/>
Updates, help, code examples, tutorials, etc...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63379 - dieudunet - Mon Dec 12, 2005 4:19 pm</h4>
    <div class="postbody"><span class="postbody">Nothing change,
<br/>
<br/>
i got 17 pixel lost , up down right and left
<br/>
<br/>
i do not understand why there is no answer
<br/>
<br/>
is that the hardware managing the Stylus so hard to code
<br/>
i will try to precise the code in ARM7 main program</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63380 - Mollusk - Mon Dec 12, 2005 4:22 pm</h4>
    <div class="postbody"><span class="postbody">It's that depending on the screen manufacturer (no idea how many there are !), the precisions are quite the same ! some codes produced perfect input on my DS and like 20 pixels off on others, some were the opposite...
<br/>
<br/>
The current code is the one that seems to work the best overall, meaning it's not as good for me, but much better for some people<br/>_________________<br/>PAlib official forum : <a class="postlink" href="http://www.palib.info" target="_blank">http://www.palib.info</a>
<br/>
PAlib official tutorials: <a class="postlink" href="http://www.palib.info/wiki" target="_blank">http://www.palib.info/wiki</a>
<br/>
Updates, help, code examples, tutorials, etc...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63381 - dieudunet - Mon Dec 12, 2005 4:30 pm</h4>
    <div class="postbody"><span class="postbody">i want to understand, i ,will not stop my quest of the perfect stylus until i found WHY commercial game works and not my code
<br/>
<br/>
i go now to work to nintendo office, i can 't sleep until i know
<br/>
<br/>
<br/>
see you soon
<br/>
<br/>
:D</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63398 - FloFri - Mon Dec 12, 2005 7:15 pm</h4>
    <div class="postbody"><span class="postbody">just do a rewrite of TouchReadXY , that would be enough to fix the problem ;) ;) ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63408 - tepples - Mon Dec 12, 2005 8:56 pm</h4>
    <div class="postbody"><span class="postbody">Has anybody tried to disassemble an official WMB demo's ARM7 binary to see exactly what it does with touch screen results?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63432 - wintermute - Tue Dec 13, 2005 2:02 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Has anybody tried to disassemble an official WMB demo's ARM7 binary to see exactly what it does with touch screen results?</td> </tr></table><span class="postbody">
<br/>
<br/>
yes, the answer is, not a lot really. The raw touch screen values are sent back to the arm9</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63548 - natrium42 - Wed Dec 14, 2005 4:44 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Has anybody tried to disassemble an official WMB demo's ARM7 binary to see exactly what it does with touch screen results?</td> </tr></table><span class="postbody">
<br/>
<br/>
yes, the answer is, not a lot really. The raw touch screen values are sent back to the arm9</span></td> </tr></table><span class="postbody">
<br/>
WntrMute, I see that you added neimod's modification for touchscreen code to libnds. There is a small typo for yoffset calculation, though.
<br/>
<br/>
dieudunet, here is a test binary with the new code: <a href="http://www.natrium42.com/downloads/TouchTest.nds" target="_blank">http://www.natrium42.com/downloads/TouchTest.nds</a><br/>_________________<br/><a class="postlink" href="http://www.natrium42.com" target="_blank">www.natrium42.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63581 - dieudunet - Wed Dec 14, 2005 2:57 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>natrium42 wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Has anybody tried to disassemble an official WMB demo's ARM7 binary to see exactly what it does with touch screen results?</td> </tr></table><span class="postbody">
<br/>
<br/>
yes, the answer is, not a lot really. The raw touch screen values are sent back to the arm9</span></td> </tr></table><span class="postbody">
<br/>
WntrMute, I see that you added neimod's modification for touchscreen code to libnds. There is a small typo for yoffset calculation, though.
<br/>
<br/>
dieudunet, here is a test binary with the new code: <a href="http://www.natrium42.com/downloads/TouchTest.nds" target="_blank">http://www.natrium42.com/downloads/TouchTest.nds</a></span></td> </tr></table><span class="postbody">
<br/>
<br/>
Thanks a lot guy, i will test it now :D</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63601 - tepples - Wed Dec 14, 2005 11:37 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Has anybody tried to disassemble an official WMB demo's ARM7 binary to see exactly what it does with touch screen results?</td> </tr></table><span class="postbody">
<br/>
The raw touch screen values are sent back to the arm9</span></td> </tr></table><span class="postbody">
<br/>
OK, has anybody tried to disassemble those parts of an official demo's ARM9 binary that deal with the touch screen?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63624 - SeanMon - Thu Dec 15, 2005 2:54 am</h4>
    <div class="postbody"><span class="postbody">The DS might store the calibration data in memory, and commercial games have access to this, but the homebrew community doesn't know where it is yet.
<br/>
<br/>
Possible?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63625 - Sintax - Thu Dec 15, 2005 2:59 am</h4>
    <div class="postbody"><span class="postbody">Most likely I'd say the code we use is simply not exactly right. I tried the new touchscreen demo posted and it works a lot better than the code from before. The outsides of the touchscreen register well, but there is still a pull when there is a light touch, although now it is towards the center of the screen as opposed to the bottom left, like before.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63693 - YopYop - Thu Dec 15, 2005 4:49 pm</h4>
    <div class="postbody"><span class="postbody">Hi, 
<br/>
<br/>
Can you test this demo <a href="http://yopyop156.ifrance.com/TouchTest3.nds" target="_blank">http://yopyop156.ifrance.com/TouchTest3.nds</a> on your DS?
<br/>
<br/>
Thanks 
<br/>
<br/>
yopyop
<br/>
<br/>
edit a little change.</span><span class="gensmall"><br/><br/>Last edited by YopYop on Thu Dec 15, 2005 10:06 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#63696 - Jasper_M - Thu Dec 15, 2005 5:13 pm</h4>
    <div class="postbody"><span class="postbody">YopYop: YOur code doesn't work.
<br/>
<br/>
However, I have a solution that works 100% (!) on my ds. Here's part of the code from my WIP Minesweeper, adapt it to suit your needs....:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   touchPosition touchxy;//EDIT:ADDED AFTERWARDS
<br/>
            bool wasClick = false;
<br/>
         do{
<br/>
            touchxy = touchReadXY();
<br/>
            u32 pressure;
<br/>
            pressure =    IPC-&gt;touchZ2 *touchxy.x;
<br/>
            pressure /=    IPC-&gt;touchZ1;
<br/>
            pressure -=touchxy.x;
<br/>
            if(touchxy.y&gt;48 &amp;&amp; touchxy.x&lt;144)
<br/>
               pressure+=0x70;
<br/>
            if(touchxy.y&gt;16 &amp;&amp; touchxy.x&lt;176)
<br/>
               pressure+=0x200;
<br/>
               
<br/>
         if(pressure&lt;0x0D00 &amp;&amp; touchxy.x!=0 &amp;&amp;touchxy.y !=0 &amp;&amp;IPC-&gt;touchZ2&gt;10){   
<br/>
            wasClick=true;
<br/>
            tilex = touchxy.px;
<br/>
            tiley = touchxy.py; 
<br/>
         }
<br/>
            specialKeys = ~IPC-&gt;buttons;
<br/>
         }
<br/>
         while(specialKeys &amp; (1&lt;&lt;6));
<br/>
         if(wasClick)
<br/>
                            //VALID CLICK HERE,COORDS ROCK DO SOMETHING
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
I may post the test code if someone is willing to host it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63723 - duencil - Thu Dec 15, 2005 9:07 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>natrium42 wrote:</b></span></td> </tr> <tr> <td class="quote">WntrMute, I see that you added neimod's modification for touchscreen code to libnds. There is a small typo for yoffset calculation, though.</td> </tr></table><span class="postbody">
<br/>
The yoffset calculation looks okay.. What were you referring to? The only typo I saw was in the clipping, where
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">if ( py &gt; (SCREEN_HEIGHT -1)) px = SCREEN_HEIGHT -1;</td> </tr></table><span class="postbody">
<br/>
in touch.c should of course be changing py.  Was that it?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63726 - natrium42 - Thu Dec 15, 2005 9:24 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>duencil wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
The yoffset calculation looks okay.. What were you referring to?</td> </tr></table><span class="postbody">
<br/>
I was referring to this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">xoffset = ((PersonalData-&gt;calX1 + PersonalData-&gt;calX2) * xscale  - ((PersonalData-&gt;calX1px + PersonalData-&gt;calX2px) &lt;&lt; 19) ) / 2;
<br/>
yoffset = ((PersonalData-&gt;calY1 + PersonalData-&gt;calY2) * xscale  - ((PersonalData-&gt;calY1px + PersonalData-&gt;calY2px) &lt;&lt; 19) ) / 2;</td> </tr></table><span class="postbody">
<br/>
It should be yscale and not xscale for yoffset calculation.<br/>_________________<br/><a class="postlink" href="http://www.natrium42.com" target="_blank">www.natrium42.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63737 - duencil - Fri Dec 16, 2005 12:16 am</h4>
    <div class="postbody"><span class="postbody">Oh right, thanks natrium42 for clarifying that. I didn't have the latest cvs.  After making those modifications my touch readings continue to be way off, but I think the problem could be in the touchRead() function rather than touchReadXY().  Whether looking at the raw touch position values or the converted pixel position values, I see a great variation in X when I just move the stylus vertically from the top to the bottom of the screen.
<br/>
<br/>
Unless we need to consider the centre position that we mark when callibrating - could this be being stored in the personal data (maybe in the 4 reserved bytes before the calibration information we have now). It seems likely that the centre is needed for _something_ given that you have to mark it. And storing the centre along with 2 diagonal callibration points would be enough info for an app to work out how to compensate for a per row delta in x, or a per column delta in y.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63738 - duencil - Fri Dec 16, 2005 12:26 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>duencil wrote:</b></span></td> </tr> <tr> <td class="quote">could this be being stored in the personal data (maybe in the 4 reserved bytes before the calibration information we have now)</td> </tr></table><span class="postbody">
<br/>
<br/>
I just checked out those bytes, but they seem to be set to zero.  I don't see any other likely candidate for the information.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
