<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>FIFO[SOLVED] - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > FIFO[SOLVED]</h2>
<div id="posts">
<div class="post">
    <h4>#133215 - yellowstar - Wed Jul 04, 2007 4:01 am</h4>
    <div class="postbody"><span class="postbody">I need some help with FIFO.
<br/>
<br/>
The way I am doing it dosen't work.
<br/>
<br/>
I am trying to send messages to and from the ARM7 and ARM9,
<br/>
and vice versa.
<br/>
<br/>
I quit using pointers,
<br/>
and the other way I was doing it.
<br/>
<br/>
Now I am doing it a different way.
<br/>
<br/>
I am using FIFO normally.
<br/>
That is, the FIFO items are
<br/>
structs containg the data.(The structs are 4 bytes long.)
<br/>
<br/>
Note:
<br/>
arm7.cpp is basicly the arm7 template code,
<br/>
with the FIFO code added.
<br/>
FIFO7.h and 9 don't have anything in them,
<br/>
I just didn't remove them.
<br/>
shared.h includes another header,
<br/>
which includes FIFO.h.
<br/>
<br/>
*Source code removed*</span><span class="gensmall"><br/><br/>Last edited by yellowstar on Fri Nov 09, 2007 8:36 pm; edited 5 times in total</span></div>    
</div>
<div class="post">
    <h4>#133247 - masscat - Wed Jul 04, 2007 4:47 pm</h4>
    <div class="postbody"><span class="postbody">One thing you cannot do is allocate memory on one ARM and free it on the other ARM. The run-times of the two ARMs are completely independent, that is, memory allocated using malloc will only be known to the run-time of the ARM that made the call.
<br/>
Mallocs on the ARM7 are (using the default linking) allocated out of the ARM7's private memory (03800000h) and this cannot be addressed by the ARM9.
<br/>
If you want to share data between the ARMs it must be in an area of memory addressable by both ARMs (or use some other mechanism like passing the data through the fifo). You will also have to implement your own memory management (not using malloc/free).
<br/>
<br/>
DC_FlushAll() does not exist for the ARM7 because the ARM7 does not have a cache. To avoid the ARM9 cache place data in the non-cached main memory mirror (02400000-027FFFFF). This will slow down the ARM9's access to the data but is much simpler than handling the cache for shared data.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#133256 - yellowstar - Wed Jul 04, 2007 8:45 pm</h4>
    <div class="postbody"><span class="postbody">I tried removing the calls to free,
<br/>
but that didn't work.
<br/>
<br/>
I am now trying a differen't method,
<br/>
but it dosen't work.
<br/>
<br/>
Now, the FIFO items don't contain anything.
<br/>
Instead, the actual messages are stored in arrays.
<br/>
These arrays are stored in shared memory.
<br/>
When a processor receives a command from the FIFO,
<br/>
it processes it.(see below)
<br/>
When a command is processed, it uses
<br/>
the first command in the array for its processor,
<br/>
then it moves all the commands in the list forward.
<br/>
<br/>
When a command is sent,
<br/>
it adds a command to the end of the array for the other
<br/>
processor. It then puts the command's data in it.
<br/>
Then it writes to the FIFO send register to send a
<br/>
FIFO item to the other processor.
<br/>
<br/>
The new source is in my first post.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#134617 - yellowstar - Sat Jul 14, 2007 9:11 pm</h4>
    <div class="postbody"><span class="postbody">I quit using pointers,
<br/>
and the other way I was doing it.
<br/>
<br/>
Now I am doing it a different way.
<br/>
<br/>
I am using FIFO normally.
<br/>
That is, the FIFO items are
<br/>
structs containg the data.(The structs are 4 bytes long.)
<br/>
<br/>
But it still won't work.
<br/>
(The ARM9 is supposed to print the
<br/>
data when a FIFO item is recieved,
<br/>
but it won't work.)
<br/>
<br/>
See my first post for source code.
<br/>
<br/>
Is there any other FIFO tutorials,
<br/>
other than <a class="postlink" href="http://www.double.co.nz/nintendo_ds/nds_develop7.html" target="_blank">this</a> one?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144894 - yellowstar - Thu Nov 08, 2007 11:55 pm</h4>
    <div class="postbody"><span class="postbody">Anybody?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144917 - gmiller - Fri Nov 09, 2007 5:15 am</h4>
    <div class="postbody"><span class="postbody">Not sure if this will help or is even correct ... but
<br/>
<br/>
Since the region you are using is in shared memory it is not the heap on either machine nor is the heap on either available to the other.  If you organize the shared memory into a circular buffer with the information describing the buffer also in shared memory then you might be able to get this working.  You should not use new/delete or malloc/free for any of this because they only work in the heap.
<br/>
<br/>
Of course I have not done this on the DS but I have done it in shared memory machines other than the DS</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144950 - yellowstar - Fri Nov 09, 2007 7:38 pm</h4>
    <div class="postbody"><span class="postbody">I'm not using shared memory for this anymore.
<br/>
<br/>
Instead, I'm only using the FIFO normally.
<br/>
That is, the FIFO messages are 4-byte structs.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144958 - yellowstar - Fri Nov 09, 2007 8:35 pm</h4>
    <div class="postbody"><span class="postbody">I have solved it.
<br/>
<br/>
It was caused by a mistake in my code.
<br/>
<br/>
For recieving,
<br/>
there are lines which have this:
<br/>
if(REC_ERROR!=0)
<br/>
<br/>
In the recieving function,
<br/>
before doing anything,
<br/>
it would set it to zero.
<br/>
Then, for errors,
<br/>
it set it to one.
<br/>
<br/>
This means it would only continue
<br/>
on errors.(no messages)
<br/>
<br/>
I fixed it,
<br/>
and it workes.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145003 - TwentySeven - Sat Nov 10, 2007 10:24 am</h4>
    <div class="postbody"><span class="postbody">I mean no insult, but your posts always remind me of haikus.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
