<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Problems with image8to16() in a Loading Texture function - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Problems with image8to16() in a Loading Texture function</h2>
<div id="posts">
<div class="post">
    <h4>#157622 - sUPREz - Tue May 27, 2008 10:24 am</h4>
    <div class="postbody"><span class="postbody">Hi everyone. This is my first post. I'm new in DS dev. 
<br/>
I try to make a small game with a 3D ortho GUI. 
<br/>
I need to load several texture and I try to create a function that load a list of texture. Here is my code :
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">typedef struct tagTEXTURE
<br/>
{
<br/>
   char* name;
<br/>
   GL_TEXTURE_SIZE_ENUM size_x, size_y;
<br/>
   float x_reel, y_reel;
<br/>
} TEXTURE;
<br/>
<br/>
const int numtexture = 3;
<br/>
TEXTURE* textures_list;
<br/>
<br/>
void InitTextures()
<br/>
{
<br/>
   textures_list = (TEXTURE*)malloc(numtexture*sizeof(TEXTURE));
<br/>
<br/>
   textures_list[0].name = "Button00_pcx";
<br/>
   textures_list[0].size_x = TEXTURE_SIZE_128;
<br/>
   textures_list[0].size_y = TEXTURE_SIZE_64;
<br/>
   //.75 means that my texture only use 96px of the 128px
<br/>
   textures_list[0].x_reel = 0.75;
<br/>
   //.75 means that my texture only use 48px of the 64px
<br/>
   textures_list[0].y_reel = 0.75;
<br/>
<br/>
   
<br/>
   
<br/>
   textures_list[1].name = "Button01_pcx";
<br/>
   textures_list[1].size_x = TEXTURE_SIZE_64;
<br/>
   textures_list[1].size_y = TEXTURE_SIZE_64;
<br/>
   textures_list[1].x_reel = 0.75;
<br/>
   textures_list[1].y_reel = 0.75;
<br/>
<br/>
   textures_list[2].name = "Button02_pcx";
<br/>
   textures_list[2].size_x = TEXTURE_SIZE_64;
<br/>
   textures_list[2].size_y = TEXTURE_SIZE_64;
<br/>
   textures_list[2].x_reel = 0.75;
<br/>
   textures_list[2].y_reel = 0.75;
<br/>
}
<br/>
<br/>
int LoadGLTextures()                           // Load PCX files And Convert To Textures
<br/>
{
<br/>
   InitTextures();
<br/>
   int i;
<br/>
   sImage pcx;
<br/>
<br/>
   for(i=0;i&lt;numtexture;i++)
<br/>
   {
<br/>
<br/>
      loadPCX((u8*)textures_list[i].name, &amp;pcx);
<br/>
      image8to16(&amp;pcx);
<br/>
      glGenTextures(1, &amp;texture[i]);
<br/>
      glBindTexture(0, texture[i]);
<br/>
      glTexImage2D(0, 0, GL_RGB, textures_list[i].size_x , textures_list[i].size_y, 0, TEXGEN_TEXCOORD, pcx.image.data8);
<br/>
      imageDestroy(&amp;pcx);
<br/>
   }
<br/>
   return TRUE;
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
Everything works fine except the image8to16() function that make my ROM crash. I got "The rom-image has crashed" error message from no$GBA.
<br/>
If I remove this line the program is running without problems but my textures are not loaded.
<br/>
Can you give some help so I can't figure out where I'm wrong ? Thanks a lot.
<br/>
<br/>
EDIT : just a few word to say that I'm not using PA_lib.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157624 - TwentySeven - Tue May 27, 2008 11:09 am</h4>
    <div class="postbody"><span class="postbody">Are you sure your file system is working?
<br/>
Are you sure loadPCX is working?
<br/>
<br/>
Have you checked whats in &amp;pcx?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157625 - sUPREz - Tue May 27, 2008 11:20 am</h4>
    <div class="postbody"><span class="postbody">Yes this code is working if I'm loading my texture manually. Here is a previous working version of my code:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
loadPCX((u8*)Button00_pcx, &amp;pcx);
<br/>
   image8to16(&amp;pcx);
<br/>
   glGenTextures(1, &amp;texture[0]);
<br/>
   glBindTexture(0, texture[0]);
<br/>
   glTexImage2D(0, 0, GL_RGB, TEXTURE_SIZE_64 , TEXTURE_SIZE_64, 0, TEXGEN_TEXCOORD, pcx.image.data8);
<br/>
   imageDestroy(&amp;pcx);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Meanwhile, I don't check what is in &amp;pcx. I'll check this but as I don't have the debug version of no$gba, it's a little bit harder.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157627 - Maxxie - Tue May 27, 2008 11:40 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
 loadPCX((u8*)textures_list[i].name, &amp;pcx); 
<br/>
</td> </tr></table><span class="postbody">
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
<br/>
should be the one causing troubles.
<br/>
<br/>
loadPCX expects a pointer to the image (a memory location containing the file content) not a filename.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157631 - sUPREz - Tue May 27, 2008 1:13 pm</h4>
    <div class="postbody"><span class="postbody">Thanks !
<br/>
You're right!
<br/>
<br/>
I modified my structure :
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">typedef struct tagTEXTURE
<br/>
{
<br/>
   u8* name;
<br/>
   GL_TEXTURE_SIZE_ENUM size_x, size_y;
<br/>
   float x_reel, y_reel;
<br/>
} TEXTURE;</td> </tr></table><span class="postbody">
<br/>
<br/>
and  change my structure allocation :
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   textures_list[0].name = (u8*)Button00_pcx;
<br/>
   textures_list[0].size_x = TEXTURE_SIZE_128;
<br/>
   textures_list[0].size_y = TEXTURE_SIZE_64;
<br/>
   textures_list[0].x_reel = 0.75;
<br/>
   textures_list[0].y_reel = 0.75;</td> </tr></table><span class="postbody">
<br/>
<br/>
And it works. I now have some graphics issues but it's another problem I think :)
<br/>
<br/>
Thanks  Maxxie.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
