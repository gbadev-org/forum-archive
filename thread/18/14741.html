<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Touch Code no longer working? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > Touch Code no longer working?</h2>
<div id="posts">
<div class="post">
    <h4>#147885 - thegamefreak0134 - Sat Dec 29, 2007 9:52 pm</h4>
    <div class="postbody"><span class="postbody">I know this is probably an old question, so here goes.
<br/>
<br/>
I recently updated devkitPro from devkitARM r19 to r21. When I did so (including updating libnds) all of my touch code in all of my programs stopped working when I recompiled. I've looked at the values being returned by the code and it's particularly odd. Was the touch code modified severely between those revisions, or is there some newer function I should be using to get the stylus position now? What I get now looks like I'm getting raw reads where I should be getting pixel (screen position) reads, and garbage reads where I should be getting raw reads. The X value for raw instead of random garbage is instead constantly incrementing. The entire effect looks like the functions are now returning things in a different format than the header I am using expects them to be returning, which is odd since they were both updated at the same time. This scenario holds true with all of the examples in the devKitPro folders.
<br/>
<br/>
As a result of this, we (me and my friend) are using r19 for all of our coding, and simply updating the header files to the new version when we need some of the newer defines. This is going to make our source code highly non-portable, and it would make me happy if I could know what is going on with the touch code. I can post code examples if necessary, but the touch input test in the examples folder gives the best example of what is going on with our code. I think it may even be copied from there.
<br/>
<br/>
-thegamefreak<br/>_________________<br/>What if the hokey-pokey really is what it's all about?
<br/>
<br/>
[url=http:/www.darknovagames.com/index.php?action=recruit&amp;clanid=1]Support Zeta on DarkNova![/url]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#147896 - tepples - Sun Dec 30, 2007 2:09 am</h4>
    <div class="postbody"><span class="postbody">The format of the IPC struct changes with each version of libnds. Make sure that all of your project's .o files get deleted when you upgrade libnds. (Make won't automatically do this.) And if you're using a custom ARM7, try copying the VcountHandler() and main() functions from the template's ARM7 code (.../devkitPro/examples/nds/templates/combined/arm7/source/template.c) into your project's ARM7 code. It is my experience that the changes to the combined template's ARM7 code from version to version happen mostly in those two functions.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#147926 - wintermute - Sun Dec 30, 2007 6:03 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">The format of the IPC struct changes with each version of libnds. 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
And will eventually vanish. Avoid using the IPC struct at all.
<br/>
<br/>
You should be using touchReadXY to get touch screen co-ordinates.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#147930 - tepples - Sun Dec 30, 2007 6:28 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">You should be using touchReadXY to get touch screen co-ordinates.</td> </tr></table><span class="postbody">
<br/>
I just looked it up; it's in .../libnds/include/nds/arm9/input.h. Thanks for pointing it out. So if the IPC struct will disappear, I take it the ARM7 will pass the info to the ARM9 through the FIFO, right?
<br/>
<br/>
Semi-related: Why is KEY_TOUCH defined this way? It doesn't appear to match the hardware.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
  KEY_X      = BIT(10), //!&lt; Keypad X button.
<br/>
  KEY_Y      = BIT(11), //!&lt; Keypad Y button.
<br/>
  KEY_TOUCH  = BIT(12), //!&lt; Touchscreen pendown.
<br/>
  KEY_LID    = BIT(13)  //!&lt; Lid state.
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#147933 - wintermute - Sun Dec 30, 2007 6:38 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Semi-related: Why is KEY_TOUCH defined this way? It doesn't appear to match the hardware.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
How would you suggest "matching the hardware"?
<br/>
<br/>
We combined the key bits from arm7 and arm9 into a single 16bit value rather than having a 32bit value or treating them separately. Makes as much sense as any other way to do it.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#147934 - wintermute - Sun Dec 30, 2007 6:42 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>thegamefreak0134 wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
I recently updated devkitPro from devkitARM r19 to r21.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Is there any chance people could stop doing this?
<br/>
<br/>
devkitPro is the toolchain vendor, you don't upgrade it.
<br/>
<br/>
<br/>
Most of your problems will probably be solved by doing a clean rebuild of your project and the examples after upgrading devkitARM.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#147936 - tepples - Sun Dec 30, 2007 7:25 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">We combined the key bits from arm7 and arm9 into a single 16bit value rather than having a 32bit value or treating them separately. Makes as much sense as any other way to do it.</td> </tr></table><span class="postbody">
<br/>
I would have suggested the obvious extension to 32-bit, but this makes sense too. I'll take the naming issue to another topic.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#148085 - nce - Wed Jan 02, 2008 1:30 am</h4>
    <div class="postbody"><span class="postbody">I haven't read all the thread sorry if I say somthing stupid
<br/>
<br/>
It's probably something different but the result I had was quite the same when I switched from the R19 to the R20.
<br/>
<br/>
I had all the data in the touchscreen texture inverted. When I wanted to read from px py it was working on emulator but on real hardware I was forced to read x and y .... that was looking quite strange :)
<br/>
<br/>
I finally drop on a thread here speaking about a compiling problem and the prob was a conflict between visual studio 6 and devkitARM.... And yes there is a conflict !
<br/>
<br/>
If like me you have visual studio installed what I'm doing to compile nds code is to have a bat file that rename the VC98 folder from visual studio and launch the make comande so it will use the make from devkit and not from visual and the rename back my VC98 folder....
<br/>
<br/>
Hope it help to understand that sometimes errors can come from something realy hidden :)<br/>_________________<br/>-jerome-</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#148090 - wintermute - Wed Jan 02, 2008 2:41 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>nce wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<br/>
I finally drop on a thread here speaking about a compiling problem and the prob was a conflict between visual studio 6 and devkitARM.... And yes there is a conflict !
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
No there isn't.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
If like me you have visual studio installed what I'm doing to compile nds code is to have a bat file that rename the VC98 folder from visual studio and launch the make comande so it will use the make from devkit and not from visual and the rename back my VC98 folder....
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Visual Studio's "make" is actually called Nmake and isn't compatible with gnu make. If you have something called make in there then you've modified your installation or installed something else to the same location.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#148094 - thegamefreak0134 - Wed Jan 02, 2008 5:32 am</h4>
    <div class="postbody"><span class="postbody">I do apologize, wintermute, for the incorrect comment. I do know the difference, call it a typo.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">touchXY = touchReadXY();</td> </tr></table><span class="postbody">
<br/>
<br/>
That's the line we use, and that's the exact line that has issues. 
<br/>
<br/>
tepples, from what I can tell, doing a clean (which delete's the .o files) and then a make still produces the errors. I'll try copying the code though, but I need to get my hands on a fresh copy of r21 again, which I can't do until the 3rd. (I'm stuck on dial-up here.) I'll get back to you if I find a solution, but all that you suggest sounds very reasonable.
<br/>
<br/>
-gamefreak<br/>_________________<br/>What if the hokey-pokey really is what it's all about?
<br/>
<br/>
[url=http:/www.darknovagames.com/index.php?action=recruit&amp;clanid=1]Support Zeta on DarkNova![/url]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#148151 - nce - Thu Jan 03, 2008 1:05 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Visual Studio's "make" is actually called Nmake </td> </tr></table><span class="postbody">
<br/>
<br/>
Yes indeed, I'm not a pro in all compilation and link stuff, when it's working I'm happy when not I become crazy that's all LOL.
<br/>
<br/>
is maybe not the make but the link. What I do know ( and you are not forced to beleive me :) ) on 2 differents computers ( clean xp sp2 ) when I installed a fresh visual studio 6.0 and R20, that bug appears....
<br/>
<br/>
I know one day I should try visual studio 2005 and stop using this old 6.0 ....<br/>_________________<br/>-jerome-</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#148158 - M3d10n - Thu Jan 03, 2008 3:27 am</h4>
    <div class="postbody"><span class="postbody">VC++ 6.0? Good lord! 
<br/>
<br/>
I use VC++ Express 2005 for DS dev (using a makefile project which just calls "make") and had no problems with it. 
<br/>
<br/>
Actually, when you add the path to the libnds header files into the project's include paths you get magical intellisense auto-complete for all the libnds stuff.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
