<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>makefile and external library problems - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > makefile and external library problems</h2>
<div id="posts">
<div class="post">
    <h4>#145992 - ecaheti - Tue Nov 27, 2007 9:39 am</h4>
    <div class="postbody"><span class="postbody">Hi everyone!
<br/>
<br/>
Quick presentation of me and my project.
<br/>
I'm a student and i'm working on a project about driving a robot (Pekee, by Wanyrobotics) with a DS.
<br/>
<br/>
The developpement of the interfaces are quite advanced (thanks to PAlib) but I have problems with the communication between the DS and the robot. For it I have the full linux source code of a working program (compiling with a makefile).
<br/>
<br/>
When I only integrate the robot library
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include "lib-pekee/libRobot/WRobotPekee.h" //inclusion des librairies du robot</td> </tr></table><span class="postbody">
<br/>
no trouble happens.
<br/>
<br/>
But when I want to use the library, for exemple with the declaration of an object define in this
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">WRobotPekee pekee = WRobotPekee();   //D?claration d'un objet Pekee</td> </tr></table><span class="postbody">
<br/>
I get a compilation error, maybe a link error, I don't know exactly
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">d:/devkitPro/PA_Pekee/Main-boutons-cible-formes-spatiale/source/main.cpp:39: undefined reference to `WRobotPekee::WRobotPekee()'
<br/>
d:/devkitPro/PA_Pekee/Main-boutons-cible-formes-spatiale/source/main.cpp:183: undefined reference to `WRobotPekee::~WRobotPekee()'</td> </tr></table><span class="postbody">
<br/>
<br/>
Some people told me that I have to create a "static library (.a)" and integrate it into the makefile of the DS project, but I don't know how to create a static library (with devkitpro?) and how integrate it in a makefile.
<br/>
<br/>
here is the makefile of the DS project
<br/>
<a href="http://ftpbobby.free.fr/Temp/Makefile%20ds.txt" target="_blank">http://ftpbobby.free.fr/Temp/Makefile%20ds.txt</a>
<br/>
and here is the makefile of the linux project of the robot
<br/>
<a href="http://ftpbobby.free.fr/Temp/Makefile%20pekee.txt" target="_blank">http://ftpbobby.free.fr/Temp/Makefile%20pekee.txt</a>
<br/>
<br/>
The subject is complex, but I'm in trouble since 3 months! I can give you more details if needed.
<br/>
<br/>
Thank you by advance.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145995 - PypeBros - Tue Nov 27, 2007 10:38 am</h4>
    <div class="postbody"><span class="postbody">you create a static library with the "ar" tool .
<br/>
e.g. 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
libpppds.a: arm9/build/GuiEngine.o arm9/build/Wifindows.o arm9/build/exec.o arm9/build/happyhttp.o arm9/build/selfupdate.o arm9/build/wifidgets.o
<br/>
    $(AR) -r $@ $?
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
then you simply include the ".a" file in the list of libraries, e.g.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
LIBS   := $(DSROOT)/runme/libpppds.a -lnds9 -ldswifi9 -lfat
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/><a class="postlink" href="http://sylvainhb.blogspot.com/p/sprite-editor.html" target="_blank"> SEDS: Sprite Edition on DS</a> :: <a class="postlink" href="http://sylvainhb.blogspot.com/search/label/modplayer" target="_blank">modplayer</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146006 - ecaheti - Tue Nov 27, 2007 5:06 pm</h4>
    <div class="postbody"><span class="postbody">Is the "ar" tool able to generate code for the NDS or is it a general application?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146007 - kusma - Tue Nov 27, 2007 5:16 pm</h4>
    <div class="postbody"><span class="postbody">"ar" does not generate any code, it simply packages existing files together. AFAIK it's not concerned with what you put in the archive (it's a general tool), but devkitARM comes with an "arm-eabi-ar(.exe)" anyway that can be used for the purpose of making static libraries for the DS. Any other "ar"-tool you might have does not come from devkitARM.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146025 - tepples - Tue Nov 27, 2007 8:48 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>kusma wrote:</b></span></td> </tr> <tr> <td class="quote">"ar" does not generate any code, it simply packages existing files together.</td> </tr></table><span class="postbody">
<br/>
True; '<a class="postlink" href="http://www.gnu.org/software/binutils/manual/html_chapter/binutils_1.html" target="_blank">ar</a>' could be used like 'tar' if you want. You generate relocatable object code files (*.o) using 'gcc -c', and then you use 'ar' to toss them into a library. However, 'ar' does understand *.o well enough to generate a symbol index for them when you use the -s flag (which has the same effect as '<a class="postlink" href="http://unixhelp.ed.ac.uk/CGI/man-cgi?ranlib" target="_blank">ranlib</a>').<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146128 - ecaheti - Thu Nov 29, 2007 10:49 am</h4>
    <div class="postbody"><span class="postbody">ok 
<br/>
I will try stuffs with ar.
<br/>
<br/>
few questions :
<br/>
@kusma
<br/>
what is "AFAIK"
<br/>
<br/>
@all
<br/>
Is a good idea to replace every "CC" by "ar" in the makefile of the robot project?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146129 - Lick - Thu Nov 29, 2007 11:25 am</h4>
    <div class="postbody"><span class="postbody">What about:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">WRobotPekee pekee;
<br/>
<br/>
// or
<br/>
<br/>
WRobotPekee *pekee = new WRobotPekee();</td> </tr></table><span class="postbody">
<br/>
<br/>
And also, copy the Robot's CPP file to the current project and make sure that file is being compiled.
<br/>
If it's only two files, don't bother creating a static library.<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146134 - tepples - Thu Nov 29, 2007 1:42 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ecaheti wrote:</b></span></td> </tr> <tr> <td class="quote">few questions :
<br/>
@kusma
<br/>
what is "AFAIK"</td> </tr></table><span class="postbody">
<br/>
The first few <a class="postlink" href="http://www.google.com/search?q=afaik" target="_blank">Google results</a> should explain.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">@all
<br/>
Is a good idea to replace every "CC" by "ar" in the makefile of the robot project?</td> </tr></table><span class="postbody">
<br/>
No. You leave all the calls to $(CC) -c in there so that you get the .o files. Then you add a line that uses arm-eabi-ar to pack the desired .o files into a library.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146139 - ecaheti - Thu Nov 29, 2007 3:49 pm</h4>
    <div class="postbody"><span class="postbody">Ok I tried some stuff.
<br/>
<br/>
I tried to build "libpekee.a" with the makefile, but I couldn't. Here it is 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">libpekee.a: debug/main.o  debug/TCPClient.o  debug/WDevice.o  debug/WDriver.o  debug/WNetworkObjectTransport.o  debug/WRobot.o  debug/WRobotPekee.o  debug/WServiceDirectory.o
<br/>
   $(arm-eabi-ar) -r $@ $?
<br/>
</td> </tr></table><span class="postbody">
<br/>
All the .o files are created by the makefile.
<br/>
It didn't work.
<br/>
<br/>
So, I tried to make the library with the command 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">arm-eabi-ar -r libpekee.a main.o  TCPClient.o  WDevice.o  WDriver.o  WNetworkObjectTransport.o  WRobot.o  WRobotPekee.o  WServiceDirectory.o</td> </tr></table><span class="postbody">
<br/>
but it appeared that the "arm-eabi-ar" command is not know by my system (Ubuntu 6.10).
<br/>
<br/>
Back to Windows, and the command worked! At last I got my "libpekee.a".
<br/>
<br/>
as PypeBros said in the beginning of the discussion</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">then you simply include the ".a" file in the list of libraries, e.g.<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">LIBS   := $(DSROOT)/runme/libpppds.a -lnds9 -ldswifi9 -lfat</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
<br/>
I try this in the makefile of my DS project:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">LIBS   := $(INCLUDE)/plop/libpekee.a -lfat -lnds9 -ldswifi9</td> </tr></table><span class="postbody">
<br/>
<br/>
But the result is the same
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">d:/devkitPro/PA_Pekee/Main-boutons-cible-formes-spatiale/source/main.cpp:39: undefined reference to `WRobotPekee::WRobotPekee()'
<br/>
d:/devkitPro/PA_Pekee/Main-boutons-cible-formes-spatiale/source/main.cpp:186: undefined reference to `WRobotPekee::~WRobotPekee()'</td> </tr></table><span class="postbody">
<br/>
<br/>
@Lick
<br/>
I also tried your proposal, but it didn't work. I still got some "undefined reference to `WRobotPekee::WRobotPekee()' ".
<br/>
<br/>
Maybe there is a special place to define some special stuff?</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
