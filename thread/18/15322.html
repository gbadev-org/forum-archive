<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Can someone explain Fixed Point numbers and how to use them? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Can someone explain Fixed Point numbers and how to use them?</h2>
<div id="posts">
<div class="post">
    <h4>#153666 - TheMagnitude - Thu Apr 03, 2008 5:34 pm</h4>
    <div class="postbody"><span class="postbody">Ive read the wikipedia entry for fixed point numbers but I still don't understand how I would implement and use them in programming :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153672 - sniper - Thu Apr 03, 2008 7:45 pm</h4>
    <div class="postbody"><span class="postbody">Fixed Point is simply multiply the values and calculate with the bigger values to get a fraction part of the resulting values.
<br/>
<br/>
means:
<br/>
<br/>
X/Y --&gt; (X*100)/Y .. the result is 100 times bigger but has a fraction part.
<br/>
<br/>
X = 1, Y = 10 
<br/>
<br/>
1/10 = 0 (Integer)
<br/>
<br/>
(1*100)/10 = 10 (means 10/100 = 0.1 ) 
<br/>
<br/>
<br/>
For example if you want calculate:
<br/>
<br/>
X = X + 0.1, 1000 times.
<br/>
<br/>
with floating point you can do it like this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">    int i;
<br/>
    double x = 0.0;
<br/>
<br/>
    for( i=0; i&lt;1000; i++ )
<br/>
    {
<br/>
       x = x + 0.1;
<br/>
    }
<br/>
<br/>
    printf("x must be 100: %f", x);</td> </tr></table><span class="postbody">
<br/>
<br/>
with integer you cannot calulate this because 0.1 is 0.
<br/>
<br/>
<br/>
without floating point types you can multiply the value x and the adder by 100. Then you have to devide the result by 100 to get the real value.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">    int i;
<br/>
    int x = 0;
<br/>
<br/>
    for( i=0; i&lt;1000; i++ )
<br/>
    {
<br/>
       x = x + (1*100)/10;  // 1*100/10 = 0.1*100
<br/>
    }
<br/>
<br/>
    printf("x must be 100: %d", x/100);</td> </tr></table><span class="postbody">
<br/>
<br/>
And get the same result (100).
<br/>
<br/>
<br/>
For speedups (no multiplications/division) usually u use shift operators:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">    int i;
<br/>
    int x = 0;
<br/>
<br/>
    for( i=0; i&lt;1000; i++ )
<br/>
    {
<br/>
       x = x + (1&lt;&lt;12)/10; // 1*4096/10 = 0.1*4096
<br/>
    }
<br/>
<br/>
    printf("x must be 100: %d", x&gt;&gt;12);</td> </tr></table><span class="postbody">
<br/>
<br/>
But you see the result is 99 instead of 100, so it is not that accurate as double but acceptable.
<br/>
<br/>
<br/>
I hope it is understandable and helpful for you ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153675 - elhobbs - Thu Apr 03, 2008 8:48 pm</h4>
    <div class="postbody"><span class="postbody">you can use the macros provided with libnds. look in arm9\math.h and arm9\videogl.h use the f32 datatype. use normal +/- for addition and subtraction and the functions divf32 and mulf32 for division and multiplication respectively. There are even macro to convert from integer or float to f32 - inttof32 and floattof32.
<br/>
<br/>
good luck</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153676 - Dwedit - Thu Apr 03, 2008 8:51 pm</h4>
    <div class="postbody"><span class="postbody">Which compilers DON'T automatically convert multiplication by powers of 2 to shifts?<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153677 - sniper - Thu Apr 03, 2008 9:05 pm</h4>
    <div class="postbody"><span class="postbody">Some in case muls/divs has the same speed as shifts but then its not required ;P
<br/>
<br/>
C is only an example. If you code it in asm you have to take care about it of cause.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153700 - DensitY - Fri Apr 04, 2008 2:05 am</h4>
    <div class="postbody"><span class="postbody">Fixed point Math is a way todo floating point using integers
<br/>
<br/>
basically entire idea is to shift whole numbers up into the higher bit ranges of an integer and using the lower bits as a the fractional range
<br/>
<br/>
for example lets take a 16bit integer, and convert it to a 8.8 format
<br/>
<br/>
say converting a standard integer to fixed point integer
<br/>
Fp value = whole Number &lt;&lt; 8;
<br/>
<br/>
here we're shifting the whole number up 8 bits into the 16 bit integer, modifying the lower 8 bits your actually modifing the fractional of the whole number.
<br/>
to convert a floating point number its rather simple in this case
<br/>
fp value = floatpoint number * (1&lt;&lt;8)
<br/>
<br/>
its the same conditions in terms of changing it back. but in general you avoid floats on the DS if possible along with dividing.
<br/>
<br/>
ok now there is some rules to remember with fixed point, and thats basically what happens to a number if you multiply it by a fixed point value (and same if you multiply by fixed point) and also what do you need todo to add.
<br/>
<br/>
Multiply rules
<br/>
<br/>
1.Multiplying a Fixed point value by a standard integer results in a fixed point value. ie
<br/>
 fixed value = Fixed value * standard int value
<br/>
<br/>
2. multiplying 2 fixed point values together actually increases fractional side of the fixed point value by 2. For example
<br/>
<br/>
8.16 = 8.8 * 8.8
<br/>
<br/>
so todo this correctly you have todo this to chip off the extra 8 bits of fraction data we don't need.
<br/>
<br/>
8.8 = (8.8 * 8.8) &gt;&gt; 8
<br/>
<br/>
the same rules apply for division as well.
<br/>
<br/>
<br/>
Adding Rules. 
<br/>
<br/>
- Adding Fixed by a standard integer number will result in you just increasing the value by a faction instead of the intended whole number
<br/>
<br/>
ie 
<br/>
<br/>
incorrect fixed result = fixed number + whole number
<br/>
<br/>
so to ensure you increase it by the correct hole number range you have todo
<br/>
<br/>
fixed result = fixed number + (whole number &lt;&lt; 8)
<br/>
<br/>
<br/>
<span style="font-weight: bold">SOO...</span> how is this useful?
<br/>
<br/>
well libnds has a fixed point SIN and COS map (which you have to correct by 4 bits but you'll work that out), this means that we can move things around ie
<br/>
<br/>
fstepx = COS[ANGLE &amp; 0x1FF] &gt;&gt; 4;
<br/>
fstepy = SIN[ANGLE &amp; 0x1FF] &gt;&gt; 4;
<br/>
<br/>
then do
<br/>
Player x += fstepx;
<br/>
player y += fstepy;
<br/>
<br/>
todo "floating point" fractional movement without using floating point variables which are emulated and slow on the DS hardware. 
<br/>
<br/>
you can also do a string of abusive tricks, ie  a simple optimization back in the old PC days when division was painfully slow was todo something like
<br/>
<br/>
result = something * 0.5
<br/>
instead of 
<br/>
result = something / 2
<br/>
<br/>
on the DS you could do something like this in fixed point to simulate a divide by 2
<br/>
<br/>
result = (something * 128 ) &gt;&gt; 8
<br/>
<br/>
the 128 is actually 0.5 if 8.8 fixed point the result of 0.5 * (1&lt;&lt;8).
<br/>
<br/>
um, hopefully this is kind of helpful, I kind of just rambled this out.
<br/>
<br/>
- Dens</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153707 - HyperHacker - Fri Apr 04, 2008 5:41 am</h4>
    <div class="postbody"><span class="postbody">Sounds to me like fixed point just means using 1024ths instead of ones. E.g. 2 becomes 2048 because 2048/1024=2. Kinda along the lines of counting in cents instead of dollars.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153709 - DensitY - Fri Apr 04, 2008 6:48 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">Sounds to me like fixed point just means using 1024ths instead of ones. E.g. 2 becomes 2048 because 2048/1024=2. Kinda along the lines of counting in cents instead of dollars.</td> </tr></table><span class="postbody">
<br/>
<br/>
yeah, it depends on the format. with the DS you have a few formats
<br/>
<br/>
16.16
<br/>
8.8 (for BG layer coords)
<br/>
12.4
<br/>
1.12 
<br/>
24.8
<br/>
<br/>
etc 
<br/>
<br/>
depends on what you need and what the hardware accepts (you'll have to worry about that alot more if you start coding for the 3d hardware).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153771 - TheMagnitude - Sat Apr 05, 2008 10:34 pm</h4>
    <div class="postbody"><span class="postbody">Thanks guys that helped alot, instead of creating a new topic, does anyone know how to get random numbers with libnds?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153774 - silent_code - Sun Apr 06, 2008 1:09 am</h4>
    <div class="postbody"><span class="postbody">1) in your titlescreen do:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include &lt;stdlib.h&gt; // this is required for random numbers!
<br/>
...
<br/>
   uint8 r = 0;
<br/>
<br/>
   while((REG_KEYINPUT &amp; KEY_A) &amp;&amp; (REG_KEYINPUT &amp; KEY_START))
<br/>
   {
<br/>
      r++;
<br/>
      swiWaitForVBlank(); // enable vblank before using this!
<br/>
   }
<br/>
<br/>
   srand(r); //this will make sure that the random number generator will generate different numbers each time the title screen is left</td> </tr></table><span class="postbody">
<br/>
<br/>
2) on the nds, there is an rtc (realtime clock), that you can use:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   srand(IPC-&gt;time.rtc.seconds); // again, setup the rng, this time with the current second, although you can use anything from the rtc here (and add, multiply, modulo it etc)</td> </tr></table><span class="postbody">
<br/>
<br/>
the aforementioned will only work on hw, though. to test if rtc is working, here's some simple time output:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   iprintf("Current time: %2i:%2i.%2i", IPC-&gt;time.rtc.hours, IPC-&gt;time.rtc.minutes, IPC-&gt;time.rtc.seconds);</td> </tr></table><span class="postbody">
<br/>
<br/>
after setting up the rng either way, you can obtain a random integer value by using:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define randomi(seed) (rand() % seed)
<br/>
...
<br/>
   ...
<br/>
   uint32 rndNr = randomi(1000);</td> </tr></table><span class="postbody">
<br/>
<br/>
just an example. hope that's helpful! :^)
<br/>
<br/>
happy coding!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153803 - a128 - Sun Apr 06, 2008 6:55 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>TheMagnitude wrote:</b></span></td> </tr> <tr> <td class="quote">Thanks guys that helped alot, instead of creating a new topic, does anyone know how to get random numbers with libnds?</td> </tr></table><span class="postbody">
<br/>
<br/>
 Mersenne Twister is a good and fast random generator
<br/>
<br/>
<a class="postlink" href="http://www.math.sci.hiroshima-u.ac.jp/~m-mat/MT/emt.html" target="_blank">http://www.math.sci.hiroshima-u.ac.jp/~m-mat/MT/emt.html</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
