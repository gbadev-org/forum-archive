<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>DLDI for DS Link (SD) problem ** solved!! - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > DLDI for DS Link (SD) problem ** solved!!</h2>
<div id="posts">
<div class="post">
    <h4>#119947 - Diddl - Tue Feb 27, 2007 9:08 pm</h4>
    <div class="postbody"><span class="postbody">DLDI driver doesn't work for my DS Link (slot 1) card. But I have dsdoom compiled and running on my DS Link. So I want to see why ...
<br/>
<br/>
First tests shows, libfat already fails at function fatInitDefault(). So I inserted debug messages to console in this io driver (io_DLMS.c). 
<br/>
<br/>
Now I have a reduced test scenario, this are the facts:
<br/>
<ul>
<br/>
<li>a WORKING sample based on gba_nds_fat (example 1)
<br/>
</li><li>a NOT WORKING sample based on libfat (example 2)
<br/>
</li><li>both use devkit20
<br/>
</li><li>both use the same io_DLMS driver!!
<br/>
</li><li>now I use the same object files of io_DLMS and io_DLMS_asm!!
<br/>
</li><li>gba_nds_fat and libfat does exactly the same calls. both examples simply calls first DLMS_StartUp() and then DLMS_ReadSectors(0,1)
<br/>
</li><li>the curiosity is, in example 1 DLMS_ReadSectors(0,1) reads the sector 0 with data at relative address 1c0 but example 2 gets only 00 bytes. all 512 bytes are 0.
<br/>
</li></ul>
<br/>
<br/>
I cannot understand this and I'm sorry, I cannot debug this assembler file which includes this DLMS_ReadSectors() function.
<br/>
<br/>
<br/>
<span style="font-weight: bold">PLEASE HELP ME!!! I'm too weak to solve this problem without help.</span> All I can do is done. I cannot explain the reason of the problem.
<br/>
<br/>
<br/>
If anyone give me instructions I can test, but I have no idea to do it myself.
<br/>
<br/>
<br/>
For the tests I have the following test files (binary and sources). To test you need a DS Link card in slot 1 with both test files (.nds). The console message show the call to DLMS_StartUp() and then DLMS_ReadSectors(0,1). A hex dump of the read block will follow. Key A for printing next line, Key B breaks hexdump.
<br/>
<br/>
<br/>
Modified libfat code from Chishm - added this DS Link slot 1 driver:
<br/>
<a class="postlink" href="http://web3.vs2066076.netfabrik.de/nds/libfat070127.zip" target="_blank">Example 2 (libfat)</a>
<br/>
<br/>
<br/>
Libfat testcode (needs modified libfat):
<br/>
<a class="postlink" href="http://web3.vs2066076.netfabrik.de/nds/test_libfat.zip" target="_blank">Example 2</a>
<br/>
<br/>
<br/>
<br/>
gba_nds_fat test code (working)
<br/>
<a class="postlink" href="http://web3.vs2066076.netfabrik.de/nds/test_gba_nds_fat_doom.zip" target="_blank">Example 1</a>
<br/>
[/list]</span><span class="gensmall"><br/><br/>Last edited by Diddl on Fri Mar 02, 2007 8:29 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#120281 - Diddl - Fri Mar 02, 2007 8:24 am</h4>
    <div class="postbody"><span class="postbody">have soved this problem. now I 'am testing a working DLDI.
<br/>
<br/>
does nobody own a DS Link here? Is there anybody who want to test?
<br/>
<br/>
<br/>
Working DS Linker DLDI: <a class="postlink" href="http://web3.vs2066076.netfabrik.de/nds/ds_link.dldi" target="_blank">DLDI</a>  ::    <a class="postlink" href="http://web3.vs2066076.netfabrik.de/nds/src_ds_link.zip" target="_blank">Source</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
