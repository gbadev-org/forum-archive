<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Libnds questions - newbie - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Libnds questions - newbie</h2>
<div id="posts">
<div class="post">
    <h4>#144526 - nulL - Sat Nov 03, 2007 7:34 am</h4>
    <div class="postbody"><span class="postbody">Hi I'm having trouble drawing directly to the second screen (bottom) as well as the top screen at the same time.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void ClearScreen(void) {
<br/>
    int i;
<br/>
    
<br/>
    for(i = 256 * 10; i &lt; 256 * 192; i++)
<br/>
        VRAM_A[i] = RGB15(0, 15, 0);
<br/>
    
<br/>
}
<br/>
<br/>
int main() {
<br/>
    irqInit();
<br/>
    irqEnable(IRQ_VBLANK);
<br/>
    
<br/>
    videoSetMode(MODE_FB0);
<br/>
    vramSetBankA(VRAM_A_LCD);
<br/>
    
<br/>
    while(1) {
<br/>
        swiWaitForVBlank();
<br/>
        ClearScreen();
<br/>
    }
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
The above code draws the top sceen green. How can I use simular code to draw the top screen green and the bottem red at the same time?
<br/>
<br/>
Sorry if this sounds like a stupid question.
<br/>
<br/>
Also where can I find the libnds api documentation. I have found <a href="http://devkitpro.sourceforge.net/devkitProWiki/libnds/index.html" target="_blank">http://devkitpro.sourceforge.net/devkitProWiki/libnds/index.html</a> but the video section is not avaliable. Or do I have to use the headers for the documentation?
<br/>
<br/>
Thanks</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144528 - HyperHacker - Sat Nov 03, 2007 8:12 am</h4>
    <div class="postbody"><span class="postbody">Hold on I see all sorts of problems here.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">for(i = 256 * 10; i &lt; 256 * 192; i++)
<br/>
        VRAM_A[i] = RGB15(0, 15, 0);</td> </tr></table><span class="postbody">The high bit of each pixel needs to be set for it to show up in most modes (maybe not framebuffer mode?).
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">videoSetMode(MODE_FB0);
<br/>
vramSetBankA(VRAM_A_LCD);</td> </tr></table><span class="postbody">I don't know of any good reason to use framebuffer mode instead of a 256x256 extended rotation bitmap. You get the same result but you have rotation, shearing, scaling, transparency, etc. Also, assigning a bank to "LCD" (no idea why it's named that) means it won't be used for VRAM at all.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">while(1) {
<br/>
        swiWaitForVBlank();
<br/>
        ClearScreen();
<br/>
    }
<br/>
}</td> </tr></table><span class="postbody">There's no sense clearing the screen every frame, that just wastes CPU power.
<br/>
<br/>
VRAM management can be a bit of a pain. If you just want each screen to have a 16-bit bitmap, you can do something like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">vramSetMainBanks(VRAM_A_MAIN_BG, VRAM_B_SUB_BG, VRAM_C_LCD, VRAM_D_LCD); //Bank A at 0x06000000, bank B at 0x06200000
<br/>
videoSetMode(MODE_5_2D | DISPLAY_BG3_ACTIVE);
<br/>
videoSetModeSub(MODE_5_2D | DISPLAY_BG3_ACTIVE);
<br/>
<br/>
BG3_CR = BG_BMP16_256x256; //256x256 16-bit bitmap
<br/>
BG3_XDX = 1 &lt;&lt; 8; //Identity matrix (no rotation, scaling or shearing)
<br/>
BG3_XDY = 0;
<br/>
BG3_YDX = 0;
<br/>
BG3_YDY = 1 &lt;&lt; 8;
<br/>
BG3_CX = 0; //Position at 0, 0
<br/>
BG3_CY = 0;
<br/>
<br/>
SUB_BG3_CR = BG_BMP16_256x256; //256x256 16-bit bitmap
<br/>
SUB_BG3_XDX = 1 &lt;&lt; 8; //Identity matrix (no rotation, scaling or shearing)
<br/>
SUB_BG3_XDY = 0;
<br/>
SUB_BG3_YDX = 0;
<br/>
SUB_BG3_YDY = 1 &lt;&lt; 8;
<br/>
SUB_BG3_CX = 0; //Position at 0, 0
<br/>
SUB_BG3_CY = 0;</td> </tr></table><span class="postbody">
<br/>
<br/>
Now you can just write your pixel data to 0x06000000 for the main screen and 0x06200000 for the subscreen, but make sure to set the high bit or else it won't show up. It gets a bit more complex if you want multiple bitmaps, text layers, sprites, etc.
<br/>
<br/>
Beware of the limited CPU power you have, though. Updating two 256x192 bitmaps every frame doesn't leave much for the rest of the program. You'll want to avoid making large changes to what's on the screen as much as possible. If speed isn't important, you can look into having two bitmaps per screen, and toggle between them for a double-buffering effect.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144570 - nulL - Sun Nov 04, 2007 12:51 am</h4>
    <div class="postbody"><span class="postbody">Thanks for the help HyperHacker.
<br/>
<br/>
Ive added the following code to yours.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">    unsigned int* pixelLocation;
<br/>
    unsigned short int colour = RGB15(0, 15, 0);
<br/>
    int i;
<br/>
    
<br/>
    pixelLocation = (unsigned int*) 0x06200000; 
<br/>
    
<br/>
    colour = colour | (1&lt;&lt;15);
<br/>
<br/>
    for(i = 0; i &lt; 256 * 256; i++)
<br/>
        pixelLocation[i] = colour;
<br/>
    
<br/>
    pixelLocation = (unsigned int*) 0x06000000; 
<br/>
    
<br/>
    colour = RGB15(15, 0, 0);
<br/>
    colour = colour | (1&lt;&lt;15);
<br/>
    
<br/>
    for(i = 0; i &lt; 256 * 256; i++)
<br/>
        pixelLocation[i] = colour;</td> </tr></table><span class="postbody">
<br/>
<br/>
But I get the following result.
<br/>
<a href="http://www.nodespot.info/uploads/unregistered/bb/redgreen.png">[Images not permitted - Click here to view it]</a>
<br/>
It seems every second column is black. Im not sure why.
<br/>
<br/>
Also on actual DS hardware nothing is drawn to the second screen (bottom screen).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144571 - DragonMinded - Sun Nov 04, 2007 1:15 am</h4>
    <div class="postbody"><span class="postbody">Because you defined pixelLocation to be an integer, not a uint16.  Therefore, every index to it will be on a 4 byte boundary, not a two byte boundary, hence leaving every other pixel dark.<br/>_________________<br/>Enter the mind of the dragon.
<br/>
<br/>
<a href="http://dragonminded.blogspot.com" target="_blank">http://dragonminded.blogspot.com</a>
<br/>
<br/>
Seriously guys, how hard is it to simply TRY something yourself?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144574 - nulL - Sun Nov 04, 2007 2:39 am</h4>
    <div class="postbody"><span class="postbody">Ahh yes that makes way to much sence now. Thanks DragonMinded.
<br/>
<br/>
Sorry to be a pain but I still have the probelm of the second screen not showing anything (dark/black) on actual DS hardware. Though on Desmume it works fine (top screen red, bottom green).
<br/>
<br/>
Here is my full code
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
int main() {
<br/>
        
<br/>
    vramSetMainBanks(VRAM_A_MAIN_BG, VRAM_C_SUB_BG, VRAM_C_LCD, VRAM_D_LCD); //Bank A at 0x06000000, bank B at 0x06200000
<br/>
    videoSetMode(MODE_5_2D | DISPLAY_BG3_ACTIVE);
<br/>
    videoSetModeSub(MODE_5_2D | DISPLAY_BG3_ACTIVE);
<br/>
<br/>
    BG3_CR = BG_BMP16_256x256; //256x256 16-bit bitmap
<br/>
    BG3_XDX = 1 &lt;&lt; 8; //Identity matrix (no rotation, scaling or shearing)
<br/>
    BG3_XDY = 0;
<br/>
    BG3_YDX = 0;
<br/>
    BG3_YDY = 1 &lt;&lt; 8;
<br/>
    BG3_CX = 0; //Position at 0, 0
<br/>
    BG3_CY = 0;
<br/>
<br/>
    SUB_BG3_CR = BG_BMP16_256x256; //256x256 16-bit bitmap
<br/>
    SUB_BG3_XDX = 1 &lt;&lt; 8; //Identity matrix (no rotation, scaling or shearing)
<br/>
    SUB_BG3_XDY = 0;
<br/>
    SUB_BG3_YDX = 0;
<br/>
    SUB_BG3_YDY = 1 &lt;&lt; 8;
<br/>
    SUB_BG3_CX = 0; //Position at 0, 0
<br/>
    SUB_BG3_CY = 0;
<br/>
<br/>
    unsigned short int* pixelLocation;
<br/>
    unsigned short int colour = RGB15(15, 0, 0);
<br/>
    int i;
<br/>
    
<br/>
    pixelLocation = (unsigned short*) 0x06200000; 
<br/>
    
<br/>
    colour = colour | (1&lt;&lt;15);
<br/>
<br/>
    for(i = 0; i &lt; 256 * 256; i++)
<br/>
        pixelLocation[i] = colour;
<br/>
    
<br/>
    pixelLocation = (unsigned short*) 0x06000000; 
<br/>
    
<br/>
    colour = RGB15(0, 15, 0);
<br/>
    colour = colour | (1&lt;&lt;15);
<br/>
    
<br/>
    for(i = 0; i &lt; 256 * 256; i++)
<br/>
        pixelLocation[i] = colour;
<br/>
    
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144577 - tepples - Sun Nov 04, 2007 3:11 am</h4>
    <div class="postbody"><span class="postbody">Too many DS emulators are more forgiving than the DS hardware in a few aspects. If you're trying to make a program that uses bitmap mode run correctly on DS hardware, check these first: <ul><li>VRAM banks </li><li>Alpha bit </li></ul> Specifically, check this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">vramSetMainBanks(VRAM_A_MAIN_BG, VRAM_C_SUB_BG, VRAM_C_LCD, VRAM_D_LCD);
<br/>
</td> </tr></table><span class="postbody">
<br/>
Why does C appear twice?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
