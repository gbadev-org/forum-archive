<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Getting the System Time / Date - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Getting the System Time / Date</h2>
<div id="posts">
<div class="post">
    <h4>#55441 - GrenadeJumper - Wed Sep 28, 2005 3:07 pm</h4>
    <div class="postbody"><span class="postbody">Hi All,
<br/>
<br/>
I'm trying to create a random number generator for a project I'm working on, but I can't generate a random seed to initialise it with.
<br/>
<br/>
So, my cunning plan is to use the system date and time! But I can't seem to find out how...
<br/>
<br/>
Here's my current code for the initialiser:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">RandomInitialise(124,127);</td> </tr></table><span class="postbody">
<br/>
<span style="font-size: 9px; line-height: normal">(Note, the 124 and 127 are just numbers I put in there for it to work. Nothing important)</span>
<br/>
The only constraint on the numbers is that they have to be below 30,000.
<br/>
I'm thinking, use something like:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">Day x Month + ( Seconds + (hours x 3) + (minutes x 5) )
<br/>
Seconds x Hours + ( Month + (Minutes x 3) + (Day x 5) )</td> </tr></table><span class="postbody">
<br/>
Just for randomness :-)
<br/>
<br/>
Hope someone can help!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#55483 - cybereality - Wed Sep 28, 2005 9:05 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">uint16 random ( uint16 range = 0 )
<br/>
{
<br/>
   static uint32 randSeed = 0xB0B15BAD;
<br/>
<br/>
   randSeed *= 0x0019660D;
<br/>
   randSeed += 0x3C6EF35F;
<br/>
<br/>
   return ((randSeed &gt;&gt; 16) % range);
<br/>
} </td> </tr></table><span class="postbody">
<br/>
This function will return a pseudo-random number. Works good for most purposes. Just place the function at the beginning of the code and call it like this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int rand = random(8);</td> </tr></table><span class="postbody">
<br/>
Which will return a random integer between 0 and 7. That should be all you need. Hope thats what your looking for.<br/>_________________<br/><a class="postlink" href="http://www.cybereality.com" target="_blank">// cybereality</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#55511 - GrenadeJumper - Wed Sep 28, 2005 11:16 pm</h4>
    <div class="postbody"><span class="postbody">The problem with that code is that it generates the same number sequence every time i run it. That's the same problem i have with my hard-coded seed in the original generator.
<br/>
<br/>
In the libnds files, i just found the line
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define   REG_TIME      ( (vu16*)0x4000100)</td> </tr></table><span class="postbody">
<br/>
Is that the system time? (*hopes*)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#55512 - josath - Wed Sep 28, 2005 11:25 pm</h4>
    <div class="postbody"><span class="postbody">the time / date is all stored in the IPC. look at the fields in the struct in ipc.h. it's already all split into year/day/minute/second for you</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#55513 - GrenadeJumper - Wed Sep 28, 2005 11:55 pm</h4>
    <div class="postbody"><span class="postbody">Yay, thanks a ton!
<br/>
:-D</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#55514 - tepples - Wed Sep 28, 2005 11:55 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>cybereality wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">uint16 random ( uint16 range = 0 )
<br/>
{
<br/>
   static uint32 randSeed = 0xB0B15BAD;
<br/>
<br/>
   randSeed *= 0x0019660D;
<br/>
   randSeed += 0x3C6EF35F;
<br/>
<br/>
   return ((randSeed &gt;&gt; 16) % range);
<br/>
} </td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
It'll divide by zero if you use the default value for range. In this case you might as well not give a default value for range.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#55556 - GrenadeJumper - Thu Sep 29, 2005 10:31 am</h4>
    <div class="postbody"><span class="postbody">Argh, a new problem in the same area!
<br/>
<br/>
Ok, this is the code:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   uint16 d = -(~IPC-&gt;curtime[3]) - 1;
<br/>
   uint16 m = -(~IPC-&gt;curtime[2]) - 1;
<br/>
   uint16 y = -(~IPC-&gt;curtime[4]) + 1;
<br/>
   uint16 h = -(~IPC-&gt;curtime[5]) - 1;
<br/>
   uint16 mi = -(~IPC-&gt;curtime[6]) - 1;
<br/>
   uint16 s = -(~IPC-&gt;curtime[7]) - 1;
<br/>
<br/>
   if(h &gt; 50) h-= 40;
<br/>
<br/>
   uint32 rand1 = d + m; // + s + h * 3 + mi * 5 + s;
<br/>
   uint32 rand2 = s + h; // + m + mi * 3 + d * 5 + s;
<br/>
   iprintf("\n\t\t%d, %d", rand1, rand2);
<br/>
   RandomInitialise(rand1,rand2); </td> </tr></table><span class="postbody">
<br/>
<br/>
The values of 'd', 'm', 'y', 'h', 'mi' and 's' work, because they are printed later in the code. But, for some totally unknown, reason 'rand1' and 'rand2' are always 0 when they are printed, and the random numbers created after the 'RandomInitialise' routine are always the same.
<br/>
<br/>
Help!?!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#55568 - tuLL - Thu Sep 29, 2005 2:19 pm</h4>
    <div class="postbody"><span class="postbody">I know nothing about programming.
<br/>
<br/>
But the Darkstar by Darkain has a list with all the system's settings in hex.
<br/>
<br/>
I don't know if it is open-source, but check it out.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#55592 - GrenadeJumper - Thu Sep 29, 2005 8:18 pm</h4>
    <div class="postbody"><span class="postbody">The strange thing is, it worked for a while. I had it output the date + time to the console + it worked perfectly. But as soon as I tried to use it for the Random Number Generator seed, it failed! Argh!
<br/>
<br/>
Does anyone know why this would happen?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#55603 - Dwedit - Thu Sep 29, 2005 10:24 pm</h4>
    <div class="postbody"><span class="postbody">There's always the method that systems used before they had internal clocks: Generating a new random number many times a second.  Or constantly generate numbers while the joystick buttons are being pressed, or other input from the user to randomize.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
