<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Speed of some DS hardware - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Speed of some DS hardware</h2>
<div id="posts">
<div class="post">
    <h4>#113234 - goruka - Sun Dec 24, 2006 11:33 pm</h4>
    <div class="postbody"><span class="postbody">I still haven't messed with the DS enough, but before wasting a lot of time benchmarking, I wanted to do some questions about the opengl-like registers of the DS.
<br/>
<br/>
1- How fast is the internal matrix multiplication? I noticed you can push/pop matrices and multiply them (4x4/4x3/3x3), is this much faster than doing it on ARM? (pushing matrix stack, loading a matrix, mutiplying by another and pop the result)
<br/>
<br/>
2-How's the SQRT function (speed/accuracy)? any idea of the error?
<br/>
<br/>
Well I guess these are my main doubts so far.
<br/>
<br/>
Cheers and Thanks!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113247 - HyperHacker - Mon Dec 25, 2006 9:06 am</h4>
    <div class="postbody"><span class="postbody">#1, I'd imagine it's faster, or else why would it be there?<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113252 - OOPMan - Mon Dec 25, 2006 9:41 am</h4>
    <div class="postbody"><span class="postbody">With regards to the SQRT function, I can't say for sure but I'd guess the DS not having an FPU would slow that one down...
<br/>
<br/>
In general, avoid using SQRT when possible. This can be quite easy to do in many situations...
<br/>
<br/>
For example:
<br/>
<br/>
<span style="font-weight: bold">x</span>^2 + <span style="font-weight: bold">y</span>^2 = <span style="font-weight: bold">r</span>^2
<br/>
<br/>
You want to determine whether some random line with a length of <span style="font-weight: bold">a</span> is longer than the above one. You could take the square root of the above <span style="font-weight: bold">r</span>^2 and compare <span style="font-weight: bold">r</span> and <span style="font-weight: bold">a</span> directly, but this is inefficient.
<br/>
<br/>
It's actually better to compare <span style="font-weight: bold">r</span>^2 to <span style="font-weight: bold">a</span>^2. By doing so you can determine the which line is longer without resorting to SQRT.
<br/>
<br/>
While such trickery does not apply to every single possible situation out there, basic 1st year university maths illustrated that it applies a lot more often than you'd imagine and can make a difficult problem very easy :-)
<br/>
<br/>
So, try to avoid SQRT where possible ;-)<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113340 - Juglak - Tue Dec 26, 2006 9:33 pm</h4>
    <div class="postbody"><span class="postbody">Not sure on the matricies... but...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
40002B0h - NDS9 - SQRTCNT - 16bit - Square Root Control (R/W)
<br/>
  0     Mode (0=32bit input, 1=64bit input)
<br/>
  1-14  Not used
<br/>
  15    Busy (0=Ready, 1=Busy) (Execution time is 13 clks, in either Mode)
<br/>
<br/>
 
<br/>
<br/>
40002B4h - NDS9 - SQRT_RESULT - 32bit - Square Root Result (R/W?)
<br/>
40002B8h - NDS9 - SQRT_PARAM - 64bit - Square Root Parameter Input (R/W)
<br/>
Unsigned 64bit parameter, and unsigned 32bit result.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<span style="font-weight: bold">Execution time is 13 clks</span>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
If I'm not mistaken, though, libnds does NOT take advantage of these accelerated registers for sqrt...
<br/>
<br/>
-J
<br/>
Ref: <a href="http://nocash.emubase.de/gbatek.htm" target="_blank">http://nocash.emubase.de/gbatek.htm</a><br/>_________________<br/>My goodies: 1xDS Lite - Supercard Lite, DSi, Supercard DSONEi</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113344 - Lick - Tue Dec 26, 2006 10:03 pm</h4>
    <div class="postbody"><span class="postbody">You can access the SQRT hardware with the registers defined in nds/arm9/math.h. Found out today.<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113362 - kusma - Wed Dec 27, 2006 1:41 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lick wrote:</b></span></td> </tr> <tr> <td class="quote">You can access the SQRT hardware with the registers defined in nds/arm9/math.h. Found out today.</td> </tr></table><span class="postbody">
<br/>
<br/>
How do you guarantee that the result is ready when you read it? I'm suspecting this functionality to be hard to take advantage of from C/C++ code, and thus the only big advantage being eliminated unless you're writing assembly-code to manually parallelize code. And let's be practical here: we're only writing inner-loops in assembly, and what kind of inner-loops require normalizing? I can only think of a few, and most of them can be "tricked" away using sleazy cheats.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113363 - Lick - Wed Dec 27, 2006 1:53 am</h4>
    <div class="postbody"><span class="postbody">This?
<br/>
<br/>
while(SQRT_CR &amp; SQRT_BUSY);<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113364 - kusma - Wed Dec 27, 2006 2:06 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lick wrote:</b></span></td> </tr> <tr> <td class="quote">This?
<br/>
<br/>
while(SQRT_CR &amp; SQRT_BUSY);</td> </tr></table><span class="postbody">
<br/>
<br/>
Yeah, okay, This doesn't tell the scheduler to put 13 clocks between writing the registers and reading them, though. And the gcc scheduler isn't too friendly to these kinds of ("manual") stalls...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113369 - tepples - Wed Dec 27, 2006 3:02 am</h4>
    <div class="postbody"><span class="postbody">Looks like a job for inline asm, right?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113370 - kusma - Wed Dec 27, 2006 3:06 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Looks like a job for inline asm, right?</td> </tr></table><span class="postbody">
<br/>
<br/>
Good point. That way I guess you can force some dependencies to make the read and write distant enough. Still, it's a rather ugly hack, and it reduce the schedulers ability to generate optimal code.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113372 - sajiimori - Wed Dec 27, 2006 3:21 am</h4>
    <div class="postbody"><span class="postbody">Better yet, do real work in the meantime.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113373 - kusma - Wed Dec 27, 2006 3:27 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">Better yet, do real work in the meantime.</td> </tr></table><span class="postbody">
<br/>
But how do you control the order of instructions in an program that has been transformed to SSA-form before scheduling?</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
