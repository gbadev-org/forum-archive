<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>How To Save Screenshots On The DS - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > How To Save Screenshots On The DS</h2>
<div id="posts">
<div class="post">
    <h4>#142241 - Ishi - Sat Oct 06, 2007 8:36 pm</h4>
    <div class="postbody"><span class="postbody">I spent last night looking things up for this and getting it working, so I thought I'd share what I learned.
<br/>
<br/>
This basically allows you to dump a screenshot straight to a file on your DS card, and then convert it into a proper image file on your PC. Really handy for showing glitches that you need help fixing or something like that.
<br/>
<br/>
It requires a free VRAM bank unfortunately. I don't think there's a way to do this without using a bank, but if there is I'd love to be shown how.
<br/>
<br/>
I'm using this on 3D on the top screen, settings may need to be changed if you're doing anything different. Again, clarification on that would be fantastic :)
<br/>
<br/>
<span style="font-weight: bold">1.</span>
<br/>
<br/>
Get your game up and running. Keep one of the main VRAM banks free (I use D).
<br/>
<br/>
Amongst the usual headers, you'll need:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include &lt;stdio.h&gt;
<br/>
#include &lt;fat.h&gt;</td> </tr></table><span class="postbody">
<br/>
<br/>
Don't forget to initialise the file system for saving the image later. Usually done right after powerON() etc.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   fatInitDefault(); //file system</td> </tr></table><span class="postbody">
<br/>
<br/>
<span style="font-weight: bold">2.</span>
<br/>
<br/>
When you want to take the screenshot (probably when the user presses a button or something), change the video mode and enable display capture:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   //set up frame buffer video mode
<br/>
   videoSetMode(MODE_FB3); //frame buffer 3
<br/>
<br/>
   DISP_CAPTURE = DCAP_ENABLE | //enables display capturing
<br/>
               DCAP_BANK(3) | //which vram bank to use - 0=A, 1=B, 2=C, 3=D
<br/>
               DCAP_SIZE(3) | //3 = full size 256 x 192
<br/>
               DCAP_SRC(1); //capture source - not sure what this does</td> </tr></table><span class="postbody">
<br/>
<br/>
<span style="font-weight: bold">3.</span>
<br/>
<br/>
At this point I let it render a couple of frames before I grab the image. When I tried grabbing it straight away there was glitches on the image, probably caused by the switch in video mode.
<br/>
<br/>
<span style="font-weight: bold">4.</span>
<br/>
<br/>
Time to get the image.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   //dump the screenshot to file
<br/>
   FILE *file = fopen("/screenshot", "wb");
<br/>
   if(file)
<br/>
   {
<br/>
      fwrite((void*)0x6860000, //memory location of the screen buffer - this might only apply to VRAM bank D, I'm not sure tbh
<br/>
         2, //each pixel is two bytes
<br/>
         256 * 192, //total number of pixels (49152)
<br/>
         file);
<br/>
      fclose(file);
<br/>
   }</td> </tr></table><span class="postbody">
<br/>
<br/>
That saves the current screen data to the root directory of your card.
<br/>
<br/>
Finally, return the video mode to what it used to be, and the game should carry on running as normal. Note that MODE_0_3D is just an example here, you can set whatever video mode you need to.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   //return to default video mode
<br/>
   videoSetMode(MODE_0_3D);
<br/>
<br/>
   DISP_CAPTURE = 0; //disable display capture</td> </tr></table><span class="postbody">
<br/>
<br/>
<span style="font-weight: bold">5.</span>
<br/>
<br/>
Copy/move the screenshot file off the DS onto your PC. Drag &amp; Drop it onto my converter program - <a href="http://www.ishisoft.remakes.org/misc/ds_screenshot_converter.zip" target="_blank">http://www.ishisoft.remakes.org/misc/ds_screenshot_converter.zip</a> - and if all goes well, your screenshot should be saved out as a 256x192 .png image. (like so: <a href="http://www.ishisoft.remakes.org/misc/screenshot1.png" target="_blank">http://www.ishisoft.remakes.org/misc/screenshot1.png</a> ).
<br/>
<br/>
<br/>
Hope this is useful for someone. It's not exactly comprehensive or detailed, but it gets the job done.
<br/>
<br/>
Note that you can save the screenshot file as whatever you want. Mine outputs incrementally numbered files so that you can take more than one screenshot at a time. I left that kind of thing out of this tutorial for the sake of simpicity.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142282 - gm112 - Sun Oct 07, 2007 7:12 pm</h4>
    <div class="postbody"><span class="postbody">Woah! Nice find :D. At least this is a start, you know?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142285 - Lazy1 - Sun Oct 07, 2007 7:39 pm</h4>
    <div class="postbody"><span class="postbody">Can you capture the sub screen as well?
<br/>
That would be really good to capture them both and write it as a single 256x384 image.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142287 - Mighty Max - Sun Oct 07, 2007 7:49 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lazy1 wrote:</b></span></td> </tr> <tr> <td class="quote">Can you capture the sub screen as well?
<br/>
That would be really good to capture them both and write it as a single 256x384 image.</td> </tr></table><span class="postbody">
<br/>
<br/>
The second gfx core does not seem to have the needed capture registers.
<br/>
<a href="http://nocash.emubase.de/gbatek.htm#dsvideodisplaysystemblockdiagram" target="_blank">http://nocash.emubase.de/gbatek.htm#dsvideodisplaysystemblockdiagram</a><br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142289 - Dood77 - Sun Oct 07, 2007 7:58 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lazy1 wrote:</b></span></td> </tr> <tr> <td class="quote">Can you capture the sub screen as well?
<br/>
That would be really good to capture them both and write it as a single 256x384 image.</td> </tr></table><span class="postbody">
<br/>
<br/>
The second gfx core does not seem to have the needed capture registers.
<br/>
<a href="http://nocash.emubase.de/gbatek.htm#dsvideodisplaysystemblockdiagram" target="_blank">http://nocash.emubase.de/gbatek.htm#dsvideodisplaysystemblockdiagram</a></span></td> </tr></table><span class="postbody">
<br/>
So flip screens, capture, then append one image to the other...<br/>_________________<br/>If I use a term wrong or something then feel free to correct, I?m not much of a programmer.
<br/>
<span style="font-size: 9px; line-height: normal">
<br/>
Original DS Phat obtained on day of release + flashme v7
<br/>
Supercard: miniSD, Kingston 1GB, Kingston 2GB
<br/>
Ralink chipset PCI NIC
<br/>
</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142290 - Mighty Max - Sun Oct 07, 2007 8:07 pm</h4>
    <div class="postbody"><span class="postbody">If you flip the screens, you are not flipping the engine.
<br/>
You would completely need to flip the core you are rendering on. This will most likely have a huge impact on your code.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142303 - wintermute - Sun Oct 07, 2007 11:36 pm</h4>
    <div class="postbody"><span class="postbody">There's been a screenshot demo in CVS examples since April. It outputs .bmps<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142355 - Ishi - Mon Oct 08, 2007 6:59 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">There's been a screenshot demo in CVS examples since April. It outputs .bmps</td> </tr></table><span class="postbody">
<br/>
<br/>
What / where is CVS examples? I couldn't find anything on the forum here so I figured it would be worth posting.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142362 - tepples - Mon Oct 08, 2007 7:49 pm</h4>
    <div class="postbody"><span class="postbody"><a class="postlink" href="http://en.wikipedia.org/wiki/Concurrent_Versions_System" target="_blank">CVS</a> is a revision control system. All devkitPro projects, such as devkitARM and libnds, have their latest source code in the <a class="postlink" href="http://sourceforge.net/cvs/?group_id=114505" target="_blank">devkitPro CVS repository</a> on SourceForge.net. I interpreted "CVS examples" as shorthand for the latest version of the libnds examples that has been made available in the devkitPro CVS repository.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142393 - Ishi - Mon Oct 08, 2007 10:30 pm</h4>
    <div class="postbody"><span class="postbody">Ah cool, ta for the info :)
<br/>
I had a look for CVS on wiki but I think I got distracted by Cyclic Vomiting Syndrome. ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142441 - HyperHacker - Tue Oct 09, 2007 5:27 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">If you flip the screens, you are not flipping the engine.
<br/>
You would completely need to flip the core you are rendering on. This will most likely have a huge impact on your code.</td> </tr></table><span class="postbody">Worse, you can't render 3D on the second core.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#148291 - Neo_Ace - Fri Jan 04, 2008 12:22 pm</h4>
    <div class="postbody"><span class="postbody">Can you put the code complete? Than is not separated.
<br/>
<br/>
Sorry for my English</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#148404 - simonjhall - Sat Jan 05, 2008 1:38 pm</h4>
    <div class="postbody"><span class="postbody">Hi Ishi, when I run your program to convert the image to a png I get an error about a missing corona.dll.
<br/>
I'm hunting around for a replacement but it may be worth updating your zip file to include this file...<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#148451 - yellowstar - Sat Jan 05, 2008 10:35 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ishi wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
It requires a free VRAM bank unfortunately. I don't think there's a way to do this without using a bank, but if there is I'd love to be shown how.
<br/>
</td> </tr></table><span class="postbody">
<br/>
FIFO can probably do that. But, I don't know how to do it... Check gbatek.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ishi wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<span style="font-weight: bold">3.</span>
<br/>
<br/>
At this point I let it render a couple of frames before I grab the image. When I tried grabbing it straight away there was glitches on the image, probably caused by the switch in video mode.
<br/>
</td> </tr></table><span class="postbody">
<br/>
That's most likely because the display capture isn't done. Use this to check for that.(Your code does the following, but it doesn't continue as soon as the capture is done)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
while(DISP_CAPTURE==1)swiWaitForVBlank();
<br/>
//Wait for the display capture to finish. You set this to 1 to start the capture. The hardware sets this //to 0 when it's done. So, this code waits for that to happen.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
My captures were captured flawlessly every time with this.(But I used my own code. But that shouldn't make any difference)
<br/>
Of course, since it's waiting on the capture, you have to wait a bit for it
<br/>
to finish.(One way to know if it's done is to have something moving, but most things have that)(Or display a done message)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
