<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>ITCM & DTCM - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > ITCM & DTCM</h2>
<div id="posts">
<div class="post">
    <h4>#101252 - ProblemBaby - Mon Sep 04, 2006 1:23 am</h4>
    <div class="postbody"><span class="postbody">Hey
<br/>
I have a very processor intensive function.. I thought that putting the code in ITCM and the data in DTCM would speed it up some. When I later just for testing changed back to main memory I saw that the speed was exactly the same! why doesnt code execute faster in ITCM and load/store data faster in DTCM???
<br/>
<br/>
thanks
<br/>
<br/>
(the function is a loop with about 150 instructions in it)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#101254 - chishm - Mon Sep 04, 2006 1:32 am</h4>
    <div class="postbody"><span class="postbody">You'll find that the ARM9 will cache regularly used instructions and data into icache and dcache respectively. Both of these use the same physical memory as ITCM and DTCM, so apart from the slight cache overhead, you'll get similar performance from either explicitly placing the code/data there or letting the CPU do it.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#101256 - ProblemBaby - Mon Sep 04, 2006 1:45 am</h4>
    <div class="postbody"><span class="postbody">Is this done at runtime or at compile time? like: do I ever have to put small routines in itcm?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#101275 - sajiimori - Mon Sep 04, 2006 3:20 am</h4>
    <div class="postbody"><span class="postbody">Just in case there was some confusion: Regardless of whether TCM and the cache use the same physical hardware (and I don't know if they do), they do not occupy the same logical addresses.  In fact, the cache is not mapped to any memory addresses.
<br/>
<br/>
There are two basic reasons to put something in TCM:
<br/>
<br/>
1.  It is accessed repeatedly during a loop, but it is too large to fit in the cache, so automatic caching has little or no benefit.  You don't necessarily have to put the entire loop in TCM to eliminate access to slow RAM, though.  You just have to move enough to TCM so that the rest can fit in the cache.
<br/>
<br/>
2.  It is accessed often, but sporadically, so that its place in the cache is likely to be overwritten by the time it is accessed again.  Even worse, every time this sporadic action is performed, it overwrites older cached data without any payoff -- it's a lose-lose.
<br/>
<br/>
I tend to look at TCM as a way to free up cache space by keeping common things from filling it up.
<br/>
<br/>
<br/>
Edit: To answer your question more directly, the cache is handled by the CPU at runtime.  <a class="postlink" href="http://www.arm.com/pdfs/DDI0155A_946ES.pdf" target="_blank">http://www.arm.com/pdfs/DDI0155A_946ES.pdf</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#101287 - chishm - Mon Sep 04, 2006 6:55 am</h4>
    <div class="postbody"><span class="postbody">Hmm, I don't know where I read that the ITCM uses the same hardware as the Icache. Regardless, for small inner loops that are used infrequently but run through a few hundred times, it is better to let the cache take care of them. Use ITCM for code that will be executed frequently (and especially) in small chunks. You won't normally be able to fit an entire game loop in ITCM. Also, place data in DTCM. ITCM takes a performance hit when accessing data from code within it.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#101289 - sajiimori - Mon Sep 04, 2006 7:18 am</h4>
    <div class="postbody"><span class="postbody">Also, be careful about DTCM usage if your stack is there.
<br/>
<br/>
Some of the best things to put in ITCM are matrix operations.  They're kind of long (resulting in a lot of memory reads), they're often used by multiple subsystems (so use is sporadic), they aren't usually written with loops (so caching doesn't pay off during one call), and they can eat a lot of cycles (so efficiency matters).</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
