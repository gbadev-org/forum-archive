<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>2D on top, 3D on the bottom, text somewhere in between? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > 2D on top, 3D on the bottom, text somewhere in between?</h2>
<div id="posts">
<div class="post">
    <h4>#159448 - ragefury32 - Tue Jul 01, 2008 3:36 am</h4>
    <div class="postbody"><span class="postbody">Okay, I am trying to modify one of the NeHe demos to draw the 3D texture mapped box with full rotation (Lesson 8) on the bottom screen, and I am trying to draw a 256x256 logo on the background on the top screen, while displaying the xrot, yrot and zrot parameters using the top screen above.  So here's what I got so far:
<br/>
<br/>
	// Turn on everything	
<br/>
	powerON(POWER_ALL);
<br/>
	// Setup the Main screen for 3D 
<br/>
	videoSetMode(MODE_0_3D);
<br/>
	videoSetModeSub(MODE_5_2D | DISPLAY_BG3_ACTIVE);
<br/>
	lcdMainOnBottom(); 									
<br/>
	vramSetMainBanks(VRAM_A_TEXTURE, VRAM_B_LCD, VRAM_C_SUB_BG, VRAM_D_LCD);
<br/>
	vramSetBankA(VRAM_A_TEXTURE);
<br/>
	vramSetBankC(VRAM_C_SUB_BG);
<br/>
	BG3_CR = BG_BMP8_256x256;
<br/>
	dmaCopy(drunkenlogo_dta, BG_GFX, 256*256);
<br/>
	dmaCopy(palette_dta, BG_PALETTE, 256*2);
<br/>
	irqInit();
<br/>
	irqSet(IRQ_VBLANK, 0);
<br/>
        consoleDemoInit(); 
<br/>
	glInit();
<br/>
	glEnable(GL_OUTLINE | GL_TEXTURE_2D);
<br/>
	glSetOutlineColor(0,RGB15(31,31,31));
<br/>
...and etc, etc, etc. 
<br/>
<br/>
The OpenGL worked, the text console worked, the background does not seem to want to materialize.  What did I do wrong here?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#159451 - silent_code - Tue Jul 01, 2008 10:40 am</h4>
    <div class="postbody"><span class="postbody">Are you sure you're writing the image to the right location? Take a look at what consoleDemoInit() does, too.
<br/>
<br/>
Also: check out the "Volumetric Shadow Demo" (sources are free to download) on my web site and see how I did it. That might help. :^)
<br/>
<br/>
Good luck!<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#159452 - eKid - Tue Jul 01, 2008 1:03 pm</h4>
    <div class="postbody"><span class="postbody">I believe consoleDemoInit sets up the video mode too. You'll have to set it the console using the more flexible consoleInitDefault(), or even more flexible consoleInit().</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#159453 - elhobbs - Tue Jul 01, 2008 1:21 pm</h4>
    <div class="postbody"><span class="postbody">BG_GFX and BG_PALETTE are for the main backgrouund. you need to use BG_GFX_SUB and BG_PALETTE_SUB. you also need to setup the background a little more. this will setup an 8 bit 256x256 background on bg3:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
SUB_BG3_CR = BG_BMP8_256x256|BG_TILE_BASE(0)|BG_PRIORITY_0;
<br/>
SUB_BG3_XDX = 1&lt;&lt;8;
<br/>
SUB_BG3_YDY = 1&lt;&lt;8;
<br/>
SUB_BG3_XDY = 0;
<br/>
SUB_BG3_YDX = 0;
<br/>
SUB_BG3_CX = 0;
<br/>
SUB_BG3_CY = 0;
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#159459 - ragefury32 - Tue Jul 01, 2008 3:46 pm</h4>
    <div class="postbody"><span class="postbody">Thanks guys -
<br/>
<br/>
I note that I can get it to work if I do:
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
SUB_BG3_CR = BG_BMP8_256x256 | BG_PRIORITY(0) | BG_TILE_BASE(4);
<br/>
   SUB_BG3_XDY = 0;
<br/>
   SUB_BG3_XDX = 1 &lt;&lt; 8;
<br/>
   SUB_BG3_YDX = 0;
<br/>
   SUB_BG3_YDY = 1 &lt;&lt; 8;
<br/>
   SUB_BG3_CX = 0;
<br/>
    SUB_BG3_CY = 32 &lt;&lt; 8;
<br/>
   dmaCopy(drunkenlogo_dta, BG_GFX_SUB, 256*256);
<br/>
   dmaCopy(palette_dta, BG_PALETTE_SUB, 256*2);
<br/>
   irqInit();
<br/>
   irqSet(IRQ_VBLANK, 0);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
And that'll get me the logo on top.  However, I am not sure how to do the ConsoleInit()...Does libnds have an easily accessible online reference?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#159460 - silent_code - Tue Jul 01, 2008 3:56 pm</h4>
    <div class="postbody"><span class="postbody">It does have easily accessible source code. ;^)
<br/>
But no, afaIk, there is no documentation, but you can build one from the source code comments yourself, e.g. with doxygen. :^)<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#159462 - ragefury32 - Tue Jul 01, 2008 4:27 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>silent_code wrote:</b></span></td> </tr> <tr> <td class="quote">It does have easily accessible source code. ;^)
<br/>
But no, afaIk, there is no documentation, but you can build one from the source code comments yourself, e.g. with doxygen. :^)</td> </tr></table><span class="postbody">
<br/>
<br/>
Okay.  So I went through your volumetric shadow demo (great work BTW) and I came across this inside initialize.cpp:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
   videoSetModeSub(MODE_5_2D | DISPLAY_BG0_ACTIVE | DISPLAY_BG3_ACTIVE);
<br/>
   SUB_BG0_CR = BG_256_COLOR | BG_MAP_BASE(31) | BG_TILE_BASE(4);
<br/>
   SUB_BG3_CR = BG_BMP8_256x256 | BG_PRIORITY(3)
<br/>
<br/>
(Does the usual scaling code for the the Mode 5 stuff on BG3)
<br/>
<br/>
consoleInit((uint16 *)pBuffer, (uint16 *)CHAR_BASE_BLOCK_SUB(4), 95, 32, (uint16 *)SCREEN_BASE_BLOCK_SUB(31), 0, 8)
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Let me see if I read this correctly.  BG3 is for the background pbi files, and BG0 is primarily the text layer.  BG3 gets priority so it'll get drawn first, followed by BG0 on top.  
<br/>
<br/>
So looking at the BG0 Control Register setup, the  layer is 256 Color with the mapbase at 31 and tilebase is 4, so during consoleInit - pBuffer holds the the font bitmaps, 4 holds the fonts in VRAM_C, I got 95 characters starting at ASCII 32, it's going to Mapbase 31, Palette 0, 8 bit (256 color).  Correct?
<br/>
<br/>
So tilebase holds my font, and mapbase points back to the layer that I want the fonts to display at?
<br/>
<br/>
I tried to hack up the DrunkCoders 2D demo so it'll do 2 screens with the text console on top.  No dice, it seems.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#159473 - silent_code - Tue Jul 01, 2008 7:05 pm</h4>
    <div class="postbody"><span class="postbody">If I didn't misunderstand anything: Exactly. :^)
<br/>
<br/>
And thanks! :^D
<br/>
<br/>
PS: .pbi is my own crappy hackish "get it to work" format and by no means any standard, but better than raw data, I guess. ;^)
<br/>
<br/>
EDIT: What did you try? Could you post the relevant parts of the source? What exactly is not working?<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#159480 - ragefury32 - Tue Jul 01, 2008 9:44 pm</h4>
    <div class="postbody"><span class="postbody">I saw this from your code:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   // assigne video ram banks
<br/>
   vramSetBankA(VRAM_A_TEXTURE_SLOT0);
<br/>
   vramSetBankB(VRAM_B_TEXTURE_SLOT1);
<br/>
   vramSetBankC(VRAM_C_SUB_BG_0x06260000);
<br/>
   vramSetBankD(VRAM_D_LCD);      // The captured image will be put here, so it *must* be set to LCD mode
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
But I can't for the life of me figure out why VRAM_C_SUB_BG is set to 0x06260000 instead of 0x06200000.
<br/>
<br/>
Okay.  So basically, I tried towhat I did was to hack up one of the Drunkcoders.org 2D demos.  Here's what I was trying to do:
<br/>
<br/>
a) Top screen is standard 2D Mode 5, background loaded on BG3.  
<br/>
b) Bottom screen is Mode 5, background on BG3, text on BG0.
<br/>
<br/>
I figured that this should work if 0 gets priority over 3.
<br/>
<br/>
For some reason, the code didn't exactly work.  You can kind of see the background image, but it seems that layer 0 seems to overwrite it with crap.  Is that an issue with the default font, or did I really screw something up here?
<br/>
<br/>
Here's a screenshot from iDeaS:
<br/>
<br/>
<a href="http://aculei.net/~ragefury/Files/Hope-AMD/screenshot2.png">[Images not permitted - Click here to view it]</a>
<br/>
<br/>
And here is the code I cooked up - 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
#include &lt;nds.h&gt;
<br/>
#include &lt;stdio.h&gt;
<br/>
<br/>
// git adds a nice header we can include to access the data
<br/>
// this has the same name as the image
<br/>
<br/>
#include "drunkenlogo.h"
<br/>
<br/>
int main(void)
<br/>
{
<br/>
   // irqs are nice
<br/>
   irqInit();
<br/>
   irqSet(IRQ_VBLANK, 0);
<br/>
<br/>
    // set the mode for 2 text layers and two extended background layers
<br/>
   videoSetMode(MODE_5_2D | DISPLAY_BG3_ACTIVE);
<br/>
<br/>
   // set the sub background up for text display (we could just print to one
<br/>
   // of the main display text backgrounds just as easily
<br/>
   videoSetModeSub(MODE_5_2D | DISPLAY_BG0_ACTIVE | DISPLAY_BG3_ACTIVE); //sub bg 0 will be used to print text
<br/>
<br/>
    // set the first bank as background memory and the third as sub background memory
<br/>
    // B and D are not used
<br/>
    vramSetMainBanks(VRAM_A_MAIN_BG_0x06000000, VRAM_B_LCD,
<br/>
                      VRAM_C_SUB_BG_0x06200000, VRAM_D_LCD);
<br/>
<br/>
    
<br/>
   
<br/>
   BG_PALETTE_SUB[255] = RGB15(31,31,31);//by default font will be rendered with color 255
<br/>
<br/>
   // consoleInit() is a lot more flexible but this gets you up and running quick
<br/>
<br/>
   BG3_CR = BG_BMP8_256x256 | BG_PRIORITY(3);
<br/>
   SUB_BG0_CR = BG_MAP_BASE(31) | BG_PRIORITY(0);
<br/>
    SUB_BG3_CR = BG_BMP8_256x256;
<br/>
<br/>
<br/>
   consoleInitDefault((u16*)SCREEN_BASE_BLOCK_SUB(31), (u16*)CHAR_BASE_BLOCK_SUB(0), 16);
<br/>
<br/>
   iprintf("\n\n\tHello DS developers\n");
<br/>
   iprintf("\twww.drunkencoders.com\n");
<br/>
   iprintf("\t256 color bitmap demo");
<br/>
  
<br/>
   // set up our bitmap background
<br/>
<br/>
   dmaCopy(drunkenlogoBitmap, BG_GFX, 256*256);
<br/>
   dmaCopy(drunkenlogoPal, BG_PALETTE, 256*2);
<br/>
<br/>
   // these are rotation backgrounds so you must set the rotation attributes:
<br/>
    // these are fixed point numbers with the low 8 bits the fractional part
<br/>
    // this basicaly gives it a 1:1 translation in x and y so you get a nice flat bitmap
<br/>
        BG3_XDX = 1 &lt;&lt; 8;
<br/>
        BG3_XDY = 0;
<br/>
        BG3_YDX = 0;
<br/>
        BG3_YDY = 1 &lt;&lt; 8;
<br/>
    // our bitmap looks a bit better if we center it so scroll down (256 - 192) / 2
<br/>
        BG3_CX = 0;
<br/>
        BG3_CY = 32 &lt;&lt; 8;
<br/>
<br/>
<br/>
   dmaCopy(drunkenlogoBitmap, BG_GFX_SUB, 256*256);
<br/>
   dmaCopy(drunkenlogoPal, BG_PALETTE_SUB, 256*2);
<br/>
<br/>
       SUB_BG3_XDX = 1 &lt;&lt; 8;
<br/>
        SUB_BG3_XDY = 0;
<br/>
        SUB_BG3_YDX = 0;
<br/>
        SUB_BG3_YDY = 1 &lt;&lt; 8;
<br/>
<br/>
    // our bitmap looks a bit better if we center it so scroll down (256 - 192) / 2
<br/>
        SUB_BG3_CX = 0;
<br/>
        SUB_BG3_CY = 32 &lt;&lt; 8;
<br/>
<br/>
    while(1)swiWaitForVBlank();
<br/>
<br/>
   return 0;
<br/>
}
<br/>
<br/>
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#159561 - ragefury32 - Wed Jul 02, 2008 6:07 pm</h4>
    <div class="postbody"><span class="postbody">Never mind.  I figured it out - I think the DMA copy demolished BG0.  
<br/>
<br/>
I reversed the order so the background gets copied in first (this is fine as it is a static background), and then the ConsoleDefaultInit() kicks in afterwards.
<br/>
<br/>
I still don't know WHY silentCode's demo uses 0x0626000 as the base for BG0 though.  Is it because of TileBase(4) used for the custom font load?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#159573 - silent_code - Wed Jul 02, 2008 6:54 pm</h4>
    <div class="postbody"><span class="postbody">Duh, I really don't remember, it's been nearly (or even over) a year I have set that up... I'd say "Because it works"... but your guess sounds quite convincing. :^)
<br/>
No really, I think it was because I was getting garbage all the time and then figured out that using an offset fixed it.<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#159578 - elhobbs - Wed Jul 02, 2008 7:23 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ragefury32 wrote:</b></span></td> </tr> <tr> <td class="quote">Never mind.  I figured it out - I think the DMA copy demolished BG0.  
<br/>
<br/>
I reversed the order so the background gets copied in first (this is fine as it is a static background), and then the ConsoleDefaultInit() kicks in afterwards.
<br/>
<br/>
I still don't know WHY silentCode's demo uses 0x0626000 as the base for BG0 though.  Is it because of TileBase(4) used for the custom font load?</td> </tr></table><span class="postbody">consoleDemoInit which maps VRAM_C to 0x06200000 and puts the map at 31*2048 and the tiles at 0. so you are already using 6200000-620ffff for the console. you are then mapping the background to 0x6200000. so they overlap.
<br/>
<br/>
this is the configuration that I would recommend:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
//set the tiles at 6200000
<br/>
//the the map at 6207800
<br/>
SUB_BG0_CR = BG_32x32 | BG_COLOR_16 | BG_MAP_BASE(15) | BG_TILE_BASE(0) | BG_PRIORITY_0; 
<br/>
BG_PALETTE_SUB[0]=0;
<br/>
BG_PALETTE_SUB[255]=0xff00;
<br/>
consoleInitDefault((u16*)SCREEN_BASE_BLOCK_SUB(15), (u16*CHAR_BASE_BLOCK_SUB(0), 16);
<br/>
<br/>
//set the sub bg3 at 6208000
<br/>
SUB_BG3_CR = BG_BMP8_256x256 | BG_TILE_BASE(2) | BG_PRIORITY_1;
<br/>
SUB_BG3_XDX = 1&lt;&lt;8;
<br/>
SUB_BG3_YDY = 1&lt;&lt;8;
<br/>
SUB_BG3_XDY = 0;
<br/>
SUB_BG3_YDX = 0;
<br/>
SUB_BG3_CX = 0;
<br/>
SUB_BG3_CY = 0;
<br/>
<br/>
//move the background image into bg3
<br/>
dmaCopy(drunkenlogoBitmap, BG_BMP_RAM_SUB(2), 256*256); 
<br/>
dmaCopy(drunkenlogoPal, BG_PALETTE, 256*2); 
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#159636 - ragefury32 - Thu Jul 03, 2008 11:32 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>elhobbs wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ragefury32 wrote:</b></span></td> </tr> <tr> <td class="quote">Never mind.  I figured it out - I think the DMA copy demolished BG0.  
<br/>
<br/>
I reversed the order so the background gets copied in first (this is fine as it is a static background), and then the ConsoleDefaultInit() kicks in afterwards.
<br/>
<br/>
I still don't know WHY silentCode's demo uses 0x0626000 as the base for BG0 though.  Is it because of TileBase(4) used for the custom font load?</td> </tr></table><span class="postbody">consoleDemoInit which maps VRAM_C to 0x06200000 and puts the map at 31*2048 and the tiles at 0. so you are already using 6200000-620ffff for the console. you are then mapping the background to 0x6200000. so they overlap.
<br/>
<br/>
this is the configuration that I would recommend:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
//set the tiles at 6200000
<br/>
//the the map at 6207800
<br/>
SUB_BG0_CR = BG_32x32 | BG_COLOR_16 | BG_MAP_BASE(15) | BG_TILE_BASE(0) | BG_PRIORITY_0; 
<br/>
BG_PALETTE_SUB[0]=0;
<br/>
BG_PALETTE_SUB[255]=0xff00;
<br/>
consoleInitDefault((u16*)SCREEN_BASE_BLOCK_SUB(15), (u16*CHAR_BASE_BLOCK_SUB(0), 16);
<br/>
<br/>
//set the sub bg3 at 6208000
<br/>
SUB_BG3_CR = BG_BMP8_256x256 | BG_TILE_BASE(2) | BG_PRIORITY_1;
<br/>
SUB_BG3_XDX = 1&lt;&lt;8;
<br/>
SUB_BG3_YDY = 1&lt;&lt;8;
<br/>
SUB_BG3_XDY = 0;
<br/>
SUB_BG3_YDX = 0;
<br/>
SUB_BG3_CX = 0;
<br/>
SUB_BG3_CY = 0;
<br/>
<br/>
//move the background image into bg3
<br/>
dmaCopy(drunkenlogoBitmap, BG_BMP_RAM_SUB(2), 256*256); 
<br/>
dmaCopy(drunkenlogoPal, BG_PALETTE, 256*2); 
<br/>
</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
<br/>
Hm.  I tried that...were you trying to move the DMACopy in the lower screen to BG_BMP_RAM_SUB(2) (which requires an integer pointer cast)?  When I tried the code the DMACopy on the lower screen will still clobber BG0.  In fact, the only thing that moving the DMACopy on the lower screen SEEMS to do is to move the  bitmap up.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#159639 - elhobbs - Thu Jul 03, 2008 1:46 pm</h4>
    <div class="postbody"><span class="postbody">this is what I get for not testing my code. I used the wrong macro for setting up bg3
<br/>
<br/>
change
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
SUB_BG3_CR = BG_BMP8_256x256 | BG_TILE_BASE(2) | BG_PRIORITY_1; 
<br/>
</td> </tr></table><span class="postbody">
<br/>
to
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
SUB_BG3_CR = BG_BMP8_256x256 | BG_BMP_BASE(2) | BG_PRIORITY_1; 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
sorry about that. I tested it and it really works this time. to avoid further confusion here is the entire code I used:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include &lt;nds.h&gt; 
<br/>
#include &lt;stdio.h&gt; 
<br/>
<br/>
// git adds a nice header we can include to access the data 
<br/>
// this has the same name as the image 
<br/>
<br/>
#include "drunkenlogo.h" 
<br/>
<br/>
int main(void) 
<br/>
{ 
<br/>
   // irqs are nice 
<br/>
   irqInit(); 
<br/>
   irqSet(IRQ_VBLANK, 0); 
<br/>
<br/>
    // set the mode for 2 text layers and two extended background layers 
<br/>
   videoSetMode(MODE_5_2D | DISPLAY_BG3_ACTIVE); 
<br/>
<br/>
   // set the sub background up for text display (we could just print to one 
<br/>
   // of the main display text backgrounds just as easily 
<br/>
   videoSetModeSub(MODE_5_2D | DISPLAY_BG0_ACTIVE | DISPLAY_BG3_ACTIVE); //sub bg 0 will be used to print text 
<br/>
<br/>
    // set the first bank as background memory and the third as sub background memory 
<br/>
    // B and D are not used 
<br/>
    vramSetMainBanks(VRAM_A_MAIN_BG_0x06000000, VRAM_B_LCD, 
<br/>
                      VRAM_C_SUB_BG_0x06200000, VRAM_D_LCD); 
<br/>
<br/>
    
<br/>
    
<br/>
//set the tiles at 6200000 
<br/>
//the the map at 6207800 
<br/>
SUB_BG0_CR = BG_32x32 | BG_COLOR_16 | BG_MAP_BASE(15) | BG_TILE_BASE(0) | BG_PRIORITY_0; 
<br/>
BG_PALETTE_SUB[0]=0; 
<br/>
BG_PALETTE_SUB[255]=0xff00; 
<br/>
consoleInitDefault((u16*)SCREEN_BASE_BLOCK_SUB(15), (u16*)CHAR_BASE_BLOCK_SUB(0), 16); 
<br/>
<br/>
//set the sub bg3 at 6208000 
<br/>
SUB_BG3_CR = BG_BMP8_256x256 | BG_BMP_BASE(2) | BG_PRIORITY_1; 
<br/>
SUB_BG3_XDX = 1&lt;&lt;8; 
<br/>
SUB_BG3_YDY = 1&lt;&lt;8; 
<br/>
SUB_BG3_XDY = 0; 
<br/>
SUB_BG3_YDX = 0; 
<br/>
SUB_BG3_CX = 0; 
<br/>
SUB_BG3_CY = 0; 
<br/>
<br/>
//move the background image into bg3 
<br/>
dmaCopy(drunkenlogoBitmap,(void*) BG_BMP_RAM_SUB(2), 256*256); 
<br/>
dmaCopy(drunkenlogoPal, BG_PALETTE_SUB, 256*2);
<br/>
<br/>
iprintf("Hello World\n"); 
<br/>
<br/>
    while(1)swiWaitForVBlank(); 
<br/>
<br/>
   return 0; 
<br/>
} 
<br/>
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#159734 - ragefury32 - Sat Jul 05, 2008 3:40 pm</h4>
    <div class="postbody"><span class="postbody">Okay, so basically, you are pushing the starting address of SUB_BG0 from BG_MAP_BASE(31) to BG_MAP_BASE(15) (essentially pushing it up in memory) and SUB_BG3 to start from BG_MAP_BASE(0) to BG_MAP_BASE(2) so it can allocate the memory space for the text console.
<br/>
<br/>
So if I read this correctly, the base units are 2k each, so you are essentially moving the SUB_BG0's memory allocation up 32k, and SUB_BG3 down 4K, freeing up 36k for the console.  Is that right?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#159749 - elhobbs - Sun Jul 06, 2008 4:21 am</h4>
    <div class="postbody"><span class="postbody">not exactly. you are correct about the map base units, the slots are 2k for the text background slot size for the character map. the character tile base uses a 16k slot size though. the console is located in the first 32k of sub background memory. the bitmap background slot size if 16k. so slot 2 is at 32k. If you cheat a little this leaves enough room in VRAM_C for another 256 color bitmap sub background at slot 5. this would actually overlap the two 256 color 256x256 bitmaps, but if you only use 256x192 bytes for each with no scrolling then you wont have an issue.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
