<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>DS memory questions - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > DS memory questions</h2>
<div id="posts">
<div class="post">
    <h4>#117159 - Balkman - Fri Feb 02, 2007 12:38 am</h4>
    <div class="postbody"><span class="postbody">I've done plenty of game programming on a PC using both Direct X and OpenGL, so I understand the basics of game programming and logic. So feel free to get into detail with any responses. The following questions are ones that deal specifically with the hardware of the NDS. 
<br/>
<br/>
1) I need a ton of sprite data to be loaded all at once. Can sprite data be read and displayed from main memory, or does it have to be sitting in a VRAM bank? I am asking this because I need more video memory than the four 128k banks (A-D) provided. 
<br/>
<br/>
2) What are the smaller VRAM banks E-I generally used for? Can I use them for the background?
<br/>
<br/>
3) The OAM has a limit of 128 unique sprites. I haven't done 2D animation on the DS yet, but is each frame going to count as one of these 128? Or can I have 128 animating sprites at once? 
<br/>
<br/>
(I've done 2D sprite animation in Direct X before, is it basically the same logic?â€¦ large sprite sheet with all frames on it, and move the index around?) 
<br/>
<br/>
4) There is an OAM Main, and OAM Sub, both of which are large enough to hold data for 128 sprites. Does this mean I can have a total of 256? If not, what is the purpose of the sub OAM and the sub Palette? 
<br/>
<br/>
5) Does the DS do anything special when you dynamically allocate memory? Is there a special way it handles heap memory? Or does it just use a piece of the 4MB main memory?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117164 - tepples - Fri Feb 02, 2007 12:54 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Balkman wrote:</b></span></td> </tr> <tr> <td class="quote">I've done plenty of game programming on a PC using both Direct X and OpenGL, so I understand the basics of game programming and logic. So feel free to get into detail with any responses. The following questions are ones that deal specifically with the hardware of the NDS. 
<br/>
<br/>
1) I need a ton of sprite data to be loaded all at once. Can sprite data be read and displayed from main memory, or does it have to be sitting in a VRAM bank? I am asking this because I need more video memory than the four 128k banks (A-D) provided.</td> </tr></table><span class="postbody">
<br/>
Yes, you can copy each frame of animation from main memory to VRAM. If you have a 32x32 pixel sprite in 256 colors, reserve a 1024 byte block of VRAM and then copy each frame in as needed. My <a class="postlink" href="http://www.pineight.com/gba/#docs" target="_blank">guide to sprite cel VRAM</a> was written for the GBA, but the techniques still apply to the DS.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">2) What are the smaller VRAM banks E-I generally used for? Can I use them for the background?</td> </tr></table><span class="postbody">
<br/>
Mostly sub-screen stuff while the main screen is in 3D mode using VRAM for textures.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">3) The OAM has a limit of 128 unique sprites. I haven't done 2D animation on the DS yet, but is each frame going to count as one of these 128? Or can I have 128 animating sprites at once?</td> </tr></table><span class="postbody">
<br/>
You can have 128 animating sprites at once on each screen. Each sprite struct contains (at least) an X coordinate, a Y coordinate, and an index into the sprite sheet. Using one 128 KiB bank of VRAM, you can have each sprite displaying a different 32x32 pixel cel and still animate each cel of each sprite separately.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">4) There is an OAM Main, and OAM Sub, both of which are large enough to hold data for 128 sprites. Does this mean I can have a total of 256? If not, what is the purpose of the sub OAM and the sub Palette? </td> </tr></table><span class="postbody">
<br/>
Main is one 2D core and sub is the other. The major difference between the two cores is that main can replace one of the backgrounds with a 3D (pseudo OpenGL) layer, using the other three layers as a HUD and/or skyplane. You can send main to the top screen or to the touch screen using lcdMainOnTop() or lcdMainOnBottom().
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">5) Does the DS do anything special when you dynamically allocate memory? Is there a special way it handles heap memory? Or does it just use a piece of the 4MB main memory?</td> </tr></table><span class="postbody">
<br/>
malloc() just uses part of the main memory.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117173 - dannyboy - Fri Feb 02, 2007 1:34 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Balkman wrote:</b></span></td> </tr> <tr> <td class="quote">2) What are the smaller VRAM banks E-I generally used for? Can I use them for the background?</td> </tr></table><span class="postbody">
<br/>
<br/>
<a class="postlink" href="http://www.drunkencoders.com/documents/DS/ndslib.htm" target="_blank">This page</a> has all the information for what each RAM bank can be used for. In particular though, BANK E is 64KB and can be used for a 256*192 8 bit background for the main screen. Bank H and I can be used for the sub background, but they only total 48KB. So you either compromise on the size or the colour depth.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Balkman wrote:</b></span></td> </tr> <tr> <td class="quote">4) There is an OAM Main, and OAM Sub, both of which are large enough to hold data for 128 sprites. Does this mean I can have a total of 256? If not, what is the purpose of the sub OAM and the sub Palette?</td> </tr></table><span class="postbody">
<br/>
The DS has two screens. So it's 128 sprites per screen.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117177 - tepples - Fri Feb 02, 2007 2:13 am</h4>
    <div class="postbody"><span class="postbody">And if you need more than 128 sprites at once, such as if you are developing a DoDonPachi clone, you can use horizontal blanking time to load a new display list into OAM.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117182 - Goosey - Fri Feb 02, 2007 3:04 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">And if you need more than 128 sprites at once, such as if you are developing a DoDonPachi clone, you can use horizontal blanking time to load a new display list into OAM.</td> </tr></table><span class="postbody">
<br/>
<br/>
Or use 3D Mode isometric projection and quads to simulate sprites.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117203 - HyperHacker - Fri Feb 02, 2007 10:00 am</h4>
    <div class="postbody"><span class="postbody">3D eats up more battery power though.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117214 - Vich - Fri Feb 02, 2007 12:29 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">3D eats up more battery power though.</td> </tr></table><span class="postbody">
<br/>
<br/>
Do you have any idea on how much more? (since this is quite interesting to know for my current project)<br/>_________________<br/>[<a class="postlink" href="http://www.lifeisdigital.net" target="_blank">project website</a>] [<a class="postlink" href="http://www.kenvanhoeylandt.net" target="_blank">personal website</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117270 - Balkman - Fri Feb 02, 2007 11:59 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Yes, you can copy each frame of animation from main memory to VRAM. If you have a 32x32 pixel sprite in 256 colors, reserve a 1024 byte block of VRAM and then copy each frame in as needed. My guide to sprite cel VRAM was written for the GBA, but the techniques still apply to the DS.</td> </tr></table><span class="postbody">
<br/>
<br/>
Yes this is good news. I thought I would have had to have all the frames of animation sitting in VRAM at all times. So aparently it's not slow to copy data from main memory to video ram on the DS each frame. I know this is unheard of on any type of PC game programming.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Or use 3D Mode isometric projection and quads to simulate sprites.</td> </tr></table><span class="postbody">
<br/>
<br/>
I like that idea, but I'm gonna stick with just 2d as this is my first DS project.
<br/>
<br/>
Thanks everyone for helping me out with this.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117283 - HyperHacker - Sat Feb 03, 2007 5:17 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Vich wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">3D eats up more battery power though.</td> </tr></table><span class="postbody">
<br/>
<br/>
Do you have any idea on how much more? (since this is quite interesting to know for my current project)</span></td> </tr></table><span class="postbody">
<br/>
No, but you could measure. On a full charge, have a program just do powerON(POWER_ALL_2D) and time how long it takes to kill the battery. Charge it again and do the same test with powerON(POWER_ALL).<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117414 - silent_code - Sun Feb 04, 2007 7:53 pm</h4>
    <div class="postbody"><span class="postbody">i don't believe it will be a too representative measuring. i guess the hardware has some logic that knows when it's in idle mode and it'll save power that way.
<br/>
<br/>
for an ideal measuring one had a game that uses the 2d core in one version and the 3d core in another, but the games are essentially the same. like when "emulating" 2d with 3d. only then will it be possible to know the difference in power consumption.
<br/>
<br/>
but, it's just a guess anyway.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
