<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>grit corrupting my image? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > grit corrupting my image?</h2>
<div id="posts">
<div class="post">
    <h4>#166859 - vuurrobin - Sat Feb 21, 2009 12:51 am</h4>
    <div class="postbody"><span class="postbody">hello
<br/>
<br/>
I was trying out WinterMute's <a class="postlink" href="http://forums.devkitpro.org/viewtopic.php?f=22&amp;t=17" target="_blank">Elevator Guide to Grit</a> on the devkitpro's forum, but some part of my image somehow gets corrupted. 
<br/>
<br/>
I posted the question there, but I'm reposting it here because there are more active people here.
<br/>
<br/>
here's the original message:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>vuurrobin wrote:</b></span></td> </tr> <tr> <td class="quote">hello
<br/>
<br/>
I'm trying to get this to work, but I'm having some troubles.
<br/>
<br/>
first I updated the code so it worked with the current libnds, and this was the result:
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include &lt;nds.h&gt;
<br/>
<br/>
#include "beerguy.h"
<br/>
<br/>
int main()
<br/>
{
<br/>
    powerOn(POWER_ALL_2D);
<br/>
<br/>
    // enable the main screen with background 0 active
<br/>
    videoSetMode(MODE_0_2D | DISPLAY_BG0_ACTIVE);
<br/>
<br/>
    // map bank A for use with the background
<br/>
    vramSetBankA(VRAM_A_MAIN_BG_0x06000000);
<br/>
<br/>
    // enable background 0 in 256 color mode with a 256x256 map
<br/>
    // BG_TILE_BASE changes the offset where tile data is stored
<br/>
    // BG_MAP_BASE gives the offset to the map data
<br/>
    //BGCTRL[0]
<br/>
    REG_BG0CNT = BG_TILE_BASE(0) | BG_MAP_BASE(4) | BG_COLOR_256 | BG_32x32; //| TEXTBG_SIZE_256x256;
<br/>
<br/>
<br/>
<br/>
    // use dma to copy the tile, map and palette data to VRAM
<br/>
    // CHAR_BASE_BLOCK gives us the actual address of the tile data
<br/>
    // SCREEN_BASE_BLOCK does the same thing for maps
<br/>
    // these should match the BG_TILE_BASE and BG_MAP base numbers above
<br/>
    dmaCopy(beerguyPal, BG_PALETTE, beerguyPalLen);
<br/>
    dmaCopy(beerguyTiles, (void *)CHAR_BASE_BLOCK(0), beerguyTilesLen);
<br/>
    dmaCopy(beerguyMap, (void *)SCREEN_BASE_BLOCK(4), beerguyMapLen);
<br/>
<br/>
    return 0;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
next I took a picture which I had from another project, added the grit rule file (without any modifications), and modified the makefile I had so it would work with bmp files (only the png part was in the makefile). I compiled the project without any problems. but when I tried running the program on no$gba and on hardware, a small part of the image got corrupted.
<br/>
<br/>
here is the original image:
<br/>
<a href="http://www.freewebs.com/vuurrobin/ds/beerguy.png">[Images not permitted - Click here to view it]</a>
<br/>
<br/>
and here is the result (created with no$gba screenshot option):
<br/>
<a href="http://www.freewebs.com/vuurrobin/ds/screenshot.png">[Images not permitted - Click here to view it]</a>
<br/>
<br/>
seeing as more than half of the image shows up normal, I doubt the problem is in the code. I think it has something to do with grit, but I have no idea what. I already try'd disabling tile reduction, but the problem is still there (the color changed from yelow to blue tho).
<br/>
<br/>
can someone help me?
<br/>
<br/>
also, the link to the project doesn't work anymore.</span></td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#166865 - Cearn - Sat Feb 21, 2009 10:47 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>vuurrobin wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
    REG_BG0CNT = BG_TILE_BASE(0) | BG_MAP_BASE(4) | BG_COLOR_256 | BG_32x32; 
<br/>
    ... 
<br/>
    dmaCopy(beerguyTiles, (void *)CHAR_BASE_BLOCK(0), beerguyTilesLen);
<br/>
    dmaCopy(beerguyMap, (void *)SCREEN_BASE_BLOCK(4), beerguyMapLen);
<br/>
<br/>
    return 0;
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
Charblock 0 and Screenblock 4 overlap. You're probably overwriting the tiles with the map. Try using screenblock 31.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
