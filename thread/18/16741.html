<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>How to detect a DS phat from a DS Lite - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > How to detect a DS phat from a DS Lite</h2>
<div id="posts">
<div class="post">
    <h4>#169283 - sonny_jim - Sat Jun 27, 2009 8:54 pm</h4>
    <div class="postbody"><span class="postbody">I'm currently writing a driver for DSLinux to change the backlight brightness, but I've found this in <a class="postlink" href="http://nocash.emubase.de/gbatek.htm#dspowermanagement" target="_blank">gbatek:</a>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
On Old-DS, registers 4..7Fh are mirrors of 0..3. On DS-Lite, registers 5,6,7 are mirrors of 4, register 8..7Fh are mirrors of 0-7.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
This means if I try and change the brightness on a DS phat, it turns the speakers off.  How does homebrew that uses backlight controls detect if it's running on a DS Lite?  By comparing registers?
<br/>
<br/>
Apologies if this is a common question, a quick search didn't throw up anything useful.<br/>_________________<br/></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Would that be the internet driver for the program?
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#169285 - Ludo6431 - Sat Jun 27, 2009 10:35 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">[...]
<br/>
&lt;mukunda&gt; Ludo6431, the spi registers have some stuff that's different
<br/>
&lt;Ludo6431&gt; mukunda, yep, but what ? :)
<br/>
&lt;mukunda&gt; "Bit4-7 Unknown (Always 4) (Read-Only)"
<br/>
&lt;mukunda&gt; in the register that controls the backlight brightness
<br/>
&lt;mukunda&gt; on phat ds it wont be 4, since it will be a mirror of register 0
<br/>
&lt;Ludo6431&gt; oh yes !
<br/>
&lt;mukunda&gt; and 4 of register 0 is the shutdown bit
<br/>
&lt;Ludo6431&gt; thanks a lot !
<br/>
&lt;mukunda&gt; np</td> </tr></table><span class="postbody"><br/>_________________<br/>Sorry for my poor english, I'm french.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#169288 - AxemRed - Sun Jun 28, 2009 8:12 am</h4>
    <div class="postbody"><span class="postbody">I use this on the ARM7 side:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">isOldDS = !(readPowerManagement(4) &amp; BIT(6));
<br/>
backlight = isOldDS ? 3 : readPowerManagement(4);
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#169291 - SteveH - Sun Jun 28, 2009 6:03 pm</h4>
    <div class="postbody"><span class="postbody">I've just done a little experiment on my DSL and DSi (I no longer have a DSphat to play with)
<br/>
<br/>
My little app I wrote just gets the values from the 8 power management registers and outputs the results.
<br/>
<br/>
DSlite:
<br/>
<br/>
0 - 0d
<br/>
1 - 00
<br/>
2 - 00
<br/>
3 - 01
<br/>
4 - 43
<br/>
5 - 43
<br/>
6 - 43
<br/>
7 - 43
<br/>
<br/>
As per the docs - Registers 5-7 are mirroring register 4, and the high nibble is 4.
<br/>
<br/>
Now onto the DSi:
<br/>
<br/>
0 - 0f
<br/>
1 - 00
<br/>
2 - 00
<br/>
3 - 01
<br/>
4 - 41
<br/>
5 - 00
<br/>
6 - 00
<br/>
7 - 00
<br/>
<br/>
As you can see registers 5-7 are not mirroring register 4...
<br/>
<br/>
So from the above the following test could be ran on an arm7:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
u8 dsGen = 0;
<br/>
<br/>
if( readPowerManagement(4) &amp; BIT(6) )
<br/>
  dsGen++;
<br/>
<br/>
if( readPowerManagement(4) == readPowerManagement(5) )
<br/>
  dsGen++;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
If the above code was ran on the ARM7 the value of dsGen would be:
<br/>
<br/>
phat - 0
<br/>
DSi - 1
<br/>
lite - 2
<br/>
<br/>
Another thing I spotted is that the Sound Amplifier Mute (bit 1 of register 0) is 1 on the DSi, but it is always 0 on a lite (again from the GBAtec docs).
<br/>
<br/>
I can not say that the above is 100% correct as I only have access to one DSi and one DSlite, I used the Ez Flash Vi cart for my testing, so again this may be down to a cart issue.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#169292 - dantheman - Sun Jun 28, 2009 9:08 pm</h4>
    <div class="postbody"><span class="postbody">If you can find the source to Lick's "LoveLite" program, that may be useful.  On my DS Phat, it merely toggles the backlight, while on a DS Lite it changes the brightness settings.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#169303 - sonny_jim - Tue Jun 30, 2009 12:48 pm</h4>
    <div class="postbody"><span class="postbody">Cool, thanks for the replies.  Once I've got this backlight driver working I'm going to try and get my DSerial working with DSLinux (*gulp*).<br/>_________________<br/></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Would that be the internet driver for the program?
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
