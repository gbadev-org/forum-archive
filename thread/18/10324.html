<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Communication Hardware - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Communication Hardware</h2>
<div id="posts">
<div class="post">
    <h4>#92095 - entilzha - Tue Jul 11, 2006 4:11 pm</h4>
    <div class="postbody"><span class="postbody">Hi guys,
<br/>
<br/>
Currently I'm looking into using the DS as an embedded system in a hobby robot. I tried it with the GBA earlier, which worked nicely. Back then I used the communication port of the GBA in general purpose mode, and programmed it to talk I2C to the rest of the robot.
<br/>
<br/>
Thinking about maybe building a new robot, it is time for a new challenge. The DS poses the interesting option of WiFi communication for wireless robot control, especially since I understand WiFi-lib now supports TCP. Not having a DS yet, I was wondering if this is a feasible project. It leaves 2 questions open to me:
<br/>
<br/>
* Would WiFi-lib enable me to send TCP/IP messages to the DS? Does the DS accept messages from random computers?
<br/>
<br/>
* How am I gonna control the robot itself? It will have some microprocessors taking care of things, which I will have to interface with. I understand the com-port now only exists in software. Does it still exist in hardware pins somewhere, meaning I should get my soldering iron and start hacking? Or is it really gone?
<br/>
And also: does the SPI interface leave me any options? Does anybody know what would happen if I set the device bits in the REG_SPICNT to 3 (prohibited)? Maybe I could make my own device there? Or maybe I could share a line with the microphone or something?
<br/>
<br/>
Thanx in advance for your tips/suggestions..</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#92312 - HyperHacker - Wed Jul 12, 2006 7:21 pm</h4>
    <div class="postbody"><span class="postbody">If you install FlashMe, you can use the DS card slot as a sort of serial port.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#92384 - entilzha - Thu Jul 13, 2006 8:38 am</h4>
    <div class="postbody"><span class="postbody">Wow.. That would be amazing.. I wouldn't have though of that one.. so that would mean modding an sd card. Not too shabby, as I would be using the gba slot to hold the program cartridge.
<br/>
<br/>
Any docs/threads/hints on how this can be done?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#92391 - TheRain - Thu Jul 13, 2006 9:14 am</h4>
    <div class="postbody"><span class="postbody">Natrium42's SerialMe which requires Passme hardware and programming a CPLD to function...
<br/>
<br/>
<a href="http://www.natrium42.com/projects/serial.html" target="_blank">http://www.natrium42.com/projects/serial.html</a>
<br/>
<br/>
this fellow succesfully interfaced a SPI camera to the DS ( full source code is downloadable toward the bottom)
<br/>
<br/>
<a href="http://www.kako.com/neta/2006-011/2006-011.html" target="_blank">http://www.kako.com/neta/2006-011/2006-011.html</a>
<br/>
<br/>
Darkfader has documented the physical specs of the card slot and his page has PCB layouts of all sorts
<br/>
<a href="http://darkfader.net/ds/" target="_blank">http://darkfader.net/ds/</a>
<br/>
DS Card Slot Pinout
<br/>
<a href="http://df.groovyness.com/darkfader.net/ds/files/cartridge.txt" target="_blank">http://df.groovyness.com/darkfader.net/ds/files/cartridge.txt</a>
<br/>
<br/>
nerdofnerds and I are working on MIDI for the DS so we're collecting information on this too.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#92400 - masscat - Thu Jul 13, 2006 10:46 am</h4>
    <div class="postbody"><span class="postbody">Does anybody know where you can get DS cartridge slot prototype boards from (like those used in the SPI camera project or similar)?
<br/>
<br/>
EDIT: Just read the website off the picture of the board (kako.com) so I imagine they had them made up themself.
<br/>
<br/>
On the wireless side of things, at the moment the DS requires an AP to associate with but after that any computer can talk to it. The DS is capable of being an AP but the wireless library does not support it yet (I am not sure it is understood how to setup the ds hardware for this).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93310 - KeithE - Tue Jul 18, 2006 3:07 pm</h4>
    <div class="postbody"><span class="postbody">Thank you thank you thank you for this topic, and for the links to the SPI camera!
<br/>
<br/>
With the information there, I was able to interface a tri-axis accelerometer to the DS through the SPI EEPROM interface in the DS card slot.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93363 - entilzha - Tue Jul 18, 2006 8:09 pm</h4>
    <div class="postbody"><span class="postbody">Congratulations! 
<br/>
<br/>
That Japanese site from the camera-interface is incomprehensible, but the code is not too hard to understand, just like his schematic..
<br/>
<br/>
I have to agree with masscat though, how do I get a special insert for the DS slot? There is an etching kit available to me, but I'd prefer to stay away from it if that's possible (I'm no hero with chemicals). Did you take an already existing DS cart and mod it, or did you make your own insert?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93369 - entilzha - Tue Jul 18, 2006 8:28 pm</h4>
    <div class="postbody"><span class="postbody">The key thing is this Japanese guy somehow knows the registers for SPI interfacing with the savegame EEPROM. These aren't mentioned in the DSTek. Maybe he dove into the ARM-9 documentation or something? Maybe he just tried out some registers..
<br/>
<br/>
Anyway, apparently there is another SPI port available for interfacing with the savegame EEPROM on registers
<br/>
<br/>
0x040001A0 (CONTROL)
<br/>
0x040001A2 (DATA)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93381 - masscat - Tue Jul 18, 2006 9:52 pm</h4>
    <div class="postbody"><span class="postbody">There is some information about the registers on the <a class="postlink" href="http://www.bottledlight.com/ds/index.php/Hardware/CardRegisters" target="_blank">NDSTech Wiki</a>.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93383 - KeithE - Tue Jul 18, 2006 10:03 pm</h4>
    <div class="postbody"><span class="postbody">I used the NDSTech wiki to help me understand the registers.  Also, the temperature sensor code linked to from the SPI camera showed me how to send multiple bytes of data without raising chip select between each byte.
<br/>
<br/>
I hacked up a DS game, bought for $9.99 at the local video game store, using the diagram on <a class="postlink" href="http://akkit.org/DS/index.html" target="_blank">akkit.org</a> for reference.
<br/>
<br/>
And I didn't follow the schematic on the SPI camera site - I connected my sensor to pins 2, 6, 15, and 16 of the DS card (CLK, CS, MISO, MOSI).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93466 - entilzha - Wed Jul 19, 2006 10:03 am</h4>
    <div class="postbody"><span class="postbody">ok, nice. I assume you just removed both the game chip and the EEPROM?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93480 - KeithE - Wed Jul 19, 2006 1:50 pm</h4>
    <div class="postbody"><span class="postbody">That is correct - I desoldered both the chips, and soldered wires from my sensor to the proper via holes on the PCB.  I left the capacitors on the board - I didn't trace what they were connected to but they don't seem to hurt anything.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93483 - dovoto - Wed Jul 19, 2006 2:25 pm</h4>
    <div class="postbody"><span class="postbody">I highly recomend
<br/>
<br/>
<a class="postlink" href="http://www.charmedlabs.com" target="_blank">www.charmedlabs.com</a>
<br/>
<br/>
I have been using it for the last 3 years or so and is by far the most ureful device i have ever purchased.  Works great on ds and gba.  It does use the gba cart bus as apposed to the ds cart bus but I personaly dont see that as an issue.<br/>_________________<br/><a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93524 - TheRain - Wed Jul 19, 2006 6:15 pm</h4>
    <div class="postbody"><span class="postbody">Hey dovoto... does that thing have a slot on it to plug in a flash cart with it??  or how do you run your code?? 
<br/>
<br/>
Anyhow... if anyone's interested, I succeded at getting MIDI to transmit from the DS.   MIDI, btw, is a serial protocol operating at 32,125 baud and sending three bytes at a time with start and stop bits... so 30 bits in total for a MIDI message.    The code I wrote was derived from natrium's SerialMe code, but does not require a CPLD at the card slot... data is sent directly from pin 16...   here's my MIDI .h file:
<br/>
<a href="http://www.collinmeyermusic.com/dsmidi/dsmidi.h" target="_blank">http://www.collinmeyermusic.com/dsmidi/dsmidi.h</a>
<br/>
you may want to invert the bytes sent (HIGH to LOW, LOW to HIGH) if you are working with some other protocol.  You can see my notes in the .h file where I changed natrium's code in order to invert my bits because MIDI bits are inverted in level. 
<br/>
and my extreeeemly complicated (joking) schematic:
<br/>
<a href="http://www.collinmeyermusic.com/dsmidi/dsmidischematic.jpg">[Images not permitted - Click here to view it]</a>
<br/>
<br/>
I did similarly to what KeithE did, deconstructed a card and just soldered wires to it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93542 - dovoto - Wed Jul 19, 2006 8:22 pm</h4>
    <div class="postbody"><span class="postbody">It has 4MB of onboard flash mapped to the gba cart.  This has been more than enough for anything I have done (although some homebrew is too big to fit).  You can suppliment the memory with something like an MK2 cheaply enough though.  
<br/>
<br/>
The fact that it has an onboard fpga with 60 or so io ports (and 16MB of ram if you opt for that version) is pretty awesome for any homebrew robotics project or even as a general purpose FPGA development board.
<br/>
<br/>
99% of the time it is just my gba flash card for ds homebrew deving (I dont have to take it out of the DS to flash it is the main reason...it also does full coms with the pc via the cable).<br/>_________________<br/><a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93545 - KeithE - Wed Jul 19, 2006 8:36 pm</h4>
    <div class="postbody"><span class="postbody">That midi project looks pretty cool.  What have you used it for?
<br/>
<br/>
I decided to use the DS card bus instead of the charmed labs Xport for 2 reasons: 1 - I don't want to buy one.  2 - I'd like to make a device that anyone can use without having to buy extra hardware to support it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93579 - TheRain - Wed Jul 19, 2006 11:45 pm</h4>
    <div class="postbody"><span class="postbody">Thanks Keith...
<br/>
<br/>
So far, the only app i have created with it is on my dev blog <a href="http://www.collinmeyermusic.com/dev/" target="_blank">http://www.collinmeyermusic.com/dev/</a>      it's just an X/Y touchpad controller that sends out MIDI Continuous Control messages based on your screen touches.    
<br/>
<br/>
Currently I am working towards a step sequencer with mod sequencing as well.... but learning enough about the DS to create a nice, skinned looking interface and some eye candy is the biggest hurdle I have to that.   Well, that and I still need to think through the sequencer timing issues.   
<br/>
<br/>
As an aside, MIDI is designed as a music systems communication protocol... but I wanted to note that the specification can be used for all manner of other hardware designs as a control specification.. though if you are to be MIDI compatible 32,125 baud is the max speed of transfer.  
<br/>
<br/>
I think that device that dovoto's talking about looks REALLY cool, if a bit hefty of a package...    I can't wait for DSerial though,  I hope natrium get's it working soon.  <a href="http://www.natrium42.com/blog/?p=38#comments" target="_blank">http://www.natrium42.com/blog/?p=38#comments</a>
<br/>
<br/>
Something I think would be really slick is a touch screen interface to something that is like stepper motor or servo controlled... maybe even where what's on screen is a slick looking graphical representation of what you're controlling with smooth touch screen control.   =)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
