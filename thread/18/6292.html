<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>ARM-PDA to NDS portation problem - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > ARM-PDA to NDS portation problem</h2>
<div id="posts">
<div class="post">
    <h4>#47812 - Mighty Max - Wed Jul 13, 2005 8:58 pm</h4>
    <div class="postbody"><span class="postbody">Hello,
<br/>
<br/>
i am currently working with some mates on the portation of an XStrong PDA application to the DS. As the XStrong is already a ARM microprocessor, this shouldnt be much of a problem for the most parts of the code.
<br/>
<br/>
I have looked into the DevKt ARM's libnds and ndslib includes to get the basic understanding about the DS framebuffer, but i didn't really get through. There seems to be a lot terminologie that is unknown to me in the definitions, as what a BG bank shall be etc ...
<br/>
<br/>
I did a search on the forums here already, but i could not find the explanation about the way the DS does the display in fully x1r5g5b5 mode.
<br/>
<br/>
What i'd need is to know where the framebuffer(s) of the NDS is located or how to read its address (if its variable). Is it possible in the non indexed (as in palette) xrgb mode to use transparent overlays ?
<br/>
<br/>
Thanks in advance
<br/>
Mighty Max</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#47816 - MrAdults - Wed Jul 13, 2005 9:43 pm</h4>
    <div class="postbody"><span class="postbody">This should be everything you need then.
<br/>
<a href="http://www.double.co.nz/nintendo_ds/nds_develop2.html" target="_blank">http://www.double.co.nz/nintendo_ds/nds_develop2.html</a>
<br/>
<br/>
There is no palette-index-based mode (that I know of) for the framebuffer, but there are palette-based background modes that function similarly.
<br/>
<br/>
-Rich</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#47818 - Mighty Max - Wed Jul 13, 2005 9:51 pm</h4>
    <div class="postbody"><span class="postbody">Must have overseen it  *scratch head*
<br/>
<br/>
Thank you :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#47870 - dovoto - Thu Jul 14, 2005 5:10 am</h4>
    <div class="postbody"><span class="postbody">There is the frame buffer which is unlayered and 15 bit color.  There is also background modes which are layered and accessable as 15 bit or paletted frame buffers.  These modes provide layering of backgrounds with limited transperency.
<br/>
<br/>
Also N was nice enough to give us more flexible sprites which include a true 2D 16 bit non-tiled mode.
<br/>
<br/>
Plenty of frame buffers to play around with and transperency can be had between them all (although it is not the most flexible of transperency)<br/>_________________<br/><a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#48007 - Mighty Max - Fri Jul 15, 2005 10:57 pm</h4>
    <div class="postbody"><span class="postbody">Thanks you too Dovoto :)
<br/>
<br/>
I think this is gonna be a time of noobism all over again ;)
<br/>
<br/>
As i don't want to just take but give too, i gonna add my replacement for the QueryPerformance functions from the WinAPI for everone. 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
bool timersinitialized = false ;
<br/>
<br/>
// additional define to timers.h
<br/>
#define TIMER_PURE_CASCADE   (1&lt;&lt;2)
<br/>
<br/>
#ifndef _windef_
<br/>
#define _windef_
<br/>
typedef long BOOL ;
<br/>
typedef __int64 LARGE_INTEGER ;
<br/>
#define TRUE 0x80000000
<br/>
#define FALSE 0x00000000
<br/>
#endif
<br/>
<br/>
BOOL QueryPerformanceCounter(LARGE_INTEGER *lpPerformanceCount) {
<br/>
   if (!timersinitialized) {
<br/>
      // Initialize if not done before
<br/>
      // Timer with 33.4MHz / 1024
<br/>
      TIMER_CR(0) = TIMER_DIV_1024 | TIMER_PURE_CASCADE ;      // lower 16 bit
<br/>
      TIMER_CR(1) = TIMER_PURE_CASCADE ;                  // bit 16..31
<br/>
      TIMER_CR(2) = TIMER_PURE_CASCADE ;                  // bit 32..47
<br/>
      TIMER_CR(3) = TIMER_PURE_CASCADE ;                  // highest 16 bit
<br/>
      timersinitialized = true ;
<br/>
   } ;
<br/>
   // read the registers and combine 64bits (__int64)
<br/>
   *lpPerformanceCount = (__int64)TIMER_DATA(0) | (TIMER_DATA(1) &lt;&lt; 16) | (TIMER_DATA(2) &lt;&lt; 32) | (TIMER_DATA(3) &lt;&lt; 48) ;
<br/>
   return TRUE ;
<br/>
} ;
<br/>
<br/>
BOOL QueryPerformanceFrequency(LARGE_INTEGER *lpFrequency) {
<br/>
   // counts per sec
<br/>
   *lpFrequency = 33400000 / 1024 ;      // 33.4 M
<br/>
   return TRUE ;
<br/>
} ;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
PS: I didnt come to test it yet, as my hardware did not yet arrive.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
