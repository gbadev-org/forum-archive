<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>coding rumble on ezflash 5 and 3 in 1 expansion pack - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > coding rumble on ezflash 5 and 3 in 1 expansion pack</h2>
<div id="posts">
<div class="post">
    <h4>#160715 - elhobbs - Mon Jul 21, 2008 1:19 am</h4>
    <div class="postbody"><span class="postbody">do I need to do anything special to get rumble working on the ezflash 5 with the 3 in 1 expansion pack? I have tried a few rumble samples and nothing happens. Is there anything special that needs to be done? I am beginning to think my 3 in 1 card is broken. I can get the expansion pack ram to work but the rumble does not work. so either I am missing an important init sequence (there does not appear to be one) or it is broken.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160722 - elhobbs - Mon Jul 21, 2008 3:21 am</h4>
    <div class="postbody"><span class="postbody">I found the 3 in 1 test source code on the ezflash site and it looks like the 3 in 1 does require enabling the rumble. here is the code</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void SetShake(u16 data)
<br/>
{
<br/>
   *(vuint16 *)0x9fe0000 = 0xd200;
<br/>
   *(vuint16 *)0x8000000 = 0x1500;
<br/>
   *(vuint16 *)0x8020000 = 0xd200;
<br/>
   *(vuint16 *)0x8040000 = 0x1500;
<br/>
   *(vuint16 *)0x9E20000 = data;
<br/>
   *(vuint16 *)0x9fc0000 = 0x1500;
<br/>
}
<br/>
<br/>
//to enable
<br/>
sysSetCartOwner(true);
<br/>
SetShake(0xF0);
<br/>
<br/>
//to rumble
<br/>
*(vu16 *)0x8000000 = 0x00;
<br/>
*(vu16 *)0x8000000 = 0x02;
<br/>
</td> </tr></table><span class="postbody"> so, the SetShake function looks like it may be very specific to the 3 in 1. do other cards have similiar initialization sequences? is there a library like lick's ram library for rumble?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160731 - Maxxie - Mon Jul 21, 2008 7:06 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>elhobbs wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
so, the SetShake function looks like it may be very specific to the 3 in 1. do other cards have similiar initialization sequences? is there a library like lick's ram library for rumble?</td> </tr></table><span class="postbody">
<br/>
<br/>
Yes. Even the rumble itself is very individual. Some cards need constant CPU interaction (setting &amp; unsetting a bit) to vibrate an actuator others just start or stop a motor.
<br/>
<br/>
For the SC Rumble:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
// check and enable rumble
<br/>
bool SC_TestRumble(void)
<br/>
{
<br/>
   /* since REG_ is volatile, the write should not be optimized */
<br/>
   /* which would break mode set */
<br/>
   REG_SC_UNLOCK = SC_MAGIC ;
<br/>
   REG_SC_UNLOCK = SC_MAGIC ;
<br/>
   /* mode is rumble + sD Cart, to not break a previous DLDI initialization */
<br/>
   REG_SC_UNLOCK = SC_RUMBLE | SC_SDCARD ;
<br/>
   REG_SC_UNLOCK = SC_RUMBLE | SC_SDCARD ;   
<br/>
   if ((REG_SC_A &amp; 2) || (REG_SC_B &amp; 2))
<br/>
   { 
<br/>
      return false ;
<br/>
   } else
<br/>
   {
<br/>
      return true ;
<br/>
   }
<br/>
}
<br/>
<br/>
void RUMBLER::Enable(bool en)
<br/>
{
<br/>
   switch (type)
<br/>
   {
<br/>
      case RUMBLE_SC:
<br/>
         REG_SC_B = en?2:0 ;
<br/>
         break ;
<br/>
...
<br/>
}
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/><a class="postlink" href="http://nintendods.desperate-programmers.com/doku.php?id=wireless_io_map" target="_blank">Trying  to bring more detail into understanding the wireless hardware</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160746 - tepples - Mon Jul 21, 2008 1:00 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Maxxie wrote:</b></span></td> </tr> <tr> <td class="quote">Even the rumble itself is very individual. Some cards need constant CPU interaction (setting &amp; unsetting a bit) to vibrate an actuator others just start or stop a motor.</td> </tr></table><span class="postbody">
<br/>
Do the ones that need CPU interaction need CPU interaction more often than 60 times a second?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160747 - silent_code - Mon Jul 21, 2008 1:32 pm</h4>
    <div class="postbody"><span class="postbody">@ tepples: They could need more than that. When a timer is available, it can be used to trigger the rumbling at a specific frequency. 60hz might just be too low and games that run at 30 hz are affected by that issue even more.<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160748 - Maxxie - Mon Jul 21, 2008 1:42 pm</h4>
    <div class="postbody"><span class="postbody">I once thought about using DMA on a volatile register to feed the port (HSync / triggerBitValue via vcount i.e.) but then i figured out, that "my" rumble is a motor one :p
<br/>
<br/>
So haven't tested this aproach.
<br/>
<br/>
For cards that trigger with BIT(1) this should lead to a max ~4kHz try of rumble.
<br/>
<br/>
However that occupies a lot of bus-bandwidth and a (high priorized for screen reg access) DMA channel.<br/>_________________<br/><a class="postlink" href="http://nintendods.desperate-programmers.com/doku.php?id=wireless_io_map" target="_blank">Trying  to bring more detail into understanding the wireless hardware</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160750 - silent_code - Mon Jul 21, 2008 1:56 pm</h4>
    <div class="postbody"><span class="postbody">Errrr... Metroid Prime Pb comes with the offical Rumble Pak and the game also works with the M3Real RAM &amp; Rumble, although the R&amp;R uses a little motor. There is a difference in intensities (official has more pronounced "soft" rumbling, but the R&amp;R has more powerful "hard" rumbling), but they both seem to work the same... off the offial cartridge, of course. ;^D
<br/>
<br/>
PS: Both paks seem not to be compatible with the NDS' inofficial rumble alarm feature (only compatible with some Wario game pak, iIrc).<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160751 - Maxxie - Mon Jul 21, 2008 2:01 pm</h4>
    <div class="postbody"><span class="postbody">Can you hear the *YARR* of the pirates putting patches over their eye... err ... rumble code?
<br/>
<br/>
(Which will be the reason why it doesn't work on the firmware functions like the alarm)<br/>_________________<br/><a class="postlink" href="http://nintendods.desperate-programmers.com/doku.php?id=wireless_io_map" target="_blank">Trying  to bring more detail into understanding the wireless hardware</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160752 - silent_code - Mon Jul 21, 2008 2:12 pm</h4>
    <div class="postbody"><span class="postbody">@ Maxxie: ??? ... ? There are no pirates in my room. :^) (I don't get it. ;^D )
<br/>
<br/>
PS: Arrrr! (Playing along, just for the fun of it...)<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160777 - spinal_cord - Mon Jul 21, 2008 11:57 pm</h4>
    <div class="postbody"><span class="postbody">Never mind.<br/>_________________<br/>I'm not a boring person, it's just that boring things keep happening to me.
<br/>
<a class="postlink" href="http://spinal.dizidesigns.co.uk/" target="_blank">Homepage</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
