<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Texture Mapping / Orthoview problem on hardware - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Texture Mapping / Orthoview problem on hardware</h2>
<div id="posts">
<div class="post">
    <h4>#123010 - zeGouky - Sat Mar 24, 2007 2:18 pm</h4>
    <div class="postbody"><span class="postbody">Hi people,
<br/>
<br/>
I'm trying to draw a textured QUAD using the orthoview, but my code work on no$gba but not on the hardware :-/
<br/>
<br/>
here's the piece of the code :
<br/>
<br/>
Init :
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   videoSetMode(MODE_0_3D);
<br/>
   videoSetModeSub( MODE_0_2D | DISPLAY_BG0_ACTIVE );   // --- lower screen for console text
<br/>
   vramSetMainBanks( VRAM_A_TEXTURE, VRAM_B_LCD, VRAM_C_SUB_BG, VRAM_D_SUB_SPRITE );
<br/>
<br/>
   glViewPort(0,0,255,191);
<br/>
   glClearColor(0,0,0);
<br/>
   glClearDepth(0x7FFF);
<br/>
<br/>
   glGenTextures(1, &amp;textureID);
<br/>
   glBindTexture(0, textureID);
<br/>
   glTexImage2D(0, 0, GL_RGB, TEXTURE_SIZE_128 , TEXTURE_SIZE_128, 0, TEXGEN_TEXCOORD, (u8*)texture_bin);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Init Orthoview : 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   glMatrixMode(GL_PROJECTION);
<br/>
   glLoadIdentity();
<br/>
   glOrthof32(0, 256, 192, 0,0, 1);
<br/>
<br/>
   glMatrixMode(GL_TEXTURE);
<br/>
   glIdentity();
<br/>
<br/>
   glMatrixMode(GL_MODELVIEW);
<br/>
   glLoadIdentity();
<br/>
   glMaterialf(GL_AMBIENT, RGB15(16,16,16));
<br/>
   glMaterialf(GL_DIFFUSE, RGB15(16,16,16));
<br/>
   glMaterialf(GL_SPECULAR, BIT(15) | RGB15(8,8,8));
<br/>
   glMaterialf(GL_EMISSION, RGB15(16,16,16));
<br/>
<br/>
   glPolyFmt(POLY_ALPHA(31) | POLY_CULL_NONE);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Back to perspective : 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   glMatrixMode(GL_PROJECTION);   
<br/>
   glLoadIdentity();
<br/>
   glMatrixMode(GL_MODELVIEW);
<br/>
   glLoadIdentity();
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Rendering the quad :
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
      //   -- Rendering
<br/>
      OrthoView();
<br/>
<br/>
      glPushMatrix();
<br/>
      glBindTexture(GL_TEXTURE_2D, textureID);
<br/>
      glBegin(GL_QUADS);
<br/>
         glNormal(NORMAL_PACK(0,inttov10(-1),0));
<br/>
<br/>
         glTexCoord1i(TEXTURE_PACK(inttot16(128), 0));
<br/>
         glVertex3v16( spr_x, spr_y+spr_h, 0);
<br/>
<br/>
         glTexCoord1i(TEXTURE_PACK(inttot16(128),inttot16(128)));
<br/>
         glVertex3v16( spr_x+spr_w, spr_y+spr_h, 0);
<br/>
<br/>
         glTexCoord1i(TEXTURE_PACK(0, inttot16(128)));
<br/>
         glVertex3v16( spr_x+spr_w, spr_y, 0);
<br/>
<br/>
         glTexCoord1i(TEXTURE_PACK(0,0));
<br/>
         glVertex3v16( spr_x, spr_y, 0);
<br/>
      glEnd();
<br/>
      glPopMatrix(1);
<br/>
<br/>
      //   --- Bactk to perspective
<br/>
      PerspectiveView();
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
On the device im just getting the QUAD with no texture but the QUAD is in color #0 of it.
<br/>
<br/>
If anyone can help :)
<br/>
<br/>
Thanks</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123062 - HyperHacker - Sat Mar 24, 2007 10:29 pm</h4>
    <div class="postbody"><span class="postbody">The quad is a solid colour from the texture? Sounds like a problem with the texture matrix or coordinates.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123090 - zeGouky - Sun Mar 25, 2007 1:23 am</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
redone something more "proper" according to the examples and not its work but i have 2 weird problems.
<br/>
<br/>
1/ If I display 2 textured quads and when the front one go on the upper, left of the screen it go behind the 2nd quad. This bug dont happen on the emu ... :-/ Hope i'm clear :)
<br/>
<br/>
2/ if im loading 2 textures : one 128x128 and one 256x256, the 2nd loaded textures is not shown that only happen when i use a 256x256 texture, i can load a 128x128 and a 64x64 without problems.
<br/>
<br/>
Again hope i'm clear.
<br/>
<br/>
Thanks</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123133 - Lick - Sun Mar 25, 2007 1:48 pm</h4>
    <div class="postbody"><span class="postbody">1) You need to set different Z-values for the quads. Otherwise they are on the same depth and it will result into unexpected output.
<br/>
<br/>
2) You need more VRAM. You could also try using a different texture format. GL_RGB is 2bytes per pixel, while there are other formats are 0.5bytes per pixel.<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123177 - zeGouky - Sun Mar 25, 2007 10:11 pm</h4>
    <div class="postbody"><span class="postbody">2/ hmm when im setting z values for the quad , the quad go off :-/ Im new to opengl so maybe im missing something ?  here's the piece of code :
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   glBindTexture( GL_TEXTURE_2D, texture[textureID]);
<br/>
   glBegin(GL_QUADS);
<br/>
      glNormal(NORMAL_PACK(0,inttov10(-1),0));
<br/>
<br/>
      glTexCoord1i(TEXTURE_PACK(inttot16(tex_w), 0));
<br/>
      glVertex3v16( x, y+h, -1);
<br/>
<br/>
      glTexCoord1i(TEXTURE_PACK(inttot16(tex_w),inttot16(tex_h)));
<br/>
      glVertex3v16( x+w, y+h, -1);
<br/>
<br/>
      glTexCoord1i(TEXTURE_PACK(0, inttot16(tex_h)));
<br/>
      glVertex3v16( x+w, y, -1);
<br/>
<br/>
      glTexCoord1i(TEXTURE_PACK(0,0));
<br/>
      glVertex3v16( x, y, -1);
<br/>
   glEnd();
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
2/ argh yes, working now :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123181 - zeGouky - Sun Mar 25, 2007 11:44 pm</h4>
    <div class="postbody"><span class="postbody">Finally got it working, i have added depth to my glOrtho and also change GFX_FLUSH = 2 to GFX_FLUSH = 0 in glFlush();</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
