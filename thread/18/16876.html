<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>compiling zlib with devkitARM - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > compiling zlib with devkitARM</h2>
<div id="posts">
<div class="post">
    <h4>#170375 - headspin - Sun Sep 20, 2009 6:08 am</h4>
    <div class="postbody"><span class="postbody"><span style="font-weight: bold">Mod note:</span> split from <a href="http://forum.gbadev.org/viewtopic.php?t=16862" target="_blank">http://forum.gbadev.org/viewtopic.php?t=16862</a>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">Not really sure how compression relates to malloc logging and memory fragmentation tbh. I'm also confused by the existence of something called ndszlib when zlib compiles OOB with devkitARM</td> </tr></table><span class="postbody">
<br/>
<br/>
The OP stated he's "extremely tight on memory" so I mearly suggested a way of conserving space that he may not have thought of. Just because it doesn't directly relate to the question doesn't make it a moot point.
<br/>
<br/>
About ndszlib: Perhaps it's just a modification of the makefile but the official zlib does not compile under devkitARM "out of the box".[/b]<br/>_________________<br/><a class="postlink" href="http://headsoft.com.au/index.php?category=warhawk" target="_blank">Warhawk DS</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=mmll" target="_blank">Manic Miner: The Lost Levels</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=tdg" target="_blank">The Detective Game</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#170380 - wintermute - Sun Sep 20, 2009 3:36 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>headspin wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<br/>
About ndszlib: Perhaps it's just a modification of the makefile but the official zlib does not compile under devkitARM "out of the box".</td> </tr></table><span class="postbody">
<br/>
<br/>
I beg to differ.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
monalisa:zlib-1.2.3 davem$ PATH=$DEVKITARM/bin:$PATH
<br/>
monalisa:zlib-1.2.3 davem$ AR="arm-eabi-ar rc" RANLIB=arm-eabi-ranlib CC=arm-eabi-gcc prefix=$DEVKITPRO/portlibs/arm ./configure
<br/>
Building static library libz.a version 1.2.3 with arm-eabi-gcc.
<br/>
Checking for unistd.h... Yes.
<br/>
Checking whether to use vs[n]printf() or s[n]printf()... using vs[n]printf()
<br/>
Checking for vsnprintf() in stdio.h... Yes.
<br/>
Checking for return value of vsnprintf()... Yes.
<br/>
Checking for errno.h... Yes.
<br/>
Checking for mmap support... No.
<br/>
monalisa:zlib-1.2.3 davem$ make
<br/>
arm-eabi-gcc -O3   -c -o example.o example.c
<br/>
arm-eabi-gcc -O3   -c -o adler32.o adler32.c
<br/>
arm-eabi-gcc -O3   -c -o compress.o compress.c
<br/>
arm-eabi-gcc -O3   -c -o crc32.o crc32.c
<br/>
arm-eabi-gcc -O3   -c -o gzio.o gzio.c
<br/>
arm-eabi-gcc -O3   -c -o uncompr.o uncompr.c
<br/>
arm-eabi-gcc -O3   -c -o deflate.o deflate.c
<br/>
arm-eabi-gcc -O3   -c -o trees.o trees.c
<br/>
arm-eabi-gcc -O3   -c -o zutil.o zutil.c
<br/>
arm-eabi-gcc -O3   -c -o inflate.o inflate.c
<br/>
arm-eabi-gcc -O3   -c -o infback.o infback.c
<br/>
arm-eabi-gcc -O3   -c -o inftrees.o inftrees.c
<br/>
arm-eabi-gcc -O3   -c -o inffast.o inffast.c
<br/>
arm-eabi-ar rc libz.a adler32.o compress.o crc32.o gzio.o uncompr.o deflate.o trees.o zutil.o inflate.o infback.o inftrees.o inffast.o 
<br/>
arm-eabi-gcc -O3 -o example example.o -L. libz.a
<br/>
arm-eabi-gcc -O3   -c -o minigzip.o minigzip.c
<br/>
arm-eabi-gcc -O3 -o minigzip minigzip.o -L. libz.a
<br/>
monalisa:zlib-1.2.3 davem$ make install
<br/>
cp zlib.h zconf.h /opt/devkitpro/portlibs/arm/include
<br/>
chmod 644 /opt/devkitpro/portlibs/arm/include/zlib.h /opt/devkitpro/portlibs/arm/include/zconf.h
<br/>
cp libz.a /opt/devkitpro/portlibs/arm/lib
<br/>
cd /opt/devkitpro/portlibs/arm/lib; chmod 755 libz.a
<br/>
cd /opt/devkitpro/portlibs/arm/lib; if test -f libz.1.2.3.dylib; then \
<br/>
     rm -f libz.dylib libz.1.dylib; \
<br/>
     ln -s libz.1.2.3.dylib libz.dylib; \
<br/>
     ln -s libz.1.2.3.dylib libz.1.dylib; \
<br/>
     (ldconfig || true)  &gt;/dev/null 2&gt;&amp;1; \
<br/>
   fi
<br/>
cp zlib.3 /opt/devkitpro/portlibs/arm/share/man/man3
<br/>
chmod 644 /opt/devkitpro/portlibs/arm/share/man/man3/zlib.3
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#170383 - headspin - Sun Sep 20, 2009 7:13 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">I beg to differ.</td> </tr></table><span class="postbody">
<br/>
<br/>
Both from MSYS and command prompt I get
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">cc -O   -c -o example.o example.c
<br/>
make: cc: Command not found
<br/>
make: *** [example.o] Error 127</td> </tr></table><span class="postbody">
<br/>
<br/>
I did also try setting those environment variables but still get the same error. So I hardly call that "out of the box". But even if I <span style="font-style: italic">could</span> get it to compile with some esoteric compiler settings like in your example. I don't know much at all about your toolchain and as you've pretty much demonstrated to me I wouldn't have thought what seems so obvious to you and that is to type in "AR="arm-eabi-ar rc" RANLIB=arm-eabi-ranlib CC=arm-eabi-gcc" at the prompt. How silly of me not to know that but thanks for pointing it out.
<br/>
<br/>
Personally I prefer to spend my time writing software rather than messing about with toolchains so IMHO downloading a project with a makefile customised for devkitARM is a mindless preference for me. The ndszlib project can be compiled from command line with "make"; too easy!<br/>_________________<br/><a class="postlink" href="http://headsoft.com.au/index.php?category=warhawk" target="_blank">Warhawk DS</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=mmll" target="_blank">Manic Miner: The Lost Levels</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=tdg" target="_blank">The Detective Game</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#170397 - Sektor - Mon Sep 21, 2009 10:27 am</h4>
    <div class="postbody"><span class="postbody">Well almost out of the box, just makefile changes.
<br/>
<br/>
It appears some other changes are <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=16864" target="_blank">needed to fix bugs</a>.<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><a class="postlink" href="http://gtamp.com/DS" target="_blank">GTAMP.com/DS</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#170417 - wintermute - Tue Sep 22, 2009 10:09 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Sektor wrote:</b></span></td> </tr> <tr> <td class="quote">Well almost out of the box, just makefile changes.</td> </tr></table><span class="postbody">
<br/>
<br/>
That was the point of the procedure I outlined above, you don't need to edit <span style="font-weight: bold">anything</span>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
It appears some other changes are <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=16864" target="_blank">needed to fix bugs</a>.</td> </tr></table><span class="postbody">
<br/>
<br/>
Try building it properly, see if the bug still occurs<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#170424 - headspin - Tue Sep 22, 2009 1:04 pm</h4>
    <div class="postbody"><span class="postbody">Okay I'm definately going blind in my old age I just noticed your second argument goes onto the next line and totally missed it. Okay ran it again on MSYS and this time it compiles okay. But unfortunately it has the same issue as that compiled by Sektor's modified makefile. "uncompress" fails without making sverx's following change in inflate.c.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">if ((state-&gt;wrap &amp; 2) &amp;&amp; hold == 0x8b1f) {  /* gzip header */</td> </tr></table><span class="postbody">
<br/>
<br/>
to
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">if (hold == 0x8b1f) {  /* gzip header */</td> </tr></table><span class="postbody">
<br/>
<br/>
We have no idea why but at least we know now it's not some mistake in Sektor's makefile.<br/>_________________<br/><a class="postlink" href="http://headsoft.com.au/index.php?category=warhawk" target="_blank">Warhawk DS</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=mmll" target="_blank">Manic Miner: The Lost Levels</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=tdg" target="_blank">The Detective Game</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
