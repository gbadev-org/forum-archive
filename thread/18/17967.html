<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>DS negative depth - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > DS negative depth</h2>
<div id="posts">
<div class="post">
    <h4>#178040 - nocash - Thu Aug 15, 2013 12:04 pm</h4>
    <div class="postbody"><span class="postbody">I have just noticed that no$zoomer applies a patch to no$gba, which allows it to render polygons with negative depth values (ie. negative Z or W coordinates). The patch is called "EX4". What is that for?
<br/>
<br/>
Normally these values should be positive. Registers like CLEAR_DEPTH, FOG_OFFSET, DISP_1DOT_DEPTH, and RearPlaneBitmap are restricted to 15bit positive values. And near plane clipping should occur at Z&lt;0.
<br/>
<br/>
Maybe W buffering can end up with negative W values, even when Z passed near plane clipping? And if so, can the NDS hardware store negative W values in the "framebuffer"?
<br/>
<br/>
Or maybe my rendering code has rounding errors, unintentionally ending up with negative values when Z coordinates are getting too close to zero?
<br/>
<br/>
Did anybody experience negative depth related problems in no$gba? Or used such stuff on real NDS hardware?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#178047 - nocash - Mon Aug 19, 2013 12:01 pm</h4>
    <div class="postbody"><span class="postbody">After gazing at the patch for some more time, I think maybe it doesn't want to handle negative depths at all.
<br/>
In the depth comparision, it's replacing a "jnb" opcode by a "jg" opcode. The signed/unsigned stuff looked most eye-catching to me, but the other difference is that "jg" doesn't jump-if-equal.
<br/>
<br/>
If there are problems on equal depths in no$gba... that might be related to manual/auto-sorted polygons, rounding-errors, or even on the nds hardware's "depth=less" check (maybe it does actually check "depth=lessorequal")... I'll need to do some tests.
<br/>
If somebody has experiences with equal depth's (in no$gba or on real nds) please let me know what you have observed!</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
