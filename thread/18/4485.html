<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Speculation on reading extra DS buttons from GBA mode - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Speculation on reading extra DS buttons from GBA mode</h2>
<div id="posts">
<div class="post">
    <h4>#30055 - tepples - Sun Nov 28, 2004 12:35 am</h4>
    <div class="postbody"><span class="postbody">Wild speculation about the DS controller:
<br/>
<br/>
It could be possible that the GBA register <a class="postlink" href="http://www.cs.rit.edu/~tjh8300/CowBite/CowBiteSpec.htm#Keypad%20input%20and%20control%20registe" target="_blank">0x4000130 - REG_KEY</a> is no longer read-only. One way Nintendo could have designed it, similar to how the reading the DMG controller works, would be to make some of the bits writable such that writing to the bits would either unmask or bankswitch which buttons can be read.
<br/>
<br/>
Example of hypothetical unmaskable register:
<br/>
Write 0x03FF to REG_KEY, and reading REG_KEY returns only the GBA buttons.
<br/>
Write 0x0FFF to REG_KEY, and reading REG_KEY returns the X and Y buttons as well.
<br/>
<br/>
Example of hypothetical bankswitchable register:
<br/>
Write 0x0000 to REG_KEY, and reading REG_KEY returns the GBA buttons.
<br/>
Write 0x4000 to REG_KEY, and reading REG_KEY returns the X and Y buttons.
<br/>
Write 0x8000 to REG_KEY, and reading REG_KEY returns the X coordinate of the touch screen.
<br/>
Write 0xC000 to REG_KEY, and reading REG_KEY returns the Y coordinate of the touch screen.
<br/>
<br/>
Has anybody else thought to try this?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#30058 - Lord Graga - Sun Nov 28, 2004 1:36 am</h4>
    <div class="postbody"><span class="postbody">I am 100% sure that the pad is read the same way on the DS as it is on GBA, just with two extra bits to read from.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#30059 - tepples - Sun Nov 28, 2004 1:49 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lord Graga wrote:</b></span></td> </tr> <tr> <td class="quote">I am 100% sure that the pad is read the same way on the DS as it is on GBA, just with two extra bits to read from.</td> </tr></table><span class="postbody">
<br/>
Which would confuse games that expect all-buttons-up to be exactly 0x03FF; hence my bitmasking idea.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#30060 - Krakken - Sun Nov 28, 2004 1:50 am</h4>
    <div class="postbody"><span class="postbody">Joat has tried reading the key input register with no luck on a GBA flash cart. I don't believe he tried it using your method though which seems quite feasible.
<br/>
<br/>
<a href="http://zerohaven.com/ds/wiki/index.php?title=Misc:Misc" target="_blank">http://zerohaven.com/ds/wiki/index.php?title=Misc:Misc</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#30488 - abilyk - Wed Dec 01, 2004 5:35 pm</h4>
    <div class="postbody"><span class="postbody">Though it was a sound idea, writing to REG_KEY has no effect on the data read from REG_KEY.  I tested using a fleshed-out version of this pseudocode:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">for(temp_index = 0; temp_index &lt; 65536; temp_index++)
<br/>
{
<br/>
   REG_KEYINPUT = temp_index;
<br/>
   if(REG_KEYINPUT != 0x3ff)
<br/>
   {
<br/>
      PRINT(temp_index, REG_KEYINPUT);
<br/>
   }
<br/>
}</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
