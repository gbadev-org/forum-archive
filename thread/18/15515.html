<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Getting a file size - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Getting a file size</h2>
<div id="posts">
<div class="post">
    <h4>#156502 - NeX - Sat May 10, 2008 9:16 pm</h4>
    <div class="postbody"><span class="postbody">So I've finally got my hands on something DLDI.  An R4, to be precise.  I want the size of a file.  I get no file error, just always a daft filesize.  Each file in the directory, ranging from 2 to 200kb, reads as "1179923538".  The file in this example is 33,210 bytes.  What am I not understanding?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
                     soundf = fopen (filename[sounds], "r");
<br/>
                     if(stat("kick0_maypex.raw",&amp;st)==0)
<br/>
                     {
<br/>
                        iprintf("Size: %d\n",st.st_size);
<br/>
                     }
<br/>
                     else
<br/>
                     {
<br/>
                        iprintf("Couldn't read the file!\n");
<br/>
                     }
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/><a class="postlink" href="http://www.mediafire.com/?cuyb10fzdz2" target="_blank">Strummer</a> or <a class="postlink" href="http://www.mediafire.com/?71zxcztscix" target="_blank">Drummer?</a>.  
<br/>
Or maybe you would rather play with sand? <a class="postlink" href="http://www.mediafire.com/?a05z5wmdvxm" target="_blank">Sandscape is for you in that case.</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#156504 - elhobbs - Sat May 10, 2008 9:34 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">if(stat("kick0_maypex.raw",&amp;st)==0)</td> </tr></table><span class="postbody">
<br/>
you are always passing the same filename to stat.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#156505 - NeX - Sat May 10, 2008 9:35 pm</h4>
    <div class="postbody"><span class="postbody">Yes, to make sure it wasn't looking for a nonsense filename.  It is not returning a filesize.  It's returning rubbish.<br/>_________________<br/><a class="postlink" href="http://www.mediafire.com/?cuyb10fzdz2" target="_blank">Strummer</a> or <a class="postlink" href="http://www.mediafire.com/?71zxcztscix" target="_blank">Drummer?</a>.  
<br/>
Or maybe you would rather play with sand? <a class="postlink" href="http://www.mediafire.com/?a05z5wmdvxm" target="_blank">Sandscape is for you in that case.</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#156513 - NeX - Sat May 10, 2008 11:16 pm</h4>
    <div class="postbody"><span class="postbody">If you're wondering what errno is being returned, zero.  There is no problem opening the file, and reading from it, just getting the stats.<br/>_________________<br/><a class="postlink" href="http://www.mediafire.com/?cuyb10fzdz2" target="_blank">Strummer</a> or <a class="postlink" href="http://www.mediafire.com/?71zxcztscix" target="_blank">Drummer?</a>.  
<br/>
Or maybe you would rather play with sand? <a class="postlink" href="http://www.mediafire.com/?a05z5wmdvxm" target="_blank">Sandscape is for you in that case.</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#156514 - Lazy1 - Sun May 11, 2008 12:08 am</h4>
    <div class="postbody"><span class="postbody">Try:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
fstat( fileno( soundf ), &amp;st );
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#156535 - zeruda - Sun May 11, 2008 12:04 pm</h4>
    <div class="postbody"><span class="postbody">You could try something along the lines of the following:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void ReadFile(const char *Name)
<br/>
{
<br/>
    ifstream infile;
<br/>
    char FileName[80];
<br/>
    strcpy (FileName, Name);
<br/>
    strcat (FileName, ".raw");
<br/>
    infile.open (FileName, ios::ate | ios::binary);
<br/>
    int size = infile.tellg();           // Since we are at the end, we can get the size
<br/>
    infile.seekg(0, ios::beg);              // Seek back to the beginning
<br/>
    u32 *Data = new u32[(size/4)];           // use a quarter of the size since using u32
<br/>
    for (int i = 0; i &lt; size; i++) {
<br/>
        infile.read((char*)&amp;Data[i], 4);
<br/>
    }
<br/>
    infile.close();
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#156538 - tepples - Sun May 11, 2008 12:50 pm</h4>
    <div class="postbody"><span class="postbody">Often, especially with the GNU libstdc++ used in devkitARM, you get smaller code by doing something in &lt;cstdio&gt; (or &lt;stdio.h&gt; in C) instead of &lt;iostream&gt;. In &lt;cstdio&gt;, you'd use fopen, fseek, ftell, then fclose or rewind.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#156554 - NeX - Sun May 11, 2008 3:32 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for trying to help, but it's still not working.  I think it might be a problem with the MicroSD card; it's taking up to a minute to write the 90kb .nds.  I'm still getting garbage for the filesizes.  That alternate method looked perfect, but I can't get it to compile.  Is that for C++?<br/>_________________<br/><a class="postlink" href="http://www.mediafire.com/?cuyb10fzdz2" target="_blank">Strummer</a> or <a class="postlink" href="http://www.mediafire.com/?71zxcztscix" target="_blank">Drummer?</a>.  
<br/>
Or maybe you would rather play with sand? <a class="postlink" href="http://www.mediafire.com/?a05z5wmdvxm" target="_blank">Sandscape is for you in that case.</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#156557 - simonjhall - Sun May 11, 2008 4:40 pm</h4>
    <div class="postbody"><span class="postbody">I find the formatting of a flash card that goes into a DS will eventually "wear out" for some reason and will need a re-format. Maybe it's that time again?<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#156560 - silent_code - Sun May 11, 2008 5:27 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>simonjhall wrote:</b></span></td> </tr> <tr> <td class="quote">I find the formatting of a flash card that goes into a DS will eventually "wear out" for some reason and will need a re-format. Maybe it's that time again?</td> </tr></table><span class="postbody">
<br/>
be asured, this isn't only true for "a flash card that goes into a DS". :^|</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#156651 - zeruda - Mon May 12, 2008 3:49 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>NeX wrote:</b></span></td> </tr> <tr> <td class="quote">Thanks for trying to help, but it's still not working.  I think it might be a problem with the MicroSD card; it's taking up to a minute to write the 90kb .nds.  I'm still getting garbage for the filesizes.  That alternate method looked perfect, but I can't get it to compile.  Is that for C++?</td> </tr></table><span class="postbody">
<br/>
<br/>
Yeah, it's a c++ library, you have to also use the following header:
<br/>
<br/>
#include &lt;fstream&gt;</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#156911 - HyperHacker - Thu May 15, 2008 11:50 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>simonjhall wrote:</b></span></td> </tr> <tr> <td class="quote">I find the formatting of a flash card that goes into a DS will eventually "wear out" for some reason and will need a re-format. Maybe it's that time again?</td> </tr></table><span class="postbody">I suspect that's due to apps using old versions of GBA_NDS_FAT.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#156912 - Dwedit - Thu May 15, 2008 11:54 pm</h4>
    <div class="postbody"><span class="postbody">The old GBA_NDS_FAT and GBAMP_CF libraries have serious bugs when enlarging a directory.  If you pre-create files so that it does not create anything new, you can avoid many problems.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
