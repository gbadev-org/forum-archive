<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>graphics problem 2. (should be an answer...sorry) - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > graphics problem 2. (should be an answer...sorry)</h2>
<div id="posts">
<div class="post">
    <h4>#152312 - ben0bi - Thu Mar 13, 2008 6:36 pm</h4>
    <div class="postbody"><span class="postbody">ok i fixed this issue. thanks for the help.
<br/>
now i got another problem (im really new to DS as you might see. ;) ):
<br/>
<br/>
i want to setup an 8bit screen to save memory.
<br/>
<br/>
works with images but now i want to draw pixels. i set bg_palette 255 to my color and try this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
u8* mybuffer=(u8*) BG_BMP_RAM(0);
<br/>
mybuffer[0]=255;
<br/>
mybuffer[1]=255;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
that does not work on the machine (emulator works..). WHY?
<br/>
<br/>
it works if i use:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
u16* mybuffer=(u16*) BG_BMP_RAM(0);
<br/>
mybuffer[0]=255 + 255&lt;&lt;8; // &lt;&lt;8 = second pixel
<br/>
//mybuffer[1]=255;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
but what is the difference? i don't get it....i mean, 8bit is half a 16bit. but why can i not assign the space directly with u8?
<br/>
<br/>
does anyone have a clue about this?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152316 - Cearn - Thu Mar 13, 2008 7:20 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ben0bi wrote:</b></span></td> </tr> <tr> <td class="quote">but what is the difference? i don't get it....i mean, 8bit is half a 16bit. but why can i not assign the space directly with u8? 
<br/>
</td> </tr></table><span class="postbody">
<br/>
It's just one of those little quirks of GBA/NDS hardware. VRAM (and palette RAM and OAM) can only be written to in 16- or 32-bit chunks, not bytes. If you try, the byte will be duplicated. If you want a 8-bit plotter, use something go <a class="postlink" href="http://www.coranac.com/tonc/text/bitmaps.htm#ssec-modes-m4" target="_blank">here</a>.  Technically it's for GBA, but the principles are the same.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ben0bi wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">mybuffer[0]=255 + 255&lt;&lt;8; // &lt;&lt;8 = second pixel </td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
Remember that addition has a higher operator precedence than shifts. This actually writes 510&lt;&lt;8 (which is then cut down to 254&lt;&lt;8 to keep it inside 16 bits)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152353 - ben0bi - Fri Mar 14, 2008 1:11 am</h4>
    <div class="postbody"><span class="postbody">thanks for the explanation.
<br/>
<br/>
i now use this formula:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
buffer[pos] = rightColor | (leftColor&lt;&lt;8);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
and to determine the position of the pixel i use this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define POSFROMXY(x,y) (x + y*SCREEN_WIDTH)
<br/>
<br/>
u16 pos=POSFROMXY(x,y);
<br/>
<br/>
int mod=pos%2;
<br/>
if(pos!=0)
<br/>
   pos=(pos-mod)/2;
<br/>
<br/>
if(mod==1)
<br/>
   buffer[pos]=color |  (buffer[pos] &amp; 0xff00);
<br/>
else
<br/>
   buffer[pos]=(color&lt;&lt;8) | (buffer[pos] &amp; 0x00ff);
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152377 - nce - Fri Mar 14, 2008 4:22 pm</h4>
    <div class="postbody"><span class="postbody">looks good :)
<br/>
<br/>
but you could have something a little faster with this  ( but yes the compiler may optimise this for you anyway.... )
<br/>
<br/>
if SCREEN_WIDTH = 256 you can have :
<br/>
<br/>
#define POSFROMXY(x,y) (x + (y&lt;&lt;8)) 
<br/>
<br/>
and 
<br/>
<br/>
int mod = pos &amp; 1;
<br/>
pos &gt;&gt;= 1;  // no real need for a test with 0 here ... 
<br/>
<br/>
and if you divide by 2 it will get rid of the first bit anyway so no need to do (pos-mod)/2.  pos/2 gives you the same answer...<br/>_________________<br/>-jerome-</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152400 - ben0bi - Sat Mar 15, 2008 1:02 am</h4>
    <div class="postbody"><span class="postbody">yes thanx.
<br/>
<br/>
soon i will post my very first ds game. it only uses one double-buffered background in 8bit on each screen because graphics setup is a little but to complicated for me at this time.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
