<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>libFAT, DLDI, and emulators - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > libFAT, DLDI, and emulators</h2>
<div id="posts">
<div class="post">
    <h4>#165245 - DiscoStew - Sun Dec 14, 2008 9:57 pm</h4>
    <div class="postbody"><span class="postbody">For some reason, I can't get this dang thing to work. Prior to installing the latest toolchain, I was using the combined template for my projects (even though I wasn't doing anything on the ARM7 yet), and I had gotten my setup working so I could use libFAT on No$GBA using DLDI. Now, having converted to just the plain ARM9 build, I continually get the error that the compiled project "does not have a DLDI section". This is what I had before with the combined template...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">all: $(TARGET)_fcsr.nds
<br/>
<br/>
$(TARGET)_fcsr.nds   : $(TARGET).ds.gba
<br/>
   padbin.exe 512 $(TARGET).ds.gba
<br/>
   cat $(TARGET).ds.gba ./fcsrimage/image.img &gt; $(TARGET)_fcsr.nds
<br/>
   dlditool.exe ./fcsrimage/fcsr.dldi $(TARGET)_fcsr.nds
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
$(TARGET).ds.gba   : $(TARGET).nds
<br/>
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
$(TARGET).nds   :   $(TARGET).arm7 $(TARGET).arm9
<br/>
   ndstool   -c $(TARGET).nds -7 $(TARGET).arm7 -9 $(TARGET).arm9
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
$(TARGET).arm7   : arm7/$(TARGET).elf
<br/>
$(TARGET).arm9   : arm9/$(TARGET).elf
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
arm7/$(TARGET).elf:
<br/>
   $(MAKE) -C arm7
<br/>
   
<br/>
#---------------------------------------------------------------------------------
<br/>
arm9/$(TARGET).elf:
<br/>
   $(MAKE) -C arm9
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
...and this is what I am trying to do with the single build...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#---------------------------------------------------------------------------------
<br/>
# main targets
<br/>
#---------------------------------------------------------------------------------
<br/>
<br/>
all: $(OUTPUT)_fcsr.nds
<br/>
<br/>
$(OUTPUT)_fcsr.nds   : $(OUTPUT).nds
<br/>
   padbin 512 $(OUTPUT).nds
<br/>
   cat $(OUTPUT).nds $(CURDIR)/../fcsrimage/image.img &gt; $(OUTPUT)_fcsr.nds
<br/>
   dlditool $(CURDIR)/../fcsrimage/fcsr.dldi $(OUTPUT)_fcsr.nds
<br/>
   
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
<br/>
$(OUTPUT).nds   :    $(OUTPUT).arm9
<br/>
$(OUTPUT).arm9   :   $(OUTPUT).elf
<br/>
$(OUTPUT).elf   :   $(OFILES)</td> </tr></table><span class="postbody">
<br/>
<br/>
Everything checks out, but when it gets to the dlditool line, I get the error described above. Just to note, my "combined" Makefile was working perfectly, so I don't think there is anything different from the files being used.<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165250 - chishm - Mon Dec 15, 2008 3:41 am</h4>
    <div class="postbody"><span class="postbody">Are you actually using libfat? Even if you link the libs correctly and include the appropriate headers, libfat (and the DLDI stub in libnds) won't be linked into the final binary unless they're used (by, say, a call to fatInitDefault() that the compiler deems worth keeping).<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165251 - DiscoStew - Mon Dec 15, 2008 4:18 am</h4>
    <div class="postbody"><span class="postbody">Ah, that was it. When I was first getting all this stuff together, I did call fatInitDefault with a message and infinite loop if it failed, but some time down the road, I commented it out, and that is probably when that particular error started.......I hate simple mistakes  :P
<br/>
<br/>
BTW, with my last project (prior to the new toolchain release), I was using the DLDI stub that was compiled from fcsrDLDI.zip found at the website <a href="http://gpf.dcemu.co.uk/," target="_blank">http://gpf.dcemu.co.uk/,</a> but since libnds comes with one, should I switch over?
<br/>
<br/>
EDIT:
<br/>
<br/>
nvm. It appeared that using the dldi stub from libnds did not allow libfat to work with No$GBA. I switched back to the stub I used previously, and it works fine.<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
