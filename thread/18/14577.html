<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Texture Coordinates - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > Texture Coordinates</h2>
<div id="posts">
<div class="post">
    <h4>#145933 - Peter - Sun Nov 25, 2007 11:05 pm</h4>
    <div class="postbody"><span class="postbody">Hello all,
<br/>
<br/>
I have a few questions regarding texture-coordinates. 
<br/>
<br/>
When I wrote my displaylist converter and mesh viewer code, my goal was to use texture coordinates between 0..1, then use the texture matrix to scale them to the actual texture size. I though this makes sense, because it enables me to use textures with different sizes without changing the displaylist that contains the tex-coords. 
<br/>
<br/>
However, since the precision of the <a class="postlink" href="http://nocash.emubase.de/gbatek.htm#ds3dtextureattributes" target="_blank">TEXCOORD</a> command has only 4 bit fractional part, unfortunalety it runs out of precision rather soon and this makes it useless for me.
<br/>
<br/>
My current idea is to multiply the texture-coordinates in a displaylist by 256*16 during the displaylist creation. The 256 would be a hardcoded texture-size of 256x256 pixels and the 16 is for the tex-coord command's 4bit fraction.
<br/>
<br/>
Since I know the hardcoded 256 in the displaylists, I can calculate the ration between the 256 and the real texture size I want to use, then use the texture matrix again to scale it to the correct size. But I still have a bad feeling about this, it just seems wrong to me. 
<br/>
<br/>
However, I don't like the idea to store the exact texture-size in the displaylist and more or less bound it to exactly this size. What if I want to use the same displaylist with two different textures with different sizes (e.g. LOD, not the best example but you get what I mean).
<br/>
<br/>
What is your approach to handle this? I'm kinda confused.<br/>_________________<br/>Kind Regards,
<br/>
Peter</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145935 - DekuTree64 - Sun Nov 25, 2007 11:18 pm</h4>
    <div class="postbody"><span class="postbody">Personally I would just avoid using different texture sizes on the same model. A good artist will tweak the UV coordinates so it looks good with a specific resolution, depending on how large the model will generally be on screen. And for LOD, you'll generally want a different model with more polygons anyway, or use the high resolution textures all the time (because if you're planning to swap models in-game, you probably won't have time to load high-res textures).
<br/>
<br/>
That said, if you do have a legitimate reason to switch sizes, then yes, I would generate the coordinates for the largest size you plan to use, and then scale them down with a texture matrix.
<br/>
<br/>
And for what it's worth, you can modify display list data on the fly too.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145940 - nce - Mon Nov 26, 2007 12:45 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Peter wrote:</b></span></td> </tr> <tr> <td class="quote"> But I still have a bad feeling about this, it just seems wrong to me. </td> </tr></table><span class="postbody">
<br/>
<br/>
Don't worry, it's working :) that's the way I did it.<br/>_________________<br/>-jerome-</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145966 - M3d10n - Mon Nov 26, 2007 6:23 pm</h4>
    <div class="postbody"><span class="postbody">I generate UV coordinates assuming a fixed texture size (32x32, I think) and scale the texture matrix depending on the texture size. However, I don't store texture change commands in my display lists (I split my meshes in display lists for each material).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145974 - kusma - Mon Nov 26, 2007 11:46 pm</h4>
    <div class="postbody"><span class="postbody">wouldn't the "best" method be to normalize the texture coordinate so you utilize the full range and thus get maximum precision on each model, and then scale everything to match the texture using the texture-matrix?
<br/>
<br/>
edit: this technique does of course not limit itself to texture coordinates. use it at your vertices as well.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145976 - nce - Tue Nov 27, 2007 12:54 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>kusma wrote:</b></span></td> </tr> <tr> <td class="quote">wouldn't the "best" method be to normalize the texture coordinate so you utilize the full range and thus get maximum precision on each model.</td> </tr></table><span class="postbody">
<br/>
<br/>
you can of course, use the full range if you want, but you have to think also at your tilling.
<br/>
<br/>
Imagine that you know from the beginning that you 'll never make a texture bigger than 256*256 you don't need the extra precision to put a uv between 2 pixel ( no bilinear filtering on the DS ).  So it's better to assume all your texture as 256*256 that left you room to make them tile ( if you are doing environment )
<br/>
<br/>
- I use the same configuration : max texture 256*256 but all are assumed to be 128*128 so I can tile easily textures and when I have a 256 256 I just make sure that my uvs match the precision of a 128*128
<br/>
<br/>
<br/>
and yes I scale also environment with a factor of 16 compared to the characters :)<br/>_________________<br/>-jerome-</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145978 - kusma - Tue Nov 27, 2007 1:03 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>nce wrote:</b></span></td> </tr> <tr> <td class="quote">you can of course, use the full range if you want, but you have to think also at your tilling.
<br/>
</td> </tr></table><span class="postbody">
<br/>
Normalizing to the full range still gives you tiling. What I'm talking about is basically taking all your texture coordinates (in floating point), finding the minimum and the maximum of each component, and scale them to occupy the entire 16bit range of the texture coordinates. Then you can scale back however you want to texture-space using the texture matrix. Of course, if you have a lot of tiling over a single polygon, you might have to do something different, but that's a completely different matter, as no single scaling-method will give you high range and high precision at the same time.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145981 - M3d10n - Tue Nov 27, 2007 2:57 am</h4>
    <div class="postbody"><span class="postbody">Oh, that's a really good idea, Kusma. I already normalize vertex coordinates and store the correcting scale in the display list itself, to use the maximum precision, but I never thought of using it for textures. It might even improve minification and magnification quality a bit.
<br/>
<br/>
It also allows the artists to be more free when creating their UVs. Right now I have to ask them to keep all UVs as close as possible to the origin and avoid offsetting UV coords too much to avoid overflows, but if they are normalized, it doesn't matter.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145987 - nce - Tue Nov 27, 2007 4:58 am</h4>
    <div class="postbody"><span class="postbody">Hi Kusma, Yes it's a good idea,
<br/>
<br/>
But I'm not sure to understand why trying to get the best resolution possible ? there is no bilinear filtering on the ds so when you are doing your uvs is better to try to set them just between your texel.
<br/>
<br/>
as if you have a texture size 2 * 2, you can only have 0 , 0.5 and 1 as value for you uv. no realy need to get able to set a uv at 0.02 or 0.3, because that will just result in flickering, sometimes piking one pixel sometimes piking the other... 
<br/>
<br/>
&gt;&gt; that's why if you know that your texture is max 256*256, the concern about having full precision is not needed, I think.<br/>_________________<br/>-jerome-</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145991 - kusma - Tue Nov 27, 2007 8:53 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>nce wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
But I'm not sure to understand why trying to get the best resolution possible ? there is no bilinear filtering on the ds so when you are doing your uvs is better to try to set them just between your texel.
<br/>
</td> </tr></table><span class="postbody">
<br/>
Sure, there's no bilinear filtering, but there IS sub-texel precision. Being able to choose exactly where inside the texel a vertex is positioned makes it easier to improve the quality of the sampling. However, I believe that the biggest gain is that you get a somewhat "dynamic" range / precision trade-off from mesh to mesh.
<br/>
<br/>
By the way (quite unrelated, I know), I played around a bit with some kind of temporal filtering yesterday - alternating the texture matrix at full frame rate to get something slightly better than normal point sampling. It wasn't exactly a great success in 2d (1d worked great) due to all the flickering you get, but it might be usable for something. Perhaps, if one already does normal motion trail post processing, the flickering artifacts will disappear? :)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
