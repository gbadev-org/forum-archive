<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Very very simple sound demo - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Very very simple sound demo</h2>
<div id="posts">
<div class="post">
    <h4>#106868 - HyperHacker - Tue Oct 24, 2006 8:15 am</h4>
    <div class="postbody"><span class="postbody">Just figured I'd post this because sound documentation seems to be quite scarce. This explains how to play a tone of a specific frequency. The idea here is rather than generating a sample or loading it from a file, you do it like you would on old consoles and just choose the frequency and manually start and stop playback. This is good for things like emulation of said consoles.
<br/>
<br/>
First you turn sound on:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">SOUND_CR = SOUND_VOL(127) | SOUND_ENABLE;</td> </tr></table><span class="postbody">
<br/>
For the most part you can keep the volume at max (127) as the DS provides a hardware volume control. Software volume control might be useful for environment effects or something. I'm not sure if the DS can play loud enough sounds to damage its speakers, but be sensible.
<br/>
<br/>
You're supposed to wait 15 milliseconds before playing sound after turning it on. DS runs at 60FPS so one frame will take about 16ms; call swiWaitForVBlank() twice just to be safe (lest you call right before VBlank and end up only delaying 1ms). You have to have the VBlank interrupt enabled for this, which you should know how to do already.
<br/>
<br/>
Once you've done that you just choose your frequency, channel volume, pan, and wave duty and start the sound:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">SCHANNEL_TIMER(8) = SOUND_FREQ(DesiredFrequency &lt;&lt; 3);
<br/>
SCHANNEL_CR(8) = SOUND_VOL(127) | SOUND_PAN(64) | SCHANNEL_WAVEDUTY(6) | SOUND_FORMAT_PSG | SCHANNEL_ENABLE;</td> </tr></table><span class="postbody">
<br/>
<br/>
Simple breakdown of these values:
<br/>
SOUND_FREQ(DesiredFrequency &lt;&lt; 3) should be obvious. Your frequency needs to be multiplied by 8; you can left-shift by 3 as I've done here to accomplish the same but faster.
<br/>
<br/>
SOUND_VOL(127) sets the individual channel volume; again, no real reason to reduce it in a simple demo app.
<br/>
<br/>
SOUND_PAN(64) centers the sound. 0 would make it entirely on the left speaker, 127 entirely on the right.
<br/>
<br/>
SOUND_FORMAT_PSG enables the Programmable Sound Generator, which tells the DS we're doing choose-a-frequency-and-go sounds rather than playing actual sound samples in memory. There's probably a term for that but I can't think of one.
<br/>
<br/>
SCHANNEL_ENABLE, of course, turns the channel on.
<br/>
<br/>
libnds doesn't appear to have a wave duty macro, but you can add one:
<br/>
#define SCHANNEL_WAVEDUTY(n) (n &lt;&lt; 24)
<br/>
Various documents list completely different information for the wave duty values. The most reasonable I've seen is GBATek's: 0=12.5%..6=87.5%, 7=silence.
<br/>
<br/>
Finally, note that you can only do this on channels 8 through 13. You can also generate white noise using PSG on channels 14 and 15.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106879 - Lick - Tue Oct 24, 2006 11:14 am</h4>
    <div class="postbody"><span class="postbody">Thanks man, quite easy to follow! Good job!
<br/>
<br/>
- Lick<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106885 - 0xtob - Tue Oct 24, 2006 1:06 pm</h4>
    <div class="postbody"><span class="postbody">Yeah, thanks for taking the time to write that up! This should be easier to understand for newbies than the PSG description in GBAtek.
<br/>
<br/>
In fact, I would be happy to have some more documentation on the PSG. As the DS inherited the programmable sound generator from the GBA, which in turn inherited it from the Game Boy, the DS should be capable of much more oldskool sound goodness than described in GBAtek (which only covers pulse waves and noise). So, are there some hardware gurus around who could take a look at that?
<br/>
<br/>
Bye,
<br/>
Tob</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106902 - tepples - Tue Oct 24, 2006 4:29 pm</h4>
    <div class="postbody"><span class="postbody"><a class="postlink" href="http://www.pineight.com/ds/" target="_blank">AXE</a> uses the PSG.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106912 - josath - Tue Oct 24, 2006 7:00 pm</h4>
    <div class="postbody"><span class="postbody">I got this demo from mic a while ago, which he apparently wrote to test PSG emulation in his emulator, dualis. Includes a .NDS and the main source file, but not all of the supporting things like makefiles, etc. Should be easy enough to get to compile though. (may be using older version of libnds)
<br/>
<br/>
<a href="http://davr.org/ds2/PSG_Play.zip" target="_blank">http://davr.org/ds2/PSG_Play.zip</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#107195 - HyperHacker - Fri Oct 27, 2006 3:52 pm</h4>
    <div class="postbody"><span class="postbody">I was doing some more testing and GBATek's wave duty information actually seems to be wrong. 0 and 6 sound almost identical (very coarse) while 3 sounds a lot different. This matches another document I read, but I don't recall where.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114415 - clrFog - Sun Jan 07, 2007 7:57 pm</h4>
    <div class="postbody"><span class="postbody">Hi, I want to start playing around with the PSG. I use the simple sound example project as a startingpoint. My problem is that when i paste 
<br/>
<br/>
SOUND_CR = SOUND_ENABLE | SOUND_VOL(0x7F);
<br/>
<br/>
in main the compiler doesn't recognize it; " 'SOUND_CR' undeclared (first use in this function) ". And the documentation for libnds seems to be down at the moment. Can anywone explain whats wrong?
<br/>
Yes I'm noob ;)
<br/>
Would appreach any help.<br/>_________________<br/>DS lite white, M3 perfect lite micro SD, Sandisk 512MB</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114416 - Lick - Sun Jan 07, 2007 8:02 pm</h4>
    <div class="postbody"><span class="postbody">SOUND_CR is only available on the ARM7.. You probably copied that code to the ARM9 sources.<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114418 - clrFog - Sun Jan 07, 2007 8:11 pm</h4>
    <div class="postbody"><span class="postbody">Oh, the simple sound is just one file though, simplesound.c. So that is a arm9 code?<br/>_________________<br/>DS lite white, M3 perfect lite micro SD, Sandisk 512MB</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114420 - Lick - Sun Jan 07, 2007 8:18 pm</h4>
    <div class="postbody"><span class="postbody">Well, it's ARM9 alright. But you're not supposed to access SOUND_CR. The default ARM7 binary will handle it for you. 
<br/>
If you want your own initialization, you need to program the ARM7 as well. You can use the combined template to do this.<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114421 - clrFog - Sun Jan 07, 2007 8:32 pm</h4>
    <div class="postbody"><span class="postbody">Yes I tried the combined template and now my DS beeeeps!! =)
<br/>
Thx for incredibly fast response, now im going to make my DIY syntheziser!<br/>_________________<br/>DS lite white, M3 perfect lite micro SD, Sandisk 512MB</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121430 - clrFog - Mon Mar 12, 2007 11:24 am</h4>
    <div class="postbody"><span class="postbody">Mollusk has implemented acess to the PSG in PAlib.
<br/>
<br/>
<a href="http://palib.info/forum/modules/newbb/viewtopic.php?topic_id=1971&amp;forum=30" target="_blank">http://palib.info/forum/modules/newbb/viewtopic.php?topic_id=1971&amp;forum=30</a>
<br/>
<br/>
Try it, its fun =)<br/>_________________<br/>DS lite white, M3 perfect lite micro SD, Sandisk 512MB</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#139791 - lopazopy - Mon Sep 10, 2007 6:16 am</h4>
    <div class="postbody"><span class="postbody">I've been playing with PSG sound and when I set the pan to 0 (all the way to the left) i still get sound out of the right speaker.  I also checked it with headphones to make sure there was no sound contamination and I get the same thing.  Anybody know why I can't get sound to play out of one speaker and one speaker only?
<br/>
<br/>
Also, how do I calculate perfect Hz frequencies?  For example I want to play a sound at 300 Hz but the perfect frequency is something like 299.12 or 300.372 Hz.  How do I find that out?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#139797 - Diddl - Mon Sep 10, 2007 8:44 am</h4>
    <div class="postbody"><span class="postbody">is it possible to use more than one waveform (sinus, rectangle, sawtooth)?
<br/>
<br/>
is there only one oscillator or two per channel?
<br/>
<br/>
is it possible to make fm synthese?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#139811 - tepples - Mon Sep 10, 2007 12:25 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>lopazopy wrote:</b></span></td> </tr> <tr> <td class="quote">Anybody know why I can't get sound to play out of one speaker and one speaker only?</td> </tr></table><span class="postbody">
<br/>
If you've tried it with <span style="font-style: italic">good</span> headphones, then it's probably leakage within the DS. I know of an experiment to confirm this, but it would require a GameCube, a Game Boy Player accessory, and a SLOT-2 card that fits in a GBA.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>lopazopy wrote:</b></span></td> </tr> <tr> <td class="quote">Also, how do I calculate perfect Hz frequencies?  For example I want to play a sound at 300 Hz but the perfect frequency is something like 299.12 or 300.372 Hz.  How do I find that out?</td> </tr></table><span class="postbody">
<br/>
Differences in frequencies of less than 7 cents, where there are 1200 cents in an octave, should be inaudible to the human ear. What are you trying to do that needs a frequency better than +/- 0.4%?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Diddl wrote:</b></span></td> </tr> <tr> <td class="quote">is it possible to use more than one waveform (sinus, rectangle, sawtooth)? </td> </tr></table><span class="postbody">
<br/>
Rectangle is predefined for 1/8, 1/4, 3/8, and 1/2 duty cycle waveforms. For any other duty cycle, or for any other wave shape, you can always load a waveform into RAM and play it looped.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Diddl wrote:</b></span></td> </tr> <tr> <td class="quote">is there only one oscillator or two per channel?</td> </tr></table><span class="postbody">
<br/>
As far as I can tell, one.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Diddl wrote:</b></span></td> </tr> <tr> <td class="quote">is it possible to make fm synthese?</td> </tr></table><span class="postbody">
<br/>
Only in software, and the ARM7 hasn't been proven powerful enough to emulate the Yamaha FM chip in the Sega Genesis or AdLib chipset in real time.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#139828 - lopazopy - Mon Sep 10, 2007 4:59 pm</h4>
    <div class="postbody"><span class="postbody">I fixed the sound leakage problem by decreasing the vol from 127 (max) to 10.  It may still be there, but I can't hear it, so it isn't :)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">What are you trying to do that needs a frequency better than +/- 0.4%?</td> </tr></table><span class="postbody">
<br/>
<br/>
I don't think I need frequencies that accurate, but when I was listening to a nonstop tone at 3000 Hz it sounded like it was clicking and didn't sound constant.  I didn't know if it had to do with not picking a frequency that isn't a multiple of 32.768kHz or whatever of if that is just the way it is due to hardware.  I guess I'd just rather have perfect frequencies and sound....why shoot for less?</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
