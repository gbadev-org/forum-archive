<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Moving the console to another VRAM bank - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > Moving the console to another VRAM bank</h2>
<div id="posts">
<div class="post">
    <h4>#119772 - simonjhall - Mon Feb 26, 2007 1:34 am</h4>
    <div class="postbody"><span class="postbody">Yo,
<br/>
<br/>
I got a pretty dumb question here. I realised only today that I'd been using the stock consoleDemoInit() function and I'd been effectively typing up the whole of VRAM C for this.
<br/>
As I want to use banks A-D for textures, how do I move it to something a little less useful?
<br/>
<br/>
It's gotta be something obvious but I just can't seem to get it to work!<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119775 - chishm - Mon Feb 26, 2007 2:58 am</h4>
    <div class="postbody"><span class="postbody">Use </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void consoleInitDefault(u16* map, u16* charBase, u8 bitDepth);</td> </tr></table><span class="postbody">
<br/>
For even more control use </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void consoleInit(u16* font, u16* charBase, u16 numCharacters, u8 charStart, u16* map, u8 pal, u8 bitDepth);</td> </tr></table><span class="postbody">
<br/>
Both are defined in &lt;nds/arm9/console.h&gt;.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119790 - simonjhall - Mon Feb 26, 2007 10:27 am</h4>
    <div class="postbody"><span class="postbody">Yeah...
<br/>
I just dunno what I'm doing with that SCREEN_BASE_BLOCK_SUB and CHAR_BASE_BLOCK_SUB lark! By the looks of thost macros it seems that you're setting an offset from some address, and that address is bound to a particular bank...
<br/>
<br/>
Again, I'm sure it's obvious what the answer is - but it was pretty late when I was tring to sort it out!<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119794 - chishm - Mon Feb 26, 2007 11:48 am</h4>
    <div class="postbody"><span class="postbody">Try this (I haven't tested it):
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   
<br/>
videoSetModeSub(MODE_0_2D | DISPLAY_BG0_ACTIVE);   //sub bg 0 will be used to print text
<br/>
vramSetBankH(VRAM_H_SUB_BG); 
<br/>
<br/>
SUB_BG0_CR = BG_MAP_BASE(31);
<br/>
<br/>
BG_PALETTE_SUB[255] = RGB15(31,31,31);   //by default font will be rendered with color 255
<br/>
<br/>
//consoleInit() is a lot more flexible but this gets you up and running quick
<br/>
consoleInitDefault((u16*)SCREEN_BASE_BLOCK_SUB(31), (u16*)CHAR_BASE_BLOCK_SUB(0), 16);</td> </tr></table><span class="postbody">
<br/>
<br/>
This was taken from <a class="postlink" href="http://devkitpro.cvs.sourceforge.net/devkitpro/libnds/source/arm9/console.c?revision=1.18&amp;view=markup" target="_blank">the libnds consoleDemoInit function</a> with the VRAM block changed to H instead of C.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119795 - simonjhall - Mon Feb 26, 2007 12:09 pm</h4>
    <div class="postbody"><span class="postbody">Do you have to change any of those screen base or char base numbers?<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119818 - elhobbs - Mon Feb 26, 2007 6:08 pm</h4>
    <div class="postbody"><span class="postbody">here is the code I use for the sub screen console in VRAM bank H
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
// Subscreen as a console
<br/>
videoSetModeSub(MODE_0_2D | DISPLAY_BG0_ACTIVE);
<br/>
vramSetBankH(VRAM_H_SUB_BG); 
<br/>
SUB_BG0_CR = BG_MAP_BASE(15);
<br/>
consoleInitDefault((u16*)SCREEN_BASE_BLOCK_SUB(15), (u16*)CHAR_BASE_BLOCK_SUB(0), 16);
<br/>
BG_PALETTE_SUB[0]=0;   
<br/>
BG_PALETTE_SUB[255]=0xff00;
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119840 - simonjhall - Mon Feb 26, 2007 9:08 pm</h4>
    <div class="postbody"><span class="postbody">elhobbs: awesome, that worked first time! Thanks!
<br/>
<br/>
Thanks guys. Another 128k for me to piss around with...<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
