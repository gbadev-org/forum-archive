<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Help with display lists - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > Help with display lists</h2>
<div id="posts">
<div class="post">
    <h4>#170466 - FiveStringBass - Mon Sep 28, 2009 8:46 pm</h4>
    <div class="postbody"><span class="postbody">Hi all,
<br/>
<br/>
I've been playing with the example display list in the 3D examples, I added an extra vertex and colour, and wanted to add an extra quad to the list.  However, the new quad does not show up.  I know i'm not specifying a colour for each new vertex on the 2nd quad, but shouldn't it be drawn in the last colour that was set, i.e. white (31,31,31)?  The GL state should be set to quads and the draw colour set to white unless I change it in the meantime, shouldn't it?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
u32 triangle[] = 
<br/>
{
<br/>
   22,                   
<br/>
   FIFO_COMMAND_PACK(FIFO_BEGIN, FIFO_COLOR, FIFO_VERTEX16, FIFO_COLOR),
<br/>
      GL_QUAD,
<br/>
      RGB15(31,0,0),
<br/>
      VERTEX_PACK(inttov16(-1),inttov16(-1)), 
<br/>
      VERTEX_PACK(0,0),
<br/>
      RGB15(0,31,0),
<br/>
<br/>
   // FIFO_COMMAND_PACK(#FIFO_VERTEX16, FIFO_COLOR, FIFO_VERTEX16, FIFO_END),
<br/>
   FIFO_COMMAND_PACK(FIFO_VERTEX16,FIFO_COLOR, FIFO_VERTEX16, FIFO_COLOR),
<br/>
      VERTEX_PACK(inttov16(-1),inttov16(1)), 
<br/>
      VERTEX_PACK(0,0),
<br/>
      RGB15(0,0,31),
<br/>
      VERTEX_PACK(inttov16(1),inttov16(1)), 
<br/>
      VERTEX_PACK(0,0),
<br/>
      RGB15(31,31,31),
<br/>
<br/>
   FIFO_COMMAND_PACK(FIFO_VERTEX16, /*FIFO_COLOR*/ FIFO_VERTEX16, FIFO_VERTEX16, FIFO_VERTEX16),
<br/>
      VERTEX_PACK(inttov16(1), inttov16(-1)), 
<br/>
      VERTEX_PACK(0,0),   
<br/>
   //   RGB15(31, 0, 31),
<br/>
      VERTEX_PACK(inttov16(-1),inttov16(-1)), 
<br/>
      VERTEX_PACK(inttov16(-1),0),
<br/>
      VERTEX_PACK(inttov16(-1),inttov16(1)), 
<br/>
      VERTEX_PACK(inttov16(-1),0),
<br/>
      VERTEX_PACK(inttov16(1),inttov16(1)), 
<br/>
      VERTEX_PACK(inttov16(-2),0),
<br/>
<br/>
   FIFO_COMMAND_PACK(FIFO_VERTEX16, /*FIFO_VERTEX16*/  FIFO_NOP, FIFO_NOP, FIFO_NOP),
<br/>
      VERTEX_PACK(inttov16(1),inttov16(1)), 
<br/>
      VERTEX_PACK(inttov16(-2),0),
<br/>
   //   VERTEX_PACK(inttov16(1), inttov16(-1)), 
<br/>
   //   VERTEX_PACK(inttov16(-1),0)   
<br/>
////////////////
<br/>
<br/>
};
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Also, is the initial number a count of the commands (i.e. FIFO_BEGIN, FIFO_COLOR, FIFO_VERTEX16, FIFO_END/FIFO_NOP), or is it a count of the data being pushed onto the queue (e.g. if you take the original triangle it was specified with 12 commands, and you would need 3 vectors and 3 colour values to specify it (so 3 * xyz = 9 values + 3*rgb values = 12 in total))?
<br/>
<br/>
<br/>
Thanks,
<br/>
5SB</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#170474 - Pate - Tue Sep 29, 2009 5:02 am</h4>
    <div class="postbody"><span class="postbody">The initial number is count of the data, and that seems to be the problem in your example. You should put 25 as the value and your code should work.
<br/>
<br/>
If you don't want to manually calculate the size, you can do something like this:
<br/>
<br/>
triangle[0] = (sizeof(triangle)-4)&gt;&gt;2;
<br/>
<br/>
Ps. Welcome to the forum!
<br/>
<br/>
Pate<br/>_________________<br/><ul><li>Now working on DSx86 <a href="http://dsx86.patrickaalto.com" target="_blank">http://dsx86.patrickaalto.com</a>
<br/>
</li><li>Get LineWarsDS from <a href="http://linewars.patrickaalto.com" target="_blank">http://linewars.patrickaalto.com</a></li></ul></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#170501 - FiveStringBass - Tue Sep 29, 2009 7:46 pm</h4>
    <div class="postbody"><span class="postbody">Thanks very much Pate - 25 did the trick, but i'm still confused to be honest.  I want to be able to calculate the size manually for now just so I am sure what is happening.
<br/>
<br/>
If i'm going by the number of data items on the fifo, then with the 2 quads in the example, quad 1 contains 4 vertices and 4 colours = 16 data items, the second quad only contains 4 vertices, so 12 additional data items, making a total of 28. 
<br/>
<br/>
If I count the number of commands, then I only count 21. 
<br/>
<br/>
Sorry to appear dumb, I just don't get it...
<br/>
<br/>
5SB</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#170510 - DiscoStew - Tue Sep 29, 2009 11:31 pm</h4>
    <div class="postbody"><span class="postbody">The FIFO_COMMAND_PACK also counts as an item, and there are 4 in there, making it 25 in total.
<br/>
<br/>
Also, the 1st quad is 3 items per vertex (1 color, 2 vertex), making it 12 items, not 16. The 2nd quad is 2 items per vertex with having no change in color, so it would be 8 items.
<br/>
<br/>
12 + 8 + 1 (for GL_QUAD) + 4 (for 4 FIFO_COMMAND_PACKs) = 25<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#170512 - FiveStringBass - Wed Sep 30, 2009 12:01 am</h4>
    <div class="postbody"><span class="postbody">Ah, I see now.  Fantastic, ta very much DiscoStew! 
<br/>
<br/>
5SB</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
