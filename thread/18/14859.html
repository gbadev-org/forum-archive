<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>dma xor'ing data ? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > dma xor'ing data ?</h2>
<div id="posts">
<div class="post">
    <h4>#149175 - PypeBros - Wed Jan 16, 2008 10:42 am</h4>
    <div class="postbody"><span class="postbody">I was moving around datas between the main memory and VRAM using DMA lately, and during a debugging process, it suddenly started to go wild.
<br/>
<br/>
Rather than doing "normal" copies, the DS started to "overlay" past content and new content such as if a 'OR' or 'XOR' function was applied between them. Several updates of the software didn't fix the thing, but restarting the console did.
<br/>
<br/>
My guess is that i may have touched some DMA configuration bit that i don't reset in my initialisation code, but then, gbatek does not document any kind of "copy-and-combine" dma transfers (afaik).
<br/>
<br/>
Has anyone else ever experienced something alike ? If properly controlled, it could get handy for people working e.g. in bitmap mode (font rendering coming directly to mind)<br/>_________________<br/><a class="postlink" href="http://sylvainhb.blogspot.com/p/sprite-editor.html" target="_blank"> SEDS: Sprite Edition on DS</a> :: <a class="postlink" href="http://sylvainhb.blogspot.com/search/label/modplayer" target="_blank">modplayer</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#149180 - thoduv - Wed Jan 16, 2008 1:11 pm</h4>
    <div class="postbody"><span class="postbody">Has you been able to reproduce the behavior ?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#149181 - Jim e - Wed Jan 16, 2008 1:20 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>PypeBros wrote:</b></span></td> </tr> <tr> <td class="quote">Several updates of the software didn't fix the thing, but restarting the console did.</td> </tr></table><span class="postbody">You're saying that restarting the console fixed it. Are you sure video memory isn't somehow overlapping?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#149198 - PypeBros - Wed Jan 16, 2008 5:32 pm</h4>
    <div class="postbody"><span class="postbody">@thoduv: unfortunately (?) no, i haven't reproduced it. I mean, not since i power-cycled the console. I suspect it appeared due to invalid lengths submitted to dmaCopy(), resulting of some data corruption ...
<br/>
<br/>
My software works in the following way: it can get a new copy of itself over HTTP and stores it in a file before it performs a software reset and have the freshly updated software loaded again in memory. That's what i did several times. The same copy of the software stop showing the bug after i power-cycled the console.<br/>_________________<br/><a class="postlink" href="http://sylvainhb.blogspot.com/p/sprite-editor.html" target="_blank"> SEDS: Sprite Edition on DS</a> :: <a class="postlink" href="http://sylvainhb.blogspot.com/search/label/modplayer" target="_blank">modplayer</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#149257 - simonjhall - Thu Jan 17, 2008 10:16 am</h4>
    <div class="postbody"><span class="postbody">Could be a cache thing? Wouldn't give an xor effect, but the DMA system might get the crap that used to be in memory before the data cache was written back.
<br/>
DC_FlushAll before DMA = teh friend.<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#149267 - Jim e - Thu Jan 17, 2008 3:36 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>simonjhall wrote:</b></span></td> </tr> <tr> <td class="quote">DC_FlushAll before DMA = teh friend.</td> </tr></table><span class="postbody">Kinda spoils the whole point of dmacopy then. Though it is a good way to see if thats the issue.
<br/>
<br/>
I've heard of the bitwise or problem, it was due to mapping vram banks to the same spot. It would fix itself if you reset all the banks.
<br/>
<br/>
Do you have any more symptoms or example code?</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
