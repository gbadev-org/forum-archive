<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Cannot build: undefined reference to `initSystem' - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Cannot build: undefined reference to `initSystem'</h2>
<div id="posts">
<div class="post">
    <h4>#143588 - Kheldar - Wed Oct 24, 2007 3:10 am</h4>
    <div class="postbody"><span class="postbody">I've installed devkitpro and PALib again after reinstalling XP. However trying to build anything including any of the tutorials results in:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">c:/devkitpro/devkitarm/bin/../lib/gcc/arm-eabi/4.1.2/../../../../arm-eabi/lib/th
<br/>
umb/ds_arm9_crt0.o: In function `CIDLoop':
<br/>
ds_arm9_crt0.s:(.init+0x2ac): undefined reference to `initSystem'
<br/>
collect2: ld returned 1 exit status
<br/>
make[1]: *** [/c/Lesson2/Lesson2.elf] Error 1</td> </tr></table><span class="postbody">
<br/>
<br/>
Have I forgotten to do something after installing? &gt;&lt;
<br/>
<br/>
Thanks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143590 - wintermute - Wed Oct 24, 2007 4:14 am</h4>
    <div class="postbody"><span class="postbody">Isn't that just great?
<br/>
<br/>
It would appear that the PAlib people have done something rather nasty. Can you build the libnds examples provided with devkitARM?<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143591 - Hyouko - Wed Oct 24, 2007 6:01 am</h4>
    <div class="postbody"><span class="postbody">Nah, I got a similar bug after trying to manually install devkitARM r21 on my Vista machine.  After the rest of the updates got out (and were installed by the updater prog) everything worked fine.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143593 - wintermute - Wed Oct 24, 2007 6:23 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Hyouko wrote:</b></span></td> </tr> <tr> <td class="quote">Nah, I got a similar bug after trying to manually install devkitARM r21 on my Vista machine.  After the rest of the updates got out (and were installed by the updater prog) everything worked fine.</td> </tr></table><span class="postbody">
<br/>
<br/>
With PAlib specifically?
<br/>
<br/>
I did hear a rumour that the PAlib people were actually embedding libnds now rather than working with the installed version. Hopefully it's not true
<br/>
<br/>
<span style="font-weight: bold">EDIT:</span> Yes, it appears to be true. PAlib is really rather broken, sorry.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143600 - Rajveer - Wed Oct 24, 2007 9:35 am</h4>
    <div class="postbody"><span class="postbody">Hmm, seems I get a similar problem after using the automated installer on Vista 64 (w/o PALib). When trying to compile an example I get:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">C:\DSDevelopment\devkitPro\examples\nds\sound\SimpleSound\data&gt;make
<br/>
make: *** No targets specified and no makefile found.  Stop.</td> </tr></table><span class="postbody">
<br/>
<br/>
After trying to compile my own project I get (after using build.bat which cleans and makes):
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">C:\DSDevelopment\Raji\Futuracer\Futuracer7&gt;make clean
<br/>
make: *** [clean] Error 1
<br/>
<br/>
C:\DSDevelopment\Raji\Futuracer\Futuracer7&gt;make
<br/>
make: *** [build] Error 1
<br/>
<br/>
C:\DSDevelopment\Raji\Futuracer\Futuracer7&gt;pause
<br/>
Press any key to continue . . .</td> </tr></table><span class="postbody">
<br/>
<br/>
My environmental variables are:
<br/>
<br/>
Devkitarm: /c/DSDevelopment/devkitPro/devkitARM
<br/>
Devkitpro: /c/DSDevelopment/devkitPro
<br/>
Path: c:\DSDevelopment\devkitPro\msys\bin
<br/>
%SystemRoot%\system32
<br/>
%SystemRoot%
<br/>
%SystemRoot%\System32\Wbem
<br/>
<br/>
EDIT: Fixed, with the newer version compatible with Vista 64.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143625 - Kheldar - Wed Oct 24, 2007 9:22 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">Isn't that just great?
<br/>
<br/>
It would appear that the PAlib people have done something rather nasty. Can you build the libnds examples provided with devkitARM?</td> </tr></table><span class="postbody">
<br/>
<br/>
Sorry for not replying sooner, long work hours. :)
<br/>
<br/>
I got the same error building those. However I just reinstalled devkit without PAlib and they build fine now. Is PAlib unusable with devkitpro now then?
<br/>
<br/>
I wanted to use PAlib as image loading was easier. I cant seem to grasp what you need to do for the file from the graphics examples and couldnt find anything that made sense searching around. Maybe I'm just being really dense. 
<br/>
<br/>
For example in the 256 colour bitmap example there are .git and .grit files, I have the app, but cant seem to make my own .git and .grit files. Do I need these? The source has #include "drunkenlogo.h but I cant see that file anywhere?
<br/>
<br/>
Say I have a 256x256 bitmap. What should be done to it in what order with what tools to then use it in the code?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143633 - Hyouko - Wed Oct 24, 2007 9:55 pm</h4>
    <div class="postbody"><span class="postbody">Well, a kindly fellow named Peter linked me to his texture converting tool:
<br/>
<br/>
<a class="postlink" href="http://www.console-dev.de/tmp/tex2n3d.zip" target="_blank">http://www.console-dev.de/tmp/tex2n3d.zip</a>
<br/>
<br/>
which you can use to get .bin files for the texture and/or texture palette.  you can then load them in the same way that the various example 3D nds projects (textured cube, paletted cube, etc) do.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143640 - wintermute - Wed Oct 24, 2007 11:08 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Hyouko wrote:</b></span></td> </tr> <tr> <td class="quote">Well, a kindly fellow named Peter linked me to his texture converting tool:
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
That's nice, shame it's not actually relevant to the OP's question.
<br/>
<br/>
Stay tuned, large post in progress, I'm doing my best to explain a specific use of grit in some detail but it may take a while to get done.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"><br/><br/>Last edited by wintermute on Thu Oct 25, 2007 6:06 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#143675 - wintermute - Thu Oct 25, 2007 6:06 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Kheldar wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Sorry for not replying sooner, long work hours. :)
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
That's OK, there's no particular rush.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
I got the same error building those. However I just reinstalled devkit without PAlib and they build fine now. Is PAlib unusable with devkitpro now then?
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
That's a bit disturbing, I'm hoping this was just a result of the timing of the updates rather than a specific PAlib related issue. Both libnds and devkitARM were updated simultaneously and you may have managed to run the updater at a point when libnds had not yet propagated through the sourceforge mirror system. The link error you were experiencing is due to having the older libnds version installed which does not contain some of the code needed by the toolchain itself.
<br/>
<br/>
From a recent cursory examination of the PAlib files it would appear that they have decided to distribute some random versions of the libraries supplied by devkitPro. This situation makes it extremely difficult to ensure that their system will work with any updates I make. 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
I wanted to use PAlib as image loading was easier. I cant seem to grasp what you need to do for the file from the graphics examples and couldnt find anything that made sense searching around. Maybe I'm just being really dense.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Image loading seems easier because they've written the code for you and you don't have to understand the underlying architechture. It's great if you want the instant gratification of seeing stuff on screen but not so good when you get a bit more advanced and discover that it doesn't work in the right way for your latest game design.  
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
For example in the 256 colour bitmap example there are .git and .grit files, I have the app, but cant seem to make my own .git and .grit files. Do I need these? The source has #include "drunkenlogo.h but I cant see that file anywhere?
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Sorry, it seems I didn't remove the old files from the examples before generating the archive. You only need a .grit file, .git was used before we had to rename the tool due to a name collision with a source control system.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Say I have a 256x256 bitmap. What should be done to it in what order with what tools to then use it in the code?</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
It kind of depends on what you intend the bitmap for. Since you specified 256x256 here and that's the size of a small DS background map I'm going to assume you want to use a tiled background here.
<br/>
<br/>
The standard arm9 template supplied now has rules for converting images in a folder called 'gfx' using grit. This is a fairly simple procedure.
<br/>
<br/>
First copy the arm9 template found in devkitPro\examples\nds\templates - on my set up I just copied the arm9 folder from c:\devkitPro\examples\nds\templates to c:\projects\nds.
<br/>
<br/>
Then give the folder a new name, I renamed it as 256colorTilemap - that way I have some idea of what it is later when I'm looking through the code.
<br/>
<br/>
Make a new folder in there called gfx and copy your 256x256 256color bitmap in there.
<br/>
<br/>
Now double click the .pnproj file in the template folder to load the project in Programmer's Notepad 2. We're going to create a .grit file so that grit knows what format to convert the image to - this is a simple text file containing command line arguments for grit.  I've commented the options here so you know what they are, the lines beginning with # are ignored by the tool. I'm using a file called tilemap.bmp so this text file is saved as tilemap.grit
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#-------------------------------------------------------
<br/>
# graphics in tile format
<br/>
#-------------------------------------------------------
<br/>
-gt
<br/>
<br/>
#-------------------------------------------------------
<br/>
# tile reduction by tiles, palette and hflip/vflip
<br/>
#-------------------------------------------------------
<br/>
-mRtpf
<br/>
<br/>
#-------------------------------------------------------
<br/>
# graphics bit depth is 8 (256 color)
<br/>
#-------------------------------------------------------
<br/>
-gB8
<br/>
<br/>
#-------------------------------------------------------
<br/>
# map layout standard bg format
<br/>
#-------------------------------------------------------
<br/>
-mLs
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
A full list of the commands that grit understands can be found at <a href="http://coranac.com/files/grit-readme.txt" target="_blank">http://coranac.com/files/grit-readme.txt</a>
<br/>
<br/>
Now we need to write some code to display the image so open up the main.c file and edit it to suit. I ended up with this
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
/*---------------------------------------------------------------------------------
<br/>
<br/>
   Simple tilemap demo
<br/>
   -- WinterMute
<br/>
<br/>
---------------------------------------------------------------------------------*/
<br/>
#include &lt;nds.h&gt;
<br/>
<br/>
#include "tilemap.h"
<br/>
<br/>
//---------------------------------------------------------------------------------
<br/>
int main(void) {
<br/>
//---------------------------------------------------------------------------------
<br/>
<br/>
   // initialise the interrupt system
<br/>
   irqInit();
<br/>
   // and enable the vblank interrupt so we can use swiWaitForVblank()
<br/>
   irqEnable(IRQ_VBLANK);
<br/>
<br/>
   // enable the main screen with background 0 active
<br/>
   videoSetMode(MODE_0_2D | DISPLAY_BG0_ACTIVE);
<br/>
<br/>
   // map bank A for use with the background
<br/>
   vramSetBankA(VRAM_A_MAIN_BG);
<br/>
 
<br/>
   // enable background 0 in 256 color mode with a 256x256 map
<br/>
   // BG_TILE_BASE changes the offset where tile data is stored
<br/>
   // BG_MAP_BASE gives the offset to the map data
<br/>
   BGCTRL[0] = BG_TILE_BASE(0) | BG_MAP_BASE(4) | BG_COLOR_256 | TEXTBG_SIZE_256x256;
<br/>
<br/>
   // use dma to copy the tile, map and palette data to VRAM
<br/>
   // CHAR_BASE_BLOCK gives us the actual address of the tile data
<br/>
   // SCREEN_BASE_BLOCK does the same thing for maps
<br/>
   // these should match the BG_TILE_BASE and BG_MAP base numbers above
<br/>
   dmaCopy(tilemapPal,BG_PALETTE,tilemapPalLen);
<br/>
   dmaCopy(tilemapTiles,(void *)CHAR_BASE_BLOCK(0),tilemapTilesLen);
<br/>
   dmaCopy(tilemapMap,(void *)SCREEN_BASE_BLOCK(4),tilemapMapLen);
<br/>
<br/>
   // finally, hang around in an infinite loop
<br/>
   // using swiWaitForVBlank here puts the DS into a low power loop
<br/>
   while(1) {
<br/>
      swiWaitForVBlank();
<br/>
   }
<br/>
<br/>
   return 0;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
The header file "tilemap.h" is generated by grit and can be found in the build folder. The names are generated from the filename of the bmp so, for a tiled image like this we end up with a few variables defined.
<br/>
<br/>
&lt;filename&gt;Pal - address of the palette data
<br/>
&lt;filename&gt;PalLen - size of the palette data in bytes
<br/>
&lt;filename&gt;Tiles - address of the tile data
<br/>
&lt;filename&gt;TilesLen - size of he tile data in bytes
<br/>
&lt;filename&gt;Map - address of the map data
<br/>
&lt;filename&gt;MapLen - size of the map in bytes
<br/>
<br/>
It's worth reviewing the material in TONC, <a href="http://coranac.com/tonc/text/regbg.htm" target="_blank">http://coranac.com/tonc/text/regbg.htm</a> covers tiled backgrounds in some detail. The documentation there is all for GBA but the DS implements a superset of the GBA hardware so it's still well worth reading.
<br/>
<br/>
For what it's worth I uploaded the complete project for this little example at <a href="http://devkitpro.sourceforge.net/256colorTilemap.zip" target="_blank">http://devkitpro.sourceforge.net/256colorTilemap.zip</a><br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
