<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Storage in EWRAM - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Storage in EWRAM</h2>
<div id="posts">
<div class="post">
    <h4>#43081 - LOUD NOISES - Wed May 18, 2005 9:54 pm</h4>
    <div class="postbody"><span class="postbody">I'm trying to store some information in the EWRAM and I'm running into trouble. Whenever I declare a variable stored in EWRAM the compile takes about 5 times as long as normal and produces a 24 MB file. I'm declaring the variable like so
<br/>
<br/>
static unsigned char grid[192][256] __attribute__ ((section (".ewram"))) = { 0 };
<br/>
<br/>
Any ideas?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#43091 - tepples - Thu May 19, 2005 12:02 am</h4>
    <div class="postbody"><span class="postbody"><span style="font-weight: bold">Try this first:</span>
<br/>
Leave off the " = { 0 }" at the end of the declaration.
<br/>
<br/>
<span style="font-weight: bold">If that doesn't work:</span>
<br/>
Using the section ".ewram" will cause the compiler to actually copy the array into the binary. If you just want a big zero-filled array, try putting it in a section that the linker script considers zero-filled and destined for the Nintendo DS's 4 MB EWRAM. Try the names ".bss" or ".sbss"; I haven't read the Nintendo DS link script myself, but extrapolating from the GBA link script and what I've read in this section, one of those should work.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#43102 - LOUD NOISES - Thu May 19, 2005 2:43 am</h4>
    <div class="postbody"><span class="postbody">Using the section ".sbss" seems to be working perfectly. Thanks for your help.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#43138 - Mollusk - Thu May 19, 2005 12:46 pm</h4>
    <div class="postbody"><span class="postbody">what exactly is .sbss ?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#43147 - tepples - Thu May 19, 2005 2:53 pm</h4>
    <div class="postbody"><span class="postbody">".bss", or "block storage section", is the name of a memory section used by the linker. Like ".data", it is writable, but unlike ".data", the contents of ".bss" are not stored in the executable; rather, they're zero-filled before the startup code calls main().
<br/>
<br/>
".sbss", or "second block storage section", is a term referring to a second zero-filled section on some platforms, similar to ".bss" and usually in a larger, slower area of memory. For instance, on the Game Boy Advance, ".bss" goes in IWRAM (32 KB, 32-bit, 0 wait state), and ".sbss" goes in EWRAM (256 KB, 16-bit, 2 wait states unless overclocked through an officially undocumented register).<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#43148 - Mollusk - Thu May 19, 2005 2:58 pm</h4>
    <div class="postbody"><span class="postbody">Ok, thanks a lot ! It's really clear now for me :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#43168 - LOUD NOISES - Thu May 19, 2005 7:41 pm</h4>
    <div class="postbody"><span class="postbody">It's strange that .bss didn't work for me. Although the program compiled fine (unlike using .ewram), the program results were pretty screwy until I tried .sbss. Here's what I tried (these are all global):
<br/>
<br/>
unsigned char grid[192][256];
<br/>
(compiled fine, but program crashed on the hardware (just two black screens) although it worked for the most part on the iDeaS)
<br/>
<br/>
static unsigned char grid[192][256];
<br/>
static unsigned char grid[192][256] __attribute__ ((section (".bss"))) 
<br/>
(both of these resulted in the same problem (below))
<br/>
<br/>
static unsigned char grid[192][256] __attribute__ ((section (".ewram"))) 
<br/>
(compiled into a 20+ MB file)
<br/>
<br/>
static unsigned char grid[192][256] __attribute__ ((section (".sbss"))) 
<br/>
(worked correctly)
<br/>
<br/>
As for the screwy output... if I filled grid with 50 lines of red, 50 of blue, 50 of green, and 42 with purple, then copied grid into BG_GFX (or sub) with background 3 set to extended rotation background in mode BG_BMP8_256x256, only about half of the image would be displayed. 
<br/>
<br/>
Toward the middle of screen (after red and blue) the image would get would have bits of black here and there then go completely black. Then toward the botton the image would seem to start over (red and blue again).
<br/>
<br/>
I can't get extended backgrounds to show up in ideas, so here's a crappy mspaint example what seems to happen:
<br/>
<br/>
<a href="http://img212.echo.cx/img212/8469/pic8yv.jpg" target="_blank">http://img212.echo.cx/img212/8469/pic8yv.jpg</a>
<br/>
<br/>
After switching to .sbss everything worked fine, but if I could get it into faster memory it would be nice.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#43169 - LOUD NOISES - Thu May 19, 2005 7:44 pm</h4>
    <div class="postbody"><span class="postbody">Oh wait, that's 48 kb. That must explain the problem with IWRAM.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
