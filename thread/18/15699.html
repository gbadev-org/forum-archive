<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>[Fixed] Problem with ROTOSCALE - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > [Fixed] Problem with ROTOSCALE</h2>
<div id="posts">
<div class="post">
    <h4>#158832 - Gardner - Thu Jun 19, 2008 1:41 am</h4>
    <div class="postbody"><span class="postbody">Hi there, i'm starting to learn a thing or two about NDS Game Programming. Just for start, i decided to try PATATER's Tutorial. Everything was great until i reache the sprite part.
<br/>
<br/>
When i set the sprite of the ship as rotoscale, it was draw in a wrong way, like is shown in the this image: <a href="http://img171.imageshack.us/img171/7708/problemwithrotoscaleuw9.png" target="_blank">http://img171.imageshack.us/img171/7708/problemwithrotoscaleuw9.png</a> When I set its rotoscale as false, the problem goes away.
<br/>
<br/>
Someone can help-me? Or at least send-me some directions? :)
<br/>
Bye!<br/>_________________<br/>"Open your eyes and see..."</span><span class="gensmall"><br/><br/>Last edited by Gardner on Sun Jun 22, 2008 2:58 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#158834 - yellowstar - Thu Jun 19, 2008 2:02 am</h4>
    <div class="postbody"><span class="postbody">Post your code. It's usually very difficult for anybody to help you without the code. The exact same thing happens on hardware/actual DS, correct?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#158841 - Gardner - Thu Jun 19, 2008 3:34 am</h4>
    <div class="postbody"><span class="postbody">Sorry, i don't know why i thought that just mention pataters will help. :(
<br/>
<br/>
So this is the code:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void initVideo() {
<br/>
  vramSetMainBanks(VRAM_A_MAIN_BG_0x06000000,
<br/>
                   VRAM_B_MAIN_BG_0x06020000,
<br/>
                   VRAM_C_SUB_BG_0x06200000,
<br/>
                   VRAM_D_LCD);
<br/>
<br/>
  vramSetBankE(VRAM_E_MAIN_SPRITE);
<br/>
<br/>
  videoSetMode(MODE_5_2D |
<br/>
               DISPLAY_BG2_ACTIVE |
<br/>
               DISPLAY_BG3_ACTIVE |
<br/>
               DISPLAY_SPR_ACTIVE |
<br/>
               DISPLAY_SPR_1D);
<br/>
  
<br/>
  videoSetModeSub(MODE_5_2D |
<br/>
                  DISPLAY_BG3_ACTIVE);
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void initSprites(tOAM * oam, SpriteInfo *spriteInfo) {
<br/>
<br/>
  static const int BYTES_PER_16_COLOR_TILE = 32;
<br/>
  static const int COLORS_PER_PALETTE = 16;
<br/>
  static const int BOUNDARY_VALUE = 32;
<br/>
  static const int OFFSET_MULTIPLIER = BOUNDARY_VALUE / sizeof(SPRITE_GFX[0]);
<br/>
  
<br/>
  int nextAvailableTileIdx = 0;
<br/>
  
<br/>
  static const int SHUTTLE_OAM_ID = 0;
<br/>
  assert(SHUTTLE_OAM_ID &lt; SPRITE_COUNT);
<br/>
  SpriteInfo * shuttleInfo = &amp;spriteInfo[SHUTTLE_OAM_ID];
<br/>
  SpriteEntry * shuttle = &amp;oam-&gt;spriteBuffer[SHUTTLE_OAM_ID];
<br/>
  
<br/>
  shuttleInfo-&gt;oamId = SHUTTLE_OAM_ID;
<br/>
  shuttleInfo-&gt;width = 64;
<br/>
  shuttleInfo-&gt;height = 64;
<br/>
  shuttleInfo-&gt;angle = 462;
<br/>
  shuttleInfo-&gt;entry = shuttle;
<br/>
  
<br/>
  shuttle-&gt;posY = SCREEN_HEIGHT / 2 - shuttleInfo-&gt;height;
<br/>
  shuttle-&gt;isRotoscale = true;
<br/>
<br/>
  
<br/>
  assert(!shuttle-&gt;isRotoscale || (shuttleInfo-&gt;oamId &lt; MATRIX_COUNT));
<br/>
  shuttle-&gt;rsDouble = false;
<br/>
  shuttle-&gt;objMode = OBJMODE_NORMAL;
<br/>
  shuttle-&gt;isMosaic = false;
<br/>
  shuttle-&gt;colMode = OBJCOLOR_16;
<br/>
  shuttle-&gt;objShape = OBJSHAPE_SQUARE;
<br/>
  
<br/>
  shuttle-&gt;posX = SCREEN_WIDTH / 2 - shuttleInfo-&gt;width * 2 + shuttleInfo-&gt;width / 2;
<br/>
  shuttle-&gt;rsMatrixIdx = ATTR1_ROTDATA(shuttleInfo-&gt;oamId);
<br/>
  shuttle-&gt;objSize = OBJSIZE_64;
<br/>
  
<br/>
  shuttle-&gt;tileIdx = nextAvailableTileIdx;
<br/>
  
<br/>
  nextAvailableTileIdx += orangeShuttleTilesLen / BYTES_PER_16_COLOR_TILE;
<br/>
  
<br/>
  shuttle-&gt;objPriority = OBJPRIORITY_1;
<br/>
  shuttle-&gt;objPal = shuttleInfo-&gt;oamId;
<br/>
  
<br/>
  rotateSprite(&amp;oam-&gt;matrixBuffer[shuttleInfo-&gt;oamId], shuttleInfo-&gt;angle);
<br/>
<br/>
...
<br/>
  
<br/>
  dmaCopyHalfWords(SPRITE_DMA_CHANNEL,
<br/>
                   orangeShuttlePal,
<br/>
                   &amp;SPRITE_PALETTE[shuttleInfo-&gt;oamId * COLORS_PER_PALETTE],
<br/>
                   orangeShuttlePalLen);
<br/>
  
<br/>
  dmaCopyHalfWords(SPRITE_DMA_CHANNEL,
<br/>
                   orangeShuttleTiles,
<br/>
                   &amp;SPRITE_GFX[shuttle-&gt;tileIdx * OFFSET_MULTIPLIER],
<br/>
                   orangeShuttleTilesLen);
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
And about your question, the answer is yes, in the console is the same thing. Thanks for yout time!! :)<br/>_________________<br/>"Open your eyes and see..."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#158846 - eKid - Thu Jun 19, 2008 9:51 am</h4>
    <div class="postbody"><span class="postbody">Hmm, very wierd output.. not sure what's causing that. It looks like its skipping some rows when the sprite is drawing. You can see the 'moon' sprite on the bottom of the ship. How are you converting the graphics?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#158891 - Gardner - Fri Jun 20, 2008 10:22 am</h4>
    <div class="postbody"><span class="postbody">All images are converted by "grit". One more screenshot from dualis where is show details about OAM.
<br/>
<br/>
<a href="http://img264.imageshack.us/img264/1456/rotoscaleoamqb6.png" target="_blank">http://img264.imageshack.us/img264/1456/rotoscaleoamqb6.png</a><br/>_________________<br/>"Open your eyes and see..."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#158896 - silent_code - Fri Jun 20, 2008 11:29 am</h4>
    <div class="postbody"><span class="postbody">This is normal with Dualis and 16 color sprites. ;^)
<br/>
Try it on no$gba and HW, it should work. :^D<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#158905 - eKid - Fri Jun 20, 2008 1:42 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
And about your question, the answer is yes, in the console is the same thing.
<br/>
</td> </tr></table><span class="postbody">
<br/>
I think that means he tested on HW?
<br/>
<br/>
Gardner: Could you upload an .nds binary somewhere?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#158906 - silent_code - Fri Jun 20, 2008 1:58 pm</h4>
    <div class="postbody"><span class="postbody">Sorry! Even though I especially looked for that statement, I overlooked it! Damn! :^\
<br/>
<br/>
Try:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">shuttle-&gt;rsMatrixIdx = shuttleInfo-&gt;oamId;</td> </tr></table><span class="postbody">
<br/>
That worked for some others, who also started with Patater's guide. :^)
<br/>
<br/>
The sprite structure was changed to work with C bitfields, so the shifting makros aren't needed anymore - even worse: they must not be used, because they will corrupt data, just like in your program!
<br/>
<br/>
EDIT @ Gardner: You're welcome. :^)<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"><br/><br/>Last edited by silent_code on Sun Jun 22, 2008 12:04 pm; edited 2 times in total</span></div>    
</div>
<div class="post">
    <h4>#158930 - Gardner - Sat Jun 21, 2008 10:25 pm</h4>
    <div class="postbody"><span class="postbody">WoW!!! Worked like magic!! \o/
<br/>
<br/>
It works in the HW too, but, as you said, it doesn't work on dualis. I will try the no$gba.
<br/>
<br/>
An thanks for the tips about sprite structure.
<br/>
<br/>
eKid, i think there is no need for the .nds now, am i correct?
<br/>
<br/>
Thanks for all of you!! :)<br/>_________________<br/>"Open your eyes and see..."</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
