<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Accessing GBA cart from ARM9 code? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Accessing GBA cart from ARM9 code?</h2>
<div id="posts">
<div class="post">
    <h4>#39817 - FeaRog - Tue Apr 12, 2005 5:46 pm</h4>
    <div class="postbody"><span class="postbody">Hey,
<br/>
 I've been trying to read from the GBA cart in the ARM9 code, and it always seems to return zero. Trying to DMA from it also doesn't seem to work. I can access it fine using the ARM7, but I'd much rather use the ARM9 if possible.
<br/>
<br/>
Does anyone know if it is possible? If so, how exactly? I must be missing something.
<br/>
<br/>
Also, do we have any RPC or semaphore mechanisms to communicate between the two processors?
<br/>
<br/>
Cheers!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39862 - tepples - Wed Apr 13, 2005 12:22 am</h4>
    <div class="postbody"><span class="postbody">I have no experience with the Nintendo DS in specific, but given that the ARM7 CPU has been compared to the "I/O processors" in the Jaguar and PS2, here's how I'd design it on a high level.
<br/>
<br/>
<span style="font-weight: bold">On ARM7:</span>
<br/>
Put something like gbfs_copy_obj() on the ARM7. Then make a wrapper around it that takes a list of files and a destination address and copies them from ROM. Have your ARM7 main code repeatedly check a "start" flag in shared memory and, once it becomes set, process the list and set a "finish" flag.
<br/>
<br/>
<span style="font-weight: bold">On ARM9:</span>
<br/>
Construct a list of files to be copied into RAM, set the start flag, and do other things while waiting for the finish flag to become set.
<br/>
<br/>
This will work, but having the ARM7 spin on "start" may not be the best idea battery-consumption-wise.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39865 - FeaRog - Wed Apr 13, 2005 12:45 am</h4>
    <div class="postbody"><span class="postbody">Thats essentially what I'm doing, but the performance is shocking. The ARM7 spinning on the flag in shared memory seems to be killing performance. The swiWaitForVBlank() function doesn't seem to work at the moment, so without that wait it is continually checking the flag and hogging the memory bus. I don't want to load everything at the start and then stop the loader (if I were doing that I'd just compile everything into the main executable). Performance would probably be much improved with a decent delay between checks, or a different communication mechanism between the two (semaphores? RPC? anyone know what options we have here?)
<br/>
<br/>
If possible I'd still like to use the arm9 for it. An interest point of note is that while I can't upload a texture to VRAM directly from the GBA cart, it seems that I can DMA a display list directly from it (!) I'll have to do some more testing to quadruple-check this one and make sure I'm not smoking something...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39866 - tepples - Wed Apr 13, 2005 12:48 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>FeaRog wrote:</b></span></td> </tr> <tr> <td class="quote">The swiWaitForVBlank() function doesn't seem to work at the moment, so without that wait it is continually checking the flag and hogging the memory bus [...] Performance would probably be much improved with a decent delay between checks, or a different communication mechanism between the two (semaphores? RPC? anyone know what options we have here?)</td> </tr></table><span class="postbody">
<br/>
You could have it spin while waiting for hblank.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39867 - DekuTree64 - Wed Apr 13, 2005 1:08 am</h4>
    <div class="postbody"><span class="postbody">Until Dovoto and company figure out a few more things about the hardware, I'd suggest making an ARM7 data loading system that checks a flag/queue on VBlank, and have the ARM9 tell it to load all necessary assets at the start of each level.
<br/>
It's a little less flexible, but should be nice and simple to get set up, and doesn't involve the loss of my job :)<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
