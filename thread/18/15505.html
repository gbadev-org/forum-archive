<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>warning: array subscript is above array bounds - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > warning: array subscript is above array bounds</h2>
<div id="posts">
<div class="post">
    <h4>#156312 - Quirky - Thu May 08, 2008 8:58 pm</h4>
    <div class="postbody"><span class="postbody">Anyone know if this is a "feature" of gcc 4.3? It happens with DKA r22 and this code:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include &lt;algorithm&gt;
<br/>
<br/>
const static int COUNT(8);
<br/>
unsigned char vals[COUNT] = {0};
<br/>
<br/>
bool doStuff(unsigned char a)
<br/>
{
<br/>
  unsigned char *begin = vals;
<br/>
  unsigned char *end = (vals+COUNT);
<br/>
  return std::find(begin, end, a) != end;
<br/>
}
<br/>
<br/>
/* Compiled with these flags:
<br/>
$DEVKITARM/bin/arm-eabi-g++ -c -O2 -Wall fn.cpp -o fn.o 
<br/>
*/
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
This is a bit daft - std::find should work with normal C arrays too. Compiling with -O1 "fixes" the problem.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#156314 - silent_code - Thu May 08, 2008 9:06 pm</h4>
    <div class="postbody"><span class="postbody">EDIT: you are right. skip this post then. stl container's .end() points past the last element. that makes the problem even more interesting. ;^p
<br/>
<br/>
sidenote: iirc, the last stable (might only apply to the mingw version) gcc release was 3.4.5. makes perfect sense to me if that is why 4.3 might behave a bit buggy here.
<br/>
<br/>
anyways, good luck!
<br/>
<br/>
<br/>
origianl post:
<br/>
<br/>
end is out of bounds. it should be at vals + COUNT - 1. :^)
<br/>
(take pen and paper and test it yourself.) ;^)
<br/>
<br/>
i don't know why O1 fixes it, though. maybe a different allocation scheme is used or semething. (i don't know much about how the optimization switches work in detail, just how to use them and the general optimizations they do, so the following is totally fictional: imagine instead of allocating the two words you specified, it silently allocates four words to improve memory alignment.)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">mem  val  index
<br/>
---------------
<br/>
0x17 AAAA 0 (start)
<br/>
0x18 BBBB 1
<br/>
0x19 CCCC 2 (end)
<br/>
<br/>
count = 3
<br/>
start = 0x17
<br/>
end = 0x17 + 2
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
@ PeterM: good point, i'll check that.</span><span class="gensmall"><br/><br/>Last edited by silent_code on Thu May 08, 2008 9:30 pm; edited 3 times in total</span></div>    
</div>
<div class="post">
    <h4>#156315 - PeterM - Thu May 08, 2008 9:16 pm</h4>
    <div class="postbody"><span class="postbody">I believe for C++ algorithms, "end" <span style="font-style: italic">should</span> point to one past the last element.<br/>_________________<br/><a href="http://aaiiee.wordpress.com/" target="_blank">http://aaiiee.wordpress.com/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#156316 - Quirky - Thu May 08, 2008 9:20 pm</h4>
    <div class="postbody"><span class="postbody">Yes, the end of an array is one past the last element. Normally you would use vectors or something similar where begin() and end() would hide this implementation detail, but the principal is the same for c-arrays. <a href="http://www.sgi.com/tech/stl/stl_introduction.html" target="_blank">http://www.sgi.com/tech/stl/stl_introduction.html</a>
<br/>
<br/>
Back to the question... -Wno-array-bounds is the way to go for now, as the bounds checking gives false positives, misses cases, etc. Seems the array bounds checking is still a bit buggy in gcc 4.3.
<br/>
<br/>
<a href="http://gcc.gnu.org/bugzilla/show_bug.cgi?id=35587" target="_blank">http://gcc.gnu.org/bugzilla/show_bug.cgi?id=35587</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
