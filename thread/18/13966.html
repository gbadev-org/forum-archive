<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Can't get clear colour to work for some reason. - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Can't get clear colour to work for some reason.</h2>
<div id="posts">
<div class="post">
    <h4>#138153 - Dark Knight ez - Mon Aug 20, 2007 10:37 am</h4>
    <div class="postbody"><span class="postbody">Hey all.
<br/>
<br/>
I've been working a small bit on getting AmplituDS up and running in the latest devkitpro setup and succeeded except for clear colour.
<br/>
For some reason the clear colour shown remains black instead of the white I set it to.
<br/>
I must have forgotten something, somewhere... going through the 3D examples of the current devkitpro setup, I fail to see what it is though, so I was hoping you guys could point me to what I'm missing.
<br/>
<br/>
My 3D initialization code (run only once):
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">    // initializing 3D is part of initializing scene
<br/>
    glInit();
<br/>
    glEnable(GL_ANTIALIAS);
<br/>
    glEnable(GL_TEXTURE_2D);
<br/>
    
<br/>
    glViewPort(0,0,255,191);
<br/>
    
<br/>
    GFX_CLEAR_COLOR = 0; // some flashcards mess up and need this set to 0 before using
<br/>
    
<br/>
    glClearColor(255,255,255, 31);
<br/>
    glClearPolyID(63);
<br/>
    glClearDepth(0x7FFF);
<br/>
    
<br/>
    glMatrixMode(GL_PROJECTION);
<br/>
    glLoadIdentity();
<br/>
    gluPerspective(45.0f, 256.0f / 192.0f, 0.1f, 100.0f);
<br/>
    
<br/>
    // ds specific, several attributes can be set here
<br/>
    glPolyFmt(POLY_ALPHA(31) | POLY_CULL_BACK);
<br/>
    
<br/>
    glPushMatrix();
<br/>
    
<br/>
    glMatrixMode(GL_TEXTURE);
<br/>
    glLoadIdentity();
<br/>
    
<br/>
    // Set the current matrix to be the model matrix
<br/>
    glMatrixMode(GL_MODELVIEW);</td> </tr></table><span class="postbody">
<br/>
<br/>
The above doesn't mention the setting of the video mode and the setting of vram banks to textures, but that's all done too. Everything 3D works for me now, except for the clear colour...
<br/>
<br/>
Thanks in advance for any help.<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><a class="postlink" href="http://amplituds.drunkencoders.com" target="_blank">AmplituDS website</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#138157 - Lick - Mon Aug 20, 2007 11:39 am</h4>
    <div class="postbody"><span class="postbody">Maybe silent_code's tip is of u se here.
<br/>
<br/>
<a href="http://forum.gbadev.org/viewtopic.php?p=121850#121850" target="_blank">http://forum.gbadev.org/viewtopic.php?p=121850#121850</a><br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#138158 - Dark Knight ez - Mon Aug 20, 2007 11:59 am</h4>
    <div class="postbody"><span class="postbody">Using
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">    GFX_CLEAR_COLOR = RGB15(255, 255, 255) | (31 &lt;&lt; 16);</td> </tr></table><span class="postbody">
<br/>
instead of
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">    glClearColor(255,255,255, 31);</td> </tr></table><span class="postbody">
<br/>
didn't work for me.
<br/>
<br/>
I really doubt the alpha value in the glClearColor isn't set in GFX_CLEAR_COLOR, btw. The code in the CVS repository does it as suggested by silent_code, and although that could have changed since release 20, it makes no sense for release 20 to also have the alpha value as argument of glClearColor and not do anything with it.
<br/>
<br/>
Thanks for the suggestion though. I appreciate the effort.<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><a class="postlink" href="http://amplituds.drunkencoders.com" target="_blank">AmplituDS website</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#138160 - silent_code - Mon Aug 20, 2007 12:39 pm</h4>
    <div class="postbody"><span class="postbody">well, i had the problem, too (with aa), but after examining libnds, that was the solution i came up with. ;)
<br/>
<br/>
EDIT: try setting the clear poly id to 0.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">GFX_CLEAR_COLOR = RGB15(31, 31, 31) | (31 &lt;&lt; 16) | (0 &lt;&lt; 24);</td> </tr></table><span class="postbody">
<br/>
ps: why would you use 255 in RGB15? isn't that supposed to work with 5 bit values between 0 and 31? always worked that way for me, though... &lt;confused&gt;
<br/>
<br/>
from libnds:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">// macro creates a 15 bit color from 3x5 bit components
<br/>
#define RGB15(r,g,b)  ((r)|((g)&lt;&lt;5)|((b)&lt;&lt;10))</td> </tr></table><span class="postbody"></span><span class="gensmall"><br/><br/>Last edited by silent_code on Mon Aug 20, 2007 1:45 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#138161 - Dark Knight ez - Mon Aug 20, 2007 1:27 pm</h4>
    <div class="postbody"><span class="postbody">Err... yes, you're absolutely right... should be 31.
<br/>
I gave that (and setting polyId to 0) a try, but still no luck.
<br/>
(The former mentioned makes sense, as it has all the bits set anyway, so it ends up as the same value as the flawed use of 255, really.)
<br/>
<br/>
I checked out your shadow pencil demo code, but... don't see anything that catches my attention.<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><a class="postlink" href="http://amplituds.drunkencoders.com" target="_blank">AmplituDS website</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#138162 - silent_code - Mon Aug 20, 2007 1:41 pm</h4>
    <div class="postbody"><span class="postbody">i guessed that. well, i really don't see anything else that could be wrong with this code. maybe you're resetting it somewhere else? dunno. sounds strange.
<br/>
does the "shadow pencil" (&lt;giggle&gt;, should be stencil shadow ;D ) demo compile and work (e.g. in no$)? there should be a colored background (0, 25, 25), if you walk through a wall.
<br/>
<br/>
well, good luck!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#138169 - Dark Knight ez - Mon Aug 20, 2007 3:42 pm</h4>
    <div class="postbody"><span class="postbody">I got stencil shadow (my eyes are failing me, I swear! xD) to compile... had like two outdated mentions: glIdentity() -&gt; glLoadIdentity() and REG_EXEMEMCNT -&gt; REG_EXMEMCNT.
<br/>
When I tried it out on my hardware setup it didn't work at all for me though. Nada.
<br/>
I'm tempted to just make a big white square in the back of the 3D scene instead of using the nice glClearColor. If I haven't fixed this in a couple of days, I probably will.
<br/>
Anyway, a big thanks for the suggestions, silent_code. Was nice of you.<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><a class="postlink" href="http://amplituds.drunkencoders.com" target="_blank">AmplituDS website</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#138225 - Dark Knight ez - Tue Aug 21, 2007 11:49 am</h4>
    <div class="postbody"><span class="postbody">Sooooo.... the reason... quite embarassing...
<br/>
I didn't do a glFlush right after setting all that stuff. At least one was needed for the screen to turn white of course.
<br/>
*quickly runs away*<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><a class="postlink" href="http://amplituds.drunkencoders.com" target="_blank">AmplituDS website</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#138320 - silent_code - Wed Aug 22, 2007 11:03 pm</h4>
    <div class="postbody"><span class="postbody">nice to see you finally got it! :)
<br/>
<br/>
so, you couldn't run stencils... you're sure using a slot1 device. the demo won't run due to gbfs (afaik). but no$ should run it. well, with some weird graphics and stencil shadows without the stencil... means simple blending. 
<br/>
<br/>
man, it's really been a while since the last time i ran that demo. couldn't get libfat or anything simmilar to work, so i froze any further development. plus my laptop is being repaired... &lt;sigh&gt;</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
