<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>extended backgrounds - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > extended backgrounds</h2>
<div id="posts">
<div class="post">
    <h4>#130092 - AdolescentFred - Wed May 30, 2007 9:57 pm</h4>
    <div class="postbody"><span class="postbody">I'm new to DS programming and I'm having trouble using extended backgrounds. I can't see the problem with the code, especially because most of it is copied from examples.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int main(){
<br/>
  videoSetMode(MODE_5_2D | DISPLAY_BG2_ACTIVE);
<br/>
  vramSetBankA(VRAM_A_MAIN_BG_0x06000000);
<br/>
  BG2_CR = BG_BMP16_256x256 | BG_BMP_BASE(0) | BG_PRIORITY(3);
<br/>
  BG2_XDX = 1 &lt;&lt; 8;
<br/>
  BG2_XDY = 0;
<br/>
  BG2_YDY = 1 &lt;&lt; 8;
<br/>
  BG2_YDX = 0;
<br/>
  BG2_CY = 0;
<br/>
  BG2_CX = 0;
<br/>
  u16 *BG_BUFFER = (u16*)BG_BMP_RAM(0);
<br/>
  int x,y;
<br/>
  for(y=0;y&lt;192;y++){
<br/>
    for(x=0;x&lt;256;x++){
<br/>
      BG_BUFFER[y*256 + x] = page_bin[y*256 + x];
<br/>
    }
<br/>
  }
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
I have a feeling the problem lies in the copying of the pixmap into VRAM, because I wasn't really sure what to use to copy it. dmaCopy() didn't work either. I just get a black top screen and a white bottom one.
<br/>
thanks for any help anyone can give.
<br/>
~Fred</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130098 - GPFerror - Wed May 30, 2007 11:26 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>AdolescentFred wrote:</b></span></td> </tr> <tr> <td class="quote">I'm new to DS programming and I'm having trouble using extended backgrounds. I can't see the problem with the code, especially because most of it is copied from examples.
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int main(){
<br/>
  videoSetMode(MODE_5_2D | DISPLAY_BG2_ACTIVE);
<br/>
  vramSetBankA(VRAM_A_MAIN_BG_0x06000000);
<br/>
  BG2_CR = BG_BMP16_256x256 | BG_BMP_BASE(0) | BG_PRIORITY(3);
<br/>
  BG2_XDX = 1 &lt;&lt; 8;
<br/>
  BG2_XDY = 0;
<br/>
  BG2_YDY = 1 &lt;&lt; 8;
<br/>
  BG2_YDX = 0;
<br/>
  BG2_CY = 0;
<br/>
  BG2_CX = 0;
<br/>
  u16 *BG_BUFFER = (u16*)BG_BMP_RAM(0);
<br/>
  int x,y;
<br/>
  for(y=0;y&lt;192;y++){
<br/>
    for(x=0;x&lt;256;x++){
<br/>
      BG_BUFFER[y*256 + x] = page_bin[y*256 + x];
<br/>
    }
<br/>
  }
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
I have a feeling the problem lies in the copying of the pixmap into VRAM, because I wasn't really sure what to use to copy it. dmaCopy() didn't work either. I just get a black top screen and a white bottom one.
<br/>
thanks for any help anyone can give.
<br/>
~Fred</span></td> </tr></table><span class="postbody">
<br/>
<br/>
change to this
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">BG_BUFFER[y*256 + x] = page_bin[y*256 + x] | BIT(15);</td> </tr></table><span class="postbody">
<br/>
<br/>
Have to set this bit in 16bit mode.
<br/>
<br/>
Troy(GPF)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130157 - AdolescentFred - Thu May 31, 2007 10:53 am</h4>
    <div class="postbody"><span class="postbody">thanks it's displaying now but not correctly. I knew that I had to set the alpha bit, but i thought that it was done already because I used
<br/>
"bmp2bin -d" 
<br/>
to generate the bin file and option d says:
<br/>
"16 bits output, x1b5g5r5, DS, x bit set"
<br/>
<br/>
The colours are all wrong and there are horizontal and vertical lines and I don't know what the problem is.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130162 - mml - Thu May 31, 2007 11:25 am</h4>
    <div class="postbody"><span class="postbody">Try making a test-pattern image (ie, an image with some repeating pattern) and use that, then run it in emulation and use the magnifying glass app to zoom in and look at how its distorted.  Since you know from the pattern where the pixels are supposed to be, you can work out where they're being relocated to, which might provide you some hint as to what's going wrong.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130163 - AdolescentFred - Thu May 31, 2007 11:53 am</h4>
    <div class="postbody"><span class="postbody">I've never managed to get an emulator to run under linux, but i tried a pattern on the hardware and i've solved the problem.
<br/>
<br/>
page_bin is from page_bin.h which was generated by the Makefile (I used the defualt one) and it was defined as u8 where it should be u16. It was displaying wrong because it was doing 8bit reads and 16bit writes. I changed it to u16 and it displays perfectly now.
<br/>
Thanks for your help GPFerror and mml</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130168 - mml - Thu May 31, 2007 12:40 pm</h4>
    <div class="postbody"><span class="postbody">Are you using git/grit to convert your image data to .s/.h files?  It has an option for specifying the output data type.  It defaults to u32 according to grit --help, so if you are using git/grit, it could be your foo.git is overriding that to output u8's instead.  The "correct" fix would then be to change this to output u16's, so if you modify the source image later you don't have to hack the .h by hand again.
<br/>
<br/>
You might not be using it though -- I don't remember what the default Makefile used for converting graphics, but I do remember needing to change it in a few places to get it working for me (and get an endianness fix for git from Cearn, since I'm dev'ing on PPC hardware) -- but maybe that's just because I was a noob and doing something wrong.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130169 - Dark Knight ez - Thu May 31, 2007 12:51 pm</h4>
    <div class="postbody"><span class="postbody">What's all the fuss about? There's no need to "hack" .h files by hand or whatever.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">((uint16*)page_bin)[y*256 + x]; </td> </tr></table><span class="postbody">
<br/>
<br/>
Voila. No hacking .h files. No worrying about whether they are u8s, u32s, whatever.<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><a class="postlink" href="http://amplituds.drunkencoders.com" target="_blank">AmplituDS website</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130180 - AdolescentFred - Thu May 31, 2007 3:45 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dark Knight ez wrote:</b></span></td> </tr> <tr> <td class="quote">What's all the fuss about? There's no need to "hack" .h files by hand or whatever.
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">((uint16*)page_bin)[y*256 + x]; </td> </tr></table><span class="postbody">
<br/>
<br/>
Voila. No hacking .h files. No worrying about whether they are u8s, u32s, whatever.</span></td> </tr></table><span class="postbody">
<br/>
Thats exactly what i've done
<br/>
<br/>
@mml: i've used gfx2gba for converting tile gfx to .bin, and for this I used bmp2bin, both of which come with devkitarm. The makefile builds them in using some bin2s magic or something, and generated the headers in the build dir.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
