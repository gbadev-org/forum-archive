<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Ok... WHAT am I doing wrong? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > Ok... WHAT am I doing wrong?</h2>
<div id="posts">
<div class="post">
    <h4>#119615 - Lupi - Sat Feb 24, 2007 8:16 pm</h4>
    <div class="postbody"><span class="postbody">My situation:
<br/>
I'm doing a text engine for my adventure game. I know I could make it with console.h functions, but I need more flexibility to work with the text.
<br/>
<br/>
I have taken the font from the libnds examples, the one in Graphics/2D/custom_font
<br/>
I realized I had to transform the caracters into 16 bits words. My pallette number is also the first one (0) and I don't need to flip the tiles. So I get in bits:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">0 0 0 0       0        0         0 0 A B C D E F G H
<br/>
Pal         Horiz.   Verti.       Tile index
<br/>
               Flip      Flip</td> </tr></table><span class="postbody">
<br/>
<br/>
Where ABCDEFGH is the code of the ASCII character.
<br/>
<br/>
Because of the problems I was having, I decided to do a SIMPLE example:
<br/>
Load 6 characters in a line. The character is '!', this is 0000 0001 in my tiles...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">u16 Admiraciones [6]= {0x01,0x01,0x01,0x01,0x01,0x01};
<br/>
<br/>
dmaCopy((void *)Admiraciones, (u16 *)BG_MAP_RAM(16), 6*2);</td> </tr></table><span class="postbody">
<br/>
<br/>
This does work on emulators, but doesn't work on hardware
<br/>
<br/>
I have been a few days working an engine adapted for my game, it <span style="font-weight: bold">ALWAYS</span> worked on any emulator, but today I decided to go and try on real Hardware, but strange symbols appeared. Every time I started the game, different symbols, some of them were correct, but most of them were not.
<br/>
My question is, WHAT am I doing wrong?
<br/>
<br/>
Thanks in advance
<br/>
<br/>
EDIT
<br/>
A copy of my .nds file:
<br/>
<a href="http://www.megaupload.com/es/?d=BI6KG4W5" target="_blank">http://www.megaupload.com/es/?d=BI6KG4W5</a>
<br/>
<br/>
Now try on a emulator...
<br/>
then try in DS hardware...
<br/>
??</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119634 - Nelzon - Sat Feb 24, 2007 11:08 pm</h4>
    <div class="postbody"><span class="postbody">I'm not sure if that's the problem, but have you flushed the memory before the DMA copy call?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119636 - Lupi - Sat Feb 24, 2007 11:22 pm</h4>
    <div class="postbody"><span class="postbody">Well, every time I load a new background with text I load 0 in the places where there is no text, to hide old letters.
<br/>
<br/>
If that's not flushing memory then I have no idea what is it :S
<br/>
What is it for? How can I do it?
<br/>
<br/>
PD: Excuse my ignorance, my english vocabulary is a bit poor ^_^;;</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119637 - Dark Knight ez - Sat Feb 24, 2007 11:25 pm</h4>
    <div class="postbody"><span class="postbody">Try memcpy. Dmacopy is not the safest of ways.<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><a class="postlink" href="http://amplituds.drunkencoders.com" target="_blank">AmplituDS website</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119639 - Nelzon - Sat Feb 24, 2007 11:43 pm</h4>
    <div class="postbody"><span class="postbody">The RAM of the DS is mirrored, the first part is cached, the other is not. When you e.g. want to share parts of the cached memory between ARM9 and ARM7 you must flush the cache to make sure both processors read the same memory contents. You can do that by simply call DC_FlushAll();
<br/>
I think the problems you may have with DMACopy are related to this matter.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119640 - Lupi - Sat Feb 24, 2007 11:50 pm</h4>
    <div class="postbody"><span class="postbody">Thanks :D
<br/>
It works now :)
<br/>
<br/>
But why does this happen? Doesn't memcpy  do the same that dmacopy?
<br/>
<br/>
Lupi
<br/>
<br/>
Edit: Sorry Nelzon, I couldn't read your post when I was posting, but thanks :-)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119641 - Dark Knight ez - Sun Feb 25, 2007 12:01 am</h4>
    <div class="postbody"><span class="postbody">Sort of, but in a different way.
<br/>
I found dmaCopy to be unreliable, but maybe Delzon's suggestion -- DC_FlushAll(); -- would've fixed the severe problems I experienced with it. I don't know.
<br/>
memcpy has always treated me nice though, so I stick with that.<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><a class="postlink" href="http://amplituds.drunkencoders.com" target="_blank">AmplituDS website</a></span></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
