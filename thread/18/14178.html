<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Flooding the Wi-Fi channel? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Flooding the Wi-Fi channel?</h2>
<div id="posts">
<div class="post">
    <h4>#140666 - Jesse - Wed Sep 19, 2007 12:00 am</h4>
    <div class="postbody"><span class="postbody">When sending a larger amount of data over Wi-Fi to a server ::send seems to cause flooding of the radio channel. This disrupts the Wi-Fi for all my equipment as well. I'm just using normal ::send and I've tried both blocking and non-blocking mode. If I make sure not to go over the "speedlimit" by waiting a few VBlank for each kB I send everything is well, but as soon as I send too much everything seems to be clogged up and while it continues to send, it's going very slow.</span><span class="gensmall"><br/><br/>Last edited by Jesse on Wed Sep 19, 2007 7:55 pm; edited 2 times in total</span></div>    
</div>
<div class="post">
    <h4>#140707 - jetboy - Wed Sep 19, 2007 11:09 am</h4>
    <div class="postbody"><span class="postbody">And LAN after the wifi router gets flooded too.
<br/>
I killed the net in my company by trying to send some data with Jesse's softweare.
<br/>
The line is afaik 8Megabits up/down @_@.
<br/>
All people in the building lost conectivity when i was sending anything.<br/>_________________<br/>Colors! gallery -&gt; <a href="http://colors.collectingsmiles.com" target="_blank">http://colors.collectingsmiles.com</a>
<br/>
Any questions? Try <a href="http://colors.collectingsmiles.com/faq.php" target="_blank">http://colors.collectingsmiles.com/faq.php</a> first, or official forums <a href="http://forum.brombra.net" target="_blank">http://forum.brombra.net</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#140714 - Jesse - Wed Sep 19, 2007 1:46 pm</h4>
    <div class="postbody"><span class="postbody">I found the problem for this. My Arm9/Arm7 communication was all messed up. It's wonder it worked in the first place.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#140715 - pas - Wed Sep 19, 2007 1:47 pm</h4>
    <div class="postbody"><span class="postbody">What prog are you talking about ? *wants do a lil flooding * ^^</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#140717 - Jesse - Wed Sep 19, 2007 1:54 pm</h4>
    <div class="postbody"><span class="postbody">It's easy. Just write a wifi-app and mess up your code "just enough". :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#140720 - Lynx - Wed Sep 19, 2007 2:24 pm</h4>
    <div class="postbody"><span class="postbody">Yeah.. even I can do that!
<br/>
<br/>
Or do you have to be able to write good code for it to be messed up?<br/>_________________<br/><a class="postlink" href="http://www.ndshb.com" target="_blank">NDS Homebrew Roms &amp; Reviews</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#140782 - Jesse - Wed Sep 19, 2007 7:55 pm</h4>
    <div class="postbody"><span class="postbody">I was a bit premature in declaring this solved. I just released a new version of Colors!, and a lot of people seem to have this problem. I though I had fixed it, since it dissapeared for me after fixing my arm7-arm9 communication and updating to the CVS version of dswifi (which also made my DS Lite behave much better). Apparently it wasn't fixed all the way. Anyone who has noticed this behaviour?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141339 - jetboy - Mon Sep 24, 2007 7:45 am</h4>
    <div class="postbody"><span class="postbody">Still anyone dont have a slightest idea what might be causing this?
<br/>
Tepples? You usually have solutions for everything... I count on you :)<br/>_________________<br/>Colors! gallery -&gt; <a href="http://colors.collectingsmiles.com" target="_blank">http://colors.collectingsmiles.com</a>
<br/>
Any questions? Try <a href="http://colors.collectingsmiles.com/faq.php" target="_blank">http://colors.collectingsmiles.com/faq.php</a> first, or official forums <a href="http://forum.brombra.net" target="_blank">http://forum.brombra.net</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141837 - Jesse - Sun Sep 30, 2007 6:25 pm</h4>
    <div class="postbody"><span class="postbody">I'm still stuck at this. melw was gracious enough to help me out, and we managed to narrowed down the problem a bit. To exclude mistakes from my side regarding Wi-Fi-setup and Arm7/Arm9 communication, I hijacked a test-function in <a class="postlink" href="http://www.devkitpro.org/files/wifi_lib_test.zip" target="_blank">wifi_lib_test</a>. That didn't make any difference. As soon as I send too much data at the same time, the network chokes. It's a bit random and appears around 50% here, but I think it was more consistent for melw.
<br/>
<br/>
Here is the code from my modified wifi_lib_test:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void Do_Play_TCPConnect() {
<br/>
   struct hostent *pHostInfo = gethostbyname("80.244.71.104");
<br/>
<br/>
   int Socket = socket(AF_INET, SOCK_STREAM, 0);
<br/>
   if(Socket &lt; 0)
<br/>
      Error("Could not create socket");
<br/>
<br/>
   struct sockaddr_in ServerAddress;
<br/>
   ServerAddress.sin_family = pHostInfo-&gt;h_addrtype;
<br/>
   memcpy((char *)&amp;ServerAddress.sin_addr.s_addr, pHostInfo-&gt;h_addr_list[0], pHostInfo-&gt;h_length);
<br/>
   ServerAddress.sin_port = htons(27691);
<br/>
   if(connect(Socket, (struct sockaddr *) &amp;ServerAddress, sizeof(ServerAddress)) &lt; 0)
<br/>
      Error("Failed to connect");
<br/>
<br/>
   int Size = 32 * 1024;
<br/>
   char *pBuf = malloc(Size);
<br/>
   memset(pBuf, 0, Size);
<br/>
<br/>
   const int PacketSize = 4096;
<br/>
   int BytesLeft = Size;
<br/>
   while(BytesLeft &gt; 0)
<br/>
   {
<br/>
      int Len = BytesLeft;
<br/>
      if(Len &gt; PacketSize)
<br/>
         Len = PacketSize;
<br/>
      int Res = send(Socket, pBuf + Size - BytesLeft, Len, 0);
<br/>
      if(Res &gt; 0)
<br/>
      {
<br/>
         BytesLeft -= Res;
<br/>
         char buf[256];
<br/>
         sprintf(buf, "Sent %i bytes", Res);
<br/>
         printtop(buf);
<br/>
      }
<br/>
   }
<br/>
<br/>
   free(pBuf);
<br/>
   printtop("Done");
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
I can get around the problem by waiting a few vBlanks for each ::send, but how many that is needed seems to differ from DS to DS (probably connection to connection) and of course slows things down considerably. I also tried using ::select to make sure only to call ::send when the buffer was ready, but ::select doesn't seem to be implemented yet.
<br/>
<br/>
Is there something wrong with my code? Does anyone have any ideas of what I could try?<br/>_________________<br/><a href="http://www.collectingsmiles.com/colors" target="_blank">http://www.collectingsmiles.com/colors</a> &amp; <a href="http://www.collectingsmiles.com/hyena" target="_blank">http://www.collectingsmiles.com/hyena</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141845 - jetboy - Sun Sep 30, 2007 8:49 pm</h4>
    <div class="postbody"><span class="postbody">Just guessing.
<br/>
<br/>
Isnt it like that you try to send and never check if the data was already sent, then try to send another packet again? I dont know the inner working of the lib, but it could mean that the packet is never completely sent, or the checksums dont match or possibly any other unfriendly scenario...<br/>_________________<br/>Colors! gallery -&gt; <a href="http://colors.collectingsmiles.com" target="_blank">http://colors.collectingsmiles.com</a>
<br/>
Any questions? Try <a href="http://colors.collectingsmiles.com/faq.php" target="_blank">http://colors.collectingsmiles.com/faq.php</a> first, or official forums <a href="http://forum.brombra.net" target="_blank">http://forum.brombra.net</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141846 - Jesse - Sun Sep 30, 2007 8:50 pm</h4>
    <div class="postbody"><span class="postbody">In an bold move I managed to track down the man responsible, Sgstair. Sadly, we didn't really get any new info. It seems to be a problem with dswifi and it wasn't really possible to check if there is outgoing data in the buffer with the current lib. I did get a suggestion to manually send a snippet of data back from the server on regular intervals, which would allow me to make sure I don't send too much data to clog things up.<br/>_________________<br/><a href="http://www.collectingsmiles.com/colors" target="_blank">http://www.collectingsmiles.com/colors</a> &amp; <a href="http://www.collectingsmiles.com/hyena" target="_blank">http://www.collectingsmiles.com/hyena</a></span><span class="gensmall"><br/><br/>Last edited by Jesse on Sun Sep 30, 2007 8:55 pm; edited 3 times in total</span></div>    
</div>
<div class="post">
    <h4>#141848 - Jesse - Sun Sep 30, 2007 8:53 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>jetboy wrote:</b></span></td> </tr> <tr> <td class="quote">Isnt it like that you try to send and never check if the data was already sent, then try to send another packet again?</td> </tr></table><span class="postbody">
<br/>
Yes, and that is supposed to work using TCP. :)
<br/>
But that is probably related to the problem and it's just too bad there is no way to know if the data was properly sent.<br/>_________________<br/><a href="http://www.collectingsmiles.com/colors" target="_blank">http://www.collectingsmiles.com/colors</a> &amp; <a href="http://www.collectingsmiles.com/hyena" target="_blank">http://www.collectingsmiles.com/hyena</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141910 - HyperHacker - Mon Oct 01, 2007 2:41 pm</h4>
    <div class="postbody"><span class="postbody">The impression I got from his post was that you're trying to send one packet before the hardware has finished sending the previous one, confusing it and/or garbling the packets. Is that possible?<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141915 - Jesse - Mon Oct 01, 2007 5:06 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">The impression I got from his post was that you're trying to send one packet before the hardware has finished sending the previous one, confusing it and/or garbling the packets. Is that possible?</td> </tr></table><span class="postbody">
<br/>
Ah. No, that's not really the case. Since I only use the high-level functions, I shouldn't have to worry about sending too much data. Depending on if I've set the socket to blocking or non-blocking, ::send will either wait until there is room in the outgoing buffers, or return with an error if there is no room. Also, since I have no way of checking the buffers manually, I couldn't do it any other way.<br/>_________________<br/><a href="http://www.collectingsmiles.com/colors" target="_blank">http://www.collectingsmiles.com/colors</a> &amp; <a href="http://www.collectingsmiles.com/hyena" target="_blank">http://www.collectingsmiles.com/hyena</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
