<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Load sound banks/songs/samples..? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Load sound banks/songs/samples..?</h2>
<div id="posts">
<div class="post">
    <h4>#173934 - Ruben - Sun May 09, 2010 6:32 am</h4>
    <div class="postbody"><span class="postbody">Hi.
<br/>
<br/>
So I'm in the final stages of my Midi player [and yes, it WILL be adapted to libnds before that =P]... and just one thing remains unsettled: dynamic loading.
<br/>
<br/>
From what I've seen, official games load songs from their filesystem, followed by loading banks [instruments] and samples. While overall it seems easy... what exactly should be done? I mean... the main issues are keeping track of what has been malloc'd so that it may be free'd after. I have been able to load from a sound database file quite successfully, but only with this problem. I can't think of any proper way to keep track of what to free after it's all loaded.
<br/>
<br/>
Any ideas?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#173938 - headspin - Sun May 09, 2010 11:44 am</h4>
    <div class="postbody"><span class="postbody">Um, free everything you malloc'ed. Why wouldn't you know what has been malloc'ed?
<br/>
<br/>
You can always have data buffers initialized to NULL and check it later.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">char* buffer = NULL;
<br/>
<br/>
buffer = (char*) malloc(..);
<br/>
<br/>
if(buffer != NULL)
<br/>
{
<br/>
    free(buffer);
<br/>
    buffer = NULL;
<br/>
}</td> </tr></table><span class="postbody"><br/>_________________<br/><a class="postlink" href="http://headsoft.com.au/index.php?category=warhawk" target="_blank">Warhawk DS</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=mmll" target="_blank">Manic Miner: The Lost Levels</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=tdg" target="_blank">The Detective Game</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#173941 - Ruben - Sun May 09, 2010 12:19 pm</h4>
    <div class="postbody"><span class="postbody">Because this is what is done [in ASM to make matters worse xP]:
<br/>
<br/>
-sxdsLoadSong which will load song data into memory with malloc [poitner returned to caller]
<br/>
-this calls sxdsLoadBank, which will load a bank into memory with malloc, and will call sxdsLoadSamp
<br/>
-this will load samples into memory with malloc
<br/>
<br/>
... See what I mean? xP
<br/>
<br/>
EDIT:
<br/>
Probably doesn't help that I allow up to 8 songs playing at once, with up to 8 different banks and 256 different samples in memory at once &gt;_&gt;'</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#174067 - dheart88 - Sun May 16, 2010 10:55 pm</h4>
    <div class="postbody"><span class="postbody">is it fit in DS 4 MB ram?? why it has to be MIDI if mod is better? MOD has it's own sample and MIDI still depend on the hardware sample.. So you really put all the sample so this midi can work?? 
<br/>
<br/>
Suggestion:
<br/>
how about this, first before generate the output, your program will only select resources/samples needed before it's loaded to RAM, so it'll be only 16 samples (if I'm not mistaken, midi can only have 16 channels right?? I still remember my old days with yamaha PSR series) so it won't ended with 256 samples... (or maybe because there are 16sample each song * 8 song =256??)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#174077 - Ruben - Mon May 17, 2010 5:10 am</h4>
    <div class="postbody"><span class="postbody">It doesn't exactly work that way, because Midi 'patches' or 'programs' depend on more than one sample most of the time. But it doesn't matter anymore, cos I already sorted this: I do the exact opposite of the loading routines, going through all tones and instead of loading, freeing.
<br/>
<br/>
Now, if only porting to libnds was easier... &gt;_&lt;'</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
