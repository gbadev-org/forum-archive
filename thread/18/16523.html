<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>[SOLVED] Dynamic texture creation, formats and palette - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > [SOLVED] Dynamic texture creation, formats and palette</h2>
<div id="posts">
<div class="post">
    <h4>#167295 - kiniou - Sun Mar 08, 2009 12:56 pm</h4>
    <div class="postbody"><span class="postbody">Hello,
<br/>
<br/>
I'm trying to create a dynamic texture with glTexImage2D to apply a sort of animation on a 3D model. I manage to create one in GL_RGB format with function RGB15(). Here is my code:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
    int size_max = 128;
<br/>
    int col = 16;
<br/>
    int size = 0;
<br/>
    u8  c = 0;
<br/>
   
<br/>
    while(size&lt;size_max) {
<br/>
<br/>
      //c is the colour components between 0 and 32
<br/>
      //this is a 16 columns and 8 lines texture
<br/>
      //so the final result is a greyscale texture starting left from black to white
<br/>
                c = (u8)( (size%col) / (float)col * 32.0 );
<br/>
                this-&gt;dynamic_texture[size] = RGB15(c,c,c);
<br/>
                size++;
<br/>
    }
<br/>
   
<br/>
    glGenTextures(1, &amp;this-&gt;textureID[2]);
<br/>
    glBindTexture(0, this-&gt;textureID[2]);
<br/>
    glTexImage2D(0, 0, GL_RGB, TEXTURE_SIZE_16 , TEXTURE_SIZE_8, 0, TEXGEN_TEXCOORD , (uint8 *) this-&gt;dynamic_texture);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Then I write some crappy code to shift this greyscale texture and create new ones to have an animated texture. 
<br/>
I've made a test with 16 textures and it works but it takes a lot of texture memory and it's not efficient.
<br/>
<br/>
Now I'm looking to change this crappy code to use 16 palettes instead of 16 textures.
<br/>
I tried to use GL_RGB16 thinking of each texel was a number between 0 and 15 but it doesn't seems to work and can't find how it must be formatted.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
int size_max = 128;
<br/>
    int col = 16;
<br/>
    int size = 0;
<br/>
    uint8  c = 0;
<br/>
    
<br/>
    while(size&lt;size_max) {
<br/>
<br/>
        //c is the colour components between 0 and 16
<br/>
        //this is a 16 columns and 8 lines texture
<br/>
        //so the final result is a greyscale texture starting left from black to white
<br/>
        c = (u8)( (size%col) );
<br/>
        this-&gt;dynamic_texture[size] = c;
<br/>
        size++;
<br/>
    }
<br/>
    
<br/>
    glGenTextures(1, &amp;this-&gt;textureID[2]);
<br/>
    glBindTexture(0, this-&gt;textureID[2]);
<br/>
    glTexImage2D(0, 0, GL_RGB16, TEXTURE_SIZE_16 , TEXTURE_SIZE_8, 0, TEXGEN_TEXCOORD , (uint8 *) this-&gt;dynamic_texture);
<br/>
    
<br/>
<br/>
    for(uint16 i=0;i&lt;16;i++) {
<br/>
        this-&gt;dynamic_palette[i]=RGB15(i*2,i*2,i*2);
<br/>
    }
<br/>
    
<br/>
    this-&gt;pal_addr = gluTexLoadPal((const u16 *) &amp;this-&gt;dynamic_palette,16,GL_RGB16);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
You can download the packed files for this test <a class="postlink" href="http://dev.knokorpo.fr/projects/list_files/glideout" target="_blank"> Here </a>.
<br/>
<br/>
Thanks for any help or explanations.<br/>_________________<br/>It's time to code...</span><span class="gensmall"><br/><br/>Last edited by kiniou on Mon Mar 23, 2009 5:04 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#167298 - Kath - Sun Mar 08, 2009 3:05 pm</h4>
    <div class="postbody"><span class="postbody">The texture formats with palettes are usually packed, for example:
<br/>
<br/>
Format 3: 16-Color Palette Texture
<br/>
Each Texel occupies 4bit, the 1st Texel is located in LSBs of 1st byte.
<br/>
<br/>
You can read about the texture formats <a class="postlink" href="http://nocash.emubase.de/gbatek.htm#ds3dtextureformats" target="_blank">here</a>.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167717 - kiniou - Mon Mar 23, 2009 5:03 pm</h4>
    <div class="postbody"><span class="postbody">Thanks Kath for your reply.
<br/>
<br/>
I've already read that part but I didn't understood the packed formats and after reading it again it became clearer.
<br/>
<br/>
Now my problem is solved, I post the code in case someone wants to reuse it:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
    int size_max = 128; // 16 columns * 8 lines = 128 pixels
<br/>
    int col = 16;
<br/>
    uint8  c1 = 0;
<br/>
    uint8  c2 = 0;
<br/>
    u8 c = 0;
<br/>
<br/>
    for(int i=(size_max/2 -1);i&gt;=0;i--) {
<br/>
<br/>
        //c1 and c2 are the color components between 0 and 16
<br/>
        //packed into a uint8
<br/>
<br/>
            c  = (u8)( (i*2) % col );
<br/>
            c1 = c ;
<br/>
<br/>
<br/>
            c  = (u8)( (i*2 + 1) % col );
<br/>
            c2 = c &lt;&lt; 4 ;
<br/>
<br/>
            this-&gt;dynamic_texture[i] =( c1 | c2 ) ;
<br/>
    }
<br/>
<br/>
    glGenTextures(1, &amp;this-&gt;textureID[2]);
<br/>
    glBindTexture(0, this-&gt;textureID[2]);
<br/>
    glTexImage2D(0, 0, GL_RGB16, TEXTURE_SIZE_16 , TEXTURE_SIZE_8, 0, TEXGEN_TEXCOORD , this-&gt;dynamic_texture);
<br/>
<br/>
<br/>
    //creation of 16 palettes RGB16
<br/>
    uint16 k = 0;
<br/>
    for (uint16 j=0;j&lt;16;j++) {
<br/>
        for(uint16 i=0;i&lt;16;i++) {
<br/>
            k = (16 - (i+j)%16) * 2;
<br/>
            this-&gt;dynamic_palette[i]=RGB15(k,k,k);
<br/>
        }
<br/>
<br/>
        this-&gt;pal_addr[j] = gluTexLoadPal((const u16 *) &amp;this-&gt;dynamic_palette,16,GL_RGB16);
<br/>
    }</td> </tr></table><span class="postbody"><br/>_________________<br/>It's time to code...</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
