<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Wierd texture bug - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Wierd texture bug</h2>
<div id="posts">
<div class="post">
    <h4>#104428 - Dan Forever - Fri Sep 29, 2006 1:07 am</h4>
    <div class="postbody"><span class="postbody">Finally figured out today that the devkitpro supplied makefiles automatically convert .pcx files to textures! Got it all running up and fine in Dualis, but when I actually load [the .ds.gba or] the nds file on the ds hardware itself, all I get is a blank white quad (which is the colour it's set to).
<br/>
<br/>
It's based on the nehe 6 tutorial code:
<br/>
Any suggestions as to why this might happen would be most appreciated :)
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">// include your ndslib
<br/>
#include &lt;nds.h&gt;
<br/>
#include &lt;stdio.h&gt;
<br/>
<br/>
#include "blue_large_pcx.h"
<br/>
//#include "drunkenlogo_pcx.h"
<br/>
<br/>
void DrawDude(void);
<br/>
void ProcessInput(void);
<br/>
<br/>
float x, y;
<br/>
<br/>
int   texture[1];
<br/>
<br/>
int LoadGLTextures()                           // Load PCX files And Convert To Textures
<br/>
{
<br/>
   sImage pcx;                //////////////(NEW) and different from nehe.
<br/>
<br/>
   //load our texture
<br/>
   loadPCX((u8*)blue_large_pcx, &amp;pcx);
<br/>
//   loadPCX((u8*)drunkenlogo_pcx, &amp;pcx);
<br/>
   
<br/>
   image8to16(&amp;pcx);
<br/>
<br/>
   glGenTextures(1, &amp;texture[0]);
<br/>
   glBindTexture(0, texture[0]);
<br/>
   glTexImage2D(0, 0, GL_RGB, TEXTURE_SIZE_128 , TEXTURE_SIZE_128, 0, TEXGEN_TEXCOORD, pcx.data8);
<br/>
//   glTexImage2D(0, 0, GL_RGB, TEXTURE_SIZE_64 , TEXTURE_SIZE_64, 0, TEXGEN_TEXCOORD, pcx.data8);
<br/>
<br/>
   imageDestroy(&amp;pcx);
<br/>
<br/>
   return TRUE;
<br/>
}
<br/>
<br/>
int main()
<br/>
{   
<br/>
   // Turn on everything
<br/>
   powerON(POWER_ALL);
<br/>
   
<br/>
   // Setup the Main screen for 3D 
<br/>
   videoSetMode(MODE_0_3D);
<br/>
   vramSetBankA(VRAM_A_TEXTURE);                        //NEW  must set up some memory for textures
<br/>
   
<br/>
   // IRQ basic setup
<br/>
   irqInit();
<br/>
   irqSet(IRQ_VBLANK, 0);
<br/>
<br/>
   // Set our viewport to be the same size as the screen
<br/>
   glViewPort(0,0,255,191);
<br/>
   
<br/>
   // Specify the Clear Color and Depth 
<br/>
   glClearColor(0,0,0);
<br/>
   glClearDepth(0x7FFF);
<br/>
<br/>
   LoadGLTextures();
<br/>
   
<br/>
   consoleDemoInit();
<br/>
   printf("Lets do something fun...\n");
<br/>
<br/>
   //lcdMainOnTop();
<br/>
   lcdMainOnBottom();
<br/>
<br/>
   x = 0.0f;
<br/>
   y = 0.0f;
<br/>
<br/>
   while(true) 
<br/>
   {
<br/>
      ProcessInput();
<br/>
<br/>
      // Reset the screen and setup the view
<br/>
      glReset();
<br/>
      gluPerspective(35, 256.0 / 192.0, 0.1, 100);
<br/>
      glColor3f(0, 1, 0);                           // Set the color..not in nehe source...ds gl default will be black
<br/>
<br/>
      //ds specific, several attributes can be set here   
<br/>
      glPolyFmt(POLY_ALPHA(31) | POLY_CULL_NONE);
<br/>
      
<br/>
      // Set the current matrix to be the model matrix
<br/>
      glMatrixMode(GL_MODELVIEW);
<br/>
<br/>
      //Push our original Matrix onto the stack (save state)
<br/>
      glPushMatrix();   
<br/>
<br/>
      glLoadIdentity();                           // Reset The Current Modelview Matrix
<br/>
      glTranslatef(x,y,-6.0f);                  // Move Left 1.5 Units And Into The Screen 6.0
<br/>
      glColor3f(1.0f,1.0f,1.0f);                     // Set The Color To Blue One Time Only
<br/>
      DrawDude();
<br/>
      
<br/>
//*/
<br/>
      // Pop our Matrix from the stack (restore state)
<br/>
      glPopMatrix(1);
<br/>
<br/>
      //a handy little built in function to wait for a screen refresh
<br/>
      swiWaitForVBlank();
<br/>
      
<br/>
      // flush to screen   
<br/>
      glFlush();
<br/>
   }
<br/>
   
<br/>
   return 0;
<br/>
}
<br/>
<br/>
void DrawDude(void)
<br/>
{
<br/>
   glBindTexture(GL_TEXTURE_2D, texture[0]);
<br/>
   glBegin(GL_QUADS);                           // Draw A Quad
<br/>
<br/>
      glTexCoord2f(0.0f, 1.0f);
<br/>
      glVertex3f(-1.0f, 1.0f, 0.0f);               // Top Left
<br/>
<br/>
      glTexCoord2f(0.0f, 0.0f);
<br/>
      glVertex3f( 1.0f, 1.0f, 0.0f);               // Top Right
<br/>
<br/>
      glTexCoord2f(1.0f, 0.0f);
<br/>
      glVertex3f( 1.0f,-1.0f, 0.0f);               // Bottom Right
<br/>
<br/>
      glTexCoord2f(1.0f, 1.0f);
<br/>
      glVertex3f(-1.0f,-1.0f, 0.0f);               // Bottom Left
<br/>
<br/>
   glEnd();                                 // Done Drawing The Quad
<br/>
}
<br/>
<br/>
void ProcessInput(void)
<br/>
{
<br/>
   scanKeys();
<br/>
<br/>
   uint32 keyFlags = keysDown();
<br/>
<br/>
   switch(keyFlags)
<br/>
   {
<br/>
      case KEY_A:
<br/>
         printf("A Pressed\n");
<br/>
         break;
<br/>
      case KEY_B:
<br/>
         printf("B Pressed\n");
<br/>
         break;
<br/>
      case KEY_X:
<br/>
         printf("X Pressed\n");
<br/>
         break;
<br/>
      case KEY_Y:
<br/>
         printf("Y Pressed\n");
<br/>
         break;
<br/>
      case KEY_UP:
<br/>
         printf("Up Pressed\n");
<br/>
         break;
<br/>
      case KEY_DOWN:
<br/>
         printf("Down Pressed\n");
<br/>
         break;
<br/>
      case KEY_LEFT:
<br/>
         printf("Left Pressed\n");
<br/>
         break;
<br/>
      case KEY_RIGHT:
<br/>
         printf("Right Pressed\n");
<br/>
         break;
<br/>
      case KEY_START:
<br/>
         printf("Start Pressed\n");
<br/>
         break;
<br/>
      case KEY_SELECT:
<br/>
         printf("Select Pressed\n");
<br/>
         break;
<br/>
      case KEY_R:
<br/>
         printf("R Shoulder Pressed\n");
<br/>
         break;
<br/>
      case KEY_L:
<br/>
         printf("L Shoulder Pressed\n");
<br/>
         break;
<br/>
      case KEY_TOUCH:
<br/>
         printf("Touchpad Pressed\n");
<br/>
         break;
<br/>
      case KEY_LID:
<br/>
         printf("Lid Down\n");
<br/>
         break;
<br/>
   }
<br/>
<br/>
   keyFlags = keysHeld();
<br/>
<br/>
   if(keyFlags &amp; KEY_UP)
<br/>
      y += 0.3f;
<br/>
   if(keyFlags &amp; KEY_DOWN)
<br/>
      y -= 0.3f;
<br/>
   if(keyFlags &amp; KEY_LEFT)
<br/>
      x -= 0.3f;
<br/>
   if(keyFlags &amp; KEY_RIGHT)
<br/>
      x += 0.3f;
<br/>
}</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104670 - toa - Sun Oct 01, 2006 10:26 am</h4>
    <div class="postbody"><span class="postbody">Use:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">glMatrixMode(GL_TEXTURE);
<br/>
glIdentity();</td> </tr></table><span class="postbody">
<br/>
<br/>
Insert, for example, after:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">...
<br/>
//ds specific, several attributes can be set here   
<br/>
glPolyFmt(POLY_ALPHA(31) | POLY_CULL_NONE);
<br/>
...
<br/>
</td> </tr></table><span class="postbody">
<br/>
in your mains while-loop.
<br/>
<br/>
Should do the trick!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104816 - Dan Forever - Mon Oct 02, 2006 10:22 pm</h4>
    <div class="postbody"><span class="postbody">Yeah that solved the problem, thanks Toa!</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
