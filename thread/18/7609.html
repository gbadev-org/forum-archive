<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Display 8bit image mistery - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > Display 8bit image mistery</h2>
<div id="posts">
<div class="post">
    <h4>#62044 - pt3r - Sat Nov 26, 2005 8:03 pm</h4>
    <div class="postbody"><span class="postbody">I wrote following code to display a 256 color 8bit image on the 3 background of the main display:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
int main(void)
<br/>
{
<br/>
  powerON(POWER_ALL);  
<br/>
  videoSetMode(MODE_5_2D |DISPLAY_BG3_ACTIVE);
<br/>
  vramSetBankA(VRAM_A_MAIN_BG_0x6000000);
<br/>
<br/>
  BG3_CR = BG_BMP8_256x256 | BG_BMP_RAM(0); 
<br/>
  BG3_XDX = 1&lt;&lt;8;
<br/>
  BG3_XDY = 0;
<br/>
  BG3_YDX = 0;
<br/>
  BG3_YDY = 1&lt;&lt;8;
<br/>
  BG3_CY = 0;
<br/>
  BG3_CX = 0;
<br/>
  
<br/>
  dmaCopy(screen_256Bitmap, (uint16*)BG_BMP_RAM(0), 256*192);
<br/>
  dmaCopy(screen_256Pal, BG_PALETTE, 256*2);
<br/>
...
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
This code works well on the dualis emulator as well as on my DS. Since I'm still very new to the DS coding I decided to experiment a bit with the code in order to check whether my assumptions regarding VRAM were correct. So i decided to use bank B instead of bank A. This code failed to work on the dualis emulator but it works without a fault on the DS. Is this a bug in the dualis emulator? The same thing happens when I use Bank C
<br/>
with a vramSetBankC(VRAM_C_MAIN_BG_0x6000000);
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
int main(void)
<br/>
{
<br/>
  powerON(POWER_ALL);  
<br/>
  videoSetMode(MODE_5_2D |DISPLAY_BG3_ACTIVE);
<br/>
  vramSetBankB(VRAM_B_MAIN_BG_0x6000000);
<br/>
<br/>
  BG3_CR = BG_BMP8_256x256 | BG_BMP_RAM(0); 
<br/>
  BG3_XDX = 1&lt;&lt;8;
<br/>
  BG3_XDY = 0;
<br/>
  BG3_YDX = 0;
<br/>
  BG3_YDY = 1&lt;&lt;8;
<br/>
  BG3_CY = 0;
<br/>
  BG3_CX = 0;
<br/>
  
<br/>
  dmaCopy(screen_256Bitmap, (uint16*)BG_BMP_RAM(0), 256*192);
<br/>
  dmaCopy(screen_256Pal, BG_PALETTE, 256*2);
<br/>
...
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I decided to push the experiment a bit further and tried to map a different VRAM area to my background. This code gives a black screen both on dualis and on my DS.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
int main(void)
<br/>
{
<br/>
  powerON(POWER_ALL);  
<br/>
  videoSetMode(MODE_5_2D |DISPLAY_BG3_ACTIVE);
<br/>
  vramSetBankA(VRAM_A_MAIN_BG_0x6040000);
<br/>
<br/>
  BG3_CR = BG_BMP8_256x256 | BG_BMP_RAM(16); 
<br/>
  BG3_XDX = 1&lt;&lt;8;
<br/>
  BG3_XDY = 0;
<br/>
  BG3_YDX = 0;
<br/>
  BG3_YDY = 1&lt;&lt;8;
<br/>
  BG3_CY = 0;
<br/>
  BG3_CX = 0;
<br/>
  
<br/>
  dmaCopy(screen_256Bitmap, (uint16*)BG_BMP_RAM(16), 256*192);
<br/>
  dmaCopy(screen_256Pal, BG_PALETTE, 256*2);
<br/>
...
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
What  am I missing? Any help/hints are highly appreciated.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62114 - pt3r - Sun Nov 27, 2005 3:57 pm</h4>
    <div class="postbody"><span class="postbody">Is nobody able to answer my question ? Perhaps I should rephrase it. How is it possible that this code works  
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
powerON(POWER_ALL);  
<br/>
  videoSetMode(MODE_5_2D|DISPLAY_BG3_ACTIVE);
<br/>
  vramSetBankA(VRAM_A_MAIN_BG_0x6000000);
<br/>
  BG3_CR = BG_BMP8_256x256|BG_BMP_RAM(0);
<br/>
  BG3_XDX = 1&lt;&lt;8;
<br/>
  BG3_XDY = 0;
<br/>
  BG3_YDX = 0;
<br/>
  BG3_YDY = 1&lt;&lt;8;
<br/>
  BG3_CY = 0;
<br/>
  BG3_CX = 0;
<br/>
  
<br/>
  dmaCopy(screen_256Bitmap, (uint16*)BG_BMP_RAM(0), 256*192);
<br/>
  dmaCopy(screen_256Pal, BG_PALETTE, 256*2);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
But this code does not work, the only thing I changed is the VRAM bank address from 0x06000000 to 0x06400000 and I of course copied the image data to the corresponding address:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
powerON(POWER_ALL);  
<br/>
  videoSetMode(MODE_5_2D|DISPLAY_BG3_ACTIVE);
<br/>
  vramSetBankA(VRAM_A_MAIN_BG_0x6040000);
<br/>
<br/>
  BG3_CR = BG_BMP8_256x256|BG_BMP_RAM(16);
<br/>
  BG3_XDX = 1&lt;&lt;8;
<br/>
  BG3_XDY = 0;
<br/>
  BG3_YDX = 0;
<br/>
  BG3_YDY = 1&lt;&lt;8;
<br/>
  BG3_CY = 0;
<br/>
  BG3_CX = 0;
<br/>
  
<br/>
  dmaCopy(screen_256Bitmap, (uint16*)BG_BMP_RAM(16), 256*192);
<br/>
  dmaCopy(screen_256Pal, BG_PALETTE, 256*2);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Where do I make a mistake in my code and/or reasoning, Why am I able to display the image in background 3 when mapped to VRAM_A_MAIN_BG_0x6000000 but not when I map it to VRAM_A_MAIN_BG_0x6040000? I read the ndslib document as well as the dstek document but I can not find a clue on why this coud doesn't work. :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62224 - pt3r - Mon Nov 28, 2005 2:15 pm</h4>
    <div class="postbody"><span class="postbody">Nevermind I did some more studying and figured out where my train of thought ran of the rails. 
<br/>
When initialising the BGx_CR is must use BG_BMP_BASE(x) instead of BG_BMP_RAM(x).</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
