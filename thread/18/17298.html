<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Help to optmize SDL game - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Help to optmize SDL game</h2>
<div id="posts">
<div class="post">
    <h4>#174498 - protomank - Thu Jun 17, 2010 2:58 pm</h4>
    <div class="postbody"><span class="postbody">Hello, I need some help to optimize my game project, that is based on SDL.
<br/>
The code is available in <a class="postlink" href="http://rockman-engine.svn.sourceforge.net/viewvc/rockman-engine/" target="_blank">http://rockman-engine.svn.sourceforge.net/viewvc/rockman-engine/</a>.
<br/>
<br/>
It becomes very slow when there are too much sprites (a player, 3 npcs and shots) in the screen. But even on a clean screen, it looks like the update of the background is slow.
<br/>
<br/>
Disclaimer: 
<br/>
- there is no way I will not not SDL unless some brave sould takes the step to do a full port to DS ;)
<br/>
- I've already saw DS programs running in full speed in the DS
<br/>
- so, fell free to point errors in my code that are making things slow, even if you say "you need to rewrite 80% of the code". It is ok, I'm open to critics.<br/>_________________<br/>Iuri Fiedoruk
<br/>
<a href="http://rockbot.upperland.net" target="_blank">http://rockbot.upperland.net</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#174520 - relminator - Sun Jun 20, 2010 2:28 am</h4>
    <div class="postbody"><span class="postbody">I'll be looking at your code and see if I can overload some stuff to use the 3d core.
<br/>
<br/>
[edit]
<br/>
<br/>
Can you zip your sources? I'm having probs navigating.<br/>_________________<br/><a href="http://rel.betterwebber.com" target="_blank">http://rel.betterwebber.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#174523 - Sektor - Sun Jun 20, 2010 4:03 am</h4>
    <div class="postbody"><span class="postbody">No need to zip it. You can get the <a class="postlink" href="http://rockman-engine.svn.sourceforge.net/viewvc/rockman-engine/?view=tar" target="_blank">GNU tarball</a>.<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><a class="postlink" href="http://gtamp.com/DS" target="_blank">GTAMP.com/DS</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#174524 - relminator - Sun Jun 20, 2010 6:11 am</h4>
    <div class="postbody"><span class="postbody">I've seen your graphics.h file and unless you invest time changing your rendering engine, It's gonna be hard to help you.<br/>_________________<br/><a href="http://rel.betterwebber.com" target="_blank">http://rel.betterwebber.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#174563 - protomank - Sat Jun 26, 2010 1:16 pm</h4>
    <div class="postbody"><span class="postbody">well, and how do you suggest I change it?<br/>_________________<br/>Iuri Fiedoruk
<br/>
<a href="http://rockbot.upperland.net" target="_blank">http://rockbot.upperland.net</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#174565 - relminator - Sat Jun 26, 2010 3:00 pm</h4>
    <div class="postbody"><span class="postbody">Ditch SDL and use the 3d engine.  Trust me, once you make your 2d renderer using the 3d engine. It's almost like SDL as long as you don't use per pixel surface access.<br/>_________________<br/><a href="http://rel.betterwebber.com" target="_blank">http://rel.betterwebber.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#174566 - protomank - Sat Jun 26, 2010 3:54 pm</h4>
    <div class="postbody"><span class="postbody">Does the 3d engine runs on Windows, Linux, Mac, PS2, Dingoo and PSP? :D
<br/>
<br/>
I use SDL because this is a multi-platform game.
<br/>
Anyway, I've did some optimizations in how I clear screen and how I move sprites that made the game run full-speed without sound, and using maxmod to play a background music, it runs, not well, but well-enought.
<br/>
I think I can achieve a good speed in the DS, even if using SDL.<br/>_________________<br/>Iuri Fiedoruk
<br/>
<a href="http://rockbot.upperland.net" target="_blank">http://rockbot.upperland.net</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#174569 - DiscoStew - Sat Jun 26, 2010 5:32 pm</h4>
    <div class="postbody"><span class="postbody">SDL will only limit you when using it on the DS because it is all software-based rendering, which probably doesn't use the VRAM at all, making it even worse.
<br/>
<br/>
Without using the device's hardware capabilities, you end up running via software rendering, which takes up CPU cycles vs letting hardware handle it at literally no cost.
<br/>
<br/>
Without use of the tcm and cache, the ARM9 CPU would be limited to 33Mhz vs the 66Mhz when used efficiently, and this doesn't include teh hardware glitch.
<br/>
<br/>
The hardware glitch occurs when non-sequential access to RAM are done, resulting in an extra 3 waitcycles added to each operation.  In worse-case scenarios, including the lack of tcm and cache use, the 66Mhz that was started with will drop to a measly 8Mhz, which is half the processing capabilities of the GBA.
<br/>
<br/>
This is why SDL is not recommended with DS development. It currently forces everything to be rendered via the CPU, as well as clashes with the hardware defects of the device because of it being done through the CPU.<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#174570 - protomank - Sat Jun 26, 2010 6:37 pm</h4>
    <div class="postbody"><span class="postbody">Well, it is just a matter of someone fixing SDL. Sadly, it seems no one with the knowledge in DS development wants to do it.
<br/>
<br/>
So, I'll just keep using to old version, and make sure it runs half-ok, while more decent SDL ports like the Dingoo-Linux and PSP gives me more joy ;)<br/>_________________<br/>Iuri Fiedoruk
<br/>
<a href="http://rockbot.upperland.net" target="_blank">http://rockbot.upperland.net</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#174574 - SteveH - Sun Jun 27, 2010 12:39 pm</h4>
    <div class="postbody"><span class="postbody">The reason that SDL exists at this moment in time on the DS is due to the portee wanting to port something to the DS, and then they ditched the SDL code as soon as they reliased that SDL + DS = Nightmare to implement.
<br/>
<br/>
SDL is the worst games lib to exist ever, I used an earler version and all I managed to get was a 10fps animation on my PC at that time, if I went native I got 120fps (Windowed mode BTW) on a fairly decent spec'd P4 PC at the time.
<br/>
<br/>
Even professional studios that do cross platform development write everything in a native layer that can be changed at compile time before shiping things out. There's even a book wrote on the subject of cross platform development, and IIRC there's a section on why SDL, and the other cross platform libs, are bad vs native libs.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#174578 - protomank - Mon Jun 28, 2010 12:31 am</h4>
    <div class="postbody"><span class="postbody">Well, SDL is indeed slower than native ports, but the portability it brings have no price for homebrew developers. Not every person have enought free time or money to make native ports of their projects.
<br/>
And my experience with SDL is fairly good with Rockbot and several open-source games I've helped to develop, Rockbot for example, is now running so well on Nintendo DS, that I'll probally will have to slow it down a bit :)
<br/>
<br/>
I do not have a fps counter, because, on my experience, the FPS system itself does slow down things a good bit, but I am moving the player 3 pixels each loop and animation is smooth, even with a lot of simultaneous sprites (3 npcs and 4 shots/projectiles) and background music. The PC port runs at full speed even on my old eePC 701. The PS2 port runs fine, only have some problems with the sound (that is not caused by SDL itself, but thread rotating).
<br/>
Another thing: it is WAY MORE EASY than doing native ports.
<br/>
<br/>
So, I am happy with it, even if a LOT of people here in DSDev keeps saying that it sucks :)<br/>_________________<br/>Iuri Fiedoruk
<br/>
<a href="http://rockbot.upperland.net" target="_blank">http://rockbot.upperland.net</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#174580 - elhobbs - Mon Jun 28, 2010 12:44 am</h4>
    <div class="postbody"><span class="postbody">if it runs so well on the ds using sdl then what are you going on about?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#174587 - protomank - Mon Jun 28, 2010 12:10 pm</h4>
    <div class="postbody"><span class="postbody">In the mean time after I posted here, I found a way to optimize drawing the sprites, so that this is not a problem anymore :)
<br/>
<br/>
The fact is that I've recycled an old RPG engine I had, while the map did not scroll most of time, so each sprite had a copy of it's background to clear the screen when it moved. Also, not all sprites moved at same time.
<br/>
<br/>
Rockbot is a side scrolling game, so I've tryied to repaint all screen each loop, thus clearing all the sprites, and then redraw them. What I tought would be slower, in fact is faster, and else it will free some memory (no backup of the screen in each sprite/surface needed anymore).
<br/>
<br/>
All in all, SDL can be fast, it just depends what you are trying to do with it ;)<br/>_________________<br/>Iuri Fiedoruk
<br/>
<a href="http://rockbot.upperland.net" target="_blank">http://rockbot.upperland.net</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#174588 - elhobbs - Mon Jun 28, 2010 2:33 pm</h4>
    <div class="postbody"><span class="postbody">I thought you said the buttons were broken in the ds port of sdl? How are you getting around that?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#174590 - protomank - Mon Jun 28, 2010 2:38 pm</h4>
    <div class="postbody"><span class="postbody">Do not ask me WHY, but after I've upgraded my machine to the lastest Ubuntu.. the problem simply vanished.
<br/>
It could be that I had some trash in the libraries.
<br/>
Or maybe because the compatibility gcc is now 4.1 instead of 4.2 in Ubuntu.
<br/>
Or maybe some magic unicorn flyied under a rainbow and fixed it when a butterfly winged in Japan...
<br/>
<br/>
I do now have an answer, but I am happy that it is working ;)
<br/>
I'll drop a test build for you guys to check it out soon.<br/>_________________<br/>Iuri Fiedoruk
<br/>
<a href="http://rockbot.upperland.net" target="_blank">http://rockbot.upperland.net</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
