<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>My new game - and problems with same. - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > My new game - and problems with same.</h2>
<div id="posts">
<div class="post">
    <h4>#123022 - 3D_geek - Sat Mar 24, 2007 6:06 pm</h4>
    <div class="postbody"><span class="postbody">Well, after a week of dinking around with the DS - using:
<br/>
<br/>
* Games N'Music cartridge (which  works AMAZINGLY well BTW)
<br/>
* Linux for development.
<br/>
* devkitARM r20
<br/>
* libnds - the latest as of a week ago.
<br/>
<br/>
I have something reasonably nice running - which you are welcome to download and play with:
<br/>
<br/>
<a href="http://www.sjbaker.org/tmp/hardball.nds" target="_blank">http://www.sjbaker.org/tmp/hardball.nds</a>
<br/>
<br/>
Instructions: {UPDATED 3/25}[UDATED AGAIN 3/31] are now displayed on the bottom screen.
<br/>
<br/>
The back-story is that this is a mining colony on Mars - the arena is an ancient Martian city that's been turned into a place for the miners to live - with a glass canopy enclosing the atmosphere.  Since it's a low gravity world, miners can get around on a variety of human-powered flying machines - bicycle-powered helicopters, giant mutant eagles, jet-packs, etc.  For fun, they play a game that's a bit like 3D football - flying around the arena - grabbing the ball using force-field "grabbers"...using huge ore buckets on cranes as goals...you get the idea.
<br/>
<br/>
The entire game works 100% correctly on a Linux PC - but not yet 100% on the DS.
<br/>
<br/>
The actual game functions *would* also work - but because I've exceeded the 2048 polygon budget, I've had to turn a bunch of stuff off to get it to run at all - so I have more work to do before this is a playable game...but you *can* just fly around and admire the scenery - and that's fun for about 5 minutes!
<br/>
<br/>
...but I have LOTS of problems still:
<br/>
<br/>
1) I don't understand why I don't get any sounds or activity on the buttons that are handled on the ARM7. I've pretty much concluded that there is a problem somewhere in the current version of devkitARM and/or libnds because programs that I build don't produce sound or respond to the X/Y buttons - but programs I get ready-built from elsewhere work fine until I recompile them.  Because the things that don't work are ARM7 functions, I presume there is something amiss with the ARM7 executable that devkit is (presumably) tacking on to my ARM9 program.  Help!?!
<br/>
<br/>
2) I'm surprised that the DS seems to simply lock up/freeze if I draw one too many polygons.  (Jeez - 2048 is a horribly low limit!)  Is that intended behavior?
<br/>
<br/>
3) Could someone explain how texture storage works?  When I overflow ~128k, I just get white textures - OK, fair enough - I guess I need more VRAM banks.  So I added stuff like:
<br/>
<br/>
  vramSetBankA(VRAM_A_TEXTURE);
<br/>
  vramSetBankB(VRAM_B_TEXTURE);
<br/>
  vramSetBankC(VRAM_C_TEXTURE);
<br/>
  vramSetBankD(VRAM_D_TEXTURE);
<br/>
<br/>
...but some of those commands seem to shut off the bottom screen - others result in very corrupted textures...like maybe they are sharing RAM with program storage or something. Which banks can I use and which ones are used for something else?
<br/>
<br/>
4) When my program links (using g++), I get a bunch of spurious linker errors.  The same set of sources, compiled for Linux/x86 hardware link just fine.   The errors appear to be something to do with ARM arithmetic emulation.
<br/>
<br/>
I can shut them up and get a working binary using "-Wl,-zmuldefs" ...but that can't be a good thing!
<br/>
<br/>
/home/nds/devkitARM_r20/bin/../lib/gcc/arm-eabi/4.1.1/thumb/libgcc.a(_udivsi3.o): In function `__aeabi_uidiv':
<br/>
(.text+0x0): multiple definition of `__udivsi3'
<br/>
/u/nds/devkitARM_r20/libnds/lib/libnds9.a(division.o):/home/nds/devkitARM_r20/libnds/source/common/division.s:(.text+0x4): first defined here
<br/>
/home/nds/devkitARM_r20/bin/../lib/gcc/arm-eabi/4.1.1/thumb/libgcc.a(_udivsi3.o): In function `__aeabi_uidiv':
<br/>
(.text+0x0): multiple definition of `__aeabi_uidiv'
<br/>
/u/nds/devkitARM_r20/libnds/lib/libnds9.a(division.o):/home/nds/devkitARM_r20/libnds/source/common/division.s:(.text+0x4): first defined here
<br/>
collect2: ld returned 1 exit status
<br/>
<br/>
    Any clues?<span style="color: violet"></span></span><span class="gensmall"><br/><br/>Last edited by 3D_geek on Sat Mar 31, 2007 9:04 am; edited 2 times in total</span></div>    
</div>
<div class="post">
    <h4>#123026 - Diddl - Sat Mar 24, 2007 6:22 pm</h4>
    <div class="postbody"><span class="postbody">no clues (from me) ...
<br/>
<br/>
but it is cool, a nice 3d landscape!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123037 - 3D_geek - Sat Mar 24, 2007 7:55 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Diddl wrote:</b></span></td> </tr> <tr> <td class="quote">no clues (from me) ...
<br/>
<br/>
but it is cool, a nice 3d landscape!</td> </tr></table><span class="postbody">
<br/>
<br/>
Thanks!
<br/>
<br/>
The railroad tracks should have mine karts rolling back and forth along them - there is a bug someplace in my fixed point matrix math that's making one of them fly across the middle of the arena at enormous speed - and the others be miles outside the arena.  There should be two massive cranes with excavator scoops dangling benath them to make the two 'goals' - then the player is this kinda punk-looking guy riding a man-powered helicopter...other players are riding giant eagles and jetpacks and such...
<br/>
<br/>
But the arena and mine karts eats about 1000 triangles - each of the players eats around 700 - so I blow the triangle limit alarmingly quickly.  I've got to put the whole scene on a severe polygon diet...argh!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123056 - tepples - Sat Mar 24, 2007 9:55 pm</h4>
    <div class="postbody"><span class="postbody">Shutting off the subscreen can be solved: move the console to a sub-bank (E through I). The corrupted textures may be the console's map and/or its 8x8 pixel font.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123060 - HyperHacker - Sat Mar 24, 2007 10:22 pm</h4>
    <div class="postbody"><span class="postbody">Your mine carts are 1000 polygons? You need to scale this game waaaaay down. I'd think ~9 quads and some textures could make a decent mine cart, especially if texture transparency is used for the wheels.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>3D_geek wrote:</b></span></td> </tr> <tr> <td class="quote"> Start  == Reset the game,
<br/>
 Select == Toggle Pause</td> </tr></table><span class="postbody">Why do people keep using this control scheme? Every game ever has used Start to pause. It really sucks when you don't know the game you're playing has it assigned to Reset instead, or instinctively reach for Start anyway.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123086 - 3D_geek - Sun Mar 25, 2007 12:41 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">Your mine carts are 1000 polygons? You need to scale this game waaaaay down. I'd think ~9 quads and some textures could make a decent mine cart, especially if texture transparency is used for the wheels.</td> </tr></table><span class="postbody">
<br/>
<br/>
No!  You misunderstand - the entire ARENA (all of the buildings, gantries, the floor, the walls and the roof and sky above the roof - PLUS THE MINEKARTS (of which there are half a dozen) comes to under 1000 polygons.  The mine karts are indeed cuboids - with no top and two polygons dangling underneath with wheel textures!
<br/>
<br/>
The worst problem is the characters in the game - which are quite detailed because the camera is right up next to them much of the time.   I've got to use a level-of-detail mechanism to drop those to much fewer polygons at longer ranges - but the worst-case situation is still bad...probably one has to play with the AI to ensure that characters don't congregate together too close to the camera...tricky stuff.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>3D_geek wrote:</b></span></td> </tr> <tr> <td class="quote"> Start  == Reset the game,
<br/>
 Select == Toggle Pause</td> </tr></table><span class="postbody">Why do people keep using this control scheme? Every game ever has used Start to pause. It really sucks when you don't know the game you're playing has it assigned to Reset instead, or instinctively reach for Start anyway.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
It's utterly trivial to change.  'Start' says 'Reset' to me...but that's one line of code...I have a ton of other control issues to fix yet.  Aside from anything else, I can't get the X/Y buttons to work - so I'm short of two buttons as it is.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123087 - 3D_geek - Sun Mar 25, 2007 12:44 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Shutting off the subscreen can be solved: move the console to a sub-bank (E through I). The corrupted textures may be the console's map and/or its 8x8 pixel font.</td> </tr></table><span class="postbody">
<br/>
I'm not entirely sure how to do that - what banks are there - and what are the recommended distribution of textures/screens/whatever?   I'm using 16 bit textures - so no color map is needed.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123125 - 0xtob - Sun Mar 25, 2007 10:45 am</h4>
    <div class="postbody"><span class="postbody">Hey, really nice game so far!
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">1) I don't understand why I don't get any sounds or activity on the buttons that are handled on the ARM7. I've pretty much concluded that there is a problem somewhere in the current version of devkitARM and/or libnds because programs that I build don't produce sound or respond to the X/Y buttons - but programs I get ready-built from elsewhere work fine until I recompile them. Because the things that don't work are ARM7 functions, I presume there is something amiss with the ARM7 executable that devkit is (presumably) tacking on to my ARM9 program. Help!?! </td> </tr></table><span class="postbody">
<br/>
This looks like the arm7 part is not running, which is usually the case because the wrong entry point is set (the entry point was changed with devkitPro r20). Check for the ndstool call in your top-level Makefile. If there are parameters like -e7 ... and -r7 ..., remove them. Also make sure you're using the latest ndstool (i.e. the one that comes with DKP r20).<br/>_________________<br/><a class="postlink" href="http://blog.dev-scene.com/0xtob" target="_blank">http://blog.dev-scene.com/0xtob</a> | <a class="postlink" href="http://nitrotracker.tobw.net" target="_blank">http://nitrotracker.tobw.net</a> | <a class="postlink" href="http://dsmi.tobw.net" target="_blank">http://dsmi.tobw.net</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123142 - zzo38computer - Sun Mar 25, 2007 5:01 pm</h4>
    <div class="postbody"><span class="postbody">Make START+SELECT if pushed simultaneously reset the game, and START by itself to pause.<br/>_________________<br/><span style="font-weight: bold">Important:</span> Please send messages about FWNITRO to the public forum, not privately to me.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123170 - 3D_geek - Sun Mar 25, 2007 8:44 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>0xtob wrote:</b></span></td> </tr> <tr> <td class="quote">This looks like the arm7 part is not running, which is usually the case because the wrong entry point is set (the entry point was changed with devkitPro r20). Check for the ndstool call in your top-level Makefile. If there are parameters like -e7 ... and -r7 ..., remove them. Also make sure you're using the latest ndstool (i.e. the one that comes with DKP r20).</td> </tr></table><span class="postbody">
<br/>
<br/>
Right - I kinda suspected an ARM7 problem.  I'm not able to use the standard set of Makefiles that were in the 'examples' package because this project runs under Windows and Linux PC as well as the NDS - but the script I use to convert an 'elf' binary into a '.nds' file is:
<br/>
<br/>
echo "Converting " $1 "(ELF)" to $2 "(NDS)..."
<br/>
${DEVKITARM}/bin/arm-eabi-objcopy -O binary $1 $1.arm9
<br/>
${DEVKITARM}/bin/ndstool -c $2 -9 $1.arm9
<br/>
<br/>
But that can't be it - none of the 'examples' programs produce sound or respond to the X/Y buttons either.
<br/>
<br/>
My setup has
<br/>
<br/>
/home/nds/devkitARM
<br/>
/home/nds/devkitARM/libnds
<br/>
<br/>
...so I presume ndstool is finding whatever it needs OK (I don't see any error messages from it).  My libnds came from downloading libnds-src-20070317.tar.bz2 and building it in the usual way by typing 'make' then 'make install'.  Again, no errors were reported.
<br/>
<br/>
What exactly does ndstool actually do?  Is there something I could search for in the '.nds' binary file that would verify whether the 'ARM7' code is present and at the correct version?  Where is that code stored in libnds?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123175 - 3D_geek - Sun Mar 25, 2007 9:48 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>zzo38computer wrote:</b></span></td> </tr> <tr> <td class="quote">Make START+SELECT if pushed simultaneously reset the game, and START by itself to pause.</td> </tr></table><span class="postbody">
<br/>
<br/>
Your wish is my command!
<br/>
<br/>
<a href="http://www.sjbaker.org/tmp/hardball.nds" target="_blank">http://www.sjbaker.org/tmp/hardball.nds</a>
<br/>
<br/>
START - toggle pause.
<br/>
SELECT - cycle through camera positions
<br/>
START+SELECT - reset
<br/>
A - Accellerate
<br/>
B - Brake
<br/>
L/R - (Temporarily because I'm debugging something) Zoom In/Zoom Out
<br/>
+ - Joystick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123434 - gabebear - Wed Mar 28, 2007 4:49 am</h4>
    <div class="postbody"><span class="postbody">You can only do 2048 triangles per render pass, but you can combine multiple render passes into a single image with the DS's display capture. On the second pass you will lose the depth buffer, so you have to separate the foreground from the background(a.k.a. whatever you draw on the second pass will be on top of the first pass). Each pass takes a fixed time of 1/60th of a sec. I guess there should be a libnds example that demonstrates display capture. I'll put that on my to-do list; the example would need to be really well commented.
<br/>
<br/>
Using display capture to boost polygon count isn't trivial, you probably want to get more familiar with the DS hardware before playing with it.</span><span class="gensmall"><br/><br/>Last edited by gabebear on Wed Mar 28, 2007 7:20 am; edited 2 times in total</span></div>    
</div>
<div class="post">
    <h4>#123440 - ikaris - Wed Mar 28, 2007 5:57 am</h4>
    <div class="postbody"><span class="postbody">Nice job 3D_geek,
<br/>
<br/>
what did you use to export the 3D data ?
<br/>
<br/>
Are you using display lists or immediate mode ?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123522 - 3D_geek - Wed Mar 28, 2007 8:44 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ikaris wrote:</b></span></td> </tr> <tr> <td class="quote">what did you use to export the 3D data ?</td> </tr></table><span class="postbody">
<br/>
<br/>
The models were made in a mix of blender and AC3D (both under Linux) - I used my 'PLIB' library (http://plib.sf.net) to import the models (PLIB imports and exports a bunch of different formats) into a tool I wrote that writes the models out as a big heap of pre-initialised arrays and classes in C++ source code.  The result is a 'scene graph' that you can compile into your sources and render just by calling the 'draw' method on any object in the scene.  I have another tool I wrote to take images in '.rgb' or '.png' and chucks them out as preinitialised C++ structures.  This allows all of the models and textures to be compiled into the code.
<br/>
<br/>
The constructor functions for objects in the scene graph and texture maps causes them to be 'registered' into a repository as the program starts up - then the game can 'fetch' objects by querying the repository with a text string.
<br/>
<br/>
The program runs under Linux/PC also - so I can debug more conveniently.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Are you using display lists or immediate mode ?</td> </tr></table><span class="postbody">
<br/>
<br/>
It's in immediate mode - I should probably look into display lists - but right now it's running plenty fast enough so I'll attack other problems first.  The biggest concerns right now are getting the ARM7 problem under control and figuring out what I'm going to do about the 2048 triangle limit.
<br/>
<br/>
The multipass solution to pushing up the polygon limit is tempting - but I like the smoothness of running at a solid 60Hz.  For 'flying' games, 60Hz does a lot to improve the fluidity of the experience.  If I can get my brain around texture memory bank allocation - I may do what MarioKart does and pre-render the players as sprites (at least at longer ranges).  I'll figure something out.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123570 - gabebear - Thu Mar 29, 2007 4:23 am</h4>
    <div class="postbody"><span class="postbody">if you want to get more polys without limiting your frame-rate you need to look into using quads.
<br/>
<br/>
General run down on DS polygon limit:
<br/>
   ~2000 triangles (strips or singles)
<br/>
   ~1500 quads as singles
<br/>
   ~1700 quads as strips
<br/>
<br/>
so drawing quads as quads instead of two triangles is 50% or more efficient.
<br/>
<br/>
Quads will not render correctly unless they are flat or reallllllly close to flat(like any other 3D card). I made a simple PLY to packed display list converter that works well with Blender <a href="http://ghearing.com/mtutorial/" target="_blank">http://ghearing.com/mtutorial/</a> . The converter doesn't make sure that quads are flat, so you have to make sure quads are actually flat in Blender, and it doesn't make strips. Strips would only increase efficiency by 13% at most (probably like 8% on average).
<br/>
<br/>
I noticed that the converter doesn't export normals correctly unless you export vertex colors as well, but I haven't fixed it yet.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123571 - tepples - Thu Mar 29, 2007 4:27 am</h4>
    <div class="postbody"><span class="postbody">But isn't the use of strips <a class="postlink" href="http://www.patentstorm.us/patents/5561749-claims.html" target="_blank">patented</a> where a lot of us live?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123589 - kusma - Thu Mar 29, 2007 10:06 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">But isn't the use of strips <a class="postlink" href="http://www.patentstorm.us/patents/5561749-claims.html" target="_blank">patented</a> where a lot of us live?</td> </tr></table><span class="postbody">
<br/>
<br/>
That patent can pretty much be considered useless. It was filed two years after the release of OpenGL 1.0, which already incorporated the concept. I'm sure there's other prior art out there.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123592 - memoni - Thu Mar 29, 2007 12:02 pm</h4>
    <div class="postbody"><span class="postbody">I cannot unfortunately test your game currently so I don't know exactly how your level is laid out, but one thing to fight against the polygon limit is to add some sort of space partitioning.
<br/>
<br/>
It can be as simple as dividing the world on a grid of cubes, then checking if some polygons touch a cube and then expanding the cube to be AABB of all the touched polygons. The polys are only added to one "cube". Continue until no polys left. Then at render time check if the AABB of the chunk if visible and only render the visible chunks.
<br/>
<br/>
Additionally you could make the game logic so that it tries to keep the number of carts within the poly limits but still keep the illusion of a lot of carts.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123662 - 3D_geek - Fri Mar 30, 2007 1:00 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>kusma wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">But isn't the use of strips <a class="postlink" href="http://www.patentstorm.us/patents/5561749-claims.html" target="_blank">patented</a> where a lot of us live?</td> </tr></table><span class="postbody">
<br/>
<br/>
That patent can pretty much be considered useless. It was filed two years after the release of OpenGL 1.0, which already incorporated the concept. I'm sure there's other prior art out there.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Yeah - there sure is.  OpenGL is the successor to IrisGL - which was around since the start of SGI's graphics workstation line - which was around in 1982 or so. IrisGL has an API call 'bgntmesh' and 'bgnqstrip' that to tristrips and quadstrips respectively.  I suspect there were strip-based systems around long before that - but it's harder to prove.
<br/>
<br/>
That patent is ignored by absolutely everyone - there is a ton of 'prior' art which renders it completely invalid.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123666 - 3D_geek - Fri Mar 30, 2007 1:31 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>memoni wrote:</b></span></td> </tr> <tr> <td class="quote">I cannot unfortunately test your game currently so I don't know exactly how your level is laid out, but one thing to fight against the polygon limit is to add some sort of space partitioning.
<br/>
<br/>
It can be as simple as dividing the world on a grid of cubes, then checking if some polygons touch a cube and then expanding the cube to be AABB of all the touched polygons. The polys are only added to one "cube". Continue until no polys left. Then at render time check if the AABB of the chunk if visible and only render the visible chunks.
<br/>
<br/>
Additionally you could make the game logic so that it tries to keep the number of carts within the poly limits but still keep the illusion of a lot of carts.</td> </tr></table><span class="postbody">
<br/>
<br/>
Yes - I'm very familiar with the issues involving field of view culling (I used to design flight simulator graphics for a living and I've twice designed and built my own 3D hardware with custom/semicustom silicon!) - but in this particular application, there is no way to prevent the eyepoint getting into a position in one corner of the play arena where every single object in the entire game world is in view at once.  Since we have an utter hard limit on polygon count - one has to engineer for the worst case.  In a normal graphics system, the worst that would happen would be that you'd drop frame rate occasionally...here, something much more drastic has to happen.
<br/>
<br/>
That means that there isn't a whole lot of point in doing field of view culling - which only improves the best case - unless you have some other mechanism to get rid of things that are far from the eye (you can't easily be close to everything at once - so that's one kind of "worst case" that can't ever happen.  But that too is essentially out of the question because the game is set in a very confined arena and things never get very far from your eye (intentionally - because with the ultra-low screen resolution, you lose sight of things if they get too far away.   I'll have to use a level of detail mechanism to drop the polygon counts of objects at longer ranges - along with a mechanism to render smaller objects in near-to-far order, simply dropping out the ones that push the polygon count over the magic limit.  I may also have to consider hacking my AI to have enemy players stay away from the camera when the polygon counts start to climb too high.
<br/>
<br/>
Intelligent use of quadstrips is definitely something I need to look into - but even so, the gains are likely to be disappointing because only a fairly small proportion of my scene content is quad-strippable - and fifty percent of a small amount isn't worth a whole lot of implementation hassle (especially because a bunch of my models are going to be animated with skin/bones techniques so things that were planar quads when I modelled them may well bend into non-planar things at runtime.
<br/>
<br/>
Taking smaller and more distant objects and rendering them as 2D sprites is clearly a good idea (we know that's what Nintendo do in several of their games - but the limited amount of texture memory is going to make that painful too.  Fortunately, the tiny display resolution works for us in that regard - nearly everything is 'small' on such a tiny screen.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123724 - memoni - Fri Mar 30, 2007 5:47 pm</h4>
    <div class="postbody"><span class="postbody">3D_Geek, that "everthing can be visible" was the bit I feared when I answered without seeing the game. I have only Mac at home currently and the cart I have has windows drivers only.
<br/>
<br/>
If you want to go for 2 pass rendering that kind of partitioning might help you to divide the two passes (front and back).
<br/>
<br/>
Btw, does someone know if backfacing polygons are culled before they are added to the vertex buffer? If not and you have some cycles to spare you might try to do a backface culling before drawing.
<br/>
<br/>
p.s. Do you happen to have any screenshots of your game?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123738 - tepples - Fri Mar 30, 2007 7:44 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>memoni wrote:</b></span></td> </tr> <tr> <td class="quote">Btw, does someone know if backfacing polygons are culled before they are added to the vertex buffer?</td> </tr></table><span class="postbody">
<br/>
They are. One of the 3D demos included with libnds examples shows how much RAM is being used, and the value changes based on the number of polygons that are facing forward.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"> If not and you have some cycles to spare you might try to do a backface culling before drawing.</td> </tr></table><span class="postbody">
<br/>
Software culling isn't so easy if you're using quad strips to save geometry RAM. For example, a deltoidal <a class="postlink" href="http://en.wikipedia.org/wiki/Deltoidal_icositetrahedron" target="_blank">icosatetrahedron</a> (a 24-quad <a class="postlink" href="http://en.wikipedia.org/wiki/Catalan_solid" target="_blank">Catalan</a> approximation to the sphere) is six such strips, and a software backface culler would have to split strips to fit everything in.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123753 - crossraleigh - Fri Mar 30, 2007 9:03 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">[...] unless you have some other mechanism to get rid of things that are far from the eye [...]</td> </tr></table><span class="postbody">
<br/>
There is a hardware register that allows you to automatically cull distant polygons. GBATEK calls it DISP_1DOT_DEPTH, but it may be called something different in libnds.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">[...] a bunch of my models are going to be animated with skin/bones techniques so things that were planar quads when I modelled them may well bend into non-planar things at runtime.</td> </tr></table><span class="postbody">
<br/>
You could just ignore polygons on a joint when finding quads on an animated model.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123803 - 3D_geek - Sat Mar 31, 2007 7:15 am</h4>
    <div class="postbody"><span class="postbody">Finding the problem with glTexImage2D solved a lot of my issues.  By loading large textures first and then the smaller ones I'm able to avoid the texture wastage in libnds and because I now only use banks A and B, I seem to be somehow avoiding the problems I had previously with killing the ARM7 and corrupting the bottom screen.
<br/>
<br/>
So now I have three characters working - with on-screen help and such - and both helicopter and eagle are animated, mine karts are trundling around correctly....the eagle is flapping it's wings when it's working hard - and steering with it's tail feathers too.   Press 'Y' to toggle between flying the 'pedalcopter guy' and the 'giant eagle gal'.
<br/>
<br/>
The guy with the jet pack is on the other team so you can't fly as him.
<br/>
<br/>
It's beginning to look cool!
<br/>
<br/>
<a href="http://www.sjbaker.org/tmp/hardball.nds" target="_blank">http://www.sjbaker.org/tmp/hardball.nds</a></span><span class="gensmall"><br/><br/>Last edited by 3D_geek on Sat Mar 31, 2007 9:19 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#123807 - 3D_geek - Sat Mar 31, 2007 9:15 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>memoni wrote:</b></span></td> </tr> <tr> <td class="quote">p.s. Do you happen to have any screenshots of your game?</td> </tr></table><span class="postbody">
<br/>
<br/>
I have two shots of the PC version running at DS screen resolution (approximately):
<br/>
<br/>
<a href="http://www.sjbaker.org/tmp/screenshot.gif" target="_blank">http://www.sjbaker.org/tmp/screenshot.gif</a>
<br/>
<a href="http://www.sjbaker.org/tmp/screenshot2.gif" target="_blank">http://www.sjbaker.org/tmp/screenshot2.gif</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
