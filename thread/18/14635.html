<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>DS Beginner : Writing to VRAM - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > DS Beginner : Writing to VRAM</h2>
<div id="posts">
<div class="post">
    <h4>#146660 - Tramboi - Fri Dec 07, 2007 12:03 pm</h4>
    <div class="postbody"><span class="postbody">Hi everybody,
<br/>
I'm trying to optimize a scaler that ends up writing to the VRAM like this:
<br/>
<br/>
.. computations
<br/>
STRH	r9, [r0],#2
<br/>
STRH	r10,[r0],#2
<br/>
STRH	r11,[r0],#2
<br/>
STRH	r12,[r0],#2
<br/>
<br/>
(I write 256 pixels per line, ie 64 iterations of this)
<br/>
<br/>
Now I have a few questions for you :)
<br/>
<br/>
1) Assuming a bit of swizzling before was free, is it faster to store 2 32bits instead of 4 16bits in the VRAM?
<br/>
<br/>
2) Assuming it is, we should have
<br/>
STR r9,[r0],#4
<br/>
STR r10,[r0],#4
<br/>
<br/>
would a STM be faster?
<br/>
STM 
<br/>
<br/>
3) Is it recommended to do all the computations in very fast memory (cached or TCM if I get it right) then DMA the result to VRAM?
<br/>
<br/>
Remarks:
<br/>
<br/>
From here:
<br/>
<a href="http://meraman.dip.jp/index.php?cmd=read&amp;page=M3DSS_GBATEK_NDS&amp;p=1#content_1_12" target="_blank">http://meraman.dip.jp/index.php?cmd=read&amp;page=M3DSS_GBATEK_NDS&amp;p=1#content_1_12</a>
<br/>
<br/>
I read these timings for VRAM::
<br/>
N32=5 S32=2 N16=4 S16=1
<br/>
<br/>
STR seems to cost 2*N cycles
<br/>
STM seems to cost (n-1)S+2N
<br/>
<br/>
Can I deduce that the first version costs 4 * (2 * N16) = 32 cycles ?
<br/>
Can I deduce the second version costs 2 * (2 * N32) = 20 cycles ?
<br/>
Can I deduce the STM version costs S32 + 2 * N32 = 12 cycles?
<br/>
<br/>
<br/>
Thanks in advance for clarifying all this, I'm trying to make sense of all the info I find on the Web and it can be overwhelming. I'm used to much faster CPUs with complex pipelines and prefetching! :)
<br/>
<br/>
Cheers,
<br/>
Tramb</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146671 - tepples - Fri Dec 07, 2007 1:46 pm</h4>
    <div class="postbody"><span class="postbody">My advice: Do it both ways and use a profiler to find which one's faster. The most quick-and-dirty profiler consists of writing to BG_PALETTE[0] before and after a function, which changes the width of a horizontal stripe across the background by an amount in proportion to the runtime of a function. The next simplest is one based on starting a CPU timer before a function and reading it at the end.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
