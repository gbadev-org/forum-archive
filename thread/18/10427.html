<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>malloc problem - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > malloc problem</h2>
<div id="posts">
<div class="post">
    <h4>#93371 - delfare - Tue Jul 18, 2006 8:52 pm</h4>
    <div class="postbody"><span class="postbody">hi,
<br/>
I have a problem with malloc : malloc return used memory(not NULL) and when I use the data, my game bug.
<br/>
<br/>
how can I solve this problem?
<br/>
<br/>
example :
<br/>
in my game, I have :
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
u16 *map1, *map2;
<br/>
map1 = (u16*)malloc(sizeof(u16)*256*192);
<br/>
map2 = (u16*)malloc(sizeof(u16)*256*192);
<br/>
int i;
<br/>
for(i=0;i&lt;256*192;i++)
<br/>
{
<br/>
        map1[i]=PA_RGB(31,31,31);
<br/>
        map2[i]=PA_RGB(31,31,31);
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
and it bug.
<br/>
if I delete this, it work fine.<br/>_________________<br/>If I speak badly, it's because I speak french and I am 15
<br/>
<br/>
PA 3d tutorial : <a href="http://delfare.pizz.biz" target="_blank">http://delfare.pizz.biz</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93496 - entilzha - Wed Jul 19, 2006 3:50 pm</h4>
    <div class="postbody"><span class="postbody">Hmm, I read somewhere else on the forum that malloc is broken in the latest release (r19) of devkitARM. The options given by Tepples were to downgrade to r18, or wait for r20. :)
<br/>
<br/>
<a href="http://forum.gbadev.org/viewtopic.php?t=10434" target="_blank">http://forum.gbadev.org/viewtopic.php?t=10434</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93500 - wintermute - Wed Jul 19, 2006 4:03 pm</h4>
    <div class="postbody"><span class="postbody">Please check your facts before posting misinformation.
<br/>
<br/>
There is a problem with malloc on <span style="font-weight: bold">gba</span> it works fine on other platforms.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93533 - delfare - Wed Jul 19, 2006 7:25 pm</h4>
    <div class="postbody"><span class="postbody">yes but what can I do?
<br/>
is there another memory allocator?
<br/>
<br/>
PS : I use devkitpro updater 1.3.1<br/>_________________<br/>If I speak badly, it's because I speak french and I am 15
<br/>
<br/>
PA 3d tutorial : <a href="http://delfare.pizz.biz" target="_blank">http://delfare.pizz.biz</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93558 - wintermute - Wed Jul 19, 2006 9:56 pm</h4>
    <div class="postbody"><span class="postbody">insufficient information for a meaningful answer.
<br/>
<br/>
Why are you allocating memory to use as a screen?
<br/>
<br/>
What does PA_RGB do?
<br/>
<br/>
What does "it bug" mean?
<br/>
<br/>
What are you doing with map1 and map2 later?<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93564 - sajiimori - Wed Jul 19, 2006 10:30 pm</h4>
    <div class="postbody"><span class="postbody">As entilzha mentioned, you can downgrade to r18.
<br/>
<br/>
You could also write your own allocator, but if you have to ask how, that's probably not the best option.  :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93566 - PeterM - Wed Jul 19, 2006 10:33 pm</h4>
    <div class="postbody"><span class="postbody">I think what Wintermute was getting at was that there's nothing wrong with malloc for DS, so the bug must be elsewhere.<br/>_________________<br/><a href="http://aaiiee.wordpress.com/" target="_blank">http://aaiiee.wordpress.com/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93576 - tepples - Wed Jul 19, 2006 11:25 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>entilzha wrote:</b></span></td> </tr> <tr> <td class="quote">Hmm, I read somewhere else on the forum that malloc is broken in the latest release (r19) of devkitARM.</td> </tr></table><span class="postbody">
<br/>
Did you read this in the GBA section? The GBA startup code and the Nintendo DS startup code, which set up the heap, have separate bugs.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93736 - wintermute - Thu Jul 20, 2006 10:52 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>delfare wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
What does "it bug" mean?
<br/>
</td> </tr></table><span class="postbody">
<br/>
the game stop
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
<br/>
I don't really see anything with that code that might cause the DS to freeze, if that's what you mean. Is there any chance that you're running close to memory limits and the ~200k allocated for your double buffer is pushing it close to the edge?<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93814 - entilzha - Fri Jul 21, 2006 12:36 pm</h4>
    <div class="postbody"><span class="postbody">wow, I'm totally sorry man.. Didn't mean to post misinformation. I didn't know the DS was free of this problem.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93923 - HyperHacker - Sat Jul 22, 2006 12:21 am</h4>
    <div class="postbody"><span class="postbody">So if I understand this correctly, when you call malloc() it returns a pointer to memory that's already in use? I had this problem in a Windows program just a few days ago. The problem was that I was moving buffers around using realloc() but still using the old pointers and thus writing into random areas of memory. Memory corruption bugs like this can be tricky bastards because the faulty code often doesn't fail, but causes some other function to misbehave somehow.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93957 - tepples - Sat Jul 22, 2006 2:30 am</h4>
    <div class="postbody"><span class="postbody">Which is part of why there's a push toward "safe" languages such as Java, Objective CAML, C#, C++/CLI, etc.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
