<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Help: text on image problem [solved] - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > Help: text on image problem [solved]</h2>
<div id="posts">
<div class="post">
    <h4>#163551 - Kayvon - Sat Oct 04, 2008 9:42 pm</h4>
    <div class="postbody"><span class="postbody">I've been lurking since about a week ago, when I first started programming on the DS. I'm an experienced coder and I'm almost done with a simple "Missile Command" homebrew, but I'm stuck.
<br/>
<br/>
I can't text over an image on the subscreen to work:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
int main()
<br/>
{
<br/>
   static const int DMA_CHANNEL = 3; // low priority DMA channel to background copy
<br/>
<br/>
   powerON(POWER_ALL);
<br/>
<br/>
   irqInit();
<br/>
   irqSet(IRQ_VBLANK, 0);
<br/>
<br/>
   vramSetBankC(VRAM_C_SUB_BG_0x06200000); // map bank C to sub screen background memory
<br/>
   videoSetModeSub(MODE_3_2D | DISPLAY_BG3_ACTIVE | DISPLAY_BG0_ACTIVE);
<br/>
   SUB_BG3_X0 = 0;         // X-Pos
<br/>
   SUB_BG3_Y0 = 0;         // Y-Pos
<br/>
   SUB_BG3_CR = BG_BMP16_256x256 | BG_BMP_BASE(0) | BG_PRIORITY(3);
<br/>
   SUB_BG3_XDX = 1 &lt;&lt; 8;
<br/>
   SUB_BG3_XDY = 0;
<br/>
   SUB_BG3_YDX = 0;
<br/>
   SUB_BG3_YDY = 1 &lt;&lt; 8;
<br/>
   SUB_BG3_CX = 0;
<br/>
   SUB_BG3_CY = 0;
<br/>
   dmaCopyHalfWords(DMA_CHANNEL,
<br/>
                     splashBitmap, // This variable is generated for us by grit.
<br/>
                     (uint16 *)BG_BMP_RAM_SUB(0), // address for sub background 3
<br/>
                     splashBitmapLen);
<br/>
<br/>
   BG_PALETTE_SUB[255] = RGB15(31,31,31);   // white font
<br/>
   SUB_BG0_CR = BG_MAP_BASE(2);
<br/>
   consoleInitDefault((u16*)SCREEN_BASE_BLOCK_SUB(2), (u16*)CHAR_BASE_BLOCK_SUB(0), 16);
<br/>
   iprintf("Testing...\n1, 2, 3!");
<br/>
<br/>
   while(1);
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
I can get the splash image to appear on the subscreen no problem. I can get normal text (helpful in debugging) without a problem. But I can't get the both to work at once.
<br/>
<br/>
Any help here is appreciated. I suspect I've done something wrong with the memory banks[/code]</span><span class="gensmall"><br/><br/>Last edited by Kayvon on Sun Oct 05, 2008 3:55 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#163554 - Maxxie - Sat Oct 04, 2008 10:14 pm</h4>
    <div class="postbody"><span class="postbody">The memory indexes you use for text and bmp background are overlapping:
<br/>
<br/>
SCREEN_BASE_BLOCK_SUB(2) and CHAR_BASE_BLOCK_SUB(0)
<br/>
<br/>
conflict with
<br/>
<br/>
BG_BMP_RAM_SUB(0)
<br/>
<br/>
If you write to the map/tiles of the text BG  (i.e. on console init) you are overwriting part of the image you have previously put there.
<br/>
Take a look at gbatek and/or the macro defines to check where those macros point to and how large they are. Then move them so that they do not overlap anymore.<br/>_________________<br/><a class="postlink" href="http://nintendods.desperate-programmers.com/doku.php?id=wireless_io_map" target="_blank">Trying  to bring more detail into understanding the wireless hardware</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163557 - silent_code - Sat Oct 04, 2008 11:24 pm</h4>
    <div class="postbody"><span class="postbody">Especially read up on the limitations and boundaries. One type's (map or character / tile memory) block size is 16kB, the other's is 4kB. So you can have maps and tiles parallel in memory, but they must not overlap! If you map data is small enough, you can make it overlap, though. Just be clever. :^)
<br/>
<br/>
Otherwise, I can just write, that i've answered that question a few times already. Please search the forum (you'll find examples, like text over a bezier curve etc.) or take a look at my VSD on my site. It even loads a custom font (which isn't that hard to do). :^)<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163560 - Kayvon - Sun Oct 05, 2008 12:06 am</h4>
    <div class="postbody"><span class="postbody">Curses! I usually pride myself on searching exhaustively before asking a question in a forum, so I'm rather embarrassed.
<br/>
<br/>
Thanks for the info. I'll read the various threads and post the new code when I fix it (so future readers with the same problem can see the solution).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163561 - Kayvon - Sun Oct 05, 2008 12:42 am</h4>
    <div class="postbody"><span class="postbody">The main problem was that I didn't understand what  SUB_BG3_CY was and did. I still don't, actually, so I need to research some more, unless someone wants to share. It seems to be a memory offset, telling how many bytes of memory to "ignore" before the background actually starts. So change the line above to:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   SUB_BG3_CY = (16*256)*2;</td> </tr></table><span class="postbody">
<br/>
<br/>
And, since the memory is stored in a different location, the BG_BMP_RAM_SUB(0) needs to bump up to a (1) to stay consistent:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   dmaCopyHalfWords(DMA_CHANNEL,
<br/>
                     splashBitmap, // This variable is generated for us by grit.
<br/>
                     (uint16 *)BG_BMP_RAM_SUB(1), // address for sub background 3
<br/>
                     splashBitmapLen);</td> </tr></table><span class="postbody">
<br/>
<br/>
Everything else works just grand. And now I'm late for an event, so I'll be wondering what CX and CY mean until I can research later.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163605 - Cearn - Mon Oct 06, 2008 12:57 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Kayvon wrote:</b></span></td> </tr> <tr> <td class="quote">The main problem was that I didn't understand what  SUB_BG3_CY was and did. I still don't, actually, so I need to research some more, unless someone wants to share. It seems to be a memory offset, telling how many bytes of memory to "ignore" before the background actually starts.</td> </tr></table><span class="postbody">
<br/>
<br/>
SUB_BG3_CY is one of the scrolling offsets for sub-BG 3. Basically, it CX and CY indicate at which map coordinates the viewport is. You can find what they do in <a class="postlink" href="http://nocash.emubase.de/gbatek.htm#lcdiobgrotationscaling" target="_blank">GBATek:BG rotscale</a> and <a class="postlink" href="http://www.coranac.com/tonc/text/affbg.htm" target="_blank">Tonc:affine BG</a> under the old names of REG_BG<span style="font-style: italic">n</span>X/Y.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
