<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>simple oamRotateScale question - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > simple oamRotateScale question</h2>
<div id="posts">
<div class="post">
    <h4>#172318 - radiodee1 - Sat Jan 30, 2010 2:18 pm</h4>
    <div class="postbody"><span class="postbody">I have this code, which I think should rotate a single sprite on the screen. The problem is that somehow it makes all the sprites on the screen rotate. What am I doing wrong? ( 'x' and 'y' are the x and y position of the sprite on the screen, and 'sprites[0].gfxPtr' is the pointer to the sprite's memory.)
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">oamSet(&amp;oamMain, 0, x, y, 0, 0, SpriteSize_16x16,     
<br/>
  SpriteColorFormat_16Color, sprites[0].gfxPtr, 0, false, false, false, false, false);
<br/>
  
<br/>
for(i = 0; i &lt; 32768; i = i + 1000) {
<br/>
  
<br/>
  oamRotateScale(&amp;oamMain, 0, i, (1 &lt;&lt; 8), (1&lt;&lt;8));
<br/>
  
<br/>
  swiWaitForVBlank();
<br/>
  oamUpdate(&amp;oamMain);
<br/>
<br/>
}</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172319 - Azenris - Sat Jan 30, 2010 4:13 pm</h4>
    <div class="postbody"><span class="postbody">Im not sure about the functions you used as I havnt used them. Dunno if this helps at all but rotation (i think) is done by rotating a rotation set, not an individual sprite.
<br/>
<br/>
There aer 32 rotation sets in total and when creating a sprite you specify which rotation set is belongs to. maybe you have placed all the sprites into the same set as the one your trying to rotate.
<br/>
<br/>
You can also instead of setting the rotset on the non-rotating ones you could just disable the bit to have them rotate
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">OBJ Attribute 0 (R/W)
<br/>
<br/>
  Bit   Expl.
<br/>
  0-7   Y-Coordinate           (0-255)
<br/>
  8     Rotation/Scaling Flag  (0=Off, 1=On)
<br/>
  When Rotation/Scaling used (Attribute 0, bit 8 set):
<br/>
    9     Double-Size Flag     (0=Normal, 1=Double)
<br/>
  When Rotation/Scaling not used (Attribute 0, bit 8 cleared):
<br/>
    9     OBJ Disable          (0=Normal, 1=Not displayed)
<br/>
  10-11 OBJ Mode  (0=Normal, 1=Semi-Transparent, 2=OBJ Window, 3=Prohibited)
<br/>
  12    OBJ Mosaic             (0=Off, 1=On)
<br/>
  13    Colors/Palettes        (0=16/16, 1=256/1)
<br/>
  14-15 OBJ Shape              (0=Square,1=Horizontal,2=Vertical,3=Prohibited)
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/><a class="postlink" href="http://sacredpotion.blogspot.com/" target="_blank"><span style="color: red">My Homebrew Games</span></a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172321 - SteveH - Sat Jan 30, 2010 7:02 pm</h4>
    <div class="postbody"><span class="postbody">To rotate a single sprite you need to set it's afflineIndex to a value of 0 - 31, if you are using affineIndex 0 as no rotation, then you should set the sprite that you want to rotate to another affineIndex number.
<br/>
<br/>
The definition of the oamSet function (copied from the libnds docs) is as follows, as you can see you need to set the tenth paramater to the value of the affine data that you want to use.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void    oamSet  (OamState  *oam, int id, int x, int y, int priority, int palette_alpha, SpriteSize  size, SpriteColorFormat  format, const void *gfxOffset, int affineIndex, bool  sizeDouble, bool  hide, bool  hflip, bool  vflip, bool  mosaic)</td> </tr></table><span class="postbody">
<br/>
<br/>
Your code snippet is correct, but what you want to do is something like this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
oamSet(&amp;oamMain, 0, 10, 10, 0, 0, SpriteSize_16x16,     
<br/>
  SpriteColorFormat_16Color, sprites[0].gfxPtr, 0, false, false, false, false, false);
<br/>
 
<br/>
oamSet(&amp;oamMain, 1, 50, 10, 0, 0, SpriteSize_16x16,     
<br/>
  SpriteColorFormat_16Color, sprites[0].gfxPtr, 1, false, false, false, false, false);
<br/>
 
<br/>
for(i = 0; i &lt; 32768; i = i + 1000) {
<br/>
 
<br/>
  oamRotateScale(&amp;oamMain, 1, i, (1 &lt;&lt; 8), (1&lt;&lt;8));
<br/>
 
<br/>
  swiWaitForVBlank();
<br/>
  oamUpdate(&amp;oamMain);
<br/>
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
The code above should rotate the second sprite and leave the first sprite alone.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172324 - radiodee1 - Sun Jan 31, 2010 12:05 am</h4>
    <div class="postbody"><span class="postbody">thanks. that's a great help.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
