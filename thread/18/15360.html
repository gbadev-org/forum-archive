<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Bitshift and colour simple question but difficult for me XD - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > Bitshift and colour simple question but difficult for me XD</h2>
<div id="posts">
<div class="post">
    <h4>#154142 - TheMagnitude - Fri Apr 11, 2008 10:21 pm</h4>
    <div class="postbody"><span class="postbody">Is there any reason why I shouldn't be able to do:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">long variable = 1 &lt;&lt; 15 /* It doesn't work for anything more than 14 and the calculations are not precise at 14 /*</td> </tr></table><span class="postbody">
<br/>
<br/>
Also is there another colour function like RGB15(31,31,31) but RGB255(255,255,255) so I can have greater colour precision (im writing directly to the framebuffer);</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#154143 - kusma - Fri Apr 11, 2008 10:32 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>TheMagnitude wrote:</b></span></td> </tr> <tr> <td class="quote">Is there any reason why I shouldn't be able to do:
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">long variable = 1 &lt;&lt; 15 /* It doesn't work for anything more than 14 and the calculations are not precise at 14 /*</td> </tr></table><span class="postbody">
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
Because 1 &lt;&lt; 15 is a value where only the 16th bit is set, and the DS only has 15 bit color depth.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Also is there another colour function like RGB15(31,31,31) but RGB255(255,255,255) so I can have greater colour precision (im writing directly to the framebuffer);</td> </tr></table><span class="postbody">
<br/>
No, the DS has (as said before) only 15 bits of color depth. That's 5 bits per component, and (1 &lt;&lt; 5) - 1 = 31, which is the highest allowed value per color component.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#154144 - TheMagnitude - Fri Apr 11, 2008 10:51 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>kusma wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>TheMagnitude wrote:</b></span></td> </tr> <tr> <td class="quote">Is there any reason why I shouldn't be able to do:
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">long variable = 1 &lt;&lt; 15 /* It doesn't work for anything more than 14 and the calculations are not precise at 14 /*</td> </tr></table><span class="postbody">
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
Because 1 &lt;&lt; 15 is a value where only the 16th bit is set, and the DS only has 15 bit color depth.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Also is there another colour function like RGB15(31,31,31) but RGB255(255,255,255) so I can have greater colour precision (im writing directly to the framebuffer);</td> </tr></table><span class="postbody">
<br/>
No, the DS has (as said before) only 15 bits of color depth. That's 5 bits per component, and (1 &lt;&lt; 5) - 1 = 31, which is the highest allowed value per color component.</span></td> </tr></table><span class="postbody">Thanks for replying, is there any way I can use the memory of the DS or a cache or something to work with 30 point fixed numbers i.e: 1 &lt;&lt; 30 or higher?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#154149 - kusma - Fri Apr 11, 2008 11:27 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>TheMagnitude wrote:</b></span></td> </tr> <tr> <td class="quote">Thanks for replying, is there any way I can use the memory of the DS or a cache or something to work with 30 point fixed numbers i.e: 1 &lt;&lt; 30 or higher?</td> </tr></table><span class="postbody">
<br/>
The LCD controller of the Nintendo DS can only output 15 bits per pixel. There's no way around that, and neither memory nor cache have anything to do with this. Of course, you can do internal calculations in higher precision than the output-precision if you're doing some complex rendering, but you must down-convert to 15 bit before displaying your image no matter what.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#154151 - strager - Fri Apr 11, 2008 11:52 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>TheMagnitude wrote:</b></span></td> </tr> <tr> <td class="quote">[...], is there any way I can use the memory of the DS or a cache or something to work with 30 point fixed numbers i.e: 1 &lt;&lt; 30 or higher?</td> </tr></table><span class="postbody">
<br/>
<br/>
Yes; you can use the `long long` type (s64/u64).  sgstair has a fixed multiply function designed for 4.60 fixed numbers in his <a class="postlink" href="http://opti.akkit.org/competition.php?id=5" target="_blank">Mandelbrot example program</a>.  Adding and subtracting should be simple, as with multiplying with an integer.  Division and square roots may be done using the <a class="postlink" href="http://nocash.emubase.de/gbatek.htm#dsmaths" target="_blank">math co-processor</a>.
<br/>
<br/>
As for your first question, GBATek may be able to help you with <a class="postlink" href="http://nocash.emubase.de/gbatek.htm#lcdvrambitmapbgmodes" target="_blank">colours on the GBA</a>.  DS colours use the previously unused bit 15 for opacity in some cases; set this to one if your bitmap does not appear.  Remember, when assigning a `long` expression to a `short` variable, the top 16 bits* are truncated.
<br/>
<br/>
<span style="font-style: italic">* On the GBA and NDS, where sizeof(long) == 4, sizeof(short) == 2, and CHAR_BITS == 8, this applies.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#154162 - tepples - Sat Apr 12, 2008 2:01 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>kusma wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>TheMagnitude wrote:</b></span></td> </tr> <tr> <td class="quote">Thanks for replying, is there any way I can use the memory of the DS or a cache or something to work with 30 point fixed numbers i.e: 1 &lt;&lt; 30 or higher?</td> </tr></table><span class="postbody">
<br/>
The LCD controller of the Nintendo DS can only output 15 bits per pixel. There's no way around that</span></td> </tr></table><span class="postbody">
<br/>
I know of a workaround. Later Sega Genesis games used it, and so do cheap LCD TVs that advertise "16 million" or "16.2 million" not "16.8 million" colors. You use spatial dithering to simulate an extra bit, and then you use flickering to simulate another. Games for TI-89 graphing calculators, which have 1-bit displays, simulate 4-level grayscale the same way. So you're still displaying 15-bit images, but the human eye makes them look 18- or even 21-bit.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#154173 - TheMagnitude - Sat Apr 12, 2008 7:30 am</h4>
    <div class="postbody"><span class="postbody">Wow thanks for the replies that was really useful!
<br/>
<br/>
When I use s64's it runs about 3 times as slow :(
<br/>
<br/>
How can someone make a function to multiply too fixed point numbers? Surely the way to do it is:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">fixed1*fixed2 &gt;&gt; precision</td> </tr></table><span class="postbody">
<br/>
<br/>
Ill check it out later anyhow
<br/>
<br/>
I think spatial dithering and flickering techniques are a bit too hard so Ill just leave the colour depth as it is.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#154177 - TwentySeven - Sat Apr 12, 2008 10:15 am</h4>
    <div class="postbody"><span class="postbody">You're right.
<br/>
<br/>
<br/>
X = 24.8
<br/>
Y = 24.8
<br/>
<br/>
X*Y = 24.16
<br/>
<br/>
so to correctly multiply X*Y you have to lop off 8 bits.
<br/>
<br/>
so if you know your final range is going to fit into an int32, you don't need to use int64's for all of it, just the actual calculation
<br/>
<br/>
int64 Z = X*Y;
<br/>
int32 Result = (int32)(Z &gt;&gt; 8);</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#154178 - PlagueSpark - Sat Apr 12, 2008 10:48 am</h4>
    <div class="postbody"><span class="postbody">In libnds there are ready-to-use some useful stuff for fixed point math
<br/>
Excpecialy in videoGL.h header file there macroses for multiply 16bit 4.12 integers and SIN[512] COS[512] tables that is very useful not just for 3d
<br/>
<br/>
If to believe the manual, DS also has the native accelerated div/mod functions
<br/>
<br/>
Here some define macroses examples for 16.16 s32 integers with no usage of 64bit integers
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define FPMUL(x,y)   ((((x)&gt;&gt;6)*((y)&gt;&gt;6))&gt;&gt;4)
<br/>
#define FPDIV(x,y)   ((((x)&lt;&lt;6)/((y)&gt;&gt;6))&gt;&gt;4)
<br/>
</td> </tr></table><span class="postbody">
<br/>
I got them from old tutorial for n-gage on flipcode.net</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
