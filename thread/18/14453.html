<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Problems with my Pong game(Download available) - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Problems with my Pong game(Download available)</h2>
<div id="posts">
<div class="post">
    <h4>#144533 - yellowstar - Sat Nov 03, 2007 3:40 pm</h4>
    <div class="postbody"><span class="postbody">This topic is a continuation about
<br/>
the issues with my wireless Pong game,
<br/>
started in the wireless topic.
<br/>
<br/>
Don't post about helping with
<br/>
this in the wireless topic.
<br/>
Instead, post here.</span><span class="gensmall"><br/><br/>Last edited by yellowstar on Mon Dec 24, 2007 10:24 pm; edited 5 times in total</span></div>    
</div>
<div class="post">
    <h4>#144536 - yellowstar - Sat Nov 03, 2007 3:57 pm</h4>
    <div class="postbody"><span class="postbody">The following quotes are posts
<br/>
about the original issues.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yellowstar wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
I am almost done with my Pong game. 
<br/>
All that's left is Wireless.(and bugs) 
<br/>
(By the way, scores are displayed in console 
<br/>
on sub screen, game on main. 
<br/>
Due to a problem with console not working 
<br/>
on main.) 
<br/>
(Will implement non-console scores later.) 
<br/>
<br/>
The opponet's bat 
<br/>
is choppy.(On the recieving DS.) 
<br/>
<br/>
Other things are out of sync, 
<br/>
but that's my problem. 
<br/>
(Only bat movement messages are sent 
<br/>
at the moment) 
<br/>
<br/>
EDIT: 
<br/>
I am using R 60. 
<br/>
Has the aforementioned problems 
<br/>
been resolved? 
<br/>
<br/>
EDIT2: 
<br/>
There are more problems. 
<br/>
<br/>
Sometimes, 
<br/>
the opponets bat(on the recieving DS) 
<br/>
would be behind. 
<br/>
It would still follow the wanted movement. 
<br/>
<br/>
In the worst case, 
<br/>
the opponets bat 
<br/>
wouldn't move at all. 
<br/>
<br/>
EDIT3: 
<br/>
Another problem: 
<br/>
<br/>
Sometimes there is some lag. 
<br/>
Both DSes,(at least I think it's both) 
<br/>
slow down. 
<br/>
The max is about one second. 
<br/>
<br/>
(By the way, 
<br/>
I got the scores in sync.) 
<br/>
(They don't get updated at exactly 
<br/>
the same moment.)
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>melw wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
You need to be prepared for choppy networking. It doesn't matter what the reason is. Even if the lobby library was 100% perfect, for example the users can be too much apart from each other or there's other traffic on the channel distracting the sent messages. 
<br/>
<br/>
To the actual question - how to achieve smooth gameplay in your case? There's a handful of options you can choose from: 
<br/>
<br/>
<br/>
- synchronize time between the DS's in the beginning and timestamp your messages. 
<br/>
- interpolate the movement between frames 
<br/>
- don't send data every frame, rather send when something happens (bat starts moving/stops, hits a ball, etc.), and also then send game parameters (bat speed, ball speed, ball direction), not just static values (bat/ball coordinates). this makes interpolating values a lot easier. in between you can sync the data just to be sure. 
<br/>
- draw stuff on screen with couple frames of lag compared to your actual gametime to allow the other end to catch up. 
<br/>
<br/>
<br/>
btw. I once did a Pong for Series 60 phones using Bluetooth (one of the most horrifyin coding experiences in my life :) That was the wonkiest networking I've dealt with, now doing things with the lobby lib life seems whole lot of easier...
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yellowstar wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
It's obvious I never did any networking stuff 
<br/>
before...(I read I few tutorials, 
<br/>
but I couldn't actually do them due to 
<br/>
no network and Dial-Up.) 
<br/>
<br/>
I'll try your suggestions melw, 
<br/>
and if those fail, 
<br/>
I guess I'll search gamedev and the Internet.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yellowstar wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Thanks melw. 
<br/>
Thanks to your second suggestion, 
<br/>
I have gotten the bats to 
<br/>
move smoothly now. 
<br/>
<br/>
Now, 
<br/>
I'm having troubles with scores 
<br/>
being out of sync. 
<br/>
(Hopefully I can figure it out. 
<br/>
If not, I'll try searching the Inet.)
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>MechaBouncer wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
That's certainly odd. I would think it would be simple enough to sync them up each time a player scored since you have to wait a little anyway. Is it something that alternates between players or is one keeping correct score consistently while the other side is not?
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Well, i guess he is playing a game on both DS and only correcting the positions on the other one. 
<br/>
<br/>
@Yellowstar, 
<br/>
Let the hoster control the game. Do not calculate misses/hits and thus points on both DSes.
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yellowstar wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
I think I fixed the out of sync scores. 
<br/>
(I can't be sure until I test it with somebody else) 
<br/>
<br/>
The way I am doing it at the moment, is this: 
<br/>
No messages for scoring are sent. 
<br/>
Instead, both systems decide 
<br/>
when a point is scored, 
<br/>
based on where the bats and ball are. 
<br/>
<br/>
This game is getting very 
<br/>
close to completion/release.(minus bugs and such) 
<br/>
<br/>
EDIT: 
<br/>
<br/>
@Mighty Max: 
<br/>
I was doing the latter... 
<br/>
I was having both systems 
<br/>
tell the other when it scored a point.
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yellowstar wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
The way I am doing it at the moment, is this:
<br/>
No messages for scoring are sent.
<br/>
Instead, both systems decide
<br/>
when a point is scored,
<br/>
based on where the bats and ball are.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Keep in mind that the ball's properties (position, direction, speed) and the bat's properties (position) are _never_ in complete sync. This setup will produce different results on both DSes by design on a real game (There will be the situation that one DS counts a score and on the other DS the ball was just catched)</span></td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yellowstar wrote:</b></span></td> </tr> <tr> <td class="quote">Well,
<br/>
that made the problem worse.(the score difference between
<br/>
the systems were large.)
<br/>
<br/>
Time to come
<br/>
up with a differen't mechism.</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>MechaBouncer wrote:</b></span></td> </tr> <tr> <td class="quote">Perhaps you could handle it that when the ball is travelling in one direction, the player it's travelling to is handling the ball mechanics and sending position and direction information to the other DS, then it flips when going the other direction. That way, the person having to return the ball doesn't get screwed by the offhand chance that the ball position wasn't synched well enough. Does that sound reasonable?</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yellowstar wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<span style="font-weight: bold">EDIT:</span>
<br/>
<br/>
@Mighty Max:
<br/>
I was doing the latter...
<br/>
I was having both systems
<br/>
tell the other when it scored a point.</td> </tr></table><span class="postbody">
<br/>
<br/>
You misunderstood me. Do NOT make both sides work the same. This will not work. There needs one instance that has the last word on all decisions. (It's just like persons, when they are both the same urge to have the last word, they will argue or going into a "whatever!" state ;) )
<br/>
<br/>
Have one and always the same DS counting the scores. Have the same DS deciding whether the ball was hit. Do not calculate the hit on the other DS for any other reason then to hide lag from the displaying (precalculation which is superseeded by the host)</span></td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144537 - Lick - Sat Nov 03, 2007 4:06 pm</h4>
    <div class="postbody"><span class="postbody">In your game, make a menu. The menu should at least have these 2 options:
<br/>
1) Host ad-hoc game
<br/>
2) Join ad-hoc game
<br/>
<br/>
When a player chooses to host, you run the server-code:
<br/>
- listen for connecting players 
<br/>
- keep track of server's own paddle
<br/>
- keep track of the ball (position and direction)
<br/>
- calculate collisions
<br/>
- keep track of the score
<br/>
- send updates to the client
<br/>
<br/>
When a player chooses to join, you run the client-code:
<br/>
- search for servers to join
<br/>
- keep track of client's own paddle
<br/>
- receive updates from the server (ball position/direction, server's paddle position and score)
<br/>
- send updates to the server (own paddle position)<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144538 - yellowstar - Sat Nov 03, 2007 4:16 pm</h4>
    <div class="postbody"><span class="postbody">Here is the new problems:
<br/>
<br/>
(I tried to debug this,
<br/>
but source unknown)
<br/>
(This is probably a bug
<br/>
in my code,
<br/>
but I can't find the cause.)
<br/>
<br/>
(I am trying to have only
<br/>
the host handle scoring,
<br/>
and have it tell the client whenever
<br/>
a score is made. The client dosen't decide
<br/>
by itself when a score is made,
<br/>
it relies on the host.)
<br/>
<br/>
On the client side,
<br/>
nothing seems to move.
<br/>
(On the host side,
<br/>
the client's bat is moving.)
<br/>
(I have found,
<br/>
that this is because Reset is
<br/>
being called ~15-27 times
<br/>
per second.)(may not be accurate due to inaccurate timer setup.)
<br/>
(Reset puts all the sprites back were they were,
<br/>
like at the start of the game.)
<br/>
<br/>
The new scoring problem:
<br/>
The client doesn't realize
<br/>
that the host made a goal,
<br/>
when it actually did.
<br/>
<br/>
However,
<br/>
when the client makes
<br/>
a goal,
<br/>
it's score,
<br/>
and the host's score,
<br/>
are updated on the client.
<br/>
<br/>
(Also,
<br/>
I have found that,
<br/>
for some reason,
<br/>
that the # of times
<br/>
the client passes the GetScoreMessage,
<br/>
is about the same as the # of calls to Reset.)
<br/>
(The host isn't sending an abnormal number
<br/>
of scoring messages.)
<br/>
(GetScoreMessage checks for scoring messages,
<br/>
and updates scoring, and then resets.)
<br/>
<br/>
<span style="font-weight: bold">EDIT:</span>
<br/>
By passing the GetScoreMessage function,
<br/>
I mean it thinks there is a
<br/>
score message, when there
<br/>
actually isn't any.
<br/>
<br/>
@Lick:
<br/>
I didn't see your post till now
<br/>
Lick, since you posted
<br/>
before I finished posting
<br/>
this post.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144552 - yellowstar - Sat Nov 03, 2007 7:32 pm</h4>
    <div class="postbody"><span class="postbody">Maybe its a bug in the lib...
<br/>
<br/>
I'm trying to force it to work via hacking.
<br/>
<br/>
I got it to stop resetting all the time,
<br/>
but I'm getting problems similar
<br/>
to the second problem.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144557 - Mighty Max - Sat Nov 03, 2007 8:58 pm</h4>
    <div class="postbody"><span class="postbody">What is the "second problem"?
<br/>
In which way would you think the lib is bugging (so i can have a look)?<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144620 - yellowstar - Sun Nov 04, 2007 9:56 pm</h4>
    <div class="postbody"><span class="postbody">The second problem:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yellowstar wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
The new scoring problem:
<br/>
The client doesn't realize
<br/>
that the host made a goal,
<br/>
when it actually did.
<br/>
<br/>
However,
<br/>
when the client makes
<br/>
a goal,
<br/>
it's score,
<br/>
and the host's score,
<br/>
are updated on the client.
<br/>
<br/>
(Also,
<br/>
I have found that,
<br/>
for some reason,
<br/>
that the # of times
<br/>
the client passes the GetScoreMessage,
<br/>
is about the same as the # of calls to Reset.)
<br/>
(The host isn't sending an abnormal number
<br/>
of scoring messages.)
<br/>
(GetScoreMessage checks for scoring messages,
<br/>
and updates scoring, and then resets.)
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I found problems on the host also.
<br/>
<br/>
I have found it is sending a max of 2 scoring messages
<br/>
per second.(All of which are for the client, except for one exception)
<br/>
It is constantly sending the score of the client,
<br/>
even though it isn't making that many scores.
<br/>
(These scores for the client are all the same,
<br/>
except for one message for when it scores.)
<br/>
<br/>
The only time when the host's score makes it through,
<br/>
is, when the client makes a goal.(the client's message makes it to)
<br/>
(The host's score gets updated when the client scores)
<br/>
<br/>
The problem could be this:
<br/>
The messages for the client's score
<br/>
could be clogging out the host score.(all of
<br/>
the time except when client scores)
<br/>
<br/>
I'm trying to fix it via hacking,
<br/>
but I haven't gotten it to work at the moment.
<br/>
<br/>
<br/>
As for the bug:(The number of messages per second
<br/>
is alot more than what the host sends.)
<br/>
This is a problem with the client.
<br/>
<br/>
Here's what's happening,
<br/>
based on the debug file:
<br/>
<br/>
Basicly,
<br/>
it's the same as the host,
<br/>
except on the recieving end.(Except,
<br/>
# of messages per second is about ~15-27)
<br/>
The client is recieving the above number
<br/>
of fake messages.(The only real ones are the messages
<br/>
for the client's score, for when it changes.)
<br/>
(Also, the scoring messages for the host.)
<br/>
(The scoring messages for the host are only sent once.)
<br/>
<br/>
<span style="font-weight: bold">EDIT:</span>
<br/>
It would be great, if,
<br/>
you, Mighty Max,
<br/>
would add functionality to
<br/>
the lib to capture packets on the current channel.
<br/>
(Only messages sent by the apps using the lib,
<br/>
not messages for the lib's internal stuff.)
<br/>
(Like telling other system's that this DS is here,
<br/>
rooms, ect.)
<br/>
(It would capture broadcasted packets,
<br/>
and packets not sent to it.)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144623 - Mighty Max - Sun Nov 04, 2007 10:56 pm</h4>
    <div class="postbody"><span class="postbody">Keep in mind that the callback might be triggered at any time out of system mode (IRQ) and that a SendTo might trigger a callback even if you are within an IRQ, as it is checking for data in the fifo.
<br/>
<br/>
If you are changing data you are already changing this is likely to make trouble (reentrancy)
<br/>
<br/>
Ive tried to provoke errors in the lib, but i was not able to get it to receive more messages as sent. If i came to a problem in the try to reproduce it, is that once the two DSes get out of sync in sent/gotten messages for a longer time (usually the gotten is a bit behind the sent amount), every no more ack-ed messaged are received at all. 
<br/>
<br/>
Just to make sure, you are not using one of the reserved stream IDs? (0x7FFF,0xFFFF)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<span style="font-weight: bold">EDIT:</span>
<br/>
It would be great, if,
<br/>
you, Mighty Max,
<br/>
would add functionality to
<br/>
the lib to capture packets on the current channel.
<br/>
(Only messages sent by the apps using the lib,
<br/>
not messages for the lib's internal stuff.)
<br/>
(Like telling other system's that this DS is here,
<br/>
rooms, ect.)
<br/>
(It would capture broadcasted packets,
<br/>
and packets not sent to it.)</td> </tr></table><span class="postbody">
<br/>
<br/>
I got to disappoint you. This is no option. 
<br/>
The DS hardware does - to the current knowledge - not trigger a receive event message that are not addressed for the DS by either a group address or the specific mac address. It would be a really dirty hack to either use allways broadcasts (and filter by SW) or to use forensic methods to capture dropped-after-receive packets out of the mac memory
<br/>
<br/>
You could use a ralink card, or an PCap compatible WLan adapter with wireshark to get the raws for all mac addresses. Set the filter "eth.type==0x08fe"<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144625 - yellowstar - Sun Nov 04, 2007 11:27 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<br/>
Just to make sure, you are not using one of the reserved stream IDs? (0x7FFF,0xFFFF)
<br/>
</td> </tr></table><span class="postbody">
<br/>
I'm only using stream ID 1.
<br/>
By the the way,
<br/>
what is total number of streams?(minus the reserved ones)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<span style="font-weight: bold">EDIT:</span>
<br/>
It would be great, if,
<br/>
you, Mighty Max,
<br/>
would add functionality to
<br/>
the lib to capture packets on the current channel.
<br/>
(Only messages sent by the apps using the lib,
<br/>
not messages for the lib's internal stuff.)
<br/>
(Like telling other system's that this DS is here,
<br/>
rooms, ect.)
<br/>
(It would capture broadcasted packets,
<br/>
and packets not sent to it.)</td> </tr></table><span class="postbody">
<br/>
<br/>
I got to disappoint you. This is no option. 
<br/>
The DS hardware does - to the current knowledge - not trigger a receive event message that are not addressed for the DS by either a group address or the specific mac address. It would be a really dirty hack to either use allways broadcasts (and filter by SW) or to use forensic methods to capture dropped-after-receive packets out of the mac memory
<br/>
<br/>
You could use a ralink card, or an PCap compatible WLan adapter with wireshark to get the raws for all mac addresses. Set the filter "eth.type==0x08fe"</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Unfortunatly,
<br/>
using a PC for this,
<br/>
for me, is not an option.(Don't have any wireless NICs
<br/>
in any of my PCs, and they are old)
<br/>
<br/>
I guess the only option would be
<br/>
to write a packet capture app,(based on Juglak's WMB Host)
<br/>
and have it only recognize user messages.
<br/>
<br/>
<span style="font-weight: bold">EDIT:</span>
<br/>
The only IRQs
<br/>
I am using,
<br/>
are, vblank and all timers.
<br/>
<br/>
Once the messages are sent,
<br/>
they are not changed.
<br/>
<br/>
<span style="font-weight: bold">EDIT2:</span>
<br/>
I have successfully hacked
<br/>
the host to only send the correct packets.(no fakes)
<br/>
(I'm still having the above problems with scoring)
<br/>
(clogging must not be the problem)
<br/>
<br/>
<span style="font-weight: bold">EDIT3:</span>
<br/>
The messaging is in sync.
<br/>
That is, neither DS is behind the other in
<br/>
sent/received messages.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144777 - yellowstar - Wed Nov 07, 2007 2:30 am</h4>
    <div class="postbody"><span class="postbody">Failed again.
<br/>
<br/>
I tried having the
<br/>
host send sync messages.
<br/>
<br/>
These messages are sent every 3rd vblank.
<br/>
These sync messages would
<br/>
contain the host's bat y pos,
<br/>
ball data, and the scores.
<br/>
(the bat and ball data isn't
<br/>
used on the client, since it wouldn't work right.)
<br/>
<br/>
The host sends the data(at least the scores)
<br/>
correctly.
<br/>
<br/>
But,
<br/>
the client dosen't coroperate.
<br/>
<br/>
The client's scores behave
<br/>
similar to before,
<br/>
except for a few new problems.(Sometimes
<br/>
it would update, but one of the scores would
<br/>
be really out of sync)(These times would be
<br/>
when the client makes a goal)
<br/>
<br/>
I tried hacking,
<br/>
but that didn't make much difference.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144812 - melw - Wed Nov 07, 2007 9:44 pm</h4>
    <div class="postbody"><span class="postbody">I was originally planning to spend this afternoon on something different, but oh well: <a class="postlink" href="http://dicewars.drunkencoders.com/pong.zip" target="_blank">pong nds+src</a>
<br/>
<br/>
It's bit sketchy and not very playable (as in fun to play) but works over here both in local game mode and in ad-hoc mode with the lobby library. No interpolations or any fancy stuff included, in other words flaky network will stutter the gameplay.
<br/>
<br/>
Mighty Max, I first tried using rooms but the room owner not receiving all the user callbacks makes things somewhat complicated... Hope to see the missing callbacks being added to the library at some point.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144813 - Mighty Max - Wed Nov 07, 2007 9:51 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>melw wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Mighty Max, I first tried using rooms but the room owner not receiving all the user callbacks makes things somewhat complicated... Hope to see the missing callbacks being added to the library at some point.</td> </tr></table><span class="postbody">
<br/>
<br/>
I know that there is much to do.
<br/>
I have to excuse my lack of updates recently. I am pretty busy preparing a scientific paper for a student symposium.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144815 - yellowstar - Wed Nov 07, 2007 10:17 pm</h4>
    <div class="postbody"><span class="postbody">That works pretty good, melw.(minus the minor problems)
<br/>
Much better than mine.
<br/>
I'll have a look at the source,
<br/>
and see if I can figure something out.
<br/>
<br/>
I'm using a timer.(For detecting when opponet quit,
<br/>
and for debugging.)
<br/>
(I was using 4, but I have changed it so
<br/>
only one is used.)(They all used to have the same settings)(minus
<br/>
the Timer IRQ Handler)
<br/>
<br/>
I'm having more problems.
<br/>
The client isn't detecting any scoring messages at all.
<br/>
Could Timers have been creating problems?
<br/>
(This problem might be due to a bug in my code)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144819 - melw - Wed Nov 07, 2007 10:41 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">I know that there is much to do.
<br/>
I have to excuse my lack of updates recently. I am pretty busy preparing a scientific paper for a student symposium.</td> </tr></table><span class="postbody">
<br/>
No worries. Complete room functionality is going to be good to have, but in the end LOBBY_SendToUser() is all we need...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yellowstar wrote:</b></span></td> </tr> <tr> <td class="quote">I'm having more problems. The client isn't detecting any scoring messages at all.</td> </tr></table><span class="postbody">
<br/>
Feel free to use the source I posted and modify it in any way you wish to. I chose to send scores at the same time with ball update messages (as when ball goes out of the borders, scoring is updated too). Don't see how one kind of messages wouldn't go through and then all the others would...
<br/>
<br/>
IRQ timers aren't necessarily needed for a game like this. Incrementing a frame counter in VBlank() gives you a running timer that is updated 60 times in a second. In other words, if timers are giving you too much headache - just don't use 'em. :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144825 - yellowstar - Thu Nov 08, 2007 12:31 am</h4>
    <div class="postbody"><span class="postbody">I tried to figure out that source, but...(it's hard
<br/>
to understand (and ect) in its current state)
<br/>
<br/>
As for timers,
<br/>
they aren't used for game-specific things.
<br/>
They are only used for debugging,
<br/>
and detecting when the opponet quit.
<br/>
<br/>
I tried disabling timers,
<br/>
but that didn't change anything.(that is, the scoring messages)
<br/>
<br/>
Maybe those room problems
<br/>
are what's causing my room problems.
<br/>
<br/>
<span style="font-weight: bold">EDIT:</span>
<br/>
This might not help,
<br/>
but here's this <a class="postlink" href="http://members.iglide.net/ticeandsons/yellowstar/yell_pong_bak.zip" target="_blank">game</a> in it's current state.
<br/>
(Don't worry, this is the correct archive)
<br/>
<br/>
<span style="font-weight: bold">EDIT2:</span>
<br/>
To compile this,
<br/>
you'll need to download my
<br/>
<a class="postlink" href="http://members.iglide.net/ticeandsons/yellowstar/yell_wireless.zip" target="_blank">lib.</a>(it makes using the wireless lib easier,
<br/>
among other things.)
<br/>
<br/>
(The debugging has been removed.)(at least at the time of writing this)
<br/>
(This means you can startup the game any way you want.)
<br/>
(Also, all most everything seems to be in sync,
<br/>
except scores.)
<br/>
(This means you should be able to play it normally.)
<br/>
(That is, play and watch the game on your own DS.)</span><span class="gensmall"><br/><br/>Last edited by yellowstar on Thu Nov 15, 2007 2:31 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#144854 - melw - Thu Nov 08, 2007 10:42 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yellowstar wrote:</b></span></td> </tr> <tr> <td class="quote">I tried to figure out that source, but...(it's hard
<br/>
to understand (and ect) in its current state)</td> </tr></table><span class="postbody">
<br/>
Heh.. and I tried to keep it short and simple. Not too many comments, though. Exchanging the user data during the game is done with two messages MESSAGE_GAME_UPDATE_BALL/BAT. Only server has control over the ball, but client also sends bat update messages. Bat accurancy is shifted by 2 (0...192*4) and the ball position values are shifted by 11 (0...256*2048 x 0...192*2048). As we're passing only unsigned chars in the lobby messages, these values are split into 2 and 3 char chunks while transferring. First char of the message is always the identifier (MESSAGE_GAME_...). These update messages are sent only when something happens (ball hits a wall, bat or goes out of the field, bat starts / stops movement).
<br/>
<br/>
Debugging tips: if you're not searching for crash bugs, printing on the sub screen has its advantages. What comes to your scoring messages problem - obviously you have a bug somewhere, nothing wrong with the lobby library.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145295 - yellowstar - Tue Nov 13, 2007 10:58 pm</h4>
    <div class="postbody"><span class="postbody">I think I found the solution.
<br/>
<br/>
For handling messages,
<br/>
it does not handle them in the stream callback.(that
<br/>
is, processing them, updating scores, bat pos, ect.)
<br/>
(Unlike melw's code)
<br/>
Instead, they are handled in vblank.(not
<br/>
the interrupt, in the infinite while loop.)
<br/>
<br/>
Since that is not in the callback,
<br/>
messages can be missed, and disorted.
<br/>
Once a certain message is detected,
<br/>
the callback could trigger before
<br/>
it finishes processing,
<br/>
and thus disorting the message.(the message would
<br/>
be actually the new, recieved message)
<br/>
<br/>
In theory,
<br/>
once I fix this,
<br/>
it should work.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145308 - Mighty Max - Wed Nov 14, 2007 12:03 am</h4>
    <div class="postbody"><span class="postbody">Yes, this is indeed very likely a major problem.
<br/>
The data passed to a callback is only valid within the callback.
<br/>
<br/>
Maybe i should add a more asynchonous method for retrieving data from a stream, with enlisting messages for which no callback is defined, with proper methods to check for and get these messages....<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145330 - yellowstar - Wed Nov 14, 2007 4:13 am</h4>
    <div class="postbody"><span class="postbody">I fixed it.
<br/>
<br/>
But, I am still having problems.
<br/>
<br/>
The host's score on the client is correct.
<br/>
But, the client's score on the client is wrong.
<br/>
<br/>
I'm trying to send sync messages(host)
<br/>
when the ball
<br/>
hits a wall.
<br/>
<br/>
These messages contain the score of the host and client.
<br/>
<br/>
I'm going to update the download, tomorrow.
<br/>
<br/>
<br/>
I have gotten my NiFi EEPROM
<br/>
app to work.(the reading and backup part)
<br/>
I just need to compare the output
<br/>
with the actual EEPROM to confirm the output is correct.
<br/>
<br/>
There is a bug in it that could
<br/>
cause crashes and corrupt output
<br/>
with EEPROM sizes larger than 512.(bytes)
<br/>
I'm still trying to figure out
<br/>
how to fix it.(I know what's the problem)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145414 - yellowstar - Thu Nov 15, 2007 2:37 am</h4>
    <div class="postbody"><span class="postbody">I have updated the download.(goto
<br/>
my download post for that.)
<br/>
(On the previous page, at the bottom of that page.)
<br/>
<br/>
Here's what's happening with the client's scores:
<br/>
It seems to be switching between 0 and 1.
<br/>
<br/>
It is never the correct score.
<br/>
<br/>
<br/>
My NiFi EEPROM app
<br/>
output isn't the same as another app I
<br/>
compared.(the example in the current nds examples)
<br/>
<br/>
Later,
<br/>
I'm going to test it with other EEPROM tools.
<br/>
<br/>
<span style="font-weight: bold">EDIT:</span>
<br/>
Another thing:
<br/>
When I disable sending sync messages,
<br/>
the scoring on the client is always zero.
<br/>
(This must mean there's a problem with
<br/>
the scoring messages.)
<br/>
<br/>
<br/>
And another thing:
<br/>
Recently I accidently
<br/>
deleted the code
<br/>
for rooms.(to update with my small lib.)
<br/>
I'll need to rewrite this code.(this time
<br/>
in my lib.)
<br/>
Maybe I'll get it working once I get to rewriting it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145473 - yellowstar - Fri Nov 16, 2007 3:30 am</h4>
    <div class="postbody"><span class="postbody">I tried adding code
<br/>
to disable and enable
<br/>
interrupts at the start and end
<br/>
of the send message functions,
<br/>
but that didn't do anything.
<br/>
<br/>
<br/>
I've been having troubles
<br/>
with one DS crashing.
<br/>
<br/>
This problem is caused by FAT,
<br/>
but I haven't figured out how to fix it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145553 - yellowstar - Sat Nov 17, 2007 8:21 pm</h4>
    <div class="postbody"><span class="postbody">I have gotten the client's scores on the client
<br/>
to work better.
<br/>
<br/>
Now,
<br/>
they switch between 0 and the real score.
<br/>
(I still haven't gotten FAT working again.)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145661 - yellowstar - Tue Nov 20, 2007 3:52 am</h4>
    <div class="postbody"><span class="postbody">I'm having strange problems with all my wireless programs.
<br/>
(Pong and NiFi EEPROM)
<br/>
<br/>
The host and client won't detect the other.
<br/>
This makes it impossible to do anything.
<br/>
(That means no gameplay, and no EEP transfers.)
<br/>
<br/>
This must be caused by some kind of
<br/>
bug in my small lib.
<br/>
<br/>
I have moved all init
<br/>
code to the lib.
<br/>
Also,
<br/>
I have moved all the cpp
<br/>
files to the source directory.(they
<br/>
were previously in the include dir for including.)
<br/>
<br/>
One of the above is probably causing the problem.
<br/>
(It's more likely it's the second thing.)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145725 - yellowstar - Wed Nov 21, 2007 12:44 am</h4>
    <div class="postbody"><span class="postbody">I have solved it.
<br/>
<br/>
The new init wireless function
<br/>
wasn't being called.(IPC_SetChannelCallback)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146039 - yellowstar - Tue Nov 27, 2007 10:49 pm</h4>
    <div class="postbody"><span class="postbody">I have decided to give up on this.
<br/>
<br/>
Even if I did get it working,
<br/>
it would probably be hacky still.
<br/>
(And a hacky pong game,
<br/>
for the first every pong game,
<br/>
would be very bad.)
<br/>
(And tutorials based on it would be bad too.)
<br/>
<br/>
I might keep working on this, however.
<br/>
<br/>
<br/>
I'm having problems with rooms, again.
<br/>
<br/>
It's crashing at a differen't point this time.
<br/>
But, one of the systems seems to still
<br/>
be crashing.
<br/>
<br/>
I might go back
<br/>
to working on my SFB game soon, again.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#147588 - yellowstar - Mon Dec 24, 2007 1:01 am</h4>
    <div class="postbody"><span class="postbody">It's nearly done!
<br/>
But, there's some minor sync issues,(bat positions)
<br/>
and a major crash bug.(Mysterious, I played it with one person,
<br/>
but something happened and problems started with the next person)
<br/>
<br/>
I was planning on getting it done and released by Xmas,
<br/>
but... I was going to release it today, but unless this problem is solved
<br/>
TODAY, it can't be solved and released before then.
<br/>
(I can't get much of anything done Xmas Eve)
<br/>
<br/>
It's the Red Screen(s) of Death.
<br/>
addr2line doesn't help.
<br/>
1st pc = FFFF7FFC 2nd = FFFF8004
<br/>
(1st is top-left value, other is bottom-right one with the other regs)
<br/>
<br/>
It worked pretty good with the first test. Good enough to be released if it weren't for this problem.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#147625 - yellowstar - Mon Dec 24, 2007 10:23 pm</h4>
    <div class="postbody"><span class="postbody">I solved it.
<br/>
<br/>
I had it going into an infinite loop, and that caused the Red Screens of Death.
<br/>
<br/>
You can download it <a class="postlink" href="http://members.iglide.net/ticeandsons/yellowstar/yell_pong.zip" target="_blank">here.</a>(src+bin)
<br/>
<br/>
The ball on the client side is out sync REALLY bad. But, it's still playable.
<br/>
<br/>
I wanted to add realistic 360 degree movement and collisions, but I'll try doing that later.
<br/>
(I'll use melw's code for that. I guess you wouldn't mind melw?)
<br/>
<br/>
I could use some help with getting it into sync better.
<br/>
(melw?)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#147702 - melw - Wed Dec 26, 2007 3:58 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yellowstar wrote:</b></span></td> </tr> <tr> <td class="quote">I wanted to add realistic 360 degree movement and collisions, but I'll try doing that later.
<br/>
(I'll use melw's code for that. I guess you wouldn't mind melw?)
<br/>
<br/>
I could use some help with getting it into sync better.
<br/>
(melw?)</td> </tr></table><span class="postbody">
<br/>
By all means. Even if the pong example in lobby lib svn isn't really properly finished either - the "realistic" ball movement is in fact rand(). One should rather calculate the ball angle depending on where the ball collides with the bat.
<br/>
<br/>
The sync messages are described few posts up, and it's essentially still the same (can't remember if there's any updates since 1? months ago).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#147780 - yellowstar - Thu Dec 27, 2007 9:40 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>melw wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yellowstar wrote:</b></span></td> </tr> <tr> <td class="quote">I wanted to add realistic 360 degree movement and collisions, but I'll try doing that later.
<br/>
(I'll use melw's code for that. I guess you wouldn't mind melw?)
<br/>
<br/>
I could use some help with getting it into sync better.
<br/>
(melw?)</td> </tr></table><span class="postbody">
<br/>
One should rather calculate the ball angle depending on where the ball collides with the bat.
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
That's what I wanted to do, but the math for that is complicated. How would do such a equation?(I have a PC tutorial with the PC equation)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
