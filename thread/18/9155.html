<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>[SOLVED] Q: Setting memory sections for some code & data - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > [SOLVED] Q: Setting memory sections for some code & data</h2>
<div id="posts">
<div class="post">
    <h4>#78491 - Mighty Max - Fri Apr 07, 2006 6:34 pm</h4>
    <div class="postbody"><span class="postbody">Hello,
<br/>
<br/>
i got a problem with some linker settings, and i have no idea on the solution, maybe someone might be able to help:
<br/>
<br/>
<br/>
I have some code and some data i want to be in a given mem region. I want them to be in the area 0x23B8000-23EFFFF. There is more then enough space for them there.
<br/>
<br/>
I did several things (to try) to get this working: I've defined a data and a code section at this address via the ds_arm9.ld. But when i assign anything, data or code into this section via "__attribute__ ((section("name")))" the thing won't start anymore. (HW keeps whitescreens, dualis crashes)
<br/>
<br/>
Even if i don't access any of this region, and do a simple "Hello World" nds. The .map file looks ok. The .nds is about 3.8MB, so it's building the arm9 bin as a monolithic block as expected.
<br/>
<br/>
<br/>
I tested if i could make a workaround. The nds is small enough to match complete in this region, so i modified the ewram start &amp; size in the ld. Again, the .map looked right, the nds was at 73kB (the same size as without any tries to get into this memory region)
<br/>
<br/>
But on the load it crashes again with whitescreens.
<br/>
<br/>
<br/>
Any help would be great.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"><br/><br/>Last edited by Mighty Max on Fri Apr 07, 2006 8:13 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#78503 - DekuTree64 - Fri Apr 07, 2006 7:19 pm</h4>
    <div class="postbody"><span class="postbody">Make sure ARM7 isn't using that address range at all.
<br/>
<br/>
For the ewram start change test, make sure your ndstool call puts the ARM9 start address at the right place.
<br/>
<br/>
Make sure there are no stacks or anything are defined to be in that area (in arm9.ld, stuff like __sp_irq = suchandsuch).
<br/>
<br/>
Make sure __eheap_end doesn't go past your area's address.
<br/>
<br/>
I've monkeyed my way around linkscripts to add new sections before without too much trouble, so don't give up too easily :)
<br/>
If you do create it as a section, base it off .itcm or something that's not contiguous with the main binary, so the actual data will be part of the main binary, even though the linking address is way at the end. Then add a line in crt0 to copy it to the real address like the other sections.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#78508 - Mighty Max - Fri Apr 07, 2006 7:51 pm</h4>
    <div class="postbody"><span class="postbody">Thanks DekuTree64,
<br/>
<br/>
the change of the NDS entrypoint did it. Stupid me *g*
<br/>
<br/>
Now i can finally finish the project :)<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#78555 - thundrestrike - Sat Apr 08, 2006 2:24 am</h4>
    <div class="postbody"><span class="postbody">what are you makeing, mightymax? im just curious thanks<br/>_________________<br/>popcorn</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#78609 - Mighty Max - Sat Apr 08, 2006 11:56 am</h4>
    <div class="postbody"><span class="postbody">It will need a lot of tweaking still before i can release info to it.
<br/>
I don't want to promise something i can't hold.
<br/>
<br/>
It looks good so far, tho.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
