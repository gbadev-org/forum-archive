<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Load Sprite data direct to correct address? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Load Sprite data direct to correct address?</h2>
<div id="posts">
<div class="post">
    <h4>#173876 - Pete_Lockwood - Thu May 06, 2010 1:34 am</h4>
    <div class="postbody"><span class="postbody">Maybe a dumb question but I won't know without asking..
<br/>
<br/>
Got some sprite data, currently it's getting loaded into memory somewhere then copied to SPRITE_GFX[]
<br/>
<br/>
Is it possible to rig the linker to direct the DS to load this particular lump of data directly into SPRITE_GFX and skip the copying (plus save having a redundant copy of the data in memory)?<br/>_________________<br/>It's not an illusion, it just looks like one.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#173878 - headspin - Thu May 06, 2010 6:28 am</h4>
    <div class="postbody"><span class="postbody">If you use DMA to copy the data it will be very fast anyway. There is also the benefit that you can DMA data to a single sprite to animate it thus saving precious OAM space for more sprites.<br/>_________________<br/><a class="postlink" href="http://headsoft.com.au/index.php?category=warhawk" target="_blank">Warhawk DS</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=mmll" target="_blank">Manic Miner: The Lost Levels</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=tdg" target="_blank">The Detective Game</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#173880 - Pete_Lockwood - Thu May 06, 2010 11:18 am</h4>
    <div class="postbody"><span class="postbody">It's not a question of speed and there are no animations.  It's just a waste that the same sprite data is in 2 locations in memory, that's all.<br/>_________________<br/>It's not an illusion, it just looks like one.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#173882 - sverx - Thu May 06, 2010 11:57 am</h4>
    <div class="postbody"><span class="postbody">You mean you want that resource (you've got in your NDS file) loaded directly into VRAM without loading it to Main RAM? I don't think it's possibile, but I'll be happy to be wrong :D
<br/>
<br/>
(mmm... using a filesystem you can load data directly to a VRAM bank...)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#173884 - Pete_Lockwood - Thu May 06, 2010 1:10 pm</h4>
    <div class="postbody"><span class="postbody">Yes, that's what I mean.  Filesystem means you're distributing multiple files.<br/>_________________<br/>It's not an illusion, it just looks like one.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#173886 - elhobbs - Thu May 06, 2010 1:39 pm</h4>
    <div class="postbody"><span class="postbody">I took a look at the ds_arm9.ld link script and the ds_arm9_crt0.s. It looks like in the case of code in the itcm section that it is put in main memory ewram section during compile and then the startup code in ds_arm9_crt0.s moves it to the itcm region. so I do not think that the linker can help remove the extra copy.
<br/>
<br/>
perhaps you could use the memory for something else after the sprites are loaded?
<br/>
<br/>
with libfat you definitely use multiple files. I thought filesystem appended the files directly to the nds file so that everything was self contained. I think it relies on argv support in the loader to get at the file system which the loader ignores.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#173887 - sverx - Thu May 06, 2010 3:15 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Pete_Lockwood wrote:</b></span></td> </tr> <tr> <td class="quote">Filesystem means you're distributing multiple files.</td> </tr></table><span class="postbody">
<br/>
<br/>
Not, if you put the filesystem into the NDS file. Even if it is never a good idea, there are lots of problems and incompatibility.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#173891 - vuurrobin - Thu May 06, 2010 9:21 pm</h4>
    <div class="postbody"><span class="postbody">IIRC, the entire nds file minus (a part of) the header and the embedded filesystem gets copied to the main ram (thus limiting it to 4mb) by the loader, before it gets copied to other parts and started. so I doubt it would be possible without using a custom loader (or even with one).
<br/>
<br/>
also keep in mind that the loader needs to be stored somewhere during loading. thats useally in vram...
<br/>
<br/>
<br/>
if memory is a problem, then use the embedded filesystem with libfilesystem for readonly data like images.<br/>_________________<br/>my blog:
<br/>
<a href="http://vuurrobin.100webcustomers.com/" target="_blank">http://vuurrobin.100webcustomers.com/</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
