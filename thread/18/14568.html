<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Using capture to create double polygon potential at 30FPS? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Using capture to create double polygon potential at 30FPS?</h2>
<div id="posts">
<div class="post">
    <h4>#145814 - DiscoStew - Thu Nov 22, 2007 11:16 pm</h4>
    <div class="postbody"><span class="postbody">It is just a thought that came to me the other day, but using the capture method used in allowing 3D on both screens, couldn't that also be a way to double the polygons on a single screen? Sort everything to get rendered so everything in the back portion gets captured, and render the remaining which  would be the front portion on the 3D layer, and the captured layer displayed behind it.
<br/>
<br/>
Now, I know there are potential problems associated with this, such as anything rendered going through the boundary of the front and back portion, but in circumstances where that isn't a problem, couldn't it work?<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145815 - NeX - Thu Nov 22, 2007 11:18 pm</h4>
    <div class="postbody"><span class="postbody">Yes, and I can imagine it being used on fighting games such as Soul Calibur DS...<br/>_________________<br/><a class="postlink" href="http://www.mediafire.com/?cuyb10fzdz2" target="_blank">Strummer</a> or <a class="postlink" href="http://www.mediafire.com/?71zxcztscix" target="_blank">Drummer?</a>.  
<br/>
Or maybe you would rather play with sand? <a class="postlink" href="http://www.mediafire.com/?a05z5wmdvxm" target="_blank">Sandscape is for you in that case.</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145832 - jetboy - Fri Nov 23, 2007 1:35 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>DiscoStew wrote:</b></span></td> </tr> <tr> <td class="quote">Now, I know there are potential problems associated with this, such as anything rendered going through the boundary of the front and back portion, but in circumstances where that isn't a problem, couldn't it work?</td> </tr></table><span class="postbody">
<br/>
<br/>
Not only that would work, but itsd used in amy comercial games. Lets get Nintendogs for example. Background is rendered in one pass, while dogs and toys are rendered in the other.<br/>_________________<br/>Colors! gallery -&gt; <a href="http://colors.collectingsmiles.com" target="_blank">http://colors.collectingsmiles.com</a>
<br/>
Any questions? Try <a href="http://colors.collectingsmiles.com/faq.php" target="_blank">http://colors.collectingsmiles.com/faq.php</a> first, or official forums <a href="http://forum.brombra.net" target="_blank">http://forum.brombra.net</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145833 - a128 - Fri Nov 23, 2007 2:58 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>jetboy wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
 Lets get Nintendogs for example. Background is rendered in one pass, while dogs and toys are rendered in the other.</td> </tr></table><span class="postbody">
<br/>
Why you think this game uses this technique?
<br/>
Just because the dogs does not look like low-poly models ?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145834 - simonjhall - Fri Nov 23, 2007 3:06 pm</h4>
    <div class="postbody"><span class="postbody">You can only do front-back compositing, right? You don't get any Z out do you? It's be nice to be able to render half a scene, capture everything (including depth) and restarting rendering.<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145835 - Mighty Max - Fri Nov 23, 2007 3:35 pm</h4>
    <div class="postbody"><span class="postbody">Well i could think of a complete z-aware (5 bit) method to rendering the double amount of polygons and vertices in 4 passes (15fps)
<br/>
<br/>
- Split the scene into two randomly chosen partitions (A,B)
<br/>
- render and capture A as is
<br/>
- render and capture A with no lighting on, fog enabled in white , all colors set to blac
<br/>
- render and capture B as is
<br/>
- render and capture B with no lighting on, fog enabled in white , all colors set to blac
<br/>
- merge the two full color images, chose source of each pixel by the "whiteness" of the fog (=depth of the pixel)
<br/>
<br/>
While it is possible, it is very slow and memory consuming (needs to store the 4x the screen in wram, and at least once - the last completed - to be displyed while rendering in the background in vram). So beside of a demo to render more polygons, i don't see much use :D<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145836 - DiscoStew - Fri Nov 23, 2007 3:48 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">Well i could think of a complete z-aware (5 bit) method to rendering the double amount of polygons and vertices in 4 passes (15fps)
<br/>
<br/>
- Split the scene into two randomly chosen partitions (A,B)
<br/>
- render and capture A as is
<br/>
- render and capture A with no lighting on, fog enabled in white , all colors set to blac
<br/>
- render and capture B as is
<br/>
- render and capture B with no lighting on, fog enabled in white , all colors set to blac
<br/>
- merge the two full color images, chose source of each pixel by the "whiteness" of the fog (=depth of the pixel)
<br/>
<br/>
While it is possible, it is very slow and memory consuming (needs to store the 4x the screen in wram, and at least once - the last completed - to be displyed while rendering in the background in vram). So beside of a demo to render more polygons, i don't see much use :D</td> </tr></table><span class="postbody">
<br/>
<br/>
I thought I read up in the GBATEK about the rear plane using 2 bitmaps, one that had the image data, and one that had the depth data. Then again, if I read correctly, using that specific method also locks out the VRAM from using textures. I could be wrong though. Maybe it only locks out banks 2 and 3.<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145837 - Mighty Max - Fri Nov 23, 2007 3:55 pm</h4>
    <div class="postbody"><span class="postbody">Oh, ok this info was new to me, so you can drop the manual z-compare&amp;source selection, so only 3 passes needed: 
<br/>
<br/>
- rendering A full color (A.colors)
<br/>
- rendering A in order to receive a depthmap (A.depth)
<br/>
- rendering B with A.colors and A.depth set in the rear pane
<br/>
<br/>
The loss of texture memory can partly be recovered again, by splitting the scene by textures, so each scene partition does not need the full set of textures.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145860 - tepples - Sat Nov 24, 2007 12:38 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">The loss of texture memory can partly be recovered again, by splitting the scene by textures, so each scene partition does not need the full set of textures.</td> </tr></table><span class="postbody">
<br/>
But how much texture data can you copy to the VRAM during a single vblank? If I recall correctly, it's like the NES or 8-bit Game Boy where you get a narrow time window, not like the GBA or DS 2D where you get long enough for it not to matter.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145862 - Mighty Max - Sat Nov 24, 2007 1:03 am</h4>
    <div class="postbody"><span class="postbody">Well there is a pass which only uses black triangles to calculate z-values, allowing you to access the texture mem.
<br/>
<br/>
Alternating A und B passes, reduces the amount of texture exchanges:
<br/>
<br/>
Render A -&gt; Render Z-Buffer &amp; exchange textures -&gt; Render B (complete Frame 1)
<br/>
Render B -&gt; Render Z-Buffer &amp; exchange textures -&gt; Render A (complete Frame 2)<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145889 - M3d10n - Sat Nov 24, 2007 11:05 pm</h4>
    <div class="postbody"><span class="postbody">Just change the near and far clip planes for each pass and turn on the clipping. You won't need to care about depth that way, the trade off being you'll have a few extra polygons on geometry crossing the boundaries.
<br/>
<br/>
Also, while you can upload your own z-buffer from VRAM, there seems to be no way to <span style="font-weight: bold">read </span>the Z-buffer, because there isn't one. 
<br/>
<br/>
Well, actually there is one, but it's dimensions are 256 x 1 and it's re-used for each scanline.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145891 - Mighty Max - Sat Nov 24, 2007 11:32 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>M3d10n wrote:</b></span></td> </tr> <tr> <td class="quote">Just change the near and far clip planes for each pass and turn on the clipping. You won't need to care about depth that way, the trade off being you'll have a few extra polygons on geometry crossing the boundaries.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
It's indeed another great method, however this is very scene dependend, as you need some way to determinate a good cutting plane. Otherwise you might end up with hundrets of splitted polygons, or  possibly a cut that seperates only few polygons from the whole.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Also, while you can upload your own z-buffer from VRAM, there seems to be no way to <span style="font-weight: bold">read </span>the Z-buffer, because there isn't one. 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
While it is true as in the form of a buffer, it isn't for the z-values. That is why i suggested the fog method: Fog-"Density is linear interpolated for pixels that are between two Density depth boundaries." (<a class="postlink" href="http://nocash.emubase.de/gbatek.htm#ds3dtoonedgefog" target="_blank">gbatek</a>)<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145942 - nce - Mon Nov 26, 2007 1:01 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">  Fog-"Density is linear interpolated for pixels that are between two Density depth boundaries." (<a class="postlink" href="http://nocash.emubase.de/gbatek.htm#ds3dtoonedgefog" target="_blank">gbatek</a>)</td> </tr></table><span class="postbody">
<br/>
<br/>
Only probleme is the z plane that you can define is not a linear Z 
<br/>
<br/>
When I did some test to render a scene in 3dsmax and use it, I had to wrote my z buffer as : 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
local color =  pix.zdepth  -- the z depht of my pixel ( in linear )
<br/>
local far = 40960.0
<br/>
local near = 4096.0
<br/>
color = ((far+near)/(far-near)) + ( (1.0/color) * ((-2 * far * near)/(far-near)) )
<br/>
color =  ( color + 1.0 ) / 2.0  -- -1 1 to 0 1
<br/>
<br/>
//because the depth map is saved in 14 bit and not in 24 you have to convert it
<br/>
<br/>
--write data
<br/>
color *= 16777215.0  --24bit
<br/>
--bring back to 14bit
<br/>
color *= 32768.0
<br/>
color -= 511.0
<br/>
color /= ( 32768.0*512.0 ) + 511.0
<br/>
WriteShort file ( ( color ) as Integer)</td> </tr></table><span class="postbody">
<br/>
<br/>
of course your far and near have to relefect the one you used when setting your projection matrix.
<br/>
<br/>
and if the convertion from 24 to 14 looks strange it's because of the gbatek doc ( look at the rear plane data ) :
<br/>
<br/>
The 15bit Depth is expanded to 24bit as "X=(X*200h)+((X+1)/8000h)*1FFh".<br/>_________________<br/>-jerome-</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145953 - a128 - Mon Nov 26, 2007 9:14 am</h4>
    <div class="postbody"><span class="postbody">Could someone post a demo of the technique?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145955 - Mighty Max - Mon Nov 26, 2007 9:35 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>nce wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">  Fog-"Density is linear interpolated for pixels that are between two Density depth boundaries." (<a class="postlink" href="http://nocash.emubase.de/gbatek.htm#ds3dtoonedgefog" target="_blank">gbatek</a>)</td> </tr></table><span class="postbody">
<br/>
<br/>
Only probleme is the z plane that you can define is not a linear Z 
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
<br/>
This isn't any problem at all
<br/>
I am not recreating a z value by linear means, but i am mapping the z by linear means.
<br/>
<br/>
And if the DS caclulates the fog as Density = a + b*z, with a beeing the offset and b the scaling, z can be recovered by z = (Density - a) / b . As you see the function that creates z isn't needed here. So you can choose a logarithmic scale, a look-up tabel or even randomly setting z as the base z-function.
<br/>
<br/>
If you choose the fog setup clever so that a becomes 0, b becomes 1, anything that is left is Density = 0 + 1*z = z . Done.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>a128 wrote:</b></span></td> </tr> <tr> <td class="quote">Could someone post a demo of the technique?</td> </tr></table><span class="postbody">
<br/>
<br/>
If noone has done it by next weeks Wednesday, i'll do it. For now, i have some work for the campus left i desperately try to hide from, but can't anymore.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146140 - RickA - Thu Nov 29, 2007 4:08 pm</h4>
    <div class="postbody"><span class="postbody">What we did when we were playing around with it was splitting the scene in left/right parts rather than front/back. Then you wouldn't need do keep the depthbuffer around as you don't need it again. Naturally this will cost you some triangles, and possibly interpolation artifacts on the boundary where the polygons are clipped.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146195 - S7ARBVCK - Fri Nov 30, 2007 10:45 am</h4>
    <div class="postbody"><span class="postbody">Sorry - am I missing something here? If your scene is rendered back to front, you can just render 2000 poly's, grab the scene, blit it as a background and render the forward half of the scene over the top of this and it'll look fine, surely?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146205 - tepples - Fri Nov 30, 2007 1:47 pm</h4>
    <div class="postbody"><span class="postbody">The front/back technique can be yours <span style="font-style: italic">if</span> the price is right, but it's not always easy. The trouble comes when you have a camera below the ceiling, which tends to rotate more than a camera that's positioned high above the scene. After numerous camera rotations, it is often difficult to find the best boundary to split the scene so that the back half comes closest to 2000 polygons without going over and without drawing anything that should be in the front half.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146207 - Mighty Max - Fri Nov 30, 2007 2:29 pm</h4>
    <div class="postbody"><span class="postbody">Front to back rendering works perfectly for static scenes (walking through the BSP)
<br/>
<br/>
If you include dynamic elements you'd need dynamic resorting and splitting of the polygons, which is very heavy on calculations. If you can't afford it (i.e. because there is no FPU) you have to maintain the z-informations on already drawn pixels.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
