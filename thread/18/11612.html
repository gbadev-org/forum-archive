<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>n00b topic - how to display a sprite on the sub screen - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > n00b topic - how to display a sprite on the sub screen</h2>
<div id="posts">
<div class="post">
    <h4>#108006 - djmcbell - Sat Nov 04, 2006 12:46 am</h4>
    <div class="postbody"><span class="postbody">Yep, I'm willing to bet you've had absolutely *LOADS* of these, but here we are again. I've been using the Patatersoft tutorial, which assures me I should have a sprite up and going on the bottom screen. Which would be nice and dandy, except there isn't. It displays on the top (and my modified version below displays nothing on top, as expected, but nothing on bottom), but how do I display it on the bottom instead?
<br/>
<br/>
I'm just using a ball sprite (I'm trying to get up and running by creating my own little vertical Pong demo, but that's by the by) so here's the important code -
<br/>
<br/>
updateOAM - I know I should be writing to OAM_SUB, but I don't know the settings
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">//Update the OAM - OAM_SUB
<br/>
void updateOAM(SpriteEntry * spriteEntry)
<br/>
{
<br/>
   DC_FlushAll();
<br/>
   dmaCopy(spriteEntry, OAM, 128 * sizeof(SpriteEntry));
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
InitVideo - I've changed a few things on the subscreen, I don't think it should make a different here
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void initVideo()
<br/>
{
<br/>
   /*map vram to display a bg on the main and sub screen and give us lots
<br/>
   of sprites*/
<br/>
   vramSetMainBanks( //map A and B to main background memory
<br/>
               //this gives us 256KB which is a healthy amount for
<br/>
               // 16-bit gfx
<br/>
               VRAM_A_MAIN_BG_0x6000000,
<br/>
               VRAM_B_MAIN_BG_0x6020000,
<br/>
               //map C to sub background memory
<br/>
               VRAM_C_SUB_BG_0x6200000,
<br/>
               //map D to LCD free space
<br/>
               VRAM_D_LCD);
<br/>
   //map a bank for use with sprites
<br/>
   vramSetBankE(VRAM_E_MAIN_SPRITE);
<br/>
   //mapping E to main sprites gives us 64k for sprites
<br/>
   //(64k is the max space that 1024 tiles take up in 256 color mode)
<br/>
   //set the video mode on the main screen
<br/>
   videoSetMode( MODE_5_2D | //set the graphics mode to Mode 5
<br/>
            DISPLAY_SPR_ACTIVE | //turn on sprites
<br/>
            DISPLAY_BG3_ACTIVE | //turn on background 3
<br/>
            DISPLAY_SPR_1D); //this is used when in tile mode
<br/>
   //set the video mode on the sub screen
<br/>
   videoSetModeSub(MODE_5_2D | 
<br/>
            DISPLAY_SPR_ACTIVE |
<br/>
            DISPLAY_BG3_ACTIVE |
<br/>
            DISPLAY_SPR_1D);
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
And our initSprites itself - again, changed the sprite so that it *should* go into the submemory
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void initSprites(SpriteEntry * spriteEntry, SpriteRotation * spriteRotation)
<br/>
{
<br/>
   //init OAM
<br/>
   initOAM(spriteEntry, spriteRotation);
<br/>
   ballx = SCREEN_WIDTH/2 - 64;
<br/>
   bally = SCREEN_HEIGHT/2 - 64;
<br/>
   //create the ball sprite
<br/>
   int ballGfxID = 64;
<br/>
   spriteEntry[0].attribute[0] = ATTR0_COLOR_256 |
<br/>
                     ATTR0_ROTSCALE_DOUBLE | //able to rotscale
<br/>
                     bally;
<br/>
   spriteEntry[0].attribute[1] = ATTR1_ROTDATA(0) |
<br/>
                     ATTR1_SIZE_64 | //size 64x64
<br/>
                     ballx;
<br/>
   spriteEntry[0].attribute[2] = ballGfxID;
<br/>
   //set initial rotation attributes
<br/>
   rotateSprite(&amp;spriteRotation[0], 0);
<br/>
   //copy in the sprite palettes
<br/>
   dmaCopy(ballpalette_bin, //from address
<br/>
      (uint16 *)SPRITE_PALETTE_SUB, //to address
<br/>
      ballpalette_bin_size); //size of data to copy
<br/>
   //copy the sprite graphics in obj graphics mem
<br/>
   dmaCopy(balldata_bin, //from address
<br/>
      &amp;SPRITE_GFX_SUB[ballGfxID * 16], //to address
<br/>
      balldata_bin_size); //size of data to copy
<br/>
   //update the OAM
<br/>
   updateOAM(spriteEntry);
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
I've been doing some GBA coding (quite enjoying that) but really want to get into DS coding, so any quick help here would be appreciated.[/code]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#108009 - Lick - Sat Nov 04, 2006 12:57 am</h4>
    <div class="postbody"><span class="postbody">You need to reserve some VRAM for the VRAM_x_SUB_SPRITE.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void updateOAM_SUB(SpriteEntry * spriteEntry)
<br/>
{
<br/>
   DC_FlushAll();
<br/>
   dmaCopy(spriteEntry, OAM_SUB, 128 * sizeof(SpriteEntry));
<br/>
}</td> </tr></table><span class="postbody"><br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#108035 - djmcbell - Sat Nov 04, 2006 5:59 pm</h4>
    <div class="postbody"><span class="postbody">Thanks Lick, but unfortunately this is a case of "been there, done that".
<br/>
<br/>
I have tried what you said, and that's not working. I have no doubt that it's reserving the memory as it's supposed to, but it doesn't appear to show up.
<br/>
<br/>
If it helps, I'm using dualis as my emulator to try it with.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#108046 - thegamefreak0134 - Sat Nov 04, 2006 7:47 pm</h4>
    <div class="postbody"><span class="postbody">Have you tried testing on real hardware? I've heard lots of issues with the emulators not liking the whole screen swap thing at all.<br/>_________________<br/>What if the hokey-pokey really is what it's all about?
<br/>
<br/>
[url=http:/www.darknovagames.com/index.php?action=recruit&amp;clanid=1]Support Zeta on DarkNova![/url]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#108144 - djmcbell - Sun Nov 05, 2006 10:33 pm</h4>
    <div class="postbody"><span class="postbody">Well, that was annoying but I got it. Mapped sub-sprites to bank D (did a Google search on sprite banks) and it worked. So my sprite was correct, I just didn't have them going anywhere.
<br/>
<br/>
Thanks for all the help anyhow guys. No, I don't have anything to test it on (I do have a DS with a 256mb EFA linker, but no PassMe1 device yet - I've checked and that's the one I'd need). Only just getting started though at the minute.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#108146 - Lick - Sun Nov 05, 2006 10:41 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lick wrote:</b></span></td> </tr> <tr> <td class="quote">You need to reserve some VRAM for the VRAM_x_SUB_SPRITE.</td> </tr></table><span class="postbody">
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>djmcbell wrote:</b></span></td> </tr> <tr> <td class="quote">Well, that was annoying but I got it. Mapped sub-sprites to bank D (did a Google search on sprite banks) and it worked. So my sprite was correct, I just didn't have them going anywhere.</td> </tr></table><span class="postbody">
<br/>
So I was right. =/<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#108340 - djmcbell - Tue Nov 07, 2006 9:53 pm</h4>
    <div class="postbody"><span class="postbody">*apologies for necro-post*
<br/>
<br/>
Yep, I just mis-understood your reply. I had tried the OAM_SUB but hadn't reserved anything for sub sprites. Thanks!</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
