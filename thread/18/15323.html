<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Key Color Transparency - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Key Color Transparency</h2>
<div id="posts">
<div class="post">
    <h4>#153674 - Kr00pS - Thu Apr 03, 2008 8:44 pm</h4>
    <div class="postbody"><span class="postbody">Hi !
<br/>
<br/>
I'm using OpenGL to make 2D and draw sprites, tiles but I don't know how to deal with the key color of my sprites.
<br/>
<br/>
I've searched but I didn't find anything that works with the DS.
<br/>
<br/>
Thanks for help.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153683 - Sausage Boy - Thu Apr 03, 2008 10:08 pm</h4>
    <div class="postbody"><span class="postbody">I assume you mean that you're using the DS's 3D hardware to render your stuff? Transparency depends on the texture mode you're using. If you're using direct, 16bit, RGB textures, you simply clear bit15 of a pixel to make it transparent. If you're using a paletted mode, you can set bit29 of TEXIMAGE_PARAM to make 0 transparent (see <a class="postlink" href="http://nocash.emubase.de/gbatek.htm#ds3dtextureattributes" target="_blank">gbatek</a>)
<br/>
<br/>
40004A8h - Cmd 2Ah - TEXIMAGE_PARAM - Set Texture Parameters (W)
<br/>
...
<br/>
  29    Color 0 of 4/16/256-Color Palettes (0=Displayed, 1=Made Transparent)
<br/>
<br/>
<br/>
Of course, there are defines in libnds for all this stuff, so you don't have to fiddle around with bits and magic numbers. You'll have to find them on your own though, I don't remember. :(<br/>_________________<br/>"no offense, but this is the gayest game ever"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153686 - TwentySeven - Thu Apr 03, 2008 10:47 pm</h4>
    <div class="postbody"><span class="postbody">GL_TEXTURE_COLOR0_TRANSPARENT</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153716 - Kr00pS - Fri Apr 04, 2008 12:16 pm</h4>
    <div class="postbody"><span class="postbody">Okay... PCX doesn't support transparent pixels...
<br/>
<br/>
<br/>
(OLD)
<br/>
<span style="font-style: italic">Here's the result :
<br/>
<a href="http://img530.imageshack.us/img530/8048/ndsxi9.jpg">[Images not permitted - Click here to view it]</a>
<br/>
<br/>
The color0 is the transparent one ? My sprite is a PNG modified with GIMP (the background is transparent) and transformed into PCX to load in the NDS.
<br/>
<br/>
I deleted the data folder and recompiled but nothing, just a black background like in the image.
<br/>
<br/>
Here's the code I'm using to load a PCX texture
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">      sImage pcx;
<br/>
<br/>
      //load our texture
<br/>
      loadPCX((u8*)texture_bin, &amp;pcx);
<br/>
<br/>
      image8to16(&amp;pcx);
<br/>
<br/>
      glGenTextures(1, &amp;m_Texture);
<br/>
      glBindTexture(0, m_Texture);
<br/>
      glTexImage2D(0, 0, GL_RGB, texture_size , texture_size, 0, TEXGEN_TEXCOORD | GL_TEXTURE_COLOR0_TRANSPARENT, pcx.image.data8);
<br/>
<br/>
      imageDestroy(&amp;pcx);
<br/>
</td> </tr></table><span class="postbody"></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153724 - Sausage Boy - Fri Apr 04, 2008 2:40 pm</h4>
    <div class="postbody"><span class="postbody">PCX isn't really the ideal format for stuff like this. I would save my images as something that handles transparency, png for example, use a PC tool to convert it and use that on my DS. I may be a little biased, but I think my texture converter, <a class="postlink" href="http://blog.dev-scene.com/gaspcubed/2007/10/06/texmex-004/" target="_blank">texmex</a>, is the best one, even if it leaks a little memory from time to time. There are other tools, the Nomad Texture Converter even comes with a fancy GUI, and hopefully less memory leaks.<br/>_________________<br/>"no offense, but this is the gayest game ever"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153725 - Rajveer - Fri Apr 04, 2008 3:01 pm</h4>
    <div class="postbody"><span class="postbody">I second Sausage Boy's method of saving as PNG and converting with texmex, I've been using his tool for around a year now and it works really well.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153726 - Sausage Boy - Fri Apr 04, 2008 3:56 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Rajveer wrote:</b></span></td> </tr> <tr> <td class="quote">I second Sausage Boy's method of saving as PNG and converting with texmex, I've been using his tool for around a year now and it works really well.</td> </tr></table><span class="postbody">
<br/>
<br/>
Wow, that's amazing to hear. Got any tips for improvements?<br/>_________________<br/>"no offense, but this is the gayest game ever"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153729 - Kr00pS - Fri Apr 04, 2008 5:18 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for the program, I converted my .png transparent file and It gave me a .dta file.
<br/>
<br/>
What to do with this file ? Have you a specific makefile for this ?
<br/>
<br/>
Thanks for all.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153741 - Sausage Boy - Fri Apr 04, 2008 10:41 pm</h4>
    <div class="postbody"><span class="postbody">.dta is raw texture pixel data. I don't know how you included the .pcx, but you can do it the same way. If you rely on the makefile including it automatically, you'll need to add a rule for .dta. Just check the makefile, copy the section for .pcx or .bin or whatever, and change all the extensions to .dta. If you're really lazy you could also get away with renaming the .dta to .bin.<br/>_________________<br/>"no offense, but this is the gayest game ever"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153744 - Kr00pS - Fri Apr 04, 2008 11:17 pm</h4>
    <div class="postbody"><span class="postbody">Okay, so, I'm converting the .png and the .bmp into .dta which I rename to .bin and I place to my /data/ folder.
<br/>
<br/>
It compiles, it runs but the transparency doesn't work again, the background of the sprite is black. 
<br/>
<br/>
I'm using this to load .bin texture file:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">      glGenTextures(1, &amp;m_Texture);
<br/>
      glBindTexture(0, m_Texture);
<br/>
      glTexImage2D(0, 0, GL_RGB, texture_size , texture_size, 0, TEXGEN_TEXCOORD | GL_TEXTURE_COLOR0_TRANSPARENT, (u8*)texture_bin);</td> </tr></table><span class="postbody">
<br/>
<br/>
Thanks for your patience. :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153745 - Sausage Boy - Sat Apr 05, 2008 12:13 am</h4>
    <div class="postbody"><span class="postbody">Not-so-obvious error this time. Turns out libnds manually sets all the alpha bits to 1 if the GL_RGB mode is used. Use GL_RGBA, it's exactly the same to the hardware, but libnds won't touch our transparencies.
<br/>
<br/>
Also, GL_TEXTURE_COLOR0_TRANSPARENT isn't really necessary here, it's only used for paletted textures (4-, 16- or 256-colors).<br/>_________________<br/>"no offense, but this is the gayest game ever"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153748 - Rajveer - Sat Apr 05, 2008 1:53 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Sausage Boy wrote:</b></span></td> </tr> <tr> <td class="quote">Wow, that's amazing to hear. Got any tips for improvements?</td> </tr></table><span class="postbody">
<br/>
<br/>
Not really, does everything I need it to very simply. A GUI would be nice, simply because I keep forgetting which format is which and I'm always looking at readme.txt to find out, so clicking buttons would be easier! Other than that, I can't think of anything, cheers for the great tool! :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153755 - Kr00pS - Sat Apr 05, 2008 9:38 am</h4>
    <div class="postbody"><span class="postbody">Yeah ! It works great with:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">glTexImage2D(0, 0, GL_RGBA, texture_size , texture_size, 0, TEXGEN_TEXCOORD, (u8*)texture_bin);</td> </tr></table><span class="postbody">
<br/>
<br/>
and a simple convertion of the .png with your tool. Thanks for everything.
<br/>
<br/>
<br/>
PS: I can make a GUI for your tool if you want. :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153801 - Sausage Boy - Sun Apr 06, 2008 5:07 pm</h4>
    <div class="postbody"><span class="postbody">Hmmm, I'm not too sure about this GUI thing everybody keeps talking about, but more ways to specify the texture format than numbers only would be nice indeed.<br/>_________________<br/>"no offense, but this is the gayest game ever"</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
