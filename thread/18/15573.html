<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>devkitpro example with dualis - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > devkitpro example with dualis</h2>
<div id="posts">
<div class="post">
    <h4>#157413 - gauauu - Fri May 23, 2008 10:07 pm</h4>
    <div class="postbody"><span class="postbody">So I'm finally diving into the world of DS dev, instead of just GBA.  I'm playing with the devkitPro examples, but when I try to run the Sprite_Bitmap example in the dualis emulator, I get a message:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">r15 unaligned</td> </tr></table><span class="postbody"> and dualis crashes.
<br/>
<br/>
Is this a problem with the emulator, or with the example?  And as a follow-up:
<br/>
If it's the example, what causes this issue?
<br/>
If it's the dualis emulator:  is there a better emulator that is recommended?
<br/>
<br/>
Thanks!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157421 - silent_code - Sat May 24, 2008 1:43 am</h4>
    <div class="postbody"><span class="postbody">i'm not saying it's better or not, but i *also* use no$gba a lot! i'm pressing f3 a lot, while doing so. ;^)<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157433 - gauauu - Sat May 24, 2008 10:27 am</h4>
    <div class="postbody"><span class="postbody">Thanks.  I don't have a windows machine handy right now, but I tried this example on DeSMumE for linux, and it worked fine.   Still not sure what dualis hated so much from that example, but oh well.
<br/>
<br/>
Side note:  I almost posted a long post asking for help getting devkitARM working on linux, until I realized that for some odd reason, gnome had stopped extracting the zipped files halfway through, so I only had half the devkit installed ;-)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157436 - M3d10n - Sat May 24, 2008 1:32 pm</h4>
    <div class="postbody"><span class="postbody">Linux? You could try iDeaS: <a href="http://www.ideasemu.org/index.php?act=downloads" target="_blank">http://www.ideasemu.org/index.php?act=downloads</a>
<br/>
<br/>
iDeaS and No$GBA are the only emulators that can run the 3D project I'm working on properly.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157437 - gauauu - Sat May 24, 2008 1:42 pm</h4>
    <div class="postbody"><span class="postbody">Good to know...I saw that both existing, but nowhere I read had any recommendations about which was better....Thanks!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157443 - silent_code - Sat May 24, 2008 5:03 pm</h4>
    <div class="postbody"><span class="postbody">you really have to give it a try and look for yourself.
<br/>
i find dualis handy because of it's viewers, but i mostly rely on the accuracy of no$gba (and of course the hw for any major changes or additions to the code.)
<br/>
<br/>
just in case you wonder aboout it: i have also seen people fooling around with what i think is big n's emulator, but i woundn't recommend bothering with it: as far as i can tell from what i have seen and read about it, that emu does nothing more than no$gba, which does a pretty good job for *free* and after all, using tools illegally sucks big time! don't bother with it. ;^)<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157448 - gauauu - Sat May 24, 2008 5:49 pm</h4>
    <div class="postbody"><span class="postbody">Yeah, I have no desire to use illegal tools...gotta stay on the up-and-up ;-)
<br/>
<br/>
Unfortunately, I can't do much testing on actual hardware...I don't have a DS, and don't have the budget for one at the moment. So it's code for emulators, then recruit volunteers for hardware testing.  And I'll probably end up doing most of it in linux...trying to switch away from windows at the moment.  (I've always preferred open source stuff, and after years and years, I think linux might finally hit my standard of "good enough" for desktop use)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157451 - tepples - Sat May 24, 2008 10:37 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>gauauu wrote:</b></span></td> </tr> <tr> <td class="quote">Unfortunately, I can't do much testing on actual hardware...I don't have a DS, and don't have the budget for one at the moment.</td> </tr></table><span class="postbody">
<br/>
While I was in your situation, I developed for Allegro and the GBA.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157455 - gauauu - Sat May 24, 2008 11:00 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">While I was in your situation, I developed for Allegro and the GBA.</td> </tr></table><span class="postbody">
<br/>
<br/>
Yeah, that's what I have been doing.  But I've had a number of requests to port Anguna to the DS.  So I'm giving it a whirl....</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157456 - Lazy1 - Sat May 24, 2008 11:41 pm</h4>
    <div class="postbody"><span class="postbody">Has the no$gba guy re-appeared or what?
<br/>
I need to know if I have to re-buy it or if he can give me another key.
<br/>
<br/>
Moral of the story:
<br/>
You will always forget something when it's time to backup your files.
<br/>
Make sure it's not an activation key.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157636 - gauauu - Tue May 27, 2008 3:17 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>M3d10n wrote:</b></span></td> </tr> <tr> <td class="quote">Linux? You could try iDeaS: <a href="http://www.ideasemu.org/index.php?act=downloads" target="_blank">http://www.ideasemu.org/index.php?act=downloads</a>
<br/>
<br/>
iDeaS and No$GBA are the only emulators that can run the 3D project I'm working on properly.</td> </tr></table><span class="postbody">
<br/>
<br/>
Interestingly enough, I couldn't get iDeaS for linux to display anything that wasn't 3d at all...just blank screens.  BUT, using iDeaS for windows under wine on linux worked just fine ;-)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157643 - sverx - Tue May 27, 2008 5:04 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>silent_code wrote:</b></span></td> </tr> <tr> <td class="quote">i'm not saying it's better or not, but i *also* use no$gba a lot! i'm pressing f3 a lot, while doing so. ;^)</td> </tr></table><span class="postbody">
<br/>
<br/>
Sorry for the OT: I've seen with no$gba that window (pressing F3) that tells me, for instance:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Errors per second -- 0
<br/>
Total Errors -- 0</td> </tr></table><span class="postbody">
<br/>
what does they mean? Because sometimes it happens that some 'errors' got counted when I'm running my programs but I can't find mistakes in my code and everything goes on regularily... so I really don't know if I should care about it at all or if I should take it <span style="font-style: italic">seriously</span>...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157645 - kusma - Tue May 27, 2008 5:17 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sverx wrote:</b></span></td> </tr> <tr> <td class="quote">what does they mean? Because sometimes it happens that some 'errors' got counted when I'm running my programs but I can't find mistakes in my code and everything goes on regularily... so I really don't know if I should care about it at all or if I should take it <span style="font-style: italic">seriously</span>...</td> </tr></table><span class="postbody">
<br/>
They can be anything from unaligned reads to reads of undefined memory. In general they are worth looking into, but in some special cases they are just annoying (like byte-writes to VRAM on the gba -- it can be used for good things) ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157648 - sverx - Tue May 27, 2008 5:32 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>kusma wrote:</b></span></td> </tr> <tr> <td class="quote">They can be anything from unaligned reads to reads of undefined memory.</td> </tr></table><span class="postbody">
<br/>
<br/>
an unaligned read is a mistake? :shock:</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157653 - silent_code - Tue May 27, 2008 5:50 pm</h4>
    <div class="postbody"><span class="postbody">i just want to add, that most of the time, if not every time, my own roms will have one error at the very beginning of the code. so, even if i stop execution in the first line of main(), i get the error. until now, i couldn't identify it.
<br/>
<br/>
but, if you get massive amounts of errors on a per frame base, you should <span style="font-style: italic">seriously</span> ( ;^D ) check your code, though.
<br/>
<br/>
well, in fact, even commercial roms are reported to yield enormous amounts of errors in no$gba, but that might just be related to what kusma posted. :^)<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157656 - sverx - Tue May 27, 2008 6:03 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>silent_code wrote:</b></span></td> </tr> <tr> <td class="quote">i just want to add, that most of the time, if not every time, my own roms will have one error at the very beginning of the code. so, even if i stop execution in the first line of main(), i get the error. until now, i couldn't identify it.</td> </tr></table><span class="postbody">
<br/>
<br/>
fortunatly, that still never happened me ;)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>silent_code wrote:</b></span></td> </tr> <tr> <td class="quote">but, if you get massive amounts of errors on a per frame base, you should <span style="font-style: italic">seriously</span> ( ;^D ) check your code, though.</td> </tr></table><span class="postbody">
<br/>
<br/>
I agree, but anyway it's 'funny' that with the MODplayer I'm writing I get ZERO errors when playing some tunes and a lot of errors when playing some others... but they play just fine! (here and example, after some 30 seconds...)
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Errors per second -- 1,557
<br/>
Total Errors -- 77,872</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157659 - kusma - Tue May 27, 2008 6:13 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sverx wrote:</b></span></td> </tr> <tr> <td class="quote">an unaligned read is a mistake? :shock:</td> </tr></table><span class="postbody">
<br/>
It sure is. The ARM CPUs doesn't support it; the result from such an operation is undefined.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157661 - sverx - Tue May 27, 2008 6:20 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>kusma wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sverx wrote:</b></span></td> </tr> <tr> <td class="quote">an unaligned read is a mistake? :shock:</td> </tr></table><span class="postbody">
<br/>
It sure is. The ARM CPUs doesn't support it; the result from such an operation is undefined.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
mmm... but is it possibile (I mean with the GCC compiler 'shipped' with devKitPro) to produce code with unaligned reads? Or should I give up using u8 &amp; s8 types? Sorry, I need an explanation, this can make a mess in my mind...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157663 - silent_code - Tue May 27, 2008 6:33 pm</h4>
    <div class="postbody"><span class="postbody">you can still use u8's and u16's, the compiler will just pad and align them for you as needed (so, effectively you might loose some bytes for each unpacked structure.)
<br/>
<br/>
i hope that's not bogus i just wrote. ;^)
<br/>
<br/>
EDIT: corrected it a bit and made it more general.<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"><br/><br/>Last edited by silent_code on Tue May 27, 2008 6:50 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#157664 - Maxxie - Tue May 27, 2008 6:38 pm</h4>
    <div class="postbody"><span class="postbody">Byte reads can not be unaligned.
<br/>
<br/>
If you however read hwords or words from unaligned addresses (2/4 byte aligned) then you will observe problems.
<br/>
<br/>
Let's say you have at address 0 the 6 bytes 0,1,2,3,4,5 are stored.
<br/>
A word read from address 2, could result 0x03020100 if the lower address bits are ignored, 0x01000203 if the 2nd lower bit selects the halfword to be filled in first or 0x05040302 if the read was executed as you intended it.
<br/>
(Under little endian)
<br/>
<br/>
Since this might depend on the buswidth the memory is connected with, the behavious is defined as undefined.
<br/>
<br/>
Bit 0 set in address on 32/16 bit reads are completely ignored on the DS afaik.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157702 - Cydrak - Tue May 27, 2008 10:03 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>kusma wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sverx wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
an unaligned read is a mistake? :shock:
<br/>
</td> </tr></table><span class="postbody">
<br/>
It sure is. The ARM CPUs doesn't support it; the result from such an operation is undefined.
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
Actually it's more fun than that. It is defined; the ARM Arch Ref Manual (would that be "ARM ARM?" :b *groan*) says, in many scattered footnotes:
<br/>
- LD/STRH, LD/STRD, LD/STR (THUMB): "Unpredictable".
<br/>
- LD/STM, STR (ARM), SWP (write): Address masked; low bits ignored.
<br/>
- LDR (ARM), SWP (read): Address masked; data ROR'd by 8 * low bits (even written out in the pseudocode!).
<br/>
<br/>
This makes the LDR (mildly) useful in loops. The data will already be shifted, needing just a couple bitmasks and an OR on the results. I used that in a blitter somewhere, so presumably the DS follows the standard. Heh, I suppose that's more than anyone cared to know... &gt;_&gt;</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157729 - sverx - Wed May 28, 2008 9:26 am</h4>
    <div class="postbody"><span class="postbody">Thank you all, it's really interesting :)
<br/>
<br/>
BTW I guess it's impossible -at least for me- to do an unaligned read if I'm just writing C code and not even using pointer math... I mean, I'm just writing 'plain' C code, without anything particular... do you think that is it possible to code an unaligned read without even knowing?
<br/>
<br/>
(mmm... does malloc() always return pointers to aligned memory locations, right? ... )</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157731 - kusma - Wed May 28, 2008 9:40 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cydrak wrote:</b></span></td> </tr> <tr> <td class="quote">Actually it's more fun than that. It is defined; the ARM Arch Ref Manual (would that be "ARM ARM?" :b *groan*)
<br/>
</td> </tr></table><span class="postbody">
<br/>
Indeed it's called the ARM ARM :). We absolutely HAVE to call it "The ARM ARM" at work to avoid confusion ;)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cydrak wrote:</b></span></td> </tr> <tr> <td class="quote">says, in many scattered footnotes:
<br/>
- LD/STRH, LD/STRD, LD/STR (THUMB): "Unpredictable".
<br/>
- LD/STM, STR (ARM), SWP (write): Address masked; low bits ignored.
<br/>
- LDR (ARM), SWP (read): Address masked; data ROR'd by 8 * low bits (even written out in the pseudocode!).</td> </tr></table><span class="postbody">
<br/>
Hehe, yeah. This just makes it all even harder to deal with (like the fact that LDR and STR in ARM mode isn't symmetrical)! My guess would be that some old important legacy code depended on an implementation detail that gave these results, so we can't get rid of it or something ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157732 - kusma - Wed May 28, 2008 9:42 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sverx wrote:</b></span></td> </tr> <tr> <td class="quote">Thank you all, it's really interesting :)
<br/>
<br/>
BTW I guess it's impossible -at least for me- to do an unaligned read if I'm just writing C code and not even using pointer math... I mean, I'm just writing 'plain' C code, without anything particular... do you think that is it possible to code an unaligned read without even knowing?
<br/>
<br/>
(mmm... does malloc() always return pointers to aligned memory locations, right? ... )</td> </tr></table><span class="postbody">
<br/>
You're absolutely right, without pointer-trickery, you can't generate unaligned reads/writes in C/C++. malloc() is required to return a pointer aligned to the strictest alignment required by the platform.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157733 - Maxxie - Wed May 28, 2008 9:42 am</h4>
    <div class="postbody"><span class="postbody">malloc here is allways word (32bit) aligned.
<br/>
<br/>
The compiler will align elements in structs for you compatible with the ARM (except if you specify it to do different via the packed attribute) so you will be OK if you are not doing pointermaths/casts by yourself.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157734 - sverx - Wed May 28, 2008 9:50 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>kusma wrote:</b></span></td> </tr> <tr> <td class="quote">You're absolutely right, without pointer-trickery, you can't generate unaligned reads/writes in C/C++. malloc() is required to return a pointer aligned to the strictest alignment required by the platform.</td> </tr></table><span class="postbody">
<br/>
<br/>
That's good. What's bad now is that if
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Errors per second -- 1,557 
<br/>
Total Errors -- 77,872</td> </tr></table><span class="postbody">
<br/>
aren't misaligned reads, what can they be? :shock:
<br/>
<br/>
<span style="font-size: 9px; line-height: normal">(and it's funny it happens only with some MODs, and from a specific point on...)</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157735 - kusma - Wed May 28, 2008 9:53 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sverx wrote:</b></span></td> </tr> <tr> <td class="quote">That's good. What's bad now is that if
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Errors per second -- 1,557 
<br/>
Total Errors -- 77,872</td> </tr></table><span class="postbody">
<br/>
aren't misaligned reads, what can they be? :shock:
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
Buy the debug-version of NO$GBA, it will tell you.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157736 - simonjhall - Wed May 28, 2008 9:56 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sverx wrote:</b></span></td> </tr> <tr> <td class="quote">(mmm... does malloc() always return pointers to aligned memory locations, right? ... )</td> </tr></table><span class="postbody">Yes, it will return pointers aligned to the word size of the machine.
<br/>
<br/>
With regards to the question about can you get C to do unaligned loads, yes you can. One way will be where you're sharing data with a machine whose architecture packs its data differently to your machine.
<br/>
<br/>
For instance if you've got a structure like</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">struct fred
<br/>
{
<br/>
   char a, b, c;
<br/>
   int d;
<br/>
};</td> </tr></table><span class="postbody">And machine X outputs data to disk/network and is picked up by machine Y running the *same C code* then you need to ensure that the packing of the structure is the same when you're reading it in. If machine X has no problems with unaligned data and there's no padding byte between element C and element D then when this code is built on machine Y which does require (say) 32-bit alignment then a padding byte will be inserted into the gap in order to align D. When you go to read D you'll get the wrong data as it'll be reading from the wrong address. You won't generate an unaligned load though.
<br/>
<br/>
In order to read from the right location you need to tell the compiler that there's no padding like this:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#pragma pack (1)
<br/>
struct fred2
<br/>
{
<br/>
   char a, b, c;
<br/>
   int d;
<br/>
};
<br/>
#pragma pack ()</td> </tr></table><span class="postbody">...but this means that when you pull your data out of D the address will be unaligned (assuming that the structure IS aligned) causing an unaligned exception. Sha-zam.
<br/>
<br/>
(yeah I know, pragmas aren't quite virgin C - can anyone provide a better example that doesn't require casting pointers from smaller to larger types?)<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157737 - sverx - Wed May 28, 2008 10:09 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>kusma wrote:</b></span></td> </tr> <tr> <td class="quote">Buy the debug-version of NO$GBA, it will tell you.</td> </tr></table><span class="postbody">
<br/>
<br/>
That's another good reason for buying the no$gba debug ver, then :)
<br/>
(mmm... does Martin finally gave news about him lately?)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157738 - sverx - Wed May 28, 2008 10:12 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>simonjhall wrote:</b></span></td> </tr> <tr> <td class="quote">With regards to the question about can you get C to do unaligned loads, yes you can. One way will be where you're sharing data with a machine whose architecture packs its data differently to your machine.</td> </tr></table><span class="postbody">
<br/>
<br/>
You're right. Fortunaly -at least this- shouldn't affect me ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157742 - kusma - Wed May 28, 2008 10:58 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>simonjhall wrote:</b></span></td> </tr> <tr> <td class="quote">And machine X outputs data to disk/network and is picked up by machine Y
<br/>
</td> </tr></table><span class="postbody">
<br/>
Doing so is something I'd say qualifies as "pointer trickery" (and in general - bad code) :)
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>simonjhall wrote:</b></span></td> </tr> <tr> <td class="quote">...but this means that when you pull your data out of D the address will be unaligned (assuming that the structure IS aligned) causing an unaligned exception. Sha-zam.</td> </tr></table><span class="postbody">
<br/>
Not neccecarily an exception - gcc generates byte-reads and re-assembles the variables in these cases, at least for ARM cpus. In fact, unaliged reads doesn't generate exceptions on ARM cpus unless you have the system control coprocessor (or whatever it's called) and unaligned exceptions enabled.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157769 - tepples - Thu May 29, 2008 1:33 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>kusma wrote:</b></span></td> </tr> <tr> <td class="quote">Buy the debug-version of NO$GBA, it will tell you.</td> </tr></table><span class="postbody">
<br/>
His PayPal account is gone.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>simonjhall wrote:</b></span></td> </tr> <tr> <td class="quote">With regards to the question about can you get C to do unaligned loads, yes you can. One way will be where you're sharing data with a machine whose architecture packs its data differently to your machine.
<br/>
<br/>
For instance if you've got a structure like<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">struct fred
<br/>
{
<br/>
   char a, b, c;
<br/>
   int d;
<br/>
};</td> </tr></table><span class="postbody">And machine X outputs data to disk/network and is picked up by machine Y running the *same C code* then you need to ensure that the packing of the structure is the same when you're reading it in.</span></td> </tr></table><span class="postbody">
<br/>
Endianness may bite you before alignment. As I understand it, this generation's consoles all have big-endian PowerPC CPUs, while the handhelds have little-endian MIPS (PSP) or ARM (DS, Windows Mobile, GP2X, Pandora).
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">(yeah I know, pragmas aren't quite virgin C - can anyone provide a better example that doesn't require casting pointers from smaller to larger types?)</td> </tr></table><span class="postbody">
<br/>
Something that would involve union?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157803 - silent_code - Thu May 29, 2008 5:04 pm</h4>
    <div class="postbody"><span class="postbody">yeah, just check libnds' sprite entry / rotation structs for an example. they also use bitfields. ;^D<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157805 - kusma - Thu May 29, 2008 5:13 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">(yeah I know, pragmas aren't quite virgin C - can anyone provide a better example that doesn't require casting pointers from smaller to larger types?)</td> </tr></table><span class="postbody">
<br/>
Something that would involve union?</span></td> </tr></table><span class="postbody">
<br/>
reading from a different union-member than you last wrote gives undefined results in C/C++, if that's what you were thinking of. And I don't think it would break alignment either.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157808 - simonjhall - Thu May 29, 2008 6:47 pm</h4>
    <div class="postbody"><span class="postbody">Barely related to this, one thing that's starting to bug me about C/C++ is that people programmers often assign NULL (aka address zero) to pointers in order to say "there's nothing at the end of this pointer".
<br/>
This is annoying me because,
<br/>
a) if you use a target that doesn't have memory protection turned on by default (eg the DS), reading from your pointer is not going to get caught like on the PC
<br/>
b) with the target that I program, legal memory begins at address zero so doing stuff with NULL pointers is ok!
<br/>
c) asserts to check for NULL can be good or bad depending on whether or not NULL is a valid address
<br/>
d) if a pointer to a structure is assigned NULL, only access to the first member will give yield address zero, other members may be at 0x4, 0x8 etc.
<br/>
<br/>
Really what I want is to have NULL work something like NaN - whenever you try to read from it you'll always get an error and if you have the struct example above , NULL + 0x4 wouldn't equal address 0x4, it'd still equal the magic code associated with NULL.
<br/>
<br/>
(can you tell that I've been fighting NULL pointers all day?! I also can't use references)<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157809 - Maxxie - Thu May 29, 2008 6:59 pm</h4>
    <div class="postbody"><span class="postbody">If you are under C++, you can use one of those "smart pointer" templates.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
