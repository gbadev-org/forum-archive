<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>How to generate lots of random numbers? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > How to generate lots of random numbers?</h2>
<div id="posts">
<div class="post">
    <h4>#141879 - Jeremysr - Mon Oct 01, 2007 3:47 am</h4>
    <div class="postbody"><span class="postbody">I'm making a puzzle game which has lots of tiles and each tile has numbers on it. When I generate a puzzle, most of the numbers have to be random numbers (between 0 and 9) and after that I randomize the position of the tiles multiple times.
<br/>
<br/>
My question is how can I make all these numbers completely random? rand() seems to work pretty good but it generates the exact same puzzle each time.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141880 - Lazy1 - Mon Oct 01, 2007 4:25 am</h4>
    <div class="postbody"><span class="postbody">You need to seed the random number generator first before calling rand.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
srand( sometime );
<br/>
...
<br/>
...
<br/>
blah = rand();
<br/>
bleh = rand();
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Normally it would be seeded with the time but you can use any number.
<br/>
Keep in mind though if you use the same number to seed it will generate the same numbers.
<br/>
<br/>
Since by default time() is unavailable on the DS you'll need to find another way of seeding the RNG.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141883 - DragonMinded - Mon Oct 01, 2007 6:39 am</h4>
    <div class="postbody"><span class="postbody">A good way of truly randomizing is to capture some data from the microphone on startup, and use that to seed.<br/>_________________<br/>Enter the mind of the dragon.
<br/>
<br/>
<a href="http://dragonminded.blogspot.com" target="_blank">http://dragonminded.blogspot.com</a>
<br/>
<br/>
Seriously guys, how hard is it to simply TRY something yourself?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141885 - a128 - Mon Oct 01, 2007 8:44 am</h4>
    <div class="postbody"><span class="postbody"><a class="postlink" href="http://en.wikipedia.org/wiki/Mersenne_twister" target="_blank">http://en.wikipedia.org/wiki/Mersenne_twister</a>
<br/>
<br/>
Use this one.....using different seeds with srand() does not produce a better random generator :-)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141899 - tepples - Mon Oct 01, 2007 12:40 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lazy1 wrote:</b></span></td> </tr> <tr> <td class="quote">Since by default time() is unavailable on the DS you'll need to find another way of seeding the RNG.</td> </tr></table><span class="postbody">
<br/>
This is fixable. Isn't there some way to grab the current time from the ARM7?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141900 - Lick - Mon Oct 01, 2007 12:55 pm</h4>
    <div class="postbody"><span class="postbody">DragonMinded has a time() implementation in DSO I believe, and I also wrote one (NDSX_time). I'm not sure if either of these work with the latest libnds.<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141901 - Jesse - Mon Oct 01, 2007 12:59 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lazy1 wrote:</b></span></td> </tr> <tr> <td class="quote">Since by default time() is unavailable on the DS you'll need to find another way of seeding the RNG.</td> </tr></table><span class="postbody">
<br/>
This is fixable. Isn't there some way to grab the current time from the ARM7?</span></td> </tr></table><span class="postbody">
<br/>
With the CVS version of libnds this works nicely:
<br/>
srand(IPC-&gt;time.rtc.seconds);
<br/>
Of course, you may want to take more than the seconds into account, if you want more than 60 different setups. :)<br/>_________________<br/><a href="http://www.collectingsmiles.com/colors" target="_blank">http://www.collectingsmiles.com/colors</a> &amp; <a href="http://www.collectingsmiles.com/hyena" target="_blank">http://www.collectingsmiles.com/hyena</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141903 - freemaan - Mon Oct 01, 2007 2:09 pm</h4>
    <div class="postbody"><span class="postbody">You can use the WiFi register 0x044 (W_RANDOM) too to get a 11 bit random number.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141907 - HyperHacker - Mon Oct 01, 2007 2:33 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lazy1 wrote:</b></span></td> </tr> <tr> <td class="quote">You need to seed the random number generator first before calling rand.
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
srand( sometime );
<br/>
...
<br/>
...
<br/>
blah = rand();
<br/>
bleh = rand();
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Normally it would be seeded with the time but you can use any number.
<br/>
Keep in mind though if you use the same number to seed it will generate the same numbers.
<br/>
<br/>
Since by default time() is unavailable on the DS you'll need to find another way of seeding the RNG.</span></td> </tr></table><span class="postbody">Games on consoles without a real-time clock tended to do it by counting how many VBlanks until the player does something such as pushing Start at the title screen. This has the potential gotcha, though, that if the player always just mashes Start during startup to skip the title as fast as possible, they're likely to get the same few seeds over and over.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141912 - Lick - Mon Oct 01, 2007 4:02 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>freemaan wrote:</b></span></td> </tr> <tr> <td class="quote">You can use the WiFi register 0x044 (W_RANDOM) too to get a 11 bit random number.</td> </tr></table><span class="postbody">
<br/>
<br/>
Hey that's a good one. I hope I'll remember it when I need it. Any idea about its randomness though?<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141913 - Mighty Max - Mon Oct 01, 2007 4:39 pm</h4>
    <div class="postbody"><span class="postbody">It's less random as proper use of rand()
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>nocash gbatek wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
044h - W_RANDOM - Random Generator (R)
<br/>
<br/>
  0-10  Random
<br/>
  11-15 Not used (zero)
<br/>
<br/>
The random generator is updated at 33MHz rate, as such:
<br/>
<br/>
  X = (X AND 1) XOR (X ROL 1)  ;(rotation within 11bit range)
<br/>
<br/>
The random sequence goes through 5FDh different values before it restarts.
<br/>
When reading from the random register, the old latched value is returned to the CPU, and the new current random value is then latched, so reads always return the older value, timed from the previous read.
<br/>
Occassionally, about once every some thousand reads, the latching appears to occur 4 cycles earlier than normally, so the value on the next read will be 4 cycles older than expected.
<br/>
The random register has ACTIVE mirrors.
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141939 - Jeremysr - Tue Oct 02, 2007 12:21 am</h4>
    <div class="postbody"><span class="postbody">I didn't realize that you only have to seed the number generator once, and then it seems to generate good random numbers... I thought I had to seed it each time I want to generate a new number. I counted vblanks during the splash screen to get the seed and it seems to work good :)
<br/>
<br/>
If I can figure it out though, I'll try to use a combination of vblank counts and microphone volume. Thanks everyone</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141956 - mml - Tue Oct 02, 2007 11:41 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Jeremysr wrote:</b></span></td> </tr> <tr> <td class="quote">I didn't realize that you only have to seed the number generator once, and then it seems to generate good random numbers...</td> </tr></table><span class="postbody">
<br/>
<br/>
To explain it in simple terms: rand() will always generate the same (very long) sequence of numbers.  When you "seed" it, you're setting where in this long sequence to start from.  If you don't seed it, you'll always start at the start (and always get the same numbers in the same order).  If you seed it with the same number each time you start up, you'll start from a different position than if you hadn't seeded, but will still always get the same numbers in the same order, relative to the seed.   (This can be useful during debugging because you can predict the numbers that will be generated, and compare what it does with those numbers against what you expected it to do with them.)  In typical usage though, you would want to seed it with a different number each time your program starts, in order to get a sequence of numbers that feels random enough.  
<br/>
<br/>
In the PC world it's traditional to pick a seed using time(), which will give back the number of seconds since the start of 1970.  Most of the time this is a "random enough" starting point (if you start the app twice in the same second you'll get the same sequence of numbers, but for most apps this is pretty unlikely).
<br/>
<br/>
I guess on the DS you might try grabbing a number from the W_RANDOM register described above, and using that to seed rand.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141995 - Mighty Max - Tue Oct 02, 2007 9:47 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>mml wrote:</b></span></td> </tr> <tr> <td class="quote">Most of the time this is a "random enough" starting point (if you start the app twice in the same second you'll get the same sequence of numbers, but for most apps this is pretty unlikely).</td> </tr></table><span class="postbody">
<br/>
<br/>
"Most of the time"?
<br/>
<br/>
Puzzle games get easy solvable, by "guessing" the seed. There even was an online poker with $ involved suffering from this problem in 2001 iirc, allowing an attacker to know all cards after the first few were known.
<br/>
<br/>
For everything even remotely security related, seeding with time only is a no-go.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142027 - mml - Wed Oct 03, 2007 11:32 am</h4>
    <div class="postbody"><span class="postbody">For anything remotely security related, you shouldn't be using rand() to begin with.  Most of the time you do use rand(), seeding with the time is fine.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
