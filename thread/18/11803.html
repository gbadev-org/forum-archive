<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Menu Creation - font display on framebuffer? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > Menu Creation - font display on framebuffer?</h2>
<div id="posts">
<div class="post">
    <h4>#110263 - mysteryegg - Mon Nov 27, 2006 9:44 am</h4>
    <div class="postbody"><span class="postbody">I hate being a resident n00b, but I'd like to know if there is any established "standard" for touchscreen based menus. I have run into a big problem creating my own menu:
<br/>
<br/>
I am using Mode 5 on the touchscreen (set as main) and have used it as a framebuffer to draw simple button fields onto the screen. The buttons change color on click like any standard GUI button behavior to indicate being depressed. I need to label these buttons, so since I am terrible at graphic design, I thought I'd just iprintf() some text on top of BG3 where I've drawn my menu.
<br/>
<br/>
Problem is, doing any kind of BG0 initialization including ConsoleInitDefault() scrambles the image from BG3. Do people not use a console on top of other layers? Does everybody just make tiled menus? Looking for some examples.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110267 - Lick - Mon Nov 27, 2006 9:51 am</h4>
    <div class="postbody"><span class="postbody">You need more VRAM. You need to learn about the map, tile and bmp <span style="font-weight: bold">bases</span>. Bases are basically blocks of VRAM. Map and bmp bases are 2kb and tile bases are 16kb. Using bases, you can play with the VRAM.
<br/>
<br/>
Check out these defines:<span style="font-style: italic"> BG_MAP_BASE(), BG_TILE_BASE(), BG_BMP_BASE().</span>
<br/>
And these: <span style="font-style: italic">BG_MAP_RAM[_SUB](), BG_TILE_RAM[_SUB](), BG_BMP_RAM[_SUB]().</span>
<br/>
<br/>
The first 3 are for setting the BGx_CR. The last three are for copying the data to that base.
<br/>
BG3_CR |= <span style="font-weight: bold">BG_BMP_BASE(8)</span>...
<br/>
memcpy((u16*)<span style="font-weight: bold">BG_BMP_RAM(8)</span>, bmp_data, bmp_data_size);<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110301 - thegamefreak0134 - Mon Nov 27, 2006 6:59 pm</h4>
    <div class="postbody"><span class="postbody">Basically, it sounds like you have a VRAM conflict. Remember that all VRAM really doesn't exist independantly, but is rather mapped to the locations the hardware can read from. You have the console using the same VRAM as your BG, and the easiest thing to do here is to change where your BG is being stored. (ie, pick another compatable bank.)
<br/>
<br/>
-gamefreak<br/>_________________<br/>What if the hokey-pokey really is what it's all about?
<br/>
<br/>
[url=http:/www.darknovagames.com/index.php?action=recruit&amp;clanid=1]Support Zeta on DarkNova![/url]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110322 - mysteryegg - Mon Nov 27, 2006 9:43 pm</h4>
    <div class="postbody"><span class="postbody">OK, there doesn't seem to be any conflict between the framebuffer and the console anymore, but I can only see the framebuffer if it has a higher priority, and I get a black screen (with no text) otherwise. Assuming I don't need a custom font, how should I fix this code? (I am very tempted, if I can't get this to work with minimal effort, to scrap it all and just switch to a tiled menu or write directly to the OAM...)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
powerON(POWER_ALL_2D);
<br/>
...
<br/>
videoSetMode(MODE_5_2D | DISPLAY_BG3_ACTIVE | DISPLAY_BG0_ACTIVE);
<br/>
videoSetModeSub(MODE_5_2D | DISPLAY_BG3_ACTIVE);
<br/>
vramSetMainBanks (
<br/>
   VRAM_A_MAIN_BG_0x6000000,
<br/>
   VRAM_B_MAIN_BG_0x6020000,
<br/>
   VRAM_C_SUB_BG_0x6200000,
<br/>
   VRAM_D_LCD);
<br/>
BG3_CR = BG_BMP16_256x256 | BG_PRIORITY_3; //set up frame buffer
<br/>
BG3_XDX = 1 &lt;&lt; 8; 
<br/>
BG3_XDY = 0; 
<br/>
BG3_YDX = 0; 
<br/>
BG3_YDY = 1 &lt;&lt; 8; 
<br/>
BG3_CX = 0; 
<br/>
BG3_CY = 0;
<br/>
//this is where I'm probably messing up...
<br/>
BG0_CR = BG_MAP_BASE(31) | BG_PRIORITY_0;
<br/>
BG_PALETTE[255] = RGB15(0,31,0);  //green
<br/>
consoleInitDefault((u16*)SCREEN_BASE_BLOCK(31), (u16*)CHAR_BASE_BLOCK(0), 16);
<br/>
<br/>
SUB_BG3_CR = BG_BMP8_256x256;
<br/>
...
<br/>
lcdMainOnBottom();
<br/>
<br/>
//sub screen "splash" up top
<br/>
dmaCopy(Splash_bin, BG_GFX_SUB, 256*256);
<br/>
dmaCopy(palette_bin, BG_PALETTE_SUB, 256*2);
<br/>
<br/>
//clear touchscreen
<br/>
for(i = 0; i &lt; 256*192; i++)
<br/>
   BG_GFX[i] = RGB15(15,15,15) | BIT(15);
<br/>
<br/>
//draw a couple of red buttons
<br/>
rectfill(40, 40, 176, 40, BG_GFX, RGB15(31,0,0) | BIT(15));
<br/>
rectfill(40, 112, 176, 40, BG_GFX, RGB15(31,0,0) | BIT(15));
<br/>
<br/>
//write something
<br/>
iprintf("testing...");</td> </tr></table><span class="postbody">
<br/>
<br/>
Yeah, I know I'm clueless when it comes to consoles, palettes, maps, the whole shabang. It's hard starting on the DS not having done GBA before because there's no knowing how much attention I should pay to GBA tutorials without knowing "does it not work because I'm doing it wrong, or is there a difference in the way the DS does it? I figured, since I have a time shortage, and since I'm making a simple application rather than a game, there's not much reason for me to take the time to get into sprites.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110355 - mysteryegg - Tue Nov 28, 2006 1:21 am</h4>
    <div class="postbody"><span class="postbody">I give up. I've managed to get sprites to show up on top of the menu, so I will just make the menu out of sprites instead of trying to get the console working. I assume this is what most developers do anyway to have those nice "buttons flying across the screen" effects :-P</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
