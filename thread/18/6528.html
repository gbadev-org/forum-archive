<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>WMB compatible executable - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > WMB compatible executable</h2>
<div id="posts">
<div class="post">
    <h4>#50340 - mokoloko - Mon Aug 08, 2005 9:15 am</h4>
    <div class="postbody"><span class="postbody">Hello:
<br/>
<br/>
I'm new to the DS coding but I have done some simple things for the GBA.
<br/>
<br/>
I have downloaded the devkitpro, and the ndslib and now I'm following the Doublec's tutorials.
<br/>
<br/>
I have compiled the first sample (Demo1) and I have flashed (demo1.nds.gba) it to a cart and it works on the real hardware (I have flashed my DS with the patched firmware.
<br/>
<br/>
Then I have tried the WMB application and I sended the program (demo1.nds) to the DS and it worked! I was surprised because I though that I must do some changes in the code to be able to run from the WiFi.
<br/>
<br/>
In the GBA you must change the start address and the address of the data segments to be on the RAM area, so I supossed that something similar happens on the DS, but this sample works without work.
<br/>
<br/>
Then I have tried more complex samples and demos from other people and they didn't worked.
<br/>
<br/>
I suposse that the Demo1 works because it doesn't access data outside from the executable, and if the DS copies the executable to the RAM it works, but if a program needs to read more data you need to prepare the data to the correct address.
<br/>
<br/>
So my question is how could I make a program that runs from the WiFi? I prefer to use the wifi to test my programs beacuse now they will be only a few KBs in size, and this way you don't need to flash one time and another all the times that you make a simple change to the code.
<br/>
<br/>
Probably with something like a define or changing some lines in the linker script you could have three diferent versions of your program.
<br/>
<br/>
I'm looking for something that let you make:
<br/>
<br/>
1.- A WiFi version. It's limited by the RAM, but it's very fast to test.
<br/>
2.- A Flash version. It's the best way to reales a final work.
<br/>
3.- A mixed version. You could flash the data (graphics, music, etc) to the flash and then send by WiFi the executable code. The program will read the data from the flash cart, but the code from ram. This is an ideal solution fro developing because the data won't change very often from built to built, but the code will change constantly, so you have a fast way to test your program with less limitations that the WiFi version.
<br/>
<br/>
I think that this can be done simply changing some information in the code, but I don't know what. As I have said today it's my first day coding on the DS and I haven't found any info about this.
<br/>
<br/>
Is out there any document that tells something about this? Anybody knows to do that?
<br/>
<br/>
I know that SCUMMVM uses something like that, because the author has released a WiFi version and a Flash version...
<br/>
<br/>
Thanks a lot. I hope that somebody could help me...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#50347 - Sausage Boy - Mon Aug 08, 2005 3:23 pm</h4>
    <div class="postbody"><span class="postbody">It's is actually very easy to make different versions of your program.
<br/>
The reason some programs only run from cart, is because they use
<br/>
the cartridge to load their data. The ones that do work have their data
<br/>
included in the binary.
<br/>
<br/>
You need a way to either load from the binary, or from cartridge. The good
<br/>
thing is, this is very easy to make. From reading doublec's tutorials, you've
<br/>
probably heard of gbfs. This is a quite flexible filesystem, which only needs
<br/>
a pointer to the beginning of it to work.
<br/>
<br/>
My suggestion is that you make an #ifdef, like, if CARTRIDGE is designed,
<br/>
use doublec's code for setting the pointer. If it's not defined, you'll want to
<br/>
use code that gets the pointer in some other way.
<br/>
There is a good thread here: <a href="http://forum.gbadev.org/viewtopic.php?t=6449" target="_blank">http://forum.gbadev.org/viewtopic.php?t=6449</a>
<br/>
<br/>
Note that the cartridge version is useless, since the wmb one will run on
<br/>
cartridge too. You only want the cartridge version if your data is larger
<br/>
than 4MB minus the amount of ram your program uses. This is since it
<br/>
will be loaded into ram. This solution is also good if you want to be able
<br/>
to run your program fast with wmb and not all the data, and then add all
<br/>
the files to the filesystem and compile it for cartridge.<br/>_________________<br/>"no offense, but this is the gayest game ever"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#50353 - mokoloko - Mon Aug 08, 2005 4:07 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for the information. If I have undestood the things right it's very simple to make what I want.
<br/>
<br/>
I only have a question: Is it possible to run the code directly from the cart or it must be copied from the cart to ram always? It could be nice to run the code from ROM and use the RAM only for the things that need it...
<br/>
<br/>
Thanks again.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#50363 - Sausage Boy - Mon Aug 08, 2005 8:00 pm</h4>
    <div class="postbody"><span class="postbody">If you do it the doublec (most common) way, the data, won't be loaded to ram.
<br/>
This must be used if your data is bigger than 4mb.<br/>_________________<br/>"no offense, but this is the gayest game ever"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#50429 - pepsiman - Tue Aug 09, 2005 4:20 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>mokoloko wrote:</b></span></td> </tr> <tr> <td class="quote">Is it possible to run the code directly from the cart or it must be copied from the cart to ram always?</td> </tr></table><span class="postbody">
<br/>
<br/>
It is possible, the .ds.gba version of DSlinux does it.
<br/>
<br/>
You need to write your own asm startup code for the ARM7, which gives the ARM9 access to the GBA slot, copies the ARM7 binary to RAM, jumps to the ARM7 binary and tells the ARM9 where to start from.
<br/>
<br/>
See <a href="http://cvs.sourceforge.net/viewcvs.py/dslinux/dslinux/linux-2.6.x/arch/armnommu/mach-nds/head.S?rev=1.11&amp;view=auto" target="_blank">http://cvs.sourceforge.net/viewcvs.py/dslinux/dslinux/linux-2.6.x/arch/armnommu/mach-nds/head.S?rev=1.11&amp;view=auto</a> for how DSLinux does it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#50641 - mokoloko - Thu Aug 11, 2005 8:49 am</h4>
    <div class="postbody"><span class="postbody">It sounds very interesting, but also a bit complex...
<br/>
<br/>
Perhaps in the future if my program needs it, I will investigate it, but for now I will use the RAM. ;-)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#50711 - decayer - Fri Aug 12, 2005 12:44 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>mokoloko wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<br/>
Then I have tried the WMB application and I sended the program (demo1.nds) to the DS and it worked! I was surprised because I though that I must do some changes in the code to be able to run from the WiFi.
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
While my Cart Flash does not arrive, I tried to make the same, but I got something strange: <a href="http://img350.imageshack.us/img350/6532/clipboard076fl.jpg">[Images not permitted - Click here to view it]</a>
<br/>
<br/>
It's normal?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#50954 - pepsiman - Sun Aug 14, 2005 9:11 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>decayer wrote:</b></span></td> </tr> <tr> <td class="quote">It's normal?</td> </tr></table><span class="postbody">
<br/>
<br/>
Yes, the garbage logo is actually a NDS loader to allow the .nds file to load itself into RAM when it is written to a GBA flash card.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
