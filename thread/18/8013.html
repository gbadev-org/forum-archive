<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>How can I write to the GBA cart ROM? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > How can I write to the GBA cart ROM?</h2>
<div id="posts">
<div class="post">
    <h4>#65821 - Locke - Thu Jan 05, 2006 11:11 pm</h4>
    <div class="postbody"><span class="postbody">Mi flashcard writer was broken, and in order to continue burning my apps into it, I came with the idea of using the Nintendo DS to write the cart's ROM.
<br/>
<br/>
I'm working on a small program that loads by wifi and writes the data to the cart, but I'm getting some problems to get it to work correctly. First I clear bit 7 of the WAIT_CR register so arm9 can write to the gba memory. Then I use
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void writeROM(char* src, int size) {
<br/>
  char* dest = 0x08000000;
<br/>
  while(size--) 
<br/>
      *dest++ = *src++;
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
to write my data to the cart, but it doesn't work. Any ideas about what's wrong with it?
<br/>
<br/>
Thank you for your time</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#65824 - tepples - Thu Jan 05, 2006 11:21 pm</h4>
    <div class="postbody"><span class="postbody">You need to 1. unlock the flash cart's ASIC, 2. unlock the flash chips themselves, and then 3. rewrite using the flash chip's protocol.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#65825 - Dwedit - Thu Jan 05, 2006 11:22 pm</h4>
    <div class="postbody"><span class="postbody">There's a reason why it doesn't work, and it's the same reason why it's called ROM: You can't directly write to it.
<br/>
<br/>
The actual code to write to a GBA cartridge varies across flash cartridge models.  There is code out there for the Flash2Advance cartridges that I've tested and verified works, but I don't know about the others.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#65828 - Locke - Thu Jan 05, 2006 11:32 pm</h4>
    <div class="postbody"><span class="postbody">I thought it was easier, as MK2/3 (for example) can write to GBA rom at boot time.
<br/>
<br/>
I'm using a XG2005. If someone knows how to write to this flash, please let me know. Maybe the F2A code can work for me. Can you tell me where to find it?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#65829 - leoedin - Thu Jan 05, 2006 11:38 pm</h4>
    <div class="postbody"><span class="postbody">as far as I know, the Mk2/3 only work with neoflash carts (and the ones they where cloned off).
<br/>
<br/>
Leo<br/>_________________<br/>Yours Truly
<br/>
<a class="postlink" href="http://rampen.ca/leo/" target="_blank">my website</a>
<br/>
<a class="postlink" href="http://rampen.ca/leo/blog" target="_blank">my blog</a>
<br/>
<a class="postlink" href="http://rampen.ca/leo/blog/?page_id=7" target="_blank">M3 Review</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#65832 - Locke - Thu Jan 05, 2006 11:41 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>leoedin wrote:</b></span></td> </tr> <tr> <td class="quote">as far as I know, the Mk2/3 only work with neoflash carts (and the ones they where cloned off).
<br/>
<br/>
Leo</td> </tr></table><span class="postbody">
<br/>
<br/>
XG2005 is the cart Neoflash was cloned from, so if MK2 can write to it, then it is possible to do it :)
<br/>
<br/>
The main problem is how to do it...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#65849 - Sintax - Fri Jan 06, 2006 3:33 am</h4>
    <div class="postbody"><span class="postbody">You can tell the MK2/3 to write to the cart, and could probably even do it without the MK, but the documentation for coding the MK is little to none and there is probably none for writing to the cart.
<br/>
<br/>
Although source is available for the windows program that writes to the cart, I'm not sure you can get much info from that.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#65863 - Lupin - Fri Jan 06, 2006 8:21 am</h4>
    <div class="postbody"><span class="postbody">Open the cart, look for the flash ICs part number, google for a datasheet and then follow the instructions in the datasheet to write to the cart. This will work as long as the cart doesn't have some kind of custom interface or non standard flash memory (which i doubt).<br/>_________________<br/><a class="postlink" href="http://pokeme.shizzle.it/" target="_blank">Team Pokeme</a>
<br/>
<a class="postlink" href="http://lupin.shizzle.it/" target="_blank">My blog and PM ASM tutorials</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#65866 - Filb - Fri Jan 06, 2006 8:56 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dwedit wrote:</b></span></td> </tr> <tr> <td class="quote">There is code out there for the Flash2Advance cartridges that I've tested and verified works, but I don't know about the others.</td> </tr></table><span class="postbody">Where to find it?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#65871 - crossraleigh - Fri Jan 06, 2006 9:59 am</h4>
    <div class="postbody"><span class="postbody">There is NeoFlash register info at <a class="postlink" href="http://www.bottledlight.com/ds/index.php/Hardware/FlashCartridges" target="_blank">http://www.bottledlight.com/ds/index.php/Hardware/FlashCartridges</a>. I don't know about F2A.
<br/>
<br/>
By the way, Locke, your cel-shaded fighter sounds interesting. I'm looking forward to a demo.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#65927 - Dwedit - Fri Jan 06, 2006 9:00 pm</h4>
    <div class="postbody"><span class="postbody">Found it, look for cartlib.c inside <a href="http://www.devrs.com/gba/files/flgba.zip" target="_blank">http://www.devrs.com/gba/files/flgba.zip</a>
<br/>
(from <a href="http://www.devrs.com/gba/software.php#misc" target="_blank">http://www.devrs.com/gba/software.php#misc</a> )<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#66211 - Locke - Mon Jan 09, 2006 1:19 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>crossraleigh wrote:</b></span></td> </tr> <tr> <td class="quote">There is NeoFlash register info at <a class="postlink" href="http://www.bottledlight.com/ds/index.php/Hardware/FlashCartridges" target="_blank">http://www.bottledlight.com/ds/index.php/Hardware/FlashCartridges</a>. I don't know about F2A.
<br/>
<br/>
By the way, Locke, your cel-shaded fighter sounds interesting. I'm looking forward to a demo.</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Bottledlight wrote:</b></span></td> </tr> <tr> <td class="quote"><span style="font-weight: bold">Unlock sequence:
<br/>
<br/>
<br/>
  0x09555554:16 = 0xAAAA
<br/>
  0x08AAAAAA:16 = 0x5555
<br/>
<br/>
<br/>
Any read to the AD mux bus will disable the 'unlock'.</span>
<br/>
<br/>
The following registers are on the compatible bus (0x0E00xxxx on the GBA, 0x0A00xxxx on the DS), and are thus 8 bits wide.
<br/>
<br/>
Save memory type register (0xFFF8)
<br/>
7	6	5	4	3	2	1	0
<br/>
0	1	1	1	1	Mode
<br/>
<br/>
Mode:
<br/>
<br/>
    * 000: 32 KB SRAM
<br/>
    * 001: 64 KB Flash
<br/>
    * 010: EEPROM
<br/>
    * 101: 128 KB Flash (bankswitched with 0xB0)
<br/>
    * dunno about other values 
<br/>
<br/>
Flash offset register (0xFFFE)
<br/>
7	6	5	4	3	2	1	0
<br/>
A23	A22	A21	A20	A19	A18	A17	A16
<br/>
<br/>
Save memory offset register (0xFFFF)
<br/>
7	6	5	4	3	2	1	0
<br/>
Fixed	Shared	SRAM	EEPROM
<br/>
1	H2	H1	H0	A15	A15	A14	A13
<br/>
<br/>
Notes:
<br/>
<br/>
    * The high address bits are shared for all 3 types of memory
<br/>
    * EEPROM specific bits are only used for EEPROM
<br/>
    * SRAM A15 should be zero when using Flash 
<br/>
<br/>
<span style="font-weight: bold">The flash chip (Intel Z412LA35A on the NeoFlash cart) can be erased/written after being unlocked.</span> If anyone has chip names for Xg1 / Xg2 carts, I'd appreciate the information. </td> </tr></table><span class="postbody">
<br/>
<br/>
So from that last info I gess that in order to unlock the cart i need to write those two values into the appropiate addreses, so my code should be as follows:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void writeROM(char* src, int size) 
<br/>
{
<br/>
  char* dest = 0x08000000;
<br/>
<br/>
  *(uint16 *)0x09555554 = 0xAAAA;
<br/>
  *(uint16 *)0x08AAAAAA = 0x5555;
<br/>
<br/>
  while(size--)
<br/>
      *dest++ = *src++;
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
or, in case that the addreses are relative to the start of the flash chip and not to the NDS memory map:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void writeROM(char* src, int size) 
<br/>
{
<br/>
  char* dest = 0x08000000;
<br/>
<br/>
  *(uint16 *)(0x09555554 + dest) = 0xAAAA;
<br/>
  *(uint16 *)(0x08AAAAAA + dest) = 0x5555;
<br/>
<br/>
  while(size--)
<br/>
      *dest++ = *src++;
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
It's nosense, there must be something I'm doing wrong... maybe someone wiser than me can find the problem?  :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#66245 - tepples - Mon Jan 09, 2006 6:42 am</h4>
    <div class="postbody"><span class="postbody">The unlocking for the flash chip is separate from the unlocking for the bankswitching and save type configuration.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#66339 - Locke - Mon Jan 09, 2006 9:58 pm</h4>
    <div class="postbody"><span class="postbody">Ok, I think I give up. There is no technical reference for the Intel Z412LA35A anywhere on the net. Even the Intel component database has no entry related to this item, and I can't unlock it without the correct secuence.
<br/>
<br/>
Thank you all. Although useless, it was very instructive.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
