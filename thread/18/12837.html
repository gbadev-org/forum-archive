<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>[SOLVED]Help with glLight() ,please. - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > [SOLVED]Help with glLight() ,please.</h2>
<div id="posts">
<div class="post">
    <h4>#123281 - adzz182 - Mon Mar 26, 2007 11:15 pm</h4>
    <div class="postbody"><span class="postbody">Im new to openGL programming, im kinda making a 3D terrain navigating engine to practice programming. I think i have got the navigation bit sorted, but i am having trouble with toon shading and lighting. Could you please take a quick look over my code and discover why the lighting doesnt seem to work. I know its abit long, but i included the whole code so anyone that would like to compile it themselves can.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include &lt;nds.h&gt;
<br/>
#include &lt;stdio.h&gt;
<br/>
#define ROTSPEED 6
<br/>
#define MOVESPEED 15
<br/>
#define piOver180 0.01745329252
<br/>
<br/>
int DrawGLScene();
<br/>
<br/>
int32 xpos;
<br/>
int32 zpos;
<br/>
int heading,heading90; 
<br/>
int map_size=8;
<br/>
bool done = FALSE;
<br/>
<br/>
int main()
<br/>
{
<br/>
   powerON(POWER_ALL);
<br/>
<br/>
   videoSetMode(MODE_0_3D);
<br/>
   videoSetModeSub(MODE_0_2D | DISPLAY_BG0_ACTIVE);
<br/>
   vramSetBankC(VRAM_C_SUB_BG);
<br/>
   BG_PALETTE_SUB[255] = RGB15(31,31,0);
<br/>
   consoleInitDefault((u16*)SCREEN_BASE_BLOCK_SUB(31), (u16*)CHAR_BASE_BLOCK_SUB(0), 16);
<br/>
<br/>
   irqInit();
<br/>
   irqEnable(IRQ_VBLANK);
<br/>
<br/>
   glViewPort(0,0,255,191);
<br/>
<br/>
<br/>
   glClearColor(8,8,31);
<br/>
   glClearDepth(0x7FFF);
<br/>
<br/>
   glSetToonTableRange( 0, 0, RGB15(0,0,0));
<br/>
   glSetToonTableRange( 1, 12, RGB15(10,10,10) );
<br/>
   glSetToonTableRange( 13, 31, RGB15(25,25,25) );
<br/>
<br/>
   while(1)
<br/>
   {
<br/>
      glReset();
<br/>
<br/>
      glMatrixMode(GL_PROJECTION);
<br/>
      glLoadIdentity();
<br/>
      gluPerspective(35, 256.0 / 192.0, 0.1, 40);
<br/>
<br/>
      glLight(0, RGB15(31,31,31),0,floattov10(-1.0),0);
<br/>
<br/>
      glMatrixMode(GL_MODELVIEW);
<br/>
<br/>
      glMaterialf(GL_AMBIENT, RGB15(8,8,8));
<br/>
      glMaterialf(GL_DIFFUSE, RGB15(24,24,24));
<br/>
      glMaterialf(GL_SPECULAR, RGB15(0,0,0));
<br/>
      glMaterialf(GL_EMISSION, RGB15(0,0,0));
<br/>
<br/>
      glPolyFmt(POLY_ALPHA(31) | POLY_CULL_BACK | POLY_FORMAT_LIGHT0 | POLY_FORMAT_LIGHT1 | POLY_TOON_SHADING);
<br/>
<br/>
<br/>
scanKeys();
<br/>
      heading90  = ((heading+128)&amp;511);
<br/>
      if (keysHeld() &amp; KEY_LEFT)
<br/>
      {
<br/>
         xpos -= SIN[heading90] &gt;&gt; 4;
<br/>
         zpos += COS[heading90] &gt;&gt; 4;
<br/>
      }
<br/>
      if (keysHeld() &amp; KEY_RIGHT)
<br/>
      {
<br/>
         xpos += SIN[heading90] &gt;&gt; 4;
<br/>
         zpos -= COS[heading90] &gt;&gt; 4;
<br/>
      }
<br/>
<br/>
      if (keysHeld() &amp; KEY_DOWN)
<br/>
      {
<br/>
<br/>
        xpos -= (SIN[heading]&gt;&gt;4);
<br/>
        zpos += (COS[heading]&gt;&gt;4);
<br/>
      }
<br/>
      if (keysHeld() &amp; KEY_UP)
<br/>
      {
<br/>
        xpos += (SIN[heading]&gt;&gt;4);
<br/>
        zpos -= (COS[heading]&gt;&gt;4);
<br/>
      }
<br/>
<br/>
      if (keysHeld() &amp; KEY_R)
<br/>
      {
<br/>
        heading=(heading+ROTSPEED)&amp;511;
<br/>
      }
<br/>
      if(keysHeld() &amp; KEY_L)
<br/>
      {
<br/>
        heading=(heading-ROTSPEED)&amp;511;
<br/>
      }
<br/>
<br/>
<br/>
            glPushMatrix();   
<br/>
<br/>
      DrawGLScene();
<br/>
      
<br/>
      glPopMatrix(1);
<br/>
      swiWaitForVBlank();
<br/>
      glFlush();
<br/>
   }
<br/>
<br/>
   return 0;
<br/>
}
<br/>
<br/>
int DrawGLScene()
<br/>
{
<br/>
   glRotatef32i(-25,(1&lt;&lt;12),0,0);
<br/>
   glRotatef32i((512-heading),0,(1&lt;&lt;12),0);
<br/>
   glTranslate3f32(-xpos+(SIN[heading]&lt;&lt;1),0.0f,-zpos-(COS[heading]&lt;&lt;1));   
<br/>
<br/>
   glBegin(GL_QUADS);
<br/>
     int x,z;
<br/>
     glVertex3f(-1.0f,-1.0f,1.0f);
<br/>
     glVertex3f(1.0f,-1.0f,1.0f);
<br/>
     glVertex3f(1.0f,1.0f,1.0f);
<br/>
     glVertex3f(-1.0f,1.0f,1.0f);
<br/>
<br/>
     glVertex3f(1.0f,-1.0f,1.0f);
<br/>
     glVertex3f(1.0f,-1.0f,-1.0f);
<br/>
     glVertex3f(1.0f,1.0f,-1.0f);
<br/>
     glVertex3f(1.0f,1.0f,1.0f);
<br/>
<br/>
     glVertex3f(1.0f,-1.0f,-1.0f);
<br/>
     glVertex3f(-1.0f,-1.0f,-1.0f);
<br/>
     glVertex3f(-1.0f,1.0f,-1.0f);
<br/>
     glVertex3f(1.0f,1.0f,-1.0f);
<br/>
<br/>
     glVertex3f(-1.0f,-1.0f,-1.0f);
<br/>
     glVertex3f(-1.0f,-1.0f,1.0f);
<br/>
     glVertex3f(-1.0f,1.0f,1.0f);
<br/>
     glVertex3f(-1.0f,1.0f,-1.0f);
<br/>
<br/>
     glVertex3f(-1.0f,1.0f,1.0f);
<br/>
     glVertex3f(1.0f,1.0f,1.0f);
<br/>
     glVertex3f(1.0f,1.0f,-1.0f);
<br/>
     glVertex3f(-1.0f,1.0f,-1.0f);
<br/>
<br/>
     glVertex3f(-1.0f,-1.0f,1.0f);
<br/>
     glVertex3f(1.0f,-1.0f,1.0f);
<br/>
     glVertex3f(1.0f,-1.0f,-1.0f);
<br/>
     glVertex3f(-1.0f,-1.0f,-1.0f);
<br/>
<br/>
<br/>
   for(x=-map_size;x&lt;map_size;x+=1.0f)
<br/>
   {
<br/>
     for(z=-map_size;z&lt;map_size;z+=1.0f)
<br/>
     {
<br/>
       glVertex3f(x     ,-1.0f,z     );
<br/>
       glVertex3f(x     ,-1.0f,z-1.0f);
<br/>
<br/>
       glVertex3f(x-1.0f,-1.0f,z-1.0f);
<br/>
       glVertex3f(x-1.0f,-1.0f,z     );
<br/>
     }
<br/>
     }
<br/>
   glEnd();
<br/>
   SUB_BG0_CR = BG_MAP_BASE(31);
<br/>
   consoleClear();
<br/>
   iprintf("X-Position : %d\n",xpos);
<br/>
   iprintf("Z-Position : %d\n",zpos);
<br/>
   iprintf("SIN[hding] : %d\n",SIN[heading]&gt;&gt;4);
<br/>
   iprintf("COS[hding] : %d\n",COS[heading]&gt;&gt;4);
<br/>
   iprintf("Heading    : %d\n",heading);
<br/>
   iprintf("512-Rot    : %d\n",(512-heading));
<br/>
   iprintf("Map Size   : %d\n",map_size);
<br/>
   return TRUE;
<br/>
}
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Thanks alot,
<br/>
adam</span><span class="gensmall"><br/><br/>Last edited by adzz182 on Tue Mar 27, 2007 9:41 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#123305 - ikaris - Tue Mar 27, 2007 5:00 am</h4>
    <div class="postbody"><span class="postbody">Your geometry doesn't have any normals...
<br/>
<br/>
You can't have lighting without normals.
<br/>
<br/>
Look into using </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">glNormal3f</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123331 - adzz182 - Tue Mar 27, 2007 9:31 am</h4>
    <div class="postbody"><span class="postbody">thanks alot, ill look into it</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123362 - ikaris - Tue Mar 27, 2007 5:50 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>adzz182 wrote:</b></span></td> </tr> <tr> <td class="quote">thanks alot, ill look into it</td> </tr></table><span class="postbody">
<br/>
<br/>
Also, here's the source for a simple viewer I wrote that has a glLight working on a torus.
<br/>
<br/>
Take a look at it, and it might help you out.
<br/>
<br/>
<a href="http://www.vurtx.com/ds/DSViewerLights.zip" target="_blank">http://www.vurtx.com/ds/DSViewerLights.zip</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123375 - adzz182 - Tue Mar 27, 2007 7:28 pm</h4>
    <div class="postbody"><span class="postbody">ah thanks alot, its ok i have it working now.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
