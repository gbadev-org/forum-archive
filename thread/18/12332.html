<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Separate DATA and CODE - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Separate DATA and CODE</h2>
<div id="posts">
<div class="post">
    <h4>#117217 - Risine - Fri Feb 02, 2007 1:38 pm</h4>
    <div class="postbody"><span class="postbody">I'd like to put my data as files on the rom, and no more as .H included in the code ( limited to 4Mo ).
<br/>
Let's suppose I have 10Mo of pcx files ( I'm using EZ-Flash2 ), what are the possibilities?
<br/>
<br/>
1/ The one I'd rather use is with fopen/fread/.... Is it possible this way?
<br/>
If possible, how do I add data files to the ROM?
<br/>
<br/>
2/ GBFS Is it possible this way too?
<br/>
Are the steps below ok?
<br/>
gbfs toto.gbfs img1.pcx img2.pcx hop.bin story/diag ...
<br/>
padbin 16 hop.ds.gba
<br/>
copy /b hop.ds.gba+toto.gbfs hop.ds.gba</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117218 - scknight - Fri Feb 02, 2007 1:49 pm</h4>
    <div class="postbody"><span class="postbody">You can use ndstool to put files in the filesystem of the rom. Just use 
<br/>
<br/>
ndstool -x mygame.nds -9 arm9.bin -7 arm7.bin -d myfolder 
<br/>
<br/>
where your folder contains your data. However as far as I know there are no library options for reading the filesystem and youll have to write your own code to read the files from the rom</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117220 - silent_code - Fri Feb 02, 2007 2:40 pm</h4>
    <div class="postbody"><span class="postbody">go with gbfs. on the nds you need to align the rom to 256, afaik. i attach the filesystem to the nds file, not the ds.gba, then dsbuild it. don't know of any problems when attaching to the.gba, but some cards need .nds files, some need .gba files. that way you have them both.
<br/>
there are some good tutorials on this topic, like <a class="postlink" href="http://www.double.co.nz/nintendo_ds/nds_develop6.html" target="_blank">http://www.double.co.nz/nintendo_ds/nds_develop6.html</a>.
<br/>
<br/>
happy coding!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117229 - Risine - Fri Feb 02, 2007 4:03 pm</h4>
    <div class="postbody"><span class="postbody">Guys, just wondering if I'm not saying wrong things :
<br/>
<br/>
Do data compiled as .H files using bin2o affect available RAM in the executable?
<br/>
I mean, can I add 10Mo of .H data in the program without affecting the available RAM while running?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117233 - wintermute - Fri Feb 02, 2007 5:51 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>scknight wrote:</b></span></td> </tr> <tr> <td class="quote">You can use ndstool to put files in the filesystem of the rom. Just use 
<br/>
<br/>
ndstool -x mygame.nds -9 arm9.bin -7 arm7.bin -d myfolder 
<br/>
<br/>
where your folder contains your data. However as far as I know there are no library options for reading the filesystem and youll have to write your own code to read the files from the rom</td> </tr></table><span class="postbody">
<br/>
<br/>
so what was the point of mentioning this at all?<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117242 - sumiguchi - Fri Feb 02, 2007 8:09 pm</h4>
    <div class="postbody"><span class="postbody">why not use libfat?  With DLDI I would anticipate that it will provide the best compatability in the long term and gives you read and write capabilities.  Plus you don't even need to add the files to your Rom, just put them on the media.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117256 - josath - Fri Feb 02, 2007 9:45 pm</h4>
    <div class="postbody"><span class="postbody">I believe EZ-Flash2 is an old-style gba flashcart. Which means to use libfat, you'd need to build an FCSR image.
<br/>
<br/>
There are some scripts for doing this on Windows and Linux, see GPF's page: <a href="http://gpf.dcemu.co.uk/" target="_blank">http://gpf.dcemu.co.uk/</a> download the 'fcsrimage.zip' on the left sidebar.
<br/>
<br/>
The advantage of this method, is that you could distribute both the datafiles, and the FCSR image, and your code would work on pretty much every device out there (anything that supports gbarom OR libfat. The only things it wouldn't work on might be a few obscure slot-1 devices).
<br/>
<br/>
Basically the flow is like this:
<br/>
1. Put all your PCX files in some data/ directory (don't convert them with bin2o)
<br/>
2. in your code, use something like:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
fatInitDefault(); //initalize filesystem
<br/>
<br/>
struct stat fileStat; //struct to hold info about file
<br/>
stat("/data/person.pcx", fileStat); // read file info
<br/>
int fileSize = fileStat.st_size; // get filesize
<br/>
<br/>
FILE *personFile = fopen("/data/person.pcx", "rb"); // open file
<br/>
u8 *buffer = (char *)malloc(fileSize); //allocate memory
<br/>
fread(buffer, 1, fileSize, personFile); //read file into memory
<br/>
fclose(personFile); //close file
<br/>
<br/>
sImage personImg; //image struct
<br/>
loadPCX(buffer, &amp;personImg); //load the PCX into the image struct
<br/>
int imageSize = personImg.width * personImg.height; // calculate size of image data. assumes 8-bit image
<br/>
<br/>
dmaCopy(personImg.image.data8, SPRITE_GFX, imageSize); //copy image data into VRAM
<br/>
</td> </tr></table><span class="postbody">
<br/>
3. Compile your app
<br/>
<br/>
For GBA Flashcart users:
<br/>
4. Create your FCSR image containing the data/ directory
<br/>
5. padbin the .ds.gba file
<br/>
6. Append the FCSR image to the .ds.gba file
<br/>
7. flash the .ds.gba file to your GBA cart
<br/>
<br/>
For Media cart users:
<br/>
4. Copy the data/ directory to your SD/CF card
<br/>
5. Copy the .nds file to your SD/CF card</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117257 - Risine - Fri Feb 02, 2007 10:07 pm</h4>
    <div class="postbody"><span class="postbody">Thanks everybody, I'll give a try to these solutions if I don't find a way for data .H files.
<br/>
<br/>
I tried to insert a data file around 13Mo ( as a .H ), and the link failed :
<br/>
"
<br/>
region ewram is full 
<br/>
section .init [02000000 -&gt; 0200023b] overlaps section .ARM.extab [02000000 -&gt; 020001af]
<br/>
section .ARM.exidx [020001b0 -&gt; 0200061f] overlaps section .init [02000000 -&gt; 0200023b]
<br/>
.......
<br/>
"
<br/>
<br/>
Is there a way to link that stuff and allow big data .H files?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117258 - rodif - Fri Feb 02, 2007 10:23 pm</h4>
    <div class="postbody"><span class="postbody">Your arrays need to be declared as 
<br/>
<br/>
static const int something[] = {};
<br/>
<br/>
const keyword tells the linker to put the data on the cart not epram</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117259 - josath - Fri Feb 02, 2007 10:27 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>rodif wrote:</b></span></td> </tr> <tr> <td class="quote">Your arrays need to be declared as 
<br/>
<br/>
static const int something[] = {};
<br/>
<br/>
const keyword tells the linker to put the data on the cart not epram</td> </tr></table><span class="postbody">
<br/>
<br/>
That doesn't work on DS, you must be thinking of GBA. You are still limited to 4MB (actually a bit less) for your arm9 binary. Anything that gets linked, gets put into the binary. If you want more than 4MB of data, you need it attached some other way: appended gbfs/romfs/fcsr, or libfat to read directly from SD/CF.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117269 - rodif - Fri Feb 02, 2007 11:56 pm</h4>
    <div class="postbody"><span class="postbody">shoot forgot what form i was replying on.
<br/>
<br/>
ignore me</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117412 - silent_code - Sun Feb 04, 2007 7:48 pm</h4>
    <div class="postbody"><span class="postbody">to put it straigth: FORGET ABOUT .H FILES (containing your game data)! ;) they contain persistent data, but you want dynamic data. use one of the librarys mentioned above. hope that makes it clear. ;p</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
