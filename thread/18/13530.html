<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>DLDI/libfat: How to rename/move a file/directory? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > DLDI/libfat: How to rename/move a file/directory?</h2>
<div id="posts">
<div class="post">
    <h4>#132601 - psychowood - Thu Jun 28, 2007 3:29 am</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
isn't out there a working function to move a directory? I'm trying with the POSIX rename but it doesn't work (neither for a dir nor for a single file)...
<br/>
<br/>
Am I missing something? Please don't tell me I have to open-read-write-close every file... :|
<br/>
<br/>
TIA</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#132603 - DragonMinded - Thu Jun 28, 2007 3:33 am</h4>
    <div class="postbody"><span class="postbody">It's the rename function, but I think it works on files individually.<br/>_________________<br/>Enter the mind of the dragon.
<br/>
<br/>
<a href="http://dragonminded.blogspot.com" target="_blank">http://dragonminded.blogspot.com</a>
<br/>
<br/>
Seriously guys, how hard is it to simply TRY something yourself?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#132630 - psychowood - Thu Jun 28, 2007 9:39 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>DragonMinded wrote:</b></span></td> </tr> <tr> <td class="quote">It's the rename function, but I think it works on files individually.</td> </tr></table><span class="postbody">
<br/>
<br/>
I did try for a single file (to move 'rename("/DIR/filename.ext","/filename.ext")' or to rename 'rename("/DIR/filename.ext","/DIR/filenameB.ext")' ) but doesn't work either, both on No$GBA with FCSR and on a real cart (EZ4 with the correct dldi driver).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#132637 - spinal_cord - Thu Jun 28, 2007 10:13 am</h4>
    <div class="postbody"><span class="postbody">Would you not have to COPY then file to the new location, then delete the original? Thats how I would tackle it.<br/>_________________<br/>I'm not a boring person, it's just that boring things keep happening to me.
<br/>
<a class="postlink" href="http://spinal.dizidesigns.co.uk/" target="_blank">Homepage</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#132640 - psychowood - Thu Jun 28, 2007 10:21 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>spinal_cord wrote:</b></span></td> </tr> <tr> <td class="quote">Would you not have to COPY then file to the new location, then delete the original? Thats how I would tackle it.</td> </tr></table><span class="postbody">
<br/>
<br/>
Yep, that's what I'm going to do now, but I thought that using a known working function would've been safer, and a lot quicker, too.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#132641 - kusma - Thu Jun 28, 2007 10:33 am</h4>
    <div class="postbody"><span class="postbody">doesn't the copy/delete approach require twice the amount of disk-space for the file?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#132643 - psychowood - Thu Jun 28, 2007 10:39 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>kusma wrote:</b></span></td> </tr> <tr> <td class="quote">doesn't the copy/delete approach require twice the amount of disk-space for the file?</td> </tr></table><span class="postbody">
<br/>
<br/>
Yes but, at least in this specific case, it isn't a problem, because it will be used to move many small files (savers).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#132660 - spinal_cord - Thu Jun 28, 2007 1:54 pm</h4>
    <div class="postbody"><span class="postbody">Are we going to see a DS explorer any time soon, or are these just tests?<br/>_________________<br/>I'm not a boring person, it's just that boring things keep happening to me.
<br/>
<a class="postlink" href="http://spinal.dizidesigns.co.uk/" target="_blank">Homepage</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#132668 - psychowood - Thu Jun 28, 2007 2:41 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>spinal_cord wrote:</b></span></td> </tr> <tr> <td class="quote">Are we going to see a DS explorer any time soon, or are these just tests?</td> </tr></table><span class="postbody">
<br/>
<br/>
Not made by me, at least not anytime soon, sorry.
<br/>
I'm just doing a tool to help EZIV users to go around the 80 files limit of that flashcard.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#132735 - tepples - Fri Jun 29, 2007 12:49 am</h4>
    <div class="postbody"><span class="postbody">I'd make a file manager for the DS myself in order to get away from the gba_nds_fat bugs that are still in the popular one, but it appears that unless you have two adapters one in each slot, it's just not practical to copy files from one card to another.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#132739 - spinal_cord - Fri Jun 29, 2007 1:15 am</h4>
    <div class="postbody"><span class="postbody">I like the idea of copying between two cards, I have R4 and GBAMP, the larger card being in my GBAMP. I'd like to be able to use my DS to copy files frem the microsd card in the R4 to the GBAMP, so I can use the microsd in peoples phones, and copy mp3 ringtones and I'm starting to sound a little childish, but it IS a good idea.<br/>_________________<br/>I'm not a boring person, it's just that boring things keep happening to me.
<br/>
<a class="postlink" href="http://spinal.dizidesigns.co.uk/" target="_blank">Homepage</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#132814 - cory1492 - Fri Jun 29, 2007 8:39 pm</h4>
    <div class="postbody"><span class="postbody">To quote myself... when attempting to use
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">rename(const char *old, const char *new)</td> </tr></table><span class="postbody">
<br/>
which should work on both files and direcotries if implemented right (and as far as I can tell the code is there so it should be working), after the call, errno is 134 (ENOTSUP /* Not supported */); the only function I am seeing that error returned from in libfat is "_FAT_link_r" which is not called by the rename function (_FAT_rename_r).
<br/>
<br/>
Maybe I'm missing something else?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#132842 - kusma - Sat Jun 30, 2007 2:09 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>cory1492 wrote:</b></span></td> </tr> <tr> <td class="quote">To quote myself... when attempting to use
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">rename(const char *old, const char *new)</td> </tr></table><span class="postbody">
<br/>
which should work on both files and direcotries if implemented right (and as far as I can tell the code is there so it should be working), after the call, errno is 134 (ENOTSUP /* Not supported */); the only function I am seeing that error returned from in libfat is "_FAT_link_r" which is not called by the rename function (_FAT_rename_r).
<br/>
<br/>
Maybe I'm missing something else?</span></td> </tr></table><span class="postbody">
<br/>
<br/>
According to <a href="http://devkitpro.cvs.sourceforge.net/devkitpro/libfat/source/fatdir.c?revision=1.7&amp;view=markup" target="_blank">http://devkitpro.cvs.sourceforge.net/devkitpro/libfat/source/fatdir.c?revision=1.7&amp;view=markup</a> libfat shouldn't call _FAT_link_r, and _FAT_rename_r doesn't return ENOTSUP(as you're saying). This leads me to the conclusion that you're using an out-of-date libfat. If you aren't, add tracing to the source-code of libfat, or step through it in a debugger to see what's really going on.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#132845 - cory1492 - Sat Jun 30, 2007 3:33 am</h4>
    <div class="postbody"><span class="postbody">Could whatever accessors devoptab(sp?) provides be the source of the not supported result? I know my toolchain is dated (R20) compared to libfat (c/o and compiled on april 22), but I have never taken time to go digging through it's source to see how libfat is wired into it "under the hood".
<br/>
<br/>
For that matter, anyone have rename(,) working right this second at all (R20, recent libfat)? I'll keep digging if I know it's just the two of us with problems (though it isn't something I really need at this point).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#132853 - psychowood - Sat Jun 30, 2007 10:16 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>cory1492 wrote:</b></span></td> </tr> <tr> <td class="quote">For that matter, anyone have rename(,) working right this second at all (R20, recent libfat)? I'll keep digging if I know it's just the two of us with problems (though it isn't something I really need at this point).</td> </tr></table><span class="postbody">
<br/>
<br/>
FYI, I just recompiled libfat from source (is <a class="postlink" href="http://sourceforge.net/project/showfiles.php?group_id=114505&amp;package_id=197264" target="_blank">libfat-20070127</a> the latest one?) and I can confirm that rename(,) still throws an errno 134 (FCSR, EZ4Dlx and DSLink).
<br/>
<br/>
Edit: Same results using latest CVS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#132866 - cory1492 - Sat Jun 30, 2007 7:12 pm</h4>
    <div class="postbody"><span class="postbody">With this change in fatdir.c:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int _FAT_rename_r (struct _reent *r, const char *oldName, const char *newName) {
<br/>
   PARTITION* partition = NULL;
<br/>
   DIR_ENTRY oldDirEntry;
<br/>
   DIR_ENTRY newDirEntry;
<br/>
   const char *pathEnd;
<br/>
   u32 dirCluster;
<br/>
   return -2;
<br/>
...</td> </tr></table><span class="postbody">
<br/>
I still get -1/err 134 returned from rename(); it appears notsup/error is returned before the rename function even gets called...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#132887 - chishm - Sun Jul 01, 2007 3:09 am</h4>
    <div class="postbody"><span class="postbody">This might be a problem with the newlib rename stub calling the wrong function (link/unlink instead of rename). We will work on fixing this.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#132888 - MrD - Sun Jul 01, 2007 3:53 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">We will work on fixing this.</td> </tr></table><span class="postbody">
<br/>
<br/>
You don't half sound like the King of All Cosmos... :)<br/>_________________<br/>Not active on this forum. For Lemmings DS help see its website.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#133031 - kusma - Mon Jul 02, 2007 8:40 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote">This might be a problem with the newlib rename stub calling the wrong function (link/unlink instead of rename). We will work on fixing this.</td> </tr></table><span class="postbody">
<br/>
Could it be that it does so (link/unlink instead of rename) if the link-function is non-null?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#133075 - wintermute - Tue Jul 03, 2007 3:38 am</h4>
    <div class="postbody"><span class="postbody">Confirmed bug in my newlib stdio hackery. I have it fixed in my current devkitARM release 21 WiP, to be released "real soon now"?<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#133076 - chishm - Tue Jul 03, 2007 3:43 am</h4>
    <div class="postbody"><span class="postbody">Good to hear.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#133104 - psychowood - Tue Jul 03, 2007 8:52 am</h4>
    <div class="postbody"><span class="postbody">Nice, seems that, after all, it wasn't my fault ^^</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#133299 - cory1492 - Thu Jul 05, 2007 3:32 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>psychowood wrote:</b></span></td> </tr> <tr> <td class="quote">Nice, seems that, after all, it wasn't my fault ^^</td> </tr></table><span class="postbody">
<br/>
Nope, it was just your fault it will be fixed in some "probability factored future"(??).
<br/>
<br/>
Thanks wintermute.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
