<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Sprite touch recognition - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Sprite touch recognition</h2>
<div id="posts">
<div class="post">
    <h4>#118326 - outphase - Mon Feb 12, 2007 5:25 am</h4>
    <div class="postbody"><span class="postbody">Is there any simplified way of recognizing when a certain sprite is touched?
<br/>
<br/>
For example, I have a piano displayed and want to find out which key is touched at a certain time. Other than hardcoding specific coordinates, can sprites be able to recognize certain events?
<br/>
<br/>
pseudocode:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
if touch sprites[i]
<br/>
   return i;
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#118328 - DekuTree64 - Mon Feb 12, 2007 6:10 am</h4>
    <div class="postbody"><span class="postbody">All depends on how you want to set things up. Sometimes it's easiest to do an if statement for each sprite, sometimes you can use a grid-type system, sometimes it works well to give the sprites their own update function and have them call a callback function if they detect that they've been touched.
<br/>
<br/>
The particular problem of a piano is extra tricky because of the non-rectangular white keys. For the piano in my ever-more-slowly-progressing tracker, I use a sort of table based system. The outer interface is a function that takes the touch position, and it tells you what key is pressed, if any. The table lookups are something like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">u32 GetKey(TouchPiano *piano, u8xy touchPos)
<br/>
{
<br/>
    int touchX = touchPos.x - piano-&gt;topLeft.x;
<br/>
    int touchY = touchPos.y - piano-&gt;topLeft.y;
<br/>
<br/>
    if (touchX &lt; 0 || touchY &lt; 0 || touchX &gt;= PIANO_WIDTH || touchY &gt;= PIANO_HEIGHT)
<br/>
    {
<br/>
        return KEY_NONE;
<br/>
    }
<br/>
<br/>
    if (touchY &lt; BLACK_KEY_HEIGHT)
<br/>
    {
<br/>
        u32 key = blackKeyMap[(touchX + HALF_KEY_WIDTH) / KEY_WIDTH]
<br/>
        if (key != KEY_NONE)
<br/>
            return key;
<br/>
    }
<br/>
<br/>
    return whiteKeyMap[touchX / KEY_WIDTH];
<br/>
}</td> </tr></table><span class="postbody">
<br/>
So the black key lookup is offset by half a key width (because they sit half way between two white keys), and the entries for the spaces with no black key (between B-C, and E-F) are set to none, telling it to go on and do the white key lookup.
<br/>
<br/>
It's kind of hard to explain, and the real thing is a bit more complicated because it deals with changing what the lowest key is and stuff, but hopefully that can give you an idea of other ways to do touch checking.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121887 - FRuMMaGe - Thu Mar 15, 2007 1:28 pm</h4>
    <div class="postbody"><span class="postbody">You may just want to hard code it.
<br/>
<br/>
In the paint program i'm making (my first program ^^), I just hardcoded the coordinates of the buttons I press to change the colour.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">if(specialKeysPressed &amp; (1 &lt;&lt; 6))
<br/>
      {
<br/>
         if(touchXY.py &lt; 28)
<br/>
         {
<br/>
            touchPos = 0;
<br/>
            if(touchXY.px &gt;= 19 &amp; touchXY.py &gt;= 5)
<br/>
            {
<br/>
               if(touchXY.px &lt;= 39)
<br/>
               {
<br/>
                  shape_x = 0;
<br/>
                  shape_y = 0;
<br/>
                  shape_color = RGB15(31, 31, 31);
<br/>
                  goto MAINSHAPECODE;
<br/>
               }
<br/>
               if(touchXY.px &gt;= 43 &amp; touchXY.px &lt;= 63)
<br/>
               {
<br/>
                  shape_x = 0;
<br/>
                  shape_y = 0;
<br/>
                  shape_color = RGB15(0, 31, 0);
<br/>
                  goto MAINSHAPECODE;
<br/>
               }
<br/>
               if(touchXY.px &gt;= 66 &amp; touchXY.px &lt;= 86)
<br/>
               {
<br/>
                  shape_x = 0;
<br/>
                  shape_y = 0;
<br/>
                  shape_color = RGB15(31, 0, 0);
<br/>
                  goto MAINSHAPECODE;
<br/>
               }
<br/>
               if(touchXY.px &gt;= 89 &amp; touchXY.px &lt;= 109)
<br/>
               {
<br/>
                  shape_x = 0;
<br/>
                  shape_y = 0;
<br/>
                  shape_color = RGB15(0, 0, 31);
<br/>
                  goto MAINSHAPECODE;
<br/>
               }
<br/>
               if(touchXY.px &gt;= 112 &amp; touchXY.px &lt;= 132)
<br/>
               {
<br/>
                  shape_x = 0;
<br/>
                  shape_y = 0;
<br/>
                  shape_color = RGB15(0, 31, 31);
<br/>
                  goto MAINSHAPECODE;
<br/>
               }
<br/>
               if(touchXY.px &gt;= 135 &amp; touchXY.px &lt;= 155)
<br/>
               {
<br/>
                  shape_color = RGB15(31, 31, 0);
<br/>
                  goto MAINSHAPECODE;
<br/>
               }
<br/>
               if(touchXY.px &gt;= 158 &amp; touchXY.px &lt;= 178)
<br/>
               {
<br/>
                  shape_x = 0;
<br/>
                  shape_y = 0;
<br/>
                  shape_color = RGB15(31, 0, 31);
<br/>
                  goto MAINSHAPECODE;
<br/>
               }
<br/>
               if(touchXY.px &gt;= 181 &amp; touchXY.px &lt;= 201)
<br/>
               {
<br/>
                  shape_x = 0;
<br/>
                  shape_y = 0;
<br/>
                  shape_color = RGB15(0, 0, 0);
<br/>
                  goto MAINSHAPECODE;
<br/>
               }
<br/>
               if(touchXY.px &gt;= 204 &amp; touchXY.px &lt;= 224)
<br/>
               {
<br/>
                  shape_x = 0;
<br/>
                  shape_y = 0;
<br/>
                  shape_color = RGB15(0, 15, 0);
<br/>
                  goto MAINSHAPECODE;
<br/>
               }
<br/>
               if(touchXY.px &gt;= 227 &amp; touchXY.px &lt;= 247)
<br/>
               {
<br/>
                  shape_x = 0;
<br/>
                  shape_y = 0;
<br/>
                  shape_color = RGB15(15, 0, 15);
<br/>
                  goto MAINSHAPECODE;
<br/>
               }
<br/>
               if(touchXY.px &lt;= 5)
<br/>
               {
<br/>
                  shape_x = 0;
<br/>
                  shape_y = 0;
<br/>
               }
<br/>
            }
<br/>
         }            
<br/>
         if(!(specialKeysPressed &amp; (1 &lt;&lt; 6)))
<br/>
         {
<br/>
            shape_height = 0;
<br/>
            shape_width = 0;
<br/>
            shape_x = 1;
<br/>
            shape_y = 1;
<br/>
         }
<br/>
         else
<br/>
         {
<br/>
            if(touchPos == 1)
<br/>
            {
<br/>
               shape_x = touchXY.px;
<br/>
               shape_y = touchXY.py;
<br/>
               shape_height = 3;
<br/>
               shape_width = 3;
<br/>
               goto MAINSHAPECODE;
<br/>
            }
<br/>
            if(touchPos == 0);
<br/>
            {
<br/>
               goto MAINSHAPECODE;
<br/>
            }
<br/>
         }
<br/>
      }
<br/>
}</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121889 - tyraen - Thu Mar 15, 2007 1:36 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>FRuMMaGe wrote:</b></span></td> </tr> <tr> <td class="quote">You may just want to hard code it.
<br/>
<br/>
In the paint program i'm making (my first program ^^), I just hardcoded the coordinates of the buttons I press to change the colour.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Must be fun when you decide to shift them. :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121935 - HyperHacker - Thu Mar 15, 2007 9:13 pm</h4>
    <div class="postbody"><span class="postbody">Constants come in handy there. Define some constants for the X and Y position of the group and then hardcode the buttons' positions relative to that. Of course, using an array of button coordinates is an even better solution.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122051 - tepples - Fri Mar 16, 2007 7:28 pm</h4>
    <div class="postbody"><span class="postbody">For best results, make the drawing code and the collision code use the same list of button coordinates. That's what GUIs on PCs do.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
