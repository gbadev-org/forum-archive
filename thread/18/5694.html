<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Sound questions - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > Sound questions</h2>
<div id="posts">
<div class="post">
    <h4>#42455 - b0on - Wed May 11, 2005 7:26 pm</h4>
    <div class="postbody"><span class="postbody">1) how do i load sound data?
<br/>
<br/>
2) what format can be loaded?
<br/>
<br/>
in ndslib</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#42488 - josath - Thu May 12, 2005 12:49 am</h4>
    <div class="postbody"><span class="postbody"><a href="http://drunkencoders.com/documents/DS/ndslib.htm#_Sound" target="_blank">http://drunkencoders.com/documents/DS/ndslib.htm#_Sound</a>
<br/>
<br/>
One thing...in current ndslib, the values of SOUND_ENABLE and SCHANNEL_ENABLE are swapped. Don't know if this has been fixed. If sound isn't working, try swapping them.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#42509 - b0on - Thu May 12, 2005 6:44 am</h4>
    <div class="postbody"><span class="postbody">thanks josath, but how do i load/get testwavdata?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44603 - Herve13 - Fri Jun 03, 2005 12:50 pm</h4>
    <div class="postbody"><span class="postbody">I've questions on soud too.
<br/>
<br/>
Is it possible to play music in loop ? Does it work perfectly ?
<br/>
<br/>
Is it possible to play a soudn effects on a music, or does it stop the background music ?
<br/>
<br/>
thanks in advance
<br/>
herve</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44606 - Pacifist - Fri Jun 03, 2005 3:45 pm</h4>
    <div class="postbody"><span class="postbody">there are 16 channels of sound so you can play up to 16 sounds (including music) at the same time.
<br/>
<br/>
You can repeat sounds and pan them between speakers.
<br/>
<br/>
A quick note: the version of the ndslib docs I have are ever so slightly faulty.  The code in the docs miss the SOUND_ONE_SHOT flag when it loads a sound.  Without it you'll start playing uninitialized memory.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
SCHANNEL_CR(0) = SOUND_ENABLE | SOUND_VOL(0x3F) | SOUND_ONE_SHOT;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Also, to answer b0on's question, which he has already probably answered for himself, you can download apps in the gba-dev tools section to convert from wav to bin (or c header files or whatever's your pleasure).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44650 - Herve13 - Fri Jun 03, 2005 10:22 pm</h4>
    <div class="postbody"><span class="postbody">thanks for your answers !</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44728 - Herve13 - Sat Jun 04, 2005 5:58 pm</h4>
    <div class="postbody"><span class="postbody">Pacifist, can you send me please some (working) examples ?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44733 - Pacifist - Sat Jun 04, 2005 7:14 pm</h4>
    <div class="postbody"><span class="postbody">The current state of my code isn't really conducive to a simple example.
<br/>
<br/>
It's really not that hard.  Just take the code from the ndslib docs:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
  powerON(POWER_SOUND);
<br/>
  SOUND_CR = SCHANNEL_ENABLE | SOUND_VOL(0x3F);
<br/>
<br/>
  SCHANNEL_TIMER(0) = SOUND_FREQ(22050);
<br/>
  SCHANNEL_SOURCE(0) = (u32)GETRAW( test_bin );
<br/>
  SCHANNEL_LENGTH(0) =GETRAWSIZE( test_bin )&gt;&gt;2;
<br/>
  SCHANNEL_CR(0) = SOUND_ENABLE | SOUND_VOL(0x3F) | SOUND_ONE_SHOT;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
then go to the gbadev tools section and download wav2gba.
<br/>
<br/>
download a wav file.
<br/>
note the wav must be in PCM format for wav2gba to work (right click the wav and check the 'properties' tab to find out what format it's in)
<br/>
<br/>
Use wav2gba to get your bin file.  And then you just put the bin in your resources dir and include the resulting c header file.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44740 - Herve13 - Sat Jun 04, 2005 9:50 pm</h4>
    <div class="postbody"><span class="postbody">I didn't understand how to use wav2gba to get a c file 
<br/>
so I used wav2gbac toi get a c file
<br/>
<br/>
I put your code in arm7 side, but I don't success to heard something.
<br/>
<br/>
can you help me more than that please ?
<br/>
I'm completely lost
<br/>
(it's for OMalone :-))</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44742 - Maverick - Sat Jun 04, 2005 10:32 pm</h4>
    <div class="postbody"><span class="postbody">Try this one:
<br/>
<br/>
<a class="postlink" href="http://www.double.co.nz/nintendo_ds/nds_develop4.html" target="_blank">http://www.double.co.nz/nintendo_ds/nds_develop4.html</a>
<br/>
<br/>
It is a very good tutorial and will give you the tools you need.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44743 - Herve13 - Sat Jun 04, 2005 10:38 pm</h4>
    <div class="postbody"><span class="postbody">thanks but no, because it used libnds, and I don't !</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44757 - doublec - Sun Jun 05, 2005 2:18 am</h4>
    <div class="postbody"><span class="postbody">The routines to use the sound are not really libnds specific. What toolkit are you using? The same basic code should work.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44793 - dovoto - Sun Jun 05, 2005 10:04 am</h4>
    <div class="postbody"><span class="postbody">I added a sound example to ndslib.  It is in ndslib/examples/arm7/soundPlay.  This might help a few people get sound up and running.
<br/>
<br/>
<a class="postlink" href="http://www.drunkencoders.com/tools/ds/ndslib.zip" target="_blank">www.drunkencoders.com/tools/ds/ndslib.zip</a><br/>_________________<br/><a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44879 - Herve13 - Mon Jun 06, 2005 2:35 pm</h4>
    <div class="postbody"><span class="postbody">thanks dovoto, everything works now : thanks a lot !
<br/>
<br/>
Is there a way to stop playing a sound ?
<br/>
For now I just do a SCHANNEL_CR(channel)     = 0;
<br/>
is there a better way to do this ?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#45345 - Herve13 - Thu Jun 09, 2005 9:26 pm</h4>
    <div class="postbody"><span class="postbody">Up !
<br/>
<br/>
I would like to stop playing a sound immediately now.
<br/>
Because I've a background music (so, that plays continously) for one screen, and another one for another screen (same behaviour). When I go from one to another screen, I want 
<br/>
1.stop first background music
<br/>
2.start the 2nd one
<br/>
<br/>
I'm able to start the 2nd one, but the first one doesn't stop immediately (it stops after a loop)
<br/>
<br/>
Does anyone tried this before ?
<br/>
<br/>
Thanks in advance.
<br/>
I really need that feature.
<br/>
<br/>
Herve</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#45346 - DekuTree64 - Thu Jun 09, 2005 9:31 pm</h4>
    <div class="postbody"><span class="postbody">Ya, bit31 is the enable/disable bit, so clearing that is what you want. Just zeroing the whole register like you mentioned before is the easiest way to clear it, so do that.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#45347 - Herve13 - Thu Jun 09, 2005 9:33 pm</h4>
    <div class="postbody"><span class="postbody">but it doesn't stop the sound immediately !!!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#45349 - DekuTree64 - Thu Jun 09, 2005 9:42 pm</h4>
    <div class="postbody"><span class="postbody">It should... are you sending a command of some sort from the ARM9 to stop it? If you're only checking for commands on VBlank, then that would be your delay. 
<br/>
That would be what the IPC interrupt register talked about in my <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=5856&amp;postdays=0&amp;postorder=asc&amp;start=0" target="_blank">MOD player thread</a> would help with, because you could interrupt ARM7 and tell it to stop immediately, and then safely overwrite that music data with the new song.
<br/>
Unfortunately Dovoto seems to have lost his defines for it and hasn't made new ones yet...
<br/>
<br/>
If that's not your problem, would you explain exactly how your sound system works?<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#45350 - Herve13 - Thu Jun 09, 2005 10:00 pm</h4>
    <div class="postbody"><span class="postbody">I'm exactly using sound system of "soundplay" example delivered in ndslib.
<br/>
<br/>
<br/>
So, I try to stop arm7 from arm9.
<br/>
But I didn't success.
<br/>
<br/>
<br/>
Sorry, but I don't really understand what you told me with your "IPC interrupt register".
<br/>
<br/>
Else, Dovot told me that there is a way to interrupt arm7 directly, but didn't tell me how, and I didn't find anything by myself...
<br/>
<br/>
in all cases, thanks for helping.
<br/>
If someone has some code that works, please put it here.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#45353 - doublec - Thu Jun 09, 2005 10:46 pm</h4>
    <div class="postbody"><span class="postbody">Speaking of that interrupt, I notice the DSLinux project is using a 'FIFO' to pass data between the ARM9 and ARM7:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define REG_IPCFIFOSEND (*(volatile u32*) 0x04000188)
<br/>
#define REG_IPCFIFORECV (*(volatile u32*) 0x04100000)
<br/>
#define REG_IPCFIFOCNT  (*(volatile u16*) 0x04000184)
<br/>
#define IRQ_SEND        17                      /* SEND FIFO empty */
<br/>
#define IRQ_RECV        18                      /* RECV FIFO non empty */
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Is there any information about the or their usage (Apart from the DSLinux source code)?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#45354 - doublec - Thu Jun 09, 2005 11:01 pm</h4>
    <div class="postbody"><span class="postbody">Herve13, can you post the code you are using to stop the sound? If you are trying to stop it by setting the sound registers in the ARM9 it won't work. You'll need to do that from the ARM7.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#45381 - doublec - Fri Jun 10, 2005 1:51 am</h4>
    <div class="postbody"><span class="postbody">Nevermind about the Fifo details. Got pointed to dstek on IRC:
<br/>
<br/>
<a href="http://neimod.com/dstek.html" target="_blank">http://neimod.com/dstek.html</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#45394 - Lino - Fri Jun 10, 2005 4:34 am</h4>
    <div class="postbody"><span class="postbody">when does the cpu receive the irq 17? When has it stopped sending?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#45436 - dovoto - Fri Jun 10, 2005 6:06 pm</h4>
    <div class="postbody"><span class="postbody">My notes disagree slightly with dstek for the sync register.  Here are my IPC defines for sync
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
// Synchronization register 
<br/>
#define IPC_SYNC            (*(vuint16*)0x04000180)
<br/>
#define IPC_SYNC_IRQ_ENABLE      (1&lt;&lt;14)
<br/>
#define IPC_SYNC_IRQ_REQUEST   (1&lt;&lt;13)
<br/>
#define IPC_SEND_COMMAND(n)      ((IPC_SYNC &amp; 0xF0FF) | (((n) &amp; 0xF) &lt;&lt; 8) | IPC_SYNC_IRQ_REQUEST)
<br/>
<br/>
#ifdef ARM7
<br/>
#define IPC_GET_COMMAND      (IPC_SYNC &amp; 0xF)
<br/>
#endif
<br/>
#ifdef ARM9
<br/>
#define IPC_GET_COMMAND      ((IPC_SYNC &amp; 0xF0) &gt;&gt; 4)
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
To use is rather simple. "Recieving" processor refers to the one you would like to send commands to, and "sending" the one you are sending commands from.  You can send and recieve from either or both processors.:
<br/>
<br/>
1)Enable interupts on the recieving processor.
<br/>
2)Un-mask the sync interupt (set bit 16 of IE) on the recieving processor.
<br/>
3)Enable the interupt on the recieving processor (IPC_SYNC = IPC_SYNC_IRQ_ENABLE)
<br/>
4)Install the irq handler for recieving the the command.
<br/>
5)Send the command from the sending processor (IPC_SEND_COMMAND(n))
<br/>
6)This should cause an interupt to occure on the recieving processor and you can grab the sent command with IPC_GET_COMMAND
<br/>
<br/>
These are limited to 4 bit commands.  To send actual chunks of data the fifo would be a better option.  But for a sound engine were you only have a limited number of commands to send this works great.  These defines are not in the current cvs as I lost my origals and these have not quite been tested yet (the names may change slightly).  I will try to get the cvs/zip updated this evening with an example.<br/>_________________<br/><a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#45452 - Herve13 - Fri Jun 10, 2005 7:54 pm</h4>
    <div class="postbody"><span class="postbody">nice to read this dovoto ;-)
<br/>
thanks in advance for your example</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#45471 - dovoto - Fri Jun 10, 2005 11:19 pm</h4>
    <div class="postbody"><span class="postbody">Okay here are the final defines (the obove had a few errors ...thats what I get for working from memory)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
//////////////////////////////////////////////////////////////////////
<br/>
// Synchronization register 
<br/>
<br/>
#define IPC_SYNC            (*(vuint16*)0x04000180)
<br/>
<br/>
#define IPC_SYNC_IRQ_ENABLE      (1&lt;&lt;14)
<br/>
#define IPC_SYNC_IRQ_REQUEST   (1&lt;&lt;13)
<br/>
<br/>
#define IPC_SYNC_SEND_COMMAND(n)      (IPC_SYNC = (IPC_SYNC &amp; 0xF0FF) | (((n) &amp; 0xF) &lt;&lt; 8) | IPC_SYNC_IRQ_REQUEST)
<br/>
#define IPC_SYNC_GET_COMMAND      ((IPC_SYNC &amp; 0xF) )
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
This code and the example were uploaded to cvs as well as to the zip file maintained on my site.  The example sets up recieve irq on both processors.  It sends a comand from arm9 to arm7 each vblank. The arm7 reads the comand then sends it back to the arm9 and the arm9 prints it.  This may be helpfull..may not :)
<br/>
<br/>
Arm9 code
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void irqVblank(void)
<br/>
{
<br/>
    static int heartbeat = 0;
<br/>
    heartbeat++;
<br/>
    
<br/>
    //increment about once per second
<br/>
    IPC_SYNC_SEND_COMMAND(heartbeat &gt;&gt; 6);
<br/>
    
<br/>
    IF = IRQ_VBLANK;
<br/>
}
<br/>
void irqRecieve(void)
<br/>
{
<br/>
   consolePrintf("Command Recieved: %X\n", IPC_SYNC_GET_COMMAND);
<br/>
   
<br/>
   IF = IRQ_SYNC;
<br/>
}
<br/>
int main(void)
<br/>
{
<br/>
   videoSetMode(0); 
<br/>
   videoSetModeSub(MODE_0_2D | DISPLAY_BG0_ACTIVE); 
<br/>
    vramSetBankC(VRAM_C_SUB_BG); 
<br/>
      
<br/>
   SUB_BG0_CR = BG_MAP_BASE(31);
<br/>
   BG_PALETTE_SUB[255] = RGB15(31,31,31);//by default font will be rendered with color 255
<br/>
   
<br/>
   consoleInitDefault((u16*)SCREEN_BASE_BLOCK_SUB(31), (u16*)CHAR_BASE_BLOCK_SUB(0), 16);
<br/>
   
<br/>
   irqInitHandler(irqDefaultHandler);
<br/>
<br/>
   irqSet(IRQ_VBLANK, irqVblank);
<br/>
    irqSet(IRQ_SYNC, irqRecieve);
<br/>
<br/>
   IPC_SYNC = IPC_SYNC_IRQ_ENABLE;
<br/>
   
<br/>
   while(1){}
<br/>
   
<br/>
   return 0;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
And the arm7 code
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void irqRecieve(void)
<br/>
{
<br/>
    
<br/>
    //just send it back
<br/>
    IPC_SYNC_SEND_COMMAND(IPC_SYNC_GET_COMMAND);
<br/>
    IF = IRQ_SYNC;
<br/>
}
<br/>
<br/>
int main(int argc, char ** argv) 
<br/>
{
<br/>
  // Reset the clock if needed
<br/>
  rtcReset();
<br/>
<br/>
  //enable sound
<br/>
  SOUND_CR = SCHANNEL_ENABLE | SOUND_VOL(0x7F);
<br/>
  IPC-&gt;soundData = 0;
<br/>
 
<br/>
  // Set up the interrupt handler
<br/>
   irqInitHandler(irqDefaultHandler);
<br/>
   irqSet(IRQ_VBLANK, InterruptHandler);
<br/>
   irqSet(IRQ_SYNC, irqRecieve);
<br/>
   IPC_SYNC = IPC_SYNC_IRQ_ENABLE;
<br/>
 
<br/>
  // Keep the ARM7 out of main RAM
<br/>
  while (1);
<br/>
  return 0;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
The full source is under ndslib/examples/ipc<br/>_________________<br/><a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#45493 - tepples - Sat Jun 11, 2005 5:38 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>dovoto wrote:</b></span></td> </tr> <tr> <td class="quote">These are limited to 4 bit commands.  To send actual chunks of data the fifo would be a better option.  But for a sound engine were you only have a limited number of commands to send this works great.</td> </tr></table><span class="postbody">
<br/>
But as you move to a more sophisticated sound engine, you may have to put the commands in the FIFO as well, using MIDI or a similar protocol, and collapse the IPC commands to just send() and recv().<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#45500 - DekuTree64 - Sat Jun 11, 2005 6:20 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>dovoto wrote:</b></span></td> </tr> <tr> <td class="quote">These are limited to 4 bit commands.  To send actual chunks of data the fifo would be a better option.  But for a sound engine were you only have a limited number of commands to send this works great.</td> </tr></table><span class="postbody">
<br/>
But as you move to a more sophisticated sound engine, you may have to put the commands in the FIFO as well, using MIDI or a similar protocol, and collapse the IPC commands to just send() and recv().</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Yeah, my sound commands are up to 8 bytes. I'd planned on keeping the actual command buffer just like it is, and only use the register to tell ARM7 to execute all the commands immediately, instead of having to wait for the next VBlank.
<br/>
<br/>
I could also do it with the FIFO, but I like the idea of being able to queue up a bunch of commands, and then execute them all at once. Then there's only one interrupt, and ARM9 has the option of waiting for a reply from ARM7 to say that they've all been processed, or to just trigger the IRQ and call it a done deal, leaving ARM7 to process the commands while ARM9 does other things.
<br/>
<br/>
<br/>
And Dovoto, thanks a lot for your work! I'll see if I can play with it some this weekend, tho things have been a bit hectic at work so I don't know if I'll get to it :)<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#45518 - Herve13 - Sat Jun 11, 2005 3:03 pm</h4>
    <div class="postbody"><span class="postbody">thanks for your help.
<br/>
but it's too complex for me this.
<br/>
I d'ont know how to use it to stop soudn immediately on a channel.
<br/>
could someone explain it to me please ?
<br/>
soory, I'm a newbie !</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#45594 - headspin - Sun Jun 12, 2005 2:52 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>dovoto wrote:</b></span></td> </tr> <tr> <td class="quote">I added a sound example to ndslib.  It is in ndslib/examples/arm7/soundPlay.  This might help a few people get sound up and running.
<br/>
<br/>
<a class="postlink" href="http://www.drunkencoders.com/tools/ds/ndslib.zip" target="_blank">www.drunkencoders.com/tools/ds/ndslib.zip</a></td> </tr></table><span class="postbody">
<br/>
<br/>
Thanks for the example dovoto, can you please tell me how I can find out when a sample has stopped playing in the main loop?
<br/>
<br/>
I need to play a few samples in succession, so I need to know when sound has finished playing.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   while(1)
<br/>
   {
<br/>
      
<br/>
      scanKeys();
<br/>
<br/>
      //move the cursor
<br/>
      consolePrintSet(0,10);
<br/>
      consolePrintf("Touch x = %04X\n", IPC-&gt;touchX);
<br/>
      consolePrintf("Touch y = %04X\n", IPC-&gt;touchY);   
<br/>
<br/>
      if(keysDown() &amp; KEY_A) playGenericSound(AA, (u32)AA_size);
<br/>
   
<br/>
      if(keysDown() &amp; KEY_B) playGenericSound(AE, (u32)AE_size);
<br/>
   
<br/>
      if(keysDown() &amp; KEY_X) playGenericSound(AH, (u32)AH_size);
<br/>
<br/>
      // Need to check if sound has finished playing
<br/>
   
<br/>
      waitForVBlank();
<br/>
<br/>
   }</td> </tr></table><span class="postbody"><br/>_________________<br/><a class="postlink" href="http://headsoft.com.au/index.php?category=warhawk" target="_blank">Warhawk DS</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=mmll" target="_blank">Manic Miner: The Lost Levels</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=tdg" target="_blank">The Detective Game</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#45615 - DekuTree64 - Sun Jun 12, 2005 8:02 pm</h4>
    <div class="postbody"><span class="postbody">The enable bit in the channel control gets cleared automatically when the sample ends (in one-shot mode), so you'll need a way to check that.
<br/>
<br/>
Maybe make a command you can send with the IPC_SYNC to say "has this channel ended?", and then ARM7 checks it and sends a command back with true or false.
<br/>
<br/>
Or it might be even easier to write a back-to-back sample player thing on ARM7 itself.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#45621 - headspin - Sun Jun 12, 2005 9:20 pm</h4>
    <div class="postbody"><span class="postbody">Thanks DekuTree, but a little more clarification would be great.
<br/>
<br/>
I know I need ARM9 to find out when the channel has finished.
<br/>
<br/>
if(SCHANNEL_CR(n) &amp; SOUND_ENABLE) == 0) // finished
<br/>
<br/>
..should achieve that. But how can I set up a function to store this true/false, and how can I get ARM9 to read this using IPC so that ARM7 will relay the true/false state. Sorry I've just started coding DS today sheesh.. GBA seems so much nicer to code now ;)<br/>_________________<br/><a class="postlink" href="http://headsoft.com.au/index.php?category=warhawk" target="_blank">Warhawk DS</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=mmll" target="_blank">Manic Miner: The Lost Levels</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=tdg" target="_blank">The Detective Game</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#45640 - headspin - Mon Jun 13, 2005 6:13 am</h4>
    <div class="postbody"><span class="postbody">Nevermind, got it figured<br/>_________________<br/><a class="postlink" href="http://headsoft.com.au/index.php?category=warhawk" target="_blank">Warhawk DS</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=mmll" target="_blank">Manic Miner: The Lost Levels</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=tdg" target="_blank">The Detective Game</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
