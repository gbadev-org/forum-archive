<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Loading HB via DSO - why does it work?! && Non-root - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Loading HB via DSO - why does it work?! && Non-root</h2>
<div id="posts">
<div class="post">
    <h4>#158729 - silent_code - Mon Jun 16, 2008 9:42 pm</h4>
    <div class="postbody"><span class="postbody">Hi there!
<br/>
<br/>
As I have finally started to use libfat myself very recently, I am wondering why some homebrew does not load directly through the cards firmware loader (I use an M3 Real), but does perfectly when started via DS Organize?
<br/>
<br/>
The problem is, that it's not all HB. My own ROM works fine (I only have the VSD using libfat right now...), as do others, like Quake DS and of course DSO itself! I'm just wondering how I can ommit that to happen in my own implementations?
<br/>
<br/>
Let's take StillAliveDS for example. It's a really nice game and plays pretty well, saving, loading, everything works. But only, when loaded through DSO!
<br/>
<br/>
Why is that?
<br/>
<br/>
Another example: A music program, whose last version worked perfectly, now has the same problem... Although the card uses auto-patching, so the DLDI "driver" can't be the primary problem.
<br/>
<br/>
I wonder what file systems these programs use? Is it pure libfat?
<br/>
<br/>
<br/>
Then another question: How can I make my ROM directory independent? Right now, it (and all data files) has to be in the root to work, which is "not cool." Any suggestions? Is there a manufacturer independent way?
<br/>
<br/>
<br/>
Thanks a lot in advance. :^)<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#158740 - tepples - Tue Jun 17, 2008 12:05 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>silent_code wrote:</b></span></td> </tr> <tr> <td class="quote">Then another question: How can I make my ROM directory independent? Right now, it (and all data files) has to be in the root to work, which is "not cool." Any suggestions?</td> </tr></table><span class="postbody">
<br/>
One technique developed as a <span style="font-style: italic">de facto</span> standard: install all your program's data inside "/data/myprogram/". Another is to wait for all homebrew launchers to support "argv", but that won't happen any time soon because DSO is no longer maintained. A third is to search the card for your data files using the diropen() family of functions, but that takes a while.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#158756 - Lynx - Tue Jun 17, 2008 3:32 pm</h4>
    <div class="postbody"><span class="postbody">I thought one of the reasons was that different launchers setup the hardware differently.  On the Games N Music, for example, it apparently does a poor job of setting up the hardware prior to launching the homebrew.  DSO does a much better job and is why it can pretty much launch any homebrew.  By forcing the GnM to boot strait to DSO, it allows DSO to setup the hardware before the GnM can mess it up.<br/>_________________<br/><a class="postlink" href="http://www.ndshb.com" target="_blank">NDS Homebrew Roms &amp; Reviews</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#158757 - Sektor - Tue Jun 17, 2008 3:53 pm</h4>
    <div class="postbody"><span class="postbody">Some launchers don't load the arm7 correctly if the homebrew has a WMB banner.  I know the M3 Perfect had two methods for launching homebrew (A or start) and only one of them could load homebrew with a WMB banner.<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><a class="postlink" href="http://gtamp.com/DS" target="_blank">GTAMP.com/DS</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#158758 - silent_code - Tue Jun 17, 2008 5:28 pm</h4>
    <div class="postbody"><span class="postbody">But again, why would an older version of a program boot with no problems and the newer not? (And the author doesn't know why!) Might this be due to an update in libfat? Then, why are other programs working well with the same libfat version?
<br/>
<br/>
I bet it's neither libfat, nor the loaders (although, speaking in general, they *do* cause bugs in some cases.) Is it maybe the way those programs are set up / they set up the HW? Then, what's wrong?
<br/>
<br/>
I wish, I could take a look at the sources, but both programs I have the problem with are closed source. But, if I'm not completely getting off course, one of them (StillAliveDS) uses EFS (or the like.) Though, I'm quite sure the other one doesn't... :^/
<br/>
<br/>
I am so confused! 8^\
<br/>
<br/>
The only seems to be one way to get to know more details: Ask the authors. I'll test my luck an see what I can find out.
<br/>
<br/>
<br/>
<br/>
<br/>
About the other topic:
<br/>
<br/>
I originally planned to use /data/*, but as I wanted to provide emulator support via FCSR and the fat-image creation program would not work with sub folders (I always get an error, see below), I had to go with "all in the root."
<br/>
<br/>
The output I get from the program is:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Builds a FAT disk image from a given directory.
<br/>
454053
<br/>
Creating image
<br/>
creating FAT12 image size = 0.45 MB's
<br/>
<br/>
<br/>
Working[.]DoneInjectFile("root\data\vsd_data\test.tga") failed
<br/>
Blessing image
<br/>
OK - start1:0 size1:0
<br/>
"FAT12 image built as fat.img from /root"</td> </tr></table><span class="postbody">
<br/>
<br/>
But I figured, that I could use two folders: If loading from /data/* doesn't succeed, try to load from the root. I think, I'll implement that. :^)<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#158770 - t4ils - Tue Jun 17, 2008 7:50 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">How can I make my ROM directory independent? Right now, it (and all data files) has to be in the root to work, which is "not cool." Any suggestions? Is there a manufacturer independent way? </td> </tr></table><span class="postbody">
<br/>
<br/>
My suggestion : 
<br/>
I start my homebrew by looking for the game directories on the card. If not found, i create them at the root, but you can move them later :)
<br/>
StillAliveDS don't need to be put at the root of the card, you can place files anywhere you want ;)
<br/>
e.g. : /homebrews/puzzleGame/StillAliveDS
<br/>
<br/>
<br/>
Then, this is what i'm using in stillaliveds : 
<br/>
devkitpro r21
<br/>
EFSLib V2 (and fatlib of course)
<br/>
Wifilib
<br/>
ASLib
<br/>
the game is created with PALib community update (the latest build)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#158772 - silent_code - Tue Jun 17, 2008 8:28 pm</h4>
    <div class="postbody"><span class="postbody">@ t4ils:
<br/>
Thanks for the input! :^)
<br/>
Do you have any idea what could cause the loading problem?
<br/>
I'm aware of the fact, that it (at least to my knowledge) doesn't happen on other cards, so, I assume this is a multiple factors problem...<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#158777 - t4ils - Tue Jun 17, 2008 9:05 pm</h4>
    <div class="postbody"><span class="postbody">I received an email  stating that ...
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<span style="font-weight: bold">M3/G6 Homebrew Loader  	</span>
<br/>
<br/>
As the M3 and G6 firmwares turn off the power to the 2D cores before running a program, homebrew which does not remember to turn the power on does not run on these flash carts.
<br/>
<br/>
Homebrew authors can ensure M3/G6 compatibility by adding "powerON(POWER_ALL_2D|POWER_SWAP_LCDS);".
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
First, "POWER_SWAP_LCDS" swap screens, so I can't put it in my code
<br/>
maybe I can swap them again right after the powerON
<br/>
<br/>
secondly, I'm already making powerON in my homebrew (powerOn(POWER_ALL)
<br/>
<br/>
so I don't know if it's the solution</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#158779 - silent_code - Tue Jun 17, 2008 9:29 pm</h4>
    <div class="postbody"><span class="postbody">POWER_SWAP_LCDS is optional.
<br/>
I don't use it either and I only power up what's needed, still, my programs run flawlessly on the M3. :^/
<br/>
<br/>
Good try, though!
<br/>
<br/>
PS: If you use lcdMainOnTop() (or bottom), you can ensure your display setup is correct.
<br/>
<br/>
I don't know, but may it have something to do with PAlib?
<br/>
Other PAlib users: any simmilar experiences?
<br/>
<br/>
The other software doesn't use PAlib, though. It's not causing the problem. :^/
<br/>
<br/>
At this point, I can only offer to help with debugging. I think I could hunt down the cause of the problem, if given access to sources, that exhibit that bug.<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#158793 - Sweater Fish Deluxe - Tue Jun 17, 2008 11:53 pm</h4>
    <div class="postbody"><span class="postbody">I'm sure I've read somewhere that there is a problem loading EFSlib homebrews on the M3/G6 Real, so that's probably what you're running into.  I don't know the exact source of the problem, but maybe Noda has some idea.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>t4ils wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">How can I make my ROM directory independent? Right now, it (and all data files) has to be in the root to work, which is "not cool." Any suggestions? Is there a manufacturer independent way?</td> </tr></table><span class="postbody">
<br/>
My suggestion : 
<br/>
I start my homebrew by looking for the game directories on the card. If not found, i create them at the root, but you can move them later :)</span></td> </tr></table><span class="postbody">
<br/>
I think this is a great solution since argv won't be implemented any time soon in the default loaders most flash cards use, however I definitely think throwing up a splash screen or even a loading screen before doing the search is a good idea so that users know the game has loaded correctly.  Depending on how the card is layed out, the search can take 2 or 3 or more seconds.  If there's nothing to show that the game has loaded during that time, your average antsy ADD flash cart gamer will often think the game isn't working at all and turn it off and then come to you asking why the game isn't working on their card.
<br/>
<br/>
EFSlib makes a similar search when you init it (at least the first time it's run), so you'd want to put up some graphics before initing EFS as well.
<br/>
<br/>
<br/>
...word is bondage...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#158794 - silent_code - Wed Jun 18, 2008 12:04 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Sweater Fish Deluxe wrote:</b></span></td> </tr> <tr> <td class="quote">your average antsy ADD flash cart gamer</td> </tr></table><span class="postbody">
<br/>
Not funny. :^\
<br/>
<br/>
But you are right, at least the console should be initialized and some text printed... unless the problem happens even before control is handed over to your program (e.g. "before" main()). :^(<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#158881 - dantheman - Fri Jun 20, 2008 5:25 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>silent_code wrote:</b></span></td> </tr> <tr> <td class="quote">I originally planned to use /data/*, but as I wanted to provide emulator support via FCSR and the fat-image creation program would not work with sub folders (I always get an error, see below), I had to go with "all in the root."
<br/>
<br/>
The output I get from the program is:
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Builds a FAT disk image from a given directory.
<br/>
454053
<br/>
Creating image
<br/>
creating FAT12 image size = 0.45 MB's
<br/>
<br/>
<br/>
Working[.]DoneInjectFile("root\data\vsd_data\test.tga") failed
<br/>
Blessing image
<br/>
OK - start1:0 size1:0
<br/>
"FAT12 image built as fat.img from /root"</td> </tr></table><span class="postbody">
<br/>
<br/>
But I figured, that I could use two folders: If loading from /data/* doesn't succeed, try to load from the root. I think, I'll implement that. :^)</span></td> </tr></table><span class="postbody">
<br/>
<br/>
The BFI.exe file is a bit broken, causing that error.  See <a href="http://forum.gbadev.org/viewtopic.php?t=15369" target="_blank">http://forum.gbadev.org/viewtopic.php?t=15369</a> for a more stable program to use.  Modify the build.bat file so that instead of the following line:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">bfi.exe -f=%1 %2</td> </tr></table><span class="postbody">
<br/>
it says this instead:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">add_to_disk_image.exe %1 %2</td> </tr></table><span class="postbody">
<br/>
<br/>
Then try again.  If this works, please reconsider using the DATA directory, as it helps declutter the root folder.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#158895 - silent_code - Fri Jun 20, 2008 11:22 am</h4>
    <div class="postbody"><span class="postbody">I have implemented the two directories approach in the new release (out now) and it works fine, but I will definitely give this a try. Thanks! :^)<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#158958 - Noda - Mon Jun 23, 2008 7:49 am</h4>
    <div class="postbody"><span class="postbody">Concerning the M3Real problem, it seems its loader / dldi patcher is rather bad.
<br/>
<br/>
It doesn't work with latest PAlib for example because the arm7 makes use tight usage of its working ram, and some people reported that cleaning a little the arm7 memory usage makes it working on the M3R... 
<br/>
The thing is, the autodldi patcher often crash when loading some homebrew, and by crossing informations from all the feedback I had with problems concerning this linker, I suspect either their loader or their dldi patcher to allocate static memory on the shared work ram (used by the arm7), which would be causing those problems.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#158960 - silent_code - Mon Jun 23, 2008 10:02 am</h4>
    <div class="postbody"><span class="postbody">Hey Noda, that was a nice bunch of info! Thanks!
<br/>
<br/>
So, what ARM7 binary does StillAliveDS use? It's build with an older devkitARM (R21) and (probably?) current libs / current PAlib (which I guess doesn't cause the problem itself.)
<br/>
<br/>
Maybe that behaviour is becaused by the M3R loader interfering with ASlib or libwifi?
<br/>
<br/>
This is so confusing... :^/<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#158966 - Noda - Mon Jun 23, 2008 2:01 pm</h4>
    <div class="postbody"><span class="postbody">AFAIK, StillAliveDS use latest palib (which works on r21) which makes use of ASLib packed with DSWifi. Both libs fitting on the arm7 makes it very tight on arm7 working ram (64K + 32K shared) which cause the M3R loader to fail.
<br/>
<br/>
Michoko used the same Palib but removed the dswifi lib from the arm7 bin and as a result his homebrew works on M3R (and it use EFS too)...
<br/>
<br/>
Another notable thing: Michoko released a version using my new (currently under beta) EFSv2 and it seems to crash (nothing but black screen) on M3R on loading (while the same code one using EFSv1 works). EFSv2 doen't do anything fancy and oviously doesn't use any arm7 ram so it's rather strange... (and no problems with other linkers)
<br/>
<br/>
The better thing to do is probably to beg the M3R to review their loader / dldi patcher to address these issues, cause when homebrews works on all but 1 linker, I think the one who should fix this is the maker of the card.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#158968 - silent_code - Mon Jun 23, 2008 2:48 pm</h4>
    <div class="postbody"><span class="postbody">@ Noda: You are totally right. The reason I wanted to know why this would happen, is that I would like to avoid those issues in my own HB for the time the manufacturer doesn't fix the driver. :^)
<br/>
<br/>
I hope they will, eventually do just that: fix it. :^D
<br/>
<br/>
I'm going to move my project to use the new default ARM7 binary some time in my next releases. I wonder if it will work on the M3R. ;^)
<br/>
<br/>
Thanks for all the information!
<br/>
<br/>
PS @ Noda: When you release EFS2 officially, I'll definitely try it. :^)<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#159070 - HyperHacker - Wed Jun 25, 2008 3:13 am</h4>
    <div class="postbody"><span class="postbody">If clearing RAM before loading the binary fixes it, does that not mean the program is relying on the values of uninitialized variables?<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#159092 - silent_code - Wed Jun 25, 2008 11:18 am</h4>
    <div class="postbody"><span class="postbody">@ HH: Could you please elaborate a little bit, maybe give an example?<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#159111 - Noda - Wed Jun 25, 2008 5:00 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">If clearing RAM before loading the binary fixes it, does that not mean the program is relying on the values of uninitialized variables?</td> </tr></table><span class="postbody">
<br/>
<br/>
not clearing it, bug freeing up some more ram did it.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
