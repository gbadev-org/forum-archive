<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>devkitpro R12 -> R16, NDSlib -> libnds, issues - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > devkitpro R12 -> R16, NDSlib -> libnds, issues</h2>
<div id="posts">
<div class="post">
    <h4>#56956 - Didou - Wed Oct 12, 2005 4:49 pm</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
It seems that there are a serious compatibility between the <span style="font-weight: bold">NDSlib </span>and the <span style="font-weight: bold">libnds</span>. I updgraded from devkitpro <span style="font-weight: bold">R12</span> to <span style="font-weight: bold">R16</span>, then now ReboNDS doesn't behave at all as before (even after I did modifications to make it compil-able).
<br/>
<br/>
Amongst others,
<br/>
 * sounds length has to be provided in bytes instead of u32,
<br/>
 * touchpad seems to behave strangely (need to "click" twice in some cases),
<br/>
 * emulators do not run anymore the code (Ideas, Dualis) that ran before,
<br/>
<br/>
Is there a kind of check-list of what to do and not too do to port from the old NDSlib to the new libnds ?
<br/>
<br/>
It seems that interrupts init have changed. May be its the reason why the emulators do not work anymore... In particular, Ideas remains frozen on <span style="font-style: italic">swiWaitForVblank</span>.
<br/>
<br/>
Which emulator is now usable to test when coding with the R16 ? Should I remain in R12 ?
<br/>
<br/>
  -- Didou</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#57031 - Normmatt - Thu Oct 13, 2005 4:08 am</h4>
    <div class="postbody"><span class="postbody">ive had that same problem with the games not running in any emulator using devkitarm r16a so i reverted back to r15 which works fine</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#57676 - Didou - Mon Oct 17, 2005 7:17 pm</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Normmatt wrote:</b></span></td> </tr> <tr> <td class="quote">ive had that same problem with the games not running in any emulator using devkitarm r16a so i reverted back to r15 which works fine</td> </tr></table><span class="postbody">
<br/>
<br/>
I even tried to use the R15. It doesn't suck as with the R16+libnds for the touchpad ... but I lose the sound !!!!
<br/>
<br/>
WHICH version is to be used ??? It's really amazing ! Everything was perfect on the R12 !!!
<br/>
Do I need to change some compil options ?
<br/>
<br/>
  -- Didou</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#57746 - wintermute - Tue Oct 18, 2005 5:05 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Normmatt wrote:</b></span></td> </tr> <tr> <td class="quote">ive had that same problem with the games not running in any emulator using devkitarm r16a so i reverted back to r15 which works fine</td> </tr></table><span class="postbody">
<br/>
<br/>
Using an emulator as a yardstick for the compiler isn't a good idea. IdeaS appears to have problems with the bios functions for some reason. Dualis doesn't currently emulate arm7.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Didou wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
I even tried to use the R15. It doesn't suck as with the R16+libnds for the touchpad ... but I lose the sound !!!!
<br/>
<br/>
WHICH version is to be used ??? It's really amazing ! Everything was perfect on the R12 !!!
<br/>
Do I need to change some compil options ?
<br/>
<br/>
  -- Didou</td> </tr></table><span class="postbody">
<br/>
<br/>
r12 was *far* from perfect, there were a number of fairly serious problems in the linkscripts and crt0 setup. Later versions set up the mpu and cache properly which will obviously cause you problems if you don't take the cache into consideration when using DMA or using shared memory to communicate with the ARM7 ( the standard IPC struct is placed in uncached memory which helps)
<br/>
<br/>
Touchpad reading is still problematic, one of the reasons for this is that some people insist on keeping the protective layer of plastic on the touchscreen.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#57756 - Mollusk - Tue Oct 18, 2005 7:32 am</h4>
    <div class="postbody"><span class="postbody">Wintermute, while we're at it 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">the standard IPC struct is placed in uncached memory which helps</td> </tr></table><span class="postbody">
<br/>
<br/>
Deku, for his mod player, places his arm9-arm7 commands right after the IPC, so that it's placed in the uncached memory, I guess... Now the question is, how much stuff can I place there, after the IPC ? (I'd like to add some new arm9-arm7 communication stuf...)<br/>_________________<br/>PAlib official forum : <a class="postlink" href="http://www.palib.info" target="_blank">http://www.palib.info</a>
<br/>
PAlib official tutorials: <a class="postlink" href="http://www.palib.info/wiki" target="_blank">http://www.palib.info/wiki</a>
<br/>
Updates, help, code examples, tutorials, etc...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#57757 - wintermute - Tue Oct 18, 2005 7:48 am</h4>
    <div class="postbody"><span class="postbody">please don't.
<br/>
<br/>
Work is being done on implementing proper inter processor communication. Eventually the IPC struct will be removed, shared memory is a particularly poor way of implementing any form of "communication".</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#57758 - Mollusk - Tue Oct 18, 2005 7:48 am</h4>
    <div class="postbody"><span class="postbody">ok, then what would be the best and proper way ?<br/>_________________<br/>PAlib official forum : <a class="postlink" href="http://www.palib.info" target="_blank">http://www.palib.info</a>
<br/>
PAlib official tutorials: <a class="postlink" href="http://www.palib.info/wiki" target="_blank">http://www.palib.info/wiki</a>
<br/>
Updates, help, code examples, tutorials, etc...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#57774 - Didou - Tue Oct 18, 2005 12:15 pm</h4>
    <div class="postbody"><span class="postbody">Hi
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"> <span style="font-weight: bold">wintermute</span>: Later versions set up the mpu and cache properly which will obviously cause you problems if you don't take the cache into consideration when using DMA or using shared memory to communicate with the ARM7 ( the standard IPC struct is placed in uncached memory which helps) </td> </tr></table><span class="postbody">
<br/>
<br/>
Cache, humm... So this would perhaps explain the "one shot delay" I get when I read the touchpad position. Is there a need and/or a way to flush it so that it would be sure that the shared memory is really in the same state for both the ARM7 and ARM9 ?
<br/>
<br/>
The point is that in another part of the game, I use exactly the same mechanism and it works ! May be the binary context around changes the cache or whatever...
<br/>
<br/>
  -- Didou</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#57820 - Didou - Tue Oct 18, 2005 7:03 pm</h4>
    <div class="postbody"><span class="postbody">Hi again,
<br/>
<br/>
I reduced the program in order to make it shorter and show clearly the problem. it now simply prints the pointer position and moves a sprite at the hit point location. It's hence really shorter.
<br/>
It makes clear the <span style="font-style: italic">"one shot shift"</span>, i.e. at each pen hit, the location of the <span style="font-weight: bold">previous </span>pen hit is reported.
<br/>
<br/>
I put the source and .ds file at: <a class="postlink" href="http://francois.pessaux.neuf.fr/files/core.zip" target="_blank">http://francois.pessaux.neuf.fr/files/core.zip</a>
<br/>
<br/>
Cheers,
<br/>
<br/>
  -- Didou</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#57845 - Didou - Tue Oct 18, 2005 9:39 pm</h4>
    <div class="postbody"><span class="postbody">Hi, again, again,
<br/>
<br/>
I just try (on real hardware) the code I posted above with the libnds-20051018.tar.bz2....
<br/>
New episod ... no <span style="font-weight: bold">reaction to the stylus </span>! Previously I used the libnds-20050921.tar.bz2 version...
<br/>
<br/>
Euh... Is there something compatible from one versin to another ;)
<br/>
<br/>
  -- Didou</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#57870 - wintermute - Wed Oct 19, 2005 12:02 am</h4>
    <div class="postbody"><span class="postbody">That version of libnds hasn't been officially announced as yet, it needs an ndstool update. Basically I started the SF release then ran into problems with the updater that I'm still working on.
<br/>
<br/>
I tried compiling your code but there seems to be another odd issue in that it's stalling on the swiWaitForVBlank which is why you're getting no reponse at all. Right now I can't see why that should be the case but I can reproduce your  "one shot" issue with the old arm7 core and some of my own touch screen test code.
<br/>
<br/>
Expect some more updates in a day or two.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#58170 - wintermute - Fri Oct 21, 2005 1:26 pm</h4>
    <div class="postbody"><span class="postbody">devkitARM release 17 is now available along with libnds and example code updates. There's now a TouchTest example in the input section of the examples which works correctly for me.
<br/>
<br/>
Could you try the example and verify it works for you?</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
