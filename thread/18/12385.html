<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Sprite not showing up - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Sprite not showing up</h2>
<div id="posts">
<div class="post">
    <h4>#117826 - pmcc - Wed Feb 07, 2007 10:31 pm</h4>
    <div class="postbody"><span class="postbody">Hey,
<br/>
I started homebrew development a few days ago and I'm stuck on sprites. Like the title of this thread says, my sprite is not showing up on my DS / Dualis / no$gba but IT DOES in desmume...I'm trying to figure out what's wrong with my code and it's driving me crazy for 2 days now :).
<br/>
I'm using devkitPro and libnds.
<br/>
Here's some portions of my code :
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
  powerON(POWER_ALL_2D);
<br/>
  // Map vram, one bg and sprite banks for each core
<br/>
  vramSetMainBanks(VRAM_A_MAIN_BG,
<br/>
         VRAM_B_MAIN_SPRITE,
<br/>
               VRAM_C_SUB_BG,
<br/>
         VRAM_D_SUB_SPRITE);
<br/>
  // Set video mode to mode 0 (0,1,2,3 -&gt; text) with sprites support
<br/>
  eng.SetVideoMode(MODE_0_2D | DISPLAY_SPR_ACTIVE | DISPLAY_SPR_1D_LAYOUT);
<br/>
  eng.SetSubVideoMode(MODE_0_2D | DISPLAY_SPR_ACTIVE | DISPLAY_SPR_1D_LAYOUT);
<br/>
  // Enable main and sub background 1
<br/>
  eng.EnableBackground(1);
<br/>
  eng.EnableSubBackground(1);
<br/>
  // Load palette into memory
<br/>
  eng.LoadPalette(tilesetPal);
<br/>
  eng.LoadSubPalette(tilesetPal);
<br/>
  // Set main background 1
<br/>
  eng.SetBackgroundTileBase(1, 0);
<br/>
  eng.SetBackgroundMapBase(1, 30);
<br/>
  eng.SetBackgroundColors(1, BG_COLOR_256);
<br/>
  // Set sub background 1
<br/>
  eng.SetSubBackgroundTileBase(1, 1);
<br/>
  eng.SetSubBackgroundMapBase(1, 31);
<br/>
  eng.SetSubBackgroundColors(1, BG_COLOR_256);
<br/>
  // Copy our tiles data into memory where the hardware is expecting them
<br/>
  dmaCopy(tilesetTiles, (void*)CHAR_BASE_BLOCK(0), sizeof (tilesetTiles));
<br/>
  dmaCopy(tilesetTiles, (void*)CHAR_BASE_BLOCK_SUB(1), sizeof (tilesetTiles));
<br/>
  // Copy one half of the map in each screen memory
<br/>
  for (int i = 0; i &lt; 768; ++i)
<br/>
    {
<br/>
      ((u16*)SCREEN_BASE_BLOCK(30))[i] = test_map[i];
<br/>
      ((u16*)SCREEN_BASE_BLOCK_SUB(31))[i] = test_map[i + 768];
<br/>
    }
<br/>
  eng.InitOAM();
<br/>
  // temp code...
<br/>
  SpriteEntry* sprites = eng.GetSprites();
<br/>
  sprites[0].attribute[0] = ATTR0_COLOR_16 | ATTR0_SQUARE | OBJ_Y(50);
<br/>
  sprites[0].attribute[1] = ATTR1_SIZE_8 | OBJ_X(50);
<br/>
  // temp code...
<br/>
  for (int i = 0; i &lt; sizeof (ballPal); ++i)
<br/>
    {
<br/>
      SPRITE_PALETTE[i] = ballPal[i];
<br/>
    }
<br/>
  for (int i = 0; i &lt; sizeof (ballTiles); ++i)
<br/>
    {
<br/>
      SPRITE_GFX[i] = ballTiles[i];
<br/>
    }
<br/>
  while(1)
<br/>
    {
<br/>
      swiWaitForVBlank();
<br/>
      dmaCopy(eng.GetSprites(), OAM, 1024);
<br/>
      dmaCopy(eng.GetSubSprites(), OAM_SUB, 1024);
<br/>
    }
<br/>
<br/>
void CEngine::InitOAM()
<br/>
{
<br/>
  m_sprites = new SpriteEntry[128];
<br/>
  m_spritesRotation = reinterpret_cast&lt;SpriteRotation*&gt;(m_sprites);
<br/>
  m_spritesSub = new SpriteEntry[128];
<br/>
  m_spritesRotationSub = reinterpret_cast&lt;SpriteRotation*&gt;(m_spritesSub);
<br/>
  for (int i = 0; i &lt; 128; ++i)
<br/>
    {
<br/>
      m_sprites[i].attribute[0] = ATTR0_DISABLED;
<br/>
      m_sprites[i].attribute[1] = 0;
<br/>
      m_sprites[i].attribute[2] = 0;
<br/>
      m_spritesSub[i].attribute[0] = ATTR0_DISABLED;
<br/>
      m_spritesSub[i].attribute[1] = 0;
<br/>
      m_spritesSub[i].attribute[2] = 0;
<br/>
    }
<br/>
  for (int i = 0; i &lt; 32; ++i)
<br/>
    {
<br/>
      m_spritesRotation[i].hdx = 256;
<br/>
      m_spritesRotation[i].hdy = 0;
<br/>
      m_spritesRotation[i].vdx = 0;
<br/>
      m_spritesRotation[i].vdy = 256;
<br/>
      m_spritesRotationSub[i].hdx = 256;
<br/>
      m_spritesRotationSub[i].hdy = 0;
<br/>
      m_spritesRotationSub[i].vdx = 0;
<br/>
      m_spritesRotationSub[i].vdy = 256;
<br/>
    }
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Well...like I said it shows up perfectly on desmume. I've checked first sprite entry in dualis and everything is ok (size, colors, etc) but it doesn't display the sprite preview...
<br/>
Kudos to anyone that can help me on this one !
<br/>
Thanks.<br/>_________________<br/><a href="http://www.gotrooted.net" target="_blank">www.gotrooted.net</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117830 - pmcc - Wed Feb 07, 2007 11:22 pm</h4>
    <div class="postbody"><span class="postbody">Ok so, I found out what was wrong *points to libnds VRAM defines*.
<br/>
SPRITE_GFX is memory address 0x6400000, VRAM_B_MAIN_SPRITE is in fact 0x6420000 so memory address 0x6400000 was not mapped...swapped VRAM_B_MAIN_SPRITE with VRAM_B_MAIN_SPRITE_0x6400000 and now my sprite is showing up.<br/>_________________<br/><a href="http://www.gotrooted.net" target="_blank">www.gotrooted.net</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117899 - Mr Snowflake - Thu Feb 08, 2007 3:00 pm</h4>
    <div class="postbody"><span class="postbody">The VRAM_*_MAIN_ are always follow ups. If you plan on using VRAM_B_MAIN_SPRITE you should also use VRAM_A_MAIN_SPRITE As the VRAM_A_MAIN_SPRITE is mapped to the first Sprite block. That's why lot of programs always use the VRAM_B_MAIN_SPRITE_0x?????00 form<br/>_________________<br/><a class="postlink" href="http://www.mrsnowflake.be" target="_blank">http://www.mrsnowflake.be</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117965 - Lick - Thu Feb 08, 2007 10:57 pm</h4>
    <div class="postbody"><span class="postbody">Also, don't use dmaCopy but use memcpy.<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117992 - pmcc - Fri Feb 09, 2007 12:33 am</h4>
    <div class="postbody"><span class="postbody">Why should I use memcpy over dmaCopy / dmaCopyWords?<br/>_________________<br/><a href="http://www.gotrooted.net" target="_blank">www.gotrooted.net</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
