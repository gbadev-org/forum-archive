<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Help with OpenGL to draw 2D shapes - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Help with OpenGL to draw 2D shapes</h2>
<div id="posts">
<div class="post">
    <h4>#59576 - LOst? - Wed Nov 02, 2005 7:34 pm</h4>
    <div class="postbody"><span class="postbody">I don't know if this is possible to do in one day. I need to do a special type analog clock for a company in one day. And I have no experience with OpenGL. I want to do this analog clock on the DS. This is only an opportunity for me, and if I fail it is not a big idea.
<br/>
<br/>
The problem is I need to use special lines for the hands called "Geometric Pens" in Windows, are thick lines with flat edges. I thought maybe this can be done with 2 solid polygons, or maybe even a solid quad? Having a dynamic function to create a cosmetic line with an angle, thickness, start, and stop coordinates.
<br/>
I also need to have a solid circle in the middle of the clock face.
<br/>
<br/>
I will give you a picture of how I want it to look (color is not important):
<br/>
<a href="http://www.kund.hemmanet.se/~lost/ogl_cl.png" target="_blank">http://www.kund.hemmanet.se/~lost/ogl_cl.png</a>
<br/>
<br/>
Is this possible to program in less than 12 hours? Is it easy? Someone want to do the basic for me? (heh, then I just mean the functions, and not the whole DS program).
<br/>
<br/>
I need 64 lines and one circle in the middle, and I hope the DS can handle that drawing in less than a second.
<br/>
<br/>
<br/>
Do I have a chance to finish this? Give me your guess! I am so screwed if I have to guess.<br/>_________________<br/><span style="font-style: italic">Exceptions are fun</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#59617 - tepples - Wed Nov 02, 2005 10:13 pm</h4>
    <div class="postbody"><span class="postbody">Each hand is a quad. You can use GL's rotation commands to set up a matrix through which each quad will be rotated.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#59660 - LOst? - Thu Nov 03, 2005 3:53 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Each hand is a quad. You can use GL's rotation commands to set up a matrix through which each quad will be rotated.</td> </tr></table><span class="postbody">
<br/>
That would help if I knew OpenGL, but I don't. I need a few hints. Only which API's to call. I will figure out the rest hopefully.
<br/>
<br/>
<br/>
EDIT: I figured out the circle, and it was supposed to be the hard part. Maybe just maybe I will manage to finish this. Help anyone with the quads, and how to rotate them?<br/>_________________<br/><span style="font-style: italic">Exceptions are fun</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#59665 - LOst? - Thu Nov 03, 2005 5:22 am</h4>
    <div class="postbody"><span class="postbody">I have done all shapes.
<br/>
<br/>
Now I just need to know how to rotate one shape.
<br/>
<br/>
I wonder if I need to do this with software. Hmm. Probably.<br/>_________________<br/><span style="font-style: italic">Exceptions are fun</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#59666 - dovoto - Thu Nov 03, 2005 5:36 am</h4>
    <div class="postbody"><span class="postbody">Looked like it might make a cool quick little demo so here you go:  
<br/>
This should do you:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
#include&lt;nds.h&gt;
<br/>
<br/>
void DrawQuad(float x, float y, float width, float height)
<br/>
{
<br/>
   
<br/>
   glBegin(GL_QUADS);
<br/>
      glVertex3f(x - width / 2, y, 0);
<br/>
      glVertex3f(x + width / 2, y, 0);
<br/>
      glVertex3f(x  + width / 2, y  + height, 0);
<br/>
      glVertex3f(x - width / 2, y  + height, 0);
<br/>
   glEnd();
<br/>
}
<br/>
int main()
<br/>
{   
<br/>
   int hours, seconds, minutes;
<br/>
<br/>
   // Turn on everything
<br/>
   powerON(POWER_ALL);
<br/>
<br/>
   //put 3D on top
<br/>
   lcdMainOnTop();
<br/>
<br/>
   // Setup the Main screen for 3D 
<br/>
   videoSetMode(MODE_0_3D);
<br/>
<br/>
   // IRQ basic setup
<br/>
   irqInit();
<br/>
   irqSet(IRQ_VBLANK, 0);
<br/>
<br/>
   // Set our viewport to be the same size as the screen
<br/>
   glViewPort(0,0,255,191);
<br/>
<br/>
   // Specify the Clear Color and Depth 
<br/>
   glClearColor(0,0,0);
<br/>
   glClearDepth(0x7FFF);
<br/>
<br/>
   while (1) 
<br/>
   {
<br/>
      hours = (IPC-&gt;rtc_hours &lt; 12) ? IPC-&gt;rtc_hours : IPC-&gt;rtc_hours - 52;
<br/>
      minutes = IPC-&gt;rtc_minutes;
<br/>
      seconds = IPC-&gt;rtc_seconds;
<br/>
<br/>
      // Reset the screen and setup the view
<br/>
      glReset();
<br/>
      gluPerspective(35, 256.0 / 192.0, 0.1, 100);                        
<br/>
<br/>
      //ds specific, several attributes can be set here   
<br/>
      glPolyFmt(POLY_ALPHA(31) | POLY_CULL_NONE);
<br/>
<br/>
      // Set the current matrix to be the model matrix
<br/>
      glMatrixMode(GL_MODELVIEW);
<br/>
      glLoadIdentity();
<br/>
      
<br/>
      //move the camera back a little
<br/>
      glTranslatef(0,0,-3);
<br/>
<br/>
      //Push our original Matrix onto the stack (save state)
<br/>
      glPushMatrix();   
<br/>
      
<br/>
      //draw second hand
<br/>
      glColor3f(0,0,1);
<br/>
      glRotateZ(-seconds * 360 / 60);
<br/>
      glTranslatef(0,1.9,0);
<br/>
      DrawQuad(0,0,.2,.2);
<br/>
<br/>
      // Pop our Matrix from the stack (restore state)
<br/>
      glPopMatrix(1);
<br/>
<br/>
      //Push our original Matrix onto the stack (save state)
<br/>
      glPushMatrix();   
<br/>
<br/>
      //draw minute hand
<br/>
      glColor3f(0,1,0);
<br/>
      glRotateZ(-minutes * 360 / 60);
<br/>
      DrawQuad(0,0,.2,2);
<br/>
<br/>
      // Pop our Matrix from the stack (restore state)
<br/>
      glPopMatrix(1);
<br/>
<br/>
      //Push our original Matrix onto the stack (save state)
<br/>
      glPushMatrix();   
<br/>
<br/>
      //draw hourhand
<br/>
      glColor3f(1,0,0);
<br/>
      glRotateZ(-hours * 360 / 12);
<br/>
      DrawQuad(0,0,.3,1.8);
<br/>
<br/>
      // Pop our Matrix from the stack (restore state)
<br/>
      glPopMatrix(1);
<br/>
<br/>
      //a handy little built in function to wait for a screen refresh
<br/>
      swiWaitForVBlank();
<br/>
<br/>
      // flush to screen   
<br/>
      glFlush();
<br/>
<br/>
   }
<br/>
<br/>
   return 0;
<br/>
}
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/><a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#59668 - LOst? - Thu Nov 03, 2005 5:53 am</h4>
    <div class="postbody"><span class="postbody">Thanks dovoto. This will help me a lot. Since i have never used OpenGL before, you have helped me to realize what some stuff actually do.
<br/>
<br/>
Your example helps me to understand glPushMatrix, and glRotateZ. Hopefully I will be able to handle everything now. I only have one problem: GL_QUADS
<br/>
<br/>
GL_QUADS doesn't exist in my libnds version. I am using GL_QUAD instead.<br/>_________________<br/><span style="font-style: italic">Exceptions are fun</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#59675 - LOst? - Thu Nov 03, 2005 7:01 am</h4>
    <div class="postbody"><span class="postbody">In the end everything worked except reading the time. All I get is zeros. IPC structure won't update no matter what tricks I try to pull off.<br/>_________________<br/><span style="font-style: italic">Exceptions are fun</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#59721 - dovoto - Thu Nov 03, 2005 7:24 pm</h4>
    <div class="postbody"><span class="postbody">On hardware?  I tested the above code and it works fine on my DS..so perhaps your libnds is out of date?<br/>_________________<br/><a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#59798 - LOst? - Fri Nov 04, 2005 4:25 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>dovoto wrote:</b></span></td> </tr> <tr> <td class="quote">On hardware?  I tested the above code and it works fine on my DS..so perhaps your libnds is out of date?</td> </tr></table><span class="postbody">
<br/>
It works on hardware, with time and all.
<br/>
<br/>
I have another problem, and it is connected to the 3D stuff somehow. When I add or delete code in my main(), I will get a white screen on bootup, but only on real hardware. Maybe it is connected to my inline functions somehow. I will try to make them normal functions. But if it isn't, then the bugs are too big for me to handle. My libnds and GCC are 6 months old.
<br/>
<br/>
EDIT: Nah, I have to give up. I can't get any futher with this bug. I got an analog clock at least, and it will help me today for sure.<br/>_________________<br/><span style="font-style: italic">Exceptions are fun</span></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
