<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>More about display lists and textures - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > More about display lists and textures</h2>
<div id="posts">
<div class="post">
    <h4>#59724 - Webez - Thu Nov 03, 2005 7:41 pm</h4>
    <div class="postbody"><span class="postbody">Hi.
<br/>
I finally got how to export my data to nds display list. I am using them for exporting the map of my tactic-rpg. The problem is that the map is divided in cubes and each cube has 5 faces (the base doesn?t matter beacause it is no visible). And each of these faces can have a different texture. So I was thinking wich of this things is better.
<br/>
<br/>
a) Save all the textures in a big one (wich is not too good if I have a lot of levels in my game) so I can save all mapa data in a display list
<br/>
<br/>
b) Group data by texture and make a display list for each group
<br/>
<br/>
c) Don?t use display lists and load a smaller file with indexed vertex but with slower performance (I suposse it will be slower if I don?t use display lists..) 
<br/>
<br/>
Thanks</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#59728 - dovoto - Thu Nov 03, 2005 8:23 pm</h4>
    <div class="postbody"><span class="postbody">I do not believe it is appropriate to represent the map itself as a display list but only the objects inside it.  Mainly because you normaly do not want to draw your entire map each frame.  
<br/>
<br/>
I believe you can bind to textures within a display list so there is no need to seperate objects based on texture (i guess i have not verified this yet but i see no reason why not).  This means you can reference several textures from the same display list.
<br/>
<br/>
It is also normaly desirable to seperate your textures into the smallest size possible. There are a couple of reasons.
<br/>
1) You can usualy get away with a lower color depth with a set of smaller textures vs one big one
<br/>
2) One big one often will contain unused space
<br/>
3) Small textures are much easier to load on the fly.
<br/>
<br/>
Not sure if this answered your question...<br/>_________________<br/><a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#59731 - Webez - Thu Nov 03, 2005 8:36 pm</h4>
    <div class="postbody"><span class="postbody">I didn't think before about not drawing the entire map but you are absolutely right, if I use a display list I suppouse things like frustum culling are not possible for things so big. So I?ll use them for houses or such a things.
<br/>
<br/>
And about binding a texture inside a display list how I am suposse to do it?
<br/>
<br/>
Thanks a lot for your answer.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#59735 - dovoto - Thu Nov 03, 2005 9:05 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void glNewList(listName, GL_COMPILE);
<br/>
glBindTexture(blah);
<br/>
//draw stuff
<br/>
glBindTexture(blah2);
<br/>
//draw some more stuff
<br/>
void glEndList();
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
This is assuming you have my display list capable gl code (and since i have not written it yet i find this unlikely).
<br/>
<br/>
The actual bind texture would need to be placed in a display list compatible format which i dont recall off the top of my head...I am going to try to add display lists and a few other missing gl functions (glGetxxx, glPush/pop attribute, indexed data).<br/>_________________<br/><a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#59983 - LunarCrisis - Sun Nov 06, 2005 2:37 am</h4>
    <div class="postbody"><span class="postbody">Has it been verified that the DS counts polys drawn outside the screen towards the vertex limit? In theory, if it does the matrix multiplication right away (which it should) it could automatically throw away polygons which are outside the screen, couldn't it?<br/>_________________<br/>If a tree falls in the forest and no one is there to hear it, why the heck do you care?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#59986 - dovoto - Sun Nov 06, 2005 3:02 am</h4>
    <div class="postbody"><span class="postbody">there are vertex and polygon ram counters...I will test this later tonight...Should be very simple to test for vertexes outside the view.=
<br/>
<br/>
My plan is to add:
<br/>
--display lists
<br/>
-- indexed vertex/texture/normal/color data
<br/>
-- some getters for the current rotation and perspective matrix  (done)
<br/>
-- hardware fog
<br/>
-- clean up some naming conventions
<br/>
-- Hardware bounding box test (done)
<br/>
<br/>
Then make a new release.  I have everything figured out I just need to make it pretty (and think of a memory efficient way to do display lists).<br/>_________________<br/><a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#59999 - LunarCrisis - Sun Nov 06, 2005 4:46 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>dovoto wrote:</b></span></td> </tr> <tr> <td class="quote">-- Hardware bounding box test (done)</td> </tr></table><span class="postbody">Ermm, not quite sure I understand, if it's done by hardware what needs to be added?<br/>_________________<br/>If a tree falls in the forest and no one is there to hear it, why the heck do you care?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#60000 - tepples - Sun Nov 06, 2005 5:09 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>LunarCrisis wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>dovoto wrote:</b></span></td> </tr> <tr> <td class="quote">-- Hardware bounding box test (done)</td> </tr></table><span class="postbody">Ermm, not quite sure I understand, if it's done by hardware what needs to be added?</span></td> </tr></table><span class="postbody">
<br/>
A test for how much of the hardware's resources it takes, perhaps?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#60011 - dovoto - Sun Nov 06, 2005 8:26 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>LunarCrisis wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>dovoto wrote:</b></span></td> </tr> <tr> <td class="quote">-- Hardware bounding box test (done)</td> </tr></table><span class="postbody">Ermm, not quite sure I understand, if it's done by hardware what needs to be added?</span></td> </tr></table><span class="postbody">
<br/>
A test for how much of the hardware's resources it takes, perhaps?</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Yes, i will test resource ussage tomorrow :)
<br/>
<br/>
By done i mean I know how and have created the following:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#ifndef BOX_TEST_INCLUDE
<br/>
#define BOX_TEST_INCLUDE
<br/>
<br/>
int BoxTest(v16 x, v16 y, v16 z, v16 height, v16 width, v16 depth);
<br/>
int BoxTestf(float x, float y, float z, float height, float width, float depth);
<br/>
<br/>
void BoxTest_Asynch(v16 x, v16 y, v16 z, v16 height, v16 width, v16 depth);
<br/>
int BoxTestf_Asynch(float x, float y, float z, float height, float width, float depth);
<br/>
int BoxTestResult(void);
<br/>
<br/>
#endif
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/><a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#60068 - dovoto - Sun Nov 06, 2005 11:37 pm</h4>
    <div class="postbody"><span class="postbody">This should answer both performance (tepples) of the box test and what happens with vertex ram usage due to clipping and culling (Lunar Crisis).
<br/>
<br/>
<a class="postlink" href="http://www.drunkencoders.com/deos/ds/boxTest.zip" target="_blank">http://www.drunkencoders.com/deos/ds/boxTest.zip</a><br/>_________________<br/><a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#60101 - Lino - Mon Nov 07, 2005 3:26 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">http://www.drunkencoders.com/deos/ds/boxTest.zip</td> </tr></table><span class="postbody">
<br/>
<br/>
can you post the code? thanks</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#60111 - dovoto - Mon Nov 07, 2005 5:29 am</h4>
    <div class="postbody"><span class="postbody">It has been included as an example in libnds and will be available at next release.  If you need the code sooner grab it from the cvs (it should be available for normal users in an hour or three).<br/>_________________<br/><a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#60286 - duencil - Tue Nov 08, 2005 5:41 pm</h4>
    <div class="postbody"><span class="postbody">That's great new information.  Thanks dovoto.  Any idea whats going on with this code snipped from the boxtest? Bits 12 and 13 of the poly format register I don't have documented yet?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">glPolyFmt(BIT(12) | BIT(13));
<br/>
glBegin(GL_TRIANGLES);
<br/>
glEnd();</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#60296 - dovoto - Tue Nov 08, 2005 7:12 pm</h4>
    <div class="postbody"><span class="postbody">Me niether, one of them seems to affect the far cliping plane (i dont have my notes with me so not sure which one).  I am not sure what the other does.<br/>_________________<br/><a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#60717 - duencil - Mon Nov 14, 2005 2:42 am</h4>
    <div class="postbody"><span class="postbody">I've tested that out. Bit 12 of the poly format register affects z-far clipping. If its not set then polygons intersecting the far plane get culled instead of clipped.
<br/>
<br/>
I haven't yet seen how this affects the box test. But maybe the same thing is true, if your box is large and intersects the far plane, it would get culled instead of returning that its intersecting.
<br/>
<br/>
Also, seems like the box test just returns a boolean 1 if wholly or partly onscreen or 0 if completely off. There's no way to get the intersecting clipping planes, right?</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
