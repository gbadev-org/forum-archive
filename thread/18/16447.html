<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Help: Subscreen bgs using extended mode - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Help: Subscreen bgs using extended mode</h2>
<div id="posts">
<div class="post">
    <h4>#166701 - Emmanuel - Sun Feb 15, 2009 11:33 am</h4>
    <div class="postbody"><span class="postbody">The palette is loading correctly but, The sub screen bg is using the sub screen palette instead of the extended one... I am using
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">REG_BG1CNT_SUB ^= BG_PALETTE_SLOT1;</td> </tr></table><span class="postbody">
<br/>
<br/>
For editing the registers and telling it to use the palette accordingly... to no avail...
<br/>
<br/>
Googling, tutorials only explain for main screen... I know the process should be similar... but I can't find what I'm missing...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#166719 - Dwedit - Sun Feb 15, 2009 9:40 pm</h4>
    <div class="postbody"><span class="postbody">XOR Operator?<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#166744 - Emmanuel - Mon Feb 16, 2009 12:54 pm</h4>
    <div class="postbody"><span class="postbody">Yeah, that was the one being used in some examples I found... I tested with OR and it gives the same results though... however, I don't know in the long run which is the correct one, I guess I'll stick with XOR...
<br/>
<br/>
and still, the subscreen uses default sub screen palette, instead of the extended sub palette 1... I tried disabling the console, and leaving just that background... all I got was a black screen because the palette was not loaded...
<br/>
<br/>
All the palettes in the main screen work correctly, and still I can't find what I'm missing...
<br/>
<br/>
My initVideo()
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">vramSetMainBanks(VRAM_A_MAIN_BG_0x06000000,
<br/>
                     VRAM_B_MAIN_BG_0x06020000,
<br/>
                     VRAM_C_SUB_BG_0x06200000,
<br/>
                     VRAM_D_LCD);
<br/>
<br/>
    /*  Set the video mode on the main screen. */
<br/>
    videoSetMode(MODE_0_2D |
<br/>
            DISPLAY_BG0_ACTIVE |
<br/>
                DISPLAY_BG1_ACTIVE |
<br/>
            DISPLAY_BG2_ACTIVE |
<br/>
            DISPLAY_BG3_ACTIVE); //Enable BG3 for display
<br/>
<br/>
    /*  Set the video mode on the sub screen. */
<br/>
    videoSetModeSub(MODE_0_2D|
<br/>
                DISPLAY_BG0_ACTIVE |
<br/>
                DISPLAY_BG1_ACTIVE |
<br/>
            DISPLAY_BG2_ACTIVE |
<br/>
            DISPLAY_BG3_ACTIVE); //Enable BG3 for display
<br/>
   vramSetBankE(VRAM_E_LCD);
<br/>
   vramSetBankH(VRAM_H_LCD);
<br/>
   REG_DISPCNT|= DISPLAY_BG_EXT_PALETTE;</td> </tr></table><span class="postbody">
<br/>
<br/>
My load Palette
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">if(main){
<br/>
         vramSetBankE(VRAM_E_LCD);
<br/>
         memcpy(VRAM_E_EXT_PALETTE[number], /* screen palette*/
<br/>
                     buffer, size);
<br/>
         VRAM_E_CR = VRAM_ENABLE | VRAM_E_BG_EXT_PALETTE;
<br/>
         switch(number){
<br/>
            case 3:
<br/>
               REG_BG3CNT ^= BG_PALETTE_SLOT3;
<br/>
               break;
<br/>
            case 2:
<br/>
               REG_BG2CNT ^= BG_PALETTE_SLOT2;
<br/>
               break;
<br/>
            case 1:
<br/>
               REG_BG1CNT ^= BG_PALETTE_SLOT1;
<br/>
               break;
<br/>
            case 0:
<br/>
               REG_BG0CNT ^= BG_PALETTE_SLOT0;
<br/>
               break;
<br/>
         }
<br/>
      }else{
<br/>
         vramSetBankH(VRAM_H_LCD);
<br/>
         memcpy(VRAM_H_EXT_PALETTE[number], /* screen palette*/
<br/>
                     buffer, size);;
<br/>
         VRAM_H_CR = VRAM_ENABLE | VRAM_H_SUB_BG_EXT_PALETTE;
<br/>
         REG_BG1CNT_SUB ^= BG_PALETTE_SLOT1;
<br/>
         switch(number){
<br/>
            case 3:
<br/>
               REG_BG3CNT_SUB ^= BG_PALETTE_SLOT3;
<br/>
               break;
<br/>
            case 2:
<br/>
               REG_BG2CNT_SUB ^= BG_PALETTE_SLOT2;
<br/>
               break;
<br/>
            case 1:
<br/>
               REG_BG1CNT_SUB ^= BG_PALETTE_SLOT1;
<br/>
               break;
<br/>
            case 0:
<br/>
               REG_BG0CNT_SUB ^= BG_PALETTE_SLOT0;
<br/>
               break;
<br/>
         }</td> </tr></table><span class="postbody">
<br/>
<br/>
Fixed
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">videoSetModeSub(MODE_0_2D|
<br/>
                DISPLAY_BG0_ACTIVE |
<br/>
                DISPLAY_BG1_ACTIVE |
<br/>
            DISPLAY_BG2_ACTIVE |
<br/>
            DISPLAY_BG3_ACTIVE | 
<br/>
            DISPLAY_BG_EXT_PALETTE);</td> </tr></table><span class="postbody">
<br/>
I set
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">REG_DISPCNT|= DISPLAY_BG_EXT_PALETTE;</td> </tr></table><span class="postbody">
<br/>
and thought it was for both screens... but now it's fixed with the videoSetModeSub</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
