<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Max size of sources ? => Dev' env' pb  => please help - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Max size of sources ? => Dev' env' pb  => please help</h2>
<div id="posts">
<div class="post">
    <h4>#46641 - Herve13 - Tue Jun 28, 2005 3:35 pm</h4>
    <div class="postbody"><span class="postbody">Hi all,
<br/>
<br/>
I'm trying to put a gnu project to the NDS.
<br/>
Compiling went fine, but linking raise problem :
<br/>
<br/>
<br/>
e:\ndsdev\devkitarm\bin\..\lib\gcc\arm-elf\3.4.4\..\..\..\..\arm-elf\bin\ld.exe: address 0x9440c8 of new.elf section .data is not within region dtcm
<br/>
<br/>
<br/>
<br/>
file sources are &gt; 7Mo
<br/>
and .o files are &gt; 5.5 Mo
<br/>
<br/>
<br/>
may it be the problem ?
<br/>
does any workaround exist ?
<br/>
<br/>
TIA
<br/>
<br/>
Herve</span><span class="gensmall"><br/><br/>Last edited by Herve13 on Wed Jun 29, 2005 10:36 am; edited 2 times in total</span></div>    
</div>
<div class="post">
    <h4>#46644 - strager - Tue Jun 28, 2005 4:15 pm</h4>
    <div class="postbody"><span class="postbody">What are you trying to do?  Define large arrays?
<br/>
<br/>
If so, define them as const.  Elsewise, they will try to be copied to DTCM or EWRAM[2] or IWRAM, which is not what you want, is it?
<br/>
<br/>
There could be some other problem.  And why in the world do you have 7MB source files?!!?  That I do <span style="font-style: italic">not</span> understand...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46646 - gladius - Tue Jun 28, 2005 4:17 pm</h4>
    <div class="postbody"><span class="postbody">Currently, the DevkitArm compiler puts all variables and static arrays into the DTCM region, which is only 32Kb.  So if your program has more than 32Kb of variables+arrays declared (note, arrays that are malloc()'ed are okay) then you will get that error.
<br/>
<br/>
You can work around this by adding EWRAM_BSS to the end of any uninitialized variables that are not speed critical, so they will be put into main ram.  If they are initialized, use VAR_IN_EXRAM.  So something like this:
<br/>
<br/>
u8 array[0x1000]; &lt;-- original
<br/>
u8 array[0x1000] EWRAM_BSS; &lt;--- new
<br/>
<br/>
u32 values[0x10] = {0,0,0,0...}; &lt;-- original
<br/>
u32 values[0x10] VAR_IN_EXRAM = {0,0,0,0...}; &lt;---new
<br/>
<br/>
As a side note, the combined size of the code across your arm7&amp;9 must be less than 4 megabytes using the current loader method.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46647 - Herve13 - Tue Jun 28, 2005 4:43 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for your answers !
<br/>
<br/>
strager : that's not my code !
<br/>
So, I can't explain why there are so much code !!!
<br/>
<br/>
The larger files define static struct objects, and initialize them.
<br/>
And I can't add the directives EWRAM_BSS or VAR_IN_EXRAM : it doesn't compile !!!
<br/>
<br/>
I'm usiong devkitarm12 and mingw to compile
<br/>
(and I'm able to compile a lot of others projects)
<br/>
<br/>
<br/>
Could it be because there are a lot of static functions/objects ?
<br/>
I'm not really an expert on such topics...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46652 - MrAdults - Tue Jun 28, 2005 5:32 pm</h4>
    <div class="postbody"><span class="postbody">The way I'm currently dealing with this is by modifying ds_arm9.ld to move data into ewram, and explicitly defining what goes into dtcm (this is not necessary to make things operational, and is only done for the sake of performance on critical data). I recommend taking this approach if you are porting a project that is at all large-scale.
<br/>
<br/>
-Rich</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46711 - Herve13 - Wed Jun 29, 2005 7:39 am</h4>
    <div class="postbody"><span class="postbody">Someone told me to put the extra word EWRAM_DATA infront of my variable declarations :
<br/>
EWRAM_DATA struct john doo0[]      = {
<br/>
  {722,1},	{795,2},	{684,2},	{758,0},
<br/>
  {759,0},	{796,0}
<br/>
};
<br/>
<br/>
<br/>
For him, it compiled fine on his development environment.
<br/>
but not for me !!!
<br/>
<br/>
I'm using last devkitpro/arm/ppc/ndslib/mssys versions.
<br/>
But when I compile, it says :
<br/>
<br/>
c:/devkitpro/projects/project/arm9/sgf/patterns.c:27: error: syntax error before "struct"
<br/>
<br/>
<br/>
any help ?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46720 - strager - Wed Jun 29, 2005 3:17 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Herve13 wrote:</b></span></td> </tr> <tr> <td class="quote">Someone told me to put the extra word EWRAM_DATA infront of my variable declarations</td> </tr></table><span class="postbody">
<br/>
You must put them after the array name and count, but before the = {...}.  That might fix the error.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46721 - Ethos - Wed Jun 29, 2005 3:43 pm</h4>
    <div class="postbody"><span class="postbody">1) declare predefined arrays as const
<br/>
<br/>
2) if you are using global arrays...do not allocate space on the stack, use malloc to allocate space on the heap<br/>_________________<br/><a class="postlink" href="http://ethos.oddigytitanium.com" target="_blank">Ethos' Homepage (Demos/NDS 3D Tutorial)</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
