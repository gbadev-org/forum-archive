<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>gba_nds_fat->libfat transition problem - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > gba_nds_fat->libfat transition problem</h2>
<div id="posts">
<div class="post">
    <h4>#123978 - Globoeil - Mon Apr 02, 2007 8:07 am</h4>
    <div class="postbody"><span class="postbody">Hi all
<br/>
<br/>
I've searched everywhere but can't find an answer;
<br/>
<br/>
I'm programming VGMDS -The "RPG Maker-like" for DS- And at the beginning VGMDS was coded with gba_nds_fat.
<br/>
I've entirely rewritten the code to use libfat and DLDI.
<br/>
But there is a problem:
<br/>
<br/>
To identify a file, VGMDS uses short file names, and libfat only returns long filenames...
<br/>
I know some of you will say: "You only have to use long filename to identify a file", but VGMDS identify a LOT of files, and 13 bytes for short filenames are really better for mem &amp; disk space than 256 bytes for long filenames to identify just 1 file.
<br/>
<br/>
So How can I have short filename with libfat? I need this please!
<br/>
<br/>
Thank you
<br/>
<br/>
Globoeil
<br/>
<br/>
VGMDS:
<br/>
Website: <a class="postlink" href="http://www.globoeil.com/" target="_blank">http://www.globoeil.com/</a>
<br/>
Forum: <a class="postlink" href="http://vgmds.keogratuit.com/phpBB2/" target="_blank">http://vgmds.keogratuit.com/phpBB2/</a>
<br/>
If I can use libfat, VGMDS will be compatible with most of the linkers!!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123979 - chishm - Mon Apr 02, 2007 8:33 am</h4>
    <div class="postbody"><span class="postbody">You should be able to open short filenames (aliases) using the normal open functions. This still isn't a good idea, though, because the alias can change depending on what order the files are placed on the card.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123980 - Dwedit - Mon Apr 02, 2007 8:34 am</h4>
    <div class="postbody"><span class="postbody">The original version had that wonderful GetAlias function, didn't it... Strange how much things change once you try to play the game of "Let's be like the standard library".  You lose all of the API that doesn't map back to there.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123982 - Globoeil - Mon Apr 02, 2007 8:58 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">You should be able to open short filenames (aliases) using the normal open functions. This still isn't a good idea, though, because the alias can change depending on what order the files are placed on the card.</td> </tr></table><span class="postbody">
<br/>
<br/>
That's not a problem(file names of VGMDS can't exceed 8 chars lol); in fact the great problem is that I need to have short filenames with dirnext function, because I want to list file with their short filenames... Do you understand what I mean? Sorry if my english is notperfect... :(
<br/>
<br/>
Thanks for your really quick response (7:07-&gt;7:33 O_O)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123985 - chishm - Mon Apr 02, 2007 9:41 am</h4>
    <div class="postbody"><span class="postbody">Unfortunately there is no equivalent to FAT_GetAlias. 
<br/>
<br/>
Dwedit:
<br/>
Well yeah, but it has the benefits of being able to read multiple diretories at once, and nearly everything else is still there.
<br/>
Also, I seem to recall that you were the one that demanded LFN support way back in the early days of gba_nds_fat, when it was GBAMP only ;)<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123986 - HyperHacker - Mon Apr 02, 2007 9:46 am</h4>
    <div class="postbody"><span class="postbody">Would it be too terrible to add FAT_xxx functions, adding things that aren't present in the standard library?<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123992 - chishm - Mon Apr 02, 2007 11:31 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">Would it be too terrible to add FAT_xxx functions, adding things that aren't present in the standard library?</td> </tr></table><span class="postbody">
<br/>
It would break the entire layered design concept, and would require access to functions with libfat that may change in future.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#124002 - Globoeil - Mon Apr 02, 2007 12:21 pm</h4>
    <div class="postbody"><span class="postbody">So can I hope a libfat release in the future with a "GetShortname()" function? Or is it really too hard to implement in libfat?
<br/>
<br/>
If it is not possible, I'll try to make my own "pseudoshort()" function; like this:
<br/>
pseudoshort("long name file.txt.sav;nds.jpg") =&gt; "LONGNA~1.JPG"
<br/>
I think it may works at 95%... that's the best I can make alone lol.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#124014 - tepples - Mon Apr 02, 2007 1:58 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Globoeil wrote:</b></span></td> </tr> <tr> <td class="quote">So can I hope a libfat release in the future with a "GetShortname()" function? Or is it really too hard to implement in libfat?</td> </tr></table><span class="postbody">
<br/>
Yes, because libfat can provide only those functions that are listed in devoptab. Or would it be a good idea for devoptab to provide an ioctl() style interface that can affect subsequent calls to the findfirst() series?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#124018 - Diddl - Mon Apr 02, 2007 2:27 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">... Or would it be a good idea for devoptab to provide an ioctl() style interface ...</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
it would be a nice feature to support ioctl() style interface like  win32 does with direct block access for special utils. for example defragmentation or udisk support.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#124090 - josath - Tue Apr 03, 2007 2:29 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Globoeil wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">You should be able to open short filenames (aliases) using the normal open functions. This still isn't a good idea, though, because the alias can change depending on what order the files are placed on the card.</td> </tr></table><span class="postbody">
<br/>
<br/>
That's not a problem(file names of VGMDS can't exceed 8 chars lol); in fact the great problem is that I need to have short filenames with dirnext function, because I want to list file with their short filenames... Do you understand what I mean? Sorry if my english is notperfect... :(
<br/>
<br/>
Thanks for your really quick response (7:07-&gt;7:33 O_O)</span></td> </tr></table><span class="postbody">
<br/>
<br/>
How about you just ignore any files longer than 8.3 characters then?
<br/>
And for dirnext, you don't need to store 256 bytes for every single file, you only need 1 temporary 256 byte buffer, then after you read the filename, you could check if it's too long, and then if it is short enough, copy it to a shorter 13 byte buffer.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#124126 - Globoeil - Tue Apr 03, 2007 9:52 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">How about you just ignore any files longer than 8.3 characters then?</td> </tr></table><span class="postbody">
<br/>
<br/>
It's possible, but then VGMDS users will be restricted to short name for their ressources (gif,raw...) and in the previous version of VGMDS it was not needed.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">And for dirnext, you don't need to store 256 bytes for every single file, you only need 1 temporary 256 byte buffer, then after you read the filename, you could check if it's too long, and then if it is short enough, copy it to a shorter 13 byte buffer.</td> </tr></table><span class="postbody">
<br/>
<br/>
It will works only if there is no file with &gt;8 characters.
<br/>
[/quote]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#124142 - tepples - Tue Apr 03, 2007 3:13 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Globoeil wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">How about you just ignore any files longer than 8.3 characters then?</td> </tr></table><span class="postbody">
<br/>
<br/>
It's possible, but then VGMDS users will be restricted to short name for their ressources (gif,raw...) and in the previous version of VGMDS it was not needed.</span></td> </tr></table><span class="postbody">
<br/>
What about files that specify the name of another file? If they specify the actual name and not the alias, and you only stored the alias, then you have a problem.
<br/>
<br/>
The reliance on aliases will bite you once people develop "libext3" and "libntfs" to make the DS work more smoothly with Linux and with Windows &gt;= XP. I don't think ext3fs has an alias for every file name, and <a class="postlink" href="http://www.15seconds.com/faq/Security/652.htm" target="_blank">people turn off aliases in NTFS</a>.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#124170 - Globoeil - Tue Apr 03, 2007 8:14 pm</h4>
    <div class="postbody"><span class="postbody">But save 256 bytes filenames is really bigger than save 13 bytes...
<br/>
I think I'll just restrict the file names of the resources to 8+.???=13 characters.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#124224 - tepples - Wed Apr 04, 2007 6:36 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Globoeil wrote:</b></span></td> </tr> <tr> <td class="quote">But save 256 bytes filenames is really bigger than save 13 bytes...
<br/>
I think I'll just restrict the file names of the resources to 8+.???=13 characters.</td> </tr></table><span class="postbody">
<br/>
In GBFS, I chose 24 bytes as a decent compromise.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#124564 - Globoeil - Fri Apr 06, 2007 11:02 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for the tip</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
