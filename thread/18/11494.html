<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Setting up non-16bit textures with palettes - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > Setting up non-16bit textures with palettes</h2>
<div id="posts">
<div class="post">
    <h4>#106620 - Rockard - Sat Oct 21, 2006 3:02 pm</h4>
    <div class="postbody"><span class="postbody">I have a lot of questions here, I'll appreciate ANY help I can get!
<br/>
<br/>
I have tried figuring out how to load 256color textures and using them directly for some time. The existing examples seems to rely on 16bit textures, or converting them from 256col to 16bit, so no help there.
<br/>
When using a loaded pcxfile directly, and setting it up with "GL_RGB256" using the glTexImage2D command, it just turns out white, so I guess it needs a palette.
<br/>
<br/>
Does it make any difference memorywise, if I load a pcx or a bin-file?
<br/>
<br/>
There exists quite a bit of texture-options:
<br/>
#define GL_RGB32_A3   1 // 32 color palette, 3 bits of alpha
<br/>
#define GL_RGB4       2 // 4 color palette
<br/>
#define GL_RGB16      3 // 16 color palette
<br/>
#define GL_RGB256     4 // 256 color palette
<br/>
#define GL_COMPRESSED 5 // compressed texture
<br/>
#define GL_RGB8_A5    6 // 8 color palette, 5 bits of alpha
<br/>
#define GL_RGBA       7 // 15 bit direct color, 1 bit of alpha
<br/>
#define GL_RGB        8 // 15 bit direct color, alpha bit autoset to 1
<br/>
<br/>
How do I convert the images to formats that supports these setting?
<br/>
Do I need to do it, or is a simple 8bit/16bit format all that is needed?
<br/>
The compiler can load pcxfiles. Can that format handle these?
<br/>
<br/>
Which bin-converter do you recommend, so that I can set all these alpha-values?
<br/>
<br/>
I guess the "glTexLoadPal(u16 *pal, u16 count, u32 addr)" command is key for loading a palette, but I can't figure out how to use it, and how to match it to a texture(if that even is needed. Maybe only one 256col palette for all textures is possible?)
<br/>
<br/>
thank you very much.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106623 - Sausage Boy - Sat Oct 21, 2006 4:16 pm</h4>
    <div class="postbody"><span class="postbody">Check out the Paletted Cube demo for info about palettes. The only converter I know about is <a class="postlink" href="http://www.gasp.boxgamex.net/?p=14" target="_blank">my own</a>, it's very unfinished, but it handles raw and paletted formats, not the semi transparent ones.<br/>_________________<br/>"no offense, but this is the gayest game ever"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106627 - Rockard - Sat Oct 21, 2006 4:35 pm</h4>
    <div class="postbody"><span class="postbody">HAH! :D
<br/>
<br/>
Crappo! How could I have missed it... yummy!
<br/>
<br/>
Thanks!!! =)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106644 - Sausage Boy - Sun Oct 22, 2006 12:47 am</h4>
    <div class="postbody"><span class="postbody">Beware. I've found a bug in my program with paletted textures, they get moved down one row, and a garbage row is inserted. I have fixed this, and will hopefully release a new version soon.<br/>_________________<br/>"no offense, but this is the gayest game ever"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106730 - Rockard - Mon Oct 23, 2006 2:24 am</h4>
    <div class="postbody"><span class="postbody">uh, okey!
<br/>
<br/>
I tried the exampel, and converted some new textures that I added to the example... but it didn't work.. =(
<br/>
<br/>
In the end, I found out that the bank was simply out of memory =P.
<br/>
Added bankB to textures =)
<br/>
<br/>
YES! Please, I'll appreciate a new version very much!!!
<br/>
This converter is GOLD!
<br/>
<br/>
btw, with this alpha-channel stuff, is it possible to have some sort of per/pixel alpha value with any of the formats?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106806 - Sausage Boy - Mon Oct 23, 2006 5:37 pm</h4>
    <div class="postbody"><span class="postbody">Yes, it's possible. There are two per pixel semi alpha modes, oen with 8 levels of alpha and 32 colors, and one with 32 levels of alpha and 8 colors.
<br/>
<br/>
I'm having some problems with using these modes in my converter, I think I'm doing everything right, but the semi transparency doesn't seem to work. Anyone know anything about that?<br/>_________________<br/>"no offense, but this is the gayest game ever"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106815 - Rockard - Mon Oct 23, 2006 7:08 pm</h4>
    <div class="postbody"><span class="postbody">Cool!
<br/>
<br/>
It is weird that these featues isn't available to the regular hardware-spritesystem..
<br/>
<br/>
When my 3dbased sprite and tilesystem is done I will never use hardwaresprites ever again!!  HAAAAWHAAAW! :D
<br/>
<br/>
I will try out these alphamodes and see what happends.
<br/>
<br/>
BTW! Have you tried out delfares converter?
<br/>
<a href="http://www.dcemu.co.uk/vbulletin/showthread.php?t=31834" target="_blank">http://www.dcemu.co.uk/vbulletin/showthread.php?t=31834</a>
<br/>
<br/>
There is minimal documentation, so I do not know what it can do, but I suspect that it only handles GL_RGB and GL_RGBA modes.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106834 - Sausage Boy - Mon Oct 23, 2006 9:20 pm</h4>
    <div class="postbody"><span class="postbody">I released a new version, it has no bugs that I know of, except semi transparent modes acting strange.
<br/>
<br/>
<a href="http://www.gasp.boxgamex.net/?p=19" target="_blank">http://www.gasp.boxgamex.net/?p=19</a><br/>_________________<br/>"no offense, but this is the gayest game ever"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106835 - tepples - Mon Oct 23, 2006 9:27 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Rockard wrote:</b></span></td> </tr> <tr> <td class="quote">When my 3dbased sprite and tilesystem is done I will never use hardwaresprites ever again!!  HAAAAWHAAAW! :D</td> </tr></table><span class="postbody">
<br/>
What will you use on the other screen? Or are you planning on using display capture, with its high VRAM use and low frame rate, to service both screens? And are you giving up GBA for good?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106836 - Sausage Boy - Mon Oct 23, 2006 9:32 pm</h4>
    <div class="postbody"><span class="postbody">Often, you'll have most of the action on one screen, and maybe simple information and lesser graphics on the other. I mean, the second screen could still look just as good as it would have if you didn't use 3D on the first. It doesn't suddenly look worse. Unless, of course, you use up all your vram for textures and leave some worthless bank for the second screen.<br/>_________________<br/>"no offense, but this is the gayest game ever"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106837 - Rockard - Mon Oct 23, 2006 10:40 pm</h4>
    <div class="postbody"><span class="postbody">tepples,
<br/>
heheh, I have never programmed for gameboy advance. =P
<br/>
ds is my first consolesystem to develop on.
<br/>
<br/>
Anyway, I will probably save a bank for sprites and stuff for the lower screen, I guess. I just haven't thought about it yet.. =P. It will probably solve itself! =D
<br/>
<br/>
Sausage:
<br/>
Have you tried using these:
<br/>
glEnable(GL_BLEND);
<br/>
glAlphaFunc(BLEND_ALPHA);
<br/>
<br/>
?
<br/>
<br/>
When using those, the textures using GL_RGB32_A3 in the paletted cube example worked and looked nice with alpha!
<br/>
I put a white background in there behind the cube and the edges in the texture melted in. nice =)
<br/>
<br/>
Btw, who did that example? Did you? Since those binfiles must have been converted first.. using _what_ program??
<br/>
<br/>
What paintprogram do you use for converting images? I can't get photoshop to save the pngs as I want them when using 32color paletted images. It doesn't seems to include alpha correctly. I use "export for web", but when choosing 32 colors, the soft transparent edge I made becomes flat, with only 1 color for alpha - totally transparent. GAH!
<br/>
<br/>
EDIT:
<br/>
okey, just tried it out with Paintshoppro also. alphachannel isn't supported when converting to palettebased format, just single color transparancy. How is it possible to convert to texture format 1 and 6 if there isn't a appropriate format to convert from? Or can texmex convert fr?n 16-bit with alpha to these textureformats? Or maybe there is another format besides png that is better suitable for the purpose?
<br/>
<br/>
EDIT 2:
<br/>
<br/>
OK! Just tried converting from 16bit alpha, it worked! :P
<br/>
<br/>
Remember when testing, you do not see the transparencyscales when checking against the empty black space! It only works against texture!
<br/>
<br/>
Here is a link to the cubeexample which I have fooled around with:
<br/>
<a href="http://download.yousendit.com/19B3269D4FC14DD1" target="_blank">http://download.yousendit.com/19B3269D4FC14DD1</a>
<br/>
<br/>
Check texture number 8.
<br/>
So, I think your converter works just fine! =)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106887 - Sausage Boy - Tue Oct 24, 2006 2:24 pm</h4>
    <div class="postbody"><span class="postbody">Hey, sweet!
<br/>
<br/>
You don't need to worry about what format you save in, thanks to FreeImage, texmex can handle just about anything. I use regular 32bit png's with alpha. TexMex can turn 32 bit images into paletted images easily (using functions in freeimage, heh). Just save with the highest quality settings you find. Png is lossless, does 32bit colors with 8bit alpha, all while being very small, I love it. Use that (or something equivalent) and let the conversion program handle the rest.
<br/>
<br/>
<br/>
Edit:
<br/>
<br/>
hmm, are 2, 7, 10 and 11 converted with the old or new version? And what about 7 anyways, is it supposed to look like that? Is it my fault?
<br/>
<br/>
Great work on this demo.<br/>_________________<br/>"no offense, but this is the gayest game ever"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106891 - Rockard - Tue Oct 24, 2006 3:06 pm</h4>
    <div class="postbody"><span class="postbody">heheh :)
<br/>
<br/>
Do not worry about the other numbers, they are just experiments.
<br/>
I think number seven was converted using the old version, from 16bit to 16 colors or something, I do not remember. I just uploaded it with sleepy eyes for you to look at the magical texture number nine.
<br/>
<br/>
<br/>
Thank you VERY MUCH for your help and the great proggy!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106895 - Sausage Boy - Tue Oct 24, 2006 3:26 pm</h4>
    <div class="postbody"><span class="postbody">Thanks a lot for the testing as well.<br/>_________________<br/>"no offense, but this is the gayest game ever"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106938 - Rockard - Wed Oct 25, 2006 12:03 am</h4>
    <div class="postbody"><span class="postbody">Hmm, one more thing, since this is related anyway..
<br/>
<br/>
In an image processing program:
<br/>
Anyone have any idea how to decrease the amount of colours used in a 16bit picture, WITHOUT changing the bitdepth? I just want the effect, not lesser depth.
<br/>
<br/>
Reason for this is that converting a 16bit colorful photo using only texmex won't look so good, I prefer some dithering. But when converting from 16bit to 32 colours in an image processing program, the image has to be flattened to 8bit, which results in loosing of the alpha values.. :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106940 - tepples - Wed Oct 25, 2006 12:26 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Rockard wrote:</b></span></td> </tr> <tr> <td class="quote">converting a 16bit colorful photo using only texmex won't look so good, I prefer some dithering. But when converting from 16bit to 32 colours in an image processing program, the image has to be flattened to 8bit, which results in loosing of the alpha values.. :(</td> </tr></table><span class="postbody">
<br/>
Then save the alpha channel, convert to indexed, convert back to RGB, and restore the alpha channel. How to save an alpha channel depends on which paint program you prefer.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106942 - Rockard - Wed Oct 25, 2006 12:56 am</h4>
    <div class="postbody"><span class="postbody">Hmm, actually, I have already tried this! =P
<br/>
But, it didn't work completely to my satisfaction.. :(
<br/>
<br/>
When flattening a 16bit picture I have to choose a backgroundcolour where the alpha is. Lets say I choose white.
<br/>
<br/>
When applying the saved alphachannel, the edges get a grey tone, since it has recieved colour from the white.
<br/>
<br/>
Check this image: <a href="http://img110.imageshack.us/img110/408/alphaflowerga8.jpg" target="_blank">http://img110.imageshack.us/img110/408/alphaflowerga8.jpg</a>
<br/>
Left is truecolor with alpha set at a black background, right is converted using the method above.
<br/>
<br/>
Any suggestions? :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106945 - tepples - Wed Oct 25, 2006 1:08 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Rockard wrote:</b></span></td> </tr> <tr> <td class="quote">Hmm, actually, I have already tried this! =P
<br/>
But, it didn't work completely to my satisfaction.. :(
<br/>
<br/>
When flattening a 16bit picture I have to choose a backgroundcolour where the alpha is. Lets say I choose white.
<br/>
<br/>
When applying the saved alphachannel, the edges get a grey tone, since it has recieved colour from the white.</td> </tr></table><span class="postbody">
<br/>
This is a side effect of non-premultiplied alpha.
<br/>
<br/>
Can you draw directly on the alpha channel? Try setting alpha to maximum (completely opaque) before using "flatten".<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106959 - Sausage Boy - Wed Oct 25, 2006 7:22 am</h4>
    <div class="postbody"><span class="postbody">Perhaps I should add a way to use the alpha channel from another image? That way, you can convert and dither it to your likings in your editor, save it, and use the two files to get all the alpha.<br/>_________________<br/>"no offense, but this is the gayest game ever"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#107001 - Rockard - Wed Oct 25, 2006 5:03 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
This is a side effect of non-premultiplied alpha.
<br/>
<br/>
Can you draw directly on the alpha channel? Try setting alpha to maximum (completely opaque) before using "flatten".</td> </tr></table><span class="postbody">
<br/>
<br/>
Hmmm? When you convert to 8bit (thats when flatten happens automaticly), layers and alphachannels isn't possible. That is why I have to have a real backgroundcolor.. =/
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Sausage Boy wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Perhaps I should add a way to use the alpha channel from another image? That way, you can convert and dither it to your likings in your editor, save it, and use the two files to get all the alpha.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Hmm, I do not think it will make any difference, since the image will already be "destroyed" when converting it to 32 colors in the imageprogram.. applying the alpha afterwards is what I already tried out. =/
<br/>
<br/>
I think the dodgy solution I have to try is to so simply paste the converted image over the 16bit alpha one, but only covering the area that doesn't have any alpha. It's usually just the edges anyway that have alpha..
<br/>
But its so DODGY :(. I have loads of images I need to convert for my game!
<br/>
<br/>
Hmm, there exists a freeware open-source photoshop-type program I think. Anyone know the name? Maybe I can suggest the feature, if it doesn't exist already..</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#107009 - Sausage Boy - Wed Oct 25, 2006 5:43 pm</h4>
    <div class="postbody"><span class="postbody">Are you thinking of The Gimp?
<br/>
<br/>
I mean that you convert your image to 32 colors, but you save the regular unconverted image, and use the alpha values from there and the pixel values from the dithered image. Not a very good solution, but I think it would work.<br/>_________________<br/>"no offense, but this is the gayest game ever"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#107023 - Rockard - Wed Oct 25, 2006 7:47 pm</h4>
    <div class="postbody"><span class="postbody">OH! :S
<br/>
<br/>
I totally forgot that you can convert the image to 32 colors, and discard the alphachanges! HAaah!
<br/>
<br/>
Actually, I now think that I maybe can do a macro in ps that does all the stuff =).
<br/>
<br/>
I now need to find an option that removes ALL transparencys, so that all colors, even if they hardly is seen, is totally maxed up. Converting to 8bit without transparency takes notice if the transparency level isn't high enough, and then discards the color - which makes the image bad for processing the alpha on.
<br/>
<br/>
<a href="http://img281.imageshack.us/img281/2812/alphaflower2pl5.jpg" target="_blank">http://img281.imageshack.us/img281/2812/alphaflower2pl5.jpg</a>
<br/>
<br/>
Left image, converted as you suggested, without using the alpha. 
<br/>
As you can see, the lightest areas on the leaf are cut out.
<br/>
<br/>
Right image: converted with transparencys intact. You can see that there is faint colors left on the leaf.
<br/>
<br/>
What I need is an image, where the alphavalues are simply removed, so that as much colour as possible on the leaf is left intact. then, I can apply the alphavalues again! 
<br/>
<br/>
Arghh, this gets complicated :P
<br/>
<br/>
Sausage Boy, can you possibly make a converter, that quite simply reads the 16bit alpha image and removes all alpha values, (since photoshop doesn't do it the accurate way) and saves it?
<br/>
<br/>
That would be what is needed. Then, it is possible to convert the quite weird looking image (I guess the edges will have a very strong colors now, esspecially the end of that leaf) to 32 colors, and apply the alpha values again.
<br/>
<br/>
VIOLA! :D</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#107024 - Sausage Boy - Wed Oct 25, 2006 7:52 pm</h4>
    <div class="postbody"><span class="postbody">hmmm, Photoshop want's to be smart... :P
<br/>
<br/>
A nice solution I came up with would be a transparency stripper as you suggested, but it saves the transparency to a seperate file, and then you can use the transparency it saved with your dithered image. Sounds good?<br/>_________________<br/>"no offense, but this is the gayest game ever"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#107026 - Rockard - Wed Oct 25, 2006 8:14 pm</h4>
    <div class="postbody"><span class="postbody">EDIT! I got it wrong.
<br/>
<br/>
YES! This sounds good! So. I input the file, and out comes two files, one with the alpha, and one with the image stripped of the alpha?
<br/>
<br/>
That would be the ultimate solution! =)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#107029 - Sausage Boy - Wed Oct 25, 2006 8:35 pm</h4>
    <div class="postbody"><span class="postbody">I'll get to work on that, expect a new release in a couple of days. Thanks for your input :D. This stuff is more complicated than I thought.<br/>_________________<br/>"no offense, but this is the gayest game ever"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#107031 - Rockard - Wed Oct 25, 2006 8:54 pm</h4>
    <div class="postbody"><span class="postbody">Totally marvelous! =)
<br/>
<br/>
Now I can take a "break" to do some schoolwork, for once... heh :P</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#108032 - Sausage Boy - Sat Nov 04, 2006 4:46 pm</h4>
    <div class="postbody"><span class="postbody">New version with the promised features.
<br/>
<a href="http://www.gasp.boxgamex.net/?p=21" target="_blank">http://www.gasp.boxgamex.net/?p=21</a>
<br/>
<br/>
Strip alpha with
<br/>
TexMex image.png -m alphastrip
<br/>
-m changes the mode to alphastrip
<br/>
<br/>
Use it with
<br/>
TexMex image.png -alpha image_alpha.png -1
<br/>
-alpha sets the image to use for alpha.<br/>_________________<br/>"no offense, but this is the gayest game ever"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121002 - themadcelt - Thu Mar 08, 2007 1:00 am</h4>
    <div class="postbody"><span class="postbody">Sausage Boy - your link appears to have been eaten by the interweb.  Is there any chance I can still get a copy of your program?  I've been searching everywhere for an A3/A5 image conversion app.  If I can't find one, I'll have to make my own and no one wants that to happen.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121139 - Rockard - Fri Mar 09, 2007 12:20 pm</h4>
    <div class="postbody"><span class="postbody">Until he fixes his site: <a href="http://download.yousendit.com/16B860DC3558C082" target="_blank">http://download.yousendit.com/16B860DC3558C082</a>
<br/>
<br/>
=)) great prog.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121154 - themadcelt - Fri Mar 09, 2007 4:16 pm</h4>
    <div class="postbody"><span class="postbody">Thanks Rockard - SausageBoy was kind enough to send me an email with the program.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
