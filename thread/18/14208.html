<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Our PALib alternative - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Our PALib alternative</h2>
<div id="posts">
<div class="post">
    <h4>#141271 - Corsix - Sun Sep 23, 2007 6:22 pm</h4>
    <div class="postbody"><span class="postbody">Overview:
<br/>
A group discussed and implemented high level library for simplifying DS development. 
<br/>
<br/>
Aims:
<br/>
1. It should provide an interface to the DS hardware, which could also be implemented as an interface to PC hardware, thus allowing for debugging to be done in a full IDE on a PC (be able to run on the pc or ds by changing a target)
<br/>
2. Be heavily documented (doxygen?)
<br/>
3. ?
<br/>
<br/>
To get people started, an incomplete abstraction of the 2D cores:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">//! A 2D rendering core
<br/>
/*!
<br/>
   The DS has two rendering cores, called the main core and the sub core. Either core can render to
<br/>
   either screen. The main core has more modes of operation, and has more options for assigning VRAM
<br/>
   to it.
<br/>
   \sa getMain2DCore()
<br/>
   \sa getSub2DCore()
<br/>
*/
<br/>
class I2DCore
<br/>
{
<br/>
public:
<br/>
   //! Possible modes of operation
<br/>
   enum eModes
<br/>
   {
<br/>
      M_Mode0, //!&lt; Text, Text, Text    , Text
<br/>
      M_Mode3, //!&lt; Text, Text, Text    , Extended
<br/>
      M_Mode1, //!&lt; Text, Text, Text    , Rotation
<br/>
      M_Mode4, //!&lt; Text, Text, Rotation, Extended
<br/>
      M_Mode2, //!&lt; Text, Text, Rotation, Rotation
<br/>
      M_Mode5, //!&lt; Text, Text, Extended, Extended
<br/>
      M_FrameBuffer_VRAMA, //!&lt; Direct RGB16 rendering via VRAM bank A
<br/>
   };
<br/>
<br/>
   //! Sets the core to operate in one of the preset modes
<br/>
   /*!
<br/>
      The main 2D core supports all modes, however the sub core only supports modes 0-5.
<br/>
<br/>
      \param eNewMode Mode to operate in
<br/>
      \return true if the mode was set, false if the core does not support the specified mode
<br/>
   */
<br/>
   virtual bool setMode(eModes eNewMode) = 0;
<br/>
<br/>
   //! Areas of the core that can have memory assigned to them
<br/>
   enum eMemoryDestinations
<br/>
   {
<br/>
      MD_Background,
<br/>
      MD_Sprites,
<br/>
      MD_BackgroundExtendedPalettes,
<br/>
      MD_SpriteExtendedPalettes,
<br/>
   };
<br/>
<br/>
   //! Assigns one of the VRAM banks to serve as memory for the core
<br/>
   /*!
<br/>
      A 2D core contains very little built-in memory, therefore VRAM must be assigned to it.
<br/>
<br/>
      \param eMemoryDestination Where to assign the memory to
<br/>
      \param eVRamBank The VRAM bank to assign
<br/>
      \return true if the VRAM bank could be mapped to the destination, false if it is not possible
<br/>
   */
<br/>
   virtual bool assignVRAMBank(eMemoryDestinations eMemoryDestination, eVRamBanks eVRamBank) = 0;
<br/>
<br/>
   //! Gets one of the 4 background layers
<br/>
   /*!
<br/>
      When the core is in mode 0 through 5, then it has 4 background layers, numbered 0 through 3.
<br/>
      Background 3 is drawn at the back, and background 0 at the front.
<br/>
      \param iIndex Index of the background to get (0 through 3, inclusive)
<br/>
      \return Pointer to the background layer, or NULL if the index was not valid, or the current
<br/>
         mode does not have background layers
<br/>
   */
<br/>
   virtual IBackground* getBackground(u16 iIndex) const = 0;
<br/>
<br/>
   //! Gets the builtin core palette for the background layers
<br/>
   /*!
<br/>
      If extended background palettes are not used, then the core has a single 256 entry palette
<br/>
      for the 4 background layers.
<br/>
   */
<br/>
   virtual palette_t* getPrimaryBackgroundPalette() const = 0;
<br/>
<br/>
   //! Gets the builtin core palette for sprites
<br/>
   /*!
<br/>
      If extended sprite palettes are not used, then the core has a single 256 entry palette
<br/>
      for all of the sprites.
<br/>
   */
<br/>
   virtual palette_t* getPrimarySpritePalette() const = 0;
<br/>
};
<br/>
<br/>
//! Gets the main 2D rendering core
<br/>
I2DCore* getMain2DCore();
<br/>
<br/>
//! Gets the sub 2D rendering core
<br/>
I2DCore* getSub2DCore();</td> </tr></table><span class="postbody">
<br/>
<br/>
Post your abstractions of DS features, improve/discuss/comment on other people's abstractions, etc.</span><span class="gensmall"><br/><br/>Last edited by Corsix on Sun Sep 23, 2007 7:16 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#141274 - Peter - Sun Sep 23, 2007 7:13 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Corsix wrote:</b></span></td> </tr> <tr> <td class="quote">1. It should provide an interface to the DS hardware, which could also be implemented as an interface to PC hardware, thus allowing for debugging to be done in a full IDE on a PC (be able to run on the pc or ds by changing a target)
<br/>
</td> </tr></table><span class="postbody">
<br/>
Well, everything else is counterproductive anyway :)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Corsix wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
2. Be heavily documented (doxygen?)
<br/>
</td> </tr></table><span class="postbody">
<br/>
I found doxygen to be an excellent documentation system.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Corsix wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
To get people started, an incomplete abstraction of the 2D cores:
<br/>
</td> </tr></table><span class="postbody">
<br/>
Personally I'm rather scared of virtual functions on platforms like the NDS, since those need an extra table-lookup before they can be called. It doesn't matter for methods which aren't called often, but when performance is an issue, using virtual functions isn't the first choice.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Corsix wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
class I2DCore
<br/>
{
<br/>
   virtual bool setMode(eModes eNewMode) const = 0;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
In my opinion this method shoudn't be const, as it seem to set/modify something in the core.<br/>_________________<br/>Kind Regards,
<br/>
Peter</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141277 - Corsix - Sun Sep 23, 2007 7:22 pm</h4>
    <div class="postbody"><span class="postbody">Whoops, that shouldn't have been const.
<br/>
<br/>
Ultimately, there must be a tradeoff between speed and ease of use. If you want really fast, then you code in assembler using raw libnds. Are there faster ways than virtual methods for providing suitable abstraction?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#141287 - Peter - Sun Sep 23, 2007 8:31 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Corsix wrote:</b></span></td> </tr> <tr> <td class="quote">Are there faster ways than virtual methods for providing suitable abstraction?</td> </tr></table><span class="postbody">
<br/>
I guess it depends why you actually want to use virtual methods. If you only want to provide a base-set of methods, you can also just have two implementations of the class. 
<br/>
<br/>
That's how I made it. I have a class for NDS and one for Win32, both feature the same set of base-methods and have the same name and there is no need to derive from it. 
<br/>
<br/>
For example the NDS class:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
class I2DCore 
<br/>
{ 
<br/>
public:
<br/>
   // base-set of functions
<br/>
   bool setMode(eModes eNewMode) const; 
<br/>
   bool assignVRAMBank(eMemoryDestinations eMemoryDestination, eVRamBanks eVRamBank);
<br/>
<br/>
private:
<br/>
   // nds specific functions
<br/>
};
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
The Win32 class:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
class I2DCore 
<br/>
{ 
<br/>
public:
<br/>
   // base-set of functions
<br/>
   bool setMode(eModes eNewMode) const; 
<br/>
   bool assignVRAMBank(eMemoryDestinations eMemoryDestination, eVRamBanks eVRamBank);
<br/>
<br/>
private:
<br/>
   // win32 specific functions
<br/>
};
<br/>
</td> </tr></table><span class="postbody">
<br/>
If this means a lot of duplicated code, it's probably not the best solution. 
<br/>
<br/>
However, in my particular case the win32 class is using direct3d and the nds class something totally different, so the method implementations have no commonness at all and this is the reason why I chose this approach instead of virtual methods.<br/>_________________<br/>Kind Regards,
<br/>
Peter</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
