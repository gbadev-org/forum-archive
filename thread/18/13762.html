<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Determine Area of screen to touch with stylus? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > Determine Area of screen to touch with stylus?</h2>
<div id="posts">
<div class="post">
    <h4>#135548 - zaczac - Tue Jul 24, 2007 1:40 pm</h4>
    <div class="postbody"><span class="postbody">Ive been searching for this a little while now, and its getting boring! I found an old archive of </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">touchPosition tp = touchReadXY();
<br/>
<br/>
if (tp.py &gt;= 32 &amp;&amp; tp.py &lt; 160 &amp;&amp;     // stylus.y = [32, 159]
<br/>
<br/>
    tp.px &gt;= 32 &amp;&amp; tp.px &lt; 224)     // stylus.x = [32, 223]
<br/>
{
<br/>
<br/>
    // code
<br/>
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
I cant seem to get this to work, i combined it with a PAlib example to load a gif, it works normally, i inputted this code and put the sprite loading part at //code. I was expecting the sprites to show up when i touched the given area on the screen? However the topic i found this in didnt seem to say it was working, do i have some dummy code? :P
<br/>
Could someone please help me out a little? Im aiming to make a main menu, with touch screen 'areas' to go to the main game, level select etc.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135569 - josath - Tue Jul 24, 2007 6:23 pm</h4>
    <div class="postbody"><span class="postbody">a couple suggestions for debugging:
<br/>
<br/>
1. print out the touch values, so that you can see what they are, and make sure they match what you expect
<br/>
2. try testing the load sprite code separately from the touch code, to make sure it works correctly.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135579 - zaczac - Tue Jul 24, 2007 8:14 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for the debugging tips! Im sure they will be useful to me later, and it makes sense to print out the locations! Thanks for that
<br/>
<br/>
As for 2) I can load the sprite correctly without the touch code, when i inserted the touch code, it didnt, i tried changing the range to touch from 0 to 256 and it displayed the sprite...Wierd.. Without even touching the screen... Maybe my entire code is screwed up. Ill post back tommorow when i have the time, i think all im doing is just modifying a PAlib example, but maybe i've made one or two small errors. Thanks!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135661 - zaczac - Wed Jul 25, 2007 9:58 am</h4>
    <div class="postbody"><span class="postbody">Alright, i removed the touch code = displayed gif correctly...added it on and it doesnt load them no matter where i touch! Its a modded example of palib examples 'loadgif'
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">// Include any GIF file and output it on an 8bit or 16bit screen !
<br/>
<br/>
// Includes
<br/>
#include &lt;PA9.h&gt;       // Include for PA_Lib
<br/>
<br/>
#include "Mollusk.h" // gif to include
<br/>
#include "trans.h" // gif to include
<br/>
<br/>
// Function: main()
<br/>
int main(int argc, char ** argv){
<br/>
<br/>
   PA_Init();    // PA Init...
<br/>
   PA_InitVBL();   // VBL Init...
<br/>
   
<br/>
   PA_Init8bitBg(0, 3);    // Init a 16 bit Bg on screen 0
<br/>
   PA_Init8bitBg(1, 3);    // Init a 8 bit Bg on screen 1   
<br/>
<br/>
   touchPosition tp = touchReadXY();
<br/>
<br/>
if (tp.py &gt;= 3 &amp;&amp; tp.py &lt; 4 &amp;&amp;     // stylus.y = [32, 159]
<br/>
<br/>
    tp.px &gt;= 3 &amp;&amp; tp.px &lt; 4)     // stylus.x = [32, 223]
<br/>
{
<br/>
<br/>
   PA_LoadGif(   1, // Screen, which is 8 bit...
<br/>
            (void*)Mollusk); // Gif File
<br/>
<br/>
   PA_LoadGifXY(   0, 100, 60, // Screen, which is 16 bit, and at position 100, 60
<br/>
            (void*)trans); // Gif File
<br/>
}
<br/>
<br/>
<br/>
  while(1)  {
<br/>
      PA_WaitForVBL();
<br/>
   }
<br/>
      
<br/>
   return 0;
<br/>
} // End of main()
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Is there anything suspicious in there? Im thinking maybe that i need something in pa_waitforvbl so that it can continue to use the touch screen, but im a newb to DS programming. Thanks for the help</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135668 - memoni - Wed Jul 25, 2007 1:01 pm</h4>
    <div class="postbody"><span class="postbody">In the code below you are testing super tiny rectangle and you do it only once!
<br/>
<br/>
Try something like the following code. I'm not familiar how the PAlib works, so it may or may not display the image. The structure of the program should be fine, though.
<br/>
<br/>
The program loops forever, and checks the position of the stylus every frame. If the stylus position is in the upper left quarter of the screen, the program checks if the images are loaded already. If they are not, the images are loaded and marked as loaded. If the images are loaded already, nothing happens.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">// Function: main()
<br/>
int main(int argc, char ** argv)
<br/>
{
<br/>
   PA_Init();    // PA Init...
<br/>
   PA_InitVBL();   // VBL Init...
<br/>
   
<br/>
   PA_Init8bitBg(0, 3);    // Init a 16 bit Bg on screen 0
<br/>
   PA_Init8bitBg(1, 3);    // Init a 8 bit Bg on screen 1   
<br/>
<br/>
   int loaded = 0;
<br/>
<br/>
   while (1)
<br/>
   {
<br/>
      // Frame start.
<br/>
<br/>
      touchPosition tp = touchReadXY();
<br/>
<br/>
      // If touched the upper left quarter of the screen
<br/>
      if (tp.px &gt;= 0 &amp;&amp; tp.px &lt; 128 &amp;&amp; tp.py &gt;= 0 &amp;&amp; tp.py &lt; 96)
<br/>
      {
<br/>
         // Check to load the images only once
<br/>
         if (loaded == 0)
<br/>
         {
<br/>
            PA_LoadGif(   1, // Screen, which is 8 bit...
<br/>
                     (void*)Mollusk); // Gif File
<br/>
<br/>
            PA_LoadGifXY(   0, 100, 60, // Screen, which is 16 bit, and at position 100, 60
<br/>
                     (void*)trans); // Gif File
<br/>
<br/>
            loaded = 1;
<br/>
         }
<br/>
      }
<br/>
<br/>
      // Frame ends, wait for next frame.
<br/>
      PA_WaitForVBL(); 
<br/>
   }
<br/>
<br/>
   return 0;
<br/>
} // End of main() </td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135674 - zaczac - Wed Jul 25, 2007 2:43 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for the reply, I was eager to try it out, but it failed. I turned it on and it just loaded up the sprites regardless of me touching the screen. I'll have a mess about with the code and see if i can get it to work, and then post it again, 
<br/>
It annoys me when you find a post with the answer you need and someone says "NVM I GOTS IT!" :I
<br/>
<br/>
thanks for the help though! Especially since your not familiar with Palib! :P</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135788 - mml - Thu Jul 26, 2007 9:58 am</h4>
    <div class="postbody"><span class="postbody">Try throwing in an extra call to touchReadXY somewhere before your main loop and just ignore the value.  The first time it's called it might be getting junk back from some artifact of non-zeroed memory leftover from your cart's loader or something.  I've had similar weirdness happen when reading the state of the X/Y buttons.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135811 - LiraNuna - Thu Jul 26, 2007 3:37 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">      // If touched the upper left quarter of the screen
<br/>
      if (tp.px &gt;= 0 &amp;&amp; tp.px &lt; 128 &amp;&amp; tp.py &gt;= 0 &amp;&amp; tp.py &lt; 96)
<br/>
      {
<br/>
         // Check to load the images only once
<br/>
         if (loaded == 0)
<br/>
         {
<br/>
            PA_LoadGif(   1, // Screen, which is 8 bit...
<br/>
                     (void*)Mollusk); // Gif File
<br/>
<br/>
            PA_LoadGifXY(   0, 100, 60, // Screen, which is 16 bit, and at position 100, 60
<br/>
                     (void*)trans); // Gif File
<br/>
<br/>
            loaded = 1;
<br/>
         }
<br/>
      } </td> </tr></table><span class="postbody">
<br/>
<br/>
Just a note about this code - efficiency wise (sorry, I can't watch this kind of code without giving tips..), but I would advise you to change the way you run your ifs when they are nasted. since if(loaded==0) is likely to return false more then true (it changes it's value), and since your second if is rather heavy (has 4 checks), I would suggest:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
bool isLoaded = false;
<br/>
<br/>
   // First check if we need to enter the long if
<br/>
if (!isLoaded) {
<br/>
      //Read touch input
<br/>
   touchPosition tp = touchReadXY(); 
<br/>
      
<br/>
      // If touched the upper left quarter of the screen
<br/>
   if (tp.px &gt;= 0 &amp;&amp; tp.px &lt; 128 &amp;&amp; tp.py &gt;= 0 &amp;&amp; tp.py &lt; 96) {
<br/>
      PA_DoStuffHere( /*PA_Args*/ );
<br/>
         
<br/>
      isLoaded= true;
<br/>
   }
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
Also note that I read the touch input only if needed, to save processing time.
<br/>
<br/>
<span style="font-size: 7px; line-height: normal">Now you elders can flame me about being a lame asshole when giving novice programmers some tips...</span><br/>_________________<br/>Private property.
<br/>
Violators will be shot, survivors will be shot again.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135812 - mastertop101 - Thu Jul 26, 2007 3:42 pm</h4>
    <div class="postbody"><span class="postbody">Why don't you use Stylus.X and Stylus.Y if you're using palib?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135814 - zaczac - Thu Jul 26, 2007 3:57 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Why don't you use Stylus.X and Stylus.Y if you're using palib?</td> </tr></table><span class="postbody">
<br/>
<br/>
Because Im Stupid.I Didnt Realise That One! Thanks. Ill try it and post back if that did anything, then try LiraNuna's Idea. Thanks A Lot For the help guys.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
