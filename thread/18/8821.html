<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Functions in IWRAM ? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Functions in IWRAM ?</h2>
<div id="posts">
<div class="post">
    <h4>#74629 - Mollusk - Mon Mar 06, 2006 4:47 pm</h4>
    <div class="postbody"><span class="postbody">I have some critical code I'd like to make as fast as possible, so I wanted to do like I did with the gba : put the code in IWRAM... But there don't seem to be any macros to do so, and when I use my own ones devkitpro tells me there is no .iwram section...
<br/>
<br/>
Any ideas ?<br/>_________________<br/>PAlib official forum : <a class="postlink" href="http://www.palib.info" target="_blank">http://www.palib.info</a>
<br/>
PAlib official tutorials: <a class="postlink" href="http://www.palib.info/wiki" target="_blank">http://www.palib.info/wiki</a>
<br/>
Updates, help, code examples, tutorials, etc...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#74635 - knight0fdragon - Mon Mar 06, 2006 6:09 pm</h4>
    <div class="postbody"><span class="postbody">I discussed that question before so heres the answer
<br/>
<br/>
source:
<br/>
<a href="http://www.forum.gbadev.org/viewtopic.php?t=5856&amp;start=30" target="_blank">http://www.forum.gbadev.org/viewtopic.php?t=5856&amp;start=30</a>
<br/>
<br/>
from DekuTree64</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">It looks like the latest ARM7 linkscript puts variables in iwram by default, and it would still run fine with the table in main RAM anyway.</td> </tr></table><span class="postbody"><br/>_________________<br/><a href="http://www.myspace.com/knight0fdragonds" target="_blank">http://www.myspace.com/knight0fdragonds</a>
<br/>
<br/>
MK DS FC: Dragon 330772 075464 
<br/>
AC WW FC: Anthony SamsClub 1933-3433-9458 
<br/>
MPFH: Dragon 0215 4231 1206</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#74636 - Mollusk - Mon Mar 06, 2006 6:16 pm</h4>
    <div class="postbody"><span class="postbody">but it's the functions I want to put in IWRAM, not the variables...<br/>_________________<br/>PAlib official forum : <a class="postlink" href="http://www.palib.info" target="_blank">http://www.palib.info</a>
<br/>
PAlib official tutorials: <a class="postlink" href="http://www.palib.info/wiki" target="_blank">http://www.palib.info/wiki</a>
<br/>
Updates, help, code examples, tutorials, etc...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#74639 - DekuTree64 - Mon Mar 06, 2006 6:29 pm</h4>
    <div class="postbody"><span class="postbody">Well, on ARM9, functions go into main RAM by default, so you do have to specify. The section you're after is .itcm, which is 32KB and even faster than IWRAM because it's internal to the ARM9 core, which runs at twice the main system frequency. There's also .dtcm for data, which is 16KB. 
<br/>
<br/>
There are 2 16KB blocks of IWRAM that can be toggled back and forth between the two processors, which are pretty fast too. I guess there's no section defined for them though.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#74658 - Mollusk - Mon Mar 06, 2006 8:56 pm</h4>
    <div class="postbody"><span class="postbody">Thanks Deku. I already put the code in ITCM, but it just didn't seem faster than normal code, not sure why :/ (it's basically routines writing to the VRAM to plot pixels).<br/>_________________<br/>PAlib official forum : <a class="postlink" href="http://www.palib.info" target="_blank">http://www.palib.info</a>
<br/>
PAlib official tutorials: <a class="postlink" href="http://www.palib.info/wiki" target="_blank">http://www.palib.info/wiki</a>
<br/>
Updates, help, code examples, tutorials, etc...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#74670 - DekuTree64 - Mon Mar 06, 2006 10:45 pm</h4>
    <div class="postbody"><span class="postbody">Yeah, since drawing routines are generally fairly tight loops, they'll just get cached on the first run through. ITCM is good when you have something that's called occasionally throughout the frame, but not often enough to stay in the cache between calls.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#74671 - Mollusk - Mon Mar 06, 2006 10:48 pm</h4>
    <div class="postbody"><span class="postbody">ok, I'll test ITCM on other program parts to see if it gives them speed increases then...<br/>_________________<br/>PAlib official forum : <a class="postlink" href="http://www.palib.info" target="_blank">http://www.palib.info</a>
<br/>
PAlib official tutorials: <a class="postlink" href="http://www.palib.info/wiki" target="_blank">http://www.palib.info/wiki</a>
<br/>
Updates, help, code examples, tutorials, etc...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#74904 - acox - Wed Mar 08, 2006 6:33 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>DekuTree64 wrote:</b></span></td> </tr> <tr> <td class="quote">Yeah, since drawing routines are generally fairly tight loops, they'll just get cached on the first run through. ITCM is good when you have something that's called occasionally throughout the frame, but not often enough to stay in the cache between calls.</td> </tr></table><span class="postbody">
<br/>
<br/>
Since that stuff is already in a tightly coupled memory, you wouldn't want it poluting the cache as well.
<br/>
<br/>
Anyone done some work on keeping the itcm &amp; dtcm contents out of the caches?<br/>_________________<br/><a class="postlink" href="http://www.btinternet.com/~ahcox/GBA/" target="_blank">3D on GBA</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#74905 - pepsiman - Wed Mar 08, 2006 7:02 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>acox wrote:</b></span></td> </tr> <tr> <td class="quote">Anyone done some work on keeping the itcm &amp; dtcm contents out of the caches?</td> </tr></table><span class="postbody">
<br/>
Devkitarm does this by default.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
