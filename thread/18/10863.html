<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>New Battery Information discovered! (demo version 2) - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > New Battery Information discovered! (demo version 2)</h2>
<div id="posts">
<div class="post">
    <h4>#99062 - Lick - Sat Aug 19, 2006 11:02 am</h4>
    <div class="postbody"><span class="postbody">Hey everyone, if you haven't seen my brightness demo: you really <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=10847" target="_blank">should</a>!
<br/>
It's a FIFO-based demo that demonstrates useful information gathering from the ARM7-access-only registers.
<br/>
<br/>
I was messing with version 1 of the demo as I found out that when the charger was plugged in, the brightness value increased by 8. So I figured that bit(3) would be the 'is battery charging' bit. As I'm not sure if this is DS Lite specific (probably not), I hereby declare that SPI DATA REG 4 is -NOT- DS Lite specific anymore, but is also containing other information. 
<br/>
In my src I call it PM_HARDWARE_REG (perhaps it should be called EXTRA).
<br/>
<br/>
Anyway, I updated on several spots. Read below.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
` 19-08-06 ` Found a powerful useful bit. The is-battery-recharging bit.
<br/>
             It's the 4th bit (BIT(3)) of SPI DATA REG 4, that was at first
<br/>
             though to be a DS Lite specific register.
<br/>
             
<br/>
             - Added feature to see if battery is recharging.
<br/>
             - Instead of substracting 64, the brightness bit is masked.
<br/>
             - Renamed some of the #defines and functions.
<br/>
             - Made GET_BRIGHTNESS on Phatty return 0 or 1. (not 0 or 2)
<br/>
             - Added the sun icon, I pixelled (hehe), to the package.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<a class="postlink" href="http://lick.huuf.net/brightness_test_v2.zip" target="_blank">http://lick.huuf.net/brightness_test_v2.zip</a> (Play with it, plug the charger in and out etc.)
<br/>
<br/>
Hope the code will help you develop a strong application!
<br/>
- Lick
<br/>
<br/>
P.S. Thanks <a class="postlink" href="http://huuf.net" target="_blank">Huuf</a> for hosting!<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#99065 - chrisis - Sat Aug 19, 2006 12:29 pm</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
I've got both, a Phat (Japanese black model) and a Lite (European black model), both flashed with Flashme Stealth V7 (the Phat's original firmware was v4 - yellow), and one Super Card CF.
<br/>
<br/>
So, the charging message works right on the Lite, as intended. 
<br/>
However, on the Phat, nothing changes when charging/not charging, it always shows charging - at least as long as the backlight is on. But as soon as the backlight is turned off, it shows "not charging", no matter if that's the case or not.
<br/>
<br/>
So I assume on the Phat this register only shows if background is turned on or off.
<br/>
<br/>
Oh, and please excuse my non programmer speach, I'm not really a programmer at all, just love trying out all that great homebrew!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#99076 - Lick - Sat Aug 19, 2006 1:21 pm</h4>
    <div class="postbody"><span class="postbody">Thank you thank you! 
<br/>
<br/>
So perhaps it -is- a DSLite specific register after all. Problem is, I can't code for Phatty if I don't have his hardware.
<br/>
<br/>
Thanks for your input, I will figure some things out.<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#99100 - Liter - Sat Aug 19, 2006 3:36 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for this, nice little util. :)
<br/>
<br/>
Would it be possible to display exactly how fully charged the battery is in terms of percentage please?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#99104 - Lick - Sat Aug 19, 2006 3:45 pm</h4>
    <div class="postbody"><span class="postbody">Unfortunately the location of that information is still unclear. We don't even know if that information exists at all! But if it does, I'll be (one of.. =/) the first to tell ya!<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#99106 - Liter - Sat Aug 19, 2006 4:01 pm</h4>
    <div class="postbody"><span class="postbody">Thanks.
<br/>
<br/>
Presumably there must be some indication somewhere though?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#99110 - Lick - Sat Aug 19, 2006 4:22 pm</h4>
    <div class="postbody"><span class="postbody">Not sure, since the start up screens don't display that kind of information, we're not sure. There also isn't a commercial game/application that proved it can be done.
<br/>
<br/>
So nada?<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#99138 - kinvig - Sat Aug 19, 2006 7:24 pm</h4>
    <div class="postbody"><span class="postbody">forgive me if this is obvious or not helping but
<br/>
<br/>
on my DSLite
<br/>
<br/>
Animal crossing must look at something to do with battery level as when power led turns from green to red animal crossing wild world suggests saving the game as battery level is low. 
<br/>
<br/>
Regards
<br/>
<br/>
Kinvig</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#99140 - tepples - Sat Aug 19, 2006 7:27 pm</h4>
    <div class="postbody"><span class="postbody">The CPU can read whether the battery is red or green (that is, good enough for <span style="font-style: italic">ACWW</span>). It may not be capable of a more precise reading than that (that is, not good enough for Liter's request).<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#99157 - JaJa - Sat Aug 19, 2006 9:03 pm</h4>
    <div class="postbody"><span class="postbody">I think the DS just uses a voltage drop to estimate the amount left in the battery.
<br/>
<br/>
This is why it can be red, but turning down the volume, turning off wifi or removing the supercard (which is a battery killer) makes it green again.<br/>_________________<br/>LAWL HOOGE
<br/>
<a class="postlink" href="http://www.pageofrandom.wordpress.com/" target="_blank">My Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#99261 - LiraNuna - Sun Aug 20, 2006 10:35 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I hereby declare that SPI DATA REG 4 is -NOT- DS Lite specific anymore</td> </tr></table><span class="postbody">
<br/>
<br/>
That's so wrong...
<br/>
<br/>
Writing to PM4 on a phat DS will mirror it to PM0. Try to write 0x3 to it, and the DS will shut down. That's why my demo was at first DS Lite version only - Phat DSs shutted down on startup.<br/>_________________<br/>Private property.
<br/>
Violators will be shot, survivors will be shot again.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#99289 - Lick - Sun Aug 20, 2006 2:42 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lick wrote:</b></span></td> </tr> <tr> <td class="quote">So perhaps it -is- a DSLite specific register after all. Problem is, I can't code for Phatty if I don't have his hardware.</td> </tr></table><span class="postbody">
<br/>
<br/>
Yeah I figured that out already Liran..<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
