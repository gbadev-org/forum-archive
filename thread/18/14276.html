<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Texture projected along the viewing angle - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Texture projected along the viewing angle</h2>
<div id="posts">
<div class="post">
    <h4>#142235 - Ishi - Sat Oct 06, 2007 7:35 pm</h4>
    <div class="postbody"><span class="postbody">I'm working through all the features I want in my 3D engine, and next up is textures that stay static on the screen regardless of how the polygon is oriented or scaled.
<br/>
<br/>
Another way to describe it is that the texture is getting projected down the camera's viewing angle.
<br/>
<br/>
What I'm aiming for is to be able to do something like this dude out of Monkey Island - the pattern on his jacket stays flat to the camera even when he moves around: <a href="http://www.hebrewquest.com/images/StanAni1.gif" target="_blank">http://www.hebrewquest.com/images/StanAni1.gif</a>
<br/>
<br/>
<br/>
My plan for doing this is:
<br/>
- Use TEXGEN_POSITION to get the vertex position
<br/>
- Use the texture matrix to transform this position into screen space
<br/>
- The X and Y co-ords should then work nicely as U and V, mapping the texture flat onto the screen
<br/>
<br/>
<br/>
I've got it partially working. As I spin around the model, the texture stays roughly in the same on-screen position:
<br/>
<a href="http://www.ishisoft.remakes.org/misc/screenshot0001.png" target="_blank">http://www.ishisoft.remakes.org/misc/screenshot0001.png</a>
<br/>
<a href="http://www.ishisoft.remakes.org/misc/screenshot0002.png" target="_blank">http://www.ishisoft.remakes.org/misc/screenshot0002.png</a>
<br/>
<a href="http://www.ishisoft.remakes.org/misc/screenshot0003.png" target="_blank">http://www.ishisoft.remakes.org/misc/screenshot0003.png</a>
<br/>
<a href="http://www.ishisoft.remakes.org/misc/screenshot0004.png" target="_blank">http://www.ishisoft.remakes.org/misc/screenshot0004.png</a>
<br/>
<br/>
What it doesn't do at the moment is take the depth into account, as you get closer to the model, the texture gets bigger on-screen:
<br/>
<a href="http://www.ishisoft.remakes.org/misc/screenshot0005.png" target="_blank">http://www.ishisoft.remakes.org/misc/screenshot0005.png</a>
<br/>
<br/>
Rotating above/below the model doesn't work either, the texture shifts up and down:
<br/>
<a href="http://www.ishisoft.remakes.org/misc/screenshot0006.png" target="_blank">http://www.ishisoft.remakes.org/misc/screenshot0006.png</a>
<br/>
<br/>
<br/>
My problem is more than likely in generating the texture matrix. It basically needs to do the same as the modelview and projection matrices together, to get the position into screen co-ords (I'm assuming TEXGEN_POSITION uses the world position of the vertex).
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   //set up the texture matrix
<br/>
   glMatrixMode(GL_TEXTURE);
<br/>
   glLoadIdentity();
<br/>
   
<br/>
   GLvector scale = { (width / 2) &lt;&lt; 16, (height / 2) &lt;&lt; 16, 1 &lt;&lt; 16 };
<br/>
   glScalev(&amp;scale);
<br/>
<br/>
   m4x4 clip;
<br/>
   glGetFixed(GL_GET_MATRIX_CLIP, clip.m);
<br/>
   glMultMatrix4x4(&amp;clip);</td> </tr></table><span class="postbody">
<br/>
<br/>
Currently I'm just using the clip matrix (I don't even know what the clip matrix is actually). I've tried a mixture of clip, position and projection matrices, some of which give me the same effect I've currently got, but I can't get it any better.
<br/>
<br/>
The scale is just there to make the texture a decent size on screen (it was too big without it). Once the transformation is correct, this shouldn't be needed I don't think.
<br/>
<br/>
Thanks much in advance for any help :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#142547 - a128 - Wed Oct 10, 2007 8:32 am</h4>
    <div class="postbody"><span class="postbody">I do not understand what you will achive...Do you mean a Billboard?</span><span class="gensmall"><br/><br/>Last edited by a128 on Thu Oct 11, 2007 8:19 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#142595 - sajiimori - Wed Oct 10, 2007 6:19 pm</h4>
    <div class="postbody"><span class="postbody">No, it's an effect that looks like a light pattern is being shined on an object, and when the object moves, the light stays still so the texture appears to scroll across the object.
<br/>
<br/>
It's a neat idea!  The math would take me a while to figure out though because I'm so bad at it.  ;)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
