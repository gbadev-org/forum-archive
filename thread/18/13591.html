<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Tiled backgrounds & sprites @ one time - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Tiled backgrounds & sprites @ one time</h2>
<div id="posts">
<div class="post">
    <h4>#133384 - Phantaseur - Thu Jul 05, 2007 9:52 pm</h4>
    <div class="postbody"><span class="postbody">I'm trying to display tiled background and sprite on screen at one time, but I have problems with it, I can see only sprite or only background. It depend of thing which I assign to VRAM_A. If I write</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   VRAM_A_CR=VRAM_ENABLE|VRAM_A_MAIN_SPRITE;
<br/>
   VRAM_B_CR=VRAM_ENABLE|VRAM_B_MAIN_BG;</td> </tr></table><span class="postbody"> i see only sprite on the screen, if i write</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   VRAM_A_CR=VRAM_ENABLE|VRAM_A_MAIN_BG;
<br/>
   VRAM_B_CR=VRAM_ENABLE|VRAM_B_MAIN_SPRITE;</td> </tr></table><span class="postbody">i see just background. What I have to do for getting sprite and backgroung at one time?
<br/>
<br/>
Here is code:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include&lt;nds.h&gt;
<br/>
#include&lt;string.h&gt;
<br/>
<br/>
u8 redTile[64] = 
<br/>
{
<br/>
   1,1,1,1,1,1,1,1,
<br/>
   1,2,2,2,2,2,2,1,
<br/>
   1,2,2,2,2,2,2,1,
<br/>
   1,2,2,2,2,2,2,1,
<br/>
   1,2,2,2,2,2,2,1,
<br/>
   1,2,2,2,2,2,2,1,
<br/>
   1,2,2,2,2,2,2,1,
<br/>
   1,1,1,1,1,1,1,1
<br/>
};
<br/>
<br/>
u8 greenTile[64] = 
<br/>
{
<br/>
   3,3,3,3,3,3,3,3,
<br/>
   3,4,4,4,4,4,4,3,
<br/>
   3,4,5,5,5,5,4,3,
<br/>
   3,4,5,5,5,5,4,3,
<br/>
   3,4,5,5,5,5,4,3,
<br/>
   3,4,5,5,5,5,4,3,
<br/>
   3,4,4,4,4,4,4,3,
<br/>
   3,3,3,3,3,3,3,3
<br/>
};
<br/>
<br/>
int main(){
<br/>
   int id;
<br/>
   SpriteEntry *spriteEntry = new SpriteEntry[128];
<br/>
   SpriteRotation *spriteRotation = (SpriteRotation*)spriteEntry;
<br/>
<br/>
   REG_POWERCNT=POWER_ALL_2D;
<br/>
   DISPLAY_CR=MODE_0_2D|DISPLAY_BG0_ACTIVE|DISPLAY_SPR_ACTIVE|DISPLAY_SPR_1D;
<br/>
   BG0_CR=BG_32x32|BG_COLOR_256|BG_MAP_BASE(0)|BG_TILE_BASE(1);
<br/>
<br/>
   /*VRAM_A_CR=VRAM_ENABLE|VRAM_A_MAIN_SPRITE;
<br/>
   VRAM_B_CR=VRAM_ENABLE|VRAM_B_MAIN_BG;*/
<br/>
   VRAM_A_CR=VRAM_ENABLE|VRAM_A_MAIN_BG;
<br/>
   VRAM_B_CR=VRAM_ENABLE|VRAM_B_MAIN_SPRITE;
<br/>
<br/>
   BG_PALETTE[1] = RGB15(31,0,0);
<br/>
   BG_PALETTE[2] = RGB15(0,31,0);
<br/>
   SPRITE_PALETTE[3]=RGB15(0,0,31);
<br/>
   SPRITE_PALETTE[4]=RGB15(0,0,0);
<br/>
   SPRITE_PALETTE[5]=RGB15(31,31,31);
<br/>
<br/>
   memcpy((void*)BG_TILE_RAM(1), redTile, 64);
<br/>
   memcpy((void*)(BG_TILE_RAM(1)+64), greenTile, 64);
<br/>
<br/>
   for(int i=0;i&lt;32*32;i++){
<br/>
      (*(unsigned short*)(void*)(BG_MAP_RAM(0)+i*2))=0;
<br/>
   }
<br/>
<br/>
   for (int i = 0; i &lt; 128; i++) {
<br/>
   spriteEntry[i].attribute[0] = ATTR0_DISABLED;
<br/>
   spriteEntry[i].attribute[1] = 0;
<br/>
   spriteEntry[i].attribute[2] = 0;
<br/>
   }
<br/>
   for (int i = 0; i &lt; 32; i++) {
<br/>
   spriteRotation[i].hdx = 256;
<br/>
   spriteRotation[i].hdy = 0;
<br/>
   spriteRotation[i].vdx = 0;
<br/>
   spriteRotation[i].vdy = 256;
<br/>
   }
<br/>
<br/>
   id=0;
<br/>
   spriteEntry[0].attribute[0] = ATTR0_COLOR_256 | ATTR0_ROTSCALE | 128;
<br/>
   spriteEntry[0].attribute[1] = ATTR1_ROTDATA(0) | ATTR1_SIZE_8 | 96;
<br/>
   spriteEntry[0].attribute[2] = id;
<br/>
<br/>
   for(int i=0;i&lt;8*4;i++)
<br/>
      SPRITE_GFX[i+id*16]=(greenTile[2*i+1]&lt;&lt;8)|greenTile[2*i];
<br/>
<br/>
   DC_FlushRange(spriteEntry,128*sizeof(SpriteEntry));
<br/>
   dmaCopy(spriteEntry,OAM, 128*sizeof(SpriteEntry));
<br/>
<br/>
   while(1);
<br/>
<br/>
   return(0);
<br/>
}</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#133400 - Azenris - Thu Jul 05, 2007 11:42 pm</h4>
    <div class="postbody"><span class="postbody">try using this
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">VRAM_A_CR=VRAM_ENABLE|VRAM_A_MAIN_BG_0x06000000; 
<br/>
VRAM_B_CR=VRAM_ENABLE|VRAM_B_MAIN_SPRITE_0x6400000;</td> </tr></table><span class="postbody"><br/>_________________<br/><a class="postlink" href="http://sacredpotion.blogspot.com/" target="_blank"><span style="color: red">My Homebrew Games</span></a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#133510 - Phantaseur - Fri Jul 06, 2007 4:47 pm</h4>
    <div class="postbody"><span class="postbody">It doesnt work...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#133845 - Phantaseur - Mon Jul 09, 2007 6:59 am</h4>
    <div class="postbody"><span class="postbody">Is there any way to get sprite over background?
<br/>
How can I do it?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#133853 - knight0fdragon - Mon Jul 09, 2007 8:36 am</h4>
    <div class="postbody"><span class="postbody">can you post a place to download your code? i want to tinker with it, but idont want to setup an enviroment or anything<br/>_________________<br/><a href="http://www.myspace.com/knight0fdragonds" target="_blank">http://www.myspace.com/knight0fdragonds</a>
<br/>
<br/>
MK DS FC: Dragon 330772 075464 
<br/>
AC WW FC: Anthony SamsClub 1933-3433-9458 
<br/>
MPFH: Dragon 0215 4231 1206</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#133931 - Phantaseur - Mon Jul 09, 2007 9:31 pm</h4>
    <div class="postbody"><span class="postbody">Ahh.. It works, I tried it at old version of dualis and there was no expected resultat, now I copied *.nds to R4DS and it works on real hardware.
<br/>
Thank you for help offering. Sorry for disturb.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#133938 - HyperHacker - Mon Jul 09, 2007 9:52 pm</h4>
    <div class="postbody"><span class="postbody">Lesson learned: Don't trust emulators entirely, at least not yet. They are still all quite immature and have many bugs and/or differences from real hardware. No$GBA is most accurate if you don't need (or want to pay $5000 for &lt;_&lt;) a debugger, but there are still some issues (mainly sound-related).<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
