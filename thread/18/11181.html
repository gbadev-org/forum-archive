<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Cant get project working with newest devkitpro - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Cant get project working with newest devkitpro</h2>
<div id="posts">
<div class="post">
    <h4>#102965 - ChronoDK - Mon Sep 18, 2006 8:35 am</h4>
    <div class="postbody"><span class="postbody">I'm having trouble getting my project working with the latest devkitpro. It's a nine month old project, that I'm finally having the time to resurrect. It compiles and gives me a working .nds on devkitarm_r17 with ndslib up to release 20060201. After that, it stops working. It still compiles without errors (after changing BG_CR to BGCTRL), but the .nds just freezes. 
<br/>
<br/>
I'm thinking it might have something to do with the makefiles, or perhaps something with the binary spritedata as the game seems to freeze when the sprites are initialized. Unfortunatly I don't know much about those things, especially makefiles, so I can't fix it myself :-(
<br/>
<br/>
I can continue to work on it with the old devkitpro, but I would really like to use the latest release. 
<br/>
<br/>
If someone has the time to look at it, please do. The whole project with source and data is here:
<br/>
<a href="http://chrono.moogle.dk/ninja_engine.zip" target="_blank">http://chrono.moogle.dk/ninja_engine.zip</a>
<br/>
<br/>
Don't know how good the code is, but feel free to use it in your own projects. No credit needed.</span><span class="gensmall"><br/><br/>Last edited by ChronoDK on Sat Sep 23, 2006 8:53 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#102979 - headspin - Mon Sep 18, 2006 12:15 pm</h4>
    <div class="postbody"><span class="postbody">You may want to handle the sprites the way the latest libnds example does. Check out the examples\nds and use the templates in there. Then build your project back part by part by introducing your original source files and testing as you go. Use the console to output to see whats going on so you can track down possible errors.
<br/>
<br/>
There probably isn't much chance of someone fixing your code, your probably better off trying yourself, but someone might be kind enough.<br/>_________________<br/><a class="postlink" href="http://headsoft.com.au/index.php?category=warhawk" target="_blank">Warhawk DS</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=mmll" target="_blank">Manic Miner: The Lost Levels</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=tdg" target="_blank">The Detective Game</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#103031 - ChronoDK - Mon Sep 18, 2006 8:23 pm</h4>
    <div class="postbody"><span class="postbody">I know, it's a long shot. But hey, maybe someone will be kind enough :-)
<br/>
<br/>
I did try to slowly introduce the code to the new devkitpro, and something goes wrong when I get to the sprites. That is why I suspect the makefile might be the problem. 
<br/>
<br/>
But the examples for libnds does the same thing I do, so looking at them didn't help much unfortunatly.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#103677 - ChronoDK - Sat Sep 23, 2006 7:45 pm</h4>
    <div class="postbody"><span class="postbody">I tried again, and this time I got it narrowed down to these few lines: 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
oam = &amp;gameworld-&gt;sprite_control-&gt;OAMCopy[oamIndex];
<br/>
<br/>
// Set up the sprite's OAM entry attributes
<br/>
if (rotate) {
<br/>
      rotation_index = gameworld-&gt;sprite_control-&gt;getRotIndex();
<br/>
      oam-&gt;attribute[0] = ATTR0_COLOR_16 | ATTR0_SQUARE | ATTR0_ROTSCALE;
<br/>
      if (width == height &amp;&amp; width &lt; 64) //for square sprites less than 64 pixels wide
<br/>
         oam-&gt;attribute[1] = width * 1024 | ATTR1_ROTDATA(rotation_index);
<br/>
      else if (width == height &amp;&amp; width == 64)//for 64 pixels wide square sprites 
<br/>
         oam-&gt;attribute[1] = 48 * 1024 | ATTR1_ROTDATA(rotation_index);
<br/>
   }
<br/>
   else {
<br/>
      rotation_index = 0;
<br/>
      oam-&gt;attribute[0] = ATTR0_COLOR_16 | ATTR0_SQUARE;
<br/>
      if (width == height &amp;&amp; width &lt; 64) //for square sprites less than 64 pixels wide
<br/>
         oam-&gt;attribute[1] = width * 1024;
<br/>
      else if (width == height &amp;&amp; width == 64)//for 64 pixels wide square sprites 
<br/>
         oam-&gt;attribute[1] = 48 * 1024;
<br/>
   }
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
It's from my sprite class constructor. If I comment out the big if-else thing the program runs with devkitPro R19 (but the sprites wont work then of course). 
<br/>
<br/>
Has something changed with the way the sprite attributes are set? Or is there another problem?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#103703 - Lick - Sat Sep 23, 2006 11:35 pm</h4>
    <div class="postbody"><span class="postbody">What is the ' * 1024' part supposed to do? (And why isn't attribute[2] set?)
<br/>
<br/>
- Lick<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#103740 - ChronoDK - Sun Sep 24, 2006 9:18 am</h4>
    <div class="postbody"><span class="postbody">Thank you! Attribute 2 is set later on with this:
<br/>
<br/>
oam-&gt;attribute[2] = ATTR2_PALETTE(pal) | attr2 | gfx;
<br/>
<br/>
Where attr2 was a u16. I changed it to u32 and now it works :D
<br/>
<br/>
I don't think I would have figured that out, if you hadn't asked. Strange thing that it worked when I commented the other part out.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#103798 - Lick - Sun Sep 24, 2006 6:21 pm</h4>
    <div class="postbody"><span class="postbody">Wow.. Great. Glad it helped!! ;D
<br/>
<br/>
- Lick<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
