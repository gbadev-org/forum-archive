<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Help with 3D - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > Help with 3D</h2>
<div id="posts">
<div class="post">
    <h4>#167999 - opearn - Mon Apr 06, 2009 2:38 pm</h4>
    <div class="postbody"><span class="postbody">hi every one,
<br/>
<br/>
i'm trying to load and texture multiple 3D models on the nds,
<br/>
errors:
<br/>
my ground model isn't being drawn,
<br/>
and the enemys texture dosn't wrap the entire model
<br/>
<br/>
i think the main error is with the tex_scale....
<br/>
(i'm not really sure what to set tex_scale to so i ended up copying from an example)
<br/>
<br/>
the following is an extract from my code.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">GLvector tex_scale = { 64&lt;&lt;16, -64&lt;&lt;16, 1&lt;&lt;16 };
<br/>
GLvector tex_scale2 = { 64&lt;&lt;16, -64&lt;&lt;16, 1&lt;&lt;16 };
<br/>
<br/>
glMatrixMode(GL_MODELVIEW);
<br/>
glLoadIdentity();
<br/>
<br/>
//draw all our models
<br/>
   //ground
<br/>
      //position variables
<br/>
      glMatrixMode(GL_TEXTURE);
<br/>
      glLoadIdentity();
<br/>
      glScalev( &amp;tex_scale2 );      //scale normals up from (-1,1) range into texcoords
<br/>
      glRotateXi(0);
<br/>
      glRotateYi(0);
<br/>
      glMatrixMode(GL_POSITION);
<br/>
      glLoadIdentity();
<br/>
      glTranslate3f32(0,0,floattof32(0));   // x,y,z
<br/>
      glRotateXi(0);
<br/>
      glRotateYi(0);
<br/>
      
<br/>
      glMaterialf(GL_EMISSION, RGB15(31,31,31));
<br/>
      glPolyFmt(POLY_ALPHA(31) | POLY_ID(8) | POLY_CULL_BACK | POLY_FORMAT_LIGHT0);
<br/>
      
<br/>
      glBindTexture(0, texture[0]);         //wrap texture (non functional)
<br/>
      glCallList((u32*)ground_model_bin);         //draw model
<br/>
<br/>
   //enemy
<br/>
      //position variables
<br/>
      glMatrixMode(GL_TEXTURE);
<br/>
      glLoadIdentity();
<br/>
      glScalev( &amp;tex_scale );      //scale normals up from (-1,1) range into texcoords
<br/>
      glRotateXi(0);
<br/>
      glRotateYi(0);
<br/>
      glMatrixMode(GL_POSITION);
<br/>
      glLoadIdentity();
<br/>
      glTranslate3f32(p2x,p2y,floattof32(p2z));   // x,y,z
<br/>
      glRotateXi(p2rotx);                     //xrot
<br/>
      glRotateYi(p2roty);                     //yrot
<br/>
      
<br/>
      glMaterialf(GL_EMISSION, RGB15(31,31,31));
<br/>
      glPolyFmt(POLY_ALPHA(31) | POLY_ID(8) | POLY_CULL_BACK | POLY_FORMAT_LIGHT0);
<br/>
      
<br/>
      glBindTexture(0, texture[3]);            //wrap texture (non functional)
<br/>
      glCallList((u32*)enemy_model_bin);         //draw model</td> </tr></table><span class="postbody">
<br/>
<br/>
thanks for your help,
<br/>
-opearn</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168052 - opearn - Wed Apr 08, 2009 1:42 pm</h4>
    <div class="postbody"><span class="postbody">(desperate bump... because i really need help!)
<br/>
<br/>
please help me...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168057 - Synthetic - Wed Apr 08, 2009 4:46 pm</h4>
    <div class="postbody"><span class="postbody">What size are your textures, and did the example actually work?
<br/>
<br/>
From what I gathered, the texture matrix is stored internally in .12 fixed point format, and if you are packing your texture coordinates using floattot16, the t16 is .4 fixed point format already, so you when you scale the texture matrix it doesn't have to be 64&lt;&lt;16, just 64&lt;&lt;12, or whatever the size of your texture is.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168102 - opearn - Fri Apr 10, 2009 7:58 am</h4>
    <div class="postbody"><span class="postbody">so if i have a 256x256 texture i use
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">GLvector tex_scale = { 256&lt;&lt;12, -256&lt;&lt;12, 1&lt;&lt;12 };
<br/>
</td> </tr></table><span class="postbody">?
<br/>
<br/>
or do i use 128?
<br/>
<br/>
(only one axis is wrapping!)
<br/>
<br/>
heres my texgen code
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">//tex 1
<br/>
   sImage pcx;
<br/>
<br/>
   loadPCX((u8*)Ground_pcx, &amp;pcx);
<br/>
   
<br/>
   image8to16(&amp;pcx);
<br/>
   
<br/>
   glGenTextures(1, &amp;texture[0]);
<br/>
   glBindTexture(0, texture[0]);
<br/>
   glTexImage2D(0, 0, GL_RGB, TEXTURE_SIZE_256 , TEXTURE_SIZE_256, 0, GL_TEXTURE_WRAP_S|GL_TEXTURE_WRAP_T|TEXGEN_POSITION, pcx.image.data8);</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168111 - Synthetic - Fri Apr 10, 2009 9:16 am</h4>
    <div class="postbody"><span class="postbody">If the texture coordinates in your model are stored as t16, and are normalized from 0 to 1, you should use 256&lt;&lt;12, I'm pretty sure.  Try it and see.
<br/>
<br/>
Also, the - in front of your second coordinate could be causing a problem.  If the texture is not set to repeat in the y/t/v direction, any negative texture coordinates will be be mapped to a blank region of texture space.
<br/>
Or did you mean it looks like only one axis is wrapping, but both should be?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168112 - opearn - Fri Apr 10, 2009 10:26 am</h4>
    <div class="postbody"><span class="postbody">so i need to use what this config in the model converter?
<br/>
<br/>
texture size
<br/>
256x256
<br/>
<br/>
scale
<br/>
1.000
<br/>
<br/>
disable normals
<br/>
no
<br/>
<br/>
normal flip
<br/>
no
<br/>
<br/>
heres a .nds file to show what happens
<br/>
<a class="postlink" href="http://www.sendspace.com/file/ti9fkb" target="_blank">http://www.sendspace.com/file/ti9fkb</a>
<br/>
<br/>
alsoi removed the negative (-).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168122 - Synthetic - Fri Apr 10, 2009 3:36 pm</h4>
    <div class="postbody"><span class="postbody">Ok, just so we're clear:
<br/>
-The internal format for texture coordinates on the DS is 1.11.4 fixed point.  So, 1 bit sign,  11 bits for the integer, and 4 bits for the fraction.
<br/>
-The DS does not automatically normalize texture space like a strict OpenGL implementation.  So When you load a 256x256 texel texture and bind it, in texture space the texture goes from (0.0 , 0.0) out to (256.0,256.0) at the other corner.
<br/>
<br/>
So, if the model converter takes in a texture size, chances are that it is already recalculating all the texture coordinates so that they range from 0 to 256 instead from 0 to 1.  If the model converter puts out a c file with the display list in it, you can look and see for yourself if the texture coordinates are already scaled, or you could just try not scaling the texture matrix at all, and see what you get.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168123 - opearn - Fri Apr 10, 2009 4:21 pm</h4>
    <div class="postbody"><span class="postbody">what model converter do you use?
<br/>
<br/>
I'm just using the one off the guy who made AmplituDS's website.
<br/>
<a class="postlink" href="http://amplituds.drunkencoders.com/?s=download&amp;proj=Tools%20for%203D%20models" target="_blank">http://amplituds.drunkencoders.com/?s=download&amp;proj=Tools%20for%203D%20models</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168124 - Synthetic - Fri Apr 10, 2009 4:30 pm</h4>
    <div class="postbody"><span class="postbody">I'm a coder, so I don't really do much with modeling, but the guy I'm working with uses a python script written for blender.  I can't remember who wrote it, but I found it on gbadev, so if you search around you could probably find it.
<br/>
<br/>
Anyway, does the texture mapping work when you don't scale it?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168126 - opearn - Fri Apr 10, 2009 5:22 pm</h4>
    <div class="postbody"><span class="postbody">getting rid of
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">glScalev( &amp;tex_scale );</td> </tr></table><span class="postbody">
<br/>
makes it a single color
<br/>
<br/>
and setting the scale in the converter to 0 makes the map not show up at all.
<br/>
(0.000 = 0%|1.000=100%)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168127 - opearn - Fri Apr 10, 2009 5:25 pm</h4>
    <div class="postbody"><span class="postbody">maybe you could just post an example bit of code?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168140 - Synthetic - Fri Apr 10, 2009 9:15 pm</h4>
    <div class="postbody"><span class="postbody">Its hard to remotely debug.  How about you zip up your code and post a link, and I'll take a look and see if I can spot the problem.
<br/>
<br/>
What version of libnds are you using?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168142 - opearn - Sat Apr 11, 2009 12:49 am</h4>
    <div class="postbody"><span class="postbody">[devkitARM]
<br/>
Version=25
<br/>
<br/>
[libnds]
<br/>
Version=1.3.2
<br/>
<br/>
i'll pm you a link.
<br/>
<br/>
also please use the delete link after downloading it.
<br/>
<br/>
thanks</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#169246 - BusDriver - Thu Jun 25, 2009 4:21 am</h4>
    <div class="postbody"><span class="postbody">anyone who can help with this... PLEASE. YOU ARE NEEDED.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#169258 - elhobbs - Thu Jun 25, 2009 5:34 pm</h4>
    <div class="postbody"><span class="postbody">it is hard to help without the source code and the associated resources.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
