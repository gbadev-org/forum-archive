<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>[newbe] first tile mode test problem - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > [newbe] first tile mode test problem</h2>
<div id="posts">
<div class="post">
    <h4>#71402 - mlequim - Sun Feb 12, 2006 4:42 pm</h4>
    <div class="postbody"><span class="postbody">Hi, 
<br/>
<br/>
I have done a first test to display in the sub screen an image in tiles mode but I get nothing (except some pixels), maybe someone can help me ? 
<br/>
<br/>
I have first decomposed the image in tiles with "gfx2fba -t8". The tiles are in stage2.bin.
<br/>
<br/>
here is the code modified from an example. the part of the example works fine (display of an image in the upper screen in bitmap mode), but my part works not lol ! I want to display tiles in the sub screen, this part works not.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include &lt;nds.h&gt;
<br/>
<br/>
#include &lt;nds/arm9/console.h&gt; //basic print funcionality
<br/>
<br/>
#include &lt;stdio.h&gt;
<br/>
<br/>
//make file automaticaly makes a header file for access
<br/>
//to the binary data in any file ending in .bin that is in
<br/>
//the data folder.  It also links in that data to your project
<br/>
<br/>
#include "image2_bin.h"    // NORMAL
<br/>
#include "palette2_bin.h"
<br/>
<br/>
#include "stage2_bin.h"   // TILES
<br/>
#include "palette4_bin.h"
<br/>
<br/>
unsigned char map[16 * 16] = {
<br/>
1, 2, 3, 4, 5, 6, 7, 8, 9,10,11,12,13,14,15,16,
<br/>
17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,
<br/>
33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,
<br/>
49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,
<br/>
65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,
<br/>
81,82,83,84,85,83,87,88,89,90,91,92,93,94,95,96,
<br/>
97,98,99,100,101, 102, 103, 104, 105,106,107,108,109,110,111,112,
<br/>
113, 114, 115, 116, 117, 118, 119, 120,121, 122, 123, 124, 125, 126, 127, 128,
<br/>
129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144,
<br/>
145, 146, 147, 148, 149, 150, 151, 152, 153, 154, 155, 156, 157, 158, 159, 160,
<br/>
161, 162, 163, 164, 165, 166, 167, 168, 169, 170, 171, 172, 173, 174, 175, 176,
<br/>
177, 178, 179, 180, 181, 182, 183, 184, 185, 186, 187, 188, 189, 190, 191, 192,
<br/>
193, 194, 195, 196, 197, 198, 199, 200, 201, 202, 203, 204, 205, 206, 206, 207,
<br/>
208, 209, 210, 211, 212, 213, 214, 215, 216, 217, 218, 219, 220, 221, 222, 223,
<br/>
224, 225, 226, 227, 228, 229, 230, 231, 232, 233, 234, 235, 236, 237, 238, 239,
<br/>
240, 241, 242, 243, 244, 245, 246, 247, 248, 249, 250, 251, 252, 253, 254, 255};
<br/>
<br/>
int main(void)
<br/>
{
<br/>
   //irqs are nice
<br/>
   irqInit();
<br/>
   irqSet(IRQ_VBLANK, 0);
<br/>
<br/>
    //set the mode for 2 text layers and two extended background layers
<br/>
   videoSetMode(MODE_5_2D | DISPLAY_BG3_ACTIVE);
<br/>
<br/>
   //set the sub background up for text display (we could just print to one
<br/>
   //of the main display text backgrounds just as easily
<br/>
   videoSetModeSub(MODE_0_2D | DISPLAY_BG0_ACTIVE); //sub bg 0 will be used to print text
<br/>
<br/>
    //set the first bank as background memory and the third as sub background memory
<br/>
    //B and D are not used
<br/>
    vramSetMainBanks(VRAM_A_MAIN_BG_0x6000000, VRAM_B_LCD,
<br/>
                     VRAM_C_SUB_BG , VRAM_D_LCD);
<br/>
<br/>
   ////////////////set up text background for text/////////////////////
<br/>
    SUB_BG0_CR = BG_MAP_BASE(31);
<br/>
<br/>
   BG_PALETTE_SUB[255] = RGB15(31,31,31);//by default font will be rendered with color 255
<br/>
<br/>
   //consoleInit() is a lot more flexible but this gets you up and running quick
<br/>
   consoleInitDefault((u16*)SCREEN_BASE_BLOCK_SUB(31), (u16*)CHAR_BASE_BLOCK_SUB(0), 16);
<br/>
<br/>
   iprintf("\n\n\tAgonisma DS\n");
<br/>
   iprintf("\tPremier essais\n");
<br/>
   
<br/>
   ///////////////set up our bitmap background///////////////////////
<br/>
<br/>
   BG3_CR = BG_BMP8_256x256;
<br/>
<br/>
   //these are rotation backgrounds so you must set the rotation attributes:
<br/>
    //these are fixed point numbers with the low 8 bits the fractional part
<br/>
    //this basicaly gives it a 1:1 translation in x and y so you get a nice flat bitmap
<br/>
        BG3_XDX = 1 &lt;&lt; 8;
<br/>
        BG3_XDY = 0;
<br/>
        BG3_YDX = 0;
<br/>
        BG3_YDY = 1 &lt;&lt; 8;
<br/>
    //our bitmap looks a bit better if we center it so scroll down (256 - 192) / 2
<br/>
    //    BG3_CX = 0;
<br/>
    //    BG3_CY = 32 &lt;&lt; 8;
<br/>
<br/>
   dmaCopy(image2_bin, BG_GFX, 256*256);
<br/>
   dmaCopy(palette2_bin, BG_PALETTE, 256*2);
<br/>
<br/>
   u16* vramMap = (u16*)BG_MAP_BASE(31);
<br/>
<br/>
   dmaCopy(stage2_bin, BG_GFX_SUB, 256*192/4);
<br/>
   dmaCopy(palette4_bin, BG_PALETTE_SUB, 256*3/4);
<br/>
   dmaCopy(map, vramMap, 100);
<br/>
<br/>
   for (int i=0;i&lt;1000;i++)
<br/>
   {vramMap[i]=i;}
<br/>
<br/>
<br/>
    while(1)swiWaitForVBlank();
<br/>
<br/>
   return 0;
<br/>
}
<br/>
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#71786 - mlequim - Tue Feb 14, 2006 3:02 pm</h4>
    <div class="postbody"><span class="postbody">I wonder if my error is not in the memory location of the map, I have done like in GBA but maybe it is different for DS ? anyone can help ?</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
