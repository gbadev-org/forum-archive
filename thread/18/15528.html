<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Fast YUV 4:2:0 -> RGB 15 in ASM - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Fast YUV 4:2:0 -> RGB 15 in ASM</h2>
<div id="posts">
<div class="post">
    <h4>#156728 - chishm - Tue May 13, 2008 12:07 pm</h4>
    <div class="postbody"><span class="postbody">As <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?p=156033#156033" target="_blank">discussed previously</a>, YUV 4:2:0 -&gt; RGB colour conversion is fairly slow. I previously wrote an assembly function to do it as fast as possible but it's buried in the source of tuna-viDS. It takes 3 input pointers, one each to the Y, U and V components, and writes out pixels in RGB15 format (with alpha bit NOT set). I use it with a pointer directly to 3 RAM banks displayed in frame buffer mode, for triple buffering purposes. You'll need to manually set the alpha bit if you want to use any other video mode, probably quickest to orr each pixel with 0x8000 in the ASM function. It uses ARM9 specific instructions so it won't assemble for the ARM7.
<br/>
<br/>
Has anyone achieved something faster?
<br/>
<br/>
Here it is in it's entirety, for those who want it (without the GPL infection from tuna-viDS):
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code"># Copyright (c) 2008, Michael "Chishm" Chisholm
<br/>
# All rights reserved.
<br/>
#
<br/>
# Redistribution and use in source and binary forms, with or without
<br/>
# modification, are permitted provided that the following conditions are met:
<br/>
#     * Redistributions of source code must retain the above copyright
<br/>
#       notice, this list of conditions and the following disclaimer.
<br/>
#     * Redistributions in binary form must reproduce the above copyright
<br/>
#       notice, this list of conditions and the following disclaimer in the
<br/>
#       documentation and/or other materials provided with the distribution.
<br/>
#     * Neither the name of the &lt;organization&gt; nor the
<br/>
#       names of its contributors may be used to endorse or promote products
<br/>
#       derived from this software without specific prior written permission.
<br/>
#
<br/>
# THIS SOFTWARE IS PROVIDED BY &lt;copyright holder&gt; ``AS IS'' AND ANY
<br/>
# EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
<br/>
# WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
<br/>
# DISCLAIMED. IN NO EVENT SHALL &lt;copyright holder&gt; BE LIABLE FOR ANY
<br/>
# DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
<br/>
# (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
<br/>
# LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
<br/>
# ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
<br/>
# (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
<br/>
# SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
<br/>
<br/>
<br/>
<br/>
.equ   SCALEBITS_OUT,   6
<br/>
.equ   SCALEBITS_DISP, 9
<br/>
.equ   MAX_RGB,      31
<br/>
.equ   WIDTH,         256
<br/>
.equ   X_STRIDE,      512
<br/>
.equ   Y_STRIDE,      384
<br/>
.equ   UV_STRIDE,      192
<br/>
<br/>
.equ   B_U_FACTOR,      129      @ = ((2.018) * (1&lt;&lt;SCALEBITS_OUT) + 0.5)
<br/>
.equ   G_U_FACTOR,      25      @ = ((0.391) * (1&lt;&lt;SCALEBITS_OUT) + 0.5)
<br/>
.equ   G_V_FACTOR,      52      @ = ((0.813) * (1&lt;&lt;SCALEBITS_OUT) + 0.5)
<br/>
.equ   R_V_FACTOR,      102      @ = ((1.596) * (1&lt;&lt;SCALEBITS_OUT) + 0.5)
<br/>
.equ   U_FACTORS,      (G_U_FACTOR &lt;&lt; 16) | (B_U_FACTOR)
<br/>
.equ   V_FACTORS,      (G_V_FACTOR &lt;&lt; 16) | (R_V_FACTOR)
<br/>
.equ   RGB_Y_FACTOR,   74      @ = ((1.164) * (1&lt;&lt;SCALEBITS_OUT) + 0.5)
<br/>
<br/>
.align
<br/>
.global   yv12_to_rgb555_asm
<br/>
.func   yv12_to_rgb555_asm
<br/>
<br/>
@ void yv12_to_rgb555_asm 
<br/>
@  uint8_t * out_ptr
<br/>
@  uint8_t * y_ptr
<br/>
@  uint8_t * u_ptr
<br/>
@  uint8_t * v_ptr
<br/>
@  int height
<br/>
<br/>
yv12_to_rgb555_asm:
<br/>
<br/>
   stmfd   sp!, {r4-r11, lr}
<br/>
   
<br/>
@ cache colour factors into stack for quick access
<br/>
   ldr      r7, =U_FACTORS
<br/>
   ldr      r8, =V_FACTORS
<br/>
   stmfd   sp!, {r7-r8}
<br/>
<br/>
@ combine Y factor and line count into one variable -- each needs only 16 bits
<br/>
   mov      r10, #RGB_Y_FACTOR      @ low 16 bits are Y factor
<br/>
   ldr      r12, [sp, #44]
<br/>
   sub      r12, #1
<br/>
   orr      r10, r10, r12, lsl #16      @ high 16 bits are line count
<br/>
<br/>
   
<br/>
b_u0   .req r4
<br/>
g_uv0   .req r5
<br/>
r_v0   .req r6
<br/>
rgb_y   .req r7
<br/>
<br/>
column_loop:
<br/>
   
<br/>
row_loop:
<br/>
   
<br/>
   ldmfd   sp, {r7-r8}      @ load table offsets
<br/>
   ldrb   r11, [r2], #1      @ load U value
<br/>
   ldrb   r12, [r3], #1      @ load V value
<br/>
   @ Calculate colour differences
<br/>
   sub      r11, #128
<br/>
   sub      r12, #128
<br/>
   smultb   g_uv0, r7, r11
<br/>
   smulbb   r_v0, r7, r12
<br/>
   smulbb   b_u0, r8, r11
<br/>
   smlatb   g_uv0, r8, r12, g_uv0
<br/>
   
<br/>
   @ top row
<br/>
   ldrh   r11, [r1], #2      @ load Y value for 2 pixels
<br/>
   
<br/>
   @ top left pixel luma
<br/>
   and      r12, r11, #0xFF
<br/>
   sub      r12, #16
<br/>
   smulbb   rgb_y, r10, r12
<br/>
   
<br/>
   @ red   
<br/>
   mov      r12, #(1&lt;&lt;15)
<br/>
   add      r8, rgb_y, r_v0
<br/>
   movs   r9, r8, asr #14
<br/>
   orreq   r12, r8, lsr #9
<br/>
   orrgt   r12, #MAX_RGB   
<br/>
<br/>
   @ green
<br/>
   sub      r8, rgb_y, g_uv0
<br/>
   movs   r9, r8, asr #14
<br/>
   moveq   r8, r8, lsr #9
<br/>
   orreq   r12, r8, lsl #5
<br/>
   orrgt   r12, #(MAX_RGB&lt;&lt;5)   
<br/>
<br/>
   @ blue
<br/>
   add      r8, rgb_y, b_u0
<br/>
   movs   r9, r8, asr #14
<br/>
   moveq   r8, r8, lsr #9
<br/>
   orreq   r12, r8, lsl #10
<br/>
   orrgt   r12, #(MAX_RGB&lt;&lt;10)   
<br/>
   
<br/>
   @ top right pixel luma
<br/>
   lsr      r11, r11, #8
<br/>
   sub      r11, #16
<br/>
   smulbb   rgb_y, r10, r11
<br/>
<br/>
   @ red   
<br/>
   add      r8, rgb_y, r_v0
<br/>
   movs   r9, r8, asr #14
<br/>
   moveq   r8, r8, lsr #9
<br/>
   orreq   r12, r8, lsl #16
<br/>
   orrgt   r12, #(MAX_RGB&lt;&lt;16)   
<br/>
<br/>
   @ green
<br/>
   sub      r8, rgb_y, g_uv0
<br/>
   movs   r9, r8, asr #14
<br/>
   moveq   r8, r8, lsr #9
<br/>
   orreq   r12, r8, lsl #21
<br/>
   orrgt   r12, #(MAX_RGB&lt;&lt;21)   
<br/>
<br/>
   @ blue
<br/>
   add      r8, rgb_y, b_u0
<br/>
   movs   r9, r8, asr #14
<br/>
   moveq   r8, r8, lsr #9
<br/>
   orreq   r12, r8, lsl #26
<br/>
   orrgt   r12, #(MAX_RGB&lt;&lt;26)   
<br/>
   
<br/>
   @ store 2 pixels
<br/>
   str      r12, [r0], #4
<br/>
   
<br/>
   @ bottom row
<br/>
   add      r11, r1, #Y_STRIDE
<br/>
   ldrh   r11, [r11, #-2]      @ load Y value for 2 pixels
<br/>
   
<br/>
   @ bottom left pixel luma
<br/>
   and      r12, r11, #0xFF
<br/>
   sub      r12, #16
<br/>
   smulbb   rgb_y, r10, r12
<br/>
   
<br/>
   @ red   
<br/>
   mov      r12, #(1&lt;&lt;15)
<br/>
   add      r8, rgb_y, r_v0
<br/>
   movs   r9, r8, asr #14
<br/>
   orreq   r12, r8, lsr #9
<br/>
   orrgt   r12, #MAX_RGB   
<br/>
<br/>
   @ green
<br/>
   sub      r8, rgb_y, g_uv0
<br/>
   movs   r9, r8, asr #14
<br/>
   moveq   r8, r8, lsr #9
<br/>
   orreq   r12, r8, lsl #5
<br/>
   orrgt   r12, #(MAX_RGB&lt;&lt;5)   
<br/>
<br/>
   @ blue
<br/>
   add      r8, rgb_y, b_u0
<br/>
   movs   r9, r8, asr #14
<br/>
   moveq   r8, r8, lsr #9
<br/>
   orreq   r12, r8, lsl #10
<br/>
   orrgt   r12, #(MAX_RGB&lt;&lt;10)   
<br/>
   
<br/>
   @ bottom right pixel luma
<br/>
   lsr      r11, #8
<br/>
   sub      r11, #16
<br/>
   smulbb   rgb_y, r10, r11
<br/>
   
<br/>
   @ red   
<br/>
   add      r8, rgb_y, r_v0
<br/>
   movs   r9, r8, asr #14
<br/>
   moveq   r8, r8, lsr #9
<br/>
   orreq   r12, r8, lsl #16
<br/>
   orrgt   r12, #(MAX_RGB&lt;&lt;16)   
<br/>
<br/>
   @ green
<br/>
   sub      r8, rgb_y, g_uv0
<br/>
   movs   r9, r8, asr #14
<br/>
   moveq   r8, r8, lsr #9
<br/>
   orreq   r12, r8, lsl #21
<br/>
   orrgt   r12, #(MAX_RGB&lt;&lt;21)   
<br/>
<br/>
   @ blue
<br/>
   add      r8, rgb_y, b_u0
<br/>
   movs   r9, r8, asr #14
<br/>
   moveq   r8, r8, lsr #9
<br/>
   orreq   r12, r8, lsl #26
<br/>
   orrgt   r12, #(MAX_RGB&lt;&lt;26)   
<br/>
   
<br/>
   @ store 2 pixels
<br/>
   str      r12, [r0, #(X_STRIDE-4)]
<br/>
<br/>
   tst      r0, #0x1FC
<br/>
   bne      row_loop
<br/>
<br/>
   subs   r10, #(2&lt;&lt;16)
<br/>
   add      r0, #(2*X_STRIDE - 2*WIDTH)
<br/>
   add      r1, #(2*Y_STRIDE - WIDTH)
<br/>
   add      r2, #(UV_STRIDE - (WIDTH / 2))
<br/>
   add      r3, #(UV_STRIDE - (WIDTH / 2))
<br/>
   bgt      column_loop
<br/>
   
<br/>
   add      sp, #8
<br/>
   ldmfd   sp!, {r4-r11, pc}
<br/>
<br/>
.endfunc
<br/>
<br/>
.pool
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
EDIT: Corrected advice on orr with 0x8000.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"><br/><br/>Last edited by chishm on Fri May 16, 2008 1:17 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#156730 - Lazy1 - Tue May 13, 2008 12:40 pm</h4>
    <div class="postbody"><span class="postbody">Awesome :D
<br/>
Now I just have to decide if it's better to stream MPEG-1 or MPEG-4.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#156910 - HyperHacker - Thu May 15, 2008 11:35 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote">You'll need to manually set the alpha bit if you want to use any other video mode, probably quickest to orr each pixel with 0x1000</td> </tr></table><span class="postbody">0x8000?<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#156918 - chishm - Fri May 16, 2008 1:16 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote">You'll need to manually set the alpha bit if you want to use any other video mode, probably quickest to orr each pixel with 0x1000</td> </tr></table><span class="postbody">0x8000?</span></td> </tr></table><span class="postbody">
<br/>
Ah yes, silly me. Of course I meant the highest bit (0x8000, or more easily, 1&lt;&lt;15).<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#158204 - RobinWatts - Sat Jun 07, 2008 11:48 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote">Has anyone achieved something faster?</td> </tr></table><span class="postbody">
<br/>
<br/>
Here is my attempt. This should work on either the ARM7 or the ARM9. It's released under the GPL. If anyone wants it in under a different license, contact me.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">@ YUV-&gt; RGB conversion code Copyright (C) 2008 Robin Watts (robin@wss.co.uk).
<br/>
@
<br/>
@ Licensed under the GPL. If you need it under another license, contact me
<br/>
@ and ask.
<br/>
@
<br/>
@  This program is free software ; you can redistribute it and/or modify
<br/>
@  it under the terms of the GNU General Public License as published by
<br/>
@  the Free Software Foundation ; either version 2 of the License, or
<br/>
@  (at your option) any later version.
<br/>
@
<br/>
@  This program is distributed in the hope that it will be useful,
<br/>
@  but WITHOUT ANY WARRANTY ; without even the implied warranty of
<br/>
@  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
<br/>
@  GNU General Public License for more details.
<br/>
@
<br/>
@  You should have received a copy of the GNU General Public License
<br/>
@  along with this program ; if not, write to the Free Software
<br/>
@  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA
<br/>
@
<br/>
@
<br/>
@ The algorithm used here is based heavily on one created by Sophie Wilson
<br/>
@ of Acorn/e-14/Broadcomm. Many thanks.
<br/>
@
<br/>
@ Modifications are made here to allow for more bits of overflow (required
<br/>
@ by the range of the B values due to the larger than expected B scalar).
<br/>
@ Additional tweaks (in the fast fixup code) are from Paul Gardiner.
<br/>
@
<br/>
@ The old implementation of YUV -&gt; RGB did:
<br/>
@
<br/>
@ R = CLAMP((Y-16)*1.164 +           1.596*V)
<br/>
@ G = CLAMP((Y-16)*1.164 - 0.391*U - 0.813*V)
<br/>
@ B = CLAMP((Y-16)*1.164 + 2.018*U          )
<br/>
@
<br/>
@ We're going to use tables to do it faster, but rather than doing it using
<br/>
@ 5 tables as as the above suggests, we're going to do it using just 3.
<br/>
@
<br/>
@ We do this by working in parallel within a 32 bit word, and using one
<br/>
@ table each for Y U and V.
<br/>
@
<br/>
@ Source Y values are    0 to 255, so -19 to 278 after scaling
<br/>
@ Source U values are -128 to 127, so  -50.. 50(G), -258..256(B) after
<br/>
@ Source V values are -128 to 127, so -204..203(R), -104..103(G) after
<br/>
@
<br/>
@ So total summed values:
<br/>
@ -223 &lt;= R &lt;= 481, -173 &lt;= G &lt;= 431, -277 &lt;= B &lt;= 534
<br/>
@
<br/>
@ We need to pack R G and B into a 32 bit word, and because of Bs range we
<br/>
@ need 2 bits above the valid range of B to detect overflow, and another one
<br/>
@ to detect the sense of the overflow. We therefore adopt the following
<br/>
@ representation:
<br/>
@
<br/>
@ ossGGGGGggggossBBBBBbbossRRRRRrr
<br/>
@
<br/>
@ Each such word breaks down into 3 ranges.
<br/>
@
<br/>
@ ossGGGGGgggg   ossBBBBBbb   ossRRRRRrr
<br/>
@
<br/>
@ Thus we have 7 bits for each B and R table entry, and 9 bits for G (good
<br/>
@ as G is the most noticable one). The 2 s bits for each represent the sign,
<br/>
@ and o represents the overflow.
<br/>
@
<br/>
@ For R and B we pack the table by taking the 11 bit representation of their
<br/>
@ values, shifting it right by 1. We toggle bit 9 in the U and V tables.
<br/>
@
<br/>
@ For the green case we calculate 2*G (thus effectively using 9 bits for the
<br/>
@ valid range) truncate to 12 bits. We toggle bit 11 in the Y table.
<br/>
<br/>
.equ   UV_STRIDE,   192
<br/>
.equ   Y_STRIDE,   384
<br/>
.equ   X_STRIDE,   512
<br/>
.equ   WIDTH,      256
<br/>
<br/>
<br/>
.align
<br/>
.global   yv12_to_rgb555_asm
<br/>
.func   yv12_to_rgb555_asm
<br/>
<br/>
@ void yv12_to_rgb555_asm
<br/>
@  uint8_t * x_ptr
<br/>
@  uint8_t * y_ptr
<br/>
@  uint8_t * u_ptr
<br/>
@  uint8_t * v_ptr
<br/>
@  int height
<br/>
<br/>
yv12_to_rgb555_asm:
<br/>
<br/>
   @ r0 = x_ptr
<br/>
   @ r1 = y_ptr
<br/>
   @ r2 = u_ptr
<br/>
   @ r3 = v_ptr
<br/>
   @ &lt;&gt; = height
<br/>
   STMFD   r13!,{r4-r11,r14}
<br/>
<br/>
   ADR   r8, y_table
<br/>
   LDRB   r14,[r13,#9*4]      @ r14 = height
<br/>
   ADD   r9, r8,#1024   @ u_table
<br/>
   ADD   r10,r9,#1024   @ v_table
<br/>
   LDR   r4, =0x07C07C1F
<br/>
   LDR   r5, =0x60060180
<br/>
yloop:
<br/>
   SUB   r14,r14,#WIDTH&lt;&lt;8   @ r14 = height-(WIDTH&lt;&lt;8)
<br/>
xloop:
<br/>
   LDRB   r11,[r2],#1      @ r11 = u  = *u_ptr++
<br/>
   LDRB   r12,[r3],#1      @ r12 = v  = *v_ptr++
<br/>
   LDRB   r7, [r1, #Y_STRIDE]   @ r7  = y2 = y_ptr[stride]
<br/>
   LDRB   r6, [r1],#1      @ r6  = y0 = *y_ptr++
<br/>
   LDR   r11,[r9, r11,LSL #2]   @ r11 = u  = u_table[u]
<br/>
   LDR   r12,[r10,r12,LSL #2]   @ r12 = v  = v_table[v]
<br/>
   LDR   r7, [r8, r7, LSL #2]   @ r7  = y2 = y_table[y2]
<br/>
   LDR   r6, [r8, r6, LSL #2]   @ r6  = y0 = y_table[y0]
<br/>
   ADD   r11,r11,r12      @ r11 = uv = u+v
<br/>
<br/>
   ADD   r7, r7,r11      @ r7  = y0 + uv
<br/>
   ADD   r6, r6,r11      @ r6  = y2 + uv
<br/>
   ANDS   r12, r7, r5
<br/>
   TSTEQ   r6, r5
<br/>
   BNE   fix01
<br/>
return01:
<br/>
   AND   r7, r4, r7, LSR #2
<br/>
   AND   r6, r4, r6, LSR #2
<br/>
   ORR   r7, r7, r7, LSR #17
<br/>
   ORR   r6, r6, r6, LSR #17
<br/>
   ADD   r12,r0, #X_STRIDE
<br/>
   STRH   r7, [r12]
<br/>
   LDRB   r12,[r1, #Y_STRIDE]   @ r12 = y3 = y_ptr[stride]
<br/>
   LDRB   r7, [r1],#1      @ r6  = y1 = *y_ptr++
<br/>
   STRH   r6, [r0],#2
<br/>
<br/>
   LDR   r12,[r8, r12,LSL #2]   @ r7  = y3 = y_table[y2]
<br/>
   LDR   r6, [r8, r7, LSL #2]   @ r6  = y1 = y_table[y0]
<br/>
<br/>
   ADD   r7, r12,r11      @ r7  = y3 + uv
<br/>
   ADD   r6, r6, r11      @ r6  = y1 + uv
<br/>
   ANDS   r12, r7, r5
<br/>
   TSTEQ   r6, r5
<br/>
   BNE   fix02
<br/>
return02:
<br/>
   AND   r7, r4, r7, LSR #2
<br/>
   AND   r6, r4, r6, LSR #2
<br/>
   ORR   r7, r7, r7, LSR #17
<br/>
   ORR   r6, r6, r6, LSR #17
<br/>
   ADD   r12,r0, #X_STRIDE
<br/>
   STRH   r7, [r12]
<br/>
   STRH   r6, [r0],#2
<br/>
   ADDS   r14,r14,#2&lt;&lt;8
<br/>
   BLT   xloop
<br/>
<br/>
   ADD   r0, r0, #2*X_STRIDE - 2*WIDTH   @ x_ptr to next line
<br/>
   ADD   r1, r1, #2*Y_STRIDE -   WIDTH   @ y_ptr to next line
<br/>
   ADD   r2, r2, #UV_STRIDE - (WIDTH/2)
<br/>
   ADD   r3, r3, #UV_STRIDE - (WIDTH/2)
<br/>
<br/>
   SUBS   r14,r14,#2
<br/>
   BGT   yloop
<br/>
<br/>
   LDMFD   r13!,{r4-r11, pc}
<br/>
fix01:
<br/>
   @ r7 and r6 are the values, at least one of which has overflowed
<br/>
   @ r12 = r7 &amp; mask = .ss.....ss.....ss.....
<br/>
   STMFD   r13!,{r14}
<br/>
   AND   r14,r5, r5, LSR #1   @ r14 = ..1......1......1.....
<br/>
   ORR   r12,r12,r12,LSR #1   @ r12 = .sSx....sSx....sSx....
<br/>
   AND   r12,r12,r14      @ r12 = ..S......S......S.....
<br/>
   SUB   r12,r12,r12,LSR #7   @ r12 = ...SSSSS..SSSSS..SSSSS
<br/>
   ORR   r7, r7, r12      @ r7 |= ...SSSSS..SSSSS..SSSSS
<br/>
   BIC   r12,r14,r7, LSR #2   @ r12 = ..o......o......o.....
<br/>
   ADD   r7, r7, r12,LSR #7   @ r7  = fixed value
<br/>
<br/>
   AND   r12, r6, r5      @ r12 = .ss.....ss.....ss.....
<br/>
   ORR   r12,r12,r12,LSR #1   @ r12 = .sSx....sSx....sSx....
<br/>
   AND   r12,r12,r14      @ r12 = ..S......S......S.....
<br/>
   SUB   r12,r12,r12,LSR #7   @ r12 = ...SSSSS..SSSSS..SSSSS
<br/>
   ORR   r6, r6, r12      @ r6 |= ...SSSSS..SSSSS..SSSSS
<br/>
   BIC   r12,r14,r6, LSR #2   @ r12 = ..o......o......o.....
<br/>
   ADD   r6, r6, r12,LSR #7   @ r6  = fixed value
<br/>
   LDMFD   r13!,{r14}
<br/>
   B   return01
<br/>
fix02:
<br/>
   @ r7 and r6 are the values, at least one of which has overflowed
<br/>
   @ r12 = r7 &amp; mask = .ss.....ss.....ss.....
<br/>
   AND   r11,r5, r5, LSR #1   @ r11 = ..1......1......1.....
<br/>
   ORR   r12,r12,r12,LSR #1   @ r12 = .sSx....sSx....sSx....
<br/>
   AND   r12,r12,r11      @ r12 = ..S......S......S.....
<br/>
   SUB   r12,r12,r12,LSR #7   @ r12 = ...SSSSS..SSSSS..SSSSS
<br/>
   ORR   r7, r7, r12      @ r7 |= ...SSSSS..SSSSS..SSSSS
<br/>
   BIC   r12,r11,r7, LSR #2   @ r12 = ..o......o......o.....
<br/>
   ADD   r7, r7, r12,LSR #7   @ r7  = fixed value
<br/>
<br/>
   AND   r12, r6, r5      @ r12 = .ss.....ss.....ss.....
<br/>
   ORR   r12,r12,r12,LSR #1   @ r12 = .sSx....sSx....sSx....
<br/>
   AND   r12,r12,r11      @ r12 = ..S......S......S.....
<br/>
   SUB   r12,r12,r12,LSR #7   @ r12 = ...SSSSS..SSSSS..SSSSS
<br/>
   ORR   r6, r6, r12      @ r6 |= ...SSSSS..SSSSS..SSSSS
<br/>
   BIC   r12,r11,r6, LSR #2   @ r12 = ..o......o......o.....
<br/>
   ADD   r6, r6, r12,LSR #7   @ r6  = fixed value
<br/>
   B   return02
<br/>
.endfunc
<br/>
.pool
<br/>
<br/>
y_table:
<br/>
        .word 0x7FFFFFF7
<br/>
        .word 0x7FFFFFF7
<br/>
        .word 0x7FFFFFF8
<br/>
        .word 0x7FFFFFF8
<br/>
        .word 0x7FFFFFF9
<br/>
        .word 0x7FFFFFFA
<br/>
        .word 0x7FFFFFFA
<br/>
        .word 0x7FFFFFFB
<br/>
        .word 0x7FFFFFFB
<br/>
        .word 0x7FFFFFFC
<br/>
        .word 0x7FFFFFFD
<br/>
        .word 0x7FFFFFFD
<br/>
        .word 0x7FFFFFFE
<br/>
        .word 0x7FFFFFFE
<br/>
        .word 0x7FFFFFFF
<br/>
        .word 0x7FFFFFFF
<br/>
        .word 0x80000000
<br/>
        .word 0x80200401
<br/>
        .word 0x80500401
<br/>
        .word 0x80700802
<br/>
        .word 0x80900802
<br/>
        .word 0x80C00C03
<br/>
        .word 0x80E00C03
<br/>
        .word 0x81001004
<br/>
        .word 0x81301405
<br/>
        .word 0x81501405
<br/>
        .word 0x81701806
<br/>
        .word 0x81A01806
<br/>
        .word 0x81C01C07
<br/>
        .word 0x81E02008
<br/>
        .word 0x82102008
<br/>
        .word 0x82302409
<br/>
        .word 0x82502409
<br/>
        .word 0x8280280A
<br/>
        .word 0x82A0280A
<br/>
        .word 0x82C02C0B
<br/>
        .word 0x82F0300C
<br/>
        .word 0x8310300C
<br/>
        .word 0x8330340D
<br/>
        .word 0x8360340D
<br/>
        .word 0x8380380E
<br/>
        .word 0x83A03C0F
<br/>
        .word 0x83D03C0F
<br/>
        .word 0x83F04010
<br/>
        .word 0x84104010
<br/>
        .word 0x84404411
<br/>
        .word 0x84604411
<br/>
        .word 0x84804812
<br/>
        .word 0x84A04C13
<br/>
        .word 0x84D04C13
<br/>
        .word 0x84F05014
<br/>
        .word 0x85105014
<br/>
        .word 0x85405415
<br/>
        .word 0x85605816
<br/>
        .word 0x85805816
<br/>
        .word 0x85B05C17
<br/>
        .word 0x85D05C17
<br/>
        .word 0x85F06018
<br/>
        .word 0x86206018
<br/>
        .word 0x86406419
<br/>
        .word 0x8660681A
<br/>
        .word 0x8690681A
<br/>
        .word 0x86B06C1B
<br/>
        .word 0x86D06C1B
<br/>
        .word 0x8700701C
<br/>
        .word 0x8720741D
<br/>
        .word 0x8740741D
<br/>
        .word 0x8770781E
<br/>
        .word 0x8790781E
<br/>
        .word 0x87B07C1F
<br/>
        .word 0x87E07C1F
<br/>
        .word 0x88008020
<br/>
        .word 0x88208421
<br/>
        .word 0x88508421
<br/>
        .word 0x88708822
<br/>
        .word 0x88908822
<br/>
        .word 0x88C08C23
<br/>
        .word 0x88E09024
<br/>
        .word 0x89009024
<br/>
        .word 0x89309425
<br/>
        .word 0x89509425
<br/>
        .word 0x89709826
<br/>
        .word 0x89A09826
<br/>
        .word 0x89C09C27
<br/>
        .word 0x89E0A028
<br/>
        .word 0x8A10A028
<br/>
        .word 0x8A30A429
<br/>
        .word 0x8A50A429
<br/>
        .word 0x8A80A82A
<br/>
        .word 0x8AA0A82A
<br/>
        .word 0x8AC0AC2B
<br/>
        .word 0x8AF0B02C
<br/>
        .word 0x8B10B02C
<br/>
        .word 0x8B30B42D
<br/>
        .word 0x8B60B42D
<br/>
        .word 0x8B80B82E
<br/>
        .word 0x8BA0BC2F
<br/>
        .word 0x8BD0BC2F
<br/>
        .word 0x8BF0C030
<br/>
        .word 0x8C10C030
<br/>
        .word 0x8C40C431
<br/>
        .word 0x8C60C431
<br/>
        .word 0x8C80C832
<br/>
        .word 0x8CB0CC33
<br/>
        .word 0x8CD0CC33
<br/>
        .word 0x8CF0D034
<br/>
        .word 0x8D20D034
<br/>
        .word 0x8D40D435
<br/>
        .word 0x8D60D836
<br/>
        .word 0x8D90D836
<br/>
        .word 0x8DB0DC37
<br/>
        .word 0x8DD0DC37
<br/>
        .word 0x8DF0E038
<br/>
        .word 0x8E20E038
<br/>
        .word 0x8E40E439
<br/>
        .word 0x8E60E83A
<br/>
        .word 0x8E90E83A
<br/>
        .word 0x8EB0EC3B
<br/>
        .word 0x8ED0EC3B
<br/>
        .word 0x8F00F03C
<br/>
        .word 0x8F20F43D
<br/>
        .word 0x8F40F43D
<br/>
        .word 0x8F70F83E
<br/>
        .word 0x8F90F83E
<br/>
        .word 0x8FB0FC3F
<br/>
        .word 0x8FE0FC3F
<br/>
        .word 0x90010040
<br/>
        .word 0x90210441
<br/>
        .word 0x90510441
<br/>
        .word 0x90710842
<br/>
        .word 0x90910842
<br/>
        .word 0x90C10C43
<br/>
        .word 0x90E11044
<br/>
        .word 0x91011044
<br/>
        .word 0x91311445
<br/>
        .word 0x91511445
<br/>
        .word 0x91711846
<br/>
        .word 0x91A11846
<br/>
        .word 0x91C11C47
<br/>
        .word 0x91E12048
<br/>
        .word 0x92112048
<br/>
        .word 0x92312449
<br/>
        .word 0x92512449
<br/>
        .word 0x9281284A
<br/>
        .word 0x92A1284A
<br/>
        .word 0x92C12C4B
<br/>
        .word 0x92F1304C
<br/>
        .word 0x9311304C
<br/>
        .word 0x9331344D
<br/>
        .word 0x9361344D
<br/>
        .word 0x9381384E
<br/>
        .word 0x93A13C4F
<br/>
        .word 0x93D13C4F
<br/>
        .word 0x93F14050
<br/>
        .word 0x94114050
<br/>
        .word 0x94414451
<br/>
        .word 0x94614451
<br/>
        .word 0x94814852
<br/>
        .word 0x94B14C53
<br/>
        .word 0x94D14C53
<br/>
        .word 0x94F15054
<br/>
        .word 0x95215054
<br/>
        .word 0x95415455
<br/>
        .word 0x95615856
<br/>
        .word 0x95915856
<br/>
        .word 0x95B15C57
<br/>
        .word 0x95D15C57
<br/>
        .word 0x96016058
<br/>
        .word 0x96216058
<br/>
        .word 0x96416459
<br/>
        .word 0x9671685A
<br/>
        .word 0x9691685A
<br/>
        .word 0x96B16C5B
<br/>
        .word 0x96D16C5B
<br/>
        .word 0x9701705C
<br/>
        .word 0x9721745D
<br/>
        .word 0x9741745D
<br/>
        .word 0x9771785E
<br/>
        .word 0x9791785E
<br/>
        .word 0x97B17C5F
<br/>
        .word 0x97E17C5F
<br/>
        .word 0x98018060
<br/>
        .word 0x98218461
<br/>
        .word 0x98518461
<br/>
        .word 0x98718862
<br/>
        .word 0x98918862
<br/>
        .word 0x98C18C63
<br/>
        .word 0x98E19064
<br/>
        .word 0x99019064
<br/>
        .word 0x99319465
<br/>
        .word 0x99519465
<br/>
        .word 0x99719866
<br/>
        .word 0x99A19866
<br/>
        .word 0x99C19C67
<br/>
        .word 0x99E1A068
<br/>
        .word 0x9A11A068
<br/>
        .word 0x9A31A469
<br/>
        .word 0x9A51A469
<br/>
        .word 0x9A81A86A
<br/>
        .word 0x9AA1AC6B
<br/>
        .word 0x9AC1AC6B
<br/>
        .word 0x9AF1B06C
<br/>
        .word 0x9B11B06C
<br/>
        .word 0x9B31B46D
<br/>
        .word 0x9B61B46D
<br/>
        .word 0x9B81B86E
<br/>
        .word 0x9BA1BC6F
<br/>
        .word 0x9BD1BC6F
<br/>
        .word 0x9BF1C070
<br/>
        .word 0x9C11C070
<br/>
        .word 0x9C41C471
<br/>
        .word 0x9C61C471
<br/>
        .word 0x9C81C872
<br/>
        .word 0x9CB1CC73
<br/>
        .word 0x9CD1CC73
<br/>
        .word 0x9CF1D074
<br/>
        .word 0x9D21D074
<br/>
        .word 0x9D41D475
<br/>
        .word 0x9D61D876
<br/>
        .word 0x9D91D876
<br/>
        .word 0x9DB1DC77
<br/>
        .word 0x9DD1DC77
<br/>
        .word 0x9E01E078
<br/>
        .word 0x9E21E078
<br/>
        .word 0x9E41E479
<br/>
        .word 0x9E71E87A
<br/>
        .word 0x9E91E87A
<br/>
        .word 0x9EB1EC7B
<br/>
        .word 0x9EE1EC7B
<br/>
        .word 0x9F01F07C
<br/>
        .word 0x9F21F47D
<br/>
        .word 0x9F51F47D
<br/>
        .word 0x9F71F87E
<br/>
        .word 0x9F91F87E
<br/>
        .word 0x9FC1FC7F
<br/>
        .word 0x9FE1FC7F
<br/>
        .word 0xA0020080
<br/>
        .word 0xA0220481
<br/>
        .word 0xA0520481
<br/>
        .word 0xA0720882
<br/>
        .word 0xA0920882
<br/>
        .word 0xA0C20C83
<br/>
        .word 0xA0E21084
<br/>
        .word 0xA1021084
<br/>
        .word 0xA1321485
<br/>
        .word 0xA1521485
<br/>
        .word 0xA1721886
<br/>
        .word 0xA1A21886
<br/>
        .word 0xA1C21C87
<br/>
        .word 0xA1E22088
<br/>
        .word 0xA2122088
<br/>
        .word 0xA2322489
<br/>
        .word 0xA2522489
<br/>
        .word 0xA282288A
<br/>
        .word 0xA2A22C8B
<br/>
        .word 0xA2C22C8B
<br/>
u_table:
<br/>
        .word 0x0645FC00
<br/>
        .word 0x06360000
<br/>
        .word 0x06360400
<br/>
        .word 0x06260800
<br/>
        .word 0x06160C00
<br/>
        .word 0x06061000
<br/>
        .word 0x05F61400
<br/>
        .word 0x05F61800
<br/>
        .word 0x05E61C00
<br/>
        .word 0x05D62000
<br/>
        .word 0x05C62400
<br/>
        .word 0x05B62800
<br/>
        .word 0x05B62C00
<br/>
        .word 0x05A63000
<br/>
        .word 0x05963400
<br/>
        .word 0x05863800
<br/>
        .word 0x05863C00
<br/>
        .word 0x05764000
<br/>
        .word 0x05664400
<br/>
        .word 0x05564800
<br/>
        .word 0x05464C00
<br/>
        .word 0x05465000
<br/>
        .word 0x05365400
<br/>
        .word 0x05265800
<br/>
        .word 0x05165C00
<br/>
        .word 0x05166000
<br/>
        .word 0x05066400
<br/>
        .word 0x04F66800
<br/>
        .word 0x04E66C00
<br/>
        .word 0x04D67000
<br/>
        .word 0x04D67400
<br/>
        .word 0x04C67800
<br/>
        .word 0x04B67C00
<br/>
        .word 0x04A68000
<br/>
        .word 0x04A68400
<br/>
        .word 0x04968800
<br/>
        .word 0x04868C00
<br/>
        .word 0x04769000
<br/>
        .word 0x04669400
<br/>
        .word 0x04669800
<br/>
        .word 0x04569C00
<br/>
        .word 0x0446A000
<br/>
        .word 0x0436A400
<br/>
        .word 0x0426A800
<br/>
        .word 0x0426AC00
<br/>
        .word 0x0416B000
<br/>
        .word 0x0406B400
<br/>
        .word 0x03F6B800
<br/>
        .word 0x03F6BC00
<br/>
        .word 0x03E6C000
<br/>
        .word 0x03D6C400
<br/>
        .word 0x03C6C800
<br/>
        .word 0x03B6CC00
<br/>
        .word 0x03B6D000
<br/>
        .word 0x03A6D400
<br/>
        .word 0x0396D800
<br/>
        .word 0x0386DC00
<br/>
        .word 0x0386E000
<br/>
        .word 0x0376E400
<br/>
        .word 0x0366E800
<br/>
        .word 0x0356EC00
<br/>
        .word 0x0346F000
<br/>
        .word 0x0346F400
<br/>
        .word 0x0336F800
<br/>
        .word 0x0326FC00
<br/>
        .word 0x03170000
<br/>
        .word 0x03070400
<br/>
        .word 0x03070800
<br/>
        .word 0x02F70C00
<br/>
        .word 0x02E71000
<br/>
        .word 0x02D71400
<br/>
        .word 0x02D71800
<br/>
        .word 0x02C71C00
<br/>
        .word 0x02B72400
<br/>
        .word 0x02A72800
<br/>
        .word 0x02972C00
<br/>
        .word 0x02973000
<br/>
        .word 0x02873400
<br/>
        .word 0x02773800
<br/>
        .word 0x02673C00
<br/>
        .word 0x02674000
<br/>
        .word 0x02574400
<br/>
        .word 0x02474800
<br/>
        .word 0x02374C00
<br/>
        .word 0x02275000
<br/>
        .word 0x02275400
<br/>
        .word 0x02175800
<br/>
        .word 0x02075C00
<br/>
        .word 0x01F76000
<br/>
        .word 0x01E76400
<br/>
        .word 0x01E76800
<br/>
        .word 0x01D76C00
<br/>
        .word 0x01C77000
<br/>
        .word 0x01B77400
<br/>
        .word 0x01B77800
<br/>
        .word 0x01A77C00
<br/>
        .word 0x01978000
<br/>
        .word 0x01878400
<br/>
        .word 0x01778800
<br/>
        .word 0x01778C00
<br/>
        .word 0x01679000
<br/>
        .word 0x01579400
<br/>
        .word 0x01479800
<br/>
        .word 0x01479C00
<br/>
        .word 0x0137A000
<br/>
        .word 0x0127A400
<br/>
        .word 0x0117A800
<br/>
        .word 0x0107AC00
<br/>
        .word 0x0107B000
<br/>
        .word 0x00F7B400
<br/>
        .word 0x00E7B800
<br/>
        .word 0x00D7BC00
<br/>
        .word 0x00D7C000
<br/>
        .word 0x00C7C400
<br/>
        .word 0x00B7C800
<br/>
        .word 0x00A7CC00
<br/>
        .word 0x0097D000
<br/>
        .word 0x0097D400
<br/>
        .word 0x0087D800
<br/>
        .word 0x0077DC00
<br/>
        .word 0x0067E000
<br/>
        .word 0x0057E400
<br/>
        .word 0x0057E800
<br/>
        .word 0x0047EC00
<br/>
        .word 0x0037F000
<br/>
        .word 0x0027F400
<br/>
        .word 0x0027F800
<br/>
        .word 0x0017FC00
<br/>
        .word 0x00080000
<br/>
        .word 0xFFF80400
<br/>
        .word 0xFFE80800
<br/>
        .word 0xFFE80C00
<br/>
        .word 0xFFD81000
<br/>
        .word 0xFFC81400
<br/>
        .word 0xFFB81800
<br/>
        .word 0xFFB81C00
<br/>
        .word 0xFFA82000
<br/>
        .word 0xFF982400
<br/>
        .word 0xFF882800
<br/>
        .word 0xFF782C00
<br/>
        .word 0xFF783000
<br/>
        .word 0xFF683400
<br/>
        .word 0xFF583800
<br/>
        .word 0xFF483C00
<br/>
        .word 0xFF384000
<br/>
        .word 0xFF384400
<br/>
        .word 0xFF284800
<br/>
        .word 0xFF184C00
<br/>
        .word 0xFF085000
<br/>
        .word 0xFF085400
<br/>
        .word 0xFEF85800
<br/>
        .word 0xFEE85C00
<br/>
        .word 0xFED86000
<br/>
        .word 0xFEC86400
<br/>
        .word 0xFEC86800
<br/>
        .word 0xFEB86C00
<br/>
        .word 0xFEA87000
<br/>
        .word 0xFE987400
<br/>
        .word 0xFE987800
<br/>
        .word 0xFE887C00
<br/>
        .word 0xFE788000
<br/>
        .word 0xFE688400
<br/>
        .word 0xFE588800
<br/>
        .word 0xFE588C00
<br/>
        .word 0xFE489000
<br/>
        .word 0xFE389400
<br/>
        .word 0xFE289800
<br/>
        .word 0xFE289C00
<br/>
        .word 0xFE18A000
<br/>
        .word 0xFE08A400
<br/>
        .word 0xFDF8A800
<br/>
        .word 0xFDE8AC00
<br/>
        .word 0xFDE8B000
<br/>
        .word 0xFDD8B400
<br/>
        .word 0xFDC8B800
<br/>
        .word 0xFDB8BC00
<br/>
        .word 0xFDA8C000
<br/>
        .word 0xFDA8C400
<br/>
        .word 0xFD98C800
<br/>
        .word 0xFD88CC00
<br/>
        .word 0xFD78D000
<br/>
        .word 0xFD78D400
<br/>
        .word 0xFD68D800
<br/>
        .word 0xFD58DC00
<br/>
        .word 0xFD48E400
<br/>
        .word 0xFD38E800
<br/>
        .word 0xFD38EC00
<br/>
        .word 0xFD28F000
<br/>
        .word 0xFD18F400
<br/>
        .word 0xFD08F800
<br/>
        .word 0xFD08FC00
<br/>
        .word 0xFCF90000
<br/>
        .word 0xFCE90400
<br/>
        .word 0xFCD90800
<br/>
        .word 0xFCC90C00
<br/>
        .word 0xFCC91000
<br/>
        .word 0xFCB91400
<br/>
        .word 0xFCA91800
<br/>
        .word 0xFC991C00
<br/>
        .word 0xFC892000
<br/>
        .word 0xFC892400
<br/>
        .word 0xFC792800
<br/>
        .word 0xFC692C00
<br/>
        .word 0xFC593000
<br/>
        .word 0xFC593400
<br/>
        .word 0xFC493800
<br/>
        .word 0xFC393C00
<br/>
        .word 0xFC294000
<br/>
        .word 0xFC194400
<br/>
        .word 0xFC194800
<br/>
        .word 0xFC094C00
<br/>
        .word 0xFBF95000
<br/>
        .word 0xFBE95400
<br/>
        .word 0xFBE95800
<br/>
        .word 0xFBD95C00
<br/>
        .word 0xFBC96000
<br/>
        .word 0xFBB96400
<br/>
        .word 0xFBA96800
<br/>
        .word 0xFBA96C00
<br/>
        .word 0xFB997000
<br/>
        .word 0xFB897400
<br/>
        .word 0xFB797800
<br/>
        .word 0xFB697C00
<br/>
        .word 0xFB698000
<br/>
        .word 0xFB598400
<br/>
        .word 0xFB498800
<br/>
        .word 0xFB398C00
<br/>
        .word 0xFB399000
<br/>
        .word 0xFB299400
<br/>
        .word 0xFB199800
<br/>
        .word 0xFB099C00
<br/>
        .word 0xFAF9A000
<br/>
        .word 0xFAF9A400
<br/>
        .word 0xFAE9A800
<br/>
        .word 0xFAD9AC00
<br/>
        .word 0xFAC9B000
<br/>
        .word 0xFAC9B400
<br/>
        .word 0xFAB9B800
<br/>
        .word 0xFAA9BC00
<br/>
        .word 0xFA99C000
<br/>
        .word 0xFA89C400
<br/>
        .word 0xFA89C800
<br/>
        .word 0xFA79CC00
<br/>
        .word 0xFA69D000
<br/>
        .word 0xFA59D400
<br/>
        .word 0xFA59D800
<br/>
        .word 0xFA49DC00
<br/>
        .word 0xFA39E000
<br/>
        .word 0xFA29E400
<br/>
        .word 0xFA19E800
<br/>
        .word 0xFA19EC00
<br/>
        .word 0xFA09F000
<br/>
        .word 0xF9F9F400
<br/>
        .word 0xF9E9F800
<br/>
        .word 0xF9D9FC00
<br/>
        .word 0xF9DA0000
<br/>
v_table:
<br/>
        .word 0x0D00019A
<br/>
        .word 0x0CF0019B
<br/>
        .word 0x0CD0019B
<br/>
        .word 0x0CB0019C
<br/>
        .word 0x0CA0019D
<br/>
        .word 0x0C80019E
<br/>
        .word 0x0C60019F
<br/>
        .word 0x0C50019F
<br/>
        .word 0x0C3001A0
<br/>
        .word 0x0C1001A1
<br/>
        .word 0x0C0001A2
<br/>
        .word 0x0BE001A3
<br/>
        .word 0x0BD001A3
<br/>
        .word 0x0BB001A4
<br/>
        .word 0x0B9001A5
<br/>
        .word 0x0B8001A6
<br/>
        .word 0x0B6001A7
<br/>
        .word 0x0B4001A7
<br/>
        .word 0x0B3001A8
<br/>
        .word 0x0B1001A9
<br/>
        .word 0x0B0001AA
<br/>
        .word 0x0AE001AB
<br/>
        .word 0x0AC001AB
<br/>
        .word 0x0AB001AC
<br/>
        .word 0x0A9001AD
<br/>
        .word 0x0A7001AE
<br/>
        .word 0x0A6001AF
<br/>
        .word 0x0A4001AF
<br/>
        .word 0x0A3001B0
<br/>
        .word 0x0A1001B1
<br/>
        .word 0x09F001B2
<br/>
        .word 0x09E001B3
<br/>
        .word 0x09C001B3
<br/>
        .word 0x09A001B4
<br/>
        .word 0x099001B5
<br/>
        .word 0x097001B6
<br/>
        .word 0x096001B7
<br/>
        .word 0x094001B7
<br/>
        .word 0x092001B8
<br/>
        .word 0x091001B9
<br/>
        .word 0x08F001BA
<br/>
        .word 0x08D001BB
<br/>
        .word 0x08C001BB
<br/>
        .word 0x08A001BC
<br/>
        .word 0x089001BD
<br/>
        .word 0x087001BE
<br/>
        .word 0x085001BF
<br/>
        .word 0x084001BF
<br/>
        .word 0x082001C0
<br/>
        .word 0x080001C1
<br/>
        .word 0x07F001C2
<br/>
        .word 0x07D001C3
<br/>
        .word 0x07C001C3
<br/>
        .word 0x07A001C4
<br/>
        .word 0x078001C5
<br/>
        .word 0x077001C6
<br/>
        .word 0x075001C7
<br/>
        .word 0x073001C7
<br/>
        .word 0x072001C8
<br/>
        .word 0x070001C9
<br/>
        .word 0x06F001CA
<br/>
        .word 0x06D001CB
<br/>
        .word 0x06B001CB
<br/>
        .word 0x06A001CC
<br/>
        .word 0x068001CD
<br/>
        .word 0x066001CE
<br/>
        .word 0x065001CF
<br/>
        .word 0x063001CF
<br/>
        .word 0x062001D0
<br/>
        .word 0x060001D1
<br/>
        .word 0x05E001D2
<br/>
        .word 0x05D001D3
<br/>
        .word 0x05B001D3
<br/>
        .word 0x059001D4
<br/>
        .word 0x058001D5
<br/>
        .word 0x056001D6
<br/>
        .word 0x055001D7
<br/>
        .word 0x053001D7
<br/>
        .word 0x051001D8
<br/>
        .word 0x050001D9
<br/>
        .word 0x04E001DA
<br/>
        .word 0x04C001DA
<br/>
        .word 0x04B001DB
<br/>
        .word 0x049001DC
<br/>
        .word 0x048001DD
<br/>
        .word 0x046001DE
<br/>
        .word 0x044001DE
<br/>
        .word 0x043001DF
<br/>
        .word 0x041001E0
<br/>
        .word 0x03F001E1
<br/>
        .word 0x03E001E2
<br/>
        .word 0x03C001E2
<br/>
        .word 0x03B001E3
<br/>
        .word 0x039001E4
<br/>
        .word 0x037001E5
<br/>
        .word 0x036001E6
<br/>
        .word 0x034001E6
<br/>
        .word 0x032001E7
<br/>
        .word 0x031001E8
<br/>
        .word 0x02F001E9
<br/>
        .word 0x02E001EA
<br/>
        .word 0x02C001EA
<br/>
        .word 0x02A001EB
<br/>
        .word 0x029001EC
<br/>
        .word 0x027001ED
<br/>
        .word 0x025001EE
<br/>
        .word 0x024001EE
<br/>
        .word 0x022001EF
<br/>
        .word 0x021001F0
<br/>
        .word 0x01F001F1
<br/>
        .word 0x01D001F2
<br/>
        .word 0x01C001F2
<br/>
        .word 0x01A001F3
<br/>
        .word 0x018001F4
<br/>
        .word 0x017001F5
<br/>
        .word 0x015001F6
<br/>
        .word 0x014001F6
<br/>
        .word 0x012001F7
<br/>
        .word 0x010001F8
<br/>
        .word 0x00F001F9
<br/>
        .word 0x00D001FA
<br/>
        .word 0x00B001FA
<br/>
        .word 0x00A001FB
<br/>
        .word 0x008001FC
<br/>
        .word 0x007001FD
<br/>
        .word 0x005001FE
<br/>
        .word 0x003001FE
<br/>
        .word 0x002001FF
<br/>
        .word 0x00000200
<br/>
        .word 0xFFE00201
<br/>
        .word 0xFFD00202
<br/>
        .word 0xFFB00202
<br/>
        .word 0xFF900203
<br/>
        .word 0xFF800204
<br/>
        .word 0xFF600205
<br/>
        .word 0xFF500206
<br/>
        .word 0xFF300206
<br/>
        .word 0xFF100207
<br/>
        .word 0xFF000208
<br/>
        .word 0xFEE00209
<br/>
        .word 0xFEC0020A
<br/>
        .word 0xFEB0020A
<br/>
        .word 0xFE90020B
<br/>
        .word 0xFE80020C
<br/>
        .word 0xFE60020D
<br/>
        .word 0xFE40020E
<br/>
        .word 0xFE30020E
<br/>
        .word 0xFE10020F
<br/>
        .word 0xFDF00210
<br/>
        .word 0xFDE00211
<br/>
        .word 0xFDC00212
<br/>
        .word 0xFDB00212
<br/>
        .word 0xFD900213
<br/>
        .word 0xFD700214
<br/>
        .word 0xFD600215
<br/>
        .word 0xFD400216
<br/>
        .word 0xFD200216
<br/>
        .word 0xFD100217
<br/>
        .word 0xFCF00218
<br/>
        .word 0xFCE00219
<br/>
        .word 0xFCC0021A
<br/>
        .word 0xFCA0021A
<br/>
        .word 0xFC90021B
<br/>
        .word 0xFC70021C
<br/>
        .word 0xFC50021D
<br/>
        .word 0xFC40021E
<br/>
        .word 0xFC20021E
<br/>
        .word 0xFC10021F
<br/>
        .word 0xFBF00220
<br/>
        .word 0xFBD00221
<br/>
        .word 0xFBC00222
<br/>
        .word 0xFBA00222
<br/>
        .word 0xFB800223
<br/>
        .word 0xFB700224
<br/>
        .word 0xFB500225
<br/>
        .word 0xFB400226
<br/>
        .word 0xFB200226
<br/>
        .word 0xFB000227
<br/>
        .word 0xFAF00228
<br/>
        .word 0xFAD00229
<br/>
        .word 0xFAB00229
<br/>
        .word 0xFAA0022A
<br/>
        .word 0xFA80022B
<br/>
        .word 0xFA70022C
<br/>
        .word 0xFA50022D
<br/>
        .word 0xFA30022D
<br/>
        .word 0xFA20022E
<br/>
        .word 0xFA00022F
<br/>
        .word 0xF9E00230
<br/>
        .word 0xF9D00231
<br/>
        .word 0xF9B00231
<br/>
        .word 0xF9A00232
<br/>
        .word 0xF9800233
<br/>
        .word 0xF9600234
<br/>
        .word 0xF9500235
<br/>
        .word 0xF9300235
<br/>
        .word 0xF9100236
<br/>
        .word 0xF9000237
<br/>
        .word 0xF8E00238
<br/>
        .word 0xF8D00239
<br/>
        .word 0xF8B00239
<br/>
        .word 0xF890023A
<br/>
        .word 0xF880023B
<br/>
        .word 0xF860023C
<br/>
        .word 0xF840023D
<br/>
        .word 0xF830023D
<br/>
        .word 0xF810023E
<br/>
        .word 0xF800023F
<br/>
        .word 0xF7E00240
<br/>
        .word 0xF7C00241
<br/>
        .word 0xF7B00241
<br/>
        .word 0xF7900242
<br/>
        .word 0xF7700243
<br/>
        .word 0xF7600244
<br/>
        .word 0xF7400245
<br/>
        .word 0xF7300245
<br/>
        .word 0xF7100246
<br/>
        .word 0xF6F00247
<br/>
        .word 0xF6E00248
<br/>
        .word 0xF6C00249
<br/>
        .word 0xF6A00249
<br/>
        .word 0xF690024A
<br/>
        .word 0xF670024B
<br/>
        .word 0xF660024C
<br/>
        .word 0xF640024D
<br/>
        .word 0xF620024D
<br/>
        .word 0xF610024E
<br/>
        .word 0xF5F0024F
<br/>
        .word 0xF5D00250
<br/>
        .word 0xF5C00251
<br/>
        .word 0xF5A00251
<br/>
        .word 0xF5900252
<br/>
        .word 0xF5700253
<br/>
        .word 0xF5500254
<br/>
        .word 0xF5400255
<br/>
        .word 0xF5200255
<br/>
        .word 0xF5000256
<br/>
        .word 0xF4F00257
<br/>
        .word 0xF4D00258
<br/>
        .word 0xF4C00259
<br/>
        .word 0xF4A00259
<br/>
        .word 0xF480025A
<br/>
        .word 0xF470025B
<br/>
        .word 0xF450025C
<br/>
        .word 0xF430025D
<br/>
        .word 0xF420025D
<br/>
        .word 0xF400025E
<br/>
        .word 0xF3F0025F
<br/>
        .word 0xF3D00260
<br/>
        .word 0xF3B00261
<br/>
        .word 0xF3A00261
<br/>
        .word 0xF3800262
<br/>
        .word 0xF3600263
<br/>
        .word 0xF3500264
<br/>
        .word 0xF3300265
<br/>
        .word 0xF3100265
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
This trades maths operations for table lookups - which may or may not be a good thing on the NDS. There may well be more speedups to be had; for instance, rather than reading pairs of Y pixels from subsequent rows, using LDRBs we may be better reading adjacent ones with LDRH and masking.
<br/>
<br/>
This code could be faster still if only the "Y+B" components could be kept below 512. This can be acheived by bending the tables slightly. I might experiment with that later.
<br/>
<br/>
I'm off on holiday on Wednesday, so if I go silent, please don't assume that it's disinterest.
<br/>
<br/>
Robin</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#158210 - Dwedit - Sat Jun 07, 2008 1:35 pm</h4>
    <div class="postbody"><span class="postbody">Tables provide a convenient way to use up otherwise unused DTCM :)<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#158218 - RobinWatts - Sat Jun 07, 2008 5:35 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>RobinWatts wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote">Has anyone achieved something faster?</td> </tr></table><span class="postbody">
<br/>
<br/>
This code could be faster still if only the "Y+B" components could be kept below 512. This can be acheived by bending the tables slightly. I might experiment with that later.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Second attempt, using the slightly bent tables. I defy anyone to tell the difference visually :)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">@ YUV-&gt; RGB conversion code Copyright (C) 2008 Robin Watts (robin@wss.co.uk).
<br/>
@
<br/>
@ Licensed under the GPL. If you need it under another license, contact me
<br/>
@ and ask.
<br/>
@
<br/>
@  This program is free software ; you can redistribute it and/or modify
<br/>
@  it under the terms of the GNU General Public License as published by
<br/>
@  the Free Software Foundation ; either version 2 of the License, or
<br/>
@  (at your option) any later version.
<br/>
@
<br/>
@  This program is distributed in the hope that it will be useful,
<br/>
@  but WITHOUT ANY WARRANTY ; without even the implied warranty of
<br/>
@  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
<br/>
@  GNU General Public License for more details.
<br/>
@
<br/>
@  You should have received a copy of the GNU General Public License
<br/>
@  along with this program ; if not, write to the Free Software
<br/>
@  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA
<br/>
@
<br/>
@
<br/>
@ The algorithm used here is based heavily on one created by Sophie Wilson
<br/>
@ of Acorn/e-14/Broadcomm. Many thanks.
<br/>
@
<br/>
@ Additional tweaks (in the fast fixup code) are from Paul Gardiner.
<br/>
@
<br/>
@ The old implementation of YUV -&gt; RGB did:
<br/>
@
<br/>
@ R = CLAMP((Y-16)*1.164 +           1.596*V)
<br/>
@ G = CLAMP((Y-16)*1.164 - 0.391*U - 0.813*V)
<br/>
@ B = CLAMP((Y-16)*1.164 + 2.018*U          )
<br/>
@
<br/>
@ We're going to bend that here as follows:
<br/>
@
<br/>
@ R = CLAMP(y +           1.596*V)
<br/>
@ G = CLAMP(y - 0.383*U - 0.813*V)
<br/>
@ B = CLAMP(y + 1.976*U          )
<br/>
@
<br/>
@ where y = 0               for       Y &lt;=  16,
<br/>
@       y = (  Y-16)*1.164, for  16 &lt; Y &lt;= 239,
<br/>
@       y = (239-16)*1.164, for 239 &lt; Y
<br/>
@
<br/>
@ i.e. We clamp Y to the 16 to 239 range (which it is supposed to be in
<br/>
@ anyway). We then pick the B_U factor so that B never exceeds 511. We then
<br/>
@ shrink the G_U factor in line with that to avoid a colour shift as much as
<br/>
@ possible.
<br/>
@
<br/>
@ We're going to use tables to do it faster, but rather than doing it using
<br/>
@ 5 tables as as the above suggests, we're going to do it using just 3.
<br/>
@
<br/>
@ We do this by working in parallel within a 32 bit word, and using one
<br/>
@ table each for Y U and V.
<br/>
@
<br/>
@ Source Y values are    0 to 255, so    0.. 260 after scaling
<br/>
@ Source U values are -128 to 127, so  -49.. 49(G), -253..251(B) after
<br/>
@ Source V values are -128 to 127, so -204..203(R), -104..103(G) after
<br/>
@
<br/>
@ So total summed values:
<br/>
@ -223 &lt;= R &lt;= 481, -173 &lt;= G &lt;= 431, -253 &lt;= B &lt; 511
<br/>
@
<br/>
@ We need to pack R G and B into a 32 bit word, and because of Bs range we
<br/>
@ need 2 bits above the valid range of B to detect overflow, and another one
<br/>
@ to detect the sense of the overflow. We therefore adopt the following
<br/>
@ representation:
<br/>
@
<br/>
@ osGGGGGgggggosBBBBBbbbosRRRRRrrr
<br/>
@
<br/>
@ Each such word breaks down into 3 ranges.
<br/>
@
<br/>
@ osGGGGGggggg   osBBBBBbbb   osRRRRRrrr
<br/>
@
<br/>
@ Thus we have 8 bits for each B and R table entry, and 10 bits for G (good
<br/>
@ as G is the most noticable one). The s bit for each represents the sign,
<br/>
@ and o represents the overflow.
<br/>
@
<br/>
@ For R and B we pack the table by taking the 11 bit representation of their
<br/>
@ values, and toggling bit 10 in the U and V tables.
<br/>
@
<br/>
@ For the green case we calculate 4*G (thus effectively using 10 bits for the
<br/>
@ valid range) truncate to 12 bits. We toggle bit 11 in the Y table.
<br/>
<br/>
.equ   UV_STRIDE,   192
<br/>
.equ   Y_STRIDE,   384
<br/>
.equ   X_STRIDE,   512
<br/>
.equ   WIDTH,      256
<br/>
<br/>
<br/>
.align
<br/>
.global   yv12_to_rgb555_asm
<br/>
.func   yv12_to_rgb555_asm
<br/>
<br/>
@ void yv12_to_rgb555_asm
<br/>
@  uint8_t * x_ptr
<br/>
@  uint8_t * y_ptr
<br/>
@  uint8_t * u_ptr
<br/>
@  uint8_t * v_ptr
<br/>
@  int height
<br/>
<br/>
yv12_to_rgb555_asm:
<br/>
<br/>
   @ r0 = x_ptr
<br/>
   @ r1 = y_ptr
<br/>
   @ r2 = u_ptr
<br/>
   @ r3 = v_ptr
<br/>
   @ &lt;&gt; = height
<br/>
   STMFD   r13!,{r4-r11,r14}
<br/>
<br/>
   ADR   r8, y_table
<br/>
   LDRB   r14,[r13,#9*4]      @ r14 = height
<br/>
   ADD   r9, r8,#1024   @ u_table
<br/>
   ADD   r10,r9,#1024   @ v_table
<br/>
   LDR   r4, =0x07C07C1F
<br/>
   LDR   r5, =0x40040100
<br/>
yloop:
<br/>
   SUB   r14,r14,#WIDTH&lt;&lt;8   @ r14 = height-(WIDTH&lt;&lt;8)
<br/>
xloop:
<br/>
   LDRB   r11,[r2],#1      @ r11 = u  = *u_ptr++
<br/>
   LDRB   r12,[r3],#1      @ r12 = v  = *v_ptr++
<br/>
   LDRB   r7, [r1, #Y_STRIDE]   @ r7  = y2 = y_ptr[stride]
<br/>
   LDRB   r6, [r1],#1      @ r6  = y0 = *y_ptr++
<br/>
   LDR   r11,[r9, r11,LSL #2]   @ r11 = u  = u_table[u]
<br/>
   LDR   r12,[r10,r12,LSL #2]   @ r12 = v  = v_table[v]
<br/>
   LDR   r7, [r8, r7, LSL #2]   @ r7  = y2 = y_table[y2]
<br/>
   LDR   r6, [r8, r6, LSL #2]   @ r6  = y0 = y_table[y0]
<br/>
   ADD   r11,r11,r12      @ r11 = uv = u+v
<br/>
<br/>
   ADD   r7, r7,r11      @ r7  = y0 + uv
<br/>
   ADD   r6, r6,r11      @ r6  = y2 + uv
<br/>
   ANDS   r12, r7, r5
<br/>
   TSTEQ   r6, r5
<br/>
   BNE   fix01
<br/>
return01:
<br/>
   AND   r7, r4, r7, LSR #3
<br/>
   AND   r6, r4, r6, LSR #3
<br/>
   ORR   r7, r7, r7, LSR #17
<br/>
   ORR   r6, r6, r6, LSR #17
<br/>
   ADD   r12,r0, #X_STRIDE
<br/>
   STRH   r7, [r12]
<br/>
   LDRB   r12,[r1, #Y_STRIDE]   @ r12 = y3 = y_ptr[stride]
<br/>
   LDRB   r7, [r1],#1      @ r6  = y1 = *y_ptr++
<br/>
   STRH   r6, [r0],#2
<br/>
<br/>
   LDR   r12,[r8, r12,LSL #2]   @ r7  = y3 = y_table[y2]
<br/>
   LDR   r6, [r8, r7, LSL #2]   @ r6  = y1 = y_table[y0]
<br/>
<br/>
   ADD   r7, r12,r11      @ r7  = y3 + uv
<br/>
   ADD   r6, r6, r11      @ r6  = y1 + uv
<br/>
   ANDS   r12, r7, r5
<br/>
   TSTEQ   r6, r5
<br/>
   BNE   fix02
<br/>
return02:
<br/>
   AND   r7, r4, r7, LSR #3
<br/>
   AND   r6, r4, r6, LSR #3
<br/>
   ORR   r7, r7, r7, LSR #17
<br/>
   ORR   r6, r6, r6, LSR #17
<br/>
   ADD   r12,r0, #X_STRIDE
<br/>
   STRH   r7, [r12]
<br/>
   STRH   r6, [r0],#2
<br/>
   ADDS   r14,r14,#2&lt;&lt;8
<br/>
   BLT   xloop
<br/>
<br/>
   ADD   r0, r0, #2*X_STRIDE - 2*WIDTH   @ x_ptr to next line
<br/>
   ADD   r1, r1, #2*Y_STRIDE -   WIDTH   @ y_ptr to next line
<br/>
   ADD   r2, r2, #UV_STRIDE - (WIDTH/2)
<br/>
   ADD   r3, r3, #UV_STRIDE - (WIDTH/2)
<br/>
<br/>
   SUBS   r14,r14,#2
<br/>
   BGT   yloop
<br/>
<br/>
   LDMFD   r13!,{r4-r11, pc}
<br/>
fix01:
<br/>
   @ r7 and r6 are the values, at least one of which has overflowed
<br/>
   @ r12 = r7 &amp; mask = .s......s......s......
<br/>
   SUB   r12,r12,r12,LSR #8   @ r12 = ..SSSSSS.SSSSSS.SSSSSS
<br/>
   ORR   r7, r7, r12      @ r7 |= ..SSSSSS.SSSSSS.SSSSSS
<br/>
   BIC   r12,r5, r7, LSR #1   @ r12 = .o......o......o......
<br/>
   ADD   r7, r7, r12,LSR #8   @ r7  = fixed value
<br/>
<br/>
   AND   r12, r6, r5      @ r12 = .S......S......S......
<br/>
   SUB   r12,r12,r12,LSR #8   @ r12 = ..SSSSSS.SSSSSS.SSSSSS
<br/>
   ORR   r6, r6, r12      @ r6 |= ..SSSSSS.SSSSSS.SSSSSS
<br/>
   BIC   r12,r5, r6, LSR #1   @ r12 = .o......o......o......
<br/>
   ADD   r6, r6, r12,LSR #8   @ r6  = fixed value
<br/>
   B   return01
<br/>
fix02:
<br/>
   @ r7 and r6 are the values, at least one of which has overflowed
<br/>
   @ r12 = r7 &amp; mask = .s......s......s......
<br/>
   SUB   r12,r12,r12,LSR #8   @ r12 = ..SSSSSS.SSSSSS.SSSSSS
<br/>
   ORR   r7, r7, r12      @ r7 |= ..SSSSSS.SSSSSS.SSSSSS
<br/>
   BIC   r12,r5, r7, LSR #1   @ r12 = .o......o......o......
<br/>
   ADD   r7, r7, r12,LSR #8   @ r7  = fixed value
<br/>
<br/>
   AND   r12, r6, r5      @ r12 = .S......S......S......
<br/>
   SUB   r12,r12,r12,LSR #8   @ r12 = ..SSSSSS..SSSSS.SSSSSS
<br/>
   ORR   r6, r6, r12      @ r6 |= ..SSSSSS..SSSSS.SSSSSS
<br/>
   BIC   r12,r5, r6, LSR #1   @ r12 = .o......o......o......
<br/>
   ADD   r6, r6, r12,LSR #8   @ r6  = fixed value
<br/>
   B   return02
<br/>
.endfunc
<br/>
.pool
<br/>
<br/>
y_table:
<br/>
        .word 0x7FFFFFED
<br/>
        .word 0x7FFFFFEF
<br/>
        .word 0x7FFFFFF0
<br/>
        .word 0x7FFFFFF1
<br/>
        .word 0x7FFFFFF2
<br/>
        .word 0x7FFFFFF3
<br/>
        .word 0x7FFFFFF4
<br/>
        .word 0x7FFFFFF6
<br/>
        .word 0x7FFFFFF7
<br/>
        .word 0x7FFFFFF8
<br/>
        .word 0x7FFFFFF9
<br/>
        .word 0x7FFFFFFA
<br/>
        .word 0x7FFFFFFB
<br/>
        .word 0x7FFFFFFD
<br/>
        .word 0x7FFFFFFE
<br/>
        .word 0x7FFFFFFF
<br/>
        .word 0x80000000
<br/>
        .word 0x80500401
<br/>
        .word 0x80900802
<br/>
        .word 0x80E00C03
<br/>
        .word 0x81301405
<br/>
        .word 0x81701806
<br/>
        .word 0x81C01C07
<br/>
        .word 0x82102008
<br/>
        .word 0x82502409
<br/>
        .word 0x82A0280A
<br/>
        .word 0x82F0300C
<br/>
        .word 0x8330340D
<br/>
        .word 0x8380380E
<br/>
        .word 0x83D03C0F
<br/>
        .word 0x84104010
<br/>
        .word 0x84604411
<br/>
        .word 0x84A04C13
<br/>
        .word 0x84F05014
<br/>
        .word 0x85405415
<br/>
        .word 0x85805816
<br/>
        .word 0x85D05C17
<br/>
        .word 0x86206018
<br/>
        .word 0x8660681A
<br/>
        .word 0x86B06C1B
<br/>
        .word 0x8700701C
<br/>
        .word 0x8740741D
<br/>
        .word 0x8790781E
<br/>
        .word 0x87E07C1F
<br/>
        .word 0x88208421
<br/>
        .word 0x88708822
<br/>
        .word 0x88C08C23
<br/>
        .word 0x89009024
<br/>
        .word 0x89509425
<br/>
        .word 0x89A09826
<br/>
        .word 0x89E0A028
<br/>
        .word 0x8A30A429
<br/>
        .word 0x8A80A82A
<br/>
        .word 0x8AC0AC2B
<br/>
        .word 0x8B10B02C
<br/>
        .word 0x8B60B42D
<br/>
        .word 0x8BA0BC2F
<br/>
        .word 0x8BF0C030
<br/>
        .word 0x8C40C431
<br/>
        .word 0x8C80C832
<br/>
        .word 0x8CD0CC33
<br/>
        .word 0x8D20D034
<br/>
        .word 0x8D60D836
<br/>
        .word 0x8DB0DC37
<br/>
        .word 0x8DF0E038
<br/>
        .word 0x8E40E439
<br/>
        .word 0x8E90E83A
<br/>
        .word 0x8ED0EC3B
<br/>
        .word 0x8F20F43D
<br/>
        .word 0x8F70F83E
<br/>
        .word 0x8FB0FC3F
<br/>
        .word 0x90010040
<br/>
        .word 0x90510441
<br/>
        .word 0x90910842
<br/>
        .word 0x90E11044
<br/>
        .word 0x91311445
<br/>
        .word 0x91711846
<br/>
        .word 0x91C11C47
<br/>
        .word 0x92112048
<br/>
        .word 0x92512449
<br/>
        .word 0x92A1284A
<br/>
        .word 0x92F1304C
<br/>
        .word 0x9331344D
<br/>
        .word 0x9381384E
<br/>
        .word 0x93D13C4F
<br/>
        .word 0x94114050
<br/>
        .word 0x94614451
<br/>
        .word 0x94B14C53
<br/>
        .word 0x94F15054
<br/>
        .word 0x95415455
<br/>
        .word 0x95915856
<br/>
        .word 0x95D15C57
<br/>
        .word 0x96216058
<br/>
        .word 0x9671685A
<br/>
        .word 0x96B16C5B
<br/>
        .word 0x9701705C
<br/>
        .word 0x9741745D
<br/>
        .word 0x9791785E
<br/>
        .word 0x97E17C5F
<br/>
        .word 0x98218461
<br/>
        .word 0x98718862
<br/>
        .word 0x98C18C63
<br/>
        .word 0x99019064
<br/>
        .word 0x99519465
<br/>
        .word 0x99A19866
<br/>
        .word 0x99E1A068
<br/>
        .word 0x9A31A469
<br/>
        .word 0x9A81A86A
<br/>
        .word 0x9AC1AC6B
<br/>
        .word 0x9B11B06C
<br/>
        .word 0x9B61B46D
<br/>
        .word 0x9BA1BC6F
<br/>
        .word 0x9BF1C070
<br/>
        .word 0x9C41C471
<br/>
        .word 0x9C81C872
<br/>
        .word 0x9CD1CC73
<br/>
        .word 0x9D21D074
<br/>
        .word 0x9D61D876
<br/>
        .word 0x9DB1DC77
<br/>
        .word 0x9E01E078
<br/>
        .word 0x9E41E479
<br/>
        .word 0x9E91E87A
<br/>
        .word 0x9EE1EC7B
<br/>
        .word 0x9F21F47D
<br/>
        .word 0x9F71F87E
<br/>
        .word 0x9FC1FC7F
<br/>
        .word 0xA0020080
<br/>
        .word 0xA0520481
<br/>
        .word 0xA0920882
<br/>
        .word 0xA0E21084
<br/>
        .word 0xA1321485
<br/>
        .word 0xA1721886
<br/>
        .word 0xA1C21C87
<br/>
        .word 0xA2122088
<br/>
        .word 0xA2522489
<br/>
        .word 0xA2A22C8B
<br/>
        .word 0xA2F2308C
<br/>
        .word 0xA332348D
<br/>
        .word 0xA382388E
<br/>
        .word 0xA3D23C8F
<br/>
        .word 0xA4124090
<br/>
        .word 0xA4624892
<br/>
        .word 0xA4B24C93
<br/>
        .word 0xA4F25094
<br/>
        .word 0xA5425495
<br/>
        .word 0xA5925896
<br/>
        .word 0xA5D25C97
<br/>
        .word 0xA6226098
<br/>
        .word 0xA672689A
<br/>
        .word 0xA6B26C9B
<br/>
        .word 0xA702709C
<br/>
        .word 0xA752749D
<br/>
        .word 0xA792789E
<br/>
        .word 0xA7E27C9F
<br/>
        .word 0xA83284A1
<br/>
        .word 0xA87288A2
<br/>
        .word 0xA8C28CA3
<br/>
        .word 0xA90290A4
<br/>
        .word 0xA95294A5
<br/>
        .word 0xA9A298A6
<br/>
        .word 0xA9E2A0A8
<br/>
        .word 0xAA32A4A9
<br/>
        .word 0xAA82A8AA
<br/>
        .word 0xAAC2ACAB
<br/>
        .word 0xAB12B0AC
<br/>
        .word 0xAB62B4AD
<br/>
        .word 0xABA2BCAF
<br/>
        .word 0xABF2C0B0
<br/>
        .word 0xAC42C4B1
<br/>
        .word 0xAC82C8B2
<br/>
        .word 0xACD2CCB3
<br/>
        .word 0xAD22D0B4
<br/>
        .word 0xAD62D8B6
<br/>
        .word 0xADB2DCB7
<br/>
        .word 0xAE02E0B8
<br/>
        .word 0xAE42E4B9
<br/>
        .word 0xAE92E8BA
<br/>
        .word 0xAEE2ECBB
<br/>
        .word 0xAF22F4BD
<br/>
        .word 0xAF72F8BE
<br/>
        .word 0xAFC2FCBF
<br/>
        .word 0xB00300C0
<br/>
        .word 0xB05304C1
<br/>
        .word 0xB0A308C2
<br/>
        .word 0xB0E310C4
<br/>
        .word 0xB13314C5
<br/>
        .word 0xB18318C6
<br/>
        .word 0xB1C31CC7
<br/>
        .word 0xB21320C8
<br/>
        .word 0xB25324C9
<br/>
        .word 0xB2A32CCB
<br/>
        .word 0xB2F330CC
<br/>
        .word 0xB33334CD
<br/>
        .word 0xB38338CE
<br/>
        .word 0xB3D33CCF
<br/>
        .word 0xB41340D0
<br/>
        .word 0xB46348D2
<br/>
        .word 0xB4B34CD3
<br/>
        .word 0xB4F350D4
<br/>
        .word 0xB54354D5
<br/>
        .word 0xB59358D6
<br/>
        .word 0xB5D35CD7
<br/>
        .word 0xB62364D9
<br/>
        .word 0xB67368DA
<br/>
        .word 0xB6B36CDB
<br/>
        .word 0xB70370DC
<br/>
        .word 0xB75374DD
<br/>
        .word 0xB79378DE
<br/>
        .word 0xB7E37CDF
<br/>
        .word 0xB83384E1
<br/>
        .word 0xB87388E2
<br/>
        .word 0xB8C38CE3
<br/>
        .word 0xB91390E4
<br/>
        .word 0xB95394E5
<br/>
        .word 0xB9A398E6
<br/>
        .word 0xB9F3A0E8
<br/>
        .word 0xBA33A4E9
<br/>
        .word 0xBA83A8EA
<br/>
        .word 0xBAD3ACEB
<br/>
        .word 0xBB13B0EC
<br/>
        .word 0xBB63B4ED
<br/>
        .word 0xBBA3BCEF
<br/>
        .word 0xBBF3C0F0
<br/>
        .word 0xBC43C4F1
<br/>
        .word 0xBC83C8F2
<br/>
        .word 0xBCD3CCF3
<br/>
        .word 0xBD23D0F4
<br/>
        .word 0xBD63D8F6
<br/>
        .word 0xBDB3DCF7
<br/>
        .word 0xBE03E0F8
<br/>
        .word 0xBE43E4F9
<br/>
        .word 0xBE93E8FA
<br/>
        .word 0xBEE3ECFB
<br/>
        .word 0xBF23F4FD
<br/>
        .word 0xBF73F8FE
<br/>
        .word 0xBFC3FCFF
<br/>
        .word 0xC0040100
<br/>
        .word 0xC0540501
<br/>
        .word 0xC0A40902
<br/>
        .word 0xC0E41104
<br/>
        .word 0xC0E41104
<br/>
        .word 0xC0E41104
<br/>
        .word 0xC0E41104
<br/>
        .word 0xC0E41104
<br/>
        .word 0xC0E41104
<br/>
        .word 0xC0E41104
<br/>
        .word 0xC0E41104
<br/>
        .word 0xC0E41104
<br/>
        .word 0xC0E41104
<br/>
        .word 0xC0E41104
<br/>
        .word 0xC0E41104
<br/>
        .word 0xC0E41104
<br/>
        .word 0xC0E41104
<br/>
        .word 0xC0E41104
<br/>
        .word 0xC0E41104
<br/>
        .word 0xC0E41104
<br/>
u_table:
<br/>
        .word 0x0C440C00
<br/>
        .word 0x0C341400
<br/>
        .word 0x0C141C00
<br/>
        .word 0x0C042400
<br/>
        .word 0x0BE42C00
<br/>
        .word 0x0BC43400
<br/>
        .word 0x0BB43C00
<br/>
        .word 0x0B944400
<br/>
        .word 0x0B844C00
<br/>
        .word 0x0B645400
<br/>
        .word 0x0B545C00
<br/>
        .word 0x0B346400
<br/>
        .word 0x0B246C00
<br/>
        .word 0x0B047400
<br/>
        .word 0x0AF47C00
<br/>
        .word 0x0AD48400
<br/>
        .word 0x0AC48C00
<br/>
        .word 0x0AA49400
<br/>
        .word 0x0A949C00
<br/>
        .word 0x0A74A400
<br/>
        .word 0x0A54AC00
<br/>
        .word 0x0A44B400
<br/>
        .word 0x0A24BC00
<br/>
        .word 0x0A14C400
<br/>
        .word 0x09F4C800
<br/>
        .word 0x09E4D000
<br/>
        .word 0x09C4D800
<br/>
        .word 0x09B4E000
<br/>
        .word 0x0994E800
<br/>
        .word 0x0984F000
<br/>
        .word 0x0964F800
<br/>
        .word 0x09550000
<br/>
        .word 0x09350800
<br/>
        .word 0x09251000
<br/>
        .word 0x09051800
<br/>
        .word 0x08E52000
<br/>
        .word 0x08D52800
<br/>
        .word 0x08B53000
<br/>
        .word 0x08A53800
<br/>
        .word 0x08854000
<br/>
        .word 0x08754800
<br/>
        .word 0x08555000
<br/>
        .word 0x08455800
<br/>
        .word 0x08256000
<br/>
        .word 0x08156800
<br/>
        .word 0x07F57000
<br/>
        .word 0x07E57800
<br/>
        .word 0x07C58000
<br/>
        .word 0x07B58800
<br/>
        .word 0x07959000
<br/>
        .word 0x07759800
<br/>
        .word 0x0765A000
<br/>
        .word 0x0745A800
<br/>
        .word 0x0735B000
<br/>
        .word 0x0715B800
<br/>
        .word 0x0705C000
<br/>
        .word 0x06E5C800
<br/>
        .word 0x06D5D000
<br/>
        .word 0x06B5D800
<br/>
        .word 0x06A5E000
<br/>
        .word 0x0685E800
<br/>
        .word 0x0675F000
<br/>
        .word 0x0655F800
<br/>
        .word 0x06460000
<br/>
        .word 0x06260800
<br/>
        .word 0x06161000
<br/>
        .word 0x05F61400
<br/>
        .word 0x05D61C00
<br/>
        .word 0x05C62400
<br/>
        .word 0x05A62C00
<br/>
        .word 0x05963400
<br/>
        .word 0x05763C00
<br/>
        .word 0x05664400
<br/>
        .word 0x05464C00
<br/>
        .word 0x05365400
<br/>
        .word 0x05165C00
<br/>
        .word 0x05066400
<br/>
        .word 0x04E66C00
<br/>
        .word 0x04D67400
<br/>
        .word 0x04B67C00
<br/>
        .word 0x04A68400
<br/>
        .word 0x04868C00
<br/>
        .word 0x04669400
<br/>
        .word 0x04569C00
<br/>
        .word 0x0436A400
<br/>
        .word 0x0426AC00
<br/>
        .word 0x0406B400
<br/>
        .word 0x03F6BC00
<br/>
        .word 0x03D6C400
<br/>
        .word 0x03C6CC00
<br/>
        .word 0x03A6D400
<br/>
        .word 0x0396DC00
<br/>
        .word 0x0376E400
<br/>
        .word 0x0366EC00
<br/>
        .word 0x0346F400
<br/>
        .word 0x0336FC00
<br/>
        .word 0x03170400
<br/>
        .word 0x02F70C00
<br/>
        .word 0x02E71400
<br/>
        .word 0x02C71C00
<br/>
        .word 0x02B72400
<br/>
        .word 0x02972C00
<br/>
        .word 0x02873400
<br/>
        .word 0x02673C00
<br/>
        .word 0x02574400
<br/>
        .word 0x02374C00
<br/>
        .word 0x02275400
<br/>
        .word 0x02075C00
<br/>
        .word 0x01F76000
<br/>
        .word 0x01D76800
<br/>
        .word 0x01C77000
<br/>
        .word 0x01A77800
<br/>
        .word 0x01978000
<br/>
        .word 0x01778800
<br/>
        .word 0x01579000
<br/>
        .word 0x01479800
<br/>
        .word 0x0127A000
<br/>
        .word 0x0117A800
<br/>
        .word 0x00F7B000
<br/>
        .word 0x00E7B800
<br/>
        .word 0x00C7C000
<br/>
        .word 0x00B7C800
<br/>
        .word 0x0097D000
<br/>
        .word 0x0087D800
<br/>
        .word 0x0067E000
<br/>
        .word 0x0057E800
<br/>
        .word 0x0037F000
<br/>
        .word 0x0027F800
<br/>
        .word 0x00080000
<br/>
        .word 0xFFE80800
<br/>
        .word 0xFFD81000
<br/>
        .word 0xFFB81800
<br/>
        .word 0xFFA82000
<br/>
        .word 0xFF882800
<br/>
        .word 0xFF783000
<br/>
        .word 0xFF583800
<br/>
        .word 0xFF484000
<br/>
        .word 0xFF284800
<br/>
        .word 0xFF185000
<br/>
        .word 0xFEF85800
<br/>
        .word 0xFEE86000
<br/>
        .word 0xFEC86800
<br/>
        .word 0xFEB87000
<br/>
        .word 0xFE987800
<br/>
        .word 0xFE788000
<br/>
        .word 0xFE688800
<br/>
        .word 0xFE489000
<br/>
        .word 0xFE389800
<br/>
        .word 0xFE18A000
<br/>
        .word 0xFE08A400
<br/>
        .word 0xFDE8AC00
<br/>
        .word 0xFDD8B400
<br/>
        .word 0xFDB8BC00
<br/>
        .word 0xFDA8C400
<br/>
        .word 0xFD88CC00
<br/>
        .word 0xFD78D400
<br/>
        .word 0xFD58DC00
<br/>
        .word 0xFD48E400
<br/>
        .word 0xFD28EC00
<br/>
        .word 0xFD18F400
<br/>
        .word 0xFCF8FC00
<br/>
        .word 0xFCD90400
<br/>
        .word 0xFCC90C00
<br/>
        .word 0xFCA91400
<br/>
        .word 0xFC991C00
<br/>
        .word 0xFC792400
<br/>
        .word 0xFC692C00
<br/>
        .word 0xFC493400
<br/>
        .word 0xFC393C00
<br/>
        .word 0xFC194400
<br/>
        .word 0xFC094C00
<br/>
        .word 0xFBE95400
<br/>
        .word 0xFBD95C00
<br/>
        .word 0xFBB96400
<br/>
        .word 0xFBA96C00
<br/>
        .word 0xFB897400
<br/>
        .word 0xFB697C00
<br/>
        .word 0xFB598400
<br/>
        .word 0xFB398C00
<br/>
        .word 0xFB299400
<br/>
        .word 0xFB099C00
<br/>
        .word 0xFAF9A400
<br/>
        .word 0xFAD9AC00
<br/>
        .word 0xFAC9B400
<br/>
        .word 0xFAA9BC00
<br/>
        .word 0xFA99C400
<br/>
        .word 0xFA79CC00
<br/>
        .word 0xFA69D400
<br/>
        .word 0xFA49DC00
<br/>
        .word 0xFA39E400
<br/>
        .word 0xFA19EC00
<br/>
        .word 0xF9F9F000
<br/>
        .word 0xF9E9F800
<br/>
        .word 0xF9CA0000
<br/>
        .word 0xF9BA0800
<br/>
        .word 0xF99A1000
<br/>
        .word 0xF98A1800
<br/>
        .word 0xF96A2000
<br/>
        .word 0xF95A2800
<br/>
        .word 0xF93A3000
<br/>
        .word 0xF92A3800
<br/>
        .word 0xF90A4000
<br/>
        .word 0xF8FA4800
<br/>
        .word 0xF8DA5000
<br/>
        .word 0xF8CA5800
<br/>
        .word 0xF8AA6000
<br/>
        .word 0xF89A6800
<br/>
        .word 0xF87A7000
<br/>
        .word 0xF85A7800
<br/>
        .word 0xF84A8000
<br/>
        .word 0xF82A8800
<br/>
        .word 0xF81A9000
<br/>
        .word 0xF7FA9800
<br/>
        .word 0xF7EAA000
<br/>
        .word 0xF7CAA800
<br/>
        .word 0xF7BAB000
<br/>
        .word 0xF79AB800
<br/>
        .word 0xF78AC000
<br/>
        .word 0xF76AC800
<br/>
        .word 0xF75AD000
<br/>
        .word 0xF73AD800
<br/>
        .word 0xF72AE000
<br/>
        .word 0xF70AE800
<br/>
        .word 0xF6EAF000
<br/>
        .word 0xF6DAF800
<br/>
        .word 0xF6BB0000
<br/>
        .word 0xF6AB0800
<br/>
        .word 0xF68B1000
<br/>
        .word 0xF67B1800
<br/>
        .word 0xF65B2000
<br/>
        .word 0xF64B2800
<br/>
        .word 0xF62B3000
<br/>
        .word 0xF61B3800
<br/>
        .word 0xF5FB3C00
<br/>
        .word 0xF5EB4400
<br/>
        .word 0xF5CB4C00
<br/>
        .word 0xF5BB5400
<br/>
        .word 0xF59B5C00
<br/>
        .word 0xF57B6400
<br/>
        .word 0xF56B6C00
<br/>
        .word 0xF54B7400
<br/>
        .word 0xF53B7C00
<br/>
        .word 0xF51B8400
<br/>
        .word 0xF50B8C00
<br/>
        .word 0xF4EB9400
<br/>
        .word 0xF4DB9C00
<br/>
        .word 0xF4BBA400
<br/>
        .word 0xF4ABAC00
<br/>
        .word 0xF48BB400
<br/>
        .word 0xF47BBC00
<br/>
        .word 0xF45BC400
<br/>
        .word 0xF44BCC00
<br/>
        .word 0xF42BD400
<br/>
        .word 0xF41BDC00
<br/>
        .word 0xF3FBE400
<br/>
        .word 0xF3DBEC00
<br/>
v_table:
<br/>
        .word 0x1A000134
<br/>
        .word 0x19D00135
<br/>
        .word 0x19A00137
<br/>
        .word 0x19700139
<br/>
        .word 0x1930013A
<br/>
        .word 0x1900013C
<br/>
        .word 0x18D0013D
<br/>
        .word 0x1890013F
<br/>
        .word 0x18600140
<br/>
        .word 0x18300142
<br/>
        .word 0x18000144
<br/>
        .word 0x17C00145
<br/>
        .word 0x17900147
<br/>
        .word 0x17600148
<br/>
        .word 0x1730014A
<br/>
        .word 0x16F0014C
<br/>
        .word 0x16C0014D
<br/>
        .word 0x1690014F
<br/>
        .word 0x16600150
<br/>
        .word 0x16200152
<br/>
        .word 0x15F00154
<br/>
        .word 0x15C00155
<br/>
        .word 0x15900157
<br/>
        .word 0x15500158
<br/>
        .word 0x1520015A
<br/>
        .word 0x14F0015C
<br/>
        .word 0x14C0015D
<br/>
        .word 0x1480015F
<br/>
        .word 0x14500160
<br/>
        .word 0x14200162
<br/>
        .word 0x13F00164
<br/>
        .word 0x13B00165
<br/>
        .word 0x13800167
<br/>
        .word 0x13500168
<br/>
        .word 0x1320016A
<br/>
        .word 0x12E0016C
<br/>
        .word 0x12B0016D
<br/>
        .word 0x1280016F
<br/>
        .word 0x12500170
<br/>
        .word 0x12100172
<br/>
        .word 0x11E00174
<br/>
        .word 0x11B00175
<br/>
        .word 0x11800177
<br/>
        .word 0x11400178
<br/>
        .word 0x1110017A
<br/>
        .word 0x10E0017C
<br/>
        .word 0x10B0017D
<br/>
        .word 0x1070017F
<br/>
        .word 0x10400180
<br/>
        .word 0x10100182
<br/>
        .word 0x0FE00184
<br/>
        .word 0x0FA00185
<br/>
        .word 0x0F700187
<br/>
        .word 0x0F400188
<br/>
        .word 0x0F10018A
<br/>
        .word 0x0ED0018B
<br/>
        .word 0x0EA0018D
<br/>
        .word 0x0E70018F
<br/>
        .word 0x0E400190
<br/>
        .word 0x0E000192
<br/>
        .word 0x0DD00193
<br/>
        .word 0x0DA00195
<br/>
        .word 0x0D700197
<br/>
        .word 0x0D300198
<br/>
        .word 0x0D00019A
<br/>
        .word 0x0CD0019B
<br/>
        .word 0x0CA0019D
<br/>
        .word 0x0C60019F
<br/>
        .word 0x0C3001A0
<br/>
        .word 0x0C0001A2
<br/>
        .word 0x0BD001A3
<br/>
        .word 0x0B9001A5
<br/>
        .word 0x0B6001A7
<br/>
        .word 0x0B3001A8
<br/>
        .word 0x0B0001AA
<br/>
        .word 0x0AC001AB
<br/>
        .word 0x0A9001AD
<br/>
        .word 0x0A6001AF
<br/>
        .word 0x0A3001B0
<br/>
        .word 0x09F001B2
<br/>
        .word 0x09C001B3
<br/>
        .word 0x099001B5
<br/>
        .word 0x096001B7
<br/>
        .word 0x092001B8
<br/>
        .word 0x08F001BA
<br/>
        .word 0x08C001BB
<br/>
        .word 0x089001BD
<br/>
        .word 0x085001BF
<br/>
        .word 0x082001C0
<br/>
        .word 0x07F001C2
<br/>
        .word 0x07C001C3
<br/>
        .word 0x078001C5
<br/>
        .word 0x075001C7
<br/>
        .word 0x072001C8
<br/>
        .word 0x06F001CA
<br/>
        .word 0x06B001CB
<br/>
        .word 0x068001CD
<br/>
        .word 0x065001CF
<br/>
        .word 0x062001D0
<br/>
        .word 0x05E001D2
<br/>
        .word 0x05B001D3
<br/>
        .word 0x058001D5
<br/>
        .word 0x055001D7
<br/>
        .word 0x051001D8
<br/>
        .word 0x04E001DA
<br/>
        .word 0x04B001DB
<br/>
        .word 0x048001DD
<br/>
        .word 0x044001DE
<br/>
        .word 0x041001E0
<br/>
        .word 0x03E001E2
<br/>
        .word 0x03B001E3
<br/>
        .word 0x037001E5
<br/>
        .word 0x034001E6
<br/>
        .word 0x031001E8
<br/>
        .word 0x02E001EA
<br/>
        .word 0x02A001EB
<br/>
        .word 0x027001ED
<br/>
        .word 0x024001EE
<br/>
        .word 0x021001F0
<br/>
        .word 0x01D001F2
<br/>
        .word 0x01A001F3
<br/>
        .word 0x017001F5
<br/>
        .word 0x014001F6
<br/>
        .word 0x010001F8
<br/>
        .word 0x00D001FA
<br/>
        .word 0x00A001FB
<br/>
        .word 0x007001FD
<br/>
        .word 0x003001FE
<br/>
        .word 0x00000200
<br/>
        .word 0xFFD00202
<br/>
        .word 0xFF900203
<br/>
        .word 0xFF600205
<br/>
        .word 0xFF300206
<br/>
        .word 0xFF000208
<br/>
        .word 0xFEC0020A
<br/>
        .word 0xFE90020B
<br/>
        .word 0xFE60020D
<br/>
        .word 0xFE30020E
<br/>
        .word 0xFDF00210
<br/>
        .word 0xFDC00212
<br/>
        .word 0xFD900213
<br/>
        .word 0xFD600215
<br/>
        .word 0xFD200216
<br/>
        .word 0xFCF00218
<br/>
        .word 0xFCC0021A
<br/>
        .word 0xFC90021B
<br/>
        .word 0xFC50021D
<br/>
        .word 0xFC20021E
<br/>
        .word 0xFBF00220
<br/>
        .word 0xFBC00222
<br/>
        .word 0xFB800223
<br/>
        .word 0xFB500225
<br/>
        .word 0xFB200226
<br/>
        .word 0xFAF00228
<br/>
        .word 0xFAB00229
<br/>
        .word 0xFA80022B
<br/>
        .word 0xFA50022D
<br/>
        .word 0xFA20022E
<br/>
        .word 0xF9E00230
<br/>
        .word 0xF9B00231
<br/>
        .word 0xF9800233
<br/>
        .word 0xF9500235
<br/>
        .word 0xF9100236
<br/>
        .word 0xF8E00238
<br/>
        .word 0xF8B00239
<br/>
        .word 0xF880023B
<br/>
        .word 0xF840023D
<br/>
        .word 0xF810023E
<br/>
        .word 0xF7E00240
<br/>
        .word 0xF7B00241
<br/>
        .word 0xF7700243
<br/>
        .word 0xF7400245
<br/>
        .word 0xF7100246
<br/>
        .word 0xF6E00248
<br/>
        .word 0xF6A00249
<br/>
        .word 0xF670024B
<br/>
        .word 0xF640024D
<br/>
        .word 0xF610024E
<br/>
        .word 0xF5D00250
<br/>
        .word 0xF5A00251
<br/>
        .word 0xF5700253
<br/>
        .word 0xF5400255
<br/>
        .word 0xF5000256
<br/>
        .word 0xF4D00258
<br/>
        .word 0xF4A00259
<br/>
        .word 0xF470025B
<br/>
        .word 0xF430025D
<br/>
        .word 0xF400025E
<br/>
        .word 0xF3D00260
<br/>
        .word 0xF3A00261
<br/>
        .word 0xF3600263
<br/>
        .word 0xF3300265
<br/>
        .word 0xF3000266
<br/>
        .word 0xF2D00268
<br/>
        .word 0xF2900269
<br/>
        .word 0xF260026B
<br/>
        .word 0xF230026D
<br/>
        .word 0xF200026E
<br/>
        .word 0xF1C00270
<br/>
        .word 0xF1900271
<br/>
        .word 0xF1600273
<br/>
        .word 0xF1300275
<br/>
        .word 0xF0F00276
<br/>
        .word 0xF0C00278
<br/>
        .word 0xF0900279
<br/>
        .word 0xF060027B
<br/>
        .word 0xF020027C
<br/>
        .word 0xEFF0027E
<br/>
        .word 0xEFC00280
<br/>
        .word 0xEF900281
<br/>
        .word 0xEF500283
<br/>
        .word 0xEF200284
<br/>
        .word 0xEEF00286
<br/>
        .word 0xEEC00288
<br/>
        .word 0xEE800289
<br/>
        .word 0xEE50028B
<br/>
        .word 0xEE20028C
<br/>
        .word 0xEDF0028E
<br/>
        .word 0xEDB00290
<br/>
        .word 0xED800291
<br/>
        .word 0xED500293
<br/>
        .word 0xED200294
<br/>
        .word 0xECE00296
<br/>
        .word 0xECB00298
<br/>
        .word 0xEC800299
<br/>
        .word 0xEC50029B
<br/>
        .word 0xEC10029C
<br/>
        .word 0xEBE0029E
<br/>
        .word 0xEBB002A0
<br/>
        .word 0xEB8002A1
<br/>
        .word 0xEB4002A3
<br/>
        .word 0xEB1002A4
<br/>
        .word 0xEAE002A6
<br/>
        .word 0xEAB002A8
<br/>
        .word 0xEA7002A9
<br/>
        .word 0xEA4002AB
<br/>
        .word 0xEA1002AC
<br/>
        .word 0xE9E002AE
<br/>
        .word 0xE9A002B0
<br/>
        .word 0xE97002B1
<br/>
        .word 0xE94002B3
<br/>
        .word 0xE91002B4
<br/>
        .word 0xE8D002B6
<br/>
        .word 0xE8A002B8
<br/>
        .word 0xE87002B9
<br/>
        .word 0xE84002BB
<br/>
        .word 0xE80002BC
<br/>
        .word 0xE7D002BE
<br/>
        .word 0xE7A002C0
<br/>
        .word 0xE77002C1
<br/>
        .word 0xE73002C3
<br/>
        .word 0xE70002C4
<br/>
        .word 0xE6D002C6
<br/>
        .word 0xE6A002C8
<br/>
        .word 0xE66002C9
<br/>
        .word 0xE63002CB
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Robin</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#158220 - RobinWatts - Sat Jun 07, 2008 6:12 pm</h4>
    <div class="postbody"><span class="postbody">Third attempt, based on v2, but this time dithering the output. Looks much nicer, IMHO.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">@ YUV-&gt; RGB conversion code Copyright (C) 2008 Robin Watts (robin@wss.co.uk).
<br/>
@
<br/>
@ Licensed under the GPL. If you need it under another license, contact me
<br/>
@ and ask.
<br/>
@
<br/>
@  This program is free software ; you can redistribute it and/or modify
<br/>
@  it under the terms of the GNU General Public License as published by
<br/>
@  the Free Software Foundation ; either version 2 of the License, or
<br/>
@  (at your option) any later version.
<br/>
@
<br/>
@  This program is distributed in the hope that it will be useful,
<br/>
@  but WITHOUT ANY WARRANTY ; without even the implied warranty of
<br/>
@  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
<br/>
@  GNU General Public License for more details.
<br/>
@
<br/>
@  You should have received a copy of the GNU General Public License
<br/>
@  along with this program ; if not, write to the Free Software
<br/>
@  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA
<br/>
@
<br/>
@
<br/>
@ The algorithm used here is based heavily on one created by Sophie Wilson
<br/>
@ of Acorn/e-14/Broadcomm. Many thanks.
<br/>
@
<br/>
@ Additional tweaks (in the fast fixup code) are from Paul Gardiner.
<br/>
@
<br/>
@ The old implementation of YUV -&gt; RGB did:
<br/>
@
<br/>
@ R = CLAMP((Y-16)*1.164 +           1.596*V)
<br/>
@ G = CLAMP((Y-16)*1.164 - 0.391*U - 0.813*V)
<br/>
@ B = CLAMP((Y-16)*1.164 + 2.018*U          )
<br/>
@
<br/>
@ We're going to bend that here as follows:
<br/>
@
<br/>
@ R = CLAMP(y +           1.596*V)
<br/>
@ G = CLAMP(y - 0.383*U - 0.813*V)
<br/>
@ B = CLAMP(y + 1.976*U          )
<br/>
@
<br/>
@ where y = 0               for       Y &lt;=  16,
<br/>
@       y = (  Y-16)*1.164, for  16 &lt; Y &lt;= 239,
<br/>
@       y = (239-16)*1.164, for 239 &lt; Y
<br/>
@
<br/>
@ i.e. We clamp Y to the 16 to 239 range (which it is supposed to be in
<br/>
@ anyway). We then pick the B_U factor so that B never exceeds 511. We then
<br/>
@ shrink the G_U factor in line with that to avoid a colour shift as much as
<br/>
@ possible.
<br/>
@
<br/>
@ We're going to use tables to do it faster, but rather than doing it using
<br/>
@ 5 tables as as the above suggests, we're going to do it using just 3.
<br/>
@
<br/>
@ We do this by working in parallel within a 32 bit word, and using one
<br/>
@ table each for Y U and V.
<br/>
@
<br/>
@ Source Y values are    0 to 255, so    0.. 260 after scaling
<br/>
@ Source U values are -128 to 127, so  -49.. 49(G), -253..251(B) after
<br/>
@ Source V values are -128 to 127, so -204..203(R), -104..103(G) after
<br/>
@
<br/>
@ So total summed values:
<br/>
@ -223 &lt;= R &lt;= 481, -173 &lt;= G &lt;= 431, -253 &lt;= B &lt; 511
<br/>
@
<br/>
@ We need to pack R G and B into a 32 bit word, and because of Bs range we
<br/>
@ need 2 bits above the valid range of B to detect overflow, and another one
<br/>
@ to detect the sense of the overflow. We therefore adopt the following
<br/>
@ representation:
<br/>
@
<br/>
@ osGGGGGgggggosBBBBBbbbosRRRRRrrr
<br/>
@
<br/>
@ Each such word breaks down into 3 ranges.
<br/>
@
<br/>
@ osGGGGGggggg   osBBBBBbbb   osRRRRRrrr
<br/>
@
<br/>
@ Thus we have 8 bits for each B and R table entry, and 10 bits for G (good
<br/>
@ as G is the most noticable one). The s bit for each represents the sign,
<br/>
@ and o represents the overflow.
<br/>
@
<br/>
@ For R and B we pack the table by taking the 11 bit representation of their
<br/>
@ values, and toggling bit 10 in the U and V tables.
<br/>
@
<br/>
@ For the green case we calculate 4*G (thus effectively using 10 bits for the
<br/>
@ valid range) truncate to 12 bits. We toggle bit 11 in the Y table.
<br/>
<br/>
.equ   UV_STRIDE,   192
<br/>
.equ   Y_STRIDE,   384
<br/>
.equ   X_STRIDE,   512
<br/>
.equ   WIDTH,      256
<br/>
<br/>
<br/>
.align
<br/>
.global   yv12_to_rgb555_asm
<br/>
.func   yv12_to_rgb555_asm
<br/>
<br/>
@ void yv12_to_rgb555_asm
<br/>
@  uint8_t * x_ptr
<br/>
@  uint8_t * y_ptr
<br/>
@  uint8_t * u_ptr
<br/>
@  uint8_t * v_ptr
<br/>
@  int height
<br/>
<br/>
yv12_to_rgb555_asm:
<br/>
<br/>
   @ r0 = x_ptr
<br/>
   @ r1 = y_ptr
<br/>
   @ r2 = u_ptr
<br/>
   @ r3 = v_ptr
<br/>
   @ &lt;&gt; = height
<br/>
   STMFD   r13!,{r4-r11,r14}
<br/>
<br/>
   ADR   r8, y_table
<br/>
   LDRB   r14,[r13,#9*4]      @ r14 = height
<br/>
   ADD   r9, r8,#1024   @ u_table
<br/>
   ADD   r10,r9,#1024   @ v_table
<br/>
   LDR   r4, =0x07C07C1F
<br/>
   LDR   r5, =0x40040100
<br/>
yloop:
<br/>
   SUB   r14,r14,#WIDTH&lt;&lt;8   @ r14 = height-(WIDTH&lt;&lt;8)
<br/>
xloop:
<br/>
   LDRB   r11,[r2],#1      @ r11 = u  = *u_ptr++
<br/>
   LDRB   r12,[r3],#1      @ r12 = v  = *v_ptr++
<br/>
   LDRB   r7, [r1, #Y_STRIDE]   @ r7  = y2 = y_ptr[stride]
<br/>
   LDRB   r6, [r1],#1      @ r6  = y0 = *y_ptr++
<br/>
   LDR   r11,[r9, r11,LSL #2]   @ r11 = u  = u_table[u]
<br/>
   LDR   r12,[r10,r12,LSL #2]   @ r12 = v  = v_table[v]
<br/>
   LDR   r7, [r8, r7, LSL #2]   @ r7  = y2 = y_table[y2]
<br/>
   LDR   r6, [r8, r6, LSL #2]   @ r6  = y0 = y_table[y0]
<br/>
   ADD   r11,r11,r12      @ r11 = uv = u+v
<br/>
<br/>
   ADD   r12,r11,r5, LSR #8
<br/>
   ADD   r7, r7,r12      @ r7  = y0 + uv
<br/>
   ADD   r6, r6,r12      @ r6  = y2 + uv
<br/>
   ADD   r6, r6, r5, LSR #7
<br/>
   ANDS   r12, r7, r5
<br/>
   TSTEQ   r6, r5
<br/>
   BNE   fix01
<br/>
return01:
<br/>
   AND   r7, r4, r7, LSR #3
<br/>
   AND   r6, r4, r6, LSR #3
<br/>
   ORR   r7, r7, r7, LSR #17
<br/>
   ORR   r6, r6, r6, LSR #17
<br/>
   ADD   r12,r0, #X_STRIDE
<br/>
   STRH   r7, [r12]
<br/>
   LDRB   r12,[r1, #Y_STRIDE]   @ r12 = y3 = y_ptr[stride]
<br/>
   LDRB   r7, [r1],#1      @ r6  = y1 = *y_ptr++
<br/>
   STRH   r6, [r0],#2
<br/>
<br/>
   LDR   r12,[r8, r12,LSL #2]   @ r7  = y3 = y_table[y2]
<br/>
   LDR   r6, [r8, r7, LSL #2]   @ r6  = y1 = y_table[y0]
<br/>
<br/>
   ADD   r7, r12,r11      @ r7  = y3 + uv
<br/>
   ADD   r6, r6, r11      @ r6  = y1 + uv
<br/>
   ADD   r7, r7, r5, LSR #7
<br/>
   ANDS   r12, r7, r5
<br/>
   TSTEQ   r6, r5
<br/>
   BNE   fix02
<br/>
return02:
<br/>
   AND   r7, r4, r7, LSR #3
<br/>
   AND   r6, r4, r6, LSR #3
<br/>
   ORR   r7, r7, r7, LSR #17
<br/>
   ORR   r6, r6, r6, LSR #17
<br/>
   ADD   r12,r0, #X_STRIDE
<br/>
   STRH   r7, [r12]
<br/>
   STRH   r6, [r0],#2
<br/>
   ADDS   r14,r14,#2&lt;&lt;8
<br/>
   BLT   xloop
<br/>
<br/>
   ADD   r0, r0, #2*X_STRIDE - 2*WIDTH   @ x_ptr to next line
<br/>
   ADD   r1, r1, #2*Y_STRIDE -   WIDTH   @ y_ptr to next line
<br/>
   ADD   r2, r2, #UV_STRIDE - (WIDTH/2)
<br/>
   ADD   r3, r3, #UV_STRIDE - (WIDTH/2)
<br/>
<br/>
   SUBS   r14,r14,#2
<br/>
   BGT   yloop
<br/>
<br/>
   LDMFD   r13!,{r4-r11, pc}
<br/>
fix01:
<br/>
   @ r7 and r6 are the values, at least one of which has overflowed
<br/>
   @ r12 = r7 &amp; mask = .s......s......s......
<br/>
   SUB   r12,r12,r12,LSR #8   @ r12 = ..SSSSSS.SSSSSS.SSSSSS
<br/>
   ORR   r7, r7, r12      @ r7 |= ..SSSSSS.SSSSSS.SSSSSS
<br/>
   BIC   r12,r5, r7, LSR #1   @ r12 = .o......o......o......
<br/>
   ADD   r7, r7, r12,LSR #8   @ r7  = fixed value
<br/>
<br/>
   AND   r12, r6, r5      @ r12 = .S......S......S......
<br/>
   SUB   r12,r12,r12,LSR #8   @ r12 = ..SSSSSS.SSSSSS.SSSSSS
<br/>
   ORR   r6, r6, r12      @ r6 |= ..SSSSSS.SSSSSS.SSSSSS
<br/>
   BIC   r12,r5, r6, LSR #1   @ r12 = .o......o......o......
<br/>
   ADD   r6, r6, r12,LSR #8   @ r6  = fixed value
<br/>
   B   return01
<br/>
fix02:
<br/>
   @ r7 and r6 are the values, at least one of which has overflowed
<br/>
   @ r12 = r7 &amp; mask = .s......s......s......
<br/>
   SUB   r12,r12,r12,LSR #8   @ r12 = ..SSSSSS.SSSSSS.SSSSSS
<br/>
   ORR   r7, r7, r12      @ r7 |= ..SSSSSS.SSSSSS.SSSSSS
<br/>
   BIC   r12,r5, r7, LSR #1   @ r12 = .o......o......o......
<br/>
   ADD   r7, r7, r12,LSR #8   @ r7  = fixed value
<br/>
<br/>
   AND   r12, r6, r5      @ r12 = .S......S......S......
<br/>
   SUB   r12,r12,r12,LSR #8   @ r12 = ..SSSSSS..SSSSS.SSSSSS
<br/>
   ORR   r6, r6, r12      @ r6 |= ..SSSSSS..SSSSS.SSSSSS
<br/>
   BIC   r12,r5, r6, LSR #1   @ r12 = .o......o......o......
<br/>
   ADD   r6, r6, r12,LSR #8   @ r6  = fixed value
<br/>
   B   return02
<br/>
.endfunc
<br/>
.pool
<br/>
<br/>
y_table:
<br/>
        .word 0x7FFFFFED
<br/>
        .word 0x7FFFFFEF
<br/>
        .word 0x7FFFFFF0
<br/>
        .word 0x7FFFFFF1
<br/>
        .word 0x7FFFFFF2
<br/>
        .word 0x7FFFFFF3
<br/>
        .word 0x7FFFFFF4
<br/>
        .word 0x7FFFFFF6
<br/>
        .word 0x7FFFFFF7
<br/>
        .word 0x7FFFFFF8
<br/>
        .word 0x7FFFFFF9
<br/>
        .word 0x7FFFFFFA
<br/>
        .word 0x7FFFFFFB
<br/>
        .word 0x7FFFFFFD
<br/>
        .word 0x7FFFFFFE
<br/>
        .word 0x7FFFFFFF
<br/>
        .word 0x80000000
<br/>
        .word 0x80500401
<br/>
        .word 0x80900802
<br/>
        .word 0x80E00C03
<br/>
        .word 0x81301405
<br/>
        .word 0x81701806
<br/>
        .word 0x81C01C07
<br/>
        .word 0x82102008
<br/>
        .word 0x82502409
<br/>
        .word 0x82A0280A
<br/>
        .word 0x82F0300C
<br/>
        .word 0x8330340D
<br/>
        .word 0x8380380E
<br/>
        .word 0x83D03C0F
<br/>
        .word 0x84104010
<br/>
        .word 0x84604411
<br/>
        .word 0x84A04C13
<br/>
        .word 0x84F05014
<br/>
        .word 0x85405415
<br/>
        .word 0x85805816
<br/>
        .word 0x85D05C17
<br/>
        .word 0x86206018
<br/>
        .word 0x8660681A
<br/>
        .word 0x86B06C1B
<br/>
        .word 0x8700701C
<br/>
        .word 0x8740741D
<br/>
        .word 0x8790781E
<br/>
        .word 0x87E07C1F
<br/>
        .word 0x88208421
<br/>
        .word 0x88708822
<br/>
        .word 0x88C08C23
<br/>
        .word 0x89009024
<br/>
        .word 0x89509425
<br/>
        .word 0x89A09826
<br/>
        .word 0x89E0A028
<br/>
        .word 0x8A30A429
<br/>
        .word 0x8A80A82A
<br/>
        .word 0x8AC0AC2B
<br/>
        .word 0x8B10B02C
<br/>
        .word 0x8B60B42D
<br/>
        .word 0x8BA0BC2F
<br/>
        .word 0x8BF0C030
<br/>
        .word 0x8C40C431
<br/>
        .word 0x8C80C832
<br/>
        .word 0x8CD0CC33
<br/>
        .word 0x8D20D034
<br/>
        .word 0x8D60D836
<br/>
        .word 0x8DB0DC37
<br/>
        .word 0x8DF0E038
<br/>
        .word 0x8E40E439
<br/>
        .word 0x8E90E83A
<br/>
        .word 0x8ED0EC3B
<br/>
        .word 0x8F20F43D
<br/>
        .word 0x8F70F83E
<br/>
        .word 0x8FB0FC3F
<br/>
        .word 0x90010040
<br/>
        .word 0x90510441
<br/>
        .word 0x90910842
<br/>
        .word 0x90E11044
<br/>
        .word 0x91311445
<br/>
        .word 0x91711846
<br/>
        .word 0x91C11C47
<br/>
        .word 0x92112048
<br/>
        .word 0x92512449
<br/>
        .word 0x92A1284A
<br/>
        .word 0x92F1304C
<br/>
        .word 0x9331344D
<br/>
        .word 0x9381384E
<br/>
        .word 0x93D13C4F
<br/>
        .word 0x94114050
<br/>
        .word 0x94614451
<br/>
        .word 0x94B14C53
<br/>
        .word 0x94F15054
<br/>
        .word 0x95415455
<br/>
        .word 0x95915856
<br/>
        .word 0x95D15C57
<br/>
        .word 0x96216058
<br/>
        .word 0x9671685A
<br/>
        .word 0x96B16C5B
<br/>
        .word 0x9701705C
<br/>
        .word 0x9741745D
<br/>
        .word 0x9791785E
<br/>
        .word 0x97E17C5F
<br/>
        .word 0x98218461
<br/>
        .word 0x98718862
<br/>
        .word 0x98C18C63
<br/>
        .word 0x99019064
<br/>
        .word 0x99519465
<br/>
        .word 0x99A19866
<br/>
        .word 0x99E1A068
<br/>
        .word 0x9A31A469
<br/>
        .word 0x9A81A86A
<br/>
        .word 0x9AC1AC6B
<br/>
        .word 0x9B11B06C
<br/>
        .word 0x9B61B46D
<br/>
        .word 0x9BA1BC6F
<br/>
        .word 0x9BF1C070
<br/>
        .word 0x9C41C471
<br/>
        .word 0x9C81C872
<br/>
        .word 0x9CD1CC73
<br/>
        .word 0x9D21D074
<br/>
        .word 0x9D61D876
<br/>
        .word 0x9DB1DC77
<br/>
        .word 0x9E01E078
<br/>
        .word 0x9E41E479
<br/>
        .word 0x9E91E87A
<br/>
        .word 0x9EE1EC7B
<br/>
        .word 0x9F21F47D
<br/>
        .word 0x9F71F87E
<br/>
        .word 0x9FC1FC7F
<br/>
        .word 0xA0020080
<br/>
        .word 0xA0520481
<br/>
        .word 0xA0920882
<br/>
        .word 0xA0E21084
<br/>
        .word 0xA1321485
<br/>
        .word 0xA1721886
<br/>
        .word 0xA1C21C87
<br/>
        .word 0xA2122088
<br/>
        .word 0xA2522489
<br/>
        .word 0xA2A22C8B
<br/>
        .word 0xA2F2308C
<br/>
        .word 0xA332348D
<br/>
        .word 0xA382388E
<br/>
        .word 0xA3D23C8F
<br/>
        .word 0xA4124090
<br/>
        .word 0xA4624892
<br/>
        .word 0xA4B24C93
<br/>
        .word 0xA4F25094
<br/>
        .word 0xA5425495
<br/>
        .word 0xA5925896
<br/>
        .word 0xA5D25C97
<br/>
        .word 0xA6226098
<br/>
        .word 0xA672689A
<br/>
        .word 0xA6B26C9B
<br/>
        .word 0xA702709C
<br/>
        .word 0xA752749D
<br/>
        .word 0xA792789E
<br/>
        .word 0xA7E27C9F
<br/>
        .word 0xA83284A1
<br/>
        .word 0xA87288A2
<br/>
        .word 0xA8C28CA3
<br/>
        .word 0xA90290A4
<br/>
        .word 0xA95294A5
<br/>
        .word 0xA9A298A6
<br/>
        .word 0xA9E2A0A8
<br/>
        .word 0xAA32A4A9
<br/>
        .word 0xAA82A8AA
<br/>
        .word 0xAAC2ACAB
<br/>
        .word 0xAB12B0AC
<br/>
        .word 0xAB62B4AD
<br/>
        .word 0xABA2BCAF
<br/>
        .word 0xABF2C0B0
<br/>
        .word 0xAC42C4B1
<br/>
        .word 0xAC82C8B2
<br/>
        .word 0xACD2CCB3
<br/>
        .word 0xAD22D0B4
<br/>
        .word 0xAD62D8B6
<br/>
        .word 0xADB2DCB7
<br/>
        .word 0xAE02E0B8
<br/>
        .word 0xAE42E4B9
<br/>
        .word 0xAE92E8BA
<br/>
        .word 0xAEE2ECBB
<br/>
        .word 0xAF22F4BD
<br/>
        .word 0xAF72F8BE
<br/>
        .word 0xAFC2FCBF
<br/>
        .word 0xB00300C0
<br/>
        .word 0xB05304C1
<br/>
        .word 0xB0A308C2
<br/>
        .word 0xB0E310C4
<br/>
        .word 0xB13314C5
<br/>
        .word 0xB18318C6
<br/>
        .word 0xB1C31CC7
<br/>
        .word 0xB21320C8
<br/>
        .word 0xB25324C9
<br/>
        .word 0xB2A32CCB
<br/>
        .word 0xB2F330CC
<br/>
        .word 0xB33334CD
<br/>
        .word 0xB38338CE
<br/>
        .word 0xB3D33CCF
<br/>
        .word 0xB41340D0
<br/>
        .word 0xB46348D2
<br/>
        .word 0xB4B34CD3
<br/>
        .word 0xB4F350D4
<br/>
        .word 0xB54354D5
<br/>
        .word 0xB59358D6
<br/>
        .word 0xB5D35CD7
<br/>
        .word 0xB62364D9
<br/>
        .word 0xB67368DA
<br/>
        .word 0xB6B36CDB
<br/>
        .word 0xB70370DC
<br/>
        .word 0xB75374DD
<br/>
        .word 0xB79378DE
<br/>
        .word 0xB7E37CDF
<br/>
        .word 0xB83384E1
<br/>
        .word 0xB87388E2
<br/>
        .word 0xB8C38CE3
<br/>
        .word 0xB91390E4
<br/>
        .word 0xB95394E5
<br/>
        .word 0xB9A398E6
<br/>
        .word 0xB9F3A0E8
<br/>
        .word 0xBA33A4E9
<br/>
        .word 0xBA83A8EA
<br/>
        .word 0xBAD3ACEB
<br/>
        .word 0xBB13B0EC
<br/>
        .word 0xBB63B4ED
<br/>
        .word 0xBBA3BCEF
<br/>
        .word 0xBBF3C0F0
<br/>
        .word 0xBC43C4F1
<br/>
        .word 0xBC83C8F2
<br/>
        .word 0xBCD3CCF3
<br/>
        .word 0xBD23D0F4
<br/>
        .word 0xBD63D8F6
<br/>
        .word 0xBDB3DCF7
<br/>
        .word 0xBE03E0F8
<br/>
        .word 0xBE43E4F9
<br/>
        .word 0xBE93E8FA
<br/>
        .word 0xBEE3ECFB
<br/>
        .word 0xBF23F4FD
<br/>
        .word 0xBF73F8FE
<br/>
        .word 0xBFC3FCFF
<br/>
        .word 0xC0040100
<br/>
        .word 0xC0540501
<br/>
        .word 0xC0A40902
<br/>
        .word 0xC0E41104
<br/>
        .word 0xC0E41104
<br/>
        .word 0xC0E41104
<br/>
        .word 0xC0E41104
<br/>
        .word 0xC0E41104
<br/>
        .word 0xC0E41104
<br/>
        .word 0xC0E41104
<br/>
        .word 0xC0E41104
<br/>
        .word 0xC0E41104
<br/>
        .word 0xC0E41104
<br/>
        .word 0xC0E41104
<br/>
        .word 0xC0E41104
<br/>
        .word 0xC0E41104
<br/>
        .word 0xC0E41104
<br/>
        .word 0xC0E41104
<br/>
        .word 0xC0E41104
<br/>
        .word 0xC0E41104
<br/>
u_table:
<br/>
        .word 0x0C440C00
<br/>
        .word 0x0C341400
<br/>
        .word 0x0C141C00
<br/>
        .word 0x0C042400
<br/>
        .word 0x0BE42C00
<br/>
        .word 0x0BC43400
<br/>
        .word 0x0BB43C00
<br/>
        .word 0x0B944400
<br/>
        .word 0x0B844C00
<br/>
        .word 0x0B645400
<br/>
        .word 0x0B545C00
<br/>
        .word 0x0B346400
<br/>
        .word 0x0B246C00
<br/>
        .word 0x0B047400
<br/>
        .word 0x0AF47C00
<br/>
        .word 0x0AD48400
<br/>
        .word 0x0AC48C00
<br/>
        .word 0x0AA49400
<br/>
        .word 0x0A949C00
<br/>
        .word 0x0A74A400
<br/>
        .word 0x0A54AC00
<br/>
        .word 0x0A44B400
<br/>
        .word 0x0A24BC00
<br/>
        .word 0x0A14C400
<br/>
        .word 0x09F4C800
<br/>
        .word 0x09E4D000
<br/>
        .word 0x09C4D800
<br/>
        .word 0x09B4E000
<br/>
        .word 0x0994E800
<br/>
        .word 0x0984F000
<br/>
        .word 0x0964F800
<br/>
        .word 0x09550000
<br/>
        .word 0x09350800
<br/>
        .word 0x09251000
<br/>
        .word 0x09051800
<br/>
        .word 0x08E52000
<br/>
        .word 0x08D52800
<br/>
        .word 0x08B53000
<br/>
        .word 0x08A53800
<br/>
        .word 0x08854000
<br/>
        .word 0x08754800
<br/>
        .word 0x08555000
<br/>
        .word 0x08455800
<br/>
        .word 0x08256000
<br/>
        .word 0x08156800
<br/>
        .word 0x07F57000
<br/>
        .word 0x07E57800
<br/>
        .word 0x07C58000
<br/>
        .word 0x07B58800
<br/>
        .word 0x07959000
<br/>
        .word 0x07759800
<br/>
        .word 0x0765A000
<br/>
        .word 0x0745A800
<br/>
        .word 0x0735B000
<br/>
        .word 0x0715B800
<br/>
        .word 0x0705C000
<br/>
        .word 0x06E5C800
<br/>
        .word 0x06D5D000
<br/>
        .word 0x06B5D800
<br/>
        .word 0x06A5E000
<br/>
        .word 0x0685E800
<br/>
        .word 0x0675F000
<br/>
        .word 0x0655F800
<br/>
        .word 0x06460000
<br/>
        .word 0x06260800
<br/>
        .word 0x06161000
<br/>
        .word 0x05F61400
<br/>
        .word 0x05D61C00
<br/>
        .word 0x05C62400
<br/>
        .word 0x05A62C00
<br/>
        .word 0x05963400
<br/>
        .word 0x05763C00
<br/>
        .word 0x05664400
<br/>
        .word 0x05464C00
<br/>
        .word 0x05365400
<br/>
        .word 0x05165C00
<br/>
        .word 0x05066400
<br/>
        .word 0x04E66C00
<br/>
        .word 0x04D67400
<br/>
        .word 0x04B67C00
<br/>
        .word 0x04A68400
<br/>
        .word 0x04868C00
<br/>
        .word 0x04669400
<br/>
        .word 0x04569C00
<br/>
        .word 0x0436A400
<br/>
        .word 0x0426AC00
<br/>
        .word 0x0406B400
<br/>
        .word 0x03F6BC00
<br/>
        .word 0x03D6C400
<br/>
        .word 0x03C6CC00
<br/>
        .word 0x03A6D400
<br/>
        .word 0x0396DC00
<br/>
        .word 0x0376E400
<br/>
        .word 0x0366EC00
<br/>
        .word 0x0346F400
<br/>
        .word 0x0336FC00
<br/>
        .word 0x03170400
<br/>
        .word 0x02F70C00
<br/>
        .word 0x02E71400
<br/>
        .word 0x02C71C00
<br/>
        .word 0x02B72400
<br/>
        .word 0x02972C00
<br/>
        .word 0x02873400
<br/>
        .word 0x02673C00
<br/>
        .word 0x02574400
<br/>
        .word 0x02374C00
<br/>
        .word 0x02275400
<br/>
        .word 0x02075C00
<br/>
        .word 0x01F76000
<br/>
        .word 0x01D76800
<br/>
        .word 0x01C77000
<br/>
        .word 0x01A77800
<br/>
        .word 0x01978000
<br/>
        .word 0x01778800
<br/>
        .word 0x01579000
<br/>
        .word 0x01479800
<br/>
        .word 0x0127A000
<br/>
        .word 0x0117A800
<br/>
        .word 0x00F7B000
<br/>
        .word 0x00E7B800
<br/>
        .word 0x00C7C000
<br/>
        .word 0x00B7C800
<br/>
        .word 0x0097D000
<br/>
        .word 0x0087D800
<br/>
        .word 0x0067E000
<br/>
        .word 0x0057E800
<br/>
        .word 0x0037F000
<br/>
        .word 0x0027F800
<br/>
        .word 0x00080000
<br/>
        .word 0xFFE80800
<br/>
        .word 0xFFD81000
<br/>
        .word 0xFFB81800
<br/>
        .word 0xFFA82000
<br/>
        .word 0xFF882800
<br/>
        .word 0xFF783000
<br/>
        .word 0xFF583800
<br/>
        .word 0xFF484000
<br/>
        .word 0xFF284800
<br/>
        .word 0xFF185000
<br/>
        .word 0xFEF85800
<br/>
        .word 0xFEE86000
<br/>
        .word 0xFEC86800
<br/>
        .word 0xFEB87000
<br/>
        .word 0xFE987800
<br/>
        .word 0xFE788000
<br/>
        .word 0xFE688800
<br/>
        .word 0xFE489000
<br/>
        .word 0xFE389800
<br/>
        .word 0xFE18A000
<br/>
        .word 0xFE08A400
<br/>
        .word 0xFDE8AC00
<br/>
        .word 0xFDD8B400
<br/>
        .word 0xFDB8BC00
<br/>
        .word 0xFDA8C400
<br/>
        .word 0xFD88CC00
<br/>
        .word 0xFD78D400
<br/>
        .word 0xFD58DC00
<br/>
        .word 0xFD48E400
<br/>
        .word 0xFD28EC00
<br/>
        .word 0xFD18F400
<br/>
        .word 0xFCF8FC00
<br/>
        .word 0xFCD90400
<br/>
        .word 0xFCC90C00
<br/>
        .word 0xFCA91400
<br/>
        .word 0xFC991C00
<br/>
        .word 0xFC792400
<br/>
        .word 0xFC692C00
<br/>
        .word 0xFC493400
<br/>
        .word 0xFC393C00
<br/>
        .word 0xFC194400
<br/>
        .word 0xFC094C00
<br/>
        .word 0xFBE95400
<br/>
        .word 0xFBD95C00
<br/>
        .word 0xFBB96400
<br/>
        .word 0xFBA96C00
<br/>
        .word 0xFB897400
<br/>
        .word 0xFB697C00
<br/>
        .word 0xFB598400
<br/>
        .word 0xFB398C00
<br/>
        .word 0xFB299400
<br/>
        .word 0xFB099C00
<br/>
        .word 0xFAF9A400
<br/>
        .word 0xFAD9AC00
<br/>
        .word 0xFAC9B400
<br/>
        .word 0xFAA9BC00
<br/>
        .word 0xFA99C400
<br/>
        .word 0xFA79CC00
<br/>
        .word 0xFA69D400
<br/>
        .word 0xFA49DC00
<br/>
        .word 0xFA39E400
<br/>
        .word 0xFA19EC00
<br/>
        .word 0xF9F9F000
<br/>
        .word 0xF9E9F800
<br/>
        .word 0xF9CA0000
<br/>
        .word 0xF9BA0800
<br/>
        .word 0xF99A1000
<br/>
        .word 0xF98A1800
<br/>
        .word 0xF96A2000
<br/>
        .word 0xF95A2800
<br/>
        .word 0xF93A3000
<br/>
        .word 0xF92A3800
<br/>
        .word 0xF90A4000
<br/>
        .word 0xF8FA4800
<br/>
        .word 0xF8DA5000
<br/>
        .word 0xF8CA5800
<br/>
        .word 0xF8AA6000
<br/>
        .word 0xF89A6800
<br/>
        .word 0xF87A7000
<br/>
        .word 0xF85A7800
<br/>
        .word 0xF84A8000
<br/>
        .word 0xF82A8800
<br/>
        .word 0xF81A9000
<br/>
        .word 0xF7FA9800
<br/>
        .word 0xF7EAA000
<br/>
        .word 0xF7CAA800
<br/>
        .word 0xF7BAB000
<br/>
        .word 0xF79AB800
<br/>
        .word 0xF78AC000
<br/>
        .word 0xF76AC800
<br/>
        .word 0xF75AD000
<br/>
        .word 0xF73AD800
<br/>
        .word 0xF72AE000
<br/>
        .word 0xF70AE800
<br/>
        .word 0xF6EAF000
<br/>
        .word 0xF6DAF800
<br/>
        .word 0xF6BB0000
<br/>
        .word 0xF6AB0800
<br/>
        .word 0xF68B1000
<br/>
        .word 0xF67B1800
<br/>
        .word 0xF65B2000
<br/>
        .word 0xF64B2800
<br/>
        .word 0xF62B3000
<br/>
        .word 0xF61B3800
<br/>
        .word 0xF5FB3C00
<br/>
        .word 0xF5EB4400
<br/>
        .word 0xF5CB4C00
<br/>
        .word 0xF5BB5400
<br/>
        .word 0xF59B5C00
<br/>
        .word 0xF57B6400
<br/>
        .word 0xF56B6C00
<br/>
        .word 0xF54B7400
<br/>
        .word 0xF53B7C00
<br/>
        .word 0xF51B8400
<br/>
        .word 0xF50B8C00
<br/>
        .word 0xF4EB9400
<br/>
        .word 0xF4DB9C00
<br/>
        .word 0xF4BBA400
<br/>
        .word 0xF4ABAC00
<br/>
        .word 0xF48BB400
<br/>
        .word 0xF47BBC00
<br/>
        .word 0xF45BC400
<br/>
        .word 0xF44BCC00
<br/>
        .word 0xF42BD400
<br/>
        .word 0xF41BDC00
<br/>
        .word 0xF3FBE400
<br/>
        .word 0xF3DBEC00
<br/>
v_table:
<br/>
        .word 0x1A000134
<br/>
        .word 0x19D00135
<br/>
        .word 0x19A00137
<br/>
        .word 0x19700139
<br/>
        .word 0x1930013A
<br/>
        .word 0x1900013C
<br/>
        .word 0x18D0013D
<br/>
        .word 0x1890013F
<br/>
        .word 0x18600140
<br/>
        .word 0x18300142
<br/>
        .word 0x18000144
<br/>
        .word 0x17C00145
<br/>
        .word 0x17900147
<br/>
        .word 0x17600148
<br/>
        .word 0x1730014A
<br/>
        .word 0x16F0014C
<br/>
        .word 0x16C0014D
<br/>
        .word 0x1690014F
<br/>
        .word 0x16600150
<br/>
        .word 0x16200152
<br/>
        .word 0x15F00154
<br/>
        .word 0x15C00155
<br/>
        .word 0x15900157
<br/>
        .word 0x15500158
<br/>
        .word 0x1520015A
<br/>
        .word 0x14F0015C
<br/>
        .word 0x14C0015D
<br/>
        .word 0x1480015F
<br/>
        .word 0x14500160
<br/>
        .word 0x14200162
<br/>
        .word 0x13F00164
<br/>
        .word 0x13B00165
<br/>
        .word 0x13800167
<br/>
        .word 0x13500168
<br/>
        .word 0x1320016A
<br/>
        .word 0x12E0016C
<br/>
        .word 0x12B0016D
<br/>
        .word 0x1280016F
<br/>
        .word 0x12500170
<br/>
        .word 0x12100172
<br/>
        .word 0x11E00174
<br/>
        .word 0x11B00175
<br/>
        .word 0x11800177
<br/>
        .word 0x11400178
<br/>
        .word 0x1110017A
<br/>
        .word 0x10E0017C
<br/>
        .word 0x10B0017D
<br/>
        .word 0x1070017F
<br/>
        .word 0x10400180
<br/>
        .word 0x10100182
<br/>
        .word 0x0FE00184
<br/>
        .word 0x0FA00185
<br/>
        .word 0x0F700187
<br/>
        .word 0x0F400188
<br/>
        .word 0x0F10018A
<br/>
        .word 0x0ED0018B
<br/>
        .word 0x0EA0018D
<br/>
        .word 0x0E70018F
<br/>
        .word 0x0E400190
<br/>
        .word 0x0E000192
<br/>
        .word 0x0DD00193
<br/>
        .word 0x0DA00195
<br/>
        .word 0x0D700197
<br/>
        .word 0x0D300198
<br/>
        .word 0x0D00019A
<br/>
        .word 0x0CD0019B
<br/>
        .word 0x0CA0019D
<br/>
        .word 0x0C60019F
<br/>
        .word 0x0C3001A0
<br/>
        .word 0x0C0001A2
<br/>
        .word 0x0BD001A3
<br/>
        .word 0x0B9001A5
<br/>
        .word 0x0B6001A7
<br/>
        .word 0x0B3001A8
<br/>
        .word 0x0B0001AA
<br/>
        .word 0x0AC001AB
<br/>
        .word 0x0A9001AD
<br/>
        .word 0x0A6001AF
<br/>
        .word 0x0A3001B0
<br/>
        .word 0x09F001B2
<br/>
        .word 0x09C001B3
<br/>
        .word 0x099001B5
<br/>
        .word 0x096001B7
<br/>
        .word 0x092001B8
<br/>
        .word 0x08F001BA
<br/>
        .word 0x08C001BB
<br/>
        .word 0x089001BD
<br/>
        .word 0x085001BF
<br/>
        .word 0x082001C0
<br/>
        .word 0x07F001C2
<br/>
        .word 0x07C001C3
<br/>
        .word 0x078001C5
<br/>
        .word 0x075001C7
<br/>
        .word 0x072001C8
<br/>
        .word 0x06F001CA
<br/>
        .word 0x06B001CB
<br/>
        .word 0x068001CD
<br/>
        .word 0x065001CF
<br/>
        .word 0x062001D0
<br/>
        .word 0x05E001D2
<br/>
        .word 0x05B001D3
<br/>
        .word 0x058001D5
<br/>
        .word 0x055001D7
<br/>
        .word 0x051001D8
<br/>
        .word 0x04E001DA
<br/>
        .word 0x04B001DB
<br/>
        .word 0x048001DD
<br/>
        .word 0x044001DE
<br/>
        .word 0x041001E0
<br/>
        .word 0x03E001E2
<br/>
        .word 0x03B001E3
<br/>
        .word 0x037001E5
<br/>
        .word 0x034001E6
<br/>
        .word 0x031001E8
<br/>
        .word 0x02E001EA
<br/>
        .word 0x02A001EB
<br/>
        .word 0x027001ED
<br/>
        .word 0x024001EE
<br/>
        .word 0x021001F0
<br/>
        .word 0x01D001F2
<br/>
        .word 0x01A001F3
<br/>
        .word 0x017001F5
<br/>
        .word 0x014001F6
<br/>
        .word 0x010001F8
<br/>
        .word 0x00D001FA
<br/>
        .word 0x00A001FB
<br/>
        .word 0x007001FD
<br/>
        .word 0x003001FE
<br/>
        .word 0x00000200
<br/>
        .word 0xFFD00202
<br/>
        .word 0xFF900203
<br/>
        .word 0xFF600205
<br/>
        .word 0xFF300206
<br/>
        .word 0xFF000208
<br/>
        .word 0xFEC0020A
<br/>
        .word 0xFE90020B
<br/>
        .word 0xFE60020D
<br/>
        .word 0xFE30020E
<br/>
        .word 0xFDF00210
<br/>
        .word 0xFDC00212
<br/>
        .word 0xFD900213
<br/>
        .word 0xFD600215
<br/>
        .word 0xFD200216
<br/>
        .word 0xFCF00218
<br/>
        .word 0xFCC0021A
<br/>
        .word 0xFC90021B
<br/>
        .word 0xFC50021D
<br/>
        .word 0xFC20021E
<br/>
        .word 0xFBF00220
<br/>
        .word 0xFBC00222
<br/>
        .word 0xFB800223
<br/>
        .word 0xFB500225
<br/>
        .word 0xFB200226
<br/>
        .word 0xFAF00228
<br/>
        .word 0xFAB00229
<br/>
        .word 0xFA80022B
<br/>
        .word 0xFA50022D
<br/>
        .word 0xFA20022E
<br/>
        .word 0xF9E00230
<br/>
        .word 0xF9B00231
<br/>
        .word 0xF9800233
<br/>
        .word 0xF9500235
<br/>
        .word 0xF9100236
<br/>
        .word 0xF8E00238
<br/>
        .word 0xF8B00239
<br/>
        .word 0xF880023B
<br/>
        .word 0xF840023D
<br/>
        .word 0xF810023E
<br/>
        .word 0xF7E00240
<br/>
        .word 0xF7B00241
<br/>
        .word 0xF7700243
<br/>
        .word 0xF7400245
<br/>
        .word 0xF7100246
<br/>
        .word 0xF6E00248
<br/>
        .word 0xF6A00249
<br/>
        .word 0xF670024B
<br/>
        .word 0xF640024D
<br/>
        .word 0xF610024E
<br/>
        .word 0xF5D00250
<br/>
        .word 0xF5A00251
<br/>
        .word 0xF5700253
<br/>
        .word 0xF5400255
<br/>
        .word 0xF5000256
<br/>
        .word 0xF4D00258
<br/>
        .word 0xF4A00259
<br/>
        .word 0xF470025B
<br/>
        .word 0xF430025D
<br/>
        .word 0xF400025E
<br/>
        .word 0xF3D00260
<br/>
        .word 0xF3A00261
<br/>
        .word 0xF3600263
<br/>
        .word 0xF3300265
<br/>
        .word 0xF3000266
<br/>
        .word 0xF2D00268
<br/>
        .word 0xF2900269
<br/>
        .word 0xF260026B
<br/>
        .word 0xF230026D
<br/>
        .word 0xF200026E
<br/>
        .word 0xF1C00270
<br/>
        .word 0xF1900271
<br/>
        .word 0xF1600273
<br/>
        .word 0xF1300275
<br/>
        .word 0xF0F00276
<br/>
        .word 0xF0C00278
<br/>
        .word 0xF0900279
<br/>
        .word 0xF060027B
<br/>
        .word 0xF020027C
<br/>
        .word 0xEFF0027E
<br/>
        .word 0xEFC00280
<br/>
        .word 0xEF900281
<br/>
        .word 0xEF500283
<br/>
        .word 0xEF200284
<br/>
        .word 0xEEF00286
<br/>
        .word 0xEEC00288
<br/>
        .word 0xEE800289
<br/>
        .word 0xEE50028B
<br/>
        .word 0xEE20028C
<br/>
        .word 0xEDF0028E
<br/>
        .word 0xEDB00290
<br/>
        .word 0xED800291
<br/>
        .word 0xED500293
<br/>
        .word 0xED200294
<br/>
        .word 0xECE00296
<br/>
        .word 0xECB00298
<br/>
        .word 0xEC800299
<br/>
        .word 0xEC50029B
<br/>
        .word 0xEC10029C
<br/>
        .word 0xEBE0029E
<br/>
        .word 0xEBB002A0
<br/>
        .word 0xEB8002A1
<br/>
        .word 0xEB4002A3
<br/>
        .word 0xEB1002A4
<br/>
        .word 0xEAE002A6
<br/>
        .word 0xEAB002A8
<br/>
        .word 0xEA7002A9
<br/>
        .word 0xEA4002AB
<br/>
        .word 0xEA1002AC
<br/>
        .word 0xE9E002AE
<br/>
        .word 0xE9A002B0
<br/>
        .word 0xE97002B1
<br/>
        .word 0xE94002B3
<br/>
        .word 0xE91002B4
<br/>
        .word 0xE8D002B6
<br/>
        .word 0xE8A002B8
<br/>
        .word 0xE87002B9
<br/>
        .word 0xE84002BB
<br/>
        .word 0xE80002BC
<br/>
        .word 0xE7D002BE
<br/>
        .word 0xE7A002C0
<br/>
        .word 0xE77002C1
<br/>
        .word 0xE73002C3
<br/>
        .word 0xE70002C4
<br/>
        .word 0xE6D002C6
<br/>
        .word 0xE6A002C8
<br/>
        .word 0xE66002C9
<br/>
        .word 0xE63002CB
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Robin</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#158433 - Maxxie - Wed Jun 11, 2008 2:06 pm</h4>
    <div class="postbody"><span class="postbody">I have measured Chishm's and Robin's last code.
<br/>
Setup was: 256x192, Y,U and V buffers were set to start at 0x02000000 to have some pseudorandom (opcodes) but constant data, output buffer was a 4 byte aligned malloced block
<br/>
<br/>
Tested 100 runs and middled the measurement. (33MHz cycles)
<br/>
<br/>
Chishm's: 1 279 959 
<br/>
Robin's: 393 571 
<br/>
<br/>
Both measurements include the very same calling instructions (Push &amp; copy of arguments, pop afterwards)
<br/>
<br/>
( <a href="http://www.speedshare.org/download.php?id=3A61C0113" target="_blank">http://www.speedshare.org/download.php?id=3A61C0113</a> )</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#158449 - Miked0801 - Wed Jun 11, 2008 6:27 pm</h4>
    <div class="postbody"><span class="postbody">x3 is pretty dang good :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#158481 - Doom5 - Thu Jun 12, 2008 3:16 am</h4>
    <div class="postbody"><span class="postbody">I wonder how much of a performance impact this this code would have on  tuna-viDS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#158537 - RobinWatts - Fri Jun 13, 2008 1:09 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Maxxie wrote:</b></span></td> </tr> <tr> <td class="quote">I have measured Chishm's and Robin's last code.
<br/>
Setup was: 256x192, Y,U and V buffers were set to start at 0x02000000 to have some pseudorandom (opcodes) but constant data, output buffer was a 4 byte aligned malloced block</td> </tr></table><span class="postbody">
<br/>
<br/>
To get a true timing for my code you should really test it with real world data, as the timings will vary according to what proportion of the values over/underflow (normally &lt; 10%).
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Tested 100 runs and middled the measurement. (33MHz cycles)
<br/>
<br/>
Chishm's: 1 279 959 
<br/>
Robin's: 393 571 
<br/>
<br/>
Both measurements include the very same calling instructions (Push &amp; copy of arguments, pop afterwards)</td> </tr></table><span class="postbody">
<br/>
<br/>
That's brilliant - exactly the kind of thing to make me smile on my holiday.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Doom5 wrote:</b></span></td> </tr> <tr> <td class="quote">I wonder how much of a performance impact this this code would have on tuna-viDS.</td> </tr></table><span class="postbody">
<br/>
<br/>
Dunno what proportion of the runtime this takes. I had a quick look through the source before I came away, and there is definate scope for more ARM coding of sections of the code. (No disrespect to Chishm here - he's done the hard part in making it work at all!)
<br/>
<br/>
Any hints on profiling the code to find out where I should be spending my time would be much appreciated.
<br/>
<br/>
I'll try to look into it some more when I get back.
<br/>
<br/>
TTFN,
<br/>
<br/>
Robin (In a hotel business centre in Ecuador)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#158541 - tepples - Fri Jun 13, 2008 3:43 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>RobinWatts wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Tested 100 runs and middled the measurement. (33MHz cycles)
<br/>
<br/>
Chishm's: 1 279 959 
<br/>
Robin's: 393 571 
<br/>
<br/>
Both measurements include the very same calling instructions (Push &amp; copy of arguments, pop afterwards)</td> </tr></table><span class="postbody">
<br/>
That's brilliant - exactly the kind of thing to make me smile on my holiday.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Doom5 wrote:</b></span></td> </tr> <tr> <td class="quote">I wonder how much of a performance impact this this code would have on tuna-viDS.</td> </tr></table><span class="postbody">
<br/>
Dunno what proportion of the runtime this takes.</span></td> </tr></table><span class="postbody">
<br/>
There are 560,190 ARM7 cycles between vblanks. A 12 fps video takes 5 vblanks or 2,800,950 cycles to present a new frame. So Chishm's YUV decoder takes 45.7% CPU while yours takes 14.1%.
<br/>
<br/>
Another angle: If we aren't trying to necessarily be compatible with unconverted video downloaded from the Internet, wouldn't it be faster to decode video that has been encoded using Y = (R + G) / 2 instead of the standard formula, which is closer to Y = (3R + 6G + B) / 10?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#158546 - Lazy1 - Fri Jun 13, 2008 5:59 am</h4>
    <div class="postbody"><span class="postbody">Cool, I'll have to see if your code will allow me to consistently get &gt; 15FPS with libmpeg2.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#158556 - Maxxie - Fri Jun 13, 2008 12:14 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>RobinWatts wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Maxxie wrote:</b></span></td> </tr> <tr> <td class="quote">I have measured Chishm's and Robin's last code.
<br/>
Setup was: 256x192, Y,U and V buffers were set to start at 0x02000000 to have some pseudorandom (opcodes) but constant data, output buffer was a 4 byte aligned malloced block</td> </tr></table><span class="postbody">
<br/>
<br/>
To get a true timing for my code you should really test it with real world data, as the timings will vary according to what proportion of the values over/underflow (normally &lt; 10%).
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Yes i know, i had no YUV image at hand. If you got a testscreen i'd be happy to use it instead, and have the functions operate to output to a vram bank (That will reduce the speed of bost measurements)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#158559 - RobinWatts - Fri Jun 13, 2008 1:36 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Another angle: If we aren't trying to necessarily be compatible with unconverted video downloaded from the Internet, wouldn't it be faster to decode video that has been encoded using Y = (R + G) / 2 instead of the standard formula, which is closer to Y = (3R + 6G + B) / 10?</td> </tr></table><span class="postbody">
<br/>
<br/>
Nah, the exact weightings used are buried in the tables, so it'd just be different values.
<br/>
<br/>
(Unless it caused a significant difference in the number of values that over/under flowed).
<br/>
<br/>
There is scope, if we put the table generation code into the app, to get brightness/contrast/colour/gamma adjustments for free.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lazy1 wrote:</b></span></td> </tr> <tr> <td class="quote">Cool, I'll have to see if your code will allow me to consistently get &gt; 15FPS with libmpeg2.</td> </tr></table><span class="postbody">
<br/>
<br/>
I encoded various things at 12.5fps, and they seem fine. Didn't have time to experiment with different bitrates etc :(
<br/>
<br/>
If LibMPEG2 uses different weights for Cr/Cb etc, let me know what they are, and I'll generate proper tables when I get home.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Maxxie wrote:</b></span></td> </tr> <tr> <td class="quote">Yes i know, i had no YUV image at hand. If you got a testscreen i'd be happy to use it instead, and have the functions operate to output to a vram bank (That will reduce the speed of both measurements)</td> </tr></table><span class="postbody">
<br/>
<br/>
I don't have one to hand... but I'll try and generate one when I get home (I'll try and save out a frame or two from the conversion code).
<br/>
<br/>
Robin</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#158819 - tonysavon - Wed Jun 18, 2008 5:24 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>RobinWatts wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<br/>
Nah, the exact weightings used are buried in the tables, so it'd just be different values.
<br/>
<br/>
(Unless it caused a significant difference in the number of values that over/under flowed).
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
For certain matrices you could not be needing tables at all. For instance, early codecs like Cinepack use a different yuv-&gt;rgb conversion scheme
<br/>
<br/>
   | r |     | 1.0  0.0  2.0 | | y |
<br/>
   | g | = | 1.0 -0.5 -1.0 | | u |
<br/>
   | b |    | 1.0  2.0  0.0 | | v |
<br/>
<br/>
Taking the inverse of the 3x3 matrix gives you:
<br/>
<br/>
   | y |    |  0.2857  0.5714  0.1429 | | r |
<br/>
   | u | = | -0.1429 -0.2857  0.4286 | | g |
<br/>
   | v |    |  0.3571 -0.2857 -0.0714 | | b |
<br/>
<br/>
The first matrix is preatty easy to handle, as the RGB values can be computed from the YUV by means of shifts and sums.
<br/>
Quality can be debatable to purists in certain environments (although Cinepack has been succesful for a decade on our PCs), but sticking to this conversion scheme produces no visible degradation on DS screen IMHO. Of course this requires video to be encoded with this custom rgb-&gt;yuv conversion process, which forces you to write your own encoder.
<br/>
Nevertheless, after some quick tests I've done, even with video which has been created with the classic RGB-&gt;YUV conversion matrix, converting back to RGB with the above color scheme instead of the classic one, still gives you "acceptable" results.
<br/>
<br/>
It's yet to check if a valid asm implementation of this method could beat Robin's impressive piece of code though.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#158828 - RobinWatts - Thu Jun 19, 2008 12:18 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tonysavon wrote:</b></span></td> </tr> <tr> <td class="quote">For certain matrices you could not be needing tables at all. For instance, early codecs like Cinepack use a different yuv-&gt;rgb conversion scheme
<br/>
<br/>
   | r |     | 1.0  0.0  2.0 | | y |
<br/>
   | g | = | 1.0 -0.5 -1.0 | | u |
<br/>
   | b |    | 1.0  2.0  0.0 | | v |
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Really? I don?t remember that from my dealings with cinepak, but I?ll take your word for it.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">The first matrix is pretty easy to handle, as the RGB values can be computed from the YUV by means of shifts and sums.</td> </tr></table><span class="postbody">
<br/>
<br/>
Sure. So you?d:
<br/>
<br/>
 Load U
<br/>
 Load V
<br/>
 minus_guv_up1 = (V&gt;&gt;1)-U
<br/>
 Load Y0
<br/>
 R0 = Y0 +(V&lt;&lt;1)
<br/>
 G0 = Y0 - (minus_guv_up1&gt;&gt;1)
<br/>
 B0 = Y0 +(U&lt;&lt;1)
<br/>
 CLAMP(R0) 
<br/>
 CLAMP(G0) 
<br/>
 CLAMP(B0)
<br/>
 COMBINE(R0,G0,B0) 
<br/>
 store Y0
<br/>
 (rinse and repeat for Y1, Y2, Y3)
<br/>
<br/>
Each line of the above corresponds 1 ARM instruction (more in the case of CLAMP and COMBINE)
<br/>
<br/>
So thats 3 + 4*5 = 23 instructions, plus clamping and combining, for each group of 4 Y?s.
<br/>
<br/>
Let?s be generous and assume we can do CLAMPS in 1 and COMBINEs in 2, and that?s another 4*5 = 20 cycles, so 43 overall. (Actually, that?s probably insanely generous).
<br/>
<br/>
(If we can find a way to do all the maths in the top bytes of the words, we can do the funky saturated maths trick, so the clamps can be done in 2 cycles, but I suspect it?ll cost us another cycle per component to get them up there. Combine takes 5 then. So 4*(9+5) = 56, so 79 overall.)
<br/>
<br/>
The real figure is probably somewhere nearer the higher, unless there are some funky ARM5 or later instructions we can use.
<br/>
<br/>
The table based approach takes 40ish (3 of which are for dithering) (but that just detects overflows/underflows inline and jumps out to code that fixes it (potentially another 20 instructions, but run only a small percentage of the time).
<br/>
<br/>
It?s a very clever algorithm, and one which I can?t take credit for; the idea of sticking everything in the tables, using bit operations to spot the overflow/underflow and jumping out to fix it (and the initial implementation) is down to Sophie Wilson. Paul Gardiner found the fastest way of doing the fixup code (so fast, that if you expect many things to overflow, you may be best just doing the fixup in line every time). I?ve squeezed a couple of cycles here and there, but in all honesty credit lies with Sophie.
<br/>
<br/>
The fact that you can just vary the tables to vary the matrix used, as well as brightness/gamma/colour/contrast etc is just icing on the cake.
<br/>
<br/>
Robin</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#159515 - chishm - Wed Jul 02, 2008 4:48 am</h4>
    <div class="postbody"><span class="postbody">RobinWatts:
<br/>
Very nice! I tried it on my standard test video. The old code (that I posted here) achieved 14.1fps on average. Your code achieved 15.6fps on average. The output doesn't appear noticeably worse either, so I'll be using your colour space converter in the next release.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#159529 - RobinWatts - Wed Jul 02, 2008 11:40 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote">RobinWatts:
<br/>
Very nice! I tried it on my standard test video. The old code (that I posted here) achieved 14.1fps on average. Your code achieved 15.6fps on average. The output doesn't appear noticeably worse either, so I'll be using your colour space converter in the next release.</td> </tr></table><span class="postbody">
<br/>
<br/>
Cool. I'd like to think that the output should actually look better, with the dithering in it?
<br/>
<br/>
I'm just about recovered from the jetlag, so I'll try to look into some table generation code this weekend; are you interested in gamma/brightness/contrast/colour controls?
<br/>
<br/>
Robin</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#159551 - chishm - Wed Jul 02, 2008 3:13 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>RobinWatts wrote:</b></span></td> </tr> <tr> <td class="quote">Cool. I'd like to think that the output should actually look better, with the dithering in it?</td> </tr></table><span class="postbody">
<br/>
Most things (like shaded gradients in a cartoon) look better. The only thing I've notice that looks worse is in hard edges, like on text.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>RobinWatts wrote:</b></span></td> </tr> <tr> <td class="quote">I'm just about recovered from the jetlag, so I'll try to look into some table generation code this weekend; are you interested in gamma/brightness/contrast/colour controls?</td> </tr></table><span class="postbody">
<br/>
Definitely.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
