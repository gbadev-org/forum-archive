<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>displaylist working on Emulator but not in hardware - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > displaylist working on Emulator but not in hardware</h2>
<div id="posts">
<div class="post">
    <h4>#129406 - a128 - Tue May 22, 2007 3:38 pm</h4>
    <div class="postbody"><span class="postbody">Hi! 
<br/>
<br/>
I write a displaylist converter for 3ds files....the displaylists shows up
<br/>
on no$gba 2.4a emulator and Ideas 1.0.5 
<br/>
<br/>
it does not show up on DS hardware 
<br/>
<br/>
I have no clue why ?
<br/>
<br/>
I use VERTEX16 and also scale the model down to -8....+8 if some verts are &gt;+-8
<br/>
<br/>
I also optional use VERTEX10 which I convert like this:
<br/>
<br/>
<br/>
<br/>
#define floattovtx10(n)        ((short)((n) * (1 &lt;&lt; 6))) /*!&lt; \brief convert float to vtx10 */
<br/>
<br/>
<br/>
				short  x=floattovtx10(m-&gt;vlist[index[tri]].x/scale_);
<br/>
				short y=floattovtx10(m-&gt;vlist[index[tri]].y/scale_);
<br/>
				short z=floattovtx10(m-&gt;vlist[index[tri]].z/scale_);
<br/>
<br/>
				u32 xyz= NORMAL_PACK(x,y,z);</span><span class="gensmall"><br/><br/>Last edited by a128 on Thu May 24, 2007 1:19 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#129524 - a128 - Wed May 23, 2007 2:11 pm</h4>
    <div class="postbody"><span class="postbody">Searching for the error....it seems that the Normals are wrong....leaving the normal out the hardware displays the 3d object 
<br/>
<br/>
I guess floattov10 () is still broken
<br/>
<br/>
I uses the latest NDS lib with 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define floattov10(n)        ((n&gt;.998) ? 0x1FF : ((v10)((n)*(1&lt;&lt;9)))) /*!&lt; \brief convert float to v10 */
<br/>
#define NORMAL_PACK(x,y,z)   (((x) &amp; 0x3FF) | (((y) &amp; 0x3FF) &lt;&lt; 10) | ((z) &lt;&lt; 20)) /*!&lt; \brief Pack 3 v10 normals i</td> </tr></table><span class="postbody"></span><span class="gensmall"><br/><br/>Last edited by a128 on Wed May 23, 2007 3:28 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#129527 - a128 - Wed May 23, 2007 3:31 pm</h4>
    <div class="postbody"><span class="postbody">I use libnds and no$gba ...all legal 
<br/>
but thanks for your advice in general</span><span class="gensmall"><br/><br/>Last edited by a128 on Thu May 24, 2007 1:18 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#129534 - silent_code - Wed May 23, 2007 4:15 pm</h4>
    <div class="postbody"><span class="postbody">you better do. and as a personal advise: watch what you're posting. if i was a mod, i'd given you a warning.
<br/>
<br/>
happy coding, though! ;^p</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#129762 - gabebear - Sat May 26, 2007 5:32 am</h4>
    <div class="postbody"><span class="postbody">Hmm, I don't know why that is happening. Normally a normal problem would just cause the lighting to be a little wrong, not make the model not load. If the model isn't loading at all then I'm betting the normals aren't really the problem.
<br/>
<br/>
Are all your models failing to load when you run them through that way? If it doesn't always happen then I may have some ideas. Try not sending glEnd commands, they are never needed and calling glEnd in a display list can make the DS lock up.
<br/>
<br/>
I made a very rough .PLY to display list converter at <a href="http://www.ghearing.com/mtutorial/" target="_blank">http://www.ghearing.com/mtutorial/</a> . I don't know if looking at the source for that one would help or hurt you... I should go back and clean it up... well rewrite it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#129934 - a128 - Tue May 29, 2007 8:44 am</h4>
    <div class="postbody"><span class="postbody">What's strange is that it works on No$gba emulator and Ideas BUT not on hardware
<br/>
<br/>
when I not use the Normals ...the displaylist displays on hardware
<br/>
<br/>
even with FIFO_END
<br/>
<br/>
btw. I use packed command</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#129971 - gabebear - Tue May 29, 2007 4:55 pm</h4>
    <div class="postbody"><span class="postbody">a128, I have several questions
<br/>
<br/>
1. Did you try NOT using FIFO_END?
<br/>
2. How many models have you tried in your display list converter?
<br/>
3. Do all the models screw up, or just a handful?
<br/>
4. Have you gotten the picking example working?(other thread)
<br/>
<br/>
None of the emulators are good at emulating the 3D hardware, so you need to test on actual hardware very often. I almost never use an emulator.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130023 - a128 - Wed May 30, 2007 8:28 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">1. Did you try NOT using FIFO_END?
<br/>
2. How many models have you tried in your display list converter?
<br/>
3. Do all the models screw up, or just a handful?
<br/>
4. Have you gotten the picking example working?(other thread)
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
First of all.....I dicovered a bug during my normal setup.....now the normals are correct....no$gba displays the lighting now correct...but the hardware displays nothing (:-
<br/>
<br/>
1. Yes...with FIFIO_END or not ....nothing happend on hardware..
<br/>
2. 1 model
<br/>
3. all models
<br/>
<br/>
4. I not tried it...but I will test that one again
<br/>
<br/>
<br/>
If I just leave the normals out of the displaylist the model is shown  on hardware</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130054 - a128 - Wed May 30, 2007 3:28 pm</h4>
    <div class="postbody"><span class="postbody">gabebear: 
<br/>
<br/>
I found your PLY Displaylist convert very usefull.
<br/>
<br/>
I like to scale any Model to -1,-1,-1 ...+1,+1,+1
<br/>
This way you can via glScale(size) resize your model and your code  knows about the model size
<br/>
<br/>
so in your void scale() method do 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
//compute maxX,.......minZ
<br/>
......
<br/>
float BASE=1;//+8
<br/>
// Set vertices to [(-BASE,-BASE,-BASE);(BASE,BASE,BASE)]
<br/>
   float tlx = (maxX + minX) / 2.0f;
<br/>
  float tly = (maxY + minY) / 2.0f;
<br/>
  float tlz = (maxZ + minZ) / 2.0f;
<br/>
  float scalex = (maxX - minX) * 0.5f;
<br/>
  float scaley = (maxY - minY) * 0.5f;
<br/>
  float scalez = (maxZ - minZ) * 0.5f;
<br/>
  
<br/>
  
<br/>
 float sc=MAX(MAX(scalex,scaley),scalez)/BASE;
<br/>
   printf("Info: Box extensions Min:X %f,Y %f,Z %f Max:X %f,Y %f,Z %f\n",minX,minY,minZ,maxX,maxY,maxZ);
<br/>
   printf("Info: Box extensions Height %f, Width %f, Depth %f\n",-minY+maxY,-minX+maxX,-minZ+maxZ);
<br/>
      printf("Info: tlx %f, tly %f, tlz %f\n sc %f\n",tlx,tly,tlz,sc);
<br/>
   
<br/>
   // scale the verts
<br/>
   for(int i=0;i&lt;numVerts;i++) {
<br/>
      vertices[i].x-=tlx;
<br/>
      vertices[i].y-=tly;
<br/>
      vertices[i].z-=tlz;
<br/>
      
<br/>
      vertices[i].x/=sc;
<br/>
      vertices[i].y/=sc;
<br/>
      vertices[i].z/=sc;
<br/>
   }
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130308 - gabebear - Sat Jun 02, 2007 2:11 am</h4>
    <div class="postbody"><span class="postbody">Scaling everything to 7.99 &lt;-&gt; -8.00 would make more sense; you get eight times more precision on the model. Using 7.99 &lt;-&gt; -8.00 then most of your models will still look good using 10bit coords, which shrinks the size of the display list considerably.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130507 - a128 - Mon Jun 04, 2007 8:57 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>gabebear wrote:</b></span></td> </tr> <tr> <td class="quote">Scaling everything to 7.99 &lt;-&gt; -8.00 would make more sense; you get eight times more precision on the model. Using 7.99 &lt;-&gt; -8.00 then most of your models will still look good using 10bit coords, which shrinks the size of the display list considerably.</td> </tr></table><span class="postbody">
<br/>
<br/>
then just use
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">float BASE=7.99f; </td> </tr></table><span class="postbody"> in the code from my previous posting
<br/>
<br/>
rescale with glScale(sc)  during rendering..so your model has the the same size before the scaling had taken place</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
