<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Need help with a Bizzare bug - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Need help with a Bizzare bug</h2>
<div id="posts">
<div class="post">
    <h4>#166170 - albinofrenchy - Sun Feb 01, 2009 10:10 am</h4>
    <div class="postbody"><span class="postbody">Unfortunately I don't think I can sheer this down to manageable copy-paste size; but I was wondering if anyone here can give me pointers how to fix this problem.
<br/>
<br/>
I have some code that I ported to the ARM processor that in general seems to do what it is supposed to . However, I think its seriously screwing up my stack in the process.
<br/>
<br/>
If I run something like:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
int main(void) {
<br/>
   fz_matrix ctm;
<br/>
   fz_error * error;
<br/>
   fatInitDefault();
<br/>
   fz_cpudetect();
<br/>
   fz_accelerate();
<br/>
   consoleDemoInit();
<br/>
   some_pdf_init_code();
<br/>
   ctm = viewctm();
<br/>
   error = some_render_code(...);
<br/>
   if(false)
<br/>
      printf("CTM: %p", &amp;ctm);
<br/>
   return 0;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
It will crash NO$. 
<br/>
<br/>
If I comment out the bottom 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
if(false)
<br/>
   printf("CTM: %p", &amp;ctm);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
it works. 
<br/>
<br/>
If I make the ctm variable static it works as well.
<br/>
<br/>
An interesting note is that I can display the image that is rendered with no problem. It just seems to happen whenever I try to access variables in the scope of my function. So that certainly points to a broken stack; but the fact that the code never runs has me puzzled. 
<br/>
<br/>
Anyone with any ideas on what this could possibly be? I'm utterly confused; I can not think of a single reason that code that will NOT run is crashing NO$ (and my DS).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#166171 - Echo49 - Sun Feb 01, 2009 10:34 am</h4>
    <div class="postbody"><span class="postbody">Which line is No$gba crashing on?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#166172 - albinofrenchy - Sun Feb 01, 2009 10:41 am</h4>
    <div class="postbody"><span class="postbody">No way to be sure; I have only the freeware version of NO$ (I only started working with the DS last week and I am unclear as to if the NO$ guy is still releasing anything)
<br/>
<br/>
It doesn't crash in NDESMUME.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#166175 - Maxxie - Sun Feb 01, 2009 12:19 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>albinofrenchy wrote:</b></span></td> </tr> <tr> <td class="quote">It doesn't crash in NDESMUME.</td> </tr></table><span class="postbody">
<br/>
<br/>
Which version?
<br/>
May i point you to <a href="http://desmume.org/" target="_blank">http://desmume.org/</a> ?<br/>_________________<br/><a class="postlink" href="http://nintendods.desperate-programmers.com/doku.php?id=wireless_io_map" target="_blank">Trying  to bring more detail into understanding the wireless hardware</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#166177 - albinofrenchy - Sun Feb 01, 2009 1:27 pm</h4>
    <div class="postbody"><span class="postbody">It does not crash .9, nor does it crash .7 with gdb support.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#166202 - Echo49 - Sun Feb 01, 2009 10:22 pm</h4>
    <div class="postbody"><span class="postbody">You can find out which line it's crashing on by putting a while(1); at the end of each line.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#166205 - silent_code - Sun Feb 01, 2009 10:35 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Echo49 wrote:</b></span></td> </tr> <tr> <td class="quote">You can find out which line it's crashing on by putting a while(1); at the end of each line.</td> </tr></table><span class="postbody">... adn removing them one by one.
<br/>
<br/>
Otherwise there's still good old logging (unbuffered or buffered and immediately flushed), in case you can't get a debugger to work. :^)<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
