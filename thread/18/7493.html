<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>How to detect an enemy - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > How to detect an enemy</h2>
<div id="posts">
<div class="post">
    <h4>#60780 - jandujar - Mon Nov 14, 2005 8:15 pm</h4>
    <div class="postbody"><span class="postbody">Hello people,
<br/>
<br/>
I'm getting stark mad. 
<br/>
I don't know how to detect if I have an enemy in front of my player.
<br/>
<br/>
I move my player and I have his coordinates in (x,y), for example (x1,y1).
<br/>
My player moves arround itself 360 degrees, and I have the point touched with stylus (x2,y2).
<br/>
<br/>
So my player points at the direction of the line 
<br/>
R = (x1,y1) + t(x2-x1,y2-y1)
<br/>
<br/>
The cpu's player has coordinates (a,b).
<br/>
<br/>
To know if my player are pointing the cpu, I calcule the distance between the cpu and the line and then I look if this distance is less than a value r(radius of the cpu's body) (i calcule the distance^2 to reduce  calculations)
<br/>
<br/>
d(P,r)=  |Ax+By+C|
<br/>
         ---------
<br/>
         sqrt(A^2 + B^2)
<br/>
<br/>
Where A=1/(x2-x1)
<br/>
      B=-1/(y2-y1)
<br/>
      C=y1/(y2-y1)  -x1/(x2,x1)
<br/>
<br/>
This is the code:
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
s32 CSDS_distancia_recta_punto(u8 x1,u8 y1,u8 x2,u8 y2,u8 a,u8 b){
<br/>
   s32 A,B,C,arriba,abajo,resultado;
<br/>
   PA_OutputSimpleText(1,0,1,"                                    ");
<br/>
   PA_OutputSimpleText(1,0,2,"                                    ");
<br/>
   
<br/>
   if(x2-x1!=0 &amp;&amp; y2-y1!=0){
<br/>
      A=1/(x2-x1);
<br/>
      B=-1/(y2-y1);
<br/>
      C=(-y1*B) - (x1*A);
<br/>
      arriba=(A*a)+(B*b) +(C);
<br/>
      arriba=arriba^2;
<br/>
      abajo=(A^2)+(B^2);
<br/>
      resultado=arriba/abajo;
<br/>
   PA_OutputText(1,0,1,"(%d,%d) (%d,%d) (%d,%d)",x1,y1,x2,y2,a,b); 
<br/>
   PA_OutputText(1,0,2,"A = %d, B= %d, C=%d, resultado=%d",A,B,C,resultado); 
<br/>
   if(resultado&lt;0){PA_OutputText(1,0,2,"Es -"); return 80000;}
<br/>
   return resultado;
<br/>
   }else{
<br/>
      PA_OutputSimpleText(1,0,0,"es 0                                    ");
<br/>
      return 8000;
<br/>
   }
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
But this code make incorrects values.
<br/>
What I'm making bad?
<br/>
<br/>
Note: Sorry for my english.
<br/>
<br/>
You can view a java applet to show you the distance between point and a line <a class="postlink" href="http://www.pntic.mec.es/Descartes/Bach_CNST_1/Geometria_afin_analitica_plano_lugares_geome[url]tricos/Geometria4.htm" target="_blank">http://www.pntic.mec.es/Descartes/Bach_CNST_1/Geometria_afin_analitica_plano_lugares_geome[url]tricos/Geometria4.htm</a>
<br/>
<br/>
Please, help me. I have 2 weeks working on this.<br/>_________________<br/><a class="postlink" href="http://jandujar.homelinux.com" target="_blank">http://jandujar.homelinux.com</a>
<br/>
<a class="postlink" href="http://www.dsrobot.com" target="_blank">http://www.dsrobot.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#60781 - natrium42 - Mon Nov 14, 2005 8:41 pm</h4>
    <div class="postbody"><span class="postbody">Ugh, you know that you are using integer variables, right? They don't have enough "precision" for the kind of calculations you are doing, by briefly looking at your code.
<br/>
<br/>
For example:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">A=1/(x2-x1);</td> </tr></table><span class="postbody">
<br/>
<br/>
where A, x1, x2 are integers will give you A=0 most of the time and sometimes A=1, because of rounding... A will never have any other values.<br/>_________________<br/><a class="postlink" href="http://www.natrium42.com" target="_blank">www.natrium42.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#60783 - Foxy - Mon Nov 14, 2005 8:49 pm</h4>
    <div class="postbody"><span class="postbody">BTW with C/C++, A ^ B doesn't mean A power B, but A XOR B.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#60785 - Frz - Mon Nov 14, 2005 9:10 pm</h4>
    <div class="postbody"><span class="postbody">Actually in integer divison there is no rounding. So 999/1000 is still 0 in integer division
<br/>
<br/>
only the value 1 could work
<br/>
(1/1 = 1 :))</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#60789 - jandujar - Mon Nov 14, 2005 9:29 pm</h4>
    <div class="postbody"><span class="postbody">I haved change the code and still does not work.  :(
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
s32 CSDS_distancia_recta_punto(u8 x1,u8 y1,u8 x2,u8 y2,u8 a,u8 b){
<br/>
   float A,B,C,arriba,abajo,resultado;
<br/>
   PA_OutputSimpleText(1,0,1,"                                    ");
<br/>
   PA_OutputSimpleText(1,0,2,"                                    ");
<br/>
   
<br/>
   if(x2-x1!=0 &amp;&amp; y2-y1!=0){
<br/>
      A=1/(x2-x1);
<br/>
      B=-1/(y2-y1);
<br/>
      C=(-y1*B) - (x1*A);
<br/>
      arriba=(A*a)+(B*b) +(C);
<br/>
      arriba=arriba*arriba;
<br/>
      abajo=(A*A)+(B*B);
<br/>
      resultado=arriba/abajo;
<br/>
   PA_OutputText(1,0,1,"(%d,%d) (%d,%d) (%d,%d)",x1,y1,x2,y2,a,b); 
<br/>
   PA_OutputText(1,0,2,"A = %d, B= %d, C=%d, resultado=%d",A,B,C,resultado); 
<br/>
   if(resultado&lt;0){PA_OutputText(1,0,2,"Es -"); return 80000;}
<br/>
   return resultado;
<br/>
   }else{
<br/>
      PA_OutputSimpleText(1,0,0,"es 0                                    ");
<br/>
      return 8000;
<br/>
   }
<br/>
}</td> </tr></table><span class="postbody"><br/>_________________<br/><a class="postlink" href="http://jandujar.homelinux.com" target="_blank">http://jandujar.homelinux.com</a>
<br/>
<a class="postlink" href="http://www.dsrobot.com" target="_blank">http://www.dsrobot.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#60790 - Mighty Max - Mon Nov 14, 2005 9:43 pm</h4>
    <div class="postbody"><span class="postbody">It will still calc (i.e.) 
<br/>
<br/>
A=1/(x2-x1);
<br/>
<br/>
in int and then convert to float, as the implizit conversation will only be made when needed.
<br/>
<br/>
you should try
<br/>
<br/>
A = 1/((float)x2-x1) ;
<br/>
<br/>
That way the compiler is forced to do the conversation to float prior to any calculation.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#60791 - jandujar - Mon Nov 14, 2005 9:49 pm</h4>
    <div class="postbody"><span class="postbody">Thanks a lot, I finally fount the solution:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
s32 CSDS_distancia_recta_punto(u8 x1,u8 y1,u8 x2,u8 y2,u8 a,u8 b){
<br/>
   float A,B,C,arriba,abajo,resultado;
<br/>
   PA_OutputSimpleText(1,0,1,"                                    ");
<br/>
   PA_OutputSimpleText(1,0,2,"                                    ");
<br/>
   
<br/>
   if(x2-x1!=0 &amp;&amp; y2-y1!=0){
<br/>
      A=1/((float)x2-(float)x1);
<br/>
      B=-1/((float)y2-(float)y1);
<br/>
      C=(-(float)y1*(float)B) - ((float)x1*(float)A);
<br/>
      arriba=((float)A*(float)a)+((float)B*(float)b) +((float)C);
<br/>
      arriba=(float)arriba*(float)arriba;
<br/>
      abajo=((float)A*(float)A)+((float)B*(float)B);
<br/>
      resultado=(float)arriba/(float)abajo;
<br/>
   PA_OutputText(1,0,1,"(%d,%d) (%d,%d) (%d,%d)",x1,y1,x2,y2,a,b); 
<br/>
   PA_OutputText(1,0,2,"A = %f, B= %f, C=%f, resultado=%f",A,B,C,resultado); 
<br/>
   if(resultado&lt;0){PA_OutputText(1,0,2,"Es -"); return 80000;}
<br/>
   return resultado;
<br/>
   }else{
<br/>
      PA_OutputSimpleText(1,0,0,"es 0                                    ");
<br/>
      return 8000;
<br/>
   }
<br/>
}</td> </tr></table><span class="postbody"><br/>_________________<br/><a class="postlink" href="http://jandujar.homelinux.com" target="_blank">http://jandujar.homelinux.com</a>
<br/>
<a class="postlink" href="http://www.dsrobot.com" target="_blank">http://www.dsrobot.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#60824 - LOst? - Tue Nov 15, 2005 4:25 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>jandujar wrote:</b></span></td> </tr> <tr> <td class="quote">Thanks a lot, I finally fount the solution:
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
s32 CSDS_distancia_recta_punto(u8 x1,u8 y1,u8 x2,u8 y2,u8 a,u8 b){
<br/>
   float A,B,C,arriba,abajo,resultado;
<br/>
   PA_OutputSimpleText(1,0,1,"                                    ");
<br/>
   PA_OutputSimpleText(1,0,2,"                                    ");
<br/>
   
<br/>
   if(x2-x1!=0 &amp;&amp; y2-y1!=0){
<br/>
      A=1/((float)x2-(float)x1);
<br/>
      B=-1/((float)y2-(float)y1);
<br/>
      C=(-(float)y1*(float)B) - ((float)x1*(float)A);
<br/>
      arriba=((float)A*(float)a)+((float)B*(float)b) +((float)C);
<br/>
      arriba=(float)arriba*(float)arriba;
<br/>
      abajo=((float)A*(float)A)+((float)B*(float)B);
<br/>
      resultado=(float)arriba/(float)abajo;
<br/>
   PA_OutputText(1,0,1,"(%d,%d) (%d,%d) (%d,%d)",x1,y1,x2,y2,a,b); 
<br/>
   PA_OutputText(1,0,2,"A = %f, B= %f, C=%f, resultado=%f",A,B,C,resultado); 
<br/>
   if(resultado&lt;0){PA_OutputText(1,0,2,"Es -"); return 80000;}
<br/>
   return resultado;
<br/>
   }else{
<br/>
      PA_OutputSimpleText(1,0,0,"es 0                                    ");
<br/>
      return 8000;
<br/>
   }
<br/>
}</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
<br/>
Now double your working time and convert all floats to use integer fixed point for speed. .... Yea I was evil now. Sorry.<br/>_________________<br/><span style="font-style: italic">Exceptions are fun</span></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
