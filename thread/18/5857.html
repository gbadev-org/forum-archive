<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>sprite animation speed - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > sprite animation speed</h2>
<div id="posts">
<div class="post">
    <h4>#44014 - chrissieboy - Sun May 29, 2005 11:34 am</h4>
    <div class="postbody"><span class="postbody">Hi im busy with a platform game. I got my sprite animated now, but the problem is it goes toooo fast! Anyone knows something like a timer or somthing to put in ? because my animation is 6 frames and i think it shows 60 frames in a second.
<br/>
<br/>
This is the code, anyone know a solution??? HELP
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
//////////////////////////////////////////////////////////////////////
<br/>
<br/>
#include &lt;NDS/NDS.h&gt;
<br/>
#include &lt;NDS/ARM9/rand.h&gt;
<br/>
<br/>
#include "spr1pal.h"
<br/>
//#include "ballpalette2.h"
<br/>
#include "spr1img.h"
<br/>
#include "spr2img.h"
<br/>
#include "spr3img.h"
<br/>
#include "spr4img.h"
<br/>
#include "spr5img.h"
<br/>
#include "spr6img.h"
<br/>
<br/>
//////////////////////////////////////////////////////////////////////
<br/>
#define NUM_SPRITES 128   
<br/>
<br/>
sSpriteEntry OAMCopySub[128];
<br/>
<br/>
//////////////////////////////////////////////////////////////////////
<br/>
<br/>
//simple sprite struct
<br/>
typedef struct
<br/>
{
<br/>
   int x,y;   //location 
<br/>
   int dx, dy;   //speed
<br/>
   sSpriteEntry* oam;   
<br/>
   //int gfxID; //graphics lovation
<br/>
   u16 curFrame;   //Animation frame
<br/>
}Sprite;
<br/>
<br/>
///////////////////////////////////////////////////////////////////////
<br/>
<br/>
void MoveSprite(Sprite* sp)
<br/>
{
<br/>
   int x = sp-&gt;x &gt;&gt; 8;
<br/>
   int y = sp-&gt;y &gt;&gt; 8;
<br/>
<br/>
   sp-&gt;oam-&gt;attribute[1] &amp;= 0xFE00;
<br/>
   sp-&gt;oam-&gt;attribute[1] |= (x &amp; 0x01FF);
<br/>
 
<br/>
   sp-&gt;oam-&gt;attribute[0] &amp;= 0xFF00;
<br/>
   sp-&gt;oam-&gt;attribute[0] |= (y &amp; 0x00FF);
<br/>
<br/>
} 
<br/>
///////////////////////////////////////////////////////////////////////
<br/>
void initOAM(void)
<br/>
{
<br/>
   int i;
<br/>
<br/>
   for(i = 0; i &lt; 128; i++)
<br/>
   {
<br/>
      OAMCopySub[i].attribute[0] = ATTR0_DISABLED;
<br/>
   }   
<br/>
}
<br/>
<br/>
//////////////////////////////////////////////////////////////////////
<br/>
void updateOAM(void)
<br/>
{
<br/>
   int i;
<br/>
   
<br/>
   for(i = 0; i &lt; 128 * sizeof(sSpriteEntry) / 4 ; i++)
<br/>
   {
<br/>
      ((uint32*)OAM_SUB)[i] = ((uint32*)OAMCopySub)[i];
<br/>
   }
<br/>
}
<br/>
<br/>
/////////////////////////////////////////////////////////////
<br/>
<br/>
void irqVBlank(void) 
<br/>
{   
<br/>
    IF = IF;
<br/>
}
<br/>
<br/>
///////////////// C code entry (main())/////////////////////
<br/>
int main(void) 
<br/>
{
<br/>
   
<br/>
   /////////variables
<br/>
   uint16* back = VRAM_A;
<br/>
   uint16* front = VRAM_B;
<br/>
<br/>
   Sprite sprites[NUM_SPRITES];
<br/>
<br/>
   int i;
<br/>
   int a;
<br/>
   int screen = 1;
<br/>
<br/>
   
<br/>
   
<br/>
   ///////////////set up/////////////
<br/>
   //enable the cache
<br/>
//   CP15_ITCMEnableDefault();
<br/>
<br/>
   //turn on the power to the system
<br/>
   powerON(POWER_ALL);
<br/>
<br/>
   //set main display to render directly from the frame buffer
<br/>
   videoSetMode(MODE_FB1);
<br/>
   
<br/>
   //set up the sub display
<br/>
   videoSetModeSub(MODE_0_2D | 
<br/>
               DISPLAY_SPR_1D_LAYOUT | 
<br/>
               DISPLAY_SPR_ACTIVE | 
<br/>
               DISPLAY_BG0_ACTIVE |
<br/>
               DISPLAY_BG1_ACTIVE );
<br/>
   
<br/>
   //vram banks are somewhat complex
<br/>
   vramSetMainBanks(VRAM_A_LCD, VRAM_B_LCD, VRAM_C_SUB_BG, VRAM_D_SUB_SPRITE);
<br/>
   
<br/>
   //irqs are nice..ndslib comes with a very unoptomized default handler
<br/>
   irqInitHandler(irqDefaultHandler);
<br/>
   irqSet(IRQ_VBLANK, irqVBlank);
<br/>
   
<br/>
   /////////////Init the sprites ///////////
<br/>
   for(i = 0; i &lt; 256; i++)
<br/>
      SPRITE_PALETTE_SUB[i] = ((u16*)spr1pal)[i];
<br/>
   //for(i = 512; i &lt; 1024; i++)
<br/>
      //SPRITE_PALETTE_SUB[i] = ((u16*)ballpalette2)[i];
<br/>
<br/>
// sprite animation
<br/>
<br/>
   for(i=0*512; i&lt;1*512; i++) { SPRITE_GFX_SUB[i] = ((u16*)spr1img)[i-(0*512)]; }
<br/>
   for(i=1*512; i&lt;2*512; i++) { SPRITE_GFX_SUB[i] = ((u16*)spr2img)[i-(1*512)]; }
<br/>
   for(i=2*512; i&lt;3*512; i++) { SPRITE_GFX_SUB[i] = ((u16*)spr3img)[i-(2*512)]; }
<br/>
   for(i=3*512; i&lt;4*512; i++) { SPRITE_GFX_SUB[i] = ((u16*)spr4img)[i-(3*512)]; }
<br/>
   for(i=4*512; i&lt;5*512; i++) { SPRITE_GFX_SUB[i] = ((u16*)spr5img)[i-(4*512)]; }
<br/>
   for(i=5*512; i&lt;6*512; i++) { SPRITE_GFX_SUB[i] = ((u16*)spr6img)[i-(5*512)]; }
<br/>
<br/>
   
<br/>
   
<br/>
   
<br/>
   //turn of sprites
<br/>
   initOAM();
<br/>
<br/>
<br/>
      //spriteplace and speed
<br/>
      sprites[0].x = 100&lt;&lt;8; 
<br/>
      sprites[0].y = 150&lt;&lt;8; 
<br/>
      sprites[0].dx = 0;
<br/>
      sprites[0].dy = 0;
<br/>
   sprites[0].curFrame = 0;
<br/>
      sprites[0].oam = &amp;OAMCopySub[0];
<br/>
      
<br/>
   
<br/>
      //set up our sprite OAM entry attributes
<br/>
      sprites[0].oam-&gt;attribute[0] = ATTR0_COLOR_256 | ATTR0_SQUARE;  
<br/>
      sprites[0].oam-&gt;attribute[1] = ATTR1_SIZE_32;
<br/>
      sprites[0].oam-&gt;attribute[2] = 0;
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
   while (1) 
<br/>
   {
<br/>
<br/>
      
<br/>
      //move the sprites
<br/>
      uint16 keysPressed = READ_KEYS;
<br/>
            if(keysPressed &amp; KEY_LEFT) { sprites[0].x = sprites[0].x-1; }
<br/>
            if(keysPressed &amp; KEY_RIGHT) { sprites[0].x = sprites[0].x+1; }
<br/>
            
<br/>
                                               
<br/>
                           
<br/>
<br/>
                            
<br/>
                           
<br/>
            
<br/>
            
<br/>
            
<br/>
            
<br/>
            
<br/>
            
<br/>
         sprites[0].x += sprites[0].dx;
<br/>
         //sprites[i].y += sprites[i].dy;
<br/>
         
<br/>
         
<br/>
         //Animate sprite
<br/>
         if (sprites[0].curFrame&lt;6) { sprites[0].curFrame++;  }
<br/>
         else { sprites[0].curFrame = 0; }
<br/>
         
<br/>
         
<br/>
         
<br/>
/*         //check for collision with the screen boundries
<br/>
         if(sprites[0].x &lt; (1&lt;&lt;8) || sprites[0].x &gt; (231 &lt;&lt; 8))
<br/>
            sprites[0].dx = -sprites[0].dx;
<br/>
         if(sprites[0].y &lt; (1&lt;&lt;8) || sprites[0].y &gt; (164 &lt;&lt; 8))
<br/>
            sprites[0].dy = -sprites[0].dy;
<br/>
   */      
<br/>
         //reposition the sprites
<br/>
         sprites[0].oam-&gt;attribute[2] = int((sprites[0].curFrame/3))*32;
<br/>
         MoveSprite(&amp;sprites[0]);
<br/>
<br/>
      
<br/>
<br/>
//      swiWaitForVBlank();
<br/>
      
<br/>
      updateOAM();
<br/>
<br/>
      //flip screens
<br/>
      if(screen)
<br/>
      {
<br/>
         videoSetMode(MODE_FB1);
<br/>
         front = VRAM_B;
<br/>
         back = VRAM_A;
<br/>
         screen = 0;
<br/>
      }
<br/>
      else
<br/>
      {
<br/>
         videoSetMode(MODE_FB0);   
<br/>
         front = VRAM_A;
<br/>
         back = VRAM_B;
<br/>
         screen = 1;
<br/>
      }
<br/>
   }    
<br/>
   return 0;
<br/>
}
<br/>
<br/>
//////////////////////////////////////////////////////////////////////
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44017 - abigsmurf - Sun May 29, 2005 12:42 pm</h4>
    <div class="postbody"><span class="postbody">you could just make the animation 60fps and fill in the gaps with pointers (ie have 10 identical frames in a row) . Not sure if that would fill up memory though...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44034 - dagamer34 - Sun May 29, 2005 6:40 pm</h4>
    <div class="postbody"><span class="postbody">The easy and cheap way to do it is to make a counter that counts to 10, and when it reaches 10, it THEN changes the frame. Easy and cheap, but not very efficient when it comes to multiple animations running at the same time(not only that, your code gets really cluttered)
<br/>
<br/>
Make a class (or at least a struct) and set up functions that do the work for you. Don't reinvent the wheel every time you have to use it.<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
