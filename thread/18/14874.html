<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Eliminating __aeabi_atexit? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > Eliminating __aeabi_atexit?</h2>
<div id="posts">
<div class="post">
    <h4>#149372 - Dwedit - Sat Jan 19, 2008 9:15 am</h4>
    <div class="postbody"><span class="postbody">I'm working on a C++ program.
<br/>
The linker loves to add a handler to call destructors when the program finishes because there are static or global objects.  Here, it's adding __aeabi_atexit, and it's big group of friends to handle destruction of those objects when the program exits.
<br/>
Exits?  Where?  How does an NDS program exit?
<br/>
<br/>
So I'm making a dummy function here
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">extern "C" {
<br/>
   void __aeabi_atexit()
<br/>
   {
<br/>
      
<br/>
   }
<br/>
}</td> </tr></table><span class="postbody">
<br/>
to make the linker not include code for __aeabi_atexit, and this actually works.
<br/>
<br/>
Is there a better way to do this which is not a complete and utter hack?<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#149404 - tepples - Sat Jan 19, 2008 7:48 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dwedit wrote:</b></span></td> </tr> <tr> <td class="quote">How does an NDS program exit?</td> </tr></table><span class="postbody">
<br/>
Eventually, a program will exit using something like <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?p=145851#145851" target="_blank">bootlib</a>.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#149410 - sajiimori - Sat Jan 19, 2008 8:49 pm</h4>
    <div class="postbody"><span class="postbody">I somehow doubt that bootlib scans binaries to find their atexit code and executes it before resetting.  The term "memory leak" sort of loses its meaning when you're destroying the program that contains the memory allocation system -- atexit is something of a foregone conclusion.
<br/>
<br/>
The solution you've got there looks good to me, Dwedit!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#149446 - Dwedit - Sun Jan 20, 2008 3:32 am</h4>
    <div class="postbody"><span class="postbody">Maybe add it into the CRT instead of into the code?<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
