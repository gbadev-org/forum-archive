<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Getting a display list to ignore normal commands - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Getting a display list to ignore normal commands</h2>
<div id="posts">
<div class="post">
    <h4>#157412 - DiscoStew - Fri May 23, 2008 9:55 pm</h4>
    <div class="postbody"><span class="postbody">Ok, so the subject sounds odd, but I'm trying to do something on the NDS that allows me to make an option to have lighting on or off on a model. With a display list, it can either have normal commands in it or not, but for my purposes, I have to have the former. My model has a preset materials, which are added to the display list. When I was looking through the NDS specs, I saw this...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"><span style="font-weight: bold">40004C0h - Cmd 30h - DIF_AMB - MaterialColor0 - Diffuse/Ambient Reflect. (W)</span>
<br/>
<br/>
  0-4   Diffuse Reflection Red     ;\light(s) that directly hits the polygon,
<br/>
  5-9   Diffuse Reflection Green   ; ie. max when NormalVector has opposite
<br/>
  10-14 Diffuse Reflection Blue    ;/direction of LightVector
<br/>
  15    Set Vertex Color (0=No, 1=Set Diffuse Reflection Color as Vertex Color)
<br/>
  16-20 Ambient Reflection Red     ;\light(s) that indirectly hits the polygon,
<br/>
  21-25 Ambient Reflection Green   ; ie. assuming that light is reflected by
<br/>
  26-30 Ambient Reflection Blue    ;/walls/floor, regardless of LightVector
<br/>
  31    Not used
<br/>
<br/>
With Bit15 set, the lower 15bits are applied as VertexColor (exactly as when when executing the Color command), the purpose is to use it as default color (eg. when outcommenting the Normal command), normally, when using lighting, the color setting gets overwritten (as soon as executing the Normal command).</td> </tr></table><span class="postbody">
<br/>
<br/>
When it speaks about the 15th bit, I assumed that when set would prevent the execution of normals in the display list and would "color" the model with what the Diffuse value is set to until that bit is changed. Am I right, or am I thinking this wrong? If I am wrong, what would be the best way to do what I want?
<br/>
<br/>
thx in advance<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157427 - M3d10n - Sat May 24, 2008 2:24 am</h4>
    <div class="postbody"><span class="postbody">Never tested the 15th bit, but I imagine that if you set the material's diffuse to black and the ambient color to full white the lighting would be effectivelly nullfied, showing only the textures without color modulation.
<br/>
<br/>
But obviously turning off the lighting using the POLY_FMT flags would be preferable, no? Are POLY_FMT commands included in your display lists?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157449 - DiscoStew - Sat May 24, 2008 6:16 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>M3d10n wrote:</b></span></td> </tr> <tr> <td class="quote">Never tested the 15th bit, but I imagine that if you set the material's diffuse to black and the ambient color to full white the lighting would be effectivelly nullfied, showing only the textures without color modulation.
<br/>
<br/>
But obviously turning off the lighting using the POLY_FMT flags would be preferable, no? Are POLY_FMT commands included in your display lists?</td> </tr></table><span class="postbody">
<br/>
<br/>
I haven't gotten to textures at the moment. Just working on the model's materials. When I go and disable the lights through the POLY_FMT command (it's separate from the display list as of now), my model shows complete black, even when I change the diffusion to black and the ambience to white.
<br/>
All I'm trying to do is set up the model so that if I choose to disable lighting, the Normal commands in the display list won't change the coloring of the model, but obviously will when lighting is enabled. I'm doing this as part of a library for handling 3D models in a custom format.<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157466 - M3d10n - Sun May 25, 2008 3:18 am</h4>
    <div class="postbody"><span class="postbody">Did you try keeping the light on, but just setting the diffuse to black?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157469 - DekuTree64 - Sun May 25, 2008 3:49 am</h4>
    <div class="postbody"><span class="postbody">I think bit15 of the material command just means to set the current vertex color at the same time as setting the material. But any normal vector commands afterward will still overwrite the current vertex color.
<br/>
<br/>
The technique mentioned in the command description could work, although I'm not sure what would be the best way to "comment out" the normal commands, since they also have an argument that needs to be accounted for... maybe since you won't be using lighting on the model, replace all normal commands with light vector commands. And since those usually aren't done in display lists, it should be safe to then run through and replace all light vectors with normals to switch back.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157473 - DiscoStew - Sun May 25, 2008 4:57 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>M3d10n wrote:</b></span></td> </tr> <tr> <td class="quote">Did you try keeping the light on, but just setting the diffuse to black?</td> </tr></table><span class="postbody">
<br/>
<br/>
I will say, that I was able to get it working in that manner (though I had to set at least one light enabled, and any lights on with a color of complete white).
<br/>
<br/>
DekuTree64,
<br/>
You mean making a change to the command packs involving normals commands, and changing them to light vectors? Seems a little tedious, but it's worth looking into.
<br/>
<br/>
-------------
<br/>
<br/>
There is one other way that I tinkered with that could worked, but I'm not sure whether it is a good idea. Changing the emission value (along with the ambient/diffuse value). Perhaps making some cross between them? I will admit that I haven't dove into the necessity of some 3D aspects like this, and I'm learning them in this manner.<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157475 - DekuTree64 - Sun May 25, 2008 6:20 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>DiscoStew wrote:</b></span></td> </tr> <tr> <td class="quote">There is one other way that I tinkered with that could worked, but I'm not sure whether it is a good idea. Changing the emission value (along with the ambient/diffuse value).</td> </tr></table><span class="postbody">
<br/>
Good point. Just setting the emission color to white will force it to full brightness.
<br/>
<br/>
Modifying display lists is a bit tricky, but does have its uses. Especially when using manual vertex colors, because you can't modify the color at all otherwise.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#157515 - DiscoStew - Mon May 26, 2008 7:38 am</h4>
    <div class="postbody"><span class="postbody">Ok, after a little testing, I think I got it how I want it. By doing the following code with related material values....
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">glMaterial(GL_DIFFUSE, RGB(0,0,0));
<br/>
glMaterial(GL_EMISSION, AmbientRGB15);</td> </tr></table><span class="postbody">
<br/>
<br/>
....it disables the effect that the normals would have on the the model, and forces the model to have the color equal to it's ambience, whether or not lights are enabled. This is all from visual comparisons displayed in Maya using the default lighting and when all lights are disabled.<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
