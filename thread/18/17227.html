<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Sprite setup causing screen glitch? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Sprite setup causing screen glitch?</h2>
<div id="posts">
<div class="post">
    <h4>#173746 - Pete_Lockwood - Wed Apr 28, 2010 12:07 am</h4>
    <div class="postbody"><span class="postbody">I inherited the code below and it seems to be causing a small blob to display in the top left corner of the lower screen.  It appears that this blob is actually an enlarged and distorted copy of the data in the top left 8x4 pixel corner of one of the 16x16 pixel sprites.
<br/>
<br/>
Presumably something trampling over memory?  Or something not being initialized that should be?  Anyone able to spot what?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
powerOn(POWER_ALL_2D);
<br/>
<br/>
videoSetMode(MODE_5_2D | DISPLAY_SPR_ACTIVE |  //turn on sprites
<br/>
             DISPLAY_BG3_ACTIVE |          //turn on background 0
<br/>
             DISPLAY_SPR_1D_LAYOUT
<br/>
             );
<br/>
<br/>
// Use the Sub Screen for text
<br/>
videoSetModeSub(MODE_5_2D | DISPLAY_BG3_ACTIVE);
<br/>
<br/>
vramSetMainBanks(VRAM_A_MAIN_BG_0x06000000,
<br/>
                 VRAM_B_MAIN_SPRITE_0x06400000,
<br/>
                 VRAM_C_SUB_BG_0x06200000,
<br/>
                 VRAM_D_LCD         //not using D
<br/>
                 );
<br/>
lcdSwap();
<br/>
<br/>
for(int i = 0; i &lt; 64; i++) {
<br/>
   sprites[i].attribute[0] = ATTR0_DISABLED | ATTR0_COLOR_256;
<br/>
   sprites[i].attribute[1] = ATTR1_SIZE_16;
<br/>
   sprites[i].attribute[2] = 0;
<br/>
   sprites[i].filler = 0;
<br/>
}
<br/>
<br/>
for (int x=0; x&lt;6;x++) {
<br/>
   for(uint16 i=0; i&lt;64; i++){
<br/>
        SPRITE_GFX[128*x*2 + i]          = piecesTiles[8*96 + i+x*64];  // &lt;-- remove this line and the blob goes away
<br/>
        SPRITE_GFX[128*x*2 + 64 + i]     = piecesTiles[12*96+i+x*64];
<br/>
        SPRITE_GFX[128*(x*2+1) + i]      = piecesTiles[i+x*64];
<br/>
        SPRITE_GFX[128*(x*2+1) + 64 + i] = piecesTiles[4*96+i+x*64];
<br/>
    }
<br/>
}
<br/>
<br/>
for(uint16 i=0; i&lt;256; i++) SPRITE_PALETTE[i] = piecesPal[i];
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/>It's not an illusion, it just looks like one.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#173747 - Pete_Lockwood - Wed Apr 28, 2010 3:37 am</h4>
    <div class="postbody"><span class="postbody">Aha.  Looks like this solves it:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">oamInit(&amp;oamMain, SpriteMapping_1D_32 , false);</td> </tr></table><span class="postbody"><br/>_________________<br/>It's not an illusion, it just looks like one.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#173748 - ritz - Wed Apr 28, 2010 4:07 am</h4>
    <div class="postbody"><span class="postbody">Glad I could help!
<br/>
;)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
