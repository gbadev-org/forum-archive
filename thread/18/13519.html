<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>I'm stumped. Upgraded to devkitARM r20. - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > I'm stumped. Upgraded to devkitARM r20.</h2>
<div id="posts">
<div class="post">
    <h4>#132380 - Dark Knight ez - Tue Jun 26, 2007 11:32 am</h4>
    <div class="postbody"><span class="postbody">Hey all.
<br/>
<br/>
I decided to install the latest development setup for the DS as the touch screen code was hugely improved. That's actually a big plus in my RTS engine and it's definitely noticable. Great job on that.
<br/>
<br/>
Anyway, the main screen suddenly refuses to show sprites. On devkitARM r19 it worked just fine.
<br/>
Now, my sprite setup for my RTS was kind of advanced, so I just removed the following to check if it would work after that:
<br/>
- HBlank and VBlank trickery
<br/>
- extended palettes
<br/>
This way, it should be the same as the sub screen when it comes to sprite showing code.... but whereas the sub screen actually shows it sprites, the main screen still did not.
<br/>
<br/>
So then I tried to just load the main graphics and palette to _SUB and copy the sprites to OAM_SUB, etc... changing nothing else in code really but adding the _SUB part, and then the sprites meant for the main screen show up properly on the sub screen. So that tells me that the actual sprite setting code is proper, but... well... I still don't know what could possibly be the problem.
<br/>
I'm stumped. Any ideas on what could be wrong?
<br/>
<br/>
[side note]
<br/>
I'm not as stupid as to not have sprite graphics VRAM for main screen set up or anything.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">    VRAM_A_CR = VRAM_ENABLE | VRAM_A_MAIN_BG;     // 128 kb
<br/>
    VRAM_B_CR = VRAM_ENABLE | VRAM_B_MAIN_SPRITE; // 128 kb
<br/>
    VRAM_C_CR = VRAM_ENABLE | VRAM_C_SUB_BG;      // 128 kb
<br/>
    VRAM_D_CR = VRAM_ENABLE | VRAM_D_SUB_SPRITE;  // 128 kb</td> </tr></table><span class="postbody"><br/>_________________<br/><span style="font-size: 9px; line-height: normal"><a class="postlink" href="http://amplituds.drunkencoders.com" target="_blank">AmplituDS website</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#132382 - Lick - Tue Jun 26, 2007 11:34 am</h4>
    <div class="postbody"><span class="postbody">Video mode flags? Background priorities?<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#132384 - Dark Knight ez - Tue Jun 26, 2007 11:44 am</h4>
    <div class="postbody"><span class="postbody">I disabled all backgrounds just in case... did not help.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">    DISPLAY_CR = (MODE_0_2D |
<br/>
                  DISPLAY_SPR_ACTIVE |
<br/>
                  DISPLAY_SPR_1D |
<br/>
                  DISPLAY_SPR_1D_SIZE_256 //| // getting sprite references to be 256 byte (16x16 8-bit tiles)
<br/>
                  //DISPLAY_SPR_EXT_PALETTE   // using extended palettes for sprites
<br/>
                  //DISPLAY_WIN0_ON
<br/>
                );</td> </tr></table><span class="postbody"><br/>_________________<br/><span style="font-size: 9px; line-height: normal"><a class="postlink" href="http://amplituds.drunkencoders.com" target="_blank">AmplituDS website</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#132395 - tepples - Tue Jun 26, 2007 12:56 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dark Knight ez wrote:</b></span></td> </tr> <tr> <td class="quote">I decided to install the latest development setup for the DS as the touch screen code was hugely improved. That's actually a big plus in my RTS engine and it's definitely noticable. Great job on that.
<br/>
<br/>
Anyway, the main screen suddenly refuses to show sprites.</td> </tr></table><span class="postbody">
<br/>
On the version of libnds included with devkitARM R20, the default VRAM address for some of the sprite banks has changed. What happened to you happened to me around LOCKJAW 0.34. Try specifying the sprite banks for the main screen entirely, including the address in VRAM to which they are mapped. 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I'm not as stupid as to not have sprite graphics VRAM for main screen set up or anything.
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">    VRAM_A_CR = VRAM_ENABLE | VRAM_A_MAIN_BG;     // 128 kb
<br/>
    VRAM_B_CR = VRAM_ENABLE | VRAM_B_MAIN_SPRITE; // 128 kb
<br/>
    VRAM_C_CR = VRAM_ENABLE | VRAM_C_SUB_BG;      // 128 kb
<br/>
    VRAM_D_CR = VRAM_ENABLE | VRAM_D_SUB_SPRITE;  // 128 kb</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
Have you tried specifying an address for VRAM_B_MAIN_SPRITE?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#132399 - Dark Knight ez - Tue Jun 26, 2007 1:04 pm</h4>
    <div class="postbody"><span class="postbody">That did it! :)
<br/>
Thanks, tepples... not sure if I would have ever figured that one out myself. I would probably have reverted back to the older development setup instead.<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><a class="postlink" href="http://amplituds.drunkencoders.com" target="_blank">AmplituDS website</a></span></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
