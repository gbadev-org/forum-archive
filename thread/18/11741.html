<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>realtime clock help - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > realtime clock help</h2>
<div id="posts">
<div class="post">
    <h4>#109502 - SaruCoder - Sat Nov 18, 2006 9:13 pm</h4>
    <div class="postbody"><span class="postbody">I've managed to compile the real time clock example that's included with the devKitPro, but then when I run (load and execute) it on the Dualis emulator it looks like it's paused, and the clock isn't "ticking".
<br/>
<br/>
I've run into this before where I'm trying to get a basic clock working but I wasn't able to get it to count.
<br/>
<br/>
The example I'm running is:
<br/>
devkitPro\examples\nds\RealTimeClock\Watch
<br/>
<br/>
I'm starting to think it's a problem with the emulator.  I haven't tried it with other ones because I haven't came across any that are good.
<br/>
<br/>
Does anybody have any ideas on what's going on?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109520 - Lick - Sat Nov 18, 2006 11:48 pm</h4>
    <div class="postbody"><span class="postbody">Try a different emulator.<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109538 - SaruCoder - Sun Nov 19, 2006 2:44 am</h4>
    <div class="postbody"><span class="postbody">Any suggestions for a different emulator another than Dualis?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109546 - Normmatt - Sun Nov 19, 2006 6:29 am</h4>
    <div class="postbody"><span class="postbody">i'm pretty sure the only nds emulator that supports the rtc is no$gba.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#109616 - SaruCoder - Sun Nov 19, 2006 7:16 pm</h4>
    <div class="postbody"><span class="postbody">Thanks Normmatt, the clock example is working in no$gba.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117771 - SaruCoder - Wed Feb 07, 2007 8:40 am</h4>
    <div class="postbody"><span class="postbody">Ok, I just updated to devkitpro r20, and now the real time clock (example) doesn't work with no$gba (2.3c).
<br/>
<br/>
I was wondering if it's working for you guys?
<br/>
<br/>
I also noticed some changes to ipc.h, they took out IPC-&gt;rtc_heartbeat :(  So what do you guys use for "measuring" time in terms of milliseconds?  The time.h, clock_t, clock(), ...,  route doesn't work for me either.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117773 - SaruCoder - Wed Feb 07, 2007 8:50 am</h4>
    <div class="postbody"><span class="postbody">Hmm, unless you guys are relaying on the 60Hz vertical refresh, swiWaitForVBlank(), for time &lt; 1 second.  But this assumes that there won't be a hiccup where it skips a vblank.  Interesting ...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117789 - tepples - Wed Feb 07, 2007 3:13 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>SaruCoder wrote:</b></span></td> </tr> <tr> <td class="quote">Hmm, unless you guys are relaying on the 60Hz vertical refresh, swiWaitForVBlank(), for time &lt; 1 second.  But this assumes that there won't be a hiccup where it skips a vblank.  Interesting ...</td> </tr></table><span class="postbody">
<br/>
Yes, the vast majority of commercial NES, Sega Genesis, Super NES, GBA, and DS games use vblank for game logic timing. If your vblank ISR keeps a count of vblanks since power on, then the main code can compensate for hiccups.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117881 - SaruCoder - Thu Feb 08, 2007 7:47 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>SaruCoder wrote:</b></span></td> </tr> <tr> <td class="quote">Hmm, unless you guys are relaying on the 60Hz vertical refresh, swiWaitForVBlank(), for time &lt; 1 second.  But this assumes that there won't be a hiccup where it skips a vblank.  Interesting ...</td> </tr></table><span class="postbody">
<br/>
Yes, the vast majority of commercial NES, Sega Genesis, Super NES, GBA, and DS games use vblank for game logic timing. If your vblank ISR keeps a count of vblanks since power on, then the main code can compensate for hiccups.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Thanks for the reply tepples, I will probably use the vblank as my "clock".  However, I'm still still having troubles setting up the RTC.  I don't really need it, but it'll be reassuring to know what was going on.  I'm I suppose to enable an IRQ or something?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#118022 - knight0fdragon - Fri Feb 09, 2007 3:49 am</h4>
    <div class="postbody"><span class="postbody">RTC works on no$gba 2.3c<br/>_________________<br/><a href="http://www.myspace.com/knight0fdragonds" target="_blank">http://www.myspace.com/knight0fdragonds</a>
<br/>
<br/>
MK DS FC: Dragon 330772 075464 
<br/>
AC WW FC: Anthony SamsClub 1933-3433-9458 
<br/>
MPFH: Dragon 0215 4231 1206</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#118034 - wintermute - Fri Feb 09, 2007 7:59 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>knight0fdragon wrote:</b></span></td> </tr> <tr> <td class="quote">RTC works on no$gba 2.3c</td> </tr></table><span class="postbody">
<br/>
<br/>
Not sure why it would.
<br/>
<br/>
The RTC update code was temporarily removed from the default ARM7 core. It was reading the RTC every frame or about 60 times faster than it could possibly be changing. This had some detrimental effects on both touchscreen reading and microphone output.
<br/>
<br/>
I'm intending to replace this with something more sensible in the very near future, probably a single read of the RTC on start up with updating handled via vblank thereafter.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#118035 - wintermute - Fri Feb 09, 2007 8:02 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>SaruCoder wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
I also noticed some changes to ipc.h, they took out IPC-&gt;rtc_heartbeat :(  So what do you guys use for "measuring" time in terms of milliseconds?  The time.h, clock_t, clock(), ...,  route doesn't work for me either.</td> </tr></table><span class="postbody">
<br/>
<br/>
heartbeat was a debugging variable to check the arm7 code was running way back when libnds just started out.
<br/>
<br/>
I intend to make some of the time.h functions work in the very near future although it's unlikely that millisecond resolution will be implemented by default.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#118110 - HyperHacker - Sat Feb 10, 2007 5:53 am</h4>
    <div class="postbody"><span class="postbody">Hm, so the touch screen accuracy problems are caused by reading the clock too often?<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#118153 - knight0fdragon - Sat Feb 10, 2007 3:11 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>knight0fdragon wrote:</b></span></td> </tr> <tr> <td class="quote">RTC works on no$gba 2.3c</td> </tr></table><span class="postbody">
<br/>
<br/>
Not sure why it would.
<br/>
<br/>
The RTC update code was temporarily removed from the default ARM7 core. It was reading the RTC every frame or about 60 times faster than it could possibly be changing. This had some detrimental effects on both touchscreen reading and microphone output.
<br/>
<br/>
I'm intending to replace this with something more sensible in the very near future, probably a single read of the RTC on start up with updating handled via vblank thereafter.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
I was not referring to the default arm7 core, I am talking about RTC works in general, I myself have built a custom arm7 that askes to read the arm7 only upon request from the arm9 via FIFO<br/>_________________<br/><a href="http://www.myspace.com/knight0fdragonds" target="_blank">http://www.myspace.com/knight0fdragonds</a>
<br/>
<br/>
MK DS FC: Dragon 330772 075464 
<br/>
AC WW FC: Anthony SamsClub 1933-3433-9458 
<br/>
MPFH: Dragon 0215 4231 1206</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
