<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Bugged Console behavior - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Bugged Console behavior</h2>
<div id="posts">
<div class="post">
    <h4>#167508 - albinofrenchy - Mon Mar 16, 2009 6:10 am</h4>
    <div class="postbody"><span class="postbody">Anyone else thing its a bug that if you initialize two consoles without passing in a PrintConsole parameter to either function, you get back the same pointer? 
<br/>
<br/>
I just ran into this when switching back and forth between top and bottom screen consoles. I fixed it by creating my own consoles, but my libnds doesn't seem to have any functions to create new printconsoles, so I have things like this: 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
bottomConsole = (PrintConsole*)malloc(sizeof(PrintConsole));
<br/>
memcpy(bottomConsole, consoleGetDefault(), sizeof(PrintConsole));
<br/>
   
<br/>
bottomConsole = consoleInit(bottomConsole, 1,BgType_Text4bpp , 
<br/>
      BgSize_T_256x256, 0, 1, true, true);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Any better way to do this? Am I in the minority in thinking this is unexpected behavior?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167509 - hacker013 - Mon Mar 16, 2009 8:34 am</h4>
    <div class="postbody"><span class="postbody">yes it has function to create new consoles:
<br/>
<br/>
consoleInit(); and create just pointer to a printConsole struct and then you pass the through on the point where you normally consoleGetDefault passes.<br/>_________________<br/><a class="postlink" href="http://imetal.nl/" target="_blank">Website / Blog</a>
<br/>
<br/>
Let the nds be with you.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167513 - elhobbs - Mon Mar 16, 2009 1:46 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>albinofrenchy wrote:</b></span></td> </tr> <tr> <td class="quote">Anyone else thing its a bug that if you initialize two consoles without passing in a PrintConsole parameter to either function, you get back the same pointer? 
<br/>
<br/>
I just ran into this when switching back and forth between top and bottom screen consoles. I fixed it by creating my own consoles, but my libnds doesn't seem to have any functions to create new printconsoles, so I have things like this: 
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
bottomConsole = (PrintConsole*)malloc(sizeof(PrintConsole));
<br/>
memcpy(bottomConsole, consoleGetDefault(), sizeof(PrintConsole));
<br/>
   
<br/>
bottomConsole = consoleInit(bottomConsole, 1,BgType_Text4bpp , 
<br/>
      BgSize_T_256x256, 0, 1, true, true);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Any better way to do this? Am I in the minority in thinking this is unexpected behavior?</span></td> </tr></table><span class="postbody">I believe this behavior is by design. A PrintConsole contains the state information for a print context. In the main case there is typically only one console. So, when it is NULL for consoleInit the default console is assumed. returning the same console is there to handle returning the default console when a NULL PrintConsole is supplied. So you can either statically create space for a new PrintConsole or dynamically create one as you have above. I do not believe it is required to copy the default console into the dynamically created one as initConsole takes care of setting the structure up for you.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167518 - albinofrenchy - Mon Mar 16, 2009 10:09 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I do not believe it is required to copy the default console into the dynamically created one as initConsole takes care of setting the structure up for you.</td> </tr></table><span class="postbody">
<br/>
<br/>
I was wondering about this; I looked superficially at the code and it didn't seem to be setting everything; so I went ahead and am copying it out. I'll try it without the memcpy and see if it works still. 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">In the main case there is typically only one console.</td> </tr></table><span class="postbody">
<br/>
<br/>
I'd think there would often times be two; one for the top and one for the bottom. I guess not though? 
<br/>
<br/>
I actually don't get the point in having a default console if this is the behavior; might as well just handle allocation and pass back that pointer if they give you a null pointer. Sure, you'd have to free it, but if they are using only one console anyway, nothing would change.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167521 - elhobbs - Tue Mar 17, 2009 12:29 am</h4>
    <div class="postbody"><span class="postbody">the default console is statically declared with default values.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
