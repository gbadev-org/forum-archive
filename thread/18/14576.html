<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Fonts and using more than one rotation background - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Fonts and using more than one rotation background</h2>
<div id="posts">
<div class="post">
    <h4>#145924 - FireSlash - Sun Nov 25, 2007 7:02 pm</h4>
    <div class="postbody"><span class="postbody">Ok, here's my conundrum. I've initialized a font based on the rotscale_text example. Works great.
<br/>
<br/>
But I'm already using BG3 for some other graphics, so I switched it over to BG2
<br/>
<br/>
However, if I use either one at the same time, bad things(tm) happen.
<br/>
<br/>
Here's the font code:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">      // Setup our 2d font
<br/>
      unsigned int i;
<br/>
      const int char_base = 0;
<br/>
      const int screen_base = 20;
<br/>
<br/>
      //tex2d subFont;
<br/>
      //subFont.loadTex("/data/pi/textures/BG2_font.bmp", true);
<br/>
<br/>
      SUB_BG2_CR = BG_TILE_BASE(char_base) | BG_MAP_BASE(screen_base) | ROTBG_SIZE_256x256;
<br/>
<br/>
      u16* sub_tile = (u16*)CHAR_BASE_BLOCK_SUB(char_base);
<br/>
      u16* sub_map = (u16*)SCREEN_BASE_BLOCK_SUB(screen_base);
<br/>
<br/>
      consoleInit((u16*)fontData, sub_tile, 95, 32, sub_map, CONSOLE_USE_COLOR255, 8);
<br/>
      
<br/>
      for(i = 0; i &lt; fontDataSize; ++i) {
<br/>
         sub_tile[i] = fontData[i];
<br/>
      }
<br/>
<br/>
      // extended palettes are written with bank mapped to lcd
<br/>
      vramSetBankH(VRAM_H_LCD); 
<br/>
<br/>
      // each background has it's own set of 16 256 color palettes
<br/>
      for(i = 0; i &lt; fontPaletteSize; ++i) {
<br/>
         VRAM_H_EXT_PALETTE[2][0][i]= fontPalette[i];
<br/>
      }
<br/>
<br/>
      // map bank to extended palette after writing data
<br/>
      vramSetBankH(VRAM_H_SUB_BG_EXT_PALETTE); 
<br/>
      printf("AAA BBB CCC DDD\n ");</td> </tr></table><span class="postbody">
<br/>
And here's how I'm copying data to BG3:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   memcpy(BG_GFX_SUB,tContainer-&gt;get16(),65536);
<br/>
   memcpy(BG_PALETTE_SUB,tContainer-&gt;getPal(),256);</td> </tr></table><span class="postbody">
<br/>
I think the problem here is BG_GFX_SUB really doesn't tell the code WHICH exrot background to put it on. Both code segments work, just not at the same time. I've seen this method of moving data to the screen used in a lot of examples, but none of them deal with using BOTH backgrounds in mode 5.<br/>_________________<br/><a class="postlink" href="http://www.fireslash.net" target="_blank">FireSlash.net</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145928 - knight0fdragon - Sun Nov 25, 2007 9:01 pm</h4>
    <div class="postbody"><span class="postbody">I am not quite following you here, perhaps both BG code would be nice.  Are you perhaps overwriting your BG graphics?
<br/>
<br/>
BG_GFX_SUB is never going to tell the code which background to put it on, that is your job
<br/>
<br/>
you need to tell BG2 to point to 1 part of BG_GFX_SUB, and tell BG3 to point to another part
<br/>
<br/>
to avoid some of the confusion, do not use BG_GFX_SUB
<br/>
<br/>
use BG_MAP_RAM_SUB(screen) and BG_TILE_RAM_SUB(char)<br/>_________________<br/><a href="http://www.myspace.com/knight0fdragonds" target="_blank">http://www.myspace.com/knight0fdragonds</a>
<br/>
<br/>
MK DS FC: Dragon 330772 075464 
<br/>
AC WW FC: Anthony SamsClub 1933-3433-9458 
<br/>
MPFH: Dragon 0215 4231 1206</span><span class="gensmall"><br/><br/>Last edited by knight0fdragon on Sun Nov 25, 2007 10:23 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#145929 - FireSlash - Sun Nov 25, 2007 10:11 pm</h4>
    <div class="postbody"><span class="postbody">Perhaps you know of some documentation for this? I can't seem to locate any that goes past "Oh, just copy stuff here, don't ask why"<br/>_________________<br/><a class="postlink" href="http://www.fireslash.net" target="_blank">FireSlash.net</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145930 - knight0fdragon - Sun Nov 25, 2007 10:22 pm</h4>
    <div class="postbody"><span class="postbody">no I do not<br/>_________________<br/><a href="http://www.myspace.com/knight0fdragonds" target="_blank">http://www.myspace.com/knight0fdragonds</a>
<br/>
<br/>
MK DS FC: Dragon 330772 075464 
<br/>
AC WW FC: Anthony SamsClub 1933-3433-9458 
<br/>
MPFH: Dragon 0215 4231 1206</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145937 - Lick - Sun Nov 25, 2007 11:34 pm</h4>
    <div class="postbody"><span class="postbody"><a class="postlink" href="http://forum.gbadev.org/viewtopic.php?p=115851#115851" target="_blank">Read this</a>, perhaps it can help you understand the background system better.<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
