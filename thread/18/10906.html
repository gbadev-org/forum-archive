<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>calling sin/cos lut for arcsin/arccos - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > calling sin/cos lut for arcsin/arccos</h2>
<div id="posts">
<div class="post">
    <h4>#99661 - Rajveer - Wed Aug 23, 2006 2:17 am</h4>
    <div class="postbody"><span class="postbody">hi, a while ago i asked about arc sin/cos functions for libnds and somebody said you can use the existing sin/cos luts and go backwards. for future reference, can somebody tell me how to do this?
<br/>
<br/>
cheers</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#99678 - kevinc - Wed Aug 23, 2006 6:27 am</h4>
    <div class="postbody"><span class="postbody">I'm not sure if the code actually works, I'm creating it as I type, but I hope you'll get the idea. It assumes that COS is an array of shorts and that it uses a circle with 512 degrees.
<br/>
Of course, considering it's 8AM here and I haven't slept, it'll be probably horribly broken.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">// comparation function for COS
<br/>
// uses the fact that for [0, 180], cos is ordered from bigger to smaller,
<br/>
// so a binary search can be used.
<br/>
// par = function parameter; lut = position inside the COS lut
<br/>
// because the order is from higher to lower, comparisons are the opposite 
<br/>
// of what you'd normally use (lut[x + 1] &lt;= lut[x])
<br/>
int arccomp(const void *a, const void *b) {
<br/>
    short *par = (short*)a, *lut = (short*)b;
<br/>
    if (*par == *lut ||
<br/>
        (*(lut + 1) &lt; *par &amp;&amp; *par &lt; *lut)) return 0;
<br/>
    else if (*par &lt;= *lut) return 1;
<br/>
    else return -1;
<br/>
}
<br/>
<br/>
// arccos: returns a value in [0, 256]
<br/>
short arccos(short par) {
<br/>
    short *ac = (short*)bsearch(&amp;par, COS, 257, sizeof(short), arccomp); // 257 = size of [0, 256]
<br/>
    if (!ac) ErrorOutOfRange(); // not a real function, do some error handling instead
<br/>
    return ac - COS; // return index of ac in relation to COS, which equals the resulting angle
<br/>
}
<br/>
<br/>
// arcsin: returns a value in [-128, 128]
<br/>
// uses the identity sin(x) = cos(90 - x) =&gt; asin(x) = 90 - acos(x)
<br/>
short arcsin(short par) {
<br/>
    return 128 - arccos(par);
<br/>
}
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
EDIT: added some comments<br/>_________________<br/><a class="postlink" href="http://akzeac.blogspot.com" target="_blank">http://akzeac.blogspot.com</a></span><span class="gensmall"><br/><br/>Last edited by kevinc on Thu Aug 24, 2006 6:39 pm; edited 5 times in total</span></div>    
</div>
<div class="post">
    <h4>#99689 - Rajveer - Wed Aug 23, 2006 9:30 am</h4>
    <div class="postbody"><span class="postbody">ahh cool, so thats how its done! i like to learn as much as i can :)
<br/>
<br/>
thanks again kevinc!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#99693 - kevinc - Wed Aug 23, 2006 10:58 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Rajveer wrote:</b></span></td> </tr> <tr> <td class="quote">ahh cool, so thats how its done! i like to learn as much as i can :)
<br/>
<br/>
thanks again kevinc!</td> </tr></table><span class="postbody">
<br/>
<br/>
You're welcome :)
<br/>
<br/>
<br/>
<br/>
<br/>
/damn, that code is unreadable, I'll comment it later :D<br/>_________________<br/><a class="postlink" href="http://akzeac.blogspot.com" target="_blank">http://akzeac.blogspot.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#99702 - Rajveer - Wed Aug 23, 2006 1:01 pm</h4>
    <div class="postbody"><span class="postbody">when trying to compile the bsearch and erroroutoufrange commands, it gives an implicit declaration of function error. i wasnt sure if i needed any c++ libraries or anything installed as the compiler compiled things like arrays e.t.c. which libraries do i need to install and where can i get them from? do i need something such as visual studio 2005? (which my brother has but i didnt really want to install)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#99704 - kevinc - Wed Aug 23, 2006 1:15 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Rajveer wrote:</b></span></td> </tr> <tr> <td class="quote">when trying to compile the bsearch and erroroutoufrange commands, it gives an implicit declaration of function error. i wasnt sure if i needed any c++ libraries or anything installed as the compiler compiled things like arrays e.t.c. which libraries do i need to install and where can i get them from? do i need something such as visual studio 2005? (which my brother has but i didnt really want to install)</td> </tr></table><span class="postbody">
<br/>
<br/>
bsearch a standard C function, in stdlib.h. Most of the libraries you'll need already come with a standard compiler installation :)
<br/>
If you're using DevkitPro, a text editor is the only extra thing you'll need. You can install an IDE, for example Eclipse, to make programming easier, but it's optional.
<br/>
<br/>
ErrorOutOfRange is not a real function, of course. I meant to say "put there some code that handles an out-of-range error".<br/>_________________<br/><a class="postlink" href="http://akzeac.blogspot.com" target="_blank">http://akzeac.blogspot.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#99712 - Rajveer - Wed Aug 23, 2006 2:35 pm</h4>
    <div class="postbody"><span class="postbody">oh right, cheers! i thought i may not need to install libraries with devkitpro when i first started, but ill install a standard compiler for c++ functions :)
<br/>
<br/>
any compilers you recommend?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#99725 - kevinc - Wed Aug 23, 2006 4:32 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Rajveer wrote:</b></span></td> </tr> <tr> <td class="quote">oh right, cheers! i thought i may not need to install libraries with devkitpro when i first started, but ill install a standard compiler for c++ functions :)
<br/>
<br/>
any compilers you recommend?</td> </tr></table><span class="postbody">
<br/>
<br/>
Um... the compiler that comes with devkitpro? o_o
<br/>
(the compiler that <span style="font-style: italic">is</span> devkitpro?)<br/>_________________<br/><a class="postlink" href="http://akzeac.blogspot.com" target="_blank">http://akzeac.blogspot.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#99737 - Rajveer - Wed Aug 23, 2006 6:00 pm</h4>
    <div class="postbody"><span class="postbody">oh, i thought you meant that i had to install a standard c++ compiler to get the c++ libraries that include code such as bsearch. so once i get a c++ library, how do i include it in my work, with a normal include call? or do i have to set up some environmental variables? (sorry im being such a newb :( )</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#99797 - tepples - Thu Aug 24, 2006 1:30 am</h4>
    <div class="postbody"><span class="postbody">The bsearch() function (along with the rest of &lt;stdlib.h&gt; and &lt;string.h&gt;) is part of Newlib, which comes with each devkitPro architecture package.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#99902 - Rajveer - Thu Aug 24, 2006 6:25 pm</h4>
    <div class="postbody"><span class="postbody">ahh cool thats what i meant, i didnt know that c libraries were included with devkitpro :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#99905 - Rajveer - Thu Aug 24, 2006 6:29 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>kevinc wrote:</b></span></td> </tr> <tr> <td class="quote">return ac - COS; // return index of ac in relation to COS, which equals the resulting angle</td> </tr></table><span class="postbody">
<br/>
<br/>
hmm im not sure i understand this part, wont i just return ac? also ac - COS gives a binary error :S</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#99908 - kevinc - Thu Aug 24, 2006 6:36 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Rajveer wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>kevinc wrote:</b></span></td> </tr> <tr> <td class="quote">return ac - COS; // return index of ac in relation to COS, which equals the resulting angle</td> </tr></table><span class="postbody">
<br/>
<br/>
hmm im not sure i understand this part, wont i just return ac? also ac - COS gives a binary error :S</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Both ac and COS are pointers. ac points to COS[angle], so that ac - COS = angle.
<br/>
<br/>
What's the error that it's giving you? I'm assuming that COS is an array of ints, I may be wrong...
<br/>
<br/>
EDIT: Now that I've checked it, it's actually an array of shorts. I've changed the code to correct that.<br/>_________________<br/><a class="postlink" href="http://akzeac.blogspot.com" target="_blank">http://akzeac.blogspot.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#99976 - Rajveer - Fri Aug 25, 2006 1:30 am</h4>
    <div class="postbody"><span class="postbody">ah cool, cheers for the help. i understand the code now, thanks :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100016 - hellfire - Fri Aug 25, 2006 1:16 pm</h4>
    <div class="postbody"><span class="postbody">consider that a binary-search on the 256-entry table requires 8 memory-accesses, with the first 4 most probably missing cache.<br/>_________________<br/>"The three chief virtues of a programmer are: Laziness, Impatience and Hubris"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100125 - Rajveer - Sat Aug 26, 2006 12:20 pm</h4>
    <div class="postbody"><span class="postbody">yeah but 8 memory accesses is surely less intensive than calculating and angle with an arccos function? (involving multiple multiplications)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100676 - hellfire - Tue Aug 29, 2006 2:59 pm</h4>
    <div class="postbody"><span class="postbody"><span style="font-weight: bold">"The ARM9E core sustains one 16x16 or 16x32 multiply-accumulate (MAC) per cycle"</span>
<br/>
but the situation is not as good with ram.
<br/>
so at the end a good integer-approximation could actually be faster.<br/>_________________<br/>"The three chief virtues of a programmer are: Laziness, Impatience and Hubris"</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
