<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>3D Problem - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > 3D Problem</h2>
<div id="posts">
<div class="post">
    <h4>#174878 - m2 - Wed Jul 28, 2010 12:55 pm</h4>
    <div class="postbody"><span class="postbody">Hello, i have been playing around with 3D a bit, trying to get alpha blending to work, but there seems to be no way i can get rid of the flickering that seem to occur when i rotate my alpha blended cube.. I assume this might be some type of sorting problem, but i don't know how to solve it. Hope someone can help me out a bit in case there is something i have missed.
<br/>
<br/>
Here is the code:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include &lt;nds.h&gt;
<br/>
<br/>
int DrawGLScene();
<br/>
<br/>
float rot;
<br/>
int main() {   
<br/>
   
<br/>
   // Setup the Main screen for 3D 
<br/>
   videoSetMode(MODE_0_3D);
<br/>
   
<br/>
   // initialize the geometry engine
<br/>
   glInit();
<br/>
   
<br/>
<br/>
   glEnable(GL_BLEND);
<br/>
   
<br/>
   // setup the rear plane
<br/>
   glClearColor(0,0,0,31); // BG must be opaque for AA to work
<br/>
   glClearPolyID(63); // BG must have a unique polygon ID for AA to work
<br/>
   glClearDepth(0x7FFF);
<br/>
   
<br/>
   // Set our viewport to be the same size as the screen
<br/>
   glViewport(0,0,255,191);
<br/>
   
<br/>
   glMatrixMode(GL_PROJECTION);
<br/>
   glLoadIdentity();
<br/>
   gluPerspective(70, 256.0 / 192.0, 0.1, 100);
<br/>
<br/>
   
<br/>
   while (1) 
<br/>
   {
<br/>
      // Set the current matrix to be the model matrix
<br/>
      glMatrixMode(GL_MODELVIEW);
<br/>
      
<br/>
      //Push our original Matrix onto the stack (save state)
<br/>
      glPushMatrix();   
<br/>
<br/>
      DrawGLScene();
<br/>
      
<br/>
      // Pop our Matrix from the stack (restore state)
<br/>
      glPopMatrix(1);
<br/>
<br/>
      // flush to screen   
<br/>
      glFlush(0);
<br/>
      
<br/>
      // wait for the screen to refresh
<br/>
      swiWaitForVBlank();
<br/>
   
<br/>
   }
<br/>
   
<br/>
   return 0;
<br/>
}
<br/>
<br/>
int DrawGLScene()                                 // Here's Where We Do All The Drawing
<br/>
{
<br/>
   glLoadIdentity();                           // Reset The Current Modelview Matrix
<br/>
   glTranslatef(0.0f,0.0f,-3.0f);                  // Move Left 1.5 Units And Into The Screen 6.0
<br/>
   glRotatef(rot,1.0f,1.0f,1.0f);                  // Rotate The Triangle On The Y axis ( NEW )
<br/>
glPolyFmt(POLY_ID(0)|POLY_ALPHA(15) | POLY_CULL_NONE );
<br/>
glBegin(GL_QUADS);
<br/>
      glColor3f(0.0f,1.0f,0.0f);         // Set The Color To Green
<br/>
      glVertex3f( 1.0f, 1.0f,-1.0f);         // Top Right Of The Quad (Top)
<br/>
      glVertex3f(-1.0f, 1.0f,-1.0f);         // Top Left Of The Quad (Top)
<br/>
      glVertex3f(-1.0f, 1.0f, 1.0f);         // Bottom Left Of The Quad (Top)
<br/>
      glVertex3f( 1.0f, 1.0f, 1.0f);         // Bottom Right Of The Quad (Top)
<br/>
<br/>
glEnd();
<br/>
glPolyFmt(POLY_ID(1)|POLY_ALPHA(15) | POLY_CULL_NONE );
<br/>
glBegin(GL_QUADS);
<br/>
      glColor3f(1.0f,0.5f,0.0f);         // Set The Color To Orange
<br/>
      glVertex3f( 1.0f,-1.0f, 1.0f);         // Top Right Of The Quad (Bottom)
<br/>
      glVertex3f(-1.0f,-1.0f, 1.0f);         // Top Left Of The Quad (Bottom)
<br/>
      glVertex3f(-1.0f,-1.0f,-1.0f);         // Bottom Left Of The Quad (Bottom)
<br/>
      glVertex3f( 1.0f,-1.0f,-1.0f);         // Bottom Right Of The Quad (Bottom)
<br/>
<br/>
glEnd();
<br/>
glPolyFmt(POLY_ID(2)|POLY_ALPHA(15) | POLY_CULL_NONE );
<br/>
glBegin(GL_QUADS);
<br/>
      glColor3f(1.0f,0.0f,0.0f);         // Set The Color To Red
<br/>
      glVertex3f( 1.0f, 1.0f, 1.0f);         // Top Right Of The Quad (Front)
<br/>
      glVertex3f(-1.0f, 1.0f, 1.0f);         // Top Left Of The Quad (Front)
<br/>
      glVertex3f(-1.0f,-1.0f, 1.0f);         // Bottom Left Of The Quad (Front)
<br/>
      glVertex3f( 1.0f,-1.0f, 1.0f);         // Bottom Right Of The Quad (Front)
<br/>
<br/>
glEnd();
<br/>
glPolyFmt(POLY_ID(3)|POLY_ALPHA(15) | POLY_CULL_NONE );
<br/>
glBegin(GL_QUADS);
<br/>
      glColor3f(1.0f,1.0f,0.0f);         // Set The Color To Yellow
<br/>
      glVertex3f( 1.0f,-1.0f,-1.0f);         // Bottom Left Of The Quad (Back)
<br/>
      glVertex3f(-1.0f,-1.0f,-1.0f);         // Bottom Right Of The Quad (Back)
<br/>
      glVertex3f(-1.0f, 1.0f,-1.0f);         // Top Right Of The Quad (Back)
<br/>
      glVertex3f( 1.0f, 1.0f,-1.0f);         // Top Left Of The Quad (Back)
<br/>
<br/>
glEnd();
<br/>
glPolyFmt(POLY_ID(4)|POLY_ALPHA(15) | POLY_CULL_NONE );
<br/>
glBegin(GL_QUADS);
<br/>
      glColor3f(0.0f,0.0f,1.0f);         // Set The Color To Blue
<br/>
      glVertex3f(-1.0f, 1.0f, 1.0f);         // Top Right Of The Quad (Left)
<br/>
      glVertex3f(-1.0f, 1.0f,-1.0f);         // Top Left Of The Quad (Left)
<br/>
      glVertex3f(-1.0f,-1.0f,-1.0f);         // Bottom Left Of The Quad (Left)
<br/>
      glVertex3f(-1.0f,-1.0f, 1.0f);         // Bottom Right Of The Quad (Left)
<br/>
<br/>
glEnd();
<br/>
glPolyFmt(POLY_ID(5)|POLY_ALPHA(15) | POLY_CULL_NONE );
<br/>
glBegin(GL_QUADS);
<br/>
      glColor3f(1.0f,0.0f,1.0f);         // Set The Color To Violet
<br/>
      glVertex3f( 1.0f, 1.0f,-1.0f);         // Top Right Of The Quad (Right)
<br/>
      glVertex3f( 1.0f, 1.0f, 1.0f);         // Top Left Of The Quad (Right)
<br/>
      glVertex3f( 1.0f,-1.0f, 1.0f);         // Bottom Left Of The Quad (Right)
<br/>
      glVertex3f( 1.0f,-1.0f,-1.0f);         // Bottom Right Of The Quad (Right)
<br/>
<br/>
glEnd();
<br/>
   rot+=0.2f;                                 // Increase The Rotation Variable For The Triangle ( NEW )
<br/>
   return TRUE;                              // Keep Going
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#174879 - elhobbs - Wed Jul 28, 2010 2:07 pm</h4>
    <div class="postbody"><span class="postbody">I think you want to take a look at the parameters to glFlush which is a wrapper for <a class="postlink" href="http://nocash.emubase.de/gbatek.htm#ds3ddisplaycontrol" target="_blank">SWAP_BUFFERS</a>. I am thinking you are going to want to manually sort the transparent polys - so glFlush(1) may give better results.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#174881 - m2 - Wed Jul 28, 2010 3:33 pm</h4>
    <div class="postbody"><span class="postbody">Ok thank you, i will try that. Guess i will have to write some code to sort by Z order for every frame after new rotation?</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
