<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>DBMS : SQLite on my DS - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > DBMS : SQLite on my DS</h2>
<div id="posts">
<div class="post">
    <h4>#160485 - ferrand.d - Wed Jul 16, 2008 8:32 pm</h4>
    <div class="postbody"><span class="postbody">Hi all !
<br/>
<br/>
I decided to continue the project LMP-ng (the iPod clone) and add some new features. I'm trying to add SQLite to my project to manage my playlist, but I couldn't. In fact, I don't know how to add a library to my project, how to put the files...
<br/>
<br/>
I tried to add those three files (<a class="postlink" href="http://www.sqlite.org/sqlite-amalgamation-3_6_0.zip" target="_blank">http://www.sqlite.org/sqlite-amalgamation-3_6_0.zip</a>) directly in my source directory, but I got these errors :
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:14010: error: expected specifier-qualifier-list before 'pthread_mutex_t'
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c: In function 'pthreadMutexAlloc':
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:14098: error: 'PTHREAD_MUTEX_INITIALIZER' undeclared (first use in this function)
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:14098: error: (Each undeclared identifier is reported only once
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:14098: error: for each function it appears in.)
<br/>
cc1: warnings being treated as errors
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:14098: error: excess elements in struct initializer
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:14098: error: (near initialization for 'staticMutexes[0]')
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:14098: error: excess elements in struct initializer
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:14098: error: (near initialization for 'staticMutexes[0]')
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:14098: error: excess elements in struct initializer
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:14098: error: (near initialization for 'staticMutexes[0]')
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:14098: error: 'pthread_t' undeclared (first use in this function)
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:14098: error: excess elements in struct initializer
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:14098: error: (near initialization for 'staticMutexes[0]')
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:14098: error: expected '}' before numeric constant
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:14098: error: excess elements in struct initializer
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:14098: error: (near initialization for 'staticMutexes[0]')
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:14099: error: extra brace group at end of initializer
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:14099: error: (near initialization for 'staticMutexes[0]')
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:14099: error: expected '}' before numeric constant
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:14100: error: extra brace group at end of initializer
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:14100: error: (near initialization for 'staticMutexes[0]')
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:14100: error: expected '}' before numeric constant
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:14101: error: extra brace group at end of initializer
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:14101: error: (near initialization for 'staticMutexes[0]')
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:14101: error: expected '}' before numeric constant
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:14102: error: extra brace group at end of initializer
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:14102: error: (near initialization for 'staticMutexes[0]')
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:14102: error: expected '}' before numeric constant
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:14103: error: extra brace group at end of initializer
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:14103: error: (near initialization for 'staticMutexes[0]')
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:14103: error: expected '}' before numeric constant
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:14116: error: 'pthread_mutexattr_t' undeclared (first use in this function)
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:14116: error: expected ';' before 'recursiveAttr'
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:14117: error: 'recursiveAttr' undeclared (first use in this function)
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:14118: error: 'PTHREAD_MUTEX_RECURSIVE' undeclared (first use in this function)
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:14119: error: 'sqlite3_mutex' has no member named 'mutex'
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:14122: error: 'sqlite3_mutex' has no member named 'id'
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:14129: error: 'sqlite3_mutex' has no member named 'id'
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:14130: error: 'sqlite3_mutex' has no member named 'mutex'
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:14138: error: 'sqlite3_mutex' has no member named 'id'
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c: In function 'pthreadMutexFree':
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:14154: error: 'sqlite3_mutex' has no member named 'mutex'
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c: In function 'pthreadMutexEnter':
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:14197: error: 'sqlite3_mutex' has no member named 'mutex'
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:14198: error: 'sqlite3_mutex' has no member named 'owner'
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:14199: error: 'sqlite3_mutex' has no member named 'nRef'
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:14199: error: lvalue required as increment operand
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c: In function 'pthreadMutexTry':
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:14240: error: 'sqlite3_mutex' has no member named 'mutex'
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:14241: error: 'sqlite3_mutex' has no member named 'owner'
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:14242: error: 'sqlite3_mutex' has no member named 'nRef'
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:14242: error: lvalue required as increment operand
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c: In function 'pthreadMutexLeave':
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:14265: error: 'sqlite3_mutex' has no member named 'nRef'
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:14265: error: lvalue required as decrement operand
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:14273: error: 'sqlite3_mutex' has no member named 'mutex'
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:17281:3: error: #error SQLite will not work correctly with the -ffast-math option of GCC.
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c: At top level:
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:20216: error: expected specifier-qualifier-list before 'pthread_t'
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:20615: error: expected specifier-qualifier-list before 'pthread_t'
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c: In function 'testThreadLockingBehavior':
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:20817: error: 'pthread_t' undeclared (first use in this function)
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:20817: error: expected ';' before 't'
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:20829: error: 't' undeclared (first use in this function)
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c: In function 'findLockInfo':
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:20980: error: 'struct lockKey' has no member named 'tid'
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c: In function 'transferOwnership':
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:21075: error: 'pthread_t' undeclared (first use in this function)
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:21075: error: expected ';' before 'hSelf'
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:21080: error: 'hSelf' undeclared (first use in this function)
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:21081: error: 'unixFile' has no member named 'tid'
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:21092: error: 'unixFile' has no member named 'tid'
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c: In function 'unixUnlock':
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:21679: error: 'unixFile' has no member named 'tid'
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c: In function 'fillInUnixFile':
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:22411: error: 'unixFile' has no member named 'tid'
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:22828:19: error: dlfcn.h: No such file or directory
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c: In function 'unixDlOpen':
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:22830: error: 'RTLD_NOW' undeclared (first use in this function)
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:22830: error: 'RTLD_GLOBAL' undeclared (first use in this function)
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:22830: error: invalid operands to binary | (have 'struct sqlite3_mutex *' and 'struct sqlite3_mutex *')
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:22830: error: return makes pointer from integer without a cast
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c: In function 'unixDlError':
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:22843: error: assignment makes pointer from integer without a cast
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c: In function 'unixDlSym':
<br/>
/home/nios/Documents/autres_fichiers/projets/programmation/ds/lmp-ng/arm9/source/sqlite3.c:22850: error: return makes pointer from integer without a cast</td> </tr></table><span class="postbody">
<br/>
<br/>
How can I do ?
<br/>
Thanks for your help !</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160493 - silent_code - Wed Jul 16, 2008 8:49 pm</h4>
    <div class="postbody"><span class="postbody">That translates to: Lots of missing posix / unix libraries (and thus headers).
<br/>
So, unless you port them over, too, there's nothing you can do. Also, I doubt you want to have full threads (pthreads) running on the little NDS.
<br/>
<br/>
Sorry. :^(
<br/>
<br/>
Try a different implementation or create some offline (PC / Mac) converter, that outputs some data you can parse with custom routines (which you would have to write.)
<br/>
<br/>
Good luck.<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160494 - ferrand.d - Wed Jul 16, 2008 8:51 pm</h4>
    <div class="postbody"><span class="postbody">Okay thanks for you reply
<br/>
That's unfortunately what I thought...
<br/>
<br/>
I'm gonna find another solution ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160497 - naleksiev - Wed Jul 16, 2008 9:07 pm</h4>
    <div class="postbody"><span class="postbody">Try adding
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define SQLITE_THREADSAFE 0
<br/>
#define OS_OTHER</td> </tr></table><span class="postbody">
<br/>
<br/>
In my case I just added them in the make file like this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">-DSQLITE_THREADSAFE=0 -DOS_OTHER</td> </tr></table><span class="postbody">
<br/>
<br/>
And I end up with just a few warnings!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160509 - ferrand.d - Wed Jul 16, 2008 11:03 pm</h4>
    <div class="postbody"><span class="postbody">Thanks very much naleksiev, I added
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define SQLITE_THREADSAFE 0
<br/>
#define SQLITE_OMIT_LOAD_EXTENSION
<br/>
#define OS_OTHER</td> </tr></table><span class="postbody">
<br/>
in the top of the file, and there are much less errors, but I still cannot compile :
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">sqlite3.o: In function `unixSleep':
<br/>
sqlite3.c:(.text+0x56c0): undefined reference to `sleep'
<br/>
sqlite3.o: In function `unixSync':
<br/>
sqlite3.c:(.text+0x57b8): undefined reference to `fsync'
<br/>
sqlite3.c:(.text+0x57d8): undefined reference to `fsync'
<br/>
sqlite3.o: In function `unixTruncate':
<br/>
sqlite3.c:(.text+0x5ca8): undefined reference to `ftruncate'
<br/>
sqlite3.o: In function `unixDelete':
<br/>
sqlite3.c:(.text+0x14790): undefined reference to `fsync'</td> </tr></table><span class="postbody">
<br/>
<br/>
I think I must replace these Unix functions, but what are the equivalent in libnds ?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160510 - Lazy1 - Wed Jul 16, 2008 11:20 pm</h4>
    <div class="postbody"><span class="postbody">I'm actually looking for ftruncate as well since it's required by libsndfile.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160512 - naleksiev - Thu Jul 17, 2008 12:08 am</h4>
    <div class="postbody"><span class="postbody">I actually downloaded by mistake a little older version and that's why it's working for me :)
<br/>
<br/>
Try building it with 2.5.9 instead of 2.6.0</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160549 - ferrand.d - Thu Jul 17, 2008 5:25 pm</h4>
    <div class="postbody"><span class="postbody">I tried with 2.5.9 and I added
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define SQLITE_THREADSAFE 0
<br/>
#define OS_OTHER 1</td> </tr></table><span class="postbody">
<br/>
in the top of the file (without the 1 there were again errors)
<br/>
<br/>
... and now it works fine ! Thanks very much to all and especially naleksiev
<br/>
;)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
