<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Alpha-colored 3d particles - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > Alpha-colored 3d particles</h2>
<div id="posts">
<div class="post">
    <h4>#145874 - melw - Sat Nov 24, 2007 12:45 pm</h4>
    <div class="postbody"><span class="postbody">Last night I played around with some alpha-blended particles in MODE_0_3D. Using RGB8_A5 texture format is otherwise ok, but the 8 color palette doesn't give much freedom while I wanted to pick the particle color freely from all the 32k possible values. In the end I came up with one solution (which some of you may consider a dirty hack): Filling the entire VRAM bank E with all the colors, create 8 otherwise identical particle textures, only each of them using different color from the "8 color palette" and set palette pointer manually when drawing to get the right color.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define NUM_TEXTURES 8
<br/>
int textureIds[NUM_TEXTURES];
<br/>
<br/>
u8 *textureData[NUM_TEXTURES]; 
<br/>
<br/>
// particle texture loading etc. 
<br/>
<br/>
for(int i=0;i&lt;NUM_TEXTURES;i++)
<br/>
{
<br/>
   glBindTexture(0, textureIds[i]);
<br/>
   glTexImage2D(0, 0, GL_RGB8_A5, TEXTURE_SIZE_32, TEXTURE_SIZE_32, 0, TEXGEN_TEXCOORD, (u8*)textureData[i]);
<br/>
}
<br/>
<br/>
u16 *palData = (u16*)malloc(32*32*32);
<br/>
for(r=0;r&lt;32;r++) // generate all 15bit colors into one large palette
<br/>
{
<br/>
   for(g=0;g&lt;32;g++)
<br/>
   {
<br/>
      for(b=0;b&lt;32;b++)
<br/>
      {
<br/>
         palData[r*1024+g*32+b] = RGB15(r,g,b);
<br/>
      }
<br/>
   }
<br/>
}
<br/>
glTexLoadPal(palData, 32768, 0);
<br/>
<br/>
// when drawing a particle - color is integer between 0...32768
<br/>
glBindTexture(0, textureIds[textureId+(color&amp;7)]);
<br/>
GFX_PAL_FORMAT = color&gt;&gt;4;
<br/>
glBegin(GL_QUAD);
<br/>
// ... rest of the draw code
<br/>
</td> </tr></table><span class="postbody">
<br/>
If you know how to do this better or otherwise, feel free to comment. Wasting half of the VRAM bank E for oversized palette data feels stupid, but at least it works. :)
<br/>
<br/>
<a class="postlink" href="http://www.veljeskunta.org/melwyn/nds/3dtests.zip" target="_blank">test src + nds</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145881 - Lick - Sat Nov 24, 2007 4:14 pm</h4>
    <div class="postbody"><span class="postbody">If you want to modulate texture color with vertex color, use glMaterialf(GL_EMISSION, RGB15(31,0,0));. Here, the texture will be modulated with red. Default should be 0x7FFF (white).
<br/>
<br/>
This way, you can use greyscale+alpha textures modulated with the particle's color.<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145882 - melw - Sat Nov 24, 2007 5:37 pm</h4>
    <div class="postbody"><span class="postbody">Thanks! Reduced palette size from 32kb to 8 bytes and texture count from 8 to 1.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
