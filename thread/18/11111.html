<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Best way to approach a GUI on the DS? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Best way to approach a GUI on the DS?</h2>
<div id="posts">
<div class="post">
    <h4>#102233 - TJ - Tue Sep 12, 2006 2:44 am</h4>
    <div class="postbody"><span class="postbody">I have recently started taking a more serious approach to DS development now that the WiFi lib is progressing, and have gotten to the point that I would like to move past the simple printf interfaces I have been using so far.
<br/>
<br/>
Now, keep in mind, not only am I new to DS development; but I have never programmed anything but console applications in C/C++ on the PC as well. I have always felt content with text interfaces for my PC programs. So I am not terribly well prepared for a totally graphical program, but I clearly see that I need to move on to realize my program ideas.
<br/>
<br/>
My first thought after looking though the examples from libnds, was to draw a full screen bitmap of my interface and then overlay text on it with the console.
<br/>
<br/>
But trying it, I soon found that:
<br/>
1. I could never manage to print console text over a bitmap (by the way, anyone want to provide some sample code for this? I know it should be easy, but I would always get corrupted text/images when I try)
<br/>
2. The console is really too limited for any serious GUI
<br/>
<br/>
I have pretty much resolved the fact that I will need to figure out some sort of font drawing routine, which only complicates matters for me, to be honest.
<br/>
<br/>
So I figured I would just ask straight out the best way to do this.
<br/>
<br/>
Should I have the background of the GUI drawn as a bitmap, and then overlay text/buttons as sprites; or should I use the frame buffer, and draw everything that way?
<br/>
<br/>
And at the same time, are there any guides or example code that really cover how to do a serious UI, and not just print "Hello World" on a black background? Or at least how to create a font routine that will let me draw decent looking text at arbitrary positions on both screens simultaneously?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102234 - sajiimori - Tue Sep 12, 2006 2:59 am</h4>
    <div class="postbody"><span class="postbody">Start with "easy", then work on "fast".  Writing a GUI system that's purely for bitmap modes will be much simpler.  No attribute registers or VRAM concerns -- just pixels.
<br/>
<br/>
Sprites and tiled backgrounds will be good optimizations later on.
<br/>
<br/>
I have some decent code for an SDL-based GUI system (which can easily translate to anything with a framebuffer) from a few years ago.  If I had to do it over, I'd take almost the same approach, architecturally.  PM me if you're interested.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102250 - abszero - Tue Sep 12, 2006 9:08 am</h4>
    <div class="postbody"><span class="postbody">I've got code that does a text/tile mode GUI on BG1 overlayed with the default console on BG0 if that's of any use.  It runs both under no$GBA 2.3 and on my DS Lite as presented (though I didn't provide the graphics files so you can't compile exactly as is).  Comments are sparse since most things are fairly self-documenting, but if something confuses you I'll try to clarify.
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include &lt;nds.h&gt;
<br/>
 
<br/>
#include &lt;nds/arm9/console.h&gt; //basic print funcionality
<br/>
#include &lt;stdio.h&gt;
<br/>
#include &lt;string.h&gt;
<br/>
<br/>
#include "res/gui.palette.cpp"
<br/>
#include "res/gui.tiles.cpp"
<br/>
#include "res/blank.map.cpp"
<br/>
<br/>
<br/>
// Memory bases for the tiles and maps of each layer - values mostly don't matter for this example as long as they're not overlapping
<br/>
const int char_base_bg0 = 0;
<br/>
const int char_base_bg1 = 1;
<br/>
const int screen_base_bg0 = 31;
<br/>
const int screen_base_bg1 = 20;
<br/>
uint16* tile_bg0 = (uint16*)CHAR_BASE_BLOCK(char_base_bg0);
<br/>
uint16* tile_bg1 = (uint16*)CHAR_BASE_BLOCK(char_base_bg1);
<br/>
uint16* map_bg0  = (uint16*)SCREEN_BASE_BLOCK(screen_base_bg0);
<br/>
uint16* map_bg1  = (uint16*)SCREEN_BASE_BLOCK(screen_base_bg1);
<br/>
<br/>
<br/>
<br/>
// Dummy handler (if not present, runs in emu but not hardware)
<br/>
void irqVBlank() {;}
<br/>
<br/>
int main() {
<br/>
<br/>
   powerON(POWER_ALL_2D);
<br/>
<br/>
   irqInit();
<br/>
   irqSet(IRQ_VBLANK, irqVBlank);
<br/>
   irqEnable(IRQ_VBLANK);
<br/>
<br/>
   //enable vram and map it to the right places
<br/>
   vramSetMainBanks( VRAM_A_MAIN_BG_0x6000000, VRAM_B_LCD, VRAM_C_LCD, VRAM_D_LCD);
<br/>
   
<br/>
   //set the video mode
<br/>
   videoSetMode( MODE_5_2D | 
<br/>
                DISPLAY_BG0_ACTIVE |   
<br/>
                DISPLAY_BG1_ACTIVE |
<br/>
                DISPLAY_SPR_1D   );
<br/>
<br/>
   BG0_CR = BG_COLOR_16  | BG_TILE_BASE(char_base_bg0) | BG_MAP_BASE(screen_base_bg0);
<br/>
   BG1_CR = BG_COLOR_256 | BG_TILE_BASE(char_base_bg1) | BG_MAP_BASE(screen_base_bg1);
<br/>
<br/>
   BG_PALETTE[255] = RGB15(0,0,0); // font color
<br/>
   consoleInitDefault(map_bg0, tile_bg0, 16);
<br/>
<br/>
   // copy the palette, tiles, and map to their respective places 
<br/>
   dmaCopy(gui_palette, BG_PALETTE, sizeof(gui_palette));
<br/>
   dmaCopy(gui_tiles, tile_bg1, sizeof(gui_tiles));
<br/>
   dmaCopy(blank_map, map_bg1, sizeof(blank_map));
<br/>
<br/>
   while(1) {
<br/>
<br/>
      swiWaitForVBlank();
<br/>
<br/>
      scanKeys();
<br/>
      touchPosition touch = touchReadXY();
<br/>
<br/>
      iprintf("\x1b[0;18Hkeys: %08X\n", keysHeld());
<br/>
      if (touch.px || touch.py)
<br/>
         iprintf("\x1b[0;0H(%d,%d)      ",touch.px,touch.py);
<br/>
      else
<br/>
         iprintf("\x1b[0;0H             ",touch.px,touch.py);
<br/>
<br/>
   }
<br/>
<br/>
   return 0;
<br/>
}
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
To respond to your more general question about GUI implementation, I would say that the answer depends on how what your GUI needs to do maps to the available graphics modes (unless you go with a fully bitmapped/framebuffer mode as sajiimori suggested).  
<br/>
<br/>
For example, I'm working on the GUI of a Japanese dictionary suite at the moment.  The top screen will be where search results will be displayed (so mostly japanese text display) and the bottom screen will be where the user inputs things by clicking buttons, typing on keyboards, hand writing characters, etc.  
<br/>
<br/>
Both screens will need to support at least one layer of a bitmap-like mode I have decided; for displaying large amounts of text on the top screen and a stylus drawing pad for handwriting recognition on the bottom.  At the same time, implementing the rest of the GUI in a bitmap mode seems like a bit of a hassle to me (personal preference), so instead I'm doing it with tiles (the background panels, etc) and sprites (indicators, buttons, and some special bits of text).  Therefore, I ended up using MODE_5_2D since it supports both text/tile and exrot/bitmap layers like I need.
<br/>
<br/>
So as it stands:
<br/>
Top Screen - MODE_5_2D:
<br/>
  BG0 (Tile):  Console for Debugging
<br/>
  BG1 (Tile):  GUI Panels
<br/>
  BG2 (Bitmap):  Japanese Text
<br/>
Bottom Screen - MODE_5_2D:
<br/>
  Sprites: Selected buttons, widgets, etc
<br/>
  BG0 (Tile): Text indicators
<br/>
  BG1 (Tile): GUI Panels
<br/>
  BG2 (Bitmap): Handwriting Display
<br/>
<br/>
As another quick example of basing the design around the available hardware, I'm using some sprites on the bottom screen basically to implement a very limited font.  But on the text-heavy top screen, that's not really an option as I'll almost certainly have more than 128 characters to display up there and would run out of sprites.  So on the top screen, text will be handled via a font routine writing to a bitmap layer instead.  Etc.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102258 - memoni - Tue Sep 12, 2006 10:40 am</h4>
    <div class="postbody"><span class="postbody">The IMGUI concept is pretty fast things to get your GUI up and running in no time:
<br/>
<br/>
<a href="http://sol.gfxile.net/imgui/" target="_blank">http://sol.gfxile.net/imgui/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102259 - headspin - Tue Sep 12, 2006 10:50 am</h4>
    <div class="postbody"><span class="postbody">I think quite a few people just use bitmap mode for simple gui's like game menus and just read the coords of the stylus. You can have a sprite to indicate the selection over the button, or have a hand, pen cursor sprite.
<br/>
<br/>
If you need dynamic text, tile mode is probably a better way and that means you can keep a background for overlaying text on buttons and such if you need dynamic text.
<br/>
<br/>
I'm not 100% sure, but I think 0xtob could be using bitmap mode with Nitro Tracker. While it looks like it uses tiles, the controls don't line up in 8x8 tiles, that is because he uses his own dynamic controls that are drawn himself. It would be nice to hear how he does it, but it's not difficult to draw text in bitmap mode, you just have to remember that you will need to convert your font using gfx2gba using the -c32k switch. Then you can just overlay the font to the bitmap background by ORing the font characters onto the screen remembering your dealing with 16 bit data (X1B5G5R5) without a palette.<br/>_________________<br/><a class="postlink" href="http://headsoft.com.au/index.php?category=warhawk" target="_blank">Warhawk DS</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=mmll" target="_blank">Manic Miner: The Lost Levels</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=tdg" target="_blank">The Detective Game</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102265 - 0xtob - Tue Sep 12, 2006 12:29 pm</h4>
    <div class="postbody"><span class="postbody">Yep, the GUI system I coded for NitroTracker uses framebuffer for nearly everything except the for (music and text) keyboards. I have a function that prints text with dynamic-width characters on the GUI elements. I guess it's similar to libfb by DragonMinded, but less flexible. I guess you could check libfb out, TJ.
<br/>
<br/>
A gui system is really simple and fun to code (if you are motivated for it, of course). You need one main class that draws the screen and handles the input (i.e. that knows which widget is where and then notifies the correct widget of a pendown/penup/penmove event) and then you can design your widget classes that can draw themselves and react to input.
<br/>
<br/>
I have plans on open-sourcing my GUI kit, but first I want to make it more flexible, for example by changing it to use an 8 bit paletted background (I currently use 16bit). So, it will take some time.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102280 - GPFerror - Tue Sep 12, 2006 4:31 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">Start with "easy", then work on "fast".  Writing a GUI system that's purely for bitmap modes will be much simpler.  No attribute registers or VRAM concerns -- just pixels.
<br/>
<br/>
Sprites and tiled backgrounds will be good optimizations later on.
<br/>
<br/>
I have some decent code for an SDL-based GUI system (which can easily translate to anything with a framebuffer) from a few years ago.  If I had to do it over, I'd take almost the same approach, architecturally.  PM me if you're interested.</td> </tr></table><span class="postbody">
<br/>
<br/>
Just curious if you have tried to compile it with my port of the SDL lib to the ds?
<br/>
<br/>
Troy(GPF)
<br/>
<a href="http://gpf.dcemu.co.uk" target="_blank">http://gpf.dcemu.co.uk</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102297 - DekuTree64 - Tue Sep 12, 2006 6:52 pm</h4>
    <div class="postbody"><span class="postbody">I've been doing the GUI for my tracker in tile mode. Basically I just draw bitmaps of all my menus, making sure the controls are aligned to 8 pixels. Then I draw any text on in the program, using a slightly modified libnds console (just added a function to set the dest screen map, and palette to use).
<br/>
<br/>
Making buttons visually press down only involves swapping palettes, although swapping which chars the map data points to would work just as well. Some controls use sprites too, like scrollbars.
<br/>
<br/>
I'll probably eventually eliminate the bitmap step and just draw the controls dynamically from 3x3 char "template" bitmaps. But while I'm still working out the menu layouts, bitmaps are easier.
<br/>
<br/>
As for the actual code, most of the controls handle input and drawing themselves, and have a callback pointer that they call whenever their value changes (pretty similar to C-style windows API). So basically all a menu has to do is define all the controls it wants, and have a callback function with a big switch statement to set whatever variable each control affects.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102351 - TJ - Wed Sep 13, 2006 3:54 am</h4>
    <div class="postbody"><span class="postbody">My ideas where sort of a combination of what you all said. Do a bitmap background, and handle buttons and indicators as sprites or drawn on with FB routines. Good to know I wasn't thinking in a totally wrong direction, at least.
<br/>
<br/>
I am going to take a look at libfb, the final result certainly looks nice; and from my brief looks over the WiFi Chat source, it doesn't look to hard to handle. Anyone have any thoughts for or against it?
<br/>
<br/>
I should be clear, if I wasn't initially, that I have absolutely no interest in developing games for the DS. I am only interested in doing actual applications, so with that in mind, something like libfb seems to be well suited to my needs, or at least, it does in my head.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#103727 - Patater - Sun Sep 24, 2006 5:48 am</h4>
    <div class="postbody"><span class="postbody">I wrote up a graphics mode independent GUI kit in C++, designed with the DS in mind. You can check it out at <a href="http://www.patatersoft.info/guikit.html" target="_blank">http://www.patatersoft.info/guikit.html</a>
<br/>
<br/>
Basically, I provide classes for the most primitive GUI widgets. You use these primitives to create your own custom widgets, simply by inheriting from them and implementing a few paint functions and input handlers.
<br/>
<br/>
It is very easy to make dynamic GUIs (moving buttons and scroll bars, etc) with my kit, but if all you are looking for is static, it is still a nice choice. It is easy to make a map of tiles and a collision map where upon different tile presses perform different activities for static GUIs though.
<br/>
<br/>
This GUI Kit together with libfb for the graphics portion is probably a fine bet.
<br/>
<br/>
I hope you might find this GUI kit useful. Cheers!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#103918 - El Hobito - Mon Sep 25, 2006 12:06 pm</h4>
    <div class="postbody"><span class="postbody">ever considered using palib?  <a class="postlink" href="http://www.palib.com" target="_blank">www.palib.com</a>  this makes life much easier and will allow you to concentrate more on getting a good interface rather than messing around with code</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104178 - TJ - Tue Sep 26, 2006 11:04 pm</h4>
    <div class="postbody"><span class="postbody">I had looked into PALib when it was first announced...and it just isn't something I am interested in. I want more control than it would offer me.
<br/>
<br/>
I have been using libFB since it was suggested here, and I am having pretty good results, though I am still in the concept phase for most of my ideas.
<br/>
<br/>
When I get a chance, I will take a look at your project, Patater. I haven't done any advanced GUI work yet, still just simple stuff; but I will be eventually.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
