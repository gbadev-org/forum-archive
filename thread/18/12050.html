<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>no$gba debug function - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > no$gba debug function</h2>
<div id="posts">
<div class="post">
    <h4>#113685 - MrK - Fri Dec 29, 2006 7:06 pm</h4>
    <div class="postbody"><span class="postbody">Hi!
<br/>
<br/>
I'm using no$gba to debug. I have the following function to trigger a software breakpoint, which creates code to generate a mov r11,r11 and then return back to appBkp. 
<br/>
 appBkp is always an ARM function
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
char NOGBAcode[4096];
<br/>
<br/>
void appBkp (void)
<br/>
{
<br/>
char *ptr=NOGBAcode;
<br/>
<br/>
   // breakpoint mov r11,r11
<br/>
   *(int *)ptr=0xe1a0b00b; ptr+=4;      // mov r11,r11
<br/>
   *(int *)ptr=0xe12fff1e; ptr+=4;      // bx lr
<br/>
<br/>
   ((void (*)(void))NOGBAcode)();           // call code
<br/>
} 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
the thing is that it works on no$gba emulator (breaks into debugger), works on other emulators (but it's ignored), however in real hardware hangs the console. Any ideas? Maybe a cache problem?
<br/>
<br/>
TIA!
<br/>
<br/>
p.s. yes, I know I can do that function in assembler, however I'd like to get it done in C (appLog is giving me some other functions, and I don't feel like doing the %s %x %d replacement in assembler for a test app)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113686 - Mighty Max - Fri Dec 29, 2006 7:20 pm</h4>
    <div class="postbody"><span class="postbody">Yes, whenever you alter code to execute in a region that is cached, flush the caches.
<br/>
<br/>
The following code will flush code and data cashes: (Tho you only need to flush the line needed, the code flushes the complete caches)
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
flush_caches:
<br/>
   eor r0,r0,r0
<br/>
   MCR p15,0,r0,c7,c5,0
<br/>
   MCR p15,0,r0,c7,c6,0
<br/>
   BX lr
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Assuming you didnt allready execute a breakpoint with other code there, you can take the DC_* functions of ndslib instead.
<br/>
<br/>
:edit: PS: use the array as volatile<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
