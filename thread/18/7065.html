<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>help with the fat driver please! - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > help with the fat driver please!</h2>
<div id="posts">
<div class="post">
    <h4>#56095 - ninogenio - Thu Oct 06, 2005 2:41 am</h4>
    <div class="postbody"><span class="postbody">helo everyone ive been browsing here for a little while and i must say its a great forum.now i was wondering if someone could come up with a little example of how to open a txt file and read the contents using the fat driver for gbamp ive been messing about for quite a while but i just cant get it to work correctly i have a gbamp v2 flashed with the firmware v2 and my ds is also flashed thanks very much in advanced for any help givin.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#56097 - tepples - Thu Oct 06, 2005 3:01 am</h4>
    <div class="postbody"><span class="postbody">Have you got the driver to work in GBA mode yet?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#56099 - josath - Thu Oct 06, 2005 3:15 am</h4>
    <div class="postbody"><span class="postbody">'rain' reads files from the CF card
<br/>
<a href="http://www.pat.hi-ho.ne.jp/sata68/nds.shtml#rain" target="_blank">http://www.pat.hi-ho.ne.jp/sata68/nds.shtml#rain</a>
<br/>
<br/>
as does 'moonshell':
<br/>
<a href="http://mdxonline.dyndns.org/archives/nds/" target="_blank">http://mdxonline.dyndns.org/archives/nds/</a>
<br/>
<br/>
maybe these will help you.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#56123 - ninogenio - Thu Oct 06, 2005 11:54 am</h4>
    <div class="postbody"><span class="postbody">@tepples ive not got it going in gba mode i used to do some coding for the gba but latley ive been consetrating on the nds as theres a lot more flexability i almost  had something going last night i had my program load a txt file and display it on screen but there was some garbbled characters at the end also i was just wondering if it was quite normal for there to be a few warnings from the compiler about gbamp_cf.c file.
<br/>
<br/>
@josath thanks for that but im not very good at looking through other peoples code and crabbing info i like to build my programs from scratch i find i learn a lot more from them.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#56124 - chishm - Thu Oct 06, 2005 1:28 pm</h4>
    <div class="postbody"><span class="postbody">What errors/warnings are you getting about gbamp_cf.c?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#56128 - ninogenio - Thu Oct 06, 2005 1:53 pm</h4>
    <div class="postbody"><span class="postbody">here is exactly what i get it compiles ok and the functions do work its just im not sure exactly how to use them.
<br/>
<br/>
C:\ninosstuff\DSHomeBrew\demo_for_reading_data&gt;make
<br/>
arm-elf-g++ -g -Wall -O2 -mcpu=arm9tdmi -mtune=arm9tdmi -fomit-frame-pointer -ff
<br/>
ast-math -mthumb-interwork -I/c/devkitPRO/libnds/include -DARM9 -c arm9.cpp -oar
<br/>
m9.o
<br/>
gbamp_cf.c: In function 'u32 FAT_NextCluster(u32)':
<br/>
gbamp_cf.c:566: warning: comparison between signed and unsigned integer expressi
<br/>
ons
<br/>
gbamp_cf.c: In function 'bool FAT_WriteFatEntry(u32, int)':
<br/>
gbamp_cf.c:672: warning: comparison between signed and unsigned integer expressi
<br/>
ons
<br/>
gbamp_cf.c: In function 'u32 FAT_fread(void*, u32, u32, int)':
<br/>
gbamp_cf.c:2309: warning: comparison between signed and unsigned integer express
<br/>
ions
<br/>
gbamp_cf.c:2323: warning: comparison between signed and unsigned integer express
<br/>
ions
<br/>
gbamp_cf.c: In function 'u32 FAT_fwrite(void*, u32, u32, int)':
<br/>
gbamp_cf.c:2435: warning: comparison between signed and unsigned integer express
<br/>
ions
<br/>
gbamp_cf.c:2457: warning: comparison between signed and unsigned integer express
<br/>
ions
<br/>
arm-elf-g++ -g -mthumb-interwork -mno-fpu -specs=ds_arm9.specs arm9.o -L/c/devki
<br/>
tPRO/libnds/lib -lnds9 -o arm9.elf
<br/>
arm-elf-objcopy -O binary arm9.elf arm9.bin
<br/>
ndstool -c demo1.nds -9 arm9.bin -7 arm7.bin
<br/>
Nintendo DS rom tool 1.23 - Sep 15 2005 06:28:33 by Rafael Vuijk (aka DarkFader)
<br/>
<br/>
dsbuild demo1.nds -o demo1.nds.gba
<br/>
dsbuild 1.21 - Sep 15 2005
<br/>
using default loader
<br/>
<br/>
C:\ninosstuff\DSHomeBrew\demo_for_reading_data&gt;pause
<br/>
Press any key to continue . . .</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#56193 - chishm - Thu Oct 06, 2005 11:23 pm</h4>
    <div class="postbody"><span class="postbody">Those warnings won't affect anything important. It seems I'm going to have to explicitly cast a few (u32)s to fix them.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#56326 - ninogenio - Fri Oct 07, 2005 10:21 pm</h4>
    <div class="postbody"><span class="postbody">ahh right cool ive got it working now i found an old post describing what i was looking for ive got this working on my gbamp and was just wondering if this looked ok what it does is load in a jpg from the cf card.the thing im not wanting is for my program to use more reasources than neccessary. thanks very much.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include &lt;nds.h&gt;
<br/>
#include "fat_driver/gbamp_cf.c"  
<br/>
#include &lt;stdio.h&gt;
<br/>
#include &lt;stdlib.h&gt;
<br/>
#include &lt;string.h&gt;
<br/>
#include "jpeg_lib/gba-jpeg.h"
<br/>
#include "jpeg_lib/gba-jpeg-decode.c"
<br/>
<br/>
u16 count;
<br/>
<br/>
void BltImage(const unsigned char* name, u16* vram)
<br/>
{
<br/>
  WAIT_CR &amp;= ~0x80;
<br/>
  JPEG_DecompressImage(name, vram, 256, 192);
<br/>
  WAIT_CR |= 0x80;
<br/>
}
<br/>
<br/>
int main(){
<br/>
   irqInit();
<br/>
   irqSet(IRQ_VBLANK,0);
<br/>
        WAIT_CR=0xe800;
<br/>
        powerON(POWER_ALL);
<br/>
<br/>
        videoSetMode(MODE_5_2D | DISPLAY_BG2_ACTIVE);
<br/>
        vramSetBankA(VRAM_A_MAIN_BG_0x6000000);
<br/>
        BG2_CR = BG_BMP16_256x256;
<br/>
<br/>
        BG2_XDX = 1&lt;&lt;8;
<br/>
        BG2_XDY = 0;
<br/>
        BG2_YDX = 0;
<br/>
        BG2_YDY = 1&lt;&lt;8;
<br/>
        BG2_CY = 0;
<br/>
        BG2_CX = 0;
<br/>
<br/>
        FAT_InitFiles();
<br/>
        int handle = FAT_fopen("nino.jpg", "r");  
<br/>
        int size=FAT_GetFileSize();
<br/>
        char* text = (char*) malloc (size+1)  ; 
<br/>
        
<br/>
        while (!FAT_feof(handle))
<br/>
        {
<br/>
               FAT_fread((void*)text, size, 1, handle); 
<br/>
               
<br/>
        }
<br/>
        FAT_fclose(handle);
<br/>
<br/>
<br/>
        while(1) 
<br/>
        {
<br/>
              scanKeys();
<br/>
              swiWaitForVBlank();
<br/>
              BltImage((const unsigned char*)(text), BG_GFX);
<br/>
        }
<br/>
<br/>
   return 0;
<br/>
}</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
