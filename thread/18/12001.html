<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>DLDI: loadable block device drivers for libfat - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > DLDI: loadable block device drivers for libfat</h2>
<div id="posts">
<div class="post">
    <h4>#112959 - chishm - Thu Dec 21, 2006 11:52 pm</h4>
    <div class="postbody"><span class="postbody">I think it's getting fairly obvious that I'm not able to keep up with all the new adapter releases. The last time I checked, I had a backlog of about 4 devices to implement. I have about a week of free time coming up, but I won't be using it to add these particular devices. To do so would maintain the constant requirement for me to add the latest devices as they come out. So what will I do instead?
<br/>
<br/>
I have decided to completely change the way drivers are included. Rather than statically linking in a set of drivers at library compile time, they will be dynamically linked after the binary linking stage but (maybe just) before run-time. To do this, the existing disc_io drivers will be removed. A set amount of space (at this stage I'm thinking 32KB, but maybe more or less later on) will be reserved at compile time. To add the driver for a particular card, the user will run a patching program. I will write this program, as well as example Makefile, .specs, .ld and crt0 files needed to implement a driver. I will also convert the drivers already included into patch files. This will behave in a similar way to the patching of commercial ROMs, although different enough that a completely new patch and patcher are required. I will also add an auto-patcher to NDSMP so that it can patch files at load time, and release the code so manufacturers can do the same for their firmware.
<br/>
<br/>
So what benefits and downsides will this have? 
<br/>
<ul><li>I won't have to maintain all the drivers for all the cards. As soon as a driver is written by anyone, it is usable by everyone.
<br/>
</li><li>Cards that aren't even released yet will be supported by programs that have already been compiled. No more having to recompile to add support for a card.
<br/>
</li><li>Manufacturers don't have to release source code to release an easily usable driver. No more having to recompile using other libraries (I'm looking at you, G6). They don't need to make publically available their intellectual property. Of course, this means we have to disassemble whatever they do release to understand the hardware, but we already have to do this (M3, G6, GBAMP).
<br/>
</li><li>There is an extra step added to compile then copy to card then run a debug build. The tool will be command line based, so this can be added to the makefile.
<br/>
</li><li>Users will need to patch any apps that use libfat for their particular card. This should be okay, as they already do it for commercial ROMs. Alternatively, multiple builds can be released on a website, but this kinda reduces the utility of such a scheme.
<br/>
</li></ul>
<br/>
If there is too much disagreement, I won't implement this, but I think it is for the common good. All comments, questions and suggestions are welcome.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112961 - Dark Knight ez - Fri Dec 22, 2006 12:07 am</h4>
    <div class="postbody"><span class="postbody">I'm all for this. Thumbs up for rethinking the FAT library.
<br/>
Supporting every card will be so much easier for developpers.
<br/>
Creating seperate builds for apps and games is definitely not the way to go.<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><a class="postlink" href="http://amplituds.drunkencoders.com" target="_blank">AmplituDS website</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112962 - Dwedit - Fri Dec 22, 2006 12:10 am</h4>
    <div class="postbody"><span class="postbody">Leave dynamic linking to an operating system, it only causes headaches when user programs do such things.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112970 - chishm - Fri Dec 22, 2006 1:22 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dwedit wrote:</b></span></td> </tr> <tr> <td class="quote">Leave dynamic linking to an operating system, it only causes headaches when user programs do such things.</td> </tr></table><span class="postbody">
<br/>
It won't be run-time dynamic linking. It will be dynamic in the sense that it is changable after compilation. I will rely on either the loader to do it (so really, an OS) or a patcher. To normal developers, libfat will be used exactly the same as before, with the exception that they can only use one device (i.e. SLOT-1 or SLOT-2 but not both), which is chosen by the linker.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112971 - 0xtob - Fri Dec 22, 2006 1:29 am</h4>
    <div class="postbody"><span class="postbody">No more hassle with different versions of gba_nds_fat? Sounds too good to be true :-)
<br/>
<br/>
But I guess the success of the idea will depend on the acceptance on the side of the card manufacturers. Imagine the worst case: No manufacturer adds this patching functionality to their firmware or adds homebrew patching to their rom patching software. Then, it would become more complicated for the user, because some homebrewers will release their software as 20  different binaries for 20 (estimated amount) different cards, while others will just release the "universal binary" and tell the user that he needs to search for a patcher to make the app run on his card. Maintaining the patchers would also be a lot of work: If there are patchers for the three major OSes and for every card, that would be 3 x N_CARDS individual programs, so about 60 at the moment.
<br/>
<br/>
So the question is: How likely is it that the manufacturers will support this solution?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112974 - Lazy1 - Fri Dec 22, 2006 2:01 am</h4>
    <div class="postbody"><span class="postbody">It sounds easy enough, maybe something like:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
patch-driver file.nds gbamp
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I would like a card identification function in there too, something like:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
const char* GetAdapterName( void );
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Or maybe a function to return the amount of installed memory ( if any ) and functions to lock/unlock it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112976 - Lick - Fri Dec 22, 2006 2:13 am</h4>
    <div class="postbody"><span class="postbody">How long will this change take? How can we help?<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112978 - strager - Fri Dec 22, 2006 2:34 am</h4>
    <div class="postbody"><span class="postbody">I'm thinking perhaps this memory region could be passed from one patched program to another.  For example, I would patch DSOrganize for use with the GBAMP.  When I wish to open a program in DSOrganize, it would find the region where the said program needs to be patched, and copy its own code into the new program.
<br/>
<br/>
Basically, your loader application would need to be patched, and all programs compatible with this library chaining would not require a patch.
<br/>
<br/>
If one chooses to test their application using different devices, but using the same media storage device, he would only need a loader for each patch.  Or, perhaps, a set of programs, one per device, to patch the loader, and load it.  This would completely eliminate the need for patching the files manually, or picking the right binary to download.  You would only need one *.patch.nds per device.
<br/>
(The *.patch.nds file would be booted first, then would load, patch, and execute a specified file, similar to _BOOT_MP.NDS for the GBAMP.)
<br/>
<br/>
Of course, a command-line-operated piece of software may be useful to conserve space on medium which will be used for only one device.  It may also be useful if your default boot program is not an application loader, or can operate as one.
<br/>
<br/>
One great application for this change would be WiFi-sendable games and applications.  The receiver would not be limited to the sender's "version" of the fat library; it could patch the incoming image according to his media type.  (Though some conflict would occur if both SLOTs were occupied, as data files (such as saves, records, info databases, etc.) might be on the card behind one device, but not the other.)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112986 - tepples - Fri Dec 22, 2006 4:30 am</h4>
    <div class="postbody"><span class="postbody">Will this have to wait for r20? And will it work on a GBAMP in GBA mode, or will it be DS-only?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112989 - felix123 - Fri Dec 22, 2006 6:07 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>0xtob wrote:</b></span></td> </tr> <tr> <td class="quote">If there are patchers for the three major OSes and for every card, that would be 3 x N_CARDS individual programs, so about 60 at the moment.</td> </tr></table><span class="postbody">If we write it in Java or as a DS homebrew, then we could solve this problem.<br/>_________________<br/><a class="postlink" href="http://en.wikipedia.org/wiki/NDSh" target="_blank">Nintendo DS homebrew on Wikipedia</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112991 - chishm - Fri Dec 22, 2006 6:20 am</h4>
    <div class="postbody"><span class="postbody">0xtob: 
<br/>
It would be one program to do the patching, and it would load a patch file specified from a command line. The end user only needs to worry about applying the right patch, but I think someone will create a GUI front end to make it simple for even the command line illiterate. 
<br/>
<br/>
For manufacturer support, I aim to make the patch format as similar to the current driver format as possible. This makes it easy for me to modify existing drivers for the new format, and gives the manufacturers something to work from.
<br/>
<br/>
Lazy1:
<br/>
This is purely for file system access, nothing more. The idea could be adapted for other features (unlocking memory, resetting the device) but not through libfat. Card identification will be done the same way as it is now. Hopefully the dev_t is expanded to 32 bits in DKP r20
<br/>
<br/>
strager:
<br/>
It's a bit hard to pass the memory region around. Part of the dynamic linking is modifying an address table for a new base address. It is possible, but the current base address needs to be taken into account.
<br/>
<br/>
tepples:
<br/>
It will work in r19. It is a change internal to libfat, so it doesn't need the file function support provided through newlib. I will ensure that the makefile targets the ARM7, so it should work for GBAMP too.
<br/>
<br/>
felix123: 
<br/>
Eww, Java ;) . I'd prefer not to force people to install a virtual machine to use the patcher, to make it as transparent as possible.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112994 - HyperHacker - Fri Dec 22, 2006 6:49 am</h4>
    <div class="postbody"><span class="postbody">This is a good idea but I don't like the sounds of this implementation.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote">Manufacturers don't have to release source code to release an easily usable driver. No more having to recompile using other libraries (I'm looking at you, G6). They don't need to make publically available their intellectual property. Of course, this means we have to disassemble whatever they do release to understand the hardware, but we already have to do this (M3, G6, GBAMP).</td> </tr></table><span class="postbody">
<br/>
I thought the general idea was to try to convince them to release code, and if not, then point out to newcomers that they aren't homebrew-friendly and should be avoided? Don't we want to encourage manufacturers to release source/documentation so that things not using libfat (IE DSLinux) can benefit from them?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote">Users will need to patch any apps that use libfat for their particular card. This should be okay, as they already do it for commercial ROMs. Alternatively, multiple builds can be released on a website, but this kinda reduces the utility of such a scheme.</td> </tr></table><span class="postbody">
<br/>
As 0xtob pointed out, this could easily degenerate into programs having 20 different versions or mentioning they need to be patched but not saying where to get the patcher (or it becoming unavailable for whatever reason), confusing people.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote">To normal developers, libfat will be used exactly the same as before, with the exception that they can only use one device (i.e. SLOT-1 or SLOT-2 but not both), which is chosen by the linker.</td> </tr></table><span class="postbody">
<br/>
This could be a problem if you wanted to use both slots at once, or wanted to distribute your .nds file; say you meet someone with a DS and one of them cards already, but you aren't near a computer; you wouldn't be able to swap programs because they wouldn't be compatible with the card. Patching on the DS itself is possible, but let's face it, if there's already a PC program to do it is anyone going to write such an app for the DS? Not to mention, that app would need to support every card at once anyway.
<br/>
<br/>
I can understand it being a pain having to manage all the drivers yourself, but is there a reason others can't help by writing code for and/or figuring out various devices?<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112998 - felix123 - Fri Dec 22, 2006 7:16 am</h4>
    <div class="postbody"><span class="postbody">Can we use a compromise method: continue including all the drivers, and leave a blank space to patch in drivers for new cards?
<br/>
<br/>
And I also think it is a good idea to be able to access slot 1 and 2 at the same time.<br/>_________________<br/><a class="postlink" href="http://en.wikipedia.org/wiki/NDSh" target="_blank">Nintendo DS homebrew on Wikipedia</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113002 - viruseb - Fri Dec 22, 2006 8:22 am</h4>
    <div class="postbody"><span class="postbody">Chishm, your idea make a lot of sense. For the implementation I think that making a win/*nix/mac... program is a bad idea, It will just confuse the user even more. 
<br/>
I rather prefer a .nds patcher that you put in your card with the homebrew you want to play. The user launch the patcher which detect the card, select the right IO driver and patch the homebrew.
<br/>
This way there is only one patcher (different version number of course as the number of device supported increase). Also if you want to transfer an homebrew via wifi users send the patcher along with and that's it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113006 - chishm - Fri Dec 22, 2006 9:31 am</h4>
    <div class="postbody"><span class="postbody">HyperHacker:
<br/>
Trying to convince the manufacturers to release code isn't working. At best they release a half-arsed driver which only works with their card and assumes that no other card exists. I hope to include the patcher in DevkitPro much like dsbuild and ndstool are now, along with a download on my website. 
<br/>
<br/>
I included the ability to use two slots at once in libfat due to a few requests for it. Now that it's there, I have not seen a single app use it. It's as simple as accessing "fat1:/" (slot 1) or "fat2:/" (slot 2), yet no one does. 
<br/>
<br/>
People have tried to write drivers in the past, and they've been a great help. However, I still have to clean up the code to match the naming and style conventions of libfat, then test it in combination with various other devices to make sure it doesn't cause compatibility issues. Also, with the growing number of new devices, it is becoming more and more wasteful to support them all at once. Then there is the need for finished apps to be recompiled everytime a new device is released.
<br/>
<br/>
felix123:
<br/>
I was also thinking about that. In fact, the only reason I haven't mentioned it is because I will need to reserve so much space for new drivers that I would remove the old ones to make room. From the general concensus, I think it is better that I leave them in there.
<br/>
<br/>
viruseb:
<br/>
Even idiotic pirates manage to patch their commercial ROMs using a PC program, so I doubt that this is too confusing for the end user.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113011 - Mrshlee - Fri Dec 22, 2006 10:17 am</h4>
    <div class="postbody"><span class="postbody">Having a scmhbp style patcher designed for each piece of hardware would be a good way to handle it.
<br/>
<br/>
Having a single compiled homebrew NDS and a single patcher designed for your cart. 
<br/>
<span style="font-weight: bold">GBAMPPatcher.exe whatever.nds</span> spits out whatever.dkp.nds with support
<br/>
<br/>
<span style="font-weight: bold">GBAMPLoader.NDS</span> lists the raw NDS homebrews on the cart. selecting it loads the nds into ram and patches it before booting. *obviously not optimal*
<br/>
<br/>
Its going to be a little messy having the current style homebrew and new style.. but should be easy enough to handle.
<br/>
<br/>
Do you want to leave this patcher in the hands of the hardware supplier and/or hardware hackers? the framework idea is fine if we can "guarantee" support for the hardware you can support already.. and if handled by the hardware groups themselves should make life easier for most people with new hardware.. if they choose not to support the community, they are going to have pissed off customers and lack of support from us.
<br/>
<br/>
Dropping a file onto an exe is easy as pie.<br/>_________________<br/><a class="postlink" href="http://MrShlee.com/" target="_blank">MrShlee.com</a>
<br/>
Projects
<br/>
<a class="postlink" href="http://dev-scene.com/" target="_blank">Dev-Scene</a>
<br/>
<a class="postlink" href="http://MyTechpedia.com/" target="_blank">MyTechpedia</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113015 - viruseb - Fri Dec 22, 2006 10:58 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mrshlee wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<br/>
<span style="font-weight: bold">GBAMPLoader.NDS</span> lists the raw NDS homebrews on the cart. selecting it loads the nds into ram and patches it before booting. *obviously not optimal*
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
My idea is more that the .nds patch the homebrews once for all (ie rewriting the patched homebrews in the cart).
<br/>
Let the hardware supplier do the patcher is a double edged sword. They can make without revelating to many "secrets". They can even add it to their own patcher they supply.  But of course they can choose not to.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113022 - OOPMan - Fri Dec 22, 2006 12:52 pm</h4>
    <div class="postbody"><span class="postbody">Hmmmmm, this is an interesting idea, but I'm not totally sure what to make of it.
<br/>
<br/>
Chishm has made quite a few good points, but so has HyperHacker...
<br/>
<br/>
I personally don't like the idea of having to patch homebrew to run it. It just seems a little...tiresome :-)
<br/>
<br/>
Also, whether or not the manufacturers would pay any attention is a good point. They've been pretty slack for the most part. The flood of new SLOT-1 devices has seen every one appearing claiming to support with homebrew, but with very little actual meat to back up such claims...
<br/>
<br/>
I don't know, maybe it's just a knee-jerk response but I don't think libfat should worry about supporting SLOT-1 devices unless full source is released (I guess we can thank the SC team in this regard, since they did release source for their new card promptly...)
<br/>
<br/>
However, the underlying idea chishm has is a good one. Allowing various people to contribute drivers as required is a good thing...
<br/>
<br/>
My personal preferene would be for FAT access to be handled as an OS module, but that relies on a feature-complete DS OS (Other than DSLinux) being released. Either that or we start working of drivers for DSLinux to give it as much access to the DS's HW as possible...
<br/>
<br/>
Like I said, though, the OS idea is not quite pertinent just yet for general homebrew (Porting current homebrew apps to DSLinux would be a long and code-filled path...)
<br/>
<br/>
Changes to libfat are a good idea, but I think the patching thing is possibly a little problematic...
<br/>
<br/>
Hmmmmmm....
<br/>
<br/>
Modular is good, patching is a pain. What to do?<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113024 - Lick - Fri Dec 22, 2006 1:05 pm</h4>
    <div class="postbody"><span class="postbody">Just do patching. It pushes some of our work to the end-user, but I don't think they mind at all. 
<br/>
(Plus, when doing tests, the developer can simply use the makefile to generate a patched nds for his device, so it doesn't slow down development, only distribution.)<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113032 - chishm - Fri Dec 22, 2006 1:47 pm</h4>
    <div class="postbody"><span class="postbody">While testing I've added a temporary IO_INTERFACE to libfat (private source, not in CVS) that basically reserves space for the patches. If people prefer it this way, I may keep it. It does, however, take up 32KiB of space.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113037 - simonjhall - Fri Dec 22, 2006 2:11 pm</h4>
    <div class="postbody"><span class="postbody">If this method saves me a few kilobytes of memory (as only the one driver has to be loaded) then I'm all for it! Although you'd have to allocate a chunk of memory large enough for the largest driver...
<br/>
I also like the idea of the gbamp firmware patching all executables run on it - could this be done with other cards?<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113049 - OOPMan - Fri Dec 22, 2006 3:15 pm</h4>
    <div class="postbody"><span class="postbody">I would imagine it to be viable for all cards with a firmware...
<br/>
<br/>
Of course, it depends on the manufacturers playing with their firmware...<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113055 - strager - Fri Dec 22, 2006 3:29 pm</h4>
    <div class="postbody"><span class="postbody">Here is how I thought of how the driver would be implemented:
<br/>
Somewhere (possibly near the beginning of the file) there is a function look-up table.  Functions include FAT_init, FAT_fopen, and other essential pieces to the library.  Then, somewhere in the file, there is a large chunk of memory (chishm say 32KiB), which is ZERO'd out (or packed with garbage or something...).  The patcher would need some way to locate this memory region.
<br/>
The patcher would write in this chunk of memory the function code (for FAT_init, FAT_fopen, etc.) for the certain card.  Then, it would write the start addresses (offset by the ROM start address) to the function look-up table.
<br/>
The user's code (programmer of the .nds) would call the functions from the LUT.  This is done by reading the needed function pointer from the LUT, and calling the function.  (Wrapper functions should be provided kindly by a header or such.)  By default, before the ROM is patched, perhaps the LUT could contain pointers to a function to print an error message ("Please PatchMe (tm)!") as a dummy.
<br/>
(I think that the program should support both ARM and THUMB code, and should do proper switching or such...)
<br/>
Is this how libfat is intending to work things out?
<br/>
<br/>
My idea, expanded from this one, is to instead of allocating a large chunk of nasty ROM space, simply append the data to the end of the target binary (the .arm[79], not the .nds).  This could allow any size of patching, as long as it's kept under the 4MB size limit (minus the IPC structures used in libnds).
<br/>
<br/>
To transfer the patch from one software to another, simply copy the loader, with the patch and patch LUT.  Copy the ROM image using the patching functions.  Then update the loaded ROM's FAT table, while adjusting function offsets to make it work at the end of the binary.
<br/>
(This method may require a "size" parameter per function, or, if all patching code were forced to be in one block, a "size" paramater for the entire patch (minus the LUT).  Or something.)
<br/>
In theory, this patching method would not take very long; it's a simple memory-to-memory copy, with a little offset handling.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113061 - chishm - Fri Dec 22, 2006 5:03 pm</h4>
    <div class="postbody"><span class="postbody">I have managed to write the patch part (Makfile, .ld, crt0.s and .spec files) and it seems okay. I even wrote the stub interface for libfat. I haven't written the actual patcher yet, so I had a lot of manual address recalculations to perform. 
<br/>
<br/>
A lookup table is generated when code is compiled as -fPIC (Global Offset Table). This gets rewritten with the correct addresses. Unfortunately, there is a bug in GCC where it doesn't reference the GOT for interworking stubs, meaning I need to patch a second section. Externally accessed functions are the same as the IO_INTERFACE functions. In fact, my patch file header contains a section that is used as the IO_INTERFACE. This makes the code relatively easy to port backwards to the normal libfat way of doing things.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113067 - Lord Raptor - Fri Dec 22, 2006 6:45 pm</h4>
    <div class="postbody"><span class="postbody">Will it be possible to re-patch a .nds ?
<br/>
<br/>
i.e. if you get a homebrew, and don't know if it is an unpatched version or not, just patch it again with your card drivers. This will reduce confusion between unpatched and patched version of homebrews.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113074 - chuckstudios - Fri Dec 22, 2006 7:50 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lord Raptor wrote:</b></span></td> </tr> <tr> <td class="quote">Will it be possible to re-patch a .nds ?
<br/>
<br/>
i.e. if you get a homebrew, and don't know if it is an unpatched version or not, just patch it again with your card drivers. This will reduce confusion between unpatched and patched version of homebrews.</td> </tr></table><span class="postbody">
<br/>
<br/>
To do that, he'd probably need to put a little magic number thing before the driver space.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113087 - felix123 - Fri Dec 22, 2006 10:05 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chuckstudios wrote:</b></span></td> </tr> <tr> <td class="quote">To do that, he'd probably need to put a little magic number thing before the driver space.</td> </tr></table><span class="postbody">
<br/>
<br/>
Good idea. I think there should be an easy way to figure out what devices a particular binary supports.<br/>_________________<br/><a class="postlink" href="http://en.wikipedia.org/wiki/NDSh" target="_blank">Nintendo DS homebrew on Wikipedia</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113098 - HyperHacker - Sat Dec 23, 2006 12:52 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote">I included the ability to use two slots at once in libfat due to a few requests for it. Now that it's there, I have not seen a single app use it. It's as simple as accessing "fat1:/" (slot 1) or "fat2:/" (slot 2), yet no one does.</td> </tr></table><span class="postbody">
<br/>
I'm guessing this is because there's no way to list a directory. I was considering a simple file manager that could move/copy/etc files around between cards, but you can't write a file manager without a directory listing.
<br/>
<br/>
[edit] fixed quote &lt;_&lt;<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"><br/><br/>Last edited by HyperHacker on Tue Dec 26, 2006 4:58 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#113104 - chishm - Sat Dec 23, 2006 2:24 am</h4>
    <div class="postbody"><span class="postbody">Lord Raptor &amp; chuckstudios &amp; felix123:
<br/>
Yes it is possible to repatch an NDS. The patching already works based on a magic string to singnify the start of designated block, and this string is left there by the patches. The patch header also has space for a 15 character string that can be used to put a friendly device name in.
<br/>
<br/>
HyperHacker and others:
<br/>
The general concensus is people don't like change :p . I'll keep the old IO_INTERFACEs in the library and simply add this as another one. This means cards that already work will work exactly the same as before. Currently unsupported cards will need to use this patch, but it's better than no support at all.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113111 - tepples - Sat Dec 23, 2006 5:57 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote">The patch header also has space for a 15 character string that can be used to put a friendly device name in.</td> </tr></table><span class="postbody">
<br/>
It's a tight squeeze:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">012345678901234
<br/>
SuperCardMiniSD
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">HyperHacker and others:
<br/>
The general concensus is people don't like change :p .</td> </tr></table><span class="postbody">
<br/>
Does the "change" you're talking about mean switching from the r19b Windows installer to compiling pre-r20 from CVS?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113114 - chishm - Sat Dec 23, 2006 7:16 am</h4>
    <div class="postbody"><span class="postbody">I'll up the friendly name to 47 characters. The change does not require a new DKP. It just needs people to patch apps for their device as opposed to having an interface for every device built in.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113256 - OOPMan - Mon Dec 25, 2006 11:38 am</h4>
    <div class="postbody"><span class="postbody">Thanks for the Christmas present Chishm...
<br/>
<br/>
In case none of you have noticed it yet, <a class="postlink" href="http://chishm.drunkencoders.com/DLDI/" target="_blank">here</a> it is :-)
<br/>
<br/>
EDIT: Been taking a look through the source. Very nice chishm. It's lean, mean and very clean. In fact, I'm playing with the idea of mucking about with making a RAM device driver just for fun using this. Not really useful as a permanent storage device, but just interesting to see if it would work. Are there any plans to allow two drivers to be patched in at once to allow FAT access to both SLOT-1 and a SLOT-2 device?<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113260 - Lick - Mon Dec 25, 2006 1:37 pm</h4>
    <div class="postbody"><span class="postbody">Is there a new build for libfat? And yeah chishm, it's the best christmas gift ever! =D Wonderful idea, wonderfully written!
<br/>
<br/>
Perhaps a moderator could rename (DLDI) + sticky this topic?<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113261 - chishm - Mon Dec 25, 2006 1:52 pm</h4>
    <div class="postbody"><span class="postbody">I have everything sorted now (that explains the delay between the Christmas post and this -- compiling a few card's drivers).
<br/>
<br/>
I have completed the <a class="postlink" href="http://chishm.drunkencoders.com/DLDI/" target="_blank">DLDI IO_INTERFACE</a> for libfat (and gba_nds_fat). It is implemented as just another card interface, so all existing interfaces are left as they are. Only one new interface can be patched in at a time (as OOPMan mentioned), so to use two cards at once, you'll still need to have one of the currently supported cards. Also, malloc is not supported within DLDIs for various reasons, so don't try to use it. As with the provided code, DLDIs should be lean. There is currently an arbitrary limit of 32KiB, however no DLDI has even reached 16KiB so far.
<br/>
<br/>
Oh, and you'll need a new version of <a class="postlink" href="http://chishm.drunkencoders.com/libfat/20061225/libfat-nds-20061225.tar.bz2" target="_blank">libfat</a> to use it. The code is already in CVS.
<br/>
<br/>
I think the web page explains it pretty well, so I won't ramble on too much. As before, post any comments, questions, suggestions and criticisms here.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113262 - Dark Knight ez - Mon Dec 25, 2006 2:49 pm</h4>
    <div class="postbody"><span class="postbody">Only a big thank you from me.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113263 - Lick - Mon Dec 25, 2006 3:18 pm</h4>
    <div class="postbody"><span class="postbody"><span style="font-weight: bold"><span style="color: green">Working</span> G6 Flash driver (read-only):</span>
<br/>
@ <a class="postlink" href="http://www.box.net/public/b5lsb0rhqy" target="_blank">Get the g6fl.dldi and a patched test file (.nds/.ds.gba) here.</a>
<br/>
@ <a class="postlink" href="http://www.box.net/public/jc568q2y3r" target="_blank">Get the source here</a>
<br/>
<br/>
The FAT code is totally written by <span style="font-style: italic">viruseb</span>, I only did the job of building it into a .dldi patchfile. The driver should be <span style="font-style: italic">read-only</span>. 
<br/>
<br/>
G6 Flash owners, please run the tests and post the results here!
<br/>
- Lick
<br/>
<br/>
<span style="font-size: 9px; line-height: normal">[updated]</span><br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"><br/><br/>Last edited by Lick on Tue Dec 26, 2006 2:26 am; edited 3 times in total</span></div>    
</div>
<div class="post">
    <h4>#113265 - Lick - Mon Dec 25, 2006 4:18 pm</h4>
    <div class="postbody"><span class="postbody"><span style="font-weight: bold"><span style="color: green">Working </span>Supercard DS (Slot-1) driver:</span>
<br/>
@ <a class="postlink" href="http://www.box.net/public/9v58dx1lz0" target="_blank">Get the scds.dldi and a patched test file (.nds/.ds.gba) here.</a>
<br/>
@ <a class="postlink" href="http://www.box.net/public/uc42amkjf0" target="_blank">Get the source here</a>
<br/>
<br/>
'Ported' the SCDS driver, released by the SuperCard team. It should be able to <span style="font-style: italic">read and write</span>.
<br/>
<br/>
Supercard DS owners, please run the tests and post the results here!
<br/>
- Lick
<br/>
<br/>
<span style="font-size: 9px; line-height: normal">[updated]</span><br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"><br/><br/>Last edited by Lick on Tue Dec 26, 2006 11:57 pm; edited 3 times in total</span></div>    
</div>
<div class="post">
    <h4>#113266 - OOPMan - Mon Dec 25, 2006 5:21 pm</h4>
    <div class="postbody"><span class="postbody">Nice work lick. Too bad I don't own either of those or I'd test for sure. Anyway, nice work ;-)<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113268 - Puyo - Mon Dec 25, 2006 6:41 pm</h4>
    <div class="postbody"><span class="postbody">G6 works fine. Hmm, why`s the app so big? 
<br/>
Thanks, Lick!
<br/>
<br/>
Magical homebrew Patcher! Yay. Good work, chishm!
<br/>
So now there is no reason to keep any interfaces in fat lib, except DLDI, right?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113270 - OOPMan - Mon Dec 25, 2006 7:10 pm</h4>
    <div class="postbody"><span class="postbody">Not quite Puyo. If one wishes to do I/O with both a SLOT-1 and a SLOT-2 device at the same time then keeping the older stuff is a good idea.
<br/>
<br/>
I believe chishm plans to release a version at some point that removes the old stuff for those who want a lighter version with support for only one device at a time...<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113274 - Puyo - Mon Dec 25, 2006 7:39 pm</h4>
    <div class="postbody"><span class="postbody">Ok, tested everything with PicoDrive 0.1.6. First of all patching app didn`t worked for me, it said something like "The app must be configured to work" in windows text box &amp; quit. Had to recompile it to work. 
<br/>
Then for testing purposes removed all of the drivers, about 7-8 devices, and left only DLDI interface. Compiled it and compared sizes: 684-665 = 19KiB.
<br/>
Not much, but anyways.
<br/>
Trying patching with default driver gave me error: "dldi file is invalid".
<br/>
<br/>
Well, that`s for bug report, anyway the system works as expected &amp; I hope shouldn`t be hard for users. Thank you, Chishm.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113275 - bob_fossil - Mon Dec 25, 2006 7:42 pm</h4>
    <div class="postbody"><span class="postbody">Made a Windows GUI version of the patcher. You can find the .exe and source (needs Visual C++ 6.0 or better) at
<br/>
<br/>
<a href="http://home.clara.net/adamhodson/dldi32-001.zip" target="_blank">http://home.clara.net/adamhodson/dldi32-001.zip</a>
<br/>
<br/>
There may be bugs in my GUI code - I have been drinking wine.
<br/>
<br/>
Merry Christmas
<br/>
<br/>
Adam</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113277 - OOPMan - Mon Dec 25, 2006 8:00 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Puyo wrote:</b></span></td> </tr> <tr> <td class="quote">Ok, tested everything with PicoDrive 0.1.6. First of all patching app didn`t worked for me, it said something like "The app must be configured to work" in windows text box &amp; quit. Had to recompile it to work.</td> </tr></table><span class="postbody">
<br/>
<br/>
This is normal. The DLDI requires that your app be compiled with the new version of libfat that supports it. The DLDI patcher will not work on homebrew compiled against older libfat releases.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Then for testing purposes removed all of the drivers, about 7-8 devices, and left only DLDI interface. Compiled it and compared sizes: 684-665 = 19KiB.
<br/>
Not much, but anyways.
<br/>
Trying patching with default driver gave me error: "dldi file is invalid".</td> </tr></table><span class="postbody">
<br/>
<br/>
This is not such a surprise either, given the way libfat + DLDI works. If you look back through the thread you can find more info but I believe it works as follows: The new libfat has an pre-included DLDI code area 32 kib in size. When you patch your DLDI enabled homebrew it inserts the code from the DLDI file into this DLDI code area. This is probably a simplification...
<br/>
<br/>
By removing the drivers without adjusting the position of the DLDI code area in the link file I *think* you've invalidated the patching mechanism. The patching fails because libfat is smaller than it should be.
<br/>
<br/>
I may be wrong on this, though, so we'll have to wait and see what chishm has to say...<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113278 - viruseb - Mon Dec 25, 2006 8:01 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote">I have everything sorted now (that explains the delay between the Christmas post and this -- compiling a few card's drivers).
<br/>
<br/>
Also, malloc is not supported within DLDIs for various reasons, so don't try to use it. As with the provided code, DLDIs should be lean. There is currently an arbitrary limit of 32KiB, however no DLDI has even reached 16KiB so far.
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
No malloc... mmh the g6 driver have a 16ko lookuptable to translate logical adresses. If I have a malloc handy the driver will be 16ko less.
<br/>
For now I don't think it will break the 32ko limit so there is no hurry.
<br/>
Anyway good work everybody.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113279 - Puyo - Mon Dec 25, 2006 9:20 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>OOPMan wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Puyo wrote:</b></span></td> </tr> <tr> <td class="quote">...</td> </tr></table><span class="postbody">
<br/>
This is normal. The DLDI requires that your app be compiled with the new version of libfat that supports it. The DLDI patcher will not work on homebrew compiled against older libfat releases.
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
<br/>
What I meant was, that the dos patcher provided on chishm`s site didn`t even start for me, it just produced windows error when I ran it.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">This is not such a surprise either, given the way libfat + DLDI works. If you look back through the thread you can find more info but I believe it works as follows: The new libfat has an pre-included DLDI code area 32 kib in size. When you patch your DLDI enabled homebrew it inserts the code from the DLDI file into this DLDI code area. This is probably a simplification...
<br/>
<br/>
By removing the drivers without adjusting the position of the DLDI code area in the link file I *think* you've invalidated the patching mechanism. The patching fails because libfat is smaller than it should be. </td> </tr></table><span class="postbody">
<br/>
<br/>
Well, first of all I was doing it with gba_nds_fat, sorry for not mentioning it. But even if it was libfat it shouldn`t be a problem, because patching software simply searches for magic string &amp; appends the driver just after. It`s not dependant of libfat size. 
<br/>
While the problem with default.dldi is that the header is 64 bytes further from it should be.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113280 - bob_fossil - Mon Dec 25, 2006 10:11 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Puyo wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
What I meant was, that the dos patcher provided on chishm`s site didn`t even start for me, it just produced windows error when I ran it.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Same here on Windows 2000. I think it needs a later version of the Visual C++ runtime .dll (Visual Studio 2005?).
<br/>
<br/>
Adam</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113286 - Lick - Tue Dec 26, 2006 1:46 am</h4>
    <div class="postbody"><span class="postbody">Yeah, the G6 Flash driver only compiles when the memory is 32K. Even 16K did not compile. (Because the lookuptable is 16K itself.)
<br/>
SuperCard DS however is only 8K. Not that it matters much, since it's still all &lt; 32K.
<br/>
<br/>
bob_fossil: nice GUI. If only you could:
<br/>
- Load <b style="color:#FFA34F">DLDI</b>'s into a list. (Like, scan the same directory for .<b style="color:#FFA34F">dldi</b> files.. etc.)
<br/>
- Make a drag-and-drop list for to-be-patched binaries.
<br/>
That would seriously own.<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"><br/><br/>Last edited by Lick on Tue Dec 26, 2006 2:45 am; edited 2 times in total</span></div>    
</div>
<div class="post">
    <h4>#113287 - Lick - Tue Dec 26, 2006 2:24 am</h4>
    <div class="postbody"><span class="postbody"><span style="font-weight: bold"><span style="color: darkred">Untested</span> DSLink (microSD Card) driver:</span>
<br/>
@ <a class="postlink" href="http://www.box.net/public/f4vjord4a3" target="_blank">Get the untested dlms.<b style="color:#FFA34F">dldi</b> and a patched test file (.nds/.ds.gba) here.</a>
<br/>
@ <a class="postlink" href="http://www.box.net/public/deosiz3pbd" target="_blank">Get the source here</a>
<br/>
<br/>
Taken from <span style="font-style: italic">20061204_ndskybkm03.zip</span>, the original code is written by Rudolph. 'Ported' to <b style="color:#FFA34F">dldi</b>, 8K in size. Should be able to <span style="font-style: italic">read and write</span>.
<br/>
<br/>
DSLink owners, please run the tests and post the results here!
<br/>
- Lick<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113295 - Lazy1 - Tue Dec 26, 2006 5:45 am</h4>
    <div class="postbody"><span class="postbody">Interesting, does this still use the same initialization functions like fatInitDefault? Will it return failure if no device is found?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113299 - chishm - Tue Dec 26, 2006 8:31 am</h4>
    <div class="postbody"><span class="postbody">Lick:
<br/>
I added the G6FL, SCDS, and DLMS interfaces to my page. If you don't want this, I can remove them.
<br/>
<br/>
Puyo:
<br/>
When using gba_nds_fat, you'll need to add the driver as the first in the initialisation list for both GBA and NDS  (it should be fairly obvious of how to do this). The small reduction in size is because the original interfaces share a lot of code (in libfat, all the CF based cards differ only in their startup routines and registers, for example). They can also link against libnds and newlib that is already used in other parts of libfat, rather than having to compile it in separately for the driver (as in <b style="color:#FFA34F">DLDI</b>).
<br/>
<br/>
I also fixed the default.<b style="color:#FFA34F">dldi</b> file. The problem was caused by me not putting the code in the ".init" section, so the linker added it's own init code at the start of the file.
<br/>
<br/>
The win32 exe was compiled using VC++ 2005. If people want to compile it for other OSes (Linux, MacOS X, etc) or even recompile it for Windows without the dependencies, then feel free to.
<br/>
<br/>
OOPMan:
<br/>
<b style="color:#FFA34F">DLDI</b> doesn't rely on the other drivers being there at all. The reserved space is empty when no interface is patched in.
<br/>
<br/>
viruseb:
<br/>
In my opinion, good hardware and drivers shouldn't need to take up 100's of KiBs of room. I think that the hardware should be doing most of the work, not the CPU and software. Other people think differently, I suppose, including device manufacturers (where it's cheaper to burden the host system). 
<br/>
<br/>
Don't worry too much about using the smallest space as possible, as long as it's under 32KiB. It will take up the same amount of space in the binary as was originally reserved for it. The only reason to aim for smaller drivers is when the host binary is running low on space and the author decides to reduce the reserved space.
<br/>
<br/>
That being said, the <b style="color:#FFA34F">DLDI</b> specifications are flexible enough that a V2 could be made with malloc allowable.
<br/>
<br/>
Lazy1:
<br/>
To libfat, it looks like any other IO_INTERFACE. The default <b style="color:#FFA34F">DLDI</b> is simply there to reserve space, and returns false for any function call. The <b style="color:#FFA34F">DLDI</b> file header has a section that is exactly the same as an IO_INTERFACE struct, and this is used by libfat. So to the programmer, it behaves exactly the same as before. 
<br/>
<br/>
If a patch is written correctly, it will return false if the desired device is not found. However, I'm not sure all patches are written correctly, which is why you can patch back to default if you want to. I'm not sure if I mentioned it before, but you can patch from any device to any device.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113300 - OOPMan - Tue Dec 26, 2006 8:33 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Puyo wrote:</b></span></td> </tr> <tr> <td class="quote">What I meant was, that the dos patcher provided on chishm`s site didn`t even start for me, it just produced windows error when I ran it.</td> </tr></table><span class="postbody">
<br/>
<br/>
Aaaah, well, bit of confusion there :-)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Puyo wrote:</b></span></td> </tr> <tr> <td class="quote">Well, first of all I was doing it with gba_nds_fat, sorry for not mentioning it. But even if it was libfat it shouldn`t be a problem, because patching software simply searches for magic string &amp; appends the driver just after. It`s not dependant of libfat size. 
<br/>
While the problem with default.<b style="color:#FFA34F">dldi</b> is that the header is 64 bytes further from it should be.</td> </tr></table><span class="postbody">
<br/>
<br/>
Which version of gba_nds_fat? The one that supports <b style="color:#FFA34F">DLDI</b>, or not?
<br/>
<br/>
Anyway, if it is a bug I'm sure chishm will fix it soon enough :-)<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113315 - bob_fossil - Tue Dec 26, 2006 2:19 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lick wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
bob_fossil: nice GUI. If only you could:
<br/>
- Load <b style="color:#FFA34F">DLDI</b>'s into a list. (Like, scan the same directory for .<b style="color:#FFA34F">dldi</b> files.. etc.)
<br/>
- Make a drag-and-drop list for to-be-patched binaries.
<br/>
That would seriously own.</td> </tr></table><span class="postbody">
<br/>
<br/>
<a href="http://home.clara.net/adamhodson/dldi32-002.zip" target="_blank">http://home.clara.net/adamhodson/dldi32-002.zip</a>
<br/>
<br/>
OK, the program now looks in the folder you ran it from for .<b style="color:#FFA34F">dldi</b> files and creates a combo list from the available files. You can browse to another folder and use that if you wish.
<br/>
<br/>
You can now add binaries to the list to do basic batch processing. You can also drag and drop files onto the list. They will then be processed in order when you hit the 'Patch' button. The log window will show the results.
<br/>
<br/>
Adam</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113317 - Lick - Tue Dec 26, 2006 3:03 pm</h4>
    <div class="postbody"><span class="postbody">Awesome, Adam! ;D<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113332 - Lord Raptor - Tue Dec 26, 2006 8:21 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lick wrote:</b></span></td> </tr> <tr> <td class="quote"><span style="font-weight: bold"><span style="color: green">Working</span> G6 Flash driver (read-only):</span>
<br/>
@ <a class="postlink" href="http://www.box.net/public/b5lsb0rhqy" target="_blank">Get the g6fl.<b style="color:#FFA34F">dldi</b> and a patched test file (.nds/.ds.gba) here.</a>
<br/>
@ <a class="postlink" href="http://www.box.net/public/jc568q2y3r" target="_blank">Get the source here</a>
<br/>
<br/>
The FAT code is totally written by <span style="font-style: italic">viruseb</span>, I only did the job of building it into a .<b style="color:#FFA34F">dldi</b> patchfile. The driver should be <span style="font-style: italic">read-only</span>. 
<br/>
<br/>
G6 Flash owners, please run the tests and post the results here!
<br/>
- Lick
<br/>
<br/>
<span style="font-size: 9px; line-height: normal">[updated]</span></td> </tr></table><span class="postbody">
<br/>
<br/>
On my G6, the tests list the contents of the root of my card, and finishes with :
<br/>
done error: 30 Read-only file system
<br/>
-- stop --
<br/>
<br/>
Is it normal ?
<br/>
<br/>
Anyway, awesome job !</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113336 - Lick - Tue Dec 26, 2006 9:14 pm</h4>
    <div class="postbody"><span class="postbody">That's normal, because the G6 Flash driver is still read-only. (And the code is written by viruseb!)
<br/>
<br/>
chishm: the device table is bugged. The 'author' text of SCCF should be swapped with the 'author' text of SCDS (Slot-1). Thanks for adding the drivers! ;D<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113352 - Paco_777 - Tue Dec 26, 2006 11:30 pm</h4>
    <div class="postbody"><span class="postbody">Thanks a lot Chishm for all the hard work
<br/>
Thanks to your library, I'll be able to add FAT support to Comic Book DS 2.0
<br/>
<br/>
I've got two questions :
<br/>
<br/>
- I'm using PAlib and it creates 2 files : ".nds" ".sc.nds" "ds.gba"
<br/>
Is the patcher able to take 'only' the .nds file and create the correct file for each particular adapter ?
<br/>
<br/>
- I plan to persist (saving in a file) the viewed page of the comic book each time the page is changed. Could this frequent save damage the memory (SD card) ?
<br/>
Is there a known way to be notified just before the DS is shut down ?
<br/>
<br/>
<br/>
I hope to see soon the r20 of DevKitPro :)
<br/>
<br/>
PS: Thank you too Lick. i can see that you are quite active. Moreover, i 'borrowed' your brightness handling code :)<br/>_________________<br/><a href="http://Gnese.free.fr/NDS/" target="_blank">http://Gnese.free.fr/NDS/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113354 - Lord Raptor - Tue Dec 26, 2006 11:47 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lick wrote:</b></span></td> </tr> <tr> <td class="quote">That's normal, because the G6 Flash driver is still read-only. (And the code is written by viruseb!)
<br/>
<br/>
chishm: the device table is bugged. The 'author' text of SCCF should be swapped with the 'author' text of SCDS (Slot-1). Thanks for adding the drivers! ;D</td> </tr></table><span class="postbody">
<br/>
OK.
<br/>
<br/>
So, add me in the working list for the G6 :)
<br/>
<br/>
Thank you for your answer (I wondered if my G6 was corrupted)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113355 - Lick - Tue Dec 26, 2006 11:55 pm</h4>
    <div class="postbody"><span class="postbody">SuperCard DS (Slot-1) driver <span style="font-weight: bold"><span style="color: green">works</span></span>. <a class="postlink" href="http://scdev.org/forum/viewtopic.php?p=61887#61887" target="_blank">Read here</a>.
<br/>
<br/>
Paco: perhaps you can do it every minute? And make it an option, so people can turn it off to 'save' on their cards.<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113378 - chishm - Wed Dec 27, 2006 4:38 am</h4>
    <div class="postbody"><span class="postbody">Okay, SCDS author is fixed and listed as working. Thanks Lick and sWampy. 
<br/>
<br/>
Paco_777:
<br/>
You won't be able to use the current PAlib FAT library with this driver. Either wait until they upgrade it or use libfat. ".sc.nds" and ".ds.gba" are ".nds" files with a loader prefixed. You can patch either the ".ds.gba" or ".nds" files with dlditool. Use dsbuild to turn a ".nds" into a ".ds.gba" file.
<br/>
<br/>
bob_fossil:
<br/>
That's a great tool. It'll make it a lot easier for end-users. Just one very minor niggle. You should be including the GPL license with the download, as dlditool was released under the GNU GPL.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113380 - tepples - Wed Dec 27, 2006 5:15 am</h4>
    <div class="postbody"><span class="postbody">So will ndstool, dlditool, and dsbuild for all major platforms (Windows x86, Mac OS X x86/PowerPC, and Linux x86) be available from a central location?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113382 - HyperHacker - Wed Dec 27, 2006 6:30 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Paco_777 wrote:</b></span></td> </tr> <tr> <td class="quote">- I plan to persist (saving in a file) the viewed page of the comic book each time the page is changed. Could this frequent save damage the memory (SD card) ?</td> </tr></table><span class="postbody">
<br/>
Flash memory can handle generally between 100,000 and 1,000,000 writes. At 100,000, writing to it a whopping 50 times a day would get you just over 5.4 years of usage. Of course, one operation may be a few dozen writes, but then there's sure to be days where you do pretty much nothing that involves writing, so it should even out nicely.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Is there a known way to be notified just before the DS is shut down ?</td> </tr></table><span class="postbody">
<br/>
Unfortunately I don't believe so.
<br/>
<br/>
BTW, you might want to re-check your math. ;-)<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113395 - Firon - Wed Dec 27, 2006 9:25 am</h4>
    <div class="postbody"><span class="postbody">You shouldn't do that much writing to the SD card. Your application won't be the only one writing to the card.
<br/>
Is it really that hard for the user to just go to the page again if they turned the DS off or something?
<br/>
You could also offer a shutdown option which would save the page.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113419 - bob_fossil - Wed Dec 27, 2006 6:38 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
bob_fossil:
<br/>
That's a great tool. It'll make it a lot easier for end-users. Just one very minor niggle. You should be including the GPL license with the download, as dlditool was released under the GNU GPL.</td> </tr></table><span class="postbody">
<br/>
<br/>
OK, I've added the license with the download, plus the relevant bits of boilerplate to my source.
<br/>
<br/>
<a href="http://home.clara.net/adamhodson/dldi32-0021.zip" target="_blank">http://home.clara.net/adamhodson/dldi32-0021.zip</a>
<br/>
<br/>
Adam</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113422 - Paco_777 - Wed Dec 27, 2006 7:33 pm</h4>
    <div class="postbody"><span class="postbody">Thanks all,
<br/>
I guess i will add manual save feature, event if it have a few chances to damage the card, i don't want the user to take that risk (and my program to be responsible of the troubles)
<br/>
<br/>
Chishm, yes I was using the 'first' version of the new fatlib (the one from this thread : <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=10289" target="_blank">http://forum.gbadev.org/viewtopic.php?t=10289</a>) and it was working correctly. Even if i'm using PAlib, replacing the lib.h and libfat.a in the libnds directory (and adding -lfat in the makefile) is ok.
<br/>
<br/>
However, I have problems using the last version (libfat-nds-20061225.tar.bz2) with the patcher. When i launch the patcher, it tells me that the .nds file does not have a DLDI section.
<br/>
I'm almost sure to use the correct library and header. Is there something specific to do in the makefile ?
<br/>
<br/>
(for information, the libfat link in your dldi page does not work as it is forbidden)<br/>_________________<br/><a href="http://Gnese.free.fr/NDS/" target="_blank">http://Gnese.free.fr/NDS/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113468 - chishm - Thu Dec 28, 2006 12:00 am</h4>
    <div class="postbody"><span class="postbody">tepples:
<br/>
AFAIK ndstool and dsbuild are included as part of DevkitPro. If WinterMute says it's okay, I'll add dlditool too. 
<br/>
<br/>
bob_fossil:
<br/>
Thanks for fixing the licenses. I can call off my crack-team of blood-thirsty lawyers now. :p
<br/>
<br/>
Paco_777:
<br/>
Make sure you extract the newest libfat over the top of the old version, and rebuild your app (make clean &amp;&amp; make) to use it. 
<br/>
<br/>
The libfat link is broken because I haven't actually made that page yet. It's a bit like a wiki -- I added a link I later intend to fill.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113471 - tepples - Thu Dec 28, 2006 1:11 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote">tepples:
<br/>
AFAIK ndstool and dsbuild are included as part of DevkitPro.</td> </tr></table><span class="postbody">
<br/>
True, but end users tend not to have a devkitPro installation, which appears to be targeted at developers.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113478 - chishm - Thu Dec 28, 2006 2:38 am</h4>
    <div class="postbody"><span class="postbody">For end-users, ndstool is not needed if they are only downloading *.nds files. dlditool is available in the same place as all the DLDI files, so they are likely to find it. dsbuild can be found using a quick FWSE search. dlditool should handle *.ds.gba files fine too, so they can patch those if they really wish.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113485 - tepples - Thu Dec 28, 2006 5:08 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote">dlditool is available in the same place as all the DLDI files</td> </tr></table><span class="postbody">
<br/>
But does it run on a Macintosh computer?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">dsbuild can be found using a quick FWSE search.</td> </tr></table><span class="postbody">
<br/>
Fast Wide Single Ended? If you refer to Favorite Web Search Engine (Yahoo/MSN/Google), does it run on a Macintosh computer?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113500 - OOPMan - Thu Dec 28, 2006 9:14 am</h4>
    <div class="postbody"><span class="postbody">Perhaps somebody should put together an "end users tool pack", or something along those lines. A big old pack of tools required for various homebrew roms, compiled against all the different major platforms...<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113502 - chishm - Thu Dec 28, 2006 9:30 am</h4>
    <div class="postbody"><span class="postbody">If someone builds dlditool for Mac, I'll add it to the page. The source is a single .c file and uses standard POSIX functions (except stricmp, I'll have to change that to strcasecmp).
<br/>
<br/>
I do agree that we need a page with tools for end-users. Unfortunately, I only have access to a PCs (not Macs) so I can't build any tools for MacOS. Source for both ndstool and dsbuild is in DevkitPro CVS, maybe I'll add dlditool too.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113523 - SukkoPera - Thu Dec 28, 2006 3:25 pm</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
I just joined this forum and the DS homebrew community. First of all, I'd like to say "Thank you" for DevkitPro and libfat, as they are all great pieces of software and work like a charm.
<br/>
<br/>
Then, a question: can I use libfat to do low-level access to the SD card? I need to read raw sectors, just like dd does.
<br/>
<br/>
Thanks again!<br/>_________________<br/>Nintendo DS Lite (White) + Supercard Lite + R4 + Sandisk 1 GB MicroSD
<br/>
Sony PSP + Firmware 3.03 OE-A2</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113537 - Globoeil - Thu Dec 28, 2006 5:16 pm</h4>
    <div class="postbody"><span class="postbody">Hi all!
<br/>
<br/>
Good job for all these drivers!
<br/>
<br/>
i'm currently working on VGMDS (<a class="postlink" href="http://perso.wanadoo.fr/Globoeil/VGMDS/VGMDS.htm" target="_blank">http://perso.wanadoo.fr/Globoeil/VGMDS/VGMDS.htm</a>), and I need more than ever SD-compatible drivers.
<br/>
So I've heard something about libfat, but... How can I use it?
<br/>
<br/>
My context:
<br/>
-I already have a LOT of code written with "FAT_fread, FAT_chdir", etc functions (Using gba_nds_fat_2006-03-03) , and I just want to know if I have to rewrite my entire source to use libfat?
<br/>
If I don't have to rewrite all the code, what should I do?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113539 - Paco_777 - Thu Dec 28, 2006 5:49 pm</h4>
    <div class="postbody"><span class="postbody">Sorry, an older lifat.a (that was in another directory) was used instead of the new one.
<br/>
Now i can patch correctly my files :)
<br/>
<br/>
i have to say that i'm a bit lost between those 3 files (".sc.nds" and ".ds.gba" are ".nds") produced by default with PAlib.
<br/>
On my supercard SD, both the .sc.nds and a .ds.gba (renamed as .nds) extensions works.
<br/>
<br/>
I was used to use the .sc.nds file but, even if the dldi patch report no errors, the resulting file does not work.
<br/>
However that's ok because the patched .ds.gba renamed into .nds works correctly on my supercard (well, in fact the patch is not necessary because the card is supported with the default driver)
<br/>
<br/>
<br/>
It may be quite hard for some (new) end users to :
<br/>
 - find which one of the 3 files they have to get (sometimes trying the 3 of them)
<br/>
 - know if they have to rename the file or not
<br/>
  - test the file which may work without the patch
<br/>
 - apply the patch
<br/>
 - perhaps apply another specific patch for their card.
<br/>
<br/>
This procedure could be explained somewhere (perhaps it is already, but I've never found it)
<br/>
<br/>
The easiest thing would be for the developer to distribute the .nds file only
<br/>
The end user would then apply a 'homebrew' patcher with the dldi dedicated to his card. 
<br/>
With the dldi, some information could be bundled like the correct extension, and the necessity to add a loader (which may also be bundled) of not.<br/>_________________<br/><a href="http://Gnese.free.fr/NDS/" target="_blank">http://Gnese.free.fr/NDS/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113546 - chuckstudios - Thu Dec 28, 2006 9:18 pm</h4>
    <div class="postbody"><span class="postbody">There's an EZ5 driver out now. I would make into a DLDI, but it's beyond my skills.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113564 - Globoeil - Thu Dec 28, 2006 11:33 pm</h4>
    <div class="postbody"><span class="postbody">Nobody can explain it to me?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113567 - Mighty Max - Thu Dec 28, 2006 11:55 pm</h4>
    <div class="postbody"><span class="postbody"><a href="http://forum.gbadev.org/viewtopic.php?t=10289" target="_blank">http://forum.gbadev.org/viewtopic.php?t=10289</a> has every info on moving from old to new fat lib you need.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113568 - Lick - Thu Dec 28, 2006 11:57 pm</h4>
    <div class="postbody"><span class="postbody">I'm going to port the EZ5 driver. After I farted.
<br/>
<br/>
<br/>
<br/>
Okay, ready to port!<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113571 - chishm - Fri Dec 29, 2006 12:49 am</h4>
    <div class="postbody"><span class="postbody">SukkoPera:
<br/>
You can't directly read/write raw sectors using libfat. However, you could just make use of the stuff in the <a class="postlink" href="http://devkitpro.cvs.sourceforge.net/devkitpro/libfat/source/disc_io/" target="_blank">disc_io</a> source directory. You'll only need <a class="postlink" href="http://devkitpro.cvs.sourceforge.net/devkitpro/libfat/source/common.h?revision=1.1&amp;view=markup" target="_blank">common.h</a> from the top level source directory. Alternatively, just use libfat and call the disc_io functions directly. Be careful doing this, since they are internal functions (not normally exposed outside the library) and as such are subject to change without notice.
<br/>
<br/>
Globoeil:
<br/>
You don't have to rewrite all of your code. You'll need to get the backported <a class="postlink" href="http://chishm.drunkencoders.com/DLDI/downloads/gba_nds_fat_io_dldi.zip" target="_blank"><b style="color:#FFA34F">DLDI</b> interface</a> for gba_nds_fat (available on the <b style="color:#FFA34F">DLDI</b> page). Edit disc_io.c and:<ol type="1"><li>#include io_dldi.h 
<br/>
</li><li>Add a <b style="color:#FFA34F">DLDI</b> initialisation step to both GBA and NDS interface checking functions</li></ol>
<br/>
After doing this, you should be able to use <b style="color:#FFA34F">DLDI</b> patches.
<br/>
<br/>
Paco_777:
<br/>
*.sc.nds is basically the same as *.ds.gba, but with a different extension. dlditool detects the file type based on the extension, and I have programmed it to detect *.ds.gba and *.nds, but not *.sc.nds. You can force the type by using the -t switch, like:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">dlditool -tdsgba sccf.<b style="color:#FFA34F">dldi</b> libfat_tests.sc.nds</td> </tr></table><span class="postbody">
<br/>
The reason dlditool reported no errors is because it managed to find the <b style="color:#FFA34F">DLDI</b> section, but then patched it for the wrong file type (*.nds, not *.sc.nds).
<br/>
<br/>
chuckstudios:
<br/>
It's fairly easy to make a driver into a <b style="color:#FFA34F">DLDI</b> file. Instructions are on the <a class="postlink" href="http://chishm.drunkencoders.com/DLDI/" target="_blank"><b style="color:#FFA34F">DLDI</b> page</a>. If you have a working driver to begin with, it usually takes no more than 5 minutes to create and test the <b style="color:#FFA34F">DLDI</b> file.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113574 - Lick - Fri Dec 29, 2006 1:01 am</h4>
    <div class="postbody"><span class="postbody"><span style="font-weight: bold"><span style="color: red">Tested to fail</span> EZ Flash 5 (microSD Card) driver:</span>
<br/>
@ <a class="postlink" href="http://www.box.net/public/7ee39hgmxl" target="_blank">Get the failing ezf5.<b style="color:#FFA34F">dldi</b> and a patched test file (.nds/.ds.gba) here.</a>
<br/>
@ <a class="postlink" href="http://www.box.net/public/ymkgyh7i7q" target="_blank">Get the source here</a>
<br/>
<br/>
This is the ported version of EZ Flash 5's official FAT code, released by EZteam. I am not sure if the readSector code will work (their code doesn't contain such a function with the same parameters), but it probably works.
<br/>
Ow, and it's 16K.
<br/>
<br/>
EZ Flash 5 owners, please run the tests and post the results here!
<br/>
- Lick
<br/>
<br/>
<span style="font-size: 9px; line-height: normal">[update] looks like the FAT lib doesn't work. Lame, EZteam.</span><br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"><br/><br/>Last edited by Lick on Fri Dec 29, 2006 5:26 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#113575 - Lick - Fri Dec 29, 2006 1:03 am</h4>
    <div class="postbody"><span class="postbody">chishm: what is the difference for patching between the filetypes? Isn't it the same 32K that is being replaced?<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113589 - tepples - Fri Dec 29, 2006 2:01 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Paco_777 wrote:</b></span></td> </tr> <tr> <td class="quote">i have to say that i'm a bit lost between those 3 files (".sc.nds" and ".ds.gba" are ".nds") produced by default with PAlib.
<br/>
On my supercard SD, both the .sc.nds and a .ds.gba (renamed as .nds) extensions works.</td> </tr></table><span class="postbody">
<br/>
Explanation, with latest info on m3/sc included:
<br/>
<br/>
<span style="font-weight: bold">ds.gba</span>: "PassMe format". A DS program designed for use with traditional GBA flash cards and PassMe/NoPass style devices. Generally consists of a short loader program followed by a .nds file.
<br/>
<span style="font-weight: bold">sc.nds</span>: Byte-identical to ds.gba, but renamed for use with SuperCard's menu, which needs files in ds.gba format to have the .nds suffix.
<br/>
<span style="font-weight: bold">.nds</span>: New versions of ndstool put a mini-loader on these so that they work more smoothly with SuperCard, but software for traditional GBA flash cards that tries to repair the header for GBA-mode software may screw this up.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">It may be quite hard for some (new) end users to :
<br/>
 - find which one of the 3 files they have to get (sometimes trying the 3 of them)</td> </tr></table><span class="postbody">
<br/>
As I understand it: <ul><li>Traditional GBA flash cards can use ds.gba
<br/>
</li><li>GBAMP (aka M2), M3, and SLOT-1 cards can use .nds
<br/>
</li><li>SuperCard and M3 can use sc.nds (renamed ds.gba) </li><li>Drop .nds onto dsbuild to get ds.gba </li></ul>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">The easiest thing would be for the developer to distribute the .nds file only
<br/>
The end user would then apply a 'homebrew' patcher with the <b style="color:#FFA34F">dldi</b> dedicated to his card. </td> </tr></table><span class="postbody">
<br/>
I agree.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote">You'll need to get the backported <b style="color:#FFA34F">DLDI</b> interface for gba_nds_fat</td> </tr></table><span class="postbody">
<br/>
Thanks.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113596 - Lick - Fri Dec 29, 2006 2:12 am</h4>
    <div class="postbody"><span class="postbody">I don't think it's -really- necessary. BTW, SuperCard and M3 use normal NDS.
<br/>
<br/>
Only thing that has to change is the order in which ".sc.nds" and ".nds" are checked in the patcher. The first should be checked first.<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113602 - SukkoPera - Fri Dec 29, 2006 3:07 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote">SukkoPera:
<br/>
You can't directly read/write raw sectors using libfat. However, you could just make use of the stuff in the <a class="postlink" href="http://devkitpro.cvs.sourceforge.net/devkitpro/libfat/source/disc_io/" target="_blank">disc_io</a> source directory. You'll only need <a class="postlink" href="http://devkitpro.cvs.sourceforge.net/devkitpro/libfat/source/common.h?revision=1.1&amp;view=markup" target="_blank">common.h</a> from the top level source directory. Alternatively, just use libfat and call the disc_io functions directly. Be careful doing this, since they are internal functions (not normally exposed outside the library) and as such are subject to change without notice.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I've spent quite a bit today looking at libfat's sources, and I had reached the same conclusions. Therefore I took the libfat sources, deleted all the functions dealing with FAT, and renamed the whole thing libblockdev. Now I need to implement raw open(), seek() and close(), which sounds reasonable, and I hope to be able to mantain the <b style="color:#FFA34F">DLDI</b> structure, which I think is great. I'm happy to have joined the NDS homebrew community now that this sort of things is almost sorted out ;).
<br/>
<br/>
Anyway I'll keep you posted, maybe we can merge back the code, one day :).
<br/>
<br/>
Congratulations for the libfat code, it looks very well structured and easy enough to understand.
<br/>
<br/>
PS: BTW, today's CVS won't compile :). dir_iter_t is undeclared, but it didn't affect me, as it was one of the things I removed.<br/>_________________<br/>Nintendo DS Lite (White) + Supercard Lite + R4 + Sandisk 1 GB MicroSD
<br/>
Sony PSP + Firmware 3.03 OE-A2</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113605 - tepples - Fri Dec 29, 2006 4:46 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>SukkoPera wrote:</b></span></td> </tr> <tr> <td class="quote">I've spent quite a bit today looking at libfat's sources, and I had reached the same conclusions. Therefore I took the libfat sources, deleted all the functions dealing with FAT, and renamed the whole thing libblockdev.</td> </tr></table><span class="postbody">
<br/>
Good job. Is it for both GBA and DS? And once the block device drivers get factored out completely, how hard would it be to adapt FreeBSD's (presumably more widely tested) FAT library on top of it, or to adapt one of the gba_nds_fat forks on top of it?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113633 - chishm - Fri Dec 29, 2006 10:39 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>SukkoPera wrote:</b></span></td> </tr> <tr> <td class="quote">I've spent quite a bit today looking at libfat's sources, and I had reached the same conclusions. Therefore I took the libfat sources, deleted all the functions dealing with FAT, and renamed the whole thing libblockdev.</td> </tr></table><span class="postbody">
<br/>
Good job. Is it for both GBA and DS? And once the block device drivers get factored out completely, how hard would it be to adapt FreeBSD's (presumably more widely tested) FAT library on top of it, or to adapt one of the gba_nds_fat forks on top of it?</span></td> </tr></table><span class="postbody">
<br/>
The disc_io stuff was always a separate layer from gba_nds_fat or libfat. The only reason interfaces weren't back-ported to gba_nds_fat more often is because I considered that set of code (not really a library) to be rather limited in its design, with many bugs (lack of any reentrancy, support for only one slot at a time, re-writing of fread when it was already available in newlib) that were simply not fixable by modifying that code base in any sane way. I wanted to encourage the use of libfat (which has all those problems fixed and is much more maintainable), so I did this using the carrot (more device support) and stick (no bug fixes in gba_nds_fat) approach. Unfortunately, the lack of directory listing functions hindered that plan.
<br/>
<br/>
Many of the gba_nds_fat forks really only differ in the devices they support. I back-ported <b style="color:#FFA34F">DLDI</b> to try to unify the device support amongst all of the different libraries in the wild. In fact, the only difference between gba_nds_fat and libfat's IO_INTERFACE model is gba_nds_fat gets the interface pointer via a function call (a mere wrapper) compared to libfat's approach of exposing the IO_INTERFACE reference directly.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>SukkoPera wrote:</b></span></td> </tr> <tr> <td class="quote">Congratulations for the libfat code, it looks very well structured and easy enough to understand.
<br/>
<br/>
PS: BTW, today's CVS won't compile :). dir_iter_t is undeclared, but it didn't affect me, as it was one of the things I removed.</td> </tr></table><span class="postbody">
<br/>
Thanks, that was yet another reason I rewrote gba_nds_fat into libfat. The old code was a mess.
<br/>
<br/>
dir_iter_t is from the up-coming directory support which is yet to be added to DevkitPro's newlib patches. It's unfortunate that those two parts of the DKP CVS went out of sync (a few months back) but it can't be helped.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lick wrote:</b></span></td> </tr> <tr> <td class="quote">what is the difference for patching between the filetypes? Isn't it the same 32K that is being replaced?</td> </tr></table><span class="postbody">
<br/>
It is, but the patcher needs to calculate the correct memory offsets for all the functions and global variables. It does this by examining the NDS header to find the RAM address it is loaded to. *.ds.gba files have an extra 512 bytes before the header, hence they have to be treated differently. *.gba files are assumed to be loaded to 0x08000000 and *.mb.gba (*.mb) are assumed to be loaded to 0x02000000<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113655 - SukkoPera - Fri Dec 29, 2006 2:28 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>SukkoPera wrote:</b></span></td> </tr> <tr> <td class="quote">I've spent quite a bit today looking at libfat's sources, and I had reached the same conclusions. Therefore I took the libfat sources, deleted all the functions dealing with FAT, and renamed the whole thing libblockdev.</td> </tr></table><span class="postbody">
<br/>
Good job. Is it for both GBA and DS? And once the block device drivers get factored out completely, how hard would it be to adapt FreeBSD's (presumably more widely tested) FAT library on top of it, or to adapt one of the gba_nds_fat forks on top of it?</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Well, I'm trying to change Chishm's code as little as I can (which basically means not changing it at all, but adding above it), so it should still work on GBA, too. I'll try do some tests, if I ever end up with anything usable.
<br/>
<br/>
About using FreeBSD's FAT implementation, I think it can already be done in current libfat, because the raw access functionality is clearly separated from partition access. It's just that raw access is limited to reading a certain range of sectors, while I need to be able to read() an arbitrary amount of data and seek() here and there, that's why I'm modifying it.
<br/>
<br/>
Actually I thought the FAT code was taken from somewhere else, and not written from scratch. Anyway it seems already quite stable, so I think the current code is good enough, unless big problems show up.<br/>_________________<br/>Nintendo DS Lite (White) + Supercard Lite + R4 + Sandisk 1 GB MicroSD
<br/>
Sony PSP + Firmware 3.03 OE-A2</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113671 - Globoeil - Fri Dec 29, 2006 4:33 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<br/>
Globoeil:
<br/>
You don't have to rewrite all of your code. You'll need to get the backported <b style="color:#FFA34F">DLDI</b> interface for gba_nds_fat (available on the <b style="color:#FFA34F">DLDI</b> page). Edit disc_io.c and:
<br/>
<br/>
   1. #include io_dldi.h
<br/>
   2. Add a <b style="color:#FFA34F">DLDI</b> initialisation step to both GBA and NDS interface checking functions
<br/>
<br/>
<br/>
After doing this, you should be able to use <b style="color:#FFA34F">DLDI</b> patches. 
<br/>
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Thank you VERY much! But there is just on thing that I don't understand ...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Add a <b style="color:#FFA34F">DLDI</b> initialisation step to both GBA and NDS interface checking functions
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Maybe I must add a line at the beginning of my program?What line?
<br/>
Sorry for my ignorance...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113693 - SukkoPera - Fri Dec 29, 2006 8:27 pm</h4>
    <div class="postbody"><span class="postbody">Mmmh, it seems that my read function:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int _RAWIO_read_r (struct _reent *r, int fd, char *ptr, int len);</td> </tr></table><span class="postbody">
<br/>
<br/>
always gets called with len = 1024, is this normal? Maybe some kind of wrapping done by newlib? What happens if the program did a 512 byte - for instance - read, allocating only 512 for the buffer?
<br/>
<br/>
It all seems rather odd :).<br/>_________________<br/>Nintendo DS Lite (White) + Supercard Lite + R4 + Sandisk 1 GB MicroSD
<br/>
Sony PSP + Firmware 3.03 OE-A2</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113704 - wintermute - Fri Dec 29, 2006 10:16 pm</h4>
    <div class="postbody"><span class="postbody">newlib uses buffered I/O by default, it may be 1024 bytes at a time but I'm not 100% sure offhand.
<br/>
<br/>
You should be able to use setvbuf to change the buffering behaviour.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113706 - Paco_777 - Fri Dec 29, 2006 10:31 pm</h4>
    <div class="postbody"><span class="postbody">chishm, tepples :
<br/>
thanks for those clarifications and help. :)
<br/>
<br/>
chishm :
<br/>
that's not an issue for me but patching this way makes dlditool crash : 
<br/>
&gt;dlditool -tdsgba scsd.<b style="color:#FFA34F">dldi</b> myfile.sc.nds
<br/>
(i can send you my sc.nds file if it can help)<br/>_________________<br/><a href="http://Gnese.free.fr/NDS/" target="_blank">http://Gnese.free.fr/NDS/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113717 - Mighty Max - Fri Dec 29, 2006 11:21 pm</h4>
    <div class="postbody"><span class="postbody">I had a look at the fileformat, and i think i gonna use DLDI for loading blockdevice drivers into my current project dynamically. 
<br/>
<br/>
The drivers only manipulate the devices and their given xkB of memory, right? So i can switch between several DLDI by just shutting down the interface, free the memory and laod/prepare the next? Or do you export a way to malloc from main memory in any way?<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113719 - d3tr0it - Fri Dec 29, 2006 11:36 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lick wrote:</b></span></td> </tr> <tr> <td class="quote"><span style="font-weight: bold"><span style="color: darkred">Untested</span> DSLink (microSD Card) driver:</span>
<br/>
@ <a class="postlink" href="http://www.box.net/public/f4vjord4a3" target="_blank">Get the untested dlms.dldi and a patched test file (.nds/.ds.gba) here.</a>
<br/>
@ <a class="postlink" href="http://www.box.net/public/deosiz3pbd" target="_blank">Get the source here</a>
<br/>
<br/>
Taken from <span style="font-style: italic">20061204_ndskybkm03.zip</span>, the original code is written by Rudolph. 'Ported' to dldi, 8K in size. Should be able to <span style="font-style: italic">read and write</span>.
<br/>
<br/>
DSLink owners, please run the tests and post the results here!
<br/>
- Lick</td> </tr></table><span class="postbody">
<br/>
<br/>
<span style="font-weight: bold"><span style="color: darkred">Tested, Failed</span> DSLink (microSD Card) driver</span>
<br/>
<br/>
"Initing FAT...fail"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113723 - Lick - Fri Dec 29, 2006 11:46 pm</h4>
    <div class="postbody"><span class="postbody">Ppfffft.. Thanks for testing, too bad it's negative! =(<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113744 - chishm - Sat Dec 30, 2006 8:01 am</h4>
    <div class="postbody"><span class="postbody">Globoeil:
<br/>
You need to edit the disc_io.h file which is part of gba_nds_fat. First, add the line </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include "io_dldi.h"</td> </tr></table><span class="postbody"> under the comment </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">// Include known io-interfaces:</td> </tr></table><span class="postbody">
<br/>
Next, look for the function disc_setGbaSlotInterface, and just before line that says #ifdef SUPPORT_M3CF, add:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   active_interface = DLDI_GetInterface() ;
<br/>
   if (active_interface-&gt;fn_StartUp())
<br/>
   {
<br/>
      return true ;
<br/>
   } ;</td> </tr></table><span class="postbody">
<br/>
Add the same code to disc_setDsSlotInterface, just before the #ifdef SUPPORT_NMMC line.
<br/>
<br/>
Paco_777:
<br/>
Whoops, that was a bug. Fixed it now.
<br/>
<br/>
MightyMax:
<br/>
Correct, the drivers only have access to their allocated 32KiB of memory.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113762 - Firon - Sat Dec 30, 2006 11:53 am</h4>
    <div class="postbody"><span class="postbody">d3tr0it: Moonlight has also attempted to port the DSlink driver to DLDI. Please test it.
<br/>
<a href="http://mdxonlinemirror.dyndns.org/resources/20061230_dldi_dlms_ver10_20061230.zip" target="_blank">http://mdxonlinemirror.dyndns.org/resources/20061230_dldi_dlms_ver10_20061230.zip</a>
<br/>
<br/>
I patched Lick's test NDS with the driver. <a href="http://www.zshare.net/download/dslink_v2-7z.html" target="_blank">http://www.zshare.net/download/dslink_v2-7z.html</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113763 - d3tr0it - Sat Dec 30, 2006 12:27 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Firon wrote:</b></span></td> </tr> <tr> <td class="quote">d3tr0it: Moonlight has also attempted to port the DSlink driver to DLDI. Please test it.
<br/>
<a href="http://mdxonlinemirror.dyndns.org/resources/20061230_dldi_dlms_ver10_20061230.zip" target="_blank">http://mdxonlinemirror.dyndns.org/resources/20061230_dldi_dlms_ver10_20061230.zip</a>
<br/>
<br/>
I patched Lick's test NDS with the driver. <a href="http://www.zshare.net/download/dslink_v2-7z.html" target="_blank">http://www.zshare.net/download/dslink_v2-7z.html</a></td> </tr></table><span class="postbody">
<br/>
<br/>
hmm.. same error.
<br/>
I tried the NDSKYBKM03_DLMS_DSLink_SD.nds with integrated support just to see if something was wrong with my hardware, but it works like a charm</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113765 - Firon - Sat Dec 30, 2006 12:50 pm</h4>
    <div class="postbody"><span class="postbody">Well, can you try Moonshell? It's using DLDI now.
<br/>
At least this way you can rule out it being a problem with Lick's test file.
<br/>
<a href="http://mdxonlinemirror.dyndns.org/resources/20061230_moonshell16beta5.zip" target="_blank">http://mdxonlinemirror.dyndns.org/resources/20061230_moonshell16beta5.zip</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113768 - Globoeil - Sat Dec 30, 2006 1:19 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Globoeil:
<br/>
You don't have to rewrite all of your code. You'll need to get the backported DLDI interface for gba_nds_fat (available on the DLDI page). Edit disc_io.c and:
<br/>
<br/>
   1. #include io_dldi.h
<br/>
   2. Add a DLDI initialisation step to both GBA and NDS interface checking functions
<br/>
<br/>
<br/>
After doing this, you should be able to use DLDI patches.</td> </tr></table><span class="postbody">
<br/>
<br/>
Okay I've done all of these instructions.
<br/>
But when I try to use a patch (using "dlditoo.exe scsd.dldi vgrds.nds") it always says me: "VGRDS.NDS does not have a DLDI section".
<br/>
Why? I've put what you said exactly where you said
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">You need to edit the disc_io.h file which is part of gba_nds_fat. First, add the line
<br/>
Code:
<br/>
#include "io_dldi.h"
<br/>
under the comment
<br/>
Code:
<br/>
// Include known io-interfaces:
<br/>
<br/>
Next, look for the function disc_setGbaSlotInterface, and just before line that says #ifdef SUPPORT_M3CF, add:
<br/>
Code:
<br/>
<br/>
   active_interface = DLDI_GetInterface() ;
<br/>
   if (active_interface-&gt;fn_StartUp())
<br/>
   {
<br/>
      return true ;
<br/>
   } ;
<br/>
<br/>
Add the same code to disc_setDsSlotInterface, just before the #ifdef SUPPORT_NMMC line. </td> </tr></table><span class="postbody">
<br/>
Except that I modify disc_io.C because you said disc_io.h but there was not trhese function in this file.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113769 - SukkoPera - Sat Dec 30, 2006 1:22 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">newlib uses buffered I/O by default, it may be 1024 bytes at a time but I'm not 100% sure offhand.
<br/>
<br/>
You should be able to use setvbuf to change the buffering behaviour.</td> </tr></table><span class="postbody">
<br/>
<br/>
Thanks a lot, this worked:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">setvbuf (fd, NULL, _IONBF, 0);</td> </tr></table><span class="postbody"><br/>_________________<br/>Nintendo DS Lite (White) + Supercard Lite + R4 + Sandisk 1 GB MicroSD
<br/>
Sony PSP + Firmware 3.03 OE-A2</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113773 - d3tr0it - Sat Dec 30, 2006 2:28 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Firon wrote:</b></span></td> </tr> <tr> <td class="quote">Well, can you try Moonshell? It's using DLDI now.
<br/>
At least this way you can rule out it being a problem with Lick's test file.
<br/>
<a href="http://mdxonlinemirror.dyndns.org/resources/20061230_moonshell16beta5.zip" target="_blank">http://mdxonlinemirror.dyndns.org/resources/20061230_moonshell16beta5.zip</a></td> </tr></table><span class="postbody">
<br/>
<br/>
Moonshell with the 20061230_dldi_dlms_ver10_20061230.zip dldi file works on my dslink..
<br/>
<br/>
Update: Licks DLDI seems to work with moonshell also</span><span class="gensmall"><br/><br/>Last edited by d3tr0it on Sat Dec 30, 2006 2:37 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#113774 - MaHe - Sat Dec 30, 2006 2:32 pm</h4>
    <div class="postbody"><span class="postbody">Excuse me, if I'm stupid. But what is DLDI (in plain olde English)?
<br/>
A library that allows the compiled library to be patched with a new FAT driver? In this case, it's ingenious. :0<br/>_________________<br/><span style="font-size: 9px; line-height: normal">[ Crimson and Black Nintendo DS Lite | CycloDS Evolution | EZ-Flash 3-in-1 | 1 GB Transcend microSD ]</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113775 - Firon - Sat Dec 30, 2006 2:50 pm</h4>
    <div class="postbody"><span class="postbody">d3tr0it: interesting. Perhaps it really is a problem with Lick's test file, and not his driver. :P
<br/>
<br/>
MaHe: essentially, it allows you to patch an NDS file with a new/different FAT driver without needing to recompile the NDS. 
<br/>
Basically, a developer would never need to do anything to support new adapters. All you'd have to do is patch the NDS with a driver for the new adapter, and bam, you've got full support.
<br/>
<br/>
DLDI is a great idea, and it actually seems to be working in practice. Good job chishm. :P I hope every homebrew developer makes use of it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113797 - chuckstudios - Sat Dec 30, 2006 6:57 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote">chuckstudios:
<br/>
It's fairly easy to make a driver into a DLDI file. Instructions are on the <a class="postlink" href="http://chishm.drunkencoders.com/DLDI/" target="_blank">DLDI page</a>. If you have a working driver to begin with, it usually takes no more than 5 minutes to create and test the DLDI file.</td> </tr></table><span class="postbody">
<br/>
<br/>
According to Lick, it didn't work. The EZTeam's driver was in a weird structure compared to other drivers.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113809 - d3tr0it - Sat Dec 30, 2006 11:09 pm</h4>
    <div class="postbody"><span class="postbody">ok, just a little update on dslink.
<br/>
I just tried the moonshell dldi with the recently released ndsmail and it failed to access the sd card.
<br/>
<br/>
So far only moonshell works with the dslink dldis. How does the dldi implementation in moonshell differ from other apps? (ndsmail and licks test app so far)
<br/>
<br/>
And btw are there any more apps with dldi support. Maybe a test app with lots of debug output?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113812 - Lick - Sat Dec 30, 2006 11:27 pm</h4>
    <div class="postbody"><span class="postbody">My testfile was provided by chishm and it has been patched multiple times. (Not that that should mather.) The difference compared to Moonshell, and the likeness compared to NDSMail, would probably be the use of <span style="font-weight: bold">libfat</span>. Moonshell, I think, uses a modification of <span style="font-weight: bold">gba_nds_fat</span>..<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113822 - Firon - Sun Dec 31, 2006 12:47 am</h4>
    <div class="postbody"><span class="postbody">Yes, you're right, Moonshell uses gba_nds_fat. Strange though, why would the driver work with gba_nds_fat and not libfat?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113835 - chishm - Sun Dec 31, 2006 4:06 am</h4>
    <div class="postbody"><span class="postbody">I have made a new testing app that should give more thorough results. It is available on the <a class="postlink" href="http://chishm.drunkencoders.com/DLDI/" target="_blank">DLDI page</a>. If you have a card that is listed as not tested, can you try it and report back here. Thanks. I'm also interested in cards that should work but fail for whatever reason.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113860 - d3tr0it - Sun Dec 31, 2006 3:03 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote">I have made a new testing app that should give more thorough results. It is available on the <a class="postlink" href="http://chishm.drunkencoders.com/DLDI/" target="_blank">DLDI page</a>. If you have a card that is listed as not tested, can you try it and report back here. Thanks. I'm also interested in cards that should work but fail for whatever reason.</td> </tr></table><span class="postbody">
<br/>
<br/>
The new test app doesnt work with the DSLink DLDIs. Same error as before.
<br/>
"Initing FAT...fail"
<br/>
<br/>
Chishm, do you know (or have an idea) why the DLDI implementation in moonshell works with these DLDIs?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113865 - Lick - Sun Dec 31, 2006 4:17 pm</h4>
    <div class="postbody"><span class="postbody"><span style="font-style: italic">windirt (EZ-Flash Representative)</span></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">if you want run homebrew program with ez5,you need change you makefile file like this.
<br/>
<br/>
$(TARGET).nds : $(TARGET).arm7 $(TARGET).arm9
<br/>
ndstool -c homebrew.nds -7 arm7/arm7.bin -9 arm9/arm9.bin -g "PASS" "01" "EZ5NDS_LDR" -b arm9/logo32.bmp "MoonShell.nds;_;By Moonlight"
<br/>
then the homebrew.nds file can run in ez5.
<br/>
you also can change our ez5 151 makefile file for run homebrew mode in ez5
<br/>
<br/>
<br/>
Note : the -g parameter "PASS" is necessary.. We used it to distinguish cleanrom or homebrew.</td> </tr></table><span class="postbody">
<br/>
<br/>
I suppose "EZ5NDS_LDR" is needed as well?
<br/>
<br/>
[upd] try <a class="postlink" href="http://www.box.net/lite/u7d2mox7mg" target="_blank">this please</a>!<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113867 - GrizzlyAdams - Sun Dec 31, 2006 4:53 pm</h4>
    <div class="postbody"><span class="postbody">I would so much rather see a dynamic linking version than one that you had to patch each app.  You would just need a folder in the root of your card with the .so for your card(s) and you could keep drivers for all cards somewhere if you wanted to trade files with a friend that uses a different card. elf dynamic linking isn't hard at all. I wrote my own PE exe loader that handles dynamic linking and it took me very little time to do so.
<br/>
If you are looking for a source for a pre-existing elf loader then look no further than KallistiOS, I wrote a full gui OS for it with multiple apps working fine on the dreamcast.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113868 - wintermute - Sun Dec 31, 2006 5:05 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>GrizzlyAdams wrote:</b></span></td> </tr> <tr> <td class="quote">I would so much rather see a dynamic linking version than one that you had to patch each app.  You would just need a folder in the root of your card with the .so for your card(s) and you could keep drivers for all cards somewhere if you wanted to trade files with a friend that uses a different card. elf dynamic linking isn't hard at all. I wrote my own PE exe loader that handles dynamic linking and it took me very little time to do so.
<br/>
If you are looking for a source for a pre-existing elf loader then look no further than KallistiOS, I wrote a full gui OS for it with multiple apps working fine on the dreamcast.</td> </tr></table><span class="postbody">
<br/>
<br/>
That's all very well when you can actually read the device in the first place.
<br/>
<br/>
How do you read from the device when the driver has not yet been installed?
<br/>
<br/>
This approach would require all the detection and read code from every driver linked with the application which kind of makes loading the driver from the media a bit pointless.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113870 - tepples - Sun Dec 31, 2006 5:43 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">How do you read from the device when the driver has not yet been installed?</td> </tr></table><span class="postbody">
<br/>
You load your card's specific _boot_mp.nds, which loads the driver into RAM and then loads moonshell.nds.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113874 - Lick - Sun Dec 31, 2006 5:58 pm</h4>
    <div class="postbody"><span class="postbody">Almost all of the newer cards don't support auto-booting. Only GBAMP does. =/
<br/>
But wintermute is right, it's a bit of a struggle in practice. End-users should just quit being lazy and patch their homebrew themselves. It's nothing hard or time taking.<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113876 - tepples - Sun Dec 31, 2006 6:21 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lick wrote:</b></span></td> </tr> <tr> <td class="quote">But wintermute is right, it's a bit of a struggle in practice. End-users should just quit being lazy and patch their homebrew themselves.</td> </tr></table><span class="postbody">
<br/>
If no one comes through with an implementation of <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?p=113485#113485" target="_blank">this suggestion</a>, does this include buying a PC that runs Microsoft Windows with which to do so?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113890 - wintermute - Sun Dec 31, 2006 8:29 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lick wrote:</b></span></td> </tr> <tr> <td class="quote">But wintermute is right, it's a bit of a struggle in practice. End-users should just quit being lazy and patch their homebrew themselves.</td> </tr></table><span class="postbody">
<br/>
If no one comes through with an implementation of <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?p=113485#113485" target="_blank">this suggestion</a>, does this include buying a PC that runs Microsoft Windows with which to do so?</span></td> </tr></table><span class="postbody">
<br/>
<br/>
source is provided, along with linux and windows binaries.
<br/>
<br/>
I'm intending to provide this tool with devkitARM r20 which should hopefully be released by the end of January. Assuming my OSX colleagues are available then everyone should be pretty happy.
<br/>
<br/>
I now have newlib 1.15.0 built with the psuedo device API updated for the directory listing functions. There are also several fixes in the base rules for arm/itcm/iwram code as noted in other places by gmiller.
<br/>
<br/>
I'm also hoping to include git and several examples using this marvellous image processor.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113891 - wintermute - Sun Dec 31, 2006 8:32 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">How do you read from the device when the driver has not yet been installed?</td> </tr></table><span class="postbody">
<br/>
You load your card's specific _boot_mp.nds, which loads the driver into RAM and then loads moonshell.nds.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
This system requires the nds to be patched with the appropriate driver. Ideally this can and should be done by the card's bootloader but I wouldn't hold my breath waiting for such a bootloader for cards where we don't have access to the firmware.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113932 - Firon - Mon Jan 01, 2007 8:47 am</h4>
    <div class="postbody"><span class="postbody">It appears that the G6 driver only works on the normal G6, and not the G6 Lite.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113935 - theli - Mon Jan 01, 2007 1:23 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Firon wrote:</b></span></td> </tr> <tr> <td class="quote">It appears that the G6 driver only works on the normal G6, and not the G6 Lite.</td> </tr></table><span class="postbody">
<br/>
i own G6 lite and it works for me in moonshell</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113940 - Mrshlee - Mon Jan 01, 2007 3:05 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
I'm intending to provide this tool with devkitARM r20 which should hopefully be released by the end of January. Assuming my OSX colleagues are available then everyone should be pretty happy.
<br/>
<br/>
I now have newlib 1.15.0 built with the psuedo device API updated for the directory listing functions. There are also several fixes in the base rules for arm/itcm/iwram code as noted in other places by gmiller.</td> </tr></table><span class="postbody">
<br/>
<br/>
Nice to see a solid update on r20!
<br/>
<br/>
Great work man,<br/>_________________<br/><a class="postlink" href="http://MrShlee.com/" target="_blank">MrShlee.com</a>
<br/>
Projects
<br/>
<a class="postlink" href="http://dev-scene.com/" target="_blank">Dev-Scene</a>
<br/>
<a class="postlink" href="http://MyTechpedia.com/" target="_blank">MyTechpedia</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113969 - Firon - Tue Jan 02, 2007 12:32 am</h4>
    <div class="postbody"><span class="postbody">theli: is that with the DLDI test I posted, or with the official 1.6 finalbeta 2? 'Cause I asked some people to try it on a G6 Lite and they had no such luck.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#113992 - theli - Tue Jan 02, 2007 11:26 am</h4>
    <div class="postbody"><span class="postbody">it's the DLDI from the chishm website (one ported by lick)
<br/>
adn with the first DLDI test build you posted</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114018 - GPFerror - Tue Jan 02, 2007 9:54 pm</h4>
    <div class="postbody"><span class="postbody">ok quickly put together an fcsr image dldi patcher based on gba_nds_fat fcsr driver, tested it in desmume-0.5.0 so hopefully works on hardware also.
<br/>
<br/>
<a href="http://gpf.dcemu.co.uk/fcsrDLDI.zip" target="_blank">http://gpf.dcemu.co.uk/fcsrDLDI.zip</a> includes precompiled bins and source
<br/>
<br/>
here is davr's fcsr linux source and scripts and my win32 version and bat files for creating fcsr images.
<br/>
<a href="http://gpf.dcemu.co.uk/fcsrimage.zip" target="_blank">http://gpf.dcemu.co.uk/fcsrimage.zip</a>
<br/>
<br/>
to use create fcsr.img and then
<br/>
padbin 512 file.ds.gba
<br/>
cat file.ds.gba fcsr.img &gt; out.ds.gba
<br/>
<br/>
then patch for dldi
<br/>
dlditool.exe fcsr.dldi out.ds.gba
<br/>
<br/>
Troy(GPF)
<br/>
<a href="http://gpf.dcemu.co.uk" target="_blank">http://gpf.dcemu.co.uk</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114042 - zektor - Wed Jan 03, 2007 4:00 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lick wrote:</b></span></td> </tr> <tr> <td class="quote"><span style="font-weight: bold"><span style="color: darkred">Untested</span> DSLink (microSD Card) driver:</span>
<br/>
@ <a class="postlink" href="http://www.box.net/public/f4vjord4a3" target="_blank">Get the untested dlms.dldi and a patched test file (.nds/.ds.gba) here.</a>
<br/>
@ <a class="postlink" href="http://www.box.net/public/deosiz3pbd" target="_blank">Get the source here</a>
<br/>
<br/>
Taken from <span style="font-style: italic">20061204_ndskybkm03.zip</span>, the original code is written by Rudolph. 'Ported' to dldi, 8K in size. Should be able to <span style="font-style: italic">read and write</span>.
<br/>
<br/>
DSLink owners, please run the tests and post the results here!
<br/>
- Lick</td> </tr></table><span class="postbody">
<br/>
<br/>
Just tested on my DS-Link. I get INIT FAT: Failed
<br/>
<br/>
Guess it does not work :(
<br/>
<br/>
EDIT: One of the mods over at SCDev also tested his, same result.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114090 - GPFerror - Wed Jan 03, 2007 10:35 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>GPFerror wrote:</b></span></td> </tr> <tr> <td class="quote">ok quickly put together an fcsr image dldi patcher based on gba_nds_fat fcsr driver, tested it in desmume-0.5.0 so hopefully works on hardware also.
<br/>
<br/>
<a href="http://gpf.dcemu.co.uk/fcsrDLDI.zip" target="_blank">http://gpf.dcemu.co.uk/fcsrDLDI.zip</a> includes precompiled bins and source
<br/>
<br/>
here is davr's fcsr linux source and scripts and my win32 version and bat files for creating fcsr images.
<br/>
<a href="http://gpf.dcemu.co.uk/fcsrimage.zip" target="_blank">http://gpf.dcemu.co.uk/fcsrimage.zip</a>
<br/>
<br/>
to use create fcsr.img and then
<br/>
padbin 512 file.ds.gba
<br/>
cat file.ds.gba fcsr.img &gt; out.ds.gba
<br/>
<br/>
then patch for dldi
<br/>
dlditool.exe fcsr.dldi out.ds.gba
<br/>
<br/>
Troy(GPF)
<br/>
<a href="http://gpf.dcemu.co.uk" target="_blank">http://gpf.dcemu.co.uk</a></td> </tr></table><span class="postbody">
<br/>
<br/>
OK received a report that it does work on hardware for at least 1 person :)
<br/>
<br/>
Troy</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114101 - chishm - Thu Jan 04, 2007 12:12 am</h4>
    <div class="postbody"><span class="postbody">I should probably hurry up and finish the second FCSR driver. The disc images used should be almost the same, except it'll handle writing without having to predefine the regions used.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114163 - josath - Thu Jan 04, 2007 8:08 pm</h4>
    <div class="postbody"><span class="postbody">minor dlditool fix -- changed _stricmp to stricmp, and added checking for .sc.nds filetypes. (my system doesn't have stricmp, so i had to uncomment the #define earlier in the .c file, but it was for stricmp, not _stricmp)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
--- dlditool.c  2006-12-30 17:54:22.000000000 -0800
<br/>
+++ dlditool.c.fixed    2007-01-04 11:05:12.000000000 -0800
<br/>
@@ -125,7 +125,7 @@
<br/>
                return false;
<br/>
        }
<br/>
        strEnd = &amp;str[strlen (str) - strlen(end)];
<br/>
-       return (_stricmp (strEnd, end) == 0);
<br/>
+       return (stricmp (strEnd, end) == 0);
<br/>
 }
<br/>
<br/>
 int quickFind (const char* data, const char* search, size_t dataLen, size_t searchLen) {
<br/>
@@ -150,7 +150,9 @@
<br/>
<br/>
 enum FileType detectFileType (const char* appFileName) {
<br/>
        enum FileType fileType;
<br/>
-       if (stringEndsWith(appFileName, ".nds")) {
<br/>
+        if (stringEndsWith(appFileName, ".sc.nds")) {
<br/>
+                fileType = FT_DSGBA;
<br/>
+        } else if (stringEndsWith(appFileName, ".nds")) {
<br/>
                fileType = FT_NDS;
<br/>
        } else if (stringEndsWith(appFileName, ".nds.gba") || stringEndsWith(appFileName, ".ds.gba")) {
<br/>
                fileType = FT_DSGBA;
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114171 - ApM - Thu Jan 04, 2007 9:30 pm</h4>
    <div class="postbody"><span class="postbody">Looks like the patcher has serious endian issues that will have to be addressed before a PPC Mac port is possible.  Thankfully, I'm doing my dev on an Intel Mac, so it works great. =]
<br/>
<br/>
My current workflow involves loading arm9 ELF files over wifi into the delightful DS debug monitor stub using GDB, so I spent an hour or so last night hacking dlditool to support patching ELF files.  Seems to work for me -- <a class="postlink" href="http://www.sporktania.com/dlditool_elf.tar.gz" target="_blank">you can grab the source here</a>.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114183 - chishm - Fri Jan 05, 2007 12:31 am</h4>
    <div class="postbody"><span class="postbody">josath &amp; ApM:
<br/>
Yeah, DLDI tool needs a bit of work. When I get enough time I'll add sc.nds patching and fix _stricmp (I forgot that I'd renamed it to make MS VC++ happy). I also need to remove any assumptions about endianess or integer length. However, removing assumptions about 8 bit chars is going a bit too far I think ;) .<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114209 - Diddl - Fri Jan 05, 2007 9:21 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>zektor wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Just tested on my DS-Link. I get INIT FAT: Failed</td> </tr></table><span class="postbody">
<br/>
<br/>
Correct, doesn't work on my DSlink.
<br/>
<br/>
<br/>
But you could simply access DSlink Fat system by using this moonshell sources (v1.5). I have implemented this piece of source from moonshell into DSdoom and it run fine on my DSlink.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114223 - Tets - Fri Jan 05, 2007 3:16 pm</h4>
    <div class="postbody"><span class="postbody">It looks like I'm the only one around here with a Max Media Dock, so I thought I'd join and share my experiences with DLDI.
<br/>
<br/>
Unfortunately it's not working on my device at all. I've tried dldi_tester.nds and DSDoom 1.1.0 rev1. Both patched successfully with mmcf.dldi according to the patcher, but when run on my DS, I never get any kind of message indicating failure, they actually freeze while trying to init FAT.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114252 - josath - Fri Jan 05, 2007 9:15 pm</h4>
    <div class="postbody"><span class="postbody">Has anyone tested the R4 lib on a M3 DS Simply? From what I understand they are basically the same device, possibly with different firmware.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114267 - Diddl - Sat Jan 06, 2007 12:07 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>josath wrote:</b></span></td> </tr> <tr> <td class="quote">Has anyone tested the R4 lib on a M3 DS Simply? From what I understand they are basically the same device, possibly with different firmware.</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
I get my M3simply next week. but I got this driver source from M3 and the filenames have R4 in it. so I think it's the same ...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114285 - Tets - Sat Jan 06, 2007 8:06 am</h4>
    <div class="postbody"><span class="postbody">Just for kicks, I thought I'd try out the mmcf_moon.dldi driver that comes along with the most recent Moonshell. Interestingly enough the test program immediately fails when patched with it, but DSDoom works perfectly (though it needs to be run as bootme.nds, but that's a completely unrelated problem, I'm told).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114299 - Globoeil - Sat Jan 06, 2007 12:20 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Globoeil wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Globoeil:
<br/>
You don't have to rewrite all of your code. You'll need to get the backported DLDI interface for gba_nds_fat (available on the DLDI page). Edit disc_io.c and:
<br/>
<br/>
   1. #include io_dldi.h
<br/>
   2. Add a DLDI initialisation step to both GBA and NDS interface checking functions
<br/>
<br/>
<br/>
After doing this, you should be able to use DLDI patches.</td> </tr></table><span class="postbody">
<br/>
<br/>
Okay I've done all of these instructions.
<br/>
But when I try to use a patch (using "dlditoo.exe scsd.dldi vgrds.nds") it always says me: "VGRDS.NDS does not have a DLDI section".
<br/>
Why? I've put what you said exactly where you said
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">You need to edit the disc_io.h file which is part of gba_nds_fat. First, add the line
<br/>
Code:
<br/>
#include "io_dldi.h"
<br/>
under the comment
<br/>
Code:
<br/>
// Include known io-interfaces:
<br/>
<br/>
Next, look for the function disc_setGbaSlotInterface, and just before line that says #ifdef SUPPORT_M3CF, add:
<br/>
Code:
<br/>
<br/>
   active_interface = DLDI_GetInterface() ;
<br/>
   if (active_interface-&gt;fn_StartUp())
<br/>
   {
<br/>
      return true ;
<br/>
   } ;
<br/>
<br/>
Add the same code to disc_setDsSlotInterface, just before the #ifdef SUPPORT_NMMC line. </td> </tr></table><span class="postbody">
<br/>
Except that I modify disc_io.C because you said disc_io.h but there was not trhese function in this file.</span></td> </tr></table><span class="postbody">
<br/>
what I've done wrong?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114301 - chishm - Sat Jan 06, 2007 1:11 pm</h4>
    <div class="postbody"><span class="postbody">Globoeil:
<br/>
Sorry if I didn't respond last time, I must've missed it. You need to make sure that io_dldi.s is compiled. It should produce an io_dldi.o file in your build directory when you make it, if it actually is compiling. If you know how to hex-edit files, try searching your executible for the following byte string:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">ED A5 8D BF 20 43 68 69  73 68 6D 00</td> </tr></table><span class="postbody">
<br/>
Which should produce the ascii string "???? Chishm" (where ? are strange looking symbols). If you cannot find it, then it is still missing the DLDI section.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114356 - agentq - Sun Jan 07, 2007 2:51 am</h4>
    <div class="postbody"><span class="postbody">Hi chishm,
<br/>
<br/>
I've been integrating the DLDI interface into ScummVM, and have had some success.
<br/>
<br/>
GBAMP CF: Worked!
<br/>
NinjaDS: Worked!
<br/>
M3 Lite: Failed
<br/>
Max Media Dock: Failed
<br/>
<br/>
However, I managed to get the Max Media Dock to work fine after rebuilding the DLDI removing the -i option to the linker
<br/>
<br/>
Change:
<br/>
LDFLAGS	=	-specs=$(CURDIR)/../$(SPECS)/dldi.specs -T $(CURDIR)/../$(SPECS)/dldi.ld -g $(ARCH) -mno-fpu -Wl,<span style="font-weight: bold">-i,</span>-Map,$(TARGET).map
<br/>
<br/>
I've no idea what this actually does, just that the makefiles on the other DLDIs don't have this option.  Looking at the resulting DLDI with a hex editor, it seems to prevent the function addresses from being insterted in the table in the header.
<br/>
<br/>
I can build a driver for the M3 Lite out of the one I have in ScummVM if it will be useful.  Although normally I would expect any M3 driver to work on the M3 lite so I'm not sure why the existing one doesn't work.
<br/>
<br/>
Great work on the DLDI stuff by the way, it's ace!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114359 - Tets - Sun Jan 07, 2007 3:21 am</h4>
    <div class="postbody"><span class="postbody">I can confirm that after compiling the MMCF code with the -i option removed, both the tester and DSDoom work. I can read from and write to my device with no problems.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114361 - Shtroodle - Sun Jan 07, 2007 3:33 am</h4>
    <div class="postbody"><span class="postbody">Hey guys!
<br/>
<br/>
I know it doesn't look extra good when I start my first post with a request, but I'd really like to know your opinion about integrating <span style="font-weight: bold">R4/M3</span> Simply DLDI interface into homebrew apps. I've been following this thread but I'm afraid I don't really have what it takes to try it out myself (one of the reasons being the fact that I don't have a flashcard). I know that some stuff already works on R4 (like Beup and DS Doom) but I'd really like to see the working versions of ScummVM, DSOrganize, PicoDriveDS or HexenDS. It would be great if someone could try this out or at least throw in some ideas about getting this stuff to work (since if I understand this correctly, the apps using the "old" fatlib can't be patched this way).
<br/>
<br/>
Thanks for reading this and keep up the great work. Cheers.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114364 - chishm - Sun Jan 07, 2007 3:51 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>agentq wrote:</b></span></td> </tr> <tr> <td class="quote">Hi chishm,
<br/>
<br/>
I've been integrating the DLDI interface into ScummVM, and have had some success.
<br/>
<br/>
GBAMP CF: Worked!
<br/>
NinjaDS: Worked!
<br/>
M3 Lite: Failed
<br/>
Max Media Dock: Failed
<br/>
<br/>
However, I managed to get the Max Media Dock to work fine after rebuilding the DLDI removing the -i option to the linker
<br/>
<br/>
Change:
<br/>
LDFLAGS	=	-specs=$(CURDIR)/../$(SPECS)/dldi.specs -T $(CURDIR)/../$(SPECS)/dldi.ld -g $(ARCH) -mno-fpu -Wl,<span style="font-weight: bold">-i,</span>-Map,$(TARGET).map
<br/>
<br/>
I've no idea what this actually does, just that the makefiles on the other DLDIs don't have this option.  Looking at the resulting DLDI with a hex editor, it seems to prevent the function addresses from being insterted in the table in the header.</td> </tr></table><span class="postbody">
<br/>
Oh, whoops. *embarrassed* 
<br/>
That is from when I was playing with linker options while designing the DLDI stuff. It is meant to force the linker to generate relocatable code (like -fPIC for the compiler), but it didn't work the way I thought so I removed it from the template. It seems I copied the MMCF DLDI from the template before this. Thanks for the heads-up, it's fixed now.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>agentq wrote:</b></span></td> </tr> <tr> <td class="quote">I can build a driver for the M3 Lite out of the one I have in ScummVM if it will be useful.  Although normally I would expect any M3 driver to work on the M3 lite so I'm not sure why the existing one doesn't work.</td> </tr></table><span class="postbody">
<br/>
Yeah, that'd be good, especially if you have the hardware to test it on.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>agentq wrote:</b></span></td> </tr> <tr> <td class="quote">Great work on the DLDI stuff by the way, it's ace!</td> </tr></table><span class="postbody">
<br/>
Thanks :)<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114376 - Pipian - Sun Jan 07, 2007 9:29 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Diddl wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>josath wrote:</b></span></td> </tr> <tr> <td class="quote">Has anyone tested the R4 lib on a M3 DS Simply? From what I understand they are basically the same device, possibly with different firmware.</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
I get my M3simply next week. but I got this driver source from M3 and the filenames have R4 in it. so I think it's the same ...</span></td> </tr></table><span class="postbody">
<br/>
<br/>
I got my M3 Simply today and can confirm that the R4 dldi driver does in fact work with the M3 Simply.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114377 - felix123 - Sun Jan 07, 2007 10:14 am</h4>
    <div class="postbody"><span class="postbody">Shtroodle:
<br/>
Here's what you have to do
<br/>
1. Recompile the programs with the new libfat
<br/>
2. Patch the new programs with the R4 dldi driver
<br/>
3. Play<br/>_________________<br/><a class="postlink" href="http://en.wikipedia.org/wiki/NDSh" target="_blank">Nintendo DS homebrew on Wikipedia</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114378 - chishm - Sun Jan 07, 2007 10:35 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Pipian wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Diddl wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>josath wrote:</b></span></td> </tr> <tr> <td class="quote">Has anyone tested the R4 lib on a M3 DS Simply? From what I understand they are basically the same device, possibly with different firmware.</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
I get my M3simply next week. but I got this driver source from M3 and the filenames have R4 in it. so I think it's the same ...</span></td> </tr></table><span class="postbody">
<br/>
<br/>
I got my M3 Simply today and can confirm that the R4 dldi driver does in fact work with the M3 Simply.</span></td> </tr></table><span class="postbody">
<br/>
Thanks for the info. I wonder who copied who.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114384 - Legolas - Sun Jan 07, 2007 12:44 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Pipian wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Diddl wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>josath wrote:</b></span></td> </tr> <tr> <td class="quote">Has anyone tested the R4 lib on a M3 DS Simply? From what I understand they are basically the same device, possibly with different firmware.</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
I get my M3simply next week. but I got this driver source from M3 and the filenames have R4 in it. so I think it's the same ...</span></td> </tr></table><span class="postbody">
<br/>
<br/>
I got my M3 Simply today and can confirm that the R4 dldi driver does in fact work with the M3 Simply.</span></td> </tr></table><span class="postbody">
<br/>
Thanks for the info. I wonder who copied who.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
M3 Team has explained this mystery to <a class="postlink" href="http://www.gbarl.it/index.php?showtopic=27942" target="_blank">gbarl.it community</a> (open the spoiler to read it):
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
M3 DS simply &amp; R4 is same our produts .
<br/>
We sell the M3 DS simply .
<br/>
And our Factory sell the R4 .
<br/>
<br/>
We will release the M3 DS real &amp; G6 DS later .
<br/>
Any information , we will inform you .
<br/>
<br/>
Best Regards</td> </tr></table><span class="postbody">
<br/>
<br/>
So it's the same product ;)<br/>_________________<br/><a class="postlink" href="http://itaprogaming.free.fr/" target="_blank">My homepage</a>!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114390 - bjoerngiesler - Sun Jan 07, 2007 1:28 pm</h4>
    <div class="postbody"><span class="postbody">Hey,
<br/>
<br/>
chishm, first of all, I think this is great stuff. Finally a way to cleanly support all current and future flash cards without having to re-up new builds... which was a bit of a pain for me with DSFTP, at least.
<br/>
<br/>
I can't get it to run, though. :-) "It" being DSFTP using gba_nds_fat, with your compatibility backport from your home page. Symptom:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
Dynamically Linked Disk Interface patch tool v1.01 by Michael Chisholm (Chishm)
<br/>
<br/>
Old driver:          Default (No interface)
<br/>
New driver:          SuperCard (Compact Flash)
<br/>
<br/>
Position in file:    0x0000FDC0
<br/>
Position in memory:  0x00000002
<br/>
Patch base address:  0x000080BF
<br/>
Relocation offset:   0xFFFE7D03
<br/>
<br/>
Segmentation fault
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I've debugged into it, and the culprit is the memset() line at dlditool.c:89. Looks like __bss_start and __bss_end aren't initialized correctly. I've put up the .nds binary at <a class="postlink" href="http://giesler.biz/~bjoern/downloads/dsftp/DSFTP-DLDI-broken.nds" target="_blank">http://giesler.biz/~bjoern/downloads/dsftp/DSFTP-DLDI-broken.nds</a>, if you want to give it a try. Any idea what might cause this?
<br/>
<br/>
I'd love to upgrade to libfat, but DSFTP needs directory management...<br/>_________________<br/><a class="postlink" href="http://giesler.biz/~bjoern/en/sw_dsftp.html" target="_blank">DSFTP homepage</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114396 - chishm - Sun Jan 07, 2007 1:47 pm</h4>
    <div class="postbody"><span class="postbody">This was determined to be an endianess issue. The current version of dlditool (v1.01) is written with the assumption that it is running on a little-endian architecture, which a PowerPC Mac isn't. I'll release a new version once I have tested it a bit more (probably tomorrow).<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114496 - chishm - Mon Jan 08, 2007 1:31 pm</h4>
    <div class="postbody"><span class="postbody">I have released a new dlditool version (v1.10). It now supports *.sc.nds, *.gba.nds and is usable on big-endian architectures (PowerPC based Macs, for example). It is available in the usual place.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114607 - SukkoPera - Tue Jan 09, 2007 1:51 pm</h4>
    <div class="postbody"><span class="postbody">I've finally released my hack of libfat which allows for raw I/O. It's available here:
<br/>
- <a class="postlink" href="http://www.sukkology.net/software/nds/libblockdev-src-20070108.tar.bz2" target="_blank">Source</a>
<br/>
- <a class="postlink" href="http://www.sukkology.net/software/nds/libblockdev-nds-20070108.tar.bz2" target="_blank">NDS binaries</a>
<br/>
- <a class="postlink" href="http://www.sukkology.net/software/nds/libblockdev-gba-20070108.tar.bz2" target="_blank">GBA binaries (untested)</a>
<br/>
<br/>
I tried to isolate my changes/additions, so if Chishm wants to add them back to libfat, it should be fairly easy, even though some things probably need some cleaning. Anyway it works enough for my project, see <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=12114" target="_blank">this post</a> for further info.<br/>_________________<br/>Nintendo DS Lite (White) + Supercard Lite + R4 + Sandisk 1 GB MicroSD
<br/>
Sony PSP + Firmware 3.03 OE-A2</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114611 - theli - Tue Jan 09, 2007 3:18 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>GPFerror wrote:</b></span></td> </tr> <tr> <td class="quote">ok quickly put together an fcsr image dldi</td> </tr></table><span class="postbody">
<br/>
chishm, can this be listed on DLDI page?
<br/>
or why not?
<br/>
<br/>
and by the way ... what are drivers included with libfat except DLDI IO_INTERFACE ?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114676 - chishm - Wed Jan 10, 2007 12:08 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>theli wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>GPFerror wrote:</b></span></td> </tr> <tr> <td class="quote">ok quickly put together an fcsr image dldi</td> </tr></table><span class="postbody">
<br/>
chishm, can this be listed on DLDI page?
<br/>
or why not?</span></td> </tr></table><span class="postbody">
<br/>
I am working on an FCSR version 2 driver that doesn't need explicit SRAM overlays, but rather just allocates sectors as they are needed. It should also be backwards compatible with FCSR version 1 images. I intend to put this up on the DLDI page, but it isn't finished yet.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>theli wrote:</b></span></td> </tr> <tr> <td class="quote">and by the way ... what are drivers included with libfat except DLDI IO_INTERFACE ?</td> </tr></table><span class="postbody">
<br/>
Drivers in order of initialisation: DLDI, NJSD, NMMC, MPCF, M3CF, SCCF, SCSD, M3SD.
<br/>
<br/>
SukkoPera:
<br/>
The modifications are good, but I won't be adding them back to libfat, since it is intended to be a high-level filesystem library. The raw disc I/O functions are best distributed as a separate library for people to use if they want to.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114678 - sirpoonga - Wed Jan 10, 2007 12:23 am</h4>
    <div class="postbody"><span class="postbody">I haven't tried DLDI yet but I have a basic understanding of what it is about.  I have a question about programming for it.  Can you detect if your program hasn't been patched?  Such as running a function that when not patched returns a false but when patched returns a true?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114684 - chishm - Wed Jan 10, 2007 1:45 am</h4>
    <div class="postbody"><span class="postbody">No, to any host application, it appears exactly the same as a standard disc interface. If it hasn't been patched, the default <b style="color:#FFA34F">DLDI</b> just returns false on initialisation and the library tries the next available interface.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114726 - SukkoPera - Wed Jan 10, 2007 2:12 pm</h4>
    <div class="postbody"><span class="postbody">@chishm: Ok, it's fine to keep mine as a separate library.
<br/>
<br/>
Anyway, a user of my program on a SCLite says that it fails to initialise the I/O driver. Actually, I only have a SCLite myself, so I'm pretty sure my program works on such cart. Someone then commented he "heard someone say it's hit or miss with the SC Lite because of an apparent hardware revision that doesn't work with the SCSD driver".
<br/>
<br/>
Any hints on that?<br/>_________________<br/>Nintendo DS Lite (White) + Supercard Lite + R4 + Sandisk 1 GB MicroSD
<br/>
Sony PSP + Firmware 3.03 OE-A2</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114752 - Diddl - Wed Jan 10, 2007 5:08 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>SukkoPera wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Anyway, a user of my program on a SCLite says that it fails to initialise the I/O driver.</td> </tr></table><span class="postbody">
<br/>
<br/>
The problem is the order of the driver initialization. 
<br/>
<br/>
My Fat library now supports all known devices (also DSlink, R4, M3simply). I loop in a driver table and each driver init tests for it's card. 
<br/>
<br/>
Some driver init functions 'hang' if a wrong card is present. For example I have a M3 with micro SD and by calling this movie player init function my DS hang (forever - I waited for 15 minutes).
<br/>
<br/>
So this Movieplayer init function must called after the M3 init function ...
<br/>
<br/>
Maybe this Problem appears with other combinations ...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114761 - josath - Wed Jan 10, 2007 5:59 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Diddl wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>SukkoPera wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Anyway, a user of my program on a SCLite says that it fails to initialise the I/O driver.</td> </tr></table><span class="postbody">
<br/>
<br/>
The problem is the order of the driver initialization. 
<br/>
<br/>
My Fat library now supports all known devices (also DSlink, R4, M3simply). I loop in a driver table and each driver init tests for it's card. 
<br/>
<br/>
Some driver init functions 'hang' if a wrong card is present. For example I have a M3 with micro SD and by calling this movie player init function my DS hang (forever - I waited for 15 minutes).
<br/>
<br/>
So this Movieplayer init function must called after the M3 init function ...
<br/>
<br/>
Maybe this Problem appears with other combinations ...</span></td> </tr></table><span class="postbody">
<br/>
<br/>
DIDL should prevent that problem, because the patched in DIDL is the first one tested. So if a user adds the M3 microSD patch, then it will always be the first one with init() called</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114783 - tepples - Wed Jan 10, 2007 8:22 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>josath wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Diddl wrote:</b></span></td> </tr> <tr> <td class="quote">stuff</td> </tr></table><span class="postbody">
<br/>
DIDL should prevent that problem, because the patched in DIDL is the first one tested. So if a user adds the M3 microSD patch, then it will always be the first one with init() called</span></td> </tr></table><span class="postbody">
<br/>
Now it's getting confusing: <a class="postlink" href="http://www.diddl.com/appgen/index.php?cl=depesche&amp;cp=home&amp;cmd=show_home&amp;banid=&amp;ref=http%3A%2F%2Fwww.diddl.com%2F" target="_blank">Diddl</a>, <b style="color:#FFA34F">DLDI</b>, what you called "DIDL"...<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114798 - PeterM - Wed Jan 10, 2007 8:58 pm</h4>
    <div class="postbody"><span class="postbody">Just rename it "dildo" and be done with it.
<br/>
<br/>
&lt;/kidding&gt;<br/>_________________<br/><a href="http://aaiiee.wordpress.com/" target="_blank">http://aaiiee.wordpress.com/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114809 - tepples - Wed Jan 10, 2007 9:35 pm</h4>
    <div class="postbody"><span class="postbody">Or is "DILDO" the name for drivers if they finally get Wii homebrew working?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114843 - zektor - Thu Jan 11, 2007 1:38 am</h4>
    <div class="postbody"><span class="postbody">I have been patching any and all homebrew apps that are utilizing <b style="color:#FFA34F">dldi</b> with the <b style="color:#FFA34F">dldi</b> DSLink driver included with the latest moonshell. Everything I have patched is working perfectly on my DSLink (DSFtp, DSO, NitroTracker). I just wanted to express my thanks for your work chishm. I for one am extremely grateful. This was a genius of an idea!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114849 - dantheman - Thu Jan 11, 2007 2:49 am</h4>
    <div class="postbody"><span class="postbody">I have a request:  could the Win32 frontent that bob_fossil developed be hosted on the main <b style="color:#FFA34F">DLDI</b> page?  I've already encountered a user on another forum who does not understand the command-line, so I redirected him to the Win32 frontend.  Placing the download link on the main site could help this situation.
<br/>
<br/>
Unfortunately though, I think that the frontend is already out of date, as I think I remember reading about additional support for sc.nds and other filetypes in the console program.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114858 - chishm - Thu Jan 11, 2007 4:17 am</h4>
    <div class="postbody"><span class="postbody">dantheman:
<br/>
If bob_fossil updates it to version 1.10, I'll put it on my site (with his permission of course).<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114891 - theli - Thu Jan 11, 2007 9:57 am</h4>
    <div class="postbody"><span class="postbody">chishm, last (posted on your site) dlditool doesn't work for me.... nor linux nor windows (under wine) ...
<br/>
<br/>
example:
<br/>
patch moonshell with last dlditool (g6fl.<b style="color:#FFA34F">dldi</b>) ... error on start
<br/>
repatch with backuped dlditool ... all fine
<br/>
<br/>
EDIT: it seems it just doesn't deals nice with dsgba ...
<br/>
DSOrganize.nds patched and then appended gba loader works fine</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114899 - MaHe - Thu Jan 11, 2007 12:39 pm</h4>
    <div class="postbody"><span class="postbody">Just a quick bug report: Precompiled .sc.nds and .ds.gba files won't work if patched with DLDITool. You have to patch the .nds file and apply the ndsloader.bin afterwards. :/<br/>_________________<br/><span style="font-size: 9px; line-height: normal">[ Crimson and Black Nintendo DS Lite | CycloDS Evolution | EZ-Flash 3-in-1 | 1 GB Transcend microSD ]</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114906 - tyraen - Thu Jan 11, 2007 1:55 pm</h4>
    <div class="postbody"><span class="postbody">After having problems with the new DSOrganize I downloaded the testing app from Chishm's site.  I patched it and ran it, but it fails at the first test (init).
<br/>
<br/>
I'm using a SC lite, just got at Christmas time.  I saw mentioned on another thread that there are multiple hardware revisions...?  Maybe the new/old one doesn't work with the current SC <b style="color:#FFA34F">DLDI</b>?
<br/>
<br/>
Then again I could just be using it wrong:
<br/>
1. Copied the test files to the card.
<br/>
2. Run the dlditool on them, it reports success.
<br/>
3. Boot the .nds.
<br/>
<br/>
Hopefully I'm not getting that wrong. :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114932 - bob_fossil - Thu Jan 11, 2007 7:18 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote">dantheman:
<br/>
If bob_fossil updates it to version 1.10, I'll put it on my site (with his permission of course).</td> </tr></table><span class="postbody">
<br/>
<br/>
OK, I've updated dldipatch32to v0.3. You can get it from:
<br/>
<br/>
<a href="http://home.clara.net/adamhodson/dldi32-0030.zip" target="_blank">http://home.clara.net/adamhodson/dldi32-0030.zip</a>
<br/>
<br/>
New in this version:
<br/>
<br/>
- Updated to latest source 1.10.
<br/>
- Added 'clear' button to the patch list.
<br/>
- Added version info.
<br/>
- Added XP theme support.
<br/>
<br/>
If people could try this and it's OK, then I don't see any problem with chishm including it on his site.
<br/>
<br/>
Thanks,
<br/>
<br/>
Adam</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114933 - Xanikseo - Thu Jan 11, 2007 8:12 pm</h4>
    <div class="postbody"><span class="postbody">Does <b style="color:#FFA34F">DLDI</b> not support SRAM or something, because I've noticed that both the new beta of Moonshell and DSOrganize don't boot homebrew properly anymore on my M3miniSDv1 with <b style="color:#FFA34F">DLDI</b> patches. Moonshell says the media card isn't compatible, and DSOrganize freezes on a black screen with white text saying Initializing FAT... Is this a problem with the <b style="color:#FFA34F">DLDI</b> or is this just a coincedence?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114936 - felix123 - Thu Jan 11, 2007 8:24 pm</h4>
    <div class="postbody"><span class="postbody">If you want to boot homebrew with DSO you need to patch the exec_stub.bin as well. <a class="postlink" href="http://www.dragonminded.com/?loc=ndsdev/DSOrganize%20FAQ" target="_blank">Read the faq.</a> dlditool -tbin -r0x06020000 &lt;dldi file&gt; exec_stub.bin<br/>_________________<br/><a class="postlink" href="http://en.wikipedia.org/wiki/NDSh" target="_blank">Nintendo DS homebrew on Wikipedia</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114943 - Thawin - Thu Jan 11, 2007 9:06 pm</h4>
    <div class="postbody"><span class="postbody">I have a problem. 
<br/>
<br/>
DsOrganize in G6Lite.
<br/>
<br/>
didi32-0030 or diditool-win32 1.10 version dont work for me, with the last dldi of viruseb, and patching the DSOrganize.ds.gba (the same with .nds and .sc.nds). Dont pass of Trying patched driver...
<br/>
<br/>
didi32-0021 with last dldi for g6 and patching DSOrganize.ds.gba..., it works perfect, read and write.
<br/>
<br/>
Any clue?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114950 - viruseb - Thu Jan 11, 2007 9:35 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Thawin wrote:</b></span></td> </tr> <tr> <td class="quote">I have a problem. 
<br/>
<br/>
DsOrganize in G6Lite.
<br/>
<br/>
didi32-0030 or diditool-win32 1.10 version dont work for me, with the last dldi of viruseb, and patching the DSOrganize.ds.gba (the same with .nds and .sc.nds). Dont pass of Trying patched driver...
<br/>
<br/>
didi32-0021 with last dldi for g6 and patching DSOrganize.ds.gba..., it works perfect, read and write.
<br/>
<br/>
Any clue?</td> </tr></table><span class="postbody">
<br/>
Same problem than Theli. The 1.20 dlditool should solve this issue.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114969 - bob_fossil - Thu Jan 11, 2007 11:26 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Thawin wrote:</b></span></td> </tr> <tr> <td class="quote">I have a problem. 
<br/>
<br/>
DsOrganize in G6Lite.
<br/>
<br/>
didi32-0030 or diditool-win32 1.10 version dont work for me, with the last dldi of viruseb, and patching the DSOrganize.ds.gba (the same with .nds and .sc.nds). Dont pass of Trying patched driver...
<br/>
<br/>
didi32-0021 with last dldi for g6 and patching DSOrganize.ds.gba..., it works perfect, read and write.
<br/>
<br/>
Any clue?</td> </tr></table><span class="postbody">
<br/>
<br/>
v0.3
<br/>
<br/>
Old driver:          Default (No interface)
<br/>
New driver:          G6 Lite DLDI V0.15
<br/>
<br/>
Position in file:    0x000CF3C0
<br/>
Position in memory:  0x02000000
<br/>
Patch base address:  0xBF800000
<br/>
Relocation offset:   0x428CF1C0
<br/>
<br/>
Patched successfully
<br/>
<br/>
v0.21
<br/>
<br/>
Old driver:          Default (No interface)
<br/>
New driver:          G6 Lite DLDI V0.15
<br/>
<br/>
Position in file:    0x000CF3C0
<br/>
Position in memory:  0x02000000
<br/>
Patch base address:  0xBF800000
<br/>
Relocation offset:   0x428CEFC0
<br/>
<br/>
Patched successfully
<br/>
<br/>
----
<br/>
<br/>
Looks like relocation offset may be wrong? Perhaps line 351 in dlditool.c 
<br/>
<br/>
fileOffset = readAddr(appFileData, dsHeaderOffset + DHO_Arm9Src);
<br/>
<br/>
should be
<br/>
<br/>
fileOffset = readAddr(appFileData, dsHeaderOffset + DHO_Arm9Src) + dsHeaderOffset;
<br/>
<br/>
I made a test version at:
<br/>
<br/>
<a href="http://home.clara.net/adamhodson/dlditool32-test.zip" target="_blank">http://home.clara.net/adamhodson/dlditool32-test.zip</a>
<br/>
<br/>
Adam</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114994 - chishm - Fri Jan 12, 2007 1:48 am</h4>
    <div class="postbody"><span class="postbody">Yes, there is a bug in v1.10 that caused the relocation offset to be miscalculated for DSGBA type files. The next version (v1.20) uses a completely different calculation method that should work on all file types without depending on the extension. I just need to test it a bit more first before release -- I don't want something like this happening again.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#115040 - chishm - Fri Jan 12, 2007 1:20 pm</h4>
    <div class="postbody"><span class="postbody">I uploaded dlditool v1.21 to the usual place. It should be able to patch any file without relying on the extension. It uses a new offset calculation method, which won't work if you've modified the Default DLDI included as part of libfat. The updated IO_INTERFACE has already been included in libfat in the DevkitPro CVS, and should be usable when DevkitARM r20 is released. The patcher will still work with the original, unmodified DLDI IO_INTERFACE, so don't worry about upgrading libfat until DevkitARM r20 comes out.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#115045 - tyraen - Fri Jan 12, 2007 2:16 pm</h4>
    <div class="postbody"><span class="postbody">So is the problem with some SC lites not working because of a difference in hardware revisions?  Does the scsd.dldi need to be modified?  I'm not trying to pester, I'm trying to figure out why none of the dldi stuff works on my DS. :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#115046 - SukkoPera - Fri Jan 12, 2007 2:21 pm</h4>
    <div class="postbody"><span class="postbody">Heh, it seems so. I have many problem reports. Chishm, any input on that?
<br/>
<br/>
Also, where can I get the sources of the DLDI tester? It seems to corrupt my media card.<br/>_________________<br/>Nintendo DS Lite (White) + Supercard Lite + R4 + Sandisk 1 GB MicroSD
<br/>
Sony PSP + Firmware 3.03 OE-A2</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#115047 - tyraen - Fri Jan 12, 2007 2:29 pm</h4>
    <div class="postbody"><span class="postbody">Wouldn't it be nice if card manufacturers took advantage of DLDI and built in patching support to their firmware, to automatically patch supporting homebrew at execution?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#115049 - SukkoPera - Fri Jan 12, 2007 2:49 pm</h4>
    <div class="postbody"><span class="postbody">Yeah, I guess that would be nice.
<br/>
<br/>
@Chishm: You forgot to update the version number of the dldi patcher, it's still 1.20 in the 1.21 release.<br/>_________________<br/>Nintendo DS Lite (White) + Supercard Lite + R4 + Sandisk 1 GB MicroSD
<br/>
Sony PSP + Firmware 3.03 OE-A2</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#115061 - cheapo - Fri Jan 12, 2007 5:13 pm</h4>
    <div class="postbody"><span class="postbody">Is there any kind of documentation, tutorial or example on implementing libfat with/without DLDI?
<br/>
<br/>
I've never used libfat before, and I'm trying to write a simple program that reads a text file from FAT and displays its content on screen, just to learn how to use libfat, but I don't know where to start.
<br/>
<br/>
Is there anything simple available or do I have to dig trough some other program that uses libfat and look how it's implemented?
<br/>
<br/>
Thanks!<br/>_________________<br/>There's no place like 127.0.0.1</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#115065 - Sausage Boy - Fri Jan 12, 2007 5:29 pm</h4>
    <div class="postbody"><span class="postbody">Using libfat is a matter of calling an init function and then using regular fopen etc calls.<br/>_________________<br/>"no offense, but this is the gayest game ever"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#115066 - cheapo - Fri Jan 12, 2007 5:46 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Using libfat is a matter of calling an init function and then using regular fopen etc calls.</td> </tr></table><span class="postbody">
<br/>
<br/>
Okay, I'll try to find out the init function syntax in some howebrew already using it. Thanks!<br/>_________________<br/>There's no place like 127.0.0.1</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#115067 - SukkoPera - Fri Jan 12, 2007 6:08 pm</h4>
    <div class="postbody"><span class="postbody">It's fatInitDefault ();, if you don't have to do anything too fancy.<br/>_________________<br/>Nintendo DS Lite (White) + Supercard Lite + R4 + Sandisk 1 GB MicroSD
<br/>
Sony PSP + Firmware 3.03 OE-A2</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#115070 - bob_fossil - Fri Jan 12, 2007 7:01 pm</h4>
    <div class="postbody"><span class="postbody">New version of the Windows patcher at:
<br/>
<br/>
<a href="http://home.clara.net/adamhodson/dldi32-0031.zip" target="_blank">http://home.clara.net/adamhodson/dldi32-0031.zip</a>
<br/>
<br/>
It uses chishm's latest source so it should fix the problems with ds.gba files.
<br/>
<br/>
Adam</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#115071 - josath - Fri Jan 12, 2007 7:53 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>cheapo wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Using libfat is a matter of calling an init function and then using regular fopen etc calls.</td> </tr></table><span class="postbody">
<br/>
<br/>
Okay, I'll try to find out the init function syntax in some howebrew already using it. Thanks!</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Don't forget that the .h include files are also a valuble source of info, as well as looking at examples.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#115153 - chishm - Sat Jan 13, 2007 8:54 am</h4>
    <div class="postbody"><span class="postbody">tyraen:
<br/>
I've heard there may be multiple SC Lite (not rumble) hardware revisions, but I'm not entirely sure. I will be getting a SC Lite soon so I should be able to test it some more.
<br/>
<br/>
SukkoPera:
<br/>
I haven't made the tester sources public. It is just a simple program that uses libfat to open/read/write/close 2 files on the card. Since it uses a normal build of libfat, I have to use a hex editor to remove the built in IO_INTERFACES (so it doesn't give false positives). Fixed version number now too.
<br/>
<br/>
cheapo:
<br/>
You'll need to #include &lt;fat.h&gt; and call fatInitDefault(); somewhere, and add -lfat before -lnds9 in the list of libraries in your ARM9 makefile. Once this is done you can access files like any POSIX system (fopen, fread, etc.).
<br/>
<br/>
bob_fossil:
<br/>
Thanks for the GUI version, I'll add it to the DLDI page.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#115184 - zektor - Sat Jan 13, 2007 4:06 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote">tyraen:
<br/>
I've heard there may be multiple SC Lite (not rumble) hardware revisions, but I'm not entirely sure. I will be getting a SC Lite soon so I should be able to test it some more.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
You heard correct. In the process of helping cory1492 get his unpatcher software working with the "new" Supercards (SD/Mini/SC Lite) we discovered some differences. Spansion chips are now used, and the firmware is written quite differently. He managed to get his unpatcher to actually work on the newer SD and miniSD, but no luck on that SC Lite.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#115186 - tyraen - Sat Jan 13, 2007 4:13 pm</h4>
    <div class="postbody"><span class="postbody">Seems strange that some FAT interfaces work with the new ones work and some don't.  I can run older versions of Moonshell and DS Organize just fine.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#115189 - SukkoPera - Sat Jan 13, 2007 4:43 pm</h4>
    <div class="postbody"><span class="postbody">Actually, the latest moonshell ships with two DLDI drivers for SCSD: one is the same as on Chishm's page, the other one seems a DLDIsation of the SCSD driver integrated in previous versions of Moonshell.
<br/>
<br/>
Now, it seems that the former driver has the abovementioned problems, while the latter does not. Anyone can confirm this?
<br/>
<br/>
EDIT: I had a guy (thanks juvinious) try the latter driver on a failing SCLite. He reported that reading works fine on the tester app, while writing hangs. The "normal" SCSD driver fails all together.<br/>_________________<br/>Nintendo DS Lite (White) + Supercard Lite + R4 + Sandisk 1 GB MicroSD
<br/>
Sony PSP + Firmware 3.03 OE-A2</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#115214 - Firon - Sat Jan 13, 2007 7:43 pm</h4>
    <div class="postbody"><span class="postbody">Well, source is open for all DLDIs in Moonshell, so if they work and an official one doesn't, you're free to add them to the page chishm.
<br/>
<br/>
<a href="http://mdxonlinemirror.dyndns.org/resources/20070101_dldi_scsd_ver10_20070101.zip" target="_blank">http://mdxonlinemirror.dyndns.org/resources/20070101_dldi_scsd_ver10_20070101.zip</a>
<br/>
<br/>
He also made an EZ5 DLDI, but there's two conditions (unrelated to the DLDI) for it to work. Firmware version must be 1.1 or greater (though only 1.31 has been tested and confirmed working, I believe), and the GAMEID must be set to PASS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#115219 - tyraen - Sat Jan 13, 2007 8:49 pm</h4>
    <div class="postbody"><span class="postbody">I ran the dldi_tester patched with the Moonshell dldi you linked, it works except that the Write test fails at "Writing...", I'm not sure why, but it seems to have gone off into a loop, or just crashed or something.  But a step up anyways. :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#115363 - Lick - Mon Jan 15, 2007 4:11 pm</h4>
    <div class="postbody"><span class="postbody">Today I compared Moonlights DS-Link dldi source and my own DS-Link dldi source, and it seems that the only difference is that I linked it to be a SLOT-1 device (which it is) and he linked it to be a SLOT-2 device. 
<br/>
<br/>
This world is weird.<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#115381 - josath - Mon Jan 15, 2007 7:08 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lick wrote:</b></span></td> </tr> <tr> <td class="quote">Today I compared Moonlights DS-Link dldi source and my own DS-Link dldi source, and it seems that the only difference is that I linked it to be a SLOT-1 device (which it is) and he linked it to be a SLOT-2 device. 
<br/>
<br/>
This world is weird.</td> </tr></table><span class="postbody">
<br/>
<br/>
I'm too lazy to look back thru the thread now, but I thought chishm said there was some bug/typo in the makefile or spec file or something.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#115414 - Firon - Mon Jan 15, 2007 11:25 pm</h4>
    <div class="postbody"><span class="postbody">Edit: nevermind.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#115670 - zektor - Thu Jan 18, 2007 8:35 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Diddl wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>zektor wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Just tested on my DS-Link. I get INIT FAT: Failed</td> </tr></table><span class="postbody">
<br/>
<br/>
Correct, doesn't work on my DSlink.
<br/>
<br/>
<br/>
But you could simply access DSlink Fat system by using this moonshell sources (v1.5). I have implemented this piece of source from moonshell into DSdoom and it run fine on my DSlink.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
BTW, a belated thanks for this info. Would you be able to share that version of DSDoom?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#115714 - Diddl - Thu Jan 18, 2007 4:30 pm</h4>
    <div class="postbody"><span class="postbody">yes of course I will share this version of DSdoom. here isn't possible (for me) to upload a file, so you will find it here: <a class="postlink" href="http://www.nds-toolz.de/wbb2/thread.php?threadid=3116" target="_blank">NDS Toolz</a>
<br/>
<br/>
<br/>
if anyone want the source code, I will send/upload it. the difference to this DSdoom v1.1 is:
<br/>
<ul>
<br/>
<li>replaced the fat code in /fat directory
<br/>
</li><li>added mini menu to choose one of four WAD files (doom, doom2, tnt ..)
<br/>
</li><li>added different savefile directorys on different WAD files.
<br/>
</li></ul></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#115740 - tyraen - Thu Jan 18, 2007 9:27 pm</h4>
    <div class="postbody"><span class="postbody">So, just saw the new version of the Moonshell beta and the release notes mentioned SC Lite fixes, so I tested it out and it worked.  I took the DLDI from the archive and patched it against the dldi_tester from chishm's site and all tests passed successfully. :)
<br/>
<br/>
Here's a link to the DLDI: <a class="postlink" href="http://www.sendspace.com/file/5j8j65" target="_blank">sclt.dldi</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#115753 - dantheman - Thu Jan 18, 2007 11:12 pm</h4>
    <div class="postbody"><span class="postbody">Is that one different than the one Firon posted earlier on this page?  Any new changes for it, like write support?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#115754 - Firon - Thu Jan 18, 2007 11:20 pm</h4>
    <div class="postbody"><span class="postbody">It's different from the one I posted; it's made explicitly for the Supercard Lite, probably to fix the write problems with the different variations.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#115757 - tyraen - Thu Jan 18, 2007 11:34 pm</h4>
    <div class="postbody"><span class="postbody">Like I said, I tested it with the dldi_tester which does read and write tests. :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#115765 - Lazy1 - Fri Jan 19, 2007 12:12 am</h4>
    <div class="postbody"><span class="postbody">To support this all I need is a new version of libfat right?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#115804 - zektor - Fri Jan 19, 2007 5:12 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Diddl wrote:</b></span></td> </tr> <tr> <td class="quote">yes of course I will share this version of DSdoom. here isn't possible (for me) to upload a file, so you will find it here: <a class="postlink" href="http://www.nds-toolz.de/wbb2/thread.php?threadid=3116" target="_blank">NDS Toolz</a>
<br/>
<br/>
<br/>
if anyone want the source code, I will send/upload it. the difference to this DSdoom v1.1 is:
<br/>
<ul>
<br/>
<li>replaced the fat code in /fat directory
<br/>
</li><li>added mini menu to choose one of four WAD files (doom, doom2, tnt ..)
<br/>
</li><li>added different savefile directorys on different WAD files.
<br/>
</li></ul></td> </tr></table><span class="postbody">
<br/>
<br/>
I *really* appreciate this! I just had a few good rounds in Doom II thanks to your update. Again, thank you!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116010 - agentq - Sun Jan 21, 2007 3:05 am</h4>
    <div class="postbody"><span class="postbody">Hi chishm,
<br/>
<br/>
As promised (a while ago) I've made a <b style="color:#FFA34F">DLDI</b> out of the M3 driver I was using in ScummVM.  This should work on every Slot-2 M3 card.  Tested and works perfectly on my M3 lite.
<br/>
<br/>
It would be great if you could put it up as an alternate M3 SD driver or something.  I'm planning to point ScummVM DS users to your page for all the latest DLDIs, you see!  The code is based on the code that M3 released, and I fixed a misaligned data issue and ported it to the <b style="color:#FFA34F">DLDI</b> structure.
<br/>
<br/>
<a href="http://scummvm.drunkencoders.com/m3sd.zip" target="_blank">http://scummvm.drunkencoders.com/m3sd.zip</a>
<br/>
<br/>
Thanks again for your work on this.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116034 - chishm - Sun Jan 21, 2007 7:57 am</h4>
    <div class="postbody"><span class="postbody">Updated <b style="color:#FFA34F">DLDI</b> page for M3SD, SC Lite and EZ5.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116104 - tepples - Mon Jan 22, 2007 12:06 am</h4>
    <div class="postbody"><span class="postbody">Are the M3SD and SC Lite files really supposed to be a year old? :-)<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116145 - m2pt5 - Mon Jan 22, 2007 2:23 pm</h4>
    <div class="postbody"><span class="postbody">I don't know if this happens to anyone else, but the SCSD <b style="color:#FFA34F">DLDI</b> driver on chishm's page doesn't work for me at <span style="font-style: italic">all</span>. However, the scsd_moon.<b style="color:#FFA34F">dldi</b> included with Moonshell 1.6 (thanks for pointing it out, SukkoPera) works perfectly. This may be because I have an older model SCSD. (On the back, a chip marked "Lattice" is clearly visible through the plastic.)
<br/>
<br/>
Maybe scsd_moon should be added to chishm's page, for people like me with an older SCSD? (Unless it's the same one that's already there for the SCLite.)<br/>_________________<br/>Don't sign your posts, it's dumb.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116186 - Firon - Tue Jan 23, 2007 12:59 am</h4>
    <div class="postbody"><span class="postbody">No, the SC Lite one is explicitly made to support the various revisions of the SC Lite. It is possible that it could work on other SC's, but that wasn't the intent.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116207 - HyperHacker - Tue Jan 23, 2007 4:40 am</h4>
    <div class="postbody"><span class="postbody">Does or will libfat provide a method to determine which type of card is inserted? I noticed the latest version of libcartreset doesn't work with the latest libfat (undefined reference to _partition), so I have to use the non-FAT version which has no auto-detect. (Though it's probably healthier! ;-)) Currently, my card detection method is to have the user hex-edit the .nds file. :-/<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116228 - d3tr0it - Tue Jan 23, 2007 1:33 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lick wrote:</b></span></td> </tr> <tr> <td class="quote">Today I compared Moonlights DS-Link <b style="color:#FFA34F">dldi</b> source and my own DS-Link <b style="color:#FFA34F">dldi</b> source, and it seems that the only difference is that I linked it to be a SLOT-1 device (which it is) and he linked it to be a SLOT-2 device. 
<br/>
<br/>
This world is weird.</td> </tr></table><span class="postbody">
<br/>
<br/>
For me... Both yours and moonlights DS-Link <b style="color:#FFA34F">dldi</b> has the exactly same compatability. None of them works with the <b style="color:#FFA34F">dldi</b>-tester or DSmail. Both of them works in DSftp, moonshell. So the information on the <b style="color:#FFA34F">DLDI</b> homepage should probably say partial on both DLDIs.
<br/>
<br/>
I hope someone can figure out why the dslink dldis only works with certain <b style="color:#FFA34F">dldi</b> implementations.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116235 - SukkoPera - Tue Jan 23, 2007 4:00 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">Does or will libfat provide a method to determine which type of card is inserted?</td> </tr></table><span class="postbody">
<br/>
<br/>
Yes, like:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
struct stat st;
<br/>
stat ("/.", &amp;st);
<br/>
</td> </tr></table><span class="postbody">
<br/>
Then look in st.st_dev. With the current DKP release this field is too short, so you will only get part of a string (like "SC" for supercards). It will be fixed in the next DKP release.<br/>_________________<br/>Nintendo DS Lite (White) + Supercard Lite + R4 + Sandisk 1 GB MicroSD
<br/>
Sony PSP + Firmware 3.03 OE-A2</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116318 - Lick - Wed Jan 24, 2007 11:18 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">Does or will libfat provide a method to determine which type of card is inserted? I noticed the latest version of libcartreset doesn't work with the latest libfat (undefined reference to _partition), so I have to use the non-FAT version which has no auto-detect. (Though it's probably healthier! ;-)) Currently, my card detection method is to have the user hex-edit the .nds file. :-/</td> </tr></table><span class="postbody">
<br/>
The <span style="font-weight: bold">"<span style="text-decoration: underline">hack</span>"</span> must be changed to use _FAT_partition instead of _partition. All the other stuff remain the same.<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116383 - chishm - Thu Jan 25, 2007 12:32 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lick wrote:</b></span></td> </tr> <tr> <td class="quote">The <span style="font-weight: bold">"<span style="text-decoration: underline">hack</span>"</span> must be changed to use _FAT_partition instead of _partition. All the other stuff remain the same.</td> </tr></table><span class="postbody">
<br/>
There's a good reason not to use use un-exposed functions and globals -- they're subject to change without notice. _partition is a good example of this, as it was renamed to _FAT_partition to keep with the rest of the naming scheme. Use the method detailed by SukkoPera when DKA r20 comes out (dev_t and ino_t are finally 32bit). The stat-&gt;st_dev field is the device type identifier, and will work with <b style="color:#FFA34F">DLDI</b> too. stat-&gt;st_ino is the start cluster of the stat'ed file, since inodes don't exist on FAT drives, but are almost equivalent to the start cluster in that they're a unique number identifying the file.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116411 - Maxim - Thu Jan 25, 2007 12:20 pm</h4>
    <div class="postbody"><span class="postbody">I did email chism about this, but maybe the hotmail address I used has been overrun by the spam fairies...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>I wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">typedef unsigned int addr_t;
<br/>
...
<br/>
       addr_t patchOffset;                     // Position of patch destination in the file
<br/>
...
<br/>
       patchOffset = quickFind ((const char*)appFileData, dldiMagicString,
<br/>
appFileSize, sizeof(dldiMagicString)/sizeof(char));
<br/>
<br/>
       if (patchOffset &lt; 0) {
<br/>
               printf ("%s does not have a <b style="color:#FFA34F">DLDI</b> section\n", appFileName);
<br/>
               return -1;
<br/>
       }</td> </tr></table><span class="postbody">
<br/>
When the magic string is not found, patchOffset is assigned -1, which
<br/>
it takes as 0xffffffff which is not &lt; 0.
<br/>
<br/>
Should be simple enough to fix; on my copy I upgraded quickFind to use
<br/>
addr_t and used UINT_MAX instead of -1 as the "not found" value - see
<br/>
attached, a quicker and dirtier hack would just to check for ==
<br/>
0xffffffff instead of &lt; 0.</span></td> </tr></table><span class="postbody">
<br/>
See <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?p=115935#115935" target="_blank">here</a> for an example of it confusing someone (although not actually breaking the program, seeking to 0xffffffff just results in the <b style="color:#FFA34F">DLDI</b> being appended to the original file).
<br/>
<br/>
My changed version is here: <a href="http://www.smspower.org/maxim/forumstuff/dlditool.c" target="_blank">http://www.smspower.org/maxim/forumstuff/dlditool.c</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116428 - sirpoonga - Thu Jan 25, 2007 5:56 pm</h4>
    <div class="postbody"><span class="postbody">If I have a R4DS and a Supercard Lite, if I patch a rom with the supercard <b style="color:#FFA34F">dldi</b> file but run it from the r4 will it save to the supercard?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116439 - josath - Thu Jan 25, 2007 7:48 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sirpoonga wrote:</b></span></td> </tr> <tr> <td class="quote">If I have a R4DS and a Supercard Lite, if I patch a rom with the supercard <b style="color:#FFA34F">dldi</b> file but run it from the r4 will it save to the supercard?</td> </tr></table><span class="postbody">
<br/>
probably. you could always try it and see what happens</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116460 - Firon - Thu Jan 25, 2007 11:15 pm</h4>
    <div class="postbody"><span class="postbody">From what I've been seeing, it'll read and write everything from the slot-2 device, instead of the slot-1.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116464 - sirpoonga - Fri Jan 26, 2007 12:08 am</h4>
    <div class="postbody"><span class="postbody">So does that mean if I patch a program with the supercard patch it will use the supercard?  If I patch with R4 it will use the R4?  In both situation both devices are plugged in.
<br/>
<br/>
josath, I can't try it but I might be getting both an R4 and supercard lite.  Just wondering if I will run into any problems.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116467 - josath - Fri Jan 26, 2007 12:42 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sirpoonga wrote:</b></span></td> </tr> <tr> <td class="quote">So does that mean if I patch a program with the supercard patch it will use the supercard?  If I patch with R4 it will use the R4?  In both situation both devices are plugged in.
<br/>
<br/>
josath, I can't try it but I might be getting both an R4 and supercard lite.  Just wondering if I will run into any problems.</td> </tr></table><span class="postbody">
<br/>
<br/>
Why in the world would you get both?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116473 - tepples - Fri Jan 26, 2007 1:20 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>josath wrote:</b></span></td> </tr> <tr> <td class="quote">Why in the world would you get both [a SLOT-1 microSD adapter and a SLOT-2 microSD adapter]?</td> </tr></table><span class="postbody">
<br/>
To copy files from one to the other, for one thing.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116478 - chishm - Fri Jan 26, 2007 4:10 am</h4>
    <div class="postbody"><span class="postbody">Sorry about not responding, Maxim. Like many people, I lose track of my emails (80 in my inbox at last count). Since dlditool is now part of DevkitARM, I updated the code in CVS. Code is <a class="postlink" href="http://devkitpro.cvs.sourceforge.net/devkitpro/tools/nds/dlditool/" target="_blank">here</a> and the binaries will be distributed with DKA. The <b style="color:#FFA34F">DLDI</b> template will be changed too, becoming just another NDS code example. I'll update the <b style="color:#FFA34F">DLDI</b> page to reflect these changes when DKA is released (should be fairly soon).
<br/>
<br/>
Rather than changing the function to not return -1, addr_t is now a signed int. This makes more sense within the surrounding code too, as addr_t typed variables are added and subtracted to give signed results.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116512 - Lick - Fri Jan 26, 2007 2:16 pm</h4>
    <div class="postbody"><span class="postbody">How possible and useful is it to port dlditool (+ custom GUI) to NDS? The tool itself would need <b style="color:#FFA34F">dldi</b> patching beforehand, but afterwards it could patch files without having to visit the do it on a computer.<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116513 - tyraen - Fri Jan 26, 2007 2:22 pm</h4>
    <div class="postbody"><span class="postbody">Make it a plugin/executable for DSO. :)  I'm not 100% up on how an NDS file is launched from MightyMax's code, but wouldn't it even be possible to patch on the fly as it's being loaded into memory?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116528 - Lick - Fri Jan 26, 2007 4:07 pm</h4>
    <div class="postbody"><span class="postbody">Everything is possible, but that would mean you have to boot up DSOrganize everytime you want to run the homebrew, because the file itself isn't patched, only a copy of it in memory.<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116531 - tyraen - Fri Jan 26, 2007 4:23 pm</h4>
    <div class="postbody"><span class="postbody">Right, I was thinking back to the development of the OS in that other thread.  I'm sort of picturing DSO being the launcher/main app or whatnot, since it seems like there are a number of people who have their carts launch Moonshell by default.  It would be neat if you only had to patch your main app, and then have it patch/launch everything from there.  It'd be even handier if the firmware could do it obviously. :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116602 - tepples - Sat Jan 27, 2007 6:28 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lick wrote:</b></span></td> </tr> <tr> <td class="quote">Everything is possible, but that would mean you have to boot up DSOrganize everytime you want to run the homebrew, because the file itself isn't patched, only a copy of it in memory.</td> </tr></table><span class="postbody">
<br/>
Setting DSOrganize as _boot_mp.nds and having it open Browser Channel on startup is not a problem for GBA Movie Player owners like myself. I own one CF card for DSO and one for MoonShell.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116618 - Lick - Sat Jan 27, 2007 12:38 pm</h4>
    <div class="postbody"><span class="postbody">tepples: as a developer, I would choose a cross-device, DSO-independent path.<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116622 - tyraen - Sat Jan 27, 2007 1:54 pm</h4>
    <div class="postbody"><span class="postbody">Lick: True, and I guess I'm not against that.  Either way there's got to be an app in the middle though.  Say you design a version of dlditool for the DS.  When it's launched, it has a file selector.  Maybe it has two functions: patch, or patch and launch.
<br/>
<br/>
Maybe you had something better in mind though, I dunno.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116626 - tyraen - Sat Jan 27, 2007 2:45 pm</h4>
    <div class="postbody"><span class="postbody">Proof of concept maybe?
<br/>
<br/>
<a class="postlink" href="http://nick.spacek.googlepages.com/dsoDLDI.zip" target="_blank">http://nick.spacek.googlepages.com/dsoDLDI.zip</a>
<br/>
<br/>
Should probably be an executable, but then I haven't really played with that and don't know if I could bring up the file browser with it (probably not).
<br/>
<br/>
Anyways, the code's all there.  Right now it grabs the "sclt.<b style="color:#FFA34F">dldi</b>" from the root of your card, you can change that in main.cpp though.  Also, the file has to have an extension ".bds".
<br/>
<br/>
I tested it on my SC Lite.  Renamed with DSO to .bds, opened it, rebooted and started from SC menu (since I currently can't launch apps from DSO).  I tried the dldi_tester before running this on it, failed at init.  After, all tests pass.
<br/>
<br/>
Anyways, the code's pretty much out of the DSO plugin example.  I took that and slapped in the dlditool.c and separated that into a .c and .h, changed the main method, commented some things, etc. etc.
<br/>
<br/>
And since I threw it together in a little while it's probably not the best code... :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116748 - felix123 - Mon Jan 29, 2007 2:13 am</h4>
    <div class="postbody"><span class="postbody"><a href="http://down.yyjoy.com/rom/NDS/FLASH/AK/ak+/ak+dldi.rar" target="_blank">http://down.yyjoy.com/rom/NDS/FLASH/AK/ak+/ak+<b style="color:#FFA34F">dldi</b>.rar</a>
<br/>
<b style="color:#FFA34F">DLDI</b> patch for the <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?p=116747" target="_blank">new Acekard+ with FAT support</a>.<br/>_________________<br/><a class="postlink" href="http://en.wikipedia.org/wiki/NDSh" target="_blank">Nintendo DS homebrew on Wikipedia</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116788 - sirpoonga - Mon Jan 29, 2007 6:11 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>josath wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Why in the world would you get both?</td> </tr></table><span class="postbody">
<br/>
Several reasons.
<br/>
1) To make sure my game code runs on both.
<br/>
2) To keep in mind the differences between slot 1 and slot 2 when programming, like sram.
<br/>
3) DS Motion
<br/>
4) Rumble Pak
<br/>
5) Along with DS Motion I might make my games work with that Yoshi's tilt sensor so slot 1 people aren't left out.
<br/>
6) Homebrew compatibility.  Some games will only work on a slot 2 device.
<br/>
7) With a slot 2 I would need a nopass device.  The R4 acts as a no pass.  While it is twice the price as a nopass card I figured I might as well go that route because of all the above reasons.
<br/>
<br/>
Most of the time I had my dsx and my rumble pak in my nds.  I am tempted to get a supercard rumble instead of a lite but I hear it's rumble sucks.  That would be the best setup for me.  I know the rumble wouldn't have sram but then I wouldn't need to be taking cards in and out of the ds.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116799 - tepples - Mon Jan 29, 2007 8:40 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sirpoonga wrote:</b></span></td> </tr> <tr> <td class="quote">I am tempted to get a supercard rumble instead of a lite but I hear it's rumble sucks.</td> </tr></table><span class="postbody">
<br/>
Its compatibility with .gba and ds.gba homebrew also sucks (that is, .gba and ds.gba don't work at all on the rumble).<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116807 - dantheman - Mon Jan 29, 2007 10:15 pm</h4>
    <div class="postbody"><span class="postbody">I've actually been curious about that for a while now.  Normal Supercards require the rom header to be intact, so for most homebrew, it's best to use the .ds.gba version, renamed to .nds.  For a Supercard Rumble, is this still the case?  Or does the absense of RAM mean that only the .nds builds even work at all?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116971 - chishm - Wed Jan 31, 2007 1:26 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>felix123 wrote:</b></span></td> </tr> <tr> <td class="quote">http://down.yyjoy.com/rom/NDS/FLASH/AK/ak+/ak+<b style="color:#FFA34F">dldi</b>.rar
<br/>
<b style="color:#FFA34F">DLDI</b> patch for the <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?p=116747" target="_blank">new Acekard+ with FAT support</a>.</td> </tr></table><span class="postbody">
<br/>
Have you got another link for the patch? The supplied link doesn't work for me.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116973 - Lick - Wed Jan 31, 2007 1:36 pm</h4>
    <div class="postbody"><span class="postbody"><a class="postlink" href="http://lick.huuf.net/ak+dldi.rar" target="_blank">http://lick.huuf.net/ak+<b style="color:#FFA34F">dldi</b>.rar</a>
<br/>
<br/>
I found it in their [yoyo] forum.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117404 - bob_fossil - Sun Feb 04, 2007 5:38 pm</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
There's a new version of the Windows patcher at:
<br/>
<br/>
<a href="http://home.clara.net/adamhodson/dldi32-0032.zip" target="_blank">http://home.clara.net/adamhodson/dldi32-0032.zip</a>
<br/>
<br/>
- Updated to latest source 1.23 from DevKitPro CVS.
<br/>
- Fixed dialog sizing error (Maxim).
<br/>
- Added icon (Maxim).
<br/>
- Added file filters to .nds browse dialog (Maxim).
<br/>
- .nds browse dialog supports multiple selections (Maxim/bob_fossil)
<br/>
- Fixes to the output window with moved caret/text selections (Maxim).
<br/>
<br/>
Adam</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117695 - sirpoonga - Tue Feb 06, 2007 6:29 pm</h4>
    <div class="postbody"><span class="postbody">CycloDS has a <b style="color:#FFA34F">DLDI</b> file?
<br/>
<a href="http://www.cyclopsds.com/cgi-bin/cyclods/engine.pl?page=support" target="_blank">http://www.cyclopsds.com/cgi-bin/cyclods/engine.pl?page=support</a>
<br/>
<br/>
I've been thinking of getting this as I have a really cheap source.  Apparently it has an NES emulator built in.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117724 - josath - Tue Feb 06, 2007 11:36 pm</h4>
    <div class="postbody"><span class="postbody">I think cyclods is just a supercard clone/ripoff. I could be wrong though.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117759 - sirpoonga - Wed Feb 07, 2007 4:45 am</h4>
    <div class="postbody"><span class="postbody">I will see if I can find the article but someone interviewed the cyclods team and they said it was different.:?
<br/>
<br/>
It does have a nes emu built in, that's partly why I might get it.  I am also getting a good deal on one.  I was just kinda suprised to see they put a didl file out for it.  Though if it is a supercard clone that would make sense.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117761 - chishm - Wed Feb 07, 2007 4:54 am</h4>
    <div class="postbody"><span class="postbody">Apart from the name and device ID, the <b style="color:#FFA34F">DLDI</b> files for the SCSD and CYDS are byte identical.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117762 - dantheman - Wed Feb 07, 2007 5:06 am</h4>
    <div class="postbody"><span class="postbody">I looked at the CycloDS <b style="color:#FFA34F">DLDI</b> file and compared it to the Supercard SD <b style="color:#FFA34F">DLDI</b> file in a hex editor.  They are nearly identical.  Just take the Supercard file, change the header from "Supercard (SD Card)" to "CycloDS", change offset 60 to say "CYDS" instead of "SCS", and change offset 22 from 00 to 09.  Check the CRCs of the files and you'll find that they are now identical.
<br/>
<br/>
EDIT:  drat, 10 minutes too late.  That'll teach me to take forever writing a reply and then fail to refresh before posting it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117782 - tyraen - Wed Feb 07, 2007 12:27 pm</h4>
    <div class="postbody"><span class="postbody">Now I'm not 100% sure, but I have an SC Lite and I think it has an NES emu built in...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117791 - tepples - Wed Feb 07, 2007 3:15 pm</h4>
    <div class="postbody"><span class="postbody">That's probably just PocketNES, where the firmware includes a rom builder.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117793 - SukkoPera - Wed Feb 07, 2007 3:30 pm</h4>
    <div class="postbody"><span class="postbody">Yup, that's PocketNET v9.97. It also includes Goomba Color alpha 6 and DrSMS (unknown version). I'm talking about the latest 1.70 firmware.<br/>_________________<br/>Nintendo DS Lite (White) + Supercard Lite + R4 + Sandisk 1 GB MicroSD
<br/>
Sony PSP + Firmware 3.03 OE-A2</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117801 - sirpoonga - Wed Feb 07, 2007 4:56 pm</h4>
    <div class="postbody"><span class="postbody">Cool, then I will get it since I found it for a very good price.  And <b style="color:#FFA34F">DLDI</b> should work pretty well.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117815 - bugmenot! - Wed Feb 07, 2007 9:15 pm</h4>
    <div class="postbody"><span class="postbody">There's a DLDI for the DS-Xtreme now:
<br/>
<a href="http://news.ds-x.com/dsxdldi.zip/dsxdldi.zip" target="_blank">http://news.ds-x.com/dsxdldi.zip/dsxdldi.zip</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#118169 - bugmenot! - Sat Feb 10, 2007 5:17 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>bugmenot! wrote:</b></span></td> </tr> <tr> <td class="quote">There's a DLDI for the DS-Xtreme now:
<br/>
<a href="http://news.ds-x.com/dsxdldi.zip/dsxdldi.zip" target="_blank">http://news.ds-x.com/dsxdldi.zip/dsxdldi.zip</a></td> </tr></table><span class="postbody">
<br/>
<br/>
And an interesting thread about libfat as well: <a href="http://forums.ds-xtreme.com/showthread.php?t=2667" target="_blank">http://forums.ds-xtreme.com/showthread.php?t=2667</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#118238 - felix123 - Sun Feb 11, 2007 11:27 am</h4>
    <div class="postbody"><span class="postbody">yeyezai <a class="postlink" href="http://blog.tgb.net.cn/dldi/" target="_blank">translated the DLDI page</a> into Simplified Chinese. It is mostly accurate, but slightly outdated.<br/>_________________<br/><a class="postlink" href="http://en.wikipedia.org/wiki/NDSh" target="_blank">Nintendo DS homebrew on Wikipedia</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#124888 - ps2aich - Mon Apr 09, 2007 5:53 pm</h4>
    <div class="postbody"><span class="postbody">Finally, I now have the GBAMP SD DLDI working.
<br/>
<br/>
The trick was to not optimize the code (by removing
<br/>
the -O2 from the compiler options).
<br/>
<br/>
<a class="postlink" href="http://www.divshare.com/download/364026-ac7" target="_blank">mpsd.dldi including sources</a>
<br/>
<br/>
Can please some other GBAMP SD owner verify it?
<br/>
<br/>
I quick-tested personally some apps, with following results:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
DSOrganize 2.6.1      --- working (mp3 playing)
<br/>
Nitrotracker 0.3      --- not working (start screen comes, then fades out)
<br/>
Moonshell 1.7.1       --- not working (Last line is: Initialize random seed.)
<br/>
DSZhongwen            --- not working
<br/>
NitroHax 0.81         --- working (can access SD card and load XMl file)
<br/>
ReadMoreAlpha         --- cannot boot the nds file
<br/>
NDS_loader            --- not working
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#124891 - simonjhall - Mon Apr 09, 2007 6:28 pm</h4>
    <div class="postbody"><span class="postbody">I guess this doesn't really count as 'working' does it when most things you try don't work!
<br/>
<br/>
The need to disable optimisations is a bit worrying - do you know who wrote the driver? Sounds like functions need to be selectively optimised until the function which the compiler breaks is found...<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#124895 - ps2aich - Mon Apr 09, 2007 6:57 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>simonjhall wrote:</b></span></td> </tr> <tr> <td class="quote">I guess this doesn't really count as 'working' does it when most things you try don't work!
<br/>
<br/>
The need to disable optimisations is a bit worrying - do you know who wrote the driver? Sounds like functions need to be selectively optimised until the function which the compiler breaks is found...</td> </tr></table><span class="postbody">
<br/>
<br/>
The code comes from movieadvance itself. They use e.g. for-loops for
<br/>
clocking and timing.
<br/>
I have  done no changes to the code so far (it seems I am the first to
<br/>
try it with dldi ...) but it works in the 1.5.1 moonshell version (without dldi, but same code)  for
<br/>
me for 3 months now using my nds lite as mp3 player. Unfortunately, the
<br/>
1.7.1 version with dldi does not startup completely (but seems to initialize the file system successfully).
<br/>
<br/>
My assumption is, that the sd card controller is connected very, hm, direct, no hardware inbetween. But I can only guess ...
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
Snippets from the driver:
<br/>
<br/>
void CLK(void)
<br/>
{
<br/>
   u16 i;
<br/>
<br/>
   SDDIR=0x0;//send=0,get=0 clk low
<br/>
   for(i=0;i&lt;1;i++);
<br/>
   SDDIR=0x8;//send=0,get=0 clk high
<br/>
}
<br/>
<br/>
void send_byte2(u16 input)
<br/>
{   
<br/>
   u16 j;
<br/>
   
<br/>
   SDODA=input;//obyte[7:0]=input
<br/>
   SDDIR=0x29;
<br/>
   for(j=0;j&lt;5;j++);
<br/>
   SDDIR=0x09;
<br/>
}
<br/>
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#124896 - simonjhall - Mon Apr 09, 2007 7:04 pm</h4>
    <div class="postbody"><span class="postbody">Yeah, I see what you mean. Looks like those functions require proper timings, and -O'ing the code would remove those loops.
<br/>
Those variables definately need a bit of volatile lovin'- makes you wonder what other code needs the same treatment!<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#124997 - ps2aich - Tue Apr 10, 2007 8:09 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>simonjhall wrote:</b></span></td> </tr> <tr> <td class="quote">Yeah, I see what you mean. Looks like those functions require proper timings, and -O'ing the code would remove those loops.
<br/>
Those variables definately need a bit of volatile lovin'- makes you wonder what other code needs the same treatment!</td> </tr></table><span class="postbody">
<br/>
<br/>
You are right, I think I will look into this. Volatile will keep off the compiler to 'optimize' it :-) 
<br/>
Since I only do very sporadically coding on ds, I'm happy enough that
<br/>
it kind of works in general now. 
<br/>
By comparing the code with that <a class="postlink" href="http://www.maxim-ic.com/appnotes.cfm/an_pk/3969" target="_blank">site</a>, it seems the sd card is addressed in SPI mode, perhaps I can add proper startup and detection code ....
<br/>
<br/>
Thanks for your comments :-)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#125013 - tepples - Tue Apr 10, 2007 9:55 pm</h4>
    <div class="postbody"><span class="postbody">If 'volatile' isn't enough, and you really need cycle timing, then it might be better to see what assembly code the unoptimizing compiler produces (by using arm-eabi-gcc [options] -S -o asmcode.s) and then just work from that assembly language file.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#125352 - ps2aich - Thu Apr 12, 2007 7:14 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">If 'volatile' isn't enough, and you really need cycle timing, then it might be better to see what assembly code the unoptimizing compiler produces (by using arm-eabi-gcc [options] -S -o asmcode.s) and then just work from that assembly language file.</td> </tr></table><span class="postbody">
<br/>
<br/>
I currently replaced the for-loops by inlined nops (mov r0,r0) to be completely independent from compiler settings, and then
<br/>
it works again with -O2 compiler setting.
<br/>
A very exact timing seems not the problem here, a </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">asm (
<br/>
   "mov r0,r0\n"
<br/>
   "mov r0,r0\n"
<br/>
   "mov r0,r0\n"
<br/>
   "mov r0,r0\n"
<br/>
   );</td> </tr></table><span class="postbody"> is sufficient to replace the </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">for(i=0;i&lt;1;i++);</td> </tr></table><span class="postbody">
<br/>
<br/>
I'm not sure how the sd card is interfaced, because I tried other SD card
<br/>
commands (SEND_CSD,WRITE_BLOCK) in a SPI like mode, but had no
<br/>
response at all, I suppose that really only reading the sd card is possible.
<br/>
<br/>
Thanks for all comments :-)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#126253 - ps2aich - Sat Apr 21, 2007 10:45 am</h4>
    <div class="postbody"><span class="postbody">I just updated the GBAMP SD DLDI driver in the DLDI Wiki <a class="postlink" href="http://dldi.drunkencoders.com/index.php?title=GBA_Movie_Player_%28SD_Card%29" target="_blank">here</a>
<br/>
<br/>
The version has only minimal changes to the code provided by Movie Advance: the for-loops for timing are replaced by NOPs (mov r0,r0) to
<br/>
be not dependent on -O flag of the compiler.
<br/>
<br/>
So all GBAMP SD users feel free to use it.
<br/>
<br/>
Until yesterday, my strong opinion was that no homebrew launchers are working on the GBAMP SD,
<br/>
but that is not true, I've got now some strange combination of DLDI based launchers to work, I will report this
<br/>
later this weekend in a seperate thread (this also solves some issues
<br/>
I had e.g. with Nitro Hax :-) ), when I have sorted it out more clean and
<br/>
provide a complete setup that GBAMP SD users can use out of the box
<br/>
to start with. 
<br/>
<br/>
Have fun!
<br/>
<br/>
Edit: The announced <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=13043" target="_blank">thread</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#132438 - FierociousGT - Tue Jun 26, 2007 6:22 pm</h4>
    <div class="postbody"><span class="postbody">Does anyone have the DLDI patch for new G6 DS Real?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#132537 - olimar - Wed Jun 27, 2007 5:18 pm</h4>
    <div class="postbody"><span class="postbody"></span><span class="gensmall"><br/><br/>Last edited by olimar on Wed Aug 20, 2008 10:41 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#132550 - tepples - Wed Jun 27, 2007 7:34 pm</h4>
    <div class="postbody"><span class="postbody">In my experience, DMA3 is just used for memcpy() clones anyway. Or does the DS Link driver set up the DMA3 control or address registers and then expect the register values to remain unchanged from one call to the next?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#132552 - olimar - Wed Jun 27, 2007 7:41 pm</h4>
    <div class="postbody"><span class="postbody"></span><span class="gensmall"><br/><br/>Last edited by olimar on Wed Aug 20, 2008 10:42 pm; edited 2 times in total</span></div>    
</div>
<div class="post">
    <h4>#132554 - tepples - Wed Jun 27, 2007 8:05 pm</h4>
    <div class="postbody"><span class="postbody">This just means that Chishm has to update the DLDI spec with information about what DMA channels a driver is allowed to use, and update the libfat spec to undefine the behavior when those DMA channels are in use at the time of a FAT operation.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#132558 - olimar - Wed Jun 27, 2007 8:27 pm</h4>
    <div class="postbody"><span class="postbody"></span><span class="gensmall"><br/><br/>Last edited by olimar on Wed Aug 20, 2008 10:42 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#132607 - chishm - Thu Jun 28, 2007 3:57 am</h4>
    <div class="postbody"><span class="postbody">Loopy is correct, DLDI drivers should be coded without using DMA if at all possible. This is not just due to it interfering with the host app, but also because they can be slower than simple CPU copies. DMA transfers on the ARM9 have to be wrapped with cache flushes/invalidations in the general case, which causes a performance hit.
<br/>
<br/>
I am currently busy with other projects, but if someone else wants to they can fix the problems in the driver.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143797 - cybermind - Fri Oct 26, 2007 2:45 am</h4>
    <div class="postbody"><span class="postbody">I have recently made a small modification to libfat/dldi.
<br/>
<br/>
I basically copied the dldi IO_INTERFACE driver, renamed all dldi references to dlds (I chose this for <span style="font-weight: bold">S</span>econdary), and added it into the ioInterfaces list after _io_dldi. I modified the magic numbers and strings in order to separate itself from DLDI totally.
<br/>
<br/>
Then I took dlditool and modified it to look for the new DLDS magic numbers/headers/etc, as well as making a copy of the .dldi patch file, renaming to .dlds, and modifying the magic number/string in the beginning.
<br/>
<br/>
Basically, this just creates a second patchable dldi sector in homebrew. This lets you patch an .nds for two different cart/cards, allowing dynamic support for both slot1 and slot2 at the same time. You can patch either segment to any type card, and it'll still use fat1: and fat2: to access nds and gba respectively. If you patch both segments to use drivers for the same slot, libfat will only utilize the DLDI driver, ignoring the second.
<br/>
<br/>
I don't know if anyone else has an interest for this, but it might help with writing dual slot homebrew (such as the fairly outdated and broken DSFile2).
<br/>
<br/>
As with DLDI, if you don't patch DLDS, libfat will simply start trying the default hardcoded libfat IO_INTERFACEs.
<br/>
<br/>
In my example, I changed the magic numbers (merely for testing purposes, I'm not saying this should be adopted in any way) from:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">\xED\xA5\x8D\xBF Chishm</td> </tr></table><span class="postbody">
<br/>
to
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">\xEC\xA4\x8C\xBE cmdlds</td> </tr></table><span class="postbody">
<br/>
<br/>
and replaced all references to "dldi" or "DLDI" to "dlds" or "DLDS".
<br/>
<br/>
I have only tested this with an R4, so I don't know if it will actually support two devices at once (but there's no reason it shouldn't). I no-autopatched the DLDI segment of a test file, so the R4 didn't autopatch it, then I patched the DLDS segment with my new r4tf.dlds driver file, and it seemed to work as desired. I independently verified that the DLDI segment was obfuscated and not patched by the R4.</span><span class="gensmall"><br/><br/>Last edited by cybermind on Fri Oct 26, 2007 3:41 am; edited 2 times in total</span></div>    
</div>
<div class="post">
    <h4>#143798 - Lick - Fri Oct 26, 2007 3:04 am</h4>
    <div class="postbody"><span class="postbody">cybermind, that's pretty cool. Do you have a link?<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143799 - cybermind - Fri Oct 26, 2007 3:07 am</h4>
    <div class="postbody"><span class="postbody">Edit: Here is a link of all the files I used:
<br/>
<br/>
<a href="http://cybermind.user.stfunoob.com/dlds/" target="_blank">http://cybermind.user.stfunoob.com/dlds/</a>
<br/>
<br/>
files.txt explains what each file is
<br/>
<br/>
<br/>
If you use an R4, remember to <a class="postlink" href="http://dldi.drunkencoders.com/index.php?title=DLDI_No-AutoPatch" target="_blank">no-autopatch </a>the DLDI segment so that it doesn't automatically get patched and you can verify that the DLDS driver works.
<br/>
<br/>
Keep in mind I'm only posting all this just to see if the community would like to come to a consensus on a standard for this (and hoping Chishm could make an official release), or to see if nobody is going to use it.</span><span class="gensmall"><br/><br/>Last edited by cybermind on Fri Oct 26, 2007 4:43 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#143800 - Creebo - Fri Oct 26, 2007 3:48 am</h4>
    <div class="postbody"><span class="postbody">Wow this looks great cybermind! Bout time somebody did somethin</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143801 - HyperHacker - Fri Oct 26, 2007 6:23 am</h4>
    <div class="postbody"><span class="postbody">Nice. I'd love to see official support for dual patching, though ideally only if you enable it in your app with a #define. (No sense having a second DLDI section wasting space if you don't plan to access both slots.) Is "DLDS" necessary, though? Could you not just modify the patcher to patch the second DLDI section it finds when given a certain command-line flag?<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143804 - cybermind - Fri Oct 26, 2007 6:35 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">Nice. I'd love to see official support for dual patching, though ideally only if you enable it in your app with a #define. (No sense having a second DLDI section wasting space if you don't plan to access both slots.)</td> </tr></table><span class="postbody">I was thinking this, but since the DLDI driver stubs are within the libfat.a library, it would be difficult. The simplest, but least streamlined, solution is to provide 2 different libraries, one with only one DLDI section, and a second with two (libfatx.a ?). The other solution that comes to mind would be to make the second DLDI stub not be 32KiB (only taking up about 150 bytes or so), and instead modify the binary's size when patching. This, of course, would be a bit more difficult.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Is "DLDS" necessary, though? Could you not just modify the patcher to patch the second DLDI section it finds when given a certain command-line flag?</td> </tr></table><span class="postbody">Of course it's not necessary, and I had thought of something similar after posting, but at the time of thinking of this, it seemed the simplest option. Like I said, I didn't really intend for any of this to be "the way to do it," just that I am putting the idea out there.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143809 - cybermind - Fri Oct 26, 2007 7:18 am</h4>
    <div class="postbody"><span class="postbody">The second DLDI stub can be compiled into the homebrew app.
<br/>
<br/>
After initializing libfat, you call fatMountCustomInterface() with the IO_INTERFACE* for the secondary DLDI driver (just compile and link io_dldi.s within your app, remembering the header), and it will load as the fat3: device. The original DLDI driver will be either fat1: or fat2: depending on what device it was (and should be available under fat0:).
<br/>
<br/>
Also, you should be able to access _io_dldi-&gt;features (provided you include the IO_INTERFACE definition from within disc_io.h). From here, you can check what slot the secondary DLDI stub was patched for by checking for the FEATURE_SLOT_NDS or FEATURE_SLOT_GBA flag (and also what slot the fat0: device actually belongs to, although you could do all this by checking the return value from fatSetDefaultInterface(PI_SLOT_1) as well).
<br/>
<br/>
It is a bit counterproductive, but it should work right now without modifying libfat at all.
<br/>
<br/>
In general, I think two libfat libraries would be the easiest and least messy solution.</span><span class="gensmall"><br/><br/>Last edited by cybermind on Fri Oct 26, 2007 10:12 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#143814 - chishm - Fri Oct 26, 2007 9:58 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>cybermind wrote:</b></span></td> </tr> <tr> <td class="quote">In general, I think two libfat libraries would be the easiest and least messy solution.</td> </tr></table><span class="postbody">
<br/>
Oh heck no. That would require duplication of all libfat functions under two different names, with no real benefit. If there is demand for the ability to use more than one DLDI driver at a time then I can add that functionality directly to libfat. 
<br/>
<br/>
It won't be done this way though. DLDS wastes 32KiB with little gain for the majority users. Instead, I'll change the DLDI loading code and patcher to allow multiple drivers in the DLDI section. It'll take a little while to get done, though.
<br/>
<br/>
The idea of having multiple DLDI drivers at once is good, but this implementation isn't.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143815 - cybermind - Fri Oct 26, 2007 10:10 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote">Oh heck no. That would require duplication of all libfat functions under two different names, with no real benefit.</td> </tr></table><span class="postbody">I meant only linking one of two different libraries with an app, depending on whether or not you need 1 or 2 DLDI drivers. I wasn't talking about linking in two copies of the libfat library at once. 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote">It won't be done this way though. DLDS wastes 32KiB with little gain for the majority users.</td> </tr></table><span class="postbody">You can remove over 100KiB by getting rid of all the old legacy non-DLDI IO_INTERFACE drivers.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote">Instead, I'll change the DLDI loading code and patcher to allow multiple drivers in the DLDI section. It'll take a little while to get done, though.</td> </tr></table><span class="postbody">That would require a fairly sizable change to the IO_INTERFACE mechanism, no? Although once you have dual-DLDI support, you shouldn't really need that system anyway.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143823 - OSW - Fri Oct 26, 2007 11:36 am</h4>
    <div class="postbody"><span class="postbody">but does this actually all work.
<br/>
<br/>
ie. if I dldi patch an application for a slot two device, and run it on my slot one device, i don't think it can read/write from slot two.
<br/>
<br/>
wouldn't you need to adapt the code?
<br/>
<br/>
Or am I mistaken.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143826 - chishm - Fri Oct 26, 2007 12:53 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>cybermind wrote:</b></span></td> </tr> <tr> <td class="quote">I meant only linking one of two different libraries with an app, depending on whether or not you need 1 or 2 DLDI drivers. I wasn't talking about linking in two copies of the libfat library at once.</td> </tr></table><span class="postbody">
<br/>
Oh, well that's more reasonable, but can also lead to confusion, as happened when GBA_NDS_FAT was forked into multiple versions (also for device support, funnily enough).
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>cybermind wrote:</b></span></td> </tr> <tr> <td class="quote">You can remove over 100KiB by getting rid of all the old legacy non-DLDI IO_INTERFACE drivers.</td> </tr></table><span class="postbody">
<br/>
Actually, it's more like 10-20KiB. The size of the compiled NDS file is not directly related to the size of the library (.a) file, and all the compact flash based cards share a common driver.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>cybermind wrote:</b></span></td> </tr> <tr> <td class="quote">That would require a fairly sizable change to the IO_INTERFACE mechanism, no? Although once you have dual-DLDI support, you shouldn't really need that system anyway.</td> </tr></table><span class="postbody">
<br/>
Not too significant, but it will require some changes. 
<br/>
<br/>
My biggest concern at the moment is existing patchers (like those built into the loader of some devices) that completely overwrites the DLDI section.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143827 - simonjhall - Fri Oct 26, 2007 12:54 pm</h4>
    <div class="postbody"><span class="postbody">The application would have to use fat1:/ or fat2:/ at the front of the path names in order to select the device to read from, right? That's probably about it...<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143834 - Diddl - Fri Oct 26, 2007 3:27 pm</h4>
    <div class="postbody"><span class="postbody">for support of ACEkard RPG and a additional slot 2 card we would need 3 <b style="color:#FFA34F">DLDI</b> at sametime.
<br/>
<br/>
fat1:/
<br/>
fat2:/
<br/>
fat3:/
<br/>
<br/>
if you make changes in <b style="color:#FFA34F">DLDI</b> implementation and libfat it would be nice to add this feature also.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143836 - cornaljoe - Fri Oct 26, 2007 4:10 pm</h4>
    <div class="postbody"><span class="postbody">I'm having a problem with the test program.  I patched it with my regular DLDITool for the Slot-1.  Then used your modified DLDITool and a modified(magic string changed) <b style="color:#FFA34F">DLDI</b> file to patch for Slot-2.  But when booted from Slot-1 it only list files on Slot-1.  Did I miss anything?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143837 - cybermind - Fri Oct 26, 2007 4:32 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote">My biggest concern at the moment is existing patchers (like those built into the loader of some devices) that completely overwrites the <b style="color:#FFA34F">DLDI</b> section.</td> </tr></table><span class="postbody">I had thought of this too, which is why some things become problematic. You definitely do not want to alienate anybody by making existing patchers break new code.
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Diddl wrote:</b></span></td> </tr> <tr> <td class="quote">for support of ACEkard RPG and a additional slot 2 card we would need 3 <b style="color:#FFA34F">DLDI</b> at sametime.
<br/>
<br/>
fat1:/
<br/>
fat2:/
<br/>
fat3:/
<br/>
<br/>
if you make changes in <b style="color:#FFA34F">DLDI</b> implementation and libfat it would be nice to add this feature also.</td> </tr></table><span class="postbody">No other cart solutions would end up with 3 different storage devices at once (except perhaps the 3in1's two flash sectors plus a slot1 card), but it seems like it would be a very specific problem that the application would already expect. Support for 2 <b style="color:#FFA34F">DLDI</b> devices (AceKard removable media, slot2 card) is all you really need, and then specific code to access the flash sector of the AceKard.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>cornaljoe wrote:</b></span></td> </tr> <tr> <td class="quote">I'm having a problem with the test program.  I patched it with my regular DLDITool for the Slot-1.  Then used your modified DLDITool and a modified(magic string changed) <b style="color:#FFA34F">DLDI</b> file to patch for Slot-2.  But when booted from Slot-1 it only list files on Slot-1.  Did I miss anything?</td> </tr></table><span class="postbody">It only lists from the default device. My testing was based on the fact that I did not load a <b style="color:#FFA34F">DLDI</b> driver at all, only the DLDS. If you add extra code to diropen("fat2:/") and perform the scan, you can check that it works on both slots at once. Keep in mind though, as I stated originally (and Chishm has pointed out), my method is very bad (but it was done in the interest of getting it set up quickly for testing), but I was merely getting the idea out there. Don't expect the end result Chishm comes up with to be anything like this at all.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143846 - tepples - Fri Oct 26, 2007 7:50 pm</h4>
    <div class="postbody"><span class="postbody">The Allegro library has a <a class="postlink" href="http://alleg.sourceforge.net/stabledocs/en/alleg043.html" target="_blank">mechanism</a> for deciding which video, audio, and joystick drivers to include in statically linked executables. Chishm, you might consider using this as an example of how to set up libfat such that main.c chooses the drivers. A program would have lines like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">BEGIN_DISCIO_DRIVER_LIST
<br/>
  DISCIO_DRIVER_DLDI
<br/>
  DISCIO_DRIVER_DLDI2
<br/>
  DISCIO_DRIVER_SLOT2CF
<br/>
END_DISCIO_DRIVER_LIST
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143857 - HyperHacker - Fri Oct 26, 2007 9:12 pm</h4>
    <div class="postbody"><span class="postbody">Has anyone considered loading the second driver at runtime from the filesystem? Put <b style="color:#FFA34F">DLDI</b> files in /data/<b style="color:#FFA34F">dldi</b> and it detects the type of the other card and loads the driver.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143898 - chishm - Sat Oct 27, 2007 5:23 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">The Allegro library has a <a class="postlink" href="http://alleg.sourceforge.net/stabledocs/en/alleg043.html" target="_blank">mechanism</a> for deciding which video, audio, and joystick drivers to include in statically linked executables. Chishm, you might consider using this as an example of how to set up libfat such that main.c chooses the drivers.</td> </tr></table><span class="postbody">
<br/>
Deciding on the exact drivers at compile time would defeat the purpose of having interchangeable drivers initialised at run time. That is effectively going back to the "bad old days" of GBA_NDS_FAT and its various forks, where the library was compiled at the same time as your program and allowed you to remove and add drivers as you saw fit. This lead to the need for recompilation every time a new, unforeseen device came out.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143931 - tepples - Sat Oct 27, 2007 2:35 pm</h4>
    <div class="postbody"><span class="postbody">Mostly, my suggestion was to allow programs to specify at compile time whether or not they want to use the built-in drivers, or whether or not they want to use one or two <b style="color:#FFA34F">DLDI</b> spaces. It wasn't intended to suggest removing <b style="color:#FFA34F">DLDI</b> support entirely.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143945 - Diddl - Sat Oct 27, 2007 5:54 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">Has anyone considered loading the second driver at runtime from the filesystem? Put <b style="color:#FFA34F">DLDI</b> files in /data/<b style="color:#FFA34F">dldi</b> and it detects the type of the other card and loads the driver.</td> </tr></table><span class="postbody">
<br/>
<br/>
loading at runtime? it's a joke!? you cannot load anything without <b style="color:#FFA34F">dldi</b> already patched this is the clue...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143947 - chishm - Sat Oct 27, 2007 6:25 pm</h4>
    <div class="postbody"><span class="postbody">I've got a few ideas for a permanent solution to be incorporated into the next  libfat (or the one after that). In the mean time, here's a <a class="postlink" href="http://chishm.drunkencoders.com/NDS_Projects/dldi_chain.c" target="_blank">quick demo</a> I knocked together to show how to do exactly as HyperHacker suggested -- loading a second <b style="color:#FFA34F">DLDI</b> from the first device's file system. Keep in mind that the code isn't the best, and if the <b style="color:#FFA34F">DLDI</b> section is placed after the string constants then the original <b style="color:#FFA34F">DLDI</b> patcher will fail.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144063 - Dood77 - Sun Oct 28, 2007 10:28 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Diddl wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">Has anyone considered loading the second driver at runtime from the filesystem? Put <b style="color:#FFA34F">DLDI</b> files in /data/<b style="color:#FFA34F">dldi</b> and it detects the type of the other card and loads the driver.</td> </tr></table><span class="postbody">
<br/>
<br/>
loading at runtime? it's a joke!? you cannot load anything without <b style="color:#FFA34F">dldi</b> already patched this is the clue...</span></td> </tr></table><span class="postbody">
<br/>
Actually, since the <b style="color:#FFA34F">DLDI</b> would be loaded from the filesystem of the primary card, of which the binary would already be patched for, then there would be no problem patching the binary at run time with the secondary card's <b style="color:#FFA34F">DLDI</b>.<br/>_________________<br/>If I use a term wrong or something then feel free to correct, I?m not much of a programmer.
<br/>
<span style="font-size: 9px; line-height: normal">
<br/>
Original DS Phat obtained on day of release + flashme v7
<br/>
Supercard: miniSD, Kingston 1GB, Kingston 2GB
<br/>
Ralink chipset PCI NIC
<br/>
</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144073 - Lick - Sun Oct 28, 2007 11:18 pm</h4>
    <div class="postbody"><span class="postbody">I'm not really digging the idea of requiring a <b style="color:#FFA34F">DLDI</b> file on the media device. I'd vote for a slightly larger <b style="color:#FFA34F">DLDI</b> reserved space so the second driver could be injected, and the removal of the old static drivers. Then the FAT routines would be entirely dynamically inserted: clean!<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144077 - simonjhall - Sun Oct 28, 2007 11:34 pm</h4>
    <div class="postbody"><span class="postbody">In order to use two drivers couldn't you just have one driver slot in the binary and on each flash card you could hold the driver for the other flash card? ;-)
<br/>
Want to write to slot-2 but you're in slot-1 mode? Load in the other driver from disk, unload the slot-1 one, copy in the slot-2 one and you're now in slot-2 mode! Sha-zam :-)<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144098 - chishm - Mon Oct 29, 2007 2:40 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lick wrote:</b></span></td> </tr> <tr> <td class="quote">I'm not really digging the idea of requiring a <b style="color:#FFA34F">DLDI</b> file on the media device. I'd vote for a slightly larger <b style="color:#FFA34F">DLDI</b> reserved space so the second driver could be injected, and the removal of the old static drivers. Then the FAT routines would be entirely dynamically inserted: clean!</td> </tr></table><span class="postbody">
<br/>
Except for compatibility issues with:
<br/>
<ul><li>Existing drivers -- using two drivers for the one slot and the initialisation of one causes the failure of the other
<br/>
</li><li>Existing patchers -- some may not have been based on the latest dlditool code, and could overwrite the entire <b style="color:#FFA34F">DLDI</b> section
<br/>
</li><li>Existing devices -- for example, the R4 has a built in auto-patcher
<br/>
</li><li>Existing users -- "You mean I have to download and learn a new program?!‽‽interrobang?!?!"
<br/>
</li></ul>
<br/>
I'd like to have less patching of the binary, not more. The only reason that the original <b style="color:#FFA34F">DLDI</b> system patches the binary is that there is no way to load a driver from a disc that you don't have a driver for.
<br/>
<br/>
My current idea is to have one <b style="color:#FFA34F">DLDI</b> section within the binary and no built-in drivers. The binary is patched at load-time (or before if the loader isn't compatible) with the initial card's driver, then the rest can be dynamically loaded from that card. All apps that only need the use of one slot will stay the same -- simply patch once and run. Apps that use two cards at once (of which there are very few) can load more drivers from the card, supporting up to 9 additional devices at once (fat1-fat9, fat0 reserved for the load-time <b style="color:#FFA34F">DLDI</b>).<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144357 - Dood77 - Thu Nov 01, 2007 1:28 am</h4>
    <div class="postbody"><span class="postbody">Would it somehow be possible to make a single <b style="color:#FFA34F">DLDI</b> that works for multiple cards?<br/>_________________<br/>If I use a term wrong or something then feel free to correct, I?m not much of a programmer.
<br/>
<span style="font-size: 9px; line-height: normal">
<br/>
Original DS Phat obtained on day of release + flashme v7
<br/>
Supercard: miniSD, Kingston 1GB, Kingston 2GB
<br/>
Ralink chipset PCI NIC
<br/>
</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144375 - chishm - Thu Nov 01, 2007 6:13 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dood77 wrote:</b></span></td> </tr> <tr> <td class="quote">Would it somehow be possible to make a single <b style="color:#FFA34F">DLDI</b> that works for multiple cards?</td> </tr></table><span class="postbody">
<br/>
Yes, but not at the same time. You could combine all the CF drivers into one <b style="color:#FFA34F">DLDI</b>, for example, and have that detect which card it is being used on. However, the header is static, so you will get the same name and device ID no matter what card was detected.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144380 - OOPMan - Thu Nov 01, 2007 9:17 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lick wrote:</b></span></td> </tr> <tr> <td class="quote">I'm not really digging the idea of requiring a DLDI file on the media device. I'd vote for a slightly larger DLDI reserved space so the second driver could be injected, and the removal of the old static drivers. Then the FAT routines would be entirely dynamically inserted: clean!</td> </tr></table><span class="postbody">
<br/>
Except for compatibility issues with:
<br/>
<ul><li>Existing drivers -- using two drivers for the one slot and the initialisation of one causes the failure of the other
<br/>
</li><li>Existing patchers -- some may not have been based on the latest dlditool code, and could overwrite the entire DLDI section
<br/>
</li><li>Existing devices -- for example, the R4 has a built in auto-patcher
<br/>
</li><li>Existing users -- "You mean I have to download and learn a new program?!‽‽interrobang?!?!"
<br/>
</li></ul>
<br/>
I'd like to have less patching of the binary, not more. The only reason that the original DLDI system patches the binary is that there is no way to load a driver from a disc that you don't have a driver for.
<br/>
<br/>
My current idea is to have one DLDI section within the binary and no built-in drivers. The binary is patched at load-time (or before if the loader isn't compatible) with the initial card's driver, then the rest can be dynamically loaded from that card. All apps that only need the use of one slot will stay the same -- simply patch once and run. Apps that use two cards at once (of which there are very few) can load more drivers from the card, supporting up to 9 additional devices at once (fat1-fat9, fat0 reserved for the load-time DLDI).</span></td> </tr></table><span class="postbody">
<br/>
<br/>
I like this idea :-) It's elegant :-)<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144404 - cybermind - Thu Nov 01, 2007 5:43 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote">My current idea is to have one DLDI section within the binary and no built-in drivers. The binary is patched at load-time (or before if the loader isn't compatible) with the initial card's driver, then the rest can be dynamically loaded from that card. All apps that only need the use of one slot will stay the same -- simply patch once and run. Apps that use two cards at once (of which there are very few) can load more drivers from the card, supporting up to 9 additional devices at once (fat1-fat9, fat0 reserved for the load-time DLDI).</td> </tr></table><span class="postbody">I don't think you should have it this way. The current system of fat1 for slot1 and fat2 for slot2 (and fat0 for the default one) is acceptable. Otherwise, you would have to iterate through and check the features flag to determine which one was for slot1, and which was for slot2, which is the sort of thing that should be transparent to a user.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144431 - tepples - Thu Nov 01, 2007 10:13 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dood77 wrote:</b></span></td> </tr> <tr> <td class="quote">Would it somehow be possible to make a single DLDI that works for multiple cards?</td> </tr></table><span class="postbody">
<br/>
Yes, but not at the same time. You could combine all the CF drivers into one DLDI, for example, and have that detect which card it is being used on. However, the header is static, so you will get the same name and device ID no matter what card was detected.</span></td> </tr></table><span class="postbody">
<br/>
But multipurpose drivers would reduce the length of the menus in DLDI user tools. Simplicity is good for the owner of a device that doesn't know how to autopatch.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144462 - chishm - Fri Nov 02, 2007 3:59 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>cybermind wrote:</b></span></td> </tr> <tr> <td class="quote">The current system of fat1 for slot1 and fat2 for slot2 (and fat0 for the default one) is acceptable. Otherwise, you would have to iterate through and check the features flag to determine which one was for slot1, and which was for slot2, which is the sort of thing that should be transparent to a user.</td> </tr></table><span class="postbody">
<br/>
Why do you need to know which is SLOT-1 and which is SLOT-2? Shouldn't the user get to decide which slot corresponds to each label?<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144506 - HyperHacker - Sat Nov 03, 2007 2:48 am</h4>
    <div class="postbody"><span class="postbody">Well for example if your program requires swapping cards, or you simply want to display on the screen which slot corresponds to which drive, or you're using slot-2 RAM and need to know whether you'll still be able to access the filesystem with RAM mapped in.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146605 - cornaljoe - Thu Dec 06, 2007 7:24 pm</h4>
    <div class="postbody"><span class="postbody">I've released a homebrew that uses the modified libfat by cybermind.  And it works as like a charm.  Thanks for your work cybermind and chishm.
<br/>
<br/>
<a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=14630" target="_blank">DSBrowser - Dual Slot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#150482 - nipil - Tue Feb 05, 2008 3:59 pm</h4>
    <div class="postbody"><span class="postbody">A tiny useless post to say that i managed to get fat to work <span style="font-weight: bold">inside no$gba</span> using fcsr.dldi, "build.bat" (mkdosfs/bfi/bless). The loading of file works perfect, and writing fails, which is normal afaik (i guess it's due to writeSectors being empty). I guess it's not a terrible hassle to test the writing on-card, as it's not something you'll be debugging all day long ;)
<br/>
<br/>
<span style="font-weight: bold">Big thanks for this (for both real cart and emulator). I do mean it.</span>
<br/>
<br/>
<span style="font-style: italic">Is it still necessary to wait some vsync before trying to open files ?
<br/>
(ie. fatInit, swiWait x 5, fopen) or can i skip it ?</span>
<br/>
<br/>
PS: I'll test my very basic read/write .nds on a real cart tonight (MK5), should be no problem ; i'll post again if i meet any.<br/>_________________<br/>NDS Lite Gold/Silver, MK5/R4DS, MSI PC54G2, D-Link DI-624</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
