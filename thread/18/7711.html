<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Can I completely reboot my DS? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Can I completely reboot my DS?</h2>
<div id="posts">
<div class="post">
    <h4>#62914 - agentq - Tue Dec 06, 2005 10:06 pm</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
I've been trying to reboot the DS to the same state it was at power on.  I've had some success with swiSoftReset().  By syncing the ARM7 and ARM9 to call this bios function, it reboots, but it seems static initialised variables don't get reset, and this means that memory allocated with malloc() is also still allocated.
<br/>
<br/>
I'd like to find a way to do this which works on a flash cart and GBAMP/M3/SC
<br/>
<br/>
Edit: I've tried the following code to rerun the static initialisers after a reboot, but it doesn't work.  Doesn't crash though.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   static bool reset = false;
<br/>
<br/>
   if (reset) {
<br/>
      asm("ldr r3, =_init\n  bl _call_via_r3\n");
<br/>
   }
<br/>
<br/>
   reset = true;
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62943 - josath - Wed Dec 07, 2005 1:37 am</h4>
    <div class="postbody"><span class="postbody">To completely reset your DS to initial state (in order to load the wmb demos for example), check out the source to Darkain's loader, used in his MultiNDS frontend.
<br/>
<br/>
The sourcecode can be found in the ndslib CVS. There are a couple steps, it involves manually clearing the RAM/VRAM, and resetting many of the registers back to default settings.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62968 - chishm - Wed Dec 07, 2005 10:11 am</h4>
    <div class="postbody"><span class="postbody">Yeah, as you found out, swiSoftReset() (swi 0x00) actually only resets the CPU then jumps to the address located at 0x027FFE24 (ARM9) or 0x027FFE34 (ARM7). This means it doesn't reset memory or external registers.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62970 - Vich - Wed Dec 07, 2005 10:49 am</h4>
    <div class="postbody"><span class="postbody"><a href="http://www.cs.rit.edu/~tjh8300/CowBite/CowBiteSpec.htm" target="_blank">http://www.cs.rit.edu/~tjh8300/CowBite/CowBiteSpec.htm</a>
<br/>
<br/>
This is about the GBA, you might find interesting info about it and it might(not sure if it will) also apply on the ARM7 processor of the NDS. Check chapter 9 of that website document.
<br/>
<br/>
Google more on the GBA hardware reset(or hwreset?), you might find better info ('cause I did earlier this week, but can't find the link immediately).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62972 - wintermute - Wed Dec 07, 2005 11:09 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>agentq wrote:</b></span></td> </tr> <tr> <td class="quote">Hi,
<br/>
it seems static initialised variables don't get reset
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
correct.
<br/>
<br/>
The *only* way to reset initialised data is to reload the binary.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62973 - Vich - Wed Dec 07, 2005 11:36 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>agentq wrote:</b></span></td> </tr> <tr> <td class="quote">Hi,
<br/>
it seems static initialised variables don't get reset
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
correct.
<br/>
<br/>
The *only* way to reset initialised data is to reload the binary.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Are you sure? If you can hardreset the ARM7 on a GBA through BIOS calls(SWI instructions), why can't you do it on the same ARM7 on the NDS?
<br/>
<br/>
The webpage that I posted clearly stated the same 0x00 for soft reset ?nd 0x01 for RAM reset.
<br/>
<br/>
edit:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
0x26: HardReset (Undocumented)
<br/>
</td> </tr></table><span class="postbody">
<br/>
Also interesting :)</span><span class="gensmall"><br/><br/>Last edited by Vich on Wed Dec 07, 2005 11:43 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#62974 - agentq - Wed Dec 07, 2005 11:42 am</h4>
    <div class="postbody"><span class="postbody">Yeah, I've seen the CowBite spec, as I originally wrote a large chunk of it. ;-)
<br/>
<br/>
There seems to be some boot code in \nslib\examples\loader\boot\main.cpp.  Is this what josath was referring to?
<br/>
<br/>
If I have to reload the binary to reset my static data, does this mean I can't reboot my in memory copy?</span><span class="gensmall"><br/><br/>Last edited by agentq on Wed Dec 07, 2005 11:43 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#62975 - wintermute - Wed Dec 07, 2005 11:43 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Vich wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>agentq wrote:</b></span></td> </tr> <tr> <td class="quote">Hi,
<br/>
it seems static initialised variables don't get reset
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
correct.
<br/>
<br/>
The *only* way to reset initialised data is to reload the binary.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Are you sure? If you can hardreset the ARM7 on a GBA through BIOS calls(SWI instructions), why can't you do it on the same ARM7 on the NDS?
<br/>
<br/>
The webpage that I posted clearly stated the same 0x00 for soft reset ?nd 0x01 for RAM reset.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Because the GBA carries initialised data in ROM from where it's copied to RAM. The DS runs everything from RAM so data stays where it is and gets overwritten. GBA multiboot code works the same way.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63007 - agentq - Wed Dec 07, 2005 8:23 pm</h4>
    <div class="postbody"><span class="postbody">Thanks wintermute, I think that means I won't be able to write a generic 'reboot' call, unless anyone can think of another way?
<br/>
<br/>
It seems odd that there's not a SWI call to reboot the machine properly as on tha GBA.  I tried SWI 0x26 but it didn't do the job. :-(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63018 - Vich - Wed Dec 07, 2005 10:04 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>agentq wrote:</b></span></td> </tr> <tr> <td class="quote">Thanks wintermute, I think that means I won't be able to write a generic 'reboot' call, unless anyone can think of another way?
<br/>
<br/>
It seems odd that there's not a SWI call to reboot the machine properly as on tha GBA.  I tried SWI 0x26 but it didn't do the job. :-(</td> </tr></table><span class="postbody">
<br/>
Maybe swi 0x26 only works under certain conditions? Like halting the device first, clearing other memory first, etc? (in any order)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
