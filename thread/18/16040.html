<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Issue with transparency while Wifi & Dual Screen 3D ok : - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > Issue with transparency while Wifi & Dual Screen 3D ok :</h2>
<div id="posts">
<div class="post">
    <h4>#162761 - roubignolo - Fri Sep 12, 2008 3:24 pm</h4>
    <div class="postbody"><span class="postbody">Hi all !
<br/>
During the last 2 weeks, I tried to make a funny clone of the Crackdown green orbs chasing. For the moment, I'm running 3D on both screens and WiFi is OK (it only works if two DS are linked by their adhoc wifi connexion).
<br/>
<br/>
I'm pretty happy because on no$, it looks not that bad. But on real hardware it's a slaughter.
<br/>
<br/>
Anyway...
<br/>
<br/>
The problem is not related directly to these specs.
<br/>
<br/>
I've seeked the whole Internet to get some examples of how to have transparency color in a 256colors/8bits texture.
<br/>
<br/>
PNG versus PCx, GL_RGB vs GL_RGBA, GL_TEXTURE_COLOR0_TRANSPARENT or not, the use of texmex...
<br/>
<br/>
I've tried every combinaison. It just don't work.
<br/>
<br/>
So if someone could please post me a quick portion of code and the details of the texture files, it would be highly appreciated.
<br/>
<br/>
If anyone interested in my stuff, you can download it here : <a href="http://www.filedropper.com/code3dds" target="_blank">http://www.filedropper.com/code3dds</a>
<br/>
<br/>
You run with A, jump with B, rootate with L&amp;R.
<br/>
On launch screen, click ACCEPT to detect the other DS, then to ask it to play and then start to play. On each DS.
<br/>
<br/>
There is a bug on the ennemy's rotation and jump.<br/>_________________<br/>I code at work.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#162763 - Sausage Boy - Fri Sep 12, 2008 4:08 pm</h4>
    <div class="postbody"><span class="postbody">It's quite simple if you know how to do it. First step is to get a proper image conversion. Here's how you do it with texmex.
<br/>
<br/>
Get an image. Make the portions you want transparent transparent. Save it in a format that has transparency, png is a good choice. Use texmex with the line
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">texmex -4 your_image.png</td> </tr></table><span class="postbody">
<br/>
<br/>
-4 tells texmex to use the 256-color mode. Surprisingly, texmex is smart enough to realize that if you give it a transparent image, it should revert to 255 colors, and use the first palette entry for transparency.
<br/>
<br/>
Moving on, you now need to tell the DS that the first palette entry should be used for transparency. If you use glTexImage2D (I havn't looked at your code, sorry), you'll do something like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">glTexImage2D(0, 0, GL_RGB256, TEXTURE_SIZE_128, TEXTURE_SIZE_128, 0, TEXGEN_TEXCOORD | GL_TEXTURE_COLOR0_TRANSPARENT, (u8*)trans_tex_bin);</td> </tr></table><span class="postbody">
<br/>
<br/>
The only important thing is that GL_TEXTURE_COLOR0_TRANSPARENT needs to be in the texture format properties. Heh, I'm not very good at explaining stuff. I'll write a small demo if you're still having trouble. :)<br/>_________________<br/>"no offense, but this is the gayest game ever"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#162765 - roubignolo - Fri Sep 12, 2008 4:41 pm</h4>
    <div class="postbody"><span class="postbody">I saw many of your posts and tried your texmex.
<br/>
<br/>
I'll try again and let you know.
<br/>
<br/>
Cheers,
<br/>
ICODEATWORK.<br/>_________________<br/>I code at work.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#162878 - roubignolo - Mon Sep 15, 2008 1:24 pm</h4>
    <div class="postbody"><span class="postbody">Hey Sausage Boy !
<br/>
<br/>
It finally works but with a PNG without transparent ico and the -7 option and using this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   glTexImage2D(0, 0, GL_RGBA, TEXTURE_SIZE_128 , TEXTURE_SIZE_128, 0,  TEXGEN_TEXCOORD  ,  (u8*)arbre1_128x128);</td> </tr></table><span class="postbody">
<br/>
<br/>
as you already mentionned somewhere in that forum.
<br/>
<br/>
But now, I can't see anymore my flat non textured quats  :(
<br/>
<br/>
Any idea ?
<br/>
<br/>
Cheers,
<br/>
ICODEATWORK<br/>_________________<br/>I code at work.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#162879 - Sausage Boy - Mon Sep 15, 2008 1:42 pm</h4>
    <div class="postbody"><span class="postbody">Nice that you got it working. As you surely know, GL_RGBA is the direct-color mode, meaning it doesn't use a palette and will take more space in vram. This is not a problem if you don't have a lot of textures.
<br/>
<br/>
I don't know about your other problem. Try to find out exactly what code change makes the quads disappear. If you have some code, I could take a look at it.<br/>_________________<br/>"no offense, but this is the gayest game ever"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#162880 - roubignolo - Mon Sep 15, 2008 1:55 pm</h4>
    <div class="postbody"><span class="postbody">I will double check.
<br/>
<br/>
For the moment I don't use so many textures. But I could in the future.
<br/>
<br/>
How do use the paletted texture converted with texmex.
<br/>
<br/>
I mean, the .dta is ok but the .pal ?
<br/>
<br/>
Sorry for being dumb, I was born like this ;)
<br/>
<br/>
Cheers and many many thanks<br/>_________________<br/>I code at work.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#162881 - roubignolo - Mon Sep 15, 2008 3:06 pm</h4>
    <div class="postbody"><span class="postbody">this one ?
<br/>
<br/>
void  glColorTable (uint8 format, uint32 addr) 
<br/>
  glColorTable establishes the location of the current palette. Roughly follows glColorTableEXT. Association of palettes with named textures is left to the application.<br/>_________________<br/>I code at work.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#162882 - Sausage Boy - Mon Sep 15, 2008 3:15 pm</h4>
    <div class="postbody"><span class="postbody">You're on the right track! I made a little example, it's a modification of the Textured Quad example from devkitPro. Everything I changed to make it use a paletted format is marked with big comments.
<br/>
<br/>
<a href="http://blog.dev-scene.com/gaspcubed/files/2008/09/textured_quad_palette.zip" target="_blank">http://blog.dev-scene.com/gaspcubed/files/2008/09/textured_quad_palette.zip</a><br/>_________________<br/>"no offense, but this is the gayest game ever"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#162918 - roubignolo - Tue Sep 16, 2008 11:33 am</h4>
    <div class="postbody"><span class="postbody">The project compiles. But The texture is fully transparent.
<br/>
<br/>
I use my 128x128x256 texture with texmex and its -4 option.
<br/>
The two files, dta &amp; pal, are generated and I use them the way you do in your exemple.
<br/>
<br/>
Your example compiles in my environment.
<br/>
<br/>
:(:(:(:(:(
<br/>
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
////////////////////////
<br/>
//// GLOBALS
<br/>
////////////////////////
<br/>
<br/>
<br/>
int texture[2]; 
<br/>
uint32 paletteAddr1; //Only the 3rd one is paletted
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
////////////////////////
<br/>
//// Function called for each frame during rendering. Put any 3D models
<br/>
//// of my own where I want it to be
<br/>
////////////////////////
<br/>
void Placer_un_object(int type, float xx, float yy, float zz, float rotxx, float rotyy, float rotzz){
<br/>
<br/>
<br/>
switch(type){
<br/>
<br/>
      case 1:
<br/>
   glBindTexture(GL_TEXTURE_2D, texture[2]);
<br/>
<br/>
----&gt;&gt;   glColorTable(GL_RGB256, paletteAddr1);
<br/>
<br/>
   glBegin(GL_QUADS);
<br/>
<br/>
   glTexCoord2f(1.0f, 1.0f);
<br/>
                glVertex3f(xx-1.0f, yy-8.0f,   zz+0.0f);         glTexCoord2f(1.0f, 0.0f);
<br/>
                glVertex3f(xx-1.0f , yy-6.0f,   zz+0.0f);
<br/>
   glTexCoord2f(0.0f, 0.0f);
<br/>
                glVertex3f(xx+1.0f , yy-6.0f, zz+0.0f );
<br/>
                glTexCoord2f(0.0f, 1.0f);
<br/>
                glVertex3f(xx+ 1.0f ,yy -8.0f, zz+0.0f );          glTexCoord2f(1.0f, 1.0f);
<br/>
                glVertex3f(xx+    0.0f, yy-8.0f,zz-1.0f);
<br/>
   glTexCoord2f(1.0f, 0.0f);
<br/>
                glVertex3f(xx+0.0f , yy-6.0f,   zz-1.0f);         glTexCoord2f(0.0f, 0.0f);
<br/>
                glVertex3f(xx+0.0f , yy-6.0f, zz+1.0f );      
<br/>
   glTexCoord2f(0.0f, 1.0f);
<br/>
                glVertex3f(xx+    0.0f , yy-8.0f, zz+1.0f );
<br/>
   glEnd();
<br/>
   break;
<br/>
case 2:
<br/>
   break;
<br/>
   
<br/>
case 3:
<br/>
   break;
<br/>
   
<br/>
default: ;
<br/>
} 
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
/////////////////////////////////////////   
<br/>
//    TEXTURES part (into the main)
<br/>
/////////////////////////////////////////
<br/>
   
<br/>
   sImage pcx;
<br/>
<br/>
<br/>
   loadPCX((u8*)arbre128x128, &amp;pcx);
<br/>
   image8to16(&amp;pcx);
<br/>
   glGenTextures(1, &amp;texture[0]);
<br/>
   glBindTexture(0, texture[0]);
<br/>
   glTexImage2D(0, 0, GL_RGB, TEXTURE_SIZE_128 , TEXTURE_SIZE_128, 0, TEXGEN_TEXCOORD, pcx.image.data8);
<br/>
   imageDestroy(&amp;pcx);
<br/>
<br/>
   loadPCX((u8*)herbe128x128, &amp;pcx);
<br/>
   image8to16(&amp;pcx);
<br/>
   glGenTextures(2, &amp;texture[1]);
<br/>
   glBindTexture(0, texture[1]);
<br/>
   glTexImage2D(0, 0, GL_RGB, TEXTURE_SIZE_128 , TEXTURE_SIZE_128, 0, TEXGEN_TEXCOORD, pcx.image.data8);
<br/>
   imageDestroy(&amp;pcx);
<br/>
   
<br/>
<br/>
<br/>
   glGenTextures(3, &amp;texture[2]);
<br/>
   glBindTexture(0, texture[2]);
<br/>
----&gt;&gt;   glTexImage2D(0, 0, GL_RGB256, TEXTURE_SIZE_128 , TEXTURE_SIZE_128, 0,  TEXGEN_TEXCOORD  | GL_TEXTURE_COLOR0_TRANSPARENT ,  (u8*)arbre1_128x128_dta);
<br/>
----&gt;&gt;   paletteAddr1 =gluTexLoadPal( (u16*)arbre1_128x128_pal, 256, GL_RGB256 );
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Any idea ?
<br/>
<br/>
Sorry for the inconvenience :(<br/>_________________<br/>I code at work.</span><span class="gensmall"><br/><br/>Last edited by roubignolo on Tue Sep 16, 2008 2:09 pm; edited 3 times in total</span></div>    
</div>
<div class="post">
    <h4>#162924 - roubignolo - Tue Sep 16, 2008 2:06 pm</h4>
    <div class="postbody"><span class="postbody">Oh ! By the way, I also noticed this strange artefact usinf texmex -7 option :
<br/>
<br/>
<a href="http://lh5.ggpht.com/roubignolo/SM-3_LjNNZI/AAAAAAAAACg/uhrrhv_5-YY/artefact.gif.jpg">[Images not permitted - Click here to view it]</a>
<br/>
<br/>
Like if the transparency "mask" was shifted.<br/>_________________<br/>I code at work.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#162948 - Sausage Boy - Tue Sep 16, 2008 10:07 pm</h4>
    <div class="postbody"><span class="postbody">The only weird thing I can see with your code is that you're supposed to call the glGenTextures() command once. See this snippet from the Paletted Cube example:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   glGenTextures(10, textureIDS);
<br/>
   
<br/>
   // inital full 16 bit colour texture
<br/>
   glBindTexture(0, textureIDS[0]);
<br/>
   glTexImage2D(0, 0, GL_RGB, TEXTURE_SIZE_128 , TEXTURE_SIZE_128, 0, TEXGEN_TEXCOORD, (u8*)texture_bin);
<br/>
   textures[0].format = GL_RGB;
<br/>
   textures[0].pal_addr = 0;   
<br/>
   textures[0].size = texture_bin_size;    // size field just recorded for on-screen info
<br/>
   
<br/>
<br/>
   // Load some 16 colour textures
<br/>
   glBindTexture(0, textureIDS[1]);
<br/>
   glTexImage2D(0, 0, GL_RGB16, TEXTURE_SIZE_128 , TEXTURE_SIZE_128, 0, TEXGEN_TEXCOORD, (u8*)texture1_RGB16_tex_bin);
<br/>
   textures[1].format = GL_RGB16;
<br/>
   textures[1].pal_addr = gluTexLoadPal( (u16*)texture1_RGB16_pal_bin, 16, GL_RGB16 );
<br/>
   textures[1].size = texture1_RGB16_tex_bin_size+texture1_RGB16_pal_bin_size;
<br/>
<br/>
<br/>
   ...load more textures
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
But I don't think that is your problem. Try with the image files from my demo, so we can be sure that the code is the problem, and not the conversion.
<br/>
<br/>
And yes, that's really a strange bug you've discovered. Could you please post the image that does this, so I can try to fix it?<br/>_________________<br/>"no offense, but this is the gayest game ever"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#162969 - roubignolo - Wed Sep 17, 2008 3:49 pm</h4>
    <div class="postbody"><span class="postbody">This is the criminal
<br/>
<br/>
<a href="http://lh3.ggpht.com/roubignolo/SNEYve_AcDI/AAAAAAAAADE/e7lyZxFVDZc/arbre1_128x128.png.jpg">[Images not permitted - Click here to view it]</a><br/>_________________<br/>I code at work.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#162972 - Sausage Boy - Wed Sep 17, 2008 4:21 pm</h4>
    <div class="postbody"><span class="postbody">Sorry, I'll need the actual .png with the alpha channel and everything intact.<br/>_________________<br/>"no offense, but this is the gayest game ever"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163035 - roubignolo - Fri Sep 19, 2008 5:22 pm</h4>
    <div class="postbody"><span class="postbody">Done ! I sent it to you<br/>_________________<br/>I code at work.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
