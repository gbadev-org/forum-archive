<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Help! More TGA - UNSOLVED - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Help! More TGA - UNSOLVED</h2>
<div id="posts">
<div class="post">
    <h4>#135877 - yellowstar - Thu Jul 26, 2007 10:50 pm</h4>
    <div class="postbody"><span class="postbody">I need some help with loading TGA graphics,
<br/>
with transparency(alpha).
<br/>
<br/>
The way I am doing it won't work.
<br/>
<br/>
<span style="font-weight: bold">EDIT:</span>
<br/>
This problem is solved.
<br/>
But I have more questions.
<br/>
See <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?p=136708&amp;sid=7af6a424590f6ed2b1049bf01b1c5cc5#136708" target="_blank">this</a> post in this topic for details.
<br/>
<br/>
But I am having more problems, this time
<br/>
with saving TGAs of captures of the screen(s).
<br/>
See the above link for details.
<br/>
<br/>
<br/>
<span style="font-weight: bold">&lt;EDIT&gt;</span>
<br/>
<br/>
When I first posted this,
<br/>
I forgot to post what my
<br/>
problem was.
<br/>
<br/>
Here is my problem:
<br/>
<br/>
The converted TGA image,
<br/>
looks nothing like
<br/>
the TGA graphic.
<br/>
<br/>
Also,
<br/>
It is transparent in
<br/>
the wrong places.
<br/>
<br/>
NOTE:
<br/>
This above is not the problem
<br/>
I am having right now,
<br/>
but it is similar.
<br/>
<br/>
See my below posts for details.
<br/>
<br/>
<span style="font-weight: bold">&lt;/EDIT&gt;</span>
<br/>
<br/>
<br/>
<br/>
<span style="font-weight: bold">&lt;EDIT2&gt;</span>
<br/>
<br/>
I now have a image host.
<br/>
This means I have posted links to these images.
<br/>
Go to <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?p=136099#136099" target="_blank">this</a> post for details.
<br/>
<br/>
<span style="font-weight: bold">&lt;/EDIT2&gt;</span>
<br/>
<br/>
Here's how I am doing it:
<br/>
<br/>
The last piece of code is the whole thing,
<br/>
and the ones before that are
<br/>
important pieces of code.
<br/>
<br/>
<br/>
Here is the function that loads the TGA graphic:
<br/>
(The function that generates the texture from
<br/>
the converted data is at the end of this piece of code.)
<br/>
(The structs are at the top of the main piece of code,
<br/>
and the code that does the drawing is at the bottom.)
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
bool loadTGA(u8 *DATA, TGAimage *tgaimage, int *texID)
<br/>
{
<br/>
   int i;
<br/>
   unsigned int temp;
<br/>
   BYTE *stream = NULL;
<br/>
<br/>
   if(DATA==NULL){Error("Attempted to loaded null data!",-1);}
<br/>
<br/>
   stream = DATA;
<br/>
<br/>
    tgaimage-&gt;texID = texID;
<br/>
<br/>
<br/>
<br/>
    tgaimage-&gt;header.ID_Length = *stream;stream++;
<br/>
    tgaimage-&gt;header.colorMapType = *stream;stream++;
<br/>
    tgaimage-&gt;header.imageType = *stream;stream++;
<br/>
    
<br/>
    for(int a = 0; a &lt; 5; a++)
<br/>
    {
<br/>
    tgaimage-&gt;header.ColorMapSpecification[a] = *stream;stream++;
<br/>
    }
<br/>
    
<br/>
    SCpy(stream,&amp;tgaimage-&gt;header.xOrigin);stream+=2;
<br/>
    SCpy(stream,&amp;tgaimage-&gt;header.yOrigin);stream+=2;
<br/>
    SCpy(stream,&amp;tgaimage-&gt;header.imageWidth);stream+=2;
<br/>
    SCpy(stream,&amp;tgaimage-&gt;header.imageHeight);stream+=2;
<br/>
    
<br/>
    tgaimage-&gt;header.pixelDepth = *stream;stream++;
<br/>
<br/>
   if(tgaimage-&gt;header.imageType !=2){
<br/>
      char str[256];
<br/>
      strcpy(str,"");
<br/>
      sprintf(str,"%s\nSupported Type: Uncompressed, RGB, with orgin at top-left.(2)\nType: %d","Unsuported TGA type.",(int)tgaimage-&gt;header.imageType);
<br/>
      Error(str,-2);
<br/>
      
<br/>
   }
<br/>
<br/>
   tgaimage-&gt;width = tgaimage-&gt;header.imageWidth;
<br/>
   tgaimage-&gt;height = tgaimage-&gt;header.imageHeight;
<br/>
   tgaimage-&gt;bpp = tgaimage-&gt;header.pixelDepth;
<br/>
<br/>
   if (tgaimage-&gt;width &lt;= 0 || tgaimage-&gt;height &lt;= 0 || (tgaimage-&gt;bpp!=24 &amp;&amp; tgaimage-&gt;bpp!=32)){
<br/>
      printf("Width: %d\nHeight: %d\n BPP: %d\n",(int)tgaimage-&gt;width,(int)tgaimage-&gt;height,(int)tgaimage-&gt;bpp);
<br/>
      Error("Wrong file type.",-3);
<br/>
        }
<br/>
<br/>
   unsigned int bytesPerPixel = tgaimage-&gt;bpp / 8;
<br/>
   unsigned int imageSize = ((tgaimage-&gt;width * tgaimage-&gt;height) * bytesPerPixel);
<br/>
   
<br/>
   tgaimage-&gt;type = GL_RGBA;
<br/>
<br/>
   if(tgaimage-&gt;bpp==24)
<br/>
   {
<br/>
      tgaimage-&gt;type = GL_RGB;printf("RGB\n");
<br/>
    }
<br/>
    else
<br/>
    {
<br/>
        printf("RGBA\n");
<br/>
    }
<br/>
<br/>
    if(tgaimage-&gt;header.colorMapType!=0)
<br/>
    {
<br/>
    Error("Color Map Data detected! Stopping...",-4);
<br/>
    }
<br/>
    
<br/>
    tgaimage-&gt;imageData = (BYTE*)malloc((size_t)((int)imageSize));
<br/>
    
<br/>
    if(tgaimage-&gt;imageData==NULL)
<br/>
    {
<br/>
    
<br/>
    Error("Failed to alloc memory for TGA data!",-5);
<br/>
    }
<br/>
<br/>
    for(int I = 0; I &lt; (int)imageSize; I++)
<br/>
    {
<br/>
    tgaimage-&gt;imageData[I] = *stream;
<br/>
    stream++;
<br/>
    }
<br/>
<br/>
   printf("Image data\n\n");
<br/>
   
<br/>
   //Convert BGR to RGB
<br/>
   /*for (i =0; i &lt;(int)imageSize; i+=(int)bytesPerPixel)
<br/>
   {
<br/>
      
<br/>
      temp = tgaimage-&gt;imageData[i];
<br/>
      tgaimage-&gt;imageData[i] = tgaimage-&gt;imageData[i+2];
<br/>
      tgaimage-&gt;imageData[i+2] = temp;
<br/>
   }*/
<br/>
<br/>
   tgaimage-&gt;image = (u16*)malloc(sizeof(u16)*(tgaimage-&gt;width*tgaimage-&gt;height));
<br/>
int I = 0;
<br/>
   for(int i=0; i &lt; (int)(tgaimage-&gt;width*tgaimage-&gt;height); i++)
<br/>
   {
<br/>
<br/>
         tgaimage-&gt;image[i] = RGB8((tgaimage-&gt;imageData[I + 0]),
<br/>
            (tgaimage-&gt;imageData[I + 1]),
<br/>
            (tgaimage-&gt;imageData[I + 2])) | BIT(15);
<br/>
   
<br/>
   I+=bytesPerPixel;
<br/>
<br/>
   }
<br/>
<br/>
   createTexture(tgaimage);
<br/>
<br/>
   printf("Success...\n\n");
<br/>
<br/>
   return 1;
<br/>
}
<br/>
<br/>
<br/>
bool createTexture(TGAimage *tgaimage)
<br/>
{
<br/>
   glGenTextures(1,tgaimage-&gt;texID);
<br/>
   glBindTexture(GL_TEXTURE_2D, *tgaimage-&gt;texID);
<br/>
<br/>
   //glTexParameterf(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR);
<br/>
   //glTexParameterf(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR);
<br/>
    //GL_UNSIGNED_BYTE
<br/>
    
<br/>
   glTexImage2D(*tgaimage-&gt;texID, 0, GL_RGB, TEXTURE_SIZE_32, TEXTURE_SIZE_32,0, TEXGEN_TEXCOORD, (uint8*)tgaimage-&gt;image);
<br/>
<br/>
   return true;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
The following is the whole thing:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
// include your ndslib
<br/>
#include &lt;nds.h&gt;
<br/>
#include &lt;malloc.h&gt;
<br/>
//needed to load pcx files
<br/>
#include &lt;nds/arm9/image.h&gt;
<br/>
<br/>
#include "Pencil_0_tga.h"
<br/>
#include "APencil_0_tga.h"
<br/>
/*#include "Pencil_1_tga.h"
<br/>
#include "Pencil_2_tga.h"
<br/>
#include "Pencil_3_tga.h"
<br/>
#include "Pencil_4_tga.h"
<br/>
#include "Pencil_5_tga.h"
<br/>
*/
<br/>
<br/>
<br/>
#include &lt;stdio.h&gt;
<br/>
#include &lt;string.h&gt;
<br/>
#include &lt;stdlib.h&gt;
<br/>
<br/>
#define Error(message, code) printf("ERROR: %s\n",message);return code;
<br/>
<br/>
typedef unsigned char BYTE;
<br/>
<br/>
<br/>
<br/>
struct TGA_header
<br/>
{
<br/>
   BYTE ID_Length;
<br/>
   BYTE colorMapType;
<br/>
   BYTE imageType;
<br/>
   BYTE ColorMapSpecification[5];
<br/>
   short xOrigin;
<br/>
   short yOrigin;
<br/>
   short imageWidth;
<br/>
   short imageHeight;
<br/>
   BYTE pixelDepth;
<br/>
   BYTE ImageDesc;
<br/>
};
<br/>
<br/>
struct TGAimage
<br/>
{
<br/>
TGA_header header;
<br/>
BYTE *imageData;
<br/>
unsigned int bpp;
<br/>
unsigned int width;
<br/>
unsigned int height;
<br/>
int *texID;
<br/>
unsigned int type;
<br/>
u16 *image;
<br/>
};
<br/>
<br/>
bool createTexture(TGAimage *tgaimage);
<br/>
bool loadTGA(char *texFileName);
<br/>
<br/>
int DrawGLScene();
<br/>
<br/>
float   xrot;            // X Rotation
<br/>
float   yrot;            // Y Rotation
<br/>
float   zrot;            // Z Rotation
<br/>
<br/>
int   texture[1];         // Storage For One Texture
<br/>
TGAimage image;
<br/>
int result=0;
<br/>
<br/>
void SCpy(BYTE *source, short *target)
<br/>
{
<br/>
     for(int i = 0; i &lt; (int)sizeof(short); i++)
<br/>
     target[i] = source[i];
<br/>
}
<br/>
<br/>
void WaitForKey(KEYPAD_BITS key)
<br/>
{
<br/>
     if(key != KEY_TOUCH &amp;&amp; key != KEY_LID)
<br/>
     printf("Press ");
<br/>
     
<br/>
     
<br/>
     
<br/>
     if(key == KEY_LID)
<br/>
     printf("Close the ");
<br/>
     
<br/>
     
<br/>
     
<br/>
     switch(key)
<br/>
     {
<br/>
                case KEY_A:printf("A");break;
<br/>
                case KEY_B:printf("B");break;
<br/>
                case KEY_SELECT:printf("SELECT");break;
<br/>
                case KEY_START:printf("START");break;
<br/>
                case KEY_RIGHT:printf("RIGHT");break;
<br/>
                case KEY_LEFT:printf("LEFT");break;
<br/>
                case KEY_UP:printf("UP");break;
<br/>
                case KEY_DOWN:printf("DOWN");break;
<br/>
                case KEY_R:printf("R");break;
<br/>
                case KEY_L:printf("L");break;
<br/>
                case KEY_X:printf("X");break;
<br/>
                case KEY_Y:printf("Y");break;
<br/>
                case KEY_TOUCH:printf("TOUCH");break;
<br/>
                case KEY_LID:printf("LID");break;
<br/>
     }
<br/>
     printf(" To Continue...\n\n");
<br/>
     swiWaitForVBlank();swiWaitForVBlank();swiWaitForVBlank();
<br/>
     while(1)
<br/>
     {
<br/>
         scanKeys();
<br/>
             if(keysDown() &amp; key)break;
<br/>
             
<br/>
             swiWaitForVBlank();
<br/>
     }
<br/>
     
<br/>
     consoleClear();
<br/>
}
<br/>
<br/>
void WaitForAnyKey()
<br/>
{
<br/>
     bool found = false;
<br/>
     printf("\nPress Any Key to continue...\n\n");
<br/>
    swiWaitForVBlank();swiWaitForVBlank();swiWaitForVBlank();
<br/>
     while(1)
<br/>
     {
<br/>
    scanKeys();
<br/>
             for(int i = 0; i &lt;= 12; i++)
<br/>
             {
<br/>
                     if(keysDown() &amp; BIT(i)){found = true;break;}
<br/>
                     
<br/>
                     
<br/>
             }
<br/>
             
<br/>
             if(found)break;
<br/>
             
<br/>
             swiWaitForVBlank();
<br/>
     }
<br/>
     
<br/>
     consoleClear();
<br/>
}
<br/>
<br/>
void DisplayPix(TGAimage *tgaimage, int X, int Y, bool pause)
<br/>
{
<br/>
<br/>
int the_index = ( ( (int)tgaimage-&gt;width * (Y - 1) ) + (X - 1)) * (int)tgaimage-&gt;bpp;
<br/>
<br/>
   printf("Pix %d,%d =\nR = %d\nG = %d\nB = %d\n\n",(int)X,(int)Y,
<br/>
   (int)tgaimage-&gt;imageData[the_index + 0],(int)tgaimage-&gt;imageData[the_index + 1],
<br/>
   (int)tgaimage-&gt;imageData[the_index + 2]);
<br/>
<br/>
WaitForAnyKey();
<br/>
<br/>
}
<br/>
<br/>
bool loadTGA(u8 *DATA, TGAimage *tgaimage, int *texID)
<br/>
{
<br/>
   int i;
<br/>
   unsigned int temp;
<br/>
   BYTE *stream = NULL;
<br/>
<br/>
   if(DATA==NULL){Error("Attempted to loaded null data!",-1);}
<br/>
<br/>
   stream = DATA;
<br/>
<br/>
    tgaimage-&gt;texID = texID;
<br/>
<br/>
<br/>
<br/>
    tgaimage-&gt;header.ID_Length = *stream;stream++;
<br/>
    tgaimage-&gt;header.colorMapType = *stream;stream++;
<br/>
    tgaimage-&gt;header.imageType = *stream;stream++;
<br/>
    
<br/>
    for(int a = 0; a &lt; 5; a++)
<br/>
    {
<br/>
    tgaimage-&gt;header.ColorMapSpecification[a] = *stream;stream++;
<br/>
    }
<br/>
    
<br/>
    SCpy(stream,&amp;tgaimage-&gt;header.xOrigin);stream+=2;
<br/>
    SCpy(stream,&amp;tgaimage-&gt;header.yOrigin);stream+=2;
<br/>
    SCpy(stream,&amp;tgaimage-&gt;header.imageWidth);stream+=2;
<br/>
    SCpy(stream,&amp;tgaimage-&gt;header.imageHeight);stream+=2;
<br/>
    
<br/>
    tgaimage-&gt;header.pixelDepth = *stream;stream++;
<br/>
<br/>
   if(tgaimage-&gt;header.imageType !=2){
<br/>
      char str[256];
<br/>
      strcpy(str,"");
<br/>
      sprintf(str,"%s\nSupported Type: Uncompressed, RGB, with orgin at top-left.(2)\nType: %d","Unsuported TGA type.",(int)tgaimage-&gt;header.imageType);
<br/>
      Error(str,-2);
<br/>
      
<br/>
   }
<br/>
<br/>
   tgaimage-&gt;width = tgaimage-&gt;header.imageWidth;
<br/>
   tgaimage-&gt;height = tgaimage-&gt;header.imageHeight;
<br/>
   tgaimage-&gt;bpp = tgaimage-&gt;header.pixelDepth;
<br/>
<br/>
   if (tgaimage-&gt;width &lt;= 0 || tgaimage-&gt;height &lt;= 0 || (tgaimage-&gt;bpp!=24 &amp;&amp; tgaimage-&gt;bpp!=32)){
<br/>
      printf("Width: %d\nHeight: %d\n BPP: %d\n",(int)tgaimage-&gt;width,(int)tgaimage-&gt;height,(int)tgaimage-&gt;bpp);
<br/>
      Error("Wrong file type.",-3);
<br/>
        }
<br/>
<br/>
   unsigned int bytesPerPixel = tgaimage-&gt;bpp / 8;
<br/>
   unsigned int imageSize = ((tgaimage-&gt;width * tgaimage-&gt;height) * bytesPerPixel);
<br/>
   
<br/>
   tgaimage-&gt;type = GL_RGBA;
<br/>
<br/>
   if(tgaimage-&gt;bpp==24)
<br/>
   {
<br/>
      tgaimage-&gt;type = GL_RGB;printf("RGB\n");
<br/>
    }
<br/>
    else
<br/>
    {
<br/>
        printf("RGBA\n");
<br/>
    }
<br/>
<br/>
    if(tgaimage-&gt;header.colorMapType!=0)
<br/>
    {
<br/>
    Error("Color Map Data detected! Stopping...",-4);
<br/>
    }
<br/>
    
<br/>
    tgaimage-&gt;imageData = (BYTE*)malloc((size_t)((int)imageSize));
<br/>
    
<br/>
    if(tgaimage-&gt;imageData==NULL)
<br/>
    {
<br/>
    
<br/>
    Error("Failed to alloc memory for TGA data!",-5);
<br/>
    }
<br/>
<br/>
    for(int I = 0; I &lt; (int)imageSize; I++)
<br/>
    {
<br/>
    tgaimage-&gt;imageData[I] = *stream;
<br/>
    stream++;
<br/>
    }
<br/>
<br/>
   printf("Image data\n\n");
<br/>
   
<br/>
   //Convert BGR to RGB
<br/>
   /*for (i =0; i &lt;(int)imageSize; i+=(int)bytesPerPixel)
<br/>
   {
<br/>
      
<br/>
      temp = tgaimage-&gt;imageData[i];
<br/>
      tgaimage-&gt;imageData[i] = tgaimage-&gt;imageData[i+2];
<br/>
      tgaimage-&gt;imageData[i+2] = temp;
<br/>
   }*/
<br/>
<br/>
   tgaimage-&gt;image = (u16*)malloc(sizeof(u16)*(tgaimage-&gt;width*tgaimage-&gt;height));
<br/>
int I = 0;
<br/>
   for(int i=0; i &lt; (int)(tgaimage-&gt;width*tgaimage-&gt;height); i++)
<br/>
   {
<br/>
<br/>
         tgaimage-&gt;image[i] = RGB8((tgaimage-&gt;imageData[I + 0]),
<br/>
            (tgaimage-&gt;imageData[I + 1]),
<br/>
            (tgaimage-&gt;imageData[I + 2])) | BIT(15);
<br/>
   
<br/>
   I+=bytesPerPixel;
<br/>
<br/>
   }
<br/>
<br/>
   createTexture(tgaimage);
<br/>
<br/>
   printf("Success...\n\n");
<br/>
<br/>
   return 1;
<br/>
}
<br/>
<br/>
<br/>
bool createTexture(TGAimage *tgaimage)
<br/>
{
<br/>
   glGenTextures(1,tgaimage-&gt;texID);
<br/>
   glBindTexture(GL_TEXTURE_2D, *tgaimage-&gt;texID);
<br/>
<br/>
   //glTexParameterf(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR);
<br/>
   //glTexParameterf(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR);
<br/>
    //GL_UNSIGNED_BYTE
<br/>
    
<br/>
   glTexImage2D(*tgaimage-&gt;texID, 0, GL_RGB, TEXTURE_SIZE_32, TEXTURE_SIZE_32,0, TEXGEN_TEXCOORD, (uint8*)tgaimage-&gt;image);
<br/>
<br/>
   return true;
<br/>
}
<br/>
<br/>
<br/>
int LoadGLTextures()
<br/>
{
<br/>
   
<br/>
   
<br/>
   int R=loadTGA((u8*)APencil_0_tga,&amp;image,&amp;texture[0]);
<br/>
   
<br/>
   
<br/>
   
<br/>
   
<br/>
<br/>
   return R;
<br/>
}
<br/>
<br/>
<br/>
int main()
<br/>
{   
<br/>
   // Turn on everything
<br/>
   powerON(POWER_ALL);
<br/>
   
<br/>
   /*videoSetMode(MODE_FB0);
<br/>
    
<br/>
    vramSetBankA(VRAM_A_LCD);*/
<br/>
   
<br/>
   /*consoleDemoInit();
<br/>
    
<br/>
    videoSetModeSub(MODE_FB0);
<br/>
    
<br/>
    vramSetBankB(VRAM_B_LCD);
<br/>
   */
<br/>
   
<br/>
   videoSetModeSub(MODE_0_2D | DISPLAY_BG0_ACTIVE);   //sub bg 0 will be used to print text
<br/>
   vramSetBankC(VRAM_C_SUB_BG);
<br/>
<br/>
   //SUB_BG0_CR = BG_MAP_BASE(31);
<br/>
   
<br/>
   //consoleInitDefault((u16*)SCREEN_BASE_BLOCK_SUB(31), (u16*)CHAR_BASE_BLOCK_SUB(0), 16);
<br/>
   consoleDemoInit();
<br/>
   
<br/>
   
<br/>
   // Setup the Main screen for 3D 
<br/>
   videoSetMode(MODE_0_3D);
<br/>
   vramSetBankA(VRAM_A_TEXTURE);                        //NEW  must set up some memory for textures
<br/>
<br/>
   // IRQ basic setup
<br/>
   irqInit();
<br/>
   irqSet(IRQ_VBLANK, 0);
<br/>
<br/>
   // Set our viewport to be the same size as the screen
<br/>
   glViewPort(0,0,255,191);
<br/>
   
<br/>
   // Specify the Clear Color and Depth 
<br/>
   glClearColor(0,0,0);
<br/>
   glClearDepth(0x7FFF);
<br/>
    result=LoadGLTextures();
<br/>
   
<br/>
   while(1)
<br/>
   {
<br/>
          
<br/>
      // Reset the screen and setup the view
<br/>
      glReset();
<br/>
      glMatrixMode(GL_PROJECTION);
<br/>
      glLoadIdentity();
<br/>
      gluPerspective(35, 256.0 / 192.0, 0.1, 100);
<br/>
      glColor3f(1,1,1);
<br/>
      
<br/>
      glLight(0, RGB15(31,31,31) , 0,              floattov10(-1.0),       0);
<br/>
      glLight(1, RGB15(31,31,31) , 0,              0,   floattov10(-1.0));
<br/>
      glLight(2, RGB15(31,31,31) , 0,              0,   floattov10(1.0));
<br/>
<br/>
      glPushMatrix();
<br/>
      
<br/>
      glMatrixMode(GL_TEXTURE);
<br/>
      glIdentity();
<br/>
      
<br/>
      glMatrixMode(GL_MODELVIEW);
<br/>
<br/>
      //need to set up some material properties since DS does not have them set by default
<br/>
      glMaterialf(GL_AMBIENT, RGB15(16,16,16));
<br/>
      glMaterialf(GL_DIFFUSE, RGB15(16,16,16));
<br/>
      glMaterialf(GL_SPECULAR, BIT(15) | RGB15(8,8,8));
<br/>
      glMaterialf(GL_EMISSION, RGB15(16,16,16));
<br/>
<br/>
      //ds uses a table for shinyness..this generates a half-ass one
<br/>
      glMaterialShinyness();
<br/>
      
<br/>
      
<br/>
      //ds specific, several attributes can be set here   
<br/>
      glPolyFmt(POLY_ALPHA(31) | POLY_CULL_NONE  | POLY_FORMAT_LIGHT0| POLY_FORMAT_LIGHT1| POLY_FORMAT_LIGHT2);
<br/>
      
<br/>
      // Set the current matrix to be the model matrix
<br/>
      glMatrixMode(GL_MODELVIEW);
<br/>
      
<br/>
      //Push our original Matrix onto the stack (save state)
<br/>
      glPushMatrix();   
<br/>
<br/>
      DrawGLScene();
<br/>
      
<br/>
      // Pop our Matrix from the stack (restore state)
<br/>
      glPopMatrix(1);
<br/>
<br/>
      // flush to screen   
<br/>
      glFlush();
<br/>
      
<br/>
      
<br/>
      
<br/>
      
<br/>
      
<br/>
       swiWaitForVBlank();
<br/>
   }
<br/>
   
<br/>
   return 0;
<br/>
}
<br/>
<br/>
int DrawGLScene()                                 // Here's Where We Do All The Drawing
<br/>
{
<br/>
   glLoadIdentity();                           // Reset The View
<br/>
   glTranslatef(0.0f,0.0f,-5.0f);
<br/>
<br/>
   glRotatef(xrot,1.0f,0.0f,0.0f);
<br/>
   glRotatef(yrot,0.0f,1.0f,0.0f);
<br/>
   glRotatef(zrot,0.0f,0.0f,1.0f);
<br/>
<br/>
   glBindTexture(GL_TEXTURE_2D, texture[0]);
<br/>
<br/>
   glBegin(GL_QUADS);
<br/>
      // Front Face
<br/>
      glTexCoord2f(0.0f, 0.0f); glVertex3f(-1.0f, -1.0f,  1.0f);
<br/>
      glTexCoord2f(1.0f, 0.0f); glVertex3f( 1.0f, -1.0f,  1.0f);
<br/>
      glTexCoord2f(1.0f, 1.0f); glVertex3f( 1.0f,  1.0f,  1.0f);
<br/>
      glTexCoord2f(0.0f, 1.0f); glVertex3f(-1.0f,  1.0f,  1.0f);
<br/>
      // Back Face
<br/>
      glTexCoord2f(1.0f, 0.0f); glVertex3f(-1.0f, -1.0f, -1.0f);
<br/>
      glTexCoord2f(1.0f, 1.0f); glVertex3f(-1.0f,  1.0f, -1.0f);
<br/>
      glTexCoord2f(0.0f, 1.0f); glVertex3f( 1.0f,  1.0f, -1.0f);
<br/>
      glTexCoord2f(0.0f, 0.0f); glVertex3f( 1.0f, -1.0f, -1.0f);
<br/>
      // Top Face
<br/>
      glTexCoord2f(0.0f, 1.0f); glVertex3f(-1.0f,  1.0f, -1.0f);
<br/>
      glTexCoord2f(0.0f, 0.0f); glVertex3f(-1.0f,  1.0f,  1.0f);
<br/>
      glTexCoord2f(1.0f, 0.0f); glVertex3f( 1.0f,  1.0f,  1.0f);
<br/>
      glTexCoord2f(1.0f, 1.0f); glVertex3f( 1.0f,  1.0f, -1.0f);
<br/>
      // Bottom Face
<br/>
      glTexCoord2f(1.0f, 1.0f); glVertex3f(-1.0f, -1.0f, -1.0f);
<br/>
      glTexCoord2f(0.0f, 1.0f); glVertex3f( 1.0f, -1.0f, -1.0f);
<br/>
      glTexCoord2f(0.0f, 0.0f); glVertex3f( 1.0f, -1.0f,  1.0f);
<br/>
      glTexCoord2f(1.0f, 0.0f); glVertex3f(-1.0f, -1.0f,  1.0f);
<br/>
      // Right face
<br/>
      glTexCoord2f(1.0f, 0.0f); glVertex3f( 1.0f, -1.0f, -1.0f);
<br/>
      glTexCoord2f(1.0f, 1.0f); glVertex3f( 1.0f,  1.0f, -1.0f);
<br/>
      glTexCoord2f(0.0f, 1.0f); glVertex3f( 1.0f,  1.0f,  1.0f);
<br/>
      glTexCoord2f(0.0f, 0.0f); glVertex3f( 1.0f, -1.0f,  1.0f);
<br/>
      // Left Face
<br/>
      glTexCoord2f(0.0f, 0.0f); glVertex3f(-1.0f, -1.0f, -1.0f);
<br/>
      glTexCoord2f(1.0f, 0.0f); glVertex3f(-1.0f, -1.0f,  1.0f);
<br/>
      glTexCoord2f(1.0f, 1.0f); glVertex3f(-1.0f,  1.0f,  1.0f);
<br/>
      glTexCoord2f(0.0f, 1.0f); glVertex3f(-1.0f,  1.0f, -1.0f);
<br/>
   glEnd();
<br/>
<br/>
   xrot+=0.3f;
<br/>
   yrot+=0.2f;
<br/>
   zrot+=0.4f;
<br/>
   return TRUE;         
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"><br/><br/>Last edited by yellowstar on Sat Aug 04, 2007 12:10 am; edited 9 times in total</span></div>    
</div>
<div class="post">
    <h4>#135909 - silent_code - Fri Jul 27, 2007 10:50 am</h4>
    <div class="postbody"><span class="postbody">you better post *what* problem you have and what works so far. then someone will be able to help you. often, it's a good idea to post "the whole thing". it's much better to post specific parts of the code that is causing problems.
<br/>
me, e.g., i don't have the time to check your whole code. i imagine others feel the same.
<br/>
please refine your post and i'm sure someone will help you!
<br/>
<br/>
ps: i've written an nds .tga loader myself (i think i had it in my stencil shadow demo), but without transparency. now that i'll have some spare time (uni is over for this semester, yay!) that's a thing i'd like to implement myself. i've found 5+3 bit texture mode pretty useful for what i need. ;D</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135940 - yellowstar - Fri Jul 27, 2007 6:13 pm</h4>
    <div class="postbody"><span class="postbody">When I posted this topic,
<br/>
I forgot to post what my problem is.
<br/>
<br/>
See my first post for details
<br/>
on what my problem is.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135945 - silent_code - Fri Jul 27, 2007 7:11 pm</h4>
    <div class="postbody"><span class="postbody">there's still not enough information to help you. (you're being very generic - no details at all... any pics of the problem? i guess there are a *lot* of possible texture related bugs.)
<br/>
well, i can still give you some hints (i didn't read your code... it's too much):
<br/>
<br/>
i remember i had problems with endianes (is that the correct term?). that's why i'm reading and shifting stuff.
<br/>
convert your 24 colors to 15 bit colors (don't gorget to set bit 15 in the 16 bit value). make sure stuff is in R-B-G format. else you'll see garbage.
<br/>
if that works, head for transparency: convert the 8 bit alpha value into 3 bit, the regular colors still need to be 15 bit, but in a 32 color palette.
<br/>
<br/>
here you can check out my code: <a class="postlink" href="http://www.robs-basement.de" target="_blank">www.robs-basement.de</a>
<br/>
just download the sources and look for the .tga stuff (source/tgaloader.cpp, source/initialize.cpp for the conversion). you should be able to modify that to work with transparencies. well, at least there're some hints and the conversion code, plus it works. ;^D
<br/>
NOTE: oh, don't forget that i used gbfs, so you'll have to adjust it for use with libfat, in case that's what you're working with.
<br/>
<br/>
good luck.
<br/>
<br/>
ps: you don't need all those data structures, just skip the stuff you don't need and return width, height and image data (bpp is straight forward, so leave it out). [i should have written a better function for that, but i was kinda lazy... ;^D ]<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"><br/><br/>Last edited by silent_code on Sat Jun 14, 2008 3:07 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#135951 - yellowstar - Fri Jul 27, 2007 8:38 pm</h4>
    <div class="postbody"><span class="postbody">I don't have a file/image host for
<br/>
hosting files/images.
<br/>
<br/>
So I can't post links to images,
<br/>
untill I find one.
<br/>
<br/>
I can't look for one right now.
<br/>
<br/>
EDIT:
<br/>
I now have a image host.
<br/>
This means I have posted links to these images.
<br/>
Go to <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?p=136099#136099" target="_blank">this</a> post for details.
<br/>
<br/>
I guess I'll try that later,
<br/>
when I have the time.(Converting the 24 bit
<br/>
colors to 16.)</span><span class="gensmall"><br/><br/>Last edited by yellowstar on Sun Jul 29, 2007 4:12 am; edited 2 times in total</span></div>    
</div>
<div class="post">
    <h4>#135974 - yellowstar - Sat Jul 28, 2007 2:41 am</h4>
    <div class="postbody"><span class="postbody">I have posted the important pieces of code
<br/>
in my first post.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135978 - yellowstar - Sat Jul 28, 2007 4:01 am</h4>
    <div class="postbody"><span class="postbody">I have tried the above,(converting the colors to 16 bit)
<br/>
but that didn't work.
<br/>
<br/>
Now it looks differen't,
<br/>
but it still won't work right.
<br/>
<br/>
I have updated the loadTGA and createTexture functions.</span><span class="gensmall"><br/><br/>Last edited by yellowstar on Sun Jul 29, 2007 4:08 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#136006 - Cearn - Sat Jul 28, 2007 1:41 pm</h4>
    <div class="postbody"><span class="postbody">Leaving the printf statements and failed attempts in the posted code does not help us figure out what's going on. The non-essential extras makes it difficult to read the code, and due to the commented out parts it is hard to see what is and isn't part of the current function. For example 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yellowstar wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   //if(tgaimage-&gt;header.colorMapType!=0)
<br/>
   //{
<br/>
    for(int I = 0; I &lt; 5; I++)
<br/>
    {
<br/>
    tgaimage-&gt;header.ColorMapSpecification[I] = *stream.GetStreamCur();stream.Move(1);
<br/>
    printf("ColorMapSpecification[%d] = %d\n",I,(int)tgaimage-&gt;header.ColorMapSpecification[I]);
<br/>
    }
<br/>
    WaitForAnyKey();
<br/>
    //}
<br/>
   /*else
<br/>
   {
<br/>
   printf("No ColorMap Spec, there is no color map.\n");
<br/>
   }*/
<br/>
   //tgaimage-&gt;header.xOrigin = (short)stream.GetStreamCur();stream.Move(sizeof(short));
<br/>
    //tgaimage-&gt;header.yOrigin = (short)stream.GetStreamCur();stream.Move(sizeof(short));
<br/>
    //tgaimage-&gt;he
<br/>
ader.imageWidth = (short)stream.GetStreamCur();stream.Move(sizeof(short));
<br/>
    //tgaimage-&gt;header.imageHeight = (short)stream.GetStreamCur();stream.Move(sizeof(short));
<br/>
   
<br/>
    MemCpy(stream.GetStreamCur(),&amp;tgaimage-&gt;header.xOrigin);stream.Move(sizeof(short));
<br/>
    MemCpy(stream.GetStreamCur(),&amp;tgaimage-&gt;header.yOrigin);stream.Move(sizeof(short));
<br/>
</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
This is nearly impossible to parse without the benefit of color highlighting, which this forum doesn't have. All this code really says is:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">    for(int I = 0; I &lt; 5; I++)
<br/>
    {
<br/>
        tgaimage-&gt;header.ColorMapSpecification[I] = *stream.GetStreamCur();
<br/>
        stream.Move(1);
<br/>
    }
<br/>
<br/>
    MemCpy(stream.GetStreamCur(),&amp;tgaimage-&gt;header.xOrigin);
<br/>
    stream.Move(sizeof(short));
<br/>
    MemCpy(stream.GetStreamCur(),&amp;tgaimage-&gt;header.yOrigin);
<br/>
    stream.Move(sizeof(short));
<br/>
</td> </tr></table><span class="postbody">
<br/>
In other words: <span style="font-weight: bold">Remove irrelevant and non-functional parts before posting.</span>
<br/>
<br/>
Using identifiers that differ only by case (<span style="font-style: italic">i</span> and <span style="font-style: italic">I</span>, and <span style="font-style: italic">position</span> and <span style="font-style: italic">POSITION</span> members of the stream class) is a not a good idea. All-caps is generally reserved for constants, and using them for something else creates some mental friction. There letters besides <span style="font-style: italic">i</span> that are used for indices, and stream.position isn't a position but merely a pointer, so don't call it that.
<br/>
As a sidenote: using I (and l and O) are particularly bad choices for identifiers because they look very similar to 1 and 0 in many fonts.
<br/>
<br/>
The current implementation of the stream class is incredibly unwieldy. All it really does is keep track of a pointer and an offset, but in a way that could be done just as well with, well, a pointer and an offset. Or just a single pointer for that matter. Accessing the stuff with GetStreamCur() and Move() just makes it harder to read because of the horizontal space they take up. Either <span style="font-weight: bold">make your class complete and useful, or lose it</span>.
<br/>
<br/>
At the very least, create byte/halfword/word/anysize readers/writers that <span style="font-style: italic">also</span> update the position automatically; that's how (AFAIK) streams work anyway. Above all, <span style="font-weight: bold">test on the PC first, where you have better debug options</span>.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yellowstar wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void MemCpy(BYTE *source, short *target)
<br/>
{
<br/>
     for(int i = 0; i &lt; (int)sizeof(short); i++)
<br/>
     target[i] = source[i];
<br/>
}</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
This function has no relation to the standard memcpy() at all in both appearance and functionality, so don't imply that by naming it MemCpy(). What it really does expands 2 bytes into 2 halfwords: 01 02 -&gt; 0001, 0002. This is probably the source of a few of the problems. 
<br/>
<br/>
For reading a halfword from 2 bytes, either cast the source and read or, if alignment may be a problem, use something like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">u16 read16(const u8 *src)
<br/>
{   return src[0] | src[1]&lt;&lt;8;   }
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yellowstar wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   if(tgaimage-&gt;header.imageType !=2){
<br/>
      //printf("Unsuported TGA type.\n");
<br/>
      //return -2;
<br/>
      char str[8];
<br/>
      strcpy(str,"");
<br/>
      sprintf(str,"%s\nSupported Type: Uncompressed, RGB, with orgin at top-left.(2)\nType: %d","Unsuported TGA type.",(int)tgaimage-&gt;header.imageType);
<br/>
      Error(str,-2);
<br/>
      
<br/>
   }</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
You are trying to dump a string that spans two lines into 8 characters. That never ends well.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yellowstar wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   for(int i=0; i &lt; (int)(tgaimage-&gt;width*tgaimage-&gt;height); i+=2)
<br/>
   {
<br/>
<br/>
         tgaimage-&gt;IMAGE[i] = RGB15((tgaimage-&gt;imageData[I + 0] / 8) &amp; 0x1F,
<br/>
            (tgaimage-&gt;imageData[I + 1] / 8) &amp; 0x1F,
<br/>
            (tgaimage-&gt;imageData[I + 2] / 8) &amp; 0x1F) | BIT(15);
<br/>
   
<br/>
   I+=4;
<br/>
<br/>
   } </td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
If the image was 24bpp, incrementing by 4 would be bad; use bytesPerPixel like before. libnds also has an RGB8() function that takes 8bit color components as its arguments so you don't have to do the 8-&gt;5bit conversion yourself.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yellowstar wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">  tgaimage-&gt;imageData = (BYTE*)malloc((size_t)((int)imageSize));
<br/>
 ...
<br/>
   for (i =0; i &lt;(int)imageSize; i+=(int)bytesPerPixel) 
<br/>
... and many more
<br/>
</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
If you find yourself adding casts all the time, it might be better use the correct type in the first place. Often, casts for integers aren't necessary anyway.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yellowstar wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int in=0;
<br/>
int r; </td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
Don't <span style="font-weight: bold">ever</span> use global variables with names this short. They would be impossible to find in larger projects and could give rise to naming conflicts. For an example of this, see <a class="postlink" href="http://www.rinkworks.com/stupid/cs_programming.shtml" target="_blank">here</a> and search for "alpha". <span style="font-weight: bold">Ensure your global vars are distinguishable from your locals vars</span>.
<br/>
<br/>
I can't really tell if the TGA reader works or not from here, but it'd be best to test that on the PC first as well. Once you're sure that one works, port to NDS and try to display it in a frame buffer. After that, use a pre-converted image to see if you know how to work with NDS textures. Then, and <span style="font-style: italic">only</span> then, try to combine all these things. This procedure will give you a better idea of where the problem is. <span style="font-weight: bold">Do not try to do things all at once. A step-by-step approach works better.</span>
<br/>
<br/>
A picture of both would be helpful. I never used the services, but photobucket and imageshack are still free, right? You could try uploading the image there. Even a failed image can tell you a lot about what's going on, by the way. Use a simple, geometric shapes. If the colors change, you will know that you're mis-reading R,G,B values; ditto for swapped color and alpha values. If the image is skewed, you'll know that the width/pitch is wrong and if it's cut off, the height is wrong. Horizontal gaps often mean a bitdepth problem and if the image makes no sense at all, well, then it could be anything :\.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#136026 - yellowstar - Sat Jul 28, 2007 4:46 pm</h4>
    <div class="postbody"><span class="postbody">I did most of your suggestions.
<br/>
<br/>
The ones I did not do,(right now anyway)
<br/>
is testing on PC, and posting a link to an image.(no image host.)
<br/>
<br/>
EDIT:
<br/>
I now have a image host.
<br/>
This means I have posted links to these images.
<br/>
Go to <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?p=136099#136099" target="_blank">this</a> post for details.
<br/>
<br/>
I am drawing the texture
<br/>
on a cube.
<br/>
<br/>
I have made some major progress!
<br/>
<br/>
I have taken out the code
<br/>
that handles the alpha.
<br/>
<br/>
It still works with transparent
<br/>
TGAs,
<br/>
it just makes it solid,
<br/>
non-transparent.
<br/>
<br/>
I have found out,
<br/>
that the  major problem 
<br/>
is a mistake in the code
<br/>
that converts the
<br/>
image to 16 bit:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
tgaimage-&gt;image = (u16*)malloc(sizeof(u16)*(tgaimage-&gt;width*tgaimage-&gt;height));
<br/>
int I = 0;
<br/>
   for(int i=0; i &lt; (int)(tgaimage-&gt;width*tgaimage-&gt;height);i+=2)
<br/>
//The amount it is being incremented by is the problem!
<br/>
//Simply changing that amount to 1, or to i++,
<br/>
//fixes the major problem!
<br/>
   {
<br/>
<br/>
         tgaimage-&gt;image[i] = RGB8((tgaimage-&gt;imageData[I + 0]),
<br/>
            (tgaimage-&gt;imageData[I + 1]),
<br/>
            (tgaimage-&gt;imageData[I + 2])) | BIT(15);
<br/>
   
<br/>
   I+=bytesPerPixel;
<br/>
<br/>
   }
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Now,
<br/>
the converted image looks like
<br/>
the original TGA,
<br/>
but almost every
<br/>
part of the image is
<br/>
the wrong color.
<br/>
<br/>
And in two parts
<br/>
of the image,
<br/>
two colors are
<br/>
in the part that
<br/>
the other color should be.
<br/>
<br/>
Also,
<br/>
the background color is wrong.
<br/>
<br/>
When I leave the code
<br/>
in which flips the Blue
<br/>
and Red colors,
<br/>
the image dosen't look right,
<br/>
but the shape is the same
<br/>
as the original TGA.
<br/>
<br/>
But when I take out that code,
<br/>
it looks like the above.(the section after the piece of code.)
<br/>
<br/>
<br/>
For the image host:
<br/>
<br/>
I know about Image Shack.
<br/>
<br/>
I don't have access to my
<br/>
email account right now,(won't have access
<br/>
to it for a week.)
<br/>
and to register for an account I
<br/>
must check my email,
<br/>
which I can't do right now.
<br/>
<br/>
Any other image hosting
<br/>
web sites?
<br/>
<br/>
I have updated my source code.</span><span class="gensmall"><br/><br/>Last edited by yellowstar on Sun Jul 29, 2007 4:13 am; edited 2 times in total</span></div>    
</div>
<div class="post">
    <h4>#136094 - M3d10n - Sun Jul 29, 2007 1:28 am</h4>
    <div class="postbody"><span class="postbody">Use this to host images: 
<br/>
<a class="postlink" href="http://freeshare.us/" target="_blank">http://freeshare.us/</a>
<br/>
<br/>
No need to register whatsoever (but you can do it if you want to keep track of your images). Just upload the image and it it gives you links for it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#136099 - yellowstar - Sun Jul 29, 2007 3:50 am</h4>
    <div class="postbody"><span class="postbody">I have uploaded two images on freespace.
<br/>
<br/>
WARNING:
<br/>
These links are only temporary.
<br/>
I am going to move these images to Image Shack
<br/>
in about a week.(When I can access my email account.)
<br/>
<br/>
Note: In the capture, it(the texture) is on a 3D square,
<br/>
instead of the cube, which I have
<br/>
it render on normally.(the cube)
<br/>
This is because the emulator I used
<br/>
for this screenshot won't render the cube correctly.
<br/>
<br/>
The first is a capture of the top screen.(With the texture
<br/>
on a 3D square.)
<br/>
<br/>
The second is the texture.
<br/>
<br/>
The third is the original, in BMP format.
<br/>
<br/>
The fourth is the texture.
<br/>
This one's colors is swapped.(green and blue)
<br/>
<br/>
Note:
<br/>
For some reason,
<br/>
my image host messed up the Capture image
<br/>
on there host.
<br/>
But the Texture image is fine.
<br/>
<br/>
If you want to view the images without
<br/>
the free space stuff,
<br/>
do the following:
<br/>
<br/>
1.Right click the image, and click properties.
<br/>
<br/>
2.Select the address, and copy it.
<br/>
<br/>
3.Past the address into the address bar.
<br/>
<br/>
4.Go to that address!
<br/>
<br/>
<a class="postlink" href="http://m1.freeshare.us/view/?162fs739514.bmp" target="_blank">Capture</a>
<br/>
<br/>
<a class="postlink" href="http://m1.freeshare.us/view/?164fs102894.bmp" target="_blank">Texture</a>
<br/>
<br/>
<a class="postlink" href="http://m1.freeshare.us/view/?163fs334082.bmp" target="_blank">Original</a>
<br/>
<br/>
<a class="postlink" href="http://m1.freeshare.us/view/?164fs113567.bmp" target="_blank">Manually Swapped
<br/>
Texture</a>
<br/>
<br/>
<br/>
I have a question related to screenshots.
<br/>
<br/>
How do I take a screenshot(in my DS program)
<br/>
of one of the screens,(The top, 3D screen.)
<br/>
and save it to a file using FAT?</span><span class="gensmall"><br/><br/>Last edited by yellowstar on Thu Aug 02, 2007 6:06 pm; edited 3 times in total</span></div>    
</div>
<div class="post">
    <h4>#136122 - Cearn - Sun Jul 29, 2007 2:11 pm</h4>
    <div class="postbody"><span class="postbody">The screenshot looks ok to me. The reason some pixels seem 'off' is because the square is rotated and scaled -- you always get a little distortion then.
<br/>
<br/>
There is no transparency because all bits have their alpha-bit set. You'd need to only set it for other colors than the background color to make the borders transparent. Or, instead of doing all the work yourself, you can use a converter like <a class="postlink" href="http://www.coranac.com/projects.php#grit" target="_blank">grit</a> or <a class="postlink" href="http://gasp.boxgamex.net/" target="_blank">texmex</a> (which unfortunately seems down right now &gt;_&gt;) to prepare the textures for you.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yellowstar wrote:</b></span></td> </tr> <tr> <td class="quote">How do I take a screenshot(in my DS program) of one of the screens,(The top, 3D screen.) and save it to a file using FAT?</td> </tr></table><span class="postbody"><a class="postlink" href="http://nocash.emubase.de/gbatek.htm#dsvideocaptureandmainmemorydisplaymode" target="_blank">GBATek : capture</a>. With this you can get a 16bpp screenshot, which you can then convert to an image format of your choice and then save. (I think)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#136126 - yellowstar - Sun Jul 29, 2007 3:16 pm</h4>
    <div class="postbody"><span class="postbody">I removed the transparency handling.
<br/>
It still works with RGBA and RGB,
<br/>
the texture would just be solid.
<br/>
<br/>
I'am going to keep it that way untill
<br/>
I get the colors to work right.
<br/>
But if transparency works
<br/>
when I try to put it back in,(before the colors work right)
<br/>
I'll update the source and images.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#136183 - yellowstar - Sun Jul 29, 2007 10:34 pm</h4>
    <div class="postbody"><span class="postbody">I tried putting the code which
<br/>
handles the transparency back in,
<br/>
but it won't work.
<br/>
<br/>
It won't let any pixel be transparent.
<br/>
<br/>
Can this only be done with palettes?(TGA color maps)
<br/>
<br/>
I did not update the source code in my first post.
<br/>
<br/>
My code basicly loops through the image,
<br/>
and when its alpha is at least 50,
<br/>
it makes that pixel solid,
<br/>
otherwise it will make it transparent.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#136238 - silent_code - Mon Jul 30, 2007 2:14 pm</h4>
    <div class="postbody"><span class="postbody">i suggest you look up the ds' texture transparency modes. looks like you didn't read my post carefully.
<br/>
first of all, the ds' colors are 15bit (yes, there is the opaque bit 15, but this is about colors)! lighting calculations are done in 24 bit, but stuff is displayed in 18bit (the displays bit depth).
<br/>
<br/>
multiple alpha textures can only be done either with 5 (bit color) + 3 (bit alpha) or 3 + 5 and of cause that're palette modes.
<br/>
<br/>
also, i guess, you haven't looked at my code (which is working in emulators and on hw). that could've given you valuable hints. well, it's up to you - either take the offered help or leave it.
<br/>
<br/>
last thing: having a *correct* version of the texture to compare the faulty output your code creates to, would help as well. i also had problems with .tga loading, basically the component orders and the infamous swapped s/t texture coordinate problem. i made a simple texture which contained four basic color squares (r, g, b, black) and their complements (which is not necessarily required), as well as the letters R, G, B, A. using that texture i was able to correct everything in a matter of minutes. ok, my .tga loader has been migrated from working pc code, but well. ;D
<br/>
<br/>
all in all i think you need to try a little bit harder on your side and take advices seriously. like: don't post code that noone wants to read and always describe your problems, if possible with images! ;D</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#136289 - yellowstar - Tue Jul 31, 2007 12:04 am</h4>
    <div class="postbody"><span class="postbody">I have uploaded an image of the original image.(Bmp version.)
<br/>
See my above post which has the links to the images.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#136415 - yellowstar - Wed Aug 01, 2007 2:24 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>silent_code wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
also, i guess, you haven't looked at my code (which is working in emulators and on hw). that could've given you valuable hints. well, it's up to you - either take the offered help or leave it. 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I did when you first posted the link to it.
<br/>
<br/>
I tried adding the S/T texture stuff like yours does,
<br/>
but that didn't do anything.</span><span class="gensmall"><br/><br/>Last edited by yellowstar on Thu Aug 02, 2007 5:23 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#136421 - yellowstar - Wed Aug 01, 2007 4:03 pm</h4>
    <div class="postbody"><span class="postbody">I tried implementing transparency via palettes.
<br/>
<br/>
But the way  am doing it dosen't work.
<br/>
<br/>
See below for code.
<br/>
<br/>
Does anybody know of any viewers/converters for
<br/>
bin/raw files?
<br/>
The converter would need to convert from bin/raw to a
<br/>
differen't format, like BMP.
<br/>
This is for captures of the DS screen(s).
<br/>
<br/>
<br/>
Here's the loadTGA function:(original source code
<br/>
in first post was not updated)(For the createTexture function,
<br/>
the format is GL_RGB256)
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
struct TGAimage
<br/>
{
<br/>
...
<br/>
u16 *palette;
<br/>
int Pal;
<br/>
};
<br/>
<br/>
bool loadTGA(u8 *DATA, TGAimage *tgaimage, int *texID)
<br/>
{
<br/>
   int i;
<br/>
   unsigned int temp;
<br/>
   BYTE *stream = NULL;
<br/>
<br/>
   if(DATA==NULL){Error("Attempted to loaded null data!",-1);}
<br/>
<br/>
   stream = DATA;
<br/>
<br/>
    tgaimage-&gt;texID = texID;
<br/>
<br/>
<br/>
<br/>
    tgaimage-&gt;header.ID_Length = *stream;stream++;
<br/>
    tgaimage-&gt;header.colorMapType = *stream;stream++;
<br/>
    tgaimage-&gt;header.imageType = *stream;stream++;
<br/>
    
<br/>
    for(int a = 0; a &lt; 5; a++)
<br/>
    {
<br/>
    tgaimage-&gt;header.ColorMapSpecification[a] = *stream;stream++;
<br/>
    }
<br/>
    
<br/>
    SCpy(stream,&amp;tgaimage-&gt;header.xOrigin);stream+=2;
<br/>
    SCpy(stream,&amp;tgaimage-&gt;header.yOrigin);stream+=2;
<br/>
    SCpy(stream,&amp;tgaimage-&gt;header.imageWidth);stream+=2;
<br/>
    SCpy(stream,&amp;tgaimage-&gt;header.imageHeight);stream+=2;
<br/>
    
<br/>
    tgaimage-&gt;header.pixelDepth = *stream;stream++;
<br/>
<br/>
   if(tgaimage-&gt;header.imageType !=2){
<br/>
      char str[256];
<br/>
      strcpy(str,"");
<br/>
      sprintf(str,"%s\nSupported Type: Uncompressed, RGB, with orgin at top-left.(2)\nType: %d","Unsuported TGA type.",(int)tgaimage-&gt;header.imageType);
<br/>
      Error(str,-2);
<br/>
      
<br/>
   }
<br/>
<br/>
   tgaimage-&gt;width = tgaimage-&gt;header.imageWidth;
<br/>
   tgaimage-&gt;height = tgaimage-&gt;header.imageHeight;
<br/>
   tgaimage-&gt;bpp = tgaimage-&gt;header.pixelDepth;
<br/>
<br/>
   if (tgaimage-&gt;width &lt;= 0 || tgaimage-&gt;height &lt;= 0 || (tgaimage-&gt;bpp!=24 &amp;&amp; tgaimage-&gt;bpp!=32)){
<br/>
      printf("Width: %d\nHeight: %d\n BPP: %d\n",(int)tgaimage-&gt;width,(int)tgaimage-&gt;height,(int)tgaimage-&gt;bpp);
<br/>
      Error("Wrong file type.",-3);
<br/>
        }
<br/>
<br/>
   unsigned int bytesPerPixel = tgaimage-&gt;bpp / 8;
<br/>
   unsigned int imageSize = ((tgaimage-&gt;width * tgaimage-&gt;height) * bytesPerPixel);
<br/>
   
<br/>
   tgaimage-&gt;type = GL_RGBA;
<br/>
<br/>
   if(tgaimage-&gt;bpp==24)
<br/>
   {
<br/>
      tgaimage-&gt;type = GL_RGB;printf("RGB\n");
<br/>
    }
<br/>
    else
<br/>
    {
<br/>
        printf("RGBA\n");
<br/>
    }
<br/>
<br/>
    if(tgaimage-&gt;header.colorMapType!=0)
<br/>
    {
<br/>
    Error("Color Map Data detected! Stopping...",-4);
<br/>
    }
<br/>
    
<br/>
    tgaimage-&gt;imageData = (BYTE*)malloc((size_t)((int)imageSize));
<br/>
    
<br/>
    if(tgaimage-&gt;imageData==NULL)
<br/>
    {
<br/>
    
<br/>
    Error("Failed to alloc memory for TGA data!",-5);
<br/>
    }
<br/>
<br/>
    for(int I = 0; I &lt; (int)imageSize; I++)
<br/>
    {
<br/>
    tgaimage-&gt;imageData[I] = *stream;
<br/>
    stream++;
<br/>
    }
<br/>
<br/>
   printf("Image data\n\n");
<br/>
   
<br/>
   //Convert BGR to RGB
<br/>
   /*for (i =0; i &lt;(int)imageSize; i+=(int)bytesPerPixel)
<br/>
   {
<br/>
      
<br/>
      temp = tgaimage-&gt;imageData[i];
<br/>
      tgaimage-&gt;imageData[i] = tgaimage-&gt;imageData[i+2];
<br/>
      tgaimage-&gt;imageData[i+2] = temp;
<br/>
   }*/
<br/>
<br/>
   tgaimage-&gt;image = (u16*)malloc(sizeof(u16)*(tgaimage-&gt;width*tgaimage-&gt;height));
<br/>
int I = 0;
<br/>
int w = 0;
<br/>
int H = 0;
<br/>
bool found = false;
<br/>
u16 Temp;
<br/>
u16 pal[50];
<br/>
   for(int i=0; i &lt; (int)(tgaimage-&gt;width*tgaimage-&gt;height); i++)
<br/>
   {
<br/>
<br/>
         Temp = RGB8((tgaimage-&gt;imageData[I + 0]),
<br/>
            (tgaimage-&gt;imageData[I + 1]),
<br/>
            (tgaimage-&gt;imageData[I + 2]));
<br/>
<br/>
         if(bytesPerPixel==4)
<br/>
         {
<br/>
<br/>
         if(tgaimage-&gt;imageData[I + 3]&gt;=175)
<br/>
            Temp |= BIT(15);
<br/>
<br/>
         if(tgaimage-&gt;imageData[I + 3]&lt;175)
<br/>
            Temp &amp;= ~BIT(15);
<br/>
<br/>
         }
<br/>
<br/>
         
<br/>
<br/>
         
<br/>
   
<br/>
   I+=bytesPerPixel;
<br/>
<br/>
<br/>
   found = false;
<br/>
<br/>
   for(int h=0; h&lt;w; h++)
<br/>
   {
<br/>
     if(pal[h]==Temp)
<br/>
     {
<br/>
     found=true;
<br/>
     H = h;
<br/>
     break;
<br/>
     }
<br/>
   }
<br/>
<br/>
   if(found==true)
<br/>
   {
<br/>
<br/>
   Temp = (u16)H;
<br/>
<br/>
   }
<br/>
<br/>
   if(found==false)
<br/>
   {
<br/>
      w++;
<br/>
<br/>
      pal[w-1] = Temp;
<br/>
<br/>
      found = true;
<br/>
<br/>
      H = w;
<br/>
<br/>
      Temp = (u16)H;
<br/>
   }
<br/>
<br/>
   if(!(pal[(int)Temp] &amp; BIT(15)))
<br/>
      Temp = 0;
<br/>
<br/>
   tgaimage-&gt;image[i] = Temp;
<br/>
<br/>
<br/>
   }
<br/>
<br/>
   tgaimage-&gt;palette = (u16*)malloc(2 * 256);
<br/>
<br/>
   memset(tgaimage-&gt;palette,2 + 2 * ((size_t)w),0);
<br/>
<br/>
   memcpy(tgaimage-&gt;palette,&amp;pal[1],2 * ((size_t)w));
<br/>
<br/>
   gluTexLoadPal(tgaimage-&gt;palette,(u16)w,GL_RGBA);
<br/>
<br/>
   
<br/>
<br/>
   createTexture(tgaimage);
<br/>
<br/>
   printf("Success...\n\n");
<br/>
<br/>
   return 1;
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#136500 - a128 - Thu Aug 02, 2007 11:17 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
<br/>
//---------------------------------------------------------------------------------
<br/>
//should work?!!!!!!!!!!!!
<br/>
//converts 32bit RGBA to NDS RGBalpha 16bit image with alpha=0 or 1
<br/>
<br/>
void image32to16(sImage* img) {
<br/>
//---------------------------------------------------------------------------------
<br/>
<br/>
   int x;
<br/>
   int y;
<br/>
<br/>
   int colormode=4;
<br/>
<br/>
   u16* temp = (u16*)malloc(img-&gt;height*img-&gt;width*2);
<br/>
<br/>
   unsigned int imageSize = img-&gt;height*img-&gt;width * colormode;
<br/>
<br/>
   int n=0;
<br/>
   
<br/>
   for(int i=0;i&lt;imageSize;n++,i+=colormode)
<br/>
   {
<br/>
               
<br/>
         unsigned char r,g,b,a;
<br/>
<br/>
         r=img-&gt;image.data8[i]&gt;&gt;3;
<br/>
         g=img-&gt;image.data8[i+1]&gt;&gt;3;
<br/>
         b=img-&gt;image.data8[i+2]&gt;&gt;3;
<br/>
         a=img-&gt;image.data8[i+3]&amp;0x1;//only one bit
<br/>
<br/>
         temp[n]=   (a&lt;&lt;15)|RGB15(r,g,b);
<br/>
   }
<br/>
<br/>
   free(img-&gt;image.data8);
<br/>
<br/>
   img-&gt;bpp=16;
<br/>
   img-&gt;image.data16 = temp;
<br/>
}
<br/>
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
loading TGA  from linux/windows is done via
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
bool tga_alpha=false;
<br/>
//---------------------------------------------------------------------------------
<br/>
bool loadTGA(const char *filename, sImage* tgaFile)
<br/>
{
<br/>
    FILE *file;
<br/>
    unsigned char      badChar;
<br/>
    short int      badInt;
<br/>
    long           imageSize;
<br/>
    int         colorMode;
<br/>
<br/>
    file = fopen(filename, "rb");
<br/>
<br/>
    if (!file)
<br/>
        return false;
<br/>
<br/>
    fread(&amp;badChar, sizeof(unsigned char), 1, file);
<br/>
    fread(&amp;badChar, sizeof(unsigned char), 1, file);
<br/>
<br/>
    unsigned char imageTypeCode;
<br/>
    fread(&amp;imageTypeCode, sizeof(unsigned char), 1, file);
<br/>
<br/>
    //13 bytes of useless data
<br/>
    fread(&amp;badInt, sizeof(short int), 1, file);
<br/>
    fread(&amp;badInt, sizeof(short int), 1, file);
<br/>
    fread(&amp;badChar, sizeof(unsigned char), 1, file);
<br/>
    fread(&amp;badInt, sizeof(short int), 1, file);
<br/>
    fread(&amp;badInt, sizeof(short int), 1, file);
<br/>
<br/>
<br/>
    //image dimensions
<br/>
<br/>
    short int w;
<br/>
    short int h;
<br/>
    
<br/>
    fread(&amp;w, sizeof(short int), 1, file);
<br/>
    fread(&amp;h, sizeof(short int), 1, file);
<br/>
<br/>
    tgaFile-&gt;width=(int)w;
<br/>
    tgaFile-&gt;height=(int)h;
<br/>
<br/>
    //image bit depth
<br/>
    unsigned char bitCount;
<br/>
    fread(&amp;bitCount, sizeof(unsigned char), 1, file);
<br/>
<br/>
    //1 byte of garbage data
<br/>
    fread(&amp;badChar, sizeof(unsigned char), 1, file);
<br/>
<br/>
    //colorMode -&gt; 3 = BGR, 4 = BGRA
<br/>
    colorMode = bitCount / 8;
<br/>
    imageSize = tgaFile-&gt;width * tgaFile-&gt;height * colorMode;
<br/>
<br/>
//fprintf(stderr,"\nTGA has colorMode %d\n",colorMode);
<br/>
    if(colorMode==4) fprintf(stderr,"\nTGA has RGBalpha map\n");
<br/>
    
<br/>
    tga_alpha=colorMode==4;
<br/>
<br/>
    /*else
<br/>
        if(colorMode==3) fprintf(stderr,"\nTGA has RGB map\n");
<br/>
*/
<br/>
    //allocate memory for image data
<br/>
    tgaFile-&gt;image.data8 = (u8*)malloc(imageSize);
<br/>
<br/>
    //read in image data
<br/>
    fread(tgaFile-&gt;image.data8, sizeof(unsigned char), imageSize, file);
<br/>
<br/>
    //change BGR to RGB (especially for OpenGL later on)
<br/>
<br/>
    int i;
<br/>
    //3 = BGR to RGB and 4=BGRA to RGBA
<br/>
    for ( i = 0; i &lt; imageSize; i += colorMode)
<br/>
    {
<br/>
        //swap blue and red colour value
<br/>
        tgaFile-&gt;image.data8[i] ^= tgaFile-&gt;image.data8[i+2] ^=
<br/>
                                     tgaFile-&gt;image.data8[i] ^= tgaFile-&gt;image.data8[i+2];
<br/>
    
<br/>
    
<br/>
    }
<br/>
<br/>
    //close file
<br/>
    fclose(file);
<br/>
<br/>
    return true;
<br/>
}
<br/>
//TGA stuff end
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
Here I load the TGA file and convert it to NDS image!!
<br/>
<br/>
finaly I dump the NDS image to a inlcude file and I am done
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
int ok= loadTGA(name, &amp;ob-&gt;texture_image);
<br/>
//set by loadTGA, ugly code
<br/>
if(tga_alpha)
<br/>
{
<br/>
   ob-&gt;texture_alpha=1;
<br/>
   image32to16(&amp;ob-&gt;texture_image);
<br/>
}
<br/>
   else{
<br/>
   ob-&gt;texture_alpha=0;
<br/>
      image24to16(&amp;ob-&gt;texture_image);
<br/>
   }
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#136520 - silent_code - Thu Aug 02, 2007 2:50 pm</h4>
    <div class="postbody"><span class="postbody">ok, now from the corrupt/original texture comparsion i can tell, that your byte order is broken!
<br/>
<br/>
AGAIN:
<br/>
<br/>
ARE YOU *SURE* YOU ARE WRITING COLORS IN R-B-G, NOT R-G-B?
<br/>
<br/>
are you using shorts (u16)?
<br/>
are you writing 32 or 16 bits?
<br/>
<br/>
if your code was technically the same as mine, it would work!
<br/>
<br/>
i guess that you're getting wrong transparency, because of the same fault you get screwed colors. e.g. you get 0xFFFF00 (yellow in r-g-b) instead of 0xFF00FF (magenta ion r-g-b). shifting that into r-b-g the colors seem totally valid... think about it! instead of green you get *blue* (that's because it's r-b-G, but you seem to be writing r-G-b) and the red part of the texture is still RED, because it's R-g-b and R-b-g. white is still white, from what i can tell. that raises suspicion!
<br/>
<br/>
CHECK that! (hint: if i remember correctly, i made a comment for that in my code.)
<br/>
<br/>
btw: yes, i didn't read the code, that's because i don't have a lot of time to spend on the inet. at least i'm trying to help. ;p
<br/>
<br/>
good luck!
<br/>
<br/>
ps: the broken texture seems shifted, that looks like there's also something else wrong. try to swap the blue and green channel in an image editor and see if the resulting image looks like the original texture. that's kind of the hard way, though. you better just swap blue and green in your code. ;D</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#136530 - yellowstar - Thu Aug 02, 2007 5:19 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>silent_code wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
are you using shorts (u16)?
<br/>
are you writing 32 or 16 bits?
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I am using shorts.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>silent_code wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
if your code was technically the same as mine, it would work!
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I removed that comment in my above post.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>silent_code wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
ps: the broken texture seems shifted, that looks like there's also something else wrong. try to swap the blue and green channel in an image editor and see if the resulting image looks like the original texture. that's kind of the hard way, though. you better just swap blue and green in your code. ;D</td> </tr></table><span class="postbody">
<br/>
<br/>
The shifted image was due to a mistake by
<br/>
me, when I took the screenshot
<br/>
of the texture in an emulator.
<br/>
I have uploaded the fixed version.
<br/>
See my above post which has the links to the images.
<br/>
<br/>
I tried swapping the colors manually.
<br/>
See my above post which has the links to the images
<br/>
for the result.
<br/>
The result almost looks right,
<br/>
but it still isn't correct.
<br/>
<br/>
I also tried swapping the colors in code,
<br/>
but it won't work.
<br/>
Here's how I am doing it:(This is after the
<br/>
image is read in, before it is
<br/>
converted to 16 bit colors.)
<br/>
(I tried the way you do it
<br/>
in your code,
<br/>
bu that won't work either.)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
unsigned char temp;
<br/>
...
<br/>
<br/>
//Convert BGR to RGB
<br/>
   for (i =0; i &lt;(int)imageSize; i+=(int)bytesPerPixel)
<br/>
   {
<br/>
      
<br/>
      temp = tgaimage-&gt;imageData[i];
<br/>
      tgaimage-&gt;imageData[i] = tgaimage-&gt;imageData[i + 2];
<br/>
      tgaimage-&gt;imageData[i + 2] = temp;
<br/>
<br/>
      temp = tgaimage-&gt;imageData[i + 1];
<br/>
      tgaimage-&gt;imageData[i + 1] = tgaimage-&gt;imageData[i + 2];
<br/>
      tgaimage-&gt;imageData[i + 2] = temp;
<br/>
   }
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"><br/><br/>Last edited by yellowstar on Thu Aug 02, 2007 6:17 pm; edited 3 times in total</span></div>    
</div>
<div class="post">
    <h4>#136531 - Cearn - Thu Aug 02, 2007 5:21 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>silent_code wrote:</b></span></td> </tr> <tr> <td class="quote">ok, now from the corrupt/original texture comparsion i can tell, that your byte order is broken!
<br/>
<br/>
AGAIN:
<br/>
<br/>
ARE YOU *SURE* YOU ARE WRITING COLORS IN R-B-G, NOT R-G-B?
<br/>
</td> </tr></table><span class="postbody">
<br/>
Uhm, I'm sorry, but Targa's are BGR, not RBG. In your reader, the image seems to start at byte 17, while it should start at byte 18 (at least in the absence of an Image Identification Field or a Color Map). This is why it would seem to be RBG according to your loader (see <a class="postlink" href="http://organicbit.com/closecombat/formats/tga.html" target="_blank">specs</a> for details).
<br/>
The "pFile += 8;" in your loader should have been "pFile += 9;".  This is why the you're using *++pFile instead of the more conventional *pFile++ : at the time you need to read the width-field, you're still at byte 11 instead of byte 12.
<br/>
<br/>
I agree that yellowstar's problem is related to a frame-shift, though. But it's hard to see what goes on without the details of the original tga file. The posted original is converted to an 8-bit bmp, which makes analysis difficult.
<br/>
<br/>
<br/>
@ yellowstar:
<br/>
<br/>
Take a look at a128's code. It's nicely blocked out, indented, clearly commented (i.e., not to the extend that it hides the actual code) and written clearly (well, apart minor issues like the swap-by-xor, I guess :P ). If he had a problem with his loader, people would be more willing to debug his code than yours because it's more readable. Consider it an example.
<br/>
<br/>
As silent_code said comparing your texture (with the blue BG) and the original (green BG), it seems the image is read at an offset. If you want to find the offset yourself, use a clearly defined boundary for the image and open it in a hex editor.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#136547 - yellowstar - Thu Aug 02, 2007 6:41 pm</h4>
    <div class="postbody"><span class="postbody">I have finally got it to work!!!!
<br/>
<br/>
I made it move 1 byte forward before reading in
<br/>
the image.
<br/>
I then put in the above code in my above post
<br/>
for swapping colors.(I had to swap twice because,
<br/>
for some reason the image still wasn't correct.(It was
<br/>
similar to the way it was, without the red pixels.))
<br/>
<br/>
Now it works!!!!
<br/>
<br/>
Colors and alpha works!!!
<br/>
Alpha works without a palette!
<br/>
<br/>
<br/>
I have one last queston:(I asked this before in this topic.)
<br/>
<br/>
Does anybody know of any viewers/converters for bin files?
<br/>
The converter needs to convert an bin file
<br/>
to a differen't file.(like BMP)
<br/>
(This is for captures of the screen(s))
<br/>
<br/>
<span style="font-weight: bold">EDIT:</span>
<br/>
Also,
<br/>
how do I capture the bottom
<br/>
screen, instead of the top screen?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#136708 - yellowstar - Sat Aug 04, 2007 12:06 am</h4>
    <div class="postbody"><span class="postbody">I am trying to save TGAs of captures of the screen(s).
<br/>
<br/>
But the way I am doing it won't work.
<br/>
<br/>
Here's my problem:
<br/>
The image, on the computer,
<br/>
is only black.
<br/>
<br/>
I also have some other questions:(source code is below)
<br/>
<br/>
Does anybody know of any basic TGA editors?
<br/>
They need to be able to enable/disable
<br/>
RLE encoding, changing the orgin, palette, and ect.
<br/>
(The one I was using I don't have access to right now,
<br/>
and it's very big, and I don't want to
<br/>
download it with my slow internet just for this.)
<br/>
<br/>
Also, how do I capture the bottom screen,
<br/>
instead of the top screen?
<br/>
<br/>
Does anybody know of any viewers/converters for bin files?
<br/>
(For captures of the screens.)
<br/>
The converters would need to be able to convert bin to
<br/>
a differen't format.(like BMP.)
<br/>
<br/>
<br/>
<br/>
Here's how I am doing it:
<br/>
<br/>
This is the function which saves the TGA for captures:
<br/>
(This function is supposed to save a TGA,
<br/>
using a converted version of the data.)
<br/>
(The actual function is the function below this one)
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
<br/>
struct TGA_header
<br/>
{
<br/>
   BYTE ID_Length;
<br/>
   BYTE colorMapType;
<br/>
   BYTE imageType;
<br/>
   BYTE ColorMapSpecification[5];
<br/>
   short xOrigin;
<br/>
   short yOrigin;
<br/>
   short imageWidth;
<br/>
   short imageHeight;
<br/>
   BYTE pixelDepth;
<br/>
   BYTE ImageDesc;
<br/>
};
<br/>
<br/>
<br/>
void SaveTGAMACRO(TGAimage *tgaimage, u8 *buff, int index, int startBit)
<br/>
//This function is supposed to
<br/>
//grab the Red, Green, and Blue colors from
<br/>
//a 16 bit color, and convert it to 8-bit.
<br/>
{
<br/>
<br/>
<br/>
      for(int p=startBit;p&lt;startBit + 5;p++)
<br/>
      {
<br/>
         if(tgaimage-&gt;image[index] &amp; BIT(p))
<br/>
         {
<br/>
         *buff |= BIT(startBit - p);
<br/>
         }
<br/>
         else
<br/>
         {
<br/>
         *buff &amp;= ~BIT(startBit - p);
<br/>
         }
<br/>
      }
<br/>
      
<br/>
      *buff = *buff &gt;&gt; 3;
<br/>
}
<br/>
<br/>
void SaveTGA(u16 *data, int size, char *filename)//Saves an TGA image.
<br/>
//data is the image data. size is image size.(pixels)
<br/>
{
<br/>
<br/>
<br/>
<br/>
   TGAimage tgaimage;
<br/>
   u8 *buff = NULL;
<br/>
   FILE *f = NULL;
<br/>
<br/>
   memset(&amp;tgaimage,sizeof(TGAimage),0);
<br/>
<br/>
   tgaimage.header.ID_Length = 0;
<br/>
   tgaimage.header.colorMapType = 0;
<br/>
   tgaimage.header.imageType = 2;//RGB, no alpha
<br/>
<br/>
   tgaimage.header.imageWidth = 256;
<br/>
   tgaimage.header.imageHeight = 192;
<br/>
   tgaimage.header.xOrigin = 0;
<br/>
   tgaimage.header.yOrigin = 0;
<br/>
   tgaimage.header.pixelDepth = 24;//8-bit
<br/>
<br/>
   tgaimage.header.ImageDesc = 32;
<br/>
<br/>
   tgaimage.image = data;
<br/>
<br/>
   buff = (u8*)malloc((size_t)size * 3);
<br/>
<br/>
   f = fopen(filename,"wb");
<br/>
<br/>
   u8 buffer = 0;
<br/>
   int I = 0;
<br/>
<br/>
   for(int i=0; i&lt;size; i++)
<br/>
   {
<br/>
   
<br/>
<br/>
      SaveTGAMACRO(&amp;tgaimage,&amp;buffer,i,0);buff[I + 0] = buffer;
<br/>
      SaveTGAMACRO(&amp;tgaimage,&amp;buffer,i,5);buff[I + 1] = buffer;
<br/>
      SaveTGAMACRO(&amp;tgaimage,&amp;buffer,i,10);buff[I + 2] = buffer;
<br/>
<br/>
<br/>
      I+=3;
<br/>
<br/>
   }
<br/>
   
<br/>
   
<br/>
   fwrite(&amp;tgaimage.header.ID_Length,1,1,f);
<br/>
   fwrite(&amp;tgaimage.header.colorMapType,1,1,f);
<br/>
   fwrite(&amp;tgaimage.header.imageType,1,1,f);
<br/>
   
<br/>
   fwrite(&amp;tgaimage.header.ColorMapSpecification,1,5,f);
<br/>
<br/>
   fwrite(&amp;tgaimage.header.xOrigin,2,1,f);
<br/>
   fwrite(&amp;tgaimage.header.yOrigin,2,1,f);
<br/>
   fwrite(&amp;tgaimage.header.imageWidth,2,1,f);
<br/>
   fwrite(&amp;tgaimage.header.imageHeight,2,1,f);
<br/>
   
<br/>
   fwrite(&amp;tgaimage.header.pixelDepth,1,1,f);
<br/>
<br/>
   fwrite(&amp;tgaimage.header.ImageDesc,1,1,f);
<br/>
<br/>
<br/>
   fwrite(buff,3,(size_t)size,f);
<br/>
<br/>
   fclose(f);
<br/>
<br/>
<br/>
   free(buff);
<br/>
<br/>
<br/>
<br/>
}
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Here's the function which takes the screenshot:
<br/>
(It calls the SaveTGA function in this function.)
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void ScreenShot()
<br/>
{
<br/>
<br/>
int temp = 0;
<br/>
u8 temp2 = 0;
<br/>
u16 *buffer = NULL;
<br/>
FILE *f = NULL;
<br/>
<br/>
temp2 = 1;//VRAM block; Set it to target VRAM bank B
<br/>
<br/>
for(int i=16;i&lt;=17;i++)
<br/>
{
<br/>
   if(temp2 &amp; BIT(i-16))
<br/>
   {
<br/>
      temp |= BIT(i-16);
<br/>
   }
<br/>
   else
<br/>
   {
<br/>
      temp &amp;= ~BIT(i-16);
<br/>
   }
<br/>
}
<br/>
<br/>
temp2 = 0;//Write offset; set it to 00000h
<br/>
<br/>
for(int i=18;i&lt;=19;i++)
<br/>
{
<br/>
   if(temp2 &amp; BIT(i-18))
<br/>
   {
<br/>
      temp |= BIT(i-18);
<br/>
   }
<br/>
   else
<br/>
   {
<br/>
      temp &amp;= ~BIT(i-18);
<br/>
   }
<br/>
}
<br/>
<br/>
temp2 = 3;//Capture Size; set it t0 256x192(Screen size)
<br/>
<br/>
for(int i=20;i&lt;=21;i++)
<br/>
{
<br/>
   if(temp2 &amp; BIT(i-20))
<br/>
   {
<br/>
      temp |= BIT(i-20);
<br/>
   }
<br/>
   else
<br/>
   {
<br/>
      temp &amp;= ~BIT(i-20);
<br/>
   }
<br/>
}
<br/>
<br/>
temp |= BIT(24);//Set the source to only 3D
<br/>
<br/>
temp &amp;= ~BIT(25);//Set source B to VRAM
<br/>
<br/>
<br/>
<br/>
temp2 = 0;//VRAM read offset
<br/>
<br/>
for(int i=26;i&lt;=27;i++)
<br/>
{
<br/>
   if(temp2 &amp; BIT(i-26))
<br/>
   {
<br/>
      temp |= BIT(i-26);
<br/>
   }
<br/>
   else
<br/>
   {
<br/>
      temp &amp;= ~BIT(i-26);
<br/>
   }
<br/>
}
<br/>
<br/>
temp2 = 0;//VRAM read offset
<br/>
<br/>
for(int i=29;i&lt;=30;i++)
<br/>
{
<br/>
   if(temp2 &amp; BIT(i-29))
<br/>
   {
<br/>
      temp |= BIT(i-29);
<br/>
   }
<br/>
   else
<br/>
   {
<br/>
      temp &amp;= ~BIT(i-29);
<br/>
   }
<br/>
}
<br/>
<br/>
temp |= BIT(31);//Enable it;Start capturing!
<br/>
<br/>
DISP_CAPTURE = temp;//Copy it to the capture register!Make it start capturing!
<br/>
<br/>
while(DISP_CAPTURE &amp; BIT(31));//Wait for it to finish.It will clear this
<br/>
//bit when done. Then it will exit this loop.
<br/>
<br/>
buffer = (u16*)malloc(256*192*2);
<br/>
<br/>
dmaCopy(VRAM_B,buffer,256*192*2);
<br/>
<br/>
f = fopen("/screenshot.bin","w");
<br/>
fclose(f);
<br/>
<br/>
f = fopen("/screenshot.bin","wb");
<br/>
<br/>
fwrite(buffer,2,256*192,f);
<br/>
<br/>
fclose(f);
<br/>
<br/>
SaveTGA(buffer,256*192*2,"/screenshot.tga");
<br/>
<br/>
free(buffer);
<br/>
<br/>
}
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Here's the functions which calls the Screenshot function:
<br/>
(Step is called in the main loop.)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
void DoScreenShot()
<br/>
{
<br/>
<br/>
 if(keysDown() &amp; KEY_X)
<br/>
 {
<br/>
<br/>
 printf("Taking screenshot of top 3D screen...\n");
<br/>
<br/>
ScreenShot();
<br/>
<br/>
printf("Done!\n");
<br/>
printf("Saved to screenshot.bin\nin the root of your card.\n");
<br/>
<br/>
 }
<br/>
<br/>
}
<br/>
<br/>
#endif
<br/>
<br/>
void Step()
<br/>
{
<br/>
<br/>
scanKeys();
<br/>
<br/>
#ifdef DEBUG2
<br/>
<br/>
if(fat_init_success)
<br/>
{
<br/>
<br/>
DoScreenShot();
<br/>
}
<br/>
#endif
<br/>
<br/>
}
<br/>
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#136714 - kusma - Sat Aug 04, 2007 12:57 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yellowstar wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Does anybody know of any basic TGA editors?
<br/>
They need to be able to enable/disable
<br/>
RLE encoding, changing the orgin, palette, and ect.
<br/>
(The one I was using I don't have access to right now,
<br/>
and it's very big, and I don't want to
<br/>
download it with my slow internet just for this.)
<br/>
</td> </tr></table><span class="postbody">
<br/>
Why are you putting the complexity on the DS-side, and not just on the pc-side where you can cram in any big already-tested-to-death image-loading library (freeimage, devil, sdlimage or whatever)?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#136715 - yellowstar - Sat Aug 04, 2007 1:05 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>kusma wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yellowstar wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Does anybody know of any basic TGA editors?
<br/>
They need to be able to enable/disable
<br/>
RLE encoding, changing the orgin, palette, and ect.
<br/>
(The one I was using I don't have access to right now,
<br/>
and it's very big, and I don't want to
<br/>
download it with my slow internet just for this.)
<br/>
</td> </tr></table><span class="postbody">
<br/>
Why are you putting the complexity on the DS-side, and not just on the pc-side where you can cram in any big already-tested-to-death image-loading library (freeimage, devil, sdlimage or whatever)?</span></td> </tr></table><span class="postbody">
<br/>
<br/>
For TGA editors,
<br/>
I meant on the PC side.
<br/>
<br/>
For the bin viewer/converter,
<br/>
I also meant on the PC side.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#136726 - yellowstar - Sat Aug 04, 2007 3:51 am</h4>
    <div class="postbody"><span class="postbody">The bin version of the screenshot seems fine,
<br/>
as I checked it in Notepad, and the
<br/>
characters were not all the same,
<br/>
like it is supposed to be.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#136740 - kusma - Sat Aug 04, 2007 10:47 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yellowstar wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
For the bin viewer/converter,
<br/>
I also meant on the PC side.</td> </tr></table><span class="postbody">
<br/>
<br/>
Oh, I'm sorry. Then I misunderstood. Well, why don't you just use FreeImage or some other library that already went through the complexity of supporting every wicked variation of different file-formats?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#136760 - silent_code - Sat Aug 04, 2007 6:42 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cearn wrote:</b></span></td> </tr> <tr> <td class="quote">Uhm, I'm sorry, but Targa's are BGR, not RBG. In your reader, the image seems to start at byte 17, while it should start at byte 18 (at least in the absence of an Image Identification Field or a Color Map)...</td> </tr></table><span class="postbody">
<br/>
damn, you're right! now i feel dumb!
<br/>
anyway, also thanks for the code hint, i'll have a look at it asap.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#136783 - M3d10n - Sun Aug 05, 2007 5:24 am</h4>
    <div class="postbody"><span class="postbody">yellowstar:
<br/>
<br/>
Are you trying to save screenshots on the DS? If so, you can try loading the images as RAW (uncompressed, headerless) files in Photoshop. Type in the image dimensions and pixel format and it'll try to display it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#136807 - yellowstar - Sun Aug 05, 2007 4:08 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>M3d10n wrote:</b></span></td> </tr> <tr> <td class="quote">yellowstar:
<br/>
<br/>
Are you trying to save screenshots on the DS? If so, you can try loading the images as RAW (uncompressed, headerless) files in Photoshop. Type in the image dimensions and pixel format and it'll try to display it.</td> </tr></table><span class="postbody">
<br/>
<br/>
Yes,
<br/>
I am trying to save screenshots on the DS.
<br/>
After I do that,
<br/>
I am trying to convert it to TGA,
<br/>
but it won't work.
<br/>
<br/>
I don't have Photoshop.
<br/>
<br/>
I wrote a small program which
<br/>
displays an bin file on the main screen.
<br/>
It dosen't look like anything
<br/>
like it is supposed to.(It loads a preset bin file)
<br/>
<br/>
I found out that DSOrganize can
<br/>
read and display bin files, in Mode 5.
<br/>
In that it wasn't being displayed right either,
<br/>
but it was differen't than my small viewer.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#136815 - yellowstar - Sun Aug 05, 2007 5:14 pm</h4>
    <div class="postbody"><span class="postbody">I got the bin version to work right!!!
<br/>
<br/>
Now it contains what it is supposed to contain!
<br/>
<br/>
It was caused by the "i-(somevalue)"
<br/>
statements in the pieces of code
<br/>
which copied the temp2 data into the
<br/>
temp var.
<br/>
<br/>
But the TGA version is still the same.
<br/>
The TGA version still won't work.
<br/>
<br/>
<span style="font-weight: bold">EDIT:</span>
<br/>
How do I take an screenshot of
<br/>
the sub screen, instead of the main screen?
<br/>
<br/>
I tried adding lcdSwap before the temp
<br/>
var gets written to the display capture register,(I
<br/>
also put in swiWaitForVBlank, after this call,
<br/>
before it gets written)
<br/>
and after the display capture is done.
<br/>
<br/>
Bu that didn't work.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#136829 - tepples - Sun Aug 05, 2007 6:36 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yellowstar wrote:</b></span></td> </tr> <tr> <td class="quote">How do I take an screenshot of
<br/>
the sub screen, instead of the main screen?</td> </tr></table><span class="postbody">
<br/>
<a class="postlink" href="http://nocash.emubase.de/gbatek.htm#dsvideocaptureandmainmemorydisplaymode" target="_blank">"Capture is supported for Display Engine A only."</a>
<br/>
Copy the sub screen's contents (background registers, OAM, VRAM, palette) to the main screen and capture them from there.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137075 - yellowstar - Tue Aug 07, 2007 7:53 pm</h4>
    <div class="postbody"><span class="postbody">I am working on adding more features to my TGA loader.
<br/>
(bottom-left orgin, RLE compression, and color maps(palettes))
<br/>
<br/>
Right now I am working on adding the bottom-left orgin feature.
<br/>
<br/>
How would I implement RLE decompression
<br/>
in my loader?
<br/>
<br/>
In know what it <a class="postlink" href="http://en.wikipedia.org/wiki/Run-length_encoding" target="_blank">is.</a>
<br/>
<br/>
Right now,
<br/>
what I want to know is this:
<br/>
how is the numbers represented?(In the image,
<br/>
in a RLE compressed TGA)
<br/>
Bytes, or something else?
<br/>
(By numbers, I mean the numbers
<br/>
that say how much data(which is the same) is in a row.)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137156 - silent_code - Wed Aug 08, 2007 1:27 pm</h4>
    <div class="postbody"><span class="postbody">look for tga specs. there're some on the net, mostly with some code snippets. ;^)
<br/>
<br/>
like:
<br/>
<br/>
- <a class="postlink" href="http://netghost.narod.ru/gff/vendspec/tga/index.htm" target="_blank">http://netghost.narod.ru/gff/vendspec/tga/index.htm</a>
<br/>
- <a class="postlink" href="http://dmr.ath.cx/gfx/targa/" target="_blank">http://dmr.ath.cx/gfx/targa/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137164 - yellowstar - Wed Aug 08, 2007 2:55 pm</h4>
    <div class="postbody"><span class="postbody">I had a few documents about the TGA spec,
<br/>
but none of them had a section about the RLE compression.
<br/>
(And none of them were the official document.)
<br/>
<br/>
I have downloaded the spec from one of those links,
<br/>
and I am going to try to impement RLE decompression.
<br/>
<br/>
By the way,
<br/>
I have finished implementing the bottom-left orgin feature.
<br/>
It displays the image the right side up.
<br/>
That is, it displays the image like
<br/>
you would see it in an image editor/viewer.
<br/>
<br/>
<span style="font-weight: bold">EDIT:</span>
<br/>
<br/>
I have figured out what do about a
<br/>
bin viewer for a computer.
<br/>
<br/>
I could make a NDS program,
<br/>
which displays a bin file.
<br/>
<br/>
Then in an emulator,
<br/>
I could look at it,
<br/>
and if needed,
<br/>
take a screenshot of
<br/>
the screen which displays the bin file.(With everything else removed.)
<br/>
<br/>
<br/>
As for my TGA saver for screenshots: 
<br/>
The function which attempts to
<br/>
convert a color(RGB)
<br/>
to a 8 bit color,
<br/>
must be the problem.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137165 - silent_code - Wed Aug 08, 2007 3:07 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yellowstar wrote:</b></span></td> </tr> <tr> <td class="quote">The function which attempts to convert a color(RGB) to a 8 bit color</td> </tr></table><span class="postbody">
<br/>
??? 24bit -&gt; 8bit (why would you do that?) ??? 5bit -&gt; 8bit per component ???</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137168 - yellowstar - Wed Aug 08, 2007 3:15 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>silent_code wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yellowstar wrote:</b></span></td> </tr> <tr> <td class="quote">The function which attempts to convert a color(RGB) to a 8 bit color</td> </tr></table><span class="postbody">
<br/>
??? 24bit -&gt; 8bit (why would you do that?) ??? 5bit -&gt; 8bit per component ???</span></td> </tr></table><span class="postbody">
<br/>
<br/>
I meant the NDS 16 bit colors,
<br/>
and the RGB values inside them.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137178 - silent_code - Wed Aug 08, 2007 4:20 pm</h4>
    <div class="postbody"><span class="postbody">ok.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#137296 - yellowstar - Fri Aug 10, 2007 12:01 am</h4>
    <div class="postbody"><span class="postbody">I have finished implementing RLE
<br/>
decompression in my TGA loader.
<br/>
<br/>
Now the only things left I need to implement is black and white,
<br/>
and color maps.(palettes)
<br/>
I know black and white wouldn't be used much,
<br/>
but I am going to implement it anyway.
<br/>
<br/>
<span style="font-weight: bold">EDIT:</span>
<br/>
I have finished implementing grayscale,
<br/>
in my TGA loader.(black and white)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yellowstar wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
I have figured out what do about a
<br/>
bin viewer for a computer.
<br/>
<br/>
I could make a NDS program,
<br/>
which displays a bin file.
<br/>
<br/>
Then in an emulator,
<br/>
I could look at it,
<br/>
and if needed,
<br/>
take a screenshot of
<br/>
the screen which displays the bin file.(With everything else removed.)
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I have wrote this program.
<br/>
I have the makefile setup so
<br/>
that screenshot.bin on my card
<br/>
is copied to the data directory.
<br/>
This program displays that bin file.
<br/>
<br/>
That means to view a bin file on the computer,(256*192*2(u16))
<br/>
all I have to do is rename/copy the bin file to screenshot.bin
<br/>
in the root of my card,
<br/>
and build the program.
<br/>
Then I would run it in an emulator,
<br/>
then take the screenshot.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
