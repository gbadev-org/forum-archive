<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>sprite attribute 2 - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > sprite attribute 2</h2>
<div id="posts">
<div class="post">
    <h4>#41333 - wally - Wed Apr 27, 2005 6:17 pm</h4>
    <div class="postbody"><span class="postbody">How do you determine what attribute 2 should be.  I have 5 64x64 tiles, and I can't get them to all load properly.  I'm sure it's because I have the wrong number for attribute 2.  Could somebody tell me how to determine what this number should be.
<br/>
Thanks</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#41358 - tepples - Wed Apr 27, 2005 10:07 pm</h4>
    <div class="postbody"><span class="postbody">What did you not understand of the descriptions in the [url=http://www.cs.rit.edu/~tjh8300/CowBite/CowBiteSpec.htm#OAM%20(sprites)]CowBite spec[/url] and <a class="postlink" href="http://nocash.emubase.de/gbatek.htm#lcdobjoamattributes" target="_blank">GBATEK</a>?
<br/>
<br/>
(EDIT: those are GBA docs. Wally originally posted this topic in what is commonly understood as a GBA oriented forum.)
<br/>
<br/>
Could you please explain your problem with the five 64x64 pixel sprites in more detail? Do they use 16-color or 256-color cels?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"><br/><br/>Last edited by tepples on Thu Apr 28, 2005 12:20 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#41376 - wally - Wed Apr 27, 2005 11:22 pm</h4>
    <div class="postbody"><span class="postbody">I was looking at the drunken coders tutorial. There are 5 256 color 64x64 sprites.  I'm modifying a small demo, so I can figure out how to program for the gameboy. I have not been able to get sprite 5 to ever be displayed. It always shows up as a copy of one of the other ones.
<br/>
<br/>
<br/>
//Custom defines
<br/>
#define REG_VCOUNT *(vu16*)0x4000006		//Our good old vblank counter
<br/>
<br/>
//System includes
<br/>
#include &lt;NDS/NDS.h&gt;
<br/>
#include &lt;NDS/ARM9/rand.h&gt;
<br/>
<br/>
//Artwork includes
<br/>
#include "resources/pal.h"
<br/>
#include "resources/pac0.h"
<br/>
#include "resources/gh0.h"
<br/>
#include "resources/bg.h"
<br/>
<br/>
//-------------------------------------------------------------------
<br/>
<br/>
//OAM globals
<br/>
sSpriteEntry OAMCopy[128];
<br/>
sSpriteEntry OAMCopySub[128];
<br/>
<br/>
//Sprite structure
<br/>
typedef struct
<br/>
{
<br/>
	int x,y;	//location
<br/>
	int xSpeed, ySpeed;	//speed
<br/>
	sSpriteEntry* oam;
<br/>
}Sprite;
<br/>
<br/>
//-------------------------------------------------------------------
<br/>
<br/>
//Moves a sprite in OAM memory
<br/>
void MoveSprite(Sprite* sp)
<br/>
{
<br/>
	int x = sp-&gt;x &gt;&gt; 8;
<br/>
	int y = sp-&gt;y &gt;&gt; 8;
<br/>
<br/>
	sp-&gt;oam-&gt;attribute[1] &amp;= 0xFE00;
<br/>
	sp-&gt;oam-&gt;attribute[1] |= x;
<br/>
<br/>
	sp-&gt;oam-&gt;attribute[0] &amp;= 0xFF00;
<br/>
	sp-&gt;oam-&gt;attribute[0] |= y;
<br/>
<br/>
}
<br/>
//-------------------------------------------------------------------
<br/>
<br/>
 //Initializes the sprites
<br/>
void NextSprite(Sprite* sp, int number)
<br/>
{
<br/>
<br/>
		sp-&gt;x += sp-&gt;xSpeed;
<br/>
		sp-&gt;y += sp-&gt;ySpeed;
<br/>
		if(sp-&gt;x &lt; 256 || sp-&gt;x &gt; 61440) { sp-&gt;xSpeed=-sp-&gt;xSpeed; }
<br/>
		if(sp-&gt;y &lt; 256 || sp-&gt;y &gt; 45056) { sp-&gt;ySpeed=-sp-&gt;ySpeed; }
<br/>
<br/>
<br/>
}
<br/>
<br/>
//-------------------------------------------------------------------
<br/>
<br/>
 //Initializes the sprites
<br/>
void CreateSprite(Sprite* sp, int number)
<br/>
{
<br/>
	sp-&gt;x = ((5*number)&lt;&lt;10);
<br/>
	sp-&gt;y = ((5+number)&lt;&lt;10);
<br/>
   sp-&gt;xSpeed = (rand() &amp; (3&lt;&lt;6))+(1&lt;&lt;6);
<br/>
	sp-&gt;ySpeed = (rand() &amp; (3&lt;&lt;6))+(1&lt;&lt;6);
<br/>
	sp-&gt;oam = &amp;OAMCopy[number];
<br/>
<br/>
	sp-&gt;oam-&gt;attribute[0] = ATTR0_COLOR_256 | ATTR0_SQUARE;
<br/>
	sp-&gt;oam-&gt;attribute[1] = ATTR1_SIZE_64;
<br/>
	sp-&gt;oam-&gt;attribute[2] = 0;
<br/>
<br/>
<br/>
}
<br/>
<br/>
//-------------------------------------------------------------------
<br/>
<br/>
//Initialises OAM, moving all sprites offscreen
<br/>
void initOAM(void)
<br/>
{
<br/>
	int i;
<br/>
<br/>
	for(i = 0; i &lt; 128; i++)
<br/>
	{
<br/>
		OAMCopy[i].attribute[0] = ATTR0_DISABLED;
<br/>
		OAMCopySub[i].attribute[0] = ATTR0_DISABLED;
<br/>
	}	
<br/>
}
<br/>
<br/>
//-------------------------------------------------------------------
<br/>
<br/>
//Copies OAM buffer to actual OAM memory space
<br/>
void updateOAM(void)
<br/>
{
<br/>
	int i;
<br/>
<br/>
	for(i = 0; i &lt; 128 * sizeof(sSpriteEntry) / 4 ; i++)
<br/>
	{
<br/>
		((uint32*)OAM)[i] = ((uint32*)OAMCopy)[i];
<br/>
		((uint32*)OAM_SUB)[i] = ((uint32*)OAMCopySub)[i];
<br/>
	}
<br/>
}
<br/>
<br/>
//-------------------------------------------------------------------
<br/>
<br/>
//Entry point- this is where we start!
<br/>
int main(int argc, char ** argv) {
<br/>
<br/>
	int i=0, colourComponent=0;
<br/>
<br/>
	//turn on the power to the system
<br/>
	powerON(POWER_ALL);
<br/>
	videoSetMode( MODE_0_2D | DISPLAY_SPR_1D_LAYOUT | DISPLAY_SPR_ACTIVE | DISPLAY_BG0_ACTIVE );
<br/>
	videoSetModeSub( MODE_0_2D | DISPLAY_SPR_1D_LAYOUT | DISPLAY_SPR_ACTIVE | DISPLAY_BG0_ACTIVE );
<br/>
<br/>
	/*
<br/>
	VRAM_A_CR = VRAM_ENABLE | VRAM_ARM9 | VRAM_CORE_A;
<br/>
    VRAM_B_CR = VRAM_ENABLE | VRAM_ARM9 | VRAM_CORE_A;
<br/>
    VRAM_C_CR = VRAM_ENABLE | VRAM_ARM9 | VRAM_CORE_B;
<br/>
    VRAM_D_CR = VRAM_ENABLE | VRAM_ARM9 | VRAM_CORE_B;
<br/>
	vramSetMainBanks(VRAM_A_MAIN_BG,VRAM_B_MAIN_SPRITE,VRAM_C_SUB_BG,VRAM_D_SUB_SPRITE);
<br/>
	*/
<br/>
<br/>
	//Set screens to black initially
<br/>
	BG_PALETTE[0] = RGB15(0, 0, 0);		//Main screen
<br/>
	BG_PALETTE[512] = RGB15(0, 0, 0);		//Sub screen
<br/>
<br/>
<br/>
	Sprite sprites[128];
<br/>
	Sprite sprites_sub[128];
<br/>
	initOAM();
<br/>
<br/>
	//Setup heads
<br/>
   CreateSprite(&amp;sprites[0],0);
<br/>
   CreateSprite(&amp;sprites[1],1);
<br/>
   CreateSprite(&amp;sprites[2],2);
<br/>
   CreateSprite(&amp;sprites[3],3);
<br/>
   CreateSprite(&amp;sprites[4],4);
<br/>
<br/>
	sprites[0].oam-&gt;attribute[2] = 0;
<br/>
	sprites[1].oam-&gt;attribute[2] = 4096;
<br/>
	sprites[2].oam-&gt;attribute[2] = 8192;
<br/>
	sprites[3].oam-&gt;attribute[2] = 12288;     
<br/>
	sprites[4].oam-&gt;attribute[2] = 16384;
<br/>
<br/>
<br/>
	//Load palette and sprite data (main screen)
<br/>
	for(i=0; i&lt;512; i++) { SPRITE_PALETTE[i] = palPalette[i]; }
<br/>
	for(i=0; i&lt;8192; i++) { SPRITE_GFX[i] = pac0Data[i]; }
<br/>
	for(i=8193; i&lt;16384; i++) { SPRITE_GFX[i] = pac1Data[i-8193]; }
<br/>
	for(i=16385; i&lt;24576; i++) { SPRITE_GFX[i] = pac2Data[i-16385]; }
<br/>
	for(i=24577; i&lt;32768; i++) { SPRITE_GFX[i] = pac3Data[i-24577]; }
<br/>
	for(i=32769; i&lt;40960; i++) { SPRITE_GFX[i] = pac4Data[i-32769]; }
<br/>
<br/>
	//Setup top screen
<br/>
	sprites_sub[0].x = 8;
<br/>
	sprites_sub[0].y = 8;
<br/>
	sprites_sub[0].xSpeed = (8&lt;&lt;8);
<br/>
	sprites_sub[0].ySpeed = (1&lt;&lt;8);
<br/>
	sprites_sub[0].oam = &amp;OAMCopySub[0];
<br/>
<br/>
	sprites_sub[0].oam-&gt;attribute[0] = ATTR0_COLOR_256 | ATTR0_SQUARE;
<br/>
	sprites_sub[0].oam-&gt;attribute[1] = ATTR1_SIZE_64;
<br/>
	sprites_sub[0].oam-&gt;attribute[2] = 0;
<br/>
<br/>
	//Load palette and sprite data (sub screen)
<br/>
	for(i=0; i&lt;512; i++) { SPRITE_PALETTE_SUB[i] = palPalette[i]; }
<br/>
	for(i=0; i&lt;8192; i++) { SPRITE_GFX_SUB[i] = gh0Data[i]; }
<br/>
<br/>
<br/>
	//-------------------------------------------------------------------
<br/>
<br/>
	//Main game loop
<br/>
	bool exitFlag = false;
<br/>
	while (!exitFlag)
<br/>
	{
<br/>
		//Pulse screen colours (disco time!)
<br/>
		if (colourComponent &lt; 31) { colourComponent++; }
<br/>
		else { colourComponent = 0; }
<br/>
		PALETTE[0] = RGB15(colourComponent, 0, 0);
<br/>
		PALETTE[512] = RGB15(0, 0, 31-colourComponent);
<br/>
<br/>
<br/>
<br/>
		//Move heads
<br/>
<br/>
   	NextSprite(&amp;sprites[0],0);
<br/>
   	NextSprite(&amp;sprites[1],1);
<br/>
   	NextSprite(&amp;sprites[2],2);
<br/>
   	NextSprite(&amp;sprites[3],3);
<br/>
   	NextSprite(&amp;sprites[4],4);
<br/>
<br/>
		MoveSprite(&amp;sprites[0]);
<br/>
		MoveSprite(&amp;sprites[1]);
<br/>
		MoveSprite(&amp;sprites[2]);
<br/>
		MoveSprite(&amp;sprites[3]);
<br/>
	  	MoveSprite(&amp;sprites[4]);
<br/>
<br/>
<br/>
<br/>
<br/>
		//swiWaitForVBlank();
<br/>
		while(REG_VCOUNT != 190) {;}	
<br/>
<br/>
		updateOAM();
<br/>
	}
<br/>
<br/>
	return 0;
<br/>
}</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#41385 - tepples - Thu Apr 28, 2005 12:16 am</h4>
    <div class="postbody"><span class="postbody">"Beginners" is currently designated for the GBA platform. If you're on the Nintendo DS, I'll move it.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#41387 - wally - Thu Apr 28, 2005 12:38 am</h4>
    <div class="postbody"><span class="postbody">yes it is for the nintendo ds.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#41460 - wally - Thu Apr 28, 2005 7:05 pm</h4>
    <div class="postbody"><span class="postbody">Ok I finalyl figured it out.  Just in case anyone was curious.  It was over the 32k size limit.  So the first 4 objects were ok, then number 5 was out of range.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#41508 - FluBBa - Fri Apr 29, 2005 9:10 am</h4>
    <div class="postbody"><span class="postbody">64*64*5 = 20480?<br/>_________________<br/>I probably suck, my not is a programmer.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#41532 - Ethos - Fri Apr 29, 2005 2:58 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">for(i=0; i&lt;8192; i++) { SPRITE_GFX[i] = pac0Data[i]; } 
<br/>
for(i=8193; i&lt;16384; i++) { SPRITE_GFX[i] = pac1Data[i-8193]; } 
<br/>
for(i=16385; i&lt;24576; i++) { SPRITE_GFX[i] = pac2Data[i-16385]; } 
<br/>
for(i=24577; i&lt;32768; i++) { SPRITE_GFX[i] = pac3Data[i-24577]; } 
<br/>
for(i=32769; i&lt;40960; i++) { SPRITE_GFX[i] = pac4Data[i-32769]; } 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
64*64*2*5 &gt; 32k :)
<br/>
<br/>
I really suggest you do not use 64x64 sprites but a sprite made of of 8x8 pieces, it can save memory due to tile reuse :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#41553 - wally - Fri Apr 29, 2005 4:44 pm</h4>
    <div class="postbody"><span class="postbody">They are pictures of my kids the 3 sprites.  So I can't really make them smaller.  But I'll just put the 3 pics on that screen then.
<br/>
Thanks</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#41771 - FluBBa - Sun May 01, 2005 8:34 pm</h4>
    <div class="postbody"><span class="postbody">The VRAM on the DS is still 16bit only access or?<br/>_________________<br/>I probably suck, my not is a programmer.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#41812 - Ethos - Mon May 02, 2005 3:19 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>FluBBa wrote:</b></span></td> </tr> <tr> <td class="quote">The VRAM on the DS is still 16bit only access or?</td> </tr></table><span class="postbody">
<br/>
<br/>
Good question!
<br/>
<br/>
......now back to this odd odd odd code
<br/>
<br/>
I still don't understand any of this code...why is he doing all of these odd array copies?
<br/>
<br/>
Palette loop 
<br/>
for(i=0; i&lt;512; i++) { SPRITE_PALETTE[i] = palPalette[i]; } 
<br/>
should be i &lt; 256
<br/>
<br/>
the for loop after that should be....
<br/>
<br/>
for (i=0; i &lt; 64 * 32; i++).....
<br/>
<br/>
I think he is lucky anything is loaded!  (pac1Data must be addressed right after pac0Data, since that first four loop loads 4 sprites!!)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
