<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>I just want an example of file writing with FAT drivers - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > I just want an example of file writing with FAT drivers</h2>
<div id="posts">
<div class="post">
    <h4>#78658 - Globoeil - Sat Apr 08, 2006 6:27 pm</h4>
    <div class="postbody"><span class="postbody">Hi all
<br/>
Since one month I try to work on VGMDS (see it in PALIB projects section), I work with PALIB
<br/>
and I can't make a stable part of my program.
<br/>
So I really need your help.
<br/>
I just want something SIMPLE:
<br/>
<br/>
Can you paste me the source of a simple-simple code who just write a file with a name given by user (using keyboard).
<br/>
I've written the function to store char array from keyboard:
<br/>
<br/>
void readfromK(u8 maxsize,char* data){
<br/>
u 8i=0;
<br/>
PA_InitKeyboard(1);
<br/>
PA_KeyboardIn (27, 20);
<br/>
while(true) {
<br/>
tmpc=PA_CheckKeyboard();
<br/>
if(tmpc=='\n' || Pad.Held.A) break;
<br/>
if(data[0]!='\n') PA_OutputText(0,0,1,"%s! ",data);
<br/>
PA_EraseLastKey();
<br/>
if(tmpc!=0 &amp;&amp; tmpc!=PA_BACKSPACE &amp;&amp; i&lt;maxsize){ data[i]=tmpc;
<br/>
if(tmpc!=PA_SHIFT) i++;
<br/>
wait(5);}
<br/>
if(tmpc!=0 &amp;&amp; tmpc==PA_BACKSPACE &amp;&amp; i&gt;0) data[--i]='';
<br/>
}
<br/>
PA_KeyboardOut();
<br/>
}
<br/>
<br/>
<br/>
Now all that I want is the program with the main function, save function (readfromK function too, paste it).
<br/>
Thankfull for your help.
<br/>
What is simple for you will be really helpfull for me.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#78814 - josath - Sun Apr 09, 2006 11:54 pm</h4>
    <div class="postbody"><span class="postbody">I don't know what VGMDS, and you're going to have to give me a link, I'm not going to search for PALIB, find their projects section, then click on your app just to see what it is.
<br/>
<br/>
Here is some sample code. I didn't test it, but it should be correct. wherever I wrote // ERROR, it means something failed, you should print an error message to the user.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
char *filename = "testfile.txt"; // filename to save to 
<br/>
char *buffer = "This is a test string."; // data to save into the file
<br/>
int bufsize = strlen(buffer); // how much data to save
<br/>
<br/>
if(!FAT_InitFiles()) { // initialize the FAT library
<br/>
   // ERROR
<br/>
} else {
<br/>
   FAT_FILE *fp = FAT_fopen(filename, "w"); // open the file
<br/>
   if(!fp) {
<br/>
        // ERROR
<br/>
   } else {
<br/>
        int bytesWritten = FAT_fwrite(buffer, 1, bufsize, fp); // write the data
<br/>
        if(bytesWritten &lt; bufsize) {
<br/>
             // ERROR
<br/>
        }
<br/>
        FAT_fclose(fp); // close the file. DONT FORGET THIS OR DATA MAY BE LOST!
<br/>
   }
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
