<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>RAM and executable size - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > RAM and executable size</h2>
<div id="posts">
<div class="post">
    <h4>#62563 - Vich - Fri Dec 02, 2005 10:55 am</h4>
    <div class="postbody"><span class="postbody">Since the NDS has only got 4MB of RAM: does it always try to load the full executable or does it stream/buffer the parts of it that it needs?
<br/>
<br/>
And if so: Can you convert your game assets to a C++ header file and just attach them to your executable? (which might make the executable very large).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62583 - tepples - Fri Dec 02, 2005 6:22 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Vich wrote:</b></span></td> </tr> <tr> <td class="quote">Since the NDS has only got 4MB of RAM: does it always try to load the full executable or does it stream/buffer the parts of it that it needs?</td> </tr></table><span class="postbody">
<br/>
For WMB demos, the former. For games that need a DS card, the latter. For multiplayer games, either. When you boot a game from a DS card, or when you WMB a game's multiplayer client program, a .nds file is loaded into RAM. This .nds file can load other code or data into RAM by copying it from the DS card or by requesting it from the multiplayer server.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">And if so: Can you convert your game assets to a C++ header file</td> </tr></table><span class="postbody">
<br/>
You probably meant "convert your game assets to source code". Don't put data in header files, and don't put code in header files unless it's a static inline function or an inline method.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">and just attach them to your executable? (which might make the executable very large).</td> </tr></table><span class="postbody">
<br/>
Yes. You can use bin2s (which comes with devkitARM) to convert assets to assembly language files, which you can import into your program's ARM9 section. You can convert each asset separately, or you can toss them all into a GBFS file and convert them in one step.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62626 - Vich - Sat Dec 03, 2005 3:29 am</h4>
    <div class="postbody"><span class="postbody">I think I didn't formulate my question correct:
<br/>
I know when or when you can stream game assets, but what I don't know is if you can actually stream the executable code from a game cartridge.
<br/>
<br/>
About bin2s:
<br/>
Isn't it better to create 1 asset with it, that contains an archive like a ZIP-file? I've seen the GBFS members and the functionality seems really crappy.
<br/>
What does "s" in "bin2s" stand for? That it is stored in SRAM if it would be a regular commercial DS cartridge?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62630 - tepples - Sat Dec 03, 2005 5:24 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Vich wrote:</b></span></td> </tr> <tr> <td class="quote">I think I didn't formulate my question correct:
<br/>
I know when or when you can stream game assets, but what I don't know is if you can actually stream the executable code from a game cartridge.</td> </tr></table><span class="postbody">
<br/>
Executable code is just data. If you load another .nds file from the DS Game Card or the CF/SD card, then you can load executable code.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">About bin2s:
<br/>
Isn't it better to create 1 asset with it, that contains an archive like a ZIP-file?</td> </tr></table><span class="postbody">
<br/>
That's what GBFS is: an archive.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I've seen the GBFS members and the functionality seems really crappy.</td> </tr></table><span class="postbody">
<br/>
I don't really get what you're saying. What do you mean by "GBFS members" and what is "crappy" about them?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">What does "s" in "bin2s" stand for? That it is stored in SRAM if it would be a regular commercial DS cartridge?</td> </tr></table><span class="postbody">
<br/>
s == .s, the file name suffix for assembly language source code<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62635 - mymateo - Sat Dec 03, 2005 7:21 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Don't put data in header files, and don't put code in header files unless it's a static inline function or an inline method.</td> </tr></table><span class="postbody">
<br/>
<br/>
I understand that it's bad form to put that stuff in header files, but I've never really understood why.  Does it slow down the process of retrieving the information, make the resulting ROM larger, or what?  (Forgive my ignorance, everything I know about C/C++ I learned from others' source mostly)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62637 - DekuTree64 - Sat Dec 03, 2005 8:11 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>mymateo wrote:</b></span></td> </tr> <tr> <td class="quote">I understand that it's bad form to put that stuff in header files, but I've never really understood why.</td> </tr></table><span class="postbody">
<br/>
If your data is defined in the header, then every time you include that header in another file, it makes another copy of the data. If you put the data in a .c file, and only declare it as extern in the header, then you have a single copy that any file can reference.
<br/>
<br/>
Compiling large amounts of data as arrays is also insanely slow. I usually use .s files for their speed and simplicity (either straight numbers, or using .incbin to include raw data files), but GBFS is good too.
<br/>
<br/>
For small demos and things using .c arrays is fine though.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62640 - mymateo - Sat Dec 03, 2005 8:47 am</h4>
    <div class="postbody"><span class="postbody">Thanks, Deku.  I never thought of that, but it makes so much sense now.  You deserve a cookie.  Or a beer, if that's more to your liking.  :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62691 - Vich - Sun Dec 04, 2005 1:22 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Executable code is just data. If you load another .nds file from the DS Game Card or the CF/SD card, then you can load executable code.
<br/>
</td> </tr></table><span class="postbody">
<br/>
True, but that means that 1 big executable of - let's say - 20MB doesn't get streamed automatically when you run it?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">About bin2s:
<br/>
That's what GBFS is: an archive.
<br/>
[...]
<br/>
I don't really get what you're saying. What do you mean by "GBFS members" and what is "crappy" about them?
<br/>
</td> </tr></table><span class="postbody">
<br/>
I know it's something like an archive, but the way that it's build is not really user-friendly. If you would use something like a zip-archive, there is immediately a lot of functionality available to the programmer to handle the data that it contains.
<br/>
With GBFS members, I meant the functions like:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void gbfs_search_range(   u32 gbfs_1st_limit,
<br/>
                  u32 gbfs_2nd_start, u32 gbfs_2nd_limit,
<br/>
                  u32 gbfs_stride );
<br/>
<br/>
const GBFS_FILE * find_first_gbfs_file(const void *start);
<br/>
const void *skip_gbfs_file(const GBFS_FILE * file);
<br/>
const void *gbfs_get_obj(const GBFS_FILE *file,
<br/>
                         const char *name,
<br/>
                         u32 *len);
<br/>
const void *gbfs_get_nth_obj(GBFS_FILE const * file,
<br/>
                             size_t n,
<br/>
                             char *name,
<br/>
                             u32 *len);
<br/>
void *gbfs_copy_obj(void *dst,
<br/>
                    const GBFS_FILE *file,
<br/>
                    const char *name);
<br/>
size_t gbfs_count_objs(const GBFS_FILE *file);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
With "crappy", I meant that it seems very low-level to use. And thus not user(coder)-friendly.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62723 - agentq - Mon Dec 05, 2005 12:46 am</h4>
    <div class="postbody"><span class="postbody">We're programming directly to the hardware, and so nothing happens 'automatically'.  Memory is just one big block of RAM.  If you want to stream an executable you need to write the code to do that.
<br/>
<br/>
You may be able to use virtual memory to load only part of an executable under an OS like Windows.  But then PCs have hardware memory management and OS support which doesn't exist on the DS.
<br/>
<br/>
Gbfs works nicely as a simple way of getting some data into your program.  What sort of simpler API would you have liked to see?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62737 - tepples - Mon Dec 05, 2005 5:21 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Vich wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">That's what GBFS is: an archive.
<br/>
[...]
<br/>
I don't really get what you're saying. What do you mean by "GBFS members" and what is "crappy" about them?
<br/>
</td> </tr></table><span class="postbody">
<br/>
I know it's something like an archive, but the way that it's build is not really user-friendly.</span></td> </tr></table><span class="postbody">
<br/>
Using <a class="postlink" href="http://www.info-zip.org/Zip.html" target="_blank">Info-ZIP Zip</a>:
<br/>
zip file.zip foo.bin bar.chr baz.txt
<br/>
vs. using <a class="postlink" href="http://www.pineight.com/gba/#gbfs" target="_blank">GBFS</a>:
<br/>
gbfs file.gbfs foo.bin bar.chr baz.txt
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"> If you would use something like a zip-archive, there is immediately a lot of functionality available to the programmer to handle the data that it contains.</td> </tr></table><span class="postbody">
<br/>
Thing about .zip is that it uses compression, which would require a lot more memory and a lot more time to load assets (especially on the GBA, which was RAM constrained), and it wouldn't work so well for a zipfile that's included into a program that is loaded into RAM (.mb or .nds) because you have to compress things anyway.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
With GBFS members, I meant the functions like:
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void gbfs_search_range(   u32 gbfs_1st_limit,
<br/>
                  u32 gbfs_2nd_start, u32 gbfs_2nd_limit,
<br/>
                  u32 gbfs_stride );
<br/>
<br/>
const GBFS_FILE * find_first_gbfs_file(const void *start);
<br/>
const void *skip_gbfs_file(const GBFS_FILE * file);</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
Those are for appended GBFS, which is valid only in .mb, .gba, or ds.gba programs.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">const void *gbfs_get_obj(const GBFS_FILE *file,
<br/>
                         const char *name,
<br/>
                         u32 *len);
<br/>
const void *gbfs_get_nth_obj(GBFS_FILE const * file,
<br/>
                             size_t n,
<br/>
                             char *name,
<br/>
                             u32 *len);
<br/>
void *gbfs_copy_obj(void *dst,
<br/>
                    const GBFS_FILE *file,
<br/>
                    const char *name);
<br/>
size_t gbfs_count_objs(const GBFS_FILE *file);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
With "crappy", I meant that it seems very low-level to use. And thus not user(coder)-friendly.</span></td> </tr></table><span class="postbody">
<br/>
I don't know much about DS mode (hence the "GB" in GBFS), but loading a mode 3 image in GBA mode is as easy as this, once you've found the GBFS file:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">gbfs_copy_obj(VRAM, data, "title.mo3");</td> </tr></table><span class="postbody">
<br/>
As agentq said, what higher level APIs would you like to see built on these? If they're feasible, I might add them to a future version of GBFS.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62741 - Vich - Mon Dec 05, 2005 9:52 am</h4>
    <div class="postbody"><span class="postbody">tepples:
<br/>
What I'd like to see is that you could just use the iostream or FILE objects in respectively C and C++. As I understood folders wouldn't work, but that's not an issue. Then again, because of your info, I understand the API a bit better, thanks :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62788 - sajiimori - Mon Dec 05, 2005 7:18 pm</h4>
    <div class="postbody"><span class="postbody">It wouldn't be very hard to make an istream that reads from GBFS.  Why not try it out, Vich?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62789 - GPFerror - Mon Dec 05, 2005 7:19 pm</h4>
    <div class="postbody"><span class="postbody">iv just released a romdiskfs for the ds which has some stdio similair functions.
<br/>
<br/>
<a href="http://forum.gbadev.org/viewtopic.php?t=7695" target="_blank">http://forum.gbadev.org/viewtopic.php?t=7695</a>
<br/>
<br/>
Troy(GPF)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62839 - Vich - Tue Dec 06, 2005 9:43 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">It wouldn't be very hard to make an istream that reads from GBFS.  Why not try it out, Vich?</td> </tr></table><span class="postbody">
<br/>
<br/>
Hmmm good idea, but I'll probably go implement it in my streaming system, so it works with everything that uses my core library. 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>GPFerror wrote:</b></span></td> </tr> <tr> <td class="quote">iv just released a romdiskfs for the ds which has some stdio similair functions.
<br/>
<br/>
<a href="http://forum.gbadev.org/viewtopic.php?t=7695" target="_blank">http://forum.gbadev.org/viewtopic.php?t=7695</a>
<br/>
<br/>
Troy(GPF)</td> </tr></table><span class="postbody">
<br/>
<br/>
Thanks :)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
