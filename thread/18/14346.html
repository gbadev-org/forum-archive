<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Rotation scale text backgrounds - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Rotation scale text backgrounds</h2>
<div id="posts">
<div class="post">
    <h4>#143132 - Jim e - Wed Oct 17, 2007 5:45 am</h4>
    <div class="postbody"><span class="postbody">Right now I'm working on a project that needs at least 512 tiles and scaling for tile maps. Based off the example setting one up for the sub core worked, but when I tried for the main core it failed. I don't understand why.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include &lt;nds.h&gt;
<br/>
<br/>
<br/>
u16 mypal[] = {
<br/>
   RGB15(00,00,00),RGB15(31,00,00),
<br/>
   RGB15(00,31,00),RGB15(00,00,31),
<br/>
   RGB15(31,00,31),RGB15(31,31,00)
<br/>
};
<br/>
<br/>
//This code works for the sub core
<br/>
void Init_good() {
<br/>
   u32 i,x,y;
<br/>
   
<br/>
   //Set video modes and mem layout
<br/>
   videoSetModeSub(MODE_5_2D | DISPLAY_BG3_ACTIVE | DISPLAY_BG_EXT_PALETTE);   
<br/>
   vramSetBankC(VRAM_C_SUB_BG);
<br/>
   
<br/>
   // Control registers
<br/>
   SUB_BG3_CR = BG_TILE_BASE(1) | BG_MAP_BASE(0) | ROTBG_SIZE_256x256;
<br/>
   SUB_BG3_XDX = 1&lt;&lt;8;
<br/>
   SUB_BG3_XDY = 0;
<br/>
   SUB_BG3_YDX = 0;
<br/>
   SUB_BG3_YDY = 1&lt;&lt;8;
<br/>
<br/>
   //Make pointer for easy access
<br/>
   u16 (*sub_tile)[8][4] = (u16 (*)[8][4])CHAR_BASE_BLOCK_SUB(1);
<br/>
   u16 (*sub_map)[32] = (u16 (*)[32])SCREEN_BASE_BLOCK_SUB(0);
<br/>
<br/>
   //Make solid colored tiles
<br/>
   for(i = 0; i &lt; 4; i++) {
<br/>
      for(y=0;y&lt;8;y++) {
<br/>
         for(x=0;x&lt;4;x++) {
<br/>
            sub_tile[i][y][x] = (i+1)|((i+1)&lt;&lt;8);
<br/>
         }
<br/>
      }
<br/>
   }
<br/>
   
<br/>
   //Create a map of alternating tiles
<br/>
   for(y=0;y&lt;32;y++) {
<br/>
      for(x=0;x&lt;32;x++) {
<br/>
         sub_map[y][x] = (x^y)&amp;0x03;
<br/>
      }
<br/>
   }
<br/>
   
<br/>
   //Load Palette
<br/>
   vramSetBankH(VRAM_H_LCD); 
<br/>
   for(i = 0; i &lt; 6; i++) {
<br/>
      VRAM_H_EXT_PALETTE[3][0][i]= mypal[i];
<br/>
   }
<br/>
   vramSetBankH(VRAM_H_SUB_BG_EXT_PALETTE); 
<br/>
}
<br/>
<br/>
//This code does not work for the main core.
<br/>
void Init_test() {
<br/>
   u32 i,x,y;
<br/>
   
<br/>
   //Set video modes and mem layout
<br/>
   videoSetMode(MODE_5_2D | DISPLAY_BG3_ACTIVE | DISPLAY_BG_EXT_PALETTE);   
<br/>
   vramSetBankA(VRAM_A_MAIN_BG); 
<br/>
   
<br/>
   // Control registers
<br/>
   BG3_CR = BG_TILE_BASE(1) | BG_MAP_BASE(0) | ROTBG_SIZE_256x256;
<br/>
   BG3_XDX = 1&lt;&lt;8;
<br/>
   BG3_XDY = 0;
<br/>
   BG3_YDX = 0;
<br/>
   BG3_YDY = 1&lt;&lt;8;
<br/>
   
<br/>
   //Make pointer for easy access
<br/>
   u16 (*tile)[8][4] = (u16 (*)[8][4])CHAR_BASE_BLOCK(1);
<br/>
   u16 (*map)[32] = (u16 (*)[32])SCREEN_BASE_BLOCK(0);
<br/>
   
<br/>
   //Make solid colored tiles
<br/>
   for(i = 0; i &lt; 4; i++) {
<br/>
      for(y=0;y&lt;8;y++) {
<br/>
         for(x=0;x&lt;4;x++) {
<br/>
            tile[i][y][x] = (i+1)|((i+1)&lt;&lt;8);
<br/>
         }
<br/>
      }
<br/>
   }
<br/>
   
<br/>
   //create a map of alternating tiles
<br/>
   for(y=0;y&lt;32;y++) {
<br/>
      for(x=0;x&lt;32;x++) {
<br/>
         map[y][x] = (x^y)&amp;0x03;
<br/>
      }
<br/>
   }
<br/>
   
<br/>
   //Load Palette
<br/>
   vramSetBankG(VRAM_G_LCD); 
<br/>
   for(i = 0; i &lt; 6; i++) {
<br/>
      VRAM_G_EXT_PALETTE[3][0][i]= mypal[i];
<br/>
   }
<br/>
   vramSetBankG(VRAM_G_BG_EXT_PALETTE); 
<br/>
}
<br/>
<br/>
<br/>
int main(void) {
<br/>
   irqInit();
<br/>
   irqEnable(IRQ_VBLANK);
<br/>
<br/>
   Init_good();
<br/>
   Init_test();
<br/>
<br/>
   int scrollX = 0;
<br/>
   int scrollY = 0;
<br/>
   int scaleX = 1&lt;&lt;8;
<br/>
   int scaleY = 1&lt;&lt;8;
<br/>
   while(1) {
<br/>
      scanKeys();
<br/>
      u32 keys = keysHeld();
<br/>
      if ( keys &amp; KEY_LEFT ) scrollX++;
<br/>
      if ( keys &amp; KEY_RIGHT ) scrollX--;
<br/>
      if ( keys &amp; KEY_UP ) scrollY++;
<br/>
      if ( keys &amp; KEY_DOWN ) scrollY--;
<br/>
      if ( keys &amp; KEY_A ) scaleX++;
<br/>
      if ( keys &amp; KEY_Y ) scaleX--;
<br/>
      if ( keys &amp; KEY_X ) scaleY++;
<br/>
      if ( keys &amp; KEY_B ) scaleY--;
<br/>
      swiWaitForVBlank();
<br/>
      SUB_BG3_CX = scrollX&lt;&lt;7;
<br/>
      SUB_BG3_CY = scrollY&lt;&lt;7;
<br/>
      SUB_BG3_XDX = scaleX;
<br/>
      SUB_BG3_YDY = scaleY;
<br/>
      BG3_CX = scrollX&lt;&lt;7;
<br/>
      BG3_CY = scrollY&lt;&lt;7;
<br/>
      BG3_XDX = scaleX;
<br/>
      BG3_YDY = scaleY;
<br/>
   }
<br/>
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I know I could switch the core to render to the top LCD, but I wanted the main core to render the map because it has a bit more room for sprites and an easier memory layout.
<br/>
<br/>
Is there some trick that I don't know? Or is some limiting detail?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143137 - Jim e - Wed Oct 17, 2007 7:16 am</h4>
    <div class="postbody"><span class="postbody">Oh well now I feel like an idiot.  Bank G isn't large enough for the entire extended palette. Had I just done the math I would have realized that sooner. Funny thing is I tried bank F earlier today to no avail as well.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
