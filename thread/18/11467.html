<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>touchReadXY() locks nds - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > touchReadXY() locks nds</h2>
<div id="posts">
<div class="post">
    <h4>#106338 - dak - Wed Oct 18, 2006 12:38 am</h4>
    <div class="postbody"><span class="postbody">Hi, whenever I try to retrieve the screen coordinates via touchReadXY(), the app simply locks up completely.  Has anyone come upon this weirdness at all?
<br/>
<br/>
-dak</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106369 - smsisko - Wed Oct 18, 2006 12:36 pm</h4>
    <div class="postbody"><span class="postbody">I'm not sure if it applies, but when my code locks-up the ds, it is usually a stack problem, try to use the heap more.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106378 - Lick - Wed Oct 18, 2006 2:49 pm</h4>
    <div class="postbody"><span class="postbody">Show us the code!<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106416 - dak - Wed Oct 18, 2006 8:41 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
int main(void) {
<br/>
//---------------------------------------------------------------------------------
<br/>
   //Set initial DS states
<br/>
   powerON(POWER_ALL);
<br/>
   
<br/>
   //set irqs
<br/>
   irqInit();
<br/>
   irqEnable(IRQ_VBLANK);
<br/>
   
<br/>
   //set bottom screen for console
<br/>
   videoSetModeSub(MODE_0_2D | DISPLAY_BG0_ACTIVE);
<br/>
   vramSetBankC(VRAM_C_SUB_BG);
<br/>
   SUB_BG0_CR = BG_MAP_BASE(31);
<br/>
   BG_PALETTE_SUB[255] = RGB15(31,31,31);
<br/>
   consoleInitDefault((u16*)SCREEN_BASE_BLOCK_SUB(31), (u16*)CHAR_BASE_BLOCK_SUB(0), 16);
<br/>
   
<br/>
   //set GL
<br/>
   //init_OGL();
<br/>
   
<br/>
   //--- Init FAT system ---
<br/>
   //FAT_InitFiles();
<br/>
   //swiWaitForVBlank();
<br/>
   //swiWaitForVBlank();
<br/>
   //-----------------------
<br/>
   
<br/>
   //Create and initialize game engine
<br/>
   //iamEngine *gEngine = new iamEngine();
<br/>
   
<br/>
   //Swap screens
<br/>
   //lcdSwap();
<br/>
   
<br/>
   touchPosition a;
<br/>
   
<br/>
   while(1) {
<br/>
      printf("\x1b[10;0H");
<br/>
      printf("IAM3ds Game Engine\nBy Barry LaVergne\n");
<br/>
      //printf("\nCamera Position:\n[%3f, %3f, %3f]", f32tofloat(cam-&gt;pos.x), f32tofloat(cam-&gt;pos.y), f32tofloat(cam-&gt;pos.z));
<br/>
      
<br/>
      //gEngine-&gt;GameCycle();
<br/>
      
<br/>
      scanKeys();
<br/>
      
<br/>
      if (keysHeld() &amp; KEY_TOUCH) {
<br/>
         printf("snort1 \n");
<br/>
         a = touchReadXY();
<br/>
         printf("snort2 \n");
<br/>
      }
<br/>
      printf("\x1b[5;0H");
<br/>
      printf("(%d, %d)              \n", a.px, a.py);
<br/>
   }
<br/>
<br/>
   return 0;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
This is my code with all game specific lines commented out to be a barebones app.  The second I try to run touchReadXY();, the whole DS just freezes.  Is there any more initialization that I'm missing?
<br/>
<br/>
-dak</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106423 - Lick - Wed Oct 18, 2006 9:36 pm</h4>
    <div class="postbody"><span class="postbody">You should put a swiWaitForVBlank(); at the end of the mainloop. Probably won't fix it though.<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106429 - dak - Wed Oct 18, 2006 10:11 pm</h4>
    <div class="postbody"><span class="postbody">I actually call it within the game engine, but this particular problem doesnt seem to be associated with the call either way.  :$</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106464 - josath - Thu Oct 19, 2006 10:16 am</h4>
    <div class="postbody"><span class="postbody">are you using IPC-&gt;mailBusy in any way? in my copy of libnds, touchReadXY has this code:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">        while (IPC-&gt;mailBusy);</td> </tr></table><span class="postbody">
<br/>
So, if you have set mailBusy to a non-zero value, it will wait there forever until you unset it (which in this case would have to be on the arm7).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106490 - wintermute - Thu Oct 19, 2006 5:58 pm</h4>
    <div class="postbody"><span class="postbody">That would seem to indicate a problem with the arm7 code, either due to your modifications or the method you're using to run the nds.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106599 - dak - Sat Oct 21, 2006 6:28 am</h4>
    <div class="postbody"><span class="postbody">Got it; it was indeed a modified arm7 file from when I was toying with wireless XD
<br/>
<br/>
Thanks for all the help!</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
