<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>My first DS demo! - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > My first DS demo!</h2>
<div id="posts">
<div class="post">
    <h4>#39483 - FeaRog - Sat Apr 09, 2005 4:21 pm</h4>
    <div class="postbody"><span class="postbody">Hi all,
<br/>
 I've been working like a madman since I got my PassMe (about 28 hours ago now), reasonably steep learning curve, but here's what I've come up with. I'll release the source once I've tidied it up a bit - its not terribly readable at the moment.
<br/>
<br/>
I think I'm running out of texture memory, you notice it on the later models. Theres a few bugs on the texturing of the 3rd model.
<br/>
<br/>
This sort of works on the IdeaS emulator, but not very well. It has z-buffer issues, texture changing doesn't work properly, and the SELECT button doesn't seem to work at all. For full effect, run it on real hardware with the PassMe :)
<br/>
<br/>
Controls:
<br/>
Touchscreen/D-pad = rotate
<br/>
A/B = zoom in/out
<br/>
Select = change model
<br/>
<br/>
You can get it here:
<br/>
<a class="postlink" href="http://www.geocities.com/codefiend.geo/viewer.zip" target="_blank">http://www.geocities.com/codefiend.geo/viewer.zip</a>
<br/>
<br/>
I'm pretty stoked with what I've done so far :D
<br/>
<br/>
Enjoy!
<br/>
<br/>
FeaRog</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39493 - Lino - Sat Apr 09, 2005 7:04 pm</h4>
    <div class="postbody"><span class="postbody">This is the image with my version of iDeaS...
<br/>
<br/>
<br/>
<a class="postlink" href="http://ideasemu.altervista.org" target="_blank">http://ideasemu.altervista.org</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39494 - FeaRog - Sat Apr 09, 2005 7:14 pm</h4>
    <div class="postbody"><span class="postbody">Yep - try rotating the player around and you notice that you can see his gun through his body, among other artefacts.
<br/>
<br/>
Note that this doesn't run on any of the other emulators.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39501 - ecurtz - Sat Apr 09, 2005 7:40 pm</h4>
    <div class="postbody"><span class="postbody">Looks great.
<br/>
<br/>
I just got 256 color textures working for my version of a md2 converter this morning. PM me for details of the fixes I had to make if you're interested, it might help with your texture issues. (Or just wait for them to get into ndsLib, I already sent the details to dovoto, and he's pretty on the ball about making fixes.)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39524 - dovoto - Sun Apr 10, 2005 12:27 am</h4>
    <div class="postbody"><span class="postbody">That looks great!  256 color textures should make a big difference in memory usage.  I updated the CVS with the fix (although it will only work for a single palette and even that is untested).  
<br/>
<br/>
Also you may want to call:
<br/>
void glResetTextures(void);
<br/>
<br/>
in between each model and reload the textures. This should reset texture memory.  My texture stuff is very untested so any feedback is definitly welcome.  I also uploaded the fix to the bugs you noticed ecurtz.  They are in CVS (takes a few hours to propigate).<br/>_________________<br/><a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39538 - Lynx - Sun Apr 10, 2005 2:23 am</h4>
    <div class="postbody"><span class="postbody">Very nice!  Looks good on hardware to me!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39552 - zazery - Sun Apr 10, 2005 6:03 am</h4>
    <div class="postbody"><span class="postbody">Looks really cool on the hardware. The screens are reversed on my DS if the iDeas screenshot is supposed to be how it looks. The model is on the top screen and the text on the bottom.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39553 - FeaRog - Sun Apr 10, 2005 6:36 am</h4>
    <div class="postbody"><span class="postbody">Thanks for the positive feedback guys :)
<br/>
<br/>
Dovoto - I've just updated my ndslib, and started to play with display lists.
<br/>
<br/>
I've found that I had to replace the following macros in videoGL.h:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define FIFO_*            REG2ID(GFX_*)</td> </tr></table><span class="postbody">
<br/>
with 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define FIFO_*            REG2ID(&amp;GFX_*)</td> </tr></table><span class="postbody">
<br/>
for it to operate.
<br/>
<br/>
I also haven't been able to get the glCallList() function to work; I have played with the DMA control flags for it and can't seem to get anything to happen. Instead I'm using:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void glCallList2(uint32* list)
<br/>
{
<br/>
   uint32 wordcount = *(list++);
<br/>
   while( wordcount-- )
<br/>
      GFX_FIFO = *(list++);
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
Which works fine on hardware, but not in iDeaS. 
<br/>
<br/>
Another thing I discovered: the console printing commands have a problem that they don't print any zeros in a number until the last one.  Eg </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">consolePrintf("0x%x", 0x4000400);</td> </tr></table><span class="postbody"> prints 0x440. Heres my fixed version of printx for reference - they all seem to need fixing like this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void printx(int w, unsigned int d)
<br/>
{
<br/>
   int loop = 0;
<br/>
   int i = 0;
<br/>
   
<br/>
   char buf[20] = {0};
<br/>
<br/>
   while(d &gt; 0)
<br/>
   {
<br/>
      buf[loop++] =  d &amp; 0xF;
<br/>
      d = d&gt;&gt;4; 
<br/>
   }
<br/>
   
<br/>
   int started = 0;
<br/>
   for (i = 7; i &gt;= 0; i--)
<br/>
   {
<br/>
      if (buf[i])
<br/>
         started = 1;
<br/>
<br/>
      if(started)
<br/>
      {
<br/>
         if(buf[i] &lt; 10)
<br/>
            consolePrintChar(buf[i] + '0');
<br/>
         else
<br/>
            consolePrintChar(buf[i] + 'a' - 10);
<br/>
      }
<br/>
      else if(i &lt; w)
<br/>
         consolePrintChar('0');
<br/>
   }
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
And yet another thing! I hadn't done a clean rebuild of ndslib prior to fixing that console bug, and now that I've done one I find that my viewer doesn't run in iDeaS at all, and neither does the 3D example. They still work fine in hardware. Unfortunately I don't know precisely when it stopped working so I can't revert. 
<br/>
<br/>
ecurtz - what format is the palette in on the 256 colour textures? 5551 like the RGBA format?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39558 - FeaRog - Sun Apr 10, 2005 7:03 am</h4>
    <div class="postbody"><span class="postbody">Model on the top screen is how it is meant to appear zazery - I'm guessing that Lino has reversed them in his version of the emulator.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39559 - ecurtz - Sun Apr 10, 2005 7:10 am</h4>
    <div class="postbody"><span class="postbody">Palette is the same format as a regular 555 pixel. It seems to ignore the alpha bit.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39561 - LOUD NOISES - Sun Apr 10, 2005 7:22 am</h4>
    <div class="postbody"><span class="postbody">How exactly are you guys getting this to run on iDeaS? All I get is a black screen, although the textured cube demo seemed to work...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39562 - FeaRog - Sun Apr 10, 2005 7:37 am</h4>
    <div class="postbody"><span class="postbody">It won't run off the .nds file in iDeaS (not in the version I have anyway), and I don't have an emulator friendly arm9.bin for you, as it doesn't seem to work with the latest version of ndslib... Lino has all the source and he's working on the compatibility issues, so you might be able to try it in the emu in a few days (fingers crossed) :)
<br/>
<br/>
I'm still planning on releasing the source code, but maybe once I've got display lists and paletted textures happening... too busy messing around to clean things up at the moment :D This is one fun little doodad!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39564 - garlic - Sun Apr 10, 2005 7:40 am</h4>
    <div class="postbody"><span class="postbody">iDeaS seems to reverse the screens on the code i've tried as well.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39610 - dovoto - Sun Apr 10, 2005 7:08 pm</h4>
    <div class="postbody"><span class="postbody">Fixed the fifo display list comands.  Fixed console functions.  Added a few fifo comands.  Display lists seem to have issues with DMA.  Works fine on longer lists but not realy on short display lists...for now i will leave the code as a while loop for compatibility and try to figure out the limitations on DMA as that is were the real power will come from.<br/>_________________<br/><a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39655 - FeaRog - Mon Apr 11, 2005 2:34 am</h4>
    <div class="postbody"><span class="postbody">Based on my tests I'd say that the FIFO can handle a maximum list length of 16k - a 15k list (Quake ogre) worked fine, but 19k (Quake player) did not. I haven't exhaustively tested the minimum size yet, but I intend to. I'll probably generate a bunch of lists with different numbers of triangles and test them one by one. My best guess at this stage is that there is some sort of buffer between the DMA and the FIFO, and that the data doesn't reach the FIFO until that buffer is filled.
<br/>
Once we know more about the size limits (if there is one, ie if we're not missing something) we could add a check to glCallList: 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void glCallList(uint32* list)
<br/>
{
<br/>
    if (size &lt; minSize) 
<br/>
        glCallListLoop(list);
<br/>
    else
<br/>
        glCallListDMA(list);
<br/>
}</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39683 - mike260 - Mon Apr 11, 2005 1:03 pm</h4>
    <div class="postbody"><span class="postbody">Hmm...it's been a while, but I think Metroid's DMA-&gt;FIFO code splits DMAs into chunks of around 512 bytes or less. IIRC, the code is in the ITCM section, which is right at the end of the ARM9 bin.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
