<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>NDS MegaDrive/Genesis emulator first pass - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > NDS MegaDrive/Genesis emulator first pass</h2>
<div id="posts">
<div class="post">
    <h4>#69241 - bananaboy - Sun Jan 29, 2006 3:44 pm</h4>
    <div class="postbody"><span class="postbody">Hi folks,
<br/>
<br/>
I've ported <a class="postlink" href="http://cgfm2.emuviews.com/index.php" target="_blank">Charles MacDonald's</a> Genesis Plus emulator to the DS!  It currently runs very slowly (about 1 frame per second) and doesn't make use of any specialised DS hardware apart from the palette and the hardware scaling.
<br/>
<br/>
It's available here:
<br/>
<a class="postlink" href="http://www.humbug.net/gpnds.zip" target="_blank">http://www.humbug.net/gpnds.zip</a>
<br/>
<br/>
It renders the MD screen to a 512x256 extended rotation bitmap in mode 3 and uses hardware scaling to scale it to fit the DS screen.
<br/>
<br/>
Source is included (in fact, there is only source, no binary).  It uses devkitpro.  I also created a VS.NET 2003 project file (which just runs make).  gpnds can be compiled to use a statically linked in GBFS filesystem, or a single statically linked in rom image (converted using bin2s).  No roms are included in this archive!  Sound is untested/unimplemented (and #ifdefed out by default).
<br/>
<br/>
This is just a sort of first pass release.  I'm not sure if I've got the energy to port this to use the actual DS hardware (which would result in huge speed increases) so I'm putting it out there in case anyone is interested in toying with it.  As it stands, it's really not playable, so this is really just a demonstration, I guess.
<br/>
<br/>
Here is a quick how-to from the readme.txt:
<br/>
<br/>
1. Copy a smd or bin file to the root directory of gpnds.
<br/>
<br/>
2. If it's an smd file, run:
<br/>
      grom\grom -bin filename.smd
<br/>
   to convert it to a raw image.
<br/>
<br/>
3. Run:
<br/>
      swap filename.bin rom.bin
<br/>
   to swap the byte order of the bin file (there was code in the original
<br/>
   genesis plus to do this at load time, however, I wanted to remove as
<br/>
   many static arrays as possible).
<br/>
<br/>
4. Run:
<br/>
      bin2s rom.bin &gt; gp/rom.s
<br/>
   to create the data file.
<br/>
<br/>
5. Run:
<br/>
      make
<br/>
<br/>
5. Make sure the entire thing isn't over 4Mb! :)  Copy the .ds.gba file to
<br/>
   your flash card (or use whatever method you are familiar with for running
<br/>
   homebrew).
<br/>
<br/>
Keys are:
<br/>
<br/>
NDS d-pad maps to megadrive d-pad
<br/>
NDS x, b, a map to megadrive a, b, c 
<br/>
NDS start maps to megadrive start
<br/>
NDS select resets the emulator
<br/>
<br/>
--------------
<br/>
<br/>
Any questions, don't hesitate to post!
<br/>
<br/>
cheers
<br/>
sam</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#69258 - Sicon - Sun Jan 29, 2006 5:40 pm</h4>
    <div class="postbody"><span class="postbody">Very nice, it works though slowly. Keep up the good work it would be cool to see it running full speed with sound. :)<br/>_________________<br/><a href="http://www.fullsail.edu/" target="_blank">http://www.fullsail.edu/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#69265 - Barnard - Sun Jan 29, 2006 6:36 pm</h4>
    <div class="postbody"><span class="postbody">I'm stuck on step four, I don't understand what the Bin2s means and the bat file can't find the make.exe.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#69277 - Sicon - Sun Jan 29, 2006 7:22 pm</h4>
    <div class="postbody"><span class="postbody">if you have devkitpro installed you should be able to find bin2s in the devkitpro\devkitarm\bin folder. the syntax to use the program is.. </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">bin2s yourrom.bin &gt; rom.s</td> </tr></table><span class="postbody">
<br/>
<br/>
then replace the rom.s file in the gp folder and compile.<br/>_________________<br/><a href="http://www.fullsail.edu/" target="_blank">http://www.fullsail.edu/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#69440 - Wraggster - Mon Jan 30, 2006 8:08 pm</h4>
    <div class="postbody"><span class="postbody">anyone else getting a corrupt zipfile ?
<br/>
<br/>
it still opens but with errors ?<br/>_________________<br/>Webmaster of Nintendo DS Emulation News
<br/>
<br/>
<a href="http://nintendo-ds.dcemu.co.uk" target="_blank">http://nintendo-ds.dcemu.co.uk</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#69477 - Normmatt - Tue Jan 31, 2006 12:34 am</h4>
    <div class="postbody"><span class="postbody">yeah that happened the first few times but after a few trys it downloaded and worked good</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#69508 - bananaboy - Tue Jan 31, 2006 4:31 am</h4>
    <div class="postbody"><span class="postbody">Hm strange, I don't know why it would be corrupt.. Just downloaded it at work and it was fine.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#69510 - Darkflame - Tue Jan 31, 2006 4:41 am</h4>
    <div class="postbody"><span class="postbody">Its fantastic to see someone finaly working on this :)
<br/>
<br/>
Nes emulators are perfect.
<br/>
And playing Sonic on the SMS emulator is pretty nice.
<br/>
<br/>
But <span style="font-style: italic">nothing</span> would compare to having a MegaDrive emulator :D
<br/>
<br/>
Of course, I understand its very early days. I am just glade someone has at least got this far!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#69547 - TheChuckster - Tue Jan 31, 2006 1:00 pm</h4>
    <div class="postbody"><span class="postbody">It wouldn't be possible to rewrite the bits of graphics code that say draw sprites or tiles or manipulate the palette, and then convert them to directly use NDSlib? This gave StellaDS a huge speed up.
<br/>
<br/>
The hard part will be doing anything much more than that without knowing ARM ASM really well. I mean it's one thing to rewrite the whole CPU emulator in Assembly but if you don't know all of the idiosyncracies of the RISC instruction set, your code is going to be no where near optimized. Which means it will be just as fast as the C code.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#69552 - bananaboy - Tue Jan 31, 2006 1:40 pm</h4>
    <div class="postbody"><span class="postbody">Well that's the idea: to map the Genesis hardware to the DS hardware.  So any sprite code, instead of being emulated, would be redirected to poke bytes into the DS sprite hardware.  However, this looks to be a bit of a challenge :).
<br/>
<br/>
I don't think re-writing the emulator in 100% seriously optimised ARM assembly language would make it playable.  It might improve the speed by 10 or 20 percent but I think the real improvement would come from mapping the hardware.
<br/>
<br/>
Is that what StellaDS does?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#69573 - souLLy - Tue Jan 31, 2006 4:13 pm</h4>
    <div class="postbody"><span class="postbody">Great stuff, I'd love to see what this could become with more development time, good job</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#69628 - FluBBa - Tue Jan 31, 2006 9:30 pm</h4>
    <div class="postbody"><span class="postbody">bananboy: Have you checked <a class="postlink" href="http://www.finalburn.com/mobile/index.html" target="_blank">Cyclone 68000</a>?<br/>_________________<br/>I probably suck, my not is a programmer.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#69633 - nmain - Tue Jan 31, 2006 9:44 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>bananaboy wrote:</b></span></td> </tr> <tr> <td class="quote">Well that's the idea: to map the Genesis hardware to the DS hardware.  So any sprite code, instead of being emulated, would be redirected to poke bytes into the DS sprite hardware.  However, this looks to be a bit of a challenge :).
<br/>
<br/>
I don't think re-writing the emulator in 100% seriously optimised ARM assembly language would make it playable.  It might improve the speed by 10 or 20 percent but I think the real improvement would come from mapping the hardware.
<br/>
<br/>
Is that what StellaDS does?</td> </tr></table><span class="postbody">
<br/>
<br/>
Before you jump off a bridge, profile it; figure out what % of cpu time is used for all main cpu emulation, and what % is used for the gpu rendering.  No reason not to be sure; maybe the cpu emulation is taking up more time than you think.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#69641 - TheChuckster - Tue Jan 31, 2006 10:20 pm</h4>
    <div class="postbody"><span class="postbody">Yeah, I still have my CPU core as a straight port from Stella for PC. Then again, I have more leeway since I'm only emulating a 1.19 mhz 6502 variant. :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#69673 - justatest - Wed Feb 01, 2006 2:47 am</h4>
    <div class="postbody"><span class="postbody">Nice one!
<br/>
<br/>
So... how are you actually doing this? Just curious.. taking a wild guess (as a complete noob) i'd say that you're actually parsing the Genesis binary and detecting when calls are made to sprite/palette/background memory etc. Then you're translating them calls to DS specific code.
<br/>
<br/>
I'm probably awefully wrong though...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#69681 - bananaboy - Wed Feb 01, 2006 4:22 am</h4>
    <div class="postbody"><span class="postbody">justatest: No, it doesn't do anything like that.  It emulates the Genesis entirely in software and then draws to a frame buffer (this was mentioned a couple of posts above :)).
<br/>
<br/>
flubba: Thanks!  I'll check that out!  It might just be perfect!  In fact, maybe that pico emulator would be a better code base to port than Genesis Plus!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#69699 - FluBBa - Wed Feb 01, 2006 10:08 am</h4>
    <div class="postbody"><span class="postbody">There are some bugs  in the 68k core though, Reesy fixed some of them in his DrMD emulator for the GP32/2X, so might want to contact him as well.<br/>_________________<br/>I probably suck, my not is a programmer.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#69709 - thehive - Wed Feb 01, 2006 1:45 pm</h4>
    <div class="postbody"><span class="postbody">I think notaz fixed a wad too.
<br/>
And I could swear that Reesy mentioned to me that he was porting DrMD to the DS. I could be mistaken though.
<br/>
Not sure that the DS is very capable of full speed emulation of both 68000 and Z80 cores, but who knows?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#69715 - tepples - Wed Feb 01, 2006 2:41 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>thehive wrote:</b></span></td> </tr> <tr> <td class="quote">Not sure that the DS is very capable of full speed emulation of both 68000 and Z80 cores, but who knows?</td> </tr></table><span class="postbody">
<br/>
Z80 can probably be handled on the ARM7 if Goomba Color is any indication. This leaves emulation of an 8 MHz MC68000 on a 67 MHz ARM9, and because the MC68000 is microcoded and not pipelined, it takes several cycles to do one instruction.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#70010 - darthtron - Fri Feb 03, 2006 6:55 pm</h4>
    <div class="postbody"><span class="postbody">this came from the PIRACY-DOT-COM boards:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HtheB wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Koji wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HtheB wrote:</b></span></td> </tr> <tr> <td class="quote">Will there be a Genesis emu for the DS or GBA?  :oops: 
<br/>
<br/>
<a href="http://liranuna.drunkencoders.com" target="_blank">http://liranuna.drunkencoders.com</a> was working on it.. but he failed :(
<br/>
<br/>
there are awsome games on the genesis :)</td> </tr></table><span class="postbody">
<br/>
<br/>
Try rereading it... especialy </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"> This had been a long month - i got alot of emails requesting me to give betas
<br/>
of Egga - my Genesis emulator for the DS. Unfourtunatly - i can't give anyone
<br/>
anything, as the latest devkit, devkitARM r17, is making Egga to show nothing then
<br/>
a black screen and output noisy sound.</td> </tr></table><span class="postbody">
<br/>
<br/>
He hasn't failed anything. He's just having a problem getting it to work with the latest devkit. I really wouldn't expect to much though even if he did release it.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
(I know that... that  after the update, it didnt work anymore)
<br/>
But I had a chat with him and he said that he stopped making the emu..... :(</span></td> </tr></table><span class="postbody">
<br/>
<br/>
maybe we could get lira Nuna to let bananaboy take a look at his source code to "egga" and see if that would help him imporove "gpnds" by figuring out the the good and the bad from egga such as why caused it not to compile and work (one of the bads), maybe he could use that has his bases or maybe atleast use it as "insporation"
<br/>
<br/>
what do you all think</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#70025 - LiraNuna - Fri Feb 03, 2006 8:38 pm</h4>
    <div class="postbody"><span class="postbody">Egga doesn't work anymore - devkitPro r17 makes it compile into a blackscrens binary with strage buzz sound.
<br/>
<br/>
i did got it working a few days ago - now it shows garbage (atleast something!)
<br/>
<br/>
i got higher priorities projects now (like my RPG) so it's on halt.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#70155 - LunarCrisis - Sat Feb 04, 2006 7:47 pm</h4>
    <div class="postbody"><span class="postbody">I played around with this a bit, and timed a couple of things in-game in sonic 1:
<br/>
9 seconds game time == 57 seconds real time with frameskip off
<br/>
9 seconds game time == 31 seconds real time with frameskip set to 10
<br/>
(I had to fix frameskipping first though, since it wasn't doing anything initially)
<br/>
<br/>
It seems that rendering is only taking about half the time, so while using the display hardware might up to double the speed, it would still be too slow to run at full speed. =(<br/>_________________<br/>If a tree falls in the forest and no one is there to hear it, why the heck do you care?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#70184 - gladius - Sat Feb 04, 2006 10:01 pm</h4>
    <div class="postbody"><span class="postbody">Don't underestimate the speed boost that can be had by (a) using both processors and (b) handcoded assembly cpu cores.  Course the only problem with that is it is a collosal amount of work :).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#70185 - LiraNuna - Sat Feb 04, 2006 10:03 pm</h4>
    <div class="postbody"><span class="postbody">Instead of using evil framebuffer, use the power of HW. like i (did) with egga.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#79396 - HtheB - Thu Apr 13, 2006 12:06 pm</h4>
    <div class="postbody"><span class="postbody">how is the process going? :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#79409 - tepples - Thu Apr 13, 2006 1:03 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>LiraNuna wrote:</b></span></td> </tr> <tr> <td class="quote">Instead of using evil framebuffer, use the power of HW. like i (did) with egga.</td> </tr></table><span class="postbody">
<br/>
How? You'd need to do both horizontal scaling and vertical scaling, which looks ugly even if you can address all of VRAM for tiles.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#79443 - HtheB - Thu Apr 13, 2006 6:44 pm</h4>
    <div class="postbody"><span class="postbody">problem is.. will it work? :D</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#84479 - Wep_Z - Mon May 22, 2006 8:07 pm</h4>
    <div class="postbody"><span class="postbody">I know that I shouldn't bump <span style="font-weight: bold">old</span> topics, but I wanna know if there are some news to this.
<br/>
<a class="postlink" href="http://www.humbug.net" target="_blank">http://www.humbug.net</a> doesn't seem to be the official homepage for this..
<br/>
Anyone ?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#84563 - HtheB - Tue May 23, 2006 11:30 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Wep_Z wrote:</b></span></td> </tr> <tr> <td class="quote">I know that I shouldn't bump <span style="font-weight: bold">old</span> topics, but I wanna know if there are some news to this.
<br/>
<a class="postlink" href="http://www.humbug.net" target="_blank">http://www.humbug.net</a> doesn't seem to be the official homepage for this..
<br/>
Anyone ?</td> </tr></table><span class="postbody">actually..  it is yes....</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
