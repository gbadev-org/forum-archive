<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>DS Slot 2 Accessory "Template" - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > DS Slot 2 Accessory "Template"</h2>
<div id="posts">
<div class="post">
    <h4>#112196 - Juglak - Thu Dec 14, 2006 8:00 am</h4>
    <div class="postbody"><span class="postbody">Not sure if this is really useful to anyone, but, I've been working on a way to get something super cheap to work in the GBA slot to do... well, anything at all.
<br/>
<br/>
I finally came up with somewhat of a solution.
<br/>
<br/>
Using a pretty inexpensive 3.3v microcontroller (Atmel ATMEGA165-16AI in this case, since I had some and some PCB's I made to easilly test with them lying around), I was able to make some working data communications.
<br/>
<br/>
Its pretty slick, I must say.
<br/>
<br/>
Basicly, the GBA slot has 24 address pins (16 of them mux'd with data pins). Since the top 8 bits of the address are always acurate (they dont need to be latched) it makes this a bit easier.
<br/>
<br/>
So, to retrieve data from the Atmel IC, in DS code you would read from the GBA slot like so:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
GBA_READ_ADDR = ((AtmelAddr &amp; 0xFF)&lt;&lt;17);
<br/>
u16 data = *(u16*)GBA_READ_ADDR;
<br/>
swiDelay(25); // The Atmel at 8 MIPS is not fast enough to register the address change just yet, so wait a few clocks, and the data will be acurate
<br/>
u16 data = *(u16*)GBA_READ_ADDR; // data is now accurate
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
That will make the high byte of the GBA slot address = AtmelAddr.
<br/>
<br/>
Note that the atmel addr can really only be 8-bit, but thats ok. That gives us 256 16-bit values we can read/write to the Atmel software. Thats potentially a full SNES controller button readout, just on one address.
<br/>
<br/>
Now the Atmel only runs at 8 MHz (8 MIPS), so, no where near fast enough to do true GBA ROM emulation (roughly 8x too slow, actually).
<br/>
<br/>
But, using this method, I've been able to interface NES/SNES control pads, as well as some other random crap with the GBA slot. Particularly useful? Not really. But would be neat to have a two player NES emu on a single DS. ;)
<br/>
<br/>
Anyway, heres a pic I took of the rig (note at this time I have 8 more address lines to connect).
<br/>
<br/>
<a href="http://i16.tinypic.com/2rhwz6t.jpg">[Images not permitted - Click here to view it]</a>
<br/>
<br/>
Note: I gutted WWF Road to WrestleMania GBA to make this... poor game. :(
<br/>
<br/>
If anyone can think of anything useful for this setup, let me know. I'll happily post my AVR ASM for the project. Its not too complicated.
<br/>
<br/>
I'm thinking about fabricating a GBA cartridge with an SNES controller port on the bottom of it, to work with the SNES emu I started on.
<br/>
<br/>
(Note to self, you have far too many projects going on...)
<br/>
<br/>
Anyway... again, not sure how useful this is, but, its fun stuff all the same.
<br/>
<br/>
Cheers!<br/>_________________<br/>My goodies: 1xDS Lite - Supercard Lite, DSi, Supercard DSONEi</span><span class="gensmall"><br/><br/>Last edited by Juglak on Thu Dec 14, 2006 8:09 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#112197 - Juglak - Thu Dec 14, 2006 8:02 am</h4>
    <div class="postbody"><span class="postbody">Forgot to mention why I was explaining a lot.
<br/>
<br/>
The Atmel isnt fast enough to latch the lower 16 bits of the address before the GBA expects the data to be on those lines (at 8MHz, this is about 125ns delay... the address is long gone by the time the AVR recognizes it needs the data). By then, the AVR just needs to output the 16-bit data before the RD line is pulled high again. Hence the reason only the upper 8-bits of address are useful.
<br/>
<br/>
The AVR can easily latch data from the NES/SNES controller, since the pad doesnt care how long it takes to get the data.
<br/>
<br/>
I could also interface two of these AVR chips (one for the GBA interface, one for other processing) to do more "intense" interfacing... an idea was DS TV/VGA Out, but I'm reasonably certain that it would be limited to about 1-2 FPS with this rig. Still nifty idea though, since a past project of mine was B&amp;W TV (and full color VGA) done using only the AVR microcontroller and some resistors, power supply, and really crafty AVR ASM code. Roughly $9 in parts.
<br/>
So, it could be done... just probably cant get the data to the AVR fast enough to make it really usable.<br/>_________________<br/>My goodies: 1xDS Lite - Supercard Lite, DSi, Supercard DSONEi</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112304 - HyperHacker - Fri Dec 15, 2006 2:07 am</h4>
    <div class="postbody"><span class="postbody">That's awesome. Tell me, how do you solder such tiny things?<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112305 - Juglak - Fri Dec 15, 2006 2:47 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">That's awesome. Tell me, how do you solder such tiny things?</td> </tr></table><span class="postbody">
<br/>
<br/>
Fine tip soldering iron, mainly. And when that fails (usually always end up messing up and bridging at least 2 pins...), just slop solder all over all the pins, and use fine desolder braid to take up the excess.
<br/>
<br/>
I have a Weller WES50 soldering iron... pretty decent low cost semi-pro one.<br/>_________________<br/>My goodies: 1xDS Lite - Supercard Lite, DSi, Supercard DSONEi</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112338 - masscat - Fri Dec 15, 2006 11:04 am</h4>
    <div class="postbody"><span class="postbody">Natrium42 <a class="postlink" href="http://www.natrium42.com/blog/?p=40" target="_blank">assembling a DSerial</a> is a good example of soldering surface mount devices.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112573 - Juglak - Sun Dec 17, 2006 11:50 pm</h4>
    <div class="postbody"><span class="postbody">Just to note, I think I'm going to scrap this project, in favor of a Slot 1 device I'm working on, which can do all of this and more... unless anyone has any objections or other ideas for a Slot 2 device.
<br/>
<br/>
See the thread <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?p=112572" target="_blank">http://forum.gbadev.org/viewtopic.php?p=112572</a>.<br/>_________________<br/>My goodies: 1xDS Lite - Supercard Lite, DSi, Supercard DSONEi</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
