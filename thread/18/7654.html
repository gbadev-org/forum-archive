<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Making a library instead of an image - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Making a library instead of an image</h2>
<div id="posts">
<div class="post">
    <h4>#62444 - Vich - Wed Nov 30, 2005 11:33 pm</h4>
    <div class="postbody"><span class="postbody">How do you create a static library instead of a .nds file? My guess is that you have to change your makefile and/or ds_rules and/or  base_rules file, but I have no clue how.
<br/>
I've tried many parameters, but I'm partially guessing them from pages like:
<br/>
- <a href="http://forum.gbadev.org/viewtopic.php?t=1513&amp;highlight=library+makefile" target="_blank">http://forum.gbadev.org/viewtopic.php?t=1513&amp;highlight=library+makefile</a>
<br/>
- <a href="http://lists.gnu.org/archive/html/help-gplusplus/2004-10/msg00015.html" target="_blank">http://lists.gnu.org/archive/html/help-gplusplus/2004-10/msg00015.html</a>
<br/>
<br/>
<a class="postlink" href="http://www.gamedesign.be/wiki/index.php?title=Programmeren/Artikels/Handhelds/makefile" target="_blank">This</a> is the makefile that I use.
<br/>
<br/>
What I basically want is:
<br/>
- build library libA
<br/>
- build library libB, using libA
<br/>
- build a program that uses libB
<br/>
<br/>
I've googled and searched the gcc webpage, but can't find a clear answer. Anyone?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62446 - GPFerror - Wed Nov 30, 2005 11:45 pm</h4>
    <div class="postbody"><span class="postbody">here is the makefile that I use for my DS SDL library
<br/>
look at the main targets section for how the lib is built
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#---------------------------------------------------------------------------------
<br/>
.SUFFIXES:
<br/>
#---------------------------------------------------------------------------------
<br/>
<br/>
ifeq ($(strip $(DEVKITARM)),)
<br/>
$(error "Please set DEVKITARM in your environment. export DEVKITARM=&lt;path to&gt;devkitARM)
<br/>
endif
<br/>
<br/>
include $(DEVKITARM)/ds_rules
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# TARGET is the name of the output
<br/>
# BUILD is the directory where object files &amp; intermediate files will be placed
<br/>
# SOURCES is a list of directories containing source code
<br/>
# INCLUDES is a list of directories containing extra header files
<br/>
#---------------------------------------------------------------------------------
<br/>
TARGET      :=   libSDL
<br/>
BUILD      :=   build
<br/>
SOURCES       :=   source source/video source/video/nds source/timer  source/timer/nds source/thread source/thread/nds source/main source/main/nds source/joystick source/joystick/nds source/file source/events source/endian source/cdrom source/cdrom/nds source/audio source/audio/nds
<br/>
<br/>
INCLUDES   :=   include source source/video source/video/nds source/timer  source/timer/nds source/thread source/thread/nds source/main source/main/nds source/joystick source/joystick/nds source/file source/events source/endian source/cdrom source/cdrom/nds source/audio source/audio/nds
<br/>
<br/>
NDSLIB_INCLUDE=$(DEVKITPRO)/libnds/include
<br/>
NDSLIB_LIB=$(DEVKITPRO)/libnds/lib
<br/>
#---------------------------------------------------------------------------------
<br/>
# options for code generation
<br/>
#---------------------------------------------------------------------------------
<br/>
ARCH   := -mthumb-interwork
<br/>
<br/>
# note: arm9tdmi isn't the correct CPU arch, but anything newer and LD
<br/>
# *insists* it has a FPU or VFP, and it won't take no for an answer!
<br/>
CFLAGS   :=   -g -Wall -O2\
<br/>
          -mcpu=arm9tdmi -mtune=arm9tdmi -fomit-frame-pointer\
<br/>
         -ffast-math \
<br/>
         $(ARCH)
<br/>
<br/>
CFLAGS   +=   $(INCLUDE) -DARM9 -I$(NDSLIB_INCLUDE) -D__NDS__ -DENABLE_NDS -DDISABLE_THREADS -DPACKAGE=\"SDL\" -DVERSION=\"1.2.3\" -DHAVE_ALLOCA_H=1 -DHAVE_ALLOCA=1
<br/>
<br/>
ASFLAGS   :=   -g $(ARCH)
<br/>
LDFLAGS   =   -specs=ds_arm9.specs -g $(ARCH) -mno-fpu -Wl,-Map,$(notdir $*.map) -L$(NDSLIB_LIB)
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# any extra libraries we wish to link with the project
<br/>
#---------------------------------------------------------------------------------
<br/>
LIBS   := -lnds9
<br/>
 
<br/>
 
<br/>
#---------------------------------------------------------------------------------
<br/>
# list of directories containing libraries, this must be the top level containing
<br/>
# include and lib
<br/>
#---------------------------------------------------------------------------------
<br/>
LIBDIRS   :=   $(LIBNDS)
<br/>
 
<br/>
#---------------------------------------------------------------------------------
<br/>
# no real need to edit anything past this point unless you need to add additional
<br/>
# rules for different file extensions
<br/>
#---------------------------------------------------------------------------------
<br/>
ifneq ($(BUILD),$(notdir $(CURDIR)))
<br/>
#---------------------------------------------------------------------------------
<br/>
 
<br/>
export OUTPUT   :=   $(CURDIR)/$(TARGET)
<br/>
 
<br/>
export VPATH   :=   $(foreach dir,$(SOURCES),$(CURDIR)/$(dir))
<br/>
export DEPSDIR   :=   $(CURDIR)/$(BUILD)
<br/>
<br/>
CFILES      :=   $(foreach dir,$(SOURCES),$(notdir $(wildcard $(dir)/*.c)))
<br/>
CPPFILES   :=   $(foreach dir,$(SOURCES),$(notdir $(wildcard $(dir)/*.cpp)))
<br/>
SFILES      :=   $(foreach dir,$(SOURCES),$(notdir $(wildcard $(dir)/*.s)))
<br/>
BINFILES   :=   $(foreach dir,$(SOURCES),$(notdir $(wildcard $(dir)/*.bin)))
<br/>
 
<br/>
#---------------------------------------------------------------------------------
<br/>
# use CXX for linking C++ projects, CC for standard C
<br/>
#---------------------------------------------------------------------------------
<br/>
ifeq ($(strip $(CPPFILES)),)
<br/>
#---------------------------------------------------------------------------------
<br/>
   export LD   :=   $(CC)
<br/>
#---------------------------------------------------------------------------------
<br/>
else
<br/>
#---------------------------------------------------------------------------------
<br/>
   export LD   :=   $(CXX)
<br/>
#---------------------------------------------------------------------------------
<br/>
endif
<br/>
#---------------------------------------------------------------------------------
<br/>
<br/>
export OFILES   :=   $(BINFILES:.bin=.o) \
<br/>
               $(CPPFILES:.cpp=.o) $(CFILES:.c=.o) $(SFILES:.s=.o)
<br/>
 
<br/>
export INCLUDE   :=   $(foreach dir,$(INCLUDES),-I$(CURDIR)/$(dir)) \
<br/>
               $(foreach dir,$(LIBDIRS),-I$(dir)/include) \
<br/>
               $(foreach dir,$(LIBDIRS),-I$(dir)/include) \
<br/>
               -I$(CURDIR)/$(BUILD)
<br/>
 
<br/>
export LIBPATHS   :=   $(foreach dir,$(LIBDIRS),-L$(dir)/lib)
<br/>
 
<br/>
.PHONY: $(BUILD) clean
<br/>
 
<br/>
#---------------------------------------------------------------------------------
<br/>
$(BUILD):
<br/>
   @[ -d $@ ] || mkdir -p $@
<br/>
   @make --no-print-directory -C $(BUILD) -f $(CURDIR)/Makefile
<br/>
 
<br/>
#---------------------------------------------------------------------------------
<br/>
clean:
<br/>
   @echo clean ...
<br/>
   @rm -fr $(BUILD) *.elf *.nds* *.bin 
<br/>
 
<br/>
 
<br/>
#---------------------------------------------------------------------------------
<br/>
else
<br/>
 
<br/>
DEPENDS   :=   $(OFILES:.o=.d)
<br/>
 
<br/>
#---------------------------------------------------------------------------------
<br/>
# main targets
<br/>
#---------------------------------------------------------------------------------
<br/>
-include $(DEVKITARM)/base_rules
<br/>
$(NDSLIB_LIB)/libSDL.a:      $(OFILES)
<br/>
 
<br/>
#---------------------------------------------------------------------------------
<br/>
%.o   :   %.bin
<br/>
#---------------------------------------------------------------------------------
<br/>
   @echo $(notdir $&lt;)
<br/>
   @$(bin2o)
<br/>
 
<br/>
 
<br/>
-include $(DEPENDS)
<br/>
 
<br/>
#---------------------------------------------------------------------------------------
<br/>
endif
<br/>
#---------------------------------------------------------------------------------------</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62448 - Vich - Wed Nov 30, 2005 11:56 pm</h4>
    <div class="postbody"><span class="postbody">Thanks! That was easy!
<br/>
<br/>
I just added:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
-include $(DEVKITARM)/base_rules 
<br/>
$(OUTPUT).a      :   $(OFILES) 
<br/>
</td> </tr></table><span class="postbody">
<br/>
:D</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62934 - Vich - Wed Dec 07, 2005 12:37 am</h4>
    <div class="postbody"><span class="postbody">I've got another problem:
<br/>
<br/>
I built library called COW.
<br/>
The library that is called AlterNova uses COW and gets built too.
<br/>
<br/>
My program uses library AlterNova and thus also COW. So I link this program with both libraries. When I do that, I get many errors like:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">AlterNova/CTextureManager.h:145: undefined reference to `cow::CLog::~CLog()'</td> </tr></table><span class="postbody">
<br/>
<br/>
They're all undefined references to objects from AlterNova(and functions also) to COW.
<br/>
Any suggestions why this is?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62938 - GPFerror - Wed Dec 07, 2005 1:09 am</h4>
    <div class="postbody"><span class="postbody">try adding the lib a second time to the link line
<br/>
<br/>
ie 
<br/>
<br/>
-lA -lB -lA
<br/>
<br/>
or visa versa depending on the dependancies.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62939 - Vich - Wed Dec 07, 2005 1:12 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>GPFerror wrote:</b></span></td> </tr> <tr> <td class="quote">try adding the lib a second time to the link line
<br/>
<br/>
ie 
<br/>
<br/>
-lA -lB -lA
<br/>
<br/>
or visa versa depending on the dependancies.</td> </tr></table><span class="postbody">
<br/>
<br/>
Oh my f... God :o
<br/>
That solved it! It's official now: I hate GCC :P
<br/>
Thank you v?ry much!
<br/>
<br/>
[edit]
<br/>
-lB -lA does the trick too :o
<br/>
(-lAlterNova -lCOW)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
