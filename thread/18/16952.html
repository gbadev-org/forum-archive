<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Directories/Makefiles/Grit - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > Directories/Makefiles/Grit</h2>
<div id="posts">
<div class="post">
    <h4>#171163 - scizzorz - Wed Nov 04, 2009 5:31 am</h4>
    <div class="postbody"><span class="postbody">Hello!
<br/>
<br/>
I've been doing a bit of DS learning recently and I'm slightly confused on where to place my files and how to organize my makefile
<br/>
<br/>
Right now I have a directory named NDS, inside that is /build/, /source/, and /gfx/
<br/>
Inside of /gfx/ I have a 16x32 256-color sprite bitmap which I can convert with:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">C:/grit/grit obj/sprite.bmp -gB4 -gt -ftc -W3 -pe16 -gu8</td> </tr></table><span class="postbody">
<br/>
(I also have sprite.grit inside /gfx/)
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">-gB4 -gt -ftc -W3 -pe16 -gu8</td> </tr></table><span class="postbody">
<br/>
My makefile looks like this (I copy-pasted out of a tutorial on sprites and changed a few things):
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">.SUFFIXES:
<br/>
<br/>
ifeq ($(strip $(DEVKITARM)),)
<br/>
$(error "Please set DEVKITARM in your environment. export DEVKITARM=&lt;path to&gt;devkitARM")
<br/>
endif
<br/>
<br/>
include $(DEVKITARM)/ds_rules
<br/>
TARGET      :=   $(shell basename $(CURDIR))
<br/>
BUILD      :=   build
<br/>
SOURCES      :=   source
<br/>
DATA      :=   data  
<br/>
INCLUDES   :=   include
<br/>
GRAPHICS   :=   gfx
<br/>
<br/>
ARCH   :=   -mthumb -mthumb-interwork
<br/>
<br/>
CFLAGS   :=   -g -Wall -O2\
<br/>
          -march=armv5te -mtune=arm946e-s -fomit-frame-pointer\
<br/>
         -ffast-math \
<br/>
         $(ARCH)
<br/>
<br/>
CFLAGS   +=   $(INCLUDE) -DARM9
<br/>
CXXFLAGS   := $(CFLAGS) -fno-rtti -fno-exceptions
<br/>
<br/>
ASFLAGS   :=   -g $(ARCH)
<br/>
LDFLAGS   =   -specs=ds_arm9.specs -g $(ARCH) -mno-fpu -Wl,-Map,$(notdir $*.map)
<br/>
<br/>
LIBS   := -lnds9
<br/>
 
<br/>
LIBDIRS   :=   $(LIBNDS)
<br/>
 
<br/>
ifneq ($(BUILD),$(notdir $(CURDIR)))
<br/>
 
<br/>
export OUTPUT   :=   $(CURDIR)/$(TARGET)
<br/>
 
<br/>
export VPATH   :=   $(foreach dir,$(SOURCES),$(CURDIR)/$(dir)) \
<br/>
               $(foreach dir,$(GRAPHICS),$(CURDIR)/$(dir)) \
<br/>
               $(foreach dir,$(DATA),$(CURDIR)/$(dir))
<br/>
<br/>
export DEPSDIR   :=   $(CURDIR)/$(BUILD)
<br/>
<br/>
CFILES      :=   $(foreach dir,$(SOURCES),$(notdir $(wildcard $(dir)/*.c)))
<br/>
CPPFILES   :=   $(foreach dir,$(SOURCES),$(notdir $(wildcard $(dir)/*.cpp)))
<br/>
SFILES      :=   $(foreach dir,$(SOURCES),$(notdir $(wildcard $(dir)/*.s)))
<br/>
BINFILES   :=   $(foreach dir,$(DATA),$(notdir $(wildcard $(dir)/*.*)))
<br/>
PNGFILES   :=   $(foreach dir,$(GRAPHICS),$(notdir $(wildcard $(dir)/*.png)))
<br/>
 
<br/>
ifeq ($(strip $(CPPFILES)),)
<br/>
   export LD   :=   $(CC)
<br/>
else
<br/>
   export LD   :=   $(CXX)
<br/>
endif
<br/>
<br/>
export OFILES   :=   $(addsuffix .o,$(BINFILES)) \
<br/>
               $(PNGFILES:.png=.o) \
<br/>
               $(CPPFILES:.cpp=.o) $(CFILES:.c=.o) $(SFILES:.s=.o)
<br/>
<br/>
export INCLUDE   :=   $(foreach dir,$(INCLUDES),-I$(CURDIR)/$(dir)) \
<br/>
               $(foreach dir,$(LIBDIRS),-I$(dir)/include) \
<br/>
               $(foreach dir,$(LIBDIRS),-I$(dir)/include) \
<br/>
               -I$(CURDIR)/$(BUILD)
<br/>
 
<br/>
export LIBPATHS   :=   $(foreach dir,$(LIBDIRS),-L$(dir)/lib)
<br/>
 
<br/>
.PHONY: $(BUILD) clean
<br/>
 
<br/>
$(BUILD):
<br/>
   @[ -d $@ ] || mkdir -p $@
<br/>
   @make --no-print-directory -C $(BUILD) -f $(CURDIR)/Makefile
<br/>
 
<br/>
clean:
<br/>
   @echo clean ...
<br/>
   @rm -fr $(BUILD) $(TARGET).elf $(TARGET).nds $(TARGET).arm9 $(TARGET).ds.gba 
<br/>
 
<br/>
 
<br/>
else
<br/>
 
<br/>
DEPENDS   :=   $(OFILES:.o=.d)
<br/>
 
<br/>
$(OUTPUT).nds   :    $(OUTPUT).arm9
<br/>
$(OUTPUT).arm9   :   $(OUTPUT).elf
<br/>
$(OUTPUT).elf   :   $(OFILES)
<br/>
<br/>
%.bin.o   :   %.bin
<br/>
   @echo $(notdir $&lt;)
<br/>
   @$(bin2o)
<br/>
<br/>
%.c %.h   : %.bmp %.grit
<br/>
   grit $&lt; -ftc -o$*
<br/>
<br/>
<br/>
-include $(DEPENDS)
<br/>
 
<br/>
endif</td> </tr></table><span class="postbody">
<br/>
<br/>
And then I have main.cpp (mainly copy-pasted as well with a tiny modification to see if the sprite.h is loading correctly):
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include &lt;nds.h&gt;
<br/>
#include &lt;stdio.h&gt;
<br/>
<br/>
#include "sprite.h"
<br/>
volatile int frame = 0;
<br/>
//---------------------------------------------------------------------------------
<br/>
void Vblank() {
<br/>
   frame++;
<br/>
}
<br/>
   
<br/>
//---------------------------------------------------------------------------------
<br/>
int main(void) {
<br/>
   touchPosition touchXY;
<br/>
<br/>
   irqSet(IRQ_VBLANK, Vblank);
<br/>
<br/>
   consoleDemoInit();
<br/>
<br/>
   iprintf("      Hello DS dev'rs\n");
<br/>
   iprintf("     \x1b[32mwww.devkitpro.org\n");
<br/>
   iprintf("   \x1b[32;1mwww.drunkencoders.com\x1b[39m");
<br/>
 
<br/>
   while(1) {
<br/>
   
<br/>
      swiWaitForVBlank();
<br/>
      touchRead(&amp;touchXY);
<br/>
<br/>
      // print at using ansi escape sequence \x1b[line;columnH 
<br/>
      iprintf("\x1b[10;0HFrame = %d",frame);
<br/>
      iprintf("\x1b[16;0HTouch (x,y) = (%03d, %03d)",touchXY.px,touchXY.py);
<br/>
      iprintf("\x1b[17;0HPal 1 [%4d]",spritePal[1]);      
<br/>
   
<br/>
   }
<br/>
<br/>
   return 0;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
And when running the GCC make...
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">main.cpp
<br/>
arm-eabi-g++ -MMD -MP -MF /c/Users/John/NDS/build/main.d -g -Wall -O2 -march=armv5te -mtune=arm946e-s -fomit-frame-pointer -ffast-math -mthumb -mthumb-interwork -I/c/Users/John/NDS/include -I/c/devkit
<br/>
Pro/libnds/include -I/c/devkitPro/libnds/include -I/c/Users/John/NDS/build -DARM9 -fno-rtti -fno-exceptions -c /c/Users/John/NDS/source/main.cpp -o main.o
<br/>
c:/Users/John/NDS/source/main.cpp:4:22: error: rhahkzor.h: No such file or directory
<br/>
c:/Users/John/NDS/source/main.cpp: In function 'int main()':
<br/>
c:/Users/John/NDS/source/main.cpp:32: error: 'rhahkzorPal' was not declared in this scope
<br/>
make[1]: *** [main.o] Error 1
<br/>
make: *** [build] Error 2
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
Am I placing my graphics in the wrong folder or is my makefile wrong?
<br/>
I would really, really appreciate any help that you could give me - I'm brand new to programming in C++ and pretty much everything up there^^^ :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171164 - scizzorz - Wed Nov 04, 2009 5:49 am</h4>
    <div class="postbody"><span class="postbody">Nevermind, I solved it. silly me and just copy-pasting without reading every line - I never changed the PNGFILES to BMPFILES :) Sorry to bother!</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
