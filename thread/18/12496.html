<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>libfat & C++ I/O - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > libfat & C++ I/O</h2>
<div id="posts">
<div class="post">
    <h4>#119112 - nio101 - Mon Feb 19, 2007 8:59 pm</h4>
    <div class="postbody"><span class="postbody">Hello friends,
<br/>
<br/>
I've tried to use C++ I/O functions to read a text file on my EZF4, and I get some random errors, sometimes 1 character coming from out of nowhere, sometimes some characters are lost...
<br/>
<br/>
I use the latests R20/libnds/libfat...
<br/>
<br/>
I do it that way :
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include &lt;string&gt;                  
<br/>
#include &lt;fstream&gt;
<br/>
<br/>
ifstream inputstream("test.sgf");
<br/>
   
<br/>
string buffer;
<br/>
   
<br/>
while (!inputstream.eof())
<br/>
{
<br/>
   getline(inputstream, buffer,';');
<br/>
   iprintf("buff=.%s.",buffer.c_str());
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
And "buffer" doesn't always contain what it should !?!... If somebody can help...
<br/>
<br/>
BTW, I've tried the classic C-stdio way (fopen/getc/fclose), and it works well...
<br/>
<br/>
Thanks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119153 - OOPMan - Tue Feb 20, 2007 8:41 am</h4>
    <div class="postbody"><span class="postbody">I don't know whether things have changed at all recently, but I recall hearing that various elements of the stdc++ are not really supported by devkitPro. Things like iostreams and the like...
<br/>
<br/>
Anyone care to verify this?<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119165 - wintermute - Tue Feb 20, 2007 12:07 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>OOPMan wrote:</b></span></td> </tr> <tr> <td class="quote">I don't know whether things have changed at all recently, but I recall hearing that various elements of the stdc++ are not really supported by devkitPro. Things like iostreams and the like...
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
devkit<span style="font-weight: bold">Pro</span> not being a toolchain wouldn't know anything about C++ at all :P
<br/>
<br/>
devkit<span style="font-weight: bold">ARM</span> on the other hand, being the ARM toolchain supplied by the devkitPro project might.
<br/>
<br/>
This code <span style="font-style: italic">should</span> work fine I'm not sure why it doesn't atm. The iostream code eventually ends up at the same place as C stdio.
<br/>
<br/>
One thing I will say is that this
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include &lt;stdio.h&gt;
<br/>
int main() {
<br/>
  consoleDemoInit(); // Dov's lazy console init, handy for quick tests
<br/>
  printf("Hello World");
<br/>
   while(1) {
<br/>
      swiWaitForVBlank();
<br/>
   }
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
generates a 69k nds file ( using iprintf makes it 52k)
<br/>
while
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include &lt;nds.h&gt;
<br/>
#include &lt;iostream&gt;
<br/>
<br/>
<br/>
int main() {
<br/>
   consoleDemoInit();
<br/>
 
<br/>
   std::cout &lt;&lt; "Hello World!";
<br/>
   while(1) {
<br/>
      swiWaitForVBlank();
<br/>
   }
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
generates a 270k nds file.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"><br/><br/>Last edited by wintermute on Wed Feb 21, 2007 1:05 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#119176 - OOPMan - Tue Feb 20, 2007 1:53 pm</h4>
    <div class="postbody"><span class="postbody">My bad wintermute :-)
<br/>
<br/>
Useful to know that C++ does actually work, although that size hit is pretty nasty...
<br/>
<br/>
Still, it does mean I can, theoretically, use tinyxml :-)<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119209 - tepples - Tue Feb 20, 2007 8:39 pm</h4>
    <div class="postbody"><span class="postbody">It's not necessarily the C++ language itself that generates a hit but some of its features:
<br/>
<ul><li>Exception handling will bring in a lot of the C and C++ standard libraries that your program might not otherwise use on order to properly abort the program and toss an error message on the screens if main() doesn't catch everything. Based on my tests while developing AXE, compiling and linking without -fno-exceptions might add 50 KiB to the ARM7 or ARM9 executable. </li><li>Some people have claimed that use of RTTI (required for dynamic_cast) causes a size hit. Disable this at compile and link time with -fno-rtti. </li><li>But the biggest pig by far is &lt;iostream&gt;, as wintermute points out. On Windows (MinGW), hello_world_cstdio.cpp makes a 5 KiB executable, while hello_world_iostream.cpp makes a roughly 250 KiB executable. Tests on the Game Boy Advance reveal a similar magnitude of difference, so this is likely to be the case for any platform that links libstdc++ statically. Examining the result of 'nm' run on the iostream version shows that it's bringing in formatters for types that my program doesn't use, including the entire date formatter. </li></ul>
<br/>
It's possible to use C++ classes, inheritance, polymorphism, templates, etc. while using C-style exceptions (that is, result codes) and C-style I/O (that is, &lt;cstdio&gt;). But to be fair, even using C (or those parts of in C++ that are also parts of C) varies in space efficiency depending on how much abstraction you want to include:
<br/>
<ul><li>As wintermute points out, floating-point arithmetic takes space. If you use printf() instead of iprintf(), you link in a formatter with support for %e, %f, and %g formats, which links in the floating-point arithmetic library. </li><li>The formatter takes space even without support for floating-point arithmetic. If you use iprintf() instead of puts(), you link in the formatter. </li><li>The console takes space. I made a stripped-down console library called AGBTTY, and hello_world_agbtty.gba was significantly smaller than hello_world_libgba_console.gba. </li></ul>
<br/>
FAQ time?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"><br/><br/>Last edited by tepples on Thu Aug 02, 2007 12:53 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#119290 - Payk - Wed Feb 21, 2007 4:15 pm</h4>
    <div class="postbody"><span class="postbody">I am using tinyxml :D works great
<br/>
there is just one thing that has to be commented out. If you need to know  which part i mean:contact me.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119309 - OOPMan - Wed Feb 21, 2007 7:52 pm</h4>
    <div class="postbody"><span class="postbody">Hmmm, I found expat, which is entirely C, so I may end up using that instead :-)<br/>_________________<br/>"My boot, your face..." - Attributed to OOPMan, Emperor of Eroticon VI
<br/>
<br/>
You can find my NDS homebrew projects <a class="postlink" href="http://blog.dev-scene.com/oopman/" target="_blank">here...</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
