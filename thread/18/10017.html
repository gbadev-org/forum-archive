<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Display List Experts: Apply within ! (now with a video !) - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Display List Experts: Apply within ! (now with a video !)</h2>
<div id="posts">
<div class="post">
    <h4>#88960 - ikaris - Thu Jun 22, 2006 2:49 pm</h4>
    <div class="postbody"><span class="postbody">Hello everyone,
<br/>
<br/>
my Maya Display List Exporter is up and running (I'll release a version once I get an answer to this question !  I want to make sure I'm not doing something wrong...)
<br/>
<br/>
If I export a triangle, it works fine.  I can rotate it on the DS hardware and it works great. (I'm not using an emu for these tests)
<br/>
<br/>
I downloaded the latest version of devkitpro about a week ago, so I think I'm up to date.
<br/>
<br/>
If I export anything more than a triangle (i.e. a quad, i.e. two triangle, a cube, etc...) the object rotates normally, then the geometry gets distorted and then the DS crashes.
<br/>
<br/>
Here are some examples of some display lists generated by my exporter... can anyone see anything wrong ?
<br/>
<br/>
Triangle (this one works !)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
u32 callList[] =
<br/>
{
<br/>
9,
<br/>
FIFO_COMMAND_PACK(FIFO_BEGIN, FIFO_VERTEX16, FIFO_VERTEX16, FIFO_VERTEX16),
<br/>
GL_TRIANGLE,
<br/>
VERTEX_PACK(inttov16(0),inttov16(0)), VERTEX_PACK(inttov16(0),0),
<br/>
VERTEX_PACK(inttov16(-1),inttov16(0)), VERTEX_PACK(inttov16(0),0),
<br/>
VERTEX_PACK(inttov16(0),inttov16(0)), VERTEX_PACK(inttov16(-1),0),
<br/>
FIFO_COMMAND_PACK(FIFO_END, FIFO_NOP, FIFO_NOP, FIFO_NOP),
<br/>
};
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Quad (crashes after a half second...)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
u32 callList[] =
<br/>
{
<br/>
18,
<br/>
FIFO_COMMAND_PACK(FIFO_BEGIN, FIFO_VERTEX16, FIFO_VERTEX16, FIFO_VERTEX16),
<br/>
GL_TRIANGLE,
<br/>
VERTEX_PACK(inttov16(0),inttov16(0)), VERTEX_PACK(inttov16(0),0),
<br/>
VERTEX_PACK(inttov16(-1),inttov16(0)), VERTEX_PACK(inttov16(0),0),
<br/>
VERTEX_PACK(inttov16(0),inttov16(0)), VERTEX_PACK(inttov16(-1),0),
<br/>
FIFO_COMMAND_PACK(FIFO_VERTEX16, FIFO_VERTEX16, FIFO_VERTEX16, FIFO_END),
<br/>
VERTEX_PACK(inttov16(-1),inttov16(0)), VERTEX_PACK(inttov16(0),0),
<br/>
VERTEX_PACK(inttov16(-1),inttov16(0)), VERTEX_PACK(inttov16(-1),0),
<br/>
VERTEX_PACK(inttov16(0),inttov16(0)), VERTEX_PACK(inttov16(-1),0),
<br/>
};
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Cube (also crashes...)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
u32 callList[] =
<br/>
{
<br/>
108,
<br/>
FIFO_COMMAND_PACK(FIFO_BEGIN, FIFO_VERTEX16, FIFO_VERTEX16, FIFO_VERTEX16),
<br/>
GL_TRIANGLE,
<br/>
VERTEX_PACK(inttov16(-1),inttov16(-1)), VERTEX_PACK(inttov16(1),0),
<br/>
VERTEX_PACK(inttov16(1),inttov16(-1)), VERTEX_PACK(inttov16(1),0),
<br/>
VERTEX_PACK(inttov16(-1),inttov16(1)), VERTEX_PACK(inttov16(1),0),
<br/>
FIFO_COMMAND_PACK(FIFO_VERTEX16, FIFO_VERTEX16, FIFO_VERTEX16, FIFO_VERTEX16),
<br/>
VERTEX_PACK(inttov16(1),inttov16(-1)), VERTEX_PACK(inttov16(1),0),
<br/>
VERTEX_PACK(inttov16(1),inttov16(1)), VERTEX_PACK(inttov16(1),0),
<br/>
VERTEX_PACK(inttov16(-1),inttov16(1)), VERTEX_PACK(inttov16(1),0),
<br/>
VERTEX_PACK(inttov16(-1),inttov16(1)), VERTEX_PACK(inttov16(1),0),
<br/>
FIFO_COMMAND_PACK(FIFO_VERTEX16, FIFO_VERTEX16, FIFO_VERTEX16, FIFO_VERTEX16),
<br/>
VERTEX_PACK(inttov16(1),inttov16(1)), VERTEX_PACK(inttov16(1),0),
<br/>
VERTEX_PACK(inttov16(-1),inttov16(1)), VERTEX_PACK(inttov16(-1),0),
<br/>
VERTEX_PACK(inttov16(1),inttov16(1)), VERTEX_PACK(inttov16(1),0),
<br/>
VERTEX_PACK(inttov16(1),inttov16(1)), VERTEX_PACK(inttov16(-1),0),
<br/>
FIFO_COMMAND_PACK(FIFO_VERTEX16, FIFO_VERTEX16, FIFO_VERTEX16, FIFO_VERTEX16),
<br/>
VERTEX_PACK(inttov16(-1),inttov16(1)), VERTEX_PACK(inttov16(-1),0),
<br/>
VERTEX_PACK(inttov16(-1),inttov16(1)), VERTEX_PACK(inttov16(-1),0),
<br/>
VERTEX_PACK(inttov16(1),inttov16(1)), VERTEX_PACK(inttov16(-1),0),
<br/>
VERTEX_PACK(inttov16(-1),inttov16(-1)), VERTEX_PACK(inttov16(-1),0),
<br/>
FIFO_COMMAND_PACK(FIFO_VERTEX16, FIFO_VERTEX16, FIFO_VERTEX16, FIFO_VERTEX16),
<br/>
VERTEX_PACK(inttov16(1),inttov16(1)), VERTEX_PACK(inttov16(-1),0),
<br/>
VERTEX_PACK(inttov16(1),inttov16(-1)), VERTEX_PACK(inttov16(-1),0),
<br/>
VERTEX_PACK(inttov16(-1),inttov16(-1)), VERTEX_PACK(inttov16(-1),0),
<br/>
VERTEX_PACK(inttov16(-1),inttov16(-1)), VERTEX_PACK(inttov16(-1),0),
<br/>
FIFO_COMMAND_PACK(FIFO_VERTEX16, FIFO_VERTEX16, FIFO_VERTEX16, FIFO_VERTEX16),
<br/>
VERTEX_PACK(inttov16(1),inttov16(-1)), VERTEX_PACK(inttov16(-1),0),
<br/>
VERTEX_PACK(inttov16(-1),inttov16(-1)), VERTEX_PACK(inttov16(1),0),
<br/>
VERTEX_PACK(inttov16(1),inttov16(-1)), VERTEX_PACK(inttov16(-1),0),
<br/>
VERTEX_PACK(inttov16(1),inttov16(-1)), VERTEX_PACK(inttov16(1),0),
<br/>
FIFO_COMMAND_PACK(FIFO_VERTEX16, FIFO_VERTEX16, FIFO_VERTEX16, FIFO_VERTEX16),
<br/>
VERTEX_PACK(inttov16(-1),inttov16(-1)), VERTEX_PACK(inttov16(1),0),
<br/>
VERTEX_PACK(inttov16(1),inttov16(-1)), VERTEX_PACK(inttov16(1),0),
<br/>
VERTEX_PACK(inttov16(1),inttov16(-1)), VERTEX_PACK(inttov16(-1),0),
<br/>
VERTEX_PACK(inttov16(1),inttov16(1)), VERTEX_PACK(inttov16(1),0),
<br/>
FIFO_COMMAND_PACK(FIFO_VERTEX16, FIFO_VERTEX16, FIFO_VERTEX16, FIFO_VERTEX16),
<br/>
VERTEX_PACK(inttov16(1),inttov16(-1)), VERTEX_PACK(inttov16(-1),0),
<br/>
VERTEX_PACK(inttov16(1),inttov16(1)), VERTEX_PACK(inttov16(-1),0),
<br/>
VERTEX_PACK(inttov16(1),inttov16(1)), VERTEX_PACK(inttov16(1),0),
<br/>
VERTEX_PACK(inttov16(-1),inttov16(-1)), VERTEX_PACK(inttov16(-1),0),
<br/>
FIFO_COMMAND_PACK(FIFO_VERTEX16, FIFO_VERTEX16, FIFO_VERTEX16, FIFO_VERTEX16),
<br/>
VERTEX_PACK(inttov16(-1),inttov16(-1)), VERTEX_PACK(inttov16(1),0),
<br/>
VERTEX_PACK(inttov16(-1),inttov16(1)), VERTEX_PACK(inttov16(-1),0),
<br/>
VERTEX_PACK(inttov16(-1),inttov16(-1)), VERTEX_PACK(inttov16(1),0),
<br/>
VERTEX_PACK(inttov16(-1),inttov16(1)), VERTEX_PACK(inttov16(1),0),
<br/>
FIFO_COMMAND_PACK(FIFO_VERTEX16, FIFO_END, FIFO_NOP, FIFO_NOP),
<br/>
VERTEX_PACK(inttov16(-1),inttov16(1)), VERTEX_PACK(inttov16(-1),0),
<br/>
};
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Essentially all I've done is modified the code for the Display List 1 example, and included the .h file... I also added a zoom function with the shoulder buttons... here's the source in case anyone's interested...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include &lt;nds.h&gt;
<br/>
<br/>
#include "callList.h"
<br/>
<br/>
int main()
<br/>
{   
<br/>
<br/>
   float rotateX = 0.0;
<br/>
   float rotateY = 0.0;
<br/>
   float zoom = -1;
<br/>
<br/>
   powerON(POWER_ALL);
<br/>
<br/>
   //set mode 0, enable BG0 and set it to 3D
<br/>
   videoSetMode(MODE_0_3D);
<br/>
<br/>
   //this should work the same as the normal gl call
<br/>
   glViewPort(0,0,255,191);
<br/>
   
<br/>
   glClearColor(255,0,0);
<br/>
   glClearDepth(0x7FFF);
<br/>
   
<br/>
   
<br/>
   
<br/>
   while(1)      
<br/>
   {
<br/>
   
<br/>
      //any floating point gl call is being converted to fixed prior to being implemented
<br/>
      gluPerspective(35, 256.0 / 192.0, 0.1, 40);
<br/>
<br/>
      gluLookAt(   0.0, 0.0, 1.0,      //camera possition 
<br/>
               0.0, 0.0, 0.0,      //look at
<br/>
               0.0, 1.0, 0.0);      //up
<br/>
      
<br/>
      
<br/>
<br/>
      glPushMatrix();
<br/>
<br/>
      //move it away from the camera
<br/>
      glTranslate3f32(0, 0, floattof32(zoom));
<br/>
            
<br/>
      glRotateX(rotateX);
<br/>
      glRotateY(rotateY);
<br/>
      
<br/>
      glMatrixMode(GL_TEXTURE);
<br/>
      glIdentity();
<br/>
      
<br/>
      glMatrixMode(GL_MODELVIEW);
<br/>
<br/>
   
<br/>
      //not a real gl function and will likely change
<br/>
      glPolyFmt(POLY_ALPHA(31) | POLY_CULL_NONE);
<br/>
<br/>
      scanKeys();
<br/>
      
<br/>
      u16 keys = keysHeld();
<br/>
      
<br/>
      if((keys &amp; KEY_UP)) rotateX += 3;
<br/>
      if((keys &amp; KEY_DOWN)) rotateX -= 3;
<br/>
      if((keys &amp; KEY_LEFT)) rotateY += 3;
<br/>
      if((keys &amp; KEY_RIGHT)) rotateY -= 3;
<br/>
      
<br/>
      if((keys &amp; KEY_R)) zoom -= 0.1;
<br/>
      if((keys &amp; KEY_L)) zoom += 0.1;
<br/>
      
<br/>
      glCallList(callList);   
<br/>
<br/>
      glPopMatrix(1);
<br/>
         
<br/>
      glFlush();
<br/>
<br/>
   }
<br/>
<br/>
   return 0;
<br/>
}//end main 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Help !  Thanks !</span><span class="gensmall"><br/><br/>Last edited by ikaris on Thu Jun 22, 2006 5:44 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#88966 - Valmond - Thu Jun 22, 2006 3:51 pm</h4>
    <div class="postbody"><span class="postbody">Interesting :)
<br/>
<br/>
How do you calculate the first number (the length right ?) in the list ?
<br/>
<br/>
I'm not sure at all but intuitively I'd say that
<br/>
the lenght should be 15 instead of 18 for the Quad...
<br/>
<br/>
<br/>
/Valmond</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#88976 - ikaris - Thu Jun 22, 2006 5:07 pm</h4>
    <div class="postbody"><span class="postbody">Hi Valmond !
<br/>
<br/>
Different values are worth a different amount for the u32 number...
<br/>
<br/>
vertices are worth 3, (so, triangle 3 * 3 = 9) color are worth 1, texture are worth 2...
<br/>
<br/>
The thing is, if you get the number wrong, it object doesn't even show up on the screen... so I know that the number is right since its actually rendering the quad (if only for half a second :) )
<br/>
<br/>
Any ideas ?  Is there any documentation on this somewhere ?!  Is this a Nintendo standard, an OpenGL standard, or someone else's ?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#88979 - silent_code - Thu Jun 22, 2006 5:32 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ikaris wrote:</b></span></td> </tr> <tr> <td class="quote">Any ideas ?  Is there any documentation on this somewhere ?!  Is this a Nintendo standard, an OpenGL standard, or someone else's ?</td> </tr></table><span class="postbody">
<br/>
<br/>
there is, if you are allowed [...] to buy an official nitro devkit, you get one ;)
<br/>
<br/>
maybe you could start making a doc if you know enough about the topic. that would be really cool :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#88980 - ikaris - Thu Jun 22, 2006 5:35 pm</h4>
    <div class="postbody"><span class="postbody">Hey, silent !
<br/>
<br/>
I would like to make a doc, once I figure this out !
<br/>
<br/>
And, of course, make my Maya Display List exporter public !
<br/>
<br/>
I'll keep you posted !</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#88981 - ikaris - Thu Jun 22, 2006 5:45 pm</h4>
    <div class="postbody"><span class="postbody">Here's a video showing first, a working triangle, and then, the crashing quad...
<br/>
<br/>
<a href="http://www.youtube.com/watch?v=O-QsbLwnoYE" target="_blank">http://www.youtube.com/watch?v=O-QsbLwnoYE</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#88985 - Mighty Max - Thu Jun 22, 2006 6:06 pm</h4>
    <div class="postbody"><span class="postbody">I can't see an error in the code you posted
<br/>
<br/>
Do you utilize any IRQs that might interfere? 
<br/>
Could it be that the key-read hangs up (probably with the ARM7)? Test this by adding an "auto rotate" that does not check for keyinput<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#88989 - edwdig - Thu Jun 22, 2006 6:36 pm</h4>
    <div class="postbody"><span class="postbody">I know *nothing* about DS programming, but one thing did stand out to me immediately. At the end of your first example, you have this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">FIFO_COMMAND_PACK(FIFO_END, FIFO_NOP, FIFO_NOP, FIFO_NOP), </td> </tr></table><span class="postbody">
<br/>
<br/>
But  the other examples don't. Perhaps that's the reason? Also, do the Begin/End commands need to be included in the length?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#88992 - ecurtz - Thu Jun 22, 2006 6:48 pm</h4>
    <div class="postbody"><span class="postbody">I have a working exporter for MisfitModel3d. If you haven't solved this by tonight I'll post some test files when I get home.
<br/>
<br/>
Did they re-enable the DMA copy in glCallList()? That might be causing trouble.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#89005 - ikaris - Thu Jun 22, 2006 7:40 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for your comments, everyone !
<br/>
<br/>
I will try to add the auto-rotate instead of the key input and see what happens... !</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#89009 - ikaris - Thu Jun 22, 2006 7:52 pm</h4>
    <div class="postbody"><span class="postbody">Nope... making the rotation automatic doesn't help.
<br/>
<br/>
It rotates for a half second, then freaks out.
<br/>
<br/>
I should mention that the teapot sample works fine for me... maybe I should use my object in there instead of Display List 1 ?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#89016 - Mighty Max - Thu Jun 22, 2006 8:19 pm</h4>
    <div class="postbody"><span class="postbody">So its for sure the arm9 code that hangs up.
<br/>
<br/>
The teapot is worth a try, but i'd get back to your own code when it works to find the error.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#89024 - ikaris - Thu Jun 22, 2006 8:57 pm</h4>
    <div class="postbody"><span class="postbody">Putting my callList into the teapot example crashes as well...
<br/>
<br/>
so it must be my FIFO_COMMAND_PACK data.
<br/>
<br/>
I'm working on a few angles, and I'll let you all know once I've figured it out.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#89033 - Sausage Boy - Thu Jun 22, 2006 9:18 pm</h4>
    <div class="postbody"><span class="postbody">Have you tried changing the value from 18 to 15? I'm almost certain that is the problem, a display list overflow. It is definately possible to render the display list without the correct length, but from my experience, it gets fucked up after a while. 
<br/>
<br/>
I would try it myself, but I'm sitting in an internet caf? of an all inclusive hotel in Andalucia at the moment (BRAG BRAG BRAG). :P<br/>_________________<br/>"no offense, but this is the gayest game ever"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#89045 - Valmond - Thu Jun 22, 2006 9:35 pm</h4>
    <div class="postbody"><span class="postbody">Just tried something like that :)
<br/>
<br/>
Thought that maybe you have to put the colors in so
<br/>
I did that, and calculated the length according to ikaris
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">u32 callList[] =
<br/>
{
<br/>
24,
<br/>
FIFO_COMMAND_PACK(FIFO_BEGIN, FIFO_COLOR, FIFO_VERTEX16,FIFO_COLOR),
<br/>
 GL_TRIANGLE,
<br/>
   RGB15(31,0,0),
<br/>
   VERTEX_PACK(inttov16(-1),inttov16(-1)),VERTEX_PACK(0,0),
<br/>
   RGB15(0,31,0),
<br/>
   
<br/>
FIFO_COMMAND_PACK(FIFO_VERTEX16,FIFO_COLOR, FIFO_VERTEX16, FIFO_COLOR),
<br/>
   VERTEX_PACK(inttov16(1),inttov16(-1)), VERTEX_PACK(0,0),
<br/>
   RGB15(0,31,31),
<br/>
   VERTEX_PACK(inttov16(0),inttov16(1)), VERTEX_PACK(0,0),
<br/>
   RGB15(0,0,31),
<br/>
<br/>
<br/>
FIFO_COMMAND_PACK(FIFO_VERTEX16,FIFO_COLOR, FIFO_VERTEX16,FIFO_COLOR),
<br/>
   VERTEX_PACK(inttov16(-1),inttov16(-1)), VERTEX_PACK(0,0),
<br/>
   RGB15(0,31,31),
<br/>
   VERTEX_PACK(inttov16(0),inttov16(1)), VERTEX_PACK(0,0),
<br/>
   RGB15(0,0,31),
<br/>
<br/>
FIFO_COMMAND_PACK(FIFO_VERTEX16, FIFO_NOP, FIFO_NOP,FIFO_END),
<br/>
   VERTEX_PACK(inttov16(-1),inttov16(1)), VERTEX_PACK(0,0),
<br/>
0,0,0,0,0,0
<br/>
};</td> </tr></table><span class="postbody">
<br/>
<br/>
Well, with the 0,0,0,0,0 at the end (dont know how many is needed :p)
<br/>
it works, without it doesn't so maybe the problem is there...
<br/>
<br/>
/Valmond</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#89048 - Sausage Boy - Thu Jun 22, 2006 9:38 pm</h4>
    <div class="postbody"><span class="postbody">It seems like I was indeed correct. Valmond, could you try removing all the zero's and changing the 24 to 23?<br/>_________________<br/>"no offense, but this is the gayest game ever"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#89049 - Valmond - Thu Jun 22, 2006 9:49 pm</h4>
    <div class="postbody"><span class="postbody">setting the length to less (22 for example) doesn't work (no crash, no poly),
<br/>
setting it to 24 and add at least one zero works, without one zero it crashes.
<br/>
<br/>
works (from example above)
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">...   VERTEX_PACK(inttov16(-1),inttov16(1)), VERTEX_PACK(0,0),
<br/>
   0
<br/>
};</td> </tr></table><span class="postbody">
<br/>
HTH
<br/>
<br/>
/Valmond *going to eat*</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#89050 - ikaris - Thu Jun 22, 2006 9:56 pm</h4>
    <div class="postbody"><span class="postbody">My exporter does export vertex colors and tex coords, but I simply didn't add them to make the examples simpler.
<br/>
<br/>
Anyway, I just tried setting it to 23 and...
<br/>
<br/>
it WORKS !!!!
<br/>
<br/>
So I just have to find out why 23 works, and how to adjust my calculations...
<br/>
<br/>
Once I figure it out, I'll post my Maya Exporter !
<br/>
<br/>
Thanks guys !</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#89054 - ikaris - Thu Jun 22, 2006 10:11 pm</h4>
    <div class="postbody"><span class="postbody">So, my logic is: take the number of triangles and subtract one...
<br/>
<br/>
So I tried making a cube, which gives me 144...
<br/>
<br/>
A cube has 12 triangles.
<br/>
<br/>
So, I tried subtracting 11 from 144, so I put 133 into the .h file...
<br/>
<br/>
aaaaand....
<br/>
<br/>
it didn't work :(
<br/>
<br/>
WTF !</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#89055 - Mighty Max - Thu Jun 22, 2006 10:14 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ikaris wrote:</b></span></td> </tr> <tr> <td class="quote">My exporter does export vertex colors and tex coords, but I simply didn't add them to make the examples simpler.
<br/>
<br/>
Anyway, I just tried setting it to 23 and...
<br/>
<br/>
it WORKS !!!!
<br/>
<br/>
So I just have to find out why 23 works, and how to adjust my calculations...
<br/>
<br/>
Once I figure it out, I'll post my Maya Exporter !
<br/>
<br/>
Thanks guys !</td> </tr></table><span class="postbody">
<br/>
<br/>
The 23 because you send 23 dataparts. Just count entries of that list after this number.
<br/>
<br/>
- 4 Command Packs
<br/>
- 1 glType (GL_TRIANGLE)
<br/>
- 6 color data
<br/>
- 12 vertex Packs
<br/>
====
<br/>
23 Data chunks<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#89056 - ikaris - Thu Jun 22, 2006 10:15 pm</h4>
    <div class="postbody"><span class="postbody">I'll try modifying my exporter with this in mind...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#89059 - ikaris - Thu Jun 22, 2006 10:23 pm</h4>
    <div class="postbody"><span class="postbody">Woooohoooo !
<br/>
<br/>
Cube is working, no problem.
<br/>
<br/>
To paraphrase Max:
<br/>
<br/>
- Each COMMAND_PACK is worth 1
<br/>
- The GL_TRIANGLE is worth 1
<br/>
- Each vertex is worth 2
<br/>
- Each vertex color is worth 1
<br/>
- (I will assume) each UV is worth 1 (I'll test that out later)
<br/>
<br/>
I'll clean up my exporter, add some //comments, and let it loose into the world this evening !
<br/>
<br/>
Nice !</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#89072 - masscat - Thu Jun 22, 2006 11:38 pm</h4>
    <div class="postbody"><span class="postbody">Here is the code for glCallList (copied from the sourceforge CVS):
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">//---------------------------------------------------------------------------------
<br/>
//Display lists have issues that need to resolving.
<br/>
//There seems to be some issues with list size.
<br/>
//---------------------------------------------------------------------------------
<br/>
GL_STATIC_INL void glCallList(u32* list)
<br/>
//---------------------------------------------------------------------------------
<br/>
{
<br/>
   u32 count = *list++;
<br/>
<br/>
   while(count--)
<br/>
      GFX_FIFO = *list++;
<br/>
<br/>
   //this works sometimes??
<br/>
//   DMA_SRC(0) = (uint32)list;
<br/>
//   DMA_DEST(0) = 0x4000400;
<br/>
//   DMA_CR(0) = DMA_FIFO | count;
<br/>
//
<br/>
//   while(DMA_CR(0) &amp; DMA_BUSY);
<br/>
<br/>
}</td> </tr></table><span class="postbody">
<br/>
A display list is simply an array of 32bit values.
<br/>
The first element of the array is a count of the number of 32 bit values following it. This count causes glCallList to copy that number of 32 bit values into the 3D fifo.
<br/>
Each of the following command/data values take up 32 bits (even if they could be stored in less than that - 16bits for a colour). Since a vertex is represented by 3 16bit values (x, y and z) it is placed into a list with two VERTEX_PACK elements (one for the x and y and the other for z and 0 padding).
<br/>
Therefore, for each element (i.e. COMMAND_PACK, VERTEX_PACK, RGB15 etc.) you add to the array add one to the count value.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#89405 - ikaris - Sat Jun 24, 2006 6:58 pm</h4>
    <div class="postbody"><span class="postbody">Alright, people, I'm SO close to releasing this exporter... but I still have a problem !
<br/>
<br/>
When I create and then export a sphere larger than 8 radius, it's all distorted when I load it up into my example.  However, anything smaller than 8 x 8 x 8 is fine...
<br/>
<br/>
The problem is that most objects lose a LOT of detail if you can only have 16 fixed-point positions per axis :)
<br/>
<br/>
I've gone over my export code a million times and there's nothing wrong with the values being pulled out of the geometry.
<br/>
<br/>
The code is exactly like I had in the first post:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
u32 callList[] = 
<br/>
{ 
<br/>
18, 
<br/>
FIFO_COMMAND_PACK(FIFO_BEGIN, FIFO_VERTEX16, FIFO_VERTEX16, FIFO_VERTEX16), 
<br/>
GL_TRIANGLE, 
<br/>
VERTEX_PACK(inttov16(0),inttov16(0)), VERTEX_PACK(inttov16(0),0), 
<br/>
VERTEX_PACK(inttov16(-1),inttov16(0)), VERTEX_PACK(inttov16(0),0), 
<br/>
VERTEX_PACK(inttov16(0),inttov16(0)), VERTEX_PACK(inttov16(-1),0), 
<br/>
FIFO_COMMAND_PACK(FIFO_VERTEX16, FIFO_VERTEX16, FIFO_VERTEX16, FIFO_END), 
<br/>
VERTEX_PACK(inttov16(-1),inttov16(0)), VERTEX_PACK(inttov16(0),0), 
<br/>
VERTEX_PACK(inttov16(-1),inttov16(0)), VERTEX_PACK(inttov16(-1),0), 
<br/>
VERTEX_PACK(inttov16(0),inttov16(0)), VERTEX_PACK(inttov16(-1),0), 
<br/>
}; 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Just imagine the values being under -8 or over 8...
<br/>
<br/>
Does the fact that I'm using VERTEX16 and inttov16 related to this ?  I thought the 16 was for bits of precision, not actual integer values :)
<br/>
<br/>
Any ideas ?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#89419 - Sausage Boy - Sat Jun 24, 2006 9:15 pm</h4>
    <div class="postbody"><span class="postbody">Have a look at this thread...wierd?
<br/>
<a href="http://forum.gbadev.org/viewtopic.php?t=6046" target="_blank">http://forum.gbadev.org/viewtopic.php?t=6046</a><br/>_________________<br/>"no offense, but this is the gayest game ever"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#89425 - Mighty Max - Sat Jun 24, 2006 9:59 pm</h4>
    <div class="postbody"><span class="postbody">The fixed point type used by the hardware can not express values greater or equal to eight iirc. A look in the definition of inttov16 should clarify that.
<br/>
<br/>
So just scale your model down until it matches your desires.
<br/>
<br/>
[edit]
<br/>
From libnds:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
typedef short int v16;       // vertex 4.12 fixed format
<br/>
#define inttov16(n)          ((n) &lt;&lt; 12)
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
in 2-complement, that reaches from -8 to +7,999755859375 in steps of 0,000244140625<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#89433 - ikaris - Sat Jun 24, 2006 10:41 pm</h4>
    <div class="postbody"><span class="postbody">...
<br/>
<br/>
you have GOT to be kidding me...
<br/>
<br/>
That makes me want to go back to Immediate Mode from Call Lists... 
<br/>
<br/>
this sucks!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#89434 - Mighty Max - Sat Jun 24, 2006 10:42 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ikaris wrote:</b></span></td> </tr> <tr> <td class="quote">...
<br/>
<br/>
you have GOT to be kidding me...
<br/>
<br/>
That makes me want to go back to Immediate Mode from Call Lists... 
<br/>
<br/>
this sucks!</td> </tr></table><span class="postbody">
<br/>
<br/>
Its the same in immediate mode<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#89435 - ikaris - Sat Jun 24, 2006 10:44 pm</h4>
    <div class="postbody"><span class="postbody">Steps of 0,000244140625... but that gets rounded to a whole number, no ?
<br/>
<br/>
So its as good as -8 to 8... right ?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#89437 - ikaris - Sat Jun 24, 2006 10:46 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<br/>
Its the same in immediate mode</td> </tr></table><span class="postbody">
<br/>
<br/>
I said that because its easier to write an exporter that translates values over 8 if its in Immediate Mode...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#89438 - Mighty Max - Sat Jun 24, 2006 10:50 pm</h4>
    <div class="postbody"><span class="postbody">nah, its not rounding if you don't round yourself.
<br/>
<br/>
inttov16 only uses full numbers (int)
<br/>
<br/>
but you can do this conversation for float as in the following example (note: its not optimized)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
float coordinate = 2.3375f ;
<br/>
<br/>
v16 fixedPointCorrdinate = (v16)(coordinate * 4096.0f) ;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
edit: actually there is a floattov16 allready defined.<br/>_________________<br/><a class="postlink" href="http://mightymax.org/gbamp_multiboot.html" target="_blank">GBAMP Multiboot</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#89452 - ikaris - Sat Jun 24, 2006 11:35 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
edit: actually there is a floattov16 allready defined.</td> </tr></table><span class="postbody">
<br/>
<br/>
ya but if you compile with it, it says its deprecated...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#89460 - masscat - Sun Jun 25, 2006 12:27 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ikaris wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mighty Max wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
edit: actually there is a floattov16 allready defined.</td> </tr></table><span class="postbody">
<br/>
<br/>
ya but if you compile with it, it says its deprecated...</span></td> </tr></table><span class="postbody">
<br/>
Are you sure that you are using floattov16 and not floatov16 (note the extra 't'). The latter versions (single 't') of all macros are deprecated.
<br/>
<br/>
As for the -8 to 8 range of the fixed point system, it does not really matter as the models can be scaled at render time, so during the export scale all vertice to fit inside the 16x16x16 cube (maybe include the scaling factor in the model description).
<br/>
If all the models use the same scaling factor then there is no additional cost, i.e. you do not have to change the model matrix between different models. The scaling factor can easily be adjusted (before compile time) if a user of your exporter has models with different factors.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#89480 - ikaris - Sun Jun 25, 2006 2:47 am</h4>
    <div class="postbody"><span class="postbody">thanks max you really know your stuff !  I ignorantly thought the single and double "t" were the same...
<br/>
<br/>
now it works great with the float !  one step closer to releasing my exporter... the models coming out of it look great now...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#89524 - Valmond - Sun Jun 25, 2006 9:56 am</h4>
    <div class="postbody"><span class="postbody">You got 65536 steps, which eventually fit a pixel position on screen at the end :)
<br/>
<br/>
I use this in my XFile converter :
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code"> 
<br/>
    n=(int)(vert[i].get(j)*4096.0f); //&lt;-one x,y or z from a vertex
<br/>
    fputc(n&amp;255,f);
<br/>
    fputc(n&gt;&gt;8,f);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
where the input is a float and the output is a 16bit int (to a file), and it works ok.
<br/>
<br/>
BTW I also scale the (in this case 3DSMax) mesh by 0.01
<br/>
<br/>
[edit]just read the page 3, most things are already explained, gotta stop posteing before the morning coff? :p[/edit] 
<br/>
/Valmond</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
