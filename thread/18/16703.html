<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Help with dswifi and general connectivity for the xtrem noob - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Help with dswifi and general connectivity for the xtrem noob</h2>
<div id="posts">
<div class="post">
    <h4>#168974 - Emmanuel - Sun Jun 07, 2009 3:29 pm</h4>
    <div class="postbody"><span class="postbody">Here's my issue:
<br/>
Add multiplayer to my game.
<br/>
<br/>
Over Internet and local if possible. But, first I'd prefer local so it's easier to test. DS connect to DS.
<br/>
<br/>
I need to be able to at least send and receive one simple byte per frame. *well, in fact, 3 u16 per frame, but if not possible, 1 byte would keep me happy, what I plan on sending is the Key presses per frame to the server DS, and then it sends the missing presses back to the other DSs and have each calculate the game with no synchronization on hp or positions, but, they would likely be the same. I think.*
<br/>
<br/>
I am COMPLETELY clueless for the most part on all this network stuff. So, I don't expect a complete answer but at least some stuff to take me on the right path.
<br/>
<br/>
If someone has an example of DS-DS connectivity, it would be nice. *Without liblobby, cuz I've read it's buggy or something*</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168975 - DarkShadow44 - Sun Jun 07, 2009 4:28 pm</h4>
    <div class="postbody"><span class="postbody">Hello, 
<br/>
look <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=16394&amp;postdays=0&amp;postorder=asc&amp;start=15" target="_blank"> here</a> for a example.
<br/>
<br/>
Liblobby doesn't work with the latest libnds/devkitARM, but this should work.
<br/>
<br/>
Use that sample code for sending/receiving a string:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
#include &lt;nds.h&gt; 
<br/>
#include &lt;stdio.h&gt; 
<br/>
#include &lt;dswifi9.h&gt; 
<br/>
#include &lt;string.h&gt; 
<br/>
<br/>
<br/>
char SendData[300];
<br/>
<br/>
char RecvData[300];
<br/>
<br/>
<br/>
<br/>
<br/>
void Handler(int packetID, int readlength) 
<br/>
{ 
<br/>
    unsigned short* data=malloc(1000); 
<br/>
   static int bytesRead; 
<br/>
<br/>
   bytesRead = Wifi_RxRawReadPacket(packetID, readlength, (unsigned short *)data); 
<br/>
   
<br/>
   sprintf(RecvData,"%s", (char*)data+32);
<br/>
} 
<br/>
<br/>
<br/>
<br/>
int main()
<br/>
{
<br/>
   Wifi_InitDefault(false); 
<br/>
   Wifi_SetPromiscuousMode(1); 
<br/>
   Wifi_EnableWifi(); 
<br/>
   Wifi_RawSetPacketHandler(Handler); 
<br/>
   Wifi_SetChannel(10); 
<br/>
<br/>
   while(1)
<br/>
   {
<br/>
       //some stuff
<br/>
      
<br/>
<br/>
<br/>
     //sending:
<br/>
    Wifi_RawTxFrameAdHoc(strlen((char *)SendData) , 0x0014, (unsigned short*)SendData) ;
<br/>
     swiWaitForVBlank();
<br/>
   }
<br/>
return 0;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
SendData is the string to send, RecvData the received string...
<br/>
<br/>
But attention! You receive ALL packets, also those from access points. You have to add a test for checking if it is your packet !
<br/>
<br/>
Wifi_RawTxFrameAdHoc is the renamed Wifi_RawTxFrame function from the other thread, you MUST add it to the the wifi lib and re-compile or it wouldn't work!
<br/>
<br/>
Hope I could help you. ;-)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168982 - Emmanuel - Mon Jun 08, 2009 3:11 am</h4>
    <div class="postbody"><span class="postbody">Didn't work...
<br/>
<br/>
Most recent dswifi from libnds at sourceforge had some errors with some critical point or something functions or something.
<br/>
<br/>
Then, I downloaded the 3392 revision, which did compile and gave no compiling errors.
<br/>
<br/>
I added the function by copy pasting it above the original one, and renamed to the same name +AdHoc. Copy pasted the generated files onto libnds's folder.
<br/>
<br/>
On the example from the other thread, it didn't work. It just said it sent packages but neither DS received them. They froze at the package 200 something.
<br/>
<br/>
On yours, nothing happened, so I added the default console, and an if that would only send the package on a KEY_A press, and would print "Sent" to screen. The "Sent's were printed, but nothing happened on the other end. *tried from both DSs*
<br/>
<br/>
I don't know what I'm doing wrong S: Any further help is welcomed.
<br/>
<br/>
EDIT: IT WORKED! I had forgotten to set the SendData to something instead of a Null array!</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
