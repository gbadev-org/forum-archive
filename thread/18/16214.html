<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>HUD - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > HUD</h2>
<div id="posts">
<div class="post">
    <h4>#164729 - iainprice - Sun Nov 16, 2008 12:19 pm</h4>
    <div class="postbody"><span class="postbody">I'm about to release version 1 of my FPS based on my terrain viewer.....
<br/>
<br/>
I want a HUD, can someone explain how I setup my layers so that I can display an image overtop of my 3D view.
<br/>
<br/>
I think the devkitpro examples are very useful but there doesn't seem to be anything for 2D image over 3D drawing....please point me to it, if I'm wrong :)
<br/>
<br/>
Thanks for your help, my FPS will be called Renegade....will post it soon  :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164730 - Ludo6431 - Sun Nov 16, 2008 1:53 pm</h4>
    <div class="postbody"><span class="postbody">The 3D layer is in the BG0 so put BG0 with a higher priority than BG3 (by exemple) and draw on your BG3.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164731 - iainprice - Sun Nov 16, 2008 6:36 pm</h4>
    <div class="postbody"><span class="postbody">sorry to sound silly but how do i set priority levels? I can set both to active...
<br/>
<br/>
<br/>
|BG_PRIORITY_0
<br/>
<br/>
when i set it active?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164733 - Ludo6431 - Sun Nov 16, 2008 7:10 pm</h4>
    <div class="postbody"><span class="postbody">You don't sound silly ;)
<br/>
Everyone have to learn ;)
<br/>
<br/>
You can do something like this :
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">BG3_CR = BG_BMP16_256x256 | BG_BMP_BASE(0) | BG_PRIORITY(3);
<br/>
// ...
<br/>
BG2_CR = BG_BMP16_256x256 | BG_BMP_BASE(6) | BG_PRIORITY(2);
<br/>
</td> </tr></table><span class="postbody">
<br/>
The BG2 will be ontop of the BG3.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164734 - iainprice - Sun Nov 16, 2008 8:13 pm</h4>
    <div class="postbody"><span class="postbody">Hmmmmm
<br/>
<br/>
I have tried:
<br/>
<br/>
[code]
<br/>
videoSetMode(MODE_5_2D | DISPLAY_BG3_ACTIVE | MODE_5_3D);
<br/>
BG3_CR = BG_BMP16_256x256 | BG_PRIORITY(1);
<br/>
[/code]
<br/>
<br/>
but the mode_5_3d just stamps over the image.... without it the image is shown, with it the 3d is shown, how do i set the priority of the 3d lower than the 2d?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164735 - Cearn - Sun Nov 16, 2008 9:24 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>iainprice wrote:</b></span></td> </tr> <tr> <td class="quote">Hmmmmm
<br/>
<br/>
I have tried:
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">videoSetMode(MODE_5_2D | DISPLAY_BG3_ACTIVE | MODE_5_3D);
<br/>
BG3_CR = BG_BMP16_256x256 | BG_PRIORITY(1);
<br/>
</td> </tr></table><span class="postbody">
<br/>
but the mode_5_3d just stamps over the image.... without it the image is shown, with it the 3d is shown, how do i set the priority of the 3d lower than the 2d?</span></td> </tr></table><span class="postbody">
<br/>
It might help to look up <a class="postlink" href="http://nocash.emubase.de/gbatek.htm#dsvideobgmodescontrol" target="_blank">REG_DISPCNT in GBAtek</a> (and perhaps REG_BG<span style="font-style: italic">x</span>CNT too (where <span style="font-style: italic">x</span> is 0 through 3)) to understand what's going on here. The REG_DISPCNT register controls the main display settings, with different bitfields being used for different capabilities. videoSetMode( ) just puts a value into this register. As it happens, there are no separate modes for 2D and 3D; MODE_<span style="font-style: italic">x</span>_3D is the same as MODE_<span style="font-style: italic">x</span>_2D except that an additional bit is set that indicates BG0 is 3D and not 2D and auto-enables BG 0. 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">// From libnds/include/arm9/video.h:
<br/>
<br/>
#define MODE_5_2D      0x10005
<br/>
<br/>
...
<br/>
<br/>
#define MODE_5_3D    (MODE_5_2D | DISPLAY_BG0_ACTIVE | ENABLE_3D)
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
As for background priorities, these are again also just a bitfield in a control register, in this case REG_BG<span style="font-style: italic">x</span>CNT. There are four priority settings, but these are actually independent of the background number. 
<br/>
<br/>
By default, all priorities are 0. Even if you set your 2D image's background to priority 1, the 3D background (i.e, BG0) is still set to 0. Since the priority marks the 'depth', the 3D BG will appear over the 2D one. If you want the 3D behind something, you need to set its priority to a higher number, not those of the others.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">REG_BG0CNT= BG_PRIORITY(3);
<br/>
<br/>
// set REG_BG3CNT to anything except BG_PRIORITY(3).
<br/>
// For clarity, also always set the TILE/MAP/BMP bases explicitly, 
<br/>
// even if they are 0.
<br/>
REG_BG3CNT = BG_BMP16_256x256 | BG_BMP_BASE(0) | BG_PRIORITY(0); 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>iainprice wrote:</b></span></td> </tr> <tr> <td class="quote">I think the devkitpro examples are very useful but there doesn't seem to be anything for 2D image over 3D drawing....please point me to it, if I'm wrong :) </td> </tr></table><span class="postbody">There is. Go to examples\nds\Graphics\3D\Misc\Mixed_Text_3D.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164736 - iainprice - Sun Nov 16, 2008 10:52 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for your help.... getting there, it's working on ideas emu but not on my R4... hmmmmm
<br/>
<br/>
few more cups of coffee and i'm sure it will work.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164747 - Echo49 - Mon Nov 17, 2008 5:47 am</h4>
    <div class="postbody"><span class="postbody">I would make sure you're initializing everything explicitly. I recently discovered that No$gba (2.6 I think) has the GL_BLEND bit set by default, so although I got everything working the way I wanted on the emulator, it didn't work on the DS until I explicity set that bit.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164751 - elhobbs - Mon Nov 17, 2008 9:42 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>iainprice wrote:</b></span></td> </tr> <tr> <td class="quote">Hmmmmm
<br/>
<br/>
I have tried:
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
videoSetMode(MODE_5_2D | DISPLAY_BG3_ACTIVE | MODE_5_3D);
<br/>
BG3_CR = BG_BMP16_256x256 | BG_PRIORITY(1);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
but the mode_5_3d just stamps over the image.... without it the image is shown, with it the 3d is shown, how do i set the priority of the 3d lower than the 2d?</span></td> </tr></table><span class="postbody">you have the priorities reversed. 0 being the highest priority it will draw over everything. or, you could also think of it as the ds layers them in reverese order - largest number to lowest number, with the lower numbers over-writing the higher numbers.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
videoSetMode(MODE_5_2D | DISPLAY_BG3_ACTIVE | MODE_5_3D);
<br/>
BG3_CR = BG_BMP16_256x256;
<br/>
BG0_CR |= BG_PRIORITY(1);</td> </tr></table><span class="postbody">any pixels on BG3 that are 0 (I think it is really just the high bit clear) will allow BG0 to show through.
<br/>
<br/>
also, using a 16bit background is going to use a lot of texture memory. you may want to consider using an 8bit background at some point. it is not without it's issues though since the vram cannot be written to using 8bit writes.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164753 - iainprice - Mon Nov 17, 2008 10:50 pm</h4>
    <div class="postbody"><span class="postbody">As i was using BG0 and BG3, I needed to set the priority for BG1 and 2 too....
<br/>
<br/>
All working, thank you for your help..... oh yeah and thanks for pointing me to a useful example.....</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
