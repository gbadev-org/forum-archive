<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>ARM9 speed test results - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > ARM9 speed test results</h2>
<div id="posts">
<div class="post">
    <h4>#40221 - DekuTree64 - Sat Apr 16, 2005 9:20 am</h4>
    <div class="postbody"><span class="postbody"><a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=5434&amp;start=15" target="_blank">We argued</a>, I made a tester.
<br/>
Get it <a class="postlink" href="http://deku.gbadev.org/program/dsspeed.zip" target="_blank">here</a>, and run it on passme (crashes Dualis, appearently doesn't support ITCM, or doesn't like moving the TCMs around). It should build straight away if you call make in the main folder. The build.bat there is for me to build from MS visual studio, and has my specific paths in it, so it probably won't work.
<br/>
<br/>
The app just runs a series of tests and prints out the cycles they used (plus a few to start/stop the timer to count them). If you know a little ARM assembly, it should be easy to add more tests. Just write a little function (follows APCS), and branch to it the way all the others do. I marked the 2 places where you need to add things with CHANGEME, for easy searching to.
<br/>
<br/>
The code is copied to ITCM, which is mapped to address 0 (and mirrored up to 0x2000000). DTCM is mapped to 0x2FFC000 during the tests. No real reason for those addresses other than that I like them there, because they're both in branching range from main RAM, and easy to get to with immediates in assembly :)
<br/>
The stack is put out in main RAM at 0x02300000, because of the DTCM being yanked out from under it.
<br/>
<br/>
<br/>
<br/>
So then, results. It seems to act just like I expected, with most things taking 1 cycle, or taking the same as GBA in the case of an interlock. For example, a lone ldr instruction takes 1 cycle, but an ldr followed but an add involving the loaded value takes 3 cycles.
<br/>
<br/>
A plain subs, bne loop takes 4 cycles each pass, same as GBA.
<br/>
<br/>
Main RAM waitstates are killer, taking 18 cycles to load a word, and locking the CPU during that. They're much friendlier on ldmia, taking 46 cycles to load 8 words.
<br/>
<br/>
An ldr from DTCM takes 1 cycle normally. 2 consecutive loads takes 2 cycles. An ldmia with 8 regs takes 8 cycles. Awesomeness.
<br/>
<br/>
DSP instructions (I only checked smulxy and qadd) take 1 cycle, or 2 cycles if the next instruction uses the result. Bummer, because it would be really nice to just smulxy, qdadd, smulxy, qdadd, etc. to do sound filtering and stuff. Oh well, if you use smlaxy repeatedly and just make sure you won't overflow, it's only 1 cycle each, and won't interlock (not tested, but the docs say).
<br/>
<br/>
<br/>
<br/>
So, I think the only thing that will ever be slower than the ARM7 will be mov/ldr to the PC, which I think was 1 more cycle (forgot to try it, and too sleepy now). Since branch is the normal way to get around and it's still the same speed, ARM9 is better in almost every way.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#40244 - tepples - Sat Apr 16, 2005 4:10 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>DekuTree64 wrote:</b></span></td> </tr> <tr> <td class="quote">DSP instructions (I only checked smulxy and qadd) take 1 cycle, or 2 cycles if the next instruction uses the result. Bummer, because it would be really nice to just smulxy, qdadd, smulxy, qdadd, etc. to do sound filtering and stuff.</td> </tr></table><span class="postbody">
<br/>
Use an extra register and keep the smulxy's one loop cycle ahead of the qdadd's, and I'm guessing it won't interlock.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
