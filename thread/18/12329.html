<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Extended Sprite Palettes broken in latest devkitpro release - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Extended Sprite Palettes broken in latest devkitpro release</h2>
<div id="posts">
<div class="post">
    <h4>#117174 - dannyboy - Fri Feb 02, 2007 1:43 am</h4>
    <div class="postbody"><span class="postbody">Well, I decided to update to the newest ndslib, and I've got everything working except for this one thing. I got the complex_2d demo up and running and expanded it to getting more than one type of sprite working with the SPRITE_PALETTE_SUB. But when I try extended palettes they no longer work. The sprites just comes out black. Heres the relevent bits of code:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define NUM_SPRITES 20
<br/>
vramSetBankI(VRAM_I_SUB_SPRITE_EXT_PALETTE);
<br/>
<br/>
void SetPaletteColours(u8 PaletteID, sImage Image)
<br/>
{
<br/>
    int offset = PaletteID * 256;
<br/>
    vramSetBankI(VRAM_I_LCD);   // Open VRAM for writing palette
<br/>
    for (int i = 0; i &lt; 256; i++) {
<br/>
        VRAM_I[offset + i] = Image.palette[i];
<br/>
    }
<br/>
    vramSetBankI(VRAM_I_SUB_SPRITE_EXT_PALETTE);
<br/>
}
<br/>
<br/>
void LoadImage(unsigned char* pcxFile, int id)
<br/>
{
<br/>
    int offset = id*32*16;           // offset in memory for multiple sprites
<br/>
    sImage Image;
<br/>
    
<br/>
    loadPCX(pcxFile, &amp;Image);           // load our pcx file into an image
<br/>
    imageTileData(&amp;Image);              // tile it so it is useful as sprite data
<br/>
<br/>
    for(int i = 0; i &lt; 32*16; i++) { SPRITE_GFX_SUB[offset + i] = Image.image.data16[i]; }
<br/>
    SetPaletteColours(id, Image);
<br/>
<br/>
  // the following line is for the standard palette. If it is commented out then sprites
<br/>
  // come out black. Otherwise they default to this palette.
<br/>
  if (id == 0) { for (int i = 0; i &lt; 256; i++) { SPRITE_PALETTE_SUB[i] = Image.palette[i]; } }
<br/>
}
<br/>
<br/>
void LoadSprites()
<br/>
{
<br/>
    LoadImage((u8*)two_pcx, 1);
<br/>
    LoadImage((u8*)three_pcx, 0);
<br/>
    
<br/>
   initOAM(); // turn off sprites
<br/>
   for(int i = 0; i &lt; NUM_SPRITES; i++) {
<br/>
      //random place and speed
<br/>
      sprites[i].x = rand() &amp; 0xFFFF;
<br/>
      sprites[i].y = rand() &amp; 0x7FFF;
<br/>
      sprites[i].dx = (rand() &amp; 0xFF) + 0x100;
<br/>
      sprites[i].dy = (rand() &amp; 0xFF) + 0x100;
<br/>
      if(rand() &amp; 1) { sprites[i].dx = -sprites[i].dx; }
<br/>
      if(rand() &amp; 1) { sprites[i].dy = -sprites[i].dy; }
<br/>
<br/>
      sprites[i].oam = &amp;OAMCopySub[i];
<br/>
      
<br/>
      sprites[i].gfxID = 0;
<br/>
      if (i &lt; 10) { sprites[i].gfxID = 1; }
<br/>
<br/>
      //set up our sprites OAM entry attributes
<br/>
      sprites[i].oam-&gt;attribute[0] = ATTR0_COLOR_256 | ATTR0_SQUARE;
<br/>
      sprites[i].oam-&gt;attribute[1] = ATTR1_SIZE_32;
<br/>
     sprites[i].oam-&gt;attribute[2] = ATTR2_PALETTE(sprites[i].gfxID) | sprites[i].gfxID*32;
<br/>
    }
<br/>
}
<br/>
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117231 - Mollusk - Fri Feb 02, 2007 5:03 pm</h4>
    <div class="postbody"><span class="postbody">When updating, it screwed up my default vram settings, but once fixed the extended palettes still worked :/<br/>_________________<br/>PAlib official forum : <a class="postlink" href="http://www.palib.info" target="_blank">http://www.palib.info</a>
<br/>
PAlib official tutorials: <a class="postlink" href="http://www.palib.info/wiki" target="_blank">http://www.palib.info/wiki</a>
<br/>
Updates, help, code examples, tutorials, etc...</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
