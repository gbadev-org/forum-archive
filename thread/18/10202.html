<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>BMP to Raw > conv.exe (?) - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > BMP to Raw > conv.exe (?)</h2>
<div id="posts">
<div class="post">
    <h4>#90909 - HtheB - Mon Jul 03, 2006 12:43 pm</h4>
    <div class="postbody"><span class="postbody">Hi, I want to convert .bmp to .raw..
<br/>
I tried many tools that I could find (yes.. even on gbadev)
<br/>
It didnt work with any application.. (it wont work on the DS)
<br/>
<br/>
I had conv.exe.. (it was the best so far..) but.. does anyone has the conv.exe? b/c I think I have a corrupted version of it.. (the images works.. but its VERY weird..)
<br/>
<br/>
<br/>
if someone know where to find it.. please tell me ^_^
<br/>
<br/>
tnq! :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#90921 - silent_code - Mon Jul 03, 2006 2:19 pm</h4>
    <div class="postbody"><span class="postbody">use usenti and/or (win)git (google for it ;) )... should solve your problems (except for 16bit images)...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#90930 - LiraNuna - Mon Jul 03, 2006 3:47 pm</h4>
    <div class="postbody"><span class="postbody">what format you need the .raw as? 16col, 256col 32kcol ?
<br/>
if it's one of those, gfx2gba is what you're looking for.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">gfx2gba -c[16/256/32k] img.bmp</td> </tr></table><span class="postbody"><br/>_________________<br/>Private property.
<br/>
Violators will be shot, survivors will be shot again.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#90938 - HtheB - Mon Jul 03, 2006 4:56 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>silent_code wrote:</b></span></td> </tr> <tr> <td class="quote">use usenti and/or (win)git (google for it ;) )... should solve your problems (except for 16bit images)...</td> </tr></table><span class="postbody">
<br/>
Tried out allready ;)
<br/>
didnt work..
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>LiraNuna wrote:</b></span></td> </tr> <tr> <td class="quote">what format you need the .raw as? 16col, 256col 32kcol ?
<br/>
if it's one of those, gfx2gba is what you're looking for.
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">gfx2gba -c[16/256/32k] img.bmp</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
<br/>
Allready tried out.. didn't work eather..
<br/>
<br/>
<br/>
its 24bit bmp format.. ^_^
<br/>
so.... I really need that conv.exe its the only way :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#90942 - silent_code - Mon Jul 03, 2006 5:11 pm</h4>
    <div class="postbody"><span class="postbody">then just save it in 16 or 8 bit ;) that way you'll be able to use gfx2gba or the tools i mentioned... shouldn't be a problem ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#90943 - Cearn - Mon Jul 03, 2006 5:29 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HtheB wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>silent_code wrote:</b></span></td> </tr> <tr> <td class="quote">use usenti and/or (win)git (google for it ;) )... should solve your problems (except for 16bit images)...</td> </tr></table><span class="postbody">
<br/>
Tried out allready ;)
<br/>
didnt work..</span></td> </tr></table><span class="postbody">
<br/>
Could you define 'didn't work' here? Apart from the alpha bit, these tools should give the proper result even for 24bit images.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#91043 - HtheB - Tue Jul 04, 2006 6:41 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cearn wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HtheB wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>silent_code wrote:</b></span></td> </tr> <tr> <td class="quote">use usenti and/or (win)git (google for it ;) )... should solve your problems (except for 16bit images)...</td> </tr></table><span class="postbody">
<br/>
Tried out allready ;)
<br/>
didnt work..</span></td> </tr></table><span class="postbody">
<br/>
Could you define 'didn't work' here? Apart from the alpha bit, these tools should give the proper result even for 24bit images.</span></td> </tr></table><span class="postbody">Ok, I will make pictures and show them.. (really its horrible :( )</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#91151 - silent_code - Tue Jul 04, 2006 10:27 pm</h4>
    <div class="postbody"><span class="postbody">you better do ;)
<br/>
<br/>
it sounds like it's a code problem... i'm using 24bit .bmp files with usenti and (win)git and the only problem i have is the 24 to 16bit conversion of my raytraced images :( (look at the other thread about that problem).
<br/>
but that's nothing to do with the tools.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#91217 - HtheB - Wed Jul 05, 2006 10:55 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>silent_code wrote:</b></span></td> </tr> <tr> <td class="quote">you better do ;)
<br/>
<br/>
it sounds like it's a code problem... i'm using 24bit .bmp files with usenti and (win)git and the only problem i have is the 24 to 16bit conversion of my raytraced images :( (look at the other thread about that problem).
<br/>
but that's nothing to do with the tools.</td> </tr></table><span class="postbody">this is what it says in the <span style="font-weight: bold">conv.cpp</span>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include &lt;stdio.h&gt;
<br/>
<br/>
typedef unsigned short ushort;
<br/>
typedef unsigned char byte;
<br/>
typedef unsigned int uint;
<br/>
<br/>
#define RGB(r,g,b) ((1 &lt;&lt; 15) | (r) | ((g) &lt;&lt; 5) | ((b) &lt;&lt; 10))
<br/>
//#define RGB(r,g,b) ((b) | ((g) &lt;&lt; 6) | ((r) &lt;&lt; 11))
<br/>
<br/>
<br/>
char *dumpFile(char* name) {
<br/>
   char *font;
<br/>
   int size;
<br/>
   
<br/>
   FILE *fd = fopen(name, "r");
<br/>
   fseek(fd, 0, SEEK_END);
<br/>
   size = ftell(fd);
<br/>
   fseek(fd, 0, SEEK_SET);
<br/>
   font = new char[size];
<br/>
   fread(font, 1, size, fd);
<br/>
   fclose(fd);
<br/>
   
<br/>
   return font;
<br/>
}
<br/>
<br/>
int main(int argc, char** argv) {   
<br/>
   byte rgb[3];
<br/>
   ushort *dataOff;
<br/>
   int off, pad;
<br/>
   char *file = dumpFile(argv[1]);
<br/>
   char *fileOff;
<br/>
   uint width, height;
<br/>
   int size;
<br/>
   ushort * data;
<br/>
   
<br/>
   width = *(uint*)(file + 18);
<br/>
   height = *(uint*)(file + 22);
<br/>
   data = new ushort[width * height];
<br/>
   size = width * height * 2;
<br/>
      
<br/>
   off = 0;
<br/>
   pad = (3000 - width * 3) &amp; 3;
<br/>
   
<br/>
   fileOff = file + 0x36;
<br/>
   dataOff = data + (height - 1) * width;
<br/>
   for (int y = 0; y &lt; height; y++) {
<br/>
      for (int x = 0; x &lt; width; x++) {
<br/>
         rgb[0] = (byte)(*fileOff++);
<br/>
         rgb[1] = (byte)(*fileOff++);
<br/>
         rgb[2] = (byte)(*fileOff++);
<br/>
         dataOff[x] = RGB(rgb[2] &gt;&gt; 3, 
<br/>
               rgb[1] &gt;&gt; 3, 
<br/>
               rgb[0] &gt;&gt; 3);
<br/>
      }
<br/>
      dataOff -= width;
<br/>
      fileOff += pad;
<br/>
   }
<br/>
   
<br/>
   
<br/>
   FILE *fd = fopen(argv[2], "w");
<br/>
   rgb[0] = height;
<br/>
   rgb[1] = width;
<br/>
   fwrite(rgb, 1, 2, fd);
<br/>
   fwrite(data, size, 1, fd);
<br/>
   fclose(fd);
<br/>
   
<br/>
   delete[] (file);
<br/>
}</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#91239 - HtheB - Wed Jul 05, 2006 3:49 pm</h4>
    <div class="postbody"><span class="postbody">when I compile it.. and use it (conv.exe) I still get corrupted pictures :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#91246 - Cearn - Wed Jul 05, 2006 5:13 pm</h4>
    <div class="postbody"><span class="postbody">That conv.exe works fine*, you're either not giving it the right kind of bitmap, or using the data it produces wrongly. Check your video mode settings.
<br/>
<br/>
<span style="font-size: 9px; line-height: normal">* Though it's a minor miracle: no comments, magic numbers galore  and <span style="font-style: italic">no</span> safety checks of any kind. The thing expects a 24bpp, version 3, bottom-up windows bitmap, where the width is a multiple of 4, but doesn't mention that anywhere. These conditions are probably met for your bitmap, but anything else will probably hang or crash the program, or worse: give incorrect output. The fact that the fopen() calls do not explicitly use binary mode is also slightly worrying; I'm not 100% sure, but that may give bad results if bytes are 0x0A ('\n') or 0x0D ('\r').
<br/>
Also note that the first 2 bytes give the size of the bitmap. Again, not documented, and would be wrong for DS-screensized bitmaps or larger.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#91263 - HtheB - Wed Jul 05, 2006 7:12 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cearn wrote:</b></span></td> </tr> <tr> <td class="quote">That conv.exe works fine*, you're either not giving it the right kind of bitmap, or using the data it produces wrongly. Check your video mode settings.
<br/>
<br/>
<span style="font-size: 9px; line-height: normal">* Though it's a minor miracle: no comments, magic numbers galore  and <span style="font-style: italic">no</span> safety checks of any kind. The thing expects a 24bpp, version 3, bottom-up windows bitmap, where the width is a multiple of 4, but doesn't mention that anywhere. These conditions are probably met for your bitmap, but anything else will probably hang or crash the program, or worse: give incorrect output. The fact that the fopen() calls do not explicitly use binary mode is also slightly worrying; I'm not 100% sure, but that may give bad results if bytes are 0x0A ('\n') or 0x0D ('\r').
<br/>
Also note that the first 2 bytes give the size of the bitmap. Again, not documented, and would be wrong for DS-screensized bitmaps or larger.</span></td> </tr></table><span class="postbody">YES!!! I GOT IT TO WORK!!!
<br/>
<br/>
i changed:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">FILE *fd = fopen(name, "r");</td> </tr></table><span class="postbody">
<br/>
and 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">FILE *fd = fopen(argv[2], "w");</td> </tr></table><span class="postbody">
<br/>
<br/>
into:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">FILE *fd = fopen(name, "rb");</td> </tr></table><span class="postbody">
<br/>
and
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">FILE *fd = fopen(argv[2], "wb");</td> </tr></table><span class="postbody">
<br/>
<br/>
and it works! tnx for all help everyone! :)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
