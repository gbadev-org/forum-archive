<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Beginner:Understanding VRAM Mapping and Memory Banks - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Beginner:Understanding VRAM Mapping and Memory Banks</h2>
<div id="posts">
<div class="post">
    <h4>#149481 - krozen - Sun Jan 20, 2008 10:12 pm</h4>
    <div class="postbody"><span class="postbody">Hi guys,
<br/>
I have some GBA experience, and have decided to make the move over to DS programming. The one thing that is holding me back at the minute is VRAM memory mapping - I just can't get my head around it, and it's placed a complete road block on my progression with DS programming.
<br/>
<br/>
The way I figure it is as follows: The DS doesn't tie memory to specific modes. Rather, you first choose the mode you want, and then choose which memory you would like to use for it. So, you can choose Mode 3 with extended background, and then decide to use VRAM Bank A to store the relevant bitmap data. BUT, all seems to map to 0x06000000 anyway! (from what I can make out from the #defines)
<br/>
<br/>
I guess my main issue is understanding why mapping is used, rather than just having dedicated parts of memory to different tasks. Would someone be able to explain the basics of it to me (perhaps using a practical example of how different memory mappings would be used in a game)?
<br/>
<br/>
Thanks a million for your help</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#149500 - Dwedit - Mon Jan 21, 2008 5:45 am</h4>
    <div class="postbody"><span class="postbody">Go to <a href="http://nocash.emubase.de/gbatek.htm#dsmemorycontrolvram" target="_blank">http://nocash.emubase.de/gbatek.htm#dsmemorycontrolvram</a> (gbatek is about a megabyte of html, takes a while to load)
<br/>
Scroll down to the part where it says
<br/>
"There is a total of 656KB of VRAM in Blocks A-I.
<br/>
Table below shows the possible configurations."
<br/>
<br/>
Use the table to help you assign named banks to a graphics feature.
<br/>
Here you can see that there are many possible overlapping ways to do this stuff.
<br/>
So let's say you wanted to assign 128KB of VRAM to Engine A Background, Engine A sprites, Engine B Background, and Engine B sprites.
<br/>
You'd assign  "bank A" to engine A's background, "bank B" to engine A's sprites, "bank C" to engine B's background, and "bank D" to engine B's sprites.
<br/>
<br/>
To use Libnds to assign the VRAM:
<br/>
Look in C:\devkitpro\libnds\include\nds\arm9\video.h for reference as to what names you can use.
<br/>
<br/>
For the above example, we could use this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">vramSetBankA(VRAM_A_MAIN_BG_0x06000000);
<br/>
vramSetBankB(VRAM_B_MAIN_SPRITE_0x06400000);
<br/>
vramSetBankC(VRAM_C_SUB_BG_0x06200000);
<br/>
vramSetBankD(VRAM_D_SUB_SPRITE);   //this is mapped at 0x06600000</td> </tr></table><span class="postbody">
<br/>
<br/>
And then we can access bank A at 06000000, bank B at 06400000, bank C at 06200000, and bank D at 06600000.
<br/>
<br/>
You can also just as easily pick different addresses, such as
<br/>
vramSetBankA(VRAM_A_MAIN_BG_0x06020000);
<br/>
then Bank A would be mapped to 06020000, not 06000000.
<br/>
<br/>
Here's another example, where we assign 256k to Engine A's background, 256k to Engine A's sprites, 32k to Engine B's background, and 16k to Engine B's sprites:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">vramSetBankA(VRAM_A_MAIN_SPRITE_0x06400000);
<br/>
vramSetBankB(VRAM_B_MAIN_SPRITE_0x06420000);
<br/>
vramSetBankC(VRAM_C_MAIN_BG_0x06000000);
<br/>
vramSetBankD(VRAM_D_MAIN_BG_0x06020000);
<br/>
vramSetBankH(VRAM_H_SUB_BG); //32k located at 0x06200000
<br/>
vramSetBankI(VRAM_I_SUB_SPRITE); //16k located at 0x06600000</td> </tr></table><span class="postbody"><br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#149542 - krozen - Mon Jan 21, 2008 9:56 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for your detailed explanation, Dwedit. I think I'm finally getting a grasp on this.
<br/>
So, the DS is far more flexible as regards VRAM the GBA. So, this means that if you have some application that is heavy on tiles, and only uses a few sprites, you can have more memory for tile data by reducing the amount of VRAM used for sprites. And, if you are using more sprite memory on the top screen than on the top, you can assign more sprite memory to the top screen than the bottom screen.
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">You can also just as easily pick different addresses, such as
<br/>
vramSetBankA(VRAM_A_MAIN_BG_0x06020000);
<br/>
then Bank A would be mapped to 06020000, not 06000000. </td> </tr></table><span class="postbody">
<br/>
<br/>
How would this impact on your application? Why would you want to do something like this - can you then use 06000000 for storing some sprite data, for example?
<br/>
<br/>
Thanks again for your help!</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
