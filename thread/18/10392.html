<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>sprite on a 3d background - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > sprite on a 3d background</h2>
<div id="posts">
<div class="post">
    <h4>#93029 - iainprice - Sun Jul 16, 2006 4:38 pm</h4>
    <div class="postbody"><span class="postbody">Is it possible to display a sprite when you are using a screen for 3D?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93044 - tepples - Sun Jul 16, 2006 6:53 pm</h4>
    <div class="postbody"><span class="postbody">Make sure that the sprite's priority is equal to or less than (that is, in front of) that of BG0 and it should work. Or use a quad.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93049 - iainprice - Sun Jul 16, 2006 7:22 pm</h4>
    <div class="postbody"><span class="postbody">Are there any tutorials or examples of sprites on 3d backgrounds?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#96891 - walaber - Sun Aug 06, 2006 5:43 am</h4>
    <div class="postbody"><span class="postbody">hmmm, so I can't seem to get this to work... I have set the 3D bg (BG_0) priority high like so:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">BG0_CR = BG_PRIORITY_3;</td> </tr></table><span class="postbody">
<br/>
<br/>
and when creating the sprite i set the priority to 0:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">mOAM-&gt;attribute[0] = ATTR0_COLOR_256 | ATTR0_SQUARE;
<br/>
mOAM-&gt;attribute[1] = ATTR1_SIZE_64;
<br/>
mOAM-&gt;attribute[2] = 0 | ATTR2_PRIORITY(0);</td> </tr></table><span class="postbody">
<br/>
<br/>
but not sprite...  if I change the video mode from MODE_0_3D to MODE_0_2D, obviously no 3D, but the sprite is there.
<br/>
<br/>
what am I doing wrong to get the sprites to show up over the 3D bg?
<br/>
<br/>
[edit]
<br/>
Spoke too soon, it works fine on my hardware, just not on Dualis :P<br/>_________________<br/>Go Go Gadget NDS!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#96914 - omaremad - Sun Aug 06, 2006 3:37 pm</h4>
    <div class="postbody"><span class="postbody">use MODE5_3D
<br/>
<br/>
it has full 2d and 3d capabilities :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104549 - Dark Knight ez - Sat Sep 30, 2006 11:34 am</h4>
    <div class="postbody"><span class="postbody">Sorry to resurrect an old topic, but I can't get sprites working on 3D either.
<br/>
My relevant pieces of code:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">    SpriteEntry sprites[128];
<br/>
<br/>
    videoSetMode(MODE_0_3D |
<br/>
                 DISPLAY_SPR_ACTIVE |    //turn on sprites
<br/>
                 DISPLAY_SPR_1D |        //this is used when in tile mode
<br/>
                 DISPLAY_SPR_1D_BMP      //and this in bitmap mode
<br/>
                );
<br/>
    BG0_CR = BG_PRIORITY_3;
<br/>
    
<br/>
    vramSetBankA(VRAM_A_TEXTURE);
<br/>
    vramSetBankB(VRAM_B_TEXTURE);
<br/>
    vramSetBankC(VRAM_C_SUB_BG);
<br/>
    vramSetBankD(VRAM_D_SUB_SPRITE);
<br/>
    vramSetBankE(VRAM_E_MAIN_SPRITE);
<br/>
<br/>
    initSpritesMain(sprites, 128);
<br/>
<br/>
    handlePowerupsSpritesMain(sprites, 128);
<br/>
<br/>
    unsigned int i;
<br/>
    for(i=0; i &lt; 128 * sizeof(SpriteEntry) / 4; i++)
<br/>
       ((uint32*)OAM)[i] = ((uint32*)sprites)[i];</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
where initSpritesMain is:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void initSpritesMain(SpriteEntry *sprites, int array_size) {
<br/>
    unsigned int i;
<br/>
    for (i=0; i&lt;array_size; i++)
<br/>
      sprites[i].attribute[0] = ATTR0_DISABLED;
<br/>
       
<br/>
    memcpy((uint16 *)SPRITE_PALETTE, sprite_pal_bin, sprite_pal_bin_size);
<br/>
    
<br/>
   //copy the sprite grahics for autoblaster
<br/>
    for (i=0; i&lt; (powerup_autoblaster_bin_size &gt;&gt; 1); i++)
<br/>
        SPRITE_GFX[i] = ((uint16*)powerup_autoblaster_bin)[i];
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
and handlePowerupsSpritesMain is:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void handlePowerupsSpritesMain(SpriteEntry *sprites, int array_size) {
<br/>
    int i;
<br/>
    
<br/>
    // init all sprites to nothing before we start
<br/>
    for (i=0; i&lt;array_size; i++)
<br/>
        sprites[i].attribute[0] = ATTR0_DISABLED;
<br/>
        
<br/>
    sprites[0].attribute[0] = ATTR0_COLOR_256 | ATTR0_SQUARE | 155;
<br/>
    sprites[0].attribute[1] = ATTR1_SIZE_32 | 219;
<br/>
    sprites[0].attribute[2] = ATTR2_PRIORITY(0);
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
For debugging purposes, I tried to display the sprite graphics on the sub screen, and that worked without a hitch. That leaves me to think it's a problem with the priorities, or maybe the copying to OAM... I don't know.
<br/>
If someone has any ideas, or is willing to share some sourcecode with me that succesfully implemented sprites on top of 3D, I'd appreciate it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104682 - omaremad - Sun Oct 01, 2006 3:24 pm</h4>
    <div class="postbody"><span class="postbody">I dont know much about mode 0 3D but i use ode 5 3D and it behaves exactly like mode 5 2D even with sprites.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104720 - Dark Knight ez - Sun Oct 01, 2006 9:55 pm</h4>
    <div class="postbody"><span class="postbody">Changing from mode 0 3D to mode 5 3D didn't help.
<br/>
Can I take a look at your code?
<br/>
<br/>
edit:
<br/>
When I disable all 3D stuff in my code and switch to mode 0 2D, the sprites are properly displayed. That means either I handle priorities wrong and the sprites are displayed behind the 3D scene, or ... ?
<br/>
<br/>
Priorities shouldn't be an issue though. I set the sprites priority to 0, meaning that should be displayed on top of everything. Being highest priority and all and should even be shown on top of BGs with priority 0.
<br/>
<br/>
What do you people use as videoSetMode(..); precisely?
<br/>
<br/>
<br/>
2nd edit:
<br/>
Bah. I know what I did wrong. Every frame I inited 3D again with a function. In that function, I kept setting the video mode to MODE_0_3D, and not enabling the sprites there as well. Commented that stuff out (it's unnecessary to be there anyway) and all is good. That's what you get when you've been working on a project for so long that you forget some of the stuff you've done to make it all work.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
