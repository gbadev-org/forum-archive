<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>EXT BG and transparent colors ? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > EXT BG and transparent colors ?</h2>
<div id="posts">
<div class="post">
    <h4>#121653 - alekmaul - Tue Mar 13, 2007 7:53 pm</h4>
    <div class="postbody"><span class="postbody">Hello everyone !
<br/>
I request your help because I have a little pb with my last try to write an emulator ...
<br/>
I want to use 2 ext bg but I can't have a transparent color, only the BG with the highest priority is display, do you know how to setup them to use transparent EXT BGs.
<br/>
Here is my init code of my BGs :
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void BitmapInitArcadeMode(void) { 
<br/>
#define SCRGNGH 234
<br/>
<br/>
  // Init graphic mode
<br/>
  vramSetMainBanks( VRAM_A_MAIN_BG_0x6000000, VRAM_B_MAIN_BG_0x6020000, VRAM_C_SUB_BG_0x6200000 , VRAM_D_MAIN_BG_0x6040000 );
<br/>
  vramSetBankE(VRAM_E_MAIN_SPRITE);
<br/>
  videoSetMode(MODE_5_2D | DISPLAY_BG3_ACTIVE | DISPLAY_BG2_ACTIVE | DISPLAY_SPR_1D | DISPLAY_SPR_ACTIVE );
<br/>
<br/>
  BG3_CR = BG_BMP8_512x512 | BG_BMP_BASE(0) | BG_PRIORITY(2) | BG_WRAP_ON;
<br/>
  BG3_XDX = 1 &lt;&lt; 8;
<br/>
  BG3_XDY = 0;
<br/>
  BG3_YDX = 0;
<br/>
  BG3_YDY = ((SCRGNGH / 192) &lt;&lt; 8) | ((SCRGNGH % 192) ) ; 
<br/>
  BG3_CX = 0;
<br/>
  BG3_CY = 0;
<br/>
<br/>
  BG2_CR = BG_BMP8_256x256 | BG_BMP_BASE(16) | BG_PRIORITY(0);
<br/>
  BG2_XDX = 1 &lt;&lt; 8;
<br/>
  BG2_XDY = 0;
<br/>
  BG2_YDX = 0;
<br/>
  BG2_YDY = ((SCRGNGH / 192) &lt;&lt; 8) | ((SCRGNGH % 192) ) ; 
<br/>
  BG2_CX = 0;
<br/>
  BG2_CY = 0;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Also , my code works fine with Dualis but not with no$gba (the best emulator ?)
<br/>
<br/>
How, i forgot that : it is for a Ghost 'n goblins arcade emulator :D !</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121655 - Dark Knight ez - Tue Mar 13, 2007 8:13 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">but I can't have a transparent color</td> </tr></table><span class="postbody">
<br/>
Set a pixel's value to 0. That should work.
<br/>
<br/>
For instance... if you would have a 128x128 bitmap (using extended rotation background) and it's using BG_BMP_BASE(0), then the following should work:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">for (i=0; i&lt;(128*128); i++) // (128*128) being the size of this BG
<br/>
        BG_GFX[i] = 0; // does not show up, not having set BIT(15)</td> </tr></table><span class="postbody">
<br/>
<br/>
Hope that helps you out.<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><a class="postlink" href="http://amplituds.drunkencoders.com" target="_blank">AmplituDS website</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121656 - alekmaul - Tue Mar 13, 2007 8:15 pm</h4>
    <div class="postbody"><span class="postbody">hum ... i've made that but only the second BG is displayed (BG2 in my example)
<br/>
and all is ok in dualis of course :/ ....
<br/>
And you talked about bit15 but i am using 8bits BGs not 16bits, so I must use palette entries</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121664 - Sausage Boy - Tue Mar 13, 2007 8:46 pm</h4>
    <div class="postbody"><span class="postbody">Unless someone has made an edit, DKe doesn't mention bit15. What he means is set the pixels value, where you normally would select which palette entry to use, to 0.
<br/>
<br/>
EDIT:
<br/>
<br/>
Oh sorry, I guess I was the one who didn't read carefully enough... Do what I said anyways, it'll hopefully work. :)<br/>_________________<br/>"no offense, but this is the gayest game ever"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121739 - Dark Knight ez - Wed Mar 14, 2007 12:51 pm</h4>
    <div class="postbody"><span class="postbody">If transparency can't be done in 8-bit bmps, here's a workaround... which you probably don't like.
<br/>
You could make BG2 (the one which is on top) to be a 16-bit background. That would in fact fit in your current VRAM setup and transparency works like I suggested.
<br/>
Drawing it would be somewhat less straightforward, but you can always do for each pixel: check what you would have written if it were 8-bit bmp, look up that palette entry in the palette you have and write that value (ORed with Bit(15)) into the 16-bit bmp.
<br/>
<br/>
Hope I didn't make any bad assumptions here or what-not. Just thought I'd try and help as much as I am able to.<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><a class="postlink" href="http://amplituds.drunkencoders.com" target="_blank">AmplituDS website</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121741 - alekmaul - Wed Mar 14, 2007 1:11 pm</h4>
    <div class="postbody"><span class="postbody">No, your idea is nice and I though about it but the pb is that it will be too slow for the emulator (I will have to write a 16 bit for each pixel so it will be 2x slow than now ...).
<br/>
So I can't use this workaround... but it was a good idea, thanks for that ;).
<br/>
<br/>
[EDIT]Here is a screen to the game, running with Dualis
<br/>
<a href="http://s199285089.onlinehome.fr/media/DS/GnRun/gnrunwip03.png">[Images not permitted - Click here to view it]</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121746 - Dark Knight ez - Wed Mar 14, 2007 2:18 pm</h4>
    <div class="postbody"><span class="postbody">Nice screenshot. :)
<br/>
<br/>
I forgot to ask this. Does the transpancy also not work on a real NDS? You only talked about Dualis and no$gba.
<br/>
<br/>
Anyway, maybe my solution is too slow for an emulator, but if it's fast enough on the NDS itself... then you could still use it when you test on real hardware instead of Dualis.
<br/>
<br/>
I, unfortunately, see no other solutions. Except maybe to use just one BG, but I think that would be even worse, seeing as how you probably use the larger one for a scene-background which needs little updating, and the smaller one for things that can move around.<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><a class="postlink" href="http://amplituds.drunkencoders.com" target="_blank">AmplituDS website</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121753 - alekmaul - Wed Mar 14, 2007 3:00 pm</h4>
    <div class="postbody"><span class="postbody">Oh yes, I forgot to talk about the DS, the pb is identical than on no$gba :( only the first background is displayed ...
<br/>
And the two background have different size, also the last background is scrolling so I can't combine them to make only one background.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121758 - alekmaul - Wed Mar 14, 2007 4:32 pm</h4>
    <div class="postbody"><span class="postbody">double post to say that the topic can be close, the pb was not in the bg initialization, it works fine, it was with the scrolling registers BGx_CX and BGx_CY.
<br/>
it seems that Dualis does not do correct usage of the registers in bitmap mode. 
<br/>
Thanks for the help every one ;)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
