<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>sscanf() and float weirdness? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > sscanf() and float weirdness?</h2>
<div id="posts">
<div class="post">
    <h4>#160521 - ragefury32 - Thu Jul 17, 2008 5:59 am</h4>
    <div class="postbody"><span class="postbody">Hm.  So I ran into a weird problem with sccanf() - 
<br/>
<br/>
So I have a block of code that look something like this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
  while((recv(my_socket, p, 1, 0) != 0) || i &lt; 2000) { 
<br/>
<br/>
  if (*p == '\n') {
<br/>
    *p = '\0';
<br/>
    char *area = linebuf;
<br/>
    char *rest = strchr(linebuf, '|');
<br/>
        *rest = '\0';
<br/>
             p = linebuf;
<br/>
            i = 0;
<br/>
<br/>
   char * cptr = NULL;
<br/>
   char pipe[] = "|";   
<br/>
   
<br/>
   printf("%s\n", rest+1);
<br/>
   
<br/>
      cptr = strtok(rest+1, pipe);
<br/>
      sscanf(cptr, "%4d", &amp;tagid);
<br/>
      iprintf("%4d, %f, %f, %f, %d\n", tagid, tx, ty, tz, flags); 
<br/>
       cptr = strtok( NULL, pipe);
<br/>
      sscanf(cptr, "%f", &amp;tx);
<br/>
      iprintf("%4d, %f, %f, %f, %d\n", tagid, tx, ty, tz, flags); 
<br/>
       cptr = strtok( NULL, pipe);
<br/>
      sscanf(cptr, "%f", &amp;tz);
<br/>
      iprintf("%4d, %f, %f, %f, %d\n", tagid, tx, ty, tz, flags); 
<br/>
      cptr = strtok( NULL, pipe);
<br/>
      sscanf(cptr, "%f", &amp;ty);   
<br/>
      iprintf("%4d, %f, %f, %f, %d\n", tagid, tx, ty, tz, flags); 
<br/>
       cptr = strtok( NULL, pipe);
<br/>
      sscanf(cptr, "%d\n", &amp;flags);
<br/>
      iprintf("%4d, %f, %f, %f, %d\n", tagid, tx, ty, tz, flags); 
<br/>
      break;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
(Basically it goes to a non-blocking socket and pulls a string out of a server once every 5 seconds, a string that looks like:
<br/>
<br/>
recreation area|3.12332324|1.3234424|0|0
<br/>
<br/>
For some reason, the sscanf() always fail on the %f.  What seems to be the problem?   Is there something in terms of the sccanf that makes it bad?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160528 - Maxxie - Thu Jul 17, 2008 8:43 am</h4>
    <div class="postbody"><span class="postbody">Its the <span style="font-weight: bold">i</span>printf that fails the float, not the sscanf.
<br/>
<br/>
iprintf is a version of printf that has dropped float support to leave only <span style="font-weight: bold">i</span>nt support.<br/>_________________<br/><a class="postlink" href="http://nintendods.desperate-programmers.com/doku.php?id=wireless_io_map" target="_blank">Trying  to bring more detail into understanding the wireless hardware</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160530 - a128 - Thu Jul 17, 2008 9:50 am</h4>
    <div class="postbody"><span class="postbody">use ftoa() to convert float to a string
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
char *a=ftoa(whatever,2);
<br/>
iprintf("%s",a);
<br/>
free(a);
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"><br/><br/>Last edited by a128 on Fri Jul 18, 2008 11:10 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#160536 - sgeos - Thu Jul 17, 2008 1:17 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>a128 wrote:</b></span></td> </tr> <tr> <td class="quote">use ftoa() to convert float to a string</td> </tr></table><span class="postbody">
<br/>
Does iprintf paired with ftoa actually net you anything over vanilla printf?  I assumed you either work with floats or you don't.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160537 - a128 - Thu Jul 17, 2008 1:36 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sgeos wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Does iprintf paired with ftoa actually net you anything over vanilla printf?  I assumed you either work with floats or you don't.
<br/>
-Brendan</td> </tr></table><span class="postbody">
<br/>
Oh yes....use 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">printf("%0.2f",foo)</td> </tr></table><span class="postbody">
<br/>
this works with floats....forget  ftoa(foo,2)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160566 - sgeos - Thu Jul 17, 2008 8:51 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>a128 wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sgeos wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Does iprintf paired with ftoa actually net you anything over vanilla printf?  I assumed you either work with floats or you don't.
<br/>
-Brendan</td> </tr></table><span class="postbody">
<br/>
Oh yes....use</span></td> </tr></table><span class="postbody">
<br/>
What do you gain?  Speed?  ROM size?  Both?  iprintf paired with ftoa is certainly less readable.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160598 - a128 - Fri Jul 18, 2008 8:08 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sgeos wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
What do you gain?  Speed?  ROM size?  Both?  iprintf paired with ftoa is certainly less readable.
<br/>
-Brendan</td> </tr></table><span class="postbody">
<br/>
 I just not tested printf with floats so I  used ftoa() with iprintf.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160603 - sgeos - Fri Jul 18, 2008 10:01 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>a128 wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sgeos wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
What do you gain?  Speed?  ROM size?  Both?  iprintf paired with ftoa is certainly less readable.
<br/>
-Brendan</td> </tr></table><span class="postbody">
<br/>
 I just not tested printf with floats so I  used ftoa() with iprintf.</span></td> </tr></table><span class="postbody">
<br/>
Without testing, how are you sure you net anything by using iprintf+ftoa instead of vanilla printf?
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160609 - a128 - Fri Jul 18, 2008 11:08 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Without testing, how are you sure you net anything by using iprintf+ftoa instead of vanilla printf? </td> </tr></table><span class="postbody">
<br/>
What do you mean?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160612 - sgeos - Fri Jul 18, 2008 11:44 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>a128 wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Without testing, how are you sure you net anything by using iprintf+ftoa instead of vanilla printf? </td> </tr></table><span class="postbody">
<br/>
What do you mean?</span></td> </tr></table><span class="postbody">
<br/>
So far as I can tell, ftoa is not part of the standard library.  Are you sure it is not implemented with a vanilla sprintf?  If it is, all you are doing is obfuscating your code by not using sprintf directly.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160616 - silent_code - Fri Jul 18, 2008 2:05 pm</h4>
    <div class="postbody"><span class="postbody">@ sgeos: Telling from his previous posts, I think he simply didn't know it worked, that's why he didn't use it. He even posted not to use his method, but to use printf directly with floats. ;^)<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160908 - ragefury32 - Thu Jul 24, 2008 1:02 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>silent_code wrote:</b></span></td> </tr> <tr> <td class="quote">@ sgeos: Telling from his previous posts, I think he simply didn't know it worked, that's why he didn't use it. He even posted not to use his method, but to use printf directly with floats. ;^)</td> </tr></table><span class="postbody">
<br/>
<br/>
See, that is the part that worries me.  I am not even sure if sscanf() is working properly, since when I tried to printf() the results, it either prints up blank, or when I push the results into the GL core, it seems to crash it.  Also note that I split the string up on | and parse each individually instead of doing a simple tokenize on first, sscanf(&amp;%d&amp;%f|&amp;%f|&amp;%f|&amp;%d, tagid, tx, ty, tz, flags) on the rest.  I was having issue with both.  How "big" is a float in the NDS?  32 Bit standard IEEE754 1-8-23, or something smaller?
<br/>
<br/>
Also, I cannot figure out whether the non-blocking recv() is working either.  recv() seems to be sitting for a while before it returns anything.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160914 - sgeos - Thu Jul 24, 2008 1:59 pm</h4>
    <div class="postbody"><span class="postbody">Try sprintf-ing to sram, or some place in memory you can watch.  That way you can inspect the results and see if the sprintf is working properly.
<br/>
<br/>
-Brendan
<br/>
<br/>
<span style="font-weight: bold">EDIT:</span>  You can use something like this.  Plug a pointer to some known memory location into it.  Definitely a hack, but if things are crashing...
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void sprintfTest(char *buffer)
<br/>
{
<br/>
  float f = 12.34;
<br/>
  int   i = 56;
<br/>
<br/>
  sprintf(buffer, "  f = %f;\n  i = %d;\n", f, i);
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
This is the PC-side output I get.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">  f = 12.340000;
<br/>
  i = 56;</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160919 - elhobbs - Thu Jul 24, 2008 3:14 pm</h4>
    <div class="postbody"><span class="postbody">I was never able to get printf working with floats. It would always crash. The little bit of debugging I did before giving up pointed into locale related code - localeconv if I remember correctly. Since so many other people where having similiar issues I never tried too hard to get it to work. I was able to get sprintf to print floats to a string though (I think there may be issues if you do not have enough free ram though). I would just read the values in as strings and then convert them with atof.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160923 - sgeos - Thu Jul 24, 2008 4:25 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>elhobbs wrote:</b></span></td> </tr> <tr> <td class="quote">I was able to get sprintf to print floats to a string though</td> </tr></table><span class="postbody">What else is sprintf used for?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>elhobbs wrote:</b></span></td> </tr> <tr> <td class="quote">(I think there may be issues if you do not have enough free ram though).</td> </tr></table><span class="postbody">Perhaps snprinf would solve this problem?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>elhobbs wrote:</b></span></td> </tr> <tr> <td class="quote">I would just read the values in as strings and then convert them with atof.</td> </tr></table><span class="postbody">Unless you are working with user input, why not pass floats directly?
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#160932 - elhobbs - Thu Jul 24, 2008 5:28 pm</h4>
    <div class="postbody"><span class="postbody">sprintf is used to print to a character buffer instead of to the console.
<br/>
<br/>
no, I was not overflowing the buffer. I think internally the function tries to call malloc under certain situations and since I had intentionally grabbed nearly all of the ram it would fail.
<br/>
<br/>
I was trying to print debug strings for float values.
<br/>
<br/>
In any case I was just trying to point out that I have had similiar problems with floats. and that the quickest/best resolution may be to try an alternate approach since this appears to be a common issue.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#161155 - ragefury32 - Tue Jul 29, 2008 3:01 pm</h4>
    <div class="postbody"><span class="postbody">So in other words, reading floats from an outside source (sccanf() off sockets) using this method is a bad idea then?  What would be a realistic workaround to this?  I mean, I can't avoid using it.  
<br/>
<br/>
How would you use snscanf() in the case of a float?  
<br/>
<br/>
snscanf(cptr, 6, "%f", &amp;tz) or something like that?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#161181 - silent_code - Tue Jul 29, 2008 8:42 pm</h4>
    <div class="postbody"><span class="postbody">You can always send bytes and all, you know. ;^)<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#161205 - elhobbs - Wed Jul 30, 2008 2:30 pm</h4>
    <div class="postbody"><span class="postbody">you may have to manually parse the information instead of using scanf. can you confirm that you are even receiving the correct data?
<br/>
<br/>
here is one way to do it:
<br/>
create a buffer to hold the longest possible line
<br/>
move a full line into the buffer
<br/>
use strtok to find the delimiters
<br/>
then use atof on each piece to get the float value</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#161343 - tepples - Fri Aug 01, 2008 8:23 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>elhobbs wrote:</b></span></td> </tr> <tr> <td class="quote">create a buffer to hold the longest possible line</td> </tr></table><span class="postbody">
<br/>
How long is the longest possible line, and what do you want the program to do should the input <a class="postlink" href="http://en.wikipedia.org/wiki/Buffer_overflow" target="_blank">exceed that</a>?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163603 - a128 - Mon Oct 06, 2008 9:59 am</h4>
    <div class="postbody"><span class="postbody">using &gt; devkitARMR21
<br/>
<br/>
i..e devkitARM R23 and this 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code"> if ( sscanf ( s, "%f,%f,%f", &amp;x, &amp;y,&amp;z ) != 3 ) {</td> </tr></table><span class="postbody">
<br/>
<br/>
does not work
<br/>
<br/>
using devkitARMR21 works!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163607 - elhobbs - Mon Oct 06, 2008 2:02 pm</h4>
    <div class="postbody"><span class="postbody">I found that a lot of the scanf/printf float problems that I was experiencing were caused by not having enough free memory or stack space. I eliminated all calls from recursive functions and I made sure that I left some memory free for the system functions (I think I left 128k free). My program uses it own memory heap so I was grabbing all of the memory from the system. Things stopped working when I went to r23 - leaving a little more free memory solved my issues.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163610 - Izhido - Mon Oct 06, 2008 3:37 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>a128 wrote:</b></span></td> </tr> <tr> <td class="quote">using &gt; devkitARMR21
<br/>
<br/>
i..e devkitARM R23 and this 
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code"> if ( sscanf ( s, "%f,%f,%f", &amp;x, &amp;y,&amp;z ) != 3 ) {</td> </tr></table><span class="postbody">
<br/>
<br/>
does not work
<br/>
<br/>
using devkitARMR21 works!</span></td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
Uh... pardon my eavesdropping, but... what exactly is that line supposed to do?
<br/>
<br/>
- Izhido</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163611 - kusma - Mon Oct 06, 2008 3:52 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Izhido wrote:</b></span></td> </tr> <tr> <td class="quote">Uh... pardon my eavesdropping, but... what exactly is that line supposed to do?</td> </tr></table><span class="postbody">
<br/>
Parse a string of three comma-separated floating point numbers.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#163617 - a128 - Mon Oct 06, 2008 5:13 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>elhobbs wrote:</b></span></td> </tr> <tr> <td class="quote">I found that a lot of the scanf/printf float problems that I was experiencing were caused by not having enough free memory or stack space. I eliminated all calls from recursive functions and I made sure that I left some memory free for the system functions (I think I left 128k free). My program uses it own memory heap so I was grabbing all of the memory from the system. Things stopped working when I went to r23 - leaving a little more free memory solved my issues.</td> </tr></table><span class="postbody">
<br/>
<br/>
No..it must be somethink else then memory....F&amp;%$&amp;$%&amp;$ I had  bugs in the core</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
