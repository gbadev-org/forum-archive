<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>No Z-sorting with glOrtho - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > No Z-sorting with glOrtho</h2>
<div id="posts">
<div class="post">
    <h4>#149897 - simonjhall - Sat Jan 26, 2008 4:31 pm</h4>
    <div class="postbody"><span class="postbody">Sup.
<br/>
I seems to remember having this problem ages ago, but I don't think I ever found a solution to it.
<br/>
<br/>
I'm drawing lots of quads in 3D to form my HUD (and this is done with glOrtho) and some quads overlap others. The HUD is effectively drawn back-to-front, so anything drawn first should be drawn over anything drawn later.
<br/>
Regardless of the Z that I use I always get the same result: no kind of depth sorting and quads that overlap appear as if the top part of the quad is drawn at a different Z to the bottom of the quad. I've checked again and again to see if I'm doing anything silly and I'm not. I then thought it could be a precision problem, so the first quad is drawn at 1.0, the next at 2.0 etc etc and I still get the exact same resut! Messing around with znear/zfar does nothing interesting.
<br/>
<br/>
For my swap buffers command I'm using '0' which apparenty means Z sorting.
<br/>
<br/>
Has anyone else had issues like this? What're the solutions?
<br/>
<br/>
Btw, here's the code for the orthographic projection matrix: (from libnds)
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">GL_STATIC_INL void glOrthof32(int32 left, int32 right, int32 bottom, int32 top, int32 zNear, int32 zFar) {
<br/>
   MATRIX_MULT4x4 = divf32(inttof32(2), right - left);     
<br/>
   MATRIX_MULT4x4 = 0;  
<br/>
   MATRIX_MULT4x4 = 0;      
<br/>
   MATRIX_MULT4x4 = 0;
<br/>
<br/>
   MATRIX_MULT4x4 = 0;  
<br/>
   MATRIX_MULT4x4 = divf32(inttof32(2), top - bottom);     
<br/>
   MATRIX_MULT4x4 = 0;    
<br/>
   MATRIX_MULT4x4 = 0;
<br/>
<br/>
   MATRIX_MULT4x4 = 0;  
<br/>
   MATRIX_MULT4x4 = 0;  
<br/>
   MATRIX_MULT4x4 = divf32(inttof32(-2), zFar - zNear);     
<br/>
   MATRIX_MULT4x4 = 0;
<br/>
<br/>
   MATRIX_MULT4x4 = -divf32(right + left, right - left);//0;  
<br/>
   MATRIX_MULT4x4 = -divf32(top + bottom, top - bottom); //0;  
<br/>
   MATRIX_MULT4x4 = -divf32(zFar + zNear, zFar - zNear);//0;  
<br/>
   MATRIX_MULT4x4 = floattof32(1.0F);
<br/>
}</td> </tr></table><span class="postbody"><br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#149915 - ingramb - Sun Jan 27, 2008 7:40 am</h4>
    <div class="postbody"><span class="postbody">I use 2d quads for my entire application, and it works fine.  You need to assign each overlapping quad a different z-value or else you'll get z fighting.  I draw everything back to front, and just increment the z-value as I go.  I use 0 for GFX_FLUSH, and the glOrthof32 from libnds.  Hopefully this helps.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#149921 - M3d10n - Sun Jan 27, 2008 12:19 pm</h4>
    <div class="postbody"><span class="postbody">Use plain integers for all of glOrthof32 parameters, not floattof32'ed or inttof32'ed numbers, same for your vertex coordinates. You should be able to be able to properly depth sort your quads that way.
<br/>
<br/>
I'm using:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">glOrthof32(0, 256, 192, 0, 0, 10);</td> </tr></table><span class="postbody">
<br/>
Which allows me to use 10 unique z values.
<br/>
(That's with the libnds version which comes with devkitARM r20, I don't know if it changed with the one from r21)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
