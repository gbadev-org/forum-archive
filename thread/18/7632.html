<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Making an alternative menu for the MK 2/3 - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Making an alternative menu for the MK 2/3</h2>
<div id="posts">
<div class="post">
    <h4>#62268 - fernando-ytr - Mon Nov 28, 2005 9:24 pm</h4>
    <div class="postbody"><span class="postbody">Hello everybody!
<br/>
<br/>
The NeoFlash Team has send the MK 2 to many coders, so... can anyone create an alternative menu for the MK 2/3? The menu from NeoFlash is a...
<br/>
<br/>
We have all the specs here:
<br/>
<br/>
<a class="postlink" href="http://www.neoflash.com/forum/index.php?action=dlattach;topic=1005.0;attach=234" target="_blank">http://www.neoflash.com/forum/index.php?action=dlattach;topic=1005.0;attach=234</a>
<br/>
<br/>
And we need a CVS, no? SourceForge, maybe?
<br/>
<br/>
Thanks!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62270 - Mollusk - Mon Nov 28, 2005 10:03 pm</h4>
    <div class="postbody"><span class="postbody">The current menu is in version 0.1 ! Maybe you could wait a little, don't you think ?<br/>_________________<br/>PAlib official forum : <a class="postlink" href="http://www.palib.info" target="_blank">http://www.palib.info</a>
<br/>
PAlib official tutorials: <a class="postlink" href="http://www.palib.info/wiki" target="_blank">http://www.palib.info/wiki</a>
<br/>
Updates, help, code examples, tutorials, etc...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62273 - fernando-ytr - Mon Nov 28, 2005 10:37 pm</h4>
    <div class="postbody"><span class="postbody">Nope, the actual version are the 0.2 and still is the same as the v0.1.
<br/>
<br/>
And NeoFlash is very slowly releasing new versions of his menu.
<br/>
<br/>
I think that this can be the corrects steps to develop the loader:
<br/>
<br/>
1- We can create and interface for read/write the  SD/MMC targets with the filesystems FAT 16/32.
<br/>
2-Add suport to the intern memory of MK3.
<br/>
3-Add a save manager.
<br/>
3-Add "streaming mode" to execute .nds archives direct from the SD/MMC/intern memory
<br/>
(I think that the M3 do anything like this but using a CF). 
<br/>
4-...
<br/>
<br/>
Of course, the formats of the loader will be .nds and .ds.gba.
<br/>
I'm going to send e-mail to all developers that recived a fre MK 2 or 3.
<br/>
<br/>
PD:Sorry for my bad English.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62303 - Mollusk - Tue Nov 29, 2005 8:21 am</h4>
    <div class="postbody"><span class="postbody">I should recieve mine soon... I'll look at the current menu status and see what I can do too, then :)<br/>_________________<br/>PAlib official forum : <a class="postlink" href="http://www.palib.info" target="_blank">http://www.palib.info</a>
<br/>
PAlib official tutorials: <a class="postlink" href="http://www.palib.info/wiki" target="_blank">http://www.palib.info/wiki</a>
<br/>
Updates, help, code examples, tutorials, etc...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62312 - rmco2003 - Tue Nov 29, 2005 2:36 pm</h4>
    <div class="postbody"><span class="postbody">I think this would be a very worthwhile project, I hope it goes further.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62320 - Extreme Coder - Tue Nov 29, 2005 4:50 pm</h4>
    <div class="postbody"><span class="postbody">I already began working on a mk2/3 shell, but I just wish I knew how to access 11011011 for example on the nds cart:P</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62328 - revo - Tue Nov 29, 2005 6:03 pm</h4>
    <div class="postbody"><span class="postbody">I wish neoflash will release actual menu source code ;)<br/>_________________<br/>[ sorry for all mistakes, but my english isn't as good as I wish it to be ]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62333 - rmco2003 - Tue Nov 29, 2005 6:51 pm</h4>
    <div class="postbody"><span class="postbody">I doubt he will, but the data sheets may be able to help in developing a new menu</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62340 - fernando-ytr - Tue Nov 29, 2005 8:15 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>rmco2003 wrote:</b></span></td> </tr> <tr> <td class="quote">I doubt he will, but the data sheets may be able to help in developing a new menu</td> </tr></table><span class="postbody">
<br/>
<br/>
Yes, but anyone knows how acces to, for example, 11011011, as Extreme Coder says?
<br/>
<br/>
Bye!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62380 - cory1492 - Wed Nov 30, 2005 12:33 pm</h4>
    <div class="postbody"><span class="postbody">as far as I understand it cart comms is controlled by setting something on the SPI bus and by using CARD_CR2 (card command register 2; register 1 should be EEPROM/FLASH) which is essentially where the MK2 is located - the card slot - but I have not gotten any useable results with this theory as of now.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62383 - Extreme Coder - Wed Nov 30, 2005 1:31 pm</h4>
    <div class="postbody"><span class="postbody">Last time I asked Dr.Neo, he said he'll be releasing sample source code to access data or whatever. The question is when:P?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62386 - darkfader - Wed Nov 30, 2005 2:47 pm</h4>
    <div class="postbody"><span class="postbody">That'd save us some work. If I weren't so lazy and had more time, I'd probably have a romloader already. (assuming it really can do what it's designed for)
<br/>
Sigh... is there really a reason to use this device for homebrew?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62389 - Extreme Coder - Wed Nov 30, 2005 3:43 pm</h4>
    <div class="postbody"><span class="postbody">maybe for fun?:P
<br/>
or because mario kart DS costs here $80:D
<br/>
But where would you get the addresses from?
<br/>
You know why the +65463195987 people at the neoflash forums are crying their asses for;)Just find a solution to shut them up:D</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62391 - revo - Wed Nov 30, 2005 4:23 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>darkfader wrote:</b></span></td> </tr> <tr> <td class="quote">Sigh... is there really a reason to use this device for homebrew?</td> </tr></table><span class="postbody">
<br/>
<br/>
Testing faster then ever before :) How? I don't know if it will work, but:
<br/>
<br/>
- <a href="http://www.everythingusb.com/sandisk_ultra_ii_sd_plus_1gb.html" target="_blank">http://www.everythingusb.com/sandisk_ultra_ii_sd_plus_1gb.html</a>
<br/>
<br/>
what about cutting 'down' part (it looks on fotos, that there is no electronic there) of it and connecting it to usb extension lead (http://www.beststuff.co.uk/images/hama_usb_extension.jpg and ad power switch if needed)? 
<br/>
<br/>
I don't have such a card (and no info about it compatibility at the moment), but what do you think about it? Simple sending file to 'removable drive', and it's ready for testing, without moving cart :] All we need it's menu that will boot file autorun.nds (or some other name) automatically from MK2/3.<br/>_________________<br/>[ sorry for all mistakes, but my english isn't as good as I wish it to be ]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62427 - tepples - Wed Nov 30, 2005 9:11 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Extreme Coder wrote:</b></span></td> </tr> <tr> <td class="quote">maybe for fun?:P
<br/>
or because mario kart DS costs here $80:D</td> </tr></table><span class="postbody">
<br/>
You haven't filled in your location, so I don't know what "dollar" means in your local language. Does <span style="font-style: italic">Mario Kart</span> cost 80 monetary units that are locally called "dollars", or is its local price actually equivalent to 80 U.S. dollars?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62441 - Empyrean - Wed Nov 30, 2005 10:23 pm</h4>
    <div class="postbody"><span class="postbody">Maybe it's Hong Kong dollars, in which case that'd be around US $10!
<br/>
<br/>
Heheh, but I'm assuming it's Australian dollars, which would equate to around US $60.<br/>_________________<br/>3 is not an "e", 
<br/>
7 is not a "t", 
<br/>
1 is not an "l",
<br/>
And for the love of God,
<br/>
Learn how to spell!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62453 - cory1492 - Thu Dec 01, 2005 1:47 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>darkfader wrote:</b></span></td> </tr> <tr> <td class="quote">That'd save us some work. If I weren't so lazy and had more time, I'd probably have a romloader already. (assuming it really can do what it's designed for)
<br/>
Sigh... is there really a reason to use this device for homebrew?</td> </tr></table><span class="postbody">Sure, having access to an SD card can make for alot of things, as with GBA MP... I thought you of all people would see at least a glimmer of potential for such a device to work with homebrew wrather than sticking to the limits of a GBA device.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62461 - Extreme Coder - Thu Dec 01, 2005 5:30 am</h4>
    <div class="postbody"><span class="postbody">no tepples, I converted it from saudi riyals( the currency here) to american dollars.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62467 - Empyrean - Thu Dec 01, 2005 6:31 am</h4>
    <div class="postbody"><span class="postbody">Hey, I was born in Saudi Arabia... Jeddah, to be exact!<br/>_________________<br/>3 is not an "e", 
<br/>
7 is not a "t", 
<br/>
1 is not an "l",
<br/>
And for the love of God,
<br/>
Learn how to spell!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62470 - Extreme Coder - Thu Dec 01, 2005 7:09 am</h4>
    <div class="postbody"><span class="postbody">I'm living there:)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62472 - Empyrean - Thu Dec 01, 2005 7:57 am</h4>
    <div class="postbody"><span class="postbody">Good stuff, man! Mar7aba!<br/>_________________<br/>3 is not an "e", 
<br/>
7 is not a "t", 
<br/>
1 is not an "l",
<br/>
And for the love of God,
<br/>
Learn how to spell!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62487 - revo - Thu Dec 01, 2005 1:31 pm</h4>
    <div class="postbody"><span class="postbody">New MK2/3 menu is out - my rPaint starts from MMC card without any problems :)<br/>_________________<br/>[ sorry for all mistakes, but my english isn't as good as I wish it to be ]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63072 - kobewan - Thu Dec 08, 2005 1:01 pm</h4>
    <div class="postbody"><span class="postbody">Heh, lots of Saudis here I guess.... from Jeddah, Saudi Arabia as well. I'm new here, but i can vouch for that $80 price. Its still a lot better than the N64 days, when cartridges would cost like $100-120, while PS games are being sold openly for $2 (boot legged of course). Won't find many Nintendo fans here, specially since even GameCube was so recently cracked...which still isn't that open here.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63154 - Sintax - Fri Dec 09, 2005 5:01 am</h4>
    <div class="postbody"><span class="postbody">So has anyone figured anything out yet? I'm already fed up with the menu, and although I'm sure they'll make new versions, I'm also sure they'll never do all the things we want it to.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63186 - Extreme Coder - Fri Dec 09, 2005 2:09 pm</h4>
    <div class="postbody"><span class="postbody">Did you try v0.3?
<br/>
Until we get a clue about how to access stuff on the mk2/3, nothing's gonna happen.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63782 - Sintax - Fri Dec 16, 2005 7:24 am</h4>
    <div class="postbody"><span class="postbody">Yeah I was hoping someone got a clue. Perhaps I found some.
<br/>
<br/>
I did a lot of looking into it and deciphering broken english, based mostly on what cory said about using CARD_CR2 and the data sheet. I think you actually have to use CARD_CR1 at first, which <a class="postlink" href="http://www.bottledlight.com/ds/index.php/Hardware/CardRegisters" target="_blank">the NDSTech Wiki</a> refers to as CARD_SPI_CR, which seems to match up with the SPI commands in the data sheet, especially considering CARD_SPI_DATA has 8 bits for SPI data, which goes along with the 8 bits of data posted for each command on the sheet.
<br/>
<br/>
Now, you can't send any Game ROM commands before you use SPI #2 according to the data sheet. And you can't send any SPI commands before sending 'EMULATED EEPROM WRITE ENABLE'... according to the data sheet. I think this refers to SPI #11. So you put 1111101 or 0xF9 into CARD_EEPDATA (CARD_SPI_DATA on the tech wiki), and maybe then it works. I guess the MK3 takes data through it's EEPROM emulator. I've programmed this in, but I have no idea how to read data, so I can't tell if it's doing anything.
<br/>
<br/>
<br/>
So that's all what I've gathered, I'm just putting it out there to hope that someone more skilled can use it, although I'm not sure it even makes sense. This device seems like it has potential and I'm just tired of waiting.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63788 - Extreme Coder - Fri Dec 16, 2005 8:49 am</h4>
    <div class="postbody"><span class="postbody">So did it work?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63890 - Sintax - Sat Dec 17, 2005 8:12 am</h4>
    <div class="postbody"><span class="postbody">Well, I did a bit more work and I think I got something. Following my theory finally paid off after I realized I had to set WAIT_CR to give the AMR9 access to the DS slot. Pertinent code (ie. excess cut out) so you can try yourself:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void waitCard () { while (CARD_CR1 &amp; 0x80); }
<br/>
<br/>
void readNeoData (uint8 command, uint8 *data, uint32 length) {
<br/>
   CARD_CR1 = /*Enable*/0x8000 | /*MODE*/0x40 | /*Continue*/0x2000;
<br/>
<br/>
   CARD_EEPDATA = command;
<br/>
   waitCard();
<br/>
<br/>
   while (length &gt; 0) {
<br/>
      CARD_EEPDATA = 0;
<br/>
      waitCard();
<br/>
      *data++ = CARD_EEPDATA;
<br/>
      length--;
<br/>
   }
<br/>
   CARD_CR1 = /*MODE*/0x40;
<br/>
}
<br/>
<br/>
int main (void) {
<br/>
   uint16 dataBuf =  0;
<br/>
<br/>
   WAIT_CR &amp;= 0xF7FF;      //Permit AMR9 access to DS slot
<br/>
<br/>
   waitCard();
<br/>
   
<br/>
   //0xF2 is 11110010 - SPI #3 on datasheet
<br/>
   readNeoData (0xF2, &amp;dataBuf, 2);
<br/>
   iprintf("Read MEM_CONFIG: %X\n", dataBuf);
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Now what I get returned is 0x1032, which comes out to 0xFFFF if you don't have the MK in, or there is a DS game in the slot. ALSO, the last 8 bits of that evaluate to 00110010, where, if you look on the data sheet, matches up with the 'ZZZZZ0O0' where 'ZZZZZ' is EEPROM64k (00110-default) and 'O' is Save to MK2 ('1' - default I guess). So that's some strong proof that something is working, I'd say. If anyone can chime in with any useful SPI info or anything, please, God, help me.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63983 - Sintax - Sun Dec 18, 2005 7:08 am</h4>
    <div class="postbody"><span class="postbody">Ok well I think I got it, if anyone's interested. The readNeoData I posted above works (although the data comes out in reverse- that is byte 2 should be byte 1), it's just that the Memory Config is the only piece of data that comes setup already, it seems. Here is writeNeoData:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void writeNeoData (uint8 command, uint8 data1, uint8 data2) {
<br/>
   CARD_CR1 = /*Enable*/0x8000 | /*MODE*/0x40 | /*Continue*/0x2000;
<br/>
   CARD_EEPDATA = 0x06;   //set Write Enable Latch
<br/>
   waitCard();
<br/>
   CARD_CR1 = 0x40;
<br/>
<br/>
   CARD_CR1 = /*Enable*/0x8000 | /*MODE*/0x40 | /*Continue*/0x2000;
<br/>
   CARD_EEPDATA = command;
<br/>
   waitCard();
<br/>
   
<br/>
   CARD_EEPDATA = data1;
<br/>
   waitCard();
<br/>
<br/>
   CARD_EEPDATA = data2;
<br/>
   waitCard();
<br/>
<br/>
   CARD_CR1 = /*MODE*/0x40;
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
Command is column 1 on the data sheet, data 1+2 are columns 2+3. It works fine with SPI #9 to write MK2/3 Config values, but something is screwy with writing the Memory Config. I haven't tried anything else yet. But at this point you should be able to use SPI #2 to switch to game mode and use the game mode commands. That probably uses CARD_CR2, although I haven't gotten into that yet.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#64005 - Extreme Coder - Sun Dec 18, 2005 1:48 pm</h4>
    <div class="postbody"><span class="postbody">So you got real responses without setting the EEPROM on the SPI #2?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#64045 - Sintax - Sun Dec 18, 2005 9:46 pm</h4>
    <div class="postbody"><span class="postbody">SPI #2 is 'Switch to Game Mode,' I'm not sure what you mean. But as far as I can tell, you actually don't need to set anything before reading or writing the SPI commands.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#64093 - Sintax - Mon Dec 19, 2005 9:51 am</h4>
    <div class="postbody"><span class="postbody">Boy, everyone seemed all gung-ho about this a while ago, but now that someone actually has something, I guess no one cares.
<br/>
<br/>
Here is a small demo/test program I made while trying to figure this all out, with source and compiled program, I don't think I'm going to put any more work into this effort:
<br/>
<br/>
<a href="http://digitalatrocity.com/DS/neotest.zip" target="_blank">http://digitalatrocity.com/DS/neotest.zip</a>
<br/>
<br/>
My hope was to get access to the MMC/SD card so we should read and write to it and use all those programs that work with the GBAMP and all that. But reading and writing the SPI commands is as far as I got. Still 110% farther than anyone else, but not enough to do anything useful.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#64132 - fernando-ytr - Mon Dec 19, 2005 7:20 pm</h4>
    <div class="postbody"><span class="postbody">Hey, Sintax!
<br/>
<br/>
Thanks for you program!I try your program in format .nds in the GBAMP, and it works!
<br/>
<br/>
Thanks!</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
