<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Measuring temp and log to file? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Measuring temp and log to file?</h2>
<div id="posts">
<div class="post">
    <h4>#150721 - nerkle - Mon Feb 11, 2008 11:55 am</h4>
    <div class="postbody"><span class="postbody">Hi
<br/>
<br/>
I read in this thread about using the touchscreen diode to measure temperature  -- as a relative n00b and non coder  -- does anyone know of homebrew that will record the temp to a file (on R4 / slot 1 - if that matters).
<br/>
<br/>
Thanks in advance.
<br/>
<br/>
Glen</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#150739 - nipil - Mon Feb 11, 2008 8:07 pm</h4>
    <div class="postbody"><span class="postbody">Sadly, i don't know any homebrew which does this. But here's a few hints anyway :
<br/>
<a class="postlink" href="http://nocash.emubase.de/gbatek.htm#dstouchscreencontrollertsc" target="_blank">GBATEK</a> has answers on where to read some temperature.
<br/>
To save it to a file, simply load &lt;fat.h&gt;, call fatInitDefault(), link using -lfat, and use the standard stdio functions.<br/>_________________<br/>NDS Lite Gold/Silver, MK5/R4DS, MSI PC54G2, D-Link DI-624</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#150741 - nipil - Mon Feb 11, 2008 8:29 pm</h4>
    <div class="postbody"><span class="postbody">Besides, you may take a look <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=13727" target="_blank">here</a> and <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=4983" target="_blank">here</a> for infos on how to read the temperature.<br/>_________________<br/>NDS Lite Gold/Silver, MK5/R4DS, MSI PC54G2, D-Link DI-624</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#150959 - nerkle - Sat Feb 16, 2008 1:39 am</h4>
    <div class="postbody"><span class="postbody">Hi
<br/>
<br/>
Thanks for the pointers so far.
<br/>
<br/>
I have managed to create a small application that does some random math and outputs the results to a .csv file stored on the root directory of the flash card / R4.  &gt;&gt; Not bad for never coding in C before and a testament to the help and support from this forum and the FAQ's out there.
<br/>
<br/>
All this has been made in on main.c file (I now realise is in Arm9).
<br/>
<br/>
I want to pull the temperature through (but this is only accessible from the Arm7 processor and is not available in Arm9).
<br/>
<br/>
The couple of places I can find reference to the internal temperature, code is added to an Arm7 source and "IPC" used to send the data to Arm9 (I think -- it is at this point that I reach for the beer)
<br/>
<br/>
I know I must be missing the point and should be able to find a demo file Arm7 and Arm9 sources, but it's late so HELP ;-)
<br/>
<br/>
<br/>
N00b I know, but I try to be as self sufficient as I can.....
<br/>
<br/>
Glen<br/>_________________<br/>Why am I doing this?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#150960 - nerkle - Sat Feb 16, 2008 1:43 am</h4>
    <div class="postbody"><span class="postbody">DOH!!
<br/>
<br/>
I guess I should build a new project based on the "combined" template from devitPro.
<br/>
<br/>
So how to I get the value from the Arm7 to Arm9?
<br/>
<br/>
Glen<br/>_________________<br/>Why am I doing this?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#150961 - Dwedit - Sat Feb 16, 2008 1:45 am</h4>
    <div class="postbody"><span class="postbody">Has anyone extensively tested out the temperature feature to see how accurate it is?<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#150964 - nerkle - Sat Feb 16, 2008 2:00 am</h4>
    <div class="postbody"><span class="postbody">Good point - but not a show stopper for me.
<br/>
<br/>
The "Big Picture" for me is to show how the NDS can be used as more than a games platfom, especially in schools.
<br/>
<br/>
The plan is to showcase recording:
<br/>
<br/>
1) Sound via the MIC
<br/>
2) Temp via the internal diodes
<br/>
3) Motion with the MotionPAK
<br/>
4) Light, pH, temperature via external sensors attached to the spare inputs on the MotionPAK
<br/>
<br/>
My "problem" is that I am a high school physics teacher, not a coder, so I am finding this interesting but challenging.
<br/>
<br/>
I hate data loggers in the classroom as they literally "black box" what is going on and it hides too much from the students.  In the past I have hooked sensors to a PC using 1-Wire technology and used the accelerometers / gyros in the Wii remote to measure gravity etc.
<br/>
<br/>
Then NDS is ideal as roughly 60% of the pupils will have one and if I can show technology being used for other things than game playing, then just maybe I can inspire some new scientists / coders...
<br/>
<br/>
So, if anyone is interesting in helping out with a project to achieve the above, I would love to hear from you all ;-) ;-)
<br/>
<br/>
Glen<br/>_________________<br/>Why am I doing this?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#150974 - dantheman - Sat Feb 16, 2008 6:59 am</h4>
    <div class="postbody"><span class="postbody">Moonshell has a temperature reading area, doesn't it?  In my experience, this value is somewhat accurate.  However, if I hold select to make mp3 files speed up, using up 100% of the CPU, this reading increases a noticeable amount.  I'm not a coder, so I don't know exactly what the temperature is a reading <span style="font-style: italic">of</span>, but my guess is that it's more of an internal processor temperature gauge.  Perhaps the DS checks the temp to see if it's in a safe range during the power-on self-tests?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#150977 - nipil - Sat Feb 16, 2008 8:48 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>dantheman wrote:</b></span></td> </tr> <tr> <td class="quote">if I hold select to make mp3 files speed up, using up 100% of the CPU, this reading increases a noticeable amount ... my guess is that it's more of an internal processor temperature gauge.</td> </tr></table><span class="postbody">
<br/>
IMHO, it could simply be the heat created by the cpu that gets propagated to the surrounding area, ie the touchscreen ?<br/>_________________<br/>NDS Lite Gold/Silver, MK5/R4DS, MSI PC54G2, D-Link DI-624</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#150991 - tepples - Sat Feb 16, 2008 2:43 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>dantheman wrote:</b></span></td> </tr> <tr> <td class="quote">I'm not a coder, so I don't know exactly what the temperature is a reading <span style="font-style: italic">of</span>, but my guess is that it's more of an internal processor temperature gauge.  Perhaps the DS checks the temp to see if it's in a safe range during the power-on self-tests?</td> </tr></table><span class="postbody">
<br/>
It's on the power management chip. As I understand it, other products using a similar power management chip use the temperature reading to make sure that the battery doesn't overheat.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#150997 - nerkle - Sat Feb 16, 2008 5:39 pm</h4>
    <div class="postbody"><span class="postbody">Done it!
<br/>
<br/>
Managed to get the processors talking by using the IPC-&gt; pointers.  Currently after 5 mins "up my shirt" the temperature is 35.34'C  (compared to my actual skin temperature of 34'C.
<br/>
<br/>
I am taking the diode voltages and converting to temperature using the posted formula.  The voltage / temperature fluctuates constantly, so am going to put some sort of moving average / smoothing into the out put.  OR only poll the sensors once every second or so.
<br/>
<br/>
Looking good so far.
<br/>
<br/>
Now to actually calibrate it....
<br/>
<br/>
Glen<br/>_________________<br/>Why am I doing this?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153446 - MystBoy - Sun Mar 30, 2008 9:21 pm</h4>
    <div class="postbody"><span class="postbody">to late^^
<br/>
i've done the same thing today^^
<br/>
i remembered this thread so if anyone need the surce... and my version has also a grafical output... if you need it tell me (via pm) and youll get the surce and the nds
<br/>
<br/>
mystboy</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153458 - HyperHacker - Mon Mar 31, 2008 1:38 am</h4>
    <div class="postbody"><span class="postbody">I don't find the sensor very accurate. It's often as much as 10?C above or below the actual temperature. However being in my pocket probably has something to do with this, and GBATek mentions calibration, which I'm sure hasn't been done.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
