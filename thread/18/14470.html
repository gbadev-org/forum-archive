<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Sound panning adjustment - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Sound panning adjustment</h2>
<div id="posts">
<div class="post">
    <h4>#144747 - polloymedio - Tue Nov 06, 2007 4:36 pm</h4>
    <div class="postbody"><span class="postbody">hey all! well, i was trying to program a panning function for the ARM7 , but for some reason, it isnt going as well as i thought it would... anyways, here's the function 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">static void snd_SetChannelPan(u8 channel, u8 pan)
<br/>
{
<br/>
   if (channel &lt; SND_MAX_CHANNELS){
<br/>
      if (pan &gt; 127) pan = 127;
<br/>
      SCHANNEL_CR(channel) = SOUND_PAN(pan);
<br/>
      //SCHANNEL_PAN(channel) = pan;
<br/>
   }
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
I also tried modificating the SCHANNEL_PAN(channel) directly, but no results... btw, im using these macros 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define SOUND_PAN(n)         ((n) &lt;&lt; 16)
<br/>
<br/>
//---------------------------------------------------------------------------------
<br/>
// registers
<br/>
//---------------------------------------------------------------------------------
<br/>
#define SCHANNEL_CR(n)            (*(vuint32*)(0x04000400 + ((n)&lt;&lt;4)))
<br/>
#define SCHANNEL_PAN(n)            (*(vuint8*)(0x04000402 + ((n)&lt;&lt;4)))
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
any ideas? I really don't think there's something wrong with the function, I made a similar function for volume control and it did work. (Difference is i used SCHANNEL_VOL(channel) = volume instead.)
<br/>
<br/>
 Thanx in advance!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144756 - ingramb - Tue Nov 06, 2007 7:36 pm</h4>
    <div class="postbody"><span class="postbody">The SCHANNEL_CR register has bits to control lots of things besides just the pan (like volume, channel enable, etc.).
<br/>
<br/>
When you do "SCHANNEL_CR(channel) = SOUND_PAN(pan)", you're setting everything else in the register to 0, which turns off the channel.
<br/>
<br/>
If you do this, you'll preserve the old values:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
u32 value = SCHANNEL_CR(channel) &amp; ~(7 &lt;&lt; 16);
<br/>
SCHANNEL_CR(channel) = value | SOUND_PAN(pan);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
The first line grabs the existing value of the register, and masks off the 7 bits that make up the pan field.  The second line writes combines the exiting value with the new pan value.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144758 - polloymedio - Tue Nov 06, 2007 8:06 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for the reply! I also saw about 3 days ago the same problem with the SCHANNEL_CR(channel) = SOUND_PAN(pan); and i did try doing this SCHANNEL_CR(channel) |= SOUND_PAN(pan); 
<br/>
nevertheless same results.. I tried your solution too, but it doesnt work for me... hmmm... maybe im calling the procedure in the wrong place? I call it at the end of the PA_IPCManage function for tests. Also, im calling from the ARM9 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
if (Pad.Newpress.A) {
<br/>
   PA_Print(0, "-");
<br/>
   PA_PlaySimpleSound(1, saberoff);
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
in the main game loop...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144761 - ingramb - Tue Nov 06, 2007 8:18 pm</h4>
    <div class="postbody"><span class="postbody">Sound registers can only be changed on the arm7.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144764 - polloymedio - Tue Nov 06, 2007 8:30 pm</h4>
    <div class="postbody"><span class="postbody">yea i know that... I am calling to play a sound in the ARM9, and from the arm7 in the PA_IPCManage function, im calling my pan function for test reasons... Thanks for the quick reply though! :)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
