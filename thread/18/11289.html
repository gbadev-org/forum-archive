<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Trying to make a camera system - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Trying to make a camera system</h2>
<div id="posts">
<div class="post">
    <h4>#104223 - DiscoStew - Wed Sep 27, 2006 6:33 am</h4>
    <div class="postbody"><span class="postbody">I've been at this for a while, and even though I've only starting OpenGL in the past few days, I am getting frustrated because I am really unsure about whether or not I'm even doing this right, and I would appreciate any help that could get me pointed in the right direction if possible.
<br/>
<br/>
What I am trying to do in my program is make a freely moveable camera with attributes of having a 3D position and 3 axises to tilt in any direction. My problem deals with the camera position and the object positions in the scene, though I may go into other things that perhaps might be changed to help fix those problems.
<br/>
<br/>
As far as making the camera affected by it axis, I have the following code...
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">gluLookAtf32( camPos.x, camPos.y, camPos.z, camPos.x, camPos.y, camPos.z - 4096, 0, 4096, 0 );
<br/>
glRotatef32i( camLookAng.y, 0, 4096, 0 );
<br/>
glRotatef32i( camLookAng.x, 4096, 0, 0 );
<br/>
glRotatef32i( camLookAng.z, 0, 0, 4096 );
<br/>
</td> </tr></table><span class="postbody">
<br/>
...which pretty much allows my camera to look at any angle from it's position. This seems to work until I either look straight down or straight up (which if I have read correctly creates problems unless you adjust the Up vector?), but enough of that, as I am more concerned with actual positioning.
<br/>
<br/>
As that function shows, I have the coordinates for the camera, as well as a place to look at that is 1 unit ahead of it, but when I go to place objects in the scene by translation, they seem to go off where the camera is, like that is where (0,0,0) is. It could be something very simple in my project that I have overlooked, but out of all the examples and tutorials I've seen, I have not seen anything that could help against this. All I want is to have my camera to not be fixed at (0,0,0), but have everything go off of that point and not the camera. Here is my actual code...
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int main( void )
<br/>
{
<br/>
<br/>
   *code here for initialization, cut out to not make this large*
<br/>
<br/>
   GLvector camPos = { 0, 4096, 0 };
<br/>
<br/>
   // Set our viewport to be the same size as the screen
<br/>
   glViewPort( 0, 0, 255, 191 );
<br/>
   
<br/>
   // Specify the Clear Color and Depth 
<br/>
   glClearColor( 0, 255, 0 );
<br/>
<br/>
   glClearDepth( 0x7FFF );
<br/>
<br/>
   while(1) {
<br/>
<br/>
      // Reset the screen and setup the view
<br/>
      glReset();
<br/>
<br/>
      glMatrixMode( GL_PROJECTION );
<br/>
            
<br/>
      gluPerspective( 35, 256.0 / 192.0, 0.1, 100 );
<br/>
            
<br/>
      gluLookAtf32( camPos.x, camPos.y, camPos.z, camPos.x, camPos.y, camPos.z - 4096, 0, 4096, 0 );
<br/>
      glRotatef32i( camLookAng.y, 0, 4096, 0 );
<br/>
      glRotatef32i( camLookAng.x, 4096, 0, 0 );
<br/>
      glRotatef32i( camLookAng.z, 0, 0, 4096 );
<br/>
      
<br/>
         
<br/>
      glColor3b( 255, 255, 255 );                  // Set the color..not in nehe source...ds gl default will be black
<br/>
<br/>
      // Set the current matrix to be the model matrix
<br/>
      glMatrixMode( GL_MODELVIEW );
<br/>
      
<br/>
      //Push our original Matrix onto the stack (save state)
<br/>
      glPushMatrix();
<br/>
<br/>
      //ds specific, several attributes can be set here   
<br/>
      glPolyFmt( POLY_ALPHA(31) | POLY_CULL_NONE );
<br/>
      
<br/>
      DrawGLScene();
<br/>
      
<br/>
      // Pop our Matrix from the stack (restore state)
<br/>
      glPopMatrix( 1 );
<br/>
<br/>
      // flush to screen   
<br/>
      glFlush();
<br/>
<br/>
      //a handy little built in function to wait for a screen refresh
<br/>
      swiWaitForVBlank();
<br/>
<br/>
   }
<br/>
   return 0;
<br/>
}
<br/>
<br/>
int DrawGLScene(void)
<br/>
{
<br/>
   glLoadIdentity();
<br/>
   glTranslate3f32( 0, 0, -8192 );
<br/>
   glRotatef32i(0, 0, 4096, 0);
<br/>
   glRotatef32i(0, 4096, 0, 0);
<br/>
   glRotatef32i(0, 0, 0, 4096);
<br/>
   glCallList( cube );
<br/>
<br/>
   return TRUE;                              // Keep Going
<br/>
<br/>
}</td> </tr></table><span class="postbody"><br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104253 - Zed0 - Wed Sep 27, 2006 1:54 pm</h4>
    <div class="postbody"><span class="postbody">I'm unsure about this but if you can move the surrounding objects around but not the camera couldn't you just move them negatively to get the same effect as moving the camera?
<br/>
<br/>
i.e. intead of 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">glTranslate3f32( 1, 2, 3 );</td> </tr></table><span class="postbody">
<br/>
you would use
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">glTranslate3f32( -1, -2, -3 );</td> </tr></table><span class="postbody"><br/>_________________<br/><span style="text-decoration: underline">__Zed0__</span>
<br/>
FlasheMe'd Silver DS - GBAMP-CF - 512MB CF Card - R4DS - 2GB Micro SD Card</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104256 - DiscoStew - Wed Sep 27, 2006 2:46 pm</h4>
    <div class="postbody"><span class="postbody">Heh, this morning as I woke up, I had this same idea. So you mean instead of moving the camera, move the objects just the opposite?
<br/>
<br/>
I think I see where this is going. Perhaps I can keep my "camPos", but not actually use it for setting the camera position, but instead use those coordinates and find the difference from that and the objects I want displayed, and position that way? So do something like this?...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">camPos = { 0, 4096, 0 };    //Camera is 1 unit above origin
<br/>
.
<br/>
.
<br/>
glLookAtf32( 0, 0, 0, 0, 0, -4096, 0, 4096, 0 };   //Camera at origin looking down -z
<br/>
.
<br/>
.
<br/>
glLoadIdentity();
<br/>
objDif.x = objPos.x - camPos.x;
<br/>
objDif.y = objPos.y - camPos.y;
<br/>
objDif.z = objPos.z - camPos.z;
<br/>
glTranslate3f32( objDif.x, objDif.y, objDif.z );
<br/>
.
<br/>
.
<br/>
glCallList( cube );
<br/>
.
<br/>
.</td> </tr></table><span class="postbody">
<br/>
I'm currently unable to test this code right now, but would this work? And what about when I tilt the camera along it's 3 axises? Would those affect this object offset too, or not?<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104278 - silent_code - Wed Sep 27, 2006 6:03 pm</h4>
    <div class="postbody"><span class="postbody">dude, just call glTranslate and glRotate with the respective negative values:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
setCamera(pos, ang)
<br/>
{
<br/>
   glLoadIdentity();
<br/>
   glRotatef(-ang.x, 1.0f, 0.0f, 0.0f);
<br/>
   glRotatef(-ang.y, 0.0f, 1.0f, 0.0f);
<br/>
   glRotatef(-ang.z, 0.0f, 0.0f, 1.0f);
<br/>
   glTranslatef(-pos.x, -pos.y, -pos.z);
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
that way you can transform the virtual camera at the beginning of the frame and everything else will transform relative to that. well, that's just the theory. you should use the matrix stack in addition to that (for hierarchies) and quaternions for rotations, otherwise, if you used euler angles your system would suffer from gimbal lock (look that one up).
<br/>
<br/>
hope i could help a bit (i didn't read all you guys wrote, so i'm sorry if i'm echoing someone else).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104281 - DiscoStew - Wed Sep 27, 2006 6:09 pm</h4>
    <div class="postbody"><span class="postbody">Well, after having tried these changes to my code, it seems that positioning of the objects works well, but the problem now is that the camera doesn't adjust itself by its axises anymore.
<br/>
<br/>
With the cube I had before, when the camera was point down -z, it was positioned down that too, and it looked fine, but when I go to change any axis, the cube remains fixed in it's orientation and position as well. Seems to me that the camera, when set at it's position and direction, becomes the focus point, and everything goes off that when I use glLoadIdentity, which I assume is what it is meant to do.
<br/>
<br/>
Maybe I should try what I did with positioning to work like that with direction as well.
<br/>
<br/>
EDIT:
<br/>
<br/>
silent_code,
<br/>
<br/>
I'll try your approach. Seems almost like what I thought up. Like I said, I'm still learning about OpenGL, so I guess I have a lot to learn.<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104294 - silent_code - Wed Sep 27, 2006 8:58 pm</h4>
    <div class="postbody"><span class="postbody">it's not that hard once you get the idea. you can also create an orbiting camera easily that way:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
setOrbCamera(pos, ang, target)
<br/>
{
<br/>
   glLoadIdentity();
<br/>
   glTranslatef(pos.x, pos.y, pos.z);
<br/>
   glRotatef(ang.x, 1.0f, 0.0f, 0.0f);
<br/>
   glRotatef(ang.y, 0.0f, 1.0f, 0.0f);
<br/>
   glRotatef(ang.z, 0.0f, 0.0f, 1.0f);
<br/>
   glTranslatef(-target.x, -target.y, -target.z);
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
easy, isn't it? this is quite basic aswell, but it works. again, you better use quaternions for rotations (ever wondered about the layout of glRotate? you can do all rotations with just one call with the help of 'em ;D ).
<br/>
<br/>
this cam rotates around the target position and the cameras position is the offset. also note that the cam allways looks at the target.
<br/>
<br/>
if you want to leave the cameras position as it's position you can also implement a short function that will aim the cam at the target (sort of "look at"). i leave that for you, as an exercise. ;)
<br/>
<br/>
i don't see any need for more math than necessary. this code and the above will be enough for fps or rts or racing games. when it comes to real 6-dof cameras you will need the rotation upgrade for sure.
<br/>
actually, this is working code i have in top down shooters, fps, tools and heck nows what else.
<br/>
<br/>
btw: the tombraider camera system was one of the first games i know of that used quaternions for the camera's rotation. so they are pretty good documented on the net. plus they are know for about nearly 200 years or so...
<br/>
<br/>
good luck!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104305 - sajiimori - Wed Sep 27, 2006 10:40 pm</h4>
    <div class="postbody"><span class="postbody">About using quaternions, it really depends on the situation.  Most of the time, I convert Euler angles straight to 3x3 matrices in one step.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104308 - silent_code - Wed Sep 27, 2006 11:03 pm</h4>
    <div class="postbody"><span class="postbody">as i said, it's only (not literally 'only') for real 6 degree of freedom camera rotations.
<br/>
but you're right, 3x3 matrices (sometimes called rotation matrices) will be enough most of the time. the code i posted will also do the job. i ran only once into a situation where i *really* needed quaternions... but having them *can* make your life easier. use your tools wisely.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104355 - DiscoStew - Thu Sep 28, 2006 8:00 am</h4>
    <div class="postbody"><span class="postbody">thx silent_code, it seems to work for what I need at the moment. I'm sure I'll need to change to quaternions at some point, but not right now. I'd need to understand them first before even attempting it.<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#105796 - silent_code - Wed Oct 11, 2006 10:58 pm</h4>
    <div class="postbody"><span class="postbody">:)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
