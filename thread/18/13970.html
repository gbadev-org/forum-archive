<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Chishm Loader in PAlib - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Chishm Loader in PAlib</h2>
<div id="posts">
<div class="post">
    <h4>#138204 - calcprogrammer1 - Tue Aug 21, 2007 3:51 am</h4>
    <div class="postbody"><span class="postbody">Since this is sort of off topic for Chishm's topic, I'll move this discussion to it's own topic.
<br/>
<br/>
I'm trying to use Chishm's Bootloader with PAlib.  Currently, I put the ARM7 files (nds_loader_arm7.h and .c) in PAlib/lib/arm7 and added #include "nds_loader_arm7.h" and the check function to main.c for the arm7.  Then I copied the load.bin (not renamed, renamed made load_bin_bin.h) to PAlib/lib/arm9/data, then copied the nds_loader_arm9.h and .c to PAlib/lib/arm9.  I added #include "nds_loader_arm9.h" to the main.c in there too.  Then I tried the fast build thing.  This is what I got:
<br/>
<br/>
<a href="http://img382.imageshack.us/img382/3168/palibscreen1bd0.jpg">[Images not permitted - Click here to view it]</a>
<br/>
<br/>
Any ideas?
<br/>
<br/>
EDIT:  Just noticed the load.bin didn't compile, I cleaned and tried again.
<br/>
<br/>
<a href="http://img248.imageshack.us/img248/3108/palibscreen2ve7.jpg">[Images not permitted - Click here to view it]</a>
<br/>
<br/>
It says there's an error that REG_EXEMEMCNT isn't declared.  I looked at the source file (nds_loader_arm9.c) and...well, it isn't declared, it's used in the line:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">REG_EXEMEMCNT |= ARM7_OWNS_ROM | ARM7_OWNS_CARD;</td> </tr></table><span class="postbody">
<br/>
<br/>
If such function or variable is declared in the ARM7 code, maybe the arm9 code isn't seeing it...well, I've looked through both ARM7 files (.h and .c) and found no REG_EXEMEMCNT, so that isn't it...  Is this declared in the load.bin file?  libnds?  libfat?  Where is REG_EXEMEMCNT declared to begin with, that way it could be added or compiled in with the PAlib compile.
<br/>
<br/>
<br/>
EDIT AGAIN :) :
<br/>
<br/>
A google search of "REG_EXEMEMCNT" turned up some interesting posts.  Apparently REG_EXEMEMCNT was renamed REG_EXMEMCNT, and this edit makes it compile just fine :P  Now to test the code to see if it WORKS.<br/>_________________<br/>DS Firmware 1, Datel Games n' Music card / Chism's FW hacked GBA MP v2 CF
<br/>
<br/>
There's no place like 127.0.0.1.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#138208 - calcprogrammer1 - Tue Aug 21, 2007 4:52 am</h4>
    <div class="postbody"><span class="postbody">Ok, so I think I've got it all sorted out, but there's some problems left.  I put the .h files in PAlib/include/PA9.h and PAlib/include/PA7.h (did #include "arm9/nds_loader_arm9.h" etc, put the .h'es in PAlib/include/arm9 and PAlib/include/arm7 respectively.  Then, I recompiled PAlib, and it worked.  Now, in my program DSFile, I have:
<br/>
<br/>
//PAlib and libfat includes:
<br/>
<br/>
#include &lt;PA9.h&gt;
<br/>
#include &lt;fat.h&gt;
<br/>
#include &lt;sys/dir.h&gt;
<br/>
<br/>
//DSFile graphics includes:
<br/>
<br/>
#include "gfx/all_gfx.c"
<br/>
#include "gfx/all_gfx.h"
<br/>
<br/>
//in DSFile's source folder:
<br/>
<br/>
#include "global.h" //global defines, function def's, and vars
<br/>
#include "file.h" //file functions
<br/>
#include "screen.h" //graphics functions
<br/>
#include "input.h" //get keys, touch, etc
<br/>
<br/>
Then, in my input.h file, I have a function "getKeys()".  It is in charge of all the key input (up, down, a, and b).
<br/>
<br/>
...
<br/>
if(Pad.Newpress.B){
<br/>
strcpy(currentdir,fixFilename(currentdir,position));
<br/>
runNdsFile(currentdir);
<br/>
getFileList();
<br/>
position=0;
<br/>
updateScreen(position)
<br/>
...
<br/>
<br/>
But, when compiling, I get this:
<br/>
<br/>
Linking...
<br/>
main.o: In function 'getKeys(int&amp;)':
<br/>
c:/devkitPro/Projects/DSFile2/DSFile2/source/input.h(35): undefined reference to 'runNdsFile'
<br/>
collect2: 1d returned 1 exit status
<br/>
make[1]: *** [/c/devkitPro/Projects/DSFile2/DSFile2/Release/DSFile2.elf] Error 1
<br/>
make: *** [build] Error 2
<br/>
Build log was saved at "file://c:\devkitPro\Projects\DSFile2\DSFile2\Release\BuildLog.htm"
<br/>
DSFile2 - 0 error (s), 1 warning(s)
<br/>
=============Rebuild All: 1 succeeded, 0 failed, 0 skipped ============<br/>_________________<br/>DS Firmware 1, Datel Games n' Music card / Chism's FW hacked GBA MP v2 CF
<br/>
<br/>
There's no place like 127.0.0.1.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#138218 - spinal_cord - Tue Aug 21, 2007 10:13 am</h4>
    <div class="postbody"><span class="postbody">in the arm9 code it calls
<br/>
<br/>
	return runNds (load_bin, load_bin_size, st.st_ino, false, true);
<br/>
<br/>
however palib does not add _bin to the end of the load.bin file, so the arguments are wrong.
<br/>
you can either change that line (and the include at the top) to 	
<br/>
return runNds (load, load_size, st.st_ino, false, true);
<br/>
or rename load.bin to load_bin.bin
<br/>
<br/>
neither solutions help load a file though.<br/>_________________<br/>I'm not a boring person, it's just that boring things keep happening to me.
<br/>
<a class="postlink" href="http://spinal.dizidesigns.co.uk/" target="_blank">Homepage</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#138233 - calcprogrammer1 - Tue Aug 21, 2007 3:49 pm</h4>
    <div class="postbody"><span class="postbody">Are you sure?  Look at my second screenshot, it compiles "load.bin" and then in the build folder, there's "load_bin.h" and "load.o", if I rename it load_bin.bin, I get a "load_bin.o" and a "load_bin_bin.h".
<br/>
<br/>
I changed load_bin to load, and load_bin_size to load_size, recompiled, and got this error:
<br/>
<br/>
nds_loader_arm9.c
<br/>
c:/devkitPro/PAlib/lib/arm9/nds_loader_arm9.c: In function 'runNdsFile':
<br/>
c:/devkitPro/PAlib/lib/arm9/nds_loader_arm9.c:253: error: 'load' undeclared
<br/>
<br/>
I also get the same saying 'load_size' undeclared.
<br/>
<br/>
I've changed it back, it compiles fine.
<br/>
<br/>
Now the problem is the undefined reference again.  Undefined reference, according to sites I've searched for, has to do with how you include a library or something, but I don't know.  All the rest of PAlib works fine, just when I use the runNdsFile() function it gives the undefined reference.<br/>_________________<br/>DS Firmware 1, Datel Games n' Music card / Chism's FW hacked GBA MP v2 CF
<br/>
<br/>
There's no place like 127.0.0.1.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#138236 - tondopie - Tue Aug 21, 2007 4:49 pm</h4>
    <div class="postbody"><span class="postbody">I have said this many times... you will have to re-write the way PAlib handles .bin files. Try starting with the makefile.<br/>_________________<br/><span style="font-weight: bold">Development Blog:</span> <a class="postlink" href="http://teendev.org" target="_blank">http://teendev.org</a>
<br/>
<span style="font-weight: bold">Homebrew Podcast:</span> <a class="postlink" href="http://homebrewcast.net" target="_blank">http://homebrewcast.net</a>
<br/>
<span style="font-weight: bold">Web Design:</span> <a class="postlink" href="http://xtendesign.net" target="_blank">http://xtendesign.net</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#138239 - calcprogrammer1 - Tue Aug 21, 2007 5:03 pm</h4>
    <div class="postbody"><span class="postbody">I opened PAlib's makefile, it archives files, all the PAlib ones were there, so I added the nds_loader_arm9.o file, hopefully that will make it work.
<br/>
<br/>
Hmm...
<br/>
<br/>
Now it returns a different error:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">------ Rebuild All started: Project: boottest, Configuration: Release Win32 ------
<br/>
Performing Makefile project actions
<br/>
Cleaning... boottest
<br/>
logo.bmp
<br/>
logo_wifi.bmp
<br/>
main.cpp
<br/>
Linking...
<br/>
c:/devkitPro/PAlib/lib\libpa9.a(nds_loader_arm9.o): In function `runNds':
<br/>
nds_loader_arm9.c:(.text+0x550): undefined reference to `_io_dldi'
<br/>
nds_loader_arm9.c:(.text+0x564): undefined reference to `_io_dldi'
<br/>
collect2: ld returned 1 exit status
<br/>
make[1]: *** [/c/devkitPro/Projects/boottest/boottest/Release/boottest.elf] Error 1
<br/>
make: *** [build] Error 2
<br/>
Build log was saved at "file://c:\devkitPro\Projects\boottest\boottest\Release\BuildLog.htm"
<br/>
boottest - 0 error(s), 0 warning(s)
<br/>
========== Rebuild All: 1 succeeded, 0 failed, 0 skipped ==========</td> </tr></table><span class="postbody"><br/>_________________<br/>DS Firmware 1, Datel Games n' Music card / Chism's FW hacked GBA MP v2 CF
<br/>
<br/>
There's no place like 127.0.0.1.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#138241 - tondopie - Tue Aug 21, 2007 5:08 pm</h4>
    <div class="postbody"><span class="postbody">that's not the problem. you don't need to get that archived. It gets archived automatically. It's the load.bin that needs to be handled differently. Open up a regular arm9 makefile and open up a PAlib arm9 makefile and see the difference.<br/>_________________<br/><span style="font-weight: bold">Development Blog:</span> <a class="postlink" href="http://teendev.org" target="_blank">http://teendev.org</a>
<br/>
<span style="font-weight: bold">Homebrew Podcast:</span> <a class="postlink" href="http://homebrewcast.net" target="_blank">http://homebrewcast.net</a>
<br/>
<span style="font-weight: bold">Web Design:</span> <a class="postlink" href="http://xtendesign.net" target="_blank">http://xtendesign.net</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#138244 - calcprogrammer1 - Tue Aug 21, 2007 5:23 pm</h4>
    <div class="postbody"><span class="postbody">Normal makefile:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">BINFILES     :=     $(foreach dir,$(DATA),$(notdir $(wildcard $(dir)/*.*)))</td> </tr></table><span class="postbody">
<br/>
<br/>
PAlib makefile:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">BINFILES     :=     $(foreach dir, $(SOURCES),$(notdir $(wildcard $(dir)/*.bin)))</td> </tr></table><span class="postbody">
<br/>
<br/>
I tried replacing it, it has compile errors.  I'm looking through the PAlib makefile, trying to find bin, I found this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">define bin202
<br/>
     cp $(&lt;) $(*).tmp
<br/>
     $(OBJCOPY) -I binary -O elf32-littlearm -B arm \
<br/>
     --rename-section .data=.rodata \
<br/>
     --redefine-sym _binary_$*_tmp_start=$*\
<br/>
     --redefine-sym _binary_$*_tmp_end=$*_end\
<br/>
     --redefine-sym _binary_$*_tmp_size=$*_size\
<br/>
     $(*).tmp $(@)
<br/>
     echo "extern const u8" $(*)"[];" &gt; $(*).h
<br/>
     echo "extern const u32" $(*)_size[]";" &gt;&gt; $(*).h
<br/>
     rm $(*).tmp
<br/>
endef</td> </tr></table><span class="postbody"><br/>_________________<br/>DS Firmware 1, Datel Games n' Music card / Chism's FW hacked GBA MP v2 CF
<br/>
<br/>
There's no place like 127.0.0.1.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#138249 - tondopie - Tue Aug 21, 2007 7:51 pm</h4>
    <div class="postbody"><span class="postbody">you'll have to figure it out yourself. I don't have access to a compiler right now. It will require having all you data files renamed in your includes.<br/>_________________<br/><span style="font-weight: bold">Development Blog:</span> <a class="postlink" href="http://teendev.org" target="_blank">http://teendev.org</a>
<br/>
<span style="font-weight: bold">Homebrew Podcast:</span> <a class="postlink" href="http://homebrewcast.net" target="_blank">http://homebrewcast.net</a>
<br/>
<span style="font-weight: bold">Web Design:</span> <a class="postlink" href="http://xtendesign.net" target="_blank">http://xtendesign.net</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#138258 - Lick - Tue Aug 21, 2007 10:13 pm</h4>
    <div class="postbody"><span class="postbody">Does PALib's FAT library has its own version of "_io_dldi"? Because it's a libfat variable.<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#138259 - calcprogrammer1 - Tue Aug 21, 2007 10:24 pm</h4>
    <div class="postbody"><span class="postbody">PAlib's FAT library is absent, I don't think PAfs supports FAT, so I'm already using libfat in my program (not necessarily PAlib though, but fat.h is in my program)<br/>_________________<br/>DS Firmware 1, Datel Games n' Music card / Chism's FW hacked GBA MP v2 CF
<br/>
<br/>
There's no place like 127.0.0.1.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#138288 - spinal_cord - Wed Aug 22, 2007 10:09 am</h4>
    <div class="postbody"><span class="postbody">I included nds_loader_arm9.h in <span style="font-style: italic">my</span> main.c, not the palib one. It seemed to work fine, but still no launching.<br/>_________________<br/>I'm not a boring person, it's just that boring things keep happening to me.
<br/>
<a class="postlink" href="http://spinal.dizidesigns.co.uk/" target="_blank">Homepage</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#138300 - calcprogrammer1 - Wed Aug 22, 2007 3:05 pm</h4>
    <div class="postbody"><span class="postbody">I have it compiling now too (added libfat includes to my test project), but it crashes whenever it gets to runNdsFile().<br/>_________________<br/>DS Firmware 1, Datel Games n' Music card / Chism's FW hacked GBA MP v2 CF
<br/>
<br/>
There's no place like 127.0.0.1.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#138318 - spinal_cord - Wed Aug 22, 2007 10:57 pm</h4>
    <div class="postbody"><span class="postbody">Thats as far as I've got also.
<br/>
<br/>
Surely someone who knows loaders (or palib) well can help.<br/>_________________<br/>I'm not a boring person, it's just that boring things keep happening to me.
<br/>
<a class="postlink" href="http://spinal.dizidesigns.co.uk/" target="_blank">Homepage</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#138334 - tondopie - Thu Aug 23, 2007 1:03 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lick wrote:</b></span></td> </tr> <tr> <td class="quote">Does PALib's FAT library has its own version of "_io_dldi"? Because it's a libfat variable.</td> </tr></table><span class="postbody">
<br/>
<br/>
that's a  very good point. PAlib might have its own FAT wrapper. I know older versions had their own FAT libs. I don't know it\f that is still the case though.<br/>_________________<br/><span style="font-weight: bold">Development Blog:</span> <a class="postlink" href="http://teendev.org" target="_blank">http://teendev.org</a>
<br/>
<span style="font-weight: bold">Homebrew Podcast:</span> <a class="postlink" href="http://homebrewcast.net" target="_blank">http://homebrewcast.net</a>
<br/>
<span style="font-weight: bold">Web Design:</span> <a class="postlink" href="http://xtendesign.net" target="_blank">http://xtendesign.net</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#139911 - spinal_cord - Tue Sep 11, 2007 1:43 pm</h4>
    <div class="postbody"><span class="postbody">Sorry to bump this again, but does anyone know how to get this (or any dldi) loader to work in palib?<br/>_________________<br/>I'm not a boring person, it's just that boring things keep happening to me.
<br/>
<a class="postlink" href="http://spinal.dizidesigns.co.uk/" target="_blank">Homepage</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#139946 - tondopie - Tue Sep 11, 2007 11:01 pm</h4>
    <div class="postbody"><span class="postbody">nope, not if it requires .bin files.<br/>_________________<br/><span style="font-weight: bold">Development Blog:</span> <a class="postlink" href="http://teendev.org" target="_blank">http://teendev.org</a>
<br/>
<span style="font-weight: bold">Homebrew Podcast:</span> <a class="postlink" href="http://homebrewcast.net" target="_blank">http://homebrewcast.net</a>
<br/>
<span style="font-weight: bold">Web Design:</span> <a class="postlink" href="http://xtendesign.net" target="_blank">http://xtendesign.net</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
