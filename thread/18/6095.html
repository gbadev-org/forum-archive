<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Mario 64DS and it's compressed files - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Mario 64DS and it's compressed files</h2>
<div id="posts">
<div class="post">
    <h4>#46073 - Kyoufu Kawa - Sun Jun 19, 2005 3:39 pm</h4>
    <div class="postbody"><span class="postbody">Having abused NDSTool a bit, I noticed that nearly every single file in Mario 64DS's filesystem is LZ77 compressed. Even sounds and dialogue text.
<br/>
<br/>
I've tried cheating with some GBA tools, tried to write my own, but I can't seem to get these files to unpack correctly &gt;_&lt;
<br/>
<br/>
Any ideas?
<br/>
<br/>
<br/>
<br/>
Very slightly off-topic: <a class="postlink" href="http://board.acmlm.org/thread.php?id=12971&amp;pl=255238" target="_blank">http://board.acmlm.org/thread.php?id=12971&amp;pl=255238</a> &lt;- the inspiration to ask this.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46079 - wintermute - Sun Jun 19, 2005 5:31 pm</h4>
    <div class="postbody"><span class="postbody">try gbalzss
<br/>
<br/>
<a href="http://cvs.sourceforge.net/viewcvs.py/devkitpro/tools/gba/" target="_blank">http://cvs.sourceforge.net/viewcvs.py/devkitpro/tools/gba/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46082 - Kyoufu Kawa - Sun Jun 19, 2005 6:06 pm</h4>
    <div class="postbody"><span class="postbody">Nice. But all of these files have a small header of at least 4 bytes, those being "LZ77". I tried to expand them myself by skipping those four, but that didn't work...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46086 - tepples - Sun Jun 19, 2005 7:48 pm</h4>
    <div class="postbody"><span class="postbody">The 'lzgb' tool included with <a class="postlink" href="http://www.pineight.com/gba/" target="_blank">Tetanus On Drugs M3</a> should be able to pack the GBA's variant of LZSS properly, although it doesn't have a VRAM-safe mode yet.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46090 - Kyoufu Kawa - Sun Jun 19, 2005 8:15 pm</h4>
    <div class="postbody"><span class="postbody">But Tepp, I don't want to -pack- them. I want to -un-pack them.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46093 - tepples - Sun Jun 19, 2005 9:05 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Kyoufu Kawa wrote:</b></span></td> </tr> <tr> <td class="quote">But Tepp, I don't want to -pack- them. I want to -un-pack them.</td> </tr></table><span class="postbody">
<br/>
For each file that is 64 KB or smaller, you can call LZ77UnCompWram() within a GBA emulator and then copy the result to cart SRAM (which should pop up as a .sav file).<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46101 - SmileyDude - Mon Jun 20, 2005 3:55 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Kyoufu Kawa wrote:</b></span></td> </tr> <tr> <td class="quote">But Tepp, I don't want to -pack- them. I want to -un-pack them.</td> </tr></table><span class="postbody">
<br/>
For each file that is 64 KB or smaller, you can call LZ77UnCompWram() within a GBA emulator and then copy the result to cart SRAM (which should pop up as a .sav file).</span></td> </tr></table><span class="postbody">
<br/>
<br/>
I haven't tested this myself, but you could also use the source to VBA's implementation of the LZ77UnCompWram() function in your own code, and uncompress it directly.  If the LZ77UnCompWram() works in VBA, that is :)<br/>_________________<br/>dennis</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46104 - tepples - Mon Jun 20, 2005 5:41 am</h4>
    <div class="postbody"><span class="postbody">The implementation of LZ77UnCompWram() in VBA's high-level-emulated BIOS works. What doesn't work is the 'offset' parameter to BitUnPack(); VBA treats it as always zero.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46115 - Kyoufu Kawa - Mon Jun 20, 2005 12:58 pm</h4>
    <div class="postbody"><span class="postbody">The code I used was a VB translation of Visualboy's unpacker. I think I was just off by... a couple bytes. Not knowing the header size sucks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46144 - Kyoufu Kawa - Mon Jun 20, 2005 8:17 pm</h4>
    <div class="postbody"><span class="postbody">Well, I tried that tool you linked to, thank whatever deity you believe in that I just acquired a copy of VC7 to compile it with ^_^
<br/>
<br/>
And hey, it works!
<br/>
<br/>
<a href="http://helmetedrodent.kickassgamers.com/wipe_mario.png">[Images not permitted - Click here to view it]</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
