<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>overlays - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > overlays</h2>
<div id="posts">
<div class="post">
    <h4>#170435 - Tommmie - Thu Sep 24, 2009 6:45 pm</h4>
    <div class="postbody"><span class="postbody">hey everyone,
<br/>
<br/>
me again, but this time about code overlays. Someone linked me to this post: <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=14707" target="_blank">http://forum.gbadev.org/viewtopic.php?t=14707</a> but when looking at Wintermutes instructions I'm really confused. In which .ld file do i have to put this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Firstly add an extra exclusion category to the main text segment.
<br/>
<br/>
Code:
<br/>
<br/>
   .text :   /* ALIGN (4): */
<br/>
   {
<br/>
      *(EXCLUDE_FILE (*.itcm* *.overlay*) .text)
<br/>
<br/>
<br/>
Then later, after the .bss section we generate the overlays.
<br/>
<br/>
Code:
<br/>
<br/>
   __ewram_overlay_lma = __bss_lma + SIZEOF(.bss);
<br/>
<br/>
   OVERLAY ALIGN(4) : NOCROSSREFS AT (__ewram_overlay_lma)
<br/>
   {
<br/>
      .overlay0 { *(.overlay0) *.overlay0*(.text) . = ALIGN(4); }
<br/>
      .overlay1 { *(.overlay1) *.overlay1*(.text) . = ALIGN(4); }
<br/>
      .overlay2 { *(.overlay2) *.overlay2*(.text) . = ALIGN(4); }
<br/>
      .overlay3 { *(.overlay3) *.overlay3*(.text) . = ALIGN(4); }
<br/>
      .overlay4 { *(.overlay4) *.overlay4*(.text) . = ALIGN(4); }
<br/>
      .overlay5 { *(.overlay5) *.overlay5*(.text) . = ALIGN(4); }
<br/>
      .overlay6 { *(.overlay6) *.overlay6*(.text) . = ALIGN(4); }
<br/>
      .overlay7 { *(.overlay7) *.overlay7*(.text) . = ALIGN(4); }
<br/>
      .overlay8 { *(.overlay8) *.overlay8*(.text) . = ALIGN(4); }
<br/>
      .overlay9 { *(.overlay9) *.overlay9*(.text) . = ALIGN(4); }
<br/>
   }
<br/>
<br/>
   PROVIDE (__overlay0_size = SIZEOF(.overlay0));
<br/>
   PROVIDE (__overlay1_size = SIZEOF(.overlay1));
<br/>
   PROVIDE (__overlay2_size = SIZEOF(.overlay2));
<br/>
   PROVIDE (__overlay3_size = SIZEOF(.overlay3));
<br/>
   PROVIDE (__overlay4_size = SIZEOF(.overlay4));
<br/>
   PROVIDE (__overlay5_size = SIZEOF(.overlay5));
<br/>
   PROVIDE (__overlay6_size = SIZEOF(.overlay6));
<br/>
   PROVIDE (__overlay7_size = SIZEOF(.overlay7));
<br/>
   PROVIDE (__overlay8_size = SIZEOF(.overlay8));
<br/>
   PROVIDE (__overlay9_size = SIZEOF(.overlay9));
<br/>
<br/>
   /* find the largest allocated overlay section */
<br/>
   __ewram_overlay_alloc = MAX( SIZEOF(.overlay0) , SIZEOF(.overlay1) );
<br/>
   __ewram_overlay_alloc = MAX( __ewram_overlay_alloc , SIZEOF(.overlay2) );
<br/>
   __ewram_overlay_alloc = MAX( __ewram_overlay_alloc , SIZEOF(.overlay3) );
<br/>
   __ewram_overlay_alloc = MAX( __ewram_overlay_alloc , SIZEOF(.overlay4) );
<br/>
   __ewram_overlay_alloc = MAX( __ewram_overlay_alloc , SIZEOF(.overlay5) );
<br/>
   __ewram_overlay_alloc = MAX( __ewram_overlay_alloc , SIZEOF(.overlay6) );
<br/>
   __ewram_overlay_alloc = MAX( __ewram_overlay_alloc , SIZEOF(.overlay7) );
<br/>
   __ewram_overlay_alloc = MAX( __ewram_overlay_alloc , SIZEOF(.overlay8) );
<br/>
   __ewram_overlay_alloc = MAX( __ewram_overlay_alloc , SIZEOF(.overlay9) );
<br/>
<br/>
   /* if we use . here then _end points to overlay_lma + SIZEOF(overlay0) ... SIZEOF(overlay9) */
<br/>
<br/>
   _end = __ewram_overlay_lma + __ewram_overlay_alloc ;
<br/>
   __end__ = __ewram_overlay_lma + __ewram_overlay_alloc ;
<br/>
   PROVIDE (end = _end);
<br/>
</td> </tr></table><span class="postbody">?
<br/>
<br/>
Tommmie[/quote][/url]</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
