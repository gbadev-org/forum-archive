<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>3D on both screens - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > 3D on both screens</h2>
<div id="posts">
<div class="post">
    <h4>#105133 - Dan Forever - Fri Oct 06, 2006 9:50 am</h4>
    <div class="postbody"><span class="postbody">Does anyone have some source code I could look at or a link to a tutorial explaining how do 3D on both screens of the DS? I know it can be done but my searches aren't having any luck :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#105168 - ecurtz - Fri Oct 06, 2006 3:17 pm</h4>
    <div class="postbody"><span class="postbody"><a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=7958" target="_blank">http://forum.gbadev.org/viewtopic.php?t=7958</a>
<br/>
<br/>
Second demo in that post.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#105952 - FireSlash - Fri Oct 13, 2006 3:56 pm</h4>
    <div class="postbody"><span class="postbody">I did it in LumiDS.
<br/>
<br/>
The code uses glOrtho, and it's pretty hacky, but you should be able to get the idea.
<br/>
<br/>
<a href="http://www.fireslash.net/~fireslash/files/lumids_0.2b_src.zip" target="_blank">http://www.fireslash.net/~fireslash/files/lumids_0.2b_src.zip</a>
<br/>
<br/>
Important bits with my crap trimmed out:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">// ------ LumiDS --------
<br/>
// Written by Christopher 'FireSlash' Kadar
<br/>
// &lt;GPL goes here&gt;
<br/>
<br/>
//Needed for the second screen
<br/>
#define   REG_CAPTURE      (*(vu32*)0x04000064)
<br/>
<br/>
// General includes
<br/>
#include &lt;nds.h&gt;
<br/>
<br/>
// Needed for dual screen 3D
<br/>
void SetRegCapture(bool enable, uint8 srcBlend, uint8 destBlend, uint8 bank, uint8 offset, uint8 size, uint8 source, uint8 srcOffset);
<br/>
<br/>
bool busy;
<br/>
<br/>
float   xrot;
<br/>
float   yrot;
<br/>
float   zrot;
<br/>
<br/>
//a global copy of sprite attribute memory
<br/>
SpriteEntry sprites[128];
<br/>
<br/>
//turn off all the sprites
<br/>
void InitSprites()
<br/>
{
<br/>
   for(int i = 0; i &lt; 128; i++)
<br/>
   {
<br/>
      sprites[i].attribute[0] = ATTR0_DISABLED;
<br/>
      sprites[i].attribute[1] = 0;
<br/>
      sprites[i].attribute[2] = 0;
<br/>
      sprites[i].attribute[3] = 0;
<br/>
    }
<br/>
}
<br/>
//copy our sprite to object attribute memory
<br/>
void UpdateOAM()
<br/>
{
<br/>
   dmaCopy(sprites, OAM_SUB, 128 * sizeof(SpriteEntry));
<br/>
}
<br/>
<br/>
<br/>
int main()
<br/>
{   
<br/>
   touchPosition touch;
<br/>
   // Turn on everything
<br/>
   powerON(POWER_ALL);
<br/>
   FAT_InitFiles(); // Get our GBAMP/M3/Whatever all warmed up ^^
<br/>
   
<br/>
   // Setup the Main screen for 3D 
<br/>
   videoSetMode(MODE_0_3D);
<br/>
   //vramSetBankA(VRAM_A_TEXTURE);                        
<br/>
<br/>
   videoSetModeSub(MODE_5_2D | DISPLAY_BG2_ACTIVE | DISPLAY_SPR_ACTIVE | DISPLAY_SPR_2D_BMP_256);
<br/>
   SUB_BG2_CR = BG_BMP16_256x256;
<br/>
   SUB_BG2_XDX = 256;
<br/>
   SUB_BG2_XDY = 0;
<br/>
   SUB_BG2_YDX = 0;
<br/>
   SUB_BG2_YDY = 256;
<br/>
   SUB_BG2_CY = 0;
<br/>
   SUB_BG2_CX = 0;
<br/>
      
<br/>
   vramSetMainBanks(VRAM_A_TEXTURE, VRAM_B_TEXTURE, VRAM_C_SUB_BG, VRAM_D_SUB_SPRITE);
<br/>
   
<br/>
   
<br/>
   memset(commandControl, 0, sizeof(CommandControl));
<br/>
<br/>
   int y = 0;
<br/>
   int x = 0;
<br/>
   for (y = 0; y &lt; SCREEN_HEIGHT; y++)
<br/>
   for (x = 0; x &lt; SCREEN_WIDTH; x++)
<br/>
   {
<br/>
      BG_GFX_SUB[y * SCREEN_WIDTH + x]  = RGB15(31, x % 32, y % 32) | BIT(15);
<br/>
   }
<br/>
<br/>
   // IRQ basic setup
<br/>
   irqInit(); 
<br/>
   irqSet(IRQ_VBLANK, 0);
<br/>
    //irqEnable(IRQ_VBLANK);
<br/>
<br/>
   glViewPort(0,0,255,191);
<br/>
   
<br/>
   // Specify the Clear Color and Depth 
<br/>
   glClearColor(0,0,0);
<br/>
   glClearDepth(0x7FFF);
<br/>
   InitSprites();
<br/>
    
<br/>
      int i = 0;
<br/>
   for (y = 0; y &lt; 3; y++)
<br/>
   for (x = 0; x &lt; 4; x++)
<br/>
   {
<br/>
      sprites[i].attribute[0] = ATTR0_BMP | ATTR0_SQUARE | (64 * y);
<br/>
      sprites[i].attribute[1] = ATTR1_SIZE_64 | (64 * x);
<br/>
      sprites[i].attribute[2] = ATTR2_ALPHA(1) | (8 * 32 * y) | (8 * x);
<br/>
      i++;
<br/>
   }
<br/>
   // framecount won't really work here... needs to be replaced
<br/>
   // with a more useful variable for deltas. try IPC-&gt;heartbeat.
<br/>
   uint32 frameCount = 0;
<br/>
   
<br/>
   while (1) 
<br/>
   {
<br/>
  
<br/>
      glReset();
<br/>
<br/>
      glOrtho(0,1,0,1,0,12);
<br/>
<br/>
      glColor3f(1,1,1);
<br/>
      
<br/>
      glLight(0, RGB15(31,31,31) , 0,              floattov10(-1.0),       0);
<br/>
      glLight(1, RGB15(31,31,31) , 0,              0,   floattov10(-1.0));
<br/>
      glLight(2, RGB15(31,31,31) , 0,              0,   floattov10(1.0));
<br/>
<br/>
      glPushMatrix();
<br/>
      
<br/>
      glMatrixMode(GL_TEXTURE);
<br/>
      glIdentity();
<br/>
      
<br/>
      glMatrixMode(GL_MODELVIEW);
<br/>
<br/>
      //need to set up some material properties since DS does not have them set by default
<br/>
      glMaterialf(GL_AMBIENT, RGB15(16,16,16));
<br/>
      glMaterialf(GL_DIFFUSE, RGB15(16,16,16));
<br/>
      glMaterialf(GL_SPECULAR, BIT(15) | RGB15(8,8,8));
<br/>
      glMaterialf(GL_EMISSION, RGB15(16,16,16));
<br/>
<br/>
      //ds uses a table for shinyness..this generates a half-ass one
<br/>
      glMaterialShinyness();
<br/>
      glEnable(GL_BLEND);
<br/>
      glEnable(GL_ALPHA_TEST);
<br/>
      
<br/>
      glMatrixMode(GL_MODELVIEW);
<br/>
      
<br/>
      //Push our original Matrix onto the stack (save state)
<br/>
      glPushMatrix();   
<br/>
<br/>
<br/>
      // This is where the magic happens
<br/>
<br/>
      if (frameCount &amp; 0x1)
<br/>
      {
<br/>
         vramSetBankC(VRAM_C_SUB_BG);
<br/>
         vramSetBankD(VRAM_D_LCD);
<br/>
         SetRegCapture(true, 0, 15, 3, 0, 3, 0, 0);
<br/>
         scene-&gt;draw_bottom(frameCount);
<br/>
      } else {
<br/>
         vramSetBankC(VRAM_C_LCD);
<br/>
         vramSetBankD(VRAM_D_SUB_SPRITE);
<br/>
         SetRegCapture(true, 0, 15, 2, 0, 3, 0, 0);
<br/>
         scene-&gt;draw_top(frameCount);
<br/>
      }
<br/>
      // Pop our Matrix from the stack (restore state)
<br/>
      glPopMatrix(1);
<br/>
      frameCount++;
<br/>
      // flush to screen   
<br/>
      glFlush();
<br/>
      lcdSwap();
<br/>
      UpdateOAM();
<br/>
      //swiWaitForVBlank(); 
<br/>
   }
<br/>
   return 0;
<br/>
}
<br/>
<br/>
<br/>
// <b style="color:#FFA34F">Capture</b> code from ecurtz from gbadev.org forums
<br/>
// Sets the DS to render straight to a <b style="color:#FFA34F">VRAM</b> bank instead of to the screen's bank.
<br/>
void SetRegCapture(bool enable, uint8 srcBlend, uint8 destBlend, uint8 bank, uint8 offset, uint8 size, uint8 source, uint8 srcOffset)
<br/>
{
<br/>
   uint32 value = 0;
<br/>
   if (enable)
<br/>
      value |= 1 &lt;&lt; 31; // 31 is enable
<br/>
   value |= 3 &lt;&lt; 29; // 29-30 seems to have something to do with the blending
<br/>
   value |= (srcOffset &amp; 0x3) &lt;&lt; 26; // <b style="color:#FFA34F">capture</b> source offset is 26-27
<br/>
   value |= (source &amp; 0x3) &lt;&lt; 24; // <b style="color:#FFA34F">capture</b> source is 24-25
<br/>
   value |= (size &amp; 0x3) &lt;&lt; 20; // <b style="color:#FFA34F">capture</b> data write size is 20-21
<br/>
   value |= (offset &amp; 0x3) &lt;&lt; 18; // write offset is 18-19 
<br/>
   value |= (bank &amp; 0x3) &lt;&lt; 16; // <b style="color:#FFA34F">vram</b> bank select is 16-17 
<br/>
   value |= (srcBlend &amp; 0xF) &lt;&lt; 8; // graphics blend evb is 8..12
<br/>
   value |= (destBlend &amp; 0xF) &lt;&lt; 0; // ram blend EVA is bits 0..4 
<br/>
   
<br/>
   REG_CAPTURE = value;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I hope this helps.<br/>_________________<br/><a class="postlink" href="http://www.fireslash.net" target="_blank">FireSlash.net</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111770 - djmcbell - Sat Dec 09, 2006 11:50 pm</h4>
    <div class="postbody"><span class="postbody">Sorry, but I'd like to bump this topic rather than make a new topic of my own.
<br/>
<br/>
I'm also looking at 3D on both screens. Basically, the top screen will be one angle of a scene, and the bottom screen will be another angle of the same scene. I've got the top screen set up, but am having a lot of trouble setting up the bottom one.
<br/>
<br/>
The demos listed above have helped me somewhat - from what I understand I should try capturing the information from the top screen, use an lcdSwap (or indeed and lcdMainOnTop/lcdMainOnBottom) and then paint the captured elements to the other screen.
<br/>
<br/>
I'm using the basic stuff from devKitPro's 3D textured cube (with a bit of nehe thrown in). I've also tried the demo from the above link but that doesn't seem to work properly (I get nothing on the top screen and a flashing checkerboard pattern on the bottom).
<br/>
<br/>
Any suggestions? And again, I curse the Wizard of Oz for my feeble brain.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111803 - Rockviech - Sun Dec 10, 2006 10:14 am</h4>
    <div class="postbody"><span class="postbody">well you could try, swap screen (now you have top screen )-&gt; render to bottom(top) screen, swap again (bottom selected) -&gt; render to bottom (bottom) screen</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111806 - djmcbell - Sun Dec 10, 2006 12:08 pm</h4>
    <div class="postbody"><span class="postbody">Sounds good Rockviech - I've tried the lcdSwap, lcdMainOnBottom and lcdMainOnTop. Each basically swaps both screens over.
<br/>
<br/>
Would there be a way just to draw the top screen only as normal, then swap and draw the bottom screen only? This sounds probably the easiest way to go.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111807 - Sausage Boy - Sun Dec 10, 2006 12:51 pm</h4>
    <div class="postbody"><span class="postbody">If you want flickering, yes. The way most people do it involves capturing the display, switching screens and displaying the captured frame on one screen, and repeating.<br/>_________________<br/>"no offense, but this is the gayest game ever"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111818 - Payk - Sun Dec 10, 2006 5:32 pm</h4>
    <div class="postbody"><span class="postbody">Well 3d on both screens is evil.
<br/>
You will 256KB <b style="color:#FFA34F">VRAM</b> less, and half framerate. I saw 2 offical games doing that (labyrinth and cars), and both gave me a headache...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111831 - djmcbell - Sun Dec 10, 2006 8:24 pm</h4>
    <div class="postbody"><span class="postbody">Right, so it looks like I'm going to have to <b style="color:#FFA34F">capture</b>. Have to experiment with that code some more.
<br/>
<br/>
By the way, the game is a puzzle game. Top screen is a view you can move, just to rotate around the board, and the bottom is a static view that never moves. I know it can be done in 2D but I just want to cheat, save resources and make things look more consistent.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111840 - tepples - Sun Dec 10, 2006 9:52 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>djmcbell wrote:</b></span></td> </tr> <tr> <td class="quote">By the way, the game is a puzzle game. Top screen is a view you can move, just to rotate around the board, and the bottom is a static view that never moves.</td> </tr></table><span class="postbody">
<br/>
Is this a clone of <a class="postlink" href="http://en.wikipedia.org/wiki/Block_Out" target="_blank">Block Out</a> (Genesis) or 3D Tetris (Virtual Boy) or Geom Cube (PS1) by any chance?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I know it can be done in 2D but I just want to cheat, save resources and make things look more consistent.</td> </tr></table><span class="postbody">
<br/>
It'll probably be better to do the static view in 2D. Remember that sprite scaling is still in full effect on the DS's 2D GPU.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111842 - djmcbell - Sun Dec 10, 2006 9:59 pm</h4>
    <div class="postbody"><span class="postbody">Sorry tepples, not allowed to say what it is. Needless to say, I'm just trying to get a foot in the door of the games industry, and have produced a GBA version of this (the company I'm producing it for is just waiting on the owners of the puzzle in question to give us the go-ahead). However I have been asked to see how it'd look on the DS, and decided I'd try my hand at 3D at the same time.
<br/>
<br/>
2D on the bottom screen I can do now quite easily. However, because the bottom screen is essentially the top screen from overhead (the top screen is just something to show off with really, and will contain 3D objects on the puzzle board itself) I was just mainly wanting to see how it'd look.
<br/>
<br/>
EDIT - code below -
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void initVideo3DAll()
<br/>
{
<br/>
   //set mode 0, enable BG0 and set it to 3D
<br/>
   videoSetMode(MODE_0_3D);
<br/>
   //this should work the same as the normal gl call
<br/>
   glViewPort(0,0,255,191);
<br/>
   glClearColor(0,0,0);
<br/>
   glClearDepth(0x7FFF);
<br/>
   //set sub-screen
<br/>
   videoSetModeSub(MODE_5_2D | DISPLAY_BG2_ACTIVE | DISPLAY_SPR_ACTIVE | DISPLAY_SPR_2D_BMP_256); 
<br/>
   SUB_BG2_CR = BG_BMP16_256x256; 
<br/>
   SUB_BG2_XDX = 256; 
<br/>
   SUB_BG2_XDY = 0; 
<br/>
   SUB_BG2_YDX = 0; 
<br/>
   SUB_BG2_YDY = 256; 
<br/>
   SUB_BG2_CY = 0; 
<br/>
   SUB_BG2_CX = 0; 
<br/>
    //set out banks   
<br/>
   vramSetMainBanks(VRAM_A_TEXTURE, VRAM_B_TEXTURE, VRAM_C_SUB_BG, VRAM_D_SUB_SPRITE);
<br/>
}
<br/>
<br/>
int main()
<br/>
{
<br/>
   //turn on to all cores
<br/>
   powerON(POWER_ALL);
<br/>
   //touch stuff
<br/>
   int min_x  = 4096 , min_y  = 4096, max_x  = 0, max_y   = 0;
<br/>
   int min_px = 4096 , min_py = 4096, max_px = 0 , max_py = 0;
<br/>
   touchPosition touch;
<br/>
   //set up our video banks
<br/>
   initVideo3DAll();
<br/>
   //set up IRQs
<br/>
   irqInit();
<br/>
   irqSet(IRQ_VBLANK,0);
<br/>
   //set up rotates
<br/>
   float rotateX = 45;
<br/>
   float rotateY = 225;
<br/>
   //load our texture from pcx file
<br/>
   int textureID[10];   //ten textures, hopefully
<br/>
   sImage pcx;
<br/>
   loadPCX((u8*)board1_pcx, &amp;pcx);
<br/>
   image8to16(&amp;pcx);
<br/>
   glGenTextures(1, &amp;textureID[0]);
<br/>
   glBindTexture(0, textureID[0]);
<br/>
   glTexImage2D(0, 0, GL_RGB, TEXTURE_SIZE_128, TEXTURE_SIZE_128, 0, TEXGEN_TEXCOORD, pcx.data8);
<br/>
   imageDestroy(&amp;pcx);
<br/>
<br/>
   loadPCX((u8*)board2_pcx, &amp;pcx);
<br/>
   image8to16(&amp;pcx);
<br/>
   glGenTextures(1, &amp;textureID[1]);
<br/>
   glBindTexture(0, textureID[1]);
<br/>
   glTexImage2D(0, 0, GL_RGB, TEXTURE_SIZE_8, TEXTURE_SIZE_8, 0, TEXGEN_TEXCOORD, pcx.data8);
<br/>
   imageDestroy(&amp;pcx);
<br/>
   //main stuff
<br/>
   uint32 frameCount=0;
<br/>
   while(1)
<br/>
   {
<br/>
      touch=touchReadXY();
<br/>
      //binding our touch coordinates into the screen
<br/>
      //iprintf("\x1b[12;12H(%d,%d)      ",touch.px,touch.py); - prints coords to the screen
<br/>
      if ( touch.x &gt; max_x)      max_x = touch.x;
<br/>
      if ( touch.y &gt; max_y)      max_y = touch.y;
<br/>
      if ( touch.px &gt; max_px)   max_px = touch.px;
<br/>
      if ( touch.py &gt; max_py)   max_py = touch.py;
<br/>
      if ( touch.x &lt; min_x)      min_x = touch.x;
<br/>
      if ( touch.y &lt; min_y)      min_y = touch.y;
<br/>
      if ( touch.px &lt; min_px)   min_px = touch.px;
<br/>
      if ( touch.py &lt; min_py)   min_py = touch.py;
<br/>
      //if(touch.px&gt;0){barx=touch.px-16;}
<br/>
<br/>
   //3D stuff
<br/>
      glReset();
<br/>
      glOrtho(0,1,0,1,0,12);
<br/>
<br/>
      //any floating point gl call is being converted to fixed prior to being implemented
<br/>
      gluPerspective(35, 256.0 / 192.0, 0.1, 40);
<br/>
      gluLookAt(   0.0, 0.0, 1.0,      //camera possition 
<br/>
               0.0, 0.0, 0.0,      //look at
<br/>
               0.0, 1.0, 0.0);      //up
<br/>
      glLight(0, RGB15(31,31,31),0,floattov10(-1.0),0);
<br/>
      glLight(1, RGB15(31,0,31),0,floattov10(1) - 1,0);
<br/>
      glLight(2, RGB15(0,31,0),floattov10(-1.0),0,0);
<br/>
      glLight(3, RGB15(0,0,31),floattov10(1.0) - 1,0,0);
<br/>
      glPushMatrix();
<br/>
      //move it away from the camera
<br/>
      glTranslate3f32(0, 0, floattof32(-1));
<br/>
      glRotateX(rotateX);
<br/>
      glRotateY(rotateY);
<br/>
      glMatrixMode(GL_TEXTURE);
<br/>
      glIdentity();
<br/>
      glMatrixMode(GL_MODELVIEW);
<br/>
      glMaterialf(GL_AMBIENT, RGB15(8,8,8));
<br/>
      glMaterialf(GL_DIFFUSE, RGB15(16,16,16));
<br/>
      glMaterialf(GL_SPECULAR, BIT(15) | RGB15(8,8,8));
<br/>
      glMaterialf(GL_EMISSION, RGB15(5,5,5));
<br/>
      //ds uses a table for shinyness..this generates a half-ass one
<br/>
      glMaterialShinyness();
<br/>
      //not a real gl function and will likely change
<br/>
      glPolyFmt(POLY_ALPHA(31) | POLY_CULL_BACK | POLY_FORMAT_LIGHT0 | POLY_FORMAT_LIGHT1 | 
<br/>
                                       POLY_FORMAT_LIGHT2 | POLY_FORMAT_LIGHT3 ) ;
<br/>
      scanKeys();      
<br/>
      u16 keys = keysHeld();
<br/>
      if((keys &amp; KEY_UP)) rotateX += 3;
<br/>
      if((keys &amp; KEY_DOWN)) rotateX -= 3;
<br/>
      if((keys &amp; KEY_LEFT)) rotateY += 3;
<br/>
      if((keys &amp; KEY_RIGHT)) rotateY -= 3;
<br/>
      if(rotateX&lt;0)rotateX=0;
<br/>
      if(rotateX&gt;90)rotateX=90;
<br/>
<br/>
      glPushMatrix();
<br/>
      
<br/>
      // This is where the magic happens 
<br/>
      if (frameCount &amp; 0x1)
<br/>
      { 
<br/>
         vramSetBankC(VRAM_C_SUB_BG); 
<br/>
         vramSetBankD(VRAM_D_LCD); 
<br/>
         SetRegCapture(true, 0, 15, 3, 0, 3, 0, 0); 
<br/>
         //draw the board base
<br/>
         glBindTexture(0, textureID[0]);   //change texture
<br/>
         glBegin(GL_QUAD);
<br/>
         for(int i = 0; i &lt; 6; i++)
<br/>
            drawBoardBase(i);
<br/>
         glEnd();
<br/>
         //draw the board pieces
<br/>
         glBindTexture(0, textureID[1]);   //change texture
<br/>
         glBegin(GL_QUAD);
<br/>
         for(int i = 0; i &lt; 6; i++)
<br/>
            drawBoardPieces(i);
<br/>
         glEnd();
<br/>
      }
<br/>
      else
<br/>
      {
<br/>
         vramSetBankC(VRAM_C_LCD); 
<br/>
         vramSetBankD(VRAM_D_SUB_SPRITE); 
<br/>
         SetRegCapture(true, 0, 15, 2, 0, 3, 0, 0); 
<br/>
         //draw the board base
<br/>
         glBindTexture(0, textureID[0]);   //change texture
<br/>
         glBegin(GL_QUAD);
<br/>
         for(int i = 0; i &lt; 6; i++)
<br/>
            drawBoardBase(i);
<br/>
         glEnd();
<br/>
         //draw the board pieces
<br/>
         glBindTexture(0, textureID[1]);   //change texture
<br/>
         glBegin(GL_QUAD);
<br/>
         for(int i = 0; i &lt; 6; i++)
<br/>
            drawBoardPieces(i);
<br/>
         glEnd();
<br/>
      }
<br/>
<br/>
      glPopMatrix(1);
<br/>
      frameCount++;
<br/>
      glFlush();
<br/>
      lcdSwap();
<br/>
   //end 3D stuff
<br/>
<br/>
      //update screens
<br/>
//      swiWaitForVBlank();
<br/>
   }
<br/>
   //loop back in main proc
<br/>
   return 0;
<br/>
}</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112065 - djmcbell - Tue Dec 12, 2006 10:31 pm</h4>
    <div class="postbody"><span class="postbody">Okay, officially stuck.
<br/>
<br/>
I take it my code is capturing the screen, but I don't know how to display what it's got in the REG_CAPTURE (basically, as in the code above).
<br/>
<br/>
I've got my two scenes, however it's flickering due to the lcdSwap (if I take out the lcdSwap it flickers on the top display between the scenes, as expected).
<br/>
<br/>
Any takers? Help would be greatly appreciated - it's basically the last thing I need nailed down before I start getting the game up and running.
<br/>
<br/>
EDIT - and yes, the SetRegCapture routine is actually there - it's just not in the portion of the code I've posted.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#136224 - a128 - Mon Jul 30, 2007 8:38 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dan Forever wrote:</b></span></td> </tr> <tr> <td class="quote">Does anyone have some source code I could look at or a link to a tutorial explaining how do 3D on both screens of the DS? I know it can be done but my searches aren't having any luck :(</td> </tr></table><span class="postbody">
<br/>
<br/>
Just a bugfixed version of the twopass demo from Eli
<br/>
<a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=7958&amp;start=15&amp;postdays=0&amp;postorder=asc&amp;highlight=" target="_blank">http://forum.gbadev.org/viewtopic.php?t=7958&amp;start=15&amp;postdays=0&amp;postorder=asc&amp;highlight=</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
