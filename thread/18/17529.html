<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Troubles loading multiple textures - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > Troubles loading multiple textures</h2>
<div id="posts">
<div class="post">
    <h4>#176202 - SchmendrickSchmuck - Sun May 08, 2011 3:50 am</h4>
    <div class="postbody"><span class="postbody">Hi all,
<br/>
I'm using a function to easily load a texture into memory. However, as soon as I load more than a single texture, the textures other than the first all become white when displayed.
<br/>
<br/>
My code regarding the textures:
<br/>
Loading
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
numTextures++;
<br/>
<br/>
glGenTextures(1, &amp;gltextures[numTextures]);
<br/>
glBindTexture(0, gltextures[numTextures]);
<br/>
glTexImage2D(0, 0, GL_RGBA, eWidth, eHeight, 0, TEXGEN_TEXCOORD, textureData);
<br/>
<br/>
return numTextures;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Displaying:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
glBindTexture(GL_TEXTURE_2D, gltextures[texture]);
<br/>
glBegin(GL_QUADS);
<br/>
//... etc
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
gltextures is a int[MAX_TEXTURES], where MAX_TEXTURES is defined as 2048 in video_gl.h.
<br/>
eWidth and eHeight are values calculated based on texture size, and can be assumed to be correct.
<br/>
Data is also fine, as the textures are displayed correctly when loaded first.
<br/>
<br/>
I've compared my code to all the examples I could find, but I can't find the answer. If it's not this part of the code, perhaps it's impossible to load multiple pcx files?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
sImage pcx;
<br/>
<br/>
loadPCX((u8*)tex, &amp;pcx);
<br/>
<br/>
image8to16trans(&amp;pcx, transCol);
<br/>
<br/>
// Load as texture
<br/>
[....]
<br/>
<br/>
imageDestroy(&amp;pcx);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Any thoughts?
<br/>
Thanks<br/>_________________<br/><a href="http://DSLiero.DennisvanZwieten.com" target="_blank">http://DSLiero.DennisvanZwieten.com</a> - Liero for NDS!</span><span class="gensmall"><br/><br/>Last edited by SchmendrickSchmuck on Wed May 11, 2011 11:39 pm; edited 2 times in total</span></div>    
</div>
<div class="post">
    <h4>#176203 - DiscoStew - Sun May 08, 2011 9:31 am</h4>
    <div class="postbody"><span class="postbody">Have you tried using textures that are not of PCX format to see if the problem is with the loading functions? I couldn't duplicate your problem with the Paletted_Cube example. If after testing that out, and it still has a problem, then could you provide a trimmed-down version of your program that continues to replicate this problem so we can analyze it? I did the work of libnds's dynamic texture allocating, so I should be able to provide a fix if the allocator is the problem.
<br/>
<br/>
If that isn't the problem, then it must be something else. What are the dimensions of the PCX files? If they are big, are you allocating enough video memory (A-D banks) to hold them?<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176206 - SchmendrickSchmuck - Sun May 08, 2011 12:26 pm</h4>
    <div class="postbody"><span class="postbody">It does appear to be a memory issue; Loading a smaller texture seems to work.
<br/>
<br/>
The main reason is (I think) that the textures are converted to 16bit RGB.
<br/>
I switched over to paletted textures, and that seems to work. However, transparency doesn't work anymore. Is it possible to have transparency in RGB256 color textures?
<br/>
<br/>
EDIT:
<br/>
Nvm, it seems you can only set color 0 as transparent with the GL_TEXTURE_COLOR0_TRANSPARENT when using paletted textures. Thanks for pointing out the memory issue.
<br/>
<br/>
EDIT 2:
<br/>
I can load two paletted textures, but in doing so my palettes get messed up, and the color tables for the textures become incorrect. Loading a 4 color palette before my main palette causes a shift in palette entries, making the texture look off. See piccy below for example.
<br/>
<br/>
<a href="http://temp.dennisvanzwieten.com/palettes.png" target="_blank">http://temp.dennisvanzwieten.com/palettes.png</a>
<br/>
<br/>
Also, is there any way of directly modifying texture palette data so that if I change the value, the texture immediately mirrors the change?<br/>_________________<br/><a href="http://DSLiero.DennisvanZwieten.com" target="_blank">http://DSLiero.DennisvanZwieten.com</a> - Liero for NDS!</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
