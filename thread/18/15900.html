<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Why isn't the Vector Test defined in video.h? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > Why isn't the Vector Test defined in video.h?</h2>
<div id="posts">
<div class="post">
    <h4>#161392 - DiscoStew - Sat Aug 02, 2008 10:50 pm</h4>
    <div class="postbody"><span class="postbody">Among the many defines in video.h, I noticed some time ago that while there is Position Test and that result address defined, there was nothing pertaining to the Vector Test. I have no idea why it wasn't there in the first place, but I use it in my projects for normals and lights, and had included it in video.h myself. Of course, when the header gets updated (or I reinstall the toolkit), I have to re-add it in.
<br/>
<br/>
Basically made the define as such after the Position Test defines...
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define GFX_VEC_TEST      (*(vuint32*) 0x040005C8)
<br/>
#define GFX_VEC_RESULT      ((vint32*)   0x04000630)</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
EDIT:
<br/>
<br/>
And with that, I also have some problem that just came up. I believe that I was at  release 22 of devkitARM prior to updating to release 23b. The lighting prior to the update was shown exactly how I wanted it to, but after updating, things went screwy. At first, I was thinking that maybe it was something I had changed in my program, but I had gone back to a backup of an old project, made a complete copy of the folder it was in, and took that one and recompiled it. The same screwiness appear in that backup. I'm gonna see if going back to that prior release will change anything.<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#161393 - ritz - Sat Aug 02, 2008 11:13 pm</h4>
    <div class="postbody"><span class="postbody">Me too. I manually add it to my own header file. Interestingly we have different types for the result:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define GFX_VEC_TEST   (*(vuint32*)(0x040005C8))
<br/>
#define GFX_VEC_RESULT ( (vuint16*)(0x04000630))</td> </tr></table><span class="postbody">
<br/>
Probably makes more sense to use (vint16*) instead of (vuint16*), now that I re-read gbatek.</span><span class="gensmall"><br/><br/>Last edited by ritz on Sat Aug 02, 2008 11:23 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#161396 - DiscoStew - Sat Aug 02, 2008 11:20 pm</h4>
    <div class="postbody"><span class="postbody">/sigh, this is what I get for NOT LOOKING CORRECTLY. I made sure all the other times when I added them into the header, and this one time made me boggle because for the result, it is supposed to be.....
<br/>
<br/>
.........vuint16...not vuint32.....<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"><br/><br/>Last edited by DiscoStew on Sat Aug 02, 2008 11:20 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#161397 - dovoto - Sat Aug 02, 2008 11:20 pm</h4>
    <div class="postbody"><span class="postbody">Added to cvs and will be in next release.
<br/>
<br/>
If you have a function written to take advantage of these definitions you would like to see included let me know.  Also a very short test would be appreciated to show usage.
<br/>
<br/>
Thanks for pointing this out.  If you make any progress in the lighting issue post it and I will take a look.<br/>_________________<br/><a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#161399 - DiscoStew - Sat Aug 02, 2008 11:29 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ritz wrote:</b></span></td> </tr> <tr> <td class="quote">Probably makes more sense to use (vint16*) instead of (vuint16*), now that I re-read gbatek.</td> </tr></table><span class="postbody">
<br/>
<br/>
Yeah, in the original video.h, the position test result is defined as signed, so the vector test result should perhaps be the same? I recompiled as both unsigned and signed, as saw no change.<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#161404 - ritz - Sat Aug 02, 2008 11:42 pm</h4>
    <div class="postbody"><span class="postbody">Looked back in a revision... I don't use this code anymore, but it worked (if I remember correctly) at the time:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">...
<br/>
glMatrixMode(GL_MODELVIEW);
<br/>
glLoadIdentity();
<br/>
v_gl3angrmat33(rota);
<br/>
GFX_VEC_TEST = tn[sni[i]]-&gt;dp;
<br/>
while (GFX_TEST_BUSY) ;
<br/>
for (q = 0; q &lt; 3; q++)
<br/>
   norm[q] = (int32)(((int16)(GFX_VEC_RESULT[q]&lt;&lt;3))&gt;&gt;3);
<br/>
glMatrixMode(GL_POSITION);
<br/>
...</td> </tr></table><span class="postbody">
<br/>
I see my shifting and (int16) cast, most likely not needed. Geez, what was I doing?! Ah, probably grabbing the sign.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#161405 - silent_code - Sat Aug 02, 2008 11:42 pm</h4>
    <div class="postbody"><span class="postbody">@ DiscoStew:
<br/>
How does the lighting screw up? Can you give us any screens?
<br/>
There are many reasons why lighting could break. I hope I can help once I get the screens (or video or binary) to see for myself. Just some simple test.
<br/>
<br/>
EDIT: Okays, I get it. :^)
<br/>
Btw: I'm using an extra "definitions" header file for that sort of problems in my programs. :^)<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"><br/><br/>Last edited by silent_code on Sun Aug 03, 2008 12:28 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#161408 - DiscoStew - Sun Aug 03, 2008 12:13 am</h4>
    <div class="postbody"><span class="postbody">ritz pretty much had the answer. I was using the wrong variable type.
<br/>
<br/>
It only came about because after each update to video.h (or reinstalling the toolkit), I'd have to add the Vector Test define in myself, and this one time, I accidentally defined it as being 32-bit per value instead of 16-bit per value. The input/output were correct, but how I was getting them by indexing via 32-bit instead of 16-bit is what made it screw up.
<br/>
<br/>
All in all, it was user error.<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
