<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>MDL & Skeletal animation - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > MDL & Skeletal animation</h2>
<div id="posts">
<div class="post">
    <h4>#71017 - ishraam - Fri Feb 10, 2006 12:44 am</h4>
    <div class="postbody"><span class="postbody">Hello,
<br/>
<br/>
I am thinking about using a Half Life MDL format for some homebrew. The nice thing about it is that it :
<br/>
- has skeletal animation (where Quake MDL format had not)
<br/>
- includes hitboxes (nice for fight, collision,...)
<br/>
- has been created for low polys 
<br/>
Correct me if I m wrong.
<br/>
<br/>
So here are 3 questions :
<br/>
- pros and cons for skeletal anim on DS ? (nice for data size is smaller, but won't it cause too much work on the CPUs ?)
<br/>
- Any other 3D file format (with skeletal anim) that feets well in a DS ?
<br/>
- Anyone know where I can find HL MDL file format reference ? 
<br/>
&gt;I have found sources, but I don't wanna waste time guessing what's what.
<br/>
<br/>
I know a MDL file is a compression of a .QC file (describing the content of the MDL), and .SMD files (containing either the bind pose - aka "reference" -, or animations). I can read both SMD &amp; QC files, since they are text files, but I do not know how thery are compiled to a single binary MDL. 
<br/>
<br/>
Help of any sort will be much appreciated! ^_^</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#71034 - tepples - Fri Feb 10, 2006 1:33 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ishraam wrote:</b></span></td> </tr> <tr> <td class="quote">I know a MDL file is a compression of a .QC file (describing the content of the MDL), and .SMD files (containing either the bind pose - aka "reference" -, or animations). I can read both SMD &amp; QC files, since they are text files</td> </tr></table><span class="postbody">
<br/>
I thought .smd was interleaved ROMs for Sega Genesis.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#71042 - ishraam - Fri Feb 10, 2006 1:50 am</h4>
    <div class="postbody"><span class="postbody">:) 
<br/>
<a href="http://developer.valvesoftware.com/wiki/SMD_file_format" target="_blank">http://developer.valvesoftware.com/wiki/SMD_file_format</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#71043 - ecurtz - Fri Feb 10, 2006 2:08 am</h4>
    <div class="postbody"><span class="postbody">Skeletal animation is the way to go on the DS. You'll want to consider exporting into a more native structure for the data rather than keeping it in .mdl format though.
<br/>
<br/>
The bone matrices (up to 32 iirc) can be pushed onto the matrix stack at the beginning of rendering and there is essentially no further CPU overhead for the bones. Take a look at the registers for the 3D stuff that involve the matrix stack. Essentially any of those calls can be compiled inline into the display list for your model. Then you just calculate the bone positions, push those onto the matrix stack and then dump the whole display list onto the 3D hardware.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#71052 - ishraam - Fri Feb 10, 2006 3:46 am</h4>
    <div class="postbody"><span class="postbody">@ ecurtz : Thanks for the answer.
<br/>
<br/>
New fresh questions off the top of my head :) :
<br/>
<br/>
1. "more native structure": did you mean something precise ? are you refering to the "my_dingdong_thing.bin" files that can be found in examples ? 
<br/>
<br/>
2. "32 iirc" ... what's "iirc" ? (I think I know about "32" :p)
<br/>
<br/>
3. DS has no hardware for quaternions, which are usually used in skeletal animation (well that's not only the DS...). So when you say "Push onto the matrix stack", I guess there MUST be CPU overhead (providing I'm using quaternions). No ? 
<br/>
<br/>
4. Finally, display list should be used for static stuff (that's the case for traditionnal OpenGL), for example a building with no animation. So I don't think they should be used for animations (be it skeletal, or else). Yet I think I saw them being used in a MD2 rendering call... Could you briefly explain me where I'm wrong ??
<br/>
<br/>
[EDIT : Forget the Q3 remark about quaternion... -_- ]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#71084 - ecurtz - Fri Feb 10, 2006 7:13 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ishraam wrote:</b></span></td> </tr> <tr> <td class="quote">@ ecurtz : Thanks for the answer.
<br/>
<br/>
New fresh questions off the top of my head :) :
<br/>
<br/>
1. "more native structure": did you mean something precise ? are you refering to the "my_dingdong_thing.bin" files that can be found in examples ? 
<br/>
<br/>
2. "32 iirc" ... what's "iirc" ? (I think I know about "32" :p)
<br/>
<br/>
3. DS has no hardware for quaternions, which are usually used in skeletal animation (well that's not only the DS...). So when you say "Push onto the matrix stack", I guess there MUST be CPU overhead (providing I'm using quaternions). No ? 
<br/>
<br/>
4. Finally, display list should be used for static stuff (that's the case for traditionnal OpenGL), for example a building with no animation. So I don't think they should be used for animations (be it skeletal, or else). Yet I think I saw them being used in a MD2 rendering call... Could you briefly explain me where I'm wrong ??
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
1. By more native I mean display lists, or at least a version of the .mdl with all of the values pre converted to fixed point and scaled correctly. These would usually be included as .bin files and shown using glCallList() - textures and other stuff are often included as binary data as well, so it's  not necessarily 3D data in the demos.
<br/>
<br/>
2. Sorry, iirc == If I Recall Correctly
<br/>
<br/>
3. Yes, you'll have to do the quaternion math yourself. I have some untested 3D math methods, including quaternion stuff if you want them.
<br/>
<br/>
4. The DS display list can include commands such as swapping textures or changing the transform matrix within the list along with the geometry. Assuming you only have one bone per vertex you can define the entire model. At that point animation consists solely of setting the bone matrices to the right values prior to submitting the list.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#71194 - acox - Fri Feb 10, 2006 10:53 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">4. The DS display list can include commands such as swapping textures or changing the transform matrix within the list along with the geometry. Assuming you only have one bone per vertex you can define the entire model. At that point animation consists solely of setting the bone matrices to the right values prior to submitting the list.</td> </tr></table><span class="postbody">
<br/>
<br/>
Interesting!
<br/>
<br/>
Which leads me to two questions:
<br/>
<br/>
<ul>
<br/>
<span style="font-weight: bold">1)</span> Does the DS have hardware support for (multiple bones + weights per vert)-type skinning? (your post implies not)]
<br/>
<br/>
<span style="font-weight: bold">2)</span>Is the HL MDL format limited to one bone per vert ?
<br/>
</ul><br/>_________________<br/><a class="postlink" href="http://www.btinternet.com/~ahcox/GBA/" target="_blank">3D on GBA</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#71215 - ecurtz - Sat Feb 11, 2006 2:12 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>acox wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<span style="font-weight: bold">1)</span> Does the DS have hardware support for (multiple bones + weights per vert)-type skinning? (your post implies not)]
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I'm not sure, but probably no.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>acox wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<span style="font-weight: bold">2)</span>Is the HL MDL format limited to one bone per vert ?
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I'm not positive, but I think yes (for HL 1).
<br/>
<br/>
Was that vague enough? Obviously I don't know the definitive answer to either of those, but I'm pretty confident about both replies.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
