<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>oam memory managment / multiple sprites with one picture? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > oam memory managment / multiple sprites with one picture?</h2>
<div id="posts">
<div class="post">
    <h4>#152565 - ben0bi - Mon Mar 17, 2008 8:50 pm</h4>
    <div class="postbody"><span class="postbody">is there a simple way to manage the oam memory?
<br/>
<br/>
i have the following problem: i want to make much much units. everyone has eventually another sprite.
<br/>
<br/>
to show the right units on the screen, i have to determine the visible ones and then copy their sprites and position/rotation data to oam. (and flush away the invisible ones to get the memory)
<br/>
<br/>
or can i load ONE sprite to oam and use it for several instances? (how?)
<br/>
<br/>
now please look at the following code:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
      /* Copy over the sprite palette */
<br/>
      dmaCopyHalfWords(OAM_SPRITE_DMA_CHANNEL,
<br/>
                     ppicturePal,
<br/>
                     &amp;SPRITE_PALETTE[sprInfo-&gt;oamId *
<br/>
                                     OAM_COLORS_PER_PALETTE],
<br/>
                     picturePalLEN);
<br/>
<br/>
      /* Copy the sprite graphics to sprite graphics memory */
<br/>
       dmaCopyHalfWords(OAM_SPRITE_DMA_CHANNEL,
<br/>
                     ppictureTiles,
<br/>
                     &amp;SPRITE_GFX[sprEntry-&gt;tileIdx * OAM_MAINSPR_OFFSET_MULTIPLIER],
<br/>
                     pictureTilesLEN);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
by simply changing the oam id (sprInfo-&gt;oamID) everything works until several sprites are loaded (because palette len is ever the same). then the tileIdx will overrun because it is calculated somewhat like this:
<br/>
<br/>
sprEntry-&gt;tileIdx= actualTileIdx;
<br/>
actualTileIdx+=mypicBitmapLen;
<br/>
<br/>
now, i cannot set actualTileIdx - = oldpicBitmapLen because on this position could be another sprite. 
<br/>
<br/>
its no problem with the palette, but the new tileIdx would eventually overlap other sprites if i use the stuff above or the old tileIdx.
<br/>
<br/>
now my question: is there something provided to manage  this issue?
<br/>
(wich e.G. shifts all space behind the old position "left" with oldBitmapLen (so i can use actualTileIdx -= oldpicBitmapLen)
<br/>
<br/>
or is there another way to show one sprite image on multiple positions/angles at the same time?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152584 - silent_code - Mon Mar 17, 2008 11:52 pm</h4>
    <div class="postbody"><span class="postbody">you can have two sprites (on the same 2d engine / screen) mapped to the same graphics. just give them the same tile number. that way you can have 50 units, that look all the same, but you don't need 50 identical tilesets.
<br/>
same goes for animations, just put them in the right place (sprite graphics memory) and assigne each sprite the according frame's tile number. all sprites can then be animated individually, but you just need memory for one animation.
<br/>
<br/>
hope that helps a bit.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
