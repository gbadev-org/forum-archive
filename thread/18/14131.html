<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>GL_CLEAR_BMP.  problem with the depth plane [solved] - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > GL_CLEAR_BMP.  problem with the depth plane [solved]</h2>
<div id="posts">
<div class="post">
    <h4>#140081 - nce - Thu Sep 13, 2007 12:45 pm</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
I was trying to use the GL_CLEAR_BMP that allow you to set a bitmap and a depth map to clean the screen in 3D...
<br/>
<br/>
But while I succeed to set a bitmap, I'm not able to draw anything else... I guess it's because of the depth function.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   glInit();
<br/>
<br/>
   videoSetMode(MODE_0_3D | DISPLAY_SPR_ACTIVE |  
<br/>
                      DISPLAY_BG0_ACTIVE | 
<br/>
                      DISPLAY_SPR_1D | 
<br/>
                      DISPLAY_SPR_1D_SIZE_64 );
<br/>
<br/>
<br/>
   videoSetModeSub(MODE_0_2D | DISPLAY_SPR_ACTIVE | 
<br/>
                        DISPLAY_SPR_1D | 
<br/>
                        DISPLAY_SPR_1D_SIZE_32 );
<br/>
<br/>
   glViewPort(0,0,255,191);
<br/>
   
<br/>
   glClearColor(0,0,0,31);
<br/>
   glClearDepth(0x7FFF);
<br/>
<br/>
//activate the clear bmp
<br/>
   GFX_CONTROL |= GL_CLEAR_BMP;
<br/>
<br/>
<br/>
   
<br/>
   vramSetBankA(VRAM_A_TEXTURE);
<br/>
   vramSetBankB(VRAM_B_TEXTURE);
<br/>
   vramSetBankC(VRAM_C_TEXTURE);
<br/>
   vramSetBankD(VRAM_D_TEXTURE);
<br/>
   vramSetBankE(VRAM_E_MAIN_SPRITE);
<br/>
   vramSetBankF(VRAM_F_TEX_PALETTE);
<br/>
   vramSetBankI(VRAM_I_SUB_SPRITE);
<br/>
<br/>
//.....
<br/>
<br/>
   vramSetBankC(VRAM_C_LCD);
<br/>
   vramSetBankC(VRAM_D_LCD);
<br/>
<br/>
//setting a stupid color for testing
<br/>
   int i = 0;
<br/>
   u16* ptr = VRAM_C;
<br/>
   for ( i = 0 ; i &lt; 256*256 ; i++ )
<br/>
   {
<br/>
      *ptr++ = RGB15 ( 15,0,31 )|(1&lt;&lt;15);
<br/>
   }
<br/>
<br/>
//setting depth by default
<br/>
   ptr = VRAM_D;
<br/>
   for ( i = 0 ; i &lt; 256*256 ; i++ )
<br/>
   {
<br/>
      *ptr++ = 0x7FFF;
<br/>
   }
<br/>
   
<br/>
<br/>
   vramSetBankC(VRAM_C_TEXTURE);
<br/>
   vramSetBankD(VRAM_D_TEXTURE);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Does anyone has already try to work with this ?
<br/>
<br/>
I realy don't have any idea what's wrong here, maybe I need to set something else ?
<br/>
<br/>
Also if I don't set the alpha bit in the color, the screen stay black but I just have one half line in the middle with some garbage color....
<br/>
I also tryied to set the depth to 0 ( maybe it's map in the other order ) but no change
<br/>
<br/>
Anyone has an idea ?
<br/>
<br/>
Thanks<br/>_________________<br/>-jerome-</span><span class="gensmall"><br/><br/>Last edited by nce on Thu Sep 13, 2007 12:52 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#140082 - nce - Thu Sep 13, 2007 12:51 pm</h4>
    <div class="postbody"><span class="postbody">OOOOOOOH   I can be reaaaaaaaly stupid sometimes.....
<br/>
<br/>
bad copy-paste here ;)
<br/>
<br/>
vramSetBankC(VRAM_C_LCD);
<br/>
vramSetBankC(VRAM_D_LCD); 
<br/>
<br/>
the error was there... thanks to the forum while I was reading my post I noticed my mistake ... ( when reading my source I seen this line 100 times without notice, but move it form your editor and it becomes visible LOL )
<br/>
<br/>
Thanks anyway ;)<br/>_________________<br/>-jerome-</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
