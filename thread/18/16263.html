<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Semi-transparent sprite becomes normal - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Semi-transparent sprite becomes normal</h2>
<div id="posts">
<div class="post">
    <h4>#165176 - sverx - Thu Dec 11, 2008 4:00 pm</h4>
    <div class="postbody"><span class="postbody">Hi!
<br/>
 I'm having a strange problem with an homebrew I'm developing.
<br/>
<br/>
In short: I have semi-transparent sprites that are shown as normal, all of them. It doesn't happen with some emulator, but it happens on the hardware (NDS Lite)... so I guess I forgot something in my program. :|
<br/>
<br/>
Any idea? Besides setting "OBJ Mode" bits to 0x01 in "OBJ Attribute 0" in the OAM entry of the sprite, what should I do?
<br/>
<br/>
Thanks...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165177 - DiscoStew - Thu Dec 11, 2008 4:58 pm</h4>
    <div class="postbody"><span class="postbody">Have you dealt with the Blend Control for this yet?
<br/>
<br/>
<a href="http://nocash.emubase.de/gbatek.htm#lcdiocolorspecialeffects" target="_blank">http://nocash.emubase.de/gbatek.htm#lcdiocolorspecialeffects</a><br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165178 - sverx - Thu Dec 11, 2008 5:02 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>DiscoStew wrote:</b></span></td> </tr> <tr> <td class="quote">Have you dealt with the Blend Control for this yet?</td> </tr></table><span class="postbody">
<br/>
<br/>
mmm... it says:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Semi-Transparent OBJs
<br/>
OBJs that are defined as 'Semi-Transparent' in OAM memory are always selected as 1st Target (regardless of BLDCNT Bit 4), and are always using Alpha Blending mode <span style="font-weight: bold">(regardless of BLDCNT Bit 6-7)</span>.</td> </tr></table><span class="postbody">
<br/>
<br/>
so I guess I don't have to set it for 'Semi-Transparent' objects... wrong?
<br/>
<br/>
BTW it's true I'm using it for alpha blending two BGs (and it's working). Can this affect the objects semi-transparency?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165259 - sverx - Mon Dec 15, 2008 11:55 am</h4>
    <div class="postbody"><span class="postbody">I'm stuck with that.
<br/>
<br/>
Does somebody knows if are there some things I shouldn't do when using semi-transparent sprites?
<br/>
<br/>
Can I use alpha blending between BGs? Can I use 3D? Can I use BG priority and object priority? Can I use extended palettes? I'm using all these...
<br/>
<br/>
Don't know why, these semi-transparent sprites just aren't semi-transparent... and it happens <span style="font-weight: bold">only</span> on hardware! (on no$gba it's ok...)
<br/>
<br/>
Ideas? Hints? Help?
<br/>
<br/>
Please...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165268 - Cydrak - Mon Dec 15, 2008 7:43 pm</h4>
    <div class="postbody"><span class="postbody">Can you elaborate on your settings? (Mainly BLEND_CR, BG_CR, OBJ attributes, and 3D rear plane?) It would help to have a minimal example; I can't really imagine palettes affecting anything.
<br/>
<br/>
To answer your question: When you have 3+ layers, priority can and will affect things, since the hardware does at most one blend per pixel. For example, if you blend a solid "cloud" layer over everything else, I expect <span style="font-style: italic">nothing</span> can blend beneath it--everything below should behave as solid. If parts of the cloud are transparent, then that may allow further blending, just not below the clouds themselves.
<br/>
<br/>
I thought no$gba emulates that, though I could be wrong. So not sure if it's your problem. :/</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165269 - Maxxie - Mon Dec 15, 2008 7:47 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sverx wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
BTW it's true I'm using it for alpha blending two BGs (and it's working). Can this affect the objects semi-transparency?</td> </tr></table><span class="postbody">
<br/>
<br/>
Just a quick try.
<br/>
Since you are using alpha blending, could it be that you set the blending parameter in it, so that it is set to (nearly) 100% opaque?
<br/>
Then it would still be processed as transparent but not appear as.<br/>_________________<br/><a class="postlink" href="http://nintendods.desperate-programmers.com/doku.php?id=wireless_io_map" target="_blank">Trying  to bring more detail into understanding the wireless hardware</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165299 - sverx - Tue Dec 16, 2008 10:16 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cydrak wrote:</b></span></td> </tr> <tr> <td class="quote">Can you elaborate on your settings? (Mainly BLEND_CR, BG_CR, OBJ attributes, and 3D rear plane?) It would help to have a minimal example; I can't really imagine palettes affecting anything.</td> </tr></table><span class="postbody">
<br/>
<br/>
I have all BGs on, BG0 being used for 3D and it has priority 0, so it's ahead. 3D back plane is transparent. Then there's another BG, with priority 1, that is semitransparent, and finally the other 2 BGs, both "normal". All these BGs are 256 colors extended palette 'text' modes.
<br/>
<br/>
My sprites all have priority 1 or 2, so they should be right behind the 3D layer or right behind the semitransparent 2D BG.
<br/>
<span style="font-style: italic">edit:</span>Those with priority 2 are 'normal', half of the ones having priority 1 should be semi-transparent. The other half of the sprite are also 'normal' and have the same priority, 1, but they have <span style="font-style: italic">lower</span> object ID so that they are drawn behind the one that should be semi-transparent.
<br/>
<br/>
Pressing a key on my DS I can even turn off the BG0... but unfortunatly nothing changes :|
<br/>
<br/>
Here's the video mode:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">videoSetMode ( (FadeActive?DISPLAY_BG0_ACTIVE:0) | DISPLAY_BG1_ACTIVE | DISPLAY_BG2_ACTIVE | DISPLAY_BG3_ACTIVE | MODE_0_2D | ENABLE_3D | DISPLAY_SPR_ACTIVE | DISPLAY_SPR_1D_LAYOUT | DISPLAY_SPR_1D_SIZE_128 | DISPLAY_BG_EXT_PALETTE | DISPLAY_SPR_EXT_PALETTE );</td> </tr></table><span class="postbody">
<br/>
<br/>
the BGs:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">BG1_CR = BG_32x32 | BG_COLOR_256 | BG_MAP_BASE(BGActive+4) | BG_TILE_BASE(5) | BG_PRIORITY(3);  //ultimo dietro!
<br/>
BG2_CR = BG_32x32 | BG_COLOR_256 | BG_MAP_BASE(BGActive)   | BG_TILE_BASE(1) | BG_PRIORITY(2);
<br/>
BG3_CR = BG_32x32 | BG_COLOR_256 | BG_MAP_BASE(BGActive+2) | BG_TILE_BASE(1) | BG_PRIORITY(1);  //davanti!</td> </tr></table><span class="postbody">
<br/>
<br/>
the Blend:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">BLEND_AB = 0x0B | ( 0x05 &lt;&lt; 8 );
<br/>
BLEND_CR = BLEND_ALPHA | BLEND_SRC_BG1 | BLEND_SRC_BG2 | BLEND_SRC_BG3 | BLEND_SRC_BACKDROP | BLEND_DST_SPRITE |  BLEND_DST_BG1 | BLEND_DST_BG2 | BLEND_DST_BG3 | BLEND_DST_BACKDROP | ((FadeActive)?BLEND_SRC_BG0 | BLEND_DST_BG0:0);</td> </tr></table><span class="postbody">
<br/>
<br/>
3D rear plane
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">glClearColor(31,31,31,0);     // BG must be transparent! (r,g,b,alpha)</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cydrak wrote:</b></span></td> </tr> <tr> <td class="quote">[...] the hardware does at most one blend per pixel.</td> </tr></table><span class="postbody">
<br/>
<br/>
I'm always keeping this in mind, I'm sure I'm not trying to blend more... at least, if I'm not mistaking...
<br/>
<br/>
Thanks :)</span><span class="gensmall"><br/><br/>Last edited by sverx on Tue Dec 16, 2008 3:04 pm; edited 2 times in total</span></div>    
</div>
<div class="post">
    <h4>#165300 - sverx - Tue Dec 16, 2008 10:21 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Maxxie wrote:</b></span></td> </tr> <tr> <td class="quote">Since you are using alpha blending, could it be that you set the blending parameter in it, so that it is set to (nearly) 100% opaque?
<br/>
Then it would still be processed as transparent but not appear as.</td> </tr></table><span class="postbody">
<br/>
<br/>
No, I'm using 0x0B and 0x05 for blending... :|</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165377 - sverx - Thu Dec 18, 2008 3:19 pm</h4>
    <div class="postbody"><span class="postbody">No news? Does somebody know if semi-transparent sprite should have higher priority than others or if they should be the first/last objects or if they can't stay behind a BGs or... what?
<br/>
<br/>
Help appreciated. A lot! :|<br/>_________________<br/><a class="postlink" href="http://bit.ly/yiQrz9" target="_blank">libXM7</a>|<a class="postlink" href="http://bit.ly/yJwcOo" target="_blank">NDS programming tutorial (Italiano)</a>|<a class="postlink" href="http://disjointedstudio.blogspot.com/" target="_blank">Waimanu DS / GBA</a>|<a class="postlink" href="http://adshomebrewersdiary.blogspot.com" target="_blank">A DS Homebrewer's Diary</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165409 - silent_code - Fri Dec 19, 2008 8:05 pm</h4>
    <div class="postbody"><span class="postbody">I am pretty sure GBAtek can answer your question.<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165414 - Cydrak - Fri Dec 19, 2008 10:00 pm</h4>
    <div class="postbody"><span class="postbody">Maybe there's something more to it, because I couldn't reproduce the problem (even with 3D, ext. palettes etc). :/
<br/>
<br/>
You didn't mention OBJ attributes, but this is what I had:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">attribute[0] = OBJ_Y(...) | ATTR0_COLOR_256 | ATTR0_TYPE_BLENDED;
<br/>
attribute[1] = OBJ_X(...) | ATTR1_SIZE_32;
<br/>
attribute[2] = objTile    | ATTR2_PRIORITY(1);</td> </tr></table><span class="postbody">
<br/>
If you can *see* the sprites I doubt OAM order is a problem. TONC's final chapter points out some GBA quirks if your indices/priorities conflict, but GBATEK says that's fixed on the DS. Though, overlapping semi-transparent sprites can cause some unintuitive effects.
<br/>
<br/>
Putting them behind a BG should work; however, if the BG itself is a BLEND_SRC then its solid areas will effectively hide any further blending.
<br/>
<br/>
You have pretty much all the BLEND_DSTs, so--if there's no BG above the sprite, you can see it, other stuff blends, and it <span style="font-style: italic">still</span> doesn't work, the only thing I can think of is it's not getting set as "1st" for some reason. Do they all turn semi-transparent if you add BLEND_SRC_SPRITE? If so, perhaps check the OAM.
<br/>
<br/>
Something else to check... any chance you turn on windowing? I'm not as familiar but apparently there's a "color effect" bit, similar to the layer bits, that needs to be assigned for each region. If zero, blending would be disabled.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165433 - JYC376 - Sat Dec 20, 2008 2:39 am</h4>
    <div class="postbody"><span class="postbody">Perhaps you should update your devkitARM and libnds first.  From your code it seems you're using an older version.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165441 - silent_code - Sat Dec 20, 2008 11:43 pm</h4>
    <div class="postbody"><span class="postbody">I do not have enough time to read all of this, but you can set sprite transparency without the blend registers. I remember reading something about problems when you have transparent sprites and set the object layer in the blending registers.
<br/>
Again, GBATek should help to clarify things.<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165472 - sverx - Mon Dec 22, 2008 2:24 pm</h4>
    <div class="postbody"><span class="postbody">Hi! Thanks for the replies...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cydrak wrote:</b></span></td> </tr> <tr> <td class="quote">You didn't mention OBJ attributes</td> </tr></table><span class="postbody">
<br/>
<br/>
I have a for cycle that defines two OBJs at time: the <span style="font-style: italic">lower</span> (higher OBJ id) is solid, the <span style="font-style: italic">upper</span> (lower OBJ id) is solid <span style="font-weight: bold">or</span> semi-transparent, it depends on the priority (it should be transparent when prio==1)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">SpriteCTRL-&gt;Sprite[2+en*2].y_attrib_0= ATTR0_SQUARE | ATTR0_COLOR_256  | OBJ_Y (ey);
<br/>
SpriteCTRL-&gt;Sprite[2+en*2].x_attrib_1= ATTR1_SIZE_32                   | OBJ_X (ex);
<br/>
SpriteCTRL-&gt;Sprite[2+en*2].attrib_2  = TILE256_1D_128K(128) | ATTR2_PRIORITY(prio) | ATTR2_PALETTE(15);
<br/>
<br/>
SpriteCTRL-&gt;Sprite[1+en*2].y_attrib_0= ATTR0_SQUARE | ATTR0_COLOR_256  | ((prio==1)?ATTR0_TYPE_BLENDED:ATTR0_TYPE_NORMAL) | OBJ_Y (ey);
<br/>
SpriteCTRL-&gt;Sprite[1+en*2].x_attrib_1= ATTR1_SIZE_32                   | OBJ_X (ex);
<br/>
SpriteCTRL-&gt;Sprite[1+en*2].attrib_2  = TILE256_1D_128K(2048-16-en*16) | ATTR2_PRIORITY(prio) | ATTR2_PALETTE(0);</td> </tr></table><span class="postbody">
<br/>
<br/>
(TILE256_1D_128K is a simple define)
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define   TILE256_1D_128K(n)   ((n)&gt;&gt;1)</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cydrak wrote:</b></span></td> </tr> <tr> <td class="quote">Putting them behind a BG should work; however, if the BG itself is a BLEND_SRC then its solid areas will effectively hide any further blending.</td> </tr></table><span class="postbody">
<br/>
<br/>
when it is semi-transparent, it has priority=1 so it's <span style="font-style: italic">above</span> all the BGs, excluding BG0 (the 3D layer), that can be deactivated --but it doesn't change :|
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cydrak wrote:</b></span></td> </tr> <tr> <td class="quote">You have pretty much all the BLEND_DSTs, so--if there's no BG above the sprite, you can see it, other stuff blends, and it <span style="font-style: italic">still</span> doesn't work, the only thing I can think of is it's not getting set as "1st" for some reason. Do they all turn semi-transparent if you add BLEND_SRC_SPRITE? If so, perhaps check the OAM.</td> </tr></table><span class="postbody">
<br/>
<br/>
I'll do this test asap. (Everything else blends ok...)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cydrak wrote:</b></span></td> </tr> <tr> <td class="quote">Something else to check... any chance you turn on windowing? I'm not as familiar but apparently there's a "color effect" bit, similar to the layer bits, that needs to be assigned for each region. If zero, blending would be disabled.</td> </tr></table><span class="postbody">
<br/>
<br/>
No, I'm (still) not using any windowing effects.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>JYC376 wrote:</b></span></td> </tr> <tr> <td class="quote">Perhaps you should update your devkitARM and libnds first.</td> </tr></table><span class="postbody">
<br/>
<br/>
Of course I will, but I think it's not related. And I'm not using a very old version, I think... or am I?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">[devkitARM]
<br/>
Version=22
<br/>
[libnds]
<br/>
Version=20071023</td> </tr></table><span class="postbody"><br/>_________________<br/><a class="postlink" href="http://bit.ly/yiQrz9" target="_blank">libXM7</a>|<a class="postlink" href="http://bit.ly/yJwcOo" target="_blank">NDS programming tutorial (Italiano)</a>|<a class="postlink" href="http://disjointedstudio.blogspot.com/" target="_blank">Waimanu DS / GBA</a>|<a class="postlink" href="http://adshomebrewersdiary.blogspot.com" target="_blank">A DS Homebrewer's Diary</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165493 - wintermute - Tue Dec 23, 2008 2:20 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sverx wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">[devkitARM]
<br/>
Version=22
<br/>
[libnds]
<br/>
Version=20071023</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
<br/>
Quite old, yes.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">[devkitARM]
<br/>
Version=24
<br/>
[libnds]
<br/>
Version=1.3.1</td> </tr></table><span class="postbody">
<br/>
<br/>
libnds 1.3.1 was released a couple of weeks ago. 1.3.2 will probably be released before New Year.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165498 - sverx - Tue Dec 23, 2008 9:53 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cydrak wrote:</b></span></td> </tr> <tr> <td class="quote">Do they all turn semi-transparent if you add BLEND_SRC_SPRITE? If so, perhaps check the OAM.</td> </tr></table><span class="postbody">
<br/>
<br/>
I made this test yesterday: NO they DO NOT turn semi-transparent (!!!) 8| 8| Something really strange is happening...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cydrak wrote:</b></span></td> </tr> <tr> <td class="quote">Something else to check... any chance you turn on windowing?</td> </tr></table><span class="postbody">
<br/>
<br/>
Any chance I didn't do that but it's turned on by the R4 software? Should I somehow 'reset' it?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">Quite old, yes. [...] 1.3.2 will probably be released before New Year.</td> </tr></table><span class="postbody">
<br/>
<br/>
Thanks. Going to update soon then :)<br/>_________________<br/><a class="postlink" href="http://bit.ly/yiQrz9" target="_blank">libXM7</a>|<a class="postlink" href="http://bit.ly/yJwcOo" target="_blank">NDS programming tutorial (Italiano)</a>|<a class="postlink" href="http://disjointedstudio.blogspot.com/" target="_blank">Waimanu DS / GBA</a>|<a class="postlink" href="http://adshomebrewersdiary.blogspot.com" target="_blank">A DS Homebrewer's Diary</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165625 - sverx - Tue Dec 30, 2008 12:25 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">[devkitARM]
<br/>
Version=24
<br/>
[libnds]
<br/>
Version=1.3.1</td> </tr></table><span class="postbody">
<br/>
<br/>
Upgraded, no change with that :|
<br/>
<br/>
Going to dissect my code until I find what's wrong there...<br/>_________________<br/><a class="postlink" href="http://bit.ly/yiQrz9" target="_blank">libXM7</a>|<a class="postlink" href="http://bit.ly/yJwcOo" target="_blank">NDS programming tutorial (Italiano)</a>|<a class="postlink" href="http://disjointedstudio.blogspot.com/" target="_blank">Waimanu DS / GBA</a>|<a class="postlink" href="http://adshomebrewersdiary.blogspot.com" target="_blank">A DS Homebrewer's Diary</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165662 - sverx - Fri Jan 02, 2009 10:33 am</h4>
    <div class="postbody"><span class="postbody">Hi!
<br/>
<br/>
BAD BAD news, <span style="font-weight: bold">I hope</span> someone can prove I'm wrong... :|
<br/>
<br/>
I was running a couple of tests these days, and the results, in their shortest form, it's:
<br/>
<br/>
<span style="font-weight: bold">you can't display any sprite behind a semi-transparent sprite.</span>
<br/>
<br/>
It just doesn't work, no matter the value of SUB_BLEND_CR :|
<br/>
<br/>
So, if you've got a sprite 0, semi-transparent, on top of a sprite 1, normal, on top of a BG, looking <span style="font-style: italic">thru</span> sprite 0 you can't see sprite 1, but you'll see those BG pixels that were hidden by sprite 1 (!!!).
<br/>
<br/>
So, what GBATEK (<a class="postlink" href="http://nocash.emubase.de/gbatek.htm#lcdiocolorspecialeffects" target="_blank">here</a>) says:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">The OBJ Layer
<br/>
Before special effects are applied, the display controller computes the OBJ priority ordering, and isolates the top-most OBJ pixel. In result, only the top-most OBJ pixel is recursed at the time when processing special effects. Ie. alpha blending and <span style="font-weight: bold">semi-transparency can be used for OBJ-to-BG or BG-to-OBJ , but not for OBJ-to-OBJ.</span></td> </tr></table><span class="postbody">
<br/>
also applies when you're <span style="font-weight: bold">not</span> using <span style="font-style: italic">color special effects</span>.
<br/>
<br/>
Again, I hope I'm wrong. Feedback / help / comments appreciated. A lot!
<br/>
<br/>
<span style="font-size: 9px; line-height: normal">(btw, Happy New Year!)</span>
<br/>
<br/>
<br/>
<br/>
<br/>
.<br/>_________________<br/><a class="postlink" href="http://bit.ly/yiQrz9" target="_blank">libXM7</a>|<a class="postlink" href="http://bit.ly/yJwcOo" target="_blank">NDS programming tutorial (Italiano)</a>|<a class="postlink" href="http://disjointedstudio.blogspot.com/" target="_blank">Waimanu DS / GBA</a>|<a class="postlink" href="http://adshomebrewersdiary.blogspot.com" target="_blank">A DS Homebrewer's Diary</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165674 - DiscoStew - Fri Jan 02, 2009 10:00 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sverx wrote:</b></span></td> </tr> <tr> <td class="quote"><span style="font-weight: bold">you can't display any sprite behind a semi-transparent sprite.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Unfortunately, this is true. The 2D hardware is not capable of that. I was thinking that you could take all the semi-transparent sprites, and render them as quads with the 3D hardware, but after thinking about it a little more, you'd be very restricted with that method. They'd be semi-transparent to each other, but you are still dealing with the 2D hardware, but in terms of BGs instead of sprites, and that's only one BG vs multiple sprites.
<br/>
<br/>
You wouldn't be able to have these special sprites with their own amount of semi-transparency, because they'd only be effecting anything <span style="font-weight: bold">within</span> the 3D hardware, which means if there is nothing but black behind these sprites in the 3D hardware, they'd end up having a shade of black in the final resulting render on the BG itself, and not be semi-transparent at all against other BGs and sprites.
<br/>
<br/>
Unless you were able to take your entire 2D engine, and convert it all to be rendered with the 3D hardware, I don't see how you could get this effect easily.<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165717 - sverx - Mon Jan 05, 2009 10:19 am</h4>
    <div class="postbody"><span class="postbody">Thanks for your reply, and for confirming me that it's true.
<br/>
<br/>
Well, actually I guess I won't turn everything into 3D, I think I'll redesign parts of my work to use one semi-transparent BG instead of the semi-transparent sprites I can't use on top of other sprites.
<br/>
<br/>
Anyway if somebody discover a <span style="font-style: italic">trick</span> (besides flickering...) to display a sprite behind a semi-transparent one... well, I'm here ready to listen :)
<br/>
<br/>
Thanks!<br/>_________________<br/><a class="postlink" href="http://bit.ly/yiQrz9" target="_blank">libXM7</a>|<a class="postlink" href="http://bit.ly/yJwcOo" target="_blank">NDS programming tutorial (Italiano)</a>|<a class="postlink" href="http://disjointedstudio.blogspot.com/" target="_blank">Waimanu DS / GBA</a>|<a class="postlink" href="http://adshomebrewersdiary.blogspot.com" target="_blank">A DS Homebrewer's Diary</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
