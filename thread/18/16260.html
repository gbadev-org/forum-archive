<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>New Libnds - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > New Libnds</h2>
<div id="posts">
<div class="post">
    <h4>#165161 - dovoto - Thu Dec 11, 2008 5:23 am</h4>
    <div class="postbody"><span class="postbody"><a class="postlink" href="http://www.devkitpro.org" target="_blank">www.devkitpro.org</a>
<br/>
<br/>
I am in need of feedback on the new APIs (mainly the background, sprite, console, and keyboard stuff).  If anyone has constructive views to share and perhaps be incorporated into the next libnds feel free to express them.<br/>_________________<br/><a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165164 - nanou - Thu Dec 11, 2008 8:20 am</h4>
    <div class="postbody"><span class="postbody">The keyboard looks really nice and clean to use. I haven't run the example (not setup to compile on this system) so I haven't seen it in action yet. I'm surprised there's no example for asynchronous input though.<br/>_________________<br/>- nanou</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165173 - dovoto - Thu Dec 11, 2008 1:15 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>nanou wrote:</b></span></td> </tr> <tr> <td class="quote">The keyboard looks really nice and clean to use. I haven't run the example (not setup to compile on this system) so I haven't seen it in action yet. I'm surprised there's no example for asynchronous input though.</td> </tr></table><span class="postbody">
<br/>
<br/>
Good point, i will add one this afternoon.<br/>_________________<br/><a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165174 - nanou - Thu Dec 11, 2008 2:30 pm</h4>
    <div class="postbody"><span class="postbody">I just compiled and checked the example. It's pretty good, I can't complain about the presentation and I'm sure there's some logical way of switching the image whatnot, but something about it bugs me: when I tap just above the keyboard I get (seemingly) random character input. (Though I think it relates to the x position, I didn't investigate too closely.)
<br/>
<br/>
I'll be starting to make use of the input (and some other things on the list) in my own code in the next few days so I'll let you know if I have any noteworthy thoughts.
<br/>
<br/>
I haven't looked into the console too closely, but I get the impression that there's only one text colour available at a time while using the default font. Is this so? If so, would it make sense to extend the ansi console to include support for multicolour text and the like? I still haven't directly touched tiles (or sprites, my apps so far have all been simply computational and/or use bitmap graphics) so I really don't have a grasp of the way the console really works yet.<br/>_________________<br/>- nanou</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165188 - dovoto - Thu Dec 11, 2008 8:56 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>nanou wrote:</b></span></td> </tr> <tr> <td class="quote">I just compiled and checked the example. It's pretty good, I can't complain about the presentation and I'm sure there's some logical way of switching the image whatnot, but something about it bugs me: when I tap just above the keyboard I get (seemingly) random character input. (Though I think it relates to the x position, I didn't investigate too closely.)</td> </tr></table><span class="postbody">
<br/>
<br/>
Fixed and in CVS.  Thank you.
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>nanou wrote:</b></span></td> </tr> <tr> <td class="quote">I haven't looked into the console too closely, but I get the impression that there's only one text colour available at a time while using the default font. Is this so? </td> </tr></table><span class="postbody">
<br/>
<br/>
When using 16 color tiled backgrounds (the default) the engine uses all 16 palettes.  By default these palettes are initialized to the colors specified by the ansii escape sequences (see hello_world for an example of printing in color).  You can change the font palette using escape sequences in the format string or by directly setting console.fontPal attribute on the currently selected console.  The font palette tells the engine which palette to use (not directly which color).
<br/>
<br/>
The console uses color 15 of each palette with white being color 15 of palette 15 (or color entry 255).
<br/>
<br/>
This should work with extended palettes as well although you will have to load the colors manually into these palettes.
<br/>
<br/>
In other words the console supports multi color text out of the box as long as you have no more than 16 unique colors on screen.
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>nanou wrote:</b></span></td> </tr> <tr> <td class="quote">Async keyboard example </td> </tr></table><span class="postbody">
<br/>
<br/>
Not sure if this is exactly what you are looking for but here is how you do it with the current release (below you will find how to do it with the next release as i have modified it a bit)
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include &lt;nds.h&gt;
<br/>
#include &lt;stdio.h&gt;
<br/>
<br/>
//---------------------------------------------------------------------------------
<br/>
int main(void) {
<br/>
//---------------------------------------------------------------------------------
<br/>
   touchPosition touch;
<br/>
<br/>
   consoleDemoInit();  //setup the sub screen for printing
<br/>
<br/>
   keyboardInit(keyboardGetDefault());
<br/>
<br/>
   keyboardShow();
<br/>
<br/>
   while(1) {
<br/>
      
<br/>
   //   scanKeys();  keyboard update calls scankeys internally
<br/>
<br/>
      keyboardUpdate();
<br/>
<br/>
      if(keysDown() &amp; KEY_TOUCH)
<br/>
      {
<br/>
         touchRead(&amp;touch);
<br/>
<br/>
         int key = keyboardGetKey(touch.px, touch.py);
<br/>
<br/>
         if(key &gt; 0)
<br/>
            iprintf("%c", key);
<br/>
      }
<br/>
<br/>
      swiWaitForVBlank();
<br/>
   }
<br/>
<br/>
   return 0;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include &lt;nds.h&gt;
<br/>
#include &lt;stdio.h&gt;
<br/>
<br/>
//---------------------------------------------------------------------------------
<br/>
int main(void) {
<br/>
//---------------------------------------------------------------------------------
<br/>
   consoleDemoInit();  //setup the sub screen for printing
<br/>
<br/>
   keyboardInit(keyboardGetDefault());
<br/>
<br/>
   keyboardShow();
<br/>
<br/>
   while(1) {
<br/>
      
<br/>
//no longer interferes with scanKeys();
<br/>
      int key = keyboardUpdate();
<br/>
<br/>
      if(key &gt; 0)
<br/>
         iprintf("%c", key);
<br/>
<br/>
      swiWaitForVBlank();
<br/>
   }
<br/>
<br/>
   return 0;
<br/>
}
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/><a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165192 - MaesterRowen - Fri Dec 12, 2008 6:21 am</h4>
    <div class="postbody"><span class="postbody">Hey there, 
<br/>
<br/>
I appreciate the hard work put forth on this toolchain. 
<br/>
<br/>
First, I like the new sprite API , it is very convenient.
<br/>
<br/>
One thing I am having trouble with is the new background API.  Is there a way to directly manipulate the backgrounds offset on the LCD?
<br/>
<br/>
For instance, I want to take bg3 = bgInit(...) and instead of starting it at (0,0), offset it to be at say:  (20,20)
<br/>
<br/>
Or because I am fairly newer to the DS scene, is there more documentation on how to use the new Background API beyond what the examples show?
<br/>
<br/>
Other than that, I think the new functionality of the sprite APIs and the console/keyboard are wonderful!
<br/>
<br/>
Thanks for the hard work.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165193 - MaesterRowen - Fri Dec 12, 2008 7:24 am</h4>
    <div class="postbody"><span class="postbody">Nevermind, 
<br/>
<br/>
I figured out to just use the original register names to get the old style. 
<br/>
<br/>
Thanks!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165195 - nanou - Fri Dec 12, 2008 8:42 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>dovoto wrote:</b></span></td> </tr> <tr> <td class="quote">[In other words the console supports multi color text out of the box as long as you have no more than 16 unique colors on screen.</td> </tr></table><span class="postbody">
<br/>
Awesome. Thanks for the clarification.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>nanou wrote:</b></span></td> </tr> <tr> <td class="quote">Async keyboard example </td> </tr></table><span class="postbody">
<br/>
Not sure if this is exactly what you are looking for but here is how you do it with the current release (below you will find how to do it with the next release as i have modified it a bit)</span></td> </tr></table><span class="postbody">
<br/>
Yeah, that's just what I was thinking.<br/>_________________<br/>- nanou</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165208 - Ludo6431 - Fri Dec 12, 2008 10:38 pm</h4>
    <div class="postbody"><span class="postbody">It's too high level for me, it's so Palib-like.
<br/>
It's a pity :s</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165209 - AntonioND - Fri Dec 12, 2008 10:43 pm</h4>
    <div class="postbody"><span class="postbody">Great update, Dovoto!!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165210 - wintermute - Fri Dec 12, 2008 11:14 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ludo6431 wrote:</b></span></td> </tr> <tr> <td class="quote">It's too high level for me, it's so Palib-like.
<br/>
It's a pity :s</td> </tr></table><span class="postbody">
<br/>
<br/>
The low level access still exists, there's nothing forcing you to use the new APIs.
<br/>
<br/>
The main motivation behind these changes is to make things easier for those who think the thin wrapper we already provide for experienced coders is "too hard". Ultimately we intend the toolchain and support libraries to be accessible enough for novices to get started on the DS reasonably quickly without getting into the bad habits that are encouraged by tutorial writers without the experience to know how bad their examples are.
<br/>
<br/>
If the new APIs are "palib like" enough to satisfy the audience attracted by high level libraries like HAMlib and PAlib then the community as a whole will benefit a great deal.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165214 - Ludo6431 - Sat Dec 13, 2008 12:38 am</h4>
    <div class="postbody"><span class="postbody">Hum, ok.
<br/>
But i haven't any access to the registers :
<br/>
idon't know how "convert" this :
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void InitVideo() {
<br/>
   videoSetMode(MODE_5_2D | DISPLAY_BG2_ACTIVE | DISPLAY_BG3_ACTIVE);
<br/>
      vramSetBankA(VRAM_A_MAIN_BG_0x06000000);   //|
<br/>
      vramSetBankB(VRAM_B_MAIN_BG_0x06020000);   //|   3*96Ko cons?cutifs pour MAIN, MAIN1 &amp; MAIN2
<br/>
      vramSetBankD(VRAM_D_MAIN_BG_0x06040000);   //|   (96Ko de libre @ BG_BMP_RAM(18))
<br/>
<br/>
      BG3_CR = BG_BMP16_256x256 | BG_BMP_BASE(0) | BG_PRIORITY(3);
<br/>
      BG3_XDX = 1 &lt;&lt; 8;
<br/>
      BG3_XDY = 0;
<br/>
      BG3_YDX = 0;
<br/>
      BG3_YDY = 1 &lt;&lt; 8;
<br/>
      BG3_CX = 0;
<br/>
      BG3_CY = 0;
<br/>
<br/>
      BG2_CR = BG_BMP16_256x256 | BG_BMP_BASE(6) | BG_PRIORITY(2);
<br/>
      BG2_XDX = 1 &lt;&lt; 8;
<br/>
      BG2_XDY = 0;
<br/>
      BG2_YDX = 0;
<br/>
      BG2_YDY = 1 &lt;&lt; 8;
<br/>
      BG2_CX = 0;
<br/>
      BG2_CY = 0;
<br/>
<br/>
   videoSetModeSub(MODE_5_2D | DISPLAY_BG0_ACTIVE | DISPLAY_BG3_ACTIVE | DISPLAY_SPR_ACTIVE | DISPLAY_SPR_1D_BMP);
<br/>
      vramSetBankC(VRAM_C_SUB_BG_0x06200000);      // 8Ko pour le texte et 96Ko pour SUB
<br/>
<br/>
      SUB_BG0_CR = BG_MAP_BASE(3);
<br/>
      BG_PALETTE_SUB[255] = RGB15(31,0,0);
<br/>
      consoleInitDefault((u16*)SCREEN_BASE_BLOCK_SUB(3), (u16*)CHAR_BASE_BLOCK_SUB(0), 16);
<br/>
      consoleClear();
<br/>
<br/>
      SUB_BG3_CR = BG_BMP16_256x256 | BG_BMP_BASE(2) | BG_PRIORITY(3);
<br/>
      SUB_BG3_XDX = 1 &lt;&lt; 8;
<br/>
      SUB_BG3_XDY = 0;
<br/>
      SUB_BG3_YDX = 0;
<br/>
      SUB_BG3_YDY = 1 &lt;&lt; 8;
<br/>
      SUB_BG3_CX = 0;
<br/>
      SUB_BG3_CY = 0;
<br/>
<br/>
   lcdMainOnBottom();
<br/>
}
<br/>
<br/>
void swapMAINbuf() {
<br/>
   if(swaped) BG2_CR = BG_BMP16_256x256 | BG_BMP_BASE(6) | BG_PRIORITY(2);
<br/>
   else BG2_CR = BG_BMP16_256x256 | BG_BMP_BASE(12) | BG_PRIORITY(2);
<br/>
   swaped^=1;
<br/>
}
<br/>
<br/>
void hideConsole() {
<br/>
   videoSetModeSub(MODE_5_2D/* | DISPLAY_BG0_ACTIVE*/ | DISPLAY_BG3_ACTIVE | DISPLAY_SPR_ACTIVE | DISPLAY_SPR_1D_BMP);
<br/>
}
<br/>
<br/>
void showConsole() {
<br/>
   videoSetModeSub(MODE_5_2D | DISPLAY_BG0_ACTIVE | DISPLAY_BG3_ACTIVE | DISPLAY_SPR_ACTIVE | DISPLAY_SPR_1D_BMP);
<br/>
}
<br/>
<br/>
void setBrightness(u8 screen, s16 bright) {
<br/>
   u16 mode = 1 &lt;&lt; 14;
<br/>
<br/>
   if(bright &lt; 0) {
<br/>
      mode = 2 &lt;&lt; 14;
<br/>
      bright = -bright;
<br/>
   }
<br/>
   if(bright &gt; 16) bright = 16;
<br/>
   *(vuint16 *)(0x0400006C + (0x1000 * screen)) = bright | mode;
<br/>
<br/>
//#define BRIGHTNESS     (*(vuint16*)0x0400006C)
<br/>
//#define SUB_BRIGHTNESS (*(vuint16*)0x0400106C)
<br/>
}</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165216 - wintermute - Sat Dec 13, 2008 1:22 am</h4>
    <div class="postbody"><span class="postbody">Most of the register definitions have now been changed to the standard names used in gbatek. The include file &lt;nds/registers_alt.h&gt; shows a cross reference from the old deprecated names to the new names.
<br/>
<br/>
The console code has been revamped a bit and now needs initialised in a slightly different way.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void InitVideo() {
<br/>
<br/>
   videoSetMode(MODE_5_2D | DISPLAY_BG2_ACTIVE | DISPLAY_BG3_ACTIVE);
<br/>
   vramSetBankA(VRAM_A_MAIN_BG_0x06000000);   //|
<br/>
   vramSetBankB(VRAM_B_MAIN_BG_0x06020000);   //|   3*96Ko cons?cutifs pour MAIN, MAIN1 &amp; MAIN2
<br/>
   vramSetBankD(VRAM_D_MAIN_BG_0x06040000);   //|   (96Ko de libre @ BG_BMP_RAM(18))
<br/>
<br/>
   REG_BG3CNT = BG_BMP16_256x256 | BG_BMP_BASE(0) | BG_PRIORITY(3);
<br/>
   REG_BG3PA = 1 &lt;&lt; 8;
<br/>
   REG_BG3PB = 0;
<br/>
   REG_BG3PC = 0;
<br/>
   REG_BG3PD = 1 &lt;&lt; 8;
<br/>
   REG_BG3X = 0;
<br/>
   REG_BG3Y = 0;
<br/>
<br/>
   REG_BG2CNT = BG_BMP16_256x256 | BG_BMP_BASE(6) | BG_PRIORITY(2);
<br/>
   REG_BG2PA = 1 &lt;&lt; 8;
<br/>
   REG_BG2PB = 0;
<br/>
   REG_BG2PC = 0;
<br/>
   REG_BG2PD = 1 &lt;&lt; 8;
<br/>
   REG_BG2X = 0;
<br/>
   REG_BG2Y = 0;
<br/>
<br/>
   videoSetModeSub(MODE_5_2D | DISPLAY_BG0_ACTIVE | DISPLAY_BG3_ACTIVE | DISPLAY_SPR_ACTIVE | DISPLAY_SPR_1D_BMP);
<br/>
   vramSetBankC(VRAM_C_SUB_BG_0x06200000);      // 8Ko pour le texte et 96Ko pour SUB
<br/>
<br/>
    REG_BG0CNT_SUB = BG_MAP_BASE(3);
<br/>
   BG_PALETTE_SUB[255] = RGB15(31,0,0);
<br/>
<br/>
   consoleInit(NULL, 0,BgType_Text4bpp, BgSize_T_256x256, 3, 0, false);
<br/>
   consoleClear();
<br/>
<br/>
   REG_BG3CNT_SUB = BG_BMP16_256x256 | BG_BMP_BASE(2) | BG_PRIORITY(3);
<br/>
   REG_BG3PA_SUB = 1 &lt;&lt; 8;
<br/>
   REG_BG3PA_SUB = 0;
<br/>
   REG_BG3PB_SUB = 0;
<br/>
   REG_BG3PC_SUB = 1 &lt;&lt; 8;
<br/>
   REG_BG3X_SUB = 0;
<br/>
   REG_BG3Y_SUB = 0;
<br/>
<br/>
   lcdMainOnBottom();
<br/>
}
<br/>
<br/>
int swaped = 0;
<br/>
<br/>
void swapMAINbuf() {
<br/>
  
<br/>
   if(swaped) REG_BG2CNT = BG_BMP16_256x256 | BG_BMP_BASE(6) | BG_PRIORITY(2);
<br/>
   else REG_BG2CNT = BG_BMP16_256x256 | BG_BMP_BASE(12) | BG_PRIORITY(2);
<br/>
   swaped^=1;
<br/>
}
<br/>
<br/>
void hideConsole() {
<br/>
   videoSetModeSub(MODE_5_2D/* | DISPLAY_BG0_ACTIVE*/ | DISPLAY_BG3_ACTIVE | DISPLAY_SPR_ACTIVE | DISPLAY_SPR_1D_BMP);
<br/>
}
<br/>
<br/>
void showConsole() {
<br/>
   videoSetModeSub(MODE_5_2D | DISPLAY_BG0_ACTIVE | DISPLAY_BG3_ACTIVE | DISPLAY_SPR_ACTIVE | DISPLAY_SPR_1D_BMP);
<br/>
}
<br/>
<br/>
void setBrightness(u8 screen, s16 bright) {
<br/>
   u16 mode = 1 &lt;&lt; 14;
<br/>
<br/>
   if(bright &lt; 0) {
<br/>
      mode = 2 &lt;&lt; 14;
<br/>
      bright = -bright;
<br/>
   }
<br/>
   if(bright &gt; 16) bright = 16;
<br/>
   *(vuint16 *)(0x0400006C + (0x1000 * screen)) = bright | mode;
<br/>
<br/>
//#define BRIGHTNESS     (*(vuint16*)0x0400006C)
<br/>
//#define SUB_BRIGHTNESS (*(vuint16*)0x0400106C)
<br/>
}
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165218 - Ludo6431 - Sat Dec 13, 2008 1:34 am</h4>
    <div class="postbody"><span class="postbody">Hum, ok so very good ;)
<br/>
Thanks a lot.<br/>_________________<br/>Sorry for my poor english, I'm french.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165219 - Jevin - Sat Dec 13, 2008 1:49 am</h4>
    <div class="postbody"><span class="postbody">When can we expect to see updated buildscripts? Gotta give the *BSDers some love! :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165226 - dovoto - Sat Dec 13, 2008 4:32 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>MaesterRowen wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
One thing I am having trouble with is the new background API.  Is there a way to directly manipulate the backgrounds offset on the LCD?
<br/>
<br/>
For instance, I want to take bg3 = bgInit(...) and instead of starting it at (0,0), offset it to be at say:  (20,20)
<br/>
<br/>
Or because I am fairly newer to the DS scene, is there more documentation on how to use the new Background API beyond what the examples show?
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
To manipulate the "offset" you can scroll the background.
<br/>
<br/>
bgSetScroll(id, x,y) or bgSetScrollf(id, x,y) where x and y are the offset in int or fixed (16.8 signed) respectivly.  If you use the scroll or rotate functionality of the api you must call bgUpdate(id) once per frame.
<br/>
<br/>
As for documents:
<br/>
<br/>
<a class="postlink" href="http://libnds.devkitpro.org/" target="_blank">http://libnds.devkitpro.org/</a>
<br/>
<br/>
Or, if you have doxygen installed you can type "make docs" from the libnds source directory (would need to grab the source tarball from the SF release for this)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
It's too high level for me, it's so Palib-like. 
<br/>
It's a pity :s
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I tried to make the api as thin as possible, basically most of it is wrapping register calls with minimal logic (this is more maintainable for us, easier to document, and easier to remember).  
<br/>
<br/>
I made an effort to ensure you could mix the api and direct register access and I am pretty sure I succeeded in all but background scrolling and rotation (some state management was necessary in this area).<br/>_________________<br/><a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165232 - Ludo6431 - Sat Dec 13, 2008 9:22 pm</h4>
    <div class="postbody"><span class="postbody">Yes, you're right, i must apologize.
<br/>
I was thinking that the registers aren't available, only the bgInit function...
<br/>
<br/>
You've done a very good work, thanks.<br/>_________________<br/>Sorry for my poor english, I'm french.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165235 - sigmaris - Sun Dec 14, 2008 1:27 am</h4>
    <div class="postbody"><span class="postbody">How come in the new background API, bgGetMapPtr() and bgGetGfxPtr() return u16** ? Shouldn't it be simply u16* ? Or am I misunderstanding what these functions are supposed to do? I am trying to modify a background's map while the game is running to animate some tiles.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165241 - dovoto - Sun Dec 14, 2008 4:55 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sigmaris wrote:</b></span></td> </tr> <tr> <td class="quote">How come in the new background API, bgGetMapPtr() and bgGetGfxPtr() return u16** ? Shouldn't it be simply u16* ? Or am I misunderstanding what these functions are supposed to do? I am trying to modify a background's map while the game is running to animate some tiles.</td> </tr></table><span class="postbody">
<br/>
<br/>
hrm...will check that out when i get back.  Definitely not right if so.<br/>_________________<br/><a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165279 - dovoto - Mon Dec 15, 2008 11:59 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sigmaris wrote:</b></span></td> </tr> <tr> <td class="quote">How come in the new background API, bgGetMapPtr() and bgGetGfxPtr() return u16** ? Shouldn't it be simply u16* ? Or am I misunderstanding what these functions are supposed to do? I am trying to modify a background's map while the game is running to animate some tiles.</td> </tr></table><span class="postbody">
<br/>
<br/>
Weird, must have slipped through our QA department ;) 
<br/>
<br/>
Sorry for the delay but return type fixed and updated in the cvs and thanks<br/>_________________<br/><a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165282 - sigmaris - Tue Dec 16, 2008 1:37 am</h4>
    <div class="postbody"><span class="postbody">cool! I noticed it worked when cast to u16* anyway. The new API is very nice, and also the enhancements in IPC and the integration of Maxmod :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165474 - M3d10n - Mon Dec 22, 2008 4:16 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">Most of the register definitions have now been changed to the standard names used in gbatek.</td> </tr></table><span class="postbody">
<br/>
What? Awesome! This makes it much easier to use gbatek as a reference.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165491 - wintermute - Tue Dec 23, 2008 2:12 am</h4>
    <div class="postbody"><span class="postbody">Yeah, that was kind of the point of the exercise really :p
<br/>
<br/>
There are still a few left to move over but we're getting there.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165589 - AxemRed - Mon Dec 29, 2008 5:15 am</h4>
    <div class="postbody"><span class="postbody">In videoGL.c:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
int glTexImage2D(int target, int empty1, GL_TEXTURE_TYPE_ENUM type, int sizeX, int sizeY, int empty2, GL_TEXTURE_PARAM_ENUM  param, const uint8* texture) {
<br/>
...
<br/>
   addr = DynamicArrayGet(&amp;glGlob-&gt;texturePtrs, glGlob-&gt;activeTexture);
<br/>
...
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Can cause problems because the relevant element of the texturePtrs array is never explicitly set to a value before you call this function.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165591 - dovoto - Mon Dec 29, 2008 5:43 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>AxemRed wrote:</b></span></td> </tr> <tr> <td class="quote">In videoGL.c:
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
int glTexImage2D(int target, int empty1, GL_TEXTURE_TYPE_ENUM type, int sizeX, int sizeY, int empty2, GL_TEXTURE_PARAM_ENUM  param, const uint8* texture) {
<br/>
...
<br/>
   addr = DynamicArrayGet(&amp;glGlob-&gt;texturePtrs, glGlob-&gt;activeTexture);
<br/>
...
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Can cause problems because the relevant element of the texturePtrs array is never explicitly set to a value before you call this function.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
hrm...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   for(i = 0; i &lt; 16; i++)
<br/>
      DynamicArraySet(&amp;glGlob-&gt;texturePtrs, i, (void*)0);
<br/>
</td> </tr></table><span class="postbody">
<br/>
added to glInit, thanks<br/>_________________<br/><a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165682 - pilch - Sat Jan 03, 2009 3:33 pm</h4>
    <div class="postbody"><span class="postbody">I saw that card.h has changed a bit.
<br/>
Does card functions really works ? (I never managed to read from the card)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165685 - Dwedit - Sat Jan 03, 2009 4:49 pm</h4>
    <div class="postbody"><span class="postbody">I think Libgba/Libnds could use some blitting or 'software sprite' functions for the 16-color tiled video modes.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165686 - Echo49 - Sat Jan 03, 2009 7:53 pm</h4>
    <div class="postbody"><span class="postbody">If I download the installer from the devkitpro site, does it grab the newest (checked) code from CVS? Or will I have to update the changes mentioned in this thread manually?
<br/>
<br/>
Also, when it says irqs are now inited before main, what's the "proper" way to set which functions are called for each irq?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165692 - dovoto - Sun Jan 04, 2009 1:55 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Echo49 wrote:</b></span></td> </tr> <tr> <td class="quote">If I download the installer from the devkitpro site, does it grab the newest (checked) code from CVS? Or will I have to update the changes mentioned in this thread manually?
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
The installer downloads the latest official release which is the topic of this thread. 
<br/>
<br/>
Directly using the SVN version of libnds should be reserved for those who don't mind a bit of frustration.  Libnds has a small team so the quality of the current SVN repo is occasionally lacking and answering support emails about it tends to frustrate the developers (in other words if you are not the type who can peak into the source code and provide us detailed information about the nature of a bug we are probably going to ignore any support questions you have on the non official release).<br/>_________________<br/><a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165693 - dovoto - Sun Jan 04, 2009 1:57 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Echo49 wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<br/>
Also, when it says irqs are now inited before main, what's the "proper" way to set which functions are called for each irq?</td> </tr></table><span class="postbody">
<br/>
<br/>
<a class="postlink" href="http://libnds.devkitpro.org/a00072.html#5343d11a5c11bd860918c390b81a68ce" target="_blank">http://libnds.devkitpro.org/a00072.html#5343d11a5c11bd860918c390b81a68ce</a><br/>_________________<br/><a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165698 - Echo49 - Sun Jan 04, 2009 6:38 am</h4>
    <div class="postbody"><span class="postbody">Thanks dovoto - I just wanted to make sure before I upgraded and begin the task of find+replacing my code.
<br/>
<br/>
I just want to clarify the point on interrupts - all I have to do is remove irqInit() and it'll be fine?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165700 - dovoto - Sun Jan 04, 2009 4:03 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Echo49 wrote:</b></span></td> </tr> <tr> <td class="quote">Thanks dovoto - I just wanted to make sure before I upgraded and begin the task of find+replacing my code.
<br/>
<br/>
I just want to clarify the point on interrupts - all I have to do is remove irqInit() and it'll be fine?</td> </tr></table><span class="postbody">
<br/>
<br/>
Yes, that is really the only change to IRQs in this release other than vblank irq is enabled before main (no handler is installed for it though so you are still welcome to install your own vblank handler).  Re-enabling vblank should have no ill effects.<br/>_________________<br/><a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165708 - AxemRed - Sun Jan 04, 2009 10:46 pm</h4>
    <div class="postbody"><span class="postbody">I've found something interesting:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
//doesn't work, ARM7 never receives the message
<br/>
//fifoSendValue32(FIFO_USER_07, value);
<br/>
<br/>
//works
<br/>
if (!fifoSendValue32(FIFO_USER_07, value)) {
<br/>
   iprintf("Error sending message to ARM7\n");
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
It appears GCC can get a bit overenthusiastic with its optimizations if you don't need the return value. Couldn't really find the problem in the libnds source -- maybe a missing volatile keyword somewhere?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165712 - Dwedit - Mon Jan 05, 2009 12:40 am</h4>
    <div class="postbody"><span class="postbody">Care to fix the issue with dirnext (struct stat size is smaller than it should be, so bytes in memory after the struct get overwritten when you call dirnext)<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165722 - hacker013 - Mon Jan 05, 2009 3:27 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>AxemRed wrote:</b></span></td> </tr> <tr> <td class="quote">I've found something interesting:
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
//doesn't work, ARM7 never receives the message
<br/>
//fifoSendValue32(FIFO_USER_07, value);
<br/>
<br/>
//works
<br/>
if (!fifoSendValue32(FIFO_USER_07, value)) {
<br/>
   iprintf("Error sending message to ARM7\n");
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
It appears GCC can get a bit overenthusiastic with its optimizations if you don't need the return value. Couldn't really find the problem in the libnds source -- maybe a missing volatile keyword somewhere?</span></td> </tr></table><span class="postbody">
<br/>
<br/>
fifoSendValue32 has 3 arguments<br/>_________________<br/><a class="postlink" href="http://imetal.nl/" target="_blank">Website / Blog</a>
<br/>
<br/>
Let the nds be with you.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165845 - AxemRed - Fri Jan 09, 2009 12:30 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>hacker013 wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>AxemRed wrote:</b></span></td> </tr> <tr> <td class="quote">I've found something interesting:
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
//doesn't work, ARM7 never receives the message
<br/>
//fifoSendValue32(FIFO_USER_07, value);
<br/>
<br/>
//works
<br/>
if (!fifoSendValue32(FIFO_USER_07, value)) {
<br/>
   iprintf("Error sending message to ARM7\n");
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
It appears GCC can get a bit overenthusiastic with its optimizations if you don't need the return value. Couldn't really find the problem in the libnds source -- maybe a missing volatile keyword somewhere?</span></td> </tr></table><span class="postbody">
<br/>
<br/>
fifoSendValue32 has 3 arguments</span></td> </tr></table><span class="postbody">
<br/>
In 1.3.1 it's declared as:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">bool fifoSendValue32(int channel, u32 value32);</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
<br/>
<br/>
Trying out the new keyboard I noticed a typo in a function name:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int keboardGetChar(void);</td> </tr></table><span class="postbody">
<br/>
<br/>
and in keyboardInit BG_PALETTE_SUB is always used even if keyboardOnSub is false:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   dmaCopy(keyboard-&gt;palette, BG_PALETTE_SUB, keyboard-&gt;paletteLen);
<br/>
   dmaCopy(keyboard-&gt;lower-&gt;mapDataPressed, bgGetMapPtr(keyboard-&gt;background), 
<br/>
     keyboard-&gt;lower-&gt;width * keyboard-&gt;lower-&gt;height * keyboard-&gt;grid_height * keyboard-&gt;grid_width / 64 * 2);
<br/>
<br/>
   BG_PALETTE_SUB[255] = RGB15(31,31,31);
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165846 - dovoto - Fri Jan 09, 2009 12:55 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>AxemRed wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<br/>
<br/>
<br/>
Trying out the new keyboard I noticed a typo in a function name:
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int keboardGetChar(void);</td> </tr></table><span class="postbody">
<br/>
<br/>
and in keyboardInit BG_PALETTE_SUB is always used even if keyboardOnSub is false:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   dmaCopy(keyboard-&gt;palette, BG_PALETTE_SUB, keyboard-&gt;paletteLen);
<br/>
   dmaCopy(keyboard-&gt;lower-&gt;mapDataPressed, bgGetMapPtr(keyboard-&gt;background), 
<br/>
     keyboard-&gt;lower-&gt;width * keyboard-&gt;lower-&gt;height * keyboard-&gt;grid_height * keyboard-&gt;grid_width / 64 * 2);
<br/>
<br/>
   BG_PALETTE_SUB[255] = RGB15(31,31,31);
<br/>
</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
<br/>
Both of these issues have been brought to my attention and will be fixed with next release.  Just need to iron out a few things with the sprite api.  Thank you for the feedback.<br/>_________________<br/><a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165848 - headspin - Fri Jan 09, 2009 1:08 pm</h4>
    <div class="postbody"><span class="postbody">Sorry if this has been asked before but why does it take so long for binaries to initialise and display something onscreen? All the examples take about 15 seconds or so to do anything. I noticed this both in emu's and hardware and I don't remember this back when I was using DKP r20.<br/>_________________<br/><a class="postlink" href="http://headsoft.com.au/index.php?category=warhawk" target="_blank">Warhawk DS</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=mmll" target="_blank">Manic Miner: The Lost Levels</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=tdg" target="_blank">The Detective Game</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165849 - dovoto - Fri Jan 09, 2009 3:48 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>headspin wrote:</b></span></td> </tr> <tr> <td class="quote">Sorry if this has been asked before but why does it take so long for binaries to initialise and display something onscreen? All the examples take about 15 seconds or so to do anything. I noticed this both in emu's and hardware and I don't remember this back when I was using DKP r20.</td> </tr></table><span class="postbody">
<br/>
<br/>
I have not noticed this, all are instant on in both no$ and on hardware for me.  can you be more specific?  are you using libfat?<br/>_________________<br/><a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165891 - headspin - Sun Jan 11, 2009 6:36 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>dovoto wrote:</b></span></td> </tr> <tr> <td class="quote">I have not noticed this, all are instant on in both no$ and on hardware for me.  can you be more specific?  are you using libfat?</td> </tr></table><span class="postbody">
<br/>
<br/>
Okay I just tested a few of the demo's it turns out it's just iDeaS not hardware. Sorry my mistake!<br/>_________________<br/><a class="postlink" href="http://headsoft.com.au/index.php?category=warhawk" target="_blank">Warhawk DS</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=mmll" target="_blank">Manic Miner: The Lost Levels</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=tdg" target="_blank">The Detective Game</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#166101 - Echo49 - Mon Jan 26, 2009 9:46 pm</h4>
    <div class="postbody"><span class="postbody">What happens when you don't have a free channel and you call soundPlaySample()? Does it return -1 or does it wait until there is one?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#166299 - ChronoDK - Wed Feb 04, 2009 9:54 am</h4>
    <div class="postbody"><span class="postbody">This new background system seems really nice! A few questions came up when trying to get older code working with this new system. 
<br/>
<br/>
First, how do I use extended palettes? I would expect a parameter in the BgInit function, but there is none. Also where do I copy the palettes to now?
<br/>
<br/>
More questions might show up later :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#166389 - cory1492 - Sat Feb 07, 2009 9:12 am</h4>
    <div class="postbody"><span class="postbody">First, thanks for all the ongoing DK updates! Getting something unusual here after updating using the DKp updater and figured <span style="font-style: italic">someone</span> may like to hear about it. I'm compiling the EZ5s dldi under current DKPro via updater, source is linked below the error.
<br/>
<br/>
Has anyone linked anything successfully against card.o of libnds9.a in the recent dkpro? It is using memcpy internally without being able to link it with ld later, changing the <span style="font-style: italic">command</span> array of cardReadID() to static or //removing it and refs to it out of the lib fixes the problem, though I have my doubts using static would do anything good for the function or the rest of the lib if anyone is actually using it.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">Cory@HOME2 /h/devkitPro/proj/_EZ5/ez5s
<br/>
$ make
<br/>
linking ez5s.elf
<br/>
h:/devkitPro/libnds/lib\libnds9.a(card.o): In function `cardReadID':
<br/>
/Users/davem/projects/devkitPro/libnds-master/libnds/arm9/../source/common/card.c:116: undefined reference to `memcpy'
<br/>
collect2: ld returned 1 exit status
<br/>
make[1]: *** [/h/devkitPro/proj/_EZ5/ez5s-dldi-R20-opt_debug/ez5s-dldi-R20-opt_debug.elf] Error 1
<br/>
make: *** [build] Error 2</td> </tr></table><span class="postbody">And <a class="postlink" href="http://nds.cmamod.com/ez5/__ez5s-dldi-DKPR24-debug.rar" target="_blank">the source</a> giving me this error.
<br/>
<br/>
Tried to pull the latest libnds from svn today as well just to double check if it's been fixed somewhere already before posting this, GRIT and a /../ in the path for the keyboardgfx png killed that build pretty quick. Two glitches for the price of one, I guess. (edit:/ I see keyboardgfx has been fixed, cures the issue with svn not building for me but the earlier memcpy linking is still an issue.)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#166513 - Echo49 - Mon Feb 09, 2009 10:29 am</h4>
    <div class="postbody"><span class="postbody">I've noticed that in timers.h TIMER_FREQ_x(n) is defined as
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define TIMER_FREQ_x(n) (-(0x2000000&gt;&gt;x)/(n))</td> </tr></table><span class="postbody">
<br/>
However, on gbatek it says the frequency is 33513982, not 0x2000000 (33554432). As a result, the calculated value differs by about 20 ticks. 
<br/>
<br/>
I know 20 ticks isn't much time (0.6ms), but my program requires timer accuracy in short bursts over long periods time. The 20 tick difference adds up fairly quickly, resulting in around 500ms of delay after 3 minutes. At the moment I'm using my own modified macro with the gbatek value, but I would prefer to use the one defined in libnds. Any chance of a fix?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#166516 - eKid - Mon Feb 09, 2009 10:45 am</h4>
    <div class="postbody"><span class="postbody">0.6 microseconds, why do you need so much accuracy? 0x2000000 is sometimes convenient because it can be divided by powers of 2 nicely.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#166517 - Echo49 - Mon Feb 09, 2009 10:52 am</h4>
    <div class="postbody"><span class="postbody">ms = <span style="font-style: italic">milli</span>second (micro is ?)
<br/>
<br/>
I'm double buffering audio from a file as a libfat/audio/doublebuffer exercise, and the delay adds up fairly quickly causing my audio to become out of sync. In reality the delay when using the libnds macro is much more than 0.6ms, though I haven't pinpointed exactly how this is the case yet.
<br/>
<br/>
In any case, wouldn't it be better to use the "proper" value rather than an approximation?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include &lt;nds.h&gt;
<br/>
#include &lt;stdio.h&gt;
<br/>
#include &lt;fat.h&gt;
<br/>
<br/>
#define SIZE 11025
<br/>
#define SAMPLERATE 22050
<br/>
<br/>
u8 *buffer, *buffer2;
<br/>
FILE* file;
<br/>
bool swap = true;
<br/>
bool fill = false;
<br/>
<br/>
u8* getBuffer() {
<br/>
   if (swap)
<br/>
      return buffer;
<br/>
   else
<br/>
      return buffer2;
<br/>
}
<br/>
<br/>
void timerHandler()
<br/>
{
<br/>
   soundPlaySample(getBuffer(), SoundFormat_8Bit, SIZE, SAMPLERATE, 127, 64, false, 0);
<br/>
   swap = !swap;
<br/>
   fill = true;
<br/>
}
<br/>
<br/>
int main() {
<br/>
   
<br/>
   irqEnable(IRQ_TIMER0);
<br/>
   irqSet(IRQ_TIMER0, timerHandler);
<br/>
   
<br/>
   soundEnable();
<br/>
<br/>
   consoleDemoInit();  //setup the sub screen for printing
<br/>
   
<br/>
   if (!fatInitDefault())
<br/>
   {
<br/>
      iprintf("fat cat");
<br/>
      return -1;
<br/>
   }
<br/>
<br/>
   file = fopen("music.raw","rb");
<br/>
   if (!file) {
<br/>
      iprintf("no file");
<br/>
      return -1;
<br/>
   }
<br/>
   
<br/>
   //align to 4 bytes
<br/>
   buffer = (u8*)new u32[(SIZE&gt;&gt;2)+1]; 
<br/>
   buffer2 = (u8*)new u32[(SIZE&gt;&gt;2)+1];
<br/>
   
<br/>
   fread(getBuffer(),1,SIZE,file);
<br/>
   
<br/>
   // formula for data is -(F*t)/1024, F=33513982 (gbatek), t=SIZE/SAMPLERATE=0.5
<br/>
   // TIMER_FREQ_1024(n) uses F=33554432 which isn't accurate enough
<br/>
   TIMER0_DATA = -16364;
<br/>
   TIMER0_CR = TIMER_ENABLE | TIMER_IRQ_REQ | TIMER_DIV_1024;
<br/>
<br/>
   while(1)
<br/>
   {
<br/>
      if (fill) {
<br/>
         fread(getBuffer(),1,SIZE,file);
<br/>
         fill = false;
<br/>
      }
<br/>
      swiWaitForVBlank();
<br/>
   }
<br/>
   return 0;
<br/>
}</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#166520 - eKid - Mon Feb 09, 2009 11:10 am</h4>
    <div class="postbody"><span class="postbody">erm.. 20 33mhz ticks is 0.6 microseconds but I see you're using /1024 prescaler. When streaming audio, you really don't want to have *any* inaccuracies or it will drift out of sync easily. The way to do that is not use these macros and just have a timer (or two) to count samples (where it is based on the sound channel's frequency) to know where you are in the ring buffer.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#166521 - Echo49 - Mon Feb 09, 2009 11:21 am</h4>
    <div class="postbody"><span class="postbody">Could you show me an example of how to sync the timer and the playback? I'm not sure how I can do this using the libnds sound functions (or whether I even can)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#166523 - eKid - Mon Feb 09, 2009 11:34 am</h4>
    <div class="postbody"><span class="postbody">Hm, it's easy if the libnds sound functions had a way to set the sound channel timer directly... (request for soundSetTimer(...) :)
<br/>
<br/>
Also, I just noticed that you are playing each half of the buffer each timer tick. That can't work properly because of some of the sound hardware quirks. You have to use one channel that plays the ring buffer as a loop.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#166566 - Echo49 - Mon Feb 09, 2009 9:30 pm</h4>
    <div class="postbody"><span class="postbody">Ok, I'll look into that.
<br/>
<br/>
edit: Seems to work fine with a ring buffer now. Cheers!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#166592 - Lazy1 - Wed Feb 11, 2009 2:52 am</h4>
    <div class="postbody"><span class="postbody">The new sound system needs a way to reserve/block channels on the arm9 from being used.
<br/>
I have channels 0 and 1 playing music from an OPL2 emulator on the arm7, normally this works fine but if a sound is played before the arm7 starts playing the song one channel will play loud static instead.
<br/>
<br/>
I'm trying to think of a workaround for this but any other ideas would be helpful.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#166596 - Echo49 - Wed Feb 11, 2009 5:47 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lazy1 wrote:</b></span></td> </tr> <tr> <td class="quote">The new sound system needs a way to reserve/block channels on the arm9 from being used.</td> </tr></table><span class="postbody">
<br/>
I agree. I noticed that both soundPause() and soundKill() do the exact same thing - change the enable bit to 0. Doesn't this mean that a paused channel could be used by another sample, rendering soundResume() useless?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#166676 - Lazy1 - Fri Feb 13, 2009 8:30 pm</h4>
    <div class="postbody"><span class="postbody">Moving the music to channels 6/7 stopped the problems I was having, however this will probably still break at some point.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168720 - Synthetic - Sun May 17, 2009 5:34 am</h4>
    <div class="postbody"><span class="postbody">I just updated to the latest version of devkitarm and libnds, and I'm seeing the behavior that headspin was talking about, on hardware.
<br/>
<br/>
I compiled the helloworld example, put it on my Cyclo Evolution (latest firmware), and it sits for ~15 seconds with both screens white.  When the hello world does display, the framecounter starts at 0, so this is happening before the vblank irq starts?</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
