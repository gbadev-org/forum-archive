<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Guitar Hero DS Controller support in hombrew - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Guitar Hero DS Controller support in hombrew</h2>
<div id="posts">
<div class="post">
    <h4>#159148 - knight0fdragon - Thu Jun 26, 2008 5:06 am</h4>
    <div class="postbody"><span class="postbody">Many thanks to davr for refreshing me on how SRAM works with DS
<br/>
<br/>
<br/>
Here is the code to use the guitar hero controller for your games. 
<br/>
<br/>
The software is provided as-is, and I can not be held responsible if anything happens to your DS
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">/*---------------------------------------------------------------------------------
<br/>
<br/>
   $Id: main.c,v 1.5 2007/10/23 00:46:29 wntrmute Exp $
<br/>
<br/>
   Simple console print demo
<br/>
   -- dovoto
<br/>
<br/>
---------------------------------------------------------------------------------*/
<br/>
#include &lt;nds.h&gt;
<br/>
#include &lt;stdio.h&gt;
<br/>
#include &lt;stdlib.h&gt;
<br/>
#include &lt;unistd.h&gt;
<br/>
<br/>
#define SRAM_WAIT_18 0x03 
<br/>
#define GREEN   0x40
<br/>
#define RED     0x20
<br/>
#define YELLOW  0x10
<br/>
#define BLUE    0x08
<br/>
<br/>
//---------------------------------------------------------------------------------
<br/>
int main(void) {
<br/>
//---------------------------------------------------------------------------------
<br/>
<br/>
   irqInit();
<br/>
   irqEnable(IRQ_VBLANK);
<br/>
  
<br/>
   videoSetMode(0);   //not using the main screen
<br/>
   videoSetModeSub(MODE_0_2D | DISPLAY_BG0_ACTIVE);   //sub bg 0 will be used to print text
<br/>
   
<br/>
  vramSetBankC(VRAM_C_SUB_BG);
<br/>
<br/>
   SUB_BG0_CR = BG_MAP_BASE(31);
<br/>
<br/>
   BG_PALETTE_SUB[255] = RGB15(31,31,31);   //by default font will be rendered with color 255
<br/>
<br/>
   //consoleInit() is a lot more flexible but this gets you up and running quick
<br/>
   consoleInitDefault((u16*)SCREEN_BASE_BLOCK_SUB(31), (u16*)CHAR_BASE_BLOCK_SUB(0), 16);
<br/>
<br/>
   iprintf("\tSwap carts if need be and press start");
<br/>
  while(!(keysDown() &amp; KEY_START))
<br/>
  {
<br/>
    scanKeys();
<br/>
  }
<br/>
<br/>
//sets up ARM9 to read SLOT 2, and sets up SRAM
<br/>
  sysSetBusOwners(BUS_OWNER_ARM9, BUS_OWNER_ARM9);
<br/>
  REG_EXMEMCNT &amp;= ~0x0880;
<br/>
<br/>
  REG_EXMEMCNT |= SRAM_WAIT_18;
<br/>
<br/>
  char fret[5];
<br/>
  memset(fret,0,5);
<br/>
//Read the buttons off the fret
<br/>
 while(1) 
<br/>
  {
<br/>
    memset(fret,' ',4);  //clears the fret buffer
<br/>
    //below here we will check to see if the cart exists
<br/>
    if((GBAROM[0xFFFF]) == CHECKCART)
<br/>
    {
<br/>
      //if it does, process the buttons 
<br/>
      if(((~SRAM[0x0]) &amp; GREEN))
<br/>
        fret[3] = 'G';
<br/>
    
<br/>
      if(((~SRAM[0x0]) &amp; RED))
<br/>
        fret[2] = 'R';
<br/>
    
<br/>
      if(((~SRAM[0x0]) &amp; YELLOW))
<br/>
        fret[1] = 'Y';
<br/>
    
<br/>
      if(((~SRAM[0x0]) &amp; BLUE))
<br/>
        fret[0] = 'B';
<br/>
    
<br/>
    iprintf("\x1b[6;5HFret         \n");
<br/>
    iprintf("\x1b[6;5HFret %s\n",fret);
<br/>
    }
<br/>
    else
<br/>
     //show that device is not found
<br/>
      iprintf("\x1b[6;5HNOT FOUND\n",fret);
<br/>
    
<br/>
    iprintf("\x1b[16;5HROM(0000) %x",GBAROM[0x0]);
<br/>
    iprintf("\x1b[17;5HROM(FFFF) %x",GBAROM[0xFFFF]);
<br/>
  }
<br/>
  return 0;
<br/>
}
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
edit:
<br/>
changed 0x600 to 0x0, as its a waste in power
<br/>
<br/>
<br/>
not tested, but to detect if the grip exists, poll
<br/>
GBAROM[0] for 0xF9FF
<br/>
<br/>
thanks to grizzlyadams for pointing this stuff out
<br/>
<br/>
to get a picture of the board used on the grip, grap it here  <a href="http://i31.tinypic.com/15388jq.jpg" target="_blank">http://i31.tinypic.com/15388jq.jpg</a>
<br/>
<br/>
<br/>
more edit
<br/>
<br/>
added check cart code, now everythign should be in order
<br/>
<br/>
used GBAROM[0xFFFF] and searched for the value of 0xF9FF
<br/>
<br/>
if you decide to use any of this code, please pass along some credit to davr Grizzleyadams and me for providing this source<br/>_________________<br/><a href="http://www.myspace.com/knight0fdragonds" target="_blank">http://www.myspace.com/knight0fdragonds</a>
<br/>
<br/>
MK DS FC: Dragon 330772 075464 
<br/>
AC WW FC: Anthony SamsClub 1933-3433-9458 
<br/>
MPFH: Dragon 0215 4231 1206</span><span class="gensmall"><br/><br/>Last edited by knight0fdragon on Thu Jun 26, 2008 6:48 am; edited 2 times in total</span></div>    
</div>
<div class="post">
    <h4>#159151 - GrizzlyAdams - Thu Jun 26, 2008 6:13 am</h4>
    <div class="postbody"><span class="postbody">Basically at first glance we thought the two resistors were providing power thru the buttons, but they are actually for presence detection instead.
<br/>
<br/>
Take care when designing for the grip, reading / writing certain addresses or values can potentially cause damage to the ds hardware (I'm not entirely sure about the gba port logic, so better safe than sorry)
<br/>
<br/>
Just make sure you don't read or write to GBAROM[] addresses that have bits A19-A22 set, and don't write values to SRAM[] and you should be safe.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#159156 - Dark Knight ez - Thu Jun 26, 2008 9:48 am</h4>
    <div class="postbody"><span class="postbody">Nice. Seems to be really easy to get going in one's code. :)<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><a class="postlink" href="http://amplituds.drunkencoders.com" target="_blank">AmplituDS website</a></span></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
