<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Very strange error - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Very strange error</h2>
<div id="posts">
<div class="post">
    <h4>#153525 - TheMagnitude - Tue Apr 01, 2008 11:33 am</h4>
    <div class="postbody"><span class="postbody">Ok. These two lines of code that simply set the x and y value of an instance, work on no$gba but don't work on the hardware and instead seem to (delete/hide) all sprites.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">bulletIns-&gt;x = instances[i]-&gt;x + ship-&gt;spriteSize / 2 + 14 * cos(instances[i]-&gt;spriteAngle) - bullet-&gt;spriteSize / 2;
<br/>
bulletIns-&gt;y = instances[i]-&gt;y + ship-&gt;spriteSize / 2 + 14 * sin(instances[i]-&gt;spriteAngle) - bullet-&gt;spriteSize / 2;</td> </tr></table><span class="postbody">
<br/>
<br/>
*bulletIns and *instances[i] are members of class:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">class instance
<br/>
{
<br/>
   public:
<br/>
      instance(float, float, object*);
<br/>
      instance(object*);
<br/>
      ~instance();
<br/>
      object* parent;
<br/>
      float x,
<br/>
           y,
<br/>
           hspeed,
<br/>
           vspeed,
<br/>
           spriteAngle;
<br/>
      SpriteEntry* sprite;
<br/>
      bool wrap;
<br/>
      void updateSprite();
<br/>
      void step();
<br/>
      void setMotion(float, float);
<br/>
      void addForce(float, float);
<br/>
} * instances[SPRITE_COUNT];</td> </tr></table><span class="postbody">
<br/>
<br/>
and *bullet and *ship are members of class:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">class object
<br/>
{
<br/>
   public:
<br/>
      object() {};
<br/>
      object(SpriteEntry* s);
<br/>
      char spriteSize;
<br/>
      SpriteEntry* sprite;
<br/>
};</td> </tr></table><span class="postbody">
<br/>
<br/>
I think its something to do with data types because this works:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">bulletIns-&gt;x = 200;
<br/>
bulletIns-&gt;y = 200;</td> </tr></table><span class="postbody">
<br/>
<br/>
Is there something with the ARM processor that cant handle certain data type conversions or something?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153528 - simonjhall - Tue Apr 01, 2008 12:30 pm</h4>
    <div class="postbody"><span class="postbody">Why don't you try printing out the numbers you're working with, to see which ones differ? It's a bit hard to tell from just this!
<br/>
<br/>
Things to also remember
<br/>
a) there's no floating-point unit, all fp maths is done via an emulation library which is very slow but should work correctly
<br/>
b) sin and cos (and tan?) have special libnds versions which work differently, make sure you're not using them here else you'll get results that you don't expect
<br/>
c) the real hardware is always right, the emulators are the ones that aren't working correctly!<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153529 - elwing - Tue Apr 01, 2008 12:34 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>simonjhall wrote:</b></span></td> </tr> <tr> <td class="quote">c) the real hardware is always right, the emulators are the ones that aren't working correctly!</td> </tr></table><span class="postbody">
<br/>
lol, i dont' agree... sure if an emulator don't produce the same result as the hardware then the emulator is faulty, since the only goal of an emulator is to mimic the behaviour of the real hardware... but that don't mean the real hardware is always working right :D</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153531 - a128 - Tue Apr 01, 2008 1:20 pm</h4>
    <div class="postbody"><span class="postbody">Youre Sprites does not show up?
<br/>
<br/>
Maybe you use ATTR0_ROTSCALE and you did not initialized the rotation parameters?!
<br/>
<br/>
I had this problem yesterday...the Emulator NO$GBA displayed it...but the hardware not
<br/>
<br/>
NO$GBA 2.6a displayed the sprites simply because the emulatior does not support rotations for sprites?!!!!!!</span><span class="gensmall"><br/><br/>Last edited by a128 on Wed Apr 02, 2008 8:33 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#153532 - TheMagnitude - Tue Apr 01, 2008 1:29 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>simonjhall wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
b) sin and cos (and tan?) have special libnds versions which work differently, make sure you're not using them here</td> </tr></table><span class="postbody">
<br/>
<br/>
Make sure I dont use them here? Why shouldn't I use them here?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>a128 wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Youre Sprites does not show up?
<br/>
<br/>
Maybe you use ATTR0_ROTSCALE and you did not initialized the rotation parameters?!
<br/>
<br/>
I had this problem yesterday...the Emulator NO$GBA displayed it...but the hardware not</td> </tr></table><span class="postbody">
<br/>
I'm not sure what ATTR0_ROTSCALE is but I use
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void rotateSprite(SpriteRotation * spriteRotation, u16 angle) {
<br/>
    s16 s = SIN[angle &amp; SPRITE_ANGLE_MASK] &gt;&gt; 4;
<br/>
    s16 c = COS[angle &amp; SPRITE_ANGLE_MASK] &gt;&gt; 4;
<br/>
    // ROTATION MATRIX
<br/>
    spriteRotation-&gt;hdx = c;
<br/>
    spriteRotation-&gt;hdy = s;
<br/>
    spriteRotation-&gt;vdx = -s;
<br/>
    spriteRotation-&gt;vdy = c;
<br/>
}</td> </tr></table><span class="postbody">
<br/>
for rotation.
<br/>
<br/>
im new to DS dev so I could be wrong.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153533 - simonjhall - Tue Apr 01, 2008 1:35 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>TheMagnitude wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>simonjhall wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
b) sin and cos (and tan?) have special libnds versions which work differently, make sure you're not using them here</td> </tr></table><span class="postbody">
<br/>
<br/>
Make sure I dont use them here? Why shouldn't I use them here?</span></td> </tr></table><span class="postbody">The proper sin and cos functions take inputs in radians, but the libnds versions take a number from 0 to 512. So make sure you're using the version you think you are.
<br/>
<br/>
But yeah, just take it back a notch and make it a lot more simple, just so you can see exactly is going wrong.<br/>_________________<br/><span style="font-weight: bold"><a class="postlink" href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=simonjhall%40gmail%2ecom&amp;no_shipping=2&amp;no_note=1&amp;tax=0&amp;currency_code=GBP&amp;lc=GB&amp;bn=PP%2dDonationsBF&amp;charset=UTF%2d8" target="_blank">Big thanks to everyone who donated for Quake2</a></span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153534 - TheMagnitude - Tue Apr 01, 2008 1:36 pm</h4>
    <div class="postbody"><span class="postbody">Hey wait a minute, when I #include &lt;math.h&gt; I can use cos and sin, but theres no mention of cos and sin in math.h, does this mean Im including the math.h from the standard c library instead of the math.h from ndslib?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153540 - wintermute - Tue Apr 01, 2008 3:33 pm</h4>
    <div class="postbody"><span class="postbody">ndslib is obsolete, you're talking about libnds.
<br/>
<br/>
&lt;math.h&gt; is the standard header for libm included with devkitARM.
<br/>
<br/>
&lt;arm9/math.h&gt; is the libnds header which includes the DS hardware math functions. This file is included from &lt;nds.h&gt;<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153541 - TheMagnitude - Tue Apr 01, 2008 4:18 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">ndslib is obsolete, you're talking about libnds.
<br/>
<br/>
&lt;math.h&gt; is the standard header for libm included with devkitARM.
<br/>
<br/>
&lt;arm9/math.h&gt; is the libnds header which includes the DS hardware math functions. This file is included from &lt;nds.h&gt;</td> </tr></table><span class="postbody">Ah thankyou thats cleared a few things up :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153573 - silent_code - Wed Apr 02, 2008 4:52 am</h4>
    <div class="postbody"><span class="postbody">just five words: send code. ;^D</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153667 - TheMagnitude - Thu Apr 03, 2008 5:36 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>silent_code wrote:</b></span></td> </tr> <tr> <td class="quote">just five words: send code. ;^D</td> </tr></table><span class="postbody">I have deleted piece of code for now and Ill develop the same thing but with Fixed Point numbers and see if I still have the same problem, and if I do then Im lost and I will =)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
