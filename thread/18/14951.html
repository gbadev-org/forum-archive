<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>efs problem.... - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > efs problem....</h2>
<div id="posts">
<div class="post">
    <h4>#150184 - iprice - Wed Jan 30, 2008 11:11 pm</h4>
    <div class="postbody"><span class="postbody">I have a text file containing:
<br/>
<br/>
mons 0 5 0 0 -600 3000 0 0
<br/>
mons 1 1 1 31 600 6000 0 270
<br/>
mons 1 1 1 31 0 8000 0 270
<br/>
wait
<br/>
turn 45
<br/>
done
<br/>
<br/>
I want to read in the info and am using the following code:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void get_next(void)
<br/>
{
<br/>
char inst[4];
<br/>
int ii=0;
<br/>
<br/>
EFS_fread(&amp;inst, 1, sizeof(char)*4, file);
<br/>
while (inst[0] == 'm')
<br/>
{
<br/>
   EFS_fread(&amp;monsters[ii].type, 1, sizeof(int), file);
<br/>
   EFS_fread(&amp;monsters[ii].health, 1, sizeof(int), file);
<br/>
   EFS_fread(&amp;monsters[ii].action, 1, sizeof(int), file);
<br/>
   EFS_fread(&amp;monsters[ii].frame, 1, sizeof(int), file);
<br/>
   EFS_fread(&amp;monsters[ii].x, 1, sizeof(int), file);
<br/>
   EFS_fread(&amp;monsters[ii].y, 1, sizeof(int), file);
<br/>
   EFS_fread(&amp;monsters[ii].z, 1, sizeof(int), file);
<br/>
   EFS_fread(&amp;monsters[ii].rot, 1, sizeof(int), file);
<br/>
   EFS_fread(&amp;inst, 1, sizeof(char)*4, file);
<br/>
ii++;
<br/>
}
<br/>
if (inst[0] == 'd')
<br/>
{
<br/>
   EFS_fclose(file);
<br/>
   game_over = 1;
<br/>
   return;
<br/>
}
<br/>
else if (inst[0] == 'w')
<br/>
{
<br/>
   player.waiting_for_monsters = 1;
<br/>
   return;
<br/>
}
<br/>
else if (inst[0] == 't')
<br/>
{
<br/>
   EFS_fread(&amp;player.turn, 1, sizeof(int), file);
<br/>
}
<br/>
else if (inst[0] == 'a')
<br/>
{
<br/>
   EFS_fread(&amp;player.amount, 1, sizeof(float), file);
<br/>
}
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I know I can make it neater but hopefully you will get the idea.... is it the newline? the size of char string? any ideas?
<br/>
<br/>
Thanks</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#150192 - nce - Thu Jan 31, 2008 1:29 am</h4>
    <div class="postbody"><span class="postbody">hi,
<br/>
<br/>
you said "TEXT file" right ?
<br/>
<br/>
so reading :
<br/>
"6000" as a sizeof(int) is wrong.  it will read the ascii code for that ;)
<br/>
<br/>
you have to read : 4*sizeof(char) in a table 
<br/>
and convert this table with something like atoi; that function convert a string in a real integer :) 
<br/>
<br/>
parsing a text file is a little harder that parsing a hexadecimal file ;)<br/>_________________<br/>-jerome-</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#150223 - iprice - Thu Jan 31, 2008 5:24 pm</h4>
    <div class="postbody"><span class="postbody">I now have:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int my_atoi(char string[])
<br/>
{
<br/>
   int value = 0;
<br/>
   int sign = 1;
<br/>
   int string_pnt = 0;
<br/>
<br/>
   if (string[string_pnt] == '-')
<br/>
   {
<br/>
      sign = -1;
<br/>
      string_pnt++;
<br/>
   }
<br/>
<br/>
   while (string[string_pnt])
<br/>
   {
<br/>
      if ((string[string_pnt] &gt;= '0') &amp;&amp; (string[string_pnt] &lt;= '9'))
<br/>
         value = value * 10 + (string[string_pnt] - '0');
<br/>
      else
<br/>
         break;
<br/>
      string_pnt++;
<br/>
   }
<br/>
   return (sign * value);
<br/>
}
<br/>
<br/>
void get_next_update(void)
<br/>
{
<br/>
   char inst[8];
<br/>
   int ii;
<br/>
<br/>
   EFS_fread(&amp;inst, 1, sizeof(char)*5, file);
<br/>
   while (inst[0] == 'm')
<br/>
   {
<br/>
      for (ii = 0; ii &lt; max_monsters; ii++)
<br/>
         if (monsters[ii].health == 0)
<br/>
            break;
<br/>
<br/>
      for(aa=0;aa&lt;8;aa++)inst[aa]=' ';
<br/>
      EFS_fread(&amp;inst, 1, sizeof(char)*2, file);
<br/>
      monsters[ii].type = my_atoi(inst);
<br/>
      EFS_fread(&amp;inst, 1, sizeof(char)*2, file);
<br/>
      monsters[ii].health = my_atoi(inst);
<br/>
      EFS_fread(&amp;inst, 1, sizeof(char)*2, file);
<br/>
      monsters[ii].action = my_atoi(inst);
<br/>
      EFS_fread(&amp;inst, 1, sizeof(char)*2, file);
<br/>
      monsters[ii].frame = my_atoi(inst);
<br/>
      EFS_fread(&amp;inst, 1, sizeof(char)*5, file);
<br/>
      monsters[ii].x = my_atoi(inst);
<br/>
      EFS_fread(&amp;inst, 1, sizeof(char)*5, file);
<br/>
      monsters[ii].y = my_atoi(inst);
<br/>
      EFS_fread(&amp;inst, 1, sizeof(char)*5, file);
<br/>
      monsters[ii].z = my_atoi(inst);
<br/>
      EFS_fread(&amp;inst, 1, sizeof(char)*5, file);
<br/>
      monsters[ii].rot = my_atoi(inst);
<br/>
      EFS_fread(&amp;inst, 1, sizeof(char)*5, file);
<br/>
   }
<br/>
   if (inst[0] == 'd')
<br/>
   {
<br/>
      EFS_fclose(file);
<br/>
      game_over = 1;
<br/>
      return;
<br/>
   }
<br/>
   else if (inst[0] == 'w')
<br/>
   {
<br/>
      player.waiting_for_monsters = 1;
<br/>
      return;
<br/>
   }
<br/>
   else if (inst[0] == 't')
<br/>
   {
<br/>
      EFS_fread(&amp;inst, 1, sizeof(char)*2, file);
<br/>
      player.turn = my_atoi(inst);
<br/>
   }
<br/>
   else if (inst[0] == 'a')
<br/>
   {
<br/>
      EFS_fread(&amp;inst, 1, sizeof(char)*2, file);
<br/>
      player.amount = (float)my_atoi(inst);
<br/>
   }
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
but it still isn't quite right..... my debug isn't working so I can't display the value in the string or varible to screen  :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#150231 - josath - Thu Jan 31, 2008 8:34 pm</h4>
    <div class="postbody"><span class="postbody">1. get your debug print working first.
<br/>
2. why are you using my_atoi() instead of the built-in atoi()?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#150234 - iprice - Thu Jan 31, 2008 9:19 pm</h4>
    <div class="postbody"><span class="postbody">I have got it working.... I needed to allow for spaces in the string and for return characters. I used my own atoi so I knew what it was doing....
<br/>
<br/>
I have now got extern scripting working so my 3d rail shooter is looking good. I'll hopefully release a test version later this week......
<br/>
<br/>
:)
<br/>
<br/>
happy now....</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
