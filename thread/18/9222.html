<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Question concerning sprites. - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > Question concerning sprites.</h2>
<div id="posts">
<div class="post">
    <h4>#79262 - Dark Knight ez - Wed Apr 12, 2006 3:31 pm</h4>
    <div class="postbody"><span class="postbody">Hey everybody. Yet another question. This time concerning sprites.
<br/>
<br/>
I've been checking out several tutorials/examples which use sprites, but they do not give enough information for me to fully comprehend it all. Why some specific values are used, amongst other things.
<br/>
<br/>
Using Patater's guide, the sprite initializing (palette and graphics) seems to crash (or at least stay stuck therein for a VERY long time - didn't have the patience to check).
<br/>
To be more precise, this seems to happen in the for-loop which addresses SPRITE_GFX_SUB. (Note that I used '0' as gfxID in the code by commenting that piece out.)
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">    //copy in the sprite palettes
<br/>
    dmaCopy(sprite_pal_bin, (uint16 *)SPRITE_PALETTE_SUB, sprite_pal_bin_size); //size of data to copy
<br/>
    //copy the sprite grahics in obj graphics mem
<br/>
    for(unsigned int i=0; i&lt;font_8x8_digits_bin_size &lt;&lt; 16; i++)
<br/>
        SPRITE_GFX_SUB[/*font_8x8_gfxID * 16 +*/ i] = ((uint16*)font_8x8_digits_bin)[i];</td> </tr></table><span class="postbody">
<br/>
Now, my question is, why is there in the for-loop a 16(!) bit-shift to the left and if that's not the fault here, what else could it be?
<br/>
<br/>
Oh, one remark which might affect things:
<br/>
The graphics I'm using (font_8x8_digits_bin) was actually a 88*8 picture. Would I be right in assuming that once that's loaded in properly, I could just pick out the x-th tile by using x as gfxID? (The picture contains all the digits and a ':' symbol in a row.)
<br/>
<br/>
Thanks in advance for any help.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#79418 - Dark Knight ez - Thu Apr 13, 2006 4:16 pm</h4>
    <div class="postbody"><span class="postbody">Adjusted the for-loop to be this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">for(unsigned int i=0; i&lt;font_8x8_digits_bin_size &lt;&lt; 2; i++) 
<br/>
        SPRITE_GFX_SUB[i] = ((uint16*)font_8x8_digits_bin)[i];</td> </tr></table><span class="postbody">
<br/>
<br/>
Having replaced &lt;&lt; 16 with &lt;&lt; 2, since that would make more sense to me. (Effectively cutting the for-loop in half, since two bytes are written each time instead of one.) It seems to me the tutorial is just wrong on that one, but I can see why the wrong value was used (16 bits = 2 bytes).
<br/>
<br/>
Now at least the first tile is displayed properly. The other tiles seem almost random (using attribute 2 to choose the xth tile). It might be a problem with converting the picture, I don't know.
<br/>
Using gfx2gba, would this be the correct way to convert the 88x8 pcx file?
<br/>
gfx2gba.exe in.pcx out.bin -8 -z 256 -b -p out_pal.bin
<br/>
(At least the palette seems to be okay this way)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#79558 - Dark Knight ez - Fri Apr 14, 2006 9:37 am</h4>
    <div class="postbody"><span class="postbody">It seems I needed to use 2x as gfxID for the xth tile. It's fixed now.
<br/>
This because I'm using 256 colours, which takes up twice as much space for one tile as in the other case.
<br/>
Really wished tutorials would be more in depth on this aspect.</span><span class="gensmall"><br/><br/>Last edited by Dark Knight ez on Fri Apr 14, 2006 7:49 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#79636 - Dark Knight ez - Fri Apr 14, 2006 7:48 pm</h4>
    <div class="postbody"><span class="postbody">For future reference, I made a mistake with this as well (although the bugs were not obvious at first). Not only was the bit-shift value wrong -- it should be shifted by 1 bit which means the size is altered by a factor of two -- also the direction was completely wrong. It should be dimished by a factor of two, not enlarged.
<br/>
<br/>
So this old code:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">for(unsigned int i=0; i&lt;font_bin_size &lt;&lt; 16; i++) 
<br/>
        SPRITE_GFX_SUB[i] = ((uint16*)font_bin)[i];</td> </tr></table><span class="postbody">
<br/>
Becomes this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">for(unsigned int i=0; i&lt;font_bin_size &gt;&gt; 1; i++) 
<br/>
        SPRITE_GFX_SUB[i] = ((uint16*)font_bin)[i];</td> </tr></table><span class="postbody">
<br/>
<br/>
Meaning Patater's tutorial was also double wrong on this aspect.
<br/>
Hope this helps out others who experience problems using sprites.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#92639 - mhackman - Fri Jul 14, 2006 8:22 am</h4>
    <div class="postbody"><span class="postbody">For a custom font I have a 32x32 sprite table with 96 items. The picture size is 32x3072. The picture shows: ! " # $ % &amp; ' ( ) * + , - . / 0 1 2 3 4 5 6 7 8 9 : ; &lt; = &gt; ? @ A B C D E.......etc....well you get the picture ;)
<br/>
I am using this code:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
dmaCopy(palette_bin, SPRITE_PALETTE_SUB, 256*2);
<br/>
dmaCopy(font_bin, SPRITE_GFX_SUB, 32*3072);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I know that there are a lot of other code possibilities like : 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   for(i = 0; i &lt; font_bin_size; i++) {
<br/>
      SPRITE_GFX_SUB[i] = (font_bin[i*2]) | ((font_bin[i*2+1])&lt;&lt;8);
<br/>
   }
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
or 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   for(i = 0; i &lt; font_bin_size &lt;&lt; 1; i++) {
<br/>
      SPRITE_GFX_SUB[i] = ((uint16*)font_bin)[i];
<br/>
   }
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
etc....it's all works. The problem is that in Dualis OAM view I only get to see these characters: ! " # $ % &amp; ' ( ) * + , - . / 0 1 2 3 4 5 6 7 8 9 : ; &lt; = &gt; ?. After that the tiles will repeat.
<br/>
<br/>
I am using gfxID 0, 32, 64, 98, etc... ( += 32 )
<br/>
<br/>
The bins are created with: gfx2gba myfont.bmp font.bin -8 -z 256 -b -p palette.bin
<br/>
<br/>
Is there a limit of 32 tiles for 32x32 that I can load??</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93289 - Dark Knight ez - Tue Jul 18, 2006 10:58 am</h4>
    <div class="postbody"><span class="postbody">First of all, dmaCopy might be fast, but it tends to make things crash.
<br/>
Even when it works on your own set-up, on others it could create a crash or other unwanted behaviour.
<br/>
<br/>
Having said that, in what VRAM bank are you trying to put your sprites? Is it big enough to hold it all? You will want to use a VRAM bank which is equal or larger than 96 kb in size. (see <a href="http://www.bottledlight.com/ds/index.php/Video/Modes" target="_blank">http://www.bottledlight.com/ds/index.php/Video/Modes</a>)
<br/>
Hope that helps.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
