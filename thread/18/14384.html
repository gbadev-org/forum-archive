<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Problem after upgrading to devkitARM 21 - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Problem after upgrading to devkitARM 21</h2>
<div id="posts">
<div class="post">
    <h4>#143570 - Peter - Tue Oct 23, 2007 10:53 pm</h4>
    <div class="postbody"><span class="postbody">I just upgraded through the automatic upater to devkitarm 21. Now every example (libnds, or my own project) I compile does only work on the actual hardware, but not in no$gba or ideas anymore.
<br/>
<br/>
Anyone with the same problem or is it just my setup (windows xp, 32bit)  for whatever reason?<br/>_________________<br/>Kind Regards,
<br/>
Peter</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143572 - tepples - Tue Oct 23, 2007 10:56 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Peter wrote:</b></span></td> </tr> <tr> <td class="quote">I just upgraded through the automatic upater to devkitarm 21. Now every example (libnds, or my own project) I compile does only work on the actual hardware, but not in no$gba or ideas anymore.</td> </tr></table><span class="postbody">
<br/>
If a program works on a Nintendo DS but fails on an emulator, it is because of a defect in the emulator. Wintermute does not design devkitARM or libnds to work around defects in emulators.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143576 - Lick - Wed Oct 24, 2007 12:21 am</h4>
    <div class="postbody"><span class="postbody">This is a serious problem since many developers test on emulators before testing on hardware. Though I do believe the problem lies with the emulators, so what can we, simple developers, do but wait?
<br/>
<br/>
BTW, it seems that DeSmuME (0.7.3) successfully runs the examples.<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143578 - tepples - Wed Oct 24, 2007 12:39 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lick wrote:</b></span></td> </tr> <tr> <td class="quote">so what can we, simple developers, do but wait?</td> </tr></table><span class="postbody">
<br/>
I chose to only update MSYS and PN today, and then wait to update devkitARM and libnds until finishing the release cycle for each of the projects I maintain. By then the emulators should have caught up.
<br/>
<br/>
If your program is 2D-heavy (not 3D-heavy or CPU-heavy), make a port to Game Boy Advance; emulators for that are mature. Or make a port to SDL or Allegro and develop your game logic on the PC.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143592 - Peter - Wed Oct 24, 2007 6:21 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">If a program works on a Nintendo DS but fails on an emulator, it is because of a defect in the emulator. Wintermute does not design devkitARM or libnds to work around defects in emulators.</td> </tr></table><span class="postbody">
<br/>
Well, I just wanted to know if this occurs to other people too or just my setup which is somehow broken. I didn't say it's devkitarm's fault though.<br/>_________________<br/>Kind Regards,
<br/>
Peter</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143594 - wintermute - Wed Oct 24, 2007 6:26 am</h4>
    <div class="postbody"><span class="postbody">That's actually the one thing I didn't check before rolling the releases. I've broken my own no$gba too so you're definitely not the only one.
<br/>
<br/>
I'll have a dig through and see what changes caused it &amp; let Martin know. It shouldn't be hard to find, no$ was running most of the examples just fine on Sunday so it's something very recent. This sort of thing is almost always some feature of the hardware that hasn't been emulated yet.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143604 - mml - Wed Oct 24, 2007 12:06 pm</h4>
    <div class="postbody"><span class="postbody">Ooh, 21 is out?!  I know what I'm doing this weekend. :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143614 - Peter - Wed Oct 24, 2007 5:58 pm</h4>
    <div class="postbody"><span class="postbody">Since I can't wait,I hacked together a command line applicaton that patches the output .nds image from devkitarm r21 to make it compatible with no$gba 2.5a.
<br/>
<br/>
I don't garantee that it works with every .nds file and I also don't know what I broke due to the changed instructions (some SPI stuff was it), but the examples i compiled on my computer worked fine after patching in no$.
<br/>
<br/>
So use at your own risk of course :)
<br/>
<span style="font-style: italic">download with source</span>
<br/>
EDIT: download link removed.<br/>_________________<br/>Kind Regards,
<br/>
Peter</span><span class="gensmall"><br/><br/>Last edited by Peter on Thu Oct 25, 2007 6:28 am; edited 2 times in total</span></div>    
</div>
<div class="post">
    <h4>#143617 - Lino - Wed Oct 24, 2007 6:54 pm</h4>
    <div class="postbody"><span class="postbody">Does it work? Is it the incriminated asm code? If yes thanks again :).
<br/>
<br/>
Can you insert the link in your site? Please?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143639 - Arialia - Wed Oct 24, 2007 10:50 pm</h4>
    <div class="postbody"><span class="postbody">Thanks a lot Peter your program works fine :)
<br/>
<br/>
i had test someone of examples :
<br/>
<br/>
16bit_color_bmp.nds   -&gt; no$gba says me "no$gba needs a copy of the original GBA BIOS to execute BIOS Sound functions "
<br/>
Mixed_Text_3D.nds     -&gt; ok
<br/>
Picking.nds     -&gt; ok
<br/>
Toon_Shading.nds     -&gt; ok
<br/>
Watch.nds -&gt; don't work multiple errors to difficult to describe .. sorry
<br/>
<br/>
[Edit]
<br/>
remove batch code<br/>_________________<br/><a class="postlink" href="http://arialia.dev-fr.org/" target="_blank">My Dev  blog </a>   - -  <a class="postlink" href="http://www.playeradvance.org/forum/showthread.php?t=4813" target="_blank">Tutorial  on libfat in french</a> -- <a class="postlink" href="http://www.playeradvance.org/forum/showthread.php?t=5519" target="_blank">DSPhoto</a></span><span class="gensmall"><br/><br/>Last edited by Arialia on Thu Oct 25, 2007 7:03 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#143641 - wintermute - Wed Oct 24, 2007 11:41 pm</h4>
    <div class="postbody"><span class="postbody">Personally, I'd prefer it a great deal if this sort of thing did not become prevalent. I fail to understand why people feel the need to produce nasty little tools which encourage the treatment of symptoms rather than looking for the cause. As a toolchain maintainer, this sort of thing makes my life hell - I've lost count of the number of support issues I've dealt with over the years which turned out to be caused by the use of a tool or some other nasty little hack that has long since outlived it's period of "usefulness"
<br/>
<br/>
The problem in this case is a piece of initialisation code in the arm7 core used to put the sound hardware into a known state. It seems that this code breaks the emulators and <span style="font-weight: bold">should</span> be fixed on their end.
<br/>
<br/>
As a temporary workaround you can rebuild the default arm7 core without the offending code. ndstool now uses the basic.arm7 file found in the libnds folder rather than embedded code to make it easier to replace.
<br/>
<br/>
The basicARM7 folder of the libnds source contains the relevant code. Just comment the line that reads
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   writePowerManagement(PM_CONTROL_REG, ( readPowerManagement(PM_CONTROL_REG) &amp; ~PM_SOUND_MUTE ) | PM_SOUND_AMP );
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
and recompile. This code is also found in the combined template so if you're using that then modify it too.
<br/>
<br/>
If you have trouble there's a pre-built basic.arm7 at <a href="http://devkitpro.sourceforge.net/basic.arm7" target="_blank">http://devkitpro.sourceforge.net/basic.arm7</a> - just copy it into the libnds folder, replacing the one that's already there.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143676 - Peter - Thu Oct 25, 2007 6:23 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">As a toolchain maintainer, this sort of thing makes my life hell - I've lost count of the number of support issues I've dealt with over the years which turned out to be caused by the use of a tool or some other nasty little hack that has long since outlived it's period of "usefulness"</td> </tr></table><span class="postbody">
<br/>
This was not my goal of course. I have removed the download link.<br/>_________________<br/>Kind Regards,
<br/>
Peter</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143679 - Arialia - Thu Oct 25, 2007 6:55 am</h4>
    <div class="postbody"><span class="postbody">Thanks Wintermute so me too i don't like using hack
<br/>
<br/>
I prefer your soluce but if this hack had been a little help to understand what happened for no$gba and other emulators it was a good hack :)
<br/>
<br/>
Thanks again Peter :)
<br/>
<br/>
Sorry for my bad english :/<br/>_________________<br/><a class="postlink" href="http://arialia.dev-fr.org/" target="_blank">My Dev  blog </a>   - -  <a class="postlink" href="http://www.playeradvance.org/forum/showthread.php?t=4813" target="_blank">Tutorial  on libfat in french</a> -- <a class="postlink" href="http://www.playeradvance.org/forum/showthread.php?t=5519" target="_blank">DSPhoto</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
