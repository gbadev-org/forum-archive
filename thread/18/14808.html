<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>C++ code on ARM7? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > C++ code on ARM7?</h2>
<div id="posts">
<div class="post">
    <h4>#148614 - Dwedit - Mon Jan 07, 2008 10:25 pm</h4>
    <div class="postbody"><span class="postbody">How do I add c++ code to arm7 without the default C++ libraries eating up all the IWRAM?<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#148615 - wintermute - Mon Jan 07, 2008 10:28 pm</h4>
    <div class="postbody"><span class="postbody">Don't use the C++ default libraries?
<br/>
<br/>
As I stated <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?p=148469#148469" target="_blank">here</a> just switching to C++ compilation does <span style="font-weight: bold">not</span> automatically add overhead.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#148618 - elwing - Mon Jan 07, 2008 11:00 pm</h4>
    <div class="postbody"><span class="postbody">as long as you are doing the same thing and you remove the useless link C++ won't be worst than C, now it's sure that if you try messing with object and template everywhere that won't be great...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#148619 - Dwedit - Mon Jan 07, 2008 11:04 pm</h4>
    <div class="postbody"><span class="postbody">How do I force the linker to exclude the standard libraries so I can see where the link errors would form?<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#148622 - Dwedit - Tue Jan 08, 2008 12:26 am</h4>
    <div class="postbody"><span class="postbody">I'm looking at the .map file, and the c++ linker added ~55k of crap.
<br/>
I see some stuff that looks like it's related to exception handling, and rtti, despite everything being compiled with -fno-rtti -fno-exceptions<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#148623 - tepples - Tue Jan 08, 2008 12:28 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dwedit wrote:</b></span></td> </tr> <tr> <td class="quote">How do I force the linker to exclude the standard libraries so I can see where the link errors would form?</td> </tr></table><span class="postbody">
<br/>
I'll let someone who knows more than I do about GCC internals answer your question:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>In <a class="postlink" href="http://www.network-theory.co.uk/docs/gccintro/gccintro_54.html" target="_blank"><span style="font-style: italic">An Introduction to GCC</span></a>, Brian J. Gough wrote:</b></span></td> </tr> <tr> <td class="quote">Note that programs using C++ object files must always be linked with g++, in order to supply the appropriate C++ libraries. Attempting to link a C++ object file with the C compiler gcc will cause "undefined reference" errors for C++ standard library functions</td> </tr></table><span class="postbody">
<br/>
You might still have problems with a "__gxx_personality" or something. Pages that I found with Google suggest using gcc with -lsupc++ to link in language features without linking in iostream/STL.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#148627 - Dwedit - Tue Jan 08, 2008 12:55 am</h4>
    <div class="postbody"><span class="postbody">Linking with gcc instead of g++, I get "undefined reference to floor".
<br/>
I think I'll just steal some implementation of "floor" from somewhere...
<br/>
<br/>
Edit: Linking with g++, and supc++ works!  No more c++ crap.  4k of code added from libraries, instead of 55k.
<br/>
<br/>
Edit: Size bounces back up the instant you add any global instances of classes...<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#148630 - wintermute - Tue Jan 08, 2008 1:40 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dwedit wrote:</b></span></td> </tr> <tr> <td class="quote">Linking with gcc instead of g++, I get "undefined reference to floor".
<br/>
I think I'll just steal some implementation of "floor" from somewhere...
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
That's because g++ links the math library ( -lm ) by default &amp; gcc doesn't. Really you should avoid float if at all possible.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Edit: Linking with g++, and supc++ works!  No more c++ crap.  4k of code added from libraries, instead of 55k.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Any chance of seeing the code - things shouldn't be linked in if you don't reference them.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Edit: Size bounces back up the instant you add any global instances of classes...</td> </tr></table><span class="postbody">
<br/>
<br/>
new is also rather heavier than straight malloc.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#148634 - kusma - Tue Jan 08, 2008 2:14 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dwedit wrote:</b></span></td> </tr> <tr> <td class="quote">I see some stuff that looks like it's related to exception handling, and rtti, despite everything being compiled with -fno-rtti -fno-exceptions</td> </tr></table><span class="postbody">
<br/>
Are you sure the files actually got compiled with those flags? It's easy add things to CFLAGS instead of CXXFLAGS or something stupid when debugging, you know ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#148639 - tepples - Tue Jan 08, 2008 3:46 am</h4>
    <div class="postbody"><span class="postbody">Unlike malloc, which returns NULL on failure, <a class="postlink" href="http://www.informit.com/guides/content.aspx?g=cplusplus&amp;seqNum=170" target="_blank">new throws an exception</a>. To get malloc style behavior, use new&lt;std::nothrow&gt; (found in #include &lt;new&gt;) instead of plain new. Another question: Are the <a class="postlink" href="http://gcc.gnu.org/ml/gcc/2004-10/msg00127.html" target="_blank">libraries throwing</a>?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#148643 - wintermute - Tue Jan 08, 2008 5:08 am</h4>
    <div class="postbody"><span class="postbody">CXXFLAGS extends CFLAGS in the templates &amp; examples.
<br/>
<br/>
The C++ libraries are build with exceptions enabled - that's one of the reasons that new is heavier than malloc ( new(nothrow) is in the same source file so unfortunately that doesn't help much) so you'll see them when you some of the C++ standard library.
<br/>
<br/>
One of the things on my long term TODO list is "investigate standard library exception removal" but I'm not sure how feasible that might be.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#148655 - kusma - Tue Jan 08, 2008 10:17 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">CXXFLAGS extends CFLAGS in the templates &amp; examples.
<br/>
</td> </tr></table><span class="postbody">
<br/>
Oh, that's SO wrong, man :)
<br/>
<br/>
I don't use the template-stuff myself since, well, the makefile kinda sucks. Wrong use of variables, auto-inclusion of every single source in the source tree, tricky to build anything else than the default goal without changing the makefile etc.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#148657 - nipil - Tue Jan 08, 2008 12:35 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>kusma wrote:</b></span></td> </tr> <tr> <td class="quote"><span style="font-weight: bold">auto-inclusion of every single source in the source tree</span></td> </tr></table><span class="postbody">Might be a stupid trick, but the default template doesn't include anything in sub-directories. So sub-folders in source, data, include and gfx are not explored when built (at least in the template makefile i have)
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>kusma wrote:</b></span></td> </tr> <tr> <td class="quote"><span style="font-weight: bold">Wrong use of variables</span></td> </tr></table><span class="postbody">What do you mean with this ?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#148658 - Sunray - Tue Jan 08, 2008 12:56 pm</h4>
    <div class="postbody"><span class="postbody">You can also try -fno-threadsafe-statics</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#148662 - kusma - Tue Jan 08, 2008 1:48 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>nipil wrote:</b></span></td> </tr> <tr> <td class="quote">Might be a stupid trick, but the default template doesn't include anything in sub-directories. So sub-folders in source, data, include and gfx are not explored when built (at least in the template makefile i have)
<br/>
</td> </tr></table><span class="postbody">
<br/>
Thanks, but I prefer writing my own clean makefiles instead of hacking around other people's design-choices. Especially since make ain't that hard to deal with ween you're experienced.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">What do you mean with this ?</td> </tr></table><span class="postbody">
<br/>
preprocessor flags are put in the CFLAGS-variable (and no CPPFLAGS-variable usage in the implicit rules for c/c++ sources), CFLAGS included in CXXFLAGS for one. I'd much rather see the makefiles use the pre-defined COMPILE.c-variable for compiling .c-files, for instance.
<br/>
<br/>
Oh, and by the way, by "wrong" I don't mean defect or anything like that - the makefiles does work and are correct, I mean wrong according to established GNU make standards. It makes them harder to modify for people who are not familiar with the devkitPro-way of doing it. I reccomend <a class="postlink" href="http://oreilly.com/catalog/make3/" target="_blank">Managing Projects with GNU Make</a> (available at <a class="postlink" href="http://books.google.co.uk/books?id=rL4GthWj9kcC&amp;dq=managing+projects+with+gnu+make&amp;pg=PP1&amp;ots=6zYh4Gs7-6&amp;sig=XuwQoHWQg0QKVPJFAOZ8vWWKNmU&amp;hl=en" target="_blank">Google Books</a> if you're poor) for anyone wanting to polish their makefile-skills.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#148695 - Echo49 - Tue Jan 08, 2008 11:37 pm</h4>
    <div class="postbody"><span class="postbody">Out of curiosity, what are the pros and cons in choosing to use C++ rather than C?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#148705 - Abcd1234 - Wed Jan 09, 2008 3:07 am</h4>
    <div class="postbody"><span class="postbody">EDIT:  I'm just deleting this whole thing... it's better written elsewhere.</span><span class="gensmall"><br/><br/>Last edited by Abcd1234 on Wed Jan 09, 2008 3:42 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#148706 - sajiimori - Wed Jan 09, 2008 3:15 am</h4>
    <div class="postbody"><span class="postbody">There are lots of threads on that question.  Let's not make another one.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#148707 - Abcd1234 - Wed Jan 09, 2008 3:41 am</h4>
    <div class="postbody"><span class="postbody">Geez, I see what you mean... I've never bothered to check out the forums other than the NDS-specific ones, and lo and behold, there's a whole forum specifically on C/C++, which is chock full of... colourful... threads on C++. :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#149129 - Echo49 - Tue Jan 15, 2008 8:03 pm</h4>
    <div class="postbody"><span class="postbody">What about specifically for the DS? Would, for example, the overhead from exception handling or creating a lot of objects be too large for time sensitive code?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#149133 - wintermute - Tue Jan 15, 2008 8:51 pm</h4>
    <div class="postbody"><span class="postbody">If you're talking about the ARM7 then, personally, I just wouldn't use C++ code at all.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#149138 - sajiimori - Tue Jan 15, 2008 10:29 pm</h4>
    <div class="postbody"><span class="postbody">Again, there are already threads about that question.  Gigantic ones.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
