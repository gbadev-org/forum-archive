<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Problems with glEnable/glDisable - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Problems with glEnable/glDisable</h2>
<div id="posts">
<div class="post">
    <h4>#66857 - ficedula - Fri Jan 13, 2006 10:33 pm</h4>
    <div class="postbody"><span class="postbody">I seem to be having problems turning polygon outlining <span style="font-style: italic">off</span> ... although I haven't noticed before since I'd always rendered everything with polyid 1 before, hence no boundaries and no outlines ;)
<br/>
<br/>
Writing to GFX_CONTROL directly is fine, but using glEnable/glDisable seems to screw up majorly. Unless I've misunderstood what it's supposed to do totally, the following code from libnds seems to be wrong...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
//---------------------------------------------------------------------------------
<br/>
void glEnable(int bits) {
<br/>
//---------------------------------------------------------------------------------
<br/>
   enable_bits |= bits | (GL_TEXTURE_2D|GL_TOON_HIGHLIGHT|GL_OUTLINE|GL_ANTIALIAS);
<br/>
   GFX_CONTROL = enable_bits;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Have I missed something, or does this really enable <span style="font-style: italic">everything</span> whenever I call glEnable? I mean, it does enable what I asked for, but I don't want everything else too... ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#66912 - HyperHacker - Sat Jan 14, 2006 10:35 am</h4>
    <div class="postbody"><span class="postbody">I haven't actually used it, but it looks like it should be "enable_bits |= bits <span style="font-weight: bold">&amp;</span> (GL_TEXTURE...".</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#67136 - duencil - Sun Jan 15, 2006 8:35 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">I haven't actually used it, but it looks like it should be "enable_bits |= bits <span style="font-weight: bold">&amp;</span> (GL_TEXTURE...".</td> </tr></table><span class="postbody">
<br/>
That sounds likely, though it depends what the intention was. If its limiting what you can set with glEnable, then you are correct, although some other flags need to be included (GL_ALPHA_TEST|GL_BLEND). If the intention is to prevent you turning certain bits off  -- seeing GL_TEXTURE_2D there might suggest that, it might be correct as it is, although some flags should be removed (GL_TOON_HIGHLIGHT|GL_OUTLINE|GL_ANTIALIAS) and others added ((1&lt;&lt;13) | (1&lt;&lt;14))</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112104 - Goosey - Wed Dec 13, 2006 7:27 am</h4>
    <div class="postbody"><span class="postbody">Sorry to dig up this old topic, but seeing as how this is still an issue I figured I would post my fix.
<br/>
<br/>
I have submitted a patch to devkitPro (download <a class="postlink" href="http://sourceforge.net/tracker/index.php?func=detail&amp;aid=1614531&amp;group_id=114505&amp;atid=668553" target="_blank">here</a>)
<br/>
<br/>
For temporary use I put in these functions into my engine:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
const u16 kConstBits   = GL_TEXTURE_2D;// | (1&lt;&lt;13) | (1&lt;&lt;14);
<br/>
static u16 enable_bits   = kConstBits;
<br/>
<br/>
void glEnableFIX(int bits) 
<br/>
{
<br/>
   enable_bits |= bits | kConstBits;
<br/>
   GFX_CONTROL = enable_bits;
<br/>
}
<br/>
<br/>
void glDisableFIX(int bits) 
<br/>
{
<br/>
   enable_bits &amp;= ~(bits | kConstBits);
<br/>
   GFX_CONTROL = enable_bits;
<br/>
}
<br/>
<br/>
void glResetFIX(void) 
<br/>
{
<br/>
   while (GFX_STATUS &amp; (1&lt;&lt;27)); // wait till gfx engine is not busy
<br/>
<br/>
   // Clear the FIFO
<br/>
   GFX_STATUS |= (1&lt;&lt;29);
<br/>
<br/>
   // Clear overflows for list memory
<br/>
   GFX_CONTROL = enable_bits | ((1&lt;&lt;12) | (1&lt;&lt;13)) | GL_TEXTURE_2D;
<br/>
   glResetMatrixStack();
<br/>
<br/>
   GFX_TEX_FORMAT = 0;
<br/>
   GFX_POLY_FORMAT = 0;
<br/>
<br/>
   glMatrixMode(GL_PROJECTION);
<br/>
   glIdentity();
<br/>
<br/>
   glMatrixMode(GL_MODELVIEW);
<br/>
   glIdentity();
<br/>
}
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
This fixes the issue of glEnable enabling things you don't request, glDisable disabling things you don't request, and glReset losing your settings when called. 
<br/>
<br/>
I haven't given this too robust a testing, so use with caution, but it seems to work so far...</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
