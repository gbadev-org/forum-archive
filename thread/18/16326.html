<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>[Rebootlib] Problem with new libfat. - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > [Rebootlib] Problem with new libfat.</h2>
<div id="posts">
<div class="post">
    <h4>#165724 - hacker013 - Mon Jan 05, 2009 3:31 pm</h4>
    <div class="postbody"><span class="postbody">The code from rebootlib needs the var _io_dldi . But this var doesn't exists anymore with the new libfat so does anybody now how to fix this?<br/>_________________<br/><a class="postlink" href="http://imetal.nl/" target="_blank">Website / Blog</a>
<br/>
<br/>
Let the nds be with you.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165726 - Dwedit - Mon Jan 05, 2009 4:31 pm</h4>
    <div class="postbody"><span class="postbody">The symbol changed its name, and moved back 0x60 bytes.
<br/>
The equate is now named "_io_dldi_stub".  To get "_io_dldi" from that, add 0x60 bytes to the address.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165732 - hacker013 - Mon Jan 05, 2009 6:01 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dwedit wrote:</b></span></td> </tr> <tr> <td class="quote">The symbol changed its name, and moved back 0x60 bytes.
<br/>
The equate is now named "_io_dldi_stub".  To get "_io_dldi" from that, add 0x60 bytes to the address.</td> </tr></table><span class="postbody">
<br/>
<br/>
i get also an error that _io_dldi_stub not exists. maybe you can give some code.
<br/>
<br/>
EDIT:
<br/>
<br/>
this is my code:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">extern const u32* _io_dldi_stub;
<br/>
const u32* _io_dldi = _io_dldi_stub + 0x60;</td> </tr></table><span class="postbody">
<br/>
<br/>
Krijg nu deze error: initializer element is not constant.<br/>_________________<br/><a class="postlink" href="http://imetal.nl/" target="_blank">Website / Blog</a>
<br/>
<br/>
Let the nds be with you.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165733 - Maxxie - Mon Jan 05, 2009 6:20 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>hacker013 wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
this is my code:
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">extern const u32* _io_dldi_stub;
<br/>
const u32* _io_dldi = _io_dldi_stub + 0x60;</td> </tr></table><span class="postbody">
<br/>
<br/>
Krijg nu deze error: initializer element is not constant.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
uhm not on the actual problem, but your offset is way off.
<br/>
The 0x60 add, gets 0x60*sizeof(u32) bytes forward (pointer arithmetic with a known type).<br/>_________________<br/><a class="postlink" href="http://nintendods.desperate-programmers.com/doku.php?id=wireless_io_map" target="_blank">Trying  to bring more detail into understanding the wireless hardware</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165735 - hacker013 - Mon Jan 05, 2009 6:24 pm</h4>
    <div class="postbody"><span class="postbody">thx for notice me on that bug but has anyone a fix for that error?<br/>_________________<br/><a class="postlink" href="http://imetal.nl/" target="_blank">Website / Blog</a>
<br/>
<br/>
Let the nds be with you.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165739 - samel - Mon Jan 05, 2009 6:49 pm</h4>
    <div class="postbody"><span class="postbody">May be
<br/>
<br/>
const u32* _io_dldi = (u32*)(((char*)_io_dldi_stub) + 0x60);</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165740 - hacker013 - Mon Jan 05, 2009 6:50 pm</h4>
    <div class="postbody"><span class="postbody">then I get still the same error<br/>_________________<br/><a class="postlink" href="http://imetal.nl/" target="_blank">Website / Blog</a>
<br/>
<br/>
Let the nds be with you.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165741 - samel - Mon Jan 05, 2009 6:54 pm</h4>
    <div class="postbody"><span class="postbody">remove const</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165742 - hacker013 - Mon Jan 05, 2009 7:01 pm</h4>
    <div class="postbody"><span class="postbody">ok, so then i have this code
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
extern u32* _io_dldi_stub;
<br/>
u32* _io_dldi = _io_dldi_stub + 0x60*sizeof(u32);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
and still the same error.<br/>_________________<br/><a class="postlink" href="http://imetal.nl/" target="_blank">Website / Blog</a>
<br/>
<br/>
Let the nds be with you.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165744 - samel - Mon Jan 05, 2009 7:20 pm</h4>
    <div class="postbody"><span class="postbody">As i understand what Maxxie &amp; Dwedit write &amp;&amp; as i say before
<br/>
<br/>
const u32* _io_dldi = (u32*)(((char*)_io_dldi_stub) + 0x60);
<br/>
<br/>
not
<br/>
<br/>
u32* _io_dldi = _io_dldi_stub + 0x60*sizeof(u32);
<br/>
<br/>
but may be i'm wrong [ 8p ].
<br/>
<br/>
For the other error ... dunno, may be you can post the full error?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165745 - hacker013 - Mon Jan 05, 2009 7:27 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>samel wrote:</b></span></td> </tr> <tr> <td class="quote">remove const</td> </tr></table><span class="postbody">
<br/>
<br/>
so i removed const and the error what I post a few posts back was the full error. And the error isn't changed.<br/>_________________<br/><a class="postlink" href="http://imetal.nl/" target="_blank">Website / Blog</a>
<br/>
<br/>
Let the nds be with you.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165748 - elhobbs - Mon Jan 05, 2009 7:39 pm</h4>
    <div class="postbody"><span class="postbody">samel - is your code in c++? I think _io_dldi_stub is in a c module. so you may need to use the whole extern "C" business if you are using c++.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165749 - hacker013 - Mon Jan 05, 2009 7:45 pm</h4>
    <div class="postbody"><span class="postbody">i fixed the error to move the define of the var to an function.<br/>_________________<br/><a class="postlink" href="http://imetal.nl/" target="_blank">Website / Blog</a>
<br/>
<br/>
Let the nds be with you.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165765 - chishm - Tue Jan 06, 2009 4:23 am</h4>
    <div class="postbody"><span class="postbody">DLDI is now fully exposed in libnds. Check &lt;nds/arm9/dldi.h&gt; for details, but you want to use dldiGetInternal() then grab a pointer to the ioInterface member.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165766 - elhobbs - Tue Jan 06, 2009 8:50 am</h4>
    <div class="postbody"><span class="postbody">chishm - is it possible to convert a cluster from fstat into a sector usable directly with dldi? PARTITION does not appear to be exposed anywhere - or am I missing something obvious?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165802 - chishm - Wed Jan 07, 2009 8:16 am</h4>
    <div class="postbody"><span class="postbody">There's no exposed functionality for doing that, although I really can't see why you want to anyway. For argument's sake, you can pull the PARTITION* for a path using getDeviceOpTab() in &lt;sys/iosupport.h&gt;. The structure isn't publicly defined so you'll need to grab it from the libfat source. This is a bad idea, however, since it is subject to change (when the library is updated) without notice.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165816 - elhobbs - Wed Jan 07, 2009 3:48 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote">There's no exposed functionality for doing that, although I really can't see why you want to anyway. For argument's sake, you can pull the PARTITION* for a path using getDeviceOpTab() in &lt;sys/iosupport.h&gt;. The structure isn't publicly defined so you'll need to grab it from the libfat source. This is a bad idea, however, since it is subject to change (when the library is updated) without notice.</td> </tr></table><span class="postbody">I agree it is not the best solution. I was using it to stream data from quake pak files in cquake. and as you can imagine it has caused all sorts of issues as it requires the pak file to be completely defragmented. the issue that I am trying to work around is that the quake pak files are similiar to a tar file, so finding a particular file in the archive requires seeking to an offset in a very large file which is very slow and there is not enough memory to cache all of the data.
<br/>
<br/>
I already pulled the code from the libfat source and it does work. I was just trying to avoid that mess if something else was publicly exposed now like dldi. In any case thanks for the response.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165831 - chishm - Thu Jan 08, 2009 8:02 am</h4>
    <div class="postbody"><span class="postbody">You could try opening two handles to the file. One for reading the table of contents (or whatever a TAR file calls it) and one for seeking to the next file in the table. As long as you only seek forward, libfat won't rescan the entire cluster chain up to that point.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#165834 - elhobbs - Thu Jan 08, 2009 6:45 pm</h4>
    <div class="postbody"><span class="postbody">unfortunately, it is not sequential access. it is random. textures and models need to be swapped in and out of memory as they are needed during game play.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
