<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Mapping Vram H to sub BG... - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Mapping Vram H to sub BG...</h2>
<div id="posts">
<div class="post">
    <h4>#174836 - relminator - Fri Jul 23, 2010 8:02 am</h4>
    <div class="postbody"><span class="postbody">Sorry for double posting as my net time is kind of limited these days.
<br/>
<br/>
Video.h
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">typedef enum {
<br/>
   VRAM_H_LCD                = 0,
<br/>
   VRAM_H_SUB_BG             = 1,
<br/>
   VRAM_H_SUB_BG_EXT_PALETTE = 2,
<br/>
} VRAM_H_TYPE;
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
256 * 192 = 48kb
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">Bank H                       0x06898000          0x0689FFFF          32KB  
<br/>
Bank I                       0x068A0000          0x068A3FFF          16KB 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Bank H is just 32 KB. Does it mean that bank I gets mapped to sub BG also?
<br/>
<br/>
I wanna map this as LCD since I want to do some per pixel stuff on the sub screen.
<br/>
<br/>
<br/>
Also when I call:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">gluTexLoadPal();</td> </tr></table><span class="postbody">
<br/>
<br/>
Is the pallete loaded in vram bank E?
<br/>
<br/>
<br/>
So far this is how I've been using the VRAM.
<br/>
<br/>
A = filled by two gltextures at 64 kb each so all of 128 kb is filled.
<br/>
<br/>
B = Some textures but still have a lot left.
<br/>
<br/>
C = Not used yet (only by consoledemoInit())
<br/>
<br/>
D = VRAM_D_SUB_SPRITE (But still lots of stuff free)
<br/>
<br/>
E = Unused but I'm not sure if glpalette uses it.
<br/>
<br/>
F, G, H, I = not used.
<br/>
<br/>
Thanks!<br/>_________________<br/><a href="http://rel.betterwebber.com" target="_blank">http://rel.betterwebber.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#174839 - elhobbs - Fri Jul 23, 2010 2:49 pm</h4>
    <div class="postbody"><span class="postbody">I use H and I for a 256x192 8bit subscreen</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
vramSetBankH(VRAM_H_SUB_BG);  
<br/>
vramSetBankI(VRAM_I_SUB_BG_0x06208000);</td> </tr></table><span class="postbody">since it does not have enough memory for 256x256 weird things happen if you try to use background scrolling.
<br/>
<br/>
libnds is hardcoded to use E for palettes. I moved palettes to F but I had to build custom palette loading code - really just copied the libnds code and switched it to F.
<br/>
<br/>
this is the layout that I use for cquake
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
vramSetMainBanks(VRAM_A_TEXTURE, VRAM_B_TEXTURE, VRAM_C_TEXTURE, VRAM_D_TEXTURE);
<br/>
vramSetBankE(VRAM_E_MAIN_BG);
<br/>
vramSetBankF(VRAM_F_TEX_PALETTE);
<br/>
vramSetBankG(VRAM_G_MAIN_BG_0x06010000);
<br/>
vramSetBankH(VRAM_H_SUB_BG);
<br/>
vramSetBankI(VRAM_I_SUB_BG_0x06208000);
<br/>
<br/>
videoSetModeSub(MODE_5_2D | DISPLAY_BG0_ACTIVE | DISPLAY_BG2_ACTIVE);
<br/>
ds_bg_sub = bgInitSub(2,BgType_Bmp8,BgSize_B8_256x256,0,0);
<br/>
<br/>
videoSetMode(MODE_3_3D | DISPLAY_BG1_ACTIVE | DISPLAY_BG2_ACTIVE | DISPLAY_BG3_ACTIVE);
<br/>
consoleInit(0,1, BgType_Text4bpp, BgSize_T_256x256, 14,0, true,true); 
<br/>
BG_PALETTE[0]=0;         
<br/>
BG_PALETTE[255]=0xffff;
<br/>
<br/>
ds_bg_text = bgInit(2,BgType_Text4bpp,BgSize_T_256x256,15,0); 
<br/>
ds_bg_main = bgInit(3,BgType_Bmp8,BgSize_B8_256x256,2,0); 
<br/>
 
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
A-D = textures
<br/>
E &amp; G = main bg 256x192 8bit ,1 console plus an additional text layer
<br/>
F = palettes
<br/>
H &amp; I = sub bg 256x192 8bit</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#174840 - relminator - Fri Jul 23, 2010 3:15 pm</h4>
    <div class="postbody"><span class="postbody">Thanks dude!!! I'm not gonna scroll the sub BG so all is well.
<br/>
<br/>
BTW, what does it mean when you do this?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">vramSetBankH(VRAM_H_SUB_BG);
<br/>
vramSetBankI(VRAM_I_SUB_BG_0x06208000); </td> </tr></table><span class="postbody"><br/>_________________<br/><a href="http://rel.betterwebber.com" target="_blank">http://rel.betterwebber.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#174842 - DiscoStew - Fri Jul 23, 2010 4:39 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>relminator wrote:</b></span></td> </tr> <tr> <td class="quote">Thanks dude!!! I'm not gonna scroll the sub BG so all is well.
<br/>
<br/>
BTW, what does it mean when you do this?
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">vramSetBankH(VRAM_H_SUB_BG);
<br/>
vramSetBankI(VRAM_I_SUB_BG_0x06208000); </td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
<br/>
<a href="http://nocash.emubase.de/gbatek.htm#dsmemorycontrolvram" target="_blank">http://nocash.emubase.de/gbatek.htm#dsmemorycontrolvram</a>
<br/>
<br/>
It just assigns the bank to a specific function and/or address for operation. VRAM H gets set to BG usage with an address at 06200000h, and VRAM I gets set to BG usage with an address at 0x6208000h, which is right after the 32KB section designated with VRAM H. VRAM I is incapable of being assigned at any other area for Sub BGs, so for programmer understandability, the address was included in the #define.<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#174843 - elhobbs - Fri Jul 23, 2010 6:05 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>relminator wrote:</b></span></td> </tr> <tr> <td class="quote">Thanks dude!!! I'm not gonna scroll the sub BG so all is well.
<br/>
<br/>
BTW, what does it mean when you do this?
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">vramSetBankH(VRAM_H_SUB_BG);
<br/>
vramSetBankI(VRAM_I_SUB_BG_0x06208000); </td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">it maps a continuous 48k for the sub screen background - which is enough to use a 256x192 8bit background.
<br/>
<br/>
the sub background starts at 0x06200000. bank H is 32k or 0x8000 in hex. this maps I right after H.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#174846 - relminator - Sat Jul 24, 2010 1:14 am</h4>
    <div class="postbody"><span class="postbody">Thanks guys.<br/>_________________<br/><a href="http://rel.betterwebber.com" target="_blank">http://rel.betterwebber.com</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
