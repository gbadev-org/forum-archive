<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Bitmaps modes on the DS? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Bitmaps modes on the DS?</h2>
<div id="posts">
<div class="post">
    <h4>#44210 - jmva16 - Tue May 31, 2005 2:40 am</h4>
    <div class="postbody"><span class="postbody">I have looked through many documents and searched this forum and it seems nobody has successfully used a bitmap mode on the ds yet.  Is this true?  I would like to do what MODE 4 was for the GBA.  I don't need backgrounds or sprites, I just want to write images to a framebuffer that go through a palette lookup.  Has anybody had any success with this type of operation?
<br/>
<br/>
I read on the Wiki <a class="postlink" href="http://www.bottledlight.com/ds/index.php/Video/2DCore" target="_blank">http://www.bottledlight.com/ds/index.php/Video/2DCore</a> that as long as you set the extended mode to 1, the display modes are the same as the GBA.  I think this information is old because I have had no success at this and these posts: <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=5264" target="_blank">http://forum.gbadev.org/viewtopic.php?t=5264</a> seem to contradict that.  Can anybody explain this further?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44238 - Abcd1234 - Tue May 31, 2005 6:11 am</h4>
    <div class="postbody"><span class="postbody">The docs are rather inaccurate here (in fact, the bit about GBA modes being directly supported is, AFAIK, totally wrong).  So, my first suggestion is that you read the docs that come with ndslib.  They're much more accurate on some of these topics (video in particular).
<br/>
<br/>
Anyway, to answer your question, the DS doesn't actually have a native bitmapped mode.  Instead, you can simply make use of an extended rotation background by setting it up in 8-bit bitmapped mode.  In my own project, I switched the display to Mode 5 (MODE_5_2D, in ndslib parlance), which provides one with 2 text backgrounds and 2 extended rotation backgrounds, with BG0 being available for 3D.  Then, I switched BG2 to a 256x256, 8 bit background (I don't have the exact flags specifications on hand... with ndslib, the value is BG_BMP8_256x256) using palette 0.  The only other important bit is to make sure to assign the VRAM banks appropriately.  And that's it!  Oh, and of course, set up the palette, but that works the same as on a GBA.  Good luck!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44253 - dovoto - Tue May 31, 2005 8:59 am</h4>
    <div class="postbody"><span class="postbody">If you have ndslib you have example code for using "bitmap modes".  They are in ndslib/exaples/arm9/2D.  May want to check out <a class="postlink" href="http://www.drunkencoders.com/documents/DS/ndslib.htm" target="_blank">http://www.drunkencoders.com/documents/DS/ndslib.htm</a> for a decent description of 2D modes.<br/>_________________<br/><a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44390 - jmva16 - Wed Jun 01, 2005 6:57 am</h4>
    <div class="postbody"><span class="postbody">Thank you for the posts.  You guys rock.  I am trying your suggestions now.  I have had success with following configuration.  I set MODE_5_2D and BG3 active.  I set BG3 to BG_BMP8_256x256.  I loaded BG_PALETTE with my palette and wrote my image to 0x6000000.  This is working with the emulator (I have not tried it on my hardware yet).
<br/>
<br/>
I do not understand the part where I write to 0x6000000.  How does it know this is BG3?  I would have expected to have to set a vram bank as MAIN_BG and written to it, however I am then confused at to which bank would be BG3 as opposed to BG0, BG1, and BG2 (the text backgrounds and the other extended rotation background).  I also do not understand the BG_BMP_BASE(x) macro and the offsets mentioned in Dovoto's ndslib.htm document.  Can anybody shed some light on this for me?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44418 - Darkain - Wed Jun 01, 2005 5:52 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>jmva16 wrote:</b></span></td> </tr> <tr> <td class="quote">Thank you for the posts.  You guys rock.  I am trying your suggestions now.  I have had success with following configuration.  I set MODE_5_2D and BG3 active.  I set BG3 to BG_BMP8_256x256.  I loaded BG_PALETTE with my palette and wrote my image to 0x6000000.  This is working with the emulator (I have not tried it on my hardware yet).
<br/>
<br/>
I do not understand the part where I write to 0x6000000.  How does it know this is BG3?  I would have expected to have to set a vram bank as MAIN_BG and written to it, however I am then confused at to which bank would be BG3 as opposed to BG0, BG1, and BG2 (the text backgrounds and the other extended rotation background).  I also do not understand the BG_BMP_BASE(x) macro and the offsets mentioned in Dovoto's ndslib.htm document.  Can anybody shed some light on this for me?</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
put 2 and 2 together, and you answered your own question.
<br/>
<br/>
BG_BMP_BASE sets where in the BG_GFX mem the image is located, in 16KBYTE increments... so, set it to 1, and it starts at 0x06004000, 2 would be 0x06008000, and so on down the line.<br/>_________________<br/>-=- Darkain Dragoon -=-
<br/>
<a class="postlink" href="http://www.darkain.com" target="_blank">http://www.darkain.com</a>
<br/>
<a class="postlink" href="http://ds.darkain.com/hack" target="_blank">DarkStar</a> for <a class="postlink" href="http://ds.darkain.com" target="_blank">Nintendo DS</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44441 - LunarCrisis - Wed Jun 01, 2005 9:20 pm</h4>
    <div class="postbody"><span class="postbody">With the ability to use these BGs to display bitmaps and sprites at the same time, I'm wondering what purpose framebuffer mode has at all.<br/>_________________<br/>If a tree falls in the forest and no one is there to hear it, why the heck do you care?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44478 - tepples - Thu Jun 02, 2005 3:28 am</h4>
    <div class="postbody"><span class="postbody">Perhaps framebuffer mode takes input in the format that the sample-3D-core-output register produces for the 3D-on-both-screens effect.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44496 - LunarCrisis - Thu Jun 02, 2005 8:22 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Perhaps framebuffer mode takes input in the format that the sample-3D-core-output register produces for the 3D-on-both-screens effect.</td> </tr></table><span class="postbody">
<br/>
I'm not sure I understand, since the 3D and framebuffers are both only available on the main screen, what would the framebuffer taking the right input help?<br/>_________________<br/>If a tree falls in the forest and no one is there to hear it, why the heck do you care?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44503 - tepples - Thu Jun 02, 2005 10:37 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>LunarCrisis wrote:</b></span></td> </tr> <tr> <td class="quote">since the 3D <span style="font-weight: bold">and framebuffers</span> are both only available on the main screen</td> </tr></table><span class="postbody">
<br/>
I didn't know that. Sorry. Should I just refrain from commenting on topical issues in the DS development forum until after I've got a job that pays enough for me to afford to buy a DS and PassMe for myself?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49337 - spunky - Thu Jul 28, 2005 10:25 pm</h4>
    <div class="postbody"><span class="postbody">hey guys.. I got it working in BMP8 mode with the main palette.
<br/>
When setting BMP16 however and writing to BG_GFX something like RGB15(31, 0, 31) does not result in the right colors, its really weird.
<br/>
Blue works fine when shifting it 10 to the left, the rest is screwed up.
<br/>
Is there a different pixel bytes layout in this mode?
<br/>
<br/>
Thanks a lot
<br/>
Marius</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49340 - MrAdults - Thu Jul 28, 2005 11:35 pm</h4>
    <div class="postbody"><span class="postbody">There is also an alpha bit, something like
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">x = RGB15(31, 0, 31)|(1&lt;&lt;15);</td> </tr></table><span class="postbody">
<br/>
<br/>
may give you your desired results.
<br/>
<br/>
-Rich</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49348 - spunky - Fri Jul 29, 2005 12:29 am</h4>
    <div class="postbody"><span class="postbody">no that didnt do it :\ for some reason the palette is still having influence it seems:
<br/>
<br/>
here are some code excerpts:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
videoSetMode(MODE_5_2D | DISPLAY_BG2_ACTIVE);
<br/>
<br/>
VRAM_A_CR = 1 | VRAM_OFFSET(0) | VRAM_ENABLE; //background&gt;VRAM_A_MAIN_BG_0x6000000  
<br/>
<br/>
//setup bg
<br/>
BG2_XDX = 0x100; BG2_XDY = 0; BG2_YDX = 0; 
<br/>
BG2_YDY = 0x100; BG2_CY = 0; BG2_CX = 0;
<br/>
<br/>
for(int i = 0; i &lt; 256*256; i++)
<br/>
    (BG_GFX)[i] = RGB15(31, 0, 0) | (1&lt;&lt;10); //transparent bit didnt make a difference
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
whats wrong :( PLUS setting it to BMP8_256x256 with a palette works perfectly fine on the emulator ( dualis ) but not on the hardware..
<br/>
the bmp16 mode works on both.. but with freaky results</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49351 - spunky - Fri Jul 29, 2005 12:59 am</h4>
    <div class="postbody"><span class="postbody">stop taking it back.. seems to work now, but dont ask me why.. 
<br/>
I keep overlooking the tiny things :\</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49352 - headspin - Fri Jul 29, 2005 1:00 am</h4>
    <div class="postbody"><span class="postbody">You have (1 &lt;&lt; 10), that should be (1&lt;&lt;15)<br/>_________________<br/><a class="postlink" href="http://headsoft.com.au/index.php?category=warhawk" target="_blank">Warhawk DS</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=mmll" target="_blank">Manic Miner: The Lost Levels</a> | <a class="postlink" href="http://headsoft.com.au/index.php?category=tdg" target="_blank">The Detective Game</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49360 - spunky - Fri Jul 29, 2005 2:41 am</h4>
    <div class="postbody"><span class="postbody">*ashamed* yes. :(</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
