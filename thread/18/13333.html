<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Multiple MD2 - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS development > Multiple MD2</h2>
<div id="posts">
<div class="post">
    <h4>#130338 - iainprice - Sat Jun 02, 2007 10:28 am</h4>
    <div class="postbody"><span class="postbody">I loved Touch the Dead and wanted to have a play. So far I have this:
<br/>
<br/>
<a href="http://www.youtube.com/watch?v=AcnzP4Lhlhg" target="_blank">http://www.youtube.com/watch?v=AcnzP4Lhlhg</a>
<br/>
<br/>
I have 2 MD2 files and picking working for finding them but they both use the same transfer matrix so they are on top of eachother, you click once and it kills one, then click again and it kills the other.
<br/>
<br/>
My HDD is playing up but I'll post some code later today.....</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130339 - iainprice - Sat Jun 02, 2007 10:37 am</h4>
    <div class="postbody"><span class="postbody">OK, so that video was a biut naff ... here is a better one....
<br/>
<br/>
<a href="http://www.youtube.com/watch?v=rDrW0KkUYOs" target="_blank">http://www.youtube.com/watch?v=rDrW0KkUYOs</a>
<br/>
<br/>
Also I am after someone who can make me a nice alien MD2.......</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130350 - iainprice - Sat Jun 02, 2007 2:04 pm</h4>
    <div class="postbody"><span class="postbody">[code]
<br/>
if ((monsters[ii].health))
<br/>
{
<br/>
	glPushMatrix();
<br/>
	glScalef32(scale);
<br/>
	glBindTexture (GL_TEXTURE_2D, Texture[0]);
<br/>
	glColorTable(GL_RGB256, TexturePal[0]);
<br/>
	glMatrixMode(GL_PROJECTION);
<br/>
	glLoadIdentity();
<br/>
	gluPerspective(35, 256.0 / 192.0, 0.1, 40);
<br/>
	glMatrixMode(GL_MODELVIEW);
<br/>
	glTranslate3f32(monsters[ii].x, monsters[ii].y, monsters[ii].z+floattof32(-zoom));
<br/>
	glRotateX(rotateX-90);
<br/>
	glRotateZ(rotateY);
<br/>
	RenderMD2Model(monsters[ii].frame,monsters[ii].action);
<br/>
	glViewPort(0,192,0,192);
<br/>
	glMatrixMode(GL_PROJECTION);
<br/>
	glLoadIdentity();
<br/>
	gluPickMatrix((touchXY.px),(191-touchXY.py),4,4,viewport); // render only below cursor
<br/>
	gluPerspective(35, 256.0 / 192.0, 0.1, 40);
<br/>
	glMatrixMode(GL_MODELVIEW);
<br/>
	startCheck();
<br/>
	QuickRenderMD2Model(monsters[ii].frame,monsters[ii].action);
<br/>
	endCheck(ii+1);
<br/>
	glPopMatrix(1);
<br/>
}
<br/>
<br/>
[/code]
<br/>
<br/>
with different x y z values, they all seem to take the same position.. where am i going wrong?
<br/>
<br/>
Thanks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130356 - FireSlash - Sat Jun 02, 2007 3:40 pm</h4>
    <div class="postbody"><span class="postbody">You're doing far too much there. The following lines should only be called once per render cycle
<br/>
<br/>
 glPushMatrix();
<br/>
 glMatrixMode(GL_PROJECTION);
<br/>
 glLoadIdentity(); 
<br/>
 glPopMatrix(1); 
<br/>
<br/>
and these lines only need called once, before your render loop
<br/>
<br/>
 glViewPort(0,192,0,192);
<br/>
 gluPerspective(35, 256.0 / 192.0, 0.1, 40);<br/>_________________<br/><a class="postlink" href="http://www.fireslash.net" target="_blank">FireSlash.net</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130370 - gabebear - Sat Jun 02, 2007 5:02 pm</h4>
    <div class="postbody"><span class="postbody">Generally FireSlash would be almost correct, but when picking you need to constantly switch between rendering contexts. The posted code snippet looks correct.
<br/>
<br/>
Let me restate your problem so that I'm certain I have it right: you are rendering two models and they are being displayed in the exact same spot even through you translated differently before drawing.
<br/>
<br/>
I'm not sure what RenderMD2Model() does, but could it be loading identity on either GL_MODELVIEW or GL_POSITION? That seems like it is the most likely problem. That, or your moster x,y,z variables actually are the same for each monster.
<br/>
<br/>
With the endCheck()/startCheck() in the libnds example you can only select one item per frame, even if they are in the exact same spot, whatever was drawn last would be picked. The picking part seems to be working as expected.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130393 - iainprice - Sat Jun 02, 2007 11:30 pm</h4>
    <div class="postbody"><span class="postbody">[code]
<br/>
void RenderMD2Model(int n,int num)
<br/>
{	
<br/>
extern v16 anormtable16[162][3];
<br/>
<br/>
int i, j,stnum,vertnum;
<br/>
if ( (n &lt; 0) || (n &gt; Models[num].header.num_frames - 1))
<br/>
  n=Models[num].header.num_frames - 1;
<br/>
if(ModelEnable[num]==false)
<br/>
  return;
<br/>
<br/>
nds_vertex_t* vert=Models[num].frms[n].verts;
<br/>
glBegin (GL_TRIANGLES);		
<br/>
for (i = 0; i &lt; Models[num].header.num_tris; ++i){
<br/>
  for (j = 0; j &lt; 3; ++j){	
<br/>
	stnum=Models[num].tris[i].st[j];
<br/>
	vertnum=Models[num].tris[i].vertex[j];
<br/>
	glNormal(NORMAL_PACK(anormtable16[vert[vertnum].normalindex][0], anormtable16[vert[vertnum].normalindex][1], anormtable16[vert[vertnum].normalindex][2]));
<br/>
	glTexCoord2t16 (Models[num].uvs[stnum].s, Models[num].uvs[stnum].t);
<br/>
	glVertex3v16 (vert[vertnum].v[0],vert[vertnum].v[1], vert[vertnum].v[2]);     
<br/>
	}
<br/>
  }
<br/>
glEnd ();
<br/>
}
<br/>
[/code]
<br/>
<br/>
The Quick render doesn't bother with textures......
<br/>
<br/>
Any ideas....</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130405 - gabebear - Sun Jun 03, 2007 1:54 am</h4>
    <div class="postbody"><span class="postbody">RenderMD2Model() looks fine as well... sorry
<br/>
<br/>
I guess I'd need to see the whole thing. You might want to try the #dsdev IRC channel. I sporadically hang out there. 
<br/>
<br/>
On a side note, do you know how to get the MD2 anorms table under a non-GPL license? I've seen people redistributions anorms.h with the copyright information stripped off, but never with a license other than the GPL. I doubt Carmack would ever sue over it, but I'd love to know a legal place to get that table. I spent a little while trying to figure out how to generate the anorms table programmatically, but finally gave up.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130438 - iainprice - Sun Jun 03, 2007 12:25 pm</h4>
    <div class="postbody"><span class="postbody">I found it on the internet and it didn't say where it had come from so I presume it was stripped of copyright.... I'll try to find the source again and pm it to you for you to have a look at.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#130506 - a128 - Mon Jun 04, 2007 8:45 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>gabebear wrote:</b></span></td> </tr> <tr> <td class="quote"> I spent a little while trying to figure out how to generate the anorms table programmatically, but finally gave up.</td> </tr></table><span class="postbody">
<br/>
<br/>
Just calc your own normals from the verticies position
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
  // calculate polygon normals 
<br/>
<br/>
  for (i = 0; i &lt; m-&gt;numfaces; i++) {
<br/>
<br/>
   A = vertex1 - vertex3;
<br/>
<br/>
i.e. Ax=vertex1.x - vertex3.x
<br/>
    ......
<br/>
  Az=vertex1.z - vertex3.z
<br/>
<br/>
   B = vertex3-vertex2;
<br/>
<br/>
   C= A x B (crossproduct)
<br/>
i.e.
<br/>
    cx = ay * bz - by * az;
<br/>
    cy = az * bx - bz * ax;
<br/>
    cz = ax * by - bx * ay;
<br/>
<br/>
    len = 1.0f / sqrt(cx * cx + cy * cy + cz * cz);
<br/>
<br/>
    face normal[i]= C *len;
<br/>
<br/>
  }
<br/>
<br/>
  // calculate vertex normals by averaging the normals of all the polygons
<br/>
  // which use the vertex.
<br/>
  FLOAT count;
<br/>
<br/>
  for (i = 0; i &lt; m-&gt;numverts; i++) {
<br/>
    ax = ay = az = 0.0f;
<br/>
    count = 0.0f;
<br/>
<br/>
    for (j = 0; j &lt; m-&gt;numfaces; j++) {
<br/>
      if (m-&gt;flist[j].v1 == i ||
<br/>
          m-&gt;flist[j].v2 == i ||
<br/>
          m-&gt;flist[j].v3 == i) {
<br/>
        ax = ax + m-&gt;face normal [j]
<br/>
        ay = ay + m-&gt;face normal[j]
<br/>
        az = az + m-&gt;face normal[j]
<br/>
        count++;
<br/>
      }
<br/>
    }
<br/>
    m-&gt;vlist[i].nx = ax / count;
<br/>
    m-&gt;vlist[i].ny = ay / count;
<br/>
    m-&gt;vlist[i].nz = az / count;
<br/>
  }
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#132083 - tepples - Sat Jun 23, 2007 5:37 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>gabebear wrote:</b></span></td> </tr> <tr> <td class="quote">On a side note, do you know how to get the MD2 anorms table under a non-GPL license?</td> </tr></table><span class="postbody">
<br/>
Today I investigated anorms, and the set of 162 normal vectors it contains turn out to be an icosahedron, subdivided by a factor of 4, projected onto a unit sphere.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
