<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Detecting key presses with interrupts - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS development > Detecting key presses with interrupts</h2>
<div id="posts">
<div class="post">
    <h4>#172750 - sylvestersteele - Mon Mar 01, 2010 4:23 am</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
Detecting key presses by polling in the while loop is pretty straightforward, but I want to detect them using interrupts. I did the following:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">irqInit (); 
<br/>
   irqSet(IRQ_VBLANK, Vblank);
<br/>
   irqEnable (IRQ_KEYS);
<br/>
   irqSet(IRQ_KEYS, keyPressed);
<br/>
   consoleDemoInit();</td> </tr></table><span class="postbody">
<br/>
<br/>
And I found that the keyPressed function is never executed. I was going through the previous posts and came across a post saying that key presses are supposed to be detecting while processing the VBlank interrupt.
<br/>
<br/>
Q1: Is this this best way to do it?
<br/>
<br/>
Q2: When is the IRQ_KEYS interrupt generated?
<br/>
<br/>
Q3: If the answer to Q1 is no- then what is the best way to do it?
<br/>
<br/>
Thanks,
<br/>
Sylvester</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172755 - Dwedit - Mon Mar 01, 2010 12:03 pm</h4>
    <div class="postbody"><span class="postbody">Detecting keypresses with interrupts is just stupid.  You can just read the keyboard once per frame, like everyone else does, possibly inside your Vblank handler.
<br/>
<br/>
The only real use of the keyboard interrupt was to wake a GBA out of sleep mode, and the DS has a hinge feature for sleep mode instead.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172756 - SteveH - Mon Mar 01, 2010 2:04 pm</h4>
    <div class="postbody"><span class="postbody">Also NEVER call irqInit() in any of the latest versions of the devkitARM toolchain, currently at r28, as it gets called before main() now.
<br/>
<br/>
The more important question I think should be asked here:
<br/>
<br/>
Why do you think that using an IRQ handler will be better than just polling the keys in a while() loop?
<br/>
<br/>
As WinterMute said in IRC the other night (slighty paraphrased here):
<br/>
<br/>
"If your main loop takes more than 1 frame to process, your doing it wrong."</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
