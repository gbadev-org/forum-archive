<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Console output + Dual screen 3D? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS development > Console output + Dual screen 3D?</h2>
<div id="posts">
<div class="post">
    <h4>#162061 - AntonioND - Sun Aug 24, 2008 4:37 pm</h4>
    <div class="postbody"><span class="postbody">Hello!
<br/>
<br/>
I was wondering if it was possible to use libnds console when I use dual screen 3D. I use VRAM_A and VRAM_B for texture memory, VRAM_C and VRAM_D as framebuffers and VRAM_E as palette memory for textures. I am using this code:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">videoSetModeSub(MODE_0_2D | DISPLAY_BG1_ACTIVE);
<br/>
vramSetBankH(VRAM_H_SUB_BG); 
<br/>
SUB_BG0_CR |= BG_PRIORITY_1;
<br/>
SUB_BG1_CR |= BG_MAP_BASE(15) | BG_PRIORITY_0;
<br/>
consoleInitDefault((u16*)SCREEN_BASE_BLOCK_SUB(15), (u16*)CHAR_BASE_BLOCK_SUB(0), CONSOLE_USE_COLOR255);
<br/>
BG_PALETTE_SUB[255]=0xff00;
<br/>
iprintf("Can you see this?");</td> </tr></table><span class="postbody">
<br/>
Obviously, it doesn't work because I change screens every frame...
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">if(screen == 0)   
<br/>
   {
<br/>
   vramSetBankC(VRAM_C_SUB_BG); vramSetBankD(VRAM_D_LCD);
<br/>
   SetRegCapture(true, 0, 31, 3, 0, 3, 0, 0);
<br/>
   }      
<br/>
else
<br/>
   {
<br/>
    vramSetBankC(VRAM_C_LCD); vramSetBankD(VRAM_D_SUB_SPRITE);
<br/>
    SetRegCapture(true, 0, 31, 2, 0, 3, 0, 0);
<br/>
   }   
<br/>
<br/>
lcdSwap();
<br/>
screen ^= 1;</td> </tr></table><span class="postbody">
<br/>
<br/>
How can I setup the console every frame in order to see the text OK? I think I can't because VRAM_F and VRAM_G can only output to main bg; VRAM_H and VRAM_I can only output to sub bg...
<br/>
<br/>
I hope someone can help me...
<br/>
<br/>
PS: Sorry for my bad english.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#162068 - silent_code - Sun Aug 24, 2008 9:06 pm</h4>
    <div class="postbody"><span class="postbody">Look into the Bezier curve code floating around this forum. I posted the whole thing with an image on both screens plus text.
<br/>
You will probably have to change a few things, but it should get you there. I think it's possible.<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#162083 - Cydrak - Mon Aug 25, 2008 4:41 am</h4>
    <div class="postbody"><span class="postbody">He's asking about 3D, though, and here the engines are constantly toggling screens, aren't they? The only "swappable" banks are C and D, already taken...
<br/>
<br/>
So, first, a hackish solution: Put the console map in RAM, and DMA every vblank to the right area (F/G, H/I).
<br/>
<br/>
Another is to put the console on F or G. Then you need to arrange a layered (2D) capture instead of a 3D one. (Notice that 3D still works, it's on BG0 as usual.) When you swap screens, you should show/hide/scroll the console layer depending on where you want it. If you want a "tall," two-screen console, you'll have to write your own. It's really not that hard--a really cheapo implementation wouldn't break 50 lines. You could use <a class="postlink" href="http://devkitpro.cvs.sourceforge.net/devkitpro/libnds/source/arm9/console.c?revision=1.30&amp;view=markup" target="_blank">libnds' console</a> as a starting point.
<br/>
<br/>
Both methods have a caveat, though: the DMA or capture has to be restarted every frame (maybe DMA can be convinced to repeat, not sure). Thing is, if you have a console and you crash, most likely you want to see the last thing printed.
<br/>
<br/>
The only way I can think to ensure that is to replicate the console text on F, C (when it's mapped as SUB_BG), <span style="font-weight: bold">and</span> H (when C is busy being redrawn). This way, you would always have an up to date console onscreen, rather than buffered. Although, to see it, you would have to avoid framebuffer display (as used for blur, faux bloom, etc).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#162086 - silent_code - Mon Aug 25, 2008 7:05 am</h4>
    <div class="postbody"><span class="postbody">Yepp, I know he's talking about dual 3D and I thought it would be somewhat easier after seeing how it's been done in the aforementioned demo. ;^)
<br/>
<br/>
Good luck. :^D<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#162089 - AntonioND - Mon Aug 25, 2008 12:28 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cydrak wrote:</b></span></td> </tr> <tr> <td class="quote">Another is to put the console on F or G. Then you need to arrange a layered (2D) capture instead of a 3D one. (Notice that 3D still works, it's on BG0 as usual.) When you swap screens, you should show/hide/scroll the console layer depending on where you want it. </td> </tr></table><span class="postbody">
<br/>
<br/>
Thank you guys, I managed to do what you said. Now I have sub screen 3D, main screen 3D + console, but in the console output there are lots of vertical lines. What am I doing wrong? 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">videoSetMode(MODE_0_3D | DISPLAY_BG1_ACTIVE);
<br/>
vramSetBankF(VRAM_F_MAIN_BG);
<br/>
 
<br/>
BG_PALETTE[255] = 0xFFFF;
<br/>
BG1_CR = BG_MAP_BASE(0) | BG_PRIORITY(0); 
<br/>
BG0_CR = BG_PRIORITY(1); 
<br/>
 
<br/>
consoleInitDefault((u16*)SCREEN_BASE_BLOCK(0), (u16*)CHAR_BASE_BLOCK(0), CONSOLE_USE_COLOR255);</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">if(Screen == 0)   
<br/>
   {
<br/>
   BG1_CR = BG_MAP_BASE(0) | BG_PRIORITY(0);
<br/>
   BG0_CR = BG_PRIORITY(1); 
<br/>
<br/>
   vramSetBankC(VRAM_C_SUB_BG); vramSetBankD(VRAM_D_LCD);
<br/>
   SetRegCapture(true, 0, 31, 3, 0, 3, 0/* 3d + bg + obj*/, 0);
<br/>
   }      
<br/>
else
<br/>
   {
<br/>
   BG1_CR = BG_PRIORITY(1); BG0_CR = BG_PRIORITY(0);
<br/>
   
<br/>
    vramSetBankC(VRAM_C_LCD); vramSetBankD(VRAM_D_SUB_SPRITE);
<br/>
   SetRegCapture(true, 0, 31, 2, 0, 3, 1 , 0);
<br/>
   }   
<br/>
<br/>
lcdSwap();
<br/>
Screen ^= 1;</td> </tr></table><span class="postbody">
<br/>
<br/>
(I guess this is better than noting :P)
<br/>
<a href="http://img145.imageshack.us/img145/4161/8226312mw6.png" target="_blank">http://img145.imageshack.us/img145/4161/8226312mw6.png</a></span><span class="gensmall"><br/><br/>Last edited by AntonioND on Tue Aug 26, 2008 4:02 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#162092 - Cydrak - Mon Aug 25, 2008 5:34 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>silent_code wrote:</b></span></td> </tr> <tr> <td class="quote">Yepp, I know he's talking about dual 3D and I thought it would be somewhat easier after seeing how it's been done in the aforementioned demo. ;^) </td> </tr></table><span class="postbody">
<br/>
Ahh, the banking stuff? I was all confused since I didn't see any 3D in your demo, but I think I see what you mean. (Putting H and C on SUB_BG, as done in the first post, certainly won't work as well. :-)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">BG1_CR = BG_MAP_BASE(0) | BG_PRIORITY(0);
<br/>
consoleInitDefault((u16*)SCREEN_BASE_BLOCK(0), (u16*)CHAR_BASE_BLOCK(0), CONSOLE_USE_COLOR255);</td> </tr></table><span class="postbody">
<br/>
The reason this doesn't work is that you always need BG_MAP_BASE and BG_TILE_BASE for a tiled layer (and of course, they should not overlap). Here both are zero, so your console scribbled text over part of the font. Try putting the tiles at 0 and the map at 8K (map base 4).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#162093 - AntonioND - Mon Aug 25, 2008 6:14 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cydrak wrote:</b></span></td> </tr> <tr> <td class="quote">The reason this doesn't work is that you always need BG_MAP_BASE and BG_TILE_BASE for a tiled layer (and of course, they should not overlap). Here both are zero, so your console scribbled text over part of the font. Try putting the tiles at 0 and the map at 8K (map base 4).</td> </tr></table><span class="postbody">
<br/>
<br/>
You guys are great! Thanks, that made everything go OK.
<br/>
I'm used to PAlib and I don't know how to use this kind of things...
<br/>
<br/>
Thanks again.
<br/>
<br/>
Bye.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#162101 - silent_code - Mon Aug 25, 2008 9:09 pm</h4>
    <div class="postbody"><span class="postbody">You are totally welcome. :^)
<br/>
<br/>
@ Cydrak: Yepp, that's what I was talking about. :^D<br/>_________________<br/><span style="font-size: 9px; line-height: normal"><span style="text-decoration: underline"><span style="font-weight: bold"></span></span> July 5th 08: "<span style="font-weight: bold">Volumetric Shadow Demo</span>" 1.6.0 (final) source released
<br/>
June 5th 08: "<span style="font-weight: bold">Zombie NDS</span>" WIP released!
<br/>
It's all on my page, just click <span style="font-weight: bold">WWW</span> below.</span></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
