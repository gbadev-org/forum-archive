<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>LIBXM7 - A C library to play XM modules on Nintendo DS... - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>DS homebrew announcements > LIBXM7 - A C library to play XM modules on Nintendo DS...</h2>
<div id="posts">
<div class="post">
    <h4>#164543 - sverx - Thu Nov 06, 2008 5:08 pm</h4>
    <div class="postbody"><span class="postbody">Hi!
<br/>
  finally, after many hours spent trying to write something that looks like an API documentation ;) I can release the <span style="font-style: italic">long time ago promised</span> XM replay library <span style="font-size: 9px; line-height: normal">(<a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=15768" target="_blank">see this topic...</a>)</span>.
<br/>
<br/>
It works completely on ARM7, it has some effect column support, some volume column support, instruments with complete volume envelopes support, 8 &amp; 16 bit samples with normal &amp; ping-pong loop support...
<br/>
<br/>
<a class="postlink" href="http://www.teleion.it/users/cgq/nds/libxm7/" target="_blank">Everything is explained with detail here</a>
<br/>
<br/>
Feedback about the lib and the documentation is warmly welcome!
<br/>
<br/>
Thanks everybody that helped me to achieve this personal milestone... and I hope somebody will find my work worth a try :)
<br/>
<br/>
Claudio</span><span class="gensmall"><br/><br/>Last edited by sverx on Fri Nov 07, 2008 3:49 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#164548 - Legolas - Fri Nov 07, 2008 12:07 am</h4>
    <div class="postbody"><span class="postbody">Nice! The demo is very interesting :)
<br/>
However, IMHO you should release at least a small example with sources, something like setup/load/play/stop<br/>_________________<br/><a class="postlink" href="http://itaprogaming.free.fr/" target="_blank">My homepage</a>!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164568 - shaymanjw - Fri Nov 07, 2008 3:21 pm</h4>
    <div class="postbody"><span class="postbody">I agree with Legolas. This looks really good, and I'd like to give it a try in my current project, but the instructions are quite vague on what needs to be done.
<br/>
A small example project would be fab.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164569 - sverx - Fri Nov 07, 2008 3:40 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>shaymanjw wrote:</b></span></td> </tr> <tr> <td class="quote">I agree with Legolas. This looks really good, and I'd like to give it a try in my current project, but the instructions are quite vague on what needs to be done.</td> </tr></table><span class="postbody">
<br/>
<br/>
Vague? :( So it's true I'm really bad in writing documentation :(
<br/>
<span style="font-size: 9px; line-height: normal">[ Gotta tell my boss :D ]</span>
<br/>
<br/>
Anyway, what exactly isn't clear in the doc? I can try to explain better, even if it's hard for me... my english is really poor :|
<br/>
<span style="font-size: 9px; line-height: normal">[I had to ask my wife to correct the doc... we spent two hours 8| ... ]</span>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>shaymanjw wrote:</b></span></td> </tr> <tr> <td class="quote">A small example project would be fab.</td> </tr></table><span class="postbody">
<br/>
<br/>
I'll promise to work on it. Even if it means I need to write the simpler interprocessor data exchange system I can imagine...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164570 - shaymanjw - Fri Nov 07, 2008 4:34 pm</h4>
    <div class="postbody"><span class="postbody">Don't worry, your English is great.
<br/>
<br/>
Basically my project is based on the combined ARM7/ARM9 template from the latest (released) LIBNDS. What would be really useful then is a small example based on this template, but that also uses your lib.
<br/>
<br/>
The stuff you mention (inter-processer data exchange) is where I am struggling...
<br/>
<br/>
One other question. Are we still able to use the LIBNDS 'playSound' command whilst using your lib?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164571 - theli - Fri Nov 07, 2008 4:49 pm</h4>
    <div class="postbody"><span class="postbody">well, counting there are only 3 functions available that's not really hard to put a simple example together:
<br/>
<a href="http://theli.ho.ua/temp/lbxm7_demo.rar" target="_blank">http://theli.ho.ua/temp/lbxm7_demo.rar</a>
<br/>
<br/>
this messy demo just plays bundled xm</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164572 - sverx - Fri Nov 07, 2008 5:08 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>shaymanjw wrote:</b></span></td> </tr> <tr> <td class="quote">Don't worry, your English is great.</td> </tr></table><span class="postbody">
<br/>
<br/>
Not as good as I want...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>shaymanjw wrote:</b></span></td> </tr> <tr> <td class="quote">Basically my project is based on the combined ARM7/ARM9 template from the latest (released) LIBNDS. What would be really useful then is a small example based on this template, but that also uses your lib.</td> </tr></table><span class="postbody">
<br/>
<br/>
I started writing it some minutes ago, then I read the message from theli :D
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>shaymanjw wrote:</b></span></td> </tr> <tr> <td class="quote">The stuff you mention (inter-processer data exchange) is where I am struggling...</td> </tr></table><span class="postbody">
<br/>
<br/>
I know. It's the hardest part, IMHO. But depending on your needs could also be done in quite simple manners, for instance as theli did (I was going to write a similar example...)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>shaymanjw wrote:</b></span></td> </tr> <tr> <td class="quote">One other question. Are we still able to use the LIBNDS 'playSound' command whilst using your lib?</td> </tr></table><span class="postbody">
<br/>
<br/>
Yes, as long as you take care of not using the first N channels, the ones used by the XM module. For instance you could tweak the function that gives you the number of the 1st free channel so that it gives you the number starting from the 1st unused channel not including the ones used by the player. ...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">s32 getFreeSoundChannel2 (int first) {
<br/>
   int i;
<br/>
   for (i=first; i&lt;16; i++) {
<br/>
      if ( (SCHANNEL_CR(i) &amp; SCHANNEL_ENABLE) == 0 ) return i;
<br/>
   }
<br/>
   return -1;
<br/>
}</td> </tr></table><span class="postbody">
<br/>
calling it with
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">s32 res = getFreeSoundChannel2 (TheModule-&gt;NumberofChannels);</td> </tr></table><span class="postbody">
<br/>
for example...
<br/>
<br/>
@theli: thanks :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164573 - Izhido - Fri Nov 07, 2008 6:52 pm</h4>
    <div class="postbody"><span class="postbody">Nice work.
<br/>
<br/>
I, however, have a question. As of today (Nov. 07 2008), most of us are expecting a new dkA &amp; libnds release with a revamped ARM7/9 communication process that should let us use WiFi &amp; Sound with ARM9-only projects.
<br/>
<br/>
Will your library survive the new release? Or there are plans to modify it once the new release goes gold?
<br/>
<br/>
- Izhido</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164586 - shaymanjw - Sat Nov 08, 2008 6:43 pm</h4>
    <div class="postbody"><span class="postbody">OK got this working nicely - thanks Theli for the example (and of course Sverx for the library).
<br/>
<br/>
There does seem to be a slight problem using playSound - it sounds like it's ignoring the sampleRate specified (as per the example, I commented out startSound in the ARM7 code - if I change the name to startSound2 for example, and then reference this in the VblankHandler code then the playSound stuff sounds fine).
<br/>
<br/>
The other option is that it's a bug in the original startSound routine.
<br/>
<br/>
Would appreciate your thoughts.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164620 - sverx - Mon Nov 10, 2008 12:00 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Izhido wrote:</b></span></td> </tr> <tr> <td class="quote">Nice work.
<br/>
<br/>
I, however, have a question. As of today (Nov. 07 2008), most of us are expecting a new dkA &amp; libnds release with a revamped ARM7/9 communication process that should let us use WiFi &amp; Sound with ARM9-only projects.
<br/>
<br/>
Will your library survive the new release? Or there are plans to modify it once the new release goes gold?</td> </tr></table><span class="postbody">
<br/>
<br/>
Thanks :)
<br/>
<br/>
I know that there are plans about that, but I do not know much more... I think that when the new libnds will arrive, I'll see how it'll be possibile to integrate my lib with that, so that you will be still able to use it even in ARM9-only projects. In the while I'll keep on working on the actual 'shape'...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>shaymanjw wrote:</b></span></td> </tr> <tr> <td class="quote">There does seem to be a slight problem using playSound - it sounds like it's ignoring the sampleRate specified (as per the example, I commented out startSound in the ARM7 code - if I change the name to startSound2 for example, and then reference this in the VblankHandler code then the playSound stuff sounds fine). 
<br/>
<br/>
The other option is that it's a bug in the original startSound routine.</td> </tr></table><span class="postbody">
<br/>
<br/>
Don't know why it's ignoring the sample rate, but I think actually there's one small bug in the startSound()
<br/>
<br/>
the code I read in the combined template ARM7 is:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">//---------------------------------------------------------------------------------
<br/>
void startSound(int sampleRate, const void* data, u32 bytes, u8 channel, u8 vol,  u8 pan, u8 format) {
<br/>
//---------------------------------------------------------------------------------
<br/>
   SCHANNEL_TIMER(channel)  = SOUND_FREQ(sampleRate);
<br/>
   SCHANNEL_SOURCE(channel) = (u32)data;
<br/>
   SCHANNEL_LENGTH(channel) = bytes &gt;&gt; 2 ;
<br/>
   SCHANNEL_CR(channel)     = SCHANNEL_ENABLE | SOUND_ONE_SHOT | SOUND_VOL(vol) | SOUND_PAN(pan) | (format==1?SOUND_8BIT:SOUND_16BIT);
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
and it's missing a
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">SCHANNEL_REPEAT_POINT(channel) = 0;</td> </tr></table><span class="postbody">
<br/>
somewhere before the last instruction. Usually you wouldn't notice that, but if this channel has previously been used by a sample that had a loop, that value could be not 0 and affect the sample you want to play.
<br/>
<br/>
...but I guess that's not related the problem affecting you, anyway...
<br/>
<br/>
I hope it helps anyway :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164628 - AntonioND - Mon Nov 10, 2008 4:21 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sverx wrote:</b></span></td> </tr> <tr> <td class="quote">and it's missing a
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">SCHANNEL_REPEAT_POINT(channel) = 0;</td> </tr></table><span class="postbody">
<br/>
somewhere before the last instruction. Usually you wouldn't notice that, but if this channel has previously been used by a sample that had a loop, that value could be not 0 and affect the sample you want to play.
<br/>
<br/>
...but I guess that's not related the problem affecting you, anyway...
<br/>
<br/>
I hope it helps anyway :)</span></td> </tr></table><span class="postbody">
<br/>
I didn't know that, thanks! It would have caused me some problems in the game I'm coding right now.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164630 - sverx - Mon Nov 10, 2008 4:57 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>AntonioND wrote:</b></span></td> </tr> <tr> <td class="quote">I didn't know that, thanks! It would have caused me some problems in the game I'm coding right now.</td> </tr></table><span class="postbody">
<br/>
<br/>
Well, it could happen only if somewhere in your code you're using samples with loop that doesn't begin at the beginning of the sample (or if you're using libxm7 and you're re-using a channel where you've been playing another XM before and it had more channels than the one that you're currently playing...)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164647 - hacker013 - Tue Nov 11, 2008 7:30 pm</h4>
    <div class="postbody"><span class="postbody">this rocks, i go to use that in the new Xsystem Release<br/>_________________<br/><a class="postlink" href="http://imetal.nl/" target="_blank">Website / Blog</a>
<br/>
<br/>
Let the nds be with you.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164659 - sverx - Wed Nov 12, 2008 5:07 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>hacker013 wrote:</b></span></td> </tr> <tr> <td class="quote">i go to use that in the new Xsystem Release</td> </tr></table><span class="postbody">
<br/>
<br/>
if you plan to write a routine to load XMs from a filesystem I can help you with that, if you need.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164668 - hacker013 - Wed Nov 12, 2008 8:53 pm</h4>
    <div class="postbody"><span class="postbody">That would be great, but i have first to make the pluginsystem to work.<br/>_________________<br/><a class="postlink" href="http://imetal.nl/" target="_blank">Website / Blog</a>
<br/>
<br/>
Let the nds be with you.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164859 - sverx - Wed Nov 26, 2008 7:42 pm</h4>
    <div class="postbody"><span class="postbody">Hi!
<br/>
  a short post to let you know I'm working hard these days on libxm7 to achieve soon the support of 80% of all the possible XM effects, of course the more common, first.
<br/>
If somebody has some XMs to help me test effects... (I'm currectly testing effects 1xx, 2xx, 3xx, E1x, E2x, X1x, X2x and volume column effect Mx) please point them to me.
<br/>
Thanks! :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164919 - sverx - Mon Dec 01, 2008 12:36 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>shaymanjw wrote:</b></span></td> </tr> <tr> <td class="quote">There does seem to be a slight problem using playSound - it sounds like it's ignoring the sampleRate specified (as per the example, I commented out startSound in the ARM7 code - if I change the name to startSound2 for example, and then reference this in the VblankHandler code then the playSound stuff sounds fine).
<br/>
<br/>
The other option is that it's a bug in the original startSound routine.
<br/>
<br/>
Would appreciate your thoughts.</td> </tr></table><span class="postbody">
<br/>
<br/>
Ow! Only now I realized it was my fault! It'll be corrected in the next version of the library, which <span style="font-style: italic">I hope</span> I'll release before the end of December... sorry :|
<br/>
<br/>
(yes, you have to rename startSound() to something else, if you need to use it, actually...)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
