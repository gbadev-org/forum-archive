<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Easy GL2D(A Fast & Easy to use 2D lib) - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>DS homebrew announcements > Easy GL2D(A Fast & Easy to use 2D lib)</h2>
<div id="posts">
<div class="post">
    <h4>#175458 - relminator - Thu Nov 25, 2010 7:45 am</h4>
    <div class="postbody"><span class="postbody">A very small, simple, yet very fast DS 2D rendering lib using the DS' 3D core.
<br/>
<br/>
<a href="http://rel.betterwebber.com/images/screenies/gl2d_ds_1.png">[Images not permitted - Click here to view it]</a>
<br/>
<a href="http://rel.betterwebber.com/images/screenies/gl2d_ds_2.png">[Images not permitted - Click here to view it]</a>
<br/>
<br/>
<br/>
Download:
<br/>
<br/>
<a class="postlink" href="http://rel.phatcode.net/junk.php?id=117" target="_blank">http://rel.phatcode.net/junk.php?id=117</a>
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Notice:
<br/>
	* glColorTable() has been deprecated since the release of libnds 1.5.0.
<br/>
	  Because of the it, stencil effects are not possible w/o some hacks so I just disabled it altogether.  However, rendering sprites in any palette is a lot easier now since palettes are automatically managed by libnds. 
<br/>
<br/>
	* You also need to tell libnds what VRAM bank you want allocate for
<br/>
	  texture palettes. See the example files.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Update 02/17/2011
<br/>
<br/>
	* Code overhaul for libnds 1.5.0 compatibility
<br/>
	* Added 2 parameters to glSpriteLoad() and glSpriteLoad()
<br/>
	* Fixed the examples to reflect changes
<br/>
	* Doxygen generated reference
<br/>
	* Bug fixes(reported by Enay, Mhaun, Alex Sinclair, etc)
<br/>
<br/>
Update 11/25/2010
<br/>
<br/>
	* Documentation and user's guide done. (User's guide is also a mini-tutorial of sorts)
<br/>
	* Added a dual_screen example.
<br/>
	* Updated the sprites example
<br/>
<br/>
Update 11/23/2010
<br/>
<br/>
	* Fixed a bug where drawing primitives messed up the sprite colors. (missing currenttexture = 0 call)
<br/>
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
Reasons to use Easy GL2D:
<br/>
<br/>
1. Library size is very small (less than 10 kb)
<br/>
2. Very fast
<br/>
3. Easy to maintain and refactor existing code
<br/>
4. Abstracted interface
<br/>
5. Code is easily portable to other platforms
<br/>
6. Can combine 2D and 3D seamlessly
<br/>
7. Almost unlimited palette usage in a single frame
<br/>
8. Can handle non-power of 2 sprites
<br/>
9. 3 types of translucency (2 via textures and 1 via polygon format)
<br/>
10. Lots of sprite effects (colors, alpha, rotation, scaling, shearing, etc.)
<br/>
11. Optimum VRAM use
<br/>
12. Paletted(almost limitless) and high-color mode can be used together.
<br/>
<br/>
<br/>
Limitations:
<br/>
<br/>
1. Emulators are slower in emulating the 3d hardware than the OAM.
<br/>
2. glPutPixel, glLine and glBox only works on a real DS and No$GBA and not on deSmuMe.
<br/>
3. You still have to learn how to use the sub OAM and sub BG since this lib is main engine
<br/>
   only. You can use the video capture to render on both screens but that would limit your
<br/>
   FPS and would use valuable VRAM.
<br/>
<br/>
<br/>
<br/>
Installation: 
<br/>
<br/>
1 . Copy the distributable/libnds folder to your devkitPro directory.
<br/>
    or you can copy the /include and /lib folders under the /libnds directory of devkitPro.
<br/>
    ie.
<br/>
	*Assuming you installed devkitPro in c:/devkitPro/
<br/>
<br/>
	c:/devkitPro/libnds/include/gl2d.h   
<br/>
	c:/devkitPro/libnds/lib/libgl2d.a
<br/>
<br/>
2.  Edit this line in your makefile and add gl2d before libnds
<br/>
    ie.
<br/>
	LIBS	:= -lnds9
<br/>
<br/>
<br/>
	to
<br/>
<br/>
<br/>
	LIBS	:= -lgl2d -lnds9
<br/>
<br/>
<br/>
<br/>
<br/>
4. Add #include &lt;gl2d.h&gt; to your source. 
<br/>
<br/>
5. Done! You can now use gl2d
<br/>
<br/>
<br/>
Note:
<br/>
<br/>
Easy GL2D DS works perfectly on a Real DS.
<br/>
<br/>
However, if you are running this on an emulator...
<br/>
No$GBA - works perfectly.
<br/>
deSmuMe - use the soft rasterizer instead of OpenGL<br/>_________________<br/><a href="http://rel.betterwebber.com" target="_blank">http://rel.betterwebber.com</a></span><span class="gensmall"><br/><br/>Last edited by relminator on Fri Feb 18, 2011 3:32 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#175618 - sverx - Wed Jan 05, 2011 4:56 pm</h4>
    <div class="postbody"><span class="postbody">I've read the docs (and the source!) and it's very interesting!
<br/>
Thanks for sharing it with us :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175621 - SchmendrickSchmuck - Fri Jan 07, 2011 10:12 pm</h4>
    <div class="postbody"><span class="postbody">Relminator, I've tried using parts of your code in a 'framework' I've been working on, but I notice a severe slowdown when 500 sprites are shown simultaneously, and with 700+ the framerate slows down to what looks like 30 or even 15 fps. Do you experience similar slowdowns in your original version? Also, on an actual DS, when there's several sprites overlapping each other, they tend to 'clear out' some parts of the image, where on emulators they display just fine. Is this a depth issue, or a blending issue? I'm not at all familiar with openGL or 3D on the DS in general, so I was hoping you could help me out with that.
<br/>
<br/>
<span style="font-weight: bold">EDIT</span>
<br/>
I've tried auto-incrementing the depth for each sprite draw call, but it doesn't seem to fix anything. Please see GameFramework.nds on <a href="http://temp.dennisvanzwieten.com/" target="_blank">http://temp.dennisvanzwieten.com/</a> if I'm not making any sense.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175624 - relminator - Mon Jan 10, 2011 3:34 am</h4>
    <div class="postbody"><span class="postbody">sverx: No prob. It's just my small way of contributing to this community.  BTW, I like your game. ;*)
<br/>
<br/>
SchmendrickSchmuck: Pretty nice demo. Slowdowns are certainly apparent on emulators as they emulate the 2d engine much better than the 3d engine.  However on a real DS, I've never really gone down to 30 FPS even with more than 1000 sprites on screen.  The only time I had slowdowns on a real DS is when I combined lots of vertex heavy 3d BG with 2d sprites.. I would assume your collision code is not well optimized.  Try not to use floats (if you are using them) for collisions. 
<br/>
As for the overlap issue, the way I fixed them is to use a static global depth value resetted every frame and incremented every glSprite call.  You will also notice that I pump 3 coords on my first glVertex call and just 2 on the other 3 verts for speed.
<br/>
<br/>
If all else fails, try to send your source on my e-mail and I'll see what I can do.<br/>_________________<br/><a href="http://rel.betterwebber.com" target="_blank">http://rel.betterwebber.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175626 - sverx - Mon Jan 10, 2011 11:23 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>relminator wrote:</b></span></td> </tr> <tr> <td class="quote"> [...] a static global depth value resetted every frame and incremented every glSprite call.</td> </tr></table><span class="postbody">
<br/>
<br/>
I saw that when watching the sources... and I was curious about the fact that you started from the back coming to the foreground... will this mean that if somebody tries to put too many objects in there there will be objects not appearing on top of others? Is there any other reason why you choosed to start from back and increment instead of starting from front and decrement?
<br/>
<br/>
Thanks :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175632 - relminator - Tue Jan 11, 2011 1:50 am</h4>
    <div class="postbody"><span class="postbody">OpenGL uses the "right-handed" cartesian coordinate system where -z is farther than +z.  So we add instead of subtract from that global depth buffer.
<br/>
<br/>
Edit:  Oh you might want to use -2048 for znear in this statement:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">glOrthof32( 0, SCREEN_WIDTH, SCREEN_HEIGHT, 0, -1024, 1 &lt;&lt; 12 );</td> </tr></table><span class="postbody">
<br/>
<br/>
I made the mistake of setting z-near to -1024.  Setting it to -2048 instead of -1024 would set   Z = 0 to -2048 so you can blit 1500 sprites with no worries.<br/>_________________<br/><a href="http://rel.betterwebber.com" target="_blank">http://rel.betterwebber.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175635 - sverx - Tue Jan 11, 2011 10:23 am</h4>
    <div class="postbody"><span class="postbody">I don't get what you mean (I'm sorry, it's my English that isn't as good as I'd like)...
<br/>
<br/>
Should we call the drawing functions from front to back, then? :|</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175639 - SchmendrickSchmuck - Tue Jan 11, 2011 8:19 pm</h4>
    <div class="postbody"><span class="postbody">It can't be my collision, it slows down around 500 sprites even without. The collision code is just a couple of array index lookups anyway. I'm not using any floats as far as I know, unless dividing by 100 implicitly turns ints into floats before casting them back to ints.. I'll send you my source later, maybe you can find things I can further optimize.
<br/>
<br/>
Also, I think what sverx wants to know is why you chose back-to-front sprite rendering as opposed to front-to-back, and whether it has anything to do with sprites hiding others.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175642 - DiscoStew - Wed Jan 12, 2011 4:44 am</h4>
    <div class="postbody"><span class="postbody">Using floats on a device without an FPU uses up more CPU time because code for handling them is done via software instead of hardware, just as a reference.
<br/>
<br/>
When dividing, are you using '/', because if you are, then that's more cycles used up. Use the divide functions from libnds, as they reference the hardware divide and such.<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175644 - sverx - Wed Jan 12, 2011 11:21 am</h4>
    <div class="postbody"><span class="postbody">if you use '/' between two ints, this won't turn them into float, of course. BTW if you want it to be faster just don't divide by 100, divide by 128 for instance, or just don't divide (multiply, if possible...)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175652 - relminator - Thu Jan 13, 2011 9:37 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sverx wrote:</b></span></td> </tr> <tr> <td class="quote">I don't get what you mean (I'm sorry, it's my English that isn't as good as I'd like)...
<br/>
<br/>
Should we call the drawing functions from front to back, then? :|</td> </tr></table><span class="postbody">
<br/>
<br/>
When the system is "right-handed" (OpenGL is right-handed and D3D is left-handed), increasing the value of Z positively makes the vertex nearer.
<br/>
<br/>
ie. 100 is nearer than 50 in a right-handed system.
<br/>
<br/>
So by increasing that global depth buffer, We essentially draw our polygons from the far to near mimicking what is called the "painter's algorithm".
<br/>
<br/>
This could have been a non-issue if the DS hardware can disable depth-testing but Nintendo somehow didn't include it. 
<br/>
<br/>
<br/>
SchmendrickSchmuck:  For a real 3D rendering engine, front to back is faster since it reduces fillrate(though I'm not sure if the DS's 3D hardware implements this optimization). Easy GL2D is a 2d renderer so, we cannot do front to back rendering. I tried that on my first attempts and as you already know, fragments don't get drawn correctly.
<br/>
<br/>
As sverx and DiscoStew already mentioned, divide only if possible by 2^n values as GCC can optimize it into a shift.<br/>_________________<br/><a href="http://rel.betterwebber.com" target="_blank">http://rel.betterwebber.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175657 - sverx - Thu Jan 13, 2011 11:16 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>relminator wrote:</b></span></td> </tr> <tr> <td class="quote"> [...] We essentially draw our polygons from the far to near mimicking what is called the "painter's algorithm".
<br/>
[...] Easy GL2D is a 2d renderer so, we cannot do front to back rendering. I tried that on my first attempts and as you already know, fragments don't get drawn correctly.</td> </tr></table><span class="postbody">
<br/>
<br/>
This is curious. So you mean if I change your code and start painting near to far (the inverse of what I would do with the so called "painter's algorithm"), would I get into trouble? :| What issues I'd encounter?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175658 - relminator - Thu Jan 13, 2011 11:22 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sverx wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>relminator wrote:</b></span></td> </tr> <tr> <td class="quote"> [...] We essentially draw our polygons from the far to near mimicking what is called the "painter's algorithm".
<br/>
[...] Easy GL2D is a 2d renderer so, we cannot do front to back rendering. I tried that on my first attempts and as you already know, fragments don't get drawn correctly.</td> </tr></table><span class="postbody">
<br/>
<br/>
This is curious. So you mean if I change your code and start painting near to far (the inverse of what I would do with the so called "painter's algorithm"), would I get into trouble? :| What issues I'd encounter?</span></td> </tr></table><span class="postbody">
<br/>
<br/>
One issue I faced was that far fragments in a polygon won't get drawn if they share the same location on the screen.<br/>_________________<br/><a href="http://rel.betterwebber.com" target="_blank">http://rel.betterwebber.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175659 - sverx - Thu Jan 13, 2011 12:14 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>relminator wrote:</b></span></td> </tr> <tr> <td class="quote">One issue I faced was that far fragments in a polygon won't get drawn if they share the same location on the screen.</td> </tr></table><span class="postbody">
<br/>
<br/>
...and you mean you get this behavior only when drawing in 'reverse' order? It's very curious... do you imagine any reason behind this?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175660 - relminator - Thu Jan 13, 2011 12:47 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sverx wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>relminator wrote:</b></span></td> </tr> <tr> <td class="quote">One issue I faced was that far fragments in a polygon won't get drawn if they share the same location on the screen.</td> </tr></table><span class="postbody">
<br/>
<br/>
...and you mean you get this behavior only when drawing in 'reverse' order? It's very curious... do you imagine any reason behind this?</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Reverse or equal actually.
<br/>
<br/>
The only reason I could think of is that the DS 3d hardware optimizing to reduce fillrate (like almost all current PC GFX hardware).
<br/>
<br/>
ie. Only draw a fragment(pixel)  if the said fragment is nearer than the value in the depth buffer.<br/>_________________<br/><a href="http://rel.betterwebber.com" target="_blank">http://rel.betterwebber.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175661 - sverx - Thu Jan 13, 2011 1:40 pm</h4>
    <div class="postbody"><span class="postbody">I see, but I really think if it's so it's like a bug. I mean... shouldn't I be free to describe a 3D scene by describing everything that's in there in whatsoever order I want and obtain the same result? Really, I'm completely a newbie speaking about 3D, maybe there's something I miss...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175662 - relminator - Thu Jan 13, 2011 2:47 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sverx wrote:</b></span></td> </tr> <tr> <td class="quote">I see, but I really think if it's so it's like a bug. I mean... shouldn't I be free to describe a 3D scene by describing everything that's in there in whatsoever order I want and obtain the same result? Really, I'm completely a newbie speaking about 3D, maybe there's something I miss...</td> </tr></table><span class="postbody">
<br/>
<br/>
Yes on the PC side of things, you can disable depth-testing(usually done for z-sorted smoke effects or anything translucent). But the DS does not have that functionality. I wish it had since it would make implementing a 2D lib easier.
<br/>
<br/>
But if you are using some sort of depth-testing(or even a software z-buffer), that's just the way it works. Front-to-back is faster than back-to-front because it reduces the number of fragments drawn on the framebuffer.<br/>_________________<br/><a href="http://rel.betterwebber.com" target="_blank">http://rel.betterwebber.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175666 - sverx - Thu Jan 13, 2011 4:56 pm</h4>
    <div class="postbody"><span class="postbody">I see. I was thinking that there wasn't any elaboration started before the end of the list of objects, so I was really thinking that it wouldn't change.
<br/>
Good to know, thanks. :)
<br/>
<br/>
Does Grit or your texture packer supports texture formats 1 and/or 6? (those A3I5/A5I3 textures)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175667 - relminator - Thu Jan 13, 2011 5:23 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sverx wrote:</b></span></td> </tr> <tr> <td class="quote">I see. I was thinking that there wasn't any elaboration started before the end of the list of objects, so I was really thinking that it wouldn't change.
<br/>
Good to know, thanks. :)
<br/>
<br/>
Does Grit or your texture packer supports texture formats 1 and/or 6? (those A3I5/A5I3 textures)</td> </tr></table><span class="postbody">
<br/>
<br/>
My texture packer certainly does not support that(I don't know a good image lib that supports those formats). Though you could texturepack then convert to any format you like in your own fav image editor.
<br/>
<br/>
I'm not sure about grit though. 
<br/>
<br/>
<br/>
In fact, I've never tried those formats yet. I don't even know where to start. Tell me if you find an image editor that supports it. I'd really love to use per-pixel alpha blending.
<br/>
<br/>
;*)<br/>_________________<br/><a href="http://rel.betterwebber.com" target="_blank">http://rel.betterwebber.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175668 - Rajveer - Thu Jan 13, 2011 7:44 pm</h4>
    <div class="postbody"><span class="postbody">Tex Mex from Sausage Boy supports converting alpha images to formats 1 and 6, the latest version that I'm aware of is 0.04. There is a small bug, where if you are using a paletted texture without transparency, you have to use it with it's threshold command (-th) set to 0.
<br/>
<br/>
Here's a link <a href="http://blog.dev-scene.com/gaspcubed/2007/10/06/texmex-004/" target="_blank">http://blog.dev-scene.com/gaspcubed/2007/10/06/texmex-004/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175673 - sverx - Fri Jan 14, 2011 10:29 am</h4>
    <div class="postbody"><span class="postbody">I will try this Tex Mex, thanks, I didn't know about that. Actually the only test I've done with a A5I3 texture was done by using a 32-level grayscale bitmap (thus giving me a single color - per pixel alpha - texture. Quite simple, but not bad, really)
<br/>
<br/>
Oh, it even worked with per pixel blending with 2D backgrounds behind the 3D layer :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175845 - relminator - Fri Feb 18, 2011 3:37 am</h4>
    <div class="postbody"><span class="postbody">I had just updated the lib.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Notice:
<br/>
	* glColorTable() has been deprecated since the release of libnds 1.5.0.
<br/>
	  Because of the it, stencil effects are not possible w/o some hacks so I just disabled it altogether.  However, rendering sprites in any palette is a lot easier now since palettes are automatically managed by libnds. 
<br/>
<br/>
	* You also need to tell libnds what VRAM bank you want allocate for
<br/>
	  texture palettes. See the example files.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Update 02/17/2011
<br/>
<br/>
	* Code overhaul for libnds 1.5.0 compatibility
<br/>
	* Added 2 parameters to glSpriteLoad() and glSpriteLoad()
<br/>
	* Fixed the examples to reflect changes
<br/>
	* Doxygen generated reference
<br/>
	* Bug fixes(reported by Enay, Mhaun, Alex Sinclair, etc)
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
also, go vote in the poll WinterMute set on devkitPro.org - <a href="http://devkitpro.org/viewtopic.php?f=25&amp;t=2333" target="_blank">http://devkitpro.org/viewtopic.php?f=25&amp;t=2333</a><br/>_________________<br/><a href="http://rel.betterwebber.com" target="_blank">http://rel.betterwebber.com</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
