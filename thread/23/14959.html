<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Midi file parser - unfinished - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS homebrew announcements > Midi file parser - unfinished</h2>
<div id="posts">
<div class="post">
    <h4>#150290 - load*,8,1 - Fri Feb 01, 2008 4:43 pm</h4>
    <div class="postbody"><span class="postbody">For OpenTTD I've been trying to put together a midi player for the Nintendo DS. Unfortunately I'm completely lacking any sound programming experience. Hence my plan was to modify <a class="postlink" href="http://dsmidiwifi.tobw.net/index.php" target="_blank">0xtob's PulseDS</a> to play midi files.
<br/>
<br/>
I do have it running now, but the music it produces is very disappointing. And further improving it is too much work for me because I'd rather concentrate on the OpenTTD port some more.
<br/>
<br/>
I hope someone with PSG or sound experience will pick this up and improve the quality. Or to encourage someone to make a arm7 midi player on their own, because quite a few game ports could use one.
<br/>
<br/>
Current status:
<br/>
- the sample binary plays a crippled version of Beethoven's 5th Symphony 
<br/>
- most midi events are parsed correctly and being sent to the arm7
<br/>
- a few events (e.g. time signature) are not being interpreted
<br/>
- the timing seems to be a little off. I'm not sure why though
<br/>
- the arm7 side needs much work. Either the PSG sounds could be improved or a small soundfont could be used
<br/>
- The arm9 code should be moved to arm7 to make it into a pure arm7 player
<br/>
<br/>
<a class="postlink" href="http://dominik.scherer.de/playmidi.tar.bz2" target="_blank">DOWNLOAD (68 KB)</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#150510 - Kojote - Tue Feb 05, 2008 11:07 pm</h4>
    <div class="postbody"><span class="postbody">good luck with your futher development!<br/>_________________<br/><span style="font-weight: bold">Kojote</span>
<br/>
PDRoms - Retroguru - Giana's Return - Speckdrumm</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#150539 - BastarB - Wed Feb 06, 2008 2:23 pm</h4>
    <div class="postbody"><span class="postbody">Is "load*,8,1" = "Dominik81"???
<br/>
<br/>
The EZ flash 5 kernel plays midi files on several channels simultaneously!
<br/>
I tried to play the music from Transport Tycoon on it this morning!
<br/>
The rythm is okej, but some instruments is out of pitch!
<br/>
The EZ5 Kernel is a modified version of moonshell!
<br/>
<br/>
Here's the download link to the sourcecode of Moonshell: <a href="http://mdxonline.dyndns.org/archives/2007/03/moonshell_ver171_dl.shtml" target="_blank">http://mdxonline.dyndns.org/archives/2007/03/moonshell_ver171_dl.shtml</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153052 - theli - Mon Mar 24, 2008 4:33 pm</h4>
    <div class="postbody"><span class="postbody">you had a little bug in your tracks' linked list rearrangement and in some moments some tracks just disappeared... this sound a little better without tracks disappearing
<br/>
<br/>
edit .. i've changed frequencies table to more pleasant for my ears  and reuploaded file :)
<br/>
<a href="http://theli.ho.com.ua/temp/playmidi.nds" target="_blank">http://theli.ho.com.ua/temp/playmidi.nds</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153125 - theli - Tue Mar 25, 2008 11:13 am</h4>
    <div class="postbody"><span class="postbody">i was playing with playing midis on PSG a little more and i need an opinion: 
<br/>
is this really worth it?
<br/>
i mean .. even if me or someone else will write a midi player for arm7 using PSG what could be the use of such library?
<br/>
.. .doomds can use mp3 for music(i don't know if it supports midi music from original wads), scummvm uses adlib emulation and gm to adlib events mapping (i think) ... openttd can also use such approach ... (or even use mp3s as doomds does)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153142 - nczempin - Tue Mar 25, 2008 3:18 pm</h4>
    <div class="postbody"><span class="postbody">I'll pick it up; I'm working on a synth, it won't be restricted to PSD (you can't do very much with those anyway). And some kind of sequencer will be required anyway. In the end it depends how much memory the different facilities will require.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153144 - theli - Tue Mar 25, 2008 5:17 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>nczempin wrote:</b></span></td> </tr> <tr> <td class="quote">I'll pick it up; I'm working on a synth, it won't be restricted to PSD (you can't do very much with those anyway). And some kind of sequencer will be required anyway. In the end it depends how much memory the different facilities will require.</td> </tr></table><span class="postbody">
<br/>
heh .. although i like the idea of midi sofsynth using PSG .. 6 PSG channels is not really enough :( ... here another demo... i've added some effects like bend pitch, panning, sustain and volume handling
<br/>
<a href="http://theli.ho.com.ua/temp/playmidi_poprock.nds" target="_blank">http://theli.ho.com.ua/temp/playmidi_poprock.nds</a>
<br/>
demo plays this MIDI file
<br/>
<a href="http://theli.ho.com.ua/temp/MIDIPC_1.MID" target="_blank">http://theli.ho.com.ua/temp/MIDIPC_1.MID</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153146 - eKid - Tue Mar 25, 2008 5:49 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>theli wrote:</b></span></td> </tr> <tr> <td class="quote">heh .. although i like the idea of midi sofsynth using PSG .. 6 PSG channels is not really enough :(</td> </tr></table><span class="postbody">
<br/>
8 tiny waveforms + a little magic = 16 PSG channels :P</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153147 - load*,8,1 - Tue Mar 25, 2008 5:49 pm</h4>
    <div class="postbody"><span class="postbody">Greet work, theli. It does sound a lot better already. Did you try the original TTD music midis as well? How do they sound like?
<br/>
I think using sound channels 8-15 for midi will be ok. 8 channels for sound effects seems to be enough.
<br/>
<br/>
I didn't realize ScummVM had Adlib support and I wasn't aware that TTD's music does exist in Adlib format. 
<br/>
But apparently <a class="postlink" href="http://www.ttdpatch.net/chris_becke_ttdlx.html" target="_blank">it does</a>. I'm not sure yet how ScummVM accomplishes this. Do they use a software syntheziser on the ARM9 side?
<br/>
<br/>
The bottleneck in OpenTTD is memory. It's already hardly playable as it is (and not playable at all on original-sized maps). I couldn't possibly sacrifice any amount of memory for a sound font. Therefore I was aiming at PSG sounds which can produce nice sounds. And converting the music to a mod format is not possible due to copyright issues.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153195 - theli - Wed Mar 26, 2008 7:29 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>eKid wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>theli wrote:</b></span></td> </tr> <tr> <td class="quote">heh .. although i like the idea of midi sofsynth using PSG .. 6 PSG channels is not really enough :(</td> </tr></table><span class="postbody">
<br/>
8 tiny waveforms + a little magic = 16 PSG channels :P</span></td> </tr></table><span class="postbody">
<br/>
idea was to leave non-psg channels for sound effects</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153196 - theli - Wed Mar 26, 2008 7:31 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>load*,8,1 wrote:</b></span></td> </tr> <tr> <td class="quote">I didn't realize ScummVM had Adlib support and I wasn't aware that TTD's music does exist in Adlib format. 
<br/>
But apparently <a class="postlink" href="http://www.ttdpatch.net/chris_becke_ttdlx.html" target="_blank">it does</a>. I'm not sure yet how ScummVM accomplishes this. Do they use a software syntheziser on the ARM9 side?
<br/>
</td> </tr></table><span class="postbody">
<br/>
i think yes but i'm not sure. i think you can ask agentq directly :)
<br/>
also i know that scummvm has support of playing midis through adlib</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153224 - theli - Wed Mar 26, 2008 5:04 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>load*,8,1 wrote:</b></span></td> </tr> <tr> <td class="quote">Greet work, theli. It does sound a lot better already. Did you try the original TTD music midis as well? How do they sound like?</td> </tr></table><span class="postbody">
<br/>
not very good... it seems to me that there are some big problems with timing ... i need to look into some sofsynth player (like timidity) to figure out all this timing stuff .... once i'm done with timing i will know whether it is a viable solution to play midis on psg :D
<br/>
but i've added dynamical midi-&gt;psg channel assignment and poor man's drums :D
<br/>
<a href="http://theli.ho.com.ua/temp/playmidi_poprock.nds" target="_blank">http://theli.ho.com.ua/temp/playmidi_poprock.nds</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153296 - theli - Thu Mar 27, 2008 10:47 pm</h4>
    <div class="postbody"><span class="postbody">well, i've got lost in all timing stuff so i just threw in libjdkmidi for working with smf format...
<br/>
if anyone wants to try here it is:
<br/>
<a href="http://theli.ho.com.ua/temp/playmidi.nds" target="_blank">http://theli.ho.com.ua/temp/playmidi.nds</a>
<br/>
it loads /test.mid from flash
<br/>
lower screen has 16 buttons for disabling/enabling 16 midi channels
<br/>
( 
<br/>
00,01,02,03,
<br/>
04,05,06,07,
<br/>
08,09,10,11,
<br/>
12,13,14,15
<br/>
)
<br/>
<br/>
if anyone cares here is the source
<br/>
<a href="http://theli.ho.com.ua/temp/playmidi.tar.bz2" target="_blank">http://theli.ho.com.ua/temp/playmidi.tar.bz2</a>
<br/>
<br/>
sooo... anyone care to help? :(
<br/>
though i don't know what can be done ... 
<br/>
probably better tunings/(other ideas of improving sound :) )/etc ...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153591 - theli - Wed Apr 02, 2008 4:01 pm</h4>
    <div class="postbody"><span class="postbody">well, now with the softsynth way... here is what i came out with ...
<br/>
adlib midi emulation ripped from scummvm and converted to C from C++
<br/>
<br/>
any advices/help on arm7 side is greatly welcomed
<br/>
you can tune some parameters in arm7/fmopl.h arm7/adlib.h
<br/>
and i need better adlib_update()(may be some buffering?) stuff in adlib.c
<br/>
edit: sorry .. seems i have uploaded wrong version and left code at workplace :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153613 - Lazy1 - Wed Apr 02, 2008 9:36 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>theli wrote:</b></span></td> </tr> <tr> <td class="quote">well, now with the softsynth way... here is what i came out with ...
<br/>
adlib midi emulation ripped from scummvm and converted to C from C++
<br/>
<br/>
any advices/help on arm7 side is greatly welcomed
<br/>
you can tune some parameters in arm7/fmopl.h arm7/adlib.h
<br/>
and i need better adlib_update()(may be some buffering?) stuff in adlib.c
<br/>
edit: sorry .. seems i have uploaded wrong version and left code at workplace :(</td> </tr></table><span class="postbody">
<br/>
<br/>
Adlib emulation on the arm7 would be very useful for my Wolfenstein 3D port.
<br/>
Maybe I can help you out a bit with this and see if we can get something working.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153633 - theli - Thu Apr 03, 2008 7:42 am</h4>
    <div class="postbody"><span class="postbody">ok, i hope i didn't messed something up this time :D
<br/>
here is the source which needs help ;)
<br/>
<a href="http://theli.ho.com.ua/temp/playmidi_adlib.rar" target="_blank">http://theli.ho.com.ua/temp/playmidi_adlib.rar</a>
<br/>
maybe using a ring buffer would be nice? :(
<br/>
anyway for now i'm going to switch to parsing midi on arm7 and use a circular buffer for rendering</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153657 - Cid2Mizard - Thu Apr 03, 2008 3:30 pm</h4>
    <div class="postbody"><span class="postbody">Good works Theli
<br/>
<br/>
And for use with palib, it's possible to create only one .h for input  ?<br/>_________________<br/><a href="http://www.nintendomax.com" target="_blank">www.nintendomax.com</a> 100% Hack 0% Warez</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153661 - theli - Thu Apr 03, 2008 4:03 pm</h4>
    <div class="postbody"><span class="postbody">erm ... it is , actually , not usable at the moment :P</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153663 - nczempin - Thu Apr 03, 2008 5:02 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>theli wrote:</b></span></td> </tr> <tr> <td class="quote">well, i've got lost in all timing stuff so i just threw in libjdkmidi for working with smf format...
<br/>
if anyone wants to try here it is:
<br/>
<a href="http://theli.ho.com.ua/temp/playmidi.nds" target="_blank">http://theli.ho.com.ua/temp/playmidi.nds</a>
<br/>
it loads /test.mid from flash
<br/>
lower screen has 16 buttons for disabling/enabling 16 midi channels
<br/>
( 
<br/>
00,01,02,03,
<br/>
04,05,06,07,
<br/>
08,09,10,11,
<br/>
12,13,14,15
<br/>
)
<br/>
<br/>
if anyone cares here is the source
<br/>
<a href="http://theli.ho.com.ua/temp/playmidi.tar.bz2" target="_blank">http://theli.ho.com.ua/temp/playmidi.tar.bz2</a>
<br/>
<br/>
sooo... anyone care to help? :(
<br/>
though i don't know what can be done ... 
<br/>
probably better tunings/(other ideas of improving sound :) )/etc ...</td> </tr></table><span class="postbody">
<br/>
<br/>
As I said, I'll take a look. It's just that I am extremely busy right now; all my DS projects are on hold for now, probably till the end of the month. Then I'll pick up the things I started and consolidate until my only major project is the Synthesizer, with perhaps a little bit of playing around with a flight sim.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153669 - theli - Thu Apr 03, 2008 6:00 pm</h4>
    <div class="postbody"><span class="postbody">anyway i have midi playing on arm7 using fm sofsynth rather nicely now :P
<br/>
here is latest progress where everything moved to arm7 and renders to ringbuffer
<br/>
<a href="http://theli.ho.com.ua/temp/playmidi_adlib.nds" target="_blank">http://theli.ho.com.ua/temp/playmidi_adlib.nds</a>
<br/>
source:
<br/>
<a href="http://theli.ho.com.ua/temp/playmidi_adlib.rar" target="_blank">http://theli.ho.com.ua/temp/playmidi_adlib.rar</a>
<br/>
<br/>
though wintermute said that in future there will be no IPC stuff and no custom arm7 cores :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#155194 - theli - Sat Apr 26, 2008 10:00 am</h4>
    <div class="postbody"><span class="postbody">ok, this is yet another demo
<br/>
based on wintermute's code he was writing for dsdoom with minor modification(mostly moving buffer rendering to arm from thumb) so it uses slightly less then 100% of arm7 and leaves enough cpu to update buttons,touch data (it should be enough for starting sounds too i think)
<br/>
demo has tunes from doom, one from TTD and one from warcraft2 :)
<br/>
l/r switch melodies
<br/>
a/b start/stop
<br/>
its stereo and all is done on arm7
<br/>
<a href="http://theli.ho.com.ua/temp/opl_test.nds" target="_blank">http://theli.ho.com.ua/temp/opl_test.nds</a>
<br/>
(it sounds better on hw than in no$gba)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164363 - hacker013 - Wed Oct 29, 2008 5:53 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>theli wrote:</b></span></td> </tr> <tr> <td class="quote">ok, this is yet another demo
<br/>
based on wintermute's code he was writing for dsdoom with minor modification(mostly moving buffer rendering to arm from thumb) so it uses slightly less then 100% of arm7 and leaves enough cpu to update buttons,touch data (it should be enough for starting sounds too i think)
<br/>
demo has tunes from doom, one from TTD and one from warcraft2 :)
<br/>
l/r switch melodies
<br/>
a/b start/stop
<br/>
its stereo and all is done on arm7
<br/>
<a href="http://theli.ho.com.ua/temp/opl_test.nds" target="_blank">http://theli.ho.com.ua/temp/opl_test.nds</a>
<br/>
(it sounds better on hw than in no$gba)</td> </tr></table><span class="postbody">
<br/>
<br/>
Can you post the source?<br/>_________________<br/><a class="postlink" href="http://imetal.nl/" target="_blank">Website / Blog</a>
<br/>
<br/>
Let the nds be with you.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164364 - theli - Wed Oct 29, 2008 7:15 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>hacker013 wrote:</b></span></td> </tr> <tr> <td class="quote">Can you post the source?</td> </tr></table><span class="postbody">
<br/>
sorry, no
<br/>
i was asked not to do this (thats why i abandoned it)
<br/>
<br/>
for midi playing you can look at wolf3d . it should have more up-to-date implementation i think (haven't looked by myself)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164371 - Lazy1 - Wed Oct 29, 2008 9:36 pm</h4>
    <div class="postbody"><span class="postbody">There is no midi in wolf3d, though you might be able to play MIDI files through an OPL2 emulator like the one in ScummVM.
<br/>
<br/>
Don't expect much though, it can only run at 11KHz on the ARM7 without playback problems and I needed to do quite a few hacks to get any sound out of it at all.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164385 - tepples - Thu Oct 30, 2008 4:20 am</h4>
    <div class="postbody"><span class="postbody">Once you've parsed out note on/off commands, rendering MIDI to audio would be much more efficient on this platform with a sampled sound bank than with an OPL2 emulator. Even official GBA games such as WarioWare use MIDI with sampled instruments, and the GBA didn't even have the hardware PCM mixer that the DS has.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164403 - theli - Thu Oct 30, 2008 4:24 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Once you've parsed out note on/off commands, rendering MIDI to audio would be much more efficient on this platform with a sampled sound bank than with an OPL2 emulator. </td> </tr></table><span class="postbody">
<br/>
i remember someone stating he was working on such thing ... haven't seen anything though ...
<br/>
anyway, if someone do wants to create such a synth here is probably a smallest GM soundfont i've ever seen (1Mb):
<br/>
<a href="http://www.saunalahti.fi/kru99/SYNTHGMS.SF2" target="_blank">http://www.saunalahti.fi/kru99/SYNTHGMS.SF2</a>
<br/>
samples are at 44100 so it can be smaller by resampling them at a lower rate</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164421 - hacker013 - Fri Oct 31, 2008 6:27 pm</h4>
    <div class="postbody"><span class="postbody">i've downloaded the begin source from the first post, maybe you can say were the bugs are and what for bugs they where. Then can I fix them by my self<br/>_________________<br/><a class="postlink" href="http://imetal.nl/" target="_blank">Website / Blog</a>
<br/>
<br/>
Let the nds be with you.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164562 - theli - Fri Nov 07, 2008 10:25 am</h4>
    <div class="postbody"><span class="postbody"><span style="font-weight: bold">hacker013</span>
<br/>
if you want that PSG stuff - here you go:
<br/>
<a href="http://theli.ho.ua/temp/playmidi_psg.rar" target="_blank">http://theli.ho.ua/temp/playmidi_psg.rar</a>
<br/>
the last version which i played with</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164566 - theli - Fri Nov 07, 2008 2:35 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Once you've parsed out note on/off commands, rendering MIDI to audio would be much more efficient on this platform with a sampled sound bank than with an OPL2 emulator. Even official GBA games such as WarioWare use MIDI with sampled instruments, and the GBA didn't even have the hardware PCM mixer that the DS has.</td> </tr></table><span class="postbody">
<br/>
well, i've tried a soundfont+hardware approach ... but as i have a zero knowledge of sound/music/synth i've failed once again :D
<br/>
here is a source (does nothing more than loading/parsing soundfont, simple midi parsing, locating of samples for instrument+note and samples' data loading on request through fifo)
<br/>
<a href="http://theli.ho.ua/temp/playmidi_sf2.rar" target="_blank">http://theli.ho.ua/temp/playmidi_sf2.rar</a>
<br/>
archive is 915k cause it contains sample midi and soundfont i tested with.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164575 - theli - Fri Nov 07, 2008 8:04 pm</h4>
    <div class="postbody"><span class="postbody">as for soundfont - i wonder whether someone with knowledge of sound synth would like to help? may be some of trackers/tracker_players/tracker_libs authors? :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164621 - sverx - Mon Nov 10, 2008 12:04 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>theli wrote:</b></span></td> </tr> <tr> <td class="quote">as for soundfont - i wonder whether someone with knowledge of sound synth would like to help? may be some of trackers/tracker_players/tracker_libs authors? :(</td> </tr></table><span class="postbody">
<br/>
<br/>
Don't know what your problem is, but if you need maybe I can help... :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164622 - theli - Mon Nov 10, 2008 12:09 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sverx wrote:</b></span></td> </tr> <tr> <td class="quote">Don't know what your problem is, but if you need maybe I can help... :)</td> </tr></table><span class="postbody">
<br/>
well... first of all i don't need how to calculate pitch shifting...
<br/>
using google i found some formulae.. but how do i use them with fixed-point numbers?
<br/>
<br/>
so , basically .. my problem is : 
<br/>
if i have a sample of key 60 (c3) recorded at (for example) 44100 and i want it to sound as some other key ... at which samplerate should i play that sample?
<br/>
(and calculate this using fixed point numbers)
<br/>
<br/>
sverx, sorry my english is also not very good :D
<br/>
<br/>
there are also generators and mdulators defined in soundfont for samples/instruments ... but i just want to start off something :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164623 - sverx - Mon Nov 10, 2008 12:35 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>theli wrote:</b></span></td> </tr> <tr> <td class="quote">well... first of all i don't need how to calculate pitch shifting... using google i found some formulae.. but how do i use them with fixed-point numbers?</td> </tr></table><span class="postbody">
<br/>
<br/>
In my lib, I simply precalculated them for the 12 notes, then it's just a matter of bit-shifting to obtain lower and upper octaves.
<br/>
<br/>
in your case you should multiply 44100 x 2^(x/12), for x that starts from 0 and goes to 11. So you have
<br/>
freq[0]=44100
<br/>
freq[1]=44100 * 2^(1/12)
<br/>
freq[2]=44100 * 2^(2/12)
<br/>
freq[3]=44100 * 2^(3/12)
<br/>
and so on...
<br/>
<br/>
I stored this values in an array, I do not calculate it on the DS :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164624 - theli - Mon Nov 10, 2008 2:27 pm</h4>
    <div class="postbody"><span class="postbody">HEY!!!! i've got something working finally 
<br/>
i'm almost happy this starting to sound :D
<br/>
well, it yet doesn't handle any generators/modulators/envelopes/looping_points and so on ... but as for start i like it veeery much :D
<br/>
check this out:
<br/>
<a href="http://theli.ho.ua/temp/playmidi_sf2_fs.ds.rar" target="_blank">http://theli.ho.ua/temp/playmidi_sf2_fs.ds.rar</a>  - with fscr image appended for testing in no$gba
<br/>
<a href="http://theli.ho.ua/temp/playmidi_sf2_hw.rar" target="_blank">http://theli.ho.ua/temp/playmidi_sf2_hw.rar</a> - for testing on hardware (archive contains test.mid and test.sf2 which binary looks for in / )
<br/>
<br/>
ps: in case someone dares to listen this... do not expect much ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164629 - sverx - Mon Nov 10, 2008 4:54 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>theli wrote:</b></span></td> </tr> <tr> <td class="quote">HEY!!!! i've got something working finally</td> </tr></table><span class="postbody">
<br/>
<br/>
I can recognize the tune ;) It's a beginning, go on! :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164701 - Cid2Mizard - Fri Nov 14, 2008 6:11 pm</h4>
    <div class="postbody"><span class="postbody">who has a theli sourcecode plz ? all link are dead :/<br/>_________________<br/><a href="http://www.nintendomax.com" target="_blank">www.nintendomax.com</a> 100% Hack 0% Warez</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164706 - theli - Fri Nov 14, 2008 9:50 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cid2Mizard wrote:</b></span></td> </tr> <tr> <td class="quote">who has a theli sourcecode plz ? all link are dead :/</td> </tr></table><span class="postbody">
<br/>
what source do you want?
<br/>
you can help with new midi synth iteration.. this time using soundfont :)
<br/>
<a href="http://forum.gbadev.org/viewtopic.php?t=16205" target="_blank">http://forum.gbadev.org/viewtopic.php?t=16205</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
