<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>ProTracker (mod) player for DS - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>DS homebrew announcements > ProTracker (mod) player for DS</h2>
<div id="posts">
<div class="post">
    <h4>#146590 - melw - Thu Dec 06, 2007 2:42 pm</h4>
    <div class="postbody"><span class="postbody">Just happened to notice this, perhaps some people over here will find it useful:
<br/>
<br/>
<a class="postlink" href="http://pagesperso-orange.fr/franck.charlet/DS_PtReplay.zip" target="_blank">Protracker NDS replay</a> by hitchhikr - <span style="font-style: italic">"A protracker files (.mod) replay routine for Nintendo DS, it's a direct conversion from the original Amiga one so it's should be as accurate as possible, also it handles modules from 4 to 16 channels and it's very small."</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146625 - hitchhikr - Thu Dec 06, 2007 10:39 pm</h4>
    <div class="postbody"><span class="postbody">I was about the post it around here but since you did...
<br/>
<br/>
I fixed a bug in it since i discovered that the defines provided within libnds aren't accurate enough for replays (they need a separate control for the channels' volume). 
<br/>
<br/>
Notice that some modules, especially the ones with very small instruments (aka chiptunes), can't be replayed accurately on the nds unless they have samples which (repeat) lengths are multiple of 4 bytes.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146631 - tepples - Fri Dec 07, 2007 12:48 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>hitchhikr wrote:</b></span></td> </tr> <tr> <td class="quote">Notice that some modules, especially the ones with very small instruments (aka chiptunes), can't be replayed accurately on the nds unless they have samples which (repeat) lengths are multiple of 4 bytes.</td> </tr></table><span class="postbody">
<br/>
Can't the loader just double the loop length?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146682 - hitchhikr - Fri Dec 07, 2007 4:01 pm</h4>
    <div class="postbody"><span class="postbody">I thought about that but it would mean to have the loops of each non-multiple of 4 bytes samples copied twice in memory and the structure of the module to be re-arranged (read: increasing it's size, which may not be possible).
<br/>
I don't think it's worth the hassle, it'll be easier to fix the modules directly inside the tracker (or to compose them with this small limitation in mind).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146705 - Michoko - Fri Dec 07, 2007 10:43 pm</h4>
    <div class="postbody"><span class="postbody">Wow hitchhikr! Brilliant work!
<br/>
<br/>
Certainly one of the most accurate replays of "Cream of the earth" I ever heard since the Amiga times!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#149070 - Maple - Mon Jan 14, 2008 6:20 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>hitchhikr wrote:</b></span></td> </tr> <tr> <td class="quote">Notice that some modules, especially the ones with very small instruments (aka chiptunes), can't be replayed accurately on the nds unless they have samples which (repeat) lengths are multiple of 4 bytes.</td> </tr></table><span class="postbody">Not knowing enough about the terminology (I'm just getting started in modtracker stuff myself), I'm not quite on the same page as you and tepples on the double-copy idea. 
<br/>
Assuming when you say "length" you mean sample length, could you not just tweak the sample or tracker-file (either using a tool or in the loader as tepples said) to pad the samples to the 4-byte boundary? I haven't experimented enough to see if this would add dead air in the sample. (I would guess that it would.) Yeah, this brings up the file-size problem you mentioned earlier.
<br/>
Alternately, if by "length" you mean the number of repeats (i.e. how many repeats in a length of time), could you not break it down into multiples of 4 bytes? I would assume you'd have to chop off the remainder. This would be no better for &lt; 4 bytes, but would at least make it closer to accurate for &gt; 4 bytes. (I don't think this is what you mean, 4 bytes is an awfully large amount for number of repeats.)
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I thought about that but it would mean to have the loops of each non-multiple of 4 bytes samples copied twice in memory and the structure of the module to be re-arranged (read: increasing it's size, which may not be possible).
<br/>
I don't think it's worth the hassle, it'll be easier to fix the modules directly inside the tracker (or to compose them with this small limitation in mind).</td> </tr></table><span class="postbody">Many folks out there would not have the patience to have to learn how a tracker program works or, if they did, might not want to have to go through the trouble of mangling every chiptune they wanted to use in their app. Hence a tool to convert bum .mods to usable ones would be useful.
<br/>
<br/>
Now I'm curious to know how DekuTree64 worked around this...
<br/>
<br/>
<br/>
All that said, excellent work.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#149091 - eKid - Tue Jan 15, 2008 7:51 am</h4>
    <div class="postbody"><span class="postbody">When I wrote my .mod player I also made a little tool to fix the samples.
<br/>
<a href="http://ekid.nintendev.com/modfix.exe" target="_blank">http://ekid.nintendev.com/modfix.exe</a>
<br/>
It's a command-line tool. Basic usage is "modfix input.mod output.mod". The samples in the output will unrolled and padded until the loop points are correct.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#149143 - DekuTree64 - Wed Jan 16, 2008 12:12 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>eKid wrote:</b></span></td> </tr> <tr> <td class="quote">The samples in the output will unrolled and padded until the loop points are correct.</td> </tr></table><span class="postbody">
<br/>
Yeah, that's basically what I did (although I did it when loading in the game). First, add silent samples to the start to push the loop start point onto a 4 byte boundary. Then for short loops, unroll to 2 or 4 repetitions so they're 4 byte aligned. For long loops, poke in a couple interpolated samples to make them longer.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#149396 - hitchhikr - Sat Jan 19, 2008 3:47 pm</h4>
    <div class="postbody"><span class="postbody">That'll make the files bigger than necessary, imho, also i did the replay with not done yet modules in mind, not older ones.
<br/>
<br/>
I think the ds needs a dedicated tool anyway, 
<br/>
not some clone or port of another tracker (assuming the psg as well as the rest of the ds capabilities had to be handled).
<br/>
<br/>
The tracker which seems to be the closest to the ds hardware in term of capabilities is screamtracker 3 (minus the 16 bits samples), fasttracker 2 and co. require software mixers to be fully functional.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#149397 - kusma - Sat Jan 19, 2008 3:55 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>hitchhikr wrote:</b></span></td> </tr> <tr> <td class="quote">fasttracker 2 and co. require software mixers to be fully functional.</td> </tr></table><span class="postbody">
<br/>
Question is, does one need "fully functional" or just "good enough"?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#149403 - tepples - Sat Jan 19, 2008 7:46 pm</h4>
    <div class="postbody"><span class="postbody">To elaborate on kusma's question: What does .xm fundamentally need that the DS hardware mixer can't do?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#149413 - Sunray - Sat Jan 19, 2008 9:46 pm</h4>
    <div class="postbody"><span class="postbody">Loop start points greater than whats fit in 16 bits, maybe?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#149414 - kusma - Sat Jan 19, 2008 10:11 pm</h4>
    <div class="postbody"><span class="postbody">Actually, what I meant was more like "why can't you just tell your musician about the limitations to avoid them". There's no point in ditching XM just because ping-pong looping isn't supported on the hardware; you could just avoid using tunes with ping-pong loops.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#149417 - tepples - Sat Jan 19, 2008 10:19 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Sunray wrote:</b></span></td> </tr> <tr> <td class="quote">Loop start points greater than whats fit in 16 bits, maybe?</td> </tr></table><span class="postbody">
<br/>
<a class="postlink" href="http://nocash.emubase.de/gbatek.htm#dssound" target="_blank">GBATEK says</a> the 16-bit count in SOUNDxPNT is a count of 4-byte units. Each unit represents two 16-bit samples, four 8-bit samples, or eight ADPCM samples. Assuming that the waves in .xm are converted to ADPCM first, what combination of sampling rate and time would need a loop that starts more than 524,280 samples into the wave?
<br/>
<br/>
kusma is on the right track: As long as the composer is someone hired by the producer (and not the end user), we can define a subset of S3M and a subset of XM that covers enough to be useful to a composer. The same converter that converts music files to use a shared instrument bank and compresses waves using ADPCM would also warn the user about waves whose attack/decay is too long. So there isn't much of a problem unless your program lets the end users be composers, such as a generic music player app (e.g. DSOrganize) or a completely skinnable game (e.g. the PC version of Lockjaw).<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#149459 - hitchhikr - Sun Jan 20, 2008 2:19 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Actually, what I meant was more like "why can't you just tell your musician about the limitations to avoid them". There's no point in ditching XM just because ping-pong looping isn't supported on the hardware; you could just avoid using tunes with ping-pong loops.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Sure, but it would also limit the xm to 16 channels without the ability to use adpcm packed samples or mixing the psg output with samples.
<br/>
Also i read somewhere that the ds is able to do surround (?) + the lengths or instruments envelopes may be tricky to fix automatically.
<br/>
<br/>
Maybe i'm wrong about that but i think Fasttracker 2 (embarrassing) modules format was designed for PCs which at that time already had more than 4 megs of ram, don't the patterns need to be depacked in memory before being replayed or something ?
<br/>
<br/>
I'm not sure that loops can be achieved with adpcm samples, can they ?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#149461 - tepples - Sun Jan 20, 2008 2:40 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>hitchhikr wrote:</b></span></td> </tr> <tr> <td class="quote">Sure, but it would also limit the xm to 16 channels</td> </tr></table><span class="postbody">
<br/>
We have a 10-bit DAC and speakers with little response below 500 Hz. What would &gt;16 channels do for the listener?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">without the ability to use adpcm packed samples</td> </tr></table><span class="postbody">
<br/>
The DS supports (a different flavor of) ADPCM. Waves would just be decoded from XM packing and encoded to IMA packing at compile time.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">or mixing the psg output with samples.</td> </tr></table><span class="postbody">
<br/>
If you don't change the duty cycle over the course of an instrument using an envelope, using the PSG on channels 8-13 is equivalent to looped waves of length 8, at no big loss to the file size. PSG on channels 14 and 15 is noise, which at 32767 samples might, so there may be a chance to special case that.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Maybe i'm wrong about that but i think Fasttracker 2 (embarrassing) modules format was designed for PCs which at that time already had more than 4 megs of ram, don't the patterns need to be depacked in memory before being replayed or something ?</td> </tr></table><span class="postbody">
<br/>
The ufmod docs state that a pattern in XM is a sequence of rows. It can be unpacked one row at a time.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I'm not sure that loops can be achieved with adpcm samples, can they ?</td> </tr></table><span class="postbody">
<br/>
DS ADPCM handles looping. When a channel gets to the loop point in an ADPCM-compressed wave, it saves the current scale factor and prediction so that it can reload them when looping back to that point.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#149463 - kusma - Sun Jan 20, 2008 2:50 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>hitchhikr wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Sure, but it would also limit the xm to 16 channels without the ability to use adpcm packed samples or mixing the psg output with samples.
<br/>
Also i read somewhere that the ds is able to do surround (?) + the lengths or instruments envelopes may be tricky to fix automatically.
<br/>
</td> </tr></table><span class="postbody">
<br/>
True, I don't think XM is the best possible format for the DS. Personally, I'd convert the modules before to get ADPCM compressed samples where possible.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Maybe i'm wrong about that but i think Fasttracker 2 (embarrassing) modules format was designed for PCs which at that time already had more than 4 megs of ram, don't the patterns need to be depacked in memory before being replayed or something ?
<br/>
</td> </tr></table><span class="postbody">
<br/>
I consider the pattern-compression part of XM to be one of the more pointless features, because of just that - it's very tricky/slow to read the pattern-data directly. I'd much prefer a compression scheme that allows you to unpack one row of pattern data at the time. We designed something like this for Pimpmobile, but never got around to implementing it. It should be relatively easy, though.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
I'm not sure that loops can be achieved with adpcm samples, can they ?</td> </tr></table><span class="postbody">
<br/>
Due to the required state kept for adpcm-decoding, I doubt so. GBATek suggest that it works, but I suspect that loop-start for ADPCM is restricted to the beginning of the sample.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#154407 - hitchhikr - Tue Apr 15, 2008 8:03 pm</h4>
    <div class="postbody"><span class="postbody">As requested by someone called peter here in your forum, i updated the replay and added the ability to specify a song position via a command and also as starting position.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#164565 - sasq - Fri Nov 07, 2008 12:52 pm</h4>
    <div class="postbody"><span class="postbody">It looks like the ARM7-part replaces the default arm7 code completely - how easy is it to get this replayer to play  nice with other arm7-code (like WIFI) ?</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
