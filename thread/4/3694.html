<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Memory Corruption - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > Memory Corruption</h2>
<div id="posts">
<div class="post">
    <h4>#23353 - Gene Ostrowski - Sat Jul 10, 2004 9:14 am</h4>
    <div class="postbody"><span class="postbody">Has anyone run into an odd bug where your variables are getting tromped on unexpectedly when watching them through the GDB debugger?
<br/>
<br/>
In my scenario, I have declared some variables in my .cpp file:
<br/>
<br/>
s16 var1;
<br/>
s16 var2;
<br/>
<br/>
Then, somewhere in the code is:
<br/>
<br/>
var1=10;
<br/>
var2=20;
<br/>
<br/>
If I set up watches on these two variables, put a breakpoint at the var1=10 line and step through the code, as soon as it writes a value to var1, BOTH values change to garbage.  I even tried separating them in memory so they are not contiguous and still see garbage:
<br/>
<br/>
[Watch screen may show]
<br/>
var1 = 54223462
<br/>
var2 = -213334563
<br/>
<br/>
In my case, I've even tried explicitly declaring the variables in both EWRAM and IWRAM, and the problem happens wherever I place the variables-- if I initialize them or not.  It does not appear that they are in an illegal memory locations (out of bounds), because on the watch window, if I watch the <span style="font-style: italic">address </span>of the variable, it shows...
<br/>
<br/>
&amp;var1  = 0x02010990 
<br/>
<br/>
... or something that is well within bounds of the memory area in question.
<br/>
<br/>
I thought I might be overrunning memory, since I've been working on the source for this project for some time, when suddenly the issue appeared.  However, as a test I commented out a good chunk of variable declarations to ensure that I "freed up" much more than I added with my new code.
<br/>
<br/>
Anybody ever run into this kind of error before, and how did you fix it?
<br/>
<br/>
I'm pulling my hair out!<br/>_________________<br/>------------------
<br/>
Gene Ostrowski</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23356 - col - Sat Jul 10, 2004 12:35 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Gene Ostrowski wrote:</b></span></td> </tr> <tr> <td class="quote">Has anyone run into an odd bug where your variables are getting tromped on unexpectedly when watching them through the GDB debugger?
<br/>
<br/>
In my scenario, I have declared some variables in my .cpp file:
<br/>
<br/>
s16 var1;
<br/>
s16 var2;
<br/>
<br/>
Then, somewhere in the code is:
<br/>
<br/>
var1=10;
<br/>
var2=20;
<br/>
<br/>
If I set up watches on these two variables, put a breakpoint at the var1=10 line and step through the code, as soon as it writes a value to var1, BOTH values change to garbage.  I even tried separating them in memory so they are not contiguous and still see garbage:
<br/>
<br/>
[Watch screen may show]
<br/>
var1 = 54223462
<br/>
var2 = -213334563
<br/>
<br/>
In my case, I've even tried explicitly declaring the variables in both EWRAM and IWRAM, and the problem happens wherever I place the variables-- if I initialize them or not.  It does not appear that they are in an illegal memory locations (out of bounds), because on the watch window, if I watch the <span style="font-style: italic">address </span>of the variable, it shows...
<br/>
<br/>
&amp;var1  = 0x02010990 
<br/>
<br/>
... or something that is well within bounds of the memory area in question.
<br/>
<br/>
I thought I might be overrunning memory, since I've been working on the source for this project for some time, when suddenly the issue appeared.  However, as a test I commented out a good chunk of variable declarations to ensure that I "freed up" much more than I added with my new code.
<br/>
<br/>
Anybody ever run into this kind of error before, and how did you fix it?
<br/>
<br/>
I'm pulling my hair out!</td> </tr></table><span class="postbody">
<br/>
<br/>
are you compiling with opimization off?
<br/>
<br/>
If you have any optimization level switched on, what you are probably seeing is the registers that will be/have been used for those variables being used for somthing else.
<br/>
<br/>
col</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23401 - Gene Ostrowski - Sun Jul 11, 2004 10:56 pm</h4>
    <div class="postbody"><span class="postbody">Well... I'm not sure.  I would <span style="font-style: italic">assume </span>that optimization is off, since I'm using the default HAMLib build makefiles.  When compiling for GDB output, the makefile indicates that it uses -O0 -g as the options, and rebuilds from scratch.
<br/>
<br/>
So assuming that the default configuration of the makefiles isn't broken, it should be doing it correctly...
<br/>
<br/>
Since I posted the original email, I've discovered that if I change the variable to <span style="font-weight: bold">int</span> instead of <span style="font-weight: bold">s16</span>, I can debug it without problems!  
<br/>
<br/>
That makes absolutely no sense whatsoever, but that's what I see.
<br/>
<br/>
Thanks for the reply, and if you have any more insight, please let me know.
<br/>
<br/>
BTW, do you know the difference between -O2 and -O3?<br/>_________________<br/>------------------
<br/>
Gene Ostrowski</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23402 - torne - Mon Jul 12, 2004 1:26 am</h4>
    <div class="postbody"><span class="postbody">-O3 will inline functions automatically where it thinks it will be useful; -O2 will only inline functions with the 'inline' attribute (and even then it will only do it if it thinks it will be useful). All other optimisation parameters are the same. -O3 has a tendency to increase code size a bit more than -O2 because of the inlining.
<br/>
<br/>
If you have a development enviroment that has the 'info' command (a Cygwin install, for example) then 'info gcc' will give you the full compiler documentation, which explains which switches are included in which optimisation setting, and what those switches do. If not, you can get it on the web at <a href="http://www.cs.utexas.edu/users/UTCS/online-docs/info2html/info2html.cgi?" target="_blank">http://www.cs.utexas.edu/users/UTCS/online-docs/info2html/info2html.cgi?</a>(gcc)Top (and many other places; google is your friend).</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
