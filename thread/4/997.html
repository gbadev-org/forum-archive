<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Allocating data in vram - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Coding > Allocating data in vram</h2>
<div id="posts">
<div class="post">
    <h4>#4861 - funkeejeffou - Sun Apr 13, 2003 12:26 pm</h4>
    <div class="postbody"><span class="postbody">Hello everyone,
<br/>
<br/>
I am actually coding a 3d engine for GBA, and I've been trying lately to allocate my textures(which are arrays of indexed colors from the palette) in Vram, so i wont use any ewram or iram for it.
<br/>
The problem is that i couldn't make it work, the lnkscript doesn't contain any vram info so i cant use the attribute command, and when i try in my header file :
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">unsigned short int *texture = (unsigned short int *)0x6014000;
<br/>
texture[1000] = {0, 23, 45, ..............., 666};</td> </tr></table><span class="postbody">
<br/>
<br/>
gcc failes to compile.
<br/>
So here I have two questions for the one who will save me :
<br/>
1- Are transfers between data wich are both in vram are faster then transfer from ROM(or else...) to  Vram?
<br/>
2- How can i allocate an array which is a global variable at any adress of my choice?
<br/>
<br/>
Bonus : Where can i find a good, clear and complete doc about how does gcc works with the lnkscript and crtso, and where are the definitions of my c functiuns that i use (in wich include directory of the devkitadv)?
<br/>
<br/>
Thank you for reading this post...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4931 - regularkid - Tue Apr 15, 2003 6:17 am</h4>
    <div class="postbody"><span class="postbody">Not sure if I can help too much, but I'll give it a shot:
<br/>
<br/>
Don't put anything into vram except for the actual screen data. You definately won't have enough room for all your textures in there (if you are in mode 4, then you only have two screens worth of space). Like you already said, you probably want to avoid filling your iwram and ewram up with textures and other data, so the next best thing is ROM. It is a lot slower than accessing from RAM, but you get lots and lots of space (the cart size, so 64mb, 128mb, 256mb, etc). In order to put something into ROM, just put the keyword "const" infront of the declaration like this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
const u8 texture = {0, 23, 45,......, 666};
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
texture will now be stored in ROM (0x08000000 and up, i think). You can add the switch:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
-Wl,-Map,Memory.map
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
to give you a listing of all your variables and functions and where they are put into memory by the compiler. Very useful. As for a reference, the best one I have seen is Jeff Frohwein's FAQ: 
<br/>
<br/>
<a class="postlink" href="http://www.devrs.com/gba/files/gbadevfaqs.php" target="_blank">http://www.devrs.com/gba/files/gbadevfaqs.php</a>
<br/>
<br/>
Hope that helps!<br/>_________________<br/>- RegularKid</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4940 - Paul Shirley - Tue Apr 15, 2003 2:17 pm</h4>
    <div class="postbody"><span class="postbody">removed</span><span class="gensmall"><br/><br/>Last edited by Paul Shirley on Sun Mar 28, 2004 9:58 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#4953 - funkeejeffou - Tue Apr 15, 2003 7:20 pm</h4>
    <div class="postbody"><span class="postbody">Thanks guys for your reply, but i still have some questions, espcially for paul.
<br/>
<br/>
You talked about the 16 bit alignement, but i dont see what you mean by it...is it the fact that a pixel is represented by an unsigned char and that we must perform logical operations on the  16 bit variable to store the palette index? 
<br/>
By the way, does the graphic card of the GBA can perform by ITSELF logical operations (as the VGA cards on pc card can, i think we call it ALU latches...not sure); or there are always data transfers between the CPU and the graphic card?
<br/>
Is there any doc on the graphic card of the GBA?
<br/>
It has been a week since i'm coding on the GBA , and I'm really frustrated by the fact that allocating data to specific ram sections is a pain in the ****, and i do not feel that i "masterize" my code in detail (because i objectively don't...). Where can i find these docs or tutorials that can help me  do my own linker files and understand the way of properly coding, i really want to optimise my code. MOst of the tutorials and docs i've found are not sufficient(and beleive me i ve searched). 
<br/>
For the allocation of my textures in vram, your idea seems to bee good, since rom space is relatively big. Can malloc allocate space at a specific adress?
<br/>
<br/>
Thanks again</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4954 - tepples - Tue Apr 15, 2003 7:33 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>funkeejeffou wrote:</b></span></td> </tr> <tr> <td class="quote">You talked about the 16 bit alignement, but i dont see what you mean by it...is it the fact that a pixel is represented by an unsigned char and that we must perform logical operations on the  16 bit variable to store the palette index?</td> </tr></table><span class="postbody">
<br/>
The bus from the CPU to VRAM is 16 bits wide, and if you try writing a byte to VRAM, it'll be written to both the even and odd bytes in the 16-bit word.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">By the way, does the graphic card of the GBA can perform by ITSELF logical operations (as the VGA cards on pc card can, i think we call it ALU latches...not sure)</td> </tr></table><span class="postbody">
<br/>
No.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Is there any doc on the graphic card of the GBA?</td> </tr></table><span class="postbody">
<br/>
Search Google for Cowbite spec.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Where can i find these docs or tutorials</td> </tr></table><span class="postbody">
<br/>
Have you checked the docs sections of <a class="postlink" href="http://www.devrs.com/gba/" target="_blank">devrs.com</a> and <a class="postlink" href="http://www.gbadev.org" target="_blank">gbadev.org</a>?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
