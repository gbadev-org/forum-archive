<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>HDMA and H-Blanks. - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > HDMA and H-Blanks.</h2>
<div id="posts">
<div class="post">
    <h4>#1121 - dooby6 - Tue Jan 14, 2003 8:32 pm</h4>
    <div class="postbody"><span class="postbody">Hello everybody,
<br/>
<br/>
I was just wondering what the difference was between HDMA and a H-Blank interrupt.
<br/>
<br/>
Dooby6.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1122 - Splam - Tue Jan 14, 2003 8:49 pm</h4>
    <div class="postbody"><span class="postbody">HBlank interupt is an interupt :)  whereby you must service the interrupt and can run your own code from it.  It's triggered (if requested to) during the horizontal blanking period.  As I say, you can write code just like you normaly would to do whatever you want.
<br/>
<br/>
HDMA is a dma and can only copy data from one place to another, there are no instructions involved once it is running (ie you can't get it to call your own code).  You can use hdma for something like copying a new palete on each line of the screen or something like changing the x position of a sprite or the screen (to make it wobble or other effects).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1131 - dooby6 - Tue Jan 14, 2003 9:48 pm</h4>
    <div class="postbody"><span class="postbody">Okay I know how to get a HBlank interrupt working but could you tell me how how to set up a HDMA.
<br/>
<br/>
Thanks alot,
<br/>
Dooby6</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1133 - Splam - Tue Jan 14, 2003 10:05 pm</h4>
    <div class="postbody"><span class="postbody">I'll give it a shot ;)
<br/>
<br/>
Presuming here usage of dma3...
<br/>
<br/>
You need to set the source, destination and control registers..
<br/>
<br/>
Source and destination,  easy, you know what you want to copy and where you want it to go :)
<br/>
<br/>
Control register..
<br/>
<br/>
You need to set the bits in the control register for DMA_ENABLE, DMA_HBLANK for starters, that will ensure the dma is started and is in HDMA mode.
<br/>
<br/>
From there on its pretty much your own choice of what you do,  the rest of the bits in that register are for things like source/destination reload or increment etc + should the dma repeat or not and finally the number of transfers to do.
<br/>
<br/>
It's pretty hard to tell you exactly how to set it up because I don't know what you want to do with it  but here's an example I found in some code of mine before I did it in asm instead..
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   //DMA3 Source Addresss
<br/>
   REG_DM3SAD = 0x2000016;
<br/>
<br/>
   //DMA3 Destination Address 
<br/>
   REG_DM3DAD = 0x5000000;
<br/>
<br/>
   REG_DM3CNT = DMA_ENABLE | DMA_HBLANK | DMA_32 | DMA_SOURCE_INCREMENT |DMA_DEST_RELOAD |DMA_REPEAT|2;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
What that does is set the hblank dma to read data from ram at address 0x2000016 and store it to the palette registers 0x5000000, it copies 2 32bit values on each line. The source address is a table of 4 colour registers for each line of the screen.
<br/>
<br/>
Those DMA_ things mean the following...
<br/>
<br/>
DMA_ENABLE  triggers the dma to start
<br/>
DMA_HBLANK  tells it to go into hblank mode
<br/>
DMA_32  means copy 32bit values
<br/>
DMA_SOURCE_INCREMENT  Keep incrementing the source address on each occurance of the hdma
<br/>
DMA_DEST_RELOAD  set the destination back to its initial value on each hdma (because I want to copy the the same palette entries)
<br/>
DMA_REPEAT   makes sure the dma happens on every line (without this it would copy 1 lot of data then stop)
<br/>
2  is the number of transfers to do  2*32bit 
<br/>
<br/>
You need to call this code on the vblank because if you don't it will just keep going forever incrementing the source address (because of the DMA_REPEAT).
<br/>
<br/>
You may have totally different definitions for the "bit codes" than I do but they should make sense.
<br/>
<br/>
Hope that helps.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1205 - dooby6 - Wed Jan 15, 2003 6:31 pm</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
Thanks that helped alot, but everytime I try it, it just causes the screen to black out. I tried in a forever loop and have done it outside the loop but the same effect just keeps happening. I' m doing in asm on the Goldroad assembler, and just trying to make the screen wobble effect, and yes I am a newbie on GBA Dev=). 
<br/>
<br/>
Thanks,
<br/>
Dooby6</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1211 - zeuhl - Wed Jan 15, 2003 6:54 pm</h4>
    <div class="postbody"><span class="postbody">I thought accessing the palette registers required 16-bit access, thus using the 16-bit DMA transfer mode.
<br/>
<br/>
if 32 bit access works (ie converting a single 32-bit access to two 16-bit accesses when writing to the palette registers), it obviously should be faster when reading IWRAM.
<br/>
<br/>
the GBA hardware just rocks ;-)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1219 - Splam - Wed Jan 15, 2003 7:29 pm</h4>
    <div class="postbody"><span class="postbody">@zeuhl
<br/>
Yeah, seems to be a popular misconception that you can only do 16bit writes, you can do 16 or 32, just not 8 ;)  the 16bit mode is in case you only want to write say an odd number of palette registers (other reasons too).
<br/>
<br/>
@dooby6
<br/>
Not sure what your problem could be, lots of things will blank the screen, it's possible you're writing to the wrong register, writing too much  etc etc.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1240 - pulstar_3 - Wed Jan 15, 2003 10:18 pm</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
I got a problem with HDMA. I try to create the wobble effect on a text bg in mode 0. I have a sine wave that takes the values for the wobble, and put the HDMA ion a v-blank interrupt but it just doesn't work at all. Any comments.
<br/>
<br/>
Cheers</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
