<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>TITLE, MENU, GAME - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Coding > TITLE, MENU, GAME</h2>
<div id="posts">
<div class="post">
    <h4>#62365 - psycorpse - Wed Nov 30, 2005 4:07 am</h4>
    <div class="postbody"><span class="postbody">How does everyone go about doing a title screen and then a menu and then to the game itself? Do you make functions for each of those? Then in the while loop of main do you check to see if the title function is done and then show the menu? All the tutorials that I see just show how to go straight into gameplay. I am new to C and C++ so I am not 100% sure that this is how it is done. Anyway if you understand what I am asking and can give any input I would greatly appreciate it. 
<br/>
<br/>
Thanks,
<br/>
Mike</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62367 - gauauu - Wed Nov 30, 2005 6:01 am</h4>
    <div class="postbody"><span class="postbody">I don't know about the "best" way, but for GBA games, I often give the title screen and/or menu screens their own game loop.
<br/>
<br/>
Something like (this is oversimplified)
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
while(true)
<br/>
{
<br/>
   doTitleScreen();
<br/>
   setupGameState();
<br/>
   while(waitForExitGame())
<br/>
   {
<br/>
        checkControls();
<br/>
        updateGameState();
<br/>
        frameTick();     //frametick waits for vblank,
<br/>
                               //does sound worker function,
<br/>
                               //etc - stuff that has to happen every frame
<br/>
                               //no matter which loop you are in....
<br/>
        updateBG();
<br/>
        updateSprites();
<br/>
   }
<br/>
}
<br/>
<br/>
void doTitleScreen()
<br/>
{
<br/>
     setupTitleScreen();
<br/>
     while(waitForStartButton())
<br/>
     {
<br/>
         processTitleScreenAnimations();
<br/>
         frameTick();
<br/>
         updateBG();
<br/>
      }
<br/>
     unsetupTitleScreen();
<br/>
}
<br/>
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
By keeping all the real code from the loops in functions, it's pretty easy to just grab the functionality you need for each different type of loop.  In my current game, I actually have a different loop for each of:
<br/>
title screen
<br/>
main menu
<br/>
game play
<br/>
stats screen
<br/>
<br/>
Since the stuff that has to happen in EACH of them in all wrapped up in the frameTick() function, I can just handle the appropriate controls/updates in each loop, instead of having one big loop and a bunch of conditionals to figure out which things I'm supposed to be doing depending on what's happening on the screen.
<br/>
<br/>
Of course, I'm not saying this is anywhere near the best, or a recommended way.  Just the way I've been doing it recently.  But I've also done it with just one master loop, and keeping track of state.  It was just enough of a pain in the butt that I decided to try this method.  And so far, it's much easier.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62368 - psycorpse - Wed Nov 30, 2005 6:06 am</h4>
    <div class="postbody"><span class="postbody">Cool. Thanks for the input. I just wasn't sure on how anyone did this.
<br/>
<br/>
Mike</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62379 - SittingDuck - Wed Nov 30, 2005 11:20 am</h4>
    <div class="postbody"><span class="postbody">Just to note, while waiting for VBlank, remember to turn off the CPU (the best way to do it is to use a BIOS function) otherwise the battery will be wasted very quickly.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62407 - expos1994 - Wed Nov 30, 2005 6:35 pm</h4>
    <div class="postbody"><span class="postbody">The way I go about it is to have a big case statement that goes from state to state.
<br/>
<br/>
something like:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
//In your main() loop...
<br/>
<br/>
switch (gamemode)
<br/>
{
<br/>
              case TITLE_MODE:
<br/>
              {
<br/>
                         dotitlestuff();
<br/>
                         if (titlestuffdone)
<br/>
                              gamemode = MENU_MODE;
<br/>
                         break;
<br/>
               }
<br/>
              case MENU_MODE:
<br/>
              {
<br/>
                        domenustuff();
<br/>
                        if (menustuffdone)
<br/>
                             gamemode = GAME_MODE;
<br/>
                        break;
<br/>
               }
<br/>
               case GAME_MODE:
<br/>
               {
<br/>
                        dogamestuff();
<br/>
                        if(gameover)
<br/>
                             gamemode = TITLE_MODE; //or GAME_OVER_MODE
<br/>
                        if(startpressed)
<br/>
                             gamemode = PAUSE_MODE;
<br/>
                        break;
<br/>
                }
<br/>
                case PAUSE_MODE:
<br/>
                {
<br/>
                         dopausestuff();
<br/>
                         if(startpressed)
<br/>
                              gamemode = GAME_MODE;
<br/>
                         break;
<br/>
                 }
<br/>
}
<br/>
<br/>
//Do your standard checking for key presses and wait for vblank stuff here
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
That's the structure I always use for GBA games.  This way will keep your game in a certain state until you put it in a different state.
<br/>
<br/>
I threw that PAUSE_MODE in there to show you where you can go with this.  I also usually have an INIT_MODE for more complex states.  Like PAUSE_MODE_INIT might fade out the game screen.  Do a pause animation, and then move the gamemode to PAUSE_MODE.  Pause_mode might just sit there and spin it's wheels until you push "start".
<br/>
<br/>
In even a small game, I could have some 20 or so different states (VIEW_HIGH_SCORE_MODE, FADE_IN_MODE, ENTER_INITIALS_MODE, NEXT_LEVEL_MODE.... you name it.)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62409 - SittingDuck - Wed Nov 30, 2005 6:46 pm</h4>
    <div class="postbody"><span class="postbody">It's best to create seperate game loops. Get rid of the switch statement. This is executed sixty times per second and includes unnessecary jumps. Every little less time helps in a GBA game! ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62411 - thegamefreak0134 - Wed Nov 30, 2005 6:56 pm</h4>
    <div class="postbody"><span class="postbody">My solution to this issue, to make it easier on yourself, is to have the different parts of the game in different program.c files. Then, create a never ending main loop in your main.c (/whatever you call it) and create a nesting system of some sort to take you through the game. My system, since I am pouring my heart and soul into a puzzle type game, will take my users first to the title screen, then to the menu. From the menu, they can navigate to different sections or press B to go back to the title. When they start a game, it's a totally different loop, but when the game ends it returns a variable so the menu comes back up at the same place. It's pretty easy to put different modes of play in like this. You can also use this type of nesting in games for things like battle systems or stat menus. And since the different parts are files of their own, you don't have to go code hunting.<br/>_________________<br/>What if the hokey-pokey really is what it's all about?
<br/>
<br/>
[url=http:/www.darknovagames.com/index.php?action=recruit&amp;clanid=1]Support Zeta on DarkNova![/url]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62412 - kusma - Wed Nov 30, 2005 6:58 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>SittingDuck wrote:</b></span></td> </tr> <tr> <td class="quote">It's best to create seperate game loops. Get rid of the switch statement. This is executed sixty times per second and includes unnessecary jumps. Every little less time helps in a GBA game! ;)</td> </tr></table><span class="postbody">
<br/>
<br/>
yes, optimize code that takes ~0.00001065552234649658 of your total time pr frame. i'll be hearing from you around christmas 2090.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62415 - poslundc - Wed Nov 30, 2005 7:27 pm</h4>
    <div class="postbody"><span class="postbody">Google "finite state machines", then implement your game as one.
<br/>
<br/>
(This is basically what expos1994 is doing.)
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62419 - expos1994 - Wed Nov 30, 2005 8:06 pm</h4>
    <div class="postbody"><span class="postbody">A nice thing about having a "gamemode" type variable that tracks the state of your game is that it can be easily monitored in VBA by using the memory viewer.
<br/>
<br/>
This can really aid in debugging.  You'll always know where you're game is sitting.  Or where your game is flying off its track.
<br/>
<br/>
I have tried creating multiple loops and multiple waits for vblank, but I found it got too complicated and didn't work as I expected it.  Which is why I went to using one Case statement.  For me, it's a lot easier to manage one loop than to manage a whole bunch of em.
<br/>
<br/>
But, that's just me.  As with any kind of programming, there are 100 different ways to do everything.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62531 - Touchstone - Thu Dec 01, 2005 9:56 pm</h4>
    <div class="postbody"><span class="postbody">I've used sort of a "context" system before with function pointers.</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">typedef struct SContext
<br/>
{
<br/>
    void(*pfnInit)(void);
<br/>
    void(*pfnProcess)(void);
<br/>
    void(*pfnRender)(void);
<br/>
    void(*pfnDestroy)(void);
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
Then you create a couple of contexts (I've only created one here).</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void menuInit(void)
<br/>
{
<br/>
}
<br/>
<br/>
void menuProcess(void)
<br/>
{
<br/>
}
<br/>
<br/>
void menuRender(void)
<br/>
{
<br/>
}
<br/>
<br/>
void menuDestroy(void)
<br/>
{
<br/>
}
<br/>
<br/>
SContext menuContext =
<br/>
{
<br/>
    menuInit,
<br/>
    menuProcess,
<br/>
    menuRender,
<br/>
    menuDestroy,
<br/>
}</td> </tr></table><span class="postbody">
<br/>
And then in the main function I have a pointer to the current context to be updated and rendered.</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">SContext* pCurrentContext;
<br/>
<br/>
void main(void)
<br/>
{
<br/>
    pCurrentContext = &amp;menuContext;
<br/>
<br/>
    pCurrentContext-&gt;pfnInit();
<br/>
    while(GameIsRunning)
<br/>
    {
<br/>
        pCurrentContext-&gt;pfnProcess();
<br/>
        pCurrentContext-&gt;pfnRender();
<br/>
    }
<br/>
    pCurrentContext-&gt;pfnDestroy();
<br/>
}</td> </tr></table><span class="postbody">
<br/>
Uhm, yeah, something like that. If you have a couple of contexts you can switch between them by running the pfnPestroy() on the current context, change the context to the new one, perform the pfnInit() and then back into the main loop.<br/>_________________<br/>You can't beat our meat</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
