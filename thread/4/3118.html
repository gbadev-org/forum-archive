<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Stack address - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Coding > Stack address</h2>
<div id="posts">
<div class="post">
    <h4>#18361 - regularkid - Wed Mar 24, 2004 11:19 pm</h4>
    <div class="postbody"><span class="postbody">Hi!
<br/>
<br/>
I'm currently trying to debug some memory corruption in my game and I think the culprit might be that my IWRAM usage is just getting to large at runtime and overwritting some other stuff (because the stack gets too large).
<br/>
<br/>
What address does the stack start at, and is there a way to determine the size of the stack at runtime?
<br/>
<br/>
Anyone else ever experience anything like this? Thanks!<br/>_________________<br/>- RegularKid</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18363 - regularkid - Wed Mar 24, 2004 11:53 pm</h4>
    <div class="postbody"><span class="postbody">I did some more searching and found that the stack starts at 0300:7F00. Does this grow upwards towards 0300:8000, or downwards towards 0300:0000?<br/>_________________<br/>- RegularKid</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18365 - Miked0801 - Thu Mar 25, 2004 12:02 am</h4>
    <div class="postbody"><span class="postbody">You can set the address anywhere and all stacks grown backwards from high addr to low.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18366 - regularkid - Thu Mar 25, 2004 12:16 am</h4>
    <div class="postbody"><span class="postbody">Is there a way to display at runtime the size of the stack? Actually, the best thing would be if it's possible to keep track of the max size that the stack has grown to during the program, then I can figure out if it is getting too big and overwritting other stuff in RAM.<br/>_________________<br/>- RegularKid</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18371 - torne - Thu Mar 25, 2004 1:49 am</h4>
    <div class="postbody"><span class="postbody">You can find the current value of the stack pointer by, uhm, reading the stack pointer register (this will require inline asm from C). The GBA doesn't have stack limit checking; my GBA OS kernel checks for stacks growing too large by having magic values written near the bottom of the stack segment and checking that they are intact on context switches. You could do something similar.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18420 - Miked0801 - Thu Mar 25, 2004 8:40 pm</h4>
    <div class="postbody"><span class="postbody">For stack growth watching, I place a known value in the stack space on bootup (being careful not to munge the stack were it already is) - soemthing like DEADBEEF or C0CAC01A or whatever.  Then, whenever you want to see where your stack is, stop the game in an emulator and look for where the pattern begins.  You could also do this in VBlank every tic in code and place that vlaue on screen.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18490 - Derek - Sat Mar 27, 2004 5:59 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Actually, the best thing would be if it's possible to keep track of the max size that the stack has grown to during the program</td> </tr></table><span class="postbody">
<br/>
<br/>
Have you tried this system. Store a pointer to a main variable on startup. Just make up a dummy if you are using AGBMain().
<br/>
<br/>
Use a function with another dummy variable and subtract the two pointers to get the current stack size. Works a treat and is standard C.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
int* stack_start;
<br/>
<br/>
int stack_size(int dummy)
<br/>
{
<br/>
  return (int)stack_start - (int)&amp;dummy;
<br/>
}
<br/>
<br/>
int main(int argc, char* argv[])
<br/>
{
<br/>
  stack_start = &amp;argc;
<br/>
<br/>
  printf("%d\n", stack_size(0));
<br/>
<br/>
  return 0;
<br/>
}</td> </tr></table><span class="postbody"><br/>_________________<br/>Yeti3D Portable 3D Engine</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
