<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Minish Cap for fun - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > Minish Cap for fun</h2>
<div id="posts">
<div class="post">
    <h4>#49462 - Miked0801 - Fri Jul 29, 2005 10:35 pm</h4>
    <div class="postbody"><span class="postbody">Ok, I finally got to look at Minish cap running in no$.  Here's what I've noticed:
<br/>
<br/>
1. They do not double buffer sprites - that means they can have more sprites VRAM in use, but can only load it during VBlank.
<br/>
2. They're scrolling system in very char in-efficient.  They load 2D areas for objects in VRAM in large chunks instead of per char.  Most maps I've seen waste over 10% of their avaiable char space because of this.  They also don't free scroll/edge fill their maps which means they're taking more time to scroll than they could.
<br/>
3. I'm seeing no palette management system for sprites.
<br/>
4. No$ is screaming every single time they scroll.  They have a number of read from NULL bugs in their scroll engine.
<br/>
5. The artwork is nice :)
<br/>
6. Fades are done with palettes which allows them to use alpha-blending for in-game effects (clouds going by and such.)
<br/>
<br/>
Overall, not impressed with the technology, but am impressed with the gameplay and interface. :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49466 - sajiimori - Fri Jul 29, 2005 10:57 pm</h4>
    <div class="postbody"><span class="postbody">I wonder if they load larger BG chunks at a time to get better compression on the ROM.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49474 - tepples - Sat Jul 30, 2005 12:55 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Miked0801 wrote:</b></span></td> </tr> <tr> <td class="quote">They do not double buffer sprites - that means they can have more sprites VRAM in use, but can only load it during VBlank.</td> </tr></table><span class="postbody">
<br/>
Very common technique. You can <a class="postlink" href="http://www.pineight.com/gba/managing-sprite-vram.txt" target="_blank">replace most or all of sprite cel VRAM during vblank</a>, whether using sprite cel DMA or using an ldmia/stmia loop (such as that of CpuFastSet) for quicker responses to serial interrupts.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Fades are done with palettes which allows them to use alpha-blending for in-game effects (clouds going by and such.) </td> </tr></table><span class="postbody">
<br/>
I have written some code to do this sort of palette fade. It uses pseudo-vector processing, handling two colors at a time for speed. I wrote it because I wanted to fade to red (not black or white which the HW supports) in a game that I'm working on. Specify a source palette (e.g. in ROM or EWRAM), a destination palette (in palette memory), a target color, and a fade level (0-16, with 0 being entirely the source palette and 16 being entirely the target color).
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">/* originally from luminesweeper/util.c
<br/>
   ? Damian Yerrick; provided with NO WARRANTY;
<br/>
   free use is permitted provided this notice is maintained in source code */
<br/>
void set_palette_dimmed(void *in_dst,
<br/>
                        const void *in_src,
<br/>
                        unsigned int dim_to,
<br/>
                        unsigned int dim_level)
<br/>
{
<br/>
  u32 *dst = in_dst;
<br/>
  const u32 *src = in_src;
<br/>
  unsigned int n;
<br/>
  unsigned int to_expanded = (dim_to &amp; 0xFFFF) | (dim_to &lt;&lt; 16);
<br/>
  unsigned int to_0 = ((to_expanded &amp; 0x7C1F03E0) &gt;&gt; 4) * dim_level;
<br/>
  unsigned int to_1 = ((to_expanded &amp; 0x03E07C1F)) * dim_level;
<br/>
<br/>
  dim_level = 16 - dim_level;
<br/>
<br/>
  for(n = 8; n &gt; 0; n--)
<br/>
  {
<br/>
    unsigned int from = *src++;
<br/>
    unsigned int from_0 = ((from &amp; 0x7C1F03E0) &gt;&gt; 4) * dim_level;
<br/>
    unsigned int from_1 = ((from &amp; 0x03E07C1F)) * dim_level;
<br/>
<br/>
    from_0 = ((from_0 + to_0)) &amp; 0x7C1F03E0;
<br/>
    from_1 = ((from_1 + to_1) &gt;&gt; 4) &amp; 0x03E07C1F;
<br/>
<br/>
    *dst++ = from_0 | from_1;
<br/>
  }
<br/>
}
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49477 - gladius - Sat Jul 30, 2005 1:07 am</h4>
    <div class="postbody"><span class="postbody">As for the scrolling read from NULL stuff, it's an anti-emulator thing I think.  There is one function that deliberately reads from open bus, and loops on the value read.  The instruction is set up so that the read will make the loop only execute 3 times or so.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49482 - sajiimori - Sat Jul 30, 2005 1:52 am</h4>
    <div class="postbody"><span class="postbody">Apparently it didn't work -- I was able to play Minish Cap on VBA right when it came out.  ^_^</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49483 - Miked0801 - Sat Jul 30, 2005 2:37 am</h4>
    <div class="postbody"><span class="postbody">I don't think it's intentional - they aren't reading from NULL directly, they're reading a NULL, offseting by a small amount, then reading (as in newValue = NULL-&gt;fooStruct)
<br/>
<br/>
On the reading of larger data sets for compression - yeah that's a good idea.  It'll get better compression than we do per char :)
<br/>
<br/>
The vblank load thing - we've had some games where we have to upload so much sprite info every tic that this is impractical and DBing is needed (check out the Lord of the Rings games when 10-15 enemies are roaming the screen.)
<br/>
<br/>
Any other thoughts?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49485 - tepples - Sat Jul 30, 2005 3:00 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Miked0801 wrote:</b></span></td> </tr> <tr> <td class="quote">(check out the Lord of the Rings games when 10-15 enemies are roaming the screen.)</td> </tr></table><span class="postbody">
<br/>
I sincerely hope that your company didn't work on <span style="font-style: italic">LotR</span> for Super NES. That game went from suck to blow as soon as I found the bug where Sam's parry would sometimes damage him even with no enemies present.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49487 - sajiimori - Sat Jul 30, 2005 3:50 am</h4>
    <div class="postbody"><span class="postbody">Nah, he's talking about the GBA versions of Two Towers, Return of the King, and Third Age.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
