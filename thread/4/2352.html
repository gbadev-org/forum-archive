<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Makefile hassles... - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > Makefile hassles...</h2>
<div id="posts">
<div class="post">
    <h4>#12563 - Burre - Mon Nov 17, 2003 10:51 pm</h4>
    <div class="postbody"><span class="postbody">Hi there.
<br/>
<br/>
I've been fooling around in the HAM environment for some time now and are eager to move on to DevKit Advance. The mission: to move my project from HAM to DKA and thus construct a makefile/linkscript combo that produces the same result (or close to). After having my own fair share of escapades in the subject, I'm desperate for help and/or pointers.
<br/>
<br/>
What is included in my project:
<br/>
* Some HAM macros (should be fairly easy to move or replace with wrappers)
<br/>
* Krawall (the real deal, not the demo) help on link scripts and/or makefile flags wanted
<br/>
* Note. HAMlib is NOT in use (wich should ease a lot)
<br/>
* The rest should be close to C/C++-standards
<br/>
<br/>
I'm mainly interested in how the AS and GCC targets for krawall should be arranged and what to do with the linkscripts (krawall comes with one, as does DKA and HAM, wich one do I use?).
<br/>
<br/>
As you've might have guessed I'm quite unexperienced with makefiles, however I've done makefiles in the past but they hardly ever exeeded two or perhaps three targets (meaning, simple makefiles).
<br/>
<br/>
All and any help highly appreciated!
<br/>
<br/>
:)<br/>_________________<br/>"The best optimizer is between your ears..."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12569 - Andy Friesen - Tue Nov 18, 2003 3:49 am</h4>
    <div class="postbody"><span class="postbody">I'm not familiar with how Krawall works, but, assuming you can get a .a file, you can just link it in with -l
<br/>
<br/>
I usually wind up doing something like:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
OBJS =\
<br/>
    a.o \
<br/>
    b.o \
<br/>
    .....
<br/>
<br/>
blah.gba: blah.elf
<br/>
    objcopy -O binary blah.elf blah.gba
<br/>
<br/>
blah.elf: $(OBJS)
<br/>
    gcc -o blah.elf $(OBJS) -lgba -lkrawall -lwhateverelse
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I'm not sure what you'd need a linkscript for; I've never needed to use one personally.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12582 - johnny_north - Tue Nov 18, 2003 4:15 pm</h4>
    <div class="postbody"><span class="postbody">-no expert-
<br/>
The linkscript is used primarily to make sure certain types of code and variables are put into the correct sections (iwram, ewram, rom). 
<br/>
<br/>
I've had very good luck using Jeff Frohwein's linkscript and crt0 in conjunction with devkitadv R3 <a class="postlink" href="http://www.devrs.com/gba/" target="_blank">http://www.devrs.com/gba/</a>. DKA R4 is improved in some ways - although I won't explore it until my current project is finished. It's possible that the linkscripts that you memtion will work - however, I know that jeff's LS/CR combo works well in that:
<br/>
<br/>
1) it has a section for optionally targeting c or c++
<br/>
2) you can select the interrupt scheme based on your needs and I like it's method of handling the interrupts via a function pointer table
<br/>
3) you can fiddle with the where and size of the stack
<br/>
4) krawall will work with this setup
<br/>
<br/>
You can mix and match this stuff in a number of ways as well. I.e. you can use the Ham compiler/tool chain without using the hamlib at all.
<br/>
<br/>
If I remember correctly, using Jeff's set up requires comiling in the following order:
<br/>
crt0.o crtbegin.o crtend.o otherfiles.o ...
<br/>
<br/>
hope that helps.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12583 - johnny_north - Tue Nov 18, 2003 4:18 pm</h4>
    <div class="postbody"><span class="postbody">another caveat - make sure that your linker flags indicates the option:
<br/>
-nostartfiles
<br/>
<br/>
This will prevent linking the default crt0 and lnkscript.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12594 - Quirky - Tue Nov 18, 2003 11:28 pm</h4>
    <div class="postbody"><span class="postbody">Krawall is easy to include. 
<br/>
<br/>
For compiling, make sure you get the directory containing krawall.h in your (gcc -I) includes for compilation of the files that call krawall routines. 
<br/>
<br/>
e.g. if the .h is in a directory "krawall" on the same level as your project then it would be...
<br/>
<br/>
gcc -I../krawall -c sound.c
<br/>
<br/>
And for linking, the krawall library file isn't called "libkrawall.a", which would be the standard thing to do, so you can't use -l as Andy mentioned. But! you can just stick the file "krawall.lib" (as it is called) on the end of the list of your object files. e.g.
<br/>
<br/>
gcc -o game.elf main.o gfx.o krawall.lib</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12664 - Burre - Fri Nov 21, 2003 4:32 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for all the help, but I might need some more. Compiling to object files now work (haven't included krawall yet because I need to make sure that the rest works properly first).
<br/>
<br/>
Here what I've done and what the result is. I figure I've placed some commands in wrong order or forgot some flags or so but I can't find the problem. However compiling seems to work (it successfully compiles into .o files), but linking produces a massive amount of errors.
<br/>
<br/>
makefile (this makefile is based on the one in HAM to make sure that the result/usage is as similar as possible):
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
# Program name (like PROGNAME.gba)
<br/>
PROGNAME=meteor
<br/>
<br/>
# Directory for the env (edit if placed elsewhere)
<br/>
DEVDIR = C:/devkitadv-r5-beta-3
<br/>
<br/>
# GCC base directory
<br/>
GCCARM = $(DEVDIR)/arm-agb-elf
<br/>
<br/>
# GCC bin directory
<br/>
GCCBIN = $(DEVDIR)/bin
<br/>
<br/>
# Object files (DO NOT EDIT)
<br/>
OFILES = crt0.o
<br/>
<br/>
# Added object files (EDITABLE)
<br/>
OFILES += main.o meteor.o collision.o sprite.o ship.o gameobject.o mapapi.o objapi.o irqapi.o dialogue.o game_menu.o
<br/>
<br/>
# Libraries to link with
<br/>
LD_LIBS = -lm -lstdc++ -lsupc++ -lc
<br/>
<br/>
# "Inspired" by HAM makefile
<br/>
#---------------------------------------------------
<br/>
EXEC_PREFIX = arm-agb-elf-
<br/>
<br/>
INCDIR      = -I $(GCCARM)/include -I $(DEVDIR)/include/c++/3.2.2 -I $(DEVDIR)/lib/gcc-lib/arm-agb-elf/3.2.2/include
<br/>
LIBDIR      = -L $(GCCARM)/lib -L $(DEVDIR)/lib/gcc-lib/arm-agb-elf/3.2.2
<br/>
CFLAGS      = $(INCDIR) -marm -mthumb-interwork -mlong-calls -Wall -save-temps -fverbose-asm -nostartfiles -c
<br/>
LDFLAGS     = 
<br/>
ASFLAGS     = -mthumb-interwork 
<br/>
PATH       +=;$(DEVDIR) 
<br/>
CC          = $(DEVDIR)/bin/$(EXEC_PREFIX)gcc.exe
<br/>
GDB         = $(DEVDIR)/bin/$(EXEC_PREFIX)insight.exe
<br/>
AS          = $(DEVDIR)/bin/$(EXEC_PREFIX)as.exe
<br/>
LD          = $(DEVDIR)/bin/$(EXEC_PREFIX)ld.exe
<br/>
OBJCOPY     = $(DEVDIR)/bin/$(EXEC_PREFIX)objcopy.exe
<br/>
SHELL       = $(DEVDIR)/tools/sh.exe
<br/>
PATH       := $(DEVDIR)/bin:$(PATH)
<br/>
#---------------------------------------------------
<br/>
<br/>
<br/>
###########################################
<br/>
# Standard Makefile targets start here
<br/>
###########################################
<br/>
all : $(PROGNAME).gba clean
<br/>
<br/>
$(PROGNAME).gba : $(PROGNAME).elf 
<br/>
   $(OBJCOPY) -v -O binary $(PROGNAME).elf $(PROGNAME).gba
<br/>
<br/>
<br/>
$(PROGNAME).elf : $(OFILES) 
<br/>
   $(LD) $(LDFLAGS) -o $(PROGNAME).elf $(OFILES) 
<br/>
   $(CC) $(CFLAGS) $(OFILES) $(LIBDIR)
<br/>
   
<br/>
#
<br/>
# Compile Targets for C/C++
<br/>
# (refined by Ulrich Hecht, thanks)
<br/>
#
<br/>
.s.o:
<br/>
   $(AS) $(ASFLAGS) $&lt; -o $@
<br/>
<br/>
<br/>
crt0.o : e:/program/HAM271/system/crt0.s 
<br/>
   $(AS) $(ASFLAGS) e:/program/HAM271/system/crt0.s -ocrt0.o #This is the crt0.s file from the HAM-environment, using the DKA crt0.s only results in a lot of ASM errors.
<br/>
<br/>
#
<br/>
# Other Targets
<br/>
#
<br/>
fixheader:
<br/>
   $(DEVDIR)/tools/ham/gbafix.exe $(PROGNAME).gba  
<br/>
<br/>
clean: 
<br/>
   $(DEVDIR)/tools/rm -f *.o *.i *.ii
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Output:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
C:/devkitadv-r5-beta-3/bin/arm-agb-elf-as.exe -mthumb-interwork  e:/program/HAM2
<br/>
71/system/crt0.s -ocrt0.o
<br/>
g++    -c -o main.o main.cpp
<br/>
g++    -c -o meteor.o meteor.cpp
<br/>
g++    -c -o collision.o collision.cpp
<br/>
g++    -c -o sprite.o sprite.cpp
<br/>
g++    -c -o ship.o ship.cpp
<br/>
g++    -c -o gameobject.o gameobject.cpp
<br/>
g++    -c -o mapapi.o mapapi.cpp
<br/>
g++    -c -o objapi.o objapi.cpp
<br/>
g++    -c -o irqapi.o irqapi.cpp
<br/>
g++    -c -o dialogue.o dialogue.cpp
<br/>
g++    -c -o game_menu.o game_menu.cpp
<br/>
C:/devkitadv-r5-beta-3/bin/arm-agb-elf-ld.exe  -o meteor.elf crt0.o main.o meteo
<br/>
r.o collision.o sprite.o ship.o gameobject.o mapapi.o objapi.o irqapi.o dialogue
<br/>
.o game_menu.o  -lm -lstdc++ -lsupc++ -lc
<br/>
C:/devkitadv-r5-beta-3/bin/arm-agb-elf-ld.exe: Warning: main.o does not support
<br/>
interworking, whereas meteor.elf does
<br/>
C:/devkitadv-r5-beta-3/bin/arm-agb-elf-ld.exe: Warning: meteor.o does not suppor
<br/>
t interworking, whereas meteor.elf does
<br/>
C:/devkitadv-r5-beta-3/bin/arm-agb-elf-ld.exe: Warning: collision.o does not sup
<br/>
port interworking, whereas meteor.elf does
<br/>
C:/devkitadv-r5-beta-3/bin/arm-agb-elf-ld.exe: Warning: sprite.o does not suppor
<br/>
t interworking, whereas meteor.elf does
<br/>
<br/>
<br/>
&lt;b&gt;*Continuing like that for about 50 lines or so*&lt;/b&gt;
<br/>
<br/>
C:/devkitadv-r5-beta-3/bin/arm-agb-elf-ld.exe: Warning: /devkitadv-r5-beta-3/arm
<br/>
-agb-elf/lib\libc.a(impure.o) does not support interworking, whereas meteor.elf
<br/>
does
<br/>
C:/devkitadv-r5-beta-3/bin/arm-agb-elf-ld.exe: Warning: /devkitadv-r5-beta-3/arm
<br/>
-agb-elf/lib\libc.a(reent.o) does not support interworking, whereas meteor.elf d
<br/>
oes
<br/>
<br/>
crt0.o: In function `__FarProcedure':
<br/>
crt0.o(.text+0x1b4): undefined reference to `__sp_irq'
<br/>
crt0.o(.text+0x1b8): undefined reference to `__sp_usr'
<br/>
crt0.o(.text+0x1bc): undefined reference to `__intr_vector_buf'
<br/>
crt0.o(.text+0x1c4): undefined reference to `__text_start'
<br/>
crt0.o(.text+0x1c8): undefined reference to `__sp_usr_offset'
<br/>
crt0.o(.text+0x1d4): undefined reference to `__data_lma'
<br/>
crt0.o(.text+0x1e0): undefined reference to `__iwram_lma'
<br/>
crt0.o(.text+0x1f8): undefined reference to `__ewram_lma'
<br/>
crt0.o: In function `IntrRet':
<br/>
crt0.o(.iwram+0x10c): undefined reference to `IntrTable'
<br/>
meteor.o: In function `METEOR::Game_Level_001_Init()':
<br/>
meteor.o(.text+0xa20): undefined reference to `_Unwind_SjLj_Register'
<br/>
meteor.o(.text+0xb08): undefined reference to `_Unwind_SjLj_Resume'
<br/>
meteor.o(.text+0xbf0): undefined reference to `_Unwind_SjLj_Resume'
<br/>
<br/>
&lt;b&gt; *Continuing like that* &lt;/b&gt;
<br/>
<br/>
dialogue.o(.text+0x204): undefined reference to `_Unwind_SjLj_Register'
<br/>
dialogue.o(.text+0x320): undefined reference to `_Unwind_SjLj_Resume'
<br/>
dialogue.o(.text+0x344): undefined reference to `_Unwind_SjLj_Unregister'
<br/>
game_menu.o: In function `GameMenu::Show()':
<br/>
game_menu.o(.text+0xe08): undefined reference to `_Unwind_SjLj_Register'
<br/>
game_menu.o(.text+0xf10): undefined reference to `_Unwind_SjLj_Resume'
<br/>
game_menu.o(.text+0x11c0): undefined reference to `_Unwind_SjLj_Resume'
<br/>
game_menu.o(.text+0x1298): undefined reference to `_Unwind_SjLj_Unregister'
<br/>
/devkitadv-r5-beta-3/arm-agb-elf/lib\libstdc++.a(eh_personality.o): In function
<br/>
`base_of_encoded_value':
<br/>
../../../../gcc-3.2.2/gcc/unwind-pe.h:106: undefined reference to `_Unwind_GetRe
<br/>
gionStart'
<br/>
/devkitadv-r5-beta-3/arm-agb-elf/lib\libstdc++.a(eh_personality.o): In function
<br/>
`parse_lsda_header':
<br/>
../../../../gcc-3.2.2/libstdc++-v3/libsupc++/eh_personality.cc:59: undefined ref
<br/>
erence to `_Unwind_GetRegionStart'
<br/>
/devkitadv-r5-beta-3/arm-agb-elf/lib\libstdc++.a(eh_personality.o): In function
<br/>
`__gxx_personality_sj0':
<br/>
../../../../gcc-3.2.2/libstdc++-v3/libsupc++/eh_personality.cc:418: undefined re
<br/>
ference to `_Unwind_SetGR'
<br/>
../../../../gcc-3.2.2/libstdc++-v3/libsupc++/eh_personality.cc:420: undefined re
<br/>
ference to `_Unwind_SetGR'
<br/>
<br/>
&lt;b&gt;*Continuing like that*&lt;/b&gt;
<br/>
<br/>
o `_Unwind_SjLj_Resume'
<br/>
/devkitadv-r5-beta-3/arm-agb-elf/lib\libstdc++.a(eh_catch.o): In function `__cxa
<br/>
_end_catch':
<br/>
../../../../gcc-3.2.2/libstdc++-v3/libsupc++/eh_catch.cc:90: undefined reference
<br/>
 to `_Unwind_DeleteException'
<br/>
make: *** [meteor.elf] Error 1
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/>"The best optimizer is between your ears..."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12666 - johnny_north - Fri Nov 21, 2003 5:22 pm</h4>
    <div class="postbody"><span class="postbody">You're using a couple of conventions that I'm not familiar with. I'd say that you  might focus on two areas:
<br/>
<br/>
1) Make sure that you have selected the correct options in crt0.s for your project. These may include c++ support, interupt handling, and stack placement.
<br/>
2) Make sure you've selected the appropriate link flags and that they are coming into play at the appropriate step in the process. It appears that some of your CFLAGS options actually belong to LDFLAGS
<br/>
<br/>
I can't say that either of these is the case, but probably. I'm not familiar with conventions like using '+=' in the make file. Also, the placement of tabs and spaces seems to be citical so stuff like:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">-ocrt0.o</td> </tr></table><span class="postbody">
<br/>
may cause problems not caused by
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">-o crt0.o</td> </tr></table><span class="postbody">
<br/>
<br/>
Here's a sample that works using no wild cards:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">GCCARM = C:\WINDOWS\Desktop\devkit\devkitadv\bin
<br/>
PRJDIR = c:\windows\Desktop\gamedir
<br/>
LIBDIR  = C:\WINDOWS\Desktop\devkit\devkitadv\lib\gcc-lib\arm-agb-elf\3.0.2\interwork
<br/>
LIBDIR2 = C:\WINDOWS\Desktop\devkit\devkitadv\arm-agb-elf\lib\interwork
<br/>
INCDIR  = C:\WINDOWS\Desktop\devkit\devkitadv\lib\gcc-lib\arm-agb-elf\3.0.2\include
<br/>
INCDIR2 = C:\WINDOWS\Desktop\devkit\devkitadv\arm-agb-elf\include
<br/>
<br/>
CFLAGS  = -I $(INCDIR2) -I $(INCDIR) -I $(PRJDIR) -mthumb-interwork -mthumb -c -g -Wall 
<br/>
SFLAGS  = -I $(INCDIR2) -I $(INCDIR) --warn -mthumb-interwork -marm7tdmi
<br/>
LDFLAGS = -L $(LIBDIR) -L $(LIBDIR2) -L $(PRJDIR) -T lnkscript -lGbaPlayerGCC -lm -lg -lstdc++ -lgcc -nostartfiles -Wl,-Map,bin.map
<br/>
<br/>
GFXFILES = 
<br/>
MUSICFILES =
<br/>
VOICEFILES =
<br/>
OFILES = crt0.o crtbegin.o crtend.o main.o 
<br/>
<br/>
all: game.bin 
<br/>
<br/>
game.bin: game.elf
<br/>
   objcopy -O binary game.elf game.bin
<br/>
<br/>
game.elf: $(OFILES) $(GFXFILES) $(MUSICFILES) $(VOICEFILES)
<br/>
   gcc -o game.elf $(OFILES) $(GFXFILES) $(MUSICFILES) $(VOICEFILES) $(LDFLAGS)
<br/>
<br/>
main.o: main.cpp 
<br/>
   gcc $(CFLAGS) main.cpp
<br/>
Crt0.o: Crt0.s
<br/>
   as $(SFLAGS) -o Crt0.o Crt0.s</td> </tr></table><span class="postbody">
<br/>
<br/>
The code listing here will wrap certain long lines which won't work in an actual make file. If you need to break a line use the " \" at the end of the line. That's "(space)\". You may or may not want to include the -mthumb option. Also, certain measures need to be taken when using -O3. I've also include a mod playing lib other than karwall, but the idea is the same. I just renamed the lib replacing the .lib extension with .a so that it will cooperate with the gcc linking process.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12679 - Burre - Sat Nov 22, 2003 2:30 pm</h4>
    <div class="postbody"><span class="postbody">I think I'm getting close to solving this problem now. I've combined my makefile with yours, and it solved a lot of the error messages (I think I messed up with the linkscript and crt0.s).
<br/>
<br/>
However, some minor problems have occured:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
# Program name (like PROGNAME.gba)
<br/>
PROGNAME=meteor
<br/>
<br/>
# Directory for the env (edit if placed elsewhere)
<br/>
DEVDIR = C:/devkitadv-r5-beta-3
<br/>
<br/>
#---------------------------------------------------
<br/>
EXEC_PREFIX = arm-agb-elf-
<br/>
<br/>
CC          = $(DEVDIR)/bin/$(EXEC_PREFIX)gcc.exe
<br/>
AS          = $(DEVDIR)/bin/$(EXEC_PREFIX)as.exe
<br/>
OBJCOPY     = $(DEVDIR)/bin/$(EXEC_PREFIX)objcopy.exe
<br/>
#---------------------------------------------------
<br/>
<br/>
PRJDIR = $(DEVDIR)/project
<br/>
LIBDIR  = $(DEVDIR)/arm-agb-elf/lib/interwork
<br/>
LIBDIR2 = $(DEVDIR)/lib/gcc-lib/arm-agb-elf/3.2.2/interwork
<br/>
INCDIR  = $(DEVDIR)/lib/gcc-lib/arm-agb-elf/3.2.2/include
<br/>
INCDIR2 = $(DEVDIR)/arm-agb-elf/include 
<br/>
<br/>
CFLAGS  = -I $(INCDIR2) -I $(INCDIR) -I $(PRJDIR) -mthumb-interwork -mthumb -c -g -Wall 
<br/>
SFLAGS  = -I $(INCDIR2) -I $(INCDIR) --warn -mthumb-interwork -marm7tdmi
<br/>
LDFLAGS = -L $(LIBDIR) -L $(LIBDIR2) -L $(PRJDIR) -T $(DEVDIR)/jeff/lnkscript -lm -lg -lstdc++ -lsupc++ -lgcc -lc -nostartfiles -Wl
<br/>
<br/>
GFXFILES = 
<br/>
MUSICFILES = 
<br/>
OFILES = crt0.o \
<br/>
$(DEVDIR)/jeff/crtbegin.o \
<br/>
$(DEVDIR)/jeff/crtend.o \
<br/>
main.o meteor.o collision.o sprite.o ship.o gameobject.o mapapi.o objapi.o irqapi.o dialogue.o game_menu.o 
<br/>
<br/>
#
<br/>
# Targets start here
<br/>
#
<br/>
<br/>
all: $(PROGNAME).gba fixheader clean
<br/>
<br/>
$(PROGNAME).gba: $(PROGNAME).elf 
<br/>
   $(OBJCOPY) -O binary $(PROGNAME).elf $(PROGNAME).gba 
<br/>
<br/>
$(PROGNAME).elf: $(OFILES) $(GFXFILES) $(MUSICFILES) 
<br/>
   $(CC) -o game.elf $(OFILES) $(GFXFILES) $(MUSICFILES) $(LDFLAGS) 
<br/>
   
<br/>
# Target for cpp files
<br/>
.cpp.o:
<br/>
   $(CC) $(CFLAGS) $&lt; -o $@
<br/>
   
<br/>
# Handle the crt0.o file
<br/>
crt0.o: $(DEVDIR)/jeff/crt0.s
<br/>
   $(AS) $(SFLAGS) $(DEVDIR)/jeff/crt0.s -o crt0.o
<br/>
   
<br/>
# These two don't need any compilation since they're already o-files
<br/>
crtbegin.o:
<br/>
crtend.o:
<br/>
<br/>
# Make GBA-file ready for hardware
<br/>
fixheader:
<br/>
   $(DEVDIR)/tools/ham/gbafix.exe $(PROGNAME).gba  
<br/>
<br/>
# Clean up when done
<br/>
clean: 
<br/>
   $(DEVDIR)/tools/rm -f *.o *.i *.ii
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Output:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
* Successful compilation and assemblation followed by:
<br/>
<br/>
C:/devkitadv-r5-beta-3/bin/arm-agb-elf-gcc.exe -o game.elf crt0.o C:/devkitadv-r5-beta-3/jeff/crtbegin.o C:/devkitadv-r5 -beta-3/jeff/crtend.o main.o meteor.o collision.o sprite.o ship.o gameobject.o mapapi.o objapi.o irqapi.o dialogue.o game_menu.o    -L C:/devkitadv-r5-beta-3/arm-agb-elf/lib/interwork -L C:/devkitadv-r5-beta-3/lib/gcc-lib/arm-agb-elf/3.2.2/interwork -L C:/devkitadv-r5-beta-3/project -T C:/devkitadv-r5-beta-3/jeff/lnkscript -lm -lg -lstdc++ -lsupc++ -lgcc -lc
<br/>
 -nostartfiles -Wl
<br/>
<br/>
C:\devkitadv-r5-beta-3\bin\..\lib\gcc-lib\arm-agb-elf\3.2.2\..\..\..\..\arm-agb-elf\bin\ld.exe: section .data [082e8770-&gt; 082e9143] overlaps section .gcc_except_table [082e86f4 -&gt; 082e877b]
<br/>
<br/>
C:/devkitadv-r5-beta-3/arm-agb-elf/lib/interwork\libg.a(agbmain.o): In function `AgbMain':
<br/>
../../../../../../../gcc-3.2.2/newlib/libc/sys/agb/agbmain.c:24: undefined reference to `_init'
<br/>
../../../../../../../gcc-3.2.2/newlib/libc/sys/agb/agbmain.c:25: undefined reference to `_fini'
<br/>
C:/devkitadv-r5-beta-3/arm-agb-elf/lib/interwork\libg.a(agb-sbrk.o): In function `_sbrk':
<br/>
../../../../../../../gcc-3.2.2/newlib/libc/sys/agb/agb-sbrk.c:28: undefined reference to `__appended_end'
<br/>
../../../../../../../gcc-3.2.2/newlib/libc/sys/agb/agb-sbrk.c:28: undefined reference to `__heap_limit'
<br/>
../../../../../../../gcc-3.2.2/newlib/libc/sys/agb/agb-sbrk.c:28: undefined reference to `__appended_start'
<br/>
collect2: ld returned 1 exit status
<br/>
make: *** [game.elf] Error 1
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
It seems like it complains about libc, but that lib is already included (-lc in the makefile).
<br/>
<br/>
What could be wrong?
<br/>
<br/>
Note: I'm using Jeff Frohwein's crt0.s and linkscript (wich I found out is the same as included in HAM, so it shouldn't interfere with my code) and crtbegin.o and crtend.o from DKA.
<br/>
<br/>
Please help.<br/>_________________<br/>"The best optimizer is between your ears..."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12715 - Miked0801 - Mon Nov 24, 2003 9:02 am</h4>
    <div class="postbody"><span class="postbody">From what I can see, you've got 2 pieces of code requesting the same area on the cartridge for ROM - perhaps a funky __attribute(section...) in your code somewhere?  Good luck on this one.  I usually start punching things when I get section conflicts... :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12721 - johnny_north - Mon Nov 24, 2003 3:42 pm</h4>
    <div class="postbody"><span class="postbody">Nothing like getting this far along and running up against a wall of link errors. The only thing I can think of this morining is to make sure that the crt0.s and the lnkscript are out of the same version. They are meant to go together and differing version might cause these problems. I'll think on this a while. Otherwise, take Mike D's feel-good approach.
<br/>
<br/>
Oh one more thing. I'm not personally using R5 yet. You may want to experiment with R4 and run the same make against it - just for an experiment. I know Jeff's file combo works with R4. The R4 includes a windows patch in one of the zip files. I think this one needs to be applied after the rest are unzipped into a directory to make sure the whole setup works.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
