<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Adding binary data - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > Adding binary data</h2>
<div id="posts">
<div class="post">
    <h4>#8934 - punchy - Thu Jul 24, 2003 10:00 am</h4>
    <div class="postbody"><span class="postbody">Hi, 
<br/>
<br/>
I'm working on a simple emulator for the GBA and I'm getting ready to release it. Currently I take the ROMs for the game I emulate, run them through objcopy to get labels the linker will pick up, and then link them in at compile time.
<br/>
<br/>
However, I can't release the emulator with copyrighted ROMS so I need a way of adding them to the already complied binary. How do I refer the ROM images in code if they aren't added yet?
<br/>
<br/>
Any help would be most appreciated.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8936 - ampz - Thu Jul 24, 2003 10:27 am</h4>
    <div class="postbody"><span class="postbody">Newbie or C/C++ section perhaps?
<br/>
Your load the ROM image from file into RAM.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8937 - Quirky - Thu Jul 24, 2003 10:27 am</h4>
    <div class="postbody"><span class="postbody">After you compile, pad your binary to a particular size, then set an address in the code to this known padded size. You can access the data at that memory location.
<br/>
<br/>
For example, if your binary (.gba) file compiles to 31000 bytes... you could potentially pad it to 32000 bytes and add a pointer to 32000 in rom:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define datapointer (( u8*)(0x8000000+32000))
<br/>
<br/>
int main (void) {
<br/>
 load_rom(datapointer);
<br/>
}
<br/>
<br/>
<br/>
void load_rom(u8 * data) {
<br/>
   // data points to the data...
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
then recompile it - it might recompile to 31020 bytes now (for example)... but you pad it to 32000 so it doesn't matter. 
<br/>
<br/>
Append your roms with (in dos)
<br/>
<br/>
copy /b emulator.gba+&lt;file&gt;.rom emulatorandgame.gba
<br/>
<br/>
By having a "size" byte in the appended rom or knowing all games are a particular size, you can step from the base pointer to other games in rom.
<br/>
<br/>
What's the emulator of, by the way? :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8939 - punchy - Thu Jul 24, 2003 11:25 am</h4>
    <div class="postbody"><span class="postbody">Thanks Quirky!
<br/>
<br/>
The emulator is Phoenix.
<br/>
<br/>
<a href="http://www.geocities.com/rgbPhoenix/index.html" target="_blank">http://www.geocities.com/rgbPhoenix/index.html</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9001 - www-fmsoftware-info - Sat Jul 26, 2003 2:03 am</h4>
    <div class="postbody"><span class="postbody">Very nice game.
<br/>
<br/>
Not sure about pressing select to fire though :\<br/>_________________<br/><a href="http://www.fmsoftware.btinternet.co.uk/Pictures/3dGBA.jpg">[Images not permitted - Click here to view it]</a>
<br/>
<a class="postlink" href="http://www.fmsoftware.info" target="_blank">www.fmsoftware.info</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9511 - Burre - Thu Aug 07, 2003 12:36 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>www-fmsoftware-info wrote:</b></span></td> </tr> <tr> <td class="quote">Very nice game.
<br/>
<br/>
Not sure about pressing select to fire though :\</td> </tr></table><span class="postbody">
<br/>
<br/>
Since the screen is tilted i guess it is supposed to be played like that (making the select-button a more clever choice than the A-button). Though if you have an SP either one could be difficult to use.
<br/>
<br/>
Nice demo anyway...<br/>_________________<br/>"The best optimizer is between your ears..."</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
