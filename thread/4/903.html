<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>text background tile set - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Coding > text background tile set</h2>
<div id="posts">
<div class="post">
    <h4>#4521 - Ninj4D4n - Wed Apr 02, 2003 3:19 pm</h4>
    <div class="postbody"><span class="postbody">Hey all
<br/>
<br/>
I have no problem working with rotational backgrounds, but some stuff with text backgrounds is giving me trouble.
<br/>
<br/>
I'm currently trying to render a full screen image as a background.  The problem is that the image when broken up into tiles, is made of 600 different tiles.  This means there's too many to load into a character base block for use with a rot background (max 256 right?).
<br/>
<br/>
Well, i've seen it stated (and by the indexing in text backgrounds), that a text background can handle up to 1024 tiles.
<br/>
So my questions are:
<br/>
1) Wouldn't 1024 tiles fill all four character base blocks leaving no room to put a map into a screen base block?
<br/>
2) If i want to use all 600 tiles, do i just load them up, in order, into character 2 character base blocks.  Then i can just index to them with 0-599?
<br/>
3) Is there any other issues i should be aware of?
<br/>
<br/>
Thanks in advance,
<br/>
Ninj4D4n</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4526 - Quirky - Wed Apr 02, 2003 4:26 pm</h4>
    <div class="postbody"><span class="postbody">1024 tiles would fill:
<br/>
<br/>
1024 * 8 *8 = 65536 bytes. 
<br/>
<br/>
If you have your character (tile) base at 0x6000000 (char base 0 out of a possible 0-3) and your screen (map) base at 31 (of 31, or 0x600F800 in memory terms) then you have 0xF800 bytes of tile data to use up for tiles - or 63488 bytes in decimal. Therefore with your 1024 tiles, the last few would blitz your map data.
<br/>
<br/>
So the maximum realistic number of tiles you could get away with (256 colours) is 992. I reckon anyway.
<br/>
<br/>
If you use 4 bits per pixel, you can double that quantity.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4537 - Ninj4D4n - Wed Apr 02, 2003 8:02 pm</h4>
    <div class="postbody"><span class="postbody">Thanks Quirky, thought i had made a calculation error.
<br/>
<br/>
So now if want to use the tile data:
<br/>
Say i stored 992 tiles like you said, with my map in the last SBB.  Now my background should be set to character base block 0, screen base block 31, and my availbe index range is 0-991?
<br/>
<br/>
--Ninj4D4n</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4546 - peebrain - Thu Apr 03, 2003 12:10 am</h4>
    <div class="postbody"><span class="postbody">Umm... it has 1024 so you can address 1024 tiles while in 16-color mode.  I'm pretty sure that in 256-color mode you can only use 512 tiles (0, 2, 4, 6, 8, ..., 1020, 1022)... Or maybe I'm thinking of sprites?
<br/>
<br/>
~Sean<br/>_________________<br/><a href="http://www.pbwhere.com" target="_blank">http://www.pbwhere.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4547 - tepples - Thu Apr 03, 2003 12:52 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>peebrain wrote:</b></span></td> </tr> <tr> <td class="quote">in 256-color mode you can only use 512 tiles (0, 2, 4, 6, 8, ..., 1020, 1022)... Or maybe I'm thinking of sprites?</td> </tr></table><span class="postbody">
<br/>
That's sprites.
<br/>
<br/>
In 16-color text mode, a background can address up to 1024 tiles spanning 32 KB, or two of the four pattern tables.  A full-screen image including the map will just barely fit in 20 KB.
<br/>
<br/>
In 256-color text mode, a background can address up to 1024 tiles spanning 64 KB, or all four pattern tables.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4560 - Ninj4D4n - Thu Apr 03, 2003 2:24 pm</h4>
    <div class="postbody"><span class="postbody">Hey, thanks alot for all the the comments guys, it really cleared some stuff up for me, but for some reason i'm still getting an error in my image.  Here's the code i'm using:
<br/>
<br/>
[code]
<br/>
#ifndef INTRO_H
<br/>
#define INTRO_H
<br/>
<br/>
#include "Ninja/NinjaBGPalette.h"
<br/>
#include "Ninja/NinjaTiles.h"
<br/>
#include "Ninja/ForestMap.h"
<br/>
<br/>
<br/>
void Intro1(void)
<br/>
{
<br/>
	SetMode(MODE_0 | OBJ_MAP_1D);
<br/>
<br/>
	//setup background info
<br/>
	Background Back1;
<br/>
	Back1.number = 0;
<br/>
	Back1.colorMode = BG_COLOR_256;
<br/>
	Back1.size = TEXTBG_SIZE_256x256;
<br/>
	Back1.charBaseBlock = 0;
<br/>
	Back1.screenBaseBlock = 29;
<br/>
	Back1.x_scroll = 0;
<br/>
	Back1.y_scroll = 0;
<br/>
<br/>
	LoadBGPalette((u16*)NinjaBGPalette);
<br/>
	LoadTileData(0, (u16*)NinjaTilesData, NinjaTiles_WIDTH, NinjaTiles_HEIGHT);
<br/>
	LoadTextMapData(29, (u16*)ForestMap, 32, 32);
<br/>
<br/>
	REG_BG0HOFS = Back1.x_scroll;
<br/>
	REG_BG0VOFS = Back1.y_scroll;
<br/>
	EnableBackground(&amp;Back1);
<br/>
	int x;
<br/>
<br/>
	while(1)
<br/>
	{
<br/>
		if(!(*KEYS &amp; KEY_UP))		//if the up key is pressed
<br/>
		{
<br/>
			Back1.y_scroll++;
<br/>
		}
<br/>
		if(!(*KEYS &amp; KEY_DOWN))         //if the up down is pressed
<br/>
		{
<br/>
			Back1.y_scroll--;
<br/>
		}
<br/>
		if(!(*KEYS &amp; KEY_LEFT))         //if the up left is pressed
<br/>
		{	
<br/>
			Back1.x_scroll--;
<br/>
		}
<br/>
		if(!(*KEYS &amp; KEY_RIGHT))         //if the up left is pressed
<br/>
		{
<br/>
			Back1.x_scroll++;
<br/>
		}
<br/>
<br/>
		WaitForVsync();
<br/>
		for(x = 0; x &lt; 10000; x++)
<br/>
		{}
<br/>
<br/>
		REG_BG0HOFS = Back1.x_scroll;
<br/>
		REG_BG0VOFS = Back1.y_scroll;
<br/>
	}
<br/>
}
<br/>
[/code]
<br/>
<br/>
and:
<br/>
[code]
<br/>
#ifndef BGS
<br/>
#define BG0_ENABLE	0x100
<br/>
#define BG1_ENABLE	0x200
<br/>
#define BG2_ENABLE	0x400
<br/>
#define BG3_ENABLE	0x800
<br/>
#define OBJ_ENABLE	0x1000
<br/>
#endif
<br/>
<br/>
<br/>
//Background defines -- BGCNT defines
<br/>
#define BG_MOSAIC_ENABLE		0x40
<br/>
#define BG_COLOR_256			0x80
<br/>
#define BG_COLOR_16				0x0
<br/>
//macros to point to mememory
<br/>
#define CharBaseBlock(n)		(((n)*0x4000)+0x6000000)
<br/>
#define ScreenBaseBlock(n)		(((n)*0x800)+0x6000000)
<br/>
<br/>
#define CHAR_SHIFT				2
<br/>
#define SCREEN_SHIFT			8
<br/>
#define TEXTBG_SIZE_256x256		0x0
<br/>
#define TEXTBG_SIZE_256x512		0x8000
<br/>
#define TEXTBG_SIZE_512x256		0x4000
<br/>
#define TEXTBG_SIZE_512x512		0xC000
<br/>
<br/>
#define ROTBG_SIZE_128x128		0x0
<br/>
#define ROTBG_SIZE_256x256		0x4000
<br/>
#define ROTBG_SIZE_512x512		0x8000
<br/>
#define ROTBG_SIZE_1024x1024	0xC000
<br/>
<br/>
#define WRAPAROUND             	0x1
<br/>
<br/>
<br/>
//structure for a background
<br/>
class Background
<br/>
{
<br/>
public:
<br/>
	u16* tileData;
<br/>
	u16* mapData;
<br/>
	u8 mosaic;
<br/>
	u8 colorMode;
<br/>
	u8 number;
<br/>
	u16 size;
<br/>
	u8 charBaseBlock;
<br/>
	u8 screenBaseBlock;
<br/>
	u8 wraparound;
<br/>
	s16 x_scroll,y_scroll;
<br/>
<br/>
	int angle;
<br/>
	int center_x, center_y;
<br/>
	FIXED zoom;
<br/>
<br/>
	s32 DX,DY;
<br/>
	s16 PA,PB,PC,PD;
<br/>
};
<br/>
<br/>
//load the background palette with colors
<br/>
void LoadBGPalette(u16* colors)
<br/>
{
<br/>
	int x;
<br/>
	for(x = 0; x &lt; 256; x++)
<br/>
		BGPalette[x] = colors[x];
<br/>
}
<br/>
<br/>
//loads tiles to character block CBB, needs width and height
<br/>
//to load correct amount of data; 
<br/>
void LoadTileData(u16 CBB, u16* tiles, int tileWidth, int tileHeight)
<br/>
{
<br/>
	int x;
<br/>
	u16* tempBlock = (u16*)CharBaseBlock(CBB);
<br/>
	for(x = 0; x &lt; tileWidth*tileHeight/2 ; x++)
<br/>
		tempBlock[x] = tiles[x];
<br/>
}
<br/>
<br/>
//Load a text map (wxh) to screen base block SBB
<br/>
void LoadTextMapData(u8 SBB, u16* map, int Width, int Height)
<br/>
{
<br/>
	int x;
<br/>
	u16* tempBlock = (u16*)ScreenBaseBlock(SBB);
<br/>
	for(x = 0; x &lt; Width*Height; x++)
<br/>
		tempBlock[x] = map[x];
<br/>
}
<br/>
<br/>
//load a rot map(wxh) to screen base block SBB;
<br/>
void LoadRotMapData(u8 SBB, u8* map, int Width, int Height)
<br/>
{
<br/>
	int x;
<br/>
	u16* tempBlock = (u16*)ScreenBaseBlock(SBB);
<br/>
	u16* tempMap = (u16*)map;
<br/>
	for(x = 0; x &lt; Width*Height/2; x++)
<br/>
		tempBlock[x] = map[x];
<br/>
}
<br/>
<br/>
//turns on a background
<br/>
void EnableBackground(Background* bg)
<br/>
{
<br/>
	u16 temp;
<br/>
<br/>
	bg-&gt;tileData = (u16*)CharBaseBlock(bg-&gt;charBaseBlock);
<br/>
	bg-&gt;mapData = (u16*)ScreenBaseBlock(bg-&gt;screenBaseBlock);
<br/>
	temp = bg-&gt;size | (bg-&gt;charBaseBlock&lt;&lt;CHAR_SHIFT) | (bg-&gt;screenBaseBlock&lt;&lt;SCREEN_SHIFT)
<br/>
		| bg-&gt;colorMode | bg-&gt;mosaic | bg-&gt;wraparound | bg-&gt;number;
<br/>
<br/>
	switch(bg-&gt;number)
<br/>
	{
<br/>
	case 0:
<br/>
		{
<br/>
			REG_BG0CNT = temp;
<br/>
			REG_DISPCNT |= BG0_ENABLE;
<br/>
		}break;
<br/>
	case 1:
<br/>
		{
<br/>
			REG_BG1CNT = temp;
<br/>
			REG_DISPCNT |= BG1_ENABLE;
<br/>
		}break;
<br/>
	case 2:
<br/>
		{
<br/>
			REG_BG2CNT = temp;
<br/>
			REG_DISPCNT |= BG2_ENABLE;
<br/>
		}break;
<br/>
	case 3:
<br/>
		{
<br/>
			REG_BG3CNT = temp;
<br/>
			REG_DISPCNT |= BG3_ENABLE;
<br/>
		}break;
<br/>
<br/>
	default:break;
<br/>
<br/>
	}
<br/>
}
<br/>
[/code]
<br/>
<br/>
<br/>
Now my image loads, but it looks wrong.  It appears to be shifted up by half the screen.  and in the horizontal middle, it is split so that the right side is shifted up one tile square.  If i scroll the background down, what's above what i can initially see is garbage.  I've checked my palette, tile set, and map data over and over again, and it looks fine.  The map uses 600 tiles arranged to cover the screen (any tile of the background that should be offscreen is just one of the 600).
<br/>
<br/>
I'll try and get a picture later today, i'm running out the door right now, but if anybody can see where i'm making a mistake that would be real helpful.
<br/>
<br/>
Thanks again for all the help
<br/>
--Ninj4D4n</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
