<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>sin, cos and tan tables - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Coding > sin, cos and tan tables</h2>
<div id="posts">
<div class="post">
    <h4>#26664 - keldon - Wed Sep 22, 2004 3:57 pm</h4>
    <div class="postbody"><span class="postbody">Instead of storing the actual sine (multiplied), store the recrical of 1 / sin(x). So for sin (106), which is 0.96, we will store 65536 * sin ( 106 ) <span style="font-weight: bold"> (which is equal to 65536 / ( 1 / sin ( x ) )</span>.
<br/>
<br/>
Now just multiply your value by sin [106], and wahay you've got it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26665 - getch - Wed Sep 22, 2004 4:03 pm</h4>
    <div class="postbody"><span class="postbody">does that help with something?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26667 - ampz - Wed Sep 22, 2004 6:16 pm</h4>
    <div class="postbody"><span class="postbody">There is no reason to store more than a quarter of a sinewave. (0 to 90 degrees)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26668 - jma - Wed Sep 22, 2004 6:25 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ampz wrote:</b></span></td> </tr> <tr> <td class="quote">There is no reason to store more than a quarter of a sinewave. (0 to 90 degrees)</td> </tr></table><span class="postbody">
<br/>
Sure there is: speed. Otherwise there is clamping of ranges, conditionals and extra math in there that isn't necessary. The question is whether or not you are using constants or variables. With constants you could do it yourself, and I agree 0-90 is just fine. With variables (ie, you're coding a library), speed may be more important.
<br/>
<br/>
Jeff<br/>_________________<br/><a href="mailto:massung@gmail.com">massung@gmail.com</a>
<br/>
<a href="http://www.retrobyte.org" target="_blank">http://www.retrobyte.org</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26669 - keldon - Wed Sep 22, 2004 6:29 pm</h4>
    <div class="postbody"><span class="postbody">Was rushing because PC keeps resetting and did not read cern tutorials properly. It is the same calculation and method. Silly mistake really.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26672 - Lord Graga - Wed Sep 22, 2004 8:52 pm</h4>
    <div class="postbody"><span class="postbody">another option is to use the lovely BIOS function BGAffineSet to make a nice SIN/COS table :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26685 - ampz - Thu Sep 23, 2004 4:00 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>jma wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ampz wrote:</b></span></td> </tr> <tr> <td class="quote">There is no reason to store more than a quarter of a sinewave. (0 to 90 degrees)</td> </tr></table><span class="postbody">
<br/>
Sure there is: speed. Otherwise there is clamping of ranges, conditionals and extra math in there that isn't necessary. The question is whether or not you are using constants or variables. With constants you could do it yourself, and I agree 0-90 is just fine. With variables (ie, you're coding a library), speed may be more important.
<br/>
<br/>
Jeff</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Yes, a full sine wave provides slightly higher speed than a quarter sine, but there is only a few cycles difference. There is another aspect: With a small quarter wave table you might be able to easier fit it in fast RAM. It all depends on what resolution you need. If you only need 256 degrees resolution, then you don't save much by using a quarter sine, but if you need 4096 degrees, then it becomes a bit harder to fit it in RAM unless reduced to a quarter sine.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26691 - tepples - Thu Sep 23, 2004 8:48 pm</h4>
    <div class="postbody"><span class="postbody">And if you have even more things that would benefit from being in fast RAM, then given the ARM7TDMI CPU's fast multiplier, it might actually prove faster overall to do linear interpolation on a smaller table.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27275 - AnthC - Thu Oct 07, 2004 11:31 pm</h4>
    <div class="postbody"><span class="postbody">Here's code you can use to generate a sintable.
<br/>
The advantages of this is that it fix into only a few lines of asm.
<br/>
Values are scaled by (1&lt;&lt;24) so the sin of 90 will be (1&lt;&lt;24)
<br/>
<br/>
S32 SinTab[1024];
<br/>
<br/>
#define S64 long int
<br/>
<br/>
void MakeTab(void)
<br/>
{
<br/>
	S64  k= 33553800;
<br/>
	S64  f0= 0;
<br/>
	S64  f1=-102943;
<br/>
<br/>
	for (int i=0;i&lt;1024;i++)
<br/>
	{
<br/>
		SinTab[i]=(S32)f0;
<br/>
		S64 tmp=f0;
<br/>
		f0=((f0*k)/(1&lt;&lt;24))-f1;
<br/>
		f1=tmp;
<br/>
	}
<br/>
}
<br/>
<br/>
// 0..1024 is 0..360 degree so degrees angle*1024/360
<br/>
<br/>
int Sin(int angle)
<br/>
{
<br/>
	return SinTab[angle&amp;1023];
<br/>
}
<br/>
<br/>
int Cos(int angle)
<br/>
{
<br/>
	return SinTab[(angle-256)&amp;1023];
<br/>
}</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27276 - sajiimori - Thu Oct 07, 2004 11:49 pm</h4>
    <div class="postbody"><span class="postbody">I think you need "long long" for 64 bits... "long int" is the same as "long", which is 32 bits on ARM GCC.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27277 - poslundc - Fri Oct 08, 2004 12:58 am</h4>
    <div class="postbody"><span class="postbody">Also: there is little reason to use a 64-bit sinetable, since you can only do 32-bit multiplication on the ARM. Assuming you do long-long multiplication, you will already want to get rid of most of the extra generated precision anyway.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27357 - AnthC - Mon Oct 11, 2004 12:08 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">I think you need "long long" for 64 bits... "long int" is the same as "long", which is 32 bits on ARM GCC.</td> </tr></table><span class="postbody">
<br/>
<br/>
Yup that's true - should have tested it, usual problem when porting PC code which involves __int64 to the GBA.
<br/>
<br/>
Other comments - 
<br/>
<br/>
The sintable is in 32 bit format, the process to generate it lazily uses 64 bit numbers/multiply.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27365 - Lord Graga - Mon Oct 11, 2004 5:05 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>AnthC wrote:</b></span></td> </tr> <tr> <td class="quote">S32 SinTab[1024];
<br/>
<br/>
#define S64 long int
<br/>
<br/>
void MakeTab(void)
<br/>
{
<br/>
	S64  k= 33553800;
<br/>
	S64  f0= 0;
<br/>
	S64  f1=-102943;
<br/>
<br/>
	for (int i=0;i&lt;1024;i++)
<br/>
	{
<br/>
		SinTab[i]=(S32)f0;
<br/>
		S64 tmp=f0;
<br/>
		f0=((f0*k)/(1&lt;&lt;24))-f1;
<br/>
		f1=tmp;
<br/>
	}
<br/>
}
<br/>
<br/>
// 0..1024 is 0..360 degree so degrees angle*1024/360
<br/>
<br/>
int Sin(int angle)
<br/>
{
<br/>
	return SinTab[angle&amp;1023];
<br/>
}
<br/>
<br/>
int Cos(int angle)
<br/>
{
<br/>
	return SinTab[(angle-256)&amp;1023];
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
Heh, looks like a thing that I saw in <a class="postlink" href="http://www.hugi.de" target="_blank">HUGI</a>. They have a collection of coding articles up, they are well worth reading. More specifically, they have a whole article dedicated to creating SIN tables :).
<br/>
<br/>
<br/>
There's also the BGAffine function to get the SIN/COS table, you may not forget.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
