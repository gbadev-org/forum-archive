<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>compiling into rom or ram? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > compiling into rom or ram?</h2>
<div id="posts">
<div class="post">
    <h4>#14065 - gbawiz - Sun Dec 28, 2003 9:41 pm</h4>
    <div class="postbody"><span class="postbody">Hello,
<br/>
I was wondering about what happens when my code is compiled. Is it compiled and stored in the area where the GBA rom information resides or is it loaded into the RAM.
<br/>
I ask this because I seem to have run out of memory in my project and would like to know more about the way my compiler allocates memory.
<br/>
<br/>
Thanks
<br/>
GbaWIZ</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14068 - Lord Graga - Sun Dec 28, 2003 11:22 pm</h4>
    <div class="postbody"><span class="postbody">if you ran out of RAM, then check if there's some arrays/etc that you could make constant.
<br/>
<br/>
Are you compiling in multiboot?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14071 - sajiimori - Mon Dec 29, 2003 12:23 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
I seem to have run out of memory in my project and would like to know more about the way my compiler allocates memory.
<br/>
</td> </tr></table><span class="postbody">
<br/>
This is roughly analogous to:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
My shirt is dirty and I'd like to know if the colors will bleed if I put it in my washing machine.
<br/>
</td> </tr></table><span class="postbody">
<br/>
Just about every aspect of the question is missing crucial information. =)
<br/>
<br/>
Obviously, it depends on what your code is, what compiler you're using, and what flags you use with the compiler.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14084 - gbawiz - Mon Dec 29, 2003 12:07 pm</h4>
    <div class="postbody"><span class="postbody">hello all,
<br/>
<br/>
well my code consists of the main program with the graphics data stored as hexadecimal header info i.e mygfx[n]={12,12,64,76,etc.....};
<br/>
I have noted that making these headers const tends to cause problems in some cases and solves problems in others.
<br/>
I use devkit advance with the standard compiler batch file:
<br/>
<br/>
set path=C:\devkitadv\bin;%path%
<br/>
gcc -o main.elf main.c -lm
<br/>
objcopy -O binary main.elf main.gba
<br/>
pause
<br/>
<br/>
are there any specific flags which need set which would make my programs work properly?
<br/>
<br/>
thanks for response,
<br/>
gbaWIZ</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14086 - Lord Graga - Mon Dec 29, 2003 2:39 pm</h4>
    <div class="postbody"><span class="postbody">I think that you should make all the GFX headers constant. If you get errors, post them here (in this thread), so that we can help you out.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14097 - sajiimori - Mon Dec 29, 2003 8:47 pm</h4>
    <div class="postbody"><span class="postbody">If you don't declare data const, the compiler will assume you might modify it, so it will be stored in RAM.  What problems did you have by declaring your graphics const?
<br/>
<br/>
Anyway, headers should never contain data object definitions.  You can get away with it for a simple program with only one module, but get out of the habit as soon as possible if you intend to move on to larger projects.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14123 - gbawiz - Tue Dec 30, 2003 8:40 pm</h4>
    <div class="postbody"><span class="postbody">thanks for your advice,
<br/>
it turns out that when i was making my graphics headers 'const' i kept forgetting one (which i was leaving as non-constant). the result was that the space allocated to this forgotten header was being overwritten by other parts of the program. So now all my GFX headers are const and they seem to work properly, thanks.
<br/>
Does that mean when I make them const, they are stored in rom only. as opposed to normal where there is both a copy in the rom and ram?
<br/>
<br/>
why should headers never contain data object definitions. what method is better to include my graphics data?
<br/>
<br/>
thanks again =)
<br/>
GbaWIZ</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14124 - tepples - Tue Dec 30, 2003 9:36 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>gbawiz wrote:</b></span></td> </tr> <tr> <td class="quote">Does that mean when I make them const, they are stored in rom only. as opposed to normal where there is both a copy in the rom and ram?</td> </tr></table><span class="postbody">
<br/>
Correct. If you don't make them const, they are stored in .data, which the startup code copies to IWRAM. If you make them const, they are stored in .rodata, which the startup code doesn't touch.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">why should headers never contain data object definitions. what method is better to include my graphics data?</td> </tr></table><span class="postbody">
<br/>
Convert graphics data to .s or .c files and compile them separately instead of #include'ing them. Or use <a class="postlink" href="http://www.pineight.com/gba/#gbfs" target="_blank">appended data</a>.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14127 - poslundc - Wed Dec 31, 2003 1:16 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">why should headers never contain data object definitions. what method is better to include my graphics data?</td> </tr></table><span class="postbody">
<br/>
Convert graphics data to .s or .c files and compile them separately instead of #include'ing them. Or use <a class="postlink" href="http://www.pineight.com/gba/#gbfs" target="_blank">appended data</a>.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
To answer the question as to why, picture the following file as a header file:
<br/>
<br/>
mySprite.h:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">const unsigned int mySpriteData[] = {10, 20, 40, 30};</td> </tr></table><span class="postbody">
<br/>
<br/>
Now you #include this file in one of your C programs that accesses it, and it works.
<br/>
<br/>
Problem is, if it even accidentally gets #included in another file (and believe me, sooner or later it WILL happen) you will be defining the same variable <span style="font-style: italic">twice</span>, which is a big no-no, and will generate a <span style="font-weight: bold">bus error</span> at the linking stage (something which has caused me a headache more than once).
<br/>
<br/>
If on the other hand you put the same data into a C file called mySprite.c, and then wrote mySprite.h as follows:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">extern const unsigned int mySpriteData[];</td> </tr></table><span class="postbody">
<br/>
<br/>
It is no longer attempting to <span style="font-style: italic">define</span> the variable, it's just <span style="font-style: italic">declaring</span> its existence. You can #include this file in as many C files as you like, and it won't attempt to connect any data to the actual variable until the linking stage. (You should also use #ifndefs to shield from multiple inclusion.)
<br/>
<br/>
Even if you're careful with your #include statements, the second way is the proper way to do things, because C files are meant to contain data and header files are meant to contain meta-data (data about data).
<br/>
<br/>
I personally think it's a big problem that so many tutuorials teach people to put their data in header files. Oh well.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14159 - Paul Shirley - Wed Dec 31, 2003 6:29 am</h4>
    <div class="postbody"><span class="postbody">removed</span><span class="gensmall"><br/><br/>Last edited by Paul Shirley on Sun Mar 28, 2004 9:26 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#14168 - tepples - Wed Dec 31, 2003 2:35 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Paul Shirley wrote:</b></span></td> </tr> <tr> <td class="quote">The only way you could get a bus error is if the linker itself is broken, you've been corrected on this point before.</td> </tr></table><span class="postbody">
<br/>
Perhaps a widely-distributed linker is in fact broken, and a duplicate symbol error shows up as a bus error.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14170 - poslundc - Wed Dec 31, 2003 3:59 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Paul Shirley wrote:</b></span></td> </tr> <tr> <td class="quote">The only way you could get a bus error is if the linker itself is broken, you've been corrected on this point before.</td> </tr></table><span class="postbody">
<br/>
<br/>
Sorry, but ld seems far from broken on my computer, you'll have to forgive me for not taking every possible explanation I hear on gbadev as gospel. "Your linker is broken" is where the responses began, not where they ended.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
