<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>setting priority how is it done? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Coding > setting priority how is it done?</h2>
<div id="posts">
<div class="post">
    <h4>#7436 - mandarin - Tue Jun 17, 2003 10:12 pm</h4>
    <div class="postbody"><span class="postbody">Ok here are my questions ....how do u set priority in sprites (give me sample code) .....howcome when i use the following function i wrote writes both sprites to the screen but the one flashes away in a millisecond? Help me out here....please
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
int displayitems(u16 x, u16 y, u16 no)
<br/>
{
<br/>
u16 loop;
<br/>
u16 num;
<br/>
u16 attrnum;
<br/>
attrnum=0;
<br/>
attrnum=no*8;
<br/>
num=0;
<br/>
num=no;
<br/>
for(loop=0; loop &lt; 128 ; loop++) {
<br/>
OBJPaletteMem[loop] = itemsPalette[loop];
<br/>
}
<br/>
initsprites(); //sets sprites of screen in case you're wondering
<br/>
sprites[no].attribute0 = COLOR_256 | SQUARE | y;
<br/>
sprites[no].attribute1 = SIZE_16 | x;
<br/>
sprites[no].attribute2 = attrnum | PRIORITY(1);
<br/>
if (no = 0) {
<br/>
num=num+128;
<br/>
for(loop = 0; loop &lt; 128;loop++)
<br/>
{
<br/>
OAMData[loop] = itemsData[loop];
<br/>
}
<br/>
}
<br/>
else {
<br/>
num=(num+1)*128;
<br/>
for(loop = 128; loop &lt;num;loop++)
<br/>
{
<br/>
OAMData[loop] = itemsData[loop-128];
<br/>
}
<br/>
}
<br/>
}
<br/>
<br/>
int main()
<br/>
{
<br/>
        setmode( mode2 | objenable |  objmap1d );
<br/>
<br/>
<br/>
            displayitems(100,100,1);
<br/>
<br/>
           displayitems(120,120,2);
<br/>
<br/>
<br/>
<br/>
       while (1) {
<br/>
<br/>
<br/>
<br/>
        WaitForVsync();
<br/>
<br/>
                   CopyOAM();
<br/>
<br/>
                  }
<br/>
             }</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7480 - Sweex - Wed Jun 18, 2003 4:04 pm</h4>
    <div class="postbody"><span class="postbody">I believe the sprites are drawn in their order. So sprite 0 is drawn on top of everything, sprite 1 is below 0 but on top of 2-127. (Might just be the other way around).
<br/>
<br/>
Also, there is a hardware limit to the amount of sprites / scanline. Don't know the exact numbers for this but I believe there is a (brief) description of this in the Cowbite hardware spec. document. If you exceed this limit, sprites will flicker or appear only partially...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7482 - niltsair - Wed Jun 18, 2003 4:21 pm</h4>
    <div class="postbody"><span class="postbody">"I believe the sprites are drawn in their order. So sprite 0 is drawn on top of everything, sprite 1 is below 0 but on top of 2-127."
<br/>
<br/>
Only true if both Sprite have the asme priority.  Priority is determine like this : 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
if Priority Sprite A &lt; Sprite B
<br/>
    Sprite A on top
<br/>
else if Priority Sprite B &lt; Sprite A
<br/>
     Sprite B on top
<br/>
<br/>
//Sprite have same priority
<br/>
else 
<br/>
    if number SpriteA &lt; Sprite B
<br/>
        SpriteA on top
<br/>
    else
<br/>
        SpriteB on top
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7498 - tepples - Wed Jun 18, 2003 6:38 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>niltsair wrote:</b></span></td> </tr> <tr> <td class="quote">"I believe the sprites are drawn in their order. So sprite 0 is drawn on top of everything, sprite 1 is below 0 but on top of 2-127."
<br/>
<br/>
Only true if both Sprite have the asme priority.</td> </tr></table><span class="postbody">
<br/>
The sprites are drawn in order, front to back. The sprite priority bits are used for priority against the background. If sprite 0 with background priority 1 overlaps sprite 1 with background priority 0, and there's a background layer with background priority 0 between the sprites, then the GBA will put the background pixels in front of any place where they overlap. The NES acted the same way, and priority tricks were common for knocking out a "window" in a sprite.
<br/>
<br/>
If you're not trying to do something dodgy like this, then make sure all prio-0 sprites appear in OAM before all prio-1 sprites, etc.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7500 - niltsair - Wed Jun 18, 2003 6:56 pm</h4>
    <div class="postbody"><span class="postbody">Interesting, didn't knew that.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7503 - mandarin - Wed Jun 18, 2003 8:06 pm</h4>
    <div class="postbody"><span class="postbody">Thanx but there is still a problem
<br/>
<br/>
<br/>
giving i define priority on all my sprites as 0 and i set my funtion to the following...
<br/>
<br/>
displayitem(120,120,0);
<br/>
<br/>
it still just flashes...eg:
<br/>
<br/>
say i define 
<br/>
<br/>
displayitem(120,120,0); //and then
<br/>
displayitem(60,60,1);
<br/>
<br/>
it then flashes the displayitem(120,120,0);
<br/>
and only displays displayitem(60,60,1);
<br/>
<br/>
please help here...if there is something wrong with my function plz point that out to plz.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7507 - niltsair - Wed Jun 18, 2003 9:31 pm</h4>
    <div class="postbody"><span class="postbody">You re-initialize all fo your sprites every time you call DisplayItem. The way it should be is :
<br/>
1. Call InitSprites
<br/>
2. Call DisplayItem
<br/>
3. Call DisplayItem
<br/>
<br/>
That's it. Remove all sprite init code in DisplayItem and only keep the code that set the property of 1 OAM.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
     //....
<br/>
<br/>
    /* Remove this, make syre it's in InitSprite or somewhere else, as logn as you call it once
<br/>
    for(loop=0; loop &lt; 128 ; loop++)
<br/>
        OBJPaletteMem[loop] = itemsPalette[loop];
<br/>
    */
<br/>
<br/>
    /* Remove this, call it once in Main
<br/>
    initsprites(); //sets sprites of screen in case you're wondering
<br/>
    */
<br/>
<br/>
    //Good code
<br/>
    sprites[no].attribute0 = COLOR_256 | SQUARE | y;
<br/>
    sprites[no].attribute1 = SIZE_16 | x;
<br/>
    sprites[no].attribute2 = attrnum | PRIORITY(1);
<br/>
    OAMData[no] = itemsData[no];    
<br/>
    
<br/>
<br/>
    /* What is this for ???
<br/>
    if (no = 0)
<br/>
    {
<br/>
        num=num+128;
<br/>
        for(loop = 0; loop &lt; 128;loop++)
<br/>
            OAMData[loop] = itemsData[loop];    
<br/>
    }
<br/>
    else
<br/>
    {
<br/>
        num=(num+1)*128;
<br/>
        for(loop = 128; loop &lt;num;loop++)
<br/>
            OAMData[loop] = itemsData[loop-128];
<br/>
    }
<br/>
    */
<br/>
    //....
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
This code won't work, you'll have to adjust some stuff. By the only thing you have to understand is to initialize sprite once, and then modify each sprite individually, not every one of them everytime. 
<br/>
<br/>
One way woudl be to keep an array of the individual sprite's values, and once per frame, you DMA the 128 sprite's value in the array to the OAM, thus you don't have to wait for VBlank for every sprite change.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7539 - mandarin - Thu Jun 19, 2003 5:11 pm</h4>
    <div class="postbody"><span class="postbody">thanx man but heres the funny thing i just figured that out this morning on my own that the initsprites(); should only be called once bcoz if i call it twice it sets the first sprite of screen thats why it flashes away.
<br/>
<br/>
Thanx anyway.
<br/>
<br/>
But I got a different problem now when i use the function and i want to call my character sprite with displaycharacter(34,45,3);
<br/>
<br/>
its exactly the same function except the sprite is 32x32 but now you see the new problem is when i load the palette into memory of this sprite it has the same as the items palette even though the character's palette is different. How can i fix this....i tried
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">for(loop = 128; loop &lt; 256;loop++)
<br/>
OBJPaletteMem[loop] = characterPalette[loop-128];
<br/>
<br/>
<br/>
please help </td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7540 - niltsair - Thu Jun 19, 2003 5:18 pm</h4>
    <div class="postbody"><span class="postbody">The thing is, there's either 1 palette of 256 colors that <span style="font-weight: bold">all sprites</span> use or 16 palettes of 16 colors that sprites also al share. No getting around it. So, you either create 1 palette for the 2 sprites or use two 16 colors palette for your 2 sprites.
<br/>
<br/>
Another way could be to decided that sprite 1 will use color 0-127 and sprite 2 color 128-255. Then load both palette to form one 256colors palette and when loading the pixel of sprite 2, add 128 to each of them.
<br/>
<br/>
So basicly, there's only 1 256colors palette entry available. Hardware allow you to either use it as 1 palette, or as 16x 16colors palette.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7543 - mandarin - Thu Jun 19, 2003 5:25 pm</h4>
    <div class="postbody"><span class="postbody">so in other words i can basically have a maximum of 2 256color sprites?
<br/>
<br/>
I don't know i really battle to understand the palette concept plz help.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7546 - niltsair - Thu Jun 19, 2003 5:57 pm</h4>
    <div class="postbody"><span class="postbody">No, there's one 256colors sprites palette. Can be use as a whole, or as 16x 16colors palette.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7547 - mandarin - Thu Jun 19, 2003 6:03 pm</h4>
    <div class="postbody"><span class="postbody">gee wiz...thats not much
<br/>
<br/>
if i want to use 16x16 must i save the pcx file in 16 color mode?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7553 - niltsair - Thu Jun 19, 2003 7:27 pm</h4>
    <div class="postbody"><span class="postbody">Yes, and when converting it to binaries, following a 16colors format when using your conversino tool.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7612 - Cyberman - Sat Jun 21, 2003 12:40 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>mandarin wrote:</b></span></td> </tr> <tr> <td class="quote">gee wiz...thats not much
<br/>
<br/>
if i want to use 16x16 must i save the pcx file in 16 color mode?</td> </tr></table><span class="postbody">
<br/>
<br/>
Umm no he means 1 256 color palette not 1 sprite.
<br/>
<br/>
You have 256 colors for the sprite palette.
<br/>
this gives you 16 16 color sprite palette's. You can have 16 color and 256 color sprites intermixed.
<br/>
<br/>
As for using 16x16 sprite you can use 256 or a 16 color palette. the sprite sizes can be 8x8 to 64x64 in size. 
<br/>
<br/>
Just remember a 16color sprite uses 1/2 the memory a 256 color one does.
<br/>
<br/>
Cyb</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
