<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Odd sprite stripping on hardware (rated G) - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > Odd sprite stripping on hardware (rated G)</h2>
<div id="posts">
<div class="post">
    <h4>#16414 - DiscoStew - Sun Feb 15, 2004 8:10 pm</h4>
    <div class="postbody"><span class="postbody">I didn't realize what I put for the subject until I typed it up. Obviously everyone should realize what I mean by a sprite though.
<br/>
<br/>
My program currently allow a bunch of sprites to be shown on-screen, even all those that are rotating through my sprite handling technique. To point out, there are less than 128 sprites, and of those sprites, less than 32 rotating sprites using unique matrices. When I push a button, it adds another set of sprites to be displayed. Now onto the problem...
<br/>
<br/>
With an emulator, everything is displayed correctly, even the rotating sprites. However, on hardware, when a certain number of sprites are already on screen, and I add another set, those newly-added sprites have an odd cutting away on them, showing only part of them. One odd thing about this is that sometimes the next sprite groups I add may be stripped, or not. You may be thinking that it has something to do with my loading the sprite images to VRAM, but I can tell you, it isn't that, because the rotating sprites don't show that. The rotating sprites have that stripping too, but it doesn't go along with the rotating. It is as if parts of the background (in this case there is no background, just the back plane) are showing as strips on top of my sprite. An observation I made is that it is cutting away by rows, whether the left side of the sprite is showing, or the right side, or complete rows of the sprite are missing, usually blocks of rows. All in all, each sprite affected has its own unique defect stripping, but the stripping for each sprite stays constant and doesn't change. Could it be something with the scanlines? FYI, I am not using a single interrupt with my program, so the H_Blank could not be the problem. I know of the fact that only a certain number (I don't know how many) of sprites can be shown per scanline, but wouldn't affect all sprites on that scanline? Besides, when another sprite group is added on the same scanline as a bunch of others, for some reason it may or may not have the defect. This is one odd bug indeed.
<br/>
<br/>
I'd show you a actual picture so you could understand it visually, but not only do I not have a place on the internet to store the picture, but I don't even have a digital camera to take the picture with (since it is a problem with hardware). However, I'll try it with ASCII characters of what it would look like (not to scale)...
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
Note: "*" = the background
<br/>
<br/>
Image with face, and image rotated 90 degrees
<br/>
***********   ***********
<br/>
***_____***   ***_____***
<br/>
**__O_O__**   **_O_____**
<br/>
*___O_O___*   *_O___OO__*
<br/>
*_________*   *_O_______*
<br/>
*__O___O__*   *_O___OO__*
<br/>
**__OOO__**   **_O_____**
<br/>
***_____***   ***_____***
<br/>
***********   ***********
<br/>
<br/>
Same image, also rotated, but with the stripping
<br/>
***********   ***********
<br/>
***_____***   ***_____***
<br/>
******O__**   ******___**
<br/>
*___O_O___*   *_O___OO__*
<br/>
*_____*****   *_O___*****
<br/>
******_O__*   ******OO__*
<br/>
*****OO__**   *****__****
<br/>
***_____***   ***_____***
<br/>
***********   ***********
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
For those of you who understand the problem, I am asking for your help. I'd apreciate it a lot. thx<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#16415 - torne - Sun Feb 15, 2004 8:33 pm</h4>
    <div class="postbody"><span class="postbody">This sounds like something to do with the number of sprite rendering cycles available per line. Rotation/scaling sprites require many more cycles than normal sprites; gbatek says 26 cycles per 8 horizontal pixels, as opposed to 8 cycles (there are 954 if you have hblank free, 1210 if you don't). The effects you get when there are too many are pretty variable; not all sprites will be affected.
<br/>
<br/>
The maximum number of sprites on one scanline is 128, but only if they are all non-rotate/scale and 8x8. Bigger sprites or rotation/scaling sprites will bring the limit down. Check the sprite overview section of gbatek..</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#16417 - DekuTree64 - Sun Feb 15, 2004 8:44 pm</h4>
    <div class="postbody"><span class="postbody">That's caused by the hardware's sprite drawing limits. I don't remember the exact number of sprite pixels/line it can handle, but I do know that rot/scale sprites take more processing power per pixel than normal ones, and double-sized rot/scales take even more than that, plus they logically have twice as many pixels across each line, so you have to be careful when using large rotating sprites.
<br/>
Still, GBA can handle a lot more than SNES could, as you can see in some games where you can get a whole bunch of enemies gathered onto the screen all on the same line, and they start breaking up like that.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#16418 - DiscoStew - Sun Feb 15, 2004 9:25 pm</h4>
    <div class="postbody"><span class="postbody">thx for your help. Each of your answers are very logical in this case, but there is still something that the stripping is doing which makes it odd. I've tried my program, and I have started out with a bunch of sprites at the top of the screen, transformable or not, and a few below those. I add a sprite group to the groups below, and the problem occurs, yet with all those sprites at the top, all averaging around the same scanlines, aren't having this stripping problem. Heck, even the following sprite groups I add, no matter where they are placed, may or may not have this problem, but usually do, transformable or not. Could this problem also be related to how the sprites are ordered in OAM, that perhaps sprites that are further down the sprite order chain are having a harder time being drawn in that those higher up in the chain?
<br/>
<br/>
Since my program only adds sprites into the order chain if they are visible in relation to my camera function, perhaps I should re-include my camera-moving function, move the camera to make some sprites off-screen, and see if the problem persists. I usually have about 90 sprites on-screen before stripping occurs (though I don't expect to have that many sprites on-screen in any of my real projects).
<br/>
<br/>
I'll see what I can do, and perhaps this extra explanation of this problem will help you all figure out another solution. Again, thx for your help<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#16429 - Miked0801 - Mon Feb 16, 2004 1:57 am</h4>
    <div class="postbody"><span class="postbody">A little more info - Sprites that use the Affine params in normal mode will take as much time to render as 2 un-affined sprites.  Double mode will make them render at about x4.  Also, do you have HBlank/DMA routines running lower on the screen?  If so, I believe (am not sure), that this will also steal time away from sprite rendering causing sprite dropout.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#16432 - torne - Mon Feb 16, 2004 4:08 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Miked0801 wrote:</b></span></td> </tr> <tr> <td class="quote">A little more info - Sprites that use the Affine params in normal mode will take as much time to render as 2 un-affined sprites.  Double mode will make them render at about x4.  Also, do you have HBlank/DMA routines running lower on the screen?  If so, I believe (am not sure), that this will also steal time away from sprite rendering causing sprite dropout.</td> </tr></table><span class="postbody">
<br/>
<br/>
Sprites with affine use 26/8 times as much time as normal sprites; more than triple. Double size makes no difference, except that you might have twice as many pixels to draw (doubling the time again); but it depends exactly how many pixels intersect the line you are drawing (I think). Turning on HBlank Free gives you only 954/1210 of the time to draw. gbatek has all these timing parameters documented in the sprite overview section.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
