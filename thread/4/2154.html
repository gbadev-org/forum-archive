<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>HOW TO? : Assembly DMA functions - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Coding > HOW TO? : Assembly DMA functions</h2>
<div id="posts">
<div class="post">
    <h4>#11178 - Snoobab - Sun Sep 28, 2003 8:54 am</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
I want to write my GBA lib's DMA functions in ASM (in an external *.s 
<br/>
file). But seeing as I've not done much RISC ASM coding before it is quite difficult. How would I go about doing this? And will the hand-written ASM DMA functions perform better than plain old inline DMA functions?
<br/>
<br/>
Thanks a lot,
<br/>
<br/>
- Ed.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11182 - poslundc - Sun Sep 28, 2003 3:07 pm</h4>
    <div class="postbody"><span class="postbody">A good start would be running gcc -S on your C file to see what assembly code the compiler would generate, then seeing what you can optimize out of that.
<br/>
<br/>
I remember seeing a website at one point explaining how to improve DMA setup time through assembler... IIRC it involved taking advantage of the fact that the DMA registers are next to each other in memory, so you can possibly do it with fewer memory transfer instructions. Someone else may be able to provide you with the actual link to the website in question.
<br/>
<br/>
Good luck,
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11187 - Snoobab - Sun Sep 28, 2003 4:41 pm</h4>
    <div class="postbody"><span class="postbody">I'll give it a try, thanks.
<br/>
<br/>
- Ed.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11276 - torne - Wed Oct 01, 2003 12:25 am</h4>
    <div class="postbody"><span class="postbody">I don't know the site you are talking about, but here's how you do it:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   ldr    r0, =REG_DMAxSAD (source address register for whichever dma you want)
<br/>
   ldr   r1, =source_address
<br/>
   ldr   r2, =dest_address
<br/>
   ldr   r3, =( top 2 bytes are the flags, bottom 2 bytes are the count)
<br/>
   stmia   r0!, {r1-r3}</td> </tr></table><span class="postbody">
<br/>
<br/>
My version is tweaked a bit more than that still as I use macros that synthesise numbers using shifts and adds where faster, instead of using ldr; the macros are around on the ASM forum somewhere.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11325 - Snoobab - Thu Oct 02, 2003 6:31 pm</h4>
    <div class="postbody"><span class="postbody">Nice, thanks torne.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
