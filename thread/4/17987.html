<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Sprite rotation errors - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > Sprite rotation errors</h2>
<div id="posts">
<div class="post">
    <h4>#178142 - aidan_aidan - Sun Dec 15, 2013 6:21 pm</h4>
    <div class="postbody"><span class="postbody">I am using a sine and cosine lookup table 2048 in length (angles are between 0 and 2048) with values between -256 and 256. The problem is that the sprite is pausing briefly before and after every 90 degrees (the angle is being increased at 60 divisions per second (every vBlank)). I have an affine background that is rotating just fine without this pausing using the same lut so I have no idea what is going on. Thank for any help.
<br/>
<br/>
video illustrating the problem
<br/>
<a href="http://youtu.be/8gweFiSobwc" target="_blank">http://youtu.be/8gweFiSobwc</a>
<br/>
<br/>
<br/>
The function with the code (nothing in the main other than this function being called):
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void railGame(void)
<br/>
{
<br/>
   u32 vBlankBool_A = 0,
<br/>
      vBlankBool_B = 0,
<br/>
      earthAngle = 0,
<br/>
      gunAngle = 512;
<br/>
      
<br/>
   s32 earthPA = 0,
<br/>
      earthPB = 0,
<br/>
      earthPC = 0,
<br/>
      earthPD = 0;
<br/>
      //512 +/- 171
<br/>
   point earthRotationTex = {256, 256},
<br/>
        earthRotationScr = {120, 256};
<br/>
        
<br/>
   affSprite gun = {&amp;OAMLOC[0], &amp;OAMLOC[1], &amp;OAMLOC[2], &amp;OAMLOC[3], &amp;OAMLOC[7], &amp;OAMLOC[11], &amp;OAMLOC[15]};
<br/>
   *gun.attribute0      = GUNATTRIBUTE0;
<br/>
   *gun.attribute1      = GUNATTRIBUTE1;
<br/>
   *gun.attribute2     = GUNATTRIBUTE2;
<br/>
   *gun.pa = *gun.pd    = 256;
<br/>
   *gun.pb = *gun.pc   = 0;
<br/>
      
<br/>
   DISPCNT = (MODE1 | BG0_ENABLE | BG1_ENABLE | BG2_ENABLE | OBJ_ENABLE | OBJ1D);
<br/>
   BG0CNT  = (CBB2 | SBB31 | BG_REG_32X32 | BGCOLOR16);
<br/>
   BG1CNT  = (CBB1 | SBB29 | BG_REG_64X32 | BGCOLOR16);
<br/>
   BG2CNT  = (CBB0 | SBB27 | BG_AFF_64X64 | BGCOLOR256);
<br/>
   
<br/>
   loadBGpalette(&amp;railGameBGpalette[0]);
<br/>
   loadOBJpalette(&amp;railGameOBJpalette[0]);
<br/>
   loadBGtiles(&amp;earthTiles[0], EARTHTILESLENGTH, CBB0_U32_LOC);
<br/>
   loadOBJtiles(&amp;blank4bppTile[0], TILELENGTH4BPP);
<br/>
   loadOBJtiles(&amp;gunTiles[0], GUNTILESLENGTH);
<br/>
   loadBGmap(&amp;earthMap[0], AFF64X64U32_LENGTH, SBB27_U32_LOC, PALETTE0);
<br/>
   
<br/>
   BG2PA = BG2PD = 255;
<br/>
   BG2PB = BG2PC = 0;
<br/>
   
<br/>
   BG2X = 0;
<br/>
   BG2Y = 0;
<br/>
      
<br/>
   while(1)
<br/>
   {
<br/>
      vBlankBool_A = (DISPSTAT &amp; VBLANKFLAG);
<br/>
      
<br/>
      if(vBlankBool_A &amp; ~vBlankBool_B)
<br/>
      {
<br/>
         keyPoll();
<br/>
         
<br/>
         earthAngle++;
<br/>
         if(earthAngle &gt; CIRCLE_DIVISION - 1)
<br/>
         {
<br/>
            earthAngle = 0;
<br/>
         }
<br/>
         
<br/>
         if(keyDown(BUTTON_L))
<br/>
         {
<br/>
            gunAngle += 3;
<br/>
         }
<br/>
         if(keyDown(BUTTON_R))
<br/>
         {
<br/>
            gunAngle -= 3;
<br/>
         }
<br/>
         if(gunAngle &gt; 716)
<br/>
         {
<br/>
            gunAngle = 716;
<br/>
         }
<br/>
         if(gunAngle &lt; 308)
<br/>
         {
<br/>
            gunAngle = 308;
<br/>
         }
<br/>
         
<br/>
         *gun.pa = *gun.pd = sine[gunAngle];
<br/>
         *gun.pb = cosine[gunAngle];
<br/>
         *gun.pc = -cosine[gunAngle];
<br/>
         
<br/>
         *gun.attribute0 = GUNATTRIBUTE0 | (((-sine[gunAngle] * 142) &gt;&gt; 8) + 240);
<br/>
         *gun.attribute1 = GUNATTRIBUTE1 | (((cosine[gunAngle] * 142) &gt;&gt; 8) + 104);
<br/>
         
<br/>
         earthPA = earthPD = cosine[earthAngle];
<br/>
         earthPB = -sine[earthAngle];
<br/>
         earthPC = sine[earthAngle];
<br/>
         
<br/>
         BG2X = (earthRotationTex.x &lt;&lt; 8) - (earthPA * earthRotationScr.x + earthPB * earthRotationScr.y);
<br/>
         BG2Y = (earthRotationTex.y &lt;&lt; 8) - (earthPC * earthRotationScr.x + earthPD * earthRotationScr.y);
<br/>
         
<br/>
         BG2PA = earthPA;
<br/>
         BG2PB = earthPB;
<br/>
         BG2PC = earthPC;
<br/>
         BG2PD = earthPD;
<br/>
      }
<br/>
      
<br/>
      vBlankBool_B = vBlankBool_A;
<br/>
   }
<br/>
}
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/>French re f draft free e w shredder for c rt</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
