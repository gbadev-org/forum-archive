<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Writing PogoShell plugin with Devkit Advance - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Coding > Writing PogoShell plugin with Devkit Advance</h2>
<div id="posts">
<div class="post">
    <h4>#5462 - Quirky - Mon Apr 28, 2003 8:51 pm</h4>
    <div class="postbody"><span class="postbody">I've written a plugin for PogoShell (nothing useful, pcx image files) but I'm having problems getting it to actually work. The actual pcx "decoding" works, I've tested it with .all.rodata.o pcx files, then appended data files (copy /b pcx.bin+pic.pcx pcx.gba) then the final step, as a plugin. Which is where it goes wrong.
<br/>
<br/>
According to the docs, when you select a file in pogoshell, a "magic  value" is stored at 0x0203FC00, i.e. near the end of EWRAM. However, this value is always 0. The code I have is:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">unsigned int *p = (unsigned int *)0x0203FC00;
<br/>
   if(p[0] == 0xFAB0BABE) {
<br/>
   
<br/>
      load_pcx((u8 *)p[-1]);
<br/>
  } else {... debug stuff to find out why it went wrong</td> </tr></table><span class="postbody">
<br/>
<br/>
I have my theory as to why it fails - I think that Devkit adds code at the start of the rom that sets EWRAM to 0. Can anyone confirm this and suggest a work around? Oh and should the plugin be written as a multiboot image or doesn't that matter?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#5469 - tepples - Mon Apr 28, 2003 11:17 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quirky wrote:</b></span></td> </tr> <tr> <td class="quote">According to the docs, when you select a file in pogoshell, a "magic  value" is stored at 0x0203FC00, i.e. near the end of EWRAM. However, this value is always 0. [...]I have my theory as to why it fails - I think that Devkit adds code at the start of the rom that sets EWRAM to 0.</td> </tr></table><span class="postbody">
<br/>
It might.  If it does, you can work around it by getting Devkit Advance R5 when it comes out.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#5473 - Quirky - Tue Apr 29, 2003 9:37 am</h4>
    <div class="postbody"><span class="postbody">Well, I've found the problem. I need to edit crt0.s, as I kind of suspected it clears EWRAM on start up. I should have looked here first really.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
DoEWRAMClear:
<br/>
@ Clear External WRAM to 0x00
<br/>
<br/>
        mov     r1,#0x40
<br/>
        lsl     r1,#12          @ r1 = 0x40000
<br/>
        lsl     r0,r1,#7        @ r0 = 0x2000000
<br/>
        bl      ClearMem
<br/>
        
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Changing the first line to mov r1,#0x3f will do the trick as that will not clear the ERAM that PogoShell sets.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#5478 - niltsair - Tue Apr 29, 2003 2:07 pm</h4>
    <div class="postbody"><span class="postbody">That's usefull to know. I wanted to eventually developp a plugging myself.
<br/>
<br/>
Thanks for the feedback.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#5512 - gb_feedback - Wed Apr 30, 2003 12:41 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Well, I've found the problem. I need to edit crt0.s, as I kind of suspected it clears EWRAM on start up. </td> </tr></table><span class="postbody">
<br/>
I guess you fixed it before I replied to your email! One other thought - It is good practice to set the fabobabe value to 0 after you've recognised it, so that other plug-ins don't think the reference is for them. I'm not sure of the exact circumstances where this might matter but I seem to remember the Pogoshell author recommending it.<br/>_________________<br/><a class="postlink" href="http://www.bookreader.co.uk/" target="_blank">http://www.bookreader.co.uk/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#5515 - Quirky - Wed Apr 30, 2003 1:30 pm</h4>
    <div class="postbody"><span class="postbody">I hit "send" then about 5 minutes later I had that brainwave. Typical! Anyway, cheers for reading at least :)
<br/>
<br/>
Have I understood correctly that, regardless of the actual size of the plugin, they use up a multiple of 32kb of space?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#5517 - gb_feedback - Wed Apr 30, 2003 1:43 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Have I understood correctly that, regardless of the actual size of the plugin, they use up a multiple of 32kb of space?</td> </tr></table><span class="postbody">
<br/>
That's basically it. I think the usual cart is designed to map any whole number of 32kb blocks to a block which starts at 0x08000000 (for obvious reasons).<br/>_________________<br/><a class="postlink" href="http://www.bookreader.co.uk/" target="_blank">http://www.bookreader.co.uk/</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
