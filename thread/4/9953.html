<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Execution from VRAM - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > Execution from VRAM</h2>
<div id="posts">
<div class="post">
    <h4>#88184 - xproductions - Sat Jun 17, 2006 11:34 pm</h4>
    <div class="postbody"><span class="postbody">I'm thinking of a technique that might be useful for demo coders: copying code into VRAM and executing it there. Martin's docs say that:
<br/>
<a class="postlink" href="http://nocash.emubase.de/gbatek.htm#memorymap" target="_blank">http://nocash.emubase.de/gbatek.htm#memorymap</a>
<br/>
the only faster memory locations than VRAM are Internal Work RAM and OAM.
<br/>
Is this feasible/practical?<br/>_________________<br/>If you would not be forgotten
<br/>
as soon as you are dead and rotten,
<br/>
either write things worth reading
<br/>
or do things worth writing.
<br/>
<br/>
-- Benjamin Franklin</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#88201 - keldon - Sun Jun 18, 2006 1:08 am</h4>
    <div class="postbody"><span class="postbody">Considering you will be needing a portion of VRAM for your display, and it taking an extra cycle to access VRAM when the GBA is accessing VRAM you would probably prefer your fast code to be in WRAM. If you look at the <a class="postlink" href="http://nocash.emubase.de/gbatek.htm#lcddimensionsandtimings" target="_blank">lcd timings</a> you will notice that vram is being accessed 54% of the time.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#88207 - Dwedit - Sun Jun 18, 2006 2:24 am</h4>
    <div class="postbody"><span class="postbody">Executing code from vram is most useful if you have a very large multiboot program, and need more space for code.  Use decompression to load code which is bigger than 256k.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#88221 - tepples - Sun Jun 18, 2006 5:09 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>keldon wrote:</b></span></td> </tr> <tr> <td class="quote">taking an extra cycle to access VRAM when the GBA is accessing VRAM [...] you will notice that vram is being accessed 54% of the time.</td> </tr></table><span class="postbody">
<br/>
Dwedit is right. 0.5/0.5 waits for Thumb code in VRAM is much better than 2/2 for EWRAM or 3/1 for ROM, especially if not all your code will fit into IWRAM. I'm certain that acNES (Nintendo's own NES emulator on GBA) uses this technique, and given Dwedit's familiarity with the technique, recent PocketNES probably does too.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#88249 - keldon - Sun Jun 18, 2006 9:54 am</h4>
    <div class="postbody"><span class="postbody">Not that I'm disagreeing, but doesn't gbatek say:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Work RAM 32K  -- 32  ---  8/16/32 ---  8/16/32  --- 1/1/1</td> </tr></table><span class="postbody">
<br/>
<br/>
Am I missing something with this?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#88301 - xproductions - Sun Jun 18, 2006 5:39 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Am I missing something with this?</td> </tr></table><span class="postbody">
<br/>
<br/>
There's more VRAM than IWRAM. This might be more useful on the DS (assuming timing is the same), since there is much more VRAM there.<br/>_________________<br/>If you would not be forgotten
<br/>
as soon as you are dead and rotten,
<br/>
either write things worth reading
<br/>
or do things worth writing.
<br/>
<br/>
-- Benjamin Franklin</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#88310 - tepples - Sun Jun 18, 2006 6:50 pm</h4>
    <div class="postbody"><span class="postbody">But then the DS has extensive caching on its EWRAM.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#88314 - DekuTree64 - Sun Jun 18, 2006 7:08 pm</h4>
    <div class="postbody"><span class="postbody">DS can cache VRAM too, not just EWRAM. The ARM9 has no knowledge of the different memory areas, it's just that the libnds crt0 only turns caching on for that range.
<br/>
<br/>
According to the speed tests I did a long time ago on GBA, sprite and BG VRAM are accessed seperately from eachother. So if you're doing a demo effect that doesn't use any sprites, there won't be any access stalls from putting code in sprite VRAM.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#88315 - tepples - Sun Jun 18, 2006 7:13 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>DekuTree64 wrote:</b></span></td> </tr> <tr> <td class="quote">DS can cache VRAM too, not just EWRAM. The ARM9 has no knowledge of the different memory areas</td> </tr></table><span class="postbody">
<br/>
Then why do people keep saying that GBA ROM space is impossible to cache on the DS?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#88318 - DekuTree64 - Sun Jun 18, 2006 7:20 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>DekuTree64 wrote:</b></span></td> </tr> <tr> <td class="quote">DS can cache VRAM too, not just EWRAM. The ARM9 has no knowledge of the different memory areas</td> </tr></table><span class="postbody">
<br/>
Then why do people keep saying that GBA ROM space is impossible to cache on the DS?</span></td> </tr></table><span class="postbody">
<br/>
Huh, I haven't heard anything about that. I'll give it a try tonight and see if it's true.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#88337 - keldon - Sun Jun 18, 2006 9:42 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>xproductions wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Am I missing something with this?</td> </tr></table><span class="postbody">
<br/>
<br/>
There's more VRAM than IWRAM. This might be more useful on the DS (assuming timing is the same), since there is much more VRAM there.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Okay I knew that; I just thought it was for some other reason that I was completely unaware of. (Thinks to self) need to get back into coding.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#88448 - wintermute - Mon Jun 19, 2006 4:26 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>DekuTree64 wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>DekuTree64 wrote:</b></span></td> </tr> <tr> <td class="quote">DS can cache VRAM too, not just EWRAM. The ARM9 has no knowledge of the different memory areas</td> </tr></table><span class="postbody">
<br/>
Then why do people keep saying that GBA ROM space is impossible to cache on the DS?</span></td> </tr></table><span class="postbody">
<br/>
Huh, I haven't heard anything about that. I'll give it a try tonight and see if it's true.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
DS can cache anywhere it's just a matter of marking the memory as cacheable.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#88534 - chishm - Tue Jun 20, 2006 1:15 am</h4>
    <div class="postbody"><span class="postbody">You don't want to have the standard ARM9 crt0 mark the GBA cart as cachable, since that would interfere with the many flash memory interfaces being used by homebrew.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116134 - HyperHacker - Mon Jan 22, 2007 7:31 am</h4>
    <div class="postbody"><span class="postbody">Mind the bump but could GBA ROM area caching not be useful for virtualization? EG you could throw some small code into cache and reboot into GBA mode to execute it, without there being a GBA cart at all. Or if you wanted to try running GBA games in DS mode, you could "edit" the ROM by just exploiting the cache, so that a given chunk of ROM is read from cache instead of the actual data on the cartridge.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116185 - Firon - Tue Jan 23, 2007 12:58 am</h4>
    <div class="postbody"><span class="postbody">All memory is cleared when rebooting into GBA mode, iirc.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116202 - chishm - Tue Jan 23, 2007 3:17 am</h4>
    <div class="postbody"><span class="postbody">The ARM9 has the cache, not the overall system. Since GBA mode is exclusive to the ARM7, there's no cache involved.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116205 - Miked0801 - Tue Jan 23, 2007 4:26 am</h4>
    <div class="postbody"><span class="postbody">GBA does have a cache, but it's very limited...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116219 - tepples - Tue Jan 23, 2007 7:29 am</h4>
    <div class="postbody"><span class="postbody">If you're referring to the ROM instruction prefetch, the execution of the BIOS probably clears it anyway.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116221 - chishm - Tue Jan 23, 2007 10:23 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Miked0801 wrote:</b></span></td> </tr> <tr> <td class="quote">GBA does have a cache, but it's very limited...</td> </tr></table><span class="postbody">
<br/>
I knew someone would mention that, but a 3 instruction pipeline isn't really a cache.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116224 - keldon - Tue Jan 23, 2007 10:48 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Miked0801 wrote:</b></span></td> </tr> <tr> <td class="quote">GBA does have a cache, but it's very limited...</td> </tr></table><span class="postbody">
<br/>
I knew someone would mention that, but a 3 instruction pipeline isn't really a cache.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Thank you! Well it is 'technically' cache, but cache needs to be redefined. The expected norm of cache [now] is for a set of memory to be copied. A prefetch buffer does not fit into the expected norm of what cache means, so it becomes a communication issue when the word cache is used against its expected meaning.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#116232 - gmiller - Tue Jan 23, 2007 3:41 pm</h4>
    <div class="postbody"><span class="postbody">A pipeline is not cache ... cache has the ability to pull data from it (in cache blocks/lines) where as a pipeline you can only deal with the data when it comes out the end.  You can implement pipelines in software where you can access data within the pipeline but the data is not complete till it hits the end of the "pipe".  With a pipeline in a CPU the instruction is not ready to execute till the last step in the pipeline (some pipelines have other stages after the execution stage but I am simplifying here).  So for the ARM 7 in this case you have to do three steps when the pipeline is empty to execute 1 instruction.  Every executed branch (or direct modification of the 'pc') in your code flushes the pipeline (which means the pipeline has to be filled again) so there will be a performance hit.
<br/>
<br/>
Cache does not need to be full to operate, it has random access capabilities (direct, full associative, set associative) and it has a replacement algorithm.  This is not how a pipeline operates.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119956 - werty - Tue Feb 27, 2007 10:13 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>keldon wrote:</b></span></td> </tr> <tr> <td class="quote">Considering you will be needing a portion of VRAM for your display, and it taking an extra cycle to access VRAM when the GBA is accessing VRAM you would probably prefer your fast code to be in WRAM. If you look at the <a class="postlink" href="http://nocash.emubase.de/gbatek.htm#lcddimensionsandtimings" target="_blank">lcd timings</a> you will notice that vram is being accessed 54% of the time.</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
 Some apps will need LCD 1% ( All LCD's store pixels , CRT's
<br/>
  dont store ) . 
<br/>
<br/>
 If you are in a bind ,   simply reprogram .   
<br/>
  Oh ! I see you use C , sorry , C cant reprogram !</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119958 - werty - Tue Feb 27, 2007 10:20 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>keldon wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Miked0801 wrote:</b></span></td> </tr> <tr> <td class="quote">GBA does have a cache, but it's very limited...</td> </tr></table><span class="postbody">
<br/>
I knew someone would mention that, but a 3 instruction pipeline isn't really a cache.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Thank you! Well it is 'technically' cache, but cache needs to be redefined. The expected norm of cache [now] is for a set of memory to be copied. A prefetch buffer does not fit into the expected norm of what cache means, so it becomes a communication issue when the word cache is used against its expected meaning.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
  Cache is Cache ,unless its in Windows , then its malware.
<br/>
 I disable Windows Vcache .
<br/>
<br/>
 Cache must be faster .
<br/>
<br/>
    Pipeline is to prevent stalls ONLY , the bottleneck
<br/>
 is still in the ALU . ARM cpus execute one instruction
<br/>
 at a time .  Branch is 3 clocks .   ??  Thats what my ARM
<br/>
 paper reads !   So wheres the advantage of the "pipe" ?!!
<br/>
    New ARM is faster ...
<br/>
<br/>
    A new way to program will obsolete C/C++ and
<br/>
  allow ppl to create faster and thus Linux will be history .
<br/>
<br/>
  Symbolic programming , uses NO text ,no modern language .
<br/>
<br/>
   Go figure ......</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119962 - werty - Tue Feb 27, 2007 10:57 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">Mind the bump but could GBA ROM area caching not be useful for virtualization? EG you could throw some small code into cache and reboot into GBA mode to execute it, without there being a GBA cart at all. Or if you wanted to try running GBA games in DS mode, you could "edit" the ROM by just exploiting the cache, so that a given chunk of ROM is read from cache instead of the actual data on the cartridge.</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
 Virtualization is an unneeded translation , something
<br/>
  no kernel needs to do .
<br/>
 It slows the kernel , and makes a job
<br/>
  for hungry programmers .
<br/>
    ALL Virtualization , not just some cases !
<br/>
<br/>
   It was something Intel did after M$ wasted too much
<br/>
  RAM for its Vcache !!  ha ha ha 
<br/>
<br/>
<br/>
  I will create a symbolic , non-text, non-English
<br/>
  kernel , using the DS BIOS .</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#119991 - Miked0801 - Wed Feb 28, 2007 3:10 am</h4>
    <div class="postbody"><span class="postbody">zzzzzzz</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
