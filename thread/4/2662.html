<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Expert help needed. I want to do 3d tile scrolling.... - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > Expert help needed. I want to do 3d tile scrolling....</h2>
<div id="posts">
<div class="post">
    <h4>#14875 - LOst? - Wed Jan 14, 2004 3:47 am</h4>
    <div class="postbody"><span class="postbody">You know some game uses a cool effect when being in tile mode. Most of you have played Street Fighter II, and on the Las Vegas stage, the floor is scrolling like if it was in 3d. Many game seem to have this effect on GBA, and I wonder how I can make parts, and I mean parts of the background do that effect?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14876 - tepples - Wed Jan 14, 2004 5:11 am</h4>
    <div class="postbody"><span class="postbody"><span style="font-style: italic">Street Fighter II</span> and <span style="font-style: italic">NBA Jam</span> use the same raster trick that lots of pseudo-3D games since <span style="font-style: italic">Pole Position</span> have used: changing the horizontal scroll value during HBlank. Some older systems required cycle-timed code to do this, but the GBA hardware makes it really easy: just make an array of horizontal scroll values and use DMA channel 0 to copy them to the BG0HOFS register.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14878 - LOst? - Wed Jan 14, 2004 6:17 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><span style="font-style: italic">Street Fighter II</span> and <span style="font-style: italic">NBA Jam</span> use the same raster trick that lots of pseudo-3D games since <span style="font-style: italic">Pole Position</span> have used: changing the horizontal scroll value during HBlank. Some older systems required cycle-timed code to do this, but the GBA hardware makes it really easy: just make an array of horizontal scroll values and use DMA channel 0 to copy them to the BG0HOFS register.</td> </tr></table><span class="postbody">
<br/>
<br/>
Wow! I didn't know that. This is great. I must try this out. But how do I know the Hblank? Do you people have any hint. I want it to be as simple as possible</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14882 - yaustar - Wed Jan 14, 2004 9:30 am</h4>
    <div class="postbody"><span class="postbody">You have heard uncer another name called 'Mode 7'on the Sness/gba. It however wasnt a mode such as mode 0 ,1 2 etc but more of the used that tepples has said above.<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14887 - LOst? - Wed Jan 14, 2004 10:55 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yaustar wrote:</b></span></td> </tr> <tr> <td class="quote">You have heard uncer another name called 'Mode 7'on the Sness/gba. It however wasnt a mode such as mode 0 ,1 2 etc but more of the used that tepples has said above.</td> </tr></table><span class="postbody">
<br/>
<br/>
Mode 7. Isn't that what Mario Cart uses? I don't want to leave Mode 0, because of all the backgrounds. The only thing I want is to make one of the backgrounds do some cool paralax(sp?) scrolling like those you can see in the floor scrolling in Street Fighter II.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14888 - yaustar - Wed Jan 14, 2004 12:30 pm</h4>
    <div class="postbody"><span class="postbody">Mode 7 IS NOT a mode. I my have misprhased it in my initail post. It is a name for the technique in games like the mario kart. I am guessing (i havent seen it) in a lesser extent in SFII
<br/>
<br/>
I am not 100% on how it works but I think it works by taking the horizontal pixel lines of the screen and scaling it.
<br/>
<br/>
If we take fzero for example, the top line has been scaled right down, the next line has been scaled slighlty lessand so on. Thereby giving a similar effect as perspective.<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14889 - LOst? - Wed Jan 14, 2004 1:05 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yaustar wrote:</b></span></td> </tr> <tr> <td class="quote">Mode 7 IS NOT a mode. I my have misprhased it in my initail post. It is a name for the technique in games like the mario kart. I am guessing (i havent seen it) in a lesser extent in SFII
<br/>
<br/>
I am not 100% on how it works but I think it works by taking the horizontal pixel lines of the screen and scaling it.
<br/>
<br/>
If we take fzero for example, the top line has been scaled right down, the next line has been scaled slighlty lessand so on. Thereby giving a similar effect as perspective.</td> </tr></table><span class="postbody">
<br/>
<br/>
I have seen VisualBoy Advance telling that it is in mode 7. Maybe it was a bug?
<br/>
<br/>
And SFII had a already drawn perspective, so that it only needs to scroll each line in different speeds</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14890 - yaustar - Wed Jan 14, 2004 1:13 pm</h4>
    <div class="postbody"><span class="postbody">Not sure about the VBA, I dont remember being taught a 'mode 7'. In SFII, it sounds like parrallex scrolling.
<br/>
<br/>
I take a read up on the 'Mode 7' as I am interested too...<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14891 - yaustar - Wed Jan 14, 2004 1:31 pm</h4>
    <div class="postbody"><span class="postbody">Just looked at some source, the math is still a tiny bit out of my league (until I understand it ;)  ) It still says mode 1 in the map viewer...what game did you try?<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14893 - LOst? - Wed Jan 14, 2004 1:42 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yaustar wrote:</b></span></td> </tr> <tr> <td class="quote">Just looked at some source, the math is still a tiny bit out of my league (until I understand it ;)  ) It still says mode 1 in the map viewer...what game did you try?</td> </tr></table><span class="postbody">
<br/>
<br/>
I fucked up my own game. I wrote incorrectly to the SetMode macro.
<br/>
<br/>
Do you need interrupts and "bios enable" to program mode 7?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14894 - yaustar - Wed Jan 14, 2004 2:39 pm</h4>
    <div class="postbody"><span class="postbody">I only know the thoery behind mode 7. I am afraid I ahve no practical use of it. THere is some source from teh main site and on Dovoto's pern project as well. You should find your anwsers there.
<br/>
<br/>
sorry<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14899 - poslundc - Wed Jan 14, 2004 4:34 pm</h4>
    <div class="postbody"><span class="postbody">OK, here we go.
<br/>
<br/>
Mode 7 is a <span style="font-style: italic">technique</span>, not a mode, to add perspective to a rotation background and give it a pseudo-3D look. Because it requires a rotation background, you must be either in Mode 1 or Mode 2 to make use of it.
<br/>
<br/>
The basic strategy is that during VBlank (or during the frame if you are double-buffered) a list of settings for each parameter (PA, PB, PC, PD, X and Y) is generated, with different values calculated for each of the 160 scanlines.
<br/>
<br/>
Then as the screen is being displayed, either using HBlank interrupts or HDMA, the settings for the background are changed for every scanline.
<br/>
<br/>
There are a bunch of tutorials and demos on the subject floating around, so have a look for them. No one has documented it in a <span style="font-style: italic">really</span> straightforward and spoonfeeding way (ie. not like the Pern tutorials or anything), so it's not for the faint of heart.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14902 - LOst? - Wed Jan 14, 2004 4:48 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">either using HBlank interrupts or HDMA, the settings for the background are changed for every scanline.</td> </tr></table><span class="postbody">
<br/>
<br/>
So, now when I don't want to do mode 7, just do some scanline scrolling effects, how do I use HDMA, or HBlank in a good way?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14903 - poslundc - Wed Jan 14, 2004 5:03 pm</h4>
    <div class="postbody"><span class="postbody">Uh, you use it in exactly the same way I described. You just change the HOFS and VOFS registers if you want to do simple scrolling effects.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14918 - tepples - Wed Jan 14, 2004 8:15 pm</h4>
    <div class="postbody"><span class="postbody"><span style="font-style: italic">Street Fighter II</span> does not use Mode 7 in-game. There's a difference between <span style="font-style: italic">Pole Position</span> scrolling and Mode 7. Go rent a <span style="font-style: italic">Namco Museum</span> title containing <span style="font-style: italic">Pole Position</span> and closely observe its in-game road graphics, which consist of a largely static screen that warps horizontally and palette-animates to show the advancing road. Then compare <span style="font-style: italic">F-Zero</span> or <span style="font-style: italic">Super Mario Kart</span>, which treats the floor as a giant texture. You'll find that <span style="font-style: italic">Street Fighter II</span>'s effect resembles <span style="font-style: italic">Pole Position</span>'s more than <span style="font-style: italic">Super Mario Kart</span>'s.
<br/>
<br/>
<span style="font-style: italic">Pole Position</span> scrolling, which can be done in any of the GBA's graphics modes, merely involves changing BG0HOFS (or BG2X) on Hblank. <span style="font-style: italic">Rad Racer</span> scrolling, which allows for hills, involves changing both BG0HOFS (or BG2X) and BG0VOFS (or BG2Y) on Hblank. Even the NES, with its one text background layer, could do <span style="font-style: italic">Pole Position</span> and <span style="font-style: italic">Rad Racer</span> scrolling.
<br/>
<br/>
"Mode 7" is so called because it was numbered 7 on the Super NES, but it's numbered 1 or 2 on the GBA, depending on how many text layers you want to replace with rot/scale layers. It involves rotation and scaling of each scanline (BG2PA, BG2PC, BG2X, BG2Y).
<br/>
<br/>
I think LOst? is looking for some sample code to do <span style="font-style: italic">Pole Position</span> scrolling on the GBA.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14940 - XeroxBoy - Thu Jan 15, 2004 12:51 am</h4>
    <div class="postbody"><span class="postbody"><a class="postlink" href="http://www.thepernproject.com/English/tutorial_5.html" target="_blank">This </a> tutorial tells you what you need to do.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14959 - LOst? - Thu Jan 15, 2004 9:05 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><span style="font-style: italic">Street Fighter II</span> does not use Mode 7 in-game. There's a difference between <span style="font-style: italic">Pole Position</span> scrolling and Mode 7. Go rent a <span style="font-style: italic">Namco Museum</span> title containing <span style="font-style: italic">Pole Position</span> and closely observe its in-game road graphics, which consist of a largely static screen that warps horizontally and palette-animates to show the advancing road. Then compare <span style="font-style: italic">F-Zero</span> or <span style="font-style: italic">Super Mario Kart</span>, which treats the floor as a giant texture. You'll find that <span style="font-style: italic">Street Fighter II</span>'s effect resembles <span style="font-style: italic">Pole Position</span>'s more than <span style="font-style: italic">Super Mario Kart</span>'s.
<br/>
<br/>
<span style="font-style: italic">Pole Position</span> scrolling, which can be done in any of the GBA's graphics modes, merely involves changing BG0HOFS (or BG2X) on Hblank. <span style="font-style: italic">Rad Racer</span> scrolling, which allows for hills, involves changing both BG0HOFS (or BG2X) and BG0VOFS (or BG2Y) on Hblank. Even the NES, with its one text background layer, could do <span style="font-style: italic">Pole Position</span> and <span style="font-style: italic">Rad Racer</span> scrolling.
<br/>
<br/>
"Mode 7" is so called because it was numbered 7 on the Super NES, but it's numbered 1 or 2 on the GBA, depending on how many text layers you want to replace with rot/scale layers. It involves rotation and scaling of each scanline (BG2PA, BG2PC, BG2X, BG2Y).
<br/>
<br/>
I think LOst? is looking for some sample code to do <span style="font-style: italic">Pole Position</span> scrolling on the GBA.</td> </tr></table><span class="postbody">
<br/>
<br/>
So you call it Pole Position. That's good to know (didn't see it in your first post) :)
<br/>
<br/>
When is the Hblank occuring? Before drawing or after? I know very little about the Hblank.
<br/>
<br/>
I just want to do this Pole Position (only in horizontal) effect on one background, as the same time as I, every frame, change both its BG0HOFS and BG0VOFS position. Can someone explain to me how I can do this, and how it works?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14969 - poslundc - Thu Jan 15, 2004 3:55 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>LOst? wrote:</b></span></td> </tr> <tr> <td class="quote">When is the Hblank occuring? Before drawing or after?</td> </tr></table><span class="postbody">
<br/>
<br/>
Uh... both really. There is an HBlank before every scanline is drawn. But there is also an HBlank after every scanline is drawn. It depends on how you want to look at it. :P
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I know very little about the Hblank.</td> </tr></table><span class="postbody">
<br/>
<br/>
<a class="postlink" href="http://www.cs.rit.edu/~tjh8300/CowBite/CowBiteSpec.htm" target="_blank">http://www.cs.rit.edu/~tjh8300/CowBite/CowBiteSpec.htm</a>
<br/>
<a class="postlink" href="http://www.work.de/nocash/gbatek.htm" target="_blank">http://www.work.de/nocash/gbatek.htm</a>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I just want to do this Pole Position (only in horizontal) effect on one background, as the same time as I, every frame, change both its BG0HOFS and BG0VOFS position. Can someone explain to me how I can do this, and how it works?</td> </tr></table><span class="postbody">
<br/>
<br/>
You might try adding your numbers. :D
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14970 - LOst? - Thu Jan 15, 2004 4:09 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>LOst? wrote:</b></span></td> </tr> <tr> <td class="quote">When is the Hblank occuring? Before drawing or after?</td> </tr></table><span class="postbody">
<br/>
<br/>
Uh... both really. There is an HBlank before every scanline is drawn. But there is also an HBlank after every scanline is drawn. It depends on how you want to look at it. :P
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I know very little about the Hblank.</td> </tr></table><span class="postbody">
<br/>
<br/>
<a class="postlink" href="http://www.cs.rit.edu/~tjh8300/CowBite/CowBiteSpec.htm" target="_blank">http://www.cs.rit.edu/~tjh8300/CowBite/CowBiteSpec.htm</a>
<br/>
<a class="postlink" href="http://www.work.de/nocash/gbatek.htm" target="_blank">http://www.work.de/nocash/gbatek.htm</a>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I just want to do this Pole Position (only in horizontal) effect on one background, as the same time as I, every frame, change both its BG0HOFS and BG0VOFS position. Can someone explain to me how I can do this, and how it works?</td> </tr></table><span class="postbody">
<br/>
<br/>
You might try adding your numbers. :D
<br/>
<br/>
Dan.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
It was a better reply than: RTFM
<br/>
<br/>
But still, I know how to add numbers, and scrolling is not the problem. It's that I just want the effect to be in one bg, and not the whole display. That must be possible right?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14973 - poslundc - Thu Jan 15, 2004 4:35 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>LOst? wrote:</b></span></td> </tr> <tr> <td class="quote">It's that I just want the effect to be in one bg, and not the whole display. That must be possible right?</td> </tr></table><span class="postbody">
<br/>
<br/>
You said that you were changing REG_BG0HOFS and REG_BG0VOFS. If you look in either of those specifications you'll see that these are the registers that control the position of background 0, not the entire display. This is also something you should have learned from the Pern or gbajunkie tutorials.
<br/>
<br/>
Sorry, I'm not trying to sound condescending, but are you sure you're ready for these kind of advanced effects? If I was dodgy in my former reply it's because it seems like you're asking how to run before being able to walk.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14974 - tepples - Thu Jan 15, 2004 4:46 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">There is an HBlank before every scanline is drawn. But there is also an HBlank after every scanline is drawn.</td> </tr></table><span class="postbody">
<br/>
From DMA's point of view, Hblank takes place <span style="font-style: italic">after</span> each scanline is drawn. You'll want to copy the first scanline's data in manually during Vblank and then set up the transfer starting at &amp;(scanline_xscrolls[1]). If you'll be combining it with vertical scrolling, you will want to start the transfer earlier or later in the array.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14977 - LOst? - Thu Jan 15, 2004 4:56 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">There is an HBlank before every scanline is drawn. But there is also an HBlank after every scanline is drawn.</td> </tr></table><span class="postbody">
<br/>
From DMA's point of view, Hblank takes place <span style="font-style: italic">after</span> each scanline is drawn. You'll want to copy the first scanline's data in manually during Vblank and then set up the transfer starting at &amp;(scanline_xscrolls[1]). If you'll be combining it with vertical scrolling, you will want to start the transfer earlier or later in the array.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Thanks for the info =)
<br/>
<br/>
And poslundc, I take your advice seriously. And I know how to walk, and now I will run. I've been walking since 1998, dreaming of doing a tile based game for a console not even created back then ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14981 - poslundc - Thu Jan 15, 2004 5:33 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>LOst? wrote:</b></span></td> </tr> <tr> <td class="quote">And poslundc, I take your advice seriously. And I know how to walk, and now I will run. I've been walking since 1998, dreaming of doing a tile based game for a console not even created back then ;)</td> </tr></table><span class="postbody">
<br/>
<br/>
By "walking" I meant knowing the basics, not dreaming of the exceptional.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14985 - LOst? - Thu Jan 15, 2004 7:15 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>LOst? wrote:</b></span></td> </tr> <tr> <td class="quote">And poslundc, I take your advice seriously. And I know how to walk, and now I will run. I've been walking since 1998, dreaming of doing a tile based game for a console not even created back then ;)</td> </tr></table><span class="postbody">
<br/>
<br/>
By "walking" I meant knowing the basics, not dreaming of the exceptional.
<br/>
<br/>
Dan.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
You don't need to know things you won't use. I haven't needed interrupts before... *deletes CRT0.S* ... but now I need interrupts. *Tries to restore the file, but fails*</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14988 - Miked0801 - Thu Jan 15, 2004 7:43 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
You don't need to know things you won't use. 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I love that.  I shouldn't have taken calculus and physics as I wouldn't have needed them - but wait, now that know those things, it's amazing what things I can accomplish with them. 
<br/>
<br/>
You can't know that you don't need something without some knowledge of it.  Interrupts are such an integral part of GBA programming that I can't see anyone doning anything long term without some knowledge.  Yes, I could probably do a tic-tac-toe game without knowledge of interrupts, but things get soooo much easier when I can have an interrupt occur to trigger my BG music (Timers), send information over the serial cable to the other player who's playing head-to-head against me (serial/timers), update the screen efficiently without causing visual glitching (vblank), or do some kick @ss screen effects (hblank.)  (Run on sentence alert!)
<br/>
<br/>
Sorry to stand on the soapbox about this issue, but I've had some similiar conversations with 1st year programmers who "know" everything (look up sophmore) and don't need any help with anything.  You are coming across this way and it worries me a bit.
<br/>
<br/>
Mike</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14998 - tepples - Thu Jan 15, 2004 11:13 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>LOst? wrote:</b></span></td> </tr> <tr> <td class="quote">You don't need to know things you won't use. I haven't needed interrupts before... *deletes CRT0.S* ... but now I need interrupts. *Tries to restore the file, but fails*</td> </tr></table><span class="postbody">
<br/>
I use GBA interrupts without any crt0 support. Read the CowBite spec to see how you too can write your own ISR in ARM code in IWRAM.
<br/>
<br/>
<span style="font-weight: bold">Correction</span>: IWRAM not EWRAM. The entry point to your ISR should be in ARM instructions (because that's what the GBA BIOS assumes) in some sort of RAM (so that you can handle removed-cart interrupts properly). IWRAM is faster than EWRAM, and though VRAM is dual-ported and faster than EWRAM, DevKit Advance provides no way to link code for copying to spare VRAM.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"><br/><br/>Last edited by tepples on Fri Jan 16, 2004 6:36 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#15031 - LOst? - Fri Jan 16, 2004 8:03 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>LOst? wrote:</b></span></td> </tr> <tr> <td class="quote">You don't need to know things you won't use. I haven't needed interrupts before... *deletes CRT0.S* ... but now I need interrupts. *Tries to restore the file, but fails*</td> </tr></table><span class="postbody">
<br/>
I use GBA interrupts without any crt0 support. Read the CowBite spec to see how you too can write your own ISR in ARM code in EWRAM.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
I will, thanks!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15059 - batblaster - Fri Jan 16, 2004 7:01 pm</h4>
    <div class="postbody"><span class="postbody">Dear Friends,
<br/>
<br/>
In advance i'm sorry for my bad enghlish. I've readed a lot all the question writed in this posts, i've used a lot hblank to make my intro and a new intro i'm coding, ( my 1st intro is available here on gbadev). The problem i've found is :
<br/>
<br/>
I've coded The SNES HDMA and is very very different of the GBA DMA i never found a way to use DMA0 or DMA3 like a real HDMA, if you use DMA to change a BG color on Each Scanline reading from an existing table did not work... Now i'm in vacation but i can post the code very soon... DMA function , in according with Nintendo official document, appear very different of the HDMA of SNES
<br/>
<br/>
"From The Pern Project Tutorial"
<br/>
<br/>
Bit 25: DMA repeat - this will cause the DMA to repeat every Hblank or Vblank if you have that specified in your timing bits.
<br/>
Bits 23-24: These control your how your source counter is affected by each transfer (by transfer I mean each word copied).
<br/>
<br/>
<br/>
00-increment-the source counter is incremented after each transfer
<br/>
01-decrement-the source counter is decremented after each transfer
<br/>
10-fixed-good for memory fills as the same data will get copied each frame
<br/>
11-invalid value
<br/>
<br/>
<br/>
Bits 21-22: These control your how your destination counter is affected by each transfer.
<br/>
<br/>
<br/>
00-increment-the destination counter is incremented after each transfer
<br/>
01-decrement
<br/>
10-fixed- direct sound FIFO access
<br/>
11-this value is different for the Destination control. When set it will increment. At the end of the transfer (this time I mean the entire DMA) it will be reset to its initial value. This is what we will be using for mode 7 effects. 
<br/>
<br/>
"End of Part"
<br/>
<br/>
<br/>
Ok my question is :
<br/>
<br/>
I've a table of color to make some raster effect posted in ram, i change and manage color each VBL , i want to reload the table each time automatically using DMA, if you try to do you can but you can't restart at the right time and you can't tell to destination (color 0 of the palette for BG effect) to do not increment or decrement...
<br/>
<br/>
I've maded a lot of modify and maded a lot of macro to manage DMA in the right mode but no good things...
<br/>
<br/>
Using Hblank interrupt is very simple and i doit see my intro to look but all code go in IWRAM if you want the code work on Real HW and maybe the tables too...
<br/>
<br/>
SNES use the HDMA in a simple mode, source table , destination (HW register) , lenght , channel number , start... That's all , very simple
<br/>
<br/>
If someone have a solution or real example to show me on how to use DMA not only for copy of move BGX i'm very HAPPY...
<br/>
<br/>
Batblaster...
<br/>
<br/>
TO LOst?:
<br/>
<br/>
Init an Interrupt handler to the HBLANK interrupt 
<br/>
<br/>
void hblank_intr(void)
<br/>
{
<br/>
       write here your code like :
<br/>
       U32 VCnt ( i do not remember the VCNT address sorry)
<br/>
       IF(VCnt&gt;40)
<br/>
          BG0SCROLLX--;
<br/>
}
<br/>
<br/>
Is only for example , from the line 40 your bg0 scroll one pixel on each scanline... Manage all in a table and you can make nice effect...
<br/>
<br/>
Sorry Again for my bad english and sorry for not right code but i'm in vacation 10.000 km distance of my house... 
<br/>
<br/>
Bye...<br/>_________________<br/>Batblaster / 7 Raven Studios Co. Ltd
<br/>
------------------------------------------</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15060 - DekuTree64 - Fri Jan 16, 2004 7:33 pm</h4>
    <div class="postbody"><span class="postbody">Hmm, DMA always worked fine for my mode7/scrolling effects. Just set it like
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">REG_DM0CNT_H = 0;      //disable first
<br/>
REG_DM0SAD = (u32)hofsTable; 
<br/>
REG_DM0DAD = (u32)(&amp;REG_BG0HOFS);
<br/>
REG_DM0CNT = 1 | BIT22 | BIT25 | BIT29 | BIT31;</td> </tr></table><span class="postbody">
<br/>
That would first disable DMA0 (if it's still enabled, you can't reset the source pos to the start of the table. This is probably where your troubles came from), then set the src/dest, set it to copy one 16-bit value at a time, dest fixed, inc src, repeat on HBL, and of course, enable. You have to do this every VBlank, or it will just continue copying from past the end of hofsTable, and therefore get unpredictable scroll values.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15063 - batblaster - Fri Jan 16, 2004 7:38 pm</h4>
    <div class="postbody"><span class="postbody">Hi DekuTree64
<br/>
<br/>
Try to make the same for the Palette 0 entries to change a color on heach scanline and check if work...
<br/>
<br/>
I've tried many many times with the DMA but nothing good all wrong colors... Using Hblank interrupt works hehehe simple...
<br/>
<br/>
If you do please write me the code heheh thanks...
<br/>
<br/>
[/list]<br/>_________________<br/>Batblaster / 7 Raven Studios Co. Ltd
<br/>
------------------------------------------</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15080 - DekuTree64 - Fri Jan 16, 2004 10:03 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include "gba.h"
<br/>
<br/>
int AgbMain()
<br/>
{
<br/>
   REG_DISPCNT = 0;
<br/>
   u16 cTab[160];
<br/>
   s32 i, frame = 0;
<br/>
   while(1)
<br/>
   {
<br/>
      for(i = 0; i &lt; 160; i++)
<br/>
         cTab[i] = RGB(((frame &gt;&gt; 1) - i + 16) &amp; 7, 
<br/>
            (i - frame + 8) &amp; 15, ((frame &gt;&gt; 2) + i) &amp; 31);   //plain ol' color equation
<br/>
      while(REG_VCOUNT == 160);
<br/>
      while(REG_VCOUNT != 160);   //just VSync
<br/>
      REG_DM0CNT_H = 0;
<br/>
      REG_DM0DAD = 0x5000000;
<br/>
      REG_DM0SAD = (u32)(cTab + 1);   //because the first HBlank happens at the END of the first line
<br/>
      REG_DM0CNT = 1 | BIT22 | BIT25 | BIT29 | BIT31;
<br/>
      ((u16*)0x5000000)[0] = cTab[0];   //set pal for first line
<br/>
      frame++;
<br/>
   }
<br/>
   return 0;
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
Try that out, it does a little scrolling color effect. Tested and working in VBA, so if it still won't work, I have no idea why. 
<br/>
Good luck^_^<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15186 - batblaster - Sun Jan 18, 2004 6:26 pm</h4>
    <div class="postbody"><span class="postbody">Hey DekuTree64,
<br/>
<br/>
Many many thanks now i understand why did not work mine hehehe great and good work... Is funny to found any time new good programmer and good guys... Thanks again a lot...<br/>_________________<br/>Batblaster / 7 Raven Studios Co. Ltd
<br/>
------------------------------------------</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15305 - LOst? - Tue Jan 20, 2004 7:13 pm</h4>
    <div class="postbody"><span class="postbody">Thankyou, Thankyou, Thankyou all!
<br/>
<br/>
I've got the pole position to work, with interrupts and all. And it's so fucking great! I cry everytime I see it in action.
<br/>
<br/>
Thanks!</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
