<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>2D Mapping - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Coding > 2D Mapping</h2>
<div id="posts">
<div class="post">
    <h4>#172457 - mog123 - Mon Feb 08, 2010 12:27 am</h4>
    <div class="postbody"><span class="postbody">Hey, I've tried 1d mapping - worked great but was a pain in the ass to edit. So now I'm trying to do 2d mapping. I've got a BMP file I converted in grit. 8bpp, 32x32 sprites, 256x448. When I try to display it with this code:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">// (1) Places the tiles 
<br/>
    //   into LOW obj memory (cbb == 4)
<br/>
    memcpy(&amp;tile_mem[4][0], Player256Tiles, 32*32);
<br/>
    memcpy(pal_obj_mem, Player256Pal, Player256PalLen);
<br/>
<br/>
<br/>
    // (2) Initialize all sprites
<br/>
    oam_init(obj_buffer, 128);
<br/>
    REG_DISPCNT= DCNT_MODE0 | DCNT_BG0 | DCNT_OBJ | DCNT_OBJ_2D;
<br/>
<br/>
<br/>
    int x= 104, y= 64;
<br/>
    u32 tid= 0, pb= 0;      // (3) tile id, pal-bank
<br/>
    OBJ_ATTR *nin11= &amp;obj_buffer[0];
<br/>
<br/>
    obj_set_attr(nin11, 
<br/>
        ATTR0_SQUARE | ATTR0_8BPP ,               // square sprite 8bpp
<br/>
        ATTR1_SIZE_32,                       // 32x32p 
<br/>
        ATTR2_PALBANK(pb) | tid);            // palbank 0, tile 0
<br/>
<br/>
    // (4) position sprite (redundant here; the _real_ position
<br/>
    // is set further down
<br/>
    obj_set_pos(nin11, x, y);
<br/>
oam_copy(oam_mem, obj_buffer, 1);</td> </tr></table><span class="postbody">
<br/>
<br/>
I only display a 8x32 (HxW) sprite. What am I doing wrong, or better yet - why is the thing I'm doing wrong, wrong.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172461 - Cearn - Mon Feb 08, 2010 10:55 am</h4>
    <div class="postbody"><span class="postbody">You're probably not copying enough tiles. With the line `memcpy(&amp;tile_mem[4][0], Player256Tiles, 32*32);', you're copying in the first 16 tiles. In 1D-mode this would make up a 32x32@8 object, but in 2D-mode, the whole VRAM forms a single bitmap and the tiles you've copied in only make up the first tile-row of that bitmap. See Fig 8b and 8c from <a class="postlink" href="http://www.coranac.com/tonc/text/regobj.htm#ssec-map" target="_blank">tonc:reg-obj</a>. Basically, you need to copy in the rest of the tiles as well.
<br/>
<br/>
Also, on that VRAM bitmap the tile index of the second row is 32. This means that the bitmap is effectively 256x256 (32x32 tiles) in size for 4bpp objects, but 128x256 (16x32 tiles) for 8bpp. You probably need to change the size of the bitmap too.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172496 - mog123 - Tue Feb 09, 2010 8:14 pm</h4>
    <div class="postbody"><span class="postbody">I just found out the possibilities that usenti offers. I can easily make an image that will be ready for 1d mapping.
<br/>
Great stuff Cearn!</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
