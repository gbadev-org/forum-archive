<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Changing A Timer Base In The IRQ Handler - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Coding > Changing A Timer Base In The IRQ Handler</h2>
<div id="posts">
<div class="post">
    <h4>#14672 - Krakken - Sat Jan 10, 2004 6:22 pm</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
Just a little question. I'm trying to set "REG_TMxD" (aka "REG_TMxCNT_L") during my IRQ handler function. I can set all the "REG_TMxCNT" registers, no problem, but I cannot set the offset for the timers. I have tried disabling "REG_TMxCNT" setting the value of "REG_TMxD" then restoring the old values of "REG_TMxCNT" but unfortunately that doesn't seem to work either.
<br/>
<br/>
If anyone knows of a solution?
<br/>
<br/>
Thanks,
<br/>
Nat.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14675 - jma - Sat Jan 10, 2004 6:48 pm</h4>
    <div class="postbody"><span class="postbody">A long time ago (about 8 months) I had this problem, too. The trick is disabling the timer settings in the correct order before writing. Sorry, I don't remember exactly what needed to be done.
<br/>
<br/>
Also, I wasn't doing it inside the ISR, so I can't say whether or not that will affect you. My guess is that it wouldn't, though.
<br/>
<br/>
Jeff<br/>_________________<br/><a href="mailto:massung@gmail.com">massung@gmail.com</a>
<br/>
<a href="http://www.retrobyte.org" target="_blank">http://www.retrobyte.org</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14681 - Krakken - Sun Jan 11, 2004 2:49 am</h4>
    <div class="postbody"><span class="postbody">Hey thanks, it worked!
<br/>
<br/>
I changed my code to the following:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">           
<br/>
REG_TM1CNT ^= TME_OVERFLOW;
<br/>
REG_TM1CNT ^= TME_ENABLE;
<br/>
            
<br/>
REG_TM1D = 0xFFFF - iRemain; 
<br/>
            
<br/>
REG_TM1CNT ^= TME_ENABLE | TME_OVERFLOW;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
And now it works just fine. Can anyone explain why it needs to be done this way?</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
