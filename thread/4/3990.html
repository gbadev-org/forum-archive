<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>multiple c files - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > multiple c files</h2>
<div id="posts">
<div class="post">
    <h4>#25810 - hakanyuksel - Sat Aug 28, 2004 10:56 pm</h4>
    <div class="postbody"><span class="postbody">I am using HAM. I have several c files in my project. I have a problem with calling functions from other c files. my code is like this
<br/>
<br/>
this is the main c file:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
#include &lt;math.h&gt;
<br/>
#include "variable.h"
<br/>
#include "interrupt.h"
<br/>
#include "init.h"
<br/>
<br/>
int main(void)
<br/>
{
<br/>
    init_game();
<br/>
<br/>
    while(1)
<br/>
    {
<br/>
    }
<br/>
return(0);
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
this it the header of the init.c file
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void init_game();
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
and this is the init.c file
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include "variable.h"
<br/>
#include "data.h"
<br/>
#include "display.h"
<br/>
#include "sprites.h"
<br/>
#include "init.h"
<br/>
<br/>
void init_game()
<br/>
{
<br/>
//   init_vars();
<br/>
<br/>
    copy_data_to_vram();
<br/>
<br/>
    u16 counter=0;
<br/>
    // SPRITE lar sifirlanir
<br/>
    for(counter=0;counter&lt;128;counter++)
<br/>
    {
<br/>
        sprite_attributes[counter].attribute1 = 160;
<br/>
        sprite_attributes[counter].attribute2 = 240;
<br/>
        sprite_attributes[counter].attribute3 = 0;
<br/>
    }
<br/>
<br/>
    set_video_mode( MODE_0 | SPRITES | SPR_1D | BG0 );
<br/>
    BG0_SET = 128+512+1024+2048+4096;
<br/>
//    init_objects();
<br/>
//    write_number_16_bg0(65535,1,1,32);
<br/>
}
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
when i compile the project I have an error like this
<br/>
main.o(.text+0x1c): In function `main':
<br/>
: undefined reference to `init_game()'
<br/>
make: *** [engine.elf] Error 1
<br/>
<br/>
What am i doing wrong. Why the compiler cant find the init_game procedure. it is declared in the init.h header file....<br/>_________________<br/>--------------------
<br/>
Hakan Yuksel
<br/>
3TE GAmes
<br/>
<a href="http://www.3tegames.com" target="_blank">www.3tegames.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25811 - sajiimori - Sat Aug 28, 2004 11:06 pm</h4>
    <div class="postbody"><span class="postbody">Perhaps init.c is not being compiled and/or linked in.  I don't know the HAM IDE, but here's how you'd do it from the command line:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
gcc -c main.c
<br/>
gcc -c init.c
<br/>
gcc -o out.elf main.o init.o
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25815 - hakanyuksel - Sun Aug 29, 2004 12:08 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">Perhaps init.c is not being compiled and/or linked in.  I don't know the HAM IDE, but here's how you'd do it from the command line:
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
gcc -c main.c
<br/>
gcc -c init.c
<br/>
gcc -o out.elf main.o init.o
<br/>
</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
<br/>
No it is compiling and linking all the c files. It is doing something like you say. It is a long command line so i dont copy and paste it down here..<br/>_________________<br/>--------------------
<br/>
Hakan Yuksel
<br/>
3TE GAmes
<br/>
<a href="http://www.3tegames.com" target="_blank">www.3tegames.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25816 - sajiimori - Sun Aug 29, 2004 12:29 am</h4>
    <div class="postbody"><span class="postbody">Well, there are no other visible problems.  All I can tell you is the header is not part of the problem because it's a linker error, and the linker doesn't care about headers.
<br/>
<br/>
Maybe there are some sample HAM projects with multiple .c files that you can look at.  Otherwise, most people here can help you with regular command line stuff.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25817 - hakanyuksel - Sun Aug 29, 2004 12:34 am</h4>
    <div class="postbody"><span class="postbody">I am trying devkitadv now. Maybe there is a bug in HAM.<br/>_________________<br/>--------------------
<br/>
Hakan Yuksel
<br/>
3TE GAmes
<br/>
<a href="http://www.3tegames.com" target="_blank">www.3tegames.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25819 - Lord Graga - Sun Aug 29, 2004 12:52 am</h4>
    <div class="postbody"><span class="postbody"><a class="postlink" href="http://forum.gbadev.org/viewtopic.php?p=25818#25818" target="_blank">I heard your prayer, fella!</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25820 - hakanyuksel - Sun Aug 29, 2004 1:28 am</h4>
    <div class="postbody"><span class="postbody">OK. I solved the problem. 
<br/>
<br/>
My project was a c++ project. It appears that you cant use c files in c++ projects(my main file was main cpp other files were c files) in HAM.  I changed it into a c project and the problem is soved. I think there must be a warning when I wanted to add c files to c++ projetcs.
<br/>
<br/>
Thank you all<br/>_________________<br/>--------------------
<br/>
Hakan Yuksel
<br/>
3TE GAmes
<br/>
<a href="http://www.3tegames.com" target="_blank">www.3tegames.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25825 - sajiimori - Sun Aug 29, 2004 2:35 am</h4>
    <div class="postbody"><span class="postbody">It's not necessarily wrong to combine C and C++ files, but there are issues to be aware of.  The one you were probably running into is "name mangling".  The C++ compiler changes the names of functions to allow overloading based on argument types.  Here's how you specify (in C++) that a function's name is not mangled (e.g. if it was compiled by a C compiler):
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
extern "C"
<br/>
{
<br/>
  void my_function();
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
To make a module work in both C and C++ applications, arrange its header like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#ifdef __cplusplus
<br/>
extern "C"
<br/>
{
<br/>
#endif
<br/>
<br/>
&lt;regular header contents&gt;
<br/>
<br/>
#ifdef __cplusplus
<br/>
}
<br/>
#endif
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25842 - hakanyuksel - Sun Aug 29, 2004 12:43 pm</h4>
    <div class="postbody"><span class="postbody">I see. Thanks for the information<br/>_________________<br/>--------------------
<br/>
Hakan Yuksel
<br/>
3TE GAmes
<br/>
<a href="http://www.3tegames.com" target="_blank">www.3tegames.com</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
