<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Event/Trigger Detection?? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Coding > Event/Trigger Detection??</h2>
<div id="posts">
<div class="post">
    <h4>#143435 - Ruben - Sun Oct 21, 2007 10:02 am</h4>
    <div class="postbody"><span class="postbody">How would I go about making my map have 'events'? By events, I mean as in:
<br/>
*Player steps into tile located at 22, 44*
<br/>
*Script 'foo' executes*
<br/>
I used to do this with a 'void*' array but that took up too much room for every map to be placed in EWRAM. I was wondering how I should do this. Any ideas??</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143441 - silent_code - Sun Oct 21, 2007 6:29 pm</h4>
    <div class="postbody"><span class="postbody">it depends on what exactly you're trying to do. that means if it's enough to write some simple "configurable" (through parameters) functions that are quite general and thus commonly used, or if you need rather complex "scripts" with very individual behaviour.
<br/>
<br/>
the latter involves a lot of work, while the first is rather unflexible (which might be enough for its purpose, though!).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143469 - sajiimori - Mon Oct 22, 2007 1:55 am</h4>
    <div class="postbody"><span class="postbody">Are you saying you have something working, but it doesn't fit in RAM?  If so, why don't you put it in ROM?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143470 - Dwedit - Mon Oct 22, 2007 2:10 am</h4>
    <div class="postbody"><span class="postbody">You don't need a space filling 2D array of events, you can get by fine with just a list of coordinates and events.  Use a binary search algorithm to check if the player is standing on an event tile.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143472 - tepples - Mon Oct 22, 2007 3:06 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">Are you saying you have something working, but it doesn't fit in RAM?  If so, why don't you put it in ROM?</td> </tr></table><span class="postbody">
<br/>
Because players 2 through 4 don't have ROM, nor does the GBA Movie Player.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143482 - Ruben - Mon Oct 22, 2007 8:03 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dwedit wrote:</b></span></td> </tr> <tr> <td class="quote">You don't need a space filling 2D array of events, you can get by fine with just a list of coordinates and events.  Use a binary search algorithm to check if the player is standing on an event tile.</td> </tr></table><span class="postbody">... and how would I do this??
<br/>
So you mean like store some const array like:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">const u8 eventfoo() {
<br/>
 //do something
<br/>
}
<br/>
<br/>
const u8 eventbar() {
<br/>
 //do something
<br/>
}
<br/>
<br/>
const u8* (EventArray[])() = {
<br/>
 //Map 1 (2x2)
<br/>
 0, 0,
<br/>
 &amp;eventfoo, 0,
<br/>
 //Map 2 (2x3)
<br/>
 0, &amp;eventbar, 0,
<br/>
 0, 0, 0,
<br/>
};</td> </tr></table><span class="postbody">
<br/>
<br/>
PS: Sorry but I'm not THAT advanced lol...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143490 - tepples - Mon Oct 22, 2007 11:37 am</h4>
    <div class="postbody"><span class="postbody">That's still a 2D space-filling array. Try this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
typedef int (*EventFunc)(Map *m, void *esto);
<br/>
<br/>
typedef struct EventTrigger {
<br/>
  unsigned short left, top, right, bottom;
<br/>
  EventFunc code;
<br/>
  void *esto;
<br/>
} EventTrigger;
<br/>
</td> </tr></table><span class="postbody">
<br/>
Then every time the player character takes a step, look through the array of EventTrigger elements associated with the map and find the first one where the character is within the rectangle described by left, top, right, and bottom. The 'esto' argument is good for passing data to the event function.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143494 - Ruben - Mon Oct 22, 2007 12:39 pm</h4>
    <div class="postbody"><span class="postbody">YAY!!!!! Thanks man! Just to show people what I ended up with (typical me :p):
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">//This is the 'typedef' for a map event
<br/>
typedef int (*_pFuncInt)(); 
<br/>
typedef struct _MapEventTrigger { 
<br/>
 u16 L, X, Y; 
<br/>
 _pFuncInt code; 
<br/>
 bool used;
<br/>
} _MapEventTrigger;
<br/>
<br/>
_MapEventTrigger _MapBG2Triggers[99];
<br/>
_MapEventTrigger _MapBG3Triggers[99];
<br/>
u8 _MapBG2TriggersSize = 0;
<br/>
u8 _MapBG3TriggersSize = 0;
<br/>
<br/>
void _MapAddTrigger(u8 l, u16 x, u16 y, _pFuncInt c) {
<br/>
 switch(l) {
<br/>
  case 0: //BG layer
<br/>
   if(_MapBG2TriggersSize &gt; 99) return;
<br/>
   _MapBG2Triggers[_MapBG2TriggersSize].L = l;
<br/>
   _MapBG2Triggers[_MapBG2TriggersSize].X = x;
<br/>
   _MapBG2Triggers[_MapBG2TriggersSize].Y = y;
<br/>
   _MapBG2Triggers[_MapBG2TriggersSize].code = c;
<br/>
   _MapBG2Triggers[_MapBG2TriggersSize].used = true;
<br/>
   _MapBG2TriggersSize++;
<br/>
   break;
<br/>
  case 1: //FG layer
<br/>
   if(_MapBG3TriggersSize &gt; 99) return;
<br/>
   _MapBG3Triggers[_MapBG3TriggersSize].L = l;
<br/>
   _MapBG3Triggers[_MapBG3TriggersSize].X = x;
<br/>
   _MapBG3Triggers[_MapBG3TriggersSize].Y = y;
<br/>
   _MapBG3Triggers[_MapBG3TriggersSize].code = c;
<br/>
   _MapBG3Triggers[_MapBG3TriggersSize].used = true;
<br/>
   _MapBG3TriggersSize++;
<br/>
   break;
<br/>
 }
<br/>
}
<br/>
<br/>
//This checks for events when the player's not moving
<br/>
void _MapEventCheck() {
<br/>
 int i;
<br/>
 if(_PlayerEvent) return;
<br/>
 if(_PlayerX &lt; 0) _PlayerX += _MapSizeX/2;
<br/>
 if(_PlayerY &lt; 0) _PlayerY += _MapSizeY/2;
<br/>
 
<br/>
 switch(_PlayerLayer) {
<br/>
  case 0:
<br/>
   for(i=0;i&lt;_MapBG2TriggersSize;i++) {
<br/>
    if(_MapBG2Triggers[i].X == _PlayerX &amp;&amp; _MapBG2Triggers[i].Y == _PlayerY &amp;&amp; _MapBG2Triggers[i].used) {
<br/>
     _PlayerEvent = 1;
<br/>
     _MapBG2Triggers[i].code();
<br/>
    }
<br/>
    break;
<br/>
   }
<br/>
   break;
<br/>
  case 1:
<br/>
   for(i=0;i&lt;_MapBG3TriggersSize;i++) {
<br/>
    if(_MapBG3Triggers[i].X == _PlayerX &amp;&amp; _MapBG3Triggers[i].Y == _PlayerY &amp;&amp; _MapBG3Triggers[i].used) {
<br/>
     _PlayerEvent = 1;
<br/>
     _MapBG3Triggers[i].code();
<br/>
    }
<br/>
    break;
<br/>
   }
<br/>
   break;
<br/>
 }
<br/>
}</td> </tr></table><span class="postbody">I didn't use the parser function as I don't think I'll EVER need that lolz... anyways... thanks again!
<br/>
<br/>
BTW: I know a lot of the code here isn't really nescesary for a 'normal' game but it's nescesary for me beleive it or not! _PlayerEvent tells the system whether the event should be triggered EVEN IF the person was just 'warped' there and stuff... lol...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143500 - kusma - Mon Oct 22, 2007 2:19 pm</h4>
    <div class="postbody"><span class="postbody">A linear search might not scale well if you get many triggers. Either keep the trigger-count low, or use a hash-table or something like that.
<br/>
<br/>
Keeping the trigger-count low is most likely a good-enough solution, hashing quickly requires some linked lists and memory-pools and so on.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
