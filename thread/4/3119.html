<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>problems with new - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Coding > problems with new</h2>
<div id="posts">
<div class="post">
    <h4>#18368 - Darmstadium - Thu Mar 25, 2004 12:51 am</h4>
    <div class="postbody"><span class="postbody">when I try to use the new operator, I get a ton of errors when I compile using DevKitAdv. Why doesn't it work?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18370 - LOst? - Thu Mar 25, 2004 1:22 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Darmstadium wrote:</b></span></td> </tr> <tr> <td class="quote">when I try to use the new operator, I get a ton of errors when I compile using DevKitAdv. Why doesn't it work?</td> </tr></table><span class="postbody">
<br/>
<br/>
Maybe you should enable the CPP option in the crt0.s, and maybe use the CPP libs when compiling.
<br/>
<br/>
new is a C++ operator only I guess, but I'm not sure.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18374 - johnny_north - Thu Mar 25, 2004 4:51 am</h4>
    <div class="postbody"><span class="postbody">Ensure these options are part of your linker options:
<br/>
<br/>
-lstdc++ -lgcc
<br/>
<br/>
You'll get c++ support which includes the new operator
<br/>
<br/>
BTW- I'm not sure if you can do this without an appropriate crt0 file. Jeff Frowein's crt0/lnkscript contains code to support c++.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18379 - NoMis - Thu Mar 25, 2004 8:48 am</h4>
    <div class="postbody"><span class="postbody">or just use g++ instead of gcc, it does the above automatic.
<br/>
<br/>
NoMis</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18380 - Lupin - Thu Mar 25, 2004 8:52 am</h4>
    <div class="postbody"><span class="postbody">Why don't just use the malloc function? Or don't use any dynamic memory at all? I think dynamic memory on a gba is not a good idea... i really wonder how the libraries manage the memory allocation since there is not endless ram space and most of the ram is most likely occupied by code and data...<br/>_________________<br/><a class="postlink" href="http://pokeme.shizzle.it/" target="_blank">Team Pokeme</a>
<br/>
<a class="postlink" href="http://lupin.shizzle.it/" target="_blank">My blog and PM ASM tutorials</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18384 - OptiRoc - Thu Mar 25, 2004 10:06 am</h4>
    <div class="postbody"><span class="postbody">Overloading "new" to operate on a statically allocated list of appropriately sized memory chunks is often a good solution.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18406 - Sweex - Thu Mar 25, 2004 4:58 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lupin wrote:</b></span></td> </tr> <tr> <td class="quote">Why don't just use the malloc function? Or don't use any dynamic memory at all? I think dynamic memory on a gba is not a good idea... i really wonder how the libraries manage the memory allocation since there is not endless ram space and most of the ram is most likely occupied by code and data...</td> </tr></table><span class="postbody">
<br/>
<br/>
No dynamic memory allocation? Are you serious? Sure, it is possible for small projects. If it becomes just a little bit bigger than, let's say, a tetris clone then it's requiring some serious effort. And besides, why should the programmer be the memory manager when you can have a computer do it for you? Sure, memory is limited on the GBA and one should be careful, but no dynamic mem allocation...?<br/>_________________<br/>If everything fails, read the manual: If even that fails, post on forum!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18412 - sajiimori - Thu Mar 25, 2004 7:50 pm</h4>
    <div class="postbody"><span class="postbody">Lupin, you know that 'new' does more than malloc(), right?  You can't just substitute malloc().
<br/>
<br/>
Also, I wouldn't presume to know how other people arrange their programs.  Making everything static can be really inconvenient for some applications.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18416 - Lupin - Thu Mar 25, 2004 8:18 pm</h4>
    <div class="postbody"><span class="postbody">Well, i was just wondering how the compiler knows where it can actually allocate data?
<br/>
<br/>
New does more than malloc()? What does it more? I thought it's both just memory allocation :/<br/>_________________<br/><a class="postlink" href="http://pokeme.shizzle.it/" target="_blank">Team Pokeme</a>
<br/>
<a class="postlink" href="http://lupin.shizzle.it/" target="_blank">My blog and PM ASM tutorials</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18421 - poslundc - Thu Mar 25, 2004 8:44 pm</h4>
    <div class="postbody"><span class="postbody">Constructors... not to mention overloaded constructors...
<br/>
<br/>
Dan (and I don't even use C++).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18435 - Lupin - Thu Mar 25, 2004 11:19 pm</h4>
    <div class="postbody"><span class="postbody">Well, i don't use C++ too, i try to program as low level as i can (because my C skills are... you know :)), preferably in asm :)<br/>_________________<br/><a class="postlink" href="http://pokeme.shizzle.it/" target="_blank">Team Pokeme</a>
<br/>
<a class="postlink" href="http://lupin.shizzle.it/" target="_blank">My blog and PM ASM tutorials</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18448 - col - Fri Mar 26, 2004 2:53 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lupin wrote:</b></span></td> </tr> <tr> <td class="quote">Well, i don't use C++ too, i try to program as low level as i can (because my C skills are... you know :)), preferably in asm :)</td> </tr></table><span class="postbody">
<br/>
<br/>
so you shouldn't have been trying to answer a question about c++, right? ;)
<br/>
<br/>
Col</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18456 - LOst? - Fri Mar 26, 2004 8:36 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lupin wrote:</b></span></td> </tr> <tr> <td class="quote">Why don't just use the malloc function? Or don't use any dynamic memory at all? I think dynamic memory on a gba is not a good idea... i really wonder how the libraries manage the memory allocation since there is not endless ram space and most of the ram is most likely occupied by code and data...</td> </tr></table><span class="postbody">
<br/>
<br/>
I tried to switch to the new operator after using malloc a while, and it worked much better until I needed to use realloc. I didn't know anything in C++ that can realloc the old memory. I tried new instead of realloc but it failed.
<br/>
<br/>
new works great with GBA games, but I like to have control of where I put my data, and new is not giving me the choice of optimizing the data space myself.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18457 - poslundc - Fri Mar 26, 2004 8:43 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>LOst? wrote:</b></span></td> </tr> <tr> <td class="quote">new works great with GBA games, but I like to have control of where I put my data, and new is not giving me the choice of optimizing the data space myself.</td> </tr></table><span class="postbody">
<br/>
<br/>
It should be just as easy to configure the new operator as it is to configure malloc.
<br/>
<br/>
But if you care so much about optimizing the data space manually, it's probably easier to do without either of these and just manage the memory directly using arrays and pointers. No heap means no fragmentation. I personally don't bother with using either malloc or new (my program still uses dynamic entities like linked lists, though).
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18463 - LOst? - Fri Mar 26, 2004 9:03 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>LOst? wrote:</b></span></td> </tr> <tr> <td class="quote">new works great with GBA games, but I like to have control of where I put my data, and new is not giving me the choice of optimizing the data space myself.</td> </tr></table><span class="postbody">
<br/>
<br/>
It should be just as easy to configure the new operator as it is to configure malloc.
<br/>
<br/>
But if you care so much about optimizing the data space manually, it's probably easier to do without either of these and just manage the memory directly using arrays and pointers. No heap means no fragmentation. I personally don't bother with using either malloc or new (my program still uses dynamic entities like linked lists, though).
<br/>
<br/>
Dan.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
I want to play your games. Do you have any links? And remember, I'm want games to be perfect synchronized (probably why I'm failing in GBA programming) and most GBA games doesn't give me that feeling.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18464 - Lupin - Fri Mar 26, 2004 9:10 pm</h4>
    <div class="postbody"><span class="postbody">yah, i also want to know what all the regulars are working on atm... I think that might be some interesting stuff ^^<br/>_________________<br/><a class="postlink" href="http://pokeme.shizzle.it/" target="_blank">Team Pokeme</a>
<br/>
<a class="postlink" href="http://lupin.shizzle.it/" target="_blank">My blog and PM ASM tutorials</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18467 - LOst? - Fri Mar 26, 2004 9:15 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lupin wrote:</b></span></td> </tr> <tr> <td class="quote">yah, i also want to know what all the regulars are working on atm... I think that might be some interesting stuff ^^</td> </tr></table><span class="postbody">
<br/>
Yea tepples, Miked0801, poslundc, please show us some of your god works! You are so good in all these tech and programming stuff, so how are you in game designing?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18471 - Miked0801 - Fri Mar 26, 2004 10:09 pm</h4>
    <div class="postbody"><span class="postbody">N.D.A. :(
<br/>
<br/>
Go buy Lord of the Rings: Return of the King, Sims: Bustin Out, James Bond: Everything or Nothing, or Digimon Racing.  Worked as a technology/support programmer on those.  The game I'm lead on currently will be mastering shortly and then I can tell you about it as well.
<br/>
<br/>
Or look at the 2 previous GBC releases of Harry Potter or Heroes of Might And Magic where I was lead as well.
<br/>
<br/>
No code to show, just good games :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18472 - poslundc - Fri Mar 26, 2004 10:58 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>LOst? wrote:</b></span></td> </tr> <tr> <td class="quote">I want to play your games. Do you have any links? And remember, I'm want games to be perfect synchronized (probably why I'm failing in GBA programming) and most GBA games doesn't give me that feeling.</td> </tr></table><span class="postbody">
<br/>
<br/>
You want games to be perfectly synchronized? I'm not sure what you mean by this... synchronized to what?
<br/>
<br/>
<a class="postlink" href="http://www.danposluns.com/gbadev" target="_blank">http://www.danposluns.com/gbadev</a> has some of the stuff I've been working on, although it's kind of out of date.
<br/>
<br/>
The Mode 7 engine, in particular, now supports random map generation, dynamic sprite z-ordering, arbitrary fades and multiply-fades, a basic event model, map collision detection, and status bars, menus and text windows. Currently working on manually-scaled sprites (to deal with the sprite cycles/line limit problem).
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18478 - sajiimori - Sat Mar 27, 2004 5:11 am</h4>
    <div class="postbody"><span class="postbody">If anybody cares, I'm currently working on a very compact Scheme (subset) implementation for GBA, to use as a game logic language for all my current and future projects.  (The faster I can make it, the less I have to write in C/asm, so that's good motivation.)
<br/>
<br/>
If all goes well, I'll release a whole development suite centered around this implementation.  Games that use it will run on GBA and anything that supports SDL.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18535 - f(DarkAngel) - Sun Mar 28, 2004 5:58 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lupin wrote:</b></span></td> </tr> <tr> <td class="quote">Well, i was just wondering how the compiler knows where it can actually allocate data?
<br/>
<br/>
New does more than malloc()? What does it more? I thought it's both just memory allocation :/</td> </tr></table><span class="postbody">
<br/>
<br/>
It has an allocation table. malloc and new uses different tables, and this is why you can't mix new/delete with malloc/free.
<br/>
<br/>
You can check out glibc docs (gnu.org) for info on how malloc works.<br/>_________________<br/>death scream...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18546 - tepples - Sun Mar 28, 2004 7:52 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>f(DarkAngel) wrote:</b></span></td> </tr> <tr> <td class="quote">malloc and new uses different tables, and this is why you can't mix new/delete with malloc/free.</td> </tr></table><span class="postbody">
<br/>
Does this mean that one should not mix C code that dynamically allocates memory with C++ code that dynamically allocates memory? Or can you explain a safe way to make new use malloc as a backend or vice versa?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">You can check out glibc docs (gnu.org) for info on how malloc works.</td> </tr></table><span class="postbody">
<br/>
The newlib docs may prove more helpful. GNU/Linux uses glibc; the publicly available tools for the GBA use Red Hat's newlib.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18558 - f(DarkAngel) - Sun Mar 28, 2004 10:30 pm</h4>
    <div class="postbody"><span class="postbody">If i recall correctly, there's no problem with using C &amp; C++ allocation in the same program. malloc and new just handles the table differently (i've accidently written that the different thing is table, not table handling), ie, they should be using the same table (there's a chance that both uses seperate tables, but i don't think this can be true because if this was true, malloc and new had to check each other's table. this is first an extra job for cpu, and second malloc doesn't/can't know anything about new in a C program). If this wasn't true, then there would be horrible problems in library usage (especially in real-mode/non-protected-mode system). Using malloc/new &amp; free/delete on the same block has undefined results (same for deallocation an array with delete x instead of delete [] x, vice and versa). 
<br/>
<br/>
It's strictly not recommended for C++ programming not to use malloc/free because they don't handle the call to the consturctor/destructors. Also malloc requires an explict pointer type-case which is an extra work for programmer. 
<br/>
<br/>
edit: i've accidently written that the different thing is tables instead of table handling/method. sorry for the confusion...<br/>_________________<br/>death scream...</span><span class="gensmall"><br/><br/>Last edited by f(DarkAngel) on Sun Mar 28, 2004 10:50 pm; edited 1 time in total</span></div>    
</div>
</div>

    </body>
</html>
