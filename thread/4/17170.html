<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>libfat and shudden GBA turn offs - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Coding > libfat and shudden GBA turn offs</h2>
<div id="posts">
<div class="post">
    <h4>#173127 - gorka - Tue Mar 23, 2010 5:32 pm</h4>
    <div class="postbody"><span class="postbody">how stable is libfat against turning off the GBA during read/write processes?
<br/>
Is it known for causing trouble into the memory cards? (damaging/corrupting files or making the whole card unreadable)
<br/>
<br/>
I am planning a project that will require a lot of reading a writing to the Mini SD card in my M3 perfect and would like to know if there is anything I should consider to avoid possible damage to files or the card.
<br/>
<br/>
Thanks in advance</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#173130 - wintermute - Tue Mar 23, 2010 7:07 pm</h4>
    <div class="postbody"><span class="postbody">Turning off during read will cause no issues.
<br/>
<br/>
Turning off during write is likely to cause data loss of some description, that's why gba games have a banner advising the user not to switch off while saving to eeprom.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#173139 - Dwedit - Wed Mar 24, 2010 12:35 am</h4>
    <div class="postbody"><span class="postbody">Pre-alllocate big files at a time when people wouldn't be turning off the system.  That way it's not interrupted during critical stuff (like writing to the FAT tables or directories).  The only thing you could lose would be the last 512 bytes of the file's data.
<br/>
<br/>
You need to call fflush() when you want to empty stdio's buffer to the disk.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#173140 - Ludo6431 - Wed Mar 24, 2010 1:22 am</h4>
    <div class="postbody"><span class="postbody">Just show when you write data (so the user is warned) and setup a checksum system to verify that the file isn't corrupted.<br/>_________________<br/>Sorry for my poor english, I'm french.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#173150 - gorka - Wed Mar 24, 2010 9:10 am</h4>
    <div class="postbody"><span class="postbody">Thanks a lot for your replies.
<br/>
<br/>
Dwedit, you mentioned:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Pre-alllocate big files at a time when people wouldn't be turning off the system. That way it's not interrupted during critical stuff (like writing to the FAT tables or directories). The only thing you could lose would be the last 512 bytes of the file's data. </td> </tr></table><span class="postbody">
<br/>
<br/>
Sorry for my ignorance, but what exactly do you mean by Pre-allocating the files?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Just show when you write data (so the user is warned) and setup a checksum system to verify that the file isn't corrupted.</td> </tr></table><span class="postbody">
<br/>
<br/>
My problem is that I plan to write little amount of data, but very frequently, so the warning is likely to be on and off all the time. But I would definitely add some kind of way to warn the user (a red dot or something like that)[/quote]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#173160 - Dwedit - Wed Mar 24, 2010 3:46 pm</h4>
    <div class="postbody"><span class="postbody">That means if you want to make a file that might get bigger as more stuff is added to it, just make a big file immediately, and let more and more data gradually fill the file.
<br/>
<br/>
Of course, you need to track the actual size of the data inside separately from the file's size.
<br/>
<br/>
Or you can just allocate double the file size, then alternately write to the first half, then the second half.  Use a checksum so you know whether it is good or not, then use an increasing sequence number so you know which half is newer.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
