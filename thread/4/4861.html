<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>HDMA and HBlank writing to same area (note and question) - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > HDMA and HBlank writing to same area (note and question)</h2>
<div id="posts">
<div class="post">
    <h4>#34389 - DiscoStew - Tue Jan 18, 2005 10:02 pm</h4>
    <div class="postbody"><span class="postbody">I've been working in the area of the HBlank, and for all my background stuff (which I plan to put together into a library), I use HDMA, so I wouldn't need to worry about it every HBlank. However, in another part of my code, which is separate from my BG stuff, I want to overwrite a background section that the HDMA writes to.
<br/>
<br/>
On both VBA and No$GBA, both allow the section to be rewritten after the HDMA before stuff is displayed on the scanline, and displays the BG correctly (which is what I wanted). But on hardware, the BG is messed up as if it is mixing the 2 things together, like my manual code starts going, then in the middle of it the HDMA inits, then the rest of my manual code writes the rest. That was just a note to everyone trying to mix the 2, if you try doing this. Now the question...
<br/>
<br/>
Because of this, I've got to choose which route I want to go in fixing this, since both my BG and other code will be in separate libraries in the future. Should I...
<br/>
<ol type="1"><li>Make functions in both libraries that extracts some data from one library, and inserts it into another library, so that it can rewrite memory that HDMA read from.
<br/>
</li><li>Remove HDMA altogether from my BG library, and replace it with my own routine that is executed every HBlank, so that there won't be any mixing do to interrupts.</li></ol>Of course, if anyone has a suggestion, I'd sure like to know what that is. I'm just trying to find a good, stable method that is fast also.
<br/>
<br/>
thx in advance<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#34390 - poslundc - Tue Jan 18, 2005 10:12 pm</h4>
    <div class="postbody"><span class="postbody">I didn't follow 100% of everything you said there, but it's been my experience that one generally shouldn't mix HDMA and HBlank interrupts. Either do one or the other... there's little practical reason for doing both.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#34392 - tepples - Tue Jan 18, 2005 11:16 pm</h4>
    <div class="postbody"><span class="postbody">If you want to modify a hardware register using hblank DMA, but you want to use hblank interrupts to modify it differently for a given set of scanlines, then write that different modification to the HDMA buffer instead of directly to the registers.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#34397 - DiscoStew - Wed Jan 19, 2005 12:12 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">but it's been my experience that one generally shouldn't mix HDMA and HBlank interrupts. Either do one or the other... there's little practical reason for doing both.</td> </tr></table><span class="postbody">
<br/>
I very much agree with you, as the results can be very odd. It seemed to work right on emulators (since they don't mimic hardware exactly), but it's the hardware that the stuff needs to work on.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">If you want to modify a hardware register using hblank DMA, but you want to use hblank interrupts to modify it differently for a given set of scanlines, then write that different modification to the HDMA buffer instead of directly to the registers.</td> </tr></table><span class="postbody">
<br/>
That would seem like the logical choice, since I've already got my HDMA setup working very nicely, plus since it's using DMA, chances of slight artifacting and other things of the nature are minimal from my own tests. I guess I should go with that, which I tried explaining in my first choice. Since both pieces of code will be in different libraries, I will need to make an extract and insert function.
<br/>
<br/>
thx for your help guys.<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
