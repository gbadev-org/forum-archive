<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>problem with tiles.... - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > problem with tiles....</h2>
<div id="posts">
<div class="post">
    <h4>#19239 - Darmstadium - Thu Apr 15, 2004 3:36 am</h4>
    <div class="postbody"><span class="postbody">I'm making this text demo. I drew all ascii character numbers 32-125 for it to use. I load up the bitmap containing the character set, the palette for the bg I put the chars on, and the map data, all with no problems. The problem is that my demo doesn't display the right tiles. It displays seemingly random tiles, ignoring which tiles I specified in the map data. I checked the map data and it is excactly what I expected. I ask you to help me figure out how to make this behave how I want. 
<br/>
<br/>
In case you're curious, to get the number of the character you want in my set from an ASCII character number, you subtract 32 from the ASCII number and multiply that by two. 
<br/>
<br/>
Here is my code so far:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include &lt;math.h&gt;
<br/>
#include "gba.h"
<br/>
#include "dispcnt.h"
<br/>
#include "bg.h"
<br/>
#include "dma.h"
<br/>
<br/>
#include "alphabet.pal.c"
<br/>
#include "alphabet.raw.c"
<br/>
<br/>
FIXED angle = 0;
<br/>
FIXED zoom = 1 &lt;&lt; 8;
<br/>
FIXED SIN[360];
<br/>
FIXED COS[360];
<br/>
char RotIndexCounter = 0;
<br/>
<br/>
background bg2;
<br/>
<br/>
u16 * ascii_to_mine(char * str, u16 len)
<br/>
{
<br/>
   u16 * mine = new u16[len];
<br/>
   u16 loop;
<br/>
   for (loop = 0; loop &lt; len; loop++)
<br/>
      mine[loop] = (str[loop] - 32) * 2;
<br/>
   
<br/>
   return mine;
<br/>
}
<br/>
<br/>
int main()
<br/>
{
<br/>
   REG_DISPCNT = 1 | OBJ_ENABLE | OBJ_MAP_1D | BG2_ENABLE;
<br/>
   
<br/>
   u16 loop;
<br/>
   
<br/>
   for(loop = 0; loop &lt; 360; loop++)
<br/>
   {
<br/>
      SIN[loop] = (FIXED)(sin(RADIAN(loop)) * 256);
<br/>
      COS[loop] = (FIXED)(cos(RADIAN(loop)) * 256);
<br/>
   }
<br/>
   
<br/>
   REG_BG2CNT = ROTBG_SIZE_128x128 | (0 &lt;&lt; CHAR_SHIFT) | (28 &lt;&lt; SCREEN_SHIFT) | BG_COLOR_256;
<br/>
   bg2.x_scroll = 120;
<br/>
   bg2.y_scroll = 80;
<br/>
   
<br/>
   REG_DM3SAD = (u32)alphabet_Bitmap;
<br/>
   REG_DM3DAD = (u32)CharBaseBlock(0);
<br/>
   REG_DM3CNT = 8192 | DMA_ENABLE | DMA_TIMEING_IMMEDIATE | DMA_32;
<br/>
   
<br/>
   REG_DM3SAD = (u32)alphabet_Palette;
<br/>
   REG_DM3DAD = (u32)BGPaletteMem;
<br/>
   REG_DM3CNT = 128 | DMA_ENABLE | DMA_TIMEING_IMMEDIATE | DMA_32;
<br/>
   
<br/>
   u16 * mapdat = (u16 *)ScreenBaseBlock(28);
<br/>
   
<br/>
   for (loop = 0; loop &lt; 256; loop++)
<br/>
      mapdat[loop] = 0;
<br/>
   
<br/>
   mapdat[0] = 84;
<br/>
   mapdat[1] = 130;
<br/>
   mapdat[2] = 134;
<br/>
   mapdat[3] = 150;
<br/>
   
<br/>
   //mapdat = ascii_to_mine("test", 4);
<br/>
   
<br/>
   while (1)
<br/>
   {
<br/>
      RotateBg(&amp;bg2,angle,0,0,zoom);
<br/>
      WaitForVBlank();
<br/>
   }
<br/>
   
<br/>
   return 0;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I realize that I'm being a bit wasteful with the tiles; I really, really don't need 256 colors, but I couldn't find a tutorial that told you how to use 16 color tiles. I'm also probably not going to need a rot bg and also can't find a tut on text bgs, so if anybody knows of a tut that teaches you these things, please let me know. Thanks a lot for your help.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19240 - niltsair - Thu Apr 15, 2004 4:00 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">u16 * mapdat = (u16 *)ScreenBaseBlock(28);
<br/>
<br/>
   for (loop = 0; loop &lt; 256; loop++)
<br/>
      mapdat[loop] = 0;
<br/>
<br/>
   mapdat[0] = 84;
<br/>
   mapdat[1] = 130;
<br/>
   mapdat[2] = 134;
<br/>
   mapdat[3] = 150; </td> </tr></table><span class="postbody">
<br/>
<br/>
Since you're using a rotation bg, each entry in the Map data takes 8bits (the tile number). You're using a 16bits pointer, which means it end up writing 2 entries in the map, 0 and the number(84,130,134,150) for each one.
<br/>
<br/>
Problem is, the Video memory can only be written with 16/32bits  values. So try this :
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   for (loop = 0; loop &lt; (16*16)/2; loop++)
<br/>
      mapdat[loop] = 0;
<br/>
   
<br/>
   mapdat[0] = 84   | 130;
<br/>
   mapdat[1] = 134 | 150;</td> </tr></table><span class="postbody">
<br/>
<br/>
<a class="postlink" href="http://www.gbadev.org/docs.php?section=tutorials" target="_blank">http://www.gbadev.org/docs.php?section=tutorials</a> for tutorials. I recommand <a class="postlink" href="http://www.thepernproject.com/" target="_blank">The pern project tutorial</a><br/>_________________<br/>-Inside every large program is a small program struggling to get out. (Hoare's Law of Large Programs)
<br/>
-The man who can smile when things go wrong has thought of someone he can blame it on. (Nixon's Theorem)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19245 - tepples - Thu Apr 15, 2004 5:56 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>niltsair wrote:</b></span></td> </tr> <tr> <td class="quote">Since you're using a rotation bg, each entry in the Map data takes 8bits (the tile number). You're using a 16bits pointer, which means it end up writing 2 entries in the map, 0 and the number(84,130,134,150) for each one.
<br/>
<br/>
Problem is, the Video memory can only be written with 16/32bits  values. So try this :
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   for (loop = 0; loop &lt; (16*16)/2; loop++)
<br/>
      mapdat[loop] = 0;
<br/>
   
<br/>
   mapdat[0] = 84   | 130;
<br/>
   mapdat[1] = 134 | 150;</td> </tr></table><span class="postbody">
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
Nit: Shouldn't the right-side of each pair be shifted &lt;&lt; 8 like this?
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   for (loop = 0; loop &lt; (16*16)/2; loop++)
<br/>
      mapdat[loop] = 0;
<br/>
   
<br/>
   mapdat[0] = 84   | (130 &lt;&lt; 8);
<br/>
   mapdat[1] = 134 | (150 &lt;&lt; 8);</td> </tr></table><span class="postbody"><br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19251 - LOst? - Thu Apr 15, 2004 9:22 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>niltsair wrote:</b></span></td> </tr> <tr> <td class="quote">Since you're using a rotation bg, each entry in the Map data takes 8bits (the tile number). You're using a 16bits pointer, which means it end up writing 2 entries in the map, 0 and the number(84,130,134,150) for each one.
<br/>
<br/>
Problem is, the Video memory can only be written with 16/32bits  values. So try this :
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   for (loop = 0; loop &lt; (16*16)/2; loop++)
<br/>
      mapdat[loop] = 0;
<br/>
   
<br/>
   mapdat[0] = 84   | 130;
<br/>
   mapdat[1] = 134 | 150;</td> </tr></table><span class="postbody">
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
Nit: Shouldn't the right-side of each pair be shifted &lt;&lt; 8 like this?
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   for (loop = 0; loop &lt; (16*16)/2; loop++)
<br/>
      mapdat[loop] = 0;
<br/>
   
<br/>
   mapdat[0] = 84   | (130 &lt;&lt; 8);
<br/>
   mapdat[1] = 134 | (150 &lt;&lt; 8);</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
<br/>
Yes it must be shifted with 8. Else you will OR it in the same byte.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19256 - niltsair - Thu Apr 15, 2004 2:03 pm</h4>
    <div class="postbody"><span class="postbody">Errr yes, was rather late :P<br/>_________________<br/>-Inside every large program is a small program struggling to get out. (Hoare's Law of Large Programs)
<br/>
-The man who can smile when things go wrong has thought of someone he can blame it on. (Nixon's Theorem)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19276 - Darmstadium - Thu Apr 15, 2004 9:39 pm</h4>
    <div class="postbody"><span class="postbody">Well, I tried doing it nilsair's way but that didn't really change anything. I'll try to describe my problem better. Two characters appear: what should be char number 68 and a small dot. The character that has number 68 apears at tile 0,0 and the dot that is not one of the character that should be there appears at 3,0. All of the other tiles seem to display the space character. Also, once I tried it niltsair's way, the horizontal flip was set for tile 1,0. Anway, the map data is precisely what it should be, but the tiles it displays are completely wrong. Thanks for helping</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19279 - niltsair - Thu Apr 15, 2004 10:04 pm</h4>
    <div class="postbody"><span class="postbody">Are your Tiles Data and Palette valid? Check inside your emulator to know if they are. If they're not, make sure that your data in  <span style="font-weight: bold">#include "alphabet.pal.c"</span> and <span style="font-weight: bold">#include "alphabet.raw.c" </span> are valid. 
<br/>
<br/>
Const u16 for palette.
<br/>
Const u8 for Tiles or Const u16 for Tiles or Const u32 for Tiles. (Depends on how they stored the pixels values in it)
<br/>
<br/>
This is not the cause of your problem but you shouldn't include .c in another source file that what Header are for.<br/>_________________<br/>-Inside every large program is a small program struggling to get out. (Hoare's Law of Large Programs)
<br/>
-The man who can smile when things go wrong has thought of someone he can blame it on. (Nixon's Theorem)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19299 - Cearn - Fri Apr 16, 2004 2:57 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Darmstadium wrote:</b></span></td> </tr> <tr> <td class="quote">Well, I tried doing it nilsair's way but that didn't really change anything. I'll try to describe my problem better. Two characters appear: what should be char number 68 and a small dot. The character that has number 68 apears at tile 0,0 and the dot that is not one of the character that should be there appears at 3,0. All of the other tiles seem to display the space character. Also, once I tried it niltsair's way, the horizontal flip was set for tile 1,0. Anway, the map data is precisely what it should be, but the tiles it displays are completely wrong. Thanks for helping</td> </tr></table><span class="postbody">
<br/>
Uhm, did you check the tile numbers and flags with the VBA map viewer? If so, you may like to know that this information is wrong for rotational backgrounds (it still thinks it's on a text background). Check out the <a class="postlink" href="http://sourceforge.net/tracker/index.php?func=detail&amp;aid=904942&amp;group_id=63889&amp;atid=505529" target="_blank">bug report</a>
<br/>
on the vba sourceproject site for a more complete story and a fixed version. 
<br/>
<br/>
Also, why are you multiplying the tile-number by 2? Is it because they're 256 color tiles, which take twice the amount of memory that 16 color tiles do? If so, don't. Unlike for sprites, the tile-numbering for backgrounds is always by the tile. See <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=2891" target="_blank">http://forum.gbadev.org/viewtopic.php?t=2891</a> or <a class="postlink" href="http://user.chem.tue.nl/jakvijn/tonc/regbg.htm#subtle" target="_blank">here</a> for some details on tile-counting.
<br/>
In other words, "Jack" would be simply be tiles 42, 65, 67, 75. (Btw, you were planning on cleaning up after that <span style="font-weight: bold">new</span> in ascii_to_mine, right? Just checking.)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>niltsair wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Const u16 for palette. 
<br/>
Const u8 for Tiles or Const u16 for tiles or Const u32 for Tiles. (Depends on how they stored the pixels values in it)</td> </tr></table><span class="postbody">
<br/>
u8 for Tiles is probably a bad idea since, as you said, 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>niltsair wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
... the Video memory can only be written with 16/32bits values. 
<br/>
</td> </tr></table><span class="postbody">
<br/>
which would put use back were we started, right? :P</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19303 - niltsair - Fri Apr 16, 2004 4:10 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">niltsair wrote:
<br/>
... the Video memory can only be written with 16/32bits values.</td> </tr></table><span class="postbody">which would put use back were we started, right? :P</span></td> </tr></table><span class="postbody">
<br/>
<br/>
It doesn't matter really, as long as you tell the linker to align it on a 32bits bondaries (ALIGN4) and just cast the pointer to whatever you want when transfering the tiles (by dma or inside a loop). The only different would be seing your values listed as :</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">const u8  myTiles[] ALIGN4 = { 0x01, 0x02, 0x03, 0x01F, ...}; or
<br/>
const u16 myTiles[] ALIGN4 = { 0x0102, 0x0301F, ...}; or
<br/>
const u32 myTiles[] = { 0x01020301F, ...}; 
<br/>
<br/>
REG_DM3SAD = (u32)myTiles;
<br/>
   REG_DM3DAD = (u32)CharBaseBlock(0);
<br/>
   REG_DM3CNT = 8192 | DMA_ENABLE | DMA_TIMEING_IMMEDIATE | MA_32; 
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/>-Inside every large program is a small program struggling to get out. (Hoare's Law of Large Programs)
<br/>
-The man who can smile when things go wrong has thought of someone he can blame it on. (Nixon's Theorem)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19308 - Darmstadium - Fri Apr 16, 2004 9:15 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for your help guys.
<br/>
Good news = everything works fantasticaly well AND i learned to use 16 color text bgs
<br/>
Bad news = my ascii_to_mine() function somehow destroys all of my tile data
<br/>
<br/>
First:
<br/>
I've made a lot of changes so here is my new code:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include &lt;math.h&gt;
<br/>
#include "gba.h"
<br/>
#include "dispcnt.h"
<br/>
#include "bg.h"
<br/>
#include "dma.h"
<br/>
<br/>
#include "alphabet.pal.c"
<br/>
#include "alphabet.raw.c"
<br/>
<br/>
background bg2;
<br/>
<br/>
u16 strlen(char * str)
<br/>
{
<br/>
   u16 len = 0;
<br/>
   while (str[len] != '\0')
<br/>
      len++;
<br/>
   return len;
<br/>
}
<br/>
<br/>
//somehow directly destroys my tile data
<br/>
u16 * ascii_to_mine(const char * str, const u8 len)
<br/>
{
<br/>
   u16 * mstr = new u16[len];
<br/>
   
<br/>
   u16 loop;
<br/>
   for (loop = 0; loop &lt; len; loop++)
<br/>
      mstr[loop] = (u16)(str[loop] - 32);
<br/>
   
<br/>
   return mstr;
<br/>
}
<br/>
<br/>
void copy_mstr(const u16 * mstr, const u16 mstr_len, const u16 tile_n)
<br/>
{
<br/>
   REG_DM3SAD = (u32)mstr;
<br/>
   REG_DM3DAD = (u32)(ScreenBaseBlock(28) + tile_n * 0x20);
<br/>
   REG_DM3CNT = mstr_len | DMA_ENABLE | DMA_TIMEING_IMMEDIATE | DMA_16;
<br/>
}
<br/>
<br/>
int main()
<br/>
{
<br/>
   REG_DISPCNT = MODE_0 | OBJ_ENABLE | OBJ_MAP_1D | BG2_ENABLE;
<br/>
   
<br/>
   REG_BG2CNT = TEXTBG_SIZE_256x256 | (0 &lt;&lt; CHAR_SHIFT) | (28 &lt;&lt; SCREEN_SHIFT) | BG_COLOR_16;
<br/>
   bg2.x_scroll = 120;
<br/>
   bg2.y_scroll = 80;
<br/>
   
<br/>
   REG_DM3SAD = (u32)alphabet_Bitmap;
<br/>
   REG_DM3DAD = (u32)CharBaseBlock(0);
<br/>
   REG_DM3CNT = 8192 | DMA_ENABLE | DMA_TIMEING_IMMEDIATE | DMA_32;
<br/>
   
<br/>
   REG_DM3SAD = (u32)alphabet_Palette;
<br/>
   REG_DM3DAD = (u32)0x05000000;
<br/>
   REG_DM3CNT = 64 | DMA_ENABLE | DMA_TIMEING_IMMEDIATE | DMA_32;
<br/>
   
<br/>
   u16 * mapdat = (u16 *)ScreenBaseBlock(28);
<br/>
   
<br/>
   u16 * mstr_test = new u16[4];
<br/>
   
<br/>
   mstr_test = ascii_to_mine("Jack", 4);
<br/>
   
<br/>
   /////Convert the string "Jack" manually\\\\\
<br/>
   //mstr_test[0] = 42;
<br/>
   //mstr_test[1] = 65;
<br/>
   //mstr_test[2] = 67;
<br/>
   //mstr_test[3] = 75;
<br/>
   
<br/>
   copy_mstr(mstr_test, 4, 0);
<br/>
   
<br/>
   //main loop not needed at this point
<br/>
   //while (1)
<br/>
   //{
<br/>
   //   WaitForVBlank();
<br/>
   //}
<br/>
   
<br/>
   return 0;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Next:
<br/>
Cearn - how come I shouldn't be using new? What are the alternatives?
<br/>
<br/>
Last:
<br/>
Like I said, ascii_to_mine() is going on a rampage. It's not a problem with the data it returns a pointer to that is copied using the copy_mstr() function, but the actual code in that function somehow does this... I'm stumped. Anybody got any ideas?
<br/>
<br/>
Thanks for your help guys</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19309 - sajiimori - Fri Apr 16, 2004 10:02 pm</h4>
    <div class="postbody"><span class="postbody">You do know that with common linkscripts, the GBA resets when main() returns...?  You might want to put that while(1) back in.
<br/>
<br/>
Your copy_mstr() is weird.  Why are you multiplying tile_n by 0x20?  Map cells are only 2 bytes long on text BGs -- perhaps you were thinking of character offsets.
<br/>
<br/>
You've enabled sprites without moving them off the screen (or doing that double-size deal), so you might get garbage on the top left corner.
<br/>
<br/>
Why are you scrolling half a screen to the right and downward?  Scroll coordinates represent the top left corner of the screen, not the center.
<br/>
<br/>
Don't use 'new' unless you're going to do real memory management.  Stick to static arrays until then -- you have memory leaks all over.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19409 - Cearn - Mon Apr 19, 2004 8:57 am</h4>
    <div class="postbody"><span class="postbody">@ niltsair
<br/>
OK if you pay attention it doesn't matter, but if you would simply use a copy-loop, you might have problems
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
const u8 map[128]= { ... };
<br/>
<br/>
u16 *sb= ScreenBlock(0);  // or u8 *sb
<br/>
for(ii=0; ii&lt;128; ii++) 
<br/>
    sb[ii] = map[ii]; 
<br/>
</td> </tr></table><span class="postbody">
<br/>
That would be bad (so would using memcpy, at least the last time I checked). DMA would be OK, of course.
<br/>
<br/>
@ Darmstadium
<br/>
What sajimori said should help you out.
<br/>
<br/>
About the "new"  thing, when you use new (or malloc in C) you basically put a fence around a portion of the memory which won't be messed with without your permission until you delete (or free) it, even when the function goes out of scope. This is in contrast to local variables, which memory's free when the function ends. When you use <span style="font-weight: bold">new</span> to allocate memory, but never release it again with <span style="font-weight: bold">delete</span>, it leaves you with less and less memory everytime you allocate more. That's the memory leak that sajimori is talking about. In your code you have
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
//somehow directly destroys my tile data 
<br/>
u16 * ascii_to_mine(const char * str, const u8 len) 
<br/>
{ 
<br/>
   u16 * mstr = new u16[len]; 
<br/>
    
<br/>
   u16 loop; 
<br/>
   for (loop = 0; loop &lt; len; loop++) 
<br/>
      mstr[loop] = (u16)(str[loop] - 32); 
<br/>
    
<br/>
   return mstr; 
<br/>
}
<br/>
<br/>
int main()
<br/>
{
<br/>
   // blah
<br/>
   u16 * mstr_test = new u16[4];  
<br/>
   mstr_test = ascii_to_mine("Jack", 4);
<br/>
<br/>
   // blah
<br/>
</td> </tr></table><span class="postbody">
<br/>
What this does is first allocate some memory to mstr_test, and then in ascii_to_mine it allocates some more, neither of which are ever released. Even worse, when you assign the result of ascii_to_mine to mstr_test, the old pointer is lost so you won't be able to release it at all. EVER. OK, so it's only 16 bytes now, but it'll get worse and worse with bigger projects. Check your C/C++ book for more on memory allocation.
<br/>
<br/>
What you may want to do is model your ascii_to_mine function to the standard C routine of strcpy. Something like
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
u16 * ascii_to_mine(u16 *dest, const char *src, int len) 
<br/>
{    
<br/>
   int loop; 
<br/>
   for (loop = 0; loop &lt; len; loop++) 
<br/>
      dest[loop] = (u16)(src[loop] - 32);   
<br/>
   // dest[len]='\0';
<br/>
    
<br/>
   return dest; 
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
Whether the line "dest[len]='\0';" should be in there is more of a personal choice; It's standard for C-strings to have a '\0' delimiter, but if you don't want that, just leave it out. Note also that I use standard ints instead of u16 and u8 for counters and lengths. It may use a little more memory, but it makes the GBA happier as it's a 32bit machine.
<br/>
Anyway, using such a function will let you use either static arrays for the destination (like sajimori advised), or you could allocate it dynamically. The point is, you won't have nasty side effects like memory leaks stemming from that function alone.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
