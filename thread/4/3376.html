<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Linker problem.. - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > Linker problem..</h2>
<div id="posts">
<div class="post">
    <h4>#20435 - dXtr - Tue May 11, 2004 12:37 pm</h4>
    <div class="postbody"><span class="postbody">I do this (it's a little edit with newline for every command, so it's easier to read..):
<br/>
c:\devkitadv-r5-beta-3/bin/arm-agb-elf-ld.exe	-L c:\devkitadv-r5-beta-3/lib/gcc-lib/arm-agb-elf/3.2.2/interwork
<br/>
						-L c:\devkitadv-r5-beta-3/arm-agb-elf/lib/interwork
<br/>
						-L c:\devkitadv-r5-beta-3/arm-agb-elf/lib/krawall
<br/>
						--script c:\devkitadv-r5-beta-3/system/lnkscript-krawall
<br/>
						-o test.elf crt0.o main.o gbalib/Interrupt.o gbalib/Sprite.o gbalib/Video.o gbalib/Memory.o CGame.o ctgoblin.o samples.o
<br/>
						-lkrawall
<br/>
						-lm
<br/>
						-lstdc++
<br/>
						-lsupc++
<br/>
						-lgcc
<br/>
						-lc
<br/>
						-lgcc
<br/>
<br/>
and get this:
<br/>
crt0.o: In function `__FarProcedure':
<br/>
crt0.o(.text+0x214): undefined reference to `main'
<br/>
crt0.o: In function `IntrRet':
<br/>
crt0.o(.iwram+0x10c): undefined reference to `IntrTable'
<br/>
make: *** [test.elf] Error 1
<br/>
<br/>
Anyone knows what's wrong? And if you need to se something that I've missed to post please say so and I post it to.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20439 - NoMis - Tue May 11, 2004 1:53 pm</h4>
    <div class="postbody"><span class="postbody">It seems you didnt have a main function. you need it for entry in you app
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
  int main()
<br/>
  {
<br/>
    ...
<br/>
  }
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
also you seem to have enabled Interrupt support in the crt0.s 
<br/>
If so you need to define the IntrTable which later can contain the addresses of your different interrupt handlers.
<br/>
<br/>
NoMis</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20441 - dXtr - Tue May 11, 2004 1:58 pm</h4>
    <div class="postbody"><span class="postbody">well... I do have a main:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
// Start the game
<br/>
int main(void)
<br/>
{
<br/>
    game = new CMyGame;
<br/>
    game-&gt;Run();
<br/>
        return(0);
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
and I do have a interrupt table to.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
FuncInterrupt IntrTable[] =
<br/>
{
<br/>
    VBLANK,
<br/>
    HBLANK,
<br/>
    VCOUNT,
<br/>
    TIMER0,
<br/>
    TIMER1,
<br/>
    TIMER2,
<br/>
    TIMER3,
<br/>
    COM,
<br/>
    DMA0,
<br/>
    DMA1,
<br/>
    DMA2,
<br/>
    DMA3,
<br/>
    BUTTON,
<br/>
    CART
<br/>
};
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20442 - Nikkoz - Tue May 11, 2004 2:04 pm</h4>
    <div class="postbody"><span class="postbody">Do you by any chanse use a Pascal compiler? Those compiles dosen't handle C++ very well...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20443 - dXtr - Tue May 11, 2004 2:31 pm</h4>
    <div class="postbody"><span class="postbody">And by the way.. the exact same coded works under ham with out this linking error</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20525 - dXtr - Wed May 12, 2004 2:38 pm</h4>
    <div class="postbody"><span class="postbody">hm... is there none who could help me.. cuz I haven't managed to fix the problem yet. =(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20538 - sajiimori - Wed May 12, 2004 7:07 pm</h4>
    <div class="postbody"><span class="postbody">Maybe it'll take some work on your part.  Try compiling smaller apps, with and without krawall, using ld directly to link and using g++ or gcc as a front end, etc.
<br/>
<br/>
I bet you could narrow the problem down to something very specific, with some effort.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20589 - isildur - Thu May 13, 2004 2:26 pm</h4>
    <div class="postbody"><span class="postbody">I once had a similar problem and it was because I was linking with the wrong crt0.o. Some use AgbMain() and others use main()... It might not be using the linkscript and the crt0 you think...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20622 - dXtr - Thu May 13, 2004 8:19 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>isildur wrote:</b></span></td> </tr> <tr> <td class="quote">I once had a similar problem and it was because I was linking with the wrong crt0.o. Some use AgbMain() and others use main()... It might not be using the linkscript and the crt0 you think...</td> </tr></table><span class="postbody">
<br/>
<br/>
yeah I've been thinking of that too. So I'm considering remove all other crt0.o files I can find on my computer and try again.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20661 - dXtr - Fri May 14, 2004 3:06 pm</h4>
    <div class="postbody"><span class="postbody">guess what.. it wasn't a linking error.. it was a compile error but it didn't show up until I link. cuz I compared the .o file I got from devkitadv. and the one I got from ham and I discoverd that they had different size with ~200byte. I checked the generated .s files and found out that they don't look the same. So I guess I've missed some flag or something &gt;_&lt;
<br/>
<br/>
here is some from the start of devkits .s file:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
   .global   IntrTable
<br/>
   .data
<br/>
   .align   2
<br/>
   .type   IntrTable,object
<br/>
   .size   IntrTable,56
<br/>
IntrTable:
<br/>
   .word   0
<br/>
   .word   0
<br/>
   .word   0
<br/>
   .word   0
<br/>
   .word   0
<br/>
   .word   0
<br/>
   .word   0
<br/>
   .word   0
<br/>
   .word   0
<br/>
   .word   0
<br/>
   .word   0
<br/>
   .word   0
<br/>
   .word   0
<br/>
   .word   0
<br/>
   .text
<br/>
   .align   2
<br/>
   .global   main
<br/>
   .type   main,function
<br/>
main:
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
and here is some from the start of ham .s file:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   .global   IntrTable
<br/>
   .bss
<br/>
   .global   IntrTable
<br/>
   .align   2
<br/>
   .type   IntrTable, %object
<br/>
   .size   IntrTable, 56
<br/>
IntrTable:
<br/>
   .space   56
<br/>
   .text
<br/>
   .align   2
<br/>
   .global   main
<br/>
   .type   main, %function
<br/>
main:
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
anyone that can point out what I've made wrong?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20672 - dXtr - Fri May 14, 2004 4:56 pm</h4>
    <div class="postbody"><span class="postbody">man.. this is strange. I've been using the devkit adv. release 5 (beta3)
<br/>
until now. Then I just had this idea.. and downloaded release 4... and guess what? now my code compiles AND links AND works! ^_^
<br/>
but why? is there something wrong with release 5?</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
