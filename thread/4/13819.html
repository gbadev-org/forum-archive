<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>(Zelda Heart Related Engine) *Solved* (Solution Inside) - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Coding > (Zelda Heart Related Engine) *Solved* (Solution Inside)</h2>
<div id="posts">
<div class="post">
    <h4>#136245 - zaczac - Mon Jul 30, 2007 5:30 pm</h4>
    <div class="postbody"><span class="postbody">Hey, im a little new to this forum, so dont flip out if im in the wrong place, im using DS kit 'Palib' and i thought maybe that something like this was achieved in GBA development. Anyway. I have a code
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">PA_StartSpriteAnim(1, 0, 0, 1, 1);
<br/>
</td> </tr></table><span class="postbody">
<br/>
This sets a animation going on screen 1, sprite # 0, frame start, frame end and FPS. 
<br/>
I was wondering, if there would be a way to MANUALLY advance this sprites frame using Button presses? The reason being is to imagine a engine similiar to zelda's heart system. I have 4 frames (full, 3/4, half, 1/4, empty) and i want to change those frames when i want, using frames, instead of making new sprites (128 limit). 
<br/>
<br/>
Has anyone made a similar engine and could reccommend something to solve this? I really would like to get it sorted out. I think maybe adding a %d + or - in there somewhere may do it, but if people can explain it a little, ill try it out and post my results.
<br/>
<br/>
Thanks for the help, id just really like to get this life meter engine done with.
<br/>
<br/>
:D</span><span class="gensmall"><br/><br/>Last edited by zaczac on Thu Aug 02, 2007 5:35 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#136252 - Lynx - Mon Jul 30, 2007 6:59 pm</h4>
    <div class="postbody"><span class="postbody">Well, palib.com forums would probably be a better place to ask, I don't understand why you wouldn't just use PA_CreateSprite() instead?  If it's not animated...  Here's how I did it for LeoToddler:
<br/>
<br/>
PA_CreateSprite(0,0,(void*)AllLetters_Sprite, OBJ_SIZE_32X32, 1, 0, 46, 10);
<br/>
<br/>
Where:
<br/>
0 = Screen
<br/>
0 - 25 = Sprite Number for A - Z
<br/>
(void*)AllLetters_Sprite = Sprite Name
<br/>
OBJ_SIZE_32X32 = Sprite Size
<br/>
1 = 256 Color Mode
<br/>
0 = Sprite Pallette Number
<br/>
46, 10 = X and Y Position on the screen.<br/>_________________<br/><a class="postlink" href="http://www.ndshb.com" target="_blank">NDS Homebrew Roms &amp; Reviews</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#136277 - zaczac - Mon Jul 30, 2007 10:06 pm</h4>
    <div class="postbody"><span class="postbody">Well, it would therefore require something like 21 extra sprites for all the hearts on screen, and there is a 128 sprite limit (and id want bushes, monsters and other things on screen too)
<br/>
I tried palib fourums, but no one replies. :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#136306 - tepples - Tue Jul 31, 2007 3:15 am</h4>
    <div class="postbody"><span class="postbody">If you make 8x32 or 32x8 pixel "four empty hearts" and "four full hearts" sprite cels, you may be able to make the status bar with fewer sprites.
<br/>
<br/>
Or you could devote a background layer to the status bar.
<br/>
<br/>
If you can draw a mock-up of your desired screen layout, save it as a PNG, and upload it to some picture host, one of us might be able to figure out an efficient way to divide the graphics between background layers and sprites.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#136320 - zaczac - Tue Jul 31, 2007 8:37 am</h4>
    <div class="postbody"><span class="postbody">Thanks for the offer, but my idea isnt an exact copy of the heart system from zelda. What it is is a Sprite That Shows 10 empty 'Circles'. on frame 1. An Empty Circle appears in full, on frame 2...two circles appear full. This happens until the 10 empty circles are full..That saves 10 Sprites on one screen. Do you kinda get what im at here? Its more like "Alundras" Energy system really, but ididnt think people would recognize it. Anyway, i'd be glad for any information that you may have. I'll keep researching into it, but i'd really like to use as few sprites as possible.
<br/>
<br/>
Thanks ever so much for the input, i appriciate the kind offers.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#136333 - voteforpedro36 - Tue Jul 31, 2007 4:38 pm</h4>
    <div class="postbody"><span class="postbody">PA_SetSpriteAnim should do what you want, that way you could use it like:
<br/>
<br/>
if (Pad.Newpress.Right) PA_SetSpriteAnim (1,0,2);
<br/>
<br/>
Where 1 is the screen, 0 is the sprite number, and 2 would be the third animation.
<br/>
<br/>
See the PAlib examples in Sprites-&gt;Animations-&gt;Frames.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#136334 - zaczac - Tue Jul 31, 2007 5:20 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">A_SetSpriteAnim should do what you want, that way you could use it like:
<br/>
<br/>
if (Pad.Newpress.Right) PA_SetSpriteAnim (1,0,2);
<br/>
<br/>
Where 1 is the screen, 0 is the sprite number, and 2 would be the third animation.
<br/>
<br/>
See the PAlib examples in Sprites-&gt;Animations-&gt;Frames.</td> </tr></table><span class="postbody">
<br/>
<br/>
No offense, but im not completely stupid.
<br/>
<br/>
Setting the sprites anim like that would require something like a variable 'life'
<br/>
if(life == 1){
<br/>
Pa_setspriteanim(0,0,0)
<br/>
}
<br/>
if(life == 2){
<br/>
Pa_setspriteanim(0,1,1)
<br/>
}
<br/>
if(life == 3){
<br/>
Pa_setspriteanim(0,2,2)
<br/>
}
<br/>
<br/>
This would take forever, since the max life is a lot, I stated that i could do it in an easier way, but i was just asking for a more professional way of doing this. I supose i could use a switch statement (life) then case 0: etc etc but that still leaves streams of code. 
<br/>
<br/>
I think that maybe i'll have to make do with a slapdash life engine for now, and then come back to it later, i supose as long as it works, it will be alright.
<br/>
<br/>
Thanks for the help guys, i appriciate it. Im still annoyed that i don't think using something like 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
for i(Something something){
<br/>
Pa_SetspriteAnim(1,i,i)
<br/>
}</td> </tr></table><span class="postbody">
<br/>
Any Feedback if someone reckons that this would work? Im not too comfortable using expressions like these, confuse me a little. Maybe someone could reccomend a way / or code on how to use the above code correctly?
<br/>
<br/>
Thanks :D</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#136521 - jenswa - Thu Aug 02, 2007 3:17 pm</h4>
    <div class="postbody"><span class="postbody">Listen to what tepples says.
<br/>
<br/>
Just use the top part (8 or 16 pixels) of the background layer for your heart tiles. This way you get a space with different background heart tiles instead of sprites.
<br/>
<br/>
And in case of zelda like heart tiles, just draw one empty, one with a quarter, one with a half and one full heart.
<br/>
<br/>
And you need a little background code to show the right tiles, but that shouldn't be a problem. Just bind the hearts from empty to full with tilenumbers zero to three or one to four. Put them in a sequence in the right order, it makes things easier to code.<br/>_________________<br/>It seems this wasn't lost after all.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#136522 - phonymike - Thu Aug 02, 2007 3:58 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>zaczac wrote:</b></span></td> </tr> <tr> <td class="quote">Setting the sprites anim like that would require something like a variable 'life'
<br/>
if(life == 1){
<br/>
Pa_setspriteanim(0,0,0)
<br/>
}
<br/>
if(life == 2){
<br/>
Pa_setspriteanim(0,1,1)
<br/>
}
<br/>
if(life == 3){
<br/>
Pa_setspriteanim(0,2,2)
<br/>
}
<br/>
<br/>
This would take forever, since the max life is a lot</td> </tr></table><span class="postbody">
<br/>
<br/>
I've never used PA_LIB, but this will do the same thing:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">if(life &gt;0){
<br/>
 PA_setspriteanim(0, life-1, life-1);
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
easy huh.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#136528 - zaczac - Thu Aug 02, 2007 5:17 pm</h4>
    <div class="postbody"><span class="postbody">Well i tried what you said. Seems logical
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">//Pad Controls The Life
<br/>
if(Pad.Held.Down){
<br/>
PA_SetSpriteAnim(1, lifediamond -= 1, lifediamond -= 1);
<br/>
} </td> </tr></table><span class="postbody">
<br/>
<br/>
however, for SOME MAD reason.... the hud likes to fly about my screen!
<br/>
<br/>
EDIT
<br/>
I changed it a little.. 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">//Pad Controls The Life
<br/>
if((Pad.Newpress.Right)&amp;&amp;(lifediamond &gt;= 0)){
<br/>
PA_StartSpriteAnim(1, 0, lifediamond -= 1, lifediamond -= 1, 1);
<br/>
} //screen, frame start, frame en
<br/>
if((Pad.Newpress.Left)&amp;&amp;(lifediamond &lt;= 10)){
<br/>
PA_StartSpriteAnim(1, 0, lifediamond += 1, lifediamond += 1, 1);
<br/>
} </td> </tr></table><span class="postbody">
<br/>
<br/>
What this does is let you control the heart meter...but only for a short period and often gives garbage on the screen. Ill post back if i can get it sorted out.
<br/>
<br/>
Thanks a whole lot for the help 'phonymike', just the response i needed!
<br/>
<br/>
<br/>
EDIT
<br/>
<br/>
I did it!
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">if((Pad.Newpress.Left)&amp;&amp;(lifediamond &gt;= 0)){
<br/>
PA_SetSpriteAnim(1, 0, lifediamond -= 1);
<br/>
//PA_StartSpriteAnim(1, 0, lifediamond -= 1, lifediamond -= 0, 1);
<br/>
}//screen, frame start, frame en
<br/>
if((Pad.Newpress.Right)&amp;&amp;(lifediamond &lt;= 10)){
<br/>
PA_SetSpriteAnim(1, 0, lifediamond += 1);
<br/>
} 
<br/>
<br/>
if(lifediamond == 255){
<br/>
lifediamond = 0;
<br/>
PA_SetSpriteAnim(1, 0, 0);
<br/>
}
<br/>
<br/>
if(lifediamond == 11){
<br/>
lifediamond = 10;
<br/>
PA_SetSpriteAnim(1, 0, 10);
<br/>
}
<br/>
<br/>
PA_OutputText(1, 2, 18, "diamondlife : %d   ", lifediamond); //debug</td> </tr></table><span class="postbody">
<br/>
<br/>
Hurray! It works like a charm, quick...easy heart engine using only one sprite!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#136566 - phonymike - Thu Aug 02, 2007 9:46 pm</h4>
    <div class="postbody"><span class="postbody">*smacks forehead
<br/>
<br/>
if you notice, I put "life - 1" not "life -= 1" as there's a BIG difference. but if it works for you then it's all good!
<br/>
<br/>
if you are gonna repeat the exact same thing many times, you'd be surprised how many times you can use the counting value in a loop. the code below isn't for gba stuff, but the heart of it draws 8 pixels in a row, and does that 8 times to make a tile, then 42 times to make the whole image. like 'tile_number' for instance. when it loops once, the next place to draw a tile is 40 bytes higher. so the first loop it'll write to 0x00. next time it loops it'll write to 0x40. next time it'll write to 0x80 and so on. from the simple counting value of 0, 1, 2 it also controls where data is written. it's horribly ugly :)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code"> for(tile_number=0;tile_number&lt;42;tile_number++){
<br/>
  for(tile_column=0;tile_column&lt;8;tile_column++){
<br/>
   for(tile_row=0;tile_row&lt;8;tile_row++){
<br/>
    player_image_snes[0x00 + (tile_column * 2) + (tile_number * 40)] |= ((player_image_bitmap[48*56 -48 + tile_row - (tile_column * 48) - (tile_number * 48)] &amp; 1) &gt;&gt; 0) &lt;&lt; (7 - tile_row);
<br/>
    player_image_snes[0x01 + (tile_column * 2) + (tile_number * 40)] |= ((player_image_bitmap[48*56 -48 + tile_row - (tile_column * 48) - (tile_number * 48)] &amp; 2) &gt;&gt; 1) &lt;&lt; (7 - tile_row);
<br/>
    player_image_snes[0x10 + (tile_column * 2) + (tile_number * 40)] |= ((player_image_bitmap[48*56 -48 + tile_row - (tile_column * 48) - (tile_number * 48)] &amp; 4) &gt;&gt; 2) &lt;&lt; (7 - tile_row);
<br/>
    player_image_snes[0x11 + (tile_column * 2) + (tile_number * 40)] |= ((player_image_bitmap[48*56 -48 + tile_row - (tile_column * 48) - (tile_number * 48)] &amp; 8) &gt;&gt; 3) &lt;&lt; (7 - tile_row);
<br/>
    player_image_snes[0x20 + tile_column       + (tile_number * 40)] |= ((player_image_bitmap[48*56 -48 + tile_row - (tile_column * 48) - (tile_number * 48)] &amp;16) &gt;&gt; 4) &lt;&lt; (7 - tile_row);
<br/>
   }
<br/>
  }
<br/>
 }</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#136582 - Cearn - Thu Aug 02, 2007 11:30 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>phonymike wrote:</b></span></td> </tr> <tr> <td class="quote">... 
<br/>
it's horribly ugly :)
<br/>
</td> </tr></table><span class="postbody">
<br/>
But it doesn't need to be. 
<br/>
<br/>
If you're using an expression multiple times, it's often more useful to put them in temporary variables beforehand instead of piling on more code. As far as I can tell, this does the same thing as your triple loop:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">// NOTES
<br/>
// * I'm assuming that "0x20 + tile_column" should have 
<br/>
//   had a *2 like the rest. If not, that complicates matters 
<br/>
//   a little.
<br/>
// * I can't tell the pointer type, replace PTR with what it should be.
<br/>
<br/>
int ii, tx, ty;
<br/>
PTR *dst, *dstBase= player_image_snes;
<br/>
PTR *src, *srcBase= &amp;player_image_bitmap[48*56-48];
<br/>
u32 raw;
<br/>
<br/>
for(ii=0; ii&lt;42; ii++)          // tile_number loop
<br/>
{
<br/>
    src= &amp;srcBase[ii*48];
<br/>
    dst= &amp;dstBase[ii*40];
<br/>
<br/>
    for(ty=0; ty&lt;8; ty++)       // tile_column loop
<br/>
    {
<br/>
        for(tx=0; tx&lt;8; tx++)   // tile_row loop
<br/>
        {
<br/>
            raw= src[tx] &lt;&lt; (7-tx);
<br/>
            dst[0x00] |= (raw   ) &amp; 1;
<br/>
            dst[0x01] |= (raw&gt;&gt;1) &amp; 1;
<br/>
            dst[0x10] |= (raw&gt;&gt;2) &amp; 1;
<br/>
            dst[0x11] |= (raw&gt;&gt;3) &amp; 1;
<br/>
            dst[0x20] |= (raw&gt;&gt;4) &amp; 1;
<br/>
        }
<br/>
        src += 48;
<br/>
        dst += 2;
<br/>
    }
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Not only can you tell what actually happens now (though opinions on that may vary &gt;_&gt;), it's probably faster as well. Compilers are capable of doing some <a class="postlink" href="http://en.wikipedia.org/wiki/Strength_reduction" target="_blank">strength reduction</a> and <a class="postlink" href="http://en.wikipedia.org/wiki/Loop-invariant_code_motion" target="_blank">moving invariant code outside of the loop</a>, if code gets that complex, it might just give up and recalculate everything every single time. 
<br/>
<br/>
Global variables in particular have the habit of being reloaded; if used more than once (ok, maybe twice), assign globals to a local variable. And, of course, int/u32 for variables, not s8/u8 or u16/u32.
<br/>
<br/>
<span style="font-size: 9px; line-height: normal"><span style="font-style: italic">ETA: it's <span style="font-weight: bold">&amp;</span>srcBase[...] not jimply srcBase[...], silly</span></span></span><span class="gensmall"><br/><br/>Last edited by Cearn on Fri Aug 03, 2007 8:41 am; edited 2 times in total</span></div>    
</div>
<div class="post">
    <h4>#136599 - phonymike - Fri Aug 03, 2007 3:01 am</h4>
    <div class="postbody"><span class="postbody">yeah that looks a hell of a lot better! the code went together so quickly and I just want it to work. plus it's only gonna be ran a few times ever on a pc. it converts a bitmap into a snes format. wish I would have seen your post earlier cause my stuff would be a little neater. your code seems to be a little off, I don't blame ya cause of the mess you've looked at. it basically reads a .bmp (which is stored flipped vertically) and breaks it down into tiles. but, the bitmap stores all five bits like any other system, 000ABCDE. the 5bpp snes stores the bits in five different bytes. and yes that last byte is unaligned to the previous 4. the snes would store it as E0000000 D0000000 C0000000 B0000000 A0000000, addresses 0x00, 0x01, 0x10, 0x11, 0x20. the first four bytes are in groups of two, word aligned, while the last byte is byte aligned. silly but it saves space.
<br/>
<br/>
if you're curious what it all does:
<br/>
<a href="http://img340.imageshack.us/img340/8783/jam0003tr4.png">[Images not permitted - Click here to view it]</a>
<br/>
<br/>
I'm so tempted to rewrite it but seriously there's no point!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#138025 - elyk1212 - Sat Aug 18, 2007 7:31 pm</h4>
    <div class="postbody"><span class="postbody">HAHA HA!   Dude, that's great.  [picture]
<br/>
<br/>
How did you know where toss your data to change the NBA Jam ROM?  Did you just automatically know off hand where it was referencing data?</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
