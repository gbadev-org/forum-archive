<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>numeric value to memory location... what truly happen? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Coding > numeric value to memory location... what truly happen?</h2>
<div id="posts">
<div class="post">
    <h4>#89184 - king501 - Fri Jun 23, 2006 1:27 pm</h4>
    <div class="postbody"><span class="postbody">I would like to understand what?s actually happening to a line like this one.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">*(unsigned int*)0x04000000 = 0x0403;</td> </tr></table><span class="postbody">
<br/>
<br/>
Or a line like;
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">((unsigned short*) 0x6000000)[5678] = 0xFFFF;</td> </tr></table><span class="postbody">
<br/>
<br/>
So far I know that it?s a a poiter to a memory location, and a numeric value is set in that memory location? 
<br/>
<br/>
I know that 0x3 is for mode 3 and 0x400 is for bg2. 
<br/>
<br/>
I know there?s a bit layout for REG_DISPCNT
<br/>
<br/>
But I don?t understand how 0x403 is combined with 0x4000000? 
<br/>
<br/>
It?s the same with: 
<br/>
<br/>
((unsigned short*) 0x6000000)[5678] = 0xFFFF;
<br/>
<br/>
I know that 0x6000000 is a memory array for the screen display, and I know that 0xFFFF is a color (white in this case), but I don?t know the mechanic that make them combined together? 
<br/>
<br/>
Tonc and Jharbour tutorial are very vague on this subject, or I missed something. 
<br/>
<br/>
Someone can help me please.
<br/>
<br/>
Thank you (sorry if I'm a slow learner, but I'm really trying to understand this proccess)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#89185 - tepples - Fri Jun 23, 2006 1:33 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>king501 wrote:</b></span></td> </tr> <tr> <td class="quote">I would like to understand what?s actually happening to a line like this one.
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">*(unsigned int*)0x04000000 = 0x0403;</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
The address bus (a set of signal lines in the CPU) is set to 0x04000000, the data bus (another set of signal lines) is set to 0x0403, and the control lines are set up for "memory data write". The GBA's memory controller interprets this combination of signal states as a write to the given I/O register.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">But I don?t understand how 0x403 is combined with 0x4000000? </td> </tr></table><span class="postbody">
<br/>
Why do you feel the need to "understand" this? Do you need an electrical engineer's perspective on how memory controllers and memory-mapped I/O work?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Tonc and Jharbour tutorial are very vague on this subject, or I missed something. </td> </tr></table><span class="postbody">
<br/>
TONC and the like are geared for software developers, who don't need to understand how memory controllers work. Software developers can just write the data to the address and assume that the rest is "magic".<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#89188 - king501 - Fri Jun 23, 2006 1:55 pm</h4>
    <div class="postbody"><span class="postbody">I?m sorry, maybe my question wasn?t correctly asked. I?m trying to figure out how bit layouts are working.
<br/>
<br/>
For instance, REG_DISPCNT (0400:0000h ) has a bit layout.
<br/>
<br/>
Bit A is supposed to be for BG2. 
<br/>
Mode 3 is supposed to be somewhere between 0-2
<br/>
<br/>
So how 0x400 and 0x3 are associated to this bit layout?
<br/>
<br/>
I just want to know how stuff are controlled if I want to control stuff on my own. Let's say I know that bg1 is at bit position 9 from REG_DISPCNT, so how do I know how to activate it?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#89189 - tepples - Fri Jun 23, 2006 2:02 pm</h4>
    <div class="postbody"><span class="postbody">May or may not help:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">Bit0 = 1 &lt;&lt;  0 == 0x0001
<br/>
Bit1 = 1 &lt;&lt;  1 == 0x0002
<br/>
Bit2 = 1 &lt;&lt;  2 == 0x0004
<br/>
Bit3 = 1 &lt;&lt;  3 == 0x0008
<br/>
Bit4 = 1 &lt;&lt;  4 == 0x0010
<br/>
Bit5 = 1 &lt;&lt;  5 == 0x0020
<br/>
Bit6 = 1 &lt;&lt;  6 == 0x0040
<br/>
Bit7 = 1 &lt;&lt;  7 == 0x0080
<br/>
Bit8 = 1 &lt;&lt;  8 == 0x0100
<br/>
Bit9 = 1 &lt;&lt;  9 == 0x0200
<br/>
BitA = 1 &lt;&lt; 10 == 0x0400
<br/>
BitB = 1 &lt;&lt; 11 == 0x0800
<br/>
BitC = 1 &lt;&lt; 12 == 0x1000
<br/>
BitD = 1 &lt;&lt; 13 == 0x2000
<br/>
BitE = 1 &lt;&lt; 14 == 0x4000
<br/>
BitF = 1 &lt;&lt; 15 == 0x8000
<br/>
</td> </tr></table><span class="postbody">
<br/>
The &lt;&lt; operator performs a bit shift, and if you can't guess what a "bit shift" is from the table, you need to go look up more about <a class="postlink" href="http://en.wikipedia.org/wiki/Binary_numeral_system" target="_blank">binary</a> and <a class="postlink" href="http://en.wikipedia.org/wiki/Hexadecimal" target="_blank">hexadecimal</a> numerals systems.
<br/>
<br/>
Generally, people don't use addresses directly; they use constants and macros.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define DISPCNT (*(volatile u16 *)0x04000000)
<br/>
#define DISP_MODE(x) x
<br/>
#define BG2_ON 0x0400
<br/>
<br/>
DISPCNT = DISP_MODE(3) | BG2_ON;
<br/>
// expands inside the preprocessor to
<br/>
(*(volatile u16 *)0x04000000) = 3 | 0x0400;
<br/>
// which the compiler simplifies to
<br/>
(*(volatile u16 *)0x04000000) = 0x0403;
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#89191 - king501 - Fri Jun 23, 2006 2:13 pm</h4>
    <div class="postbody"><span class="postbody">thank you very much, now I should be on the right track.
<br/>
<br/>
of course I'm planning to use macros, just wanted to understand what I was doing.
<br/>
<br/>
most people simply content to copy/paste, I want to do better than that.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#90023 - king501 - Tue Jun 27, 2006 10:54 pm</h4>
    <div class="postbody"><span class="postbody">I'm reading J Harbour tutorial too, and I was trying to figure out why he was using this specific number 57984;
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">DMAFastCopy((void*)background_Tiles, (void*)CHAR_BLOCK(0), [color=red]57984/4[/color], DMA_32NOW);</td> </tr></table><span class="postbody">
<br/>
<br/>
I know there's 4 char base, but I can't tell what the 57984 stand for...
<br/>
<br/>
The only thing that popped in my mind was: 16364 bytes (memory of one Char_Base) * 4, but the result is 65536.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#90052 - shen3 - Wed Jun 28, 2006 2:50 am</h4>
    <div class="postbody"><span class="postbody">hi;
<br/>
<br/>
That parameter of DMAFastCopy is the size.
<br/>
<br/>
he is loading some background tiles into memory, and the size of those tiles is 57984 bytes.
<br/>
<br/>
Becasue he is using DMA to copy 32 bytes at a time, he needs to move 57984/4 chunks of 32 bytes.
<br/>
<br/>
Shen</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#90057 - wintermute - Wed Jun 28, 2006 3:10 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>king501 wrote:</b></span></td> </tr> <tr> <td class="quote">I'm reading J Harbour tutorial too, and I was trying to figure out why he was using this specific number 57984;
<br/>
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">DMAFastCopy((void*)background_Tiles, (void*)CHAR_BLOCK(0), [color=red]57984/4[/color], DMA_32NOW);</td> </tr></table><span class="postbody">
<br/>
<br/>
I know there's 4 char base, but I can't tell what the 57984 stand for...
<br/>
<br/>
The only thing that popped in my mind was: 16364 bytes (memory of one Char_Base) * 4, but the result is 65536.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
This is just one of many reasons why you shouldn't read that %$&amp;?%% J Harbour book. Throw it away and read Tonc instead.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123211 - king501 - Mon Mar 26, 2007 7:13 am</h4>
    <div class="postbody"><span class="postbody">It has been a long time since I played with GBA hardware due to my dayjob... I forgot a lot of stuff since then :(
<br/>
<br/>
So I'm making tons of tests to understand fundamental stuff with memory and data type.
<br/>
<br/>
Question: can VRAM deal properly with 8bit data type under mode0? During my tests it worked fine with U32 and u16, but not correctly with u8.
<br/>
<br/>
here's a minor example;
<br/>
<br/>
I used mode0, 4bpp tiles, and created some colors.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
((u32*)(MEM_VRAM + 0x0000))[8] = 0x1F1F1F1F; 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
work fine, draw the top row of a tile with two colors in the following pattern (RED, BLUE, RED, BLUE, RED, BLUE, RED, BLUE).
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
((u16*)(MEM_VRAM + 0x0000))[16] = 0x1F1F; 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
work fine, draw haft of the top row of a tile with two colors in the following pattern. (RED, BLUE, RED, BLUE)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">((u8*)(MEM_VRAM + 0x0000))[32] = 0x1F;</td> </tr></table><span class="postbody">
<br/>
doesn't work nicely, pixels are duplicated. (RED, RED, BLUE, BLUE) I expected only two pixels in the following pattern (RED, BLUE)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123218 - sgeos - Mon Mar 26, 2007 8:47 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>king501 wrote:</b></span></td> </tr> <tr> <td class="quote">Question: can VRAM deal properly with 8bit data type under mode0? During my tests it worked fine with U32 and u16, but not correctly with u8.</td> </tr></table><span class="postbody">
<br/>
I believe that this is a hardware limitation.  You might want to double check with gbatek.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123224 - HyperHacker - Mon Mar 26, 2007 9:04 am</h4>
    <div class="postbody"><span class="postbody">I know DS VRAM doesn't accept 8-bit writes, so I doubt GBA VRAM does either.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123230 - sgeos - Mon Mar 26, 2007 10:25 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">I know DS VRAM doesn't accept 8-bit writes, so I doubt GBA VRAM does either.</td> </tr></table><span class="postbody">
<br/>
The DS has improved features.  If it can't handle 8-bit writes, then the GBA certainly can't.  Hardware limitation; you will have to combine two pixels into one 16bit write by either using 16bit blitting routines or a read, mask, write routine.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
