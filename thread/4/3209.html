<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Fading Problem with REG_BLDMOD Register - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > Fading Problem with REG_BLDMOD Register</h2>
<div id="posts">
<div class="post">
    <h4>#19019 - Pinski - Sat Apr 10, 2004 7:44 am</h4>
    <div class="postbody"><span class="postbody">Now I hate to enter the community asking a question that has been answered many times before.  However, I've spent a whole day trying to get this to work, searched this forum and the internet many times and read all the relevant posts, and read the Day 4 tutorial on The Pern Project website several times and I can not get fading to work.  I've tried all of the versions of the fading code I have found on this site and others and haven't gotten it to work so I figured maybe someone would help me out.
<br/>
<br/>
I just want to have BG0 in Mode 0 fade out to black, so I can then load a new screen in BG0, and then fade in to the new screen.  
<br/>
<br/>
I've been trying to use REG_BLDMOD and REG_COLEY to do this, however I can't get them to work.  I could post some code, however I've attempted about five different ways of doing this and none of them have worked.  I haven't even tried fading in yet because I can't get the fade out to work, I leave the registers as they are yet the screen is not faded out.  I see no difference in the screen at all, it doesn't darken or anything.  This is the first thing I have done on the GBA where I am completely lost and can not get anything to work at all.  If anyone could post some full code that just fades BG0 in Mode 0 to black I'd greatly appreciate it.  Please help!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19020 - sgeos - Sat Apr 10, 2004 8:05 am</h4>
    <div class="postbody"><span class="postbody">You could do a palette fade effect instead.  I'd store a "master" palette in WRAM and have a function copy a darker and darker version of the "master" palette into VRAM each frame.
<br/>
<br/>
When the screen is all black, you are free to chage the screen data and the master palette and the execute the fade in effect- starting from black, copy a lighter and lighter version of the palette in each frame until you have the proper palette in RAM.
<br/>
<br/>
If you don't want a copy of your palette in WRAM all the time, you could copy the palette from VRAM to a local array at the start of a fade out routine.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19025 - delbogun - Sat Apr 10, 2004 1:09 pm</h4>
    <div class="postbody"><span class="postbody">I like the palette fade better than the hardware fade because with palette fade you can specify exactly which palettes you want to fade. But which fading technique is actually better to use if you want to consume less power and maybe do the fading faster?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19028 - poslundc - Sat Apr 10, 2004 1:23 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>delbogun wrote:</b></span></td> </tr> <tr> <td class="quote">I like the palette fade better than the hardware fade because with palette fade you can specify exactly which palettes you want to fade. But which fading technique is actually better to use if you want to consume less power and maybe do the fading faster?</td> </tr></table><span class="postbody">
<br/>
<br/>
Hardware fading is much less CPU-intensive since it's done by the graphics coprocessor.
<br/>
<br/>
But, you've only got one alpha-effects register, so if you'd like to use it for other stuff then palette fading is the way to go.
<br/>
<br/>
If not, it doesn't hurt to use the effects register for it.
<br/>
<br/>
Pinski: People have been posting code to <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=3189" target="_blank">this thread</a>. As for your stuff, you're going to have to post some code if you expect us to tell you what's wrong with it. 
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19055 - Pinski - Sat Apr 10, 2004 8:33 pm</h4>
    <div class="postbody"><span class="postbody">As I said, I've read all those threads, including the one you linked to poslundc, and tried every solution in them.  However, I know I'm a newb and I hate when people claim to do that stuff in my other community and they haven't.  I want to use the built in fader because it's quicker and I'm fading sprites too.  I know I didn't mention that in my original post because I thought I could figure that part out myself.  However after the first post I realized it was important and I shouldn't have left it out.
<br/>
<br/>
Here's one of my solutions of code:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">REG_BLDMOD = BIT00 | BIT04 | BIT06 | BIT07 | BIT13;
<br/>
for( loop = 0; loop &lt; 17; ++loop ) 
<br/>
   {
<br/>
   REG_COLEY = loop; 
<br/>
   UpdateBackground(&amp;bg0); //makes any changes to the bg struct get copied in to the apropriate registers
<br/>
   WaitForVsync();
<br/>
   }</td> </tr></table><span class="postbody">
<br/>
<br/>
I can post other ways I've tried, but this one seems like it's the closest to being correct.  I just want BG0 and sprites to fade to black in Mode 0.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19062 - poslundc - Sat Apr 10, 2004 9:04 pm</h4>
    <div class="postbody"><span class="postbody">Well, first of all, you don't need to set bit 13 in REG_BLDMOD, although I don't think that would affect your results.
<br/>
<br/>
Second of all, realize that your effect is lasting approximately 0.27 seconds before fading entirely to black, so it's entirely possible that it's happening faster than you can really notice.
<br/>
<br/>
Third of all, it is unclear what happens once you exit your for loop. What happens next? If that's the end of your program, it'll reset and keep resetting.
<br/>
<br/>
Fourth of all, it would be much more helpful if you told us what happens when you try running the code. If none of the above help, I'd advise being more specific in your query.
<br/>
<br/>
Good luck,
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19076 - yaustar - Sat Apr 10, 2004 10:40 pm</h4>
    <div class="postbody"><span class="postbody">my post in poslundc linked thread has a snipnet of code for both fading in and out which is taken out of our (me and a friend) demo. If it is not working for you then there is something else wrong within your code. If in doubt, post the entire main() procedure.<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19078 - Pinski - Sat Apr 10, 2004 10:47 pm</h4>
    <div class="postbody"><span class="postbody">I know I'm a newb and this is a commonly asked question.  I'm sorry if I'm not being specific enough, but this seems to be a simple problem and I thought maybe just something was faulty in my code.  I'll answer your suggestions as you posed them.
<br/>
<br/>
1) Turned off Bit 13 and it didn't effect anything.
<br/>
<br/>
2) I know my effect is lasting only for a short time.  I put something in the code before like 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code"> for(x=0; x&lt;30000; x++)
<br/>
      {}</td> </tr></table><span class="postbody">
<br/>
for a delay, but it doesn't matter how long the effect is.  It still does nothing.
<br/>
<br/>
3) This happens within my getinput function.  When the user presses up on the directional pad and goes to a new screen this code occurs and then another screen is loaded in the background.  Here's the code:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
if(!(*KEYS &amp; KEY_UP))
<br/>
   {
<br/>
       if(screenY-2 &gt;= 0)
<br/>
      {
<br/>
      //do some move sprite stuff omitted for length
<br/>
      }
<br/>
      else if(spriteY-2 &gt;= 0)
<br/>
      {
<br/>
      
<br/>
         if(spriteY-2 &lt; 2 &amp;&amp; currentMap &gt; 2)
<br/>
            {   
<br/>
            REG_BLDMOD = BIT00 | BIT04 | BIT06 | BIT07;
<br/>
            for( loop = 0; loop &lt; 17; ++loop ) 
<br/>
               {
<br/>
               REG_COLEY = loop; 
<br/>
               UpdateBackground(&amp;bg0); 
<br/>
               for(x=0; x&lt;30000; x++)
<br/>
                  {}
<br/>
               WaitForVsync();
<br/>
               }
<br/>
         
<br/>
            if(currentMap==3)//currentMap is a variable that tells which Map the user is on
<br/>
               {
<br/>
               for(loop = 0; loop &lt; 32*32; loop++) //32x32 tiles 
<br/>
                  bg0.mapData[loop] = UpLeftScreen[loop];
<br/>
               CreateCMap(UpLeftScreen); //creates the collision map for the new screen
<br/>
               if(NPC_Active==1)//check for computer sprites being active
<br/>
                  {
<br/>
                  sprites[1].attribute2 |= BIT10; //turns off computer sprites displayed
<br/>
                  NPC_Active=0; //sets computer sprites to inactive
<br/>
                  }
<br/>
               }
<br/>
        //check for other currentMap states
<br/>
        //change sprite, currentMap, and screen scroll variables and then return to the main game loop
<br/>
        }
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
4) I thought I mentioned what happens when I run this code.  Absolutely nothing happens when this code is run, which is why I'm at a loss of what to do.  Normally when the code is run without this, the sprite goes to the border of the screen, then the screen jumps to the top of the next screen as it loads, then the sprite appears in it's proper place at the bottom of the new screen.  This all happens within a span of less than a second, however it's noticable to the naked eye.
<br/>
<br/>
With the code in place (with the delay timer in effect) the sprite moves to the top of the old screen, sits in place as the timer ticks down (all the while nothing happens on the screen, no fading in either direction of background or sprites, nothing), then the screen jumps to the top of the next screen as it loads, then the sprite appears in it's proper place at the bottom of the new screen.  The only difference with the code and without the code is the length of time it takes.  
<br/>
<br/>
I'm running the emulation on VisualBoy and have opened up the Memory and I/O viewers and have watched the registers change correctly.  I have turned down my monitor refresh rate to 60Hz in order to see if it was a refresh problem, that didn't work.  I have even loaded this onto the GBA to see if it was an emulation problem as talked about in other posts, and the effect doesn't work on the GBA either.
<br/>
<br/>
I'm totally at a loss of what to do next.  The registers are changing in memory but no effect takes place on the screen.
<br/>
<br/>
If you need more details or more code I'd be happy to supply them.  Thank you for your patients and your help.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19081 - Pinski - Sat Apr 10, 2004 11:05 pm</h4>
    <div class="postbody"><span class="postbody">yaustar: I tried your code again and changed it to be my specific functions and to eliminate the macros:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">for(x = 0; x &lt; 480; x++) //fade to black 
<br/>
        { 
<br/>
            WaitForVsync(); 
<br/>
            //if(!(*KEYS &amp; KEY_A)) 
<br/>
            //{break;} 
<br/>
            //set the transperancy of the first layer 
<br/>
            REG_BLDMOD = (0x1 | 0 | 0xC0);
<br/>
            //source BG0, target backdrop, mode fade to black 
<br/>
            REG_COLEY = x &gt;&gt; 4; 
<br/>
        } </td> </tr></table><span class="postbody">
<br/>
<br/>
Nothing happened.  It worked the same as my code posted, however the delay was shorter.
<br/>
<br/>
My main function is kind of long, here's my declration of BG0 and of my main game function:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
int main(void)
<br/>
{
<br/>
   int index = 0;  //some looping variables for loops :)
<br/>
   int move = 0;
<br/>
   int NPC_Check = 0;
<br/>
   u16 loop;
<br/>
   u16* temp;
<br/>
<br/>
   SetMode(MODE_0 | OBJ_ENABLE | OBJ_MAP_1D | WIN1_ENABLE | BG1_ENABLE); //set mode 0
<br/>
<br/>
//omitted for length declaration of BG1 which is a background that is only displayed in a window for text purposes, window is always off unless talking to a computer controlled sprite
<br/>
//omitted for length declaration of sprite[0] and sprite [1], sprite [0] is the player's sprite, sprite[1] is a computer controlled sprite
<br/>
<br/>
   //Let us set up the backgroud two structure and enable the background
<br/>
<br/>
   bg0.number = 0;            //background number 0-3
<br/>
   bg0.charBaseBlock = 0;
<br/>
   bg0.screenBaseBlock = 31;
<br/>
   bg0.colorMode = BG_COLOR_256;
<br/>
   bg0.size = TEXTBG_SIZE_256x256;
<br/>
   bg0.mosiac = 0;
<br/>
   bg0.x_scroll = screenX;
<br/>
   bg0.y_scroll = screenY;
<br/>
<br/>
   //This call enables the background with the suplied attributes and when it returns
<br/>
   //bg0.mapdata and tiledata will be valid pointers to the correct place
<br/>
   //for the map and tile data in VRAM
<br/>
   
<br/>
   EnableBackground(&amp;bg0);
<br/>
<br/>
<br/>
   //Now let us copy in the background tile palette
<br/>
   for(loop = 0; loop &lt; 256; loop++)
<br/>
      BGPaletteMem[loop] = MapTilesPalette[loop];
<br/>
<br/>
   //now for the actual tile graphics created by pcx2sprite 
<br/>
   for(loop = 0; loop &lt; (MapTiles_WIDTH*MapTiles_HEIGHT)/2 ; loop++)
<br/>
      bg0.tileData[loop] = MapTilesData[loop];
<br/>
<br/>
   for(loop = 0; loop &lt; 32*32; loop++) //32x32 tiles
<br/>
      bg0.mapData[loop] = LeftScreen[loop];
<br/>
   //Set current character position
<br/>
   charX = spriteX + screenX;
<br/>
   charY = spriteY + screenY;
<br/>
<br/>
   char2X = sprite2X + screen2X;
<br/>
   char2Y = sprite2Y + screen2Y;
<br/>
<br/>
   CreateCMap(LeftScreen);
<br/>
<br/>
   while(1) //main game loop
<br/>
   {
<br/>
      GetInput();    //get input changes the x and y based on input
<br/>
<br/>
      Lower_Left_NPC = (char2X/8)+(((char2Y+23)/8)+1)*32;
<br/>
      Lower_Right_NPC = ((char2X+15)/8)+(((char2Y+23)/8)+1)*32;
<br/>
      Upper_Left_NPC = (char2X/8)+(((char2Y+15)/8)+1)*32;
<br/>
      Upper_Right_NPC = ((char2X+15)/8)+(((char2Y+15)/8)+1)*32;
<br/>
   
<br/>
      Lower_Left = (charX/8)+(((charY+23)/8)+1)*32;
<br/>
      Lower_Right = ((charX+15)/8)+(((charY+23)/8)+1)*32;
<br/>
      Upper_Left = (charX/8)+(((charY+15)/8)+1)*32;
<br/>
      Upper_Right = ((charX+15)/8)+(((charY+15)/8)+1)*32;
<br/>
<br/>
      SquareCollision();  //detects collisions with background
<br/>
      MoveSprite(&amp;sprites[0],spriteX,spriteY); //changes sprite atributes based on new x,y
<br/>
      MoveSprite(&amp;sprites[1],sprite2X,sprite2Y);
<br/>
<br/>
      if(NPC_Check&gt;=150 &amp;&amp; NPC_Active==1)
<br/>
         {
<br/>
         move=rand()%4;
<br/>
         if(move==0)
<br/>
            {
<br/>
            sprite2X += 8;
<br/>
            char2X += 8;
<br/>
            }            
<br/>
         else if(move==1)
<br/>
            {
<br/>
            sprite2X -= 8;
<br/>
            char2X -= 8;
<br/>
            }
<br/>
         else if(move==2)
<br/>
            {
<br/>
            sprite2Y += 8;
<br/>
            char2Y += 8;
<br/>
            }
<br/>
         else if(move==3)
<br/>
            {
<br/>
            sprite2Y -= 8;   
<br/>
            char2Y -= 8;
<br/>
            }
<br/>
         NPC_Collision();   
<br/>
         MoveSprite(&amp;sprites[1],sprite2X,sprite2Y);
<br/>
         NPC_Check=0;
<br/>
         }
<br/>
      else
<br/>
         NPC_Check++;
<br/>
   
<br/>
      UpdateBackground(&amp;bg0); //makes any changes to the bg struct get copied into the apropriate registers
<br/>
      WaitForVsync();         //waits for the screen to stop drawing
<br/>
      CopyOAM();            //Copies our sprite array into OAM.
<br/>
   }
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
I hope I'm not overloading you guys with too much.  I was trying to keep the code posts simple, however it doesn't seem to be going to well that way.  Most of this stuff is code I learned from the Pern Project.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19082 - poslundc - Sat Apr 10, 2004 11:21 pm</h4>
    <div class="postbody"><span class="postbody">I couldn't tell where, in your main loop, the fading code gets executed.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19085 - Cearn - Sat Apr 10, 2004 11:44 pm</h4>
    <div class="postbody"><span class="postbody">I had a similar problem where I could see the registers change, but nothing happened.
<br/>
In the VBA menu, under Options/Video there is an option named "Disable SFX". If this is checked, mosaic/transparency and windowing will be disabled. Took me a while to figure that one out.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19087 - yaustar - Sat Apr 10, 2004 11:48 pm</h4>
    <div class="postbody"><span class="postbody">It be in GetInput then this code executes:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">if(!(*KEYS &amp; KEY_UP))
<br/>
   {
<br/>
       if(screenY-2 &gt;= 0)
<br/>
      {
<br/>
      //do some move sprite stuff omitted for length
<br/>
      }
<br/>
      else if(spriteY-2 &gt;= 0)
<br/>
      {
<br/>
      
<br/>
         if(spriteY-2 &lt; 2 &amp;&amp; currentMap &gt; 2)
<br/>
            {   
<br/>
            REG_BLDMOD = BIT00 | BIT04 | BIT06 | BIT07;
<br/>
            for( loop = 0; loop &lt; 17; ++loop )
<br/>
               {
<br/>
               REG_COLEY = loop;
<br/>
               UpdateBackground(&amp;bg0);
<br/>
               for(x=0; x&lt;30000; x++)
<br/>
                  {}
<br/>
               WaitForVsync();
<br/>
               }
<br/>
         
<br/>
            if(currentMap==3)//currentMap is a variable that tells which Map the user is on
<br/>
               {
<br/>
               for(loop = 0; loop &lt; 32*32; loop++) //32x32 tiles
<br/>
                  bg0.mapData[loop] = UpLeftScreen[loop];
<br/>
               CreateCMap(UpLeftScreen); //creates the collision map for the new screen
<br/>
               if(NPC_Active==1)//check for computer sprites being active
<br/>
                  {
<br/>
                  sprites[1].attribute2 |= BIT10; //turns off computer sprites displayed
<br/>
                  NPC_Active=0; //sets computer sprites to inactive
<br/>
                  }
<br/>
               }
<br/>
        //check for other currentMap states
<br/>
        //change sprite, currentMap, and screen scroll variables and then return to the main game loop
<br/>
        } </td> </tr></table><span class="postbody"><br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19088 - poslundc - Sun Apr 11, 2004 12:11 am</h4>
    <div class="postbody"><span class="postbody">If it's not what Cearn pointed out about the settings in VBA, I would recommend testing it without all of the conditional statements (just replace them with "if (1)" and comment out the current conditions) because those could easily be your problem.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19094 - Pinski - Sun Apr 11, 2004 2:07 am</h4>
    <div class="postbody"><span class="postbody">I checked the "Disable SFX" option and it was turned off.  I didn't think this would be the problem because I've loaded both of these examples up on the GBA and they didn't run either.
<br/>
<br/>
I tried both my original implementation and the one I posted of yaustar's modified code with the conditionals changed just like poslundc stated, however that didn't change anything either.  The conditionals are just a big else if statement to check which screen you are currently in so it can adjust the next screen accordingly.
<br/>
<br/>
I'm completly stumped and have no idea where to go next.
<br/>
<br/>
Thanks for all the help and patients any way.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19096 - bats - Sun Apr 11, 2004 4:36 am</h4>
    <div class="postbody"><span class="postbody">Just some suggestions:
<br/>
<br/>
Check in VBA to see if the Registers are being changed (under I/O viewer).
<br/>
Do some tests to see that the code is being executed (using debug printf, or just change a palette entry that you know will be observable)
<br/>
Check your REG_BLDMOD and REG_COLEY definitions (or whatever you call them) they shoud be something like:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define REG_BLDMOD *(vu16 *)(0x04000050)
<br/>
#define REG_COLEY *(vu16 *)(0x04000054)
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19101 - Pinski - Sun Apr 11, 2004 6:57 am</h4>
    <div class="postbody"><span class="postbody">Both registers are defined correctly and the changes in the registers occur when the code is run in both Memory Viewer and I/O viewer as I've said before.  Thanks any way.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19102 - Pinski - Sun Apr 11, 2004 8:39 am</h4>
    <div class="postbody"><span class="postbody">I got it to work in a simpler demo.  Now I just have to translate it over.  Cross your fingers.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19103 - Pinski - Sun Apr 11, 2004 9:14 am</h4>
    <div class="postbody"><span class="postbody">Ok, I finally figured it out.  For some reason, when you declare a window, it messes with the fading.  It's not the actual window code, because the fade works with that.  It's the actual setting of the window in the REG_DISPCNT register.  So what I did is subtracted the value of windows enable, fade, and then add the windows enable.
<br/>
<br/>
I can't believe that was the problem.  Well thanks for all of the help and sorry to cause such a headache as a newb.  Thanks again and here's my final fade code that works:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">            REG_BLDMOD = BIT00 | BIT04 | BIT06 | BIT07;
<br/>
            REG_DISPCNT -= 0x2000;
<br/>
            for(y = 0; y &lt; 17; ++y) 
<br/>
               {
<br/>
               REG_COLEY = y; 
<br/>
               for(z=0; z&lt;30000; z++)
<br/>
                  {}
<br/>
               WaitForVsync();
<br/>
               }
<br/>
            REG_DISPCNT += 0x2000;</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19105 - bats - Sun Apr 11, 2004 12:03 pm</h4>
    <div class="postbody"><span class="postbody">Hmm... sorry, missed you mention the I/O stuff. Good to see you figured it out.
<br/>
Just to save you some headaches...
<br/>
In general you don't want to subtract from bitfields. If, for example, REG_DISPCNT does not have bit 13 set (0x2000) subtracting 0x2000 will change other bits -- probably not what you want.
<br/>
<br/>
Instead use:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
REG_DISPCNT &amp;= ~0x2000; // this clears bit 13
<br/>
</td> </tr></table><span class="postbody">
<br/>
and</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
REG_DISPCNT |= 0x2000; // this sets bit 13
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
if you know that window 0 is always going to be on when you execute this code, you can leave it as subtract -- but you might as well get into the habit of using | and &amp; when modifying bitfields.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19106 - Cearn - Sun Apr 11, 2004 12:35 pm</h4>
    <div class="postbody"><span class="postbody">You could also try this:
<br/>
Bits 1&lt;&lt;5 and 1&lt;&lt;13 of the REG_WIN_IN and REG_WIN_OUT registers regulare the blending in the windows. If you set those blending will occur as usual. 
<br/>
<br/>
I always wondered what those did.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19132 - Pinski - Sun Apr 11, 2004 8:39 pm</h4>
    <div class="postbody"><span class="postbody">The window blending did the trick.  Not only does my fading work now, but it cleared up another glitch I had.  Thanks!
<br/>
Final Fade Out Code:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">            REG_BLDMOD = BIT00 | BIT04 | BIT06 | BIT07;
<br/>
            for(y = 0; y &lt; 17; ++y) 
<br/>
               {
<br/>
               REG_COLEY = y; 
<br/>
               for(z=0; z&lt;5000; z++)
<br/>
                  {}
<br/>
               WaitForVsync();
<br/>
               }</td> </tr></table><span class="postbody">
<br/>
<br/>
Final Fade In Code:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">            REG_BLDMOD = BIT00 | BIT04 | BIT06 | BIT07;
<br/>
            for(y = 16; y &gt;= 0; --y) 
<br/>
               {
<br/>
               REG_COLEY = y; 
<br/>
               for(z=0; z&lt;30000; z++)
<br/>
                  {}
<br/>
               WaitForVsync();
<br/>
               }</td> </tr></table><span class="postbody">
<br/>
<br/>
Window setting code:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   REG_WININ = WIN0_BG0 | WIN0_SPRITES | WIN0_BLENDS;
<br/>
   REG_WINOUT = WINOUT_BG0 | WINOUT_SPRITES | WINOUT_BLENDS;</td> </tr></table><span class="postbody">
<br/>
I only have one window active as of now.
<br/>
<br/>
Thanks to everyone that helped.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
