<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>clearing screen - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > clearing screen</h2>
<div id="posts">
<div class="post">
    <h4>#34874 - blinky465 - Thu Jan 27, 2005 5:05 pm</h4>
    <div class="postbody"><span class="postbody">I'm almost done with my iso game which uses tiled backgrounds for the floor tiles (Scott's suggestion in the iso games topic) and a linked list of sprites for the on-screen characters. I'm using VisualHAM for creating tiled backgrounds and sprites.
<br/>
<br/>
When I come to clear the screen, I loop through my linked list finding the corresponding sprites and I delete each one (freeing up resources as I go) and then remove the two tiled backgrounds.
<br/>
<br/>
As the tiled backgrounds are removed, there's a definite "chequering" effect as one is removed, then the other. I would like to avoid this.
<br/>
<br/>
So I created a "curtain" effect by using the DMAClearScreen function suggested on an earlier post:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void DMAClearScreen(u16 color) { 
<br/>
   ham_VBAText("clearing screen");
<br/>
   REG_DM3SAD     = (u32) &amp; color; 
<br/>
   REG_DM3DAD     = 0x06000000;      //Destination Address 
<br/>
   (REG_DM3CNT_L) = (160 * 240); 
<br/>
   (REG_DM3CNT_H) = 0x9100; 
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
So now I call this clear function using DMAClearScreen(0);
<br/>
my screen goes black instantly and then I tidy up the sprites etc.
<br/>
But the screen never returns from black!
<br/>
<br/>
The screen is recreated and the game continues (since after a little while, my main character dies and I get taken back to the menu screen) so I wondered if there was something I was missing:
<br/>
a call to the function is indeed copying just a big black square directly into the video ram buffer - but any drawing functions after this don't seem to have an effect.
<br/>
<br/>
Do I need to do anything before setting background tiles and drawing more sprites?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#34875 - poslundc - Thu Jan 27, 2005 5:21 pm</h4>
    <div class="postbody"><span class="postbody">The function you've listed is designed to clear the screen in bitmap modes, not tile modes. It ostensibly works because you are overwriting the same VRAM you use for tiles with zeros, but in practice you are overwriting the tile data you're using as well as the map data.
<br/>
<br/>
If all you want to do is blank the map out, you can do any of the following:
<br/>
<br/>
- Set the tiles in the map to a special blank tile
<br/>
- Set all of the colours in the palette to the same colour
<br/>
- Overwrite the tile data with zeros (what you've basically done here, but then you've lost your tiles)
<br/>
- Turn the background off
<br/>
<br/>
If you want a smoother transition to black, either use the effects register to fade in or out over a period of time (or do a palette fade if you want and know how) or use a window and change its dimensions over a period of time.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#34877 - Datch - Thu Jan 27, 2005 5:31 pm</h4>
    <div class="postbody"><span class="postbody">Which mode you're using? This look like a mode 4 code clear method.  
<br/>
<br/>
In a tile mode, I guess you could use a black square sprite scaled to the whole screen.  Then you could clean up all the other sprites and even build up another screen before removing your black square sprite.  (I've never tryed that though =) )</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#34885 - blinky465 - Thu Jan 27, 2005 8:47 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Datch wrote:</b></span></td> </tr> <tr> <td class="quote">In a tile mode, I guess you could use a black square sprite scaled to the whole screen.  Then you could clean up all the other sprites and even build up another screen before removing your black square sprite. </td> </tr></table><span class="postbody">
<br/>
<br/>
I like the sound of this - put the curtain up, draw the screen, pull it down. Play the game. Curtain up, clear the screen, pull it down.
<br/>
<br/>
Is is possible to quickly stretch a single sprite to fit the whole screen? (my main sprites are 16x16) Or would I need to tile 12 64x64 sprites?
<br/>
<br/>
I'm using bg mode 0.
<br/>
Thanks- Chris
<br/>
<br/>
<br/>
EDIT - don't know why I didn't do this - I just made the background invisible before deleting the linked list. It's not brilliant but will do for now - I'd still like to use the big sprite idea - and may be fade it down (alpha 100% to 0%) to give the illusion of the game screen fading up from black.</span><span class="gensmall"><br/><br/>Last edited by blinky465 on Thu Jan 27, 2005 8:53 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#34886 - tepples - Thu Jan 27, 2005 8:52 pm</h4>
    <div class="postbody"><span class="postbody">A single sprite cannot be stretched larger than 128x128 pixels (i.e. a 64x64 pixel sprite in double size mode).
<br/>
<br/>
Super Mario Bros. 3 for NES does a convincing curtain effect without any scaling hardware.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#34887 - poslundc - Thu Jan 27, 2005 9:15 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>blinky465 wrote:</b></span></td> </tr> <tr> <td class="quote">EDIT - don't know why I didn't do this - I just made the background invisible before deleting the linked list. It's not brilliant but will do for now - I'd still like to use the big sprite idea - and may be fade it down (alpha 100% to 0%) to give the illusion of the game screen fading up from black.</td> </tr></table><span class="postbody">
<br/>
<br/>
Using sprites for this purpose is an extremely inefficient use of resources. You can darken or lighten a layer to fade to or from black using the effects register. Or you can use any of the other techniques I mentioned in my post.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#34888 - DekuTree64 - Thu Jan 27, 2005 9:28 pm</h4>
    <div class="postbody"><span class="postbody">I'd recommend using a window instead, they're much easier. Just turn everything off inside the window, everything on outside, and move the bottom coordinate down every frame.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
