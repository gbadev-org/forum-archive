<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>memory management... - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Coding > memory management...</h2>
<div id="posts">
<div class="post">
    <h4>#5759 - lordmetroid - Thu May 08, 2003 4:57 am</h4>
    <div class="postbody"><span class="postbody">I want to keep track of how much memory I got left in IWRAM...
<br/>
It was quite easy before, before I added structures. As I could count the variables sizes... but now, one never know how big a structure is.
<br/>
<br/>
Is there a way to find out how much one has allready allocated?
<br/>
<br/>
I also wonder... is there a way of packing the structures, packing them so they don't take more memory then the variables inside... I saw one could do it for regular computer code but don't remember exactly but it was something like #pragma pack or something.
<br/>
If I pack will accessing the variables inside the structure get slower?<br/>_________________<br/>*Spam*
<br/>
Open Solutions for an open mind, <a href="http://www.areta.org" target="_blank">www.areta.org</a>
<br/>
<br/>
Areta is an organization of coders codeing mostly open source project, but there is alot of sections like GBA dev, Language learning communities, RPG communities, etc...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#5761 - niltsair - Thu May 08, 2003 5:46 am</h4>
    <div class="postbody"><span class="postbody">structures takes more place than the size of its variables? Is it only due to each variable trying to be aligned?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#5765 - tepples - Thu May 08, 2003 6:59 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>lordmetroid wrote:</b></span></td> </tr> <tr> <td class="quote">Is there a way to find out how much one has allready allocated?</td> </tr></table><span class="postbody">
<br/>
You could always try picking through the output of <span style="font-style: italic">nm -n foo.elf</span>. Devkit Advance R5 will include a tool to do this for you.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I also wonder... is there a way of packing the structures, packing them so they don't take more memory then the variables inside</td> </tr></table><span class="postbody">
<br/>
The easiest method is to keep variables of similar size together (all u8:s and s8:s together, all u16:s and s16:s together).  Or just lay out your structs on graph paper, making sure that all u16:s and s16:s fall on an even byte boundary and that all u32:s and s32:s fall on a 4-byte boundary.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I saw one could do it for regular computer code</td> </tr></table><span class="postbody">
<br/>
This requires accesses to unaligned memory addresses and thus won't work in ARM architecture.  It works in x86 because x86 supports unaligned accesses.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#5766 - Quirky - Thu May 08, 2003 7:39 am</h4>
    <div class="postbody"><span class="postbody">I keep track of IWRAM use through a combination of -Wl,-Map,game.map (as a gcc option, passed to ld) and watching IWRAM in VBA.
<br/>
<br/>
game.map (or whatever you call it) is a memory map created by the linker and it'll let you know exactly how much memory you use for global variables. VBA's memory viewer can be used to watch the stack, which starts at the end of IWRAM and works backwards.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#5769 - Touchstone - Thu May 08, 2003 8:46 am</h4>
    <div class="postbody"><span class="postbody">The linker should output a couple of variables I think, which you can use to check how much variable-memory is used. They are called something like __BSS_START__ (start of the BSS, a.k.a variable section) and __BSS_END__ (well, end of BSS).
<br/>
<br/>
So to know how much variable memory you are using you can do:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">extern char __BSS_START__;
<br/>
extern char __BSS_END__;
<br/>
int UsedBSS = (&amp;__BSS_END__) - (&amp;__BSS_START__);</td> </tr></table><span class="postbody">
<br/>
<br/>
I _think_ this is how it's done but it was three years since I did it the last time :) and at the time I did it for Playstation but I used gcc. Anyways, check out your memory-map to see what the variables that lies at the beginning and end of your variable section are called.<br/>_________________<br/>You can't beat our meat</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#5770 - Sweex - Thu May 08, 2003 9:40 am</h4>
    <div class="postbody"><span class="postbody">I wrote my own new and delete functions that keep track of allocated memory. If your not doing c++ you can probably write your own malloc and free functions.
<br/>
<br/>
Simply subtracting the allocated memory from 256k gives you the free memory (However, this is quite inaccurate as there's almost certainly not the full 256k available for your program.)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#5777 - niltsair - Thu May 08, 2003 2:29 pm</h4>
    <div class="postbody"><span class="postbody">I was wondering, how reliable is the new/delete fucntion on the DevKitAdvance? Why did you do your own new/delete implementation, for fun or because it was needed? I am about to start a project with some peoples, and we were wondering about dynamic memory allocation.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#5782 - Touchstone - Thu May 08, 2003 4:07 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>niltsair wrote:</b></span></td> </tr> <tr> <td class="quote">I was wondering, how reliable is the new/delete fucntion on the DevKitAdvance? Why did you do your own new/delete implementation, for fun or because it was needed? I am about to start a project with some peoples, and we were wondering about dynamic memory allocation.</td> </tr></table><span class="postbody">
<br/>
<br/>
If you are going commercial, or starting a bigger project, I would really opt against using any existing libraries such as DevKit Advance. I haven't tried any of them so I can't say that they are bad, I'm just suggesting that if you are gonna write a bigger project you might want to know everything that is going on, where every cycle is spent, and most importantly have the possibility to rewrite code.
<br/>
<br/>
But then again it may just be the fact that I'm getting rather bored by Tepples constant plugging for DevKit Advance. Feels like forum.gbadev.org has turned into a recruitment/support-center for devkit advance. In fact, I'm so sure I'll get flamed for writing this I'm almost prepared to bet my E3 pass. :)
<br/>
<br/>
So, in the spirit of true gameboy advance programming. Bash the hardware directly! If you want to use libraries you can write PC games using DirectX.
<br/>
<br/>
Feel free to hate me now! :)
<br/>
<br/>
P.S. I take no responsibility for what I have written in this post.<br/>_________________<br/>You can't beat our meat</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#5784 - niltsair - Thu May 08, 2003 4:39 pm</h4>
    <div class="postbody"><span class="postbody">Your E3 pass eh......
<br/>
<br/>
(Hey guys, let's keep quiet and we'll have a draw for it amongs ourselves...) :-)
<br/>
<br/>
As for our little project, it's nothing commercial, it's a homebrew game :
<br/>
<a class="postlink" href="http://www.gosg.org" target="_blank">www.gosg.org</a>
<br/>
<br/>
And about DevKitAdvance, isn't only a gcc/as compiler tweaked to work for the Gba? I mean what are we supposed to use beside a C/C++ compiler if we don't want to hand code everything in Assmebly, doesn't seems really efficient. You code your main logic in C/C++ to get clarity of code, and the processor intensive code in Assembly.
<br/>
<br/>
When using DevKitAdvance, you still have access to the hardware and you're not using a lot of librairies.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#5789 - Touchstone - Thu May 08, 2003 5:58 pm</h4>
    <div class="postbody"><span class="postbody">Well, that should teach me not to speak if I'm not exactly sure what I'm talking about. :) I thought devkit advance was a hardware abstraction library. That would really take the fun out of programming for the gba. :)
<br/>
<br/>
If it's just gcc then I won't stop anyone from using it. (Like I would otherwise :)
<br/>
<br/>
I'm sorry Tepples! Although I'm still not comfortable with all this devkit advance plugging, but maybe I'm just jealous. :)<br/>_________________<br/>You can't beat our meat</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#5791 - niltsair - Thu May 08, 2003 6:18 pm</h4>
    <div class="postbody"><span class="postbody">Ham is a bunch of librairies made to make the development easier. Never tried it.
<br/>
<br/>
DevKitAdv is really just a set of tools to compile in As, C, C++, already all configured.
<br/>
<br/>
Now, about that E3 pass.... ;-)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#5795 - tepples - Thu May 08, 2003 6:36 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Touchstone wrote:</b></span></td> </tr> <tr> <td class="quote">Well, that should teach me not to speak if I'm not exactly sure what I'm talking about. :) I thought devkit advance was a hardware abstraction library.</td> </tr></table><span class="postbody">
<br/>
In fact, Jason Wilkins has strongly argued against including anything like HAMlib in the Devkit Advance distribution. Devkit Advance R5 will include a text output library (for printf(), etc) similar to my AGBTTY, but the ANSI C standard mandates that anyway.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Although I'm still not comfortable with all this devkit advance plugging, but maybe I'm just jealous. :)</td> </tr></table><span class="postbody">
<br/>
What you see as "plugging" may just be explaining quirks of Devkit Advance R4, giving workarounds, and predicting how they will change in R5 based on my conversations with the maintainer and what I have observed of the betas.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#5799 - Touchstone - Thu May 08, 2003 7:57 pm</h4>
    <div class="postbody"><span class="postbody">Ok.
<br/>
<br/>
Sometimes I get the feeling you Tepples are advertising Devkit Advance. Back when I thought it was a library (about an hour ago :) I got bothered cause I thought you where recommending people to use a hardware abstraction library. Anyways, I'm ok with it now when I know it's not. :)
<br/>
<br/>
And niltsair, I'm sorry but I'm gonna have to hang on to the pass, even though no flaming occured. I'm sorry about that. :)<br/>_________________<br/>You can't beat our meat</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#5804 - Jason Wilkins - Thu May 08, 2003 9:41 pm</h4>
    <div class="postbody"><span class="postbody">DevKit Advance is just a C/C++ tool chain for GBA based on GCC.  If there is no disaster (like someone crashing a car into my house like they did Tuesday (NO JOKE!)), the next version should be out tommorow (Friday, May 9th, 2003). 
<br/>
<br/>
Although I know you were not suggesting that someone do so, I will say rolling your own tool chain can be a full time project in and of itself.  If you want to know everything that is going on, then you would still want to grab DevKit Advance.  The next release will include simple projects for recompiling and installing the low level internals, or you can just rip all that out and use your own stuff easily.  But, let me worry about building and fixing the compiler itself.
<br/>
<br/>
The only high level library which devkit advance will contain is a common framework library for use by example and test code.
<br/>
<br/>
I am glad that tepples is enthusiastic about DKA5, but I feel bad about promoting features which only exist on my laptop right now ^_^
<br/>
<br/>
The tool for reporting on memory usage which he mentioned is probably several weeks away.  I stopped development of it until the DevKit stablizes some more.
<br/>
<br/>
Back to the original poster.  You can tell how big a structure is by using 'sizeof(my_struct_t)' or 'sizeof(my_struct_var_name)'<br/>_________________<br/><a href="http://devkitadv.sourceforge.net" target="_blank">http://devkitadv.sourceforge.net</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#5806 - niltsair - Thu May 08, 2003 9:46 pm</h4>
    <div class="postbody"><span class="postbody">You'll probably anwser yes to this one,
<br/>
<br/>
but we're about to start the programming part of a project, would you recommand using the new release? What would be the advantages compared to the previous version.
<br/>
<br/>
And can new/delete be used safely?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#5807 - Jason Wilkins - Thu May 08, 2003 9:47 pm</h4>
    <div class="postbody"><span class="postbody">DevKit Advance is just a C/C++ tool chain for GBA based on GCC.  If there is no disaster (like someone crashing a car into my house like they did Tuesday (NO JOKE!)), the next version should be out tommorow (Friday, May 9th, 2003). 
<br/>
<br/>
Although I know you were not suggesting that someone do so, I will say rolling your own tool chain can be a full time project in and of itself.  If you want to know everything that is going on, then you would still want to grab DevKit Advance.  The next release will include simple projects for recompiling and installing the low level internals, or you can just rip all that out and use your own stuff easily.  But, let me worry about building and fixing the compiler itself.
<br/>
<br/>
The only high level library which devkit advance will contain is a common framework library for use by example and test code.
<br/>
<br/>
I am glad that tepples is enthusiastic about DKA5, but I feel bad about promoting features which only exist on my laptop right now ^_^
<br/>
<br/>
The tool for reporting on memory usage which he mentioned is probably several weeks away.  I stopped development of it until the DevKit stablizes some more.
<br/>
<br/>
Back to the original poster.  You can tell how big a structure is by using 'sizeof(my_struct_t)' or 'sizeof(my_struct_var_name)'<br/>_________________<br/><a href="http://devkitadv.sourceforge.net" target="_blank">http://devkitadv.sourceforge.net</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#5808 - Jason Wilkins - Thu May 08, 2003 10:03 pm</h4>
    <div class="postbody"><span class="postbody">This week I have been doing a lot of testing and as far as the basic lnkscript and crt0.S go, I think that DevKit Advance Beta 3 will be rock solid.
<br/>
<br/>
malloc appears to work with all combination of options, but it has not been tested extensively.  If it works, then new/delete should work as well.
<br/>
<br/>
C++ should work as far as I know.  Using main as your entry point, and libc, static constructors and destructors and atexit functions should all be called.
<br/>
<br/>
I do no think you would have any serious problems with Release 5, even its beta state.<br/>_________________<br/><a href="http://devkitadv.sourceforge.net" target="_blank">http://devkitadv.sourceforge.net</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
