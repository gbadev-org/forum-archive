<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Multiplayer (hardware) testing - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > Multiplayer (hardware) testing</h2>
<div id="posts">
<div class="post">
    <h4>#61822 - Crs - Thu Nov 24, 2005 12:57 am</h4>
    <div class="postbody"><span class="postbody">Hi folks,
<br/>
<br/>
Just wondering if anyone can suggest or help regarding some multiplayer functionality I have going on.
<br/>
<br/>
Using the NO-CASH-GBA emulator I have multiplayer working to how I would like, its not perfect but its acceptable for my game :)
<br/>
<br/>
The methods I am using are actually by other forum members methods I have found recently which has been a really BIG help.
<br/>
<br/>
I am limited to testing as far as hardware goes, I have 2*GBA's and 1*flash cartridge.  So trying various things <span style="font-weight: bold">I am wanting to see "Player 2" listed (detected) as the current player.</span>
<br/>
<br/>
I have tried powering on both GBA's with my game installed and the slave cable end in one gba.  This will not show as player 2 which is my concern.
<br/>
<br/>
I would like to assume that what I see on NO-CASH-GBA will be the final result when I have my game put on cartridges, but to me it doesnt seem like the code I have requires both GBA's to have the same gamepack installed.
<br/>
<br/>
Some detection code I have, with permission, as follows:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   SIOCNT = 0;
<br/>
<br/>
   // enable multiplayer
<br/>
   SIOCNT |= (1 &lt;&lt; 13);
<br/>
<br/>
   // set mode multiplayer mode
<br/>
   REG_RCNT = 0;
<br/>
   REG_RCNT |= (1 &lt;&lt; 14);
<br/>
<br/>
   // search for GBA ready signal..
<br/>
   int ready = 0;
<br/>
<br/>
   // ready detected
<br/>
   if (SIOCNT &amp; (1&lt;&lt;3)) ready = 1;
<br/>
<br/>
   if (ready == 0)   return -1;
<br/>
<br/>
   // get *this* player id
<br/>
   PID = (SIOCNT &gt;&gt; 4) &amp; 3;
<br/>
<br/>
   return 0;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
The function is repeatedly called if -1 is returned, should that work?  Seems to in the emulator, I'm not sure, but just how does the GBA know what end of the cable is in?
<br/>
<br/>
Well if you know what I'm talking about I would really like to hear from you :)  I appreciate your reading!
<br/>
<br/>
Chris.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#61823 - Miked0801 - Thu Nov 24, 2005 1:18 am</h4>
    <div class="postbody"><span class="postbody">The GBA knows because the master's connection cable is a different shape than all the others.  It sets a special bit somewhere when the current GBA is master/Player 1</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#61864 - Crs - Thu Nov 24, 2005 9:52 am</h4>
    <div class="postbody"><span class="postbody">Right, I thought it might have been something like that thanks for clearing that up Mike.
<br/>
<br/>
So that would suggest on hardware I should be able to show which end of the cable is attached, even without another GBA attached to the other end?
<br/>
<br/>
Therefore I must be doing something wrong here, can someone clue me in how I can get this working correctly?  It does make it tricky when it works on emulation but not on hardware don't you think? ;)
<br/>
<br/>
Thanks guys.
<br/>
<br/>
Chris.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62215 - Crs - Mon Nov 28, 2005 9:59 am</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
I finally got myself some results by changing the bits I read from SIOCNT,
<br/>
<br/>
bit 2   (L) = SI-Terminal (0 - Parent, 1- Child)
<br/>
<br/>
bits 4-5 (D) = ID of GBA [00=master,01=slave1,10=slave2,11=slave3]
<br/>
<br/>
Before I was reading bits 4-5 to get the player ID (only no$gba worked with this) but I am now only checking bit 2 to identify the unit as a master or slave.  This worked on all: no$gba, vba-link, hardware. (finally! :))
<br/>
<br/>
Now I am guessing the correct method is to read bit 2 and if it is set then continue to read bits 4-5 to get the actual ID?  Since I am only working on a 2 player game I should be ok just with bit 2.
<br/>
<br/>
Well hopefully this info is corret and maybe it will help another in a similar situation,
<br/>
<br/>
Regards
<br/>
<br/>
Chris.
<br/>
<br/>
 P.S. what is a good transfer rate to use in <span style="font-weight: bold">multiplayer mode</span>?  I get intermittent slow down while Im testing during 2 player mode?  I am <span style="font-weight: bold">really</span> hoping its an emulation problem (or lack of cpu) and not my actual game.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62680 - circle7820 - Sun Dec 04, 2005 9:01 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Miked0801 wrote:</b></span></td> </tr> <tr> <td class="quote">  It sets a special bit somewhere when the current GBA is master/Player 1.</td> </tr></table><span class="postbody">
<br/>
<br/>
 Is everything like this these days?:lol:</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62718 - Miked0801 - Mon Dec 05, 2005 12:03 am</h4>
    <div class="postbody"><span class="postbody">Lol - not always.  The problem is, I'm one of the few who has done a bunch of MP games, but I'm busy going towards a milestone right now and the info requested is <a class="postlink" href="http://nocash.emubase.de/gbatek.htm#siomultiplayermode" target="_blank">in GBATek</a>.  When people have very specific questions on MP, I try to answer.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
