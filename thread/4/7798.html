<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>More accurate fixed point divide - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > More accurate fixed point divide</h2>
<div id="posts">
<div class="post">
    <h4>#63704 - keldon - Thu Dec 15, 2005 6:30 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">inline int fpdiv ( int a, int b ) {
<br/>
   int bs = ( b &lt; 0 ? -1 : 1 );
<br/>
   b *= bs;
<br/>
   
<br/>
   long long lb;
<br/>
   lb = 1;
<br/>
   lb = lb &lt;&lt; 63;
<br/>
   lb = lb / ((long long) b  );
<br/>
   b = (int) (lb &gt;&gt; 31);
<br/>
   
<br/>
   return fpmul (a, b * bs );
<br/>
   
<br/>
}</td> </tr></table><span class="postbody">
<br/>
Is there a more accurate way to perform fixed point division?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63708 - DekuTree64 - Thu Dec 15, 2005 6:49 pm</h4>
    <div class="postbody"><span class="postbody">Ideally you'd want
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">inline int fpdiv ( int a, int b ) {
<br/>
    return (int) (((long long)a &lt;&lt; FRACTION_BITS) / (long long)b);
<br/>
}</td> </tr></table><span class="postbody">
<br/>
That's gotta be slow, doing a 64-bit divide, but it's quite accurate.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63716 - keldon - Thu Dec 15, 2005 7:50 pm</h4>
    <div class="postbody"><span class="postbody">Oh yes it works a treat; thanks a lot</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#64760 - keldon - Mon Dec 26, 2005 1:15 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">inline int fpdiv ( int a, int b ) {
<br/>
    return ((a &lt;&lt; (FRACTION_BITS-1)) / b) &lt;&lt; 1;
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
You can use an int by sacrificing one bit. I was using this for texture mapping and it has not hurt it a single bit. No pun intended.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#64783 - poslundc - Mon Dec 26, 2005 7:16 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>keldon wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">inline int fpdiv ( int a, int b ) {
<br/>
    return ((a &lt;&lt; (FRACTION_BITS-1)) / b) &lt;&lt; 1;
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
You can use an int by sacrificing one bit. I was using this for texture mapping and it has not hurt it a single bit. No pun intended.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
You have not thought this through. Example:
<br/>
<br/>
FRACTION_BITS = 16
<br/>
a = 256.5 (0x01008000)
<br/>
b = 1.0 (0x00010000)
<br/>
fpdiv(a, b) = 0.5 (0x00008000)
<br/>
<br/>
Just because it happens to work within the domain of your application's constraints doesn't mean it works universally.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#64794 - keldon - Mon Dec 26, 2005 8:45 pm</h4>
    <div class="postbody"><span class="postbody">Oh yes that was quite silly. It was only working because all of my numbers were less than 1. It needs to be long. Thanks for pointing that one out.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
