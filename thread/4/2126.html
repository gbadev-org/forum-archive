<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Need help with maps again!! - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > Need help with maps again!!</h2>
<div id="posts">
<div class="post">
    <h4>#11029 - mandarin - Tue Sep 23, 2003 8:53 pm</h4>
    <div class="postbody"><span class="postbody">Hi all,
<br/>
<br/>
Lately I've been working on something and I got a problem with the maps.
<br/>
<br/>
What I want to do is load a image and prompt the player to press start then once pressed the map of the first level gets loaded but somehow I can't get it to work.
<br/>
<br/>
you can find the code at the following urls
<br/>
<br/>
<a class="postlink" href="http://galileo.spaceports.com/~mandarin/project1.zip" target="_blank">http://galileo.spaceports.com/~mandarin/project1.zip</a>
<br/>
<a class="postlink" href="http://galileo.spaceports.com/~mandarin/h.zip" target="_blank">http://galileo.spaceports.com/~mandarin/h.zip</a>
<br/>
<a class="postlink" href="http://galileo.spaceports.com/~mandarin/images.zip" target="_blank">http://galileo.spaceports.com/~mandarin/images.zip</a>
<br/>
<br/>
project1.zip is the actual code
<br/>
h.zip are the header files
<br/>
images.zip are the tiles and map
<br/>
<br/>
help will be appreciated
<br/>
thanx</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11062 - sajiimori - Thu Sep 25, 2003 12:34 am</h4>
    <div class="postbody"><span class="postbody">Broken links.
<br/>
<br/>
Reduce the code to something small that just loads a map and see if that works.  If not, post it here with a main().</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11443 - yaustar - Tue Oct 07, 2003 4:03 am</h4>
    <div class="postbody"><span class="postbody">they are not broken, just copy and paste the address into the tool bar. (it's a domian thing)
<br/>
<br/>
From just the rom image and the c file (please bear in mind it is 4:30am):
<br/>
<br/>
It is going into mode 1 striaght away, instead of waiting at mode 4 for the player to press start. I think this is due to:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">while (*KEYS &amp; KEY_START)</td> </tr></table><span class="postbody"> [still not sure]
<br/>
<br/>
any way here is the code for the rest to see
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include "h/gba.h"
<br/>
#include "h/screenmode.h"
<br/>
#include "h/keypad.h"
<br/>
#include "h/bg.h"
<br/>
#include "h/sprites.h"
<br/>
#include "h/bg.cpp"
<br/>
#include "h/math.h"
<br/>
<br/>
#include "images/start1.h"
<br/>
#include "images/start2.h"
<br/>
#include "images/map.c"
<br/>
#include "images/tiles.h"
<br/>
<br/>
Bg bg2;
<br/>
<br/>
#define RGB(r,g,b)(r+(g&lt;&lt;5)+(b&lt;&lt;10))
<br/>
void WaitForVsync()
<br/>
{
<br/>
   while((volatile u16)REG_VCOUNT != 160){}
<br/>
}
<br/>
<br/>
<br/>
void Flip()
<br/>
{
<br/>
   if(REG_DISPCNT &amp; BACKBUFFER)
<br/>
   {
<br/>
      REG_DISPCNT &amp;=~BACKBUFFER;
<br/>
      theVideoBuffer = theBackBuffer;
<br/>
   }
<br/>
   else
<br/>
   {
<br/>
      REG_DISPCNT |= BACKBUFFER;
<br/>
      theVideoBuffer = theBackBuffer;
<br/>
   }
<br/>
}
<br/>
<br/>
<br/>
void WaitForVBlank()
<br/>
{
<br/>
   #define ScanlineCounter *(volatile u16*)0x4000006
<br/>
   while(ScanlineCounter&lt;160){}
<br/>
}
<br/>
<br/>
<br/>
void level1()
<br/>
{
<br/>
u16* temp;
<br/>
   u16 loop;
<br/>
   
<br/>
   SetMode(MODE_1 |BG2_ENABLE | OBJ_ENABLE | OBJ_MAP_1D);
<br/>
<br/>
<br/>
   bg2.number = 2;
<br/>
   bg2.charBaseBlock =0;
<br/>
   bg2.screenBaseBlock =28;
<br/>
   bg2.colorMode = BG_COLOR_256;
<br/>
   bg2.size = ROTBG_SIZE_512x512;
<br/>
   bg2.mosaic=0;
<br/>
   bg2.x_scroll=120;
<br/>
   bg2.y_scroll=80;
<br/>
<br/>
   EnableBackground(&amp;bg2);
<br/>
   
<br/>
<br/>
   for(loop = 0; loop &lt;256; loop++)
<br/>
      BGPaletteMem[loop] = TILESPalette[loop];
<br/>
<br/>
   for(loop = 0; TILES_WIDTH*TILES_HEIGHT/2;loop++)
<br/>
      bg2.tileData[loop] = TILESData[loop];
<br/>
<br/>
   temp = (u16*)map;
<br/>
<br/>
   for(loop = 0; loop&lt;64*64/2; loop++)
<br/>
      bg2.mapData[loop] = temp[loop];
<br/>
<br/>
<br/>
   while(1)
<br/>
{
<br/>
   UpdateBackground(&amp;bg2);
<br/>
   WaitForVSync();
<br/>
   
<br/>
}
<br/>
}
<br/>
<br/>
<br/>
int start()
<br/>
{
<br/>
     while (*KEYS &amp; KEY_START)
<br/>
      {
<br/>
         SetMode(MODE_4 | BG2_ENABLE);
<br/>
         u16 i;
<br/>
         
<br/>
         for(i=0;i&lt;256;i++)
<br/>
            BGPaletteMem[i]=START1Palette[i];
<br/>
         
<br/>
         
<br/>
         u16 x,y;
<br/>
         
<br/>
         for(x=0;x&lt;120;x++)
<br/>
            for(y=0;y&lt;160;y++)
<br/>
               PlotPixel(x,y, START1Data[y*120+x]);   
<br/>
               WaitForVBlank();
<br/>
         for(x=0;x&lt;120;x++)
<br/>
            for(y=0;y&lt;160;y++)
<br/>
               PlotPixel(x,y, START2Data[y*120+x]);
<br/>
<br/>
               
<br/>
         }
<br/>
   
<br/>
<br/>
<br/>
 level1();
<br/>
<br/>
         
<br/>
         
<br/>
<br/>
<br/>
      
<br/>
         
<br/>
}
<br/>
            
<br/>
<br/>
<br/>
int main()
<br/>
{
<br/>
SetMode(MODE_1 | OBJ_ENABLE | OBJ_MAP_1D);
<br/>
<br/>
<br/>
<br/>
<br/>
   while(1)
<br/>
{
<br/>
   start();
<br/>
   
<br/>
   
<br/>
}
<br/>
<br/>
<br/>
<br/>
}
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
