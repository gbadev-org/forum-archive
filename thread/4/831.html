<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Text background - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Coding > Text background</h2>
<div id="posts">
<div class="post">
    <h4>#4153 - Psyk - Fri Mar 21, 2003 9:17 am</h4>
    <div class="postbody"><span class="postbody">I'm currently using a rotation background but i want to change it to a text background. This is the code i have at the moment
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">temp = ROTBG_SIZE_256x256| (0&lt;&lt;CHAR_SHIFT) | 8&lt;&lt;SCREEN_SHIFT)   | BG_COLOR_256| PRIORITY(3);
<br/>
<br/>
REG_BG2CNT = temp; 
<br/>
REG_DISPCNT |= BG2_ENABLE; </td> </tr></table><span class="postbody">
<br/>
<br/>
This works fine but if i change the screen mode to 0 and change the code to this it doesn't work. 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">temp = TEXTBG_SIZE_256x256| (0&lt;&lt;CHAR_SHIFT) | 8&lt;&lt;SCREEN_SHIFT)   | BG_COLOR_256| PRIORITY(3);
<br/>
<br/>
REG_BG2CNT = temp; 
<br/>
REG_DISPCNT |= BG2_ENABLE; </td> </tr></table><span class="postbody">
<br/>
<br/>
When i do this all the tile data is garbled. What else do i need to change?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4157 - tepples - Fri Mar 21, 2003 4:04 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Psyk wrote:</b></span></td> </tr> <tr> <td class="quote">a rotation background ... works fine but if i change the screen mode to 0 and change the code to this ... all the tile data is garbled. What else do i need to change?</td> </tr></table><span class="postbody">
<br/>
My first guess is that your rotation background uses 8-bit data and you're forgetting to convert it to 16-bit data for a text background before you write it to the map.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4163 - Psyk - Fri Mar 21, 2003 8:26 pm</h4>
    <div class="postbody"><span class="postbody">Why does it need to be 16bit for a text background? And how do i change it to 16bit?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4165 - tepples - Fri Mar 21, 2003 9:16 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Psyk wrote:</b></span></td> </tr> <tr> <td class="quote">Why does it need to be 16bit for a text background?</td> </tr></table><span class="postbody">
<br/>
Because that's how Nintendo designed the system.  Text background maps and rotation background maps have a different format in VRAM. Your tutorial (thepernproject.com or gbajunkie.co.uk) should address this issue.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
fedcba9876543210  Text nametable entries
<br/>
||||||||||||||||
<br/>
||||||++++++++++- Tile number
<br/>
|||||+----------- Flip tile horizontally
<br/>
||||+------------ Flip tile vertically
<br/>
++++------------- Palette
<br/>
<br/>
fedcba9876543210  Affine nametable entries
<br/>
||||||||||||||||
<br/>
||||||||++++++++- Tile number of even-numbered tile
<br/>
++++++++--------- Tile number of odd-numbered tile
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">And how do i change it to 16bit?</td> </tr></table><span class="postbody">
<br/>
It depends on which tool you used to export your map.  That said, you can convert the map at runtime by copying each byte of the map to one 16-bit unit of VRAM.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4176 - Psyk - Sat Mar 22, 2003 8:38 am</h4>
    <div class="postbody"><span class="postbody">ok thanks. It doesn't seem to mention it on gbajunkie because it just explains a rotation background and says that's the one most people will want to use. And the pern project doesn't seem to be up at the moment.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4238 - Eep - Tue Mar 25, 2003 5:58 am</h4>
    <div class="postbody"><span class="postbody">I am having a similar problem with my backgrounds. I am using dovoto's background structure (modified into a class for myself) and I can get the background in mode1 as a rotation background, but when I change to mode0 and to a text background nothing shows up at all. I am using VisualBoyAdvance and the background attributes are set correctly, but it like the map isn't there. The tiles load fine. I don't know what I am doing wrong. Here is the code I use when I am in mode 0:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   SetMode(MODE_0 | OBJ_ENABLE | OBJ_MAP_1D);
<br/>
    
<br/>
   bg2.number = 2;            //background number 0-3
<br/>
   bg2.charBaseBlock = 0;
<br/>
   bg2.screenBaseBlock = 28;
<br/>
   bg2.colorMode = BG_COLOR_256;
<br/>
   bg2.size = TEXTBG_SIZE_256x256;
<br/>
   bg2.mosiac = 0;
<br/>
   bg2.x_scroll = 0;
<br/>
   bg2.y_scroll = 0;
<br/>
<br/>
   bg2.enable();
<br/>
<br/>
   u16 loop;
<br/>
   for(loop = 0; loop &lt; 256; loop++)
<br/>
        BGPaletteMem[loop] = TilesPalette[loop];
<br/>
   
<br/>
   for(loop = 0; loop &lt; Tiles_WIDTH * Tiles_HEIGHT /2; loop++)
<br/>
      bg2.tileData[loop] = TilesData[loop];
<br/>
<br/>
   u16 *tmpTest = (u16*)CTest;
<br/>
   for(loop = 0; loop &lt; 32*32/2; loop++)
<br/>
        bg2.mapData[loop] = tmpTest[loop]; 
<br/>
        
<br/>
   while(1)
<br/>
   {
<br/>
      getInput();
<br/>
      waitForVsync();
<br/>
      bg2.update();
<br/>
   }
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
When I am in mode 1 all I do is change the SetMode to MODE_1 instead of MODE_0 and change the bg2.size to ROTBG_SIZE_256x256 (since background 2 in mode1 is a rotation background). 
<br/>
<br/>
Any ideas would be really helpful. 
<br/>
<br/>
Thanks.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
