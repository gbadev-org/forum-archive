<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Overlaping sections without being full :-S - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Coding > Overlaping sections without being full :-S</h2>
<div id="posts">
<div class="post">
    <h4>#155714 - Ruben - Sat May 03, 2008 9:34 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">c:/devkitpro/devkitarm/bin/../lib/gcc/arm-eabi/4.3.0/../../../../arm-eabi/bin/ld.exe: section .ewram [08038f50 -&gt; 0803928b] overlaps section .bss [08038f50 -&gt; 08039967]
<br/>
collect2: ld returned 1 exit status</td> </tr></table><span class="postbody">
<br/>
<br/>
I have no idea what could be causing that. All I did was change from devKitARM r21 to r23, and that happened. Any ideas?
<br/>
<br/>
I'm using a modified version of Jeff's crt0.s file and his lnkscript. Also, I don't have ANYTHING in EWRAM so it can't be because it's full (it never said that anyway). Any help appreciated.
<br/>
<br/>
This is my modified cart file named '0.s' so it ends up in first position when linking (I use a complicated batch script):
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">.text
<br/>
.global _start
<br/>
.align
<br/>
.arm
<br/>
<br/>
_start:
<br/>
 b       rom_header_end
<br/>
 .fill   0x9C,0x01,0x00            @ NINTENDO logo
<br/>
 .byte   0x00,0x00,0x00,0x00,0x00  @ \
<br/>
 .byte   0x00,0x00,0x00,0x00,0x00  @  Game title
<br/>
 .byte   0x00,0x00                 @ /
<br/>
 .byte   0x00,0x00,0x00,0x00       @ Game code
<br/>
 .byte   0x30,0x31                 @ Maker code
<br/>
 .byte   0x96                      @ Reserved
<br/>
 .byte   0x00                      @ Main unit code
<br/>
 .byte   0x00                      @ Device type
<br/>
 .byte   0x00,0x00,0x00,0x00,0x00  @ \ Reserved
<br/>
 .byte   0x00,0x00                 @ /
<br/>
 .byte   0x00                      @ Software version
<br/>
 .byte   0xF0                      @ Complement
<br/>
 .byte   0x00,0x00                 @ Checksum
<br/>
<br/>
.align
<br/>
.arm
<br/>
<br/>
rom_header_end:
<br/>
 b       start_vector
<br/>
<br/>
.global __boot_method, __slave_number
<br/>
<br/>
__boot_method:
<br/>
 .byte   0x00    @ boot type
<br/>
<br/>
__slave_number:
<br/>
 .byte   0x00    @ slave number
<br/>
<br/>
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
<br/>
<br/>
.global start_vector
<br/>
.align
<br/>
.arm
<br/>
<br/>
start_vector:
<br/>
 mov     r0, #0x12
<br/>
 msr     cpsr, r0
<br/>
 ldr     sp, =__sp_irq
<br/>
 mov     r0, #0x1F
<br/>
 msr     cpsr, r0
<br/>
 ldr     sp, =__sp_usr
<br/>
 adr     r0,1f + 1
<br/>
 bx      r0
<br/>
<br/>
.thumb
<br/>
<br/>
1:
<br/>
 ldr     r1, =__intr_vector_buf
<br/>
 ldr     r0, =IntrRout
<br/>
 str     r0, [r1]
<br/>
<br/>
.LDoEWRAMClear:
<br/>
 mov     r1, #0x40
<br/>
 lsl     r1, #0x0C
<br/>
 lsl     r0, r1, #0x07
<br/>
 bl      .LClearMem
<br/>
<br/>
.LSkipEWRAMClear:
<br/>
 mov     r0, #0x03
<br/>
 lsl     r0, #0x18
<br/>
 ldr     r1, =__sp_usr_offset - 16
<br/>
 bl      .LClearMem
<br/>
<br/>
 ldr     r1, =__data_lma
<br/>
 ldr     r2, =__data_start
<br/>
 ldr     r4, =__data_end
<br/>
 bl      .LCopyMemChk
<br/>
 
<br/>
 ldr     r1, =__iwram_lma
<br/>
 ldr     r2, =__iwram_start
<br/>
 ldr     r4, =__iwram_end
<br/>
 bl      .LCopyMemChk
<br/>
 
<br/>
 ldr     r2, =__load_stop_iwram0
<br/>
 ldr     r1, =__load_start_iwram0
<br/>
 sub     r3, r2, r1
<br/>
 beq     .LCIW0Skip
<br/>
 
<br/>
 ldr     r2, =__iwram_overlay_start
<br/>
 bl      .LCopyMem
<br/>
<br/>
.LCIW0Skip:
<br/>
 ldr     r1, =__ewram_lma
<br/>
 ldr     r2, =__ewram_start
<br/>
 ldr     r4, =__ewram_end
<br/>
 bl      .LCopyMemChk
<br/>
 
<br/>
 ldr     r2, =__load_stop_ewram0
<br/>
 ldr     r1, =__load_start_ewram0
<br/>
 sub     r3, r2, r1
<br/>
 beq     .LCEW0Skip
<br/>
 
<br/>
 ldr     r2, =__ewram_overlay_start
<br/>
 bl      .LCopyMem
<br/>
<br/>
.LCEW0Skip:
<br/>
 mov     r0, #0x00          @ int argc
<br/>
 mov     r1, #0x00          @ char *argv[]
<br/>
 ldr     r3, =start_vector  @ r3 = start_vector
<br/>
 mov     lr, r3             @ lr = r3
<br/>
 ldr     r3, =main          @ r3 = main
<br/>
 bx      r3                 @ bx to r3
<br/>
<br/>
.LClearMem:
<br/>
 mov     r2, #0x03          @ r2 = 0x03
<br/>
 add     r1, r2             @ r1 += r2
<br/>
 bic     r1, r2             @ \
<br/>
 beq     .LClearMX          @  if(!((r1 += 0x03) &amp;~ 0x03)) branch to .LClearMX
<br/>
<br/>
 mov     r2, #0x40
<br/>
 lsl     r2, r2, #0x14
<br/>
 add     r2, r2, #0xD0
<br/>
 lsr     r1, #0x02
<br/>
 
<br/>
 adr     r3, .LClrVal
<br/>
 str     r3, [r2, #0x4]
<br/>
 str     r0, [r2, #0x8]
<br/>
 strh    r1, [r2, #0xC]
<br/>
 mov     r1, #0x85
<br/>
 lsl     r1, r1, #0x08
<br/>
 strh    r1, [r2, #0xE]
<br/>
<br/>
.LClearMX:
<br/>
 bx      lr                 @ bx to lr
<br/>
<br/>
.LCopyMemChk:
<br/>
 sub     r3, r4, r2         @ r3 = r4 - r2
<br/>
<br/>
.LCopyMem:
<br/>
 mov     r0, #0x03          @ r0 = 0x03
<br/>
 add     r3, r0             @ r3 += r0
<br/>
 bic     r3, r0             @ \
<br/>
 beq     .LCIDExit          @  if(r3 == 0) branch to .LCIDExit
<br/>
<br/>
 mov     r0, #0x40
<br/>
 lsl     r0, r0, #0x14
<br/>
 add     r0, r0, #0xD0
<br/>
 lsr     r3, #0x02
<br/>
 
<br/>
 str     r1, [r0, #0x4]
<br/>
 str     r2, [r0, #0x8]
<br/>
 strh    r3, [r0, #0xC]
<br/>
 mov     r3, #0x84
<br/>
 lsl     r3, r3, #0x08
<br/>
 strh    r3, [r0, #0xE]
<br/>
<br/>
.LCIDExit:
<br/>
 bx      lr
<br/>
<br/>
.align
<br/>
<br/>
.LClrVal:
<br/>
 .word 0x00000000
<br/>
<br/>
.align
<br/>
.pool
<br/>
<br/>
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
<br/>
<br/>
.section .iwram, "ax", %progbits
<br/>
.extern  IntrTable
<br/>
.global  IntrRout
<br/>
.align
<br/>
.arm
<br/>
<br/>
IntrRout:
<br/>
 mov     r2, #0x04000000          @ r2 = REG_BASE
<br/>
 ldr     r3, [r2,#0x0200]!        @ r2 = REG_IE, r3 = REG_IF&lt;&lt;16 | REG_IE
<br/>
 mrs     r0, spsr                 @ save spsr to r0
<br/>
 stmfd   sp!, {r0-r2, lr}         @ push {r0-r2, lr}
<br/>
 and     r1, r3, r3, lsr #0x10    @ r1 = REG_IE &amp; REG_IF
<br/>
 ldr     r12, =IntrTable          @ r12 = &amp;IntrTable
<br/>
 
<br/>
 ands    r0, r1, #0x01            @ \
<br/>
 bne     .LIntrGo                 @  if(r0 = r1 &amp; 0x0001) VBL intr
<br/>
 add     r12,r12, #0x04           @ r12 += 4
<br/>
 ands    r0, r1, #0x02            @ \
<br/>
 bne     .LIntrGo                 @  if(r0 = r1 &amp; 0x0002) HBL intr
<br/>
 add     r12,r12, #0x04           @ r12 += 4
<br/>
 ands    r0, r1, #0x04            @ \
<br/>
 bne     .LIntrGo                 @  if(r0 = r1 &amp; 0x0004) VCNT intr
<br/>
 add     r12,r12, #0x04           @ r12 += 4
<br/>
 ands    r0, r1, #0x08            @ \
<br/>
 bne     .LIntrGo                 @  if(r0 = r1 &amp; 0x0008) TM0 intr
<br/>
 add     r12,r12, #0x04           @ r12 += 4
<br/>
 ands    r0, r1, #0x10            @ \
<br/>
 bne     .LIntrGo                 @  if(r0 = r1 &amp; 0x0010) TM1 intr
<br/>
 add     r12,r12, #0x04           @ r12 += 4
<br/>
 ands    r0, r1, #0x20            @ \
<br/>
 bne     .LIntrGo                 @  if(r0 = r1 &amp; 0x0020) TM2 intr
<br/>
 add     r12,r12, #0x04           @ r12 += 4
<br/>
 ands    r0, r1, #0x40            @ \
<br/>
 bne     .LIntrGo                 @  if(r0 = r1 &amp; 0x0040) TM3 intr
<br/>
 add     r12,r12, #0x04           @ r12 += 4
<br/>
 ands    r0, r1, #0x80            @ \
<br/>
 bne     .LIntrGo                 @  if(r0 = r1 &amp; 0x0080) serial intr
<br/>
 add     r12,r12, #0x04           @ r12 += 4
<br/>
 ands    r0, r1, #0x100           @ \
<br/>
 bne     .LIntrGo                 @  if(r0 = r1 &amp; 0x0100) DMA0 intr
<br/>
 add     r12,r12, #0x04           @ r12 += 4
<br/>
 ands    r0, r1, #0x200           @ \
<br/>
 bne     .LIntrGo                 @  if(r0 = r1 &amp; 0x0200) DMA1 intr
<br/>
 add     r12,r12, #0x04           @ r12 += 4
<br/>
 ands    r0, r1, #0x400           @ \
<br/>
 bne     .LIntrGo                 @  if(r0 = r1 &amp; 0x0400) DMA2 intr
<br/>
 add     r12,r12, #0x04           @ r12 += 4
<br/>
 ands    r0, r1, #0x800           @ \
<br/>
 bne     .LIntrGo                 @  if(r0 = r1 &amp; 0x0800) DMA3 intr
<br/>
 add     r12,r12, #0x04           @ r12 += 4
<br/>
 ands    r0, r1, #0x1000          @ \
<br/>
 bne     .LIntrGo                 @  if(r0 = r1 &amp; 0x1000) keypad intr
<br/>
 
<br/>
 ands    r0, r1, #0x2000
<br/>
 strneb  r0, [r2, #-0x0284]       @ REG_SNDCNT1 = r0
<br/>
<br/>
.LsndLoop:
<br/>
 swine   0x02
<br/>
 bne     .LsndLoop                @ branch to .LsndLoop
<br/>
<br/>
.LIntrGo:
<br/>
 strh    r0, [r2, #0x02]          @ REG_IF = r0
<br/>
 ldr     r3, [r2, #-0x0208]       @ r3 = BIOS_IF
<br/>
 orr     r3, r3, r0               @ r3 |= r0
<br/>
 str     r3, [r2, #-0x0208]       @ BIOS_IF = r3
<br/>
 
<br/>
 mrs     r3, cpsr                 @ save cpsr
<br/>
 bic     r3, r3, #0xDF            @ r3 &amp;= ~0xDF (clear)
<br/>
 orr     r3, r3, #0x1F            @ r3 |= 0x1F (IRQ + system mode?)
<br/>
 msr     cpsr, r3                 @ restore cpsr
<br/>
 
<br/>
 ldr     r0, [r12]                @ get the handler's address
<br/>
 cmp     r0, #0x00                @ \
<br/>
 beq     .LIntrPostRet            @  if(adr == 0x00) goto .LIntrPostRet
<br/>
 
<br/>
 stmfd   sp!, {lr}                @ push {lr}
<br/>
 adr     lr, .LIntrRet            @ lr = .LIntrRet
<br/>
 bx      r0                       @ bx to r0
<br/>
<br/>
.LIntrRet:
<br/>
 ldmfd   sp!, {lr}                @ pop {lr}
<br/>
<br/>
.LIntrPostRet:
<br/>
 mrs     r3, cpsr                 @ save cpsr
<br/>
 bic     r3, r3, #0xDF            @ r3 &amp;= ~0xDF (clear)
<br/>
 orr     r3, r3, #0x92            @ r3 |= 0x92 (FIQ + IRQ mode?)
<br/>
 msr     cpsr, r3                 @ store cpsr
<br/>
 
<br/>
 ldmfd   sp!, {r0-r2, lr}         @ pop {r0-r2, lr}
<br/>
 msr     spsr, r0                 @ restore spsr
<br/>
 bx      lr                       @ bx to lr
<br/>
<br/>
.align
<br/>
.end</td> </tr></table><span class="postbody">
<br/>
<br/>
And this is the batch script:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">@echo off
<br/>
setlocal enabledelayedexpansion
<br/>
path=%path%;C:\devKitPro\devKitARM\bin;
<br/>
<br/>
set pre=arm-eabi
<br/>
set gas=%pre%-as
<br/>
set gcc=%pre%-gcc
<br/>
set fix=gbafix
<br/>
set cpy=%pre%-objcopy
<br/>
set nm=%pre%-nm
<br/>
set sflags=-mthumb-interwork
<br/>
set cflags=-c -mthumb -mthumb-interwork -O2 -ffast-math -ffreestanding -Wall
<br/>
<br/>
cd source
<br/>
for %%f in (*.s) do (
<br/>
 %gas% %sflags% %%f -o %%f.o
<br/>
 move %%f.o ..
<br/>
)
<br/>
for %%f in (*.c) do (
<br/>
 %gcc% %cflags% -I../include %%f -o %%f.o
<br/>
 move %%f.o ..
<br/>
)
<br/>
cd..
<br/>
<br/>
set obj=
<br/>
for %%f in (*.o) do set obj=!obj! %%f
<br/>
%gcc% %obj% -o main.elf -nostartfiles -T misc/lnkscript.ld
<br/>
%cpy% -O binary main.elf main.gba
<br/>
%nm% -n -S main.elf &gt; main.txt
<br/>
%fix% main.gba -p
<br/>
del *.o *.elf /q
<br/>
pause</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#155717 - eKid - Sat May 03, 2008 9:55 am</h4>
    <div class="postbody"><span class="postbody">Did you try without a custom linkscript? (ie remove the -T options) The crt0 code doesn't look like it would break if it used the normal linkscript.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#155718 - Ruben - Sat May 03, 2008 9:57 am</h4>
    <div class="postbody"><span class="postbody">Yeah, I've tried that. Lot's and lots of undefined references. This is the result:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">0.s.o: In function `start_vector':
<br/>
(.text+0x18c): undefined reference to `__sp_irq'
<br/>
0.s.o: In function `start_vector':
<br/>
(.text+0x190): undefined reference to `__sp_usr'
<br/>
0.s.o: In function `start_vector':
<br/>
(.text+0x194): undefined reference to `__intr_vector_buf'
<br/>
0.s.o: In function `start_vector':
<br/>
(.text+0x19c): undefined reference to `__sp_usr_offset'
<br/>
0.s.o: In function `start_vector':
<br/>
(.text+0x1a0): undefined reference to `__data_lma'
<br/>
0.s.o: In function `start_vector':
<br/>
(.text+0x1a8): undefined reference to `__data_end'
<br/>
0.s.o: In function `start_vector':
<br/>
(.text+0x1ac): undefined reference to `__iwram_lma'
<br/>
0.s.o: In function `start_vector':
<br/>
(.text+0x1b0): undefined reference to `__iwram_start'
<br/>
0.s.o: In function `start_vector':
<br/>
(.text+0x1b4): undefined reference to `__iwram_end'
<br/>
0.s.o: In function `start_vector':
<br/>
(.text+0x1b8): undefined reference to `__load_stop_iwram0'
<br/>
0.s.o: In function `start_vector':
<br/>
(.text+0x1bc): undefined reference to `__load_start_iwram0'
<br/>
0.s.o: In function `start_vector':
<br/>
(.text+0x1c0): undefined reference to `__iwram_overlay_start'
<br/>
0.s.o: In function `start_vector':
<br/>
(.text+0x1c4): undefined reference to `__ewram_lma'
<br/>
0.s.o: In function `start_vector':
<br/>
(.text+0x1c8): undefined reference to `__ewram_start'
<br/>
0.s.o: In function `start_vector':
<br/>
(.text+0x1cc): undefined reference to `__ewram_end'
<br/>
0.s.o: In function `start_vector':
<br/>
(.text+0x1d0): undefined reference to `__load_stop_ewram0'
<br/>
0.s.o: In function `start_vector':
<br/>
(.text+0x1d4): undefined reference to `__load_start_ewram0'
<br/>
0.s.o: In function `start_vector':
<br/>
(.text+0x1d8): undefined reference to `__ewram_overlay_start'
<br/>
collect2: ld returned 1 exit status</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#155719 - eKid - Sat May 03, 2008 10:07 am</h4>
    <div class="postbody"><span class="postbody">Hmm, those symbols <span style="font-style: italic">are</span> defined in the latest gba linkscripts. Maybe try adding -specs=gba_cart.specs or -specs=gba_mb.specs (for multiboot)? :\</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#155720 - Ruben - Sat May 03, 2008 10:13 am</h4>
    <div class="postbody"><span class="postbody">Not all of them
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">0.s.o: In function `start_vector':
<br/>
(.text+0x194): undefined reference to `__intr_vector_buf'
<br/>
0.s.o: In function `start_vector':
<br/>
(.text+0x19c): undefined reference to `__sp_usr_offset'
<br/>
0.s.o: In function `start_vector':
<br/>
(.text+0x1d0): undefined reference to `__load_stop_ewram0'
<br/>
0.s.o: In function `start_vector':
<br/>
(.text+0x1d4): undefined reference to `__load_start_ewram0'
<br/>
0.s.o: In function `start_vector':
<br/>
(.text+0x1d8): undefined reference to `__ewram_overlay_start'
<br/>
collect2: ld returned 1 exit status</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#155722 - eKid - Sat May 03, 2008 10:20 am</h4>
    <div class="postbody"><span class="postbody">Hmm, looks like __intr_vector_buf is the user irq vector. You can change
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">ldr     r1, =__intr_vector_buf</td> </tr></table><span class="postbody">
<br/>
to
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">ldr    r1,=0x3007FFC</td> </tr></table><span class="postbody">
<br/>
For __sp_usr_offset..... and the rest... you'll have to find  the addresses for them... :D
<br/>
Why aren't you using the r23 crt0.s? :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#155725 - Ruben - Sat May 03, 2008 10:37 am</h4>
    <div class="postbody"><span class="postbody">Heh. Couldn't find the address for all of them and when I use the "gba_crt.s" file, it gets stuck clearing something. Technically:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">.Lloop:
<br/>
 stmia r0!, {r2}
<br/>
 sub   r1, #0x04
<br/>
 bne   .Lloop</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#155733 - strager - Sat May 03, 2008 4:17 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ruben wrote:</b></span></td> </tr> <tr> <td class="quote">Heh. Couldn't find the address for all of them and when I use the "gba_crt.s" file, it gets stuck clearing something. Technically:
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">.Lloop:
<br/>
 stmia r0!, {r2}
<br/>
 sub   r1, #0x04
<br/>
 bne   .Lloop</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
<br/>
Looks like that <span style="font-style: italic">sub</span> should be a <span style="font-style: italic">subs</span> (not exactly sure):
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">.Lloop:
<br/>
 stmia r0!, {r2}
<br/>
 subs   r1, #0x04
<br/>
 bne   .Lloop</td> </tr></table><span class="postbody">
<br/>
<br/>
Check if the latest CVS/SVN has this issue, or file a bug report.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#155751 - wintermute - Sat May 03, 2008 9:14 pm</h4>
    <div class="postbody"><span class="postbody">Are you using devkitARM release 23?
<br/>
<br/>
Unfortunately the vast majority of code using the old custom crt0 &amp; linkscripts will break horribly with devkitARM these days.
<br/>
<br/>
It's also best not to use .bat files.
<br/>
<br/>
From the look of your path you appear to have installed the toolchain manually. On windows it's really best that you use the devkitPro updater and let it handle all the finer points of installation.
<br/>
<br/>
What I would suggest doing is deleting what you have installed so far and running the devkitPro Updater instead. Once that has done it's thing your best course of action is probably to work through the Tonc documentation. There is a template and some libgba examples provided through the installer but I lack the time to update and maintain that library - libtonc is much more complete and better documented.
<br/>
<br/>
<a href="http://www.coranac.com/tonc/text/" target="_blank">http://www.coranac.com/tonc/text/</a><br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#155781 - Ruben - Sun May 04, 2008 5:26 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Looks like that sub should be a subs (not exactly sure)</td> </tr></table><span class="postbody">
<br/>
Nah, it's fine using 'sub' since  that section runs in THUMB mode.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">From the look of your path you appear to have installed the toolchain manually.</td> </tr></table><span class="postbody">
<br/>
... ... ... all I did was use the devKitPro updater and it extracted there... :-S
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">...your best course of action is probably to work through the Tonc documentation.</td> </tr></table><span class="postbody">
<br/>
Yeah, TONC's really good but I'm using my one custom library (yeah, I'm a bit odd lol) with in-built support for S3M, XM, MOD, palette fading and all the other stuff I need. For some reason I really like using my own code. Lol.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#155782 - wintermute - Sun May 04, 2008 5:56 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ruben wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">From the look of your path you appear to have installed the toolchain manually.</td> </tr></table><span class="postbody">
<br/>
... ... ... all I did was use the devKitPro updater and it extracted there... :-S
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Oh I see, taking advantage of Windows case insensitivity for random capitalisation then ;)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">...your best course of action is probably to work through the Tonc documentation.</td> </tr></table><span class="postbody">
<br/>
Yeah, TONC's really good but I'm using my one custom library (yeah, I'm a bit odd lol) with in-built support for S3M, XM, MOD, palette fading and all the other stuff I need. For some reason I really like using my own code. Lol.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Well, there's nothing particularly wrong with using your own code. Using a custom crt0 &amp; linkscript from an obsolete tool is going to cause you nothing but grief though.
<br/>
<br/>
The crt0 and linkscript files in devkitARM were designed to give people more control over code without having to mess with the system files that should <span style="font-weight: bold">never</span> be modified by end users. I really do recommend you use the built in files and makefiles in preference to .bat, this will save you from much heartache in the long run.
<br/>
<br/>
For interrupt code feel free to steal what you need from libgba, the dispatcher used there is considerably simpler and actually more flexible than the madness in that original crt0. Cearn also has a pretty good writeup on interrupt handling in Tonc somewhere
<br/>
<br/>
The template libgba project distributed with the gba examples is also pretty flexible and will allow you to use make without having to understand the Makefile syntax. You'll also have the advantage of advanced auto dependency generation which is pretty much impossible to provide with bat files. It doesn't force you to use libgba, just remove -lgba from LIBS &amp; $(LIBGBA) from LIBDIRS. Code goes in the source folder, makefile does the rest.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
