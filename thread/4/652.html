<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>volatile error while it is not in the program - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Coding > volatile error while it is not in the program</h2>
<div id="posts">
<div class="post">
    <h4>#3351 - Lionheart - Sun Feb 23, 2003 11:34 am</h4>
    <div class="postbody"><span class="postbody">when I want to compile my program using Devkitadvs' GCC I always get the same error:
<br/>
Koelogotest.c:12: parse error before "volatile"
<br/>
I know that that means that I used a wrong code or something before "volatile" in line 12, but the problem is that I don't have the word volatile in my whole program!
<br/>
<br/>
here is the code of my whole program:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include"gba.h"
<br/>
char f =0;
<br/>
<br/>
#include "screenmode.h"
<br/>
#include "KOElogo.h"
<br/>
#include "timers.h"
<br/>
#include "screenmodes.h"
<br/>
#include "clrhome.h"
<br/>
#include "Flogo.h"
<br/>
<br/>
u16* FrontBuffer = (u16*)0x6000000;
<br/>
u16* BackBuffer = (u16*)0x600A000;
<br/>
u16* videoBuffer;
<br/>
<br/>
u16* paletteMem = (u16*)0x5000000;
<br/>
<br/>
void PlotPixel(int x,int y, unsigned short int c) {FrontBuffer[(y) *120 + (x)] = (c);}
<br/>
<br/>
#define RGB(r,g,b) (r+(g&lt;&lt;5)+(b&lt;&lt;10))
<br/>
<br/>
int main(void)
<br/>
{
<br/>
   SetMode(MODE_4 | BG2_ENABLE);   
<br/>
<br/>
   int x, y, z;
<br/>
   z=0;
<br/>
   for(x = 0; x &lt; 256; x++)
<br/>
      paletteMem[x] = KOElogoPalette[x];
<br/>
   for(y = 0; y &lt; 160; y++)
<br/>
   {
<br/>
      for(x = 0; x &lt; 120; x++)
<br/>
<br/>
      {
<br/>
         PlotPixel(x,y,KOElogoData[y*120+x]);
<br/>
<br/>
      }
<br/>
   }
<br/>
   for (z = 0; z &lt; 20000; z++ ) 
<br/>
      {}
<br/>
 
<br/>
   z=0;
<br/>
   for(x = 0; x &lt; 256; x++)
<br/>
      paletteMem[x] = clrhomePalette[x];
<br/>
   for(y = 0; y &lt; 160; y++)
<br/>
   {
<br/>
      for(x = 0; x &lt; 120; x++)
<br/>
<br/>
      {
<br/>
         PlotPixel(x,y,clrhomeData[y*120+x]);
<br/>
<br/>
      }
<br/>
   }
<br/>
   
<br/>
   z=0;
<br/>
   for(x = 0; x &lt; 256; x++)
<br/>
      paletteMem[x] = FlogoPalette[x];
<br/>
   for(y = 0; y &lt; 160; y++)
<br/>
   {
<br/>
      for(x = 0; x &lt; 120; x++)
<br/>
<br/>
      {
<br/>
         PlotPixel(x,y,FlogoData[y*120+x]);
<br/>
<br/>
      }
<br/>
   }
<br/>
   for (z = 0; z &lt; 20000; z++) 
<br/>
      {}
<br/>
}
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
sorry for the length but line 12 is the line with: 
<br/>
u16* BackBuffer = (u16*)0x600A000;
<br/>
<br/>
thanks<br/>_________________<br/>"You PLAY games? Pathetic!"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#3356 - col - Sun Feb 23, 2003 2:43 pm</h4>
    <div class="postbody"><span class="postbody">have you checked the *.h files that you are including, if one of them is faulty, it could be tripping the compiler into giving you a seemingly false line number?
<br/>
<br/>
cheers
<br/>
<br/>
Col.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#3357 - Lionheart - Sun Feb 23, 2003 2:51 pm</h4>
    <div class="postbody"><span class="postbody">yes, I have checked them and there seems to be no problem, because they work with other progams as well. HELP!
<br/>
Maybe someone can try to make the .bin file when he copies the code and makes 3 pictures with the names given in the code? If it works then something must be wrong with my compiler.<br/>_________________<br/>"You PLAY games? Pathetic!"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#3375 - CoolMan - Sun Feb 23, 2003 7:27 pm</h4>
    <div class="postbody"><span class="postbody">GCC can get confused about what causes a parse error, but it does not get confused about the line number that it hit when it detected the error. (GCC explicitely details what file the error is in if the error is nested.)
<br/>
<br/>
However, the preprocessor is what replaces typedefs like 'u8' with 'unsigned char' (which is what the compiler recognizes). If one of your typedefs (for u16, or whatever) defines it a volatile, then thats why GCC is using that as it's error referance point.
<br/>
<br/>
As for the actual cause of the error, the only thing i see that might freak out the compiler is...
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
for (z = 0; z &lt; 20000; z++) {}
<br/>
</td> </tr></table><span class="postbody">
<br/>
I don't think that should parse at all, but if it does, it might go into an infinite loop in your first case... 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
for (z = 0; z &lt; 20000; z++ )
<br/>
      {}
<br/>
<br/>
   z=0;
<br/>
</td> </tr></table><span class="postbody">
<br/>
Might just translate to...
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
for (z = 0; z &lt; 20000; z++ ) /* {} was ignored... */ z=0;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I would suggest replacing "for (z = 0; z &lt; 20000; z++ ) {}" with "for (z = 0; z &lt; 20000; z++ ) { ; }"...
<br/>
<br/>
Other then that, I don't see your error with just a quick glance.
<br/>
<br/>
I might try running it through my compiler later, but I gotta end this post and go eat lunch now. :)
<br/>
<br/>
Hope it works out.<br/>_________________<br/>Moron! You don't herd chickens with a shotgun!
<br/>
<br/>
--CoolMan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#3959 - Paul Shirley - Thu Mar 13, 2003 7:53 pm</h4>
    <div class="postbody"><span class="postbody">removed</span><span class="gensmall"><br/><br/>Last edited by Paul Shirley on Sun Mar 28, 2004 9:53 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#3968 - tepples - Thu Mar 13, 2003 11:41 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Paul Shirley wrote:</b></span></td> </tr> <tr> <td class="quote">Its a problem because you cannot see what the compiler is trying to compile</td> </tr></table><span class="postbody">
<br/>
Doesn't GCC have a way to store the preprocessor output?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">If your headers defined it this way an error would have been thrown that made more sense
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">static u16*const  FrontBuffer      =(u16*)0x6000000;
<br/>
static u16*const  BackBuffer       =(u16*)0x600A000;
<br/>
</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
In my experience, collisions with names of macros are rare if your header files always name macros in all caps.  For instance, the corresponding macros from my header file:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define VRAM (u16 *)0x06000000
<br/>
#define VRAM_BACKBUF (u16 *)0x0600a000
<br/>
</td> </tr></table><span class="postbody">
<br/>
By using names designed not to collide, I don't have any problems.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">The moral is: #define is evil, wherever possible replace its use.</td> </tr></table><span class="postbody">
<br/>
But can you always trust a compiler to expand an inline function inline and to reduce functions of constant values to constant values themselves?  For example, I have the following in my GBA header:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define RGB(r, g, b) (((r) &lt;&lt; 0) | ((g) &lt;&lt; 5) | ((b) &lt;&lt; 10))</td> </tr></table><span class="postbody">
<br/>
The inline function equivalent:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">static inline int RGB(int r, int g, int b)
<br/>
{
<br/>
  return (((r) &lt;&lt; 0) | ((g) &lt;&lt; 5) | ((b) &lt;&lt; 10));
<br/>
}</td> </tr></table><span class="postbody">
<br/>
Are C++ compilers guaranteed to expand a pure function inline and reduce it to a constant value when the function is called with constant arguments?  Or will I take a performance hit from repeated function calls?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">You may need to compile as C++ to get maximum benefit but there are plenty of reasons to do that anyway.</td> </tr></table><span class="postbody">
<br/>
Like a larger binary footprint (especially important for multiboot programs)?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#3971 - Paul Shirley - Fri Mar 14, 2003 1:17 am</h4>
    <div class="postbody"><span class="postbody">removed</span><span class="gensmall"><br/><br/>Last edited by Paul Shirley on Sun Mar 28, 2004 9:54 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#3973 - tepples - Fri Mar 14, 2003 5:15 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Paul Shirley wrote:</b></span></td> </tr> <tr> <td class="quote">(And you're missing a set of brackets in those #defines if you want maximum error checking;)</td> </tr></table><span class="postbody">
<br/>
Actually, that wasn't cut and paste.  I just checked my real header files, and they do have the parentheses in the proper places.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">'Inappropriate use is evil' is probably a better way to put it.</td> </tr></table><span class="postbody">
<br/>
For each developer's definition of "inappropriate".
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Making things that look like variables or functions is rarely appropriate.</td> </tr></table><span class="postbody">
<br/>
Except when the overhead from renaming your .c files to .cpp and changing clever preprocessor tricks into enum constants and static inline functions is enough to put your binary over the 4 MB mark or your game loop over the 280896 cycle mark because g++ has some optimization deficiencies.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
