<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>When are you supposed to use DMA? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Coding > When are you supposed to use DMA?</h2>
<div id="posts">
<div class="post">
    <h4>#23677 - benjamin - Sun Jul 18, 2004 7:31 pm</h4>
    <div class="postbody"><span class="postbody">Are there a set of well known circumstances where DMA is called for and where it is not? I see it used in various techniques and places, but its not clear when it should and shouldn't be used..</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23679 - Abscissa - Sun Jul 18, 2004 7:37 pm</h4>
    <div class="postbody"><span class="postbody">From what I gather, it shouldn't be used in most of the places that you see it used.  But I have to admit, I'm a little unclear too on where it's is/isn't fast enough.  I'm interested in the answer to this as well...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23683 - poslundc - Sun Jul 18, 2004 8:13 pm</h4>
    <div class="postbody"><span class="postbody">DMA is generally useful when copying medium-sized to large chunks of data. Smaller than 32 bytes or so it probably isn't worth it, on account of the setup time.
<br/>
<br/>
DMA is generally faster than manual copying of data because there is no overhead of looping and checking variables, but the memory access times remain the same, and the CPU is suspended while the DMA is active, so it's important to understand that while it is generally faster for large copies, it doesn't magically transfer the data instantaneously or anything.
<br/>
<br/>
DMA with a fixed source (for example, to fill a region of memory with a constant value) is generally slower than manual copying because the DMA has to reload the source for every copy. Consider using the CPUFastSet BIOS routine instead.
<br/>
<br/>
Also, because DMA halts the CPU it can interefere with your interrupts, so it's important to either make sure you aren't using the DMA when you need your interrupts to fire, or keep the transfers small enough so that they won't cause a timing problem.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23685 - Miked0801 - Sun Jul 18, 2004 9:09 pm</h4>
    <div class="postbody"><span class="postbody">Well stated :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23694 - rusty - Mon Jul 19, 2004 12:55 am</h4>
    <div class="postbody"><span class="postbody">So....if I wanted to transfer map data into buffers in main-RAM for a scrolling bacground larger than the virtual screen size, DMA transfers would be best used for this?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23700 - sajiimori - Mon Jul 19, 2004 1:20 am</h4>
    <div class="postbody"><span class="postbody">Why not load the map data straight from ROM, rather than using a RAM buffer?  It might be a little faster to load from RAM, but the speed difference won't generally be significant compared to the RAM usage.  Chances are your bottlenecks lie elsewhere.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23703 - rusty - Mon Jul 19, 2004 3:44 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">Why not load the map data straight from ROM, rather than using a RAM buffer?  It might be a little faster to load from RAM, but the speed difference won't generally be significant compared to the RAM usage.  Chances are your bottlenecks lie elsewhere.</td> </tr></table><span class="postbody">
<br/>
<br/>
I'm just speculating at this point, as  I'm in the process of writting my map-scroller.  I'm considering using a RAM buffer because as the screen scrolls, it only replaces a column or a row of tile data at any given time.
<br/>
<br/>
I was just worried that the time to copy direct from ROM to VRAM would be huge compared to RAM.  But I guess if it's not a big deal, that reall simplifies things for me...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23704 - sajiimori - Mon Jul 19, 2004 4:55 am</h4>
    <div class="postbody"><span class="postbody">As a rule, keep things simple until speed actually becomes a problem.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23705 - rusty - Mon Jul 19, 2004 4:58 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">As a rule, keep things simple until speed actually becomes a problem.</td> </tr></table><span class="postbody">
<br/>
<br/>
Thanks for the advice. There were more issues that speed that I was concerned about though (I won;t go into them all here).  
<br/>
<br/>
But I'll take your adivce and just directly from ROM.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23712 - poslundc - Mon Jul 19, 2004 12:06 pm</h4>
    <div class="postbody"><span class="postbody">One column of a text map is 40 bytes. A row is 60 bytes. Assuming you are copying only once per frame during VBlank, neither is a very big deal.
<br/>
<br/>
To put things in perspective, remember that for less than 32 bytes it's practically not worth using the DMA anyway just because of the time it takes to setup the three registers.
<br/>
<br/>
You need to start thinking through the timing logistics before implementation more when you're dealing with data amounts on the order of 40-60K, not 40-60 bytes.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
