<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>sprite rotation problem - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > sprite rotation problem</h2>
<div id="posts">
<div class="post">
    <h4>#17247 - hakanyuksel - Fri Mar 05, 2004 12:22 am</h4>
    <div class="postbody"><span class="postbody">I am trying to rotate a 64x64 sprite in mode 0. When I enable sprite rotation the sprite become a solid one color 64x64(I tried 16x16 it is still happening) box. I dont know why does it happen. I have read all the documents on the web, 
<br/>
 I am using HAM and my code is here:
<br/>
<br/>
#include &lt;math.h&gt;
<br/>
#include "memory.h"
<br/>
#include "graphics.h"
<br/>
#include "data.h"
<br/>
#include "game.h"
<br/>
#include "keyboard.h"
<br/>
<br/>
volatile const int __gba_multiboot = 1;
<br/>
<br/>
int main(void)
<br/>
{
<br/>
    unsigned short *sprite_attribute_memory = ( unsigned short* ) 0x7000000
<br/>
    *( unsigned short* ) 0x4000000 = (1&lt;&lt;12)|(1&lt;&lt;6);
<br/>
    copy_data_to_vram(); // I copy the sprite data and palet to vram here
<br/>
    wait_vblank();
<br/>
    sprite_attribute_memory[ 0 ] = SPR_COLOR_256 |(1&lt;&lt;8);
<br/>
    sprite_attribute_memory[ 1 ] = SPR_SIZE_64;
<br/>
    sprite_attribute_memory[ 2 ] = 0;
<br/>
    sprite_attribute_memory[ 6 ] = cos_table[100]&gt;&gt;8;
<br/>
    sprite_attribute_memory[ 7 ] = sin_table[100]&gt;&gt;8;
<br/>
    sprite_attribute_memory[ 14] = -sin_table[100]&gt;&gt;8;
<br/>
    sprite_attribute_memory[ 15] = cos_table[100]&gt;&gt;8;
<br/>
    while(1) {} 
<br/>
    return 0;
<br/>
}<br/>_________________<br/>--------------------
<br/>
Hakan Yuksel
<br/>
3TE GAmes
<br/>
<a href="http://www.3tegames.com" target="_blank">www.3tegames.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17249 - yaustar - Fri Mar 05, 2004 12:48 am</h4>
    <div class="postbody"><span class="postbody">What does the array bit here mean?
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">Â sprite_attribute_memory[ 0 ] = SPR_COLOR_256 |(1&lt;&lt;8);
<br/>
sprite_attribute_memory[ 1 ] = SPR_SIZE_64;
<br/>
sprite_attribute_memory[ 2 ] = 0;
<br/>
sprite_attribute_memory[ 6 ] = cos_table[100]&gt;&gt;8;
<br/>
sprite_attribute_memory[ 7 ] = sin_table[100]&gt;&gt;8;
<br/>
sprite_attribute_memory[ 14] = -sin_table[100]&gt;&gt;8;
<br/>
sprite_attribute_memory[ 15] = cos_table[100]&gt;&gt;8;</td> </tr></table><span class="postbody"><br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17250 - tepples - Fri Mar 05, 2004 1:19 am</h4>
    <div class="postbody"><span class="postbody">If a rot/scale sprite becomes one solid color the same as that of the pixel in the center, that means that you either aren't copying the rot/scale matrix into OAM or your sprite isn't referencing it. I think you meant to put the values in indices 3, 7, 11, and 15 rather than 6, 7, 14, and 15.
<br/>
<br/>
In addition, what fixed-point precision are your cos_table[] and sin_table[] stored at? The computations you gave (with the change in the destination indices) are correct for a 16.16 table.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17251 - hakanyuksel - Fri Mar 05, 2004 1:27 am</h4>
    <div class="postbody"><span class="postbody">it is the memory of the attributes. I didnt make a structure.
<br/>
So 
<br/>
<br/>
unsigned short *sprite_attribute_memory =( unsigned short* ) 0x7000000;
<br/>
<br/>
1st sprite atributes
<br/>
atribute 0 =sprite_attribute_memory[0];
<br/>
atribute 1 =sprite_attribute_memory[1];
<br/>
atribute 2 =sprite_attribute_memory[2];
<br/>
<br/>
2nd sprite attributes
<br/>
atribute 0 =sprite_attribute_memory[3];
<br/>
atribute 1 =sprite_attribute_memory[4];
<br/>
atribute 2 =sprite_attribute_memory[5];
<br/>
<br/>
1st rotation and scale infomation
<br/>
pa1 = sprite_attribute_memory[6];
<br/>
pb1 = sprite_attribute_memory[7];
<br/>
<br/>
3rd sprite atributes
<br/>
atribute 0 =sprite_attribute_memory[8];
<br/>
atribute 1 =sprite_attribute_memory[9];
<br/>
atribute 2 =sprite_attribute_memory[10];
<br/>
<br/>
4th sprite attributes
<br/>
atribute 0 =sprite_attribute_memory[11];
<br/>
atribute 1 =sprite_attribute_memory[12];
<br/>
atribute 2 =sprite_attribute_memory[13];
<br/>
<br/>
1st rotation and scale infomation
<br/>
pc1 = sprite_attribute_memory[14];
<br/>
pd1 = sprite_attribute_memory[15];
<br/>
<br/>
.....
<br/>
and so on
<br/>
<br/>
As I read from the documents
<br/>
1. Attributes are 16 bit
<br/>
2. After every 6 atributes there is a rotation 2 rotation/scale information
<br/>
3. You tell in attribute1 what rotation/scale information will be used<br/>_________________<br/>--------------------
<br/>
Hakan Yuksel
<br/>
3TE GAmes
<br/>
<a href="http://www.3tegames.com" target="_blank">www.3tegames.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17252 - hakanyuksel - Fri Mar 05, 2004 1:50 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">If a rot/scale sprite becomes one solid color the same as that of the pixel in the center, that means that you either aren't copying the rot/scale matrix into OAM or your sprite isn't referencing it. I think you meant to put the values in indices 3, 7, 11, and 15 rather than 6, 7, 14, and 15.</td> </tr></table><span class="postbody">
<br/>
I am a little confused about this rotation and scale things. 
<br/>
I am not using an external array of sprites I work on directly OAM memory;is it bad? 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
In addition, what fixed-point precision are your cos_table[] and sin_table[] stored at? The computations you gave (with the change in the destination indices) are correct for a 16.16 table.</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
heres my code for the tables
<br/>
<br/>
#define PI 3.14159265
<br/>
#define RADIAN(angle) ((float)angle / (float)180 * PI)
<br/>
<br/>
signed int cos_table[360];
<br/>
signed int sin_table[360];
<br/>
<br/>
void calculate_tables_1()
<br/>
{
<br/>
    unsigned int i;
<br/>
    for(i=0;1&lt;360;i++)
<br/>
    {
<br/>
        cos_table[i]=(signed int)sin(RADIAN(i))*256;
<br/>
        sin_table[i]=(signed int)sin(RADIAN(i))*256;
<br/>
    }
<br/>
}<br/>_________________<br/>--------------------
<br/>
Hakan Yuksel
<br/>
3TE GAmes
<br/>
<a href="http://www.3tegames.com" target="_blank">www.3tegames.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17256 - tepples - Fri Mar 05, 2004 3:03 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>hakanyuksel wrote:</b></span></td> </tr> <tr> <td class="quote">I work on directly OAM memory;is it bad?</td> </tr></table><span class="postbody">
<br/>
As long as you fit your changes into vblank time, it's not bad at all.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">heres my code for the tables </td> </tr></table><span class="postbody">
<br/>
Your trig table is in fact .8 as opposed to .16.
<br/>
<br/>
Five things to point out:
<br/>
<ol type="1"><li>A table of 512 values will be faster in practice than a table of 360 values because platforms without a hardware divide instruction (such as ARM7TDMI) handle the % operation (which reflects angles into the domain of your table) much faster when the divisor is a power of 2.</li><li>Pre-calculate your table on a PC instead of doing floating-point trig computations on the GBA.</li><li>With a .8 fixed-point format, you could make the table of type 'signed short' to save RAM.</li><li>You could make 'cos' an inline function that calls 'sin' to save more RAM.</li><li>Most importantly: Lose the "&gt;&gt;8" in your code.</li></ol><br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17306 - hakanyuksel - Sat Mar 06, 2004 1:32 am</h4>
    <div class="postbody"><span class="postbody">Your information helped very much. It is now working. I learned all the technical information about sprites now. Theere were 2 errors in my code 
<br/>
1. my trigonometry tables were wrong (When I copy and paste another trigonometry code from another file everything worked)
<br/>
2. I misunderstood somethings about rotation/scale indices now I know what to do.
<br/>
<br/>
Thank you very much tepples<br/>_________________<br/>--------------------
<br/>
Hakan Yuksel
<br/>
3TE GAmes
<br/>
<a href="http://www.3tegames.com" target="_blank">www.3tegames.com</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
