<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Map Starting Position - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > Map Starting Position</h2>
<div id="posts">
<div class="post">
    <h4>#3998 - Eep - Sat Mar 15, 2003 7:55 am</h4>
    <div class="postbody"><span class="postbody">I'm having trouble setting a map starting position. I've created a map that is 512x256 and the map loads the tiles and everything fine, but the starting position of the view is in the upper left hand corner. The ground of my map is in the lower left hand corner and I'm having trouble getting it to boot in the lower part of the map. I'm out of ideas to correct this. Any ideas would be helpful. 
<br/>
<br/>
Also, when I play my demo on the hardware and scroll past the first part of the map, the tiles don't display correctly and different tiles show up in pieces. It works fine on the emu (VisualBoyAdvance v1.3), of course. 
<br/>
<br/>
Any advise would be greatly appreicated. 
<br/>
<br/>
Thanks</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4000 - XeroxBoy - Sat Mar 15, 2003 10:02 am</h4>
    <div class="postbody"><span class="postbody">Regarding the map starting position, all you have to do is scroll the map using the scroll regs as soon as you load it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4001 - DekuTree64 - Sat Mar 15, 2003 4:59 pm</h4>
    <div class="postbody"><span class="postbody">Do you mean just setting the scroll regs messes things up, or are you using a scrolling engine that loads in new tiles off the edge of the screen as you walk around? That's what I do, and I just have it load in 32 strips of tiles from top to bottom or left to right, and it works fine. I'd have to see your code to find the problem. Also, why are you using 512x256? 256x256 is big enough to fill the screen. I guess you can only scroll 1 tile at a time before you can see things popping up though</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4002 - Eep - Sat Mar 15, 2003 5:20 pm</h4>
    <div class="postbody"><span class="postbody">Cool! That did it of course. I should have though of that before. Thanks a million! 
<br/>
<br/>
I'm still having the same trouble on the hardware though. I wish I could get a screen shot though. 
<br/>
<br/>
Thanks for the help with the starting point.
<br/>
<br/>
Any other ideas on the weird hardware problem would be greatly appeicated.
<br/>
<br/>
Thanks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4003 - Eep - Sat Mar 15, 2003 5:29 pm</h4>
    <div class="postbody"><span class="postbody">Sorry DekuTree64, I missed your post. Here's the code I'm using for the scrolling. It's fairly simple and works great on the emu. When I test it on the gba and try scrolling past the first screen of the map that the gba displays, the tiles get all chopped up. I'm not loading any other tiles as I walk. This is all that is in my game loop for right now.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
if(KEY_LEFT)
<br/>
     x--;
<br/>
if(KEY_RIGHT)
<br/>
     x++;
<br/>
if(KEY_DOWN) 
<br/>
     y++;
<br/>
if(KEY_UP) 
<br/>
     y--;
<br/>
<br/>
while(x &gt; (512 - 240)) 
<br/>
     x--;
<br/>
while(x &lt; 0) 
<br/>
     x++;
<br/>
while(y &gt; (256 - 160)) 
<br/>
     y--;
<br/>
while(y &lt; 0)  
<br/>
     y++;
<br/>
<br/>
REG_BG0VOFS = y;
<br/>
REG_BG0HOFS = x;
<br/>
<br/>
waitForVsync();
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Thanks for the help!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4004 - Lord Graga - Sat Mar 15, 2003 5:54 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">if(KEY_LEFT) 
<br/>
     x--; 
<br/>
if(KEY_RIGHT) 
<br/>
     x++; 
<br/>
if(KEY_DOWN) 
<br/>
     y++; 
<br/>
if(KEY_UP) 
<br/>
     y--; 
<br/>
<br/>
if (x&gt; 512 - 240)) 
<br/>
     x= 512-240; 
<br/>
if (x&lt;0) 
<br/>
     x=0;
<br/>
if(y &gt; (256 - 160)) 
<br/>
     y=256-160; 
<br/>
if(y &lt; 0)  
<br/>
     y=0; 
<br/>
<br/>
REG_BG0VOFS = y; 
<br/>
REG_BG0HOFS = x; 
<br/>
<br/>
waitForVsync();</td> </tr></table><span class="postbody">
<br/>
<br/>
It doesn't change anything at all, but it is better.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4005 - Eep - Sat Mar 15, 2003 6:26 pm</h4>
    <div class="postbody"><span class="postbody">Thanks, Lord Graga! 
<br/>
<br/>
Hey thanks for releasing your platforming source code. It's really helped me fix me collision detection routine. I'll send you a copy of my demo (when I get it done), if you'd like. So you can see the changes I've made. 
<br/>
<br/>
Thanks for the optimization help again.
<br/>
<br/>
I tried recreating my map and recompiling, but that didn't help. Still having the same problem on the hardware.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4006 - DekuTree64 - Sat Mar 15, 2003 6:29 pm</h4>
    <div class="postbody"><span class="postbody">Hmm, that's strange. The scrolling code is fine though, so it must be in the loading somewhere. I don't know why it would work on the emu but not hardware though. Maybe you're trying to copy tyhings 1 byte at a time? VRAM can only be written to 16 or 32 bits at a time, which I don't think the emu cares about. And then what number are you using for your first screen block? If you're using 31, and then writing to BGS(31) + 1024 + x + y * 32 for your second screen, it could be writing past the end of available VRAM, which the emu may not pick up on. Or writing over your screen mem with tiles or something. Not much else I can think of right now (I'm just taking wild guesses here^^)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4007 - Eep - Sat Mar 15, 2003 6:41 pm</h4>
    <div class="postbody"><span class="postbody">You hit the nail on the head DekuTree64. Thanks. 
<br/>
<br/>
I was selecting Screen Base Block 31. I forgot that I first started off using a 256x256 background, and I didn't change it when I changed the background. 
<br/>
<br/>
Thanks a million. I should have seen it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4008 - Lord Graga - Sat Mar 15, 2003 7:37 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">if(KEY_LEFT) 
<br/>
     if(x!=0) 
<br/>
          x--;
<br/>
if(KEY_RIGHT) 
<br/>
     x++; 
<br/>
if(KEY_DOWN) 
<br/>
     y++; 
<br/>
if(KEY_UP) 
<br/>
     if(y!=0) 
<br/>
          y--; 
<br/>
<br/>
if (x&gt; 512 - 240)) 
<br/>
     x= 512-240; 
<br/>
if (y&gt; (256 - 160)) 
<br/>
     y=256-160; 
<br/>
<br/>
REG_BG0VOFS = y; 
<br/>
REG_BG0HOFS = x; 
<br/>
<br/>
waitForVsync();</td> </tr></table><span class="postbody">
<br/>
<br/>
That one should work.
<br/>
<br/>
I would love to see what you have done to my demo, send it to <a href="mailto:lordgraga@hotmail.com">lordgraga@hotmail.com</a> when it is done :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4013 - Maverick - Sat Mar 15, 2003 9:25 pm</h4>
    <div class="postbody"><span class="postbody">Youre also going to need a
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
while(1)
<br/>
{
<br/>
if(KEY_LEFT) 
<br/>
     if(x!=0) 
<br/>
          x--; 
<br/>
if(KEY_RIGHT) 
<br/>
     x++; 
<br/>
if(KEY_DOWN) 
<br/>
     y++; 
<br/>
if(KEY_UP) 
<br/>
     if(y!=0) 
<br/>
          y--; 
<br/>
<br/>
if (x&gt; 512 - 240)) 
<br/>
     x= 512-240; 
<br/>
if (y&gt; (256 - 160)) 
<br/>
     y=256-160; 
<br/>
<br/>
REG_BG0VOFS = y; 
<br/>
REG_BG0HOFS = x; 
<br/>
<br/>
waitForVsync();
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
To check for the keypresses else it will only check once!</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
