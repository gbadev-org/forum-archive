<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Batch file generator for DevKitAdv - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Coding > Batch file generator for DevKitAdv</h2>
<div id="posts">
<div class="post">
    <h4>#10365 - marcmccann - Wed Sep 03, 2003 2:14 pm</h4>
    <div class="postbody"><span class="postbody">If any of you are getting sick of writing batch files, I have made myself a batch file generator to do it for me. If any of you people might find this useful and want it, could you please post it on here and if i get enough replies I will neaten up the code and the program itself and just give it all out on the tools section for you to have a mess around with and use<br/>_________________<br/>The GBA is one Lean and Mean machine!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10371 - antysix - Wed Sep 03, 2003 3:40 pm</h4>
    <div class="postbody"><span class="postbody">Well, why not!
<br/>
For my projects I use the most simplistic batch file without any optimizations or anything and I'm actually too lazy to get into that compiler stuff so I do want to try it.<br/>_________________<br/>Currently playing: NGC: Metroid Prime
<br/>
GBA: Golden Sun: The Lost Age
<br/>
<br/>
Currently developping: Project ~ [ Phail ]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10372 - marcmccann - Wed Sep 03, 2003 3:51 pm</h4>
    <div class="postbody"><span class="postbody">sounds like me! I hate having to mess around with things for it to work, this is a really basic program I knocked up in VB in about 10 minutes and it saves me a hell of a lot of time!
<br/>
<br/>
Anyone else interested?<br/>_________________<br/>The GBA is one Lean and Mean machine!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10374 - Lupin - Wed Sep 03, 2003 4:36 pm</h4>
    <div class="postbody"><span class="postbody">VB is neat for tools, I wrote an BIT-&gt;DEC/HEX converter (and wise-versa) in VB.
<br/>
<br/>
I also wrote an cool gfx-converter and map editor, but I lost everything because my HDD did crash :(((
<br/>
<br/>
As soon as I'm able to get some webspace I'll create an website where you could dload my tool too.
<br/>
<br/>
Anyone knows an good webhost? (4 free ^^)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10375 - tepples - Wed Sep 03, 2003 4:58 pm</h4>
    <div class="postbody"><span class="postbody">If you need hosting, and your project is <a class="postlink" href="http://www.opensource.org/licenses/" target="_blank">OSI Certified(sm) open source software</a>, try SourceForge.net.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10387 - Lupin - Wed Sep 03, 2003 8:10 pm</h4>
    <div class="postbody"><span class="postbody">yeah, I know sourceforge.net... but even though my stuff is all open source I have no real project, I'm coding various things (and most likely I won't ever finish something ^^), my main projects are Quake3 BSP renderer written in VB w/ DX, Q2/Q3 model Renderer in VB w/ DX, GBA programming stuff (my goal is to write something which looks like some kind of 3d :D)
<br/>
<br/>
But I think I'll just create an Main site for my Q3 BSP renderer and then add an sub-site wich is actually my main site with all the other stuff ^^</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10408 - marcmccann - Thu Sep 04, 2003 9:44 am</h4>
    <div class="postbody"><span class="postbody">VB is great for tools, it takes all the time out of coding a windows application and lets you get straight to the the point with what you want to do rather than messing with all your windows classes etc like u would in c++. The only drawback I have is when I want to distribute my programs because some people don't have the VB runtimes installed on thir machines. Other than that it is by far the best tool writing language. 
<br/>
<br/>
Anyhows back to the main point. Is anyone interested in this Batch file maker?<br/>_________________<br/>The GBA is one Lean and Mean machine!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10421 - Lupin - Thu Sep 04, 2003 2:38 pm</h4>
    <div class="postbody"><span class="postbody">yeah, vb runtimes really suck :(
<br/>
<br/>
Would be cool if there'd be an way to only take the functions out of the runtime which my application really needs and link them into the exe (without linking the whole dll into the exe and creating something like an self-extracting archive - that's what some tools tend to do...)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10422 - col - Thu Sep 04, 2003 2:45 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>marcmccann wrote:</b></span></td> </tr> <tr> <td class="quote">If any of you are getting sick of writing batch files, I have made myself a batch file generator to do it for me. If any of you people might find this useful and want it, could you please post it on here and if i get enough replies I will neaten up the code and the program itself and just give it all out on the tools section for you to have a mess around with and use</td> </tr></table><span class="postbody">
<br/>
<br/>
what are these batch files doing exactly?
<br/>
<br/>
are they just to switch to the correct folder and then run make with your makefile?
<br/>
or are they replacing the makefile?
<br/>
or are they doing something else?
<br/>
<br/>
I would love a batchfile generator that just knew what i wanted to do, and wrote a batch file to do it for me ;)
<br/>
<br/>
cheers
<br/>
<br/>
col.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10438 - tepples - Thu Sep 04, 2003 8:14 pm</h4>
    <div class="postbody"><span class="postbody">Here's how the most basic batch file generator would work.
<br/>
<br/>
For each file in the current directory whose name ends in .c, .cpp, .s, or .S, make a 'gcc' command line that compiles it. If the name contains "iwram" then compile it as ARM and name it as ###.iwram.o; otherwise compile it as Thumb and name it as ###.o where ### is a unique 3-digit number. Then make a 'gcc' command line that links all the .o files together. (Make this 'g++' instead of 'gcc' if one of the files was a .cpp file.)
<br/>
<br/>
There are more sophisticated programs that can generate a makefile automatically; look at automake<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10459 - col - Fri Sep 05, 2003 4:46 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Here's how the most basic batch file generator would work.
<br/>
<br/>
For each file in the current directory whose name ends in .c, .cpp, .s, or .S, make a 'gcc' command line that compiles it. If the name contains "iwram" then compile it as ARM and name it as ###.iwram.o; otherwise compile it as Thumb and name it as ###.o where ### is a unique 3-digit number. Then make a 'gcc' command line that links all the .o files together. (Make this 'g++' instead of 'gcc' if one of the files was a .cpp file.)
<br/>
<br/>
There are more sophisticated programs that can generate a makefile automatically; look at automake</td> </tr></table><span class="postbody">
<br/>
<br/>
I kind of figured that was what it was about - i wasn't sure though :)
<br/>
<br/>
My makefile handles all of that stuff automatically - so no need for batch files!  I tell the make file which directories to search and it handles the rest. I can just write some new source and save it to the correct folder, and everything works :))
<br/>
<br/>
It also handles dependencies.
<br/>
<br/>
I've been intending to 'release' it for a while, but there is a little annoyance that i would like to try and solve first - if I remove a source file from the project I have to remove the dependency file for that source file as well, or I get errors. I think it will be pretty easy to fix, just havn't got around to it yet.
<br/>
Also, I'm fairly certain that it uses features unique to gnu make, and you will need to add sed to the bin utils (devkitadv dosn't have sed)
<br/>
<br/>
If people are interested, i can post it annoyance and all?
<br/>
<br/>
cheers
<br/>
<br/>
Col</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10466 - crossraleigh - Fri Sep 05, 2003 9:43 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>col wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
If people are interested, i can post it annoyance and all?
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I sort of like looking at other peoples hand-written makefiles. Each person builds a little bit different, and each Makefile has a neat little idea that another doesn't.
<br/>
<br/>
What are the things (all of) your makefiles do?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10702 - col - Sat Sep 13, 2003 1:07 am</h4>
    <div class="postbody"><span class="postbody">ok here goes - if anyone tries using this, please tell me how you get on
<br/>
<br/>
<br/>
[edit] updated to new version that handles the tidying up of old .o and .d files
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
#=========================================================================
<br/>
#
<br/>
#    ----------------------------
<br/>
#   |makefile by Colin Brown 2003|
<br/>
#    ----------------------------
<br/>
#
<br/>
#   To use this makefile:
<br/>
#   replace the dummy entries for NAME, SRCDIRS, INCLUDES and LIBS 
<br/>
#   with those from your project.
<br/>
#   set your favourite flags for the compiler, linker and assembler
<br/>
#   thats about it.
<br/>
#
<br/>
#   
<br/>
#==========================================================================
<br/>
<br/>
<br/>
#   name of project
<br/>
NAME = myGame
<br/>
<br/>
#   list of folders that contain source
<br/>
#   remember - all source files in these folders will be compiled
<br/>
#   so don't leave any junk in there!
<br/>
SRCDIRS =   ./                        \
<br/>
         ./mySourceFolder/            \
<br/>
         ./myOtherSourceFolder/         \
<br/>
         ./yetAnotherSourceFolder/
<br/>
<br/>
#   include paths
<br/>
INCLUDES =   -I ../libFolder/inc/         \
<br/>
         -I ./myheaderFolder/
<br/>
<br/>
<br/>
#   Library paths.
<br/>
LIBS =   -L ../libFolder/myLibs/            \
<br/>
      -L ../libFolder/someOtherLibs/   
<br/>
<br/>
<br/>
#   flags: put your favourite compiler options here
<br/>
CFLAGSCOMMON =   -c -fno-rtti -nostartfiles -nostdlib \
<br/>
            -nodefaultlibs -fno-exceptions -fomit-frame-pointer \
<br/>
            -mcpu=arm7tdmi -frename-registers #-fverbose-asm -save-temps 
<br/>
<br/>
CFLAGSARM = -marm -mthumb-interwork -O2 $(CFLAGSCOMMON) 
<br/>
CFLAGSTHUMB = -mthumb -mthumb-interwork -O2 $(CFLAGSCOMMON)
<br/>
<br/>
DEFAULT = $(CFLAGSTHUMB)
<br/>
ASFLAGS = -mthumb-interwork
<br/>
<br/>
MAP = map.out
<br/>
LDFLAGS = -mthumb-interwork -Xlinker -Map $(MAP)
<br/>
<br/>
<br/>
#   tools
<br/>
CROSS = arm-agb-elf-
<br/>
CC = $(CROSS)gcc
<br/>
AS = $(CROSS)as
<br/>
LD = $(CROSS)gcc
<br/>
<br/>
#   Name of output targets
<br/>
ELF = $(NAME).elf
<br/>
TARGET = $(NAME).gba
<br/>
<br/>
#   declare which sufixes are source files
<br/>
SUFFIX_TYPES = .s .c .arm.c .thumb.c .cpp .arm.cpp .thumb.cpp
<br/>
<br/>
#   generate a list of all the source files in the source folders
<br/>
#   (sort removes pesky duplicates)
<br/>
SRC_FILES = $(sort                                    \
<br/>
            $(foreach SRCDIR, $(SRCDIRS),               \
<br/>
               $(foreach SUFFIX_TYPE, $(SUFFIX_TYPES),      \
<br/>
                  $(wildcard $(SRCDIR)*$(SUFFIX_TYPE))   \
<br/>
               )                                 \
<br/>
            )                                    \
<br/>
         )
<br/>
<br/>
#   turn all suffixes to .o            
<br/>
SRC =   $(foreach SRC_FILE, $(SRC_FILES), $(basename  $(SRC_FILE)).o)
<br/>
   
<br/>
#now a list all existing .o and .d that we need for housekeeping
<br/>
PRODUCTS = $(sort                                    \
<br/>
            $(foreach SRCDIR, $(SRCDIRS),               \
<br/>
                  $(wildcard $(SRCDIR)*.o)            \
<br/>
                  $(wildcard $(SRCDIR)*.d)            \
<br/>
            )                                    \
<br/>
         )
<br/>
         
<br/>
            
<br/>
#   now for the build rules.
<br/>
game:   $(TARGET)
<br/>
      @rm -f $(filter-out $(SRC) $(SRC:.o=.d), $(PRODUCTS) )   #tidy up any old files
<br/>
<br/>
#   this is a nasty hack so i can use rebuildAll in vc++ to clean !
<br/>
#   if anyone knows a better way please tell me :)
<br/>
all: clean
<br/>
<br/>
clean:
<br/>
   rm -f $(foreach SRCDIR, $(SRCDIRS), $(wildcard $(SRCDIR)*.o) $(wildcard $(SRCDIR)*.d))
<br/>
   rm -f $(TARGET) $(ELF) $(SYMBOLS) $(MAP)
<br/>
   rm -f *.o *.d
<br/>
<br/>
#   it's important to leave the -MD -MP in there
<br/>
#   they generate our dependency information
<br/>
#   the -MP option is only available in gcc 3.x and later
<br/>
#   for similar functionality see the paper:
<br/>
#            "Advanced Auto-Dependency Generation" by Paul D. Smith
<br/>
<br/>
%.o: %.s
<br/>
   $(AS) $(ASFLAGS) -o $@ $&lt;
<br/>
<br/>
%.o: %.c
<br/>
   $(CC) $(INCLUDES) $(DEFAULT) -MD -MP -o $@ $&lt;
<br/>
<br/>
%.o: %.cpp
<br/>
   $(CC) $(INCLUDES) $(DEFAULT) -MD -MP -o $@ $&lt;
<br/>
<br/>
%.thumb.o: %.thumb.cpp
<br/>
   $(CC) $(INCLUDES) $(CFLAGSTHUMB) -MD -MP -o $@ $&lt;
<br/>
<br/>
%.arm.o: %.arm.cpp
<br/>
   $(CC) $(INCLUDES) $(CFLAGSARM) -MD -MP -o $@ $&lt;
<br/>
<br/>
%.thumb.o: %.thumb.c
<br/>
   $(CC) $(INCLUDES) $(CFLAGSTHUMB) -MD -MP -o $@ $&lt;
<br/>
<br/>
%.arm.o: %.arm.c
<br/>
   $(CC) $(INCLUDES) $(CFLAGSARM) -MD -MP -o $@ $&lt;
<br/>
<br/>
<br/>
$(ELF): $(SRC)
<br/>
   touch $(MAP)
<br/>
   $(LD) $(LDFLAGS) -o $@ $(SRC) $(LIBS) -lstdc++
<br/>
   $(CROSS)size $@
<br/>
<br/>
$(TARGET): $(ELF)
<br/>
   $(CROSS)objcopy -v -O binary $&lt; $@
<br/>
   
<br/>
#   include the dependency information
<br/>
-include $(SRC:.o=.d)
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
cheers
<br/>
<br/>
Col</span><span class="gensmall"><br/><br/>Last edited by col on Sun Sep 14, 2003 3:31 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#10734 - col - Sat Sep 13, 2003 3:49 pm</h4>
    <div class="postbody"><span class="postbody">I edited the above post with a new version of the makefile.
<br/>
the problem of having to manually tidy up .o and .d files when removing source files from a project should be gone.
<br/>
fixed another bug related to changing source files from arm to thumb.
<br/>
<br/>
I hope now that this really is an automatic makefile :)
<br/>
<br/>
scans folders and compiles all source files found
<br/>
keeps track of all dependencies including .h files
<br/>
compatible with devkitadv version 5
<br/>
<br/>
cheers
<br/>
<br/>
Col</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10774 - Ruiner - Mon Sep 15, 2003 7:07 am</h4>
    <div class="postbody"><span class="postbody">Figured I would throw this in since it took me forever to find the choice equivalent in Windows XP. This does a little batch file menu. I usually leave the batch running when Im fixing bugs and just switch back to it and hit 1 to compile and execute the rom. The batch also doesnt close immediatly so I can see errors in compilation and such.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
:: Please feel free to use this and modify it however you need.
<br/>
:: It took me AGES to figure out how WinXP replaced the old dos
<br/>
:: choice command. 
<br/>
<br/>
@ECHO OFF
<br/>
path=%path%;c:\devkitadv;c:\devkitadv\bin;c:\devkitadv\tools
<br/>
CLS
<br/>
:LOOP
<br/>
ECHO    COMPILE MENU
<br/>
ECHO ----------------------
<br/>
ECHO 1: Compile and EXECUTE
<br/>
ECHO 2: Compile and DEBUG
<br/>
ECHO 3: Compile and CLEAN
<br/>
ECHO 4: Compile
<br/>
ECHO 5: Quit
<br/>
ECHO ----------------------
<br/>
ECHO      Written by Ruiner
<br/>
ECHO.
<br/>
:: Set is the WinXP equivalent of choice. 
<br/>
SET Choice=
<br/>
SET /P Choice=[Choice]:
<br/>
:: The next line gets a substring starting at 0 and 1 char long
<br/>
IF NOT '%Choice%'=='' SET Choice=%Choice:~0,1%
<br/>
ECHO.
<br/>
CLS
<br/>
:: /I makes the IF comparison case-insensitive
<br/>
IF /I '%Choice%'=='1' GOTO Item1
<br/>
IF /I '%Choice%'=='2' GOTO Item2
<br/>
IF /I '%Choice%'=='3' GOTO Item3
<br/>
IF /I '%Choice%'=='4' GOTO ITEM4
<br/>
IF /I '%Choice%'=='5' GOTO End
<br/>
ECHO "%Choice%" is not a menu option.
<br/>
ECHO.
<br/>
GOTO Loop
<br/>
:: --------------------------------------------
<br/>
:Item1
<br/>
make run clean
<br/>
GOTO Again
<br/>
:: --------------------------------------------
<br/>
:Item2
<br/>
make all debug
<br/>
GOTO Again
<br/>
:: --------------------------------------------
<br/>
:Item3
<br/>
make all clean
<br/>
GOTO Again
<br/>
:: --------------------------------------------
<br/>
:Item4
<br/>
make
<br/>
GOTO Again
<br/>
:: --------------------------------------------
<br/>
:Again
<br/>
ECHO.
<br/>
ECHO.
<br/>
PAUSE
<br/>
CLS
<br/>
GOTO Loop
<br/>
:End 
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
