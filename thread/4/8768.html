<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>[SOLVED] coding the "shoryuken" - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Coding > [SOLVED] coding the "shoryuken"</h2>
<div id="posts">
<div class="post">
    <h4>#74001 - deltree - Wed Mar 01, 2006 4:36 pm</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
I've been wondering how it would be possible to code a "special move" handler.
<br/>
I mean, generaly, when the player press A or B, or a control key, the character moves or do its actions.
<br/>
<br/>
How Could I program a special move, I mean, the character will do his move only if the keys like "UP then DOWN, then A then B" are pressed sequentially, in that specific order?
<br/>
what would be the good way to program this?
<br/>
<br/>
maybe you remember in street fighter 2, if you wanted to trigger the dragon punch (shoryuken), you had to do this move:
<br/>
"RIGHT then DOWN, then RIGHT/DOWN then RIGHT then buttonA"
<br/>
this sequence needs to be played in a short time (less than 1 second for the whole thing.) else, the dragon punch is not triggered.
<br/>
<br/>
I tought of doing an array that would keep every moves, then I will check the whole array to see if the "special move" sequence is somewhere inside it, but it would take a long time to compute...</span><span class="gensmall"><br/><br/>Last edited by deltree on Thu Mar 02, 2006 8:14 pm; edited 4 times in total</span></div>    
</div>
<div class="post">
    <h4>#74011 - Palamon - Wed Mar 01, 2006 6:52 pm</h4>
    <div class="postbody"><span class="postbody">You could always incorperate the special moves into the area where you deal with normal moves and just have it check the requirements of the special moves and see if they have been met.
<br/>
<br/>
Here's my idea:
<br/>
<br/>
you can have a variable flag for each special move, an array with the required moves, and when the variable flag gets to the end of the array, preform the special move
<br/>
<br/>
this is just some pseudocode
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
<br/>
const int dragonpunch[5] = //required movement array to preform a dragon punch
<br/>
{
<br/>
key variable for just Right pressed, 
<br/>
key variable for just Down pressed,
<br/>
key variable for just Right+Down pressed,
<br/>
key variable for just Right pressed,
<br/>
key variable for just A pressed};
<br/>
<br/>
<br/>
struct specialmoveflag
<br/>
{
<br/>
     int currentmovement;
<br/>
     int movetimer;
<br/>
}
<br/>
<br/>
<br/>
specialmoveflag   dragonpunch;
<br/>
<br/>
<br/>
dragonpunch.currentmovement = 0;
<br/>
<br/>
<br/>
//now in your player input section, put something like this right before you handle normal controls (left, right, punch, kick)
<br/>
<br/>
if(keyspressed == dragonpunch[dragonpunch.currentmovement+1])
<br/>
{//if you pressed the next button, move ahead on the array
<br/>
dragonpunch.currentmovement++;
<br/>
dragonpunch.timer = 10; //max number of game cycles to allow the user to press the next button in the sequence
<br/>
<br/>
     if(dragonpunch.currentmovement = 5)
<br/>
     //then do the move and reset dragonpunch variable
<br/>
<br/>
}
<br/>
<br/>
<br/>
//now if they didn't move onto the next move on the series, see if they can continue to try to do the move
<br/>
<br/>
<br/>
if(dragonpunch.currentmovement != 0)
<br/>
{
<br/>
dragonpunch.timer--; //reduce the number of game cycles they have to press the next move
<br/>
<br/>
if((keyspressed != dragonpunch[dragonpunch.currentmovement]) || dragonpunch.timer ==0))
<br/>
//if out of time or press the wrong move, start from beginning
<br/>
dragonpunch.currentmovement = 0;
<br/>
}
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
So, in other words
<br/>
<br/>
if they press the correct button, they advance on to the next move in the array.
<br/>
<br/>
If they continue to press the current button, a timer counts down and then sends you to the end of the line in the seq.
<br/>
<br/>
If they press something other then the most recent correct button or the next correct button, it sends you to the end of the line in the seq.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#74048 - keldon - Thu Mar 02, 2006 12:04 am</h4>
    <div class="postbody"><span class="postbody">Check out finite state machines in the FAQ</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#74054 - sajiimori - Thu Mar 02, 2006 12:59 am</h4>
    <div class="postbody"><span class="postbody">I'd do it Palamon's way.  I posted some fairly complete code for it a while back, but you'd have to search for it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#74123 - deltree - Thu Mar 02, 2006 4:49 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include &lt;mygba.h&gt;
<br/>
// Global Variables
<br/>
const int dragonpunch[5] = {BIT3,BIT1,BIT3+BIT1,BIT3,BIT4};//required movement array to perform a dragon punch
<br/>
<br/>
int score=0,key=0,currentmove=0,timer=0;
<br/>
<br/>
void vbl_func()
<br/>
{
<br/>
   key=0;
<br/>
   //check the pad move
<br/>
   if(F_CTRLINPUT_RIGHT_PRESSED) key=BIT3;
<br/>
   if(F_CTRLINPUT_DOWN_PRESSED) key+=BIT1;
<br/>
   if(F_CTRLINPUT_LEFT_PRESSED) key+=BIT2;
<br/>
   if(F_CTRLINPUT_UP_PRESSED) key+=BIT0;
<br/>
   if(F_CTRLINPUT_A_PRESSED) key+=BIT4;
<br/>
   if(key==dragonpunch[currentmove] &amp;&amp; currentmove&lt;5)
<br/>
   {//if you pressed the next button, move ahead on the array 
<br/>
      currentmove++; 
<br/>
      timer = 20; //max number of game cycles to allow the user to press the next button in the sequence 
<br/>
   }
<br/>
   if (timer==0) currentmove=0; //Reset dragon punch if player takes too long to perform the dragon punch
<br/>
   if (currentmove!=0) timer--;
<br/>
   if(currentmove == 5) {currentmove=0;ham_DrawText(1,1,"DRAGON PUNCH:%d   ",++score);}
<br/>
     ham_CopyObjToOAM();
<br/>
} // End of vblFunc()
<br/>
<br/>
int main()
<br/>
{
<br/>
   ham_Init(); //init..
<br/>
    ham_InitText(2);//initialize text functions
<br/>
   ham_SetBgMode(1); // Setup the background mode
<br/>
    ham_StartIntHandler(INT_TYPE_VBL,(void*)&amp;vbl_func);//handle the vblank..
<br/>
    while(1) {} //infinite loop
<br/>
} // End of main()</td> </tr></table><span class="postbody">
<br/>
<br/>
here's a working code for this , and here is the resulting ROM for the dragon punch, here &gt;&gt;&gt;<a class="postlink" href="http://superdeltree.free.fr/download/dragon.gba" target="_blank">HERE</a>
<br/>
If any of you knows how to do the dragon punch in SF2, can he tell me if it as the good feeling ? too speed, too slow, or just the right triggering ?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#74136 - Palamon - Thu Mar 02, 2006 7:07 pm</h4>
    <div class="postbody"><span class="postbody">I think it works fine and the timing seems to be good, you don't have to be perfect to get the move, but you do need to know the move sequence comfortably. 
<br/>
<br/>
Although there is one thing fishy.
<br/>
<br/>
In your code, you allow someone to press the wrong button and still continue with the sequence.
<br/>
<br/>
so if you are quick, you register a dragon punch by pressing
<br/>
right, <span style="font-weight: bold">B</span>, down, <span style="font-weight: bold">B</span>, down+right, <span style="font-weight: bold">B</span>, right, <span style="font-weight: bold">B</span>,A
<br/>
<br/>
or some other incorrect move into the sequence and still get a correct dragon punch.
<br/>
<br/>
That's why in my code, if the keys pressed wasn't the current move or blank, then it reset the sequence.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#74142 - keldon - Thu Mar 02, 2006 8:03 pm</h4>
    <div class="postbody"><span class="postbody">Street fighter, and most beat em ups allow you to enter a few incorrect buttons when pulling off moves. It's what introduced the 'double/tripple wammy' combos in street fighter II. It was in fact a bug, but went unfixed when [I believe] testers spoke of the amazing combo feature. Capcom spoke of this in one of the game development mags.
<br/>
<br/>
For fun when using ryu/ken; approach a guy and do a dragon punch. But when you are in the diagonal position press punch, and then continue with the dragon punch. That will pull off a double dragon punch; if my memory serves me right - may require medium punch. I'd tell you how to do the tripple dragon punch; but I'd have to dig up that street fighter disc and hope it works.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#74143 - deltree - Thu Mar 02, 2006 8:06 pm</h4>
    <div class="postbody"><span class="postbody">Actually, I tought about this problem, but it seems to be working like this in the real game.
<br/>
The dragon punch can be triggered even if some "parasite" keys are pushed within the correct sequence.
<br/>
so, that's  correct to me...</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
