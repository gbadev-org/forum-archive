<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Makefile question - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > Makefile question</h2>
<div id="posts">
<div class="post">
    <h4>#71903 - gauauu - Wed Feb 15, 2006 6:46 am</h4>
    <div class="postbody"><span class="postbody">In my makefile, I am wanting to do something like:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
AUTOGFX = gfx/hud.c gfx/stuff.c
<br/>
<br/>
...
<br/>
<br/>
$(AUTOGFX) : ..?..
<br/>
     perl myGfxConverter.pl file=$@
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Now, where the ..?.. is, I'd like to put set a dependancy that each AUTOGFX file is dependant on the associated .png file (gfx/png/hud.png).  I'm not sure how to specify this, though.
<br/>
<br/>
A few notes:  in the gfx/ directory, there are other C/object files that won't be automatically generated, so I can't use a directory wildcard.  I specifically want to define the files manually like I am doing.
<br/>
<br/>
I tried something like:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
$(AUTOGFX) : $(patsubst gfx/%.c,gfx/png/%.png,$@)
<br/>
     perl myGfxConverter.pl file=$@
<br/>
</td> </tr></table><span class="postbody">
<br/>
but the $@ only doesn't seem to work in the dependancy section for some reason (unless I'm doing something blatantly stupid?)  It's not that it complains of not being able to find the dependant file...it just doesn't seem to know that it needs to rebuild my AUTOGFX files when the png changes.
<br/>
<br/>
And if I do something like
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
$(AUTOGFX) : $(patsubst gfx/%.c,gfx/png/%.png,$(AUTOGFX))
<br/>
     perl myGfxConverter.pl file=$@
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Then each C source file will have to be rebuilt every time one of the png's get changed, right?
<br/>
<br/>
Also, I know that generally it's bad to put gfx in C files.  I'm doing it anyway because of how my converter perl scripts work.  The makefile question is the same whether it's C or assembly files.
<br/>
<br/>
Thanks!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#71947 - kashiwa - Wed Feb 15, 2006 2:55 pm</h4>
    <div class="postbody"><span class="postbody">I am doing in this way.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
BMPFILES   = \
<br/>
   Resource/sprMyShip.bmp \
<br/>
   Resource/sprMyShot.bmp \
<br/>
   Resource/sprOption.bmp \
<br/>
   ...
<br/>
CFILES   = \
<br/>
   $(BMPFILES:.bmp=.c) \
<br/>
   ...
<br/>
<br/>
.SUFFIXES: .s .c .o .a .d .bmp .pal
<br/>
<br/>
.bmp.c: $(BMPFILES)
<br/>
   @echo converting $&lt;
<br/>
   @perl tools/bmp2c.pl $&lt;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I feel troublesome to have to write the file name in makefile when adding a new resource. ;(</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
