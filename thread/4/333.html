<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Input and optimization - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > Input and optimization</h2>
<div id="posts">
<div class="post">
    <h4>#2044 - XeroxBoy - Tue Jan 28, 2003 5:07 am</h4>
    <div class="postbody"><span class="postbody">My input function works; however, when I turn on optimization, it fails to do so. 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define P1 *(volatile u16 * )0x04000130 // Definition of key pad reigster</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
u16 joypad()     //joypad checking routine.  
<br/>
{
<br/>
   u16 j=P1;
<br/>
   P1 |= 0x03FF;
<br/>
   return j;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
u16 Input // Method for reading input
<br/>
Input=(~joypad())&amp;0x03FF;
<br/>
if(Input &amp; KEY_UP) 
<br/>
// ...etc</td> </tr></table><span class="postbody">
<br/>
<br/>
Any help would be appreciated!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#2047 - tepples - Tue Jan 28, 2003 6:09 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>XeroxBoy wrote:</b></span></td> </tr> <tr> <td class="quote">My input function works; however, when I turn on optimization, it fails to do so. 
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define P1 *(volatile u16 * )0x04000130 // Definition of key pad reigster</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
When you use a #define to name a register, you should put parentheses around the definition, like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define P1 (*(volatile u16 * )0x04000130)</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
u16 joypad()     //joypad checking routine.  
<br/>
{
<br/>
   u16 j=P1;
<br/>
   P1 |= 0x03FF;
<br/>
   return j;
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
As far as I know, you don't ever need to write anything to the controller read register.  Were you thinking <span style="font-weight: bold">j ^= 0x3ff;</span> to convert the inputs from active-low to active-high?  In that case, you might as well just do this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
u16 joypad()
<br/>
{
<br/>
  return P1 ^ 0x03ff;
<br/>
}
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#2062 - XeroxBoy - Tue Jan 28, 2003 4:27 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for the advice, but it didn't help. I don't really understand the logic behind the input function myself - I got it from an old demo quite a while ago (I <span style="font-style: italic">think</span> it's from Warder1's Chrono Trigger demo). I tried swapping it with the code from The PERN Project, but that hasn't helped either.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#2085 - Maddox - Wed Jan 29, 2003 5:09 am</h4>
    <div class="postbody"><span class="postbody">It's your own fault for trusting the compiler to do your work for you.  And probably GCC at that, isn't it?  Admit it!  You get what you pay for.  GCC is garbage and optimizations should be turned off.  Suck it up and be a winner -- go program in assembly if you want speed and give that poor, stupid compiler your crap code to chew on.<br/>_________________<br/>You probably suck.  I hope you're is not a game programmer.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#2088 - XeroxBoy - Wed Jan 29, 2003 5:32 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">You get what you pay for. GCC is garbage</td> </tr></table><span class="postbody">
<br/>
<br/>
I agree; I personally don't like GCC very much. But do you want to give me $6000 to spend on ARM SDT? No? Then shut up.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">...optimizations should be turned off.</td> </tr></table><span class="postbody">
<br/>
<br/>
Why? Is slower code preferable?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Suck it up and be a winner -- go program in assembly</td> </tr></table><span class="postbody">
<br/>
<br/>
So your saying that Nintendo, Sega, Konami, Square, and <span style="font-style: italic">every other company that makes games for the GBA</span> are losers? Cuz, you know, I'm sure you could make better games than them.
<br/>
<br/>
Oh, and, are you the same Maddox who owns maddox.xmission.com (if not, you certainly take after your name sake)? In your article entitled "Love your kids? Prove it by beating them", you state, "The problem is that kids today think their opinions matter."
<br/>
<br/>
Hypocrite.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#2089 - Maddox - Wed Jan 29, 2003 5:48 am</h4>
    <div class="postbody"><span class="postbody">Please stick to GBA topics in your posts.
<br/>
<br/>
I use GCC like most, but I don't cry about it.  It's like a scared woodland animal -- you must respect it or you will get bitten.  Turning on optimizations always breaks my code so... 
<br/>
<br/>
Slower code is better when it works.  Your the one who couldn't get ~10 lines of code to work, not me.<br/>_________________<br/>You probably suck.  I hope you're is not a game programmer.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#2092 - XeroxBoy - Wed Jan 29, 2003 6:08 am</h4>
    <div class="postbody"><span class="postbody">Stick to GBA topics, eh?
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
To Splam: That's right -- keep rockin' that boat. We need more coolness on this forum and less crybabies asking for solutions to problems that high school Hypercard students could answer. 
<br/>
<br/>
THAT'S RIGHT: CRYBABIES!
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Anyways, if your code breaks when you turn optimizations on, then it's not as though I'm all that inferior to you. Besides, I've read many people on these forums recommending turning on optimizations, and I doubt they'd do so if they couldn't even get input working. Hence, asking how they get input with optimizations on is a good idea.
<br/>
<br/>
Out of curiousity, why would you say that slower code is better, especially as your such an ASM advocate?[/quote]</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
