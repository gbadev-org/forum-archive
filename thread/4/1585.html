<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Invalid constant error... - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Coding > Invalid constant error...</h2>
<div id="posts">
<div class="post">
    <h4>#8107 - regularkid - Wed Jul 02, 2003 6:37 am</h4>
    <div class="postbody"><span class="postbody">I'm trying to write an assembly function to wait for the vertical retrace period. Here's what I have so far:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
.ARM
<br/>
.ALIGN
<br/>
<br/>
.GLOBAL WaitVSync
<br/>
<br/>
WaitVSync:
<br/>
     wait:
<br/>
   mov   r0, #0x04000006
<br/>
   ldrh   r0, [r0]
<br/>
<br/>
   cmp   r0, #160
<br/>
   bne   wait
<br/>
<br/>
   bx   lr
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
However, when I compile with gcc I get this error:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
Video.s: Assembler messages:
<br/>
Video.s:43: Error: Invalid constant
<br/>
MAKE: *** [RK_Video_ASM.o] Error 1
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
referring to this: #0x04000006. Since I am using ARM mode rather than THUMB, there should be no reason why this constant is too big for the register. Am I wrong? Any ideas to fix this? Thanks!<br/>_________________<br/>- RegularKid</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8110 - tepples - Wed Jul 02, 2003 8:44 am</h4>
    <div class="postbody"><span class="postbody">A constant can be $smallnumber significant bits, rotated right by any even number of places.  You have to build larger constants by or'ing them from several pieces (ARM only) or loading them from a PC-relative pool (ARM or Thumb). The easiest way to access the I/O registers is to load 0x04000000 into a register and then offset from that.
<br/>
<br/>
[EDIT: factual corrections]<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"><br/><br/>Last edited by tepples on Wed Jul 02, 2003 8:49 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#8111 - torne - Wed Jul 02, 2003 8:57 am</h4>
    <div class="postbody"><span class="postbody">Try:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">mov r0, #0x04000000
<br/>
ldrh r0, [r0,#0x6]
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
This will work for the low-numbered registers.
<br/>
<br/>
Torne</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8134 - regularkid - Wed Jul 02, 2003 5:20 pm</h4>
    <div class="postbody"><span class="postbody">Thanks! Makes sense to me.<br/>_________________<br/>- RegularKid</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8143 - Darkain - Wed Jul 02, 2003 11:14 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">swi 0x50000</td> </tr></table><span class="postbody">
<br/>
<br/>
try this out too.  it wont kill the CPU.  :)<br/>_________________<br/>-=- Darkain Dragoon -=-
<br/>
<a class="postlink" href="http://www.darkain.com" target="_blank">http://www.darkain.com</a>
<br/>
<a class="postlink" href="http://ds.darkain.com/hack" target="_blank">DarkStar</a> for <a class="postlink" href="http://ds.darkain.com" target="_blank">Nintendo DS</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8147 - funkeejeffou - Thu Jul 03, 2003 1:05 am</h4>
    <div class="postbody"><span class="postbody">By the way, if your code doesn't work(wich won't be a surprise), try this :
<br/>
<br/>
ldr r0, =0x4000006
<br/>
v_blank_loop
<br/>
ldrh r1, [r0]
<br/>
cmp r1, #160
<br/>
ble v_blank_loop
<br/>
bx lr
<br/>
<br/>
you must reload for each loop the value contained in 0x4000006, otherwise it won't update.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8148 - funkeejeffou - Thu Jul 03, 2003 2:43 am</h4>
    <div class="postbody"><span class="postbody">OOps sorry!!!!
<br/>
didn't read well your code :-)
<br/>
it works, but if I were you, I would use an extra register to store 0x4000006 outside the loop, you don't need to reload it's value each time as it is constant.
<br/>
<br/>
Sorry again all, shame on me:(</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
