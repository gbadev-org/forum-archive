<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>where i wrong?? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > where i wrong??</h2>
<div id="posts">
<div class="post">
    <h4>#5684 - Link - Mon May 05, 2003 11:15 pm</h4>
    <div class="postbody"><span class="postbody">i'm not success to see the sprite, this is the code:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include "gba.h"
<br/>
#include "screenmode.h"
<br/>
#include "sprite.h"
<br/>
#include "sprite1.h" //header file ottenuto da pcx2gfx
<br/>
<br/>
int main(void)
<br/>
{
<br/>
<br/>
        SetMode(OBJ_MAP_2D | MODE_3 | OBJ_ENABLE);
<br/>
        u8 sprite1Atributes = 0;
<br/>
         
<br/>
        s16 x = 10;
<br/>
        s16 y = 10;
<br/>
        u16 char_number = 0;
<br/>
<br/>
   //for(s16 loop = 0; loop &lt; 256; loop++)
<br/>
      //OBJPaletteMem[loop] = sprite1Palette[loop];
<br/>
<br/>
        sprites[sprite1Atributes].attribute0 = COLOR_256 | SQUARE | y;
<br/>
        sprites[sprite1Atributes].attribute1 = SIZE_64 | x;
<br/>
        sprites[sprite1Atributes].attribute2 = char_number;
<br/>
<br/>
        int x_loop = 0, y_loop = 0, index = 0;
<br/>
<br/>
        for(y_loop = 0; y_loop &lt; 8; y_loop++)
<br/>
           {
<br/>
           for(x_loop = 0; x_loop &lt; 256; x_loop++)
<br/>
               {
<br/>
                   CharMem[x_loop + y_loop * 512] = sprite1Data[index]; 
<br/>
                index++;
<br/>
               } //end for x_loop
<br/>
           } //end for y_loop
<br/>
<br/>
void MoveSprite( OAMEntry* sp, int x, int y)
<br/>
{
<br/>
<br/>
        sprites-&gt;attribute1 = sprites-&gt;attribute1 &amp; 0xFE00; //azzera il vecchio valore di x
<br/>
        sprites-&gt;attribute1 = sprites-&gt;attribute1 | x;
<br/>
<br/>
        sprites-&gt;attribute0 = sprites-&gt;attribute0 &amp; 0xFF00; //azzera la vecchia y
<br/>
        sprites-&gt;attribute0 = sprites-&gt;attribute0 | y;
<br/>
}
<br/>
<br/>
int loop;
<br/>
<br/>
for(loop = 0; loop &lt; 256; loop++)
<br/>
OBJPaletteMem[loop] = sprite1Palette[loop];
<br/>
<br/>
void InitializeSprites(void)
<br/>
{
<br/>
         int loop;
<br/>
         for(loop = 0; loop &lt; 128; loop++)
<br/>
        {
<br/>
                sprites[loop].attribute0 = 160; //y to &gt; 159
<br/>
                sprites[loop].attribute1 = 240; //x to &gt; 239
<br/>
        }
<br/>
}
<br/>
<br/>
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
here some declaration in gba.h:
<br/>
<br/>
....................
<br/>
u16* OAMData			=(u16*)0x6010000;
<br/>
<br/>
<span style="font-weight: bold">#define CharMem ((u16*)0x6010000)
<br/>
#define OBJPaletteMem ((u16*)0x5000200)</span>
<br/>
<br/>
<br/>
#define REG_INTERUPT   	(*(volatile u32*)0x3007FFC)
<br/>
#define REG_DISPCNT    	(*(volatile u32*)0x4000000)
<br/>
<br/>
..........................
<br/>
<br/>
[/code]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#5693 - Psyk - Tue May 06, 2003 8:01 am</h4>
    <div class="postbody"><span class="postbody">Well it seems that you're not actually copying the data from the sprites structure into the actual OAM memory of the GBA. Also you seem to have functions in the middle of main.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#5697 - Link - Tue May 06, 2003 11:27 am</h4>
    <div class="postbody"><span class="postbody">sorry, bad code not my own but just a distraction.
<br/>
However this is new code can u let a look:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include "gba.h"
<br/>
#include "screenmode.h"
<br/>
#include "sprite.h"
<br/>
#include "sprite1.h" //header file ottenuto da pcx2gfx
<br/>
<br/>
void MoveSprite( OAMEntry* sp, int x, int y);
<br/>
void InitializeSprites(void);
<br/>
void WaitForVsync(void);
<br/>
void CopyOAM(void);
<br/>
<br/>
int main(void)
<br/>
{
<br/>
<br/>
        SetMode(OBJ_MAP_2D | MODE_3 | OBJ_ENABLE);
<br/>
        u8 sprite1Atributes = 0;
<br/>
         
<br/>
        s16 x = 10;
<br/>
        s16 y = 10;
<br/>
        u16 char_number = 0;
<br/>
        int loop, index; 
<br/>
        
<br/>
   for(loop = 0; loop &lt; 256; loop++)
<br/>
      OBJPaletteMem[loop] = sprite1Palette[loop];
<br/>
        
<br/>
        InitializeSprites();
<br/>
<br/>
        sprites[sprite1Atributes].attribute0 = COLOR_256 | SQUARE | y;
<br/>
        sprites[sprite1Atributes].attribute1 = SIZE_64 | x;
<br/>
        sprites[sprite1Atributes].attribute2 = char_number;
<br/>
<br/>
   for(index = 0; index &lt; 256*8; index++)
<br/>
   {
<br/>
      OAMData[index] = sprite1Data[index];  
<br/>
         
<br/>
   }//end index loop
<br/>
<br/>
<br/>
        /*int x_loop = 0, y_loop = 0, index = 0;
<br/>
<br/>
        for(y_loop = 0; y_loop &lt; 8; y_loop++)
<br/>
           {
<br/>
           for(x_loop = 0; x_loop &lt; 256; x_loop++)
<br/>
               {
<br/>
                   CharMem[x_loop + y_loop * 512] = sprite1Data[index]; 
<br/>
                index++;
<br/>
               } //end for x_loop
<br/>
           } //end for y_loop*/
<br/>
<br/>
        while(1)
<br/>
   {
<br/>
      MoveSprite(&amp;sprites[0],x,y);
<br/>
<br/>
      WaitForVsync();
<br/>
<br/>
      CopyOAM();
<br/>
<br/>
   }
<br/>
}
<br/>
<br/>
<br/>
<br/>
<br/>
void MoveSprite( OAMEntry* sp, int x, int y)
<br/>
{
<br/>
<br/>
        sprites-&gt;attribute1 = sprites-&gt;attribute1 &amp; 0xFE00; //azzera il 
<br/>
<br/>
vecchio valore di x
<br/>
        sprites-&gt;attribute1 = sprites-&gt;attribute1 | x;
<br/>
<br/>
        sprites-&gt;attribute0 = sprites-&gt;attribute0 &amp; 0xFF00; //azzera la 
<br/>
<br/>
vecchia y
<br/>
        sprites-&gt;attribute0 = sprites-&gt;attribute0 | y;
<br/>
}
<br/>
<br/>
void InitializeSprites(void)
<br/>
{
<br/>
      int loop;
<br/>
         for(loop = 0; loop &lt; 128; loop++)
<br/>
        {
<br/>
                sprites[loop].attribute0 = 160; //y to &gt; 159
<br/>
                sprites[loop].attribute1 = 240; //x to &gt; 239
<br/>
        }
<br/>
}
<br/>
<br/>
void WaitForVsync(void) 
<br/>
{ 
<br/>
    while(REG_VCOUNT == 160); 
<br/>
    while(REG_VCOUNT != 160); 
<br/>
}
<br/>
<br/>
void CopyOAM(void)
<br/>
{
<br/>
   u16 loop;
<br/>
   u16* temp;
<br/>
   temp = (u16*)sprites;
<br/>
   for(loop = 0; loop &lt; 128*4; loop++)
<br/>
   {
<br/>
      OAM[loop] = temp[loop];
<br/>
   }
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#5710 - Link - Tue May 06, 2003 3:59 pm</h4>
    <div class="postbody"><span class="postbody">i've seen more and more times but i'm success to find the error!
<br/>
<br/>
i'm success to make the .bin file but i can't see the sprite on the screen!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#5714 - Psyk - Tue May 06, 2003 6:46 pm</h4>
    <div class="postbody"><span class="postbody">i think you can only use the last half of the OAM when using bitmap screenmodes(modes 3, 4 and 5) so it might work if you change 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">u8 sprite1Atributes = 0; </td> </tr></table><span class="postbody"> to </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">u8 sprite1Atributes = 64;</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#5715 - niltsair - Tue May 06, 2003 6:51 pm</h4>
    <div class="postbody"><span class="postbody">Wrong.
<br/>
<br/>
You can can only use the last 512 Sprite's tiles, but you can use the full 128 OAM. So the problem is elsewhere.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#5716 - Link - Tue May 06, 2003 8:10 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>niltsair wrote:</b></span></td> </tr> <tr> <td class="quote">Wrong.
<br/>
<br/>
You can can only use the last 512 Sprite's tiles, but you can use the full 128 OAM. So the problem is elsewhere.</td> </tr></table><span class="postbody">
<br/>
<br/>
infact my question is <span style="font-weight: bold">Where</span> i wrong?
<br/>
<br/>
however i change:
<br/>
u8 sprite1Atributes = 0;  
<br/>
to
<br/>
u8 sprite1Atributes = 64;
<br/>
but nothing!
<br/>
What need to change also?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#5717 - niltsair - Tue May 06, 2003 8:17 pm</h4>
    <div class="postbody"><span class="postbody">I was replying to Psyk anwser.
<br/>
<br/>
I don't really have time to look at your code line per line, i'm at work.
<br/>
<br/>
I also think you should look at tutorial more, and figure out step by step what might be the problem, as we all did, instead of throwing all of your code at the slightess pebble in the road.
<br/>
<br/>
In your WaitFroVSync, you can remove the 
<br/>
'while(REG_VCOUNT == 160); '
<br/>
<br/>
and keep the rest. I don't think it'll fix your problem, but don't see the point of that line.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#5718 - Psyk - Tue May 06, 2003 9:01 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Wrong. 
<br/>
<br/>
You can can only use the last 512 Sprite's tiles, but you can use the full 128 OAM. So the problem is elsewhere.
<br/>
</td> </tr></table><span class="postbody">
<br/>
I was close but now i think of it that makes more sense than what i said..
<br/>
<br/>
Well anyway i suggest you use 1D object mapping as it is much easier to work with. There is an explanation on <a class="postlink" href="http://www.thepernproject.com" target="_blank">www.thepernproject.com</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
