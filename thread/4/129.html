<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>crtbegin.o and crtend.o - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Coding > crtbegin.o and crtend.o</h2>
<div id="posts">
<div class="post">
    <h4>#780 - anli - Fri Jan 10, 2003 4:12 pm</h4>
    <div class="postbody"><span class="postbody">Hello!
<br/>
<br/>
I think its a "mess" to use the gnu utils actually, so probably I am doing
<br/>
something wrong. Do I really need to do all this?
<br/>
<br/>
First of all, I am using crt0.s and lnkscript by Jeff. I put those two files in the same directory as my project.
<br/>
<br/>
Secondly, I copy this files to my project dir:
<br/>
<br/>
For arm:
<br/>
e:\devkitadv\lib\gcc-lib\arm-agb-elf\3.0.2\crtbegin.o and
<br/>
e:\devkitadv\lib\gcc-lib\arm-agb-elf\3.0.2\crtend.o
<br/>
<br/>
For thumb:
<br/>
e:\devkitadv\lib\gcc-lib\arm-agb-elf\3.0.2\thumb\crtbegin.o and
<br/>
e:\devkitadv\lib\gcc-lib\arm-agb-elf\3.0.2\thumb\crtend.o
<br/>
<br/>
For interwork:
<br/>
e:\devkitadv\lib\gcc-lib\arm-agb-elf\3.0.2\interwork\crtbegin.o and
<br/>
e:\devkitadv\lib\gcc-lib\arm-agb-elf\3.0.2\interwork\crtend.o
<br/>
<br/>
I also put a main.cpp or main.c in the directory with my code.
<br/>
(I have not done something big enough for splitting up in many files yet, or maybe I have without actually doing it). The entry function is called AgbMain.
<br/>
<br/>
Then I create a Makefile and put in the same directory. It typically contains something like this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
hello.gba: hello.elf
<br/>
   objcopy -O binary hello.elf hello.gba
<br/>
<br/>
hello.elf: crt0.o main.o
<br/>
   ld -L${DEVKITADV}/lib/gcc-lib/arm-agb-elf/3.0.2 \
<br/>
       -L${DEVKITADV}/arm-agb-elf/lib -o hello.elf -T lnkscript \
<br/>
       crt0.o crtbegin.o crtend.o main.o -lc -lm -lgcc
<br/>
<br/>
main.o: main.cpp
<br/>
   g++ -c -O3 -marm -o main.o main.cpp
<br/>
<br/>
crt0.o:   crt0.s
<br/>
   as crt0.s -o crt0.o
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
(I have an environment variable named DEVKITADV containing
<br/>
"d:\devkitadv").
<br/>
<br/>
Now
<br/>
<br/>
1. Is there a way to just tell the linker "I am linking for the thumb 
<br/>
    instruction set" instead of copying the files crtbegin.o and crtend.o to
<br/>
    the project directory, or in any way mention crtbegin.o and crtend.o in 
<br/>
    my Makefile?
<br/>
2. Is there a way to get rid of giving long paths to ld with the -L switch to 
<br/>
    the C/C++/math runtime libraries? The paths I have now is clearly 
<br/>
    version dependent, so when I am using a newer version of gcc some 
<br/>
    time, I need to change all my makefiles.
<br/>
<br/>
3. If I dont put crt0.o first in the command line to ld, but something else, 
<br/>
    the ROM will not start with crt0, and therefore be unusable. Is there a 
<br/>
    way to configure the lnkscript so the ROM will always start with crt0.o?
<br/>
    This is of course of academic interest, since I am always able to assure
<br/>
    that crt0.o is first on the command line to ld, but I am just curious.
<br/>
<br/>
over and out
<br/>
/anli</span><span class="gensmall"><br/><br/>Last edited by anli on Fri Jan 10, 2003 5:04 pm; edited 4 times in total</span></div>    
</div>
<div class="post">
    <h4>#781 - anli - Fri Jan 10, 2003 4:15 pm</h4>
    <div class="postbody"><span class="postbody">Hmm, for some reason, tabs are not working correctly in the forum, even
<br/>
if i am in the [code] environment...
<br/>
<br/>
Of course, there are tabs at some places in the Makefile, else it would
<br/>
not be useable...
<br/>
<br/>
:)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#782 - Touchstone - Fri Jan 10, 2003 4:37 pm</h4>
    <div class="postbody"><span class="postbody">What's in crtbegin.o and crtend.o that you need? I'd recon you don't need them, atleast not if you are using plain C. Just a plain crt0.s that initialize stack pointers, program status registers and interrupts then followed by a call to your AgbMain would be sufficient. If you are using C++ and have any static objects you would want to extend your start vector to include initialization of malloc and a call to the static objects initialization but that should be it really.<br/>_________________<br/>You can't beat our meat</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#783 - anli - Fri Jan 10, 2003 4:51 pm</h4>
    <div class="postbody"><span class="postbody">I think crtbegin.o and crtend.o is some addresses of the stuff that
<br/>
crt0.s must copy in the start of the execution, in other words, global
<br/>
initialized variables.
<br/>
<br/>
But I may be wrong.
<br/>
<br/>
And actually, I dont see how that can be contained in an object file...
<br/>
I mean, then I need to put them in the correct order to the linker, or?
<br/>
<br/>
Evil ducks should definitiely rule the world!
<br/>
/anli</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
