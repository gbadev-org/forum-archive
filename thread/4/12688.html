<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>How do I make a library? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Coding > How do I make a library?</h2>
<div id="posts">
<div class="post">
    <h4>#121416 - HyperHacker - Mon Mar 12, 2007 8:05 am</h4>
    <div class="postbody"><span class="postbody">I'd like to know how to make .a library files with DevkitPro like libFAT and libCartReset. All Google is telling me is how to make .so files which are apparently dynamic link libraries for Linux. Anyone?<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121423 - Diddl - Mon Mar 12, 2007 10:06 am</h4>
    <div class="postbody"><span class="postbody">a library is only a collection of object files. after compiling a c source file (.c) you get an object file. if same object file is included in many projects you should collect them to a library (.a) file.
<br/>
<br/>
look at the Makefile of libfat and you see the building of library file as last operation.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121425 - keldon - Mon Mar 12, 2007 10:48 am</h4>
    <div class="postbody"><span class="postbody">There is also an example in the tonc library.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121513 - Puyo - Mon Mar 12, 2007 9:33 pm</h4>
    <div class="postbody"><span class="postbody">There is a template in devkitPro examples.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121524 - Ant6n - Mon Mar 12, 2007 10:20 pm</h4>
    <div class="postbody"><span class="postbody">i use something like this. i basicly say some files are part of some library and they get 'ar rcs'ed.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#
<br/>
# creation of a gba library
<br/>
# and testing
<br/>
#
<br/>
<br/>
<br/>
# --- Project details ---
<br/>
PROJ    := lib
<br/>
EXT     := gba
<br/>
LIBRARY := lib_simple_gba.a
<br/>
<br/>
LCFILES := lib_palette.c lib_time.c lib_frame.c lib_math.c lib_interrupt.c lib_memory.c lib_sprite.c lib_texture.c 
<br/>
LSFILES := lib_asmirqhandler.S lib_asmagbprint.S
<br/>
<br/>
CFILES  := main.c rock.c ship.c shipdata.c
<br/>
   
<br/>
COBJS   := $(CFILES:.c=.o)
<br/>
LSOBJS  := $(LSFILES:.S=.o)
<br/>
LCOBJS  := $(LCFILES:.c=.o)
<br/>
LOBJS   := $(LCOBJS) $(LSOBJS)
<br/>
<br/>
<br/>
#--- Tool settings ---
<br/>
PREFIX := arm-eabi-
<br/>
AS      := $(PREFIX)gcc
<br/>
CC      := $(PREFIX)gcc
<br/>
AR      := $(PREFIX)ar
<br/>
LD      := $(PREFIX)gcc
<br/>
OBJCOPY := $(PREFIX)objcopy
<br/>
<br/>
<br/>
MODEL   := -mthumb-interwork
<br/>
SPECS   := -specs=gba.specs         # comment out for DKA
<br/>
<br/>
ASFLAGS := -mthumb-interwork -Wall
<br/>
CFLAGS  := -I./ $(MODEL) -O0 -mthumb -Wall
<br/>
LDFLAGS := $(SPECS) $(MODEL)
<br/>
<br/>
#--- Build steps ---
<br/>
build : $(PROJ).$(EXT)
<br/>
<br/>
$(PROJ).$(EXT) : $(PROJ).elf
<br/>
   @$(OBJCOPY) -v -O binary $&lt; $@
<br/>
   -@gbafix $@
<br/>
<br/>
$(PROJ).elf : $(COBJS) $(LIBRARY)
<br/>
   @$(LD) $(COBJS) $(LIBRARY) $(LDFLAGS) -o $@
<br/>
<br/>
$(LIBRARY) : $(LOBJS)
<br/>
   $(AR) rcs $(LIBRARY) $(LOBJS)
<br/>
<br/>
$(LCOBJS) : %.o : %.c
<br/>
   $(CC) $(CFLAGS) -g -c $&lt; -o $@
<br/>
<br/>
$(COBJS) : %.o : %.c
<br/>
   $(CC) $(CFLAGS) -g -c $&lt; -o $@
<br/>
<br/>
$(LSOBJS) : %.o : %.S
<br/>
   $(CC) $(ASFLAGS) -g -c $&lt; -o $@
<br/>
<br/>
<br/>
# --- Clean ---
<br/>
.PHONY : clean
<br/>
clean :
<br/>
   @rm -fv $(COBJS)
<br/>
   @rm -fv $(LOBJS)
<br/>
   @rm -fv $(LIBRARY)
<br/>
   @rm -fv $(PROJ).$(EXT)
<br/>
   @rm -fv $(PROJ).elf
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123801 - HyperHacker - Sat Mar 31, 2007 6:53 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Diddl wrote:</b></span></td> </tr> <tr> <td class="quote">look at the Makefile of libfat and you see the building of library file as last operation.</td> </tr></table><span class="postbody">Where is the libfat source?
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>keldon wrote:</b></span></td> </tr> <tr> <td class="quote">There is also an example in the tonc library.</td> </tr></table><span class="postbody">I see info about makefiles, but not about making libraries.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Puyo wrote:</b></span></td> </tr> <tr> <td class="quote">There is a template in devkitPro examples.</td> </tr></table><span class="postbody">Where?
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ant6n wrote:</b></span></td> </tr> <tr> <td class="quote">i use something like this. i basicly say some files are part of some library and they get 'ar rcs'ed.</td> </tr></table><span class="postbody">Wow, that code means absolutely nothing to me. I got the part about using ar, but that's about it. I've simply been including the source files into each program, and that works fine. How do I compile them on their own? They don't have a main() or anything. :-S I haven't been this lost since I wandered into the woods as a young child and couldn't find my way out again.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123805 - Ant6n - Sat Mar 31, 2007 8:05 am</h4>
    <div class="postbody"><span class="postbody">this was a makefile. I just posted to show the notion of having some library related files and some testing project that are compiled separately and then linked. The essential command here is
<br/>
$(LIBRARY) : $(LOBJS)
<br/>
   $(AR) rcs $(LIBRARY) $(LOBJS) 
<br/>
<br/>
which would probably expand into something like
<br/>
arm-eabi-ar rcs mylib.a file1.o file2.o
<br/>
that's it. I dont remember what rcs stand for, but i've been using that option like that since forever and it works for me. If you supply the mylib.a with the header files, then the library should be usable.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123811 - keldon - Sat Mar 31, 2007 10:25 am</h4>
    <div class="postbody"><span class="postbody">The tonc library comes with the makefiles; unless Cearn has changed the library not to include the makefiles.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123815 - Cearn - Sat Mar 31, 2007 1:21 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>keldon wrote:</b></span></td> </tr> <tr> <td class="quote">There is also an example in the tonc library.</td> </tr></table><span class="postbody">I see info about makefiles, but not about making libraries.</span></td> </tr></table><span class="postbody">
<br/>
It's<a class="postlink" href="http://www.coranac.com/tonc/text/regbg.htm#ssec-demo-hello" target="_blank">here</a> I admit it's well hidden ^_^;; But the tonclib and libgba's makefiles also contain the relevant stuff. It's like Ant6n says:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
$(LIBRARY) : $(LOBJS)
<br/>
   $(AR) rcs $(LIBRARY) $(LOBJS) 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ant6n wrote:</b></span></td> </tr> <tr> <td class="quote">i use something like this. i basicly say some files are part of some library and they get 'ar rcs'ed.</td> </tr></table><span class="postbody">Wow, that code means absolutely nothing to me. I got the part about using ar, but that's about it.</span></td> </tr></table><span class="postbody">
<br/>
When in doubt, <a class="postlink" href="http://www.gnu.org/software/binutils/manual/html_mono/binutils.html" target="_blank">RTFM</a>. Or just consider them the standard options.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">I've simply been including the source files into each program, and that works fine. How do I compile them on their own? They don't have a main() or anything. :-S I haven't been this lost since I wandered into the woods as a young child and couldn't find my way out again.</td> </tr></table><span class="postbody">
<br/>
Roughly put, building a project happens in two stages: <span style="font-weight: bold">compilation</span> and <span style="font-weight: bold">linking</span>. Compilation (and assembling too, I guess) converts a C source file into an ELF binary file called an object file (.o). This contains the machine code for the functions, data for the global variables, and other items that tells you where these items go and what their names are. 
<br/>
Linking is the stage where all these items are brought together into an executable. The linker looks at all the object files and places them into the right sections and links function/data calls to the addresses that those functions/data now have. 
<br/>
<br/>
The object files themselves are just collections of functions and data in a format that makes more sense to a computer. However, each of these items is still loose: they don't have their addresses yet. Only at the linking stages are the addresses fixed, and it's only at that point that one can actually run the executable*. It's only at that point that a main() needs to exist. There was a nice tutorial about how it all works <a class="postlink" href="http://www.eng.hawaii.edu/Tutor/Make/2-1.html" target="_blank">here</a>, but it seems unavailable now. 
<br/>
<br/>
Libraries are little more than collections of object files. Because the hard work (compilation) is already done, they can be build into an executable faster than if you had to compile them as well. 
<br/>
<br/>
<br/>
<span style="font-size: 9px; line-height: normal">* GBA/NDS games also need stripping of excess data with objcopy.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123816 - kusma - Sat Mar 31, 2007 1:29 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">I've simply been including the source files into each program, and that works fine. How do I compile them on their own? They don't have a main() or anything.</td> </tr></table><span class="postbody">
<br/>
<br/>
compile with the gcc-flag -c to output an object file instead of directly compiling and linking all sources. remember to specify an output filename (-o option). use ar to archive these objects together as an .a-file.
<br/>
<br/>
A typical makefile-rule to build object files from c-sources looks like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">%.o: %.c
<br/>
   $(CC) $(CPPFLAGS) $(CFLAGS) -c $&lt; -o $@
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
And a typical makefile-rule to build an .a file from a set of object files looks like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">%.a:
<br/>
   $(AR) $(ARFLAGS) $@ $?
<br/>
<br/>
mylib.a: souce1.o source2.o source3.o
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123898 - HyperHacker - Sun Apr 01, 2007 9:05 am</h4>
    <div class="postbody"><span class="postbody">Yeah, I know about as much about Unix makefiles as Homer Simpson knows about calculus. I can make out some of it, but $&lt; $@ $what? It looks like someone fell on the keyboard.
<br/>
<br/>
I do know how to compile to a .o file, and I managed to compile just a header file which includes stdio.h, does a few #defines and function prototypes, defines a few bytes worth of globals, and references a 2KB font file (extern u8 etc...). The .o file is 1.23MB, and so is the .a file created with <span style="font-style: italic">arm-eabi-ar rcs</span>! How did that happen? The entire test program is only 36KB.
<br/>
<br/>
I tried including that .o file along with the others when creating the .elf file, rather than including the header file itself in the source, but then it won't even get that far because none of the stuff in that file is defined anymore. &gt;_&lt;<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"><br/><br/>Last edited by HyperHacker on Sun Apr 01, 2007 9:09 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#123899 - Piratero - Sun Apr 01, 2007 9:09 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">Yeah, I know about as much about Unix makefiles as Homer Simpson knows about calculus. I can make out some of it, but $&lt; $@ $what? It looks like someone fell on the keyboard.
<br/>
<br/>
I do know how to compile to a .o file, and I managed to compile just a header file which includes stdio.h, does a few #defines and function prototypes, defines a few bytes worth of globals, and references a 2KB font file (extern u8 etc...). The .o file is 1.23MB, and so is the .a file created with <span style="font-style: italic">arm-eabi-ar rcs</span>! How did that happen? The entire test program is only 36KB.</td> </tr></table><span class="postbody">
<br/>
<br/>
Try this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
%.o: %.c 
<br/>
&lt;tab&gt;@echo $? $@ $*
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/><a href="http://mrkotfw.ribrdb.com/" target="_blank">http://mrkotfw.ribrdb.com/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123901 - HyperHacker - Sun Apr 01, 2007 9:21 am</h4>
    <div class="postbody"><span class="postbody">Well I'd like to get this working with batch scripts before I go off learning another whole language. I'd appreciate a link to some sort of documentation but for now let's just leave that alone if possible. I've almost got it working, but I'm getting compiler errors that make no sense. I figured leave the header file and compile the source itself (which includes the header), and in the test program, link to the .o file (which is now only 25K, which still seems pretty bloated) instead of including the source. But these errors...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">F:\DOS\DevKitPro\devkitARM\bin\arm9.o: In function `powerON':
<br/>
F:\DOS\DevKitPro\libnds\include/nds/system.h:135: multiple definition of `_NumConsoles'
<br/>
..\general\console.o:(.bss+0x0): first defined here
<br/>
</td> </tr></table><span class="postbody">
<br/>
"_NumConsoles" doesn't appear in system.h at all! Line 135 is just:
<br/>
void powerON(int on) { POWER_CR |= on;}
<br/>
wtf?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">F:\DOS\DevKitPro\devkitARM\bin\arm9.o: In function `powerON':
<br/>
F:\DOS\DevKitPro\libnds\include/nds/system.h:135: multiple definition of `_CurrentConsole'
<br/>
..\general\console.o:(.bss+0x1): first defined here
<br/>
F:\DOS\DevKitPro\devkitARM\bin\arm9.o: In function `powerON':
<br/>
F:\DOS\DevKitPro\libnds\include/nds/system.h:135: multiple definition of `Console'
<br/>
..\general\console.o:(.bss+0x4): first defined here</td> </tr></table><span class="postbody">
<br/>
More of this. This makes no sense at all.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">f:/dos/devkitpro/devkitarm/bin/../lib/gcc/arm-eabi/4.1.1/../../../../arm-eabi/bin/ld.exe: Warning: size of symbol `Console' changed from 84 in ..\general\console.o to 112 in F:\DOS\DevKitPro\devkitARM\bin\arm9.o
<br/>
collect2: ld returned 1 exit status</td> </tr></table><span class="postbody">
<br/>
What?<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123908 - kusma - Sun Apr 01, 2007 10:59 am</h4>
    <div class="postbody"><span class="postbody"><a href="http://www.gnu.org/software/make/manual/make.html" target="_blank">http://www.gnu.org/software/make/manual/make.html</a> - happy reading.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123912 - keldon - Sun Apr 01, 2007 12:47 pm</h4>
    <div class="postbody"><span class="postbody">My favourite:
<br/>
 - <a href="http://www.eng.hawaii.edu/Tutor/Make/" target="_blank">http://www.eng.hawaii.edu/Tutor/Make/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123920 - kusma - Sun Apr 01, 2007 2:59 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>keldon wrote:</b></span></td> </tr> <tr> <td class="quote">My favourite:
<br/>
 - <a href="http://www.eng.hawaii.edu/Tutor/Make/" target="_blank">http://www.eng.hawaii.edu/Tutor/Make/</a></td> </tr></table><span class="postbody">
<br/>
Uhm, yeah. A tutorial that places preprocessor-flags in the CFLAGS variable... no thanks. Besides it barely scratches the surface of make, and i spot lots of minor error there.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123923 - keldon - Sun Apr 01, 2007 4:03 pm</h4>
    <div class="postbody"><span class="postbody">It's a great gateway into using makefiles though, showing the reasoning behind it and the basics in under 10 minutes.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#123976 - HyperHacker - Mon Apr 02, 2007 7:15 am</h4>
    <div class="postbody"><span class="postbody">OK, thanks. :-) But I still don't understand where in the world these errors are coming from. @_@<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#124006 - gmiller - Mon Apr 02, 2007 1:28 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">Well I'd like to get this working with batch scripts before I go off learning another whole language. I'd appreciate a link to some sort of documentation but for now let's just leave that alone if possible. I've almost got it working, but I'm getting compiler errors that make no sense. I figured leave the header file and compile the source itself (which includes the header), and in the test program, link to the .o file (which is now only 25K, which still seems pretty bloated) instead of including the source. But these errors...
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">F:\DOS\DevKitPro\devkitARM\bin\arm9.o: In function `powerON':
<br/>
F:\DOS\DevKitPro\libnds\include/nds/system.h:135: multiple definition of `_NumConsoles'
<br/>
..\general\console.o:(.bss+0x0): first defined here
<br/>
</td> </tr></table><span class="postbody">
<br/>
"_NumConsoles" doesn't appear in system.h at all! Line 135 is just:
<br/>
void powerON(int on) { POWER_CR |= on;}
<br/>
wtf?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">F:\DOS\DevKitPro\devkitARM\bin\arm9.o: In function `powerON':
<br/>
F:\DOS\DevKitPro\libnds\include/nds/system.h:135: multiple definition of `_CurrentConsole'
<br/>
..\general\console.o:(.bss+0x1): first defined here
<br/>
F:\DOS\DevKitPro\devkitARM\bin\arm9.o: In function `powerON':
<br/>
F:\DOS\DevKitPro\libnds\include/nds/system.h:135: multiple definition of `Console'
<br/>
..\general\console.o:(.bss+0x4): first defined here</td> </tr></table><span class="postbody">
<br/>
More of this. This makes no sense at all.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">f:/dos/devkitpro/devkitarm/bin/../lib/gcc/arm-eabi/4.1.1/../../../../arm-eabi/bin/ld.exe: Warning: size of symbol `Console' changed from 84 in ..\general\console.o to 112 in F:\DOS\DevKitPro\devkitARM\bin\arm9.o
<br/>
collect2: ld returned 1 exit status</td> </tr></table><span class="postbody">
<br/>
What?</span></td> </tr></table><span class="postbody">
<br/>
<br/>
The complaint about _NumConsoles  and _CurrentConsole (based on the "name mangling rules" this is the variable "NumConsoles" / "CurrentConsole" and the linker has found two definitions of the variables which is not allowed (you can only have one definition but you can have multiple references).  It is giving the location of the two definitions.  
<br/>
<br/>
The definition could be hidden in a macro so you would need to search further.  The linker is saying that the variable is first defined in console.o so look there to see if it needs to be defined there if that is your code.  
<br/>
<br/>
You could also be linking in two mutually exclusive object files or libraries.  The problems here could be the way you are linking or what you are linking and there is little I could add without more information.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#124011 - Puyo - Mon Apr 02, 2007 1:41 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Puyo wrote:</b></span></td> </tr> <tr> <td class="quote">There is a template in devkitPro examples.</td> </tr></table><span class="postbody">Where?</span></td> </tr></table><span class="postbody">
<br/>
<a class="postlink" href="http://devkitpro.cvs.sourceforge.net/devkitpro/examples/nds/templates/arm9lib" target="_blank">Here</a>. Or the same path in your local installation.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#124057 - HyperHacker - Mon Apr 02, 2007 9:29 pm</h4>
    <div class="postbody"><span class="postbody">Puyo, was DKP updated recently? I don't have any "arm9lib" there.
<br/>
<br/>
gmiller, the variables do in fact begin with an underscore. I understand the problem with multiple definitions and what might cause it, I just don't get why it's complaining about those particular lines. I'll look around to see if I can find any redefinitions.<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#124064 - Ant6n - Mon Apr 02, 2007 11:20 pm</h4>
    <div class="postbody"><span class="postbody">Another thing I would like to ask, directly connected to 'how to make a library', is the question of what else one has to supply in order to give out some library that people might actually use. checklist:
<br/>
- *.a
<br/>
- *.h-files
<br/>
- documentation??</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#124104 - kusma - Tue Apr 03, 2007 3:03 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ant6n wrote:</b></span></td> </tr> <tr> <td class="quote">- *.a
<br/>
- *.h-files
<br/>
- documentation??</td> </tr></table><span class="postbody">
<br/>
- source code
<br/>
- example code</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#124112 - Ant6n - Tue Apr 03, 2007 5:44 am</h4>
    <div class="postbody"><span class="postbody">source code? awww....
<br/>
and make public under which license? LGPL?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#124125 - kusma - Tue Apr 03, 2007 9:46 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ant6n wrote:</b></span></td> </tr> <tr> <td class="quote">source code? awww....
<br/>
and make public under which license? LGPL?</td> </tr></table><span class="postbody">
<br/>
<br/>
I prefer less restrictive open source licenses like BSD or Zlib License (or even public domain). This is simply because everything I release isn't open source software (in fact very little of what I release are), but I strongly prefer using open source libraries over closed source ones. This is because I don't want to depend on something I can't be sure is available in the future and for future compiler tool-chains.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#128971 - Karatorian - Thu May 17, 2007 7:37 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote">Well I'd like to get this working with batch scripts before I go off learning another whole language. I'd appreciate a link to some sort of documentation but for now let's just leave that alone if possible. I've almost got it working, but I'm getting compiler errors that make no sense. I figured leave the header file and compile the source itself (which includes the header), and in the test program, link to the .o file (which is now only 25K, which still seems pretty bloated) instead of including the source.</td> </tr></table><span class="postbody">
<br/>
<br/>
Well, it proably includes debugging information, so after you strip it, it should be smaller. It also includes the ELF header, which is pretty heavyweight as well. Once you convert from the ELF file to a GB ROM, that gets stripped also, so the end result will be smaller.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">But these errors...
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">F:\DOS\DevKitPro\devkitARM\bin\arm9.o: In function `powerON':
<br/>
F:\DOS\DevKitPro\libnds\include/nds/system.h:135: multiple definition of `_NumConsoles'
<br/>
..\general\console.o:(.bss+0x0): first defined here
<br/>
</td> </tr></table><span class="postbody">
<br/>
"_NumConsoles" doesn't appear in system.h at all! Line 135 is just:
<br/>
void powerON(int on) { POWER_CR |= on;}
<br/>
wtf?
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Without seeing your code (and libnds, I only have a GBA), I can't be sure exactly where the problem is. However, I will point out that GCC is sometimes a bit off when quoting line numbers. It does seem that _NumConsoles is being defined twice. Do you define _NumConsoles in a header of your own? Or is it defined in a system header? In either case, you should chech if the header where it's defined has an #ifndef to ensure that even if it's included by multiple source files in an object that it's defines are only executed once. Such code usually looks something like this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#ifndef _foo_h_
<br/>
#define _foo_h_
<br/>
<br/>
// content of header here
<br/>
<br/>
#endif // _gba_video_h_
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">F:\DOS\DevKitPro\devkitARM\bin\arm9.o: In function `powerON':
<br/>
F:\DOS\DevKitPro\libnds\include/nds/system.h:135: multiple definition of `_CurrentConsole'
<br/>
..\general\console.o:(.bss+0x1): first defined here
<br/>
F:\DOS\DevKitPro\devkitARM\bin\arm9.o: In function `powerON':
<br/>
F:\DOS\DevKitPro\libnds\include/nds/system.h:135: multiple definition of `Console'
<br/>
..\general\console.o:(.bss+0x4): first defined here</td> </tr></table><span class="postbody">
<br/>
More of this. This makes no sense at all.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
This is the same sort of problem as the first one as is likely caused by a similar issue.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">f:/dos/devkitpro/devkitarm/bin/../lib/gcc/arm-eabi/4.1.1/../../../../arm-eabi/bin/ld.exe: Warning: size of symbol `Console' changed from 84 in ..\general\console.o to 112 in F:\DOS\DevKitPro\devkitARM\bin\arm9.o
<br/>
collect2: ld returned 1 exit status</td> </tr></table><span class="postbody">
<br/>
What?</span></td> </tr></table><span class="postbody">
<br/>
<br/>
In this case, there is a variable named Console that is defined to be one size in console.o's source code, but is defined as a different size in arm9.o. To find out how this happened, you'll have to look into the source code, including included source, to see where the conflict arises.
<br/>
<br/>
It might be helpful to see your build system and and a list of what's included by what.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
