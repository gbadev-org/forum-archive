<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Data formats - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Coding > Data formats</h2>
<div id="posts">
<div class="post">
    <h4>#15214 - poslundc - Mon Jan 19, 2004 4:04 am</h4>
    <div class="postbody"><span class="postbody">The poll pretty much says it all. Post your reasons in this thread.
<br/>
<br/>
(I'm currently using C but am considering switching over to ASM for some of my files for the speed increase. Just curious what everyone else has to say on the matter.)
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15215 - DekuTree64 - Mon Jan 19, 2004 4:26 am</h4>
    <div class="postbody"><span class="postbody">ASM all the way, C files are just ridiculously slow to compile large arrays. On my old computer, which only had 16MB of RAM or something, I left it on all night trying to compile about 50-100KB of sound effects and it never did finish... Now with 64MB and a much faster processor, it could do that in less than a minute, but compared to a couple of seconds for a .s file, it's still a big waste of time.
<br/>
Object files are good too, but if you have a lot of small chunks of data they can start taking a while to link. Haven't tried GBFS, although it sounds like a fine system as well.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15216 - tepples - Mon Jan 19, 2004 4:55 am</h4>
    <div class="postbody"><span class="postbody">I tend to use GBFS.
<br/>
<br/>
Advantages of GBFS relative to bin2s:<ul><li>Artists don't need DKA Binutils installed.</li><li>Builds go fast, as there's no need for the makefile to call ld again when one of your asset files changes.</li><li>No intermediate .s files cluttering up your program; GBFS files more closely correspond to .o files.</li><li>GBFS files carry a directory giving each object a name; you may find this useful for building a level select menu.</li><li>As the author of GBFS, I'm <a class="postlink" href="http://c2.com/cgi/wiki?DogFood" target="_blank">eating my own dog food</a>, which says a lot for its robustness.</li></ul>Disadvantages:<ul><li>Can't use source-level debugging.</li></ul>
<br/>
I found it easy to solve the lack of source-level debugging: for builds intended for such debugging, convert the GBFS files themselves to .s files and link them into the program. To let your artists work independently with "working" code, make two targets in your makefile: one that builds just the program ready for appending GBFS files, and one that builds the program and links in the data. Only one function needs to know the difference; this function, run at the beginning of the program, locates and grabs pointers to GBFS files. It can be isolated in its own file.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15218 - sajiimori - Mon Jan 19, 2004 5:27 am</h4>
    <div class="postbody"><span class="postbody">I use a filesystem for reasons similar to what tepples posted (though I actually use my own), except linked in as one big object file.
<br/>
<br/>
Artists still need DKA, but GUI utilities can make its usage easy -- even transparent (they would probably appreciate a GUI utility for appending binary data anyway).
<br/>
<br/>
The rebuild process can take longer, but linking is generally fast (unless the project is really huge, which none of mine are).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15224 - MumblyJoe - Mon Jan 19, 2004 8:56 am</h4>
    <div class="postbody"><span class="postbody">I find using .h files for data relating to tiny arrays for sprites, and using .c-&gt;.o files for sound and linking them in seem the best combo for my needs.<br/>_________________<br/><a class="postlink" href="http://www.hungrydeveloper.com" target="_blank">www.hungrydeveloper.com</a>
<br/>
Version 2.0 now up - guaranteed at least 100% more pleasing!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15229 - tom - Mon Jan 19, 2004 10:45 am</h4>
    <div class="postbody"><span class="postbody">asm files. gas is pretty fast (as opposed to gcc, which is ridiculously slow at compiling large initialized arrays, also compared to other c compilers).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15235 - Touchstone - Mon Jan 19, 2004 4:34 pm</h4>
    <div class="postbody"><span class="postbody">I convert my resources from, say a PCX file, to an GCC object file using makefiles calling my own CLI converter tools. That way I get dependency check so each resources file is only converted when it's actually changed.
<br/>
<br/>
I also want each resource to have a symbol I can access from C. That way I can build really complex resource dependencies that use practically  no memory. Take animation for example. I define my animation structures something like this:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">typedef struct SAnimationFrame
<br/>
{
<br/>
   unsigned char Dimensions; // Width and height of animation frame
<br/>
   unsigned char* pTiles; // Pointer to tile data
<br/>
   unsigned short* pPalette; // Pointer to palette data
<br/>
   unsigned char Duration; // How many gameticks the animation should be visible
<br/>
}
<br/>
<br/>
typedef struct SAnimation
<br/>
{
<br/>
   unsigned char nFrames; // Number of frames in animation
<br/>
   SAnimationFrame* aFrames[]; // Array of animation frames
<br/>
}</td> </tr></table><span class="postbody">With that done I define an animation like this:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">unsigned short HeroPalette[][16] =
<br/>
{
<br/>
  {
<br/>
      .... palette 0 ....
<br/>
   }, {
<br/>
      .... palette 1 ....
<br/>
   }
<br/>
};
<br/>
<br/>
unsigned char HeroTiles[][32] =
<br/>
{
<br/>
   {
<br/>
      .... frame 0 ....
<br/>
   }, {
<br/>
      .... frame 1 ....
<br/>
   }, {
<br/>
      .... frame 2 ....
<br/>
   }, {
<br/>
      .... frame 3 ....
<br/>
   }
<br/>
};
<br/>
<br/>
// The animation frames
<br/>
SAnimationFrame HeroAnimationFrames[] =
<br/>
{
<br/>
   {
<br/>
      DIMENSIONS_2X2,
<br/>
      &amp;HeroTiles[0], // Point to frame 0
<br/>
      &amp;HeroPalette[0], // Use palette 0
<br/>
      5 // Visible for 5 gameticks
<br/>
   }, {
<br/>
      DIMENSIONS_2X2,
<br/>
      &amp;HeroTiles[3], // Point to frame 3
<br/>
      &amp;HeroPalette[1], // Use palette 1
<br/>
      5 // Visible for 5 gameticks
<br/>
   }, {
<br/>
      DIMENSIONS_2X2,
<br/>
      &amp;HeroTiles[2], // Point to frame 2
<br/>
      &amp;HeroPalette[0], // Use palette 0
<br/>
      5 // Visible for 5 gameticks
<br/>
   }
<br/>
}
<br/>
<br/>
// Now I can actually define my animations
<br/>
SAnimation HeroAnimation_Idle =
<br/>
{
<br/>
   2, // Two frames in idle animation
<br/>
   {
<br/>
      &amp;HeroAnimationFrame[0],
<br/>
      &amp;HeroAnimationFrame[2],
<br/>
   }
<br/>
}
<br/>
<br/>
SAnimation HeroAnimation_Walk =
<br/>
{
<br/>
   3, // Three frames in walk animation
<br/>
   {
<br/>
      &amp;HeroAnimationFrame[0],
<br/>
      &amp;HeroAnimationFrame[1],
<br/>
      &amp;HeroAnimationFrame[2],
<br/>
   }
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
Uuhm, I think I got that correct, writing from the top of my head. But anyways, that's what I like about having a symbol that can be used from C or asm for each resource. I can link to them from other resources.
<br/>
<br/>
EDIT: Well obviously I didn't get it right the first time. Keeping my fingers crossed for this one. :)<br/>_________________<br/>You can't beat our meat</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15236 - poslundc - Mon Jan 19, 2004 5:27 pm</h4>
    <div class="postbody"><span class="postbody">At this point in the poll, it seems that the majority still seem to prefer using C files, and I have to admit that I still haven't run into any serious issues (with regards to compile time, anyway) using them.
<br/>
<br/>
C files have the advantage of being extremely easy to generate and easy to read, which goes along well with the use of complicated structs.
<br/>
<br/>
I think I'm still inclined to use C files for the majority of my data, and just use ASM files for the exceptionally large cases of data.
<br/>
<br/>
Tepples, there's no questioning the utility of your GBFS. I think that some of us shy away from the notion of applying an actual generic file-system to the GBA (I know I do). I think it has to do with the fact that we are working so much closer with the actual representation of data, that it's easier on the psyche to manipulate the actual data structures as object files rather than to use a level of abstraction. Not sure if I can explain it in more reasonable terms than that. :)
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15237 - poslundc - Mon Jan 19, 2004 5:30 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>MumblyJoe wrote:</b></span></td> </tr> <tr> <td class="quote">I find using .h files for data relating to tiny arrays for sprites</td> </tr></table><span class="postbody">
<br/>
<br/>
<a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=2605" target="_blank">Don't do this!</a> Not even for tiny bits of data!
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15239 - torne - Mon Jan 19, 2004 5:46 pm</h4>
    <div class="postbody"><span class="postbody">I just use the linker and objcopy; linking has never been slow for me (though I do have a gigabyte of RAM..)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15246 - Paul Shirley - Mon Jan 19, 2004 10:25 pm</h4>
    <div class="postbody"><span class="postbody">removed</span><span class="gensmall"><br/><br/>Last edited by Paul Shirley on Sun Mar 28, 2004 9:20 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#15247 - sajiimori - Mon Jan 19, 2004 11:18 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
The real advantage of C over raw data (including assembler) is that its automatically in a directly readable correct struct, no need to convert formats at runtime or compile time and the data will survive changes of compiler or platform.
<br/>
</td> </tr></table><span class="postbody">
<br/>
That's true...endian-ness can be an issue with my filesystem, though I suppose I could parameterize the FS builder on things like that, if I ever wanted to use it for other platforms.
<br/>
<br/>
It just feels weird to have game data present in the C namespace...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15248 - tepples - Tue Jan 20, 2004 12:29 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Paul Shirley wrote:</b></span></td> </tr> <tr> <td class="quote">The real advantage of C over raw data (including assembler) is that its automatically in a directly readable <span style="font-style: italic">correct</span> struct</td> </tr></table><span class="postbody">
<br/>
Follow natural packing (e.g. 4-byte fields aligned to 4-byte boundaries), and make sure you use data sizes in bits (int32_t, etc), and your structs will turn out right on all common platforms of the same endianness. Common platforms' ABIs define it this way. What uncommon platform have you run into lately?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">no need to convert formats at runtime or compile time and the data will survive changes of compiler or platform.</td> </tr></table><span class="postbody">
<br/>
&lt;sarcasm&gt;Yeah right.&lt;/sarcasm&gt; Different platforms expect different tile data formats. For instance, Sega Genesis tiles are nibble-swapped from GBA tiles. GBC interleaves bitplanes per scanline. NES interlaves bitplanes per tile. GBC and NES also prefer column-major storage for large sprites because they can do only 8x8 or 8x16 pixel sprites. Super NES tile storage is a strange mix of GBC and NES methods, with GBA style 2D mapping except at 16-tile intervals rather than the GBA's 32-tile intervals. OpenGL and Direct3D expect tiles (which they call "textures") to be presented as linear true-color bitmaps with an alpha channel. Sega Dreamcast needs its textures full-outer-shuffled. And don't even get me started on nametable formats or sprite display list formats. You'll need per-platform conversion tools if you're going to develop for more than one platform.
<br/>
<br/>
That said, I have designed GBFS directory bytestreams to be little-endian because all common big-endian game platforms that are still being developed for run programs from RAM rather than from a solid-state ROM. RAM-based big-endian platforms can convert GBFS directories from little-endian to big-endian on load.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Less thinking needed means less errors and less time setting up the tools.</td> </tr></table><span class="postbody">
<br/>
If your map tools output C, then anybody who makes a map will have to have the same compiler you have. This can become expensive if you're not using GCC.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Can't see compile speed as a serious problem unless you're not using <span style="font-style: italic">make</span>.</td> </tr></table><span class="postbody">
<br/>
Unless you either 1. have a 333 MHz PC or 2. frequently get "Virtual memory exhausted" errors. Some people have found that their hardware tools (MBV2, flash linker, etc) work only on an older PC. Compiling a large preinitialized C array in GCC will eat through up to 60 times as much memory as the final array takes.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15295 - Paul Shirley - Tue Jan 20, 2004 4:13 pm</h4>
    <div class="postbody"><span class="postbody">removed</span><span class="gensmall"><br/><br/>Last edited by Paul Shirley on Sun Mar 28, 2004 9:21 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#15327 - tepples - Tue Jan 20, 2004 9:34 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Paul Shirley wrote:</b></span></td> </tr> <tr> <td class="quote">Tile data may be complex in <span style="font-style: italic">your</span> world, in mine its simple unstructured data suitable for objcopy (as suggested in my post) and portability was never an issue.</td> </tr></table><span class="postbody">
<br/>
If "portability was never an issue" to you, then what did you mean to "survive changes of [...] platform"?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">The 3D models I'm currently working with are highly structured data I have no intention of parsing at runtime if I can compile them and I don't change the convertor tool <span style="font-style: italic">every</span> time I tweak the data structures to save space or increase speed. Or when we build a PC reference build with the <span style="font-style: italic">same data</span>.</td> </tr></table><span class="postbody">
<br/>
Can you afford to license a compiler toolchain for each 3D artist and, if you're selling a PC game, for each end user who would create models? Or can you afford to make all your compiler toolchains ABI-compatible with object files produced by GCC?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">If a compiler can't handle standard C its users have a bigger problem than my tools.</td> </tr></table><span class="postbody">
<br/>
But then each person who edits model data for your engine has to possess a copy of such a compiler, which can become expensive if the compiler used to compile the game engine is not ABI-compatible with GCC.
<br/>
<br/>
Wait, now I think I get it: Portability of texture data is not an issue to you, but source-portability of model data is. Do I understand you correctly?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15405 - dagamer34 - Thu Jan 22, 2004 4:33 am</h4>
    <div class="postbody"><span class="postbody">I didn't know there was BBCode for sarcasm...<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
