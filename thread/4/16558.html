<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Sprite Handling Design? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > Sprite Handling Design?</h2>
<div id="posts">
<div class="post">
    <h4>#167733 - brave_orakio - Tue Mar 24, 2009 4:32 am</h4>
    <div class="postbody"><span class="postbody">So, how do you guys handle sprite? Do you dynamically allocate sprites, adding and removing as needed, or do you set a fixed number of sprites, say 10 or so, then just reuse as needed?
<br/>
<br/>
      I'm asking this because in my current code, adding or removing sprites(not dynamically. Just commenting or uncommenting then recompile to test) affects the speed of the overall game probably due to OAM sorting. I'm expecting more speed changing issues once I code in the collision detection.<br/>_________________<br/>help me</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167735 - gauauu - Tue Mar 24, 2009 2:52 pm</h4>
    <div class="postbody"><span class="postbody">Not that my way is anyway near "best", but I allocate memory for a fixed number (generally the max number), then have my own sprite allocation routines that initialize and hand out an unused sprite when asked, or turn sprites off when not needed.  
<br/>
<br/>
My OAM sorter then doesn't sort the sprites directly -- I have a list of in-game characters, and each character has a handle to the sprites it uses.  Then I sort the characters, and copy each character's sprites in turn.
<br/>
<br/>
Sorting shouldn't take much time at all, so unless you are squeezing every last bit of processing power out of each frame, you shouldn't see much slowdown due to sorting your sprites.  (unless you are doing something wrong?)
<br/>
<br/>
Also, abstracting a level like I was talking about (sorting and checking collisions against characters, not sprites) helps when you suddenly have characters that take multiple sprites, or are shaped differently, etc.  I highly recommend that.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167737 - sajiimori - Tue Mar 24, 2009 10:20 pm</h4>
    <div class="postbody"><span class="postbody">I recommend the following:
<br/>
<br/>
  - Treat the concept of a 'sprite' as something higher-level than a single OAM.  A sprite can consist of multiple OAMs, but it should still be a purely visual object -- don't do any collision or game logic in your sprite code.
<br/>
<br/>
  - Sort your sprite list every frame, using an algorithm that doesn't shuffle anything around if the list is already sorted.  On most frames, there will be few (if any) changes to the list order, so just quickly scan for out-of-order sprites and shift them to where they belong.
<br/>
<br/>
  - Build the OAM list from scratch, every frame, by iterating over your sprite list and writing out the set of OAMs for each sprite.  That will automatically give the correct sorting order.  Do this work during VDraw, into a buffer that you then DMA to the hardware during VBlank.
<br/>
<br/>
  - Use a full-fledged dynamic VRAM allocator for sprite pixel data.  One easy and fast approach is to have an array with 1 bit per char, to signify whether it's currently in use.  To allocate a sprite frame, scan for a block of contiguous zeros that's long enough to fit the frame.
<br/>
<br/>
  - Allocate your high-level Sprite objects just like any other object; you can hold them by value, dynamically allocate them -- anything that can be done with normal objects.  There's no need to force a particular allocation scheme onto all client code.  Sprites can automatically register a pointer to themselves into a master list, so they'll be correctly sorted and rendered.
<br/>
<br/>
  - Wrap it all up in a nice, clean interface, and forget about OAMs, bitfields, and VBlank interrupt handlers!  =)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167739 - brave_orakio - Wed Mar 25, 2009 2:29 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Sorting shouldn't take much time at all, so unless you are squeezing every last bit of processing power out of each frame, you shouldn't see much slowdown due to sorting your sprites. (unless you are doing something wrong?) </td> </tr></table><span class="postbody">
<br/>
<br/>
Well, not exactly slowdown. Just unstable speed(I can still decrease the delay between sprite updates). though I'm not sure if my sorting is horribly slow but I'm not using many sprites(around 4 for now because I'm only testing). 
<br/>
<br/>
I just have no idea how you guys can make the game speed not change even if there is only one or say 5 sprites. maybe if a lot is happening some slowdown would occur but generally it wouldn't. There's not even a lot happening per frame in my code. Just the sorting and the copy to VRAM and of course the copy to OAM during Vblank.
<br/>
<br/>
the stuff that sajimori said hasn't quite sunk in to my head yet though. Still a bit woozy.
<br/>
<br/>
thanks for the replies though, and keep em coming! The more opinions I read the better!<br/>_________________<br/>help me</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167740 - Miked0801 - Wed Mar 25, 2009 5:11 am</h4>
    <div class="postbody"><span class="postbody">Don't bubble sort your entire sprite list from scratch every tic.  :)
<br/>
<br/>
Profile your code.  That will tell you exactly where the slowdown is.  You will probably be surprised.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167741 - brave_orakio - Wed Mar 25, 2009 6:01 am</h4>
    <div class="postbody"><span class="postbody">Since profiling came up, any tools that are free and easy to use? &gt;:-) I only use PN2 for my coding.<br/>_________________<br/>help me</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167742 - Dwedit - Wed Mar 25, 2009 7:08 am</h4>
    <div class="postbody"><span class="postbody">Either make your program for your native platform (Windows, Linux, Etc), and use those tools to profile...
<br/>
But I also made a hacked version of VBA which counts the number of times an instruction is executed.
<br/>
Obviously, this is only useful for profiling ASM code...<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167743 - albinofrenchy - Wed Mar 25, 2009 8:07 am</h4>
    <div class="postbody"><span class="postbody">There is a cyg-profiler port out there; I keep meaning to do a write up, but haven't found the time. 
<br/>
<br/>
<a href="http://forum.gbadev.org/viewtopic.php?t=11985&amp;postdays=0&amp;postorder=asc&amp;highlight=cygprofile&amp;start=15" target="_blank">http://forum.gbadev.org/viewtopic.php?t=11985&amp;postdays=0&amp;postorder=asc&amp;highlight=cygprofile&amp;start=15</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167746 - gauauu - Wed Mar 25, 2009 2:50 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>brave_orakio wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
I just have no idea how you guys can make the game speed not change even if there is only one or say 5 sprites. </td> </tr></table><span class="postbody">
<br/>
<br/>
Assuming you are doing one frame of processing per vblank, you will, unless you are doing heavy computation, have quite a bit of processing time "wasted" at the end of every frame, where you are just waiting for vblank.  So the difference between 1, 5, or 25 sprites should just be more time processing and less time waiting on the vblank, and shouldn't affect the actual game speed at all.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167749 - brave_orakio - Thu Mar 26, 2009 2:14 am</h4>
    <div class="postbody"><span class="postbody">Guys, my head is clearer and the stuff you're saying is starting to make sense. Took long enough.
<br/>
<br/>
this
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Don't bubble sort your entire sprite list from scratch every tic. :) </td> </tr></table><span class="postbody">
<br/>
<br/>
and this
<br/>
<br/>
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"> Sort your sprite list every frame, using an algorithm that doesn't shuffle anything around if the list is already sorted. On most frames, there will be few (if any) changes to the list order, so just quickly scan for out-of-order sprites and shift them to where they belong. </td> </tr></table><span class="postbody">
<br/>
<br/>
and this
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Sorting shouldn't take much time at all, so unless you are squeezing every last bit of processing power out of each frame, you shouldn't see much slowdown due to sorting your sprites. (unless you are doing something wrong?) </td> </tr></table><span class="postbody">
<br/>
<br/>
make a lot of sense now. So how about more suggestions for collision though before I fully tackle that part?<br/>_________________<br/>help me</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167750 - brave_orakio - Thu Mar 26, 2009 2:38 am</h4>
    <div class="postbody"><span class="postbody">of course this one 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Also, abstracting a level like I was talking about (sorting and checking collisions against characters, not sprites) helps when you suddenly have characters that take multiple sprites, or are shaped differently, etc. I highly recommend that.</td> </tr></table><span class="postbody">
<br/>
<br/>
and this
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">- Treat the concept of a 'sprite' as something higher-level than a single OAM. A sprite can consist of multiple OAMs, but it should still be a purely visual object -- don't do any collision or game logic in your sprite code.</td> </tr></table><span class="postbody">
<br/>
<br/>
is already part of the planning in my collision process.<br/>_________________<br/>help me</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167751 - gauauu - Thu Mar 26, 2009 3:52 am</h4>
    <div class="postbody"><span class="postbody">For collisions, it really depends on how many possible things might be colliding.
<br/>
<br/>
Most simple or tile-based games will need to check all "characters" against each other, and against the background map.  It's easiest if you define a bounding box for each character, and check bounding boxes (which should be independent of the actual graphic sprites).  For backgrounds, you can check and see which logical map tiles (abstracted from actual tiles just like characters and sprites) the bounding box intersects, and see if that tile is a "collision" tile.
<br/>
<br/>
If you have a relatively small number of characters, (especially if you only need to check on-screen characters) you can just brute force checking them all against each other -- it doesn't take all that long for small numbers.  If you have quite a few to check, there are smarter algorithms for checking to see if the bounding boxes intersect (but don't worry about those if you've only got a few characters, and don't spend a lot of time prematurely optimizing!)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167752 - sajiimori - Thu Mar 26, 2009 3:53 am</h4>
    <div class="postbody"><span class="postbody">My favorite overall strategy for collision is to let each object handle their own collision detection, rather than having a 'collision system' control everything.
<br/>
<br/>
Write a function that provides an interface similar to this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
struct TestResult
<br/>
{
<br/>
  // Info about what/where/how/when objects
<br/>
  // were impacted.  At a minimum, a bool for
<br/>
  // 'something was hit', with no extra info.
<br/>
};
<br/>
<br/>
TestResult hypotheticalCollisionTest(
<br/>
  Position startPos,
<br/>
  Shape,  // Maybe radius, or width and height
<br/>
  Vector hypotheticalMotion);
<br/>
</td> </tr></table><span class="postbody">
<br/>
Objects that want other things to be able to collide with them should carry a collision object that registers itself in a list of all collidable objects, and the collision test function should check against those registered objects (and possibly against background collision).
<br/>
<br/>
The strategy for making it fast depends on the game, but the overall goal is the same: reduce the number of objects you have to visit during a collision test.  For a lot of games, sorting your objects from left to right is enough to avoid testing against most objects.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167754 - brave_orakio - Thu Mar 26, 2009 4:30 am</h4>
    <div class="postbody"><span class="postbody">I'm thinking a maximum of maybe 10 character on screen, 8 way directions for the smaller characters. 4 for bigger characters
<br/>
<br/>
Now then, another part of the plan in regards to actual implementation is use an array of function pointers so I can just check direction(0-7 for 8-way direction or 0-3 for 4 way direction) then the function for collision for that particular direction of movement is called. 
<br/>
<br/>
Does that sound like a good implementation? Also the sorting from left to right sounds quite good.
<br/>
<br/>
Another question is, if a character where to say throw a punch or slash or close range attack for example, would the attack be a different collision object from the character itself?<br/>_________________<br/>help me</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167755 - sgeos - Thu Mar 26, 2009 5:02 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>brave_orakio wrote:</b></span></td> </tr> <tr> <td class="quote">I just have no idea how you guys can make the game speed not change even if there is only one or say 5 sprites. </td> </tr></table><span class="postbody">
<br/>
Are you synchronizing your code to the display?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167757 - brave_orakio - Thu Mar 26, 2009 6:14 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Are you synchronizing your code to the display?</td> </tr></table><span class="postbody">
<br/>
<br/>
Yes it is synchronized. The problem is as Mike said, don't bubble sort every tic! I implemented a sort used for every frame that would go through the OAM list only once and sort only the ones out of place. I'm sure it could still use some optimization but it did have more stability with the speed changing issues.<br/>_________________<br/>help me</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167758 - sgeos - Thu Mar 26, 2009 8:03 am</h4>
    <div class="postbody"><span class="postbody">IIRC, bubble sort is a horrible algorithm.  If your current solution is not working, you could try to find a different algorithm, or split your sorting across multiple frames.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167760 - elwing - Thu Mar 26, 2009 8:39 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sgeos wrote:</b></span></td> </tr> <tr> <td class="quote">IIRC, bubble sort is a horrible algorithm.</td> </tr></table><span class="postbody">
<br/>
quite true, haven't seen it once (for more than 5element let's say...) since my college course...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167761 - brave_orakio - Thu Mar 26, 2009 9:48 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">IIRC, bubble sort is a horrible algorithm. If your current solution is not working, you could try to find a different algorithm, or split your sorting across multiple frames.</td> </tr></table><span class="postbody">
<br/>
<br/>
I had to find that out the hard way! Now I use it only to sort the list in for the first time then I use a faster sort the rest of the time.<br/>_________________<br/>help me</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167763 - sgeos - Thu Mar 26, 2009 11:59 am</h4>
    <div class="postbody"><span class="postbody">You might want to look into sorting algorithms, if you have the time or if this is a bottleneck in your code.  I suspect there is a faster way to do your initial sort.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167766 - gauauu - Thu Mar 26, 2009 3:01 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>brave_orakio wrote:</b></span></td> </tr> <tr> <td class="quote">I had to find that out the hard way! Now I use it only to sort the list in for the first time then I use a faster sort the rest of the time.</td> </tr></table><span class="postbody">
<br/>
<br/>
No no no, that's backwards.  
<br/>
<br/>
Use a faster sort the first time, because that's when bubble sort is REALLY going to be awful.  
<br/>
<br/>
On a list where only one or two items are out of place by one or two places (A list of characters that is mostly sorted, except two need to be swapped, like a sorted sprite list where one character moved), bubble sort can be as fast as O(n).  (I still don't really recommend you use it, as it can end up being REALLY slow if more things are out of place)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Now then, another part of the plan in regards to actual implementation is use an array of function pointers so I can just check direction(0-7 for 8-way direction or 0-3 for 4 way direction) then the function for collision for that particular direction of movement is called. 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Well, there are many different ways and designs to implement this, but I don't really get what you are describing.  What I did (and again, this likely isn't the BEST way) is to store the original position of my character, then update it's position for movement.  Then, check collisions.  If there was a collision, restore the original position.  (And you can make it slightly trickier by first removing the X component of movement, checking collision, then removing the Y component, checking, then restore the original, letting characters "slide" along walls diagonally).  
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Another question is, if a character where to say throw a punch or slash or close range attack for example, would the attack be a different collision object from the character itself?</td> </tr></table><span class="postbody">
<br/>
<br/>
You would probably want the attack to be a different object, as the collision characteristics are different (if the attack collides with an enemy, it damages the enemy.  If the character collides with the enemy, it damages the player.  If the attack hits a wall, who cares?  If the character hits a wall, he will be blocked).
<br/>
<br/>
But again, there generally isn't one design that's always best for all cases.  (And if there is, it's highly unlikely that I've stumbled upon it).  You'll want to tailor all this we're telling you so that it makes sense in your overall design and game style.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167767 - sgeos - Thu Mar 26, 2009 4:34 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Another question is, if a character where to say throw a punch or slash or close range attack for example, would the attack be a different collision object from the character itself?</td> </tr></table><span class="postbody">
<br/>
I'd spawn some sort of a damage object.  Think of it this way, if your character shoots a fireball, "would the attack be a different collision object from the character itself"?  No, right?  So you can spawn an invisible "fireball" at the character's fist and have it disappear after it times out (or something similar).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167769 - sajiimori - Thu Mar 26, 2009 6:33 pm</h4>
    <div class="postbody"><span class="postbody">Even if your characters can only move in 8 directions, I still recommend writing a general collision algorithm that takes <span style="font-style: italic">any</span> motion vector as input (i.e. motion at any angle), for several reasons:
<br/>
<br/>
  - It consolidates all the code into a single, generic function, rather than having 8 separate functions.  You'll find that there's less repetition this way.
<br/>
<br/>
  - If characters can move when they're half-way between two tiles (i.e. they don't have to move exactly along tile boundaries), making that work correctly is no less difficult than writing a fully generic collision function.
<br/>
<br/>
  - You'll have the freedom to make projectiles that move at arbitrary angles.
<br/>
<br/>
  - You can use it on future projects that allow a wider range of motion.
<br/>
<br/>
For attacks that hit enemies in a particular direction (e.g. swinging a sword in front of you), use a separate shape, but you don't need to make a whole collision object for it (and register it in the list of collidable objects, and so on), because nothing needs to collide against it -- the attack collision goes out and looks for things to hit.  You just pass the attack shape to your collision test function (an intersection test function this time, instead of a motion test) and execute the 'get hit' logic for all the intersected enemies.
<br/>
<br/>
By the way, you may only need to write an intersection test, rather than a motion test, if objects never move fast enough to pass through other objects (or walls).
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
// This function answers the question:
<br/>
// "If there were an object at the given location,
<br/>
// "what would it intersect?"
<br/>
TestResult hypotheticalIntersectionTest(Position, Shape);
<br/>
</td> </tr></table><span class="postbody">
<br/>
When a character is trying to move, check what it would intersect if it moved, then decide what to do based on the test result.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167775 - brave_orakio - Fri Mar 27, 2009 2:31 am</h4>
    <div class="postbody"><span class="postbody">From what I read from your ideas I think my idea for my collision algorithm is a bit strange. 
<br/>
<br/>
I'll explain a little further just to give you an idea and maybe find some flaws in my logic. It would good to know if the way I'm approaching things is wrong(not just the sorting and the collision).
<br/>
<br/>
The reason I have the array of function pointers is to avoid a long if else block. I can just use numbers to indicate a direction and then give it to the array of function pointers as an index and so the proper collision happens with a character going in that particular direction. 
<br/>
<br/>
As an example, say a character is moving right and then he hit a wall. The moving right direction has a value of 2 and this would be the index used in the function pointer array. Inside the function[2] is a process that says your x posiiton should go no further because of the collision. However nothing is said of the y position because he is only moving right(Of course if I want something to happen to the y position I can do that too).
<br/>
<br/>
Of course as mentioned before, there will be a lot of functions that will look alike. This of course is only my idea and it is very much appreciated if you have something to say about its flaws and  advantages/disadvantages.<br/>_________________<br/>help me</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167778 - brave_orakio - Fri Mar 27, 2009 4:59 am</h4>
    <div class="postbody"><span class="postbody">The generic collision algorithm suggested by sajimori sounds good and can be implemented easily with my current structure. Give me sometime to ingest this stuff. Keep the ideas coming while I test out some of these suggestions though!<br/>_________________<br/>help me</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167781 - sgeos - Fri Mar 27, 2009 8:03 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>brave_orakio wrote:</b></span></td> </tr> <tr> <td class="quote">The reason I have the array of function pointers is to avoid a long if else block.</td> </tr></table><span class="postbody">
<br/>
Why not use a switch statement?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167823 - brave_orakio - Mon Mar 30, 2009 2:09 am</h4>
    <div class="postbody"><span class="postbody">Sorry for the late reply, I have no access to a computer on the weekends here. 
<br/>
If I am correct, a switch block would be slightly slower with several branches but with a array of function pointers, just one branch will do. Where the program branches is of course the address of the function required.<br/>_________________<br/>help me</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167825 - sajiimori - Mon Mar 30, 2009 3:12 am</h4>
    <div class="postbody"><span class="postbody">It depends -- just use whichever style you'd prefer to work with.
<br/>
<br/>
But of course, I still think it's basically not worth it to have separate algorithms for each direction, regardless of how you split them up.  =)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167890 - brave_orakio - Thu Apr 02, 2009 2:47 am</h4>
    <div class="postbody"><span class="postbody">Hi guys, I'll give you an update on my progress. I used sajimori's bounding box and sorting idea. Except  that I used Y sorting instead of X(Since the character list is already Y sorted anyway. And there's something wrong with my X sorting I think heh.) It's quite fast! Thanks alot!<br/>_________________<br/>help me</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167891 - brave_orakio - Thu Apr 02, 2009 5:42 am</h4>
    <div class="postbody"><span class="postbody">Although I'm still confused. The current build is running far faster than I could ever imagine without your help and I am quite happy with the speed(I can probably optimize further at a future time), but changing the number of sprites still greatly affect the overall speed. 
<br/>
<br/>
Do you guys put some sort of dummy functions or something when there are less characters on screen? Or maybe functions that check if a character should be displayed on screen when moving in the game world?
<br/>
<br/>
For example, I have six characters right now, 1 which I control and the others doing nothing but copying frames at intervals(Just to simulate how much clock time is consumed when I implement AI). When I move left the characters of course eventually become offscreen(They will show up on the other side when I scroll further as I haven't implemented the character show and remove part). When they are offscreen, do you change the previous AI process to a function that looks for a character to be shown onscreen?<br/>_________________<br/>help me</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167896 - gauauu - Thu Apr 02, 2009 3:10 pm</h4>
    <div class="postbody"><span class="postbody">Again, if you are getting fluctuations in speed based on the number of sprites on screen, then one of two things is happening:
<br/>
<br/>
1.  You aren't waiting for vblank each frame, so your main loop is running as fast as it can.  This will mean the framerate will drastically change with the amount of processing you have to do.  This is bad. 
<br/>
<br/>
2.  When you have a lot of sprites on screen, you are running over the amount of processing you can do in video frame, and are running over into the next video frame, so when you wait for vblank, you now doing 2 video frames per iteration through your main loop.
<br/>
<br/>
I'm guessing it's #1, unless you're doing something horribly inefficient or rather complicated, as you really have quite a lot of processing time in each frame.  (and it should be fairly easy to tell which it is....is the game jumping back and forth between 1 speed and half that speed, or is it a gradual speed change?)
<br/>
<br/>
The real question:  are you calling VBlankIntrWait() with each iteration of your main loop?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Do you guys put some sort of dummy functions or something when there are less characters on screen?</td> </tr></table><span class="postbody">
<br/>
<br/>
No, the extra padding time is filled when we call VBlankIntrWait().
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"> Or maybe functions that check if a character should be displayed on screen when moving in the game world? 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Handing off-screen characters varies significantly with your game design.  Reasonable designs range from killing offscreen enemies, freezing them and not processing them offscreen, processing them just like a normal character (minus displaying them) if they are within a certain range of the screen, or just processing all characters all the time.  It's hard to give you a "here's the best way to handle it" advice for this.  
<br/>
<br/>
But if your framerate is drastically fluctuating, your first problem is figure out which of the two things I mentioned above that it is, and fix the root of the problem.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167897 - elyk1212 - Thu Apr 02, 2009 6:27 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Do you guys put some sort of dummy functions or something when there are less characters on screen?
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I should also mention, if you ever want to port your code to a different system this is highly unpredictable way to judge timing.  I've seen it done in hackish situations (especially from not software types) but it always makes me throw up a little in my mouth ;).  
<br/>
<br/>
Naw, but the VBlank waiting is the best.  In situations in embedded systems where you need a specific delay, using a timer is a great idea.  For this kind of device though, screen updates are already deterministic so...
<br/>
<br/>
<br/>
BTW, great thread.  I was wondering what the "greats" do for character handing also.  I am deciding the what and how of off screen characters.  Efficiency/Accuracy trade off.  
<br/>
<br/>
I've noticed in older games many characters just regenerate and start their pattern when you come back on the screen.  Seems like they don't track too much.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167904 - sajiimori - Thu Apr 02, 2009 8:54 pm</h4>
    <div class="postbody"><span class="postbody">How I handle off-screen characters depends on the game, but at the very least, I skip all of their rendering code.
<br/>
<br/>
Beyond that, I usually keep them fully active when they're within a certain distance of the play area.  When they're outside that range, I either kill them completely, or replace them with tiny structs that only remember their most important attributes (like their location and type) so they can be recreated when they get back in range.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167905 - gauauu - Thu Apr 02, 2009 9:04 pm</h4>
    <div class="postbody"><span class="postbody">In Anguna, I cheesed out on the issue of offscreen chracters.  Everything was divided into room (like old zelda games), meaning there was a set, small number of enemies when you entered the room.  Even if they were offscreen, I could still easily track every enemy in the room.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167908 - brave_orakio - Fri Apr 03, 2009 3:03 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">No, the extra padding time is filled when we call VBlankIntrWait().</td> </tr></table><span class="postbody">
<br/>
<br/>
This makes sense. I didn't think of this one. 
<br/>
<br/>
Although I don't have a dynamic add and remove character function yet, I did simulate this by commenting out and recompiling. I would have to say that the speed changes gradually. With less character on screen, the speed increases.
<br/>
<br/>
So apparently, I'm still doing more than I should be doing per frame. Most of my loops should run in O(n) especially the sorting loop since I fixed it that way. Here's the code for the quick sort.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   int i,j;
<br/>
   CHARACTER_ATTR *tempSort;
<br/>
   OBJ_ATTR tempAttr;
<br/>
   
<br/>
   for(i = 0, j = 1; j&lt;index; i++,j++)
<br/>
   {
<br/>
      if(CharListY[i]-&gt;sprite_posNew.y&gt;CharListY[j]-&gt;sprite_posNew.y)
<br/>
      {
<br/>
         update[i] = CharListY[i]-&gt;OAM;
<br/>
      }
<br/>
      else
<br/>
      {
<br/>
         tempAttr = CharListY[i]-&gt;OAM;
<br/>
         update[i] = CharListY[j]-&gt;OAM;
<br/>
         update[j] = tempAttr;
<br/>
      
<br/>
         tempSort = CharListY[i];
<br/>
         CharListY[i] = CharListY[j];
<br/>
         CharListY[j] = tempSort;
<br/>
         
<br/>
         CharListY[i]-&gt;positionY--;
<br/>
         CharListY[j]-&gt;positionY++;
<br/>
      }
<br/>
   }
<br/>
   update[i] = CharListY[i]-&gt;OAM;</td> </tr></table><span class="postbody">
<br/>
<br/>
As you can see it is fixed for O(n). I'm just letting the rest of the frames further sort it if the first frame missed something. CharListY is an array of pointers and update is the buffered OAM.<br/>_________________<br/>help me</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167909 - brave_orakio - Fri Apr 03, 2009 3:34 am</h4>
    <div class="postbody"><span class="postbody">Oh and here's the one for the collision:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   int i,j;
<br/>
   int l1,l2,r1,r2,t1,t2,b1,b2;
<br/>
   
<br/>
   volatile CHARACTER_ATTR *collide1, *collide2;
<br/>
   
<br/>
   for(i = 0, j = i+1; i&lt;nCollision; i++,j++)
<br/>
   {
<br/>
      if(j &gt;= nCollision)
<br/>
      {
<br/>
         j = i+1;
<br/>
         continue;
<br/>
      }
<br/>
      collide1 = CharListY[i];   
<br/>
      collide2 = CharListY[j];
<br/>
<br/>
      t1 = collide1-&gt;sprite_posNew.y - collide1-&gt;width;
<br/>
      t2 = collide2-&gt;sprite_posNew.y - collide2-&gt;width;
<br/>
      b1 = collide1-&gt;sprite_posNew.y + collide1-&gt;width;
<br/>
      b2 = collide2-&gt;sprite_posNew.y + collide2-&gt;width;
<br/>
      
<br/>
      if(t1&gt;b2) continue;
<br/>
      if(b1&lt;t2) continue;
<br/>
      
<br/>
      l1 = collide1-&gt;sprite_posNew.x - collide1-&gt;length;
<br/>
      l2 = collide2-&gt;sprite_posNew.x - collide2-&gt;length;
<br/>
      r1 = collide1-&gt;sprite_posNew.x + collide1-&gt;length;
<br/>
      r2 = collide2-&gt;sprite_posNew.x + collide2-&gt;length;
<br/>
<br/>
      i--;
<br/>
      
<br/>
      if(r1&lt;l2) continue;
<br/>
      if(l1&gt;r2) continue;
<br/>
<br/>
      collide1-&gt;sprite_posNew = collide1-&gt;sprite_pos;
<br/>
      collide2-&gt;sprite_posNew = collide2-&gt;sprite_pos;
<br/>
<br/>
      i++;
<br/>
      j = i + 1;
<br/>
   }</td> </tr></table><span class="postbody">
<br/>
<br/>
It looks a bit wierd maybe but here's a quick explanation:
<br/>
<br/>
The character list is Y sorted so I basically check first if they are in collision in the top and bottom bounds. If not on to the next set. If it is in collision check the left and right bounds. If in collison, collide then check next set, if not check the current(collide1) with the next character.
<br/>
<br/>
In a related question, around how many can you sort and collide like this per frame without slowing down?<br/>_________________<br/>help me</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167913 - elyk1212 - Fri Apr 03, 2009 6:07 am</h4>
    <div class="postbody"><span class="postbody">Oh, this sounds like a great reason to start looking into I-Collide.  A method of sorting all your on screen characters by each axis, by their bounding box beginning end end points (for each axis).  Quite simple for 2D and really nice savings for 3D.  Since they would all be pointers, as long as you don't have insane amounts of characters, it shouldn't eat up too much memory.  
<br/>
<br/>
But yeah, a sort each frame (so long as you don't have sprites warping to other sides of the screen) should run in O(N) time if doing bubble sort or insertion sort, since each list will be almost sorted on each run.  
<br/>
<br/>
This idea flows from the dx and dy on each frame, for each character should not be very large (no warping or any such non-sense).
<br/>
<br/>
Anyhow, collision detection is free when you do a swap as you can tell if a end point as crossed over a start point, there was a collision
<br/>
<br/>
E.g.  looking at only one axis
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
Frame 1
<br/>
X axis only (all end points noted)
<br/>
|----------------------------| -------------------------------| ----------------|
<br/>
Ob1begin                    Obj1end                        Obj2begin        Ob2end                   
<br/>
<br/>
Frame 2 :  Swapped Obj1End with Obj2begin.. COLLISION ON X add to a list of "active pairs"
<br/>
X axis only (all end points noted)
<br/>
|----------------------------| -------------------------------| ----------------|
<br/>
Ob1begin                    Obj2begin                       Obj1end       Ob2end   
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Similarly if you swap in the reverse manor, the objects are no longer colliding. So collision detection is free, just the cost of doing your normal sorting... kinda.
<br/>
<br/>
You will note, each bounding box must collide on all axis in order for a collision to have occurred. 
<br/>
<br/>
Sometimes you can cheat in 3D though if say your guy doesn't fly, it is safe to say a collision may have occurred if just x-z is in a collision state... but depends on your game/requirements etc.
<br/>
<br/>
I used I-Collide for some Masters Independent study projects and it worked great (3D).  However, for the lower level polygon detection (underneath the bounding box detection),  I used a brute force "find a dividing plane" algorithm that wasn't the fastest, and definitely could be improved.  But you would not need this for 2D, it doesn't need to be polygon/pixel exact, I wouldn't think anyhow.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167914 - brave_orakio - Fri Apr 03, 2009 9:02 am</h4>
    <div class="postbody"><span class="postbody">I think I know I-collide as another name. Recursive-something, I read it in Game Programming gems. My sort is somewhat similar, since characters are already sorted according to Y, I used part of the concept.<br/>_________________<br/>help me</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167924 - elyk1212 - Fri Apr 03, 2009 3:50 pm</h4>
    <div class="postbody"><span class="postbody">Maybe, but I would think it would have been called V-Collide or something, as it has been slightly modified in implementation and retained only a slightly different name.
<br/>
<br/>
<a href="http://www.cs.unc.edu/~geom/V_COLLIDE/" target="_blank">http://www.cs.unc.edu/~geom/V_COLLIDE/</a>
<br/>
<br/>
<br/>
I highly recommend reading the I-Collide paper:
<br/>
<a href="ftp://ftp.cs.unc.edu/pub/users/manocha/PAPERS/COLLISION/paper3dint.pdf" target="_blank">ftp://ftp.cs.unc.edu/pub/users/manocha/PAPERS/COLLISION/paper3dint.pdf</a>
<br/>
<br/>
<br/>
However, this paper exploits spatial coherency between frames, and many techniques utilize this idea for collision detection as well as visibility culling.  So you may have been reading about a technique with a similar approach.
<br/>
<br/>
As far as I can recall, there isn't much recursive about this algorithm, unless you were traversing some type of scene hierarchy  (Octrees, KDTrees, etc), which may also be a trick to improve collision detection (not caring about what's going on several nodes away and not checking for collisions between far nodes).  But that complicates the endpoint sorting slightly as they may not be "almost sorted" when characters start popping on the screen (or crossing node boundaries), many at a time.
<br/>
<br/>
<br/>
Oh, important detail I forgot to mention.  Your bounding boxes must be axis aligned (no worries in 2D), and the endpoints must be in World space (so translate your bounding box endpoints by the world space cords of your character).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167927 - elyk1212 - Fri Apr 03, 2009 4:41 pm</h4>
    <div class="postbody"><span class="postbody">Your code from before:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
int i,j;
<br/>
   CHARACTER_ATTR *tempSort;
<br/>
   OBJ_ATTR tempAttr;
<br/>
   
<br/>
   for(i = 0, j = 1; j&lt;index; i++,j++)
<br/>
   {
<br/>
      if(CharListY[i]-&gt;sprite_posNew.y&gt;CharListY[j]-&gt;sprite_posNew.y)
<br/>
      {
<br/>
         update[i] = CharListY[i]-&gt;OAM;
<br/>
      }
<br/>
      else
<br/>
      {
<br/>
         tempAttr = CharListY[i]-&gt;OAM;
<br/>
         update[i] = CharListY[j]-&gt;OAM;
<br/>
         update[j] = tempAttr;
<br/>
      
<br/>
         tempSort = CharListY[i];
<br/>
         CharListY[i] = CharListY[j];
<br/>
         CharListY[j] = tempSort;
<br/>
         
<br/>
         CharListY[i]-&gt;positionY--;
<br/>
         CharListY[j]-&gt;positionY++;
<br/>
      }
<br/>
   }
<br/>
   update[i] = CharListY[i]-&gt;OAM;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I have another small suggestion.  I think you should really only be doing assignments if something is out of place in the list.  So, if you decide on the Endpoint I-collide, you'd only do a swap if something was out of place.  This might save clocks.  
<br/>
<br/>
This way, each node in the list is checked but a few memory writebacks are only done if something needs to be swapped.
<br/>
<br/>
Currently you're moving data around a lot.  But, I don't know, that may be a small tweak.  Also you're managing OAM attributes as well in the same spot?  Maybe just have a visibility flag set in a Character object that states weather it should be appended to OAM?
<br/>
<br/>
It should not need to be placed in OAM unless it can be seen.  But I am not entirely clear on the technique you have going, so I may be off here.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167943 - brave_orakio - Sat Apr 04, 2009 12:28 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I think you should really only be doing assignments if something is out of place in the list</td> </tr></table><span class="postbody">
<br/>
<br/>
I think thats whats happening right now If I understand you correctly. Although admittedly, I have can optimize it some more now that you mentioned it.
<br/>
As for the OAM, the plan is to remove an object if it isn`t visible before this sort happens and I guess I want to avoid another loop that`s why I`m building it here.
<br/>
<br/>
And one more thing, do you guys stagger the proccesses over several frames? Like say, frame 1 update all characters, frame 2 sort, frame 3 collision then repeat.<br/>_________________<br/>help me</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167947 - sajiimori - Sat Apr 04, 2009 4:01 am</h4>
    <div class="postbody"><span class="postbody">What you're doing doesn't look slow at all.  If you've only got 6 characters, you should be fine.  Doing a single pass of swapping out-of-order sprites is a great way to get lots of speed, and it rarely causes any noticeable problems.
<br/>
<br/>
Your characters aren't really 'volatile', are they?  If you're modifying their collision data during an interrupt, there's something horribly wrong!
<br/>
<br/>
But if not, then don't declare them 'volatile', because that basically turns off the optimizer.  =)
<br/>
<br/>
BTW, you are compiling with optimizations enabled, right?
<br/>
<br/>
Edit: Actually, I don't understand your collision loop.  Isn't this simpler?
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">// Works if objects are sorted left-to-right.
<br/>
for(int i = 0; i &lt; numObjects - 1; ++i)
<br/>
{
<br/>
   for(int j = i + 1; j &lt; numObjects; ++j)
<br/>
   {
<br/>
      if(j is completely to the right of i)
<br/>
         break;
<br/>
<br/>
      if(i and j intersect)
<br/>
         flag the collision to be resolved later;
<br/>
   }
<br/>
}
<br/>
<br/>
// Now resolve all the flagged collisions.
<br/>
</td> </tr></table><span class="postbody">
<br/>
But of course, I still <span style="font-style: italic">greatly</span> prefer to let objects handle their own collision, rather than doing all collision in a single loop.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167948 - elyk1212 - Sat Apr 04, 2009 5:50 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
And one more thing, do you guys stagger the proccesses over several frames? Like say, frame 1 update all characters, frame 2 sort, frame 3 collision then repeat.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Well, if you use I-Collide all you have to do is do a bubble sort each frame and keep track of new collisions on swaps and de-register objects that are no longer colliding on swaps.  This would be in O(N) time and is very reasonable to do on a frame by frame basis :)
<br/>
<br/>
It is a little extra work.
<br/>
<br/>
BTW, yeah, it looks like you weren't moving that much data.  Disregard that last statement.   But, anyhow, yeah I-Collide....  You know you want to try it  :P</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167949 - brave_orakio - Sat Apr 04, 2009 10:22 am</h4>
    <div class="postbody"><span class="postbody">Yeah, I am compiling with the optimizations enabled. That`s the one with O# in the make file right?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Actually, I don't understand your collision loop. Isn't this simpler? </td> </tr></table><span class="postbody">
<br/>
<br/>
Yes and I tested it, it works the same. I think I just over thought my collision loop!
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">But of course, I still greatly prefer to let objects handle their own collision, rather than doing all collision in a single loop</td> </tr></table><span class="postbody">
<br/>
<br/>
Well,　the my current collision process is still too slow (much faster than the last one though)and I will probably try this
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">But, anyhow, yeah I-Collide.... You know you want to try it :P</td> </tr></table><span class="postbody">
<br/>
<br/>
and this as well! I`ll update you guys with my progress when I try both of these! Thanks for the suggestions again!<br/>_________________<br/>help me</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167952 - Miked0801 - Sat Apr 04, 2009 4:44 pm</h4>
    <div class="postbody"><span class="postbody">How many objects are you attempting to collide each tic?  In Lord of the Rings, Return of the king, we were moving dozens of sprites and checking hundreds of collides each game loop.  Same for many other games.  I'm having a hard time imagining you are having processing issues with 6 or so sprites.
<br/>
<br/>
BTW, use insert sort over bubble sort.  It is always faster.  And consider using shell sort which will eliminate just about any other speed concern you may have with sorting.
<br/>
<br/>
And again, profile to see where you are spending your time instead of guessing.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167968 - elyk1212 - Sat Apr 04, 2009 6:26 pm</h4>
    <div class="postbody"><span class="postbody">Mike: So did you check hundreds of collides indiscriminately, or was it based on some sort of subdivision or coherency?  I wonder if a brute force technique was used effectively.  If so, I've definitely over done it with suggesting I-Collide ;)
<br/>
<br/>
BTW, isn't Shell sort just insertion sort for "nearly" sorted lists?  Perhaps it would be even better to use Shell, though, if you ever wanted to have objects move in different ways (and initial sort would be quicker).
<br/>
<br/>
<br/>
I think I missed the fact you were only checking 6 objects.  As Mike suggested, I think you may need to look into profiling and also skim around looking for something obvious.  Nothing as complex as I a suggested is needed for 6 objects.  I was using many hundreds of 3D objects that warranted the I-Collide system.
<br/>
<br/>
Still, fun to know and you might like it for 3D games you could make in the future. (Maybe keep it in mind).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167981 - keldon - Sun Apr 05, 2009 1:47 am</h4>
    <div class="postbody"><span class="postbody">[Very late to discussion, all of my comments are probably irrelevant]
<br/>
<br/>
My solution for sprite tile allocations (is also valid for background tiles)consists of a basic allocator for OAM entries, and an allocator (much like a  typical memory allocator) for the sprite/tile names (since the character names refer to addresses).
<br/>
<br/>
My implementation uses a partitioned linked list:one partition for allocated, one for free, one for unspecified (where cells in the structure refer to MEMORY_BLOCKS's).
<br/>
<br/>
I'm sure it could be faster by using skip-lists, but hasn't caused me any problems.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167982 - Miked0801 - Sun Apr 05, 2009 5:09 am</h4>
    <div class="postbody"><span class="postbody">Pretty much brute force. :)  We added elements to a list each gameloop if the collidable flag was set.  That was the first cull.  Then, we had some intermediate flags and checks to cull it further (most off screen actors didn't need to collide, but some did like platforms).  Did I mention we were doing multiple types of collision boxes per actors, an attack and body collide?  That along with a 3rd check for BG collisions that only collided with other bg information (and was 2D vector based.)  So we did attack/body, body/attack, and body/body collides per tic skipping attack/attack.  I believe we also did some basic circumscribed circle, radius/radius checking as a secondary cull, but it was dropped as AA box checks are pretty dang fast as is.
<br/>
<br/>
This collision pass was an  O^2 / 2 type pass and was one of our top CPU eaters, but not the worst (which is always, always sound and music.)  
<br/>
<br/>
So yeah, I feel you are really over doing it here.  I've found that when the number of collidable actors is getting too high, a simple x/y grid hash will bring to results back closer to O(n).  Something like x pos / some power of 2 or'd siwth a shifted y pos / a similiar power of 2 where the divisor is larger than the biggest collision box to make the spanning of areas code cleaner.  RotK did not need this.
<br/>
<br/>
And yes, shell is just a insert sort with larger initial steps.  I believe the best step results come in at 63, 21, 7, 3, 1 for the steps.  It's a nice stable O^1.25 sort that has no memory overhead and sorts in place.  Great for or large datasets.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167989 - brave_orakio - Mon Apr 06, 2009 12:22 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"> I'm having a hard time imagining you are having processing issues with 6 or so sprites. </td> </tr></table><span class="postbody">
<br/>
<br/>
exactly. I posted my code for the sorting and collision in the last few posts(Check sajimori`s post for the collision algorithm, mine is too complex using the same logic and I did change my collision that). I tried putting volatile in my OAM buffer just to try out what sajimori said and strangely, the generated ASM is longer but the runtime is faster in the emulator. 
<br/>
<br/>
Anyway, around how many sprites is the average before I should see any performance issues if everything is working as it should? 
<br/>
<br/>
And perhaps one more issue, Should I stagger my character control code over several frames(Check button input 1st frame, update position 2nd frame etc.) I`ve read of suggestion that do this with AI<br/>_________________<br/>help me</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167991 - Miked0801 - Mon Apr 06, 2009 2:24 am</h4>
    <div class="postbody"><span class="postbody">Run your game at 30hz.  That will give you more than enough time to do what you need.  Then you don't need to worry about how you split your code up across frames.  Put a counter in your vblank handler and at the end of your game loop, wait until at least 2 vblanks have passed before continuing.
<br/>
<br/>
And how many sprites?  Depends on what that sprite is doing.  You could run a game with hundreds of sprites being updated using hblank tricks if nothing else in your game needed CPU time.  If, on the other hand, you are streaming music, waiting for multiplayer communications, processing massive amounts of AI, etc. it can be as little as 1 sprite.  The number of sprites shouldn't be a limiting factor to your game's performance.  Sound can though :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167992 - sajiimori - Mon Apr 06, 2009 4:54 am</h4>
    <div class="postbody"><span class="postbody">Yeah, I think all our GBA games ran at 30fps.
<br/>
<br/>
But also, set up a timer and measure how long each section of your code is taking.  Maybe there's a bug that's causing something to take far longer than it should.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167997 - brave_orakio - Mon Apr 06, 2009 12:07 pm</h4>
    <div class="postbody"><span class="postbody">Any way to print the result of the timer without building a text system of my own?
<br/>
<br/>
If not, can anyone tell me how to connect a library(libgba, libmirko or tonclib)? Maybe I can use their existing system. What do I have to put in the make file to connect the libraries?<br/>_________________<br/>help me</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168003 - Miked0801 - Mon Apr 06, 2009 4:05 pm</h4>
    <div class="postbody"><span class="postbody">Do you have any sort of debugging capability at all?  No printfs, no break points?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168011 - elyk1212 - Mon Apr 06, 2009 8:32 pm</h4>
    <div class="postbody"><span class="postbody">I used libgba, and this is the ghetto fabulous way I do things:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
//******************************************************************************
<br/>
/**
<br/>
*   Set up the print system
<br/>
*/
<br/>
inline void Debug::printSetup()
<br/>
{
<br/>
    static int setup = 0;
<br/>
<br/>
        consoleInit( 0 , 4 , 0, NULL , 0 , 15);
<br/>
        BG_COLORS[0]=RGB8(58,110,165);
<br/>
        BG_COLORS[241]=RGB5(31,31,31);
<br/>
        
<br/>
        
<br/>
        SetMode(MODE_0 | BG0_ON | OBJ_ENABLE);
<br/>
        setup = 1;
<br/>
}
<br/>
//
<br/>
//  First I call the above, then I call something like:
<br/>
//    
<br/>
///   iprintf("\x1b[0;0H current.position: %d,%d",c-&gt;position.x,c-&gt;position.y);
<br/>
//  Where 0,0 are the coordinates where the printing begins.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
But after you print once, the whole screen gets messed up (cannot see sprites, BG etc).  LOL., but at least you can see your data values.
<br/>
<br/>
<br/>
I would use a debugger but I haven't ported the fix for VBA that gmiller created (to Linux) yet.  As soon as I do though, I'll try and release it and make sure it works on both Win32 and Linux if possible.... or I'll get lazy and use wine. :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168017 - brave_orakio - Mon Apr 06, 2009 11:15 pm</h4>
    <div class="postbody"><span class="postbody">I use devkitarm and programmer's notepad as an editor. There seems to be a printf but I don't know how to use it here(I tried it, it compiles correctly but nothing is displayed). As far as I can tell, no debugging. Or at least I don't know how to set it up<br/>_________________<br/>help me</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168018 - elyk1212 - Mon Apr 06, 2009 11:24 pm</h4>
    <div class="postbody"><span class="postbody">Did you try my solution?  (See above).  Everything called in the printSetup function is available through libgba.  Then you just call this function called <span style="font-weight: bold">iprintf</span> which has the coordinates first, then all other parts of the string work like printf would normally work: %x for hex, %i for integer...  etc.  
<br/>
<br/>
Keep in mind, there's probably a better way, but at least it's something :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168019 - brave_orakio - Tue Apr 07, 2009 12:01 am</h4>
    <div class="postbody"><span class="postbody">How do I connect libgba to my　project? Do I need to add something to my environment variables and makefile? I'm no expert in makefiles and I have no idea how to do this manually.<br/>_________________<br/>help me</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168020 - Dwedit - Tue Apr 07, 2009 12:28 am</h4>
    <div class="postbody"><span class="postbody">If you're using devkitarm's easy makefiles, you are already linking to libgba, just include the correct header files and it should work already.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168023 - brave_orakio - Tue Apr 07, 2009 12:43 am</h4>
    <div class="postbody"><span class="postbody">I didn't know devkitarm had it's own makefile. I'm using my own<br/>_________________<br/>help me</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168026 - elyk1212 - Tue Apr 07, 2009 2:08 am</h4>
    <div class="postbody"><span class="postbody">Use the template if you want to have a quick solution, if not post your Makefile here and I'll let you know what to add.
<br/>
<br/>
Basically though, it's not a question of Makefiles so much as knowing what to pass to gcc/g++, but it sure helps to know the shell and Makefile tricks :)
<br/>
<br/>
So, for example when calling gcc/g++ at the linking step, use something like this in your makefile: 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
# save all your .o files in variable OBJ
<br/>
g++ -L/yourlibpath $(OBJ) -lyourlibname -o binary
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
But. of course, you'll probably want to make a LIBPATHS variable, with all the areas you have libraries (-L), and a LIBS variable with all the library names (-l).  
<br/>
<br/>
Eh... but the template devkitArm file does all this for you.  Still, it's a great skill to learn makefiles and autotools etc... it really helps when porting your code around (which you may eventually want to do... maybe).
<br/>
<br/>
From one of my other posts:
<br/>
<a href="http://forum.gbadev.org/viewtopic.php?t=16387" target="_blank">http://forum.gbadev.org/viewtopic.php?t=16387</a>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Exhaustive docs:
<br/>
(Start here in the Introduction links, to understand terms etc)
<br/>
<a href="http://sunsite.ualberta.ca/Documentation/Gnu/make-3.79/html_chapter/make_toc.html" target="_blank">http://sunsite.ualberta.ca/Documentation/Gnu/make-3.79/html_chapter/make_toc.html</a>
<br/>
<br/>
Learn by Examples:
<br/>
<a href="http://mrbook.org/blog/tutorials/make/" target="_blank">http://mrbook.org/blog/tutorials/make/</a>
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168084 - brave_orakio - Thu Apr 09, 2009 1:10 pm</h4>
    <div class="postbody"><span class="postbody">Sorry for the late reply, I`m gonna feel like a fool but where do I find the makefile template of devkitarm? Let me check out your other posts too.<br/>_________________<br/>help me</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168087 - elyk1212 - Thu Apr 09, 2009 4:15 pm</h4>
    <div class="postbody"><span class="postbody">No worries.  It took me awhile to find out also.  It is just in the examples:
<br/>
<br/>
<a href="http://sourceforge.net/project/showfiles.php?group_id=114505&amp;package_id=273883&amp;release_id=663276" target="_blank">http://sourceforge.net/project/showfiles.php?group_id=114505&amp;package_id=273883&amp;release_id=663276</a>
<br/>
<br/>
Once you untar these guys just check under the ./template folder, and there is a Makefile there to follow/use.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168113 - brave_orakio - Fri Apr 10, 2009 11:47 am</h4>
    <div class="postbody"><span class="postbody">Ah, thanks! let me check this out for a while before I post any updates again<br/>_________________<br/>help me</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168175 - brave_orakio - Mon Apr 13, 2009 7:23 am</h4>
    <div class="postbody"><span class="postbody">Hmm, I'm not sure if I'm doing things the right way here but I have plenty of defines that are the same as libgba defines in my header files(I never intended to use libgba because I wanted to really learn from the bottom up). Would this pose a problem? 
<br/>
<br/>
Anyway, I'm having a difficult time figuring out the devkitpro generic makefile so I'm gonna go the coward's way and post my makefile
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#make file for game_demo
<br/>
<br/>
#----details------
<br/>
export PATH   :=   $(DEVKITARM)/bin:$(PATH)
<br/>
PROJ    :=    game_demo
<br/>
EXT      :=   gba
<br/>
UDIR   :=   /d/devkitpro/examples/gba/MyDemo/GameDemo
<br/>
<br/>
CFILESARM   :=   $(UDIR)/updateScrManager.c
<br/>
CFILES   :=   $(UDIR)/hero.c $(UDIR)/hero_sprite.c $(UDIR)/gameDemoMain.c $(UDIR)/vramManager.c \
<br/>
         $(UDIR)/OAMManager.c $(UDIR)/genericBG.c $(UDIR)/bgManager.c $(UDIR)/collisionManager.c
<br/>
ARMOBJ   := $(CFILESARM:.c=.o)
<br/>
COBJS   :=   $(CFILES:.c=.o)
<br/>
ALLOBJ   :=   $(ARMOBJ) $(COBJS)
<br/>
<br/>
#----tool settings--------
<br/>
<br/>
CROSS   :=   arm-eabi-
<br/>
AS      :=   $(CROSS)as
<br/>
CC      :=   $(CROSS)gcc
<br/>
LD      :=   $(CROSS)gcc
<br/>
OBJCOPY   :=   $(CROSS)objcopy
<br/>
<br/>
MODEL   :=   -mthumb-interwork -mthumb
<br/>
MODELARM   :=   -mthumb-interwork -marm
<br/>
SPECS   :=   -specs=gba.specs
<br/>
<br/>
CFLAGS   :=   -I./ -I$(UDIR) $(MODEL) -O3 -Wall -fno-strict-aliasing
<br/>
CFLAGSARMFLAG :=   -I./ -I$(UDIR) $(MODELARM) -O3 -Wall -fno-strict-aliasing
<br/>
LDFLAGSARM := $(SPECS) $(MODELARM) -mlong-calls
<br/>
LDFLAGS   :=   $(SPECS) $(MODEL) 
<br/>
<br/>
#-----Build Steps ---
<br/>
<br/>
build   :   $(PROJ).$(EXT)
<br/>
<br/>
$(PROJ).$(EXT)   :   $(PROJ).elf
<br/>
   @$(OBJCOPY) -v -O binary $&lt; $@
<br/>
   -@gbafix $@
<br/>
   
<br/>
$(PROJ).elf   :   $(ALLOBJ)
<br/>
   @$(LD) $^ $(LDFLAGS) -o $@
<br/>
<br/>
$(ARMOBJ)   :   %.o:%.c
<br/>
   $(CC) -c $&lt; $(CFLAGSARMFLAG) -save-temps -o $@
<br/>
   
<br/>
$(COBJS)   :   %.o:%.c
<br/>
   $(CC) -c $&lt; $(CFLAGS) -save-temps -o $@
<br/>
<br/>
#----Clean----
<br/>
<br/>
.PHONY : clean
<br/>
clean : 
<br/>
   @rm -fv $(COBJS) $(SOBJS)
<br/>
   @rm -fv $(PROJ).$(EXT) 
<br/>
   @rm -fv $(PROJ).elf
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Anyway, as I said above about the defines that might pose a problem, I'm going to add this question now in the event that I will have to make my own printing function(It was part of the overall design but I thought to make it later on). How do I convert an integer value to a string? Or do I just use the standard sprintf()?<br/>_________________<br/>help me</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168186 - elyk1212 - Tue Apr 14, 2009 7:32 am</h4>
    <div class="postbody"><span class="postbody">int to string:
<br/>
<br/>
If you want to learn how to do this, try to think about ascii.  All number characters are in a sequential, correct?  This is the convenience.  So, you can do something like this to create ascii character from an int:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
int num = 4;
<br/>
char c = num + '0';
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Notice that I am adding the character zero '0' to the integer, which would be fine for any one digit integer 0-9. This works since C/C++ considers int and char to be of the same primitive type... basically, and due to each ascii character being in order.
<br/>
<br/>
So what happens when I add 1 to '0'?  1+ '0' == '1'   ... 1+ '2' == '3'... so on :)  
<br/>
<br/>
Now here is a little more advanced version (handles larger numbers and hex output),but maybe not the best implementation, it's from years ago, so excuse the comments and such):
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
//**************************************************************************
<br/>
/**
<br/>
*  Convert a number to a hex equiv string (null terminates)
<br/>
*     @param buff buffer to place hex string in.
<br/>
*     @param length max length to place in buffer (not counting null)
<br/>
*     @param num mumber to convert.
<br/>
*/
<br/>
void hexToAscii_rec(char* buff, int length, int num)
<br/>
{
<br/>
   //int temp = num &gt;&gt; 4;
<br/>
   //temp &amp;=  0x0000000F;
<br/>
   int temp = num % 16;
<br/>
   //printf("num%16 = %d\n", temp);
<br/>
<br/>
   // Stopping condition
<br/>
   //   (when there are no more numbers to divide out,
<br/>
   //      fill all more sig digits with 0s
<br/>
   if(num == 0)
<br/>
   {
<br/>
      while(length &gt;=0)
<br/>
      {
<br/>
         *(buff+length) = '0';
<br/>
         length--;
<br/>
      }
<br/>
      return;
<br/>
   }
<br/>
   // Hex Number case
<br/>
   else if(temp &gt;= 0 &amp;&amp; temp &lt;= 9)
<br/>
   {
<br/>
      *(buff + length) = temp + '0';
<br/>
      //printf("Char found was: %c", *(buff+length));
<br/>
      hexToAscii_rec(buff, length-1, num/16);
<br/>
   }
<br/>
   // Hex Letter case (A-F)
<br/>
   else if(temp &gt;= 10 &amp;&amp; temp &lt;= 15)
<br/>
   {
<br/>
     // Minus 10 since this is decimal number base
<br/>
      *(buff + length)  = temp -10 + 'A';
<br/>
      //printf("Char found was: %c", *(buff+length));
<br/>
      hexToAscii_rec(buff, length-1, num/16);
<br/>
   }
<br/>
}
<br/>
<br/>
<br/>
//**************************************************************************
<br/>
/**
<br/>
*  Convert a number to a decimal equiv string (null terminates)
<br/>
*     @param buff buffer to place decimal string in.
<br/>
*     @param max_length max length to place in buffer (not counting null)
<br/>
*     @param num mumber to convert.
<br/>
*/
<br/>
int decimalToAscii(char* buff, int max_length, int num)
<br/>
{
<br/>
   int length = digitLength(10,num);
<br/>
   // If the buffer will not be big enough to hold result, Flag error
<br/>
   if(length+1 &gt; max_length)
<br/>
   {
<br/>
      //printf("Error! String to convert to Ascii ");
<br/>
      //printf("is larger than will fit in your buffer size!\r\n");
<br/>
      return HEX_ERROR;
<br/>
   }
<br/>
   // Null terminate string,
<br/>
   *(buff + length) = '\0';
<br/>
   decimalToAscii_rec(buff, length-1, num);
<br/>
   return SUCCESS;
<br/>
}
<br/>
<br/>
<br/>
<br/>
//**************************************************************************
<br/>
/**
<br/>
*  Convert a number to a decimal equiv string (null terminates)
<br/>
*     @param buff buffer to place decimal string in.
<br/>
*     @param length max length to place in buffer (not counting null)
<br/>
*     @param num mumber to convert.
<br/>
*/
<br/>
void decimalToAscii_rec(char* buff, int length, int num)
<br/>
{
<br/>
   //int temp = num &gt;&gt; 4;
<br/>
   //temp &amp;=  0x0000000F;
<br/>
   int temp = num % 10;
<br/>
   //printf("num%16 = %d\n", temp);
<br/>
   // Stopping condition
<br/>
   //   (when there are no more numbers to divide out,
<br/>
   //      fill all more sig digits with 0s
<br/>
   if(num == 0)
<br/>
   {
<br/>
      while(length &gt;=0)
<br/>
      {
<br/>
         *(buff+length) = '0';
<br/>
         length--;
<br/>
      }
<br/>
      return;
<br/>
   }
<br/>
   // Hex Number case
<br/>
   else if(temp &gt;= 0 &amp;&amp; temp &lt;= 9)
<br/>
   {
<br/>
      *(buff + length) = temp + '0';
<br/>
      //printf("Char found was: %c", *(buff+length));
<br/>
      decimalToAscii_rec(buff, length-1, num/10);
<br/>
   }
<br/>
}
<br/>
<br/>
<br/>
//**************************************************************************
<br/>
/**
<br/>
*    Find out how many digits there are to convert to ascii buffer, given
<br/>
* the number base.
<br/>
*      @param number_base base of number (10,2,16,etc).
<br/>
*      @param num number to find the length of.
<br/>
*/
<br/>
int digitLength(int number_base,int num)
<br/>
{
<br/>
   return digitLength_rec(number_base,num,0);
<br/>
}
<br/>
<br/>
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Anyway, this is done in the C style, you'll probably want to take advantage of the string class if you are using C++, it is a great idea to avoid random pointer arithmetic where you can!  But this is just for you to get the concept of the conversion.
<br/>
<br/>
There are also conversion routines built in, like for instance into ostream and the &lt;&lt; operator (in C++ only).
<br/>
<br/>
For example on my Matrix class I have:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
//**********************************************************************
<br/>
template &lt;typename T&gt;
<br/>
std::stringstream&amp; operator&lt;&lt; (std::stringstream&amp; o, const Matrix&lt;T&gt;&amp; m)
<br/>
{
<br/>
<br/>
    return o &lt;&lt; 
<br/>
        "\n{" &lt;&lt;
<br/>
        m.data[0] &lt;&lt;","&lt;&lt; m.data[4] &lt;&lt;","&lt;&lt; m.data[8] &lt;&lt;","&lt;&lt; m.data[12]
<br/>
        &lt;&lt; "\n" &lt;&lt;
<br/>
        m.data[1] &lt;&lt;","&lt;&lt; m.data[5] &lt;&lt;","&lt;&lt; m.data[9] &lt;&lt;","&lt;&lt; m.data[13]
<br/>
        &lt;&lt; "\n" &lt;&lt;
<br/>
        m.data[2] &lt;&lt;","&lt;&lt; m.data[6] &lt;&lt;","&lt;&lt; m.data[10] &lt;&lt;","&lt;&lt; m.data[14]
<br/>
        &lt;&lt; "\n" &lt;&lt;
<br/>
        m.data[3] &lt;&lt;","&lt;&lt; m.data[7] &lt;&lt;","&lt;&lt; m.data[11] &lt;&lt;","&lt;&lt; m.data[15]
<br/>
        &lt;&lt; "}" &lt;&lt; endl;
<br/>
}
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Which you can convert a stringstream to a string fairly easily stream.str()
<br/>
<a href="http://www.cplusplus.com/reference/iostream/stringstream/" target="_blank">http://www.cplusplus.com/reference/iostream/stringstream/</a>
<br/>
<br/>
I'll look at your makefile a little later.  I've got to go to bed now :P
<br/>
<br/>
I forget your error message etc, off hand.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168200 - sajiimori - Tue Apr 14, 2009 5:58 pm</h4>
    <div class="postbody"><span class="postbody">Or yeah, just use sprintf.  ;)
<br/>
<br/>
(Better yet, use s<span style="font-weight: bold">n</span>printf to reduce the risk of overflow.)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168203 - sgeos - Wed Apr 15, 2009 12:46 am</h4>
    <div class="postbody"><span class="postbody">I agree.  Why do you not want to use sprintf or snprintf?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168204 - brave_orakio - Wed Apr 15, 2009 1:55 am</h4>
    <div class="postbody"><span class="postbody">Actually, yes I guess could use that. Just curious is all about the actual process if there was anything different going on underneath. I guess I just think that sometimes it's good to know these thing in case you can use it elsewhere.
<br/>
<br/>
And thanks for the conversion code elyk! but is it possible to link libgba if my standard headers have almost all of the same defines and typedef as libgba? As for the errors, I can't say because I don't even know where to start!<br/>_________________<br/>help me</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168205 - elyk1212 - Wed Apr 15, 2009 2:14 am</h4>
    <div class="postbody"><span class="postbody">Yes, I agree that knowing "what goes on" behind the scenes if probably more valuable that just using the easy solution.  At least when you are learning.  Once you understand it, use the easy solution.  
<br/>
<br/>
This is why engineering and comp sci classes make you do this stuff manually, at least at first.
<br/>
<br/>
<br/>
Oh, and yes, it's possible to link the library.  You'll just get errors in the namespace (redefinition) if you have defines that are declared again (or warnings).  But this is not from the actual linking, this is from the header including (which brings them into the global namespace for that file).  (Linking errors could occur if there is ambiguity with function names, more than one defined (same signature), and being forward declared... so being ambiguous as to which definition to attribute the declaration to at linking time... at least I think).
<br/>
<br/>
To get rid of them, just comment each line that gives an error (or warning).  It all depends on what flags you're throwing to gcc, if the preprocessor (for #define) throws an error (at least from what I remember).  
<br/>
<br/>
If you are redefining classes or types in headers more than once,  you'll prob have to avoid that as that should be an error (again if you're only #define -ing a label it will usually just be a warning, unless you specify otherwise using flags etc).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168208 - elyk1212 - Wed Apr 15, 2009 4:30 am</h4>
    <div class="postbody"><span class="postbody">Oh, and btw, learning how to use streams with the &lt;&lt; operator is probably a pretty good practice if you use C++.  
<br/>
<br/>
You can keep it in your classes for portability and debug, it is sort of like having a toString method in Java.  
<br/>
<br/>
Allows things like:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
// outputs nice formated object to the console... on platforms that have one ;P
<br/>
cout &lt;&lt; yourclass_obj &lt;&lt; endl;
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
If anyone can find a printf variant that outputs a class's data (in an easy way), I'd like to know :P  (but I've been wrong before, ....regardless, &lt;&lt; seems to be the usual expected way when you're defining your own classes).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168215 - sgeos - Wed Apr 15, 2009 5:02 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>elyk1212 wrote:</b></span></td> </tr> <tr> <td class="quote">To get rid of them, just comment each line that gives an error (or warning).</td> </tr></table><span class="postbody">
<br/>
You may want to consider some combination of #ifdef #ifndef #undef #define and #endif.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#ifndef TRUE
<br/>
#define TRUE (!0)
<br/>
#endif  // TRUE
<br/>
<br/>
// this could break something if you are not careful
<br/>
#ifdef SOMETHING_I_NEED_TO_CONTROL
<br/>
#undef SOMETHING_I_NEED_TO_CONTROL
<br/>
#define SOMETHING_I_NEED_TO_CONTROL (MY_IMPORTANT_VALUE)
<br/>
#endif  // SOMETHING_I_NEED_TO_CONTROL</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168314 - brave_orakio - Tue Apr 21, 2009 4:00 am</h4>
    <div class="postbody"><span class="postbody">Finally I have a text system up and running! 
<br/>
<br/>
Now here's the thing, at its slowest my game loop runs at around 13k cycles which is half of the amount of cycles per frame if my math is correct. 
<br/>
<br/>
So theoretically it should not slow down even if there is only 1 character (around 2K cycles)or 6 characters(13K cycles).
<br/>
I must be doing something horribly wrong if the speed changes like that!<br/>_________________<br/>help me</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168316 - sajiimori - Tue Apr 21, 2009 8:32 am</h4>
    <div class="postbody"><span class="postbody">Add some more debug text, like a clock to display how many seconds have passed, what your calculated framerate is, etc.  Maybe something will stand out as being weird.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168317 - Cearn - Tue Apr 21, 2009 9:59 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>brave_orakio wrote:</b></span></td> </tr> <tr> <td class="quote">Now here's the thing, at its slowest my game loop runs at around 13k cycles which is half of the amount of cycles per frame if my math is correct. 
<br/>
</td> </tr></table><span class="postbody">A full refresh is roughly 281k cycles. You're using about 5%, not 50%.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168318 - brave_orakio - Tue Apr 21, 2009 10:25 am</h4>
    <div class="postbody"><span class="postbody">Heh, my math is wrong! Right I'll do that and see what else I find out<br/>_________________<br/>help me</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168326 - brave_orakio - Wed Apr 22, 2009 10:13 am</h4>
    <div class="postbody"><span class="postbody">My initial findings would indicate that my game is not synced to vblank.
<br/>
Here's what I did. First my game loop:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
while(1)
<br/>
{
<br/>
     //move all characters
<br/>
     //check collision
<br/>
     //sort
<br/>
     //wait for vblank
<br/>
     check++;
<br/>
     //print value of check
<br/>
     //print number of frames passed
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
and then my updater thas is in a vblank interrupt
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
//copy OAM buffer to OAM
<br/>
//update BG
<br/>
frame++
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
So if everything is working right, check and frame should increment at the same time right? Unfortunately, check is way bigger than frame.
<br/>
Whats strange is adding a loop at my screen updater to burn vblank time doesn't help at all. 
<br/>
<br/>
Just in case I messed up with my vblank syncing code, the code should look like this right?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
while(*REG_VCOUNT&lt;160){}
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/>help me</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168329 - sgeos - Wed Apr 22, 2009 2:58 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>brave_orakio wrote:</b></span></td> </tr> <tr> <td class="quote">Just in case I messed up with my vblank syncing code, the code should look like this right?
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
while(*REG_VCOUNT&lt;160){}
<br/>
</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
Using interrupts is a better way of doing things.
<br/>
How is REG_VCOUNT defined?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168331 - kusma - Wed Apr 22, 2009 3:03 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>brave_orakio wrote:</b></span></td> </tr> <tr> <td class="quote">Just in case I messed up with my vblank syncing code, the code should look like this right?
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
while(*REG_VCOUNT&lt;160){}
<br/>
</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
No. If you manage to finish your loop while still in VBLANK, this will finish right away. Instead, you should do:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">while(REG_VCOUNT&gt;160);
<br/>
while(REG_VCOUNT&lt;160);</td> </tr></table><span class="postbody">
<br/>
or even better
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">VBlankIntrWait();</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168338 - brave_orakio - Thu Apr 23, 2009 2:37 am</h4>
    <div class="postbody"><span class="postbody">REG_VCOUNT is defined as
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define REG_VCOUNT         ((vu16*)0x4000006)
<br/>
</td> </tr></table><span class="postbody">
<br/>
in my header
<br/>
<br/>
Yes I do use interrupts for updates but as mentioned in the post above, If my code runs too fast and don't burn V_DRAW and V_BLANK, the loop would update multiple times.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
while(REG_VCOUNT&gt;160);
<br/>
while(REG_VCOUNT&lt;160);</td> </tr></table><span class="postbody">
<br/>
<br/>
This one seems to have done the trick! But I didn't realize that moving anything less than 1 pixel per frame seems very slow!<br/>_________________<br/>help me</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168341 - Ruben - Thu Apr 23, 2009 7:00 am</h4>
    <div class="postbody"><span class="postbody">I fail to see why your code would run too fast if you were to use the software interrupt. All VBlankIntrWait() does is put the CPU on hold until an interrupt occurs, and puts it back to sleep or until it hits V-Blank, in which case you are returned to your code, essentially the same as doing a while(*REG_VCOUNT&gt;160); while(*REG_VCOUNT&lt;160);</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168342 - sgeos - Thu Apr 23, 2009 8:08 am</h4>
    <div class="postbody"><span class="postbody">VBlankIntrWait() uses less power than polling VCOUNT.  Are there any other reasons to use it?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168343 - Ruben - Thu Apr 23, 2009 8:29 am</h4>
    <div class="postbody"><span class="postbody">Because it's more accurate than polling REG_VCOUNT, though that can be remedied using REG_DISPSTAT's first bit ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168344 - brave_orakio - Thu Apr 23, 2009 9:00 am</h4>
    <div class="postbody"><span class="postbody">I didn't know about VBlankIntrWait() till now. Although wouldn't this mean that code only runs during vblank?<br/>_________________<br/>help me</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168345 - Ruben - Thu Apr 23, 2009 9:17 am</h4>
    <div class="postbody"><span class="postbody">Not really.
<br/>
From the looks of it, your loop updates stuff, waits for V-Blank (to update registers?I can't remember haha), does more stuff and starts again.
<br/>
Assuming that this stuffs takes longer than 228-160 scanlines, you *will* enter V-Draw, regardless of using VBlankIntrWait or while(((*REG_DISPSTAT)&amp;1) == 0);</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168346 - brave_orakio - Thu Apr 23, 2009 10:10 am</h4>
    <div class="postbody"><span class="postbody">Oh and I guess I have one more question. How many pixels per frame does your sprite move? Around how many is the limit so it doesn't look choppy?<br/>_________________<br/>help me</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168347 - sgeos - Thu Apr 23, 2009 10:15 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>brave_orakio wrote:</b></span></td> </tr> <tr> <td class="quote">I didn't know about VBlankIntrWait() till now. Although wouldn't this mean that code only runs during vblank?</td> </tr></table><span class="postbody">
<br/>
It starts during vblank.  If you take too long you enter vdraw.  Entering vdraw is ok, but make sure to do all your timing critical things first (sound and then video, as a quick rule of thumb).  If you are doing so much that you take more than a whole frame (vblank + vdraw), your framerate will drop, but your program updates will start during vblanks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168348 - Ruben - Thu Apr 23, 2009 11:43 am</h4>
    <div class="postbody"><span class="postbody">I'd like to add to sgeos' suggestions
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Entering vdraw is ok, but make sure to do all your timing critical things first (sound and then video, as a quick rule of thumb)</td> </tr></table><span class="postbody">
<br/>
<br/>
I'd like to say that if you're on the GBA (which it looks like from REG_VCOUNT&lt;160), sound can take its time... lots of it. So what you may want to do is call sound <span style="font-style: italic">interrupts</span> first. That is..
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void VBlankISR(void) {
<br/>
    SoundIntr(); //Reset DMA if needed (assuming you use MaxMod,
<br/>
                 //M4A or any of the other ones that use the "good"
<br/>
                 //frequencies, otherwise this goes into Timer 1 (eg. Krawall)
<br/>
<br/>
    UpdateScreenRegisters(); //You must, must, must, must, MUST
<br/>
                             //have this run first where possible to make sure that
<br/>
                             //you don't get muddled graphics
<br/>
<br/>
    //Now do your other stuffs
<br/>
<br/>
    SoundMain(); //Do the main sound work, as this takes the most time
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
<span style="font-weight: bold">However</span>, if you know that, in total calling of all the V-Blank call will take more than a full frame, trim down the stuff you put there, or try limiting the sound channel count to have more raster time to do other stuffs. It will save you a lot of headaches (I know it did for me &gt;&gt;').</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168349 - sgeos - Thu Apr 23, 2009 1:52 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ruben wrote:</b></span></td> </tr> <tr> <td class="quote">I'd like to say that if you're on the GBA (which it looks like from REG_VCOUNT&lt;160), sound can take its time... lots of it. So what you may want to do is call sound <span style="font-style: italic">interrupts</span> first.</td> </tr></table><span class="postbody">
<br/>
Certainly.  The thing about sound is that you want to make sure it is refreshed with consistent timing.  There are many ways to do this, but the simplest way (not necessarily the best) is to refresh sound first thing in the vblank, then handle graphics, and then do anything else related to sound, graphics or the internal game state that is not directly sending output to the hardware.
<br/>
<br/>
You could set your sound up so that it is refreshed when vdraw starts or at some arbitrary scanline if you don't need the interrupts for anything else.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">if you know that, in total calling of all the V-Blank call will take more than a full frame, trim down the stuff you put there</td> </tr></table><span class="postbody">
<br/>
I agree, but sometimes things just end up taking more than a full frame if you are doing something repetitive on a large number of objects.  There are workarounds.
<br/>
<br/>
<span style="font-weight: bold">EDIT:</span>  In case it is not obvious by now, pretty much everything involves synchronizing your game with the hardware.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168350 - gauauu - Thu Apr 23, 2009 3:30 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>brave_orakio wrote:</b></span></td> </tr> <tr> <td class="quote">Oh and I guess I have one more question. How many pixels per frame does your sprite move? Around how many is the limit so it doesn't look choppy?</td> </tr></table><span class="postbody">
<br/>
<br/>
And for the easier question: 
<br/>
However many pixels per frame you need to move the speed that you want the object to move.  It'll probably never look very choppy -- if it's moving slowly, you won't notice.  And if it's moving much faster than a few pixels per frame, it'll be moving so quickly that your eyes won't be able to notice the choppiness.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168390 - brave_orakio - Mon Apr 27, 2009 2:08 am</h4>
    <div class="postbody"><span class="postbody">Thanks for all the replies guys! From what I'm reading though, it seems that sound would be the main reason why a lot of games run at 30 frames instead of 60. 
<br/>
<br/>
I'll probably do a new topic on that when  the time comes for me to add sound to my game. Again thank you all!<br/>_________________<br/>help me</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168400 - sgeos - Mon Apr 27, 2009 4:05 pm</h4>
    <div class="postbody"><span class="postbody">30 FPS gives you twice as much time to get stuff done.  If you need that time, you need that time.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168402 - Miked0801 - Mon Apr 27, 2009 6:16 pm</h4>
    <div class="postbody"><span class="postbody">If it makes you feel better, every single commercial game I've worked on has run at 30hz.  GBC/DMG, GBA, and DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168418 - sgeos - Tue Apr 28, 2009 6:05 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Miked0801 wrote:</b></span></td> </tr> <tr> <td class="quote">If it makes you feel better, every single commercial game I've worked on has run at 30hz.  GBC/DMG, GBA, and DS.</td> </tr></table><span class="postbody">
<br/>
Did you force throttle 30 FPS, or did processing always take long enough to run at 30 FPS?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168424 - Miked0801 - Tue Apr 28, 2009 11:02 pm</h4>
    <div class="postbody"><span class="postbody">Both. It's just safer and looks better for the game if it always runs at a constant speed.  A few could have ran at 60, but there would have been some hiccups here and there to 30 that would have looked lame.  Better to keep it at 30 so no one notices.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168427 - Dwedit - Wed Apr 29, 2009 12:09 am</h4>
    <div class="postbody"><span class="postbody">I've heard a few games run the game logic at 30FPS, and tween it up to 60FPS.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168434 - sgeos - Wed Apr 29, 2009 7:45 am</h4>
    <div class="postbody"><span class="postbody">What is the "best" throttling method?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168452 - Dwedit - Wed Apr 29, 2009 1:44 pm</h4>
    <div class="postbody"><span class="postbody">To throttle to 30FPS:
<br/>
Your vblank handler includes code to tell how many times it has happened.
<br/>
If you run your game code, and it says vblank happed 0 times, wait for vblank twice and clear the counter.  If it says vblank happened 1 times, wait once and clear the counter.  If it says vblank happened 2 times, your code is too slow, you don't need to wait for vblank.  Clear the counter.
<br/>
<br/>
To throttle to 60FPS, just wait for Vblank if vblank has not happened.
<br/>
<br/>
To throttle to an arbitrary frame rate, you can use timer interrupts set to any frequency you want.  But you need to make sure the list of graphics to display is swapped atomically each frame, you don't want half of the sprites from one frame, and half from another.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168458 - sverx - Wed Apr 29, 2009 4:16 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dwedit wrote:</b></span></td> </tr> <tr> <td class="quote">To throttle to an arbitrary frame rate, you can use timer interrupts...</td> </tr></table><span class="postbody">
<br/>
<br/>
<span style="font-weight: bold">Arbitrary</span>? You mean like 30, 20, 15, 12, 10 fps... or you mean ANY like 50 or 25?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168465 - Dwedit - Wed Apr 29, 2009 5:46 pm</h4>
    <div class="postbody"><span class="postbody">I mean ANY, including 10FPS, 50FPS, 100FPS, 256FPS, anything provided that your game logic can execute on time.  For example, a game designed for an arbitrary FPS can change speed as needed, slow down for 'bullet time', or gradually speed up like Wario Ware.
<br/>
<br/>
But if you design it for ANY fps, you need drawing logic that will handle that.  Using on-demand VRAM loading depending on what graphics are visible in the frame is a good way to achieve this.  But it needs to be designed to be interrupted at any time, so it won't display half-finished or inconsistent graphics.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#168469 - Miked0801 - Wed Apr 29, 2009 6:39 pm</h4>
    <div class="postbody"><span class="postbody">Running a game at anything outside of the standard 60/30/20... timing is just asking for graphical shearing and the likes.  VBlank is there for a reason after all :)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
