<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>GBA Communication with PC help please. - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Coding > GBA Communication with PC help please.</h2>
<div id="posts">
<div class="post">
    <h4>#32429 - ghostils - Wed Dec 22, 2004 8:22 pm</h4>
    <div class="postbody"><span class="postbody">Ok I found a nice thread on the xboo protocol after I had spent about 2 hours messing around and figuring out that I needed to recieve bits on the ACK line of the LPT port. Which is now working, however there is such a sync problem lol.  I figured that would happen, but what I wanna know is how is the GBA Uart sending data?
<br/>
<br/>
lemme post the GBA Serial Start up code I have:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
unsigned char byte = 'A';
<br/>
REG_SIODATA8 = byte; 
<br/>
   REG_RCNT = 0;
<br/>
   REG_SIOCNT = 0;
<br/>
   REG_SIOCNT = SIO_BAUD_9600 | SIO_LENGTH_8 | SIO_USE_UART | SIO_CTS;
<br/>
   REG_SIOCNT |= SIO_SEND_ENABLE | SIO_RECV_ENABLE; 
<br/>
<br/>
//-Just keep sending A's 
<br/>
while(1)
<br/>
       {REG_SIODATA8 = byte;}
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
I had found this on another thread post about the serial port. Now I can see the baud rate, and it looks like its sending in 8bit mode, however I didn't see Parity or Stop bits (which is going to be important if its using RS232, which I think it does.... but who knows) (this is what I"m trying to find out from you guys how this thing sends data, and the best way to interface to the pc)
<br/>
<br/>
<br/>
Anyway, here is my code for the pc side of things, its pretty simplistic too:
<br/>
I read the status register (where the ACK bit) is located which is what the GBA Xboo Serial Send pin is connected to: a bit at a time is recieved, ACK goes high I print a 1, ACK goes low I print a 0, I format it for 8 bits per line. With a 30ms delay.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include &lt;sys/io.h&gt;
<br/>
#include &lt;unistd.h&gt;
<br/>
#include &lt;stdio.h&gt;
<br/>
<br/>
#define BASE_ADDR 0x378
<br/>
#define REGDATA BASE_ADDR + 0
<br/>
#define REGSTATUS BASE_ADDR + 1
<br/>
#define REGCONTROL BASE_ADDR + 2
<br/>
<br/>
int main(void)
<br/>
{
<br/>
        int status = 0;
<br/>
        int bit = 0;
<br/>
        unsigned char byte = 128;
<br/>
<br/>
        //-Turn on direct LPT port access from data to control registers:
<br/>
        status = ioperm(BASE_ADDR, 3 ,1);
<br/>
        if(status) { printf("Error: ioperm::enable\r\n"); return -1; }
<br/>
<br/>
        while(1)
<br/>
        {
<br/>
      //-Read from Status Register:
<br/>
                byte = inb(REGSTATUS);
<br/>
      
<br/>
      //-ACK = Bit 6: HIGH = 1 LOW = 0
<br/>
      //-Format output in bytes:
<br/>
                if(byte == 120) {printf("1");}
<br/>
                else if(byte == 56) {printf("0");}
<br/>
                if(bit++ &gt;= 7) {printf("\r\n"); bit=0;}
<br/>
<br/>
      //-Sleep 30ms:
<br/>
                usleep(30000);          
<br/>
        }
<br/>
<br/>
        //-Turn off LPT port access fr
<br/>
        status = ioperm(BASE_ADDR, 3 ,0);
<br/>
        if(status) { printf("Error: ioperm::disable\r\n"); return -1; }
<br/>
<br/>
        return 0;
<br/>
}
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
<br/>
So I guess the question is how do I reliably get these two to talk and transfer data that is meaningful?
<br/>
<br/>
Or is there a better way? And mebbe some code examples please =)
<br/>
<br/>
<br/>
Thanks, 
<br/>
-ghost[iLs]</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
