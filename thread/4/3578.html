<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Interrupts.... - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Coding > Interrupts....</h2>
<div id="posts">
<div class="post">
    <h4>#22364 - kanelo - Sat Jun 19, 2004 1:23 pm</h4>
    <div class="postbody"><span class="postbody">Hi people from gbadev.
<br/>
<br/>
I'm using HAM, but without ham libraries. I set up interrupts like this:
<br/>
<br/>
        INT_DISABLE;
<br/>
        // load the address of the interrupt handler
<br/>
        INT_DIR = (u32) IRQHandler;
<br/>
        // set wich interrupts could trigger interrupt handler
<br/>
        SET_INT(INT_VBLANK);
<br/>
        // enable vblank interrupt in REG_DISPSTAT
<br/>
        REG_DISPSTAT |= 0x8;
<br/>
        // enable interrupts
<br/>
        INT_ENABLE;
<br/>
<br/>
The Upper case are macros, or defines. So I set a funtion where to jump when an interrupt occurs, IRQHandler. Inside this function I check which one happened and do something.
<br/>
<br/>
void IRQHandler(void)
<br/>
{
<br/>
    INT_DISABLE;
<br/>
    if( REG_IF == INT_VBLANK )
<br/>
   {
<br/>
           g_NewFrame = TRUE;
<br/>
    }
<br/>
    INT_ENABLE;
<br/>
}
<br/>
<br/>
<br/>
It wroks nice, but I wanted to know which is the best way to do this. I know this is not the best way. I also wanted some advice about interrupts, based on experience ^_^
<br/>
<br/>
Thank you for your time.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22367 - kanelo - Sat Jun 19, 2004 2:57 pm</h4>
    <div class="postbody"><span class="postbody">What do I have to do to support multiple interrupts ?? 
<br/>
<br/>
Thanks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22374 - dagamer34 - Sat Jun 19, 2004 5:25 pm</h4>
    <div class="postbody"><span class="postbody">First, you are going to have to change your crt0.s to support multiple interrupts. Open up that file(%HAMDIR%/system) and comment lines 115 and 116 (Fast and Single interrupts) and uncomment line 117 (Multiple interrupts).
<br/>
<br/>
Now, stick this table somewhere in your code:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
/* Macros that return virtual "types" */
<br/>
typedef void (*fp)(void);  
<br/>
<br/>
/* Table of function pointers */
<br/>
fp* IntrTable[]  =
<br/>
{
<br/>
   (fp*)VBLANK,
<br/>
   (fp*)HBLANK,
<br/>
   (fp*)VCOUNT,
<br/>
   (fp*)TIMER0,
<br/>
   (fp*)TIMER1,
<br/>
   (fp*)TIMER2,
<br/>
   (fp*)TIMER3,
<br/>
   (fp*)SERIAL,
<br/>
   (fp*)DMA0,
<br/>
   (fp*)DMA1,
<br/>
   (fp*)DMA2,
<br/>
   (fp*)DMA3,
<br/>
   (fp*)KEYBOARD,
<br/>
   (fp*)CART
<br/>
};
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
This is your interrupt "table". Every time an interrupt is triggered, it will look at this table for the function to call. This nicely allows you to change a function for an interrupt.
<br/>
<br/>
Here's an example, say, if I want to change the VBLANK interrupt to call function vbl():
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
IntrTable [0] = (fp*)vbl;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I suggest creating functions that easily set interrupt functions on the fly. Post again if you need more help.<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
