<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>undefined reference to `memcpy' - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > undefined reference to `memcpy'</h2>
<div id="posts">
<div class="post">
    <h4>#21188 - cosmic4z - Tue May 25, 2004 4:51 pm</h4>
    <div class="postbody"><span class="postbody">HELP !!! (please)
<br/>
<br/>
I am using devkit advance (GCC) .. and wish to have a string created in GBA ram .. my function looks like this :-
<br/>
<br/>
void SE_InitSI(sSI* pSI,sInitSI* pInitSI)
<br/>
{
<br/>
	char	cName[8] = {"hello"};
<br/>
<br/>
	some code here ...
<br/>
}
<br/>
<br/>
when I complie / link ... i get :-
<br/>
<br/>
SE.o: In function `SE_InitSI':
<br/>
/cygdrive/e/dev/gba/cayho/SE.c:28: undefined reference to `memcpy'
<br/>
/cygdrive/e/dev/gba/cayho/SE.c:28: undefined reference to `memset'
<br/>
make: *** [main.elf] Error 1
<br/>
<br/>
are memcpy / memset in some library somewhere !?
<br/>
<br/>
what am I missing !?
<br/>
<br/>
Jamie<br/>_________________<br/>Qwak - <a href="http://www.qwak.co.uk" target="_blank">www.qwak.co.uk</a> | Forum - <a href="http://www.qwak.co.uk/forum/" target="_blank">www.qwak.co.uk/forum/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#21189 - poslundc - Tue May 25, 2004 5:02 pm</h4>
    <div class="postbody"><span class="postbody">I have the same problem in my version of GCC/DKA when trying to do anything that requires memcpy. You can circumvent the problem by doing it yourself: declare your string in the global scope as a const (make it static if you don't want to create extra symbols in the elf file), then copy it into your array at the beginning of the function using your preferred method.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#21233 - sasq - Wed May 26, 2004 8:26 am</h4>
    <div class="postbody"><span class="postbody">memcpy and memset should be in libgcc.a - which is normally linked unless you give a "nostdlibs" (or something like that) option to the linker.  libgcc contains other stuff that it can be hard to live without like modulo functions and base-conversion functions...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#21240 - cosmic4z - Wed May 26, 2004 10:52 am</h4>
    <div class="postbody"><span class="postbody">I've got libgcc on my HD ... but can't seem to link it in.
<br/>
<br/>
Infact I've got about 4 copies of it ....
<br/>
<br/>
E:\devkitadv\lib\gcc-lib\arm-agb-elf\3.0.2\libgcc.a
<br/>
E:\devkitadv\lib\gcc-lib\arm-agb-elf\3.0.2\interwork\libgcc.a
<br/>
E:\devkitadv\lib\gcc-lib\arm-agb-elf\3.0.2\thumb\libgcc.a
<br/>
E:\devkitadv\lib\gcc-lib\arm-agb-elf\3.0.2\thumb\interwork\libgcc.a
<br/>
<br/>
Which one should I use !?
<br/>
<br/>
My gcc compiler flags and linker flags are:
<br/>
<br/>
CFLAGS		=	-ggdb -O -I$(AGBDIR)/include -I $(INCDIR) -mthumb-interwork -mthumb
<br/>
<br/>
LDFLAGS		+=	-Map $(MAPFILE) -Ttext 0x08000000 -Tbss 0x03000000 -L$(AGBDIR)/lib/ -lagbsyscall -lisagbprn
<br/>
<br/>
If anyone can help ... that'd be great ... thanks :-)<br/>_________________<br/>Qwak - <a href="http://www.qwak.co.uk" target="_blank">www.qwak.co.uk</a> | Forum - <a href="http://www.qwak.co.uk/forum/" target="_blank">www.qwak.co.uk/forum/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#21242 - bats - Wed May 26, 2004 11:17 am</h4>
    <div class="postbody"><span class="postbody">Not sure if you already know this but your -llibname parameters must come after your object files.
<br/>
For example,
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">gcc -o game.elf main.o -lgraphics</td> </tr></table><span class="postbody">
<br/>
<br/>
if main references symbols in the graphics library.
<br/>
<br/>
and you shouldn't have to tell gcc which ones library to use, it should figure it out automatically (for example, if you use -mthumb -mthumb-interwork, it will look in ...\thumb\interwork). I use devkitARM, and I've found that I don't even have to use -L$(libpath).
<br/>
<br/>
Ben
<br/>
<br/>
Edit:
<br/>
I should have read these posts better.
<br/>
From what I can tell memcpy/memset are in your libc.a libraries (try objdump -t libc.a | grep memcpy). These should be linked in automagically. If you are getting undefined reference errors during your link stage, I'd guess that it's either missing from your libc.a file (which I doubt because it's included in mine) or that you're not linking in libc (which  should be automatic unless you pass -nostdlib).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#21285 - wintermute - Wed May 26, 2004 5:50 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>cosmic4z wrote:</b></span></td> </tr> <tr> <td class="quote">I've got libgcc on my HD ... but can't seem to link it in.
<br/>
<br/>
CFLAGS		=	-ggdb -O -I$(AGBDIR)/include -I $(INCDIR) -mthumb-interwork -mthumb
<br/>
<br/>
LDFLAGS		+=	-Map $(MAPFILE) -Ttext 0x08000000 -Tbss 0x03000000 -L$(AGBDIR)/lib/ -lagbsyscall -lisagbprn
<br/>
<br/>
If anyone can help ... that'd be great ... thanks :-)</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
to start with I highly recommend using some sort of linkscript rather than attempting to set section addresses directly and don't use LD to link especially when using standard libraries.
<br/>
<br/>
something like
<br/>
<br/>
LD := arm-agb-elf-gcc
<br/>
<br/>
LDFLAGS := -mthumb -mthumb-interwork -Wl,-Map,$(MAPFILE),-Ttext,0x08000000,-Tbss,0x03000000
<br/>
<br/>
may do what you need.
<br/>
<br/>
<br/>
I'd recommend switching over to DevkitARM though (obviously) &lt;/shameless plug&gt; :P
<br/>
<br/>
<br/>
LD := arm-elf-gcc
<br/>
LDFLAGS := -mthumb -mthumb-interwork -Wl,-Map,$(MAPFILE) -specs=gba.specs</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
