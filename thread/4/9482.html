<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Using GBA as a gamecube controller - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > Using GBA as a gamecube controller</h2>
<div id="posts">
<div class="post">
    <h4>#82250 - KeithE - Thu May 04, 2006 7:53 pm</h4>
    <div class="postbody"><span class="postbody">Has anyone here written a program that would allow the GBA to be used as a gamecube controller when plugged in to the gamecube with the gamecube/gba cable?  What I'm looking for is something that would make the gamecube think that the GBA is just a normal gamecube controller that will work with any gamecube game.
<br/>
<br/>
I was thinking this would be a good project for me to work on, but I figured I might as well ask to see if anyone has already done it.
<br/>
<br/>
[EDIT] - I just found a previous post on this topic - <a href="http://forum.gbadev.org/viewtopic.php?t=7316" target="_blank">http://forum.gbadev.org/viewtopic.php?t=7316</a> [/EDIT]
<br/>
<br/>
It would of course not be able to trigger the analog sticks or the X,Y, or Z buttons.  However, if I get a flash cartridge with an accelerometer in it, then I could turn a GBA into a tilt controller for the gamecube by mapping the accelerometer output to the analog stick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#82267 - tepples - Thu May 04, 2006 10:03 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>KeithE wrote:</b></span></td> </tr> <tr> <td class="quote">However, if I get a flash cartridge with an accelerometer in it</td> </tr></table><span class="postbody">
<br/>
If you can get the rest of your controller working, your best option in this case is to make the a multiboot program and then pak-swap to <span style="font-style: italic">WarioWare: Twisted!</span> or another tilt-sensitive game.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#82319 - edwdig - Fri May 05, 2006 5:21 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">If you can get the rest of your controller working, your best option in this case is to make the a multiboot program and then pak-swap to <span style="font-style: italic">WarioWare: Twisted!</span> or another tilt-sensitive game.</td> </tr></table><span class="postbody">
<br/>
<br/>
WarioWare is sensitive to rotation, not tilt. You've only got 1 axis of sensitivity.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#82320 - tepples - Fri May 05, 2006 6:23 am</h4>
    <div class="postbody"><span class="postbody">Which GBA game is sensitive to 2-axis analog tilt? (And no I don't mean a Wiimote duct-taped to a GBA either.)<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#82332 - keldon - Fri May 05, 2006 9:28 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Which GBA game is sensitive to 2-axis analog tilt? (And no I don't mean a Wiimote duct-taped to a GBA either.)</td> </tr></table><span class="postbody">
<br/>
<br/>
What about kirby tilt and tumble (if it exists). I'm sure there's a kirby/pokemon game that does.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#82344 - tepples - Fri May 05, 2006 12:57 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>keldon wrote:</b></span></td> </tr> <tr> <td class="quote">What about kirby tilt and tumble (if it exists).</td> </tr></table><span class="postbody">
<br/>
<span style="font-style: italic">Kirby Tilt n Tumble</span> is a Game Boy Color game. The GBA in GBA mode is not compatible with GBC carts. In addition, <span style="font-style: italic">Kirby Tilt n Tumble</span> uses a digital tilt sensor, which returns the same on-off types of states that a +Control Pad returns.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#82392 - KeithE - Fri May 05, 2006 10:59 pm</h4>
    <div class="postbody"><span class="postbody">Yoshi topsy turvy has a dual-axis tilt sensor that I might be able to use.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#82720 - KeithE - Mon May 08, 2006 11:07 pm</h4>
    <div class="postbody"><span class="postbody">I just got started on this project, and I'm already stuck.
<br/>
<br/>
I wrote a little program that puts the GBA into JOY BUS mode and waits until a command is received from the gamecube.  Once it receives a command, it displays it on the screen.  So, I plugged the GBA into the gamecube using a Nintendo link cable, turned on the GBA, turned on the gamecube, and waited.
<br/>
<br/>
The receive complete flag never went high.  I was expecting it to go high when the gamecube sent a command to the GBA to tell it to identify itself.
<br/>
<br/>
Here is my code.  Would anyone be willing to suggest what to try next?  Thanks.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include &lt;mygba.h&gt;
<br/>
#define R_RCNT  *(volatile u16*) 0x4000134
<br/>
#define R_JOYCNT *(volatile u16*) 0x4000140
<br/>
<br/>
int RX_COMPLETE();
<br/>
<br/>
int main(void)
<br/>
{
<br/>
   ham_Init();
<br/>
   ham_InitText(0);
<br/>
   // select JOY BUS mode by setting 2 MSBs of R_RCNT to 1
<br/>
   R_RCNT = 0xC000;
<br/>
<br/>
   ham_DrawText(0,0,"%d",RX_COMPLETE());
<br/>
   ham_DrawText(0,1,"WAITING");
<br/>
<br/>
   while (RX_COMPLETE() == 0);  // loop while RX is not complete
<br/>
   
<br/>
   // this point is reached when RX is complete
<br/>
   ham_DrawText(0,0,"%d",RX_COMPLETE()); // show that RX is complete
<br/>
   ham_DrawText(0,1,"%d",REG_JOYRE_H); // draw contents of JOY BUS receive register
<br/>
   ham_DrawText(0,2,"%d",REG_JOYRE_H); // draw contents of JOY BUS receive register
<br/>
   
<br/>
   while(TRUE)
<br/>
   {
<br/>
   }
<br/>
<br/>
   return 0;
<br/>
}
<br/>
<br/>
// this returns 1 when the receive complete flag goes HI
<br/>
int RX_COMPLETE(){
<br/>
    int out;
<br/>
    if(0x2 &amp; R_JOYCNT) out = 1;
<br/>
    else out = 0;
<br/>
    return out;
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#83098 - thegamefreak0134 - Fri May 12, 2006 9:20 pm</h4>
    <div class="postbody"><span class="postbody">For that last function, don't you need brackets around the if/else statement? If not (my C++ is a little (a lot) rusty) then I don't know what to say.<br/>_________________<br/>What if the hokey-pokey really is what it's all about?
<br/>
<br/>
[url=http:/www.darknovagames.com/index.php?action=recruit&amp;clanid=1]Support Zeta on DarkNova![/url]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#83100 - KeithE - Fri May 12, 2006 9:29 pm</h4>
    <div class="postbody"><span class="postbody">Thanks, but it needs brackets only if the statement consists of more than 1 line.
<br/>
<br/>
See this reference: <a href="http://www.acm.uiuc.edu/webmonkeys/book/c_guide/1.6.html#if" target="_blank">http://www.acm.uiuc.edu/webmonkeys/book/c_guide/1.6.html#if</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#83176 - KeithE - Sat May 13, 2006 7:22 pm</h4>
    <div class="postbody"><span class="postbody">Well, I don't think I'm going to be able to use the JOY BUS mode of the gba for this project.
<br/>
<br/>
Based on the GBATEK documentation, the only JOY BUS commands the GBA understands are 0x00, 0xFF, 0x14, and 0x15.  It looks like it responds automatically to those commands.  I don't see any way to determine what command was sent, other than those four.  From the reading I've done, it looks like the gamecube sends 0x00 to read the device ID, and sends a 3 byte command 0x40, 0x03, 0x00 to read the controller button status.  See <a href="http://www.gc-linux.org/docs/yagcd/index.html" target="_blank">http://www.gc-linux.org/docs/yagcd/index.html</a> for the GCN documentation, specifically sections 9.1, 9.2, and 5.8.  So the reason the code listing above never left the while loop is that the gamecube never sent 0x14 or 0x15.
<br/>
<br/>
Since it doesn't look like the GBA in JOY BUS mode understands anything besides 0x00, 0xFF, 0x14, and 0x15, I won't be able to determine that the gamecube has requested the controller button status, and I also won't be able to respond to the device ID with 0x0900 to indicate a GC controller instead of 0x0004 which indicates a GBA.
<br/>
<br/>
So, my feeling right now is that I'll have to write a program that puts the serial port into general purpose mode, and determine what commands were sent by interpreting SI according to the JOY BUS protocol.  Then to send data, I'll have to drive SO according to the JOY BUS protocol.
<br/>
<br/>
Does anyone have any other suggestions?  Have I interpreted the GBA and GCN specs correctly?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110244 - Masked - Mon Nov 27, 2006 6:25 am</h4>
    <div class="postbody"><span class="postbody">Sorry to bump an old topic, but I was wondering if there was any more progress made with this. I've been looking into the same thing and ran into the same problems. Does the GBA just respond to the 0x00 JOY BUS command automatically?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#110285 - KeithE - Mon Nov 27, 2006 3:26 pm</h4>
    <div class="postbody"><span class="postbody">Yes, the GBA does respond automatically to the 0x00 JOY BUS command when it is in JOY BUS mode.
<br/>
<br/>
I confirmed this by putting the GBA into JOY BUS mode, and reading the R_RCNT register repeatedly several thousand times, triggered by SI going low. I saved the reads into an array, then saved the array to SRAM so I could look at the data afterwards.  Looking at the data, I could see the gamecube sending 0x00, and the GBA responding with 0x0004.
<br/>
<br/>
I tried putting the GBA serial port in general purpose mode with all lines as inputs and doing the same thing, but I never saw any commands sent from the gamecube in that case.  I guess I'll need to do some sluething with an oscilloscope to make any more progress.
<br/>
<br/>
Also, I noticed when looking at the captured JOY BUS mode data that the timing is very tight.  It is going to be very difficult to make a program that can interpret a command and respond to it quick enough.
<br/>
<br/>
Let me know if you have any more questions about the work I've done.  I'm happy that someone else is looking into it - maybe you'll make some more progress.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
