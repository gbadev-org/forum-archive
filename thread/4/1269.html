<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>devkitadv 5 with jeff frohweins lnkscript - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Coding > devkitadv 5 with jeff frohweins lnkscript</h2>
<div id="posts">
<div class="post">
    <h4>#6310 - JL - Thu May 22, 2003 8:58 pm</h4>
    <div class="postbody"><span class="postbody">Hi guys,
<br/>
<br/>
I'm trying to compile my project using the crt0 and lnkscript from Jeff Frohwein but the compiler complains about undefined references to appended_end, appended_start and heap_limit.
<br/>
<br/>
Now I noticed that these are defined in the lnkscript that comes with devkitadv 5 but when I compile that with the crt0 from jeff I get unresolved refs to the interrupt stuff (sp_irq, sp_usr, intr_vector_buf etc.).
<br/>
<br/>
The whole reason to use jeff's crt0+lnkscript was the neat interrupt support in there.
<br/>
<br/>
So, my question is if anyone knows how to compile the crt0 from jeff with interrupt support using devkitadv 5?
<br/>
<br/>
Thanks for any help!
<br/>
<br/>
JL</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6311 - tepples - Thu May 22, 2003 9:05 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>JL wrote:</b></span></td> </tr> <tr> <td class="quote">The whole reason to use jeff's crt0+lnkscript was the neat interrupt support in there.</td> </tr></table><span class="postbody">
<br/>
Based on what I have learned from <a class="postlink" href="http://groups.yahoo.com/group/gbadev/" target="_blank">gbadev@yahoogroups</a>, Jeff F's multiple interrupt support was removed from DevKit Advance R5 because it turned out to have been copied directly from an example in Nintendo's official SDK.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6344 - Jason Wilkins - Fri May 23, 2003 3:43 pm</h4>
    <div class="postbody"><span class="postbody">I did not remove it.  DevKit Advance never contained any interrupt support to begin with.  I was not going to add it until I had a chance to look at it more.  I find the implementation of interrupts the way Nintendo provided in its examples to be a little wanting.  Or at least, I wanted to understand it better before including it.
<br/>
<br/>
If you want Jeff's interrupt handling, then copy the interrupt code out of his crt0.S and create your own seperate assembly file containing interrupt handling.  There is no reason that it has to be in crt0.S
<br/>
<br/>
Such code should have never been in crt0.S to begin with.
<br/>
<br/>
Please note that crt0.S and the linkscript are intimately related and are very unlikely to work if they are not part of the same package.<br/>_________________<br/><a href="http://devkitadv.sourceforge.net" target="_blank">http://devkitadv.sourceforge.net</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6357 - Maddox - Fri May 23, 2003 7:52 pm</h4>
    <div class="postbody"><span class="postbody">Go ahead and stick your interrupt handler in crt0.s if you want.  It won't hurt anything.<br/>_________________<br/>You probably suck.  I hope you're is not a game programmer.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6368 - Jason Wilkins - Fri May 23, 2003 8:54 pm</h4>
    <div class="postbody"><span class="postbody">Pay attention.
<br/>
<br/>
The guy wants to use DevKit Advance's crt0 and lnkscript, but also Jeff's interrupt code.
<br/>
<br/>
If he wants to do that then he needs to rip the code out of Jeff's crt0.S and put it in a seperate file.
<br/>
<br/>
If he does not necessarily want to use DevKit Advance's crt0 and lnkscript, then he will need to make sure he disables DevKit Advance's by using the -nostartfiles and -Tlnkscript options.
<br/>
<br/>
Of course it 'does not hurt anything' to have interrupt code in the crt0.S file, but it is sloppy.  Why not just throw the whole game into a .S file and a .c file??  It is like someone at Nintendo said 'Man! I'm just too lazy to put this unrelated thing into a seperate file, so I'll just slap it in here', and because everyone else is too lazy to do their own thinking they just copied it.  The only thing crt0 and interrupt handling have in common is that they are written in assembly language.
<br/>
<br/>
I didn't put it into DevKit Advance's crt0 because it creates unnecessay dependencies.  The only dependencies crt0 should have IMHO are to the entry point function and lnkscript.
<br/>
<br/>
I seem to be a little grumpy today!  I better go back to being the friendly and helpful DevKit maintainer or people might begin to wonder about me ^_^<br/>_________________<br/><a href="http://devkitadv.sourceforge.net" target="_blank">http://devkitadv.sourceforge.net</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6375 - Maddox - Fri May 23, 2003 9:32 pm</h4>
    <div class="postbody"><span class="postbody">I didn't say that it wasn't sloppy.  I was just being a dick.  I think you're right!<br/>_________________<br/>You probably suck.  I hope you're is not a game programmer.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6413 - JL - Sat May 24, 2003 11:35 pm</h4>
    <div class="postbody"><span class="postbody">Ok, thanks all for your input. The question came up because I was just wondering why the crt0 from Jeff worked fine using the previous devkit and now it doesn't anymore in the new release. 
<br/>
But since the crt0 and lnkscript are closely related, that makes sense. Ofcourse, I figured as much from the errors that the compiler threw at me, but I didn't know the background of it.
<br/>
<br/>
I want to use the new devkitadv release, because that fixes some memory allocation errors (a C++ new operator failed on me). But I also want the interrupt support, so I'll take Jeff's code and put it in a different file.
<br/>
<br/>
Grtz,
<br/>
JL</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6426 - Jason Wilkins - Sun May 25, 2003 8:40 am</h4>
    <div class="postbody"><span class="postbody">Please note, crt0.o from DevKit Advance R5 registers the address of __interrupt_handler as the interrupt handler instead of IntrMain.  So, if you rip the code you will either need to rename IntrMain to __interrupt_handler or you will need to register IntrMain yourself like this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">(void*)(0x03007FFC) = &amp;IntrMain;</td> </tr></table><span class="postbody"><br/>_________________<br/><a href="http://devkitadv.sourceforge.net" target="_blank">http://devkitadv.sourceforge.net</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
