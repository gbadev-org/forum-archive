<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>background bug(?) - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Coding > background bug(?)</h2>
<div id="posts">
<div class="post">
    <h4>#4122 - Ninj4D4n - Wed Mar 19, 2003 8:41 pm</h4>
    <div class="postbody"><span class="postbody">Hey all, i've been playing with backgrounds for a few days and keep finding this wierd occurance that seems to be giving me most of the trouble.
<br/>
<br/>
Here's my function
<br/>
[code]
<br/>
void Intro(void)
<br/>
{
<br/>
	SetMode(MODE_1 | OBJ_ENABLE | OBJ_MAP_1D);
<br/>
	Bg FlashBG, AtariBG;
<br/>
<br/>
	//////////////////////////////////
<br/>
	//setup data
<br/>
	u16 loop;
<br/>
	//load palette
<br/>
	for(loop = 0; loop &lt; 256; loop++)
<br/>
		BGPalette[loop] = tilesPalette[loop];
<br/>
<br/>
	u16* tempData = (u16*)CharBaseBlock(0);
<br/>
	//load tile set; charbase block 0
<br/>
	for(loop = 0; loop &lt; tiles_WIDTH * tiles_HEIGHT /2; loop++)
<br/>
		tempData[loop] = tilesData[loop];
<br/>
<br/>
	//load maps
<br/>
	u16* tempLoad;
<br/>
	u16* tempMap;
<br/>
<br/>
	//rot bg
<br/>
	tempMap = (u16*)ScreenBaseBlock(28);
<br/>
	tempLoad = (u16*)clouds;
<br/>
	for(loop = 0; loop &lt; 32*32/2; loop++)
<br/>
		tempMap[loop] = tempLoad[loop];
<br/>
<br/>
	AtariBG.number = 2;
<br/>
	AtariBG.charBaseBlock = 0;     //tiles in 0
<br/>
	AtariBG.screenBaseBlock = 28;   //AtariBG in 28 (above)
<br/>
	AtariBG.colorMode = BG_COLOR_256;	
<br/>
	AtariBG.size = ROTBG_SIZE_256x256;
<br/>
	AtariBG.mosaic = 0;
<br/>
	AtariBG.x_scroll = 0;
<br/>
	AtariBG.y_scroll = 0;
<br/>
<br/>
	EnableBackground(&amp;AtariBG);
<br/>
}
<br/>
[/code]
<br/>
<br/>
as you can see, it just loads all the data necessary to setup background 2.  This works fine.  The bug is if i switch the decleration:
<br/>
Bg FlashBG, AtariBG;
<br/>
<br/>
to
<br/>
<br/>
Bg AtariBG, FlashBG;
<br/>
<br/>
Nothing is displayed.  Total black screen.
<br/>
<br/>
I'm currently using the files i found at the pern project so my struct Bg is:
<br/>
[code]
<br/>
//structure for a background
<br/>
typedef struct Bg
<br/>
{
<br/>
	u16* tileData;
<br/>
	u16* mapData;
<br/>
	u8 mosaic;
<br/>
	u8 colorMode;
<br/>
	u8 number;
<br/>
	u16 size;
<br/>
	u8 charBaseBlock;
<br/>
	u8 screenBaseBlock;
<br/>
	u8 wraparound;
<br/>
	s16 x_scroll,y_scroll;
<br/>
	s32 DX,DY;
<br/>
	s16 PA,PB,PC,PD;
<br/>
}Bg;
<br/>
[/code]
<br/>
<br/>
So.... any ideas? Also, if i don't declare FlashBG before AtariBG i also get black.
<br/>
<br/>
--Ninj4D4n</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4151 - pollier - Fri Mar 21, 2003 1:59 am</h4>
    <div class="postbody"><span class="postbody">Either some other process like a music player is corrupting it, or you're relying on these values to be pre-initialised. It might be a good idea to do a memset(AtariBG, 0, sizeof(Bg)) or something...or does that apply for local declarations like this? Alternatively, you might want to check your linkscript for your IWram/EWram settings, or setup a data breakpoint in an emulator to find the source of the error.<br/>_________________<br/>(Works for me!)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4432 - Ninj4D4n - Mon Mar 31, 2003 3:14 am</h4>
    <div class="postbody"><span class="postbody">Ok, so i played around a little more.  If i make AtariBG a global variable.. everything works fine.  haha... so now i'm really confused.
<br/>
<br/>
--Ninj4D4n</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
