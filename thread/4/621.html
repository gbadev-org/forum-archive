<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>ClearBuffer() troubles - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Coding > ClearBuffer() troubles</h2>
<div id="posts">
<div class="post">
    <h4>#3195 - Corum - Wed Feb 19, 2003 7:00 pm</h4>
    <div class="postbody"><span class="postbody">Hi all.
<br/>
I've a little problem when trying to clear an u16* buffer by using a dma32 copy.
<br/>
I'm referring to the well-known function by which we can made a brute copy of a 0x0000 sequence to clean the display buffer (my version is called ClearBuffer()).
<br/>
I'm able to plot everything by using PlotPixel() and similar, but I cannot clear nothing.
<br/>
I also use the Flip() function in my code, and I'm sure to achieve the buffer flipping AFTER a complete drawing of the screen and to "clean" the correct buffer (the hidden one) at the beginning of the rendering phase.
<br/>
I compile my .bin by using a minimum set of switches (-mthumb-interwork, -04, -wall, -mlongcalls).
<br/>
Every damned function is positioned within the iwram segment.
<br/>
Anyone could explain why it happens?
<br/>
Had you ever had this kind of problem?
<br/>
<br/>
Thanks in advance for your replies.
<br/>
<br/>
Corum.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#3196 - jenswa - Wed Feb 19, 2003 8:24 pm</h4>
    <div class="postbody"><span class="postbody">Why clean, if you can just over-write it?
<br/>
<br/>
One way of cleaning is just over-writing the (back) buffer with
<br/>
one color, probably black or something.<br/>_________________<br/>It seems this wasn't lost after all.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#3213 - Corum - Thu Feb 20, 2003 10:21 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>jenswa wrote:</b></span></td> </tr> <tr> <td class="quote">Why clean, if you can just over-write it?
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Cleaning by a dma copy is faster than cleaning by plotting each "blank" pixel. And I need cleaning to deal with transparent areas.
<br/>
The surprising thing is that in another test I made into a separate project, the same function is fully working.
<br/>
Anyway, I'm using the sm's library v6 code... For tiled modes is amazing, but it lacks if applied to bitmap modes, IMHO.
<br/>
<br/>
But I think I've to assemble my own library for achieving basic stuffs.
<br/>
Thanks.
<br/>
<br/>
Corum.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#3220 - Arjan - Thu Feb 20, 2003 4:41 pm</h4>
    <div class="postbody"><span class="postbody">Maybe the buffer isn't on a word boundary??<br/>_________________<br/>dus.... <a href="http://www.bombaman.net" target="_blank">http://www.bombaman.net</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#3224 - col - Thu Feb 20, 2003 5:29 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Corum wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>jenswa wrote:</b></span></td> </tr> <tr> <td class="quote">Why clean, if you can just over-write it?
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Cleaning by a dma copy is faster than cleaning by plotting each "blank" pixel....
<br/>
Corum.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
IIRC from a discussion on the yahoo list, dma is not the fastest way to set a block of memory all to the same value! because dma will load the source data every time!
<br/>
I think its faster to use a partially unrolled loop with stm instructions.  This will work best if the size of the block is constant...
<br/>
<br/>
cheers
<br/>
<br/>
col.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
