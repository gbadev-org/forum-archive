<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Overwriting memory?? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Coding > Overwriting memory??</h2>
<div id="posts">
<div class="post">
    <h4>#15085 - Dreamer - Fri Jan 16, 2004 10:51 pm</h4>
    <div class="postbody"><span class="postbody">I am about ten seconds from tearing off my own head.  I've spent hours trying to figure out this problem I'm having with my code.  I've been fiddling with sources and tutorials, and after a long time spent working in Mode 1 I discovered (unless I'm mistaken) that I didn't know how to show full screen images, so I had to switch to Mode 4, where I had examples.  
<br/>
<br/>
So I've been working in it just fine until I tried to work on my Tetris game again (for practice).  I have a strip of images for blocks and their 'animated' (read: blinking) frames, and I load two of them into memory and store them separately.  I then made it so that if you press A they show their respective second frame, if you press B, their first.  This is just to get them ready for slight blinking animation, so I marked the tiles to distinguish frames one and two.  
<br/>
<br/>
However, while they both start out just fine, pressing the A button displays the second block's second frame for both blocks, instead of their own second frames, and pressing B shows the second block's first frame.  I've been staring at this for hours trying to fix things and make sense of it, but no matter what I do it seems like the second block overwrites the data for the first block somehow, and I don't know how to fix it.  
<br/>
<br/>
Here's a URL to the source (fairly simple), and I would greatly appreciate any insight.  The sprite creation is in Functionality\Sprites.h and .c, and it is called from Main.c.
<br/>
<br/>
<a class="postlink" href="http://jhunix.hcf.jhu.edu/~prt2/Test/Test.zip" target="_blank">http://jhunix.hcf.jhu.edu/~prt2/Test/Test.zip</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15087 - sajiimori - Fri Jan 16, 2004 11:11 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
Sprite Load ( u16 colorindex, u16 colors, u16 frames, u32 offset )
<br/>
{
<br/>
   u16 temp[frames];   // Temporary init of Frame array
<br/>
   spr.u16_Frames               = temp;
<br/>
</td> </tr></table><span class="postbody">
<br/>
The temp array is destroyed after Load returns, and you're saving a pointer to it.  The outcome is undefined.
<br/>
<br/>
Quick solutions:
<br/>
<br/>
1)  Change Sprite.u16_Frames to an actual array with MAX_FRAMES elements.
<br/>
<br/>
2)  Dynamically allocate the array.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
spr.u16_Frames = malloc(frames * sizeof(u16));
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15092 - Dreamer - Sat Jan 17, 2004 12:44 am</h4>
    <div class="postbody"><span class="postbody">Greatly appreciate the help.  Worked like a charm.  Geez my C is rusty.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15095 - sajiimori - Sat Jan 17, 2004 1:08 am</h4>
    <div class="postbody"><span class="postbody">Glad to avert the impending head-tearage.  =)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
