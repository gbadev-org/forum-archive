<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Where's Waldo - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > Where's Waldo</h2>
<div id="posts">
<div class="post">
    <h4>#15864 - Miked0801 - Sun Feb 01, 2004 10:00 pm</h4>
    <div class="postbody"><span class="postbody">As promised, here's a little snippet that has issues.  Difficulty on this one ranks about 4 on a scale from 1 to 10.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define FIXED_TO_INT(x) x &gt;&gt; 16
<br/>
<br/>
s32 mathFixedMulToInt(s32 fixed1, s32 fixed2)
<br/>
{
<br/>
    return (FIXED_TO_INT(fixed1) * FIXED_TO_INT(fixed2));
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
A couple things not right, some harder to spot that others.  Enjoy!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15867 - poslundc - Sun Feb 01, 2004 11:20 pm</h4>
    <div class="postbody"><span class="postbody">I'm bored so I'll play.
<br/>
<br/>
- No parentheses around the FIXED_TO_INT macro. So the formula is (x &gt;&gt; 16 * x &gt;&gt; 16) which is almost certainly not what is intended. (-Wall will generate a warning for this in gcc.)
<br/>
- No parentheses around the x in the FIXED_TO_INT macro, which is liable to cause more trouble in other situations (although not this particular function) where the macro is used on expressions instead of single variables/values.
<br/>
- The function assumes 16.16 point notation. (At least it probably does.) It might not be. Using a more informative typedef would help (eg. typedef s32 Fixed16x16).
<br/>
- If the function <span style="font-style: italic">did</span> work, it would be eliminating all precision before multiplying. A more sound strategy for a general-purpose 16.16 multiplication would be to reduce both parameters to 24.8 before multiplying so you would obtain another 16.16 result. (You can then reduce down to 32.0 if you want to conform with the mathFixedMulToInt spec.)
<br/>
<br/>
Finally - and this is not a correctness aspect - I would make this an inline function or put the entire thing in a macro rather than forcing a context switch just for a simple multiply routine.
<br/>
<br/>
That's all I caught... let me know if I missed anything.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15868 - jd - Sun Feb 01, 2004 11:35 pm</h4>
    <div class="postbody"><span class="postbody">This would expand to:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
s32 mathFixedMulToInt(s32 fixed1, s32 fixed2)
<br/>
{
<br/>
    return (fixed1 &gt;&gt; 16 * fixed2 &gt;&gt; 16);
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I can't remember my operand priorities (I usually use lots of brackets to make sure) but I think that "*" has a higher precidence than "&gt;&gt;". This would mean that the code above would be equivalent to:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
s32 mathFixedMulToInt(s32 fixed1, s32 fixed2)
<br/>
{
<br/>
    return (fixed1 &gt;&gt; (16 * fixed2) &gt;&gt; 16);
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
This is almost certainly not what the original programmer intended. The only other thing that I can think of is that s32 isn't defined in the code so that could be declared incorrectly as well - although perhaps I'm being a bit too pedantic there.
<br/>
<br/>
Edit: Darn, poslundc beat me to it. :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15869 - Miked0801 - Sun Feb 01, 2004 11:41 pm</h4>
    <div class="postbody"><span class="postbody">Lol.  That didn't take too long. I expected people to see the missing parenthesis and not notice I was throwing away all the precision on the multiply.  BTW, if I was doing this for real, I'd have a 'fixed' typedef sitting around so that notation would make more sense.  A -O3 would more than likely inline this :)
<br/>
<br/>
I've got a couple more fun ones that aren't quite as straight forward I'll post during the superbowl if the comercial suck - otherwise I'll throw them up tomorrow.
<br/>
<br/>
Good fun!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15872 - dagamer34 - Mon Feb 02, 2004 4:19 am</h4>
    <div class="postbody"><span class="postbody">Again, Waldo(s)....<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
