<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Okay, I want to program sprites that show any number, like - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Coding > Okay, I want to program sprites that show any number, like</h2>
<div id="posts">
<div class="post">
    <h4>#14729 - LOst? - Mon Jan 12, 2004 1:45 am</h4>
    <div class="postbody"><span class="postbody">Okay, I want to program sprites that show any number, like an extra life counter, or a debug output.
<br/>
<br/>
I want one function to show decimal numbers, and one other function that can show hexadecimal numbers.
<br/>
<br/>
I have the numbers and the sprites set up already, so what should I do to output a integer number on screen?
<br/>
<br/>
I could have done this easy if the Gameboy had faster modulo calculation. But it hasn't, so anyone's willing to help me out?
<br/>
<br/>
And please, I can't program inline assembler because of my easy compiler settings, so no dtoa, itoa with assembler in it :P</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14731 - yaustar - Mon Jan 12, 2004 1:54 am</h4>
    <div class="postbody"><span class="postbody">How complex do you want it to be?
<br/>
<br/>
I have never done this before but am interested in how it turns out :)
<br/>
<br/>
For something like a lives counter, I would have an animated sprite that goes from 0-9. So if I wanted to increment it, I would go to the next animation frame. 
<br/>
<br/>
this may help as well
<br/>
<a href="http://www.gbadev.org/download.php?section=demos&amp;filename=bgcounter.zip" target="_blank">http://www.gbadev.org/download.php?section=demos&amp;filename=bgcounter.zip</a><br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14733 - sajiimori - Mon Jan 12, 2004 2:28 am</h4>
    <div class="postbody"><span class="postbody">Is the problem just figuring out what the digits are?
<br/>
<br/>
For relatively small numbers (i.e. health counters but not memory addresses), it's reasonable to use repeated subtraction.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
get_digits(int num, int* hundreds, int* tens, int* ones)
<br/>
{
<br/>
    int h = 0, t = 0;
<br/>
<br/>
    while(num &gt;= 100)
<br/>
        ++h, num -= 100;
<br/>
    while(num &gt;= 10)
<br/>
        ++t, num -= 10;
<br/>
<br/>
    *hundreds = h;
<br/>
    *tens = t;
<br/>
    *ones = num;
<br/>
}
<br/>
<br/>
main()
<br/>
{
<br/>
    int first, second, third;
<br/>
    int health = 548;
<br/>
    get_digits(health, &amp;first, &amp;second, &amp;third);
<br/>
    printf("%d%d%d &lt;-- should say 548",
<br/>
        first, second, third);
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
Is speed really so important for debug output?  If not, just use sprintf.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14740 - DekuTree64 - Mon Jan 12, 2004 4:17 am</h4>
    <div class="postbody"><span class="postbody">Here's another possibility, reciprocal multiplication. I know you said you don't want ASM, but for anyone else who does, here's my int-to-string function:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">/*
<br/>
converts int to string
<br/>
args: int
<br/>
return: char*
<br/>
Writes digits to global array tempStr, but could easily be modified to take a string as a second argument
<br/>
*/
<br/>
<br/>
.global itoa
<br/>
.arm
<br/>
.align 2
<br/>
itoa:
<br/>
stmfd sp!, {r4}
<br/>
movs r4, r0
<br/>
rsbmi r0, r0, #0  @make sure we're working with a positive number
<br/>
ldr r12, =tempStr @global array
<br/>
add r12, r12, #15 @start at the end of the string and work our way back
<br/>
mov r1, #0
<br/>
strb r1, [r12]
<br/>
ldr r1, =429496729 @.1 &lt;&lt; 32
<br/>
<br/>
itoa_loop:
<br/>
umull r2, r3, r0, r1 @r3 = num/10
<br/>
mov r2, r3, LSL #3
<br/>
add r2, r2, r3, LSL #1 @x*8+x*2=x*10
<br/>
sub r0, r0, r2 @subtract (num/10)*10 from num to get remainder
<br/>
add r0, r0, #'0'
<br/>
strb r0, [r12, #-1]!
<br/>
movs r0, r3
<br/>
bne itoa_loop
<br/>
<br/>
cmp r4, #0
<br/>
bpl itoa_return
<br/>
mov r0, #'-'
<br/>
strb r0, [r12, #-1]! @don't forget to add a - sign if the number was originally negative
<br/>
<br/>
itoa_return:
<br/>
ldmfd sp!, {r4}
<br/>
mov r0, r12
<br/>
bx lr</td> </tr></table><span class="postbody">
<br/>
<br/>
I'll see if I can whip up a C version real quick. It will only be able to deal with 16-bit numbers since I can't use 64-bit multiplication, but that's usually enough anyway.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">char *itoa(int num)
<br/>
{
<br/>
   int tmp, tmp2, sign;
<br/>
   char *str = tempStr + 15;
<br/>
   *str = 0;
<br/>
   if(num &lt; 0)
<br/>
   {
<br/>
      sign = 1;
<br/>
      num = -num;
<br/>
   }
<br/>
   else
<br/>
      sign = 0;
<br/>
   do
<br/>
   {
<br/>
      tmp = num * 6553;
<br/>
      tmp &gt;&gt;= 16;
<br/>
      tmp2 = tmp &lt;&lt; 3;
<br/>
      tmp2 += tmp &lt;&lt; 1;
<br/>
      num -= tmp2;
<br/>
      num += '0';
<br/>
      *--str = num;
<br/>
      num = tmp;
<br/>
   } while(num != 0); //so we run through at least once, incase num==0 to begin with
<br/>
   if(sign)
<br/>
      *--str = '-';
<br/>
   return str;
<br/>
}</td> </tr></table><span class="postbody">
<br/>
Can't guarantee that will work, but you get the idea.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14741 - dagamer34 - Mon Jan 12, 2004 4:22 am</h4>
    <div class="postbody"><span class="postbody">You could also use sprintf so that the number becomes characters.
<br/>
It also makes it easier for decimal places.
<br/>
<br/>
Just because its a number doesn't mean it has to act like one.<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14743 - poslundc - Mon Jan 12, 2004 5:35 am</h4>
    <div class="postbody"><span class="postbody">If you want the functionality of sprintf on numbers but without the overhead of the library routine, you can download my <a class="postlink" href="http://www.danposluns.com/gbadev/posprintf/" target="_blank">posprintf</a> library. Runs in Thumb mode from the ROM, so it won't be as quick as DekuTree's algorithm, but it lets you print to any string without having to "print backwards" and you can format your numbers with leading zeros/spaces.
<br/>
<br/>
Plus it's a kick-ass algorithm someone in these forums pointed me to. Everything is shifts and adds for numbers up to +/-65535.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14746 - LOst? - Mon Jan 12, 2004 7:20 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>dagamer34 wrote:</b></span></td> </tr> <tr> <td class="quote">You could also use sprintf so that the number becomes characters.
<br/>
It also makes it easier for decimal places.
<br/>
<br/>
Just because its a number doesn't mean it has to act like one.</td> </tr></table><span class="postbody">
<br/>
<br/>
I can't use sprintf because of my GCC telling me dtoa doesn't work.
<br/>
<br/>
I will try out all of your codes. Thanks :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14747 - Lord Graga - Mon Jan 12, 2004 8:12 am</h4>
    <div class="postbody"><span class="postbody">I have used this writing method with success :)
<br/>
<br/>
The problem is that there's only 128 sprites :B
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">u8 used_sprites;
<br/>
const char font_name[43] = {
<br/>
   ' ','_','-','a','b',
<br/>
   'c','d','e','f','g',
<br/>
   'h','i','j','k','l',
<br/>
   'm','n','o','p','q',
<br/>
   'r','s','t','u','v',
<br/>
   'w','x','y','z','#',
<br/>
   '0','1','2','3','4',
<br/>
   '5','6','7','8','9',
<br/>
   '!','.',','
<br/>
};
<br/>
const u8 font_width[43] = {
<br/>
   4,6,4,5,6,
<br/>
   6,6,6,5,5,
<br/>
   5,2,5,6,5,
<br/>
   7,6,6,5,7,
<br/>
   5,5,6,5,5,
<br/>
   7,5,5,6,8,
<br/>
   6,5,5,5,5,
<br/>
   5,5,5,6,5,
<br/>
   2,2,2
<br/>
};
<br/>
<br/>
void Write(char *text, u16 y){
<br/>
   int i,letter,textlength;
<br/>
   int writetext[100];
<br/>
<br/>
   letter = 0;
<br/>
   while(text[letter]!=NULL)   {
<br/>
      for(i=0;i&lt;43;i++) if(text[letter] == font_name[i]) writetext[letter] = i;
<br/>
      letter++;
<br/>
   }
<br/>
   for(i=0;i&lt;letter;i++) textlength += font_width[writetext[i]]+1;
<br/>
   textlength = 120 - textlength/2;
<br/>
   for(i=0;i&lt;letter;i++)   {
<br/>
      if(writetext[i])      {
<br/>
         sprites[used_sprites].attribute0 = COLOR_256|y;
<br/>
         sprites[used_sprites].attribute1 = textlength;
<br/>
         sprites[used_sprites].attribute2 = 512+writetext[i]*2;
<br/>
         used_sprites ++;
<br/>
      }
<br/>
      textlength += font_width[writetext[i]]+1;
<br/>
   }
<br/>
   CopyOAM();
<br/>
}</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14756 - poslundc - Mon Jan 12, 2004 3:54 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lord Graga wrote:</b></span></td> </tr> <tr> <td class="quote">I have used this writing method with success :)
<br/>
<br/>
The problem is that there's only 128 sprites :B</td> </tr></table><span class="postbody">
<br/>
<br/>
<a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=2533" target="_blank">Check it out.</a>
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14770 - LOst? - Mon Jan 12, 2004 6:22 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lord Graga wrote:</b></span></td> </tr> <tr> <td class="quote">I have used this writing method with success :)
<br/>
<br/>
The problem is that there's only 128 sprites :B
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">u8 used_sprites;
<br/>
const char font_name[43] = {
<br/>
   ' ','_','-','a','b',
<br/>
   'c','d','e','f','g',
<br/>
   'h','i','j','k','l',
<br/>
   'm','n','o','p','q',
<br/>
   'r','s','t','u','v',
<br/>
   'w','x','y','z','#',
<br/>
   '0','1','2','3','4',
<br/>
   '5','6','7','8','9',
<br/>
   '!','.',','
<br/>
};
<br/>
const u8 font_width[43] = {
<br/>
   4,6,4,5,6,
<br/>
   6,6,6,5,5,
<br/>
   5,2,5,6,5,
<br/>
   7,6,6,5,7,
<br/>
   5,5,6,5,5,
<br/>
   7,5,5,6,8,
<br/>
   6,5,5,5,5,
<br/>
   5,5,5,6,5,
<br/>
   2,2,2
<br/>
};
<br/>
<br/>
void Write(char *text, u16 y){
<br/>
   int i,letter,textlength;
<br/>
   int writetext[100];
<br/>
<br/>
   letter = 0;
<br/>
   while(text[letter]!=NULL)   {
<br/>
      for(i=0;i&lt;43;i++) if(text[letter] == font_name[i]) writetext[letter] = i;
<br/>
      letter++;
<br/>
   }
<br/>
   for(i=0;i&lt;letter;i++) textlength += font_width[writetext[i]]+1;
<br/>
   textlength = 120 - textlength/2;
<br/>
   for(i=0;i&lt;letter;i++)   {
<br/>
      if(writetext[i])      {
<br/>
         sprites[used_sprites].attribute0 = COLOR_256|y;
<br/>
         sprites[used_sprites].attribute1 = textlength;
<br/>
         sprites[used_sprites].attribute2 = 512+writetext[i]*2;
<br/>
         used_sprites ++;
<br/>
      }
<br/>
      textlength += font_width[writetext[i]]+1;
<br/>
   }
<br/>
   CopyOAM();
<br/>
}</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
<br/>
Thank you, but still I'm not after making a font with sprites. All I want is to have some statistic over the game, like a score and a life counter. I will use a group of different sized sprites for use with the menus, such as Option, and Start Game, Press Start, etc...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14833 - LOst? - Tue Jan 13, 2004 3:32 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">Is the problem just figuring out what the digits are?
<br/>
<br/>
For relatively small numbers (i.e. health counters but not memory addresses), it's reasonable to use repeated subtraction.
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
get_digits(int num, int* hundreds, int* tens, int* ones)
<br/>
{
<br/>
    int h = 0, t = 0;
<br/>
<br/>
    while(num &gt;= 100)
<br/>
        ++h, num -= 100;
<br/>
    while(num &gt;= 10)
<br/>
        ++t, num -= 10;
<br/>
<br/>
    *hundreds = h;
<br/>
    *tens = t;
<br/>
    *ones = num;
<br/>
}
<br/>
<br/>
main()
<br/>
{
<br/>
    int first, second, third;
<br/>
    int health = 548;
<br/>
    get_digits(health, &amp;first, &amp;second, &amp;third);
<br/>
    printf("%d%d%d &lt;-- should say 548",
<br/>
        first, second, third);
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
Is speed really so important for debug output?  If not, just use sprintf.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Very good indeed! I really liked this one because it isn't using any multiply, and it's really small.
<br/>
<br/>
Now I finally have everything I need to make a GBA game. This is ganna be fun! Thank you</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14871 - haduken - Wed Jan 14, 2004 12:09 am</h4>
    <div class="postbody"><span class="postbody">So, cxutting through the code, you're going to want a seperate variable for each digit of the display (one for ones, tens, hundreds, et cetera). When each variable gets to a certain number (9 for a 0-9 display, F for 0-F hex), the next digit will be incremented. I've never tried this (not on a GBA, anyway), but that's what everyone ELSE seems to be doing, so...<br/>_________________<br/>There were worms, lots of worms, worms that made me crazy,..</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14874 - LOst? - Wed Jan 14, 2004 3:44 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>haduken wrote:</b></span></td> </tr> <tr> <td class="quote">So, cxutting through the code, you're going to want a seperate variable for each digit of the display (one for ones, tens, hundreds, et cetera). When each variable gets to a certain number (9 for a 0-9 display, F for 0-F hex), the next digit will be incremented. I've never tried this (not on a GBA, anyway), but that's what everyone ELSE seems to be doing, so...</td> </tr></table><span class="postbody">
<br/>
<br/>
That's what I'm been doing. And it works great!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14877 - poslundc - Wed Jan 14, 2004 5:40 am</h4>
    <div class="postbody"><span class="postbody">That's fine for small numbers, but it gets prohibitively slow very fast (that was fun to say). Trust me, a multiply is a LOT cheaper than looping over a subtraction.
<br/>
<br/>
Use DekuTree's method or my posprintf (or even just implement <a class="postlink" href="http://www.cs.uiowa.edu/~jones/bcd/decimal.html" target="_blank">the algorithm it is based on</a> yourself if you'd like) to deal with larger numbers or larger volumes of numbers. Repeated subtraction works and is intuitive, but it is a very naive approach to a problem that is easily solved by only slightly more sophisticated methods.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14924 - tepples - Wed Jan 14, 2004 8:29 pm</h4>
    <div class="postbody"><span class="postbody">Here's a less naive version of repeated subtraction that's admittedly not exactly as fast as multiplication by the reciprocal, but it works up to UINT_MAX even in the absence of 32x32=64 bit multiplies (such as in a self-contained Thumb module). It also adapts readily to 8-bit microcontrollers without hardware multiply such as the 6502 processor used in the NES.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">static const unsigned long utoa_bases[39] =
<br/>
{
<br/>
  4000000000U,
<br/>
  2000000000,
<br/>
  1000000000,  /* 1G */
<br/>
   800000000,
<br/>
   400000000,
<br/>
   200000000,
<br/>
   100000000,  /* 100M */
<br/>
    80000000,
<br/>
    40000000,
<br/>
    20000000,
<br/>
    10000000,  /* 10M */
<br/>
     8000000,
<br/>
     4000000,
<br/>
     2000000,
<br/>
     1000000,  /* 1M */
<br/>
      800000,
<br/>
      400000,
<br/>
      200000,
<br/>
      100000,  /* 100K */
<br/>
       80000,
<br/>
       40000,
<br/>
       20000,
<br/>
       10000,  /* 10K */
<br/>
        8000,
<br/>
        4000,
<br/>
        2000,
<br/>
        1000,  /* 1K */
<br/>
         800,
<br/>
         400,
<br/>
         200,
<br/>
         100,  /* 100 */
<br/>
          80,
<br/>
          40,
<br/>
          20,
<br/>
          10,  /* 10 */
<br/>
           8,
<br/>
           4,
<br/>
           2,
<br/>
           1
<br/>
};
<br/>
<br/>
/* utoa() ******************************
<br/>
   Convert an unsigned integer to an ascii string.
<br/>
*/
<br/>
size_t utoa(char *dst, unsigned long src)
<br/>
{
<br/>
  unsigned int i;
<br/>
  unsigned int pval = 4;
<br/>
  unsigned int digit = 0;
<br/>
  unsigned int len = 0;
<br/>
<br/>
  for(i = 0; i &lt; 39; i++)
<br/>
  {
<br/>
    if(src &gt;= utoa_bases[i])
<br/>
    {
<br/>
      src -= utoa_bases[i];
<br/>
      digit += pval;
<br/>
    }
<br/>
    pval &gt;&gt;= 1;
<br/>
    if(pval == 0)
<br/>
    {
<br/>
      pval = 8;
<br/>
      if(digit || len)
<br/>
        len++;
<br/>
      if(len)
<br/>
        *dst++ = digit + '0';
<br/>
      digit = 0;
<br/>
    }
<br/>
  }
<br/>
  *dst = 0;  /* zero-terminate the string */
<br/>
  return len;
<br/>
}
<br/>
<br/>
size_t stoa(char *dst, signed long src)
<br/>
{
<br/>
  if(src &lt; 0)
<br/>
  {
<br/>
    *dst++ = '-';
<br/>
    return 1 + utoa(dst, -src);
<br/>
  }
<br/>
  else
<br/>
  {
<br/>
    return utoa(dst, src);
<br/>
  }
<br/>
}
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
