<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Code Conversion Fun - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Coding > Code Conversion Fun</h2>
<div id="posts">
<div class="post">
    <h4>#65541 - thegamefreak0134 - Tue Jan 03, 2006 10:15 pm</h4>
    <div class="postbody"><span class="postbody">Hello! I have a small issue here. I have two functions used for converting a certain type of number in a MIDI file to a useable number in C++. (and vice versa, for saving. I was wondering if anyone would be able to convert these from C++ code to Visual Basic code, as I am much more fluent in that language and will be coding my program in it. 
<br/>
<br/>
The reason is that I want my easy s3m editor to also be able to double as a MIDI to s3m and back converter, and do all the things I need it to. If someone can, let me know and I'll find and post the functions. (I would now, but I don't have them with me... sad.) Thanks in Advance. (or thanks in color, for you old schoolers.)<br/>_________________<br/>What if the hokey-pokey really is what it's all about?
<br/>
<br/>
[url=http:/www.darknovagames.com/index.php?action=recruit&amp;clanid=1]Support Zeta on DarkNova![/url]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#65549 - ScottLininger - Tue Jan 03, 2006 10:47 pm</h4>
    <div class="postbody"><span class="postbody">Post away...
<br/>
<br/>
-Scott</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#65605 - NoMis - Wed Jan 04, 2006 9:42 am</h4>
    <div class="postbody"><span class="postbody">Ahhh VB :(
<br/>
<br/>
What part of the conversion is troubling you exactly? Can you provide any sample code that you particulary have problems with?
<br/>
<br/>
Why are you not putting these C++ functions into a DLL? VB can use them with no problem.
<br/>
Or is this not an option?
<br/>
<br/>
Are you using VB or VB.NET?
<br/>
<br/>
NoMis<br/>_________________<br/><span style="font-style: italic"><a class="postlink" href="http://www.gamedev.at/" target="_blank">www.gamedev.at</a></span> - The austrian gamedev site
<br/>
<span style="font-style: italic"><a class="postlink" href="http://hde.gamedev.at/" target="_blank">hde.gamedev.at</a></span> - The Handheld Dev Env plugins for Eclipse</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#65656 - thegamefreak0134 - Wed Jan 04, 2006 8:45 pm</h4>
    <div class="postbody"><span class="postbody">Well... now I'm having issues... I can't seem to find the original functions. Stay tuned though, I should be able to find them sometime this week. I'll hand copy them from the printout if neccessary...<br/>_________________<br/>What if the hokey-pokey really is what it's all about?
<br/>
<br/>
[url=http:/www.darknovagames.com/index.php?action=recruit&amp;clanid=1]Support Zeta on DarkNova![/url]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#66557 - thegamefreak0134 - Wed Jan 11, 2006 10:54 pm</h4>
    <div class="postbody"><span class="postbody">yay! (The filter gave me issues again...) I found the functions. Here they are:
<br/>
<br/>
Function 1:
<br/>
------
<br/>
WriteVarLen (value) 
<br/>
register long value; 
<br/>
{
<br/>
    register long buffer; 
<br/>
    buffer = value &amp; 0x7f; 
<br/>
    while ((value &gt;&gt;= 7) &gt; 0) 
<br/>
    { 
<br/>
        buffer &lt;&lt;= 8; 
<br/>
        buffer |= 0x80; 
<br/>
        buffer += (value &amp; 0x7f); 
<br/>
    } 
<br/>
    while (TRUE) 
<br/>
    { 
<br/>
        putc(buffer,outfile);
<br/>
        if (buffer &amp; 0x80) 
<br/>
            buffer &gt;&gt;= 8; 
<br/>
        else 
<br/>
            break; 
<br/>
        } 
<br/>
    } 
<br/>
<br/>
Function 2
<br/>
-------
<br/>
<br/>
doubleword ReadVarLen () 
<br/>
{ 
<br/>
    register doubleword value; 
<br/>
    register byte c; 
<br/>
<br/>
    if ((value = getc(infile)) &amp; 0x80) 
<br/>
    { 
<br/>
        value &amp;= 0x7f; 
<br/>
        do 
<br/>
        { 
<br/>
            value = (value &lt;&lt; 7) + ((c = getc(infile)) &amp; 0x7f); 
<br/>
        } 
<br/>
        while (c &amp; 0x80); 
<br/>
    }
<br/>
     return (value):
<br/>
}
<br/>
<br/>
End of functions.
<br/>
<br/>
These two functions deal with converting variable length 7-bit numbers to 8-bit numbers. One reads a 7-bit from a file and turns it into an 8-bit variable, and the other takes an 8-bit variable and writes a 7-bit variable length 7-bit number to a file. Both are important, and I would like a version of these for Visual Basic 6.0 if at all possible. Thanks a million if you can help!<br/>_________________<br/>What if the hokey-pokey really is what it's all about?
<br/>
<br/>
[url=http:/www.darknovagames.com/index.php?action=recruit&amp;clanid=1]Support Zeta on DarkNova![/url]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#66572 - strager - Thu Jan 12, 2006 12:55 am</h4>
    <div class="postbody"><span class="postbody">I think I have gotten the first function down.  Here's the messy code.  I can't guarentee that it will work, because my VB skills are... rusting (and they deserve to be!).  I think that the "And" operator uses the bitwise routine like "&amp;" does in C, but I'm not sure.  This may be the reason the code fails, if it does.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
' WriteVarLen(register long value) {
<br/>
Function WriteVarLen(Dim value As Long)
<br/>
    ' register long buffer;
<br/>
    Dim buffer As Long
<br/>
<br/>
    ' buffer = value &amp; 0x7F;
<br/>
    ' I think!
<br/>
    buffer = value And (2 ^ 7 - 1)
<br/>
<br/>
    ' while((value &gt;&gt;= 7) &gt; 0) {
<br/>
    While 1 Do
<br/>
        ' I think!
<br/>
        If value / (2 ^ 7) == 0 Then
<br/>
            break
<br/>
        End If
<br/>
<br/>
        ' buffer &lt;&lt;= 8;
<br/>
        buffer = buffer * (2 ^ 8)
<br/>
<br/>
        ' buffer |= 0x80;
<br/>
        ' I think!
<br/>
        buffer = buffer Or (2 ^ 8)
<br/>
<br/>
        ' buffer += (value &amp; 7F)
<br/>
        ' I think!
<br/>
        buffer = buffer + (value And (2 ^ 7 - 1))
<br/>
    ' }
<br/>
    End While
<br/>
<br/>
    ' while(TRUE) {
<br/>
    While 1 Do
<br/>
        ' Put your own write routine here
<br/>
        ' I think!
<br/>
        PrintChar(myfile, buffer And (2 ^ 8 - 1))
<br/>
<br/>
        ' if(buffer &amp; 0x80) {
<br/>
        ' I think!
<br/>
        If buffer And (2 ^ 7) Then
<br/>
            ' buffer &gt;&gt;= 8;
<br/>
            buffer = buffer / (2 ^ 8)
<br/>
        ' } else {
<br/>
        Else
<br/>
            ' break;
<br/>
            break
<br/>
        ' }
<br/>
        End If
<br/>
    ' }
<br/>
    End While
<br/>
' }
<br/>
End Function
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
You may need to fix a few things, like the while loop structure.  I haven't come across using while loops in VB, ever, because I have no use for them in VB (in "login" screens with the worst security ever, I mean).
<br/>
<br/>
Happy coding,
<br/>
strager</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#66644 - thegamefreak0134 - Thu Jan 12, 2006 5:45 pm</h4>
    <div class="postbody"><span class="postbody">OK. The write functions shouldn't be too hard to add myself. The way they work, you declare a file as open for binary access, and then read onb byte at a time, I believe. The routine simply states something to the effect of:
<br/>
<br/>
Variable = Write routine.
<br/>
<br/>
So what I need to know is what variable needs to contain the single byte I'm pulling from the file. Also, how would I use said function?
<br/>
<br/>
If possible, if someone could translate this into psuedo-code I might be able to make it work. It's mainly that I don't understand the byte level stuff the C++ program is doing, and even if I did I don't know how to do them in VB (or even if it's possible.) Thanks a million so far. I'll try to get this function working!
<br/>
<br/>
-gamefreak
<br/>
<br/>
PS: This is still coming through a filter. Wow...<br/>_________________<br/>What if the hokey-pokey really is what it's all about?
<br/>
<br/>
[url=http:/www.darknovagames.com/index.php?action=recruit&amp;clanid=1]Support Zeta on DarkNova![/url]</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
