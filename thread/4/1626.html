<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>No VBLANK interrupt in mode 5?! - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > No VBLANK interrupt in mode 5?!</h2>
<div id="posts">
<div class="post">
    <h4>#8304 - Lupin - Mon Jul 07, 2003 9:37 pm</h4>
    <div class="postbody"><span class="postbody">I have problems getting the vblank interrupt work in mode5, but maybe it's just my odd interrupt handling wich already caused some other problems...
<br/>
<br/>
Here is the basic interrupt stuff I'm doing:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
typedef void (*interrupt_handler_t)(); 
<br/>
typedef interrupt_handler_t *interrupt_handler_ptr_t; 
<br/>
<br/>
#define REG_IME (*(vu16*)0x4000208)
<br/>
#define REG_IE (*(vu16*)0x4000200) 
<br/>
#define REG_IF (*(vu16*)0x4000202)
<br/>
#define REG_INTERUPT (*((interrupt_handler_ptr_t)0x03007FFC)) 
<br/>
<br/>
void HandleInterrupt() {
<br/>
  switch (REG_IF) {
<br/>
   case INT_VBLANK:
<br/>
    VBLANK();
<br/>
    REG_IF = INT_VBLANK;
<br/>
   case INT_KEYBOARD:
<br/>
    KEYBOARD();
<br/>
    REG_IF = INT_KEYBOARD;
<br/>
  }
<br/>
}
<br/>
<br/>
void EnableInterrupts(u16 interrupts) {
<br/>
  REG_IME = 0; 
<br/>
   
<br/>
  if(interrupts | INT_VBLANK)
<br/>
   REG_DISP_STAT |= 0x8;
<br/>
<br/>
  if(interrupts | INT_HBLANK)
<br/>
   REG_DISP_STAT |= 0x10;
<br/>
<br/>
  if(interrupts | INT_KEYBOARD) 
<br/>
   REG_P1CNT |= BIT14 | BIT0 | BIT1 | BIT2 | BIT3 | BIT4 | BIT5 | BIT6 |  BIT7 | BIT8 | BIT9;
<br/>
<br/>
  REG_IE |= interrupts;
<br/>
  REG_IME = 1;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
In my main() I'm just doing this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
  REG_INTERUPT = HandleInterrupt;
<br/>
  EnableInterrupts(INT_VBLANK);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I'm not doing any interrupt stuff within my crt0.o files, so the problem has to be within the lines I posted above or mode 5 simply doesn't have an VBLANK interrupt (wich would be kinda odd...)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8427 - Darkain - Thu Jul 10, 2003 5:59 am</h4>
    <div class="postbody"><span class="postbody">VBLANK is there is mode5... possibly something else is causing errors?
<br/>
<br/>
one thing i noticed is that you have a switch (REG_IF)... wich is bad, as multiple interupts can fire at the same time.  key input is polled alongside the vblank for its interupt from what ive seen.  (some people have tried to argue this w/ me, but from what ive seen, if both are enabled, they will both always be called at the same time)<br/>_________________<br/>-=- Darkain Dragoon -=-
<br/>
<a class="postlink" href="http://www.darkain.com" target="_blank">http://www.darkain.com</a>
<br/>
<a class="postlink" href="http://ds.darkain.com/hack" target="_blank">DarkStar</a> for <a class="postlink" href="http://ds.darkain.com" target="_blank">Nintendo DS</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8428 - marker - Thu Jul 10, 2003 7:26 am</h4>
    <div class="postbody"><span class="postbody">Isn't there only 160x128 resolution in mode 5? Have you thought about that when you wrote the VBLANK function?
<br/>
<br/>
I'm a newbie, so i really don't know what I'm talking about, but this is certainly a mistake I would make.
<br/>
<br/>
-Marker</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8499 - Lupin - Sat Jul 12, 2003 9:53 am</h4>
    <div class="postbody"><span class="postbody">I shouldn't have used an switch to check REG_IF, that was my problem :(</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
