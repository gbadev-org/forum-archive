<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>staringmonkey's modifications to gba.h - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > staringmonkey's modifications to gba.h</h2>
<div id="posts">
<div class="post">
    <h4>#6148 - Daedro - Sun May 18, 2003 8:31 am</h4>
    <div class="postbody"><span class="postbody">I was just wondering which people prefer and why. The original files by eloist which are:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
///////////////////Bits///////////////////
<br/>
#define BIT0          1
<br/>
#define BIT1          (1&lt;&lt;1)
<br/>
#define BIT2          (1&lt;&lt;2)
<br/>
#define BIT3          (1&lt;&lt;3)
<br/>
#define BIT4          (1&lt;&lt;4)
<br/>
#define BIT5          (1&lt;&lt;5)
<br/>
#define BIT6          (1&lt;&lt;6)
<br/>
#define BIT7          (1&lt;&lt;7)
<br/>
#define BIT8          (1&lt;&lt;8)
<br/>
#define BIT9          (1&lt;&lt;9)
<br/>
#define BIT10          (1&lt;&lt;10)
<br/>
#define BIT11          (1&lt;&lt;11)
<br/>
#define BIT12          (1&lt;&lt;12)
<br/>
#define BIT13          (1&lt;&lt;13)
<br/>
#define BIT14          (1&lt;&lt;14)
<br/>
#define BIT15          (1&lt;&lt;15)
<br/>
<br/>
while the rest is inputed manaully:
<br/>
<br/>
#define KEY_A         1
<br/>
#define KEY_B         2
<br/>
#define KEY_SELECT         4
<br/>
#define KEY_START         8
<br/>
#define KEY_RIGHT         16
<br/>
#define KEY_LEFT         32
<br/>
#define KEY_UP         64
<br/>
#define KEY_DOWN         128
<br/>
#define KEY_R         256
<br/>
#define KEY_L         512
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
as to staringmonkey's changes to referals:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
/////////////////Bits////////////////
<br/>
#define BIT00          1
<br/>
#define BIT01          2
<br/>
#define BIT02          4
<br/>
#define BIT03          8
<br/>
#define BIT04          16
<br/>
#define BIT05          32
<br/>
#define BIT06          64
<br/>
#define BIT07          128
<br/>
#define BIT08          256
<br/>
#define BIT09          512
<br/>
#define BIT10          1024
<br/>
#define BIT11          2048
<br/>
#define BIT12          4096
<br/>
#define BIT13          8192
<br/>
#define BIT14          16384
<br/>
#define BIT15          32768
<br/>
<br/>
while the others call upon:
<br/>
<br/>
#define KEY_A          BIT00
<br/>
#define KEY_B          BIT01
<br/>
#define KEY_SELECT         BIT02
<br/>
#define KEY_START         BIT03
<br/>
#define KEY_RIGHT         BIT04
<br/>
#define KEY_LEFT         BIT05
<br/>
#define KEY_UP          BIT06
<br/>
#define KEY_DOWN         BIT07
<br/>
#define KEY_R         BIT08
<br/>
#define KEY_L          BIT09
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
It seems the changes are useful in recall, but when:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define ROTBG_SIZE_1024x1024           0xC000</td> </tr></table><span class="postbody">
<br/>
<br/>
that, is now this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define ROTBG_SIZE_1024x1024           BIT14 | BIT15</td> </tr></table><span class="postbody">
<br/>
<br/>
I dont know all these bits, and numbers to call yet but I have gotten errors over things like these. I like the recall method, but what happens here and how does bit14 and 15 which are 32768 and 16384 = 0xC000 or is a choice, if so how do I choose?
<br/>
<br/>
Anyway which way do you prefer or use, or do you do your own style.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6157 - SmileyDude - Sun May 18, 2003 3:26 pm</h4>
    <div class="postbody"><span class="postbody">I have my own -- I started with eloist's version, but I quickly expanded it with more macros, and library functions.  Also, eloist had different names for registers than the Cowbite doc, so I changed it to match.
<br/>
<br/>
Personally, I say use what works for you... you don't really care much how the bits are represented in the header file while your working with your game code, so use the header file that has what you need, and add anything that might be missing.<br/>_________________<br/>dennis</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6161 - antysix - Sun May 18, 2003 5:55 pm</h4>
    <div class="postbody"><span class="postbody">I prefer to use the numbers, not the bits because I just like that better.
<br/>
But really, it doesn't matter.<br/>_________________<br/>Currently playing: NGC: Metroid Prime
<br/>
GBA: Golden Sun: The Lost Age
<br/>
<br/>
Currently developping: Project ~ [ Phail ]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6165 - Maddox - Sun May 18, 2003 6:52 pm</h4>
    <div class="postbody"><span class="postbody">Daedro done wrote:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define ROTBG_SIZE_1024x1024           BIT14 | BIT15 
<br/>
</td> </tr></table><span class="postbody">
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
<br/>
You might want to try putting parentheses around your macro bodies.  And it might be helpful for you to purchase and read a good introductory programming book or maybe a computer engineering book so you can understand bits better.  Then you'll get less errors.  (I think all those decimal numbers in those #defines should be hexadecimal.)
<br/>
<br/>
~MADDOX!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6169 - Daedro - Sun May 18, 2003 8:17 pm</h4>
    <div class="postbody"><span class="postbody">Okay, will do, I just need to save up some money. I still need to buy a flash linker. Anyone know any trading communities? I bought Zelda: A Link To The Past, and D&amp;D Eye of The Beholder unknowning that they were converted old games and I cant even play Four Swords.
<br/>
<br/>
One other problem I have is with #include &lt;math.h&gt; and #include &lt;string.h&gt;
<br/>
These are to be included from the compiler right? well I get errors saying they cannot be found. Also I have commands like sprintf, rand, srand, and ads that are first functions and I cant find them anywhere, it must be from the string.h. Anyone know how this can be solved?
<br/>
<br/>
I get these errors from the RPG demo at thepernproject that was made by staringmonkey.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6203 - antysix - Mon May 19, 2003 7:42 pm</h4>
    <div class="postbody"><span class="postbody">I think you should download the newest version of DevKitAdv, if the compiler can't find math.h en string.h
<br/>
<br/>
The rpg demo made by staringmonkey was made for ARM SDT, the compiler most used before DevKitAdv, the differences between the two are not much but I thought ARM SDT uses boot.asm and another name for main()<br/>_________________<br/>Currently playing: NGC: Metroid Prime
<br/>
GBA: Golden Sun: The Lost Age
<br/>
<br/>
Currently developping: Project ~ [ Phail ]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6212 - Drago - Tue May 20, 2003 12:16 am</h4>
    <div class="postbody"><span class="postbody">I think this is a general advice from the GBA community:
<br/>
<span style="font-style: italic">Math.h is totally useless in GBA programming, because is focused on floating point operations. The hardware lacks of floating point unit and all operations are emulated by software, making them a lot slow. Use fixed point instead.</span>
<br/>
About string.h, it has some text processing functions that could be usefull if your program makes intensive use of text. The rest are mainly functions for memory operations, but the best performance is achieved by using DMA and BIOS functions.
<br/>
My personal advice is: avoid using any external library, make your own.
<br/>
<br/>
Anyway, if you are still interested in using the math and string headers (and you are using DKA): try adding the -I option to the gcc command line like this:
<br/>
<br/>
gcc -I &lt;path_to_include_files&gt; ... other options and files
<br/>
<br/>
In my DKA installation the path is /devkitadv/arm-agb-elf/include
<br/>
Probably you will also need to link the math library by adding the -lmath option.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6213 - Daedro - Tue May 20, 2003 12:38 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>antysix wrote:</b></span></td> </tr> <tr> <td class="quote">I think you should download the newest version of DevKitAdv, if the compiler can't find math.h en string.h
<br/>
<br/>
The rpg demo made by staringmonkey was made for ARM SDT, the compiler most used before DevKitAdv, the differences between the two are not much but I thought ARM SDT uses boot.asm and another name for main()</td> </tr></table><span class="postbody">
<br/>
<br/>
Yeah I have the most recent version of DevKitAdv, and I noticed its for ARM.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Math.h is totally useless in GBA programming, because is focused on floating point operations. The hardware lacks of floating point unit and all operations are emulated by software, making them a lot slow. Use fixed point instead. </td> </tr></table><span class="postbody">
<br/>
<br/>
I will do that for my own code. I only have 4 commands that lead from no where, but the problem is that I dont know what they are suppose to define. I cant very well add numbers and things in when I have no clue what it does. If I could see what this command 'abs' and 'sprintd' and 'rand' and 'srand' were suppose to be, maybe I could do that. These were made by staringmonkey in ARM, but he switched to devkitadv, and said he cant remember what they were now as theres too much other coding in his head.
<br/>
<br/>
Should I just define 'srand' as 1 and let it go at it to see what it does? seriously dont know what to do. Antysix, you want to take a crack at it? reply to my emails.
<br/>
<br/>
Side question, if I copy a background to DMA3 lets say, and then I copy another background to DMA3 later does it overwrite that data and erase the old data?:
<br/>
<br/>
Lets say I have LAYER01 on DMA3, then if I press start I now have LAYER02 on DMA3 is that background then erased or are they both on there? It may be in the beginning tutorials, but how do I delete DMA? I will go check, but their are a lot and not a lot tell.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6214 - niltsair - Tue May 20, 2003 12:43 am</h4>
    <div class="postbody"><span class="postbody">DMA's are just a method to quickly transfert a big chunk of valuee from 1 point in memory to another one.
<br/>
<br/>
So, when you use DMA3, you dn't store any value in it, you have to specify get what data(src address) to where(dst address) and how many to copy (and soe other little options). So, unless you specify the same destination address, no, your data don't get overwritten.
<br/>
<br/>
Unless you meant somethign else by DMA.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6215 - Daedro - Tue May 20, 2003 1:03 am</h4>
    <div class="postbody"><span class="postbody">Yes I did mean to same address. Like if I did:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">DMA_Copy(3,(void*)testMap.pal,(void*)BGPaletteMem,256,DMA_16NOW);
<br/>
<br/>
DMA_Copy(3,(void*)testMap.tiledata,(void*)CharBaseBlock(0),testMap.tileDataSize/4,DMA_32NOW);</td> </tr></table><span class="postbody">
<br/>
<br/>
Then I later wanted to use a different palette and tiles and did:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">DMA_Copy(3,(void*)newMap.pal,(void*)BGPaletteMem,256,DMA_16NOW);
<br/>
<br/>
DMA_Copy(3,(void*)newMap.tiledata,(void*)CharBaseBlock(0),newMap.tileDataSize/4,DMA_32NOW);</td> </tr></table><span class="postbody">
<br/>
<br/>
same position just different data.. im sure this would overwrite the old data.
<br/>
<br/>
But I mixed them up, I was wondering if I did this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void BlitBG(u16* bgMap, const u16* data, int dataw, int x, int y)
<br/>
{
<br/>
   int loopx,loopy;
<br/>
   
<br/>
   //x and y are pixle locations...we need tile locations so divide by eight (&gt;&gt;3)   
<br/>
   x = x &gt;&gt; 3;
<br/>
   y = y &gt;&gt; 3;
<br/>
<br/>
   for(loopy = 0; loopy &lt; 32; loopy++) //loop through all 32x32 tiles
<br/>
   {
<br/>
      for(loopx = 0; loopx &lt; 32; loopx++)
<br/>
      {
<br/>
         //this is were the data from our map editor is copied to video memory
<br/>
         bgMap[loopx + loopy * 32] = data[(loopx+x) + (loopy+y) * dataw];
<br/>
   
<br/>
      }
<br/>
<br/>
   }
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
That is the starter script, this is the recall:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">u16* bg0map =(u16*)ScreenBaseBlock(31);
<br/>
<br/>
BlitBG(bg0map,testMap.layers[1].data, testMap.layers[0].w,0,0);</td> </tr></table><span class="postbody">
<br/>
<br/>
now I have a map copied to video memory called bg0map, then I also do another with bg1map... after they are both loaded I press start and no longer need bg0map, how exactly do I delete the video memory block that holds the bg0map data ( wouldn't that make it slower being there when not being showed ) or do I just overwrite it later if I need it? I dont really know what I am talking about, so just ignore my ignorance if you can. I just know there is data being copied, and I might not need it later, how would I delete it. I know this becuase I sometimes dont copy the data and just place the data and as I move the map and then move back the data is gone.. an eraseble map :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6216 - Drago - Tue May 20, 2003 1:20 am</h4>
    <div class="postbody"><span class="postbody">Im not sure if this will help: if you dont need to show the data on bg0 just switch off its corresponding bit on REG_DISPCNT.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6219 - Daedro - Tue May 20, 2003 1:56 am</h4>
    <div class="postbody"><span class="postbody">Okay.. 
<br/>
<br/>
So turn on BG01, and BG02
<br/>
then turn off BG01, leave BG02
<br/>
then replace BG01 and turn on, then turn off BG02
<br/>
<br/>
That works...
<br/>
<br/>
I dont exactly know the code, but knowing I can do that helps. .. BIT09 is BG01 and REG_DISPCNT is 0x4000000... any help? lol
<br/>
<br/>
also, with code from a tutorial I get an error:
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">start.cpp: In function 'void Flip()':
<br/>
start.cpp:60: non-lvalue in assignment
<br/>
start.cpp:65: non-lvalue in assignment</td> </tr></table><span class="postbody">
<br/>
<br/>
I could sware it was an error for 59 and 64 before.. wierd. From code:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">55: void Flip(void)
<br/>
56: {
<br/>
57:    if(REG_DISPCNT &amp; BACKBUFFER)
<br/>
58:    {
<br/>
59:       REG_DISPCNT &amp;= ~BACKBUFFER; 
<br/>
60:       VideoBuffer = BackBuffer; 
<br/>
61:     }
<br/>
62:     else
<br/>
63:     {
<br/>
64:       REG_DISPCNT |= BACKBUFFER; 
<br/>
65:       VideoBuffer = FrontBuffer; 
<br/>
66:    }
<br/>
67: }
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Ignore the numbers as code obviously. This code is used in a tetris game and in a tutorial.. but I get errors.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6221 - niltsair - Tue May 20, 2003 3:04 am</h4>
    <div class="postbody"><span class="postbody">Having the map still loaded waste no resource, you just need to stop displaying it with the Dispaly register and that's it. When you need to display something else, just overwrite it. Deleting it when not need would actually waste Cpu Time.
<br/>
<br/>
For your errors message, pasting the value of the define that are used in the fonction woudl help. So we can see what's wrong with how they're used,</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6224 - Daedro - Tue May 20, 2003 4:13 am</h4>
    <div class="postbody"><span class="postbody">Good to know, thanks.
<br/>
<br/>
The defines:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define VideoBuffer                    ((volatile u16*)0x6000000)
<br/>
#define BackBuffer                   ((volatile u16*)0x600A000)
<br/>
#define REG_DISPCNT       (*(volatile u32*)0x4000000)
<br/>
<br/>
<br/>
from start.cpp:
<br/>
<br/>
u16* FrontBuffer = (u16*)0x6000000;</td> </tr></table><span class="postbody">
<br/>
<br/>
Wonder if it matters that I dont have a BACKBUFFER.. lol. And I notice this "volatile" in front, some gba register have this and some dont.. I am using these. In the file I got this code, the video, back, and front buffer's were in the start.cpp but I already had the back and video in gba.h so I deleted the ones in the start.cpp.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6227 - niltsair - Tue May 20, 2003 4:25 am</h4>
    <div class="postbody"><span class="postbody">Ok, VideoBuffer, BackBuffer and FrontBuffer  are pointers to data, to modify the content, you need to add an '*' in front.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">55: void Flip(void)
<br/>
56: {
<br/>
57:    if(REG_DISPCNT &amp; *BackBuffer)
<br/>
58:    {
<br/>
59:       REG_DISPCNT &amp;= ~*BackBuffer;
<br/>
60:       *VideoBuffer = *BackBuffer;
<br/>
61:     }
<br/>
62:     else
<br/>
63:     {
<br/>
64:       REG_DISPCNT |= *BackBuffer;
<br/>
65:       *VideoBuffer = *FrontBuffer;
<br/>
66:    }
<br/>
67: } </td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6231 - Daedro - Tue May 20, 2003 6:03 am</h4>
    <div class="postbody"><span class="postbody">Very nice, thank you a lot. It works right now, accept for the whole changing 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">if(REG_DISPCNT &amp; BACKBUFFER)</td> </tr></table><span class="postbody">
<br/>
<br/>
to
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">if(REG_DISPCNT &amp; *BackBuffer)</td> </tr></table><span class="postbody">
<br/>
<br/>
I just didnt change it and it works fine, just to let you know it says its a "invalid type argument of 'unary *'"
<br/>
<br/>
Thanks a lot. Now if you could be of if possible any more of help to me, could you check out this topic: <a href="http://forum.gbadev.org/viewtopic.php?t=1253" target="_blank">http://forum.gbadev.org/viewtopic.php?t=1253</a>
<br/>
<br/>
It has to do with typedef struct and how I cannot rename the variables without syntax errors.
<br/>
<br/>
Thanks niltsair, drago, and maddox.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
