<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Need some creative ideas - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > Need some creative ideas</h2>
<div id="posts">
<div class="post">
    <h4>#25783 - ProblemBaby - Sat Aug 28, 2004 2:15 pm</h4>
    <div class="postbody"><span class="postbody">Hi
<br/>
<br/>
Iam woring on a SlaveBoot program that is sended to the slaves and then waiting for the master to send a program the layout is simple I just send a function Word by Word.
<br/>
Ive succeeded to send a function that fills the screen to red.
<br/>
<br/>
My plan is to send until it sees a BX lr command.
<br/>
But Ive no good ideas how to do it more advanced like sending nestled functions and global variables and constant data well
<br/>
my Ideas for know is to if the function calls another function then the address should be saved and when the function is written the program continue to send the next function from that address (and also change the address in the slave so it is correct) but for data it is harder cause I dont know the size of how much to copy!
<br/>
<br/>
Hope you understood!
<br/>
If you have any good ideas! they are welcome!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25787 - tepples - Sat Aug 28, 2004 5:05 pm</h4>
    <div class="postbody"><span class="postbody">The typical procedure that commercial games such as <span style="font-style: italic">Kirby</span> and <span style="font-style: italic">Mario Kart</span> use involves two .mb programs: a booter and the actual client program. The booter draws a splash screen with a progress bar, copies itself to IWRAM (e.g. main.iwram.o), and receives the actual client program from the server over a normal mode broadcast. Then it passes control to the actual client program. The server sends the booter using BIOS MultiBoot and then sends the actual client program using a normal mode broadcast.
<br/>
<br/>
To know how much to copy for each of the client programs, store the size of each program along with the program itself. This is straightforward whether you use b2x, objcopy, or GBFS. Ask if you don't understand.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25790 - ProblemBaby - Sat Aug 28, 2004 5:25 pm</h4>
    <div class="postbody"><span class="postbody">Yeah I understand but I dont want multiple games in my game.
<br/>
For example I want it to play different music depending of which level the master choose and to do that Ive to make a lot of different client programs. I want in somehow use the functions and data I already got in the main ROM to be used by the slave.
<br/>
<br/>
And.. How is the best way to copy something all code to IWRAM
<br/>
all branches have to be changed, right?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25794 - tepples - Sat Aug 28, 2004 6:27 pm</h4>
    <div class="postbody"><span class="postbody">What you want to do is send assets to an existing client program. For that, Mario Kart and friends do something like this: <ul><li>Server tells clients it is about to start a new map. </li><li>Clients switch into normal mode to receive a broadcast. </li><li>Server switches to normal mode and sends the maps, music data, etc. to clients. </li><li>All machines switch back to MP mode and start the map. </li></ul><br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25796 - ProblemBaby - Sat Aug 28, 2004 6:55 pm</h4>
    <div class="postbody"><span class="postbody">Do you know how that is done exactly? is the code already loaded and then the data is placed in special locations. Like the map is always putted in 0x2010000 for example and the music is always putted in 0x2020000</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25799 - sgeos - Sat Aug 28, 2004 7:13 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ProblemBaby wrote:</b></span></td> </tr> <tr> <td class="quote">Do you know how that is done exactly? is the code already loaded and then the data is placed in special locations. Like the map is always putted in 0x2010000 for example and the music is always putted in 0x2020000</td> </tr></table><span class="postbody">
<br/>
<br/>
That is basically how it will work.  You will not care what the actual addresses end up being.  Global or module level arrays sound like the way to do things to me.  You could allocate memory instead.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">map_data_t map[MAX_MAP_SIZE];  // load map data into this
<br/>
music_data_t map[MAX_MUSIC_SIZE];  // load music data into this
<br/>
...</td> </tr></table><span class="postbody">
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25801 - ProblemBaby - Sat Aug 28, 2004 7:51 pm</h4>
    <div class="postbody"><span class="postbody">ok but what about the code?
<br/>
is the code transmitted from the Master during the booting or under the NM-transmission?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25803 - tepples - Sat Aug 28, 2004 8:42 pm</h4>
    <div class="postbody"><span class="postbody">If "the code" is what I think you're thinking of, the program that runs on the multibooted clients during a gameplay session, then that's what I called the "actual client program".<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25806 - ProblemBaby - Sat Aug 28, 2004 9:00 pm</h4>
    <div class="postbody"><span class="postbody">But when I make the client program (the actual game)
<br/>
How do I program the code when it should load graphics and sound??
<br/>
Cause if I understood you correctly that stuff should be transmitted from the master separatly</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25809 - tepples - Sat Aug 28, 2004 10:36 pm</h4>
    <div class="postbody"><span class="postbody">The client program will look like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int main(void)
<br/>
{
<br/>
  init_all();
<br/>
  while(1)
<br/>
  {
<br/>
    int done = 0;
<br/>
    wait_for_master();
<br/>
    sio_normal_mode();
<br/>
    receive_assets();
<br/>
    sio_mp_mode();
<br/>
    init_level();
<br/>
    while(!done)
<br/>
    {
<br/>
      done = game_loop();
<br/>
    }
<br/>
  }
<br/>
}</td> </tr></table><span class="postbody">
<br/>
Or do you want to know the details of how server's send_assets() and clients' receive_assets() work?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25812 - ProblemBaby - Sat Aug 28, 2004 11:24 pm</h4>
    <div class="postbody"><span class="postbody">Yeah I will I dont really understand how everything should be worked out.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25813 - tepples - Sat Aug 28, 2004 11:36 pm</h4>
    <div class="postbody"><span class="postbody">How are you currently including files into your program? Are you using b2x, objcopy, GBFS, or something else?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25814 - ProblemBaby - Sat Aug 28, 2004 11:42 pm</h4>
    <div class="postbody"><span class="postbody">hm if you mean graphics and sound and such stuff I use incbin. I dont know if that is what you call GBFS</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25835 - tepples - Sun Aug 29, 2004 5:49 am</h4>
    <div class="postbody"><span class="postbody">Incbin is close enough explanation-wise to b2x. You'll need to save the size of each file you include. Then for each asset file you want to send to the other machines, you send the size, then the CRC, then the data itself.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25840 - ProblemBaby - Sun Aug 29, 2004 11:47 am</h4>
    <div class="postbody"><span class="postbody">what is CRC?
<br/>
and where should it be placed?
<br/>
for example if I send a map
<br/>
should I ALWAYS put it in the same memory location?
<br/>
so the code always work for the slave or how do you mean?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25843 - Krakken - Sun Aug 29, 2004 1:58 pm</h4>
    <div class="postbody"><span class="postbody">CRC is a nuber that checks the integrity of the data. It can be done in a number of ways, such as taking each byte of the data and adding it to a char variable then you do the same at the other side and see if the numbers match.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
