<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Arm7 pipeline - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Coding > Arm7 pipeline</h2>
<div id="posts">
<div class="post">
    <h4>#44874 - yamaneko - Mon Jun 06, 2005 1:23 pm</h4>
    <div class="postbody"><span class="postbody">Hi
<br/>
<br/>
I would know how use the gba's Arm7 pipeline in c/c++.
<br/>
I juste know it's a 3stage pipeline.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44887 - tepples - Mon Jun 06, 2005 3:12 pm</h4>
    <div class="postbody"><span class="postbody">For one thing, there is no language called "C/C++". There are two separate languages, one called "C", the other called "C++". Which will you be using?
<br/>
<br/>
In addition, you don't have to worry about the pipeline in C or in C++. The compiler and the CPU's instruction decoder handle everything for you.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44895 - SevenString - Mon Jun 06, 2005 5:19 pm</h4>
    <div class="postbody"><span class="postbody"><a href="http://www.amazon.com/exec/obidos/search-handle-url/index=stripbooks:relevance-above&amp;field-keywords=c/c%25252B%25252B&amp;search-type=ss&amp;bq=1&amp;store-name=books/ref=xs_ap_l_xgl14/102-6979120-8707367" target="_blank">http://www.amazon.com/exec/obidos/search-handle-url/index=stripbooks:relevance-above&amp;field-keywords=c/c%25252B%25252B&amp;search-type=ss&amp;bq=1&amp;store-name=books/ref=xs_ap_l_xgl14/102-6979120-8707367</a>
<br/>
<br/>
Referring to "C" and "C++" as "C/C++" is very common, since "C++" is a superset of "C", and not truly a seperate language.
<br/>
<br/>
Also, if you know how a particular compiler works, you can do certain coding tricks to arrange code so that it uses the target processor more efficiently.  For instance, knowing the limitations of the processor's pipeline, along with how registers are used, one could organize an inner loop so that there is minimal stack usage and instruction type conflict, all within "C" or "C++".
<br/>
<br/>
I'm not fully up to speed on ARM7 assembly or what the DevKitArm compiler is doing internally, but I've used these techniques in the past for x86, 680xx, and PPC processor-based game work.
<br/>
<br/>
Of course, I PREFER to use in-line assembly language or seperate ASM code modules for that sort of optimization, but sometimes that isn't an option for later maintainability for other non-asm coders.<br/>_________________<br/><span style="font-style: italic">"Artificial Intelligence is no match for natural stupidity."</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44899 - tum_ - Mon Jun 06, 2005 5:57 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>SevenString wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
For instance, knowing the limitations of the processor's pipeline, along with how registers are used, one could organize an inner loop so that there is minimal stack usage and instruction type conflict, all within "C" or "C++".
<br/>
<br/>
I'm not fully up to speed on ARM7 assembly or what the DevKitArm compiler is doing internally, but I've used these techniques in the past for x86, 680xx, and PPC processor-based game work.
<br/>
<br/>
Of course, I PREFER to use in-line assembly language or seperate ASM code modules for that sort of optimization, but sometimes that isn't an option for later maintainability for other non-asm coders.</td> </tr></table><span class="postbody">
<br/>
<br/>
Not for the ARM7 core. To the best of my knowledge, there are no tricks
<br/>
that can be used to improve the efficiency of the ARM7 pipeline.
<br/>
Due to its relative simplicity, it does not "suffer" from instructions' dependancies &amp; various interlocks that you might want to consider when
<br/>
working with architectures like x86...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44911 - SevenString - Mon Jun 06, 2005 6:46 pm</h4>
    <div class="postbody"><span class="postbody">That's a cool thing, then.  I might actually ENJOY doing the occasional bit of assembly language.  There's certainly no shortage of general purpose registers compared to some other architectures.  :D<br/>_________________<br/><span style="font-style: italic">"Artificial Intelligence is no match for natural stupidity."</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44912 - poslundc - Mon Jun 06, 2005 6:49 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tum_ wrote:</b></span></td> </tr> <tr> <td class="quote">Not for the ARM7 core. To the best of my knowledge, there are no tricks
<br/>
that can be used to improve the efficiency of the ARM7 pipeline.</td> </tr></table><span class="postbody">
<br/>
<br/>
Branches flush the pipeline.
<br/>
<br/>
Fewer branches = better performance. Especially in memory areas that have different waitstates for sequential and random accesses, such as ROM.
<br/>
<br/>
In high-level languages such as C and C++, these optimizations can be achieved to some extent by avoiding unnecessary conditionals, unrolling loops, using switch statements or function tables where appropriate, inlining functions, etc. Many of these optimizations can also be done by the compiler automatically with optimization settings enabled - to some degree.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44916 - SevenString - Mon Jun 06, 2005 6:56 pm</h4>
    <div class="postbody"><span class="postbody">so i'm not crazy, then!  yay!
<br/>
<br/>
thanks, dan.<br/>_________________<br/><span style="font-style: italic">"Artificial Intelligence is no match for natural stupidity."</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44925 - Ultima2876 - Mon Jun 06, 2005 9:19 pm</h4>
    <div class="postbody"><span class="postbody">Unnecessary conditionals? You mean if statements? x.x</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44933 - poslundc - Mon Jun 06, 2005 9:49 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ultima2876 wrote:</b></span></td> </tr> <tr> <td class="quote">Unnecessary conditionals? You mean if statements? x.x</td> </tr></table><span class="postbody">
<br/>
<br/>
For the most part, yes. For example,
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int     spriteIndex = SPRITE_BASE;
<br/>
<br/>
if (isDisabled)
<br/>
{
<br/>
     spriteIndex += DISABLED_OFFSET;
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
... may be equivalently coded by...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int     spriteIndex = SPRITE_BASE + isDisabled * DISABLED_OFFSET;</td> </tr></table><span class="postbody">
<br/>
<br/>
The second version may compile to more efficient code than the first version. Which is not to say the second version is necessarily better or even faster all of the time; only that it optimizes for the ARM7 pipeline behaviour.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#45051 - tum_ - Tue Jun 07, 2005 10:09 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<br/>
Branches flush the pipeline.
<br/>
<br/>
Fewer branches = better performance. Especially in memory areas that have different waitstates for sequential and random accesses, such as ROM.
<br/>
<br/>
Dan.</td> </tr></table><span class="postbody">
<br/>
<br/>
Absolutely agree. I just don't refer to this as "a trick" ;-) When you estimate the execution time using the datasheet - the pipeline refill is already included into B,BL instruction timings (2S + 1N).
<br/>
<br/>
To SevenString: If you enjoy assembly you WILL enjoy ARM asm. And it's not just the register space but a number of other nice features, especially conditional instructions and "built-in" shifts.
<br/>
I've been into Z80 assembly for several years - now I really enjoy ARM ("unfortunately" ;-), assembly is rarely actually needed for ARM as it's fast enough for most tasks).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#45078 - yamaneko - Tue Jun 07, 2005 3:26 pm</h4>
    <div class="postbody"><span class="postbody">Ok men.
<br/>
<br/>
If i understand  well , i have juste to erase some branche.
<br/>
My compilateur is very bad. It unroll my code with stupid branche.
<br/>
<br/>
So,thank you every one.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#45178 - tum_ - Wed Jun 08, 2005 9:08 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yamaneko wrote:</b></span></td> </tr> <tr> <td class="quote">Ok men.
<br/>
<br/>
If i understand  well , i have juste to erase some branche.
<br/>
My compilateur is very bad. It unroll my code with stupid branche.
<br/>
<br/>
So,thank you every one.</td> </tr></table><span class="postbody">
<br/>
<br/>
Which compiler is this? Maybe it's not as bad as you think.
<br/>
You might want to look at the compiler options as well.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#45199 - yamaneko - Wed Jun 08, 2005 3:22 pm</h4>
    <div class="postbody"><span class="postbody">DevKitAdv with gcc 3.0.3 i cant use higter cause of mi .mak
<br/>
I use all option (-funroll)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#45229 - wintermute - Wed Jun 08, 2005 8:50 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yamaneko wrote:</b></span></td> </tr> <tr> <td class="quote">DevKitAdv with gcc 3.0.3 i cant use higter cause of mi .mak
<br/>
I use all option (-funroll)</td> </tr></table><span class="postbody">
<br/>
<br/>
what do you mean you can't use higher because of your .mak?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#45304 - yamaneko - Thu Jun 09, 2005 1:45 pm</h4>
    <div class="postbody"><span class="postbody">In my file i use for make (.mak). There is bad line for the other gcc version like "-lgcc" and i dont know how change it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#45309 - strager - Thu Jun 09, 2005 3:05 pm</h4>
    <div class="postbody"><span class="postbody">You need to change your library path when you do that.  -lxxx means "include the library 'libxxx.lib/libxxx.a'."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#45311 - yamaneko - Thu Jun 09, 2005 3:33 pm</h4>
    <div class="postbody"><span class="postbody">But i dont where is the ew path in new devkitadv.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#45315 - strager - Thu Jun 09, 2005 3:56 pm</h4>
    <div class="postbody"><span class="postbody">Use <a class="postlink" href="http://www.devkitpro.tk" target="_blank">devkitARM</a>.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#45316 - yamaneko - Thu Jun 09, 2005 3:57 pm</h4>
    <div class="postbody"><span class="postbody">Sorry,i repeat:
<br/>
<br/>
I dont know where is the new path in new devkitadv</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#45317 - yamaneko - Thu Jun 09, 2005 4:01 pm</h4>
    <div class="postbody"><span class="postbody">But i dont know the new path in DevKitARM too.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
