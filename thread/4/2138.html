<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>fopen not working - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > fopen not working</h2>
<div id="posts">
<div class="post">
    <h4>#11099 - GBACoder - Fri Sep 26, 2003 1:44 am</h4>
    <div class="postbody"><span class="postbody">fopen returns a null FILE* when I try to use in it main(). Has anybody else
<br/>
used it with success? Any suggestions? Thanks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11102 - tepples - Fri Sep 26, 2003 2:04 am</h4>
    <div class="postbody"><span class="postbody">The GBA itself does not have a filesystem unless you implement your own.  What are you trying to fopen()?  Please post a code sample.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11108 - GBACoder - Fri Sep 26, 2003 2:38 am</h4>
    <div class="postbody"><span class="postbody">I am trying to open a text file for reading dialogue in an rpg. 
<br/>
<br/>
FILE* f = fopen(file, "rt");
<br/>
<br/>
If not using fopen to do this then how would you go about reading dialogue, like as is done in Sphere (using JScript). Any ideas?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11109 - tepples - Fri Sep 26, 2003 2:48 am</h4>
    <div class="postbody"><span class="postbody">A GBA doesn't have access to any files other than the running .gba file. To include files containing scripts, maps, graphics, sounds, music sequences, etc. in your program, you can link the text files into your executable image by using some sort of bin2o tool, or you can use my <a class="postlink" href="http://www.pineight.com/gba/#gbfs" target="_blank">GBFS</a> system to append them in a structure resembling a tar file.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11110 - GBACoder - Fri Sep 26, 2003 3:31 am</h4>
    <div class="postbody"><span class="postbody">I downloaded your gbfs and I'll try using that. 
<br/>
<br/>
Thanks for the help.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12604 - sgeos - Wed Nov 19, 2003 8:31 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>GBACoder wrote:</b></span></td> </tr> <tr> <td class="quote">I am trying to open a text file for reading dialogue in an rpg. 
<br/>
<br/>
FILE* f = fopen(file, "rt");
<br/>
<br/>
If not using fopen to do this then how would you go about reading dialogue, like as is done in Sphere (using JScript). Any ideas?</td> </tr></table><span class="postbody">
<br/>
<br/>
As tepples noted, the GBA does not have a file system.  That means that all resources need to be compiled into the ROM.  I'll pretend gbfs does not exist and explain the coding solution I'd use.  I create a dialogue.c file, and put a function for each dialogue in it.  The functions would look something like this:
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">/*** dia0
<br/>
 *
<br/>
 *  A very basic function.
<br/>
 */
<br/>
void dia0(void)
<br/>
{
<br/>
   char s[] = "Only you can prevent forest fires.";
<br/>
<br/>
   display_text(s);
<br/>
}
<br/>
<br/>
/*** dia1
<br/>
 *
<br/>
 *  Takes game state into account.
<br/>
 */
<br/>
void dia1(void)
<br/>
{
<br/>
   char s[] = "You have 99999 GP?!";
<br/>
<br/>
   sprintf(s, "You have %d GP?!", get_player_gp());
<br/>
   display_text(s);
<br/>
}
<br/>
<br/>
/*** dia2
<br/>
 *
<br/>
 * The buffer needs to be large enoough to display any of these messages...
<br/>
 * so the longest message will be in the buffer by default.
<br/>
 * These are the message that can be displayed:
<br/>
 *
<br/>
 * "...\f" "Go kill some monsters!"
<br/>
 * "So far, you have killed 999 monsters."
<br/>
 * "...\f" "I lost count!"
<br/>
 */
<br/>
void dia2(void)
<br/>
{
<br/>
   char s[] = "So far, you have killed 999 monsters.";
<br/>
   int n;
<br/>
<br/>
   n = get_number_of_killed_monsters();
<br/>
   if (n &lt; 1)
<br/>
      sprintf(s, "...\f" "Go kill some monsters!");
<br/>
   else if (n &lt; 1000)
<br/>
      sprintf(s, "So far, you have killed %d monsters.", n);
<br/>
   else  /* n &gt; 999 */
<br/>
      sprintf(s, ""...\f" "I lost count!"");
<br/>
   display_text(s);
<br/>
}
<br/>
<br/>
/*** dia3
<br/>
 *
<br/>
 *  Using functions allows much freedom.
<br/>
 *  For example, this function randomly displays another message.
<br/>
 */
<br/>
void dia3(void)
<br/>
{
<br/>
   void (*fp[])(void) = {dia0, dia1, dia2};  /* array of function pointers */
<br/>
   int n;
<br/>
<br/>
   n = get_a_random_number_between_and_including(0, 2);
<br/>
<br/>
   /* No need to call display_text() here.  The function called via the pointer will do that.*/
<br/>
   fp[n]();
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
Every villager wants to have a function pointer to a message.  Now, I have a question.  Should I be declaring my buffers like this if I am going to sprintf into them?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">char s[sizeof("Really...\nthis is...\n my longest message.")];</td> </tr></table><span class="postbody">
<br/>
<br/>
I would divide that by sizeof(char), but if I recall correctly, sizeof(char) is always one.  The goal is to avoid initializing the buffer when I don't need to.  As far as speed goes, would strcpy be faster than printf when the game state does not need to be taken into account?
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12608 - tepples - Wed Nov 19, 2003 1:56 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sgeos wrote:</b></span></td> </tr> <tr> <td class="quote">As far as speed goes, would strcpy be faster than printf when the game state does not need to be taken into account?
<br/>
<br/>
-Brendan</td> </tr></table><span class="postbody">
<br/>
You should usually be using siprintf(), which does not handle floating-point formats and does not bring in the floating-point library, instead of sprintf(), which does handle floating-point formats and does bring in the floating-point library. You're right about strncpy(), which is faster than siprintf(), which is slightly faster and much smaller than sprintf().<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12609 - poslundc - Wed Nov 19, 2003 4:25 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">You should usually be using siprintf(), which does not handle floating-point formats and does not bring in the floating-point library, instead of sprintf(), which does handle floating-point formats and does bring in the floating-point library. You're right about strncpy(), which is faster than siprintf(), which is slightly faster and much smaller than sprintf().</td> </tr></table><span class="postbody">
<br/>
<br/>
This seems like the perfect opportunity to plug my new sprintf() variant, posprintf(). It's similar to siprintf() but with a little less functionality and targetted more at GBA development. It's also coded entirely in Thumb assembler, and should be faster than most general library functions overall.
<br/>
<br/>
<a class="postlink" href="http://www.danposluns.com/gbadev/posprintf/" target="_blank">http://www.danposluns.com/gbadev/posprintf/</a>
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
