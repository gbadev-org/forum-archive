<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>sram as .. ram on gba - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > sram as .. ram on gba</h2>
<div id="posts">
<div class="post">
    <h4>#135242 - Ant6n - Sat Jul 21, 2007 9:22 am</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
is it a bad idea to use the 8bit bus sram as normal memory on gba?
<br/>
I am running out of memory (the 16+256KB), and i really need byte writes and reads. Also it seems sram can be overclocked to run at 2 waitstates, which should make it faster than external ram.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135243 - Dwedit - Sat Jul 21, 2007 9:33 am</h4>
    <div class="postbody"><span class="postbody">I'd say use up your VRAM before you start digging into SRAM.
<br/>
If you are writing your code for a flash cartridge, know that some flash software does not bankswitch the second 32k of SRAM properly, making high SRAM writes step on other toes.
<br/>
If you are making a multiboot program with your code in EWRAM, you can even place your code into VRAM instead, and it will run faster, but then you are forced to use long jumps if you want to call code in a different memory area.
<br/>
<br/>
In the meantime, here is some asm code to do an 8-bit write to 16-bit memory (taken from the <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=13634" target="_blank">'read modify write' thread</a>):
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cearn wrote:</b></span></td> </tr> <tr> <td class="quote">Here's one for 7 instructions, without masking. 
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">@ void byte_write(void *ptr, u8 value)
<br/>
byte_write:
<br/>
    eor     r2, r0, #1
<br/>
    ldrb    r3, [r2]            @ Read the *other* byte
<br/>
    ands    r2, r0, #1          @ Test and prep for alignment
<br/>
    orreq   r3, r1, r3, lsl #8  @ Even: src-byte needs shift
<br/>
    orrne   r3, r3, r1, lsl #8  @ Odd: value needs shift
<br/>
    strh    r3, [r0,-r2]        @ Align and write
<br/>
    bx      lr
<br/>
</td> </tr></table><span class="postbody">
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
I'd suggest against overclocking the SRAM, as overclocking is too unpredictable as to whether it will work or not.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135296 - Ant6n - Sat Jul 21, 2007 11:49 pm</h4>
    <div class="postbody"><span class="postbody">Well, I think i am pretty much out of iwram,vram,ewram; and my 8bit writes shouldn't trash the flags.
<br/>
So you say 32k of sram is safe to use; 64k is probably safe to use usually (and checking whether its overlapping is probably easy). even without overclocking i still get 'only' 5 waitstates.
<br/>
I was just more concerned that reading/writing a lot to the sram, like 300K/s. I.e. whether it wears the ram out or something.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135320 - Miked0801 - Sun Jul 22, 2007 6:58 am</h4>
    <div class="postbody"><span class="postbody">If you are also saving info in the sram anywhere, then sram is not safe to use as normal RAM.  When you turn off the GBA, random writes to memory occur and these can (and do) wipe out random parts of SRAM if you are allowing access.  I got burned by this in GBC land :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135403 - Ant6n - Mon Jul 23, 2007 4:06 am</h4>
    <div class="postbody"><span class="postbody">i dont understand. wouldnt normal ram be wiped out anyway?
<br/>
btw, i think i might have figured out a way to do 8bit writes (only) to flash ram; simply by multiplying every address by two. I think I read somewhere 8bit writes get doubled...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#135466 - Miked0801 - Mon Jul 23, 2007 6:54 pm</h4>
    <div class="postbody"><span class="postbody">Yes, normal RAM would.  But if you are using SRAM for save data (which is what it is traditionally used for) then it will be wiped randomly as well.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
