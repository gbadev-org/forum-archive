<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>va_list va_start - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Coding > va_list va_start</h2>
<div id="posts">
<div class="post">
    <h4>#12290 - oX - Thu Nov 06, 2003 10:20 pm</h4>
    <div class="postbody"><span class="postbody">Hi everybody, i'm newbie in gba programming so please don't be too hard with me ;)
<br/>
<br/>
I've a problem with this code :
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void FONT::DisplayGenString(const char * format, ...)
<br/>
{
<br/>
va_list par; 
<br/>
va_start(par,format); 
<br/>
char temp[1024]; 
<br/>
vsprintf(temp,format,par); 
<br/>
va_end(par);
<br/>
DisplayString((char*)&amp;temp, (u8)0, 16);
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
It compiles but doesn't link and i've these errors :
<br/>
C:\GBA\devkitadv\arm-agb-elf\lib\interwork/libc.a(vfprintf.o): In function `_vfprintf_r':
<br/>
../../../../../../gcc-3.0.2/newlib/libc/stdio/vfprintf.c:847: undefined reference to `__eqdf2'
<br/>
../../../../../../gcc-3.0.2/newlib/libc/stdio/vfprintf.c:877: undefined reference to `__nedf2'
<br/>
etc...
<br/>
<br/>
Any ideas why it doesn't link ??
<br/>
<br/>
I'm using classic makefile by Benjamin D. Hale
<br/>
crt0.s and LinkScript of Jeff Frohwein
<br/>
<br/>
Thanks a lot for any help !!
<br/>
oX</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12297 - tepples - Fri Nov 07, 2003 12:42 am</h4>
    <div class="postbody"><span class="postbody">For one thing, you're supposed to use vsiprintf(), a Newlib extension which is identical to vsprintf() except that it does not handle floating-point numbers and thus does not bring in the software floating-point library, instead of vsprintf(), which does bring in the software floating-point library.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12298 - yaustar - Fri Nov 07, 2003 1:06 am</h4>
    <div class="postbody"><span class="postbody">Excuse my ignorance but what is the code / functions for?
<br/>
<br/>
From what I can see, it looks like it displays text to the screen..<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12306 - oX - Fri Nov 07, 2003 12:08 pm</h4>
    <div class="postbody"><span class="postbody">yes indeed
<br/>
<br/>
in fact i can already display font
<br/>
so i would compute a string than i could send to the display
<br/>
isn't it possible ??
<br/>
<br/>
tks
<br/>
oX</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12307 - tepples - Fri Nov 07, 2003 5:24 pm</h4>
    <div class="postbody"><span class="postbody">Have you tried replacing vsprintf() with vsiprintf() yet?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12311 - oX - Fri Nov 07, 2003 9:02 pm</h4>
    <div class="postbody"><span class="postbody">yep i've just tried this but it doesn't compile  :
<br/>
vsiprintf' undeclared (first use this function)
<br/>
i've searched this string in all files of my gba directory and i've found nothing !!!!
<br/>
<br/>
with vsprintf it doesn't link...
<br/>
<br/>
i don't understand..</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12318 - tepples - Fri Nov 07, 2003 11:37 pm</h4>
    <div class="postbody"><span class="postbody">You indeed have found a bug in newlib, whose stdio.h contains integer versions only of printf, fprintf, sprintf, and vfprintf, but no va_list form of sprintf. Care to report this bug to Red Hat?
<br/>
<br/>
To work around this bug, write your own vsiprintf by downloading the newlib source code, looking at vsprintf.c, and replacing each call to vfprintf with a call to vfiprintf.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12349 - oX - Sat Nov 08, 2003 4:38 pm</h4>
    <div class="postbody"><span class="postbody">in libiberty/vsprintf.c i've this code for vsprintf :
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
int
<br/>
vsprintf (buf, format, ap)
<br/>
     char *buf;
<br/>
     const char *format;
<br/>
     va_list ap;
<br/>
{
<br/>
  FILE b;
<br/>
  int ret;
<br/>
#ifdef VMS
<br/>
  b-&gt;_flag = _IOWRT|_IOSTRG;
<br/>
  b-&gt;_ptr = buf;
<br/>
  b-&gt;_cnt = 12000;
<br/>
#else
<br/>
  b._flag = _IOWRT|_IOSTRG;
<br/>
  b._ptr = buf;
<br/>
  b._cnt = 12000;
<br/>
#endif
<br/>
  ret = _doprnt(format, ap, &amp;b);
<br/>
  putc('\0', &amp;b);
<br/>
  return ret;
<br/>
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
no call to vfprintf !!
<br/>
<br/>
so i  suppose i don't have the good version of vsprintf !?
<br/>
where could i found this ?
<br/>
or  could someone post it here ?
<br/>
<br/>
tks a lot
<br/>
oX</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12351 - tepples - Sat Nov 08, 2003 6:26 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>oX wrote:</b></span></td> </tr> <tr> <td class="quote">in libiberty/vsprintf.c i've this code for vsprintf :
<br/>
[snip]
<br/>
no call to vfprintf !!
<br/>
<br/>
so i  suppose i don't have the good version of vsprintf !?</td> </tr></table><span class="postbody">
<br/>
I said Red Hat Newlib (i.e. GCC's C library), not GNU Libiberty. I mentioned that the iprintf family is a Newlib extension. You can download the latest Newlib source code <a class="postlink" href="ftp://sources.redhat.com/pub/newlib/index.html" target="_blank">here</a>.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
