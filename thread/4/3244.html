<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Sprite won't show - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Coding > Sprite won't show</h2>
<div id="posts">
<div class="post">
    <h4>#19317 - CyberSlag5k - Sat Apr 17, 2004 4:55 am</h4>
    <div class="postbody"><span class="postbody">I'm just starting to develop for the GBA but am having a bit of a problem. I cannot seem to get my sprite to show up on the screen. Relavent code is as follows:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
u16* videoBuffeer = ((u16*)0x6000000);
<br/>
u16* paletteMem = ((u16*)0x5000000);
<br/>
u16* OAM = ((u16*)0x7000000);
<br/>
<br/>
OAMEntry sprites[128];
<br/>
pRotData rotData = (pRotData)sprites;
<br/>
<br/>
void copyOAM()
<br/>
{
<br/>
   u16* temp;
<br/>
   temp = (u16*)sprites;
<br/>
   for(u16 i = 0; i &lt; 128*4; i++)
<br/>
      OAM[i] = temp[i];
<br/>
}
<br/>
<br/>
void initializeSprites()
<br/>
{
<br/>
   for(u16 i = 0; i &lt; 128; i++)
<br/>
   {
<br/>
      sprites[i].attribute0 = 160;
<br/>
      sprites[i].attribute1 = 240;
<br/>
   }
<br/>
    
<br/>
}
<br/>
<br/>
void VSync()
<br/>
{
<br/>
   while((volatile u16)REG_VCOUNT != 160)
<br/>
   {
<br/>
   }
<br/>
}
<br/>
<br/>
<br/>
void plotPixel(int x, int y, unsigned short int c)
<br/>
{
<br/>
   videoBuffeer[(y) * 120 + (x)] = (c);
<br/>
}
<br/>
<br/>
void setMode(u16 mode)
<br/>
{
<br/>
   REG_DISPCNT = mode;
<br/>
}
<br/>
<br/>
int main()
<br/>
{
<br/>
<br/>
<br/>
   s16 x = 100, y = 60;
<br/>
<br/>
   setMode(MODE_1 | OBJ_ENABLE | OBJ_MAP_1D);
<br/>
<br/>
   for(int i = 0; i &lt; 256; i++)
<br/>
      OBJPaletteMem[i] = mySpritePalette[i];
<br/>
<br/>
   initializeSprites();
<br/>
<br/>
   sprites[0].attribute0 = COLOR_256 | SQUARE | x;
<br/>
   sprites[0].attribute1 = SIZE_64 | y;
<br/>
   sprites[0].attribute2 = 0;
<br/>
<br/>
<br/>
   setMode(MODE_4 | BG2_ENABLE);
<br/>
   
<br/>
   for(int i = 0; i &lt; 128; i++)
<br/>
      OAMdata[i] = mySpriteData[i];
<br/>
<br/>
   for(int i = 0; i &lt; 256; i++)
<br/>
      paletteMem[i] = FFPalette[i];
<br/>
<br/>
   for(int i = 0; i &lt; 120; i++)
<br/>
      for(int j = 0; j &lt; 160; j++)
<br/>
         plotPixel(i, j, FFData[j * 120 + i]);
<br/>
<br/>
   while(1)
<br/>
   {
<br/>
      VSync();
<br/>
      copyOAM();
<br/>
        
<br/>
   }
<br/>
<br/>
<br/>
<br/>
<br/>
   return 0;
<br/>
}
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
The background image shows, but no sprite. Interestingly enough, if I move the mode 4 stuff (the background image) to the beginning of main, the background image appears for 1 second and then the screen goes white. Is it possible that my sprite <span style="font-style: italic">is</span> being displayed but is for some reason taking up the whole screen (and is white)?
<br/>
<br/>
Any help would be appreacited.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19319 - sajiimori - Sat Apr 17, 2004 5:36 am</h4>
    <div class="postbody"><span class="postbody">You are setting the mode twice, and the second time you are not enabling sprites or setting 1D mapping.  Also, mode 4 takes up half the sprite character RAM.  You have to start at the 512th character.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19321 - CyberSlag5k - Sat Apr 17, 2004 6:03 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">You are setting the mode twice, and the second time you are not enabling sprites or setting 1D mapping.  Also, mode 4 takes up half the sprite character RAM.  You have to start at the 512th character.</td> </tr></table><span class="postbody">
<br/>
<br/>
Is using 2 different modes bad? The sprite didn't display even if I remove all the background image stuff. The screen is just all black. And I am not sure what you mean by starting at the 512th character or how I would do it. Would you mind elaborating?
<br/>
<br/>
Thank you.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19322 - sajiimori - Sat Apr 17, 2004 6:15 am</h4>
    <div class="postbody"><span class="postbody">I think you're going to have to read up more about GBA.  Visit the Pern tutorials, then the GBATek and Cowbite documents.  These sources all illustrate the layout of sprite RAM.
<br/>
<br/>
There's nothing wrong with using 2 different modes at different times, but you are apparently switching modes for no particular reason, and you are expecting the old settings to still apply.  They don't.  As such, the OBJ_ENABLE and OBJ_MAP_1D flags are no longer set after your second setMode() call.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19323 - CyberSlag5k - Sat Apr 17, 2004 6:23 am</h4>
    <div class="postbody"><span class="postbody">Alright. Thank you.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
