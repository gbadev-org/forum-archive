<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>HAM + EMapper2 Advance - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Coding > HAM + EMapper2 Advance</h2>
<div id="posts">
<div class="post">
    <h4>#4653 - Burre - Sun Apr 06, 2003 12:06 pm</h4>
    <div class="postbody"><span class="postbody">Hi there...
<br/>
<br/>
I recently bought EMapper2 Advance to solve my mapping issues, but I can't seem to get them to work properly with each other. The E2A (Emapper2 Advance) is a licenced version and HAM isn't.
<br/>
<br/>
I've successfully built an map, based on an imported BMP tileset and manage to export both to C-code. I have then included the header files in my project and also included the C-files (containing map and tiles) into the compiler chain. So far so good. But when I run my code (using VBA), the tileset looks scrambled. I think that the map loads up fine, but the tilset looks scrambled (both by looking at the game and looking in the tile-viewer included in VBA). The pallette is fine, but is seems that HAM loads the tileset with wrong offset or something. I've noticed that gfx2gba exports to an array of 'const unsigned char' while E2A exports to 'const unsigned short', would that make any difference? Exporting the tilset with gfx2gba doesn't work either.
<br/>
<br/>
The code I use for loading maps and tiles are as follows:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
ham_LoadBGPal((void*)bgmaster_Palette,256); // Background palette
<br/>
ham_bg[0].ti = ham_InitTileSet((void*)&amp;tiles0,SIZEOF_16BIT(&amp;tiles0),1,1); // Load tileset
<br/>
ham_bg[0].mi = ham_InitMapEmptySet(3,0); // Make room for the map
<br/>
bg_game_ptr = ham_InitMapFragment((void*)&amp;map0,40,30,0,0,32,22,0); // Load the map fragment
<br/>
ham_InsertMapFragment(bg_game_ptr,0,0,0); // Put fragment on BG
<br/>
ham_InitBg(0,1,0,0);   // Display the background
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I think that is about all code I use for loading and displaying my map (if I haven't forgotten any). I use C++ (wich would explain all explicit typeconversions).
<br/>
<br/>
Any ideas why it won't work? I bet it's a simple nut to crack but I'm out of ideas and one can get quite blind reading it's own code over and over...
<br/>
<br/>
Any and all help appreciated! :)<br/>_________________<br/>"The best optimizer is between your ears..."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4655 - Saj - Sun Apr 06, 2003 1:39 pm</h4>
    <div class="postbody"><span class="postbody">Hi Burre, 
<br/>
<br/>
Have you tried saving the file as a BMP in Emapper and then converting it using gfx2gba? the purpose of this would be to see if you get the same output. Then you'd know for sure that this is a HAM issue.
<br/>
<br/>
Also Check out : <a class="postlink" href="http://www.aaronrogers.com/ham/Day6/day6.php" target="_blank">http://www.aaronrogers.com/ham/Day6/day6.php</a>
<br/>
<br/>
Also I sent you a pm regarding something else. pm me when you've checked it.<br/>_________________<br/>---------------------------------------------------
<br/>
<a class="postlink" href="http://www.theanimalrescuesite.com/cgi-bin/WebObjects/CTDSites.woa" target="_blank">Click here to give free food to starving animals.</a>
<br/>
--------------------------------------------------</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4656 - niltsair - Sun Apr 06, 2003 1:42 pm</h4>
    <div class="postbody"><span class="postbody">I never used Ham, making it hard for me to tell, but one thing you should check is:
<br/>
-Are you loading your tiles in Bank 0 while also loading your maps in Screen Data 0? 
<br/>
If you do, this means that <span style="font-weight: bold">32x(NumberofMap Loaded)</span> worth of tiles are overwritten with junk data, since they both share the same memory.
<br/>
<br/>
A common use is to load your tiles at Bank 0, Tile 0 and up and load your maps from Screen Map 31 and down. So for each Map put in memory, you lose 32 tiles toward the end of memory.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4707 - tutifruti - Mon Apr 07, 2003 1:03 pm</h4>
    <div class="postbody"><span class="postbody">Hi!
<br/>
<br/>
Try with something like this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
    ham_Init();
<br/>
    ham_SetBgMode(0);
<br/>
<br/>
    ham_LoadBGPal((void *)tilesPal,256);
<br/>
    ham_bg[0].ti=ham_InitTileEmptySet(480,1,1);
<br/>
    ham_bg[0].mi=ham_InitMapEmptySet(0,0);
<br/>
    
<br/>
      TOOL_DMA3_SET(tiles0,MEM_BG_PTR,tilesCount0*32,DMA_TRANSFER_16BIT,DMA_STARTAT_NOW)
<br/>
<br/>
    map_fragment=ham_InitMapFragment((void*)map0,mapWidth0,mapHeight0,0,0,32,22,0);
<br/>
    ham_InsertMapFragment(map_fragment,0,0,0);
<br/>
    ham_InitBg(0,1,0,0);
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4709 - Burre - Mon Apr 07, 2003 4:41 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tutifruti wrote:</b></span></td> </tr> <tr> <td class="quote">Hi!
<br/>
<br/>
Try with something like this:
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
    ham_Init();
<br/>
    ham_SetBgMode(0);
<br/>
<br/>
    ham_LoadBGPal((void *)tilesPal,256);
<br/>
    ham_bg[0].ti=ham_InitTileEmptySet(480,1,1);
<br/>
    ham_bg[0].mi=ham_InitMapEmptySet(0,0);
<br/>
    
<br/>
      TOOL_DMA3_SET(tiles0,MEM_BG_PTR,tilesCount0*32,DMA_TRANSFER_16BIT,DMA_STARTAT_NOW)
<br/>
<br/>
    map_fragment=ham_InitMapFragment((void*)map0,mapWidth0,mapHeight0,0,0,32,22,0);
<br/>
    ham_InsertMapFragment(map_fragment,0,0,0);
<br/>
    ham_InitBg(0,1,0,0);
<br/>
</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
<br/>
WOW! That finally did it! Thanks a bundle!
<br/>
<br/>
Now for the runner up question, what went wrong in the first place? I can't recall that I ever needed to manually DMA my tiledata before.<br/>_________________<br/>"The best optimizer is between your ears..."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4848 - tutifruti - Sat Apr 12, 2003 9:59 am</h4>
    <div class="postbody"><span class="postbody">Well, VRAM is 16 bits, Video Bus is 16 bits, and DMA is faster than CPU to transfer data, so I don't know why HAM uses 8 bits tile sets to transfer it with CPU...</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
