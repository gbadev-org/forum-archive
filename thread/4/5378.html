<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Appending data to the binary - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > Appending data to the binary</h2>
<div id="posts">
<div class="post">
    <h4>#39249 - brucesinner - Wed Apr 06, 2005 3:10 pm</h4>
    <div class="postbody"><span class="postbody">Does anyone have some directions to give on how do i append data to the end of my binary (.gba) file so that the artists dont need to give me new art and recompile every time they change something ?
<br/>
<br/>
Perhaps I can do a tool for that and give it to my artists. The production time would be much more faster. 
<br/>
<br/>
In time, if i do manage to append the data, how do i access it ?
<br/>
<br/>
Thanks for any tips,
<br/>
Bruce Sinner</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39253 - Lord Graga - Wed Apr 06, 2005 4:11 pm</h4>
    <div class="postbody"><span class="postbody">A simple method would be to pad the ROM (easiest way to determite which adress to read from), and then make a pointer to the end, like this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void* appended_gfx = (void*)0x8008000 //point to image data at end of original ROM. 0x8000000 + size in bytes</td> </tr></table><span class="postbody">
<br/>
<br/>
Then make a batch/shell-script, etc, that converts the data that the graphician is using to a binary format, and append it with <span style="font-style: italic">cat rom.gba binarydata.bin &gt; rom_withdata.gba</span> (if you have the cat command, i.e, unix, linux, cygwin, msys, etc), or <span style="font-style: italic">copy /b rom.gba + binarydata.bin rom_withdata.gba</span>  (for MS-DOS/Windows, don't know if the syntax is correct).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39263 - brucesinner - Wed Apr 06, 2005 7:02 pm</h4>
    <div class="postbody"><span class="postbody">Pretty thanks for the tip.
<br/>
<br/>
But how do I know where the ROM ends ? You said 0x8008000, it is always that value ? 
<br/>
<br/>
If I want to access for example a sound sample i put after it, i must count all the data before the sample and then put a pointer directly at it ?
<br/>
<br/>
thanks again</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39265 - Lord Graga - Wed Apr 06, 2005 8:04 pm</h4>
    <div class="postbody"><span class="postbody">0x8000000 + size of ROM in bytes, I wrote! How would the GBA know how big the ROM was? :)
<br/>
<br/>
<br/>
An example, "to cut it out in cardboard" (as we say in Denmark):
<br/>
<br/>
A ROM at the size of 64 kbyte (65536 == 0x10000) would have an end at 0x8000000 + 0x10000 == 0x8010000
<br/>
<br/>
A ROM at the size of 8 kbyte (8192 bytes == 0x2000) would have an end at 0x8000000 + 0x2000 == 0x8002000.
<br/>
<br/>
A ROM at the size of 54.244 (0xD3E4) bytes would have it's end at 0x8000000 + 0xD3E4 == 0x800D3E4
<br/>
<br/>
<br/>
Get it now?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39266 - brucesinner - Wed Apr 06, 2005 8:16 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lord Graga wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Get it now?</td> </tr></table><span class="postbody">
<br/>
<br/>
Yes, SIR !!!
<br/>
<br/>
You rock! 
<br/>
<br/>
Thanks again.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39267 - tepples - Wed Apr 06, 2005 8:38 pm</h4>
    <div class="postbody"><span class="postbody">Just about all the implementation work has been done for you. Check out <a class="postlink" href="http://www.pineight.com/gba/#gbfs" target="_blank">GBFS</a>.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39405 - Lupin - Fri Apr 08, 2005 2:53 pm</h4>
    <div class="postbody"><span class="postbody">you can also just use an asm file and use .incbin to include all your files... it would look something like this (i forgot to add the section stuff because i dont know how it has to look like):
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">.export  mydata
<br/>
<br/>
mydata:
<br/>
.incbin "myfile.bin"</td> </tr></table><span class="postbody">
<br/>
<br/>
and in C you do this to include your data:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
extern u8 mydata[123];
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
That should be pretty much everything you need to do (just add a section header to the ASM file...), the compiler will handle making the label addresses.<br/>_________________<br/><a class="postlink" href="http://pokeme.shizzle.it/" target="_blank">Team Pokeme</a>
<br/>
<a class="postlink" href="http://lupin.shizzle.it/" target="_blank">My blog and PM ASM tutorials</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39410 - brucesinner - Fri Apr 08, 2005 3:53 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lupin wrote:</b></span></td> </tr> <tr> <td class="quote">you can also just use an asm file and use .incbin to include all your files... it would look something like this (i forgot to add the section stuff because i dont know how it has to look like):
<br/>
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">.export  mydata
<br/>
<br/>
mydata:
<br/>
.incbin "myfile.bin"</td> </tr></table><span class="postbody">
<br/>
<br/>
and in C you do this to include your data:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
extern u8 mydata[123];
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
That should be pretty much everything you need to do (just add a section header to the ASM file...), the compiler will handle making the label addresses.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
but this way i will have to recompile after any data change, right ?
<br/>
<br/>
I want to avoid this.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39634 - Lupin - Sun Apr 10, 2005 11:14 pm</h4>
    <div class="postbody"><span class="postbody">you always have to re-build the ROM in some way...<br/>_________________<br/><a class="postlink" href="http://pokeme.shizzle.it/" target="_blank">Team Pokeme</a>
<br/>
<a class="postlink" href="http://lupin.shizzle.it/" target="_blank">My blog and PM ASM tutorials</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39639 - wintermute - Mon Apr 11, 2005 12:28 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lupin wrote:</b></span></td> </tr> <tr> <td class="quote">you always have to re-build the ROM in some way...</td> </tr></table><span class="postbody">
<br/>
<br/>
Not if you use <a class="postlink" href="http://www.pineight.com/gba/#gbfs" target="_blank">GBFS</a>[/url]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39640 - tepples - Mon Apr 11, 2005 12:28 am</h4>
    <div class="postbody"><span class="postbody">But if your artists can rebuild the ROM with just an image converter, a simple archive builder, and copy /b, then they don't have to install the whole GCC and Binutils toolchains on each system. Rebuilding the ROM with less software &gt; rebuilding the ROM with more software.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39642 - poslundc - Mon Apr 11, 2005 12:50 am</h4>
    <div class="postbody"><span class="postbody">Also, rebuilding the ROM != recompiling.
<br/>
<br/>
Recompiling can take anywhere from seconds to hours depending on the size of the project.
<br/>
<br/>
Linking/data appending is relatively painless.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39657 - brucesinner - Mon Apr 11, 2005 3:18 am</h4>
    <div class="postbody"><span class="postbody">GBFS seems to be the better solution in this case, i gotta check it out!</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
