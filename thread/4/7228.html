<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Quick Interrupt Handling Questions - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > Quick Interrupt Handling Questions</h2>
<div id="posts">
<div class="post">
    <h4>#58072 - AkumaATR - Thu Oct 20, 2005 5:12 pm</h4>
    <div class="postbody"><span class="postbody">1. Is it very often that people need to switch to user mode stack when dealing with nested interrupts via Jeff F.'s approach? I was going to use the interrupt dispatcher from his crt0.o until I started worrying about blowing the IRQ mode stack.
<br/>
<br/>
2. I decided to at this point use Wintermute's interrupt dispatcher, as I don't think I have any interrupt processing that is important enough that it can't wait for a current interrupt handler to finish. However, I have REG_IE set so that only interrupts occur on timer 1 overflow, yet it seems that I have to have my handler at index [0] in IntrTable. I read that the function pointers for each associated interrupt should be in the same order as the bits in REG_IF. Wouldn't that mean I should be able to have all entries in IntrTable as NULL except for IntrTable[4]? Like I said, at this point in time it only seems to work for me if I have my handler at IntrTable[0].
<br/>
<br/>
Any tips/ideas as to what's going on?
<br/>
<br/>
Thanks so much.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#58097 - wintermute - Thu Oct 20, 2005 8:37 pm</h4>
    <div class="postbody"><span class="postbody">The libgba interrupt dispatcher in libgba is a slightly more complex beast than the old method seen in Jeff's crt0. It's designed to allow a basic priority system so that the user can effectively specify the order in which interrupt flags are checked. Instead of a table of function pointers it uses a table which contains both a mask to check for and a function to use for servicing. There are functions in libgba for setting the table entries, you should not attempt to access them directly.
<br/>
<br/>
<a href="http://devkitpro.sourceforge.net/onlinedocs/libgba/a00031.html" target="_blank">http://devkitpro.sourceforge.net/onlinedocs/libgba/a00031.html</a>
<br/>
<br/>
Handlers are placed in the table in the order they are set by the user. No particular entry corresponds to any particular interrupt.
<br/>
<br/>
The dispatcher itself is designed to allow nested interrupts when the user requires them rather than making all interrupts nested by default. Setting the interrupt master flag (REG_IME) in your handler allows it to be interrupted, leaving it alone operates as a standard single interrupt without nesting.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
