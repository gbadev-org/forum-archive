<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>ArcTan2 - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Coding > ArcTan2</h2>
<div id="posts">
<div class="post">
    <h4>#60623 - Orion - Sun Nov 13, 2005 1:38 am</h4>
    <div class="postbody"><span class="postbody">hello
<br/>
<br/>
I have some code like this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">arctan2(obj_x - player_x, player_y - object_y)</td> </tr></table><span class="postbody">
<br/>
<br/>
Where that macro is deifned as:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define arctan(x, y)   bios_arctan2(x, y) * 0.0054932478828107118333714808880771
<br/>
<br/>
<br/>
extern __attribute__ ((long_call)) u16 bios_arctan2(s16 x, s16 y);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
The number is worked out like this: 1 / (65535 / 360). It's the return value for 360 degrees, divided by 360 degrees, and reciprocated so you multiply to get the angle.
<br/>
<br/>
My problem is that if I double object_y, the angle the object moves to meet the player halves instead of doubling - so it completely misses and fires off elsewhere. If object_y and object_x are in ratio, though (32 and 32, or 16 and 16, or 64 and 64) then it works fine, with the object moving at the expected angle.
<br/>
<br/>
Can you help? Is it something to do with how I am dealing with ArcTan2?
<br/>
<br/>
Thank you</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#60627 - tepples - Sun Nov 13, 2005 2:36 am</h4>
    <div class="postbody"><span class="postbody">This won't solve your problem, but it's something to think about:
<br/>
<br/>
First of all, whenever you multiply by a number with a decimal point, you bring in the floating point emulator. The GBA's CPU has no dedicated floating point hardware, so it has to emulate it using hundreds of ARM CPU instructions. If you use any floating point code in a loop, it will run very slowly.
<br/>
<br/>
Another thing you could try is designing your data structures around the unit "brads" instead of "degrees". There are 256 brads in a circle, or 64 brads in a right angle. I know that at least the BASIC Stamp uses brads, and so does the Allegro library. Then you can use the values returned from BIOS ArcTan2 directly.
<br/>
<br/>
One thing you could do is make a loop that steps through each direction from 0 to 359 (or 255 once you make the switch to brads) and shoots once to make sure that it's not exchanging the axes or anything.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"><br/><br/>Last edited by tepples on Sun Nov 13, 2005 4:24 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#60628 - Orion - Sun Nov 13, 2005 2:46 am</h4>
    <div class="postbody"><span class="postbody">Using brads sounds like a good idea cause then I could use &amp; to loop my sin lookups as well... Hmm. thanks.
<br/>
<br/>
And trying that, I found that I have to actually use ArcTan2(y,x)... but I've never seen any implementation have to do this before. Think this is specific to the way I'm doing things?
<br/>
<br/>
Another question... would I be better doing a bios divide or a multiply by 0.005495 (for speed)?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#60631 - DekuTree64 - Sun Nov 13, 2005 3:06 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Orion wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">arctan2(obj_x - player_x, player_y - object_y)</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
Hmm, this may just be a typo, but shouldn't it be object_y - player_y, not the other way around? I think that could cause the backwardness from what you're expecting when you double object_y...
<br/>
<br/>
Also, there's an old <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=3840" target="_blank">thread</a> with an atan2 implementation using ARM-friendly integer math, and written in assembly. Might want to try that out if you switch your angles to brads. Looks like it uses a 512 degree circle though, so you'd want to divide the angle it returns by 2 to convert to brads.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#60633 - Orion - Sun Nov 13, 2005 3:27 am</h4>
    <div class="postbody"><span class="postbody">Well, the thing was, before I had that odd thing in there it made my object move in a perfect quarter-circle around the obejct I wanted it to move to o_O</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#60635 - LOst? - Sun Nov 13, 2005 4:17 am</h4>
    <div class="postbody"><span class="postbody">brads?
<br/>
<br/>
Is that the official name for 256 circle radian?
<br/>
<br/>
Any official name for 512 circle radian?<br/>_________________<br/><span style="font-style: italic">Exceptions are fun</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#60636 - tepples - Sun Nov 13, 2005 4:28 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>LOst? wrote:</b></span></td> </tr> <tr> <td class="quote">brads?
<br/>
<br/>
Is that the official name for 256 circle radian?</td> </tr></table><span class="postbody">
<br/>
Don't know if the unit of Pi/128 radians is recognized by any standards body, but in addition to the Stamp, at least FutureBASIC for Mac has used the term, explaining it as b for binary, rad for radian.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Any official name for 512 circle radian?</td> </tr></table><span class="postbody">
<br/>
Easy: "Brads in 8.1 fixed point."<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#60639 - LOst? - Sun Nov 13, 2005 5:01 am</h4>
    <div class="postbody"><span class="postbody">[quote="tepples"]</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>LOst? wrote:</b></span></td> </tr> <tr> <td class="quote">explaining it as b for binary, rad for radian.</td> </tr></table><span class="postbody">
<br/>
<br/>
Great! I love that name. I use 256 circle radian all over my engines. In DS I am using 512 because it fits the hardware better.<br/>_________________<br/><span style="font-style: italic">Exceptions are fun</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#60654 - poslundc - Sun Nov 13, 2005 10:03 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Orion wrote:</b></span></td> </tr> <tr> <td class="quote">Another question... would I be better doing a bios divide or a multiply by 0.005495 (for speed)?</td> </tr></table><span class="postbody">
<br/>
<br/>
If you convert the number to fixed point, multiplication will be much, much faster.
<br/>
<br/>
If you leave it as floating point, there's a good chance it will be slower.
<br/>
<br/>
Used fixed point. Everywhere, all the time.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#60659 - sgeos - Sun Nov 13, 2005 1:35 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">Used fixed point. Everywhere, all the time.</td> </tr></table><span class="postbody">
<br/>
Unless you have access to an FPU.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
