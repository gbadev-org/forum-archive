<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>question about 15 bit brg - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Coding > question about 15 bit brg</h2>
<div id="posts">
<div class="post">
    <h4>#18981 - Darmstadium - Fri Apr 09, 2004 3:39 am</h4>
    <div class="postbody"><span class="postbody">I want to make a picture in mode 3 fade to black. So you have to decrement each color right? So can you get the seperate values for b r and g from a 16 bit color value like this?
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
green = COLOR &amp; ~0x7FE0;
<br/>
red = (COLOR &amp; ~0x7C1F) &gt;&gt; 5;
<br/>
blue = (COLOR &amp; ~0x3FF) &gt;&gt; 10;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
and just do something like
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
blue--;
<br/>
red--;
<br/>
green--;
<br/>
</td> </tr></table><span class="postbody">
<br/>
to make the colors darker?
<br/>
<br/>
I'd really appreciate your comments and help</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18982 - niltsair - Fri Apr 09, 2004 4:03 am</h4>
    <div class="postbody"><span class="postbody">It's simpler to just use the dedicated BG Effect registers for this :
<br/>
<br/>
<span style="font-weight: bold">REG_BLDMOD = 0x0F | 3&lt;&lt;6;
<br/>
REG_COLY = 8;</span>
<br/>
<br/>
This will darken your BG by half.
<br/>
(REG_BLDMOD =) : BG Effect Register.
<br/>
(0x0F) : Select All layers to be affected.
<br/>
(| 3&lt;&lt;6;) : Select darken effect  ( 2&lt;&lt;6; for lighten)
<br/>
(REG_COLY = 8;) : Set intensity of the effect (can be 0-16).
<br/>
<br/>
Check into a Gba.h header for the #defines instead of actually using numeric values (0x0F, 3&lt;&lt;6, ...), it'll be much clearer.
<br/>
<br/>
If you still want to do it with the pixel value, this would work given you shift back your color values. Why are you using bits complement? Just get the mask directly.
<br/>
<br/>
green = COLOR &amp; 0x001F;
<br/>
red = (COLOR &amp; 0x03E0) &gt;&gt; 5;
<br/>
blue = (COLOR &amp; 0x7C00) &gt;&gt; 10; 
<br/>
<br/>
if(green !=0) green--;
<br/>
if(red!=0) red--;
<br/>
if(blue!=0) blue--;
<br/>
<br/>
DARKENCOLOR = (blue&lt;&lt;10) | (red&lt;&lt;5) | green<br/>_________________<br/>-Inside every large program is a small program struggling to get out. (Hoare's Law of Large Programs)
<br/>
-The man who can smile when things go wrong has thought of someone he can blame it on. (Nixon's Theorem)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18985 - poslundc - Fri Apr 09, 2004 5:10 am</h4>
    <div class="postbody"><span class="postbody">Mathematical fades work best in the paletted modes, since you only need to do calculations for the 256 palette entries. It would be extremely inefficient to attempt to do so for the entire screen (as you would have to in Mode 3).
<br/>
<br/>
You're much better off using the effects register in this case, as niltsair suggests.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18989 - batblaster - Fri Apr 09, 2004 1:50 pm</h4>
    <div class="postbody"><span class="postbody">Hi ,
<br/>
<br/>
is my mistake or all of you are making an error ??? the color format are BGR
<br/>
<br/>
Blue , Green , Red
<br/>
<br/>
and not BRG
<br/>
<br/>
Blue , Red , Green
<br/>
<br/>
...<br/>_________________<br/>Batblaster / 7 Raven Studios Co. Ltd
<br/>
------------------------------------------</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18990 - niltsair - Fri Apr 09, 2004 2:06 pm</h4>
    <div class="postbody"><span class="postbody">I did not pay attention to the color order. It is indeed BGR.<br/>_________________<br/>-Inside every large program is a small program struggling to get out. (Hoare's Law of Large Programs)
<br/>
-The man who can smile when things go wrong has thought of someone he can blame it on. (Nixon's Theorem)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18998 - ScottLininger - Fri Apr 09, 2004 6:19 pm</h4>
    <div class="postbody"><span class="postbody">EDIT: whoops, you're talking mode 3, not 4... still, this may be useful.
<br/>
<br/>
Here's function I use for fading in and fading out via palette manipulation. It's fast enough for most things, though I'm sure it could be optimized.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define REDVALUE(c)      (c &amp; 31)
<br/>
#define GREENVALUE(c)   ((c&gt;&gt;5) &amp; 31)
<br/>
#define BLUEVALUE(c)   (c&gt;&gt;10)
<br/>
#define WHITE      0x7FFF
<br/>
#define BLACK      0x0000
<br/>
#define RED      0x395A
<br/>
<br/>
void FadeIntoColor(u16 targetColor,u16* bmpPalette,int fadeSteps) {
<br/>
<br/>
   int readX, step, red,green,blue;
<br/>
   u16 sourceColor;
<br/>
<br/>
   for (step=0;step&lt;=fadeSteps ;step++ ){
<br/>
      WaitForVblank;
<br/>
      for(readX = 0; readX &lt; 256; readX++) {
<br/>
         
<br/>
         sourceColor = bmpPalette[readX];
<br/>
         red = ((REDVALUE(sourceColor) * (fadeSteps-step)) + (REDVALUE(targetColor) * step)) /fadeSteps;
<br/>
         green = ((GREENVALUE(sourceColor) * (fadeSteps-step)) + (GREENVALUE(targetColor) * step)) /fadeSteps;
<br/>
         blue = ((BLUEVALUE(sourceColor) * (fadeSteps-step)) + (BLUEVALUE(targetColor) * step)) /fadeSteps;
<br/>
<br/>
         paletteMem[readX] = RGB( red , green , blue );
<br/>
      }
<br/>
   }
<br/>
<br/>
}
<br/>
<br/>
void FadeFromColor(u16 targetColor,u16* bmpPalette,int fadeSteps) {
<br/>
<br/>
   int readX, step, red,green,blue;
<br/>
   u16 sourceColor;
<br/>
   
<br/>
<br/>
   for (step=0;step&lt;=fadeSteps ;step++ ){
<br/>
      WaitForVblank();   
<br/>
      for(readX = 0; readX &lt; 256; readX++) {
<br/>
         
<br/>
         sourceColor = bmpPalette[readX];
<br/>
         red = ((REDVALUE(targetColor) * (fadeSteps-step)) + (REDVALUE(sourceColor) * step)) /fadeSteps;
<br/>
         green = ((GREENVALUE(targetColor) * (fadeSteps-step)) + (GREENVALUE(sourceColor) * step)) /fadeSteps;
<br/>
         blue = ((BLUEVALUE(targetColor) * (fadeSteps-step)) + (BLUEVALUE(sourceColor) * step)) /fadeSteps;
<br/>
<br/>
         paletteMem[readX] = RGB( red , green , blue );
<br/>
         
<br/>
      }
<br/>
   }
<br/>
<br/>
}
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
You'd call it with something like:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">FadeIntoColor(BLACK,MainPalette,15);</td> </tr></table><span class="postbody">
<br/>
<br/>
By changing the "steps" param, you can make very long or very short fades.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
