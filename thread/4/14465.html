<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>unwarranted (?) link errors - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > unwarranted (?) link errors</h2>
<div id="posts">
<div class="post">
    <h4>#144687 - bpoint - Mon Nov 05, 2007 7:40 pm</h4>
    <div class="postbody"><span class="postbody">Thanks to wintermute and tepples, I was able to solve the problem with dead code not being eliminated, but now I am faced with five remaining "undefined reference" errors during linking:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">36&gt;------ Build started: Project: sandbox, Configuration: Debug GBA ------
<br/>
36&gt;Performing Makefile project actions
<br/>
36&gt;arm-eabi-g++ -mthumb -mthumb-interwork -Wl,-Map,sandbox.elf.map -Wl,-gc-sections -specs=gba_mb.specs    sandbox.o  -L/c/CF/lib/gba -lDebug-CFADT -lDebug-CFAlgebra -lDebug-CFAnimation -lDebug-CFArchive -lDebug-CFAudio -lDebug-CFBitStream -lDebug-CFCamera -lDebug-CFCompress -lDebug-CFEncrypt -lDebug-CFFile -lDebug-CFFont -lDebug-CFGUI -lDebug-CFGeometry -lDebug-CFGfx -lDebug-CFHash -lDebug-CFHierarchy -lDebug-CFIniFile -lDebug-CFInput -lDebug-CFKeitaiComm -lDebug-CFLibc -lDebug-CFLog -lDebug-CFMath -lDebug-CFMem -lDebug-CFModel -lDebug-CFMusic -lDebug-CFOS -lDebug-CFPrim -lDebug-CFProcedural -lDebug-CFResource -lDebug-CFSerialPort -lDebug-CFSound -lDebug-CFTerrain -lDebug-CFTexture -lDebug-CFUtils -lDebug-CFWorld -o sandbox.elf
<br/>
36&gt;c:/CF/lib/gba\libDebug-CFFile.a(disk.o): In function `__static_initialization_and_destruction_0':
<br/>
36&gt;c:/CF/src/base/CFFile/build/gba/Debug/../../../disk.cpp:28: undefined reference to `CFArchive::CFArchive()'
<br/>
36&gt;c:/CF/lib/gba\libDebug-CFFile.a(disk.o): In function `__tcf_0':
<br/>
36&gt;c:/CF/src/base/CFFile/build/gba/Debug/../../../disk.cpp:28: undefined reference to `CFArchive::~CFArchive()'
<br/>
36&gt;c:/CF/lib/gba\libDebug-CFGUI.a(window.o): In function `CFGUIWindow::drawWindowFrame(CFGfx::Device*)':
<br/>
36&gt;c:/CF/src/gfx/CFGUI/build/gba/Debug/../../../window.cpp:185: undefined reference to `CFFontGetFont(unsigned int)'
<br/>
36&gt;c:/CF/src/gfx/CFGUI/build/gba/Debug/../../../window.cpp:186: undefined reference to `CFFont::setColor(CFcolor&lt;unsigned char&gt; const*)'
<br/>
36&gt;c:/CF/src/gfx/CFGUI/build/gba/Debug/../../../window.cpp:189: undefined reference to `CFFont::drawAlignedText(CFGfx::Device*, fxps16, fxps16, fxps16, CFFontAlignment, char const*, bool)'
<br/>
36&gt;collect2: ld returned 1 exit status
<br/>
36&gt;make[1]: *** [sandbox.elf] Error 1
<br/>
36&gt;make: *** [debug] Error 2
<br/>
36&gt;Project : error PRJ0019: A tool returned an error code from "Performing Makefile project actions"
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I wouldn't expect anyone to know these functions, as they're ones internal to our engine.  The problem is, I'm clearly linking in the libraries necessary (CFArchive is in libDebug-CFArchive.a, and CFFont is in libDebug-CFFont.a), so I don't understand why I'm getting any link errors at all.
<br/>
<br/>
Examining the output .map file shows that the libraries are indeed being used (there is a LOAD tag within the .stack section for that library), and strangely, there seems to be interwork code generated for these missing functions.  For example, CFFont::drawAlignedText shows up in the .map file with:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">                0x0201b7e8                ___ZN6CFFont15drawAlignedTextEPN5CFGfx6DeviceE6fxps16S3_S3_15CFFontAlignmentPKcb_from_thumb
<br/>
                0x0201b7ec                ___ZN6CFFont15drawAlignedTextEPN5CFGfx6DeviceE6fxps16S3_S3_15CFFontAlignmentPKcb_change_to_arm
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
But I'm not seeing any of the missing functions within the "Archive member included because of file (symbol)" section -- which I can only guess means that they're not being included for some reason.
<br/>
<br/>
I was originally using devkitARM r20, but noticed r21 was recently released, so I upgraded, but unfortunately it didn't help.
<br/>
<br/>
I should also mention that the <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=14464&amp;sid=87b5de49ca63eeffa461cc69b1fa3086" target="_blank">dead code stripping</a> is probably unrelated to this.  I was getting a lot (more than 100) of these undefined references before I enabled the dead code strip compiler options, but I figured that they were irrelevant since the ewram size was already being exceeded.  Unfortunately, these five seem to still remain.
<br/>
<br/>
Any suggestions?  I'm willing to post my .map file or Makefile if it would help narrow down the problem...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144696 - wintermute - Mon Nov 05, 2007 10:09 pm</h4>
    <div class="postbody"><span class="postbody">You're linking your libraries in the wrong order.
<br/>
<br/>
-lDebug-CFFile should come before -lDebug-CFArchive since the former uses functions from the latter. Same thing with -lDebug-CFFont and -lDebug-CFGUI.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#144734 - bpoint - Tue Nov 06, 2007 7:21 am</h4>
    <div class="postbody"><span class="postbody">Thanks, that seemed to fix it!
<br/>
<br/>
I wasn't aware ld only searched functions in libraries from left to right...</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
