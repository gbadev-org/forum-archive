<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>(GBA)Issues comming from ewram during compile - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > (GBA)Issues comming from ewram during compile</h2>
<div id="posts">
<div class="post">
    <h4>#70157 - Kaiser - Sat Feb 04, 2006 8:05 pm</h4>
    <div class="postbody"><span class="postbody">I've been working on a test project for the gba, I recently been adding data and more data for sprite display, sounds etc. When adding data, I used two raw data files converted to .o files (first file is 284,405 bytes, the other 119,314 bytes).
<br/>
In my header (.h) file I have them setup as:
<br/>
extern unsigned char data_file1[];
<br/>
extern unsigned char data_file2[];
<br/>
<br/>
when trying to compile with these data files I get a ewram overflow error during compile.
<br/>
<br/>
here is a screenshot of the command prompt.
<br/>
<br/>
<a href="http://vault.d3files.com/temp/ewram.jpg">[Images not permitted - Click here to view it]</a>
<br/>
<br/>
I am assuming that I am compiling too much data into the rom, but how can I get around this limit, and is there any docs that deals specifically with ewram?
<br/>
<br/>
I appriciate any feedback. Thanks</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#70163 - keldon - Sat Feb 04, 2006 8:24 pm</h4>
    <div class="postbody"><span class="postbody">You need to declare the data as const if you want it stored in ROM and not RAM.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#70169 - Kaiser - Sat Feb 04, 2006 8:55 pm</h4>
    <div class="postbody"><span class="postbody">extern const unsigned char data_file1[];
<br/>
extern const unsigned char data_file2[]; 
<br/>
<br/>
<br/>
Error still occurs though. Same message. Is there a limit to the size of my binary files perhaps?
<br/>
<br/>
<br/>
btw, here's a copy of my batch file that I use to compile the rom
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
@echo off
<br/>
REM just add  .c file and  .o file to the next two lines 
<br/>
set CFILES= spriteTest.c
<br/>
set OFILES= Data_File1.o spriteTest.o Data_File2.o
<br/>
<br/>
<br/>
set GAME= spriteTest
<br/>
set SPECS=gba_mb.specs
<br/>
<br/>
set DEVDIR=E:\devkitPro
<br/>
set DATADIR=E:\devkitPro\GBATEST\include
<br/>
<br/>
PATH=%DEVDIR%\bin;%path%
<br/>
<br/>
REM set our paths so the linker knows were to look for the libs
<br/>
set LIBDIR= %DEVDIR%\arm-elf\lib\interwork
<br/>
set LIBDIR2= %DEVDIR%\libgba\lib
<br/>
<br/>
REM set our include directories so the compiler can find our include files
<br/>
set INCDIR= %DEVDIR%\arm-elf\include
<br/>
set INCDIR2= %DATADIR%
<br/>
<br/>
REM the compiler and linker flags
<br/>
set CFLAGS= -I.  -I%INCDIR% -I%INCDIR2% -c -g -O2 -Wall -mcpu=arm7tdmi -mtune=arm7tdmi -fomit-frame-pointer -ffast-math -mthumb -mthumb-interwork 
<br/>
<br/>
set CFLAGSARM= -I.  -I%INCDIR% -I%INCDIR2% -c -g -O2 -Wall -mcpu=arm7tdmi -mtune=arm7tdmi -fomit-frame-pointer -ffast-math -mthumb-interwork
<br/>
<br/>
set LDFLAGS=  -mthumb -mthumb-interwork -specs=%SPECS% -L%LIBDIR% -L%LIBDIR2%  
<br/>
<br/>
<br/>
<br/>
<br/>
REM Compile the cfiles
<br/>
E:\devkitPro\devkitARM\bin\arm-elf-gcc.exe  %CFILES% %CFLAGS%
<br/>
<br/>
E:\devkitPro\devkitARM\bin\arm-elf-gcc spriteTest.c  %CFLAGSARM%
<br/>
<br/>
REM link the o files
<br/>
E:\devkitPro\devkitARM\bin\arm-elf-gcc.exe -o %GAME%.elf  %OFILES% %DFILES% %LDFLAGS% 
<br/>
<br/>
REM gcc produces .elf exicutables...objcopy to .gba
<br/>
E:\devkitPro\devkitARM\bin\arm-elf-objcopy.exe -v -O binary %game%.elf %game%.gba
<br/>
<br/>
E:\devkitPro\devkitARM\bin\gbafix.exe %game%.gba
<br/>
<br/>
REM remove all the ofiles
<br/>
REM del %OFILES%
<br/>
del %game%.elf
<br/>
<br/>
pause
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#70177 - nmain - Sat Feb 04, 2006 9:40 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
set SPECS=gba_mb.specs
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
This spec set tells the linker to put all your code in ewram.  A short startup routine is then added in before the code runs that copies it all off the ROM and into ewram if it is in ROM.
<br/>
<br/>
That is, this spec set is for multiboot roms; they can be run directly in ewram off a cable after being downloaded by the BIOS.  So if your program is more than 256K including assets, this won't work.  You need to reduce the size of your included assets, or if your intent is not to make a multiboot compatible rom, link with the regular specs instead:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
set SPECS=gba.specs
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#70179 - Cearn - Sat Feb 04, 2006 9:43 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Kaiser wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">..
<br/>
set SPECS=gba_mb.specs
<br/>
...
<br/>
</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
In this case, everything ROMish will go into EWRAM. I'm not sure how much data you're putting in there exactly (sizeof(.o) != sizeof(binary), but it may be close), but if GCC says EWRAM is full, I guess it's too much. To solve this you can either
<br/>
a) compile the data so it's smaller.
<br/>
b) compile to real ROM using 'gba.specs' instead of 'gba_mb.specs'.
<br/>
<br/>
EDIT: cross-post. Sigh.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#70182 - Kaiser - Sat Feb 04, 2006 10:01 pm</h4>
    <div class="postbody"><span class="postbody">It finally works heh.
<br/>
<br/>
Btw, I am still new to the GBA hardware so I am not aware what multiboot does.
<br/>
<br/>
Also I am just wondering, is it possible to actually access data though GBA memory, or the only way is by C arrays?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#70187 - Cearn - Sat Feb 04, 2006 10:18 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Kaiser wrote:</b></span></td> </tr> <tr> <td class="quote">Btw, I am still new to the GBA hardware so I am not aware what multiboot does.</td> </tr></table><span class="postbody">
<br/>
there are two modes of operation: cart-boot (or whatever it's called) and multiboot. Cart-boot is with a cartridge, which has a 32MB ROM section, but requires a flashcart for hardware testing. Multiboot is what's used to make 1-cart-multiplayer possible: code/assets are loaded into EWRAM by a multiboot cable, either by another GBA or from a PC using a homemade Xboo cable. It's a lot cheaper solution than buying a flashcard, but you're stuck with only 256kb of memory.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Kaiser wrote:</b></span></td> </tr> <tr> <td class="quote">Also I am just wondering, is it possible to actually access data though GBA memory, or the only way is by C arrays?</td> </tr></table><span class="postbody">
<br/>
Eh?
<br/>
<br/>
C arrays are memory, GBA or otherwise. All data and code is in the memory, because that's how computers work. 
<br/>
<br/>
But in case you're asking if there is any other way of attaching and locating any kind of data, yes there is. Try tepples' <a class="postlink" href="http://www.pineight.com/gba/#gbfs" target="_blank">GameBoy File System</a>. FYI, locating is not the same as accessing. Access is easy: just make a pointer and point anywhere in memory. Whether you actually find what you were looking for (i.e., locating) is very doubtful.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#70200 - Kaiser - Sun Feb 05, 2006 12:11 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cearn wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<a class="postlink" href="http://www.pineight.com/gba/#gbfs" target="_blank">GameBoy File System</a>. FYI, locating is not the same as accessing. Access is easy: just make a pointer and point anywhere in memory. Whether you actually find what you were looking for (i.e., locating) is very doubtful.</td> </tr></table><span class="postbody">
<br/>
<br/>
I'll toy around with that and see what I can come up with.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cearn wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Eh?
<br/>
<br/>
C arrays are memory, GBA or otherwise. All data and code is in the memory, because that's how computers work. 
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
hehe, yeah I figured that would be the case
<br/>
Thanks for the feedback :D</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
