<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>BG\Sprite Collision - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > BG\Sprite Collision</h2>
<div id="posts">
<div class="post">
    <h4>#19633 - dagamer34 - Fri Apr 23, 2004 12:42 am</h4>
    <div class="postbody"><span class="postbody">I have been working on tile-sprite collision for a while and have finally gotten it to respond to collision nicely. The only problem is that my collision detection system isn't accurate enough.
<br/>
<br/>
I have my algorithm check 4 corners of a sprite against the tiles, and the middle borders of the sprite. Collision is almost accurate, but sometimes it fails because it misses parts of the sprite.
<br/>
<br/>
To show you what I mean, run my little demo. 
<br/>
<br/>
<a href="http://www.geocities.com/dagamer34/ColTest.zip" target="_blank">www.geocities.com/dagamer34/ColTest.zip</a>
<br/>
<br/>
Press B to run and jump higher (when running). Now, if you get to the left box, and decide to walk off the box to the right, you get stuck when you should be falling down. My algorithm is accurate only for a small sprite, but since I only check 3 times on each side, mishaps occur.
<br/>
<br/>
My question is, is there a better way to check collision besides tracing all along the sprite itself?<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19636 - sajiimori - Fri Apr 23, 2004 1:04 am</h4>
    <div class="postbody"><span class="postbody">Well, the link doesn't work, and I don't know what you mean by "middle borders", but it sounds like you aren't checking all the tiles that are covered by the rectangle.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
bool rect_bg_collision(Rect* r)
<br/>
{
<br/>
  int top    = point_to_tile(r-&gt;y);
<br/>
  int bottom = point_to_tile(top + r-&gt;h);
<br/>
  int left   = point_to_tile(r-&gt;x);
<br/>
  int right  = point_to_tile(left + r-&gt;w);
<br/>
<br/>
  for(int y = top; y &lt; bottom; ++y)
<br/>
    for(int x = left; x &lt; right; ++x)
<br/>
      if(tile_is_solid(x, y))
<br/>
        return true;
<br/>
<br/>
  return false;
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19644 - dagamer34 - Fri Apr 23, 2004 2:41 am</h4>
    <div class="postbody"><span class="postbody">So, you have to check all the tiles then; there's no avoiding it?
<br/>
<br/>
In your code, wouldn't you only need to check the first and last row completely, and then only the first and last tiles in the other rows?  I guess I will optimize your code then.
<br/>
<br/>
Thanks for your help anyway, it was really useful.<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19650 - sajiimori - Fri Apr 23, 2004 3:47 am</h4>
    <div class="postbody"><span class="postbody">Maybe I didn't understand your problem.  I thought you said your collision detection wasn't accurate enough; that is, it's not detecting all collisions.
<br/>
<br/>
For a rectangle that is covering a 3x3 area of tiles, it is quite possible for there to be a collision against the middle tile but not the outer ones.  Could the object ever get into that situation?  Sure, if it were moving more than a tile at a time.
<br/>
<br/>
If you want to ignore some of the tiles, you'd better be sure it's impossible for a collision to happen there, or else your "optimizations" could come back to haunt you.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19651 - Miked0801 - Fri Apr 23, 2004 4:00 am</h4>
    <div class="postbody"><span class="postbody">WIth a little vector math you can check for line/line collisions if you need.  This is what we do for BG collisions as it allows for angled BG collisions tiles - and is pretty fast to boot.  There's an older article on here about that somewhere...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19732 - dagamer34 - Sat Apr 24, 2004 12:09 am</h4>
    <div class="postbody"><span class="postbody">My code is pretty accurate with what it checks, I just don't check everything because of the recursive looping involved. I wanted to see if there was another way, instead of looping through every tile, since that is VERY time-consuming, and I was trying to optimize it for the fewest checks. I guess that bit me in the back.<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
