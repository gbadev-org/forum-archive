<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Ray Cast Texture Mapping (64x64) - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > Ray Cast Texture Mapping (64x64)</h2>
<div id="posts">
<div class="post">
    <h4>#23528 - Mr. GBA - Wed Jul 14, 2004 5:55 pm</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
I've just started working on some 3D ray casting effects. I am able to render the world, but I need help on applying textures to the <span style="font-style: italic">walls</span> which are constituted of 64x64x64 units.
<br/>
<br/>
The only thing that has been of help is this page: <a href="http://www.permadi.com/tutorial/raycast/rayc10.html" target="_blank">http://www.permadi.com/tutorial/raycast/rayc10.html</a>
<br/>
<br/>
Please can someone help me texture a 64x64x64 wall using ray casting?
<br/>
<br/>
Thanks in Advance.<br/>_________________<br/>my dev/business site:
<br/>
<br/>
<a href="http://codebytesdev.afraid.org" target="_blank">http://codebytesdev.afraid.org</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23558 - sajiimori - Thu Jul 15, 2004 6:11 am</h4>
    <div class="postbody"><span class="postbody">Try here: <a href="http://www.gamedev.net/reference/articles/article872.asp" target="_blank">http://www.gamedev.net/reference/articles/article872.asp</a>
<br/>
<br/>
Edit: after reading the scaling portion, I'm convinced that their implementation is wrong and will result in a lockup.  Without testing, I think this is closer to what they had in mind:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define SCREEN_HEIGHT 160
<br/>
#define TEXTURE_HEIGHT 64
<br/>
#define int2fix(x) ((x) &lt;&lt; 16)
<br/>
#define fix2int(x) ((x) &gt;&gt; 16)
<br/>
<br/>
void plot_pixel(int x, int y, Color c);
<br/>
<br/>
void draw_column(int x, int height, Color* texture_strip)
<br/>
{
<br/>
    int i, y = SCREEN_HEIGHT/2 - height/2;
<br/>
    fixed scale = int2fix(TEXTURE_HEIGHT) / height;
<br/>
    fixed offset = 0;
<br/>
<br/>
    for(i = 0; i &lt; height; ++i, ++y)
<br/>
    {
<br/>
        int texture_offset = fix2int(offset);
<br/>
        plot_pixel(x, y, texture_strip[texture_offset]);
<br/>
        offset += scale;
<br/>
    }
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23580 - ecurtz - Thu Jul 15, 2004 4:44 pm</h4>
    <div class="postbody"><span class="postbody">You can grab a somewhat old version of my raycaster code from here:
<br/>
<a href="ftp://ftp.nuprometheus.com/pub/ARMode5/" target="_blank">ftp://ftp.nuprometheus.com/pub/ARMode5/</a>
<br/>
<br/>
That code has been up for a while so I'm not sure exactly what state it is in. It should have an uncommented and hard to understand texturing routine. (Actually it isn't that complex, you determine what column of the texture you're in based on where you hit the base of the wall. Then you move up the texture at a fractional pixel amount based on how far away/tall the wall is.)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23583 - Mr. GBA - Thu Jul 15, 2004 6:40 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for the help guys, but I'm still stuck...
<br/>
<br/>
From your help I have the following code so far (my texture image is 64*64):
<br/>
<br/>
<br/>
int offset = (int)VAy%64;       //offset to texture pixel
<br/>
		int scale = 64 * ((s32)VerticalLength/64);    //texture width * distance to wall/wall height (which is also 64)
<br/>
		int g = 0;      //variable which is incremented by scale
<br/>
<br/>
<br/>
<br/>
<br/>
		for(int bloop=start; bloop &lt;end; bloop++)         //start and end define the length of the column for the wall
<br/>
		{
<br/>
			videoBuffer[where] = WallTextureData[x+g];            //videobuffer[where] = slice/column in VRAM and WallTextureData is the image
<br/>
			videoBuffer[where+1] = WallTextureData[x+g+120];
<br/>
			where += 120; //mode 4 so + 120 to go down Y axis
<br/>
			g +=scale;
<br/>
		}
<br/>
<br/>
Any help would be much appreciated.
<br/>
<br/>
Thanks in Advance.<br/>_________________<br/>my dev/business site:
<br/>
<br/>
<a href="http://codebytesdev.afraid.org" target="_blank">http://codebytesdev.afraid.org</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23607 - sajiimori - Fri Jul 16, 2004 3:47 am</h4>
    <div class="postbody"><span class="postbody">Have you done solid-fill rendering yet?  Make sure that works before you continue.  Also, post code using the code tags, say what each of your variables is for (including VAy), and use #defines instead of magic numbers (like 64 and 120).
<br/>
<br/>
When it's easier for us to read, it's easier for us to help you. ^_^</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23622 - Mr. GBA - Fri Jul 16, 2004 11:37 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">Have you done solid-fill rendering yet?  Make sure that works before you continue.  Also, post code using the code tags, say what each of your variables is for (including VAy), and use #defines instead of magic numbers (like 64 and 120).
<br/>
<br/>
When it's easier for us to read, it's easier for us to help you. ^_^</td> </tr></table><span class="postbody">
<br/>
<br/>
Yes, I have done solid filling and everything else preceding the creation of walls is fine. I'm just stuck on the texturing of the walls.
<br/>
I won't further embarrass myself by posting flimsy code that isn't even well annotated. Instead I'll tell you where I'm stuck. I am stuck on chapter 10 of the Permadi tutorial (http://www.permadi.com/tutorial/raycast/rayc10.html 
<br/>
). Evertything up to chapter 10 in these tutorials, I have coded and it works fine. I just need extra help texturing the walls because this part of the tutorial seems a little brief.
<br/>
<br/>
Thanks.<br/>_________________<br/>my dev/business site:
<br/>
<br/>
<a href="http://codebytesdev.afraid.org" target="_blank">http://codebytesdev.afraid.org</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23633 - ecurtz - Fri Jul 16, 2004 4:26 pm</h4>
    <div class="postbody"><span class="postbody">It looks like you need to be using fixed point math for 'scale' and 'g'. 'g' is the amount of pixels you've moved along the texture, but if you aren't shifting it at all then you don't have any accuracy for your step.
<br/>
<br/>
Also the +120 in the texture pointer for the second pixel plotted doesn't make sense. That may be the offset for the screen, but it isn't the offset to the next row in your texture, which is only 64x64.
<br/>
<br/>
If you have solid textures working why don't you try going to a striped texture next and seeing if your logic for determining the texture column is correct. (i.e. paint the whole column the color of the first pixel you look up.)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23663 - Mr. GBA - Sat Jul 17, 2004 7:17 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ecurtz wrote:</b></span></td> </tr> <tr> <td class="quote">It looks like you need to be using fixed point math for 'scale' and 'g'. 'g' is the amount of pixels you've moved along the texture, but if you aren't shifting it at all then you don't have any accuracy for your step.
<br/>
<br/>
Also the +120 in the texture pointer for the second pixel plotted doesn't make sense. That may be the offset for the screen, but it isn't the offset to the next row in your texture, which is only 64x64.
<br/>
<br/>
If you have solid textures working why don't you try going to a striped texture next and seeing if your logic for determining the texture column is correct. (i.e. paint the whole column the color of the first pixel you look up.)</td> </tr></table><span class="postbody">
<br/>
<br/>
Thanks for highlighting the mistakes in my flimsy code. But even with the alterations, the texture mapping still doesn't work.
<br/>
<br/>
I've tried the striped texturing, which you suggested and  my ray caster handles it well. 
<br/>
<br/>
I have come close to texture mapping the 64x64 walls, but I think I'm still going wrong on the scaling of the texture image to fit the wall. I've tried endless permutations of formulas and nothing works so, I'm starting to think that this topic is slightly beyond me.
<br/>
<br/>
I'm still in need of help from anyone who knows how to texture a wall rendered using ray casting.
<br/>
<br/>
Thanks.<br/>_________________<br/>my dev/business site:
<br/>
<br/>
<a href="http://codebytesdev.afraid.org" target="_blank">http://codebytesdev.afraid.org</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23670 - sajiimori - Sun Jul 18, 2004 5:41 am</h4>
    <div class="postbody"><span class="postbody">Do you understand the algorithm?  All you have to do is calculate how far you're moving down the texture each time you move down a pixel on the screen.  Since that will usually not be a whole number, you use a fixed point variable.
<br/>
<br/>
Try drawing some pictures to illustrate the process for yourself.  Also try implementing just the scaling routine on your PC, using a float for the scale variable to make things easier.  Just take a single strip of pixels and try to scale it on the screen.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
