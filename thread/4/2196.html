<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>vram question - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Coding > vram question</h2>
<div id="posts">
<div class="post">
    <h4>#11460 - yanos - Tue Oct 07, 2003 10:42 pm</h4>
    <div class="postbody"><span class="postbody">Something weird that i dont understand. If i do:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
int i, lenght=1024;
<br/>
<br/>
for(i=0; i&lt;lenght; i++)
<br/>
   VideoBuffer[i+0x4000] = 0xCAFE;</td> </tr></table><span class="postbody">
<br/>
<br/>
and then i check in vba in the memory viewer, i see the value 0xCAFE at 0x6008000 instead of 0x6004000 (where i tought it should go). i got 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define VideoBuffer      ((u16*)0x6000000)</td> </tr></table><span class="postbody">
<br/>
<br/>
declared.
<br/>
<br/>
<br/>
yanos</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11461 - Burton Radons - Tue Oct 07, 2003 10:45 pm</h4>
    <div class="postbody"><span class="postbody">You're indexing with u16, so the 0x4000 is multiplied to 0x8000.  Use 0x2000 if you want to write to 0x06004000.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11466 - tepples - Wed Oct 08, 2003 12:50 am</h4>
    <div class="postbody"><span class="postbody">It looks like you're trying to clear a map.  Here are some VRAM address macros that I'm guessing people would find extremely useful:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">/* Macros for addressing maps */
<br/>
typedef u16 NAMETABLE[32][32];
<br/>
#define MAP ((NAMETABLE *)0x06000000)
<br/>
<br/>
/* Macros for addressing tile data */
<br/>
#define PATRAM(x) ((u32 *)(0x06000000 | ((x) &lt;&lt; 14)))
<br/>
#define PATRAM4(x, c) ((u32 *)(0x06000000 | (((x) &lt;&lt; 14) + ((c) &lt;&lt; 5)) ))
<br/>
#define PATRAM8(x, c) ((u32 *)(0x06000000 | (((x) &lt;&lt; 14) + ((c) &lt;&lt; 6)) ))
<br/>
#define SPR_VRAM(x) ((u32 *)(0x06010000 | ((x) &lt;&lt; 5)))
<br/>
#define OAM ((volatile struct OAM_SPRITE *)0x07000000)
<br/>
</td> </tr></table><span class="postbody">
<br/>
The MAP macro has two purposes. You can do MAP[8][0] to get the base address of row 0 of map 8, which equals (u16 *)0x06040000. In "text" (non-rot/scale) modes, you can also write characters to the map this way:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">/* place an X at (15, 10) on map 8 */
<br/>
MAP[8][10][15] = 'X';</td> </tr></table><span class="postbody">
<br/>
The PATRAM macros can also be used as targets for copying tile data:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">/* put tile data into Character Base Block 1 */
<br/>
dma_memcpy(PATRAM(1), tile_data, tile_data_len);
<br/>
<br/>
/* put tile data into Character Base Block 3, starting at tile #320 for 4-bit tiles */
<br/>
dma_memcpy(PATRAM4(3, 320), tile_data, tile_data_len);
<br/>
<br/>
/* put tile data into Character Base Block 2, starting at tile #128 for 8-bit tiles */
<br/>
dma_memcpy(PATRAM8(2, 128), tile_data, tile_data_len);
<br/>
<br/>
/* put tile data into sprite cels, starting at tile #512 */
<br/>
dma_memcpy(SPR_VRAM(512), tile_data, tile_data_len);</td> </tr></table><span class="postbody"><br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11472 - yanos - Wed Oct 08, 2003 5:02 am</h4>
    <div class="postbody"><span class="postbody">thanks a lot. I just tought that each address had an 16bits value 'attached' to it. makes perfect sense now.
<br/>
<br/>
yanos</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
