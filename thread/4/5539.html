<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>makefile problems again - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > makefile problems again</h2>
<div id="posts">
<div class="post">
    <h4>#41201 - ProblemBaby - Tue Apr 26, 2005 10:43 am</h4>
    <div class="postbody"><span class="postbody">Hi, I want my makefile to search in a directory for libfiles
<br/>
exactly as it does for sources and includes, Ive tried a lot of my own without understand what iam doing=)
<br/>
But I always got problems.
<br/>
<br/>
Here is the part of my makefile where I think something should be changed.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
#---------------------------------------------------------------------------------
<br/>
# no real need to edit anything past this point unless you need to add additional
<br/>
# rules for different file extensions
<br/>
#---------------------------------------------------------------------------------
<br/>
ifneq ($(BUILD),$(notdir $(CURDIR)))
<br/>
#---------------------------------------------------------------------------------
<br/>
<br/>
export OUTPUT	:=	$(CURDIR)/$(TARGET)
<br/>
<br/>
export VPATH	:=	$(foreach dir,$(SOURCES),$(CURDIR)/$(dir))
<br/>
<br/>
export CC		:=	$(PREFIX)gcc
<br/>
export AR		:=	$(PREFIX)ar
<br/>
export OBJCOPY		:=	$(PREFIX)objcopy
<br/>
#---------------------------------------------------------------------------------
<br/>
# use CXX for linking C++ projects, CC for standard C
<br/>
#---------------------------------------------------------------------------------
<br/>
export LD		:=	$(CC)
<br/>
<br/>
CFILES		:=	$(foreach dir,$(SOURCES),$(notdir $(wildcard $(dir)/*.c)))
<br/>
SFILES		:=	$(foreach dir,$(SOURCES),$(notdir $(wildcard $(dir)/*.S)))
<br/>
<br/>
export OFILES	:=	$(CFILES:.c=.o) $(SFILES:.S=.o)
<br/>
<br/>
export INCLUDE	:=	$(foreach dir,$(INCLUDES),-I$(CURDIR)/$(dir)) \
<br/>
					$(foreach dir,$(LIBDIRS),-I$(dir)/include) \
<br/>
					-I$(CURDIR)/$(BUILD)
<br/>
<br/>
export LIBPATHS	:=	$(foreach dir,$(LIBDIRS),-L$(dir)/lib)
<br/>
<br/>
.PHONY: $(BUILD) clean
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
$(BUILD):
<br/>
	@[ -d $@ ] || mkdir -p $@
<br/>
	@make --no-print-directory -C $(BUILD) -f $(CURDIR)/Makefile
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
clean:
<br/>
	@echo clean ...
<br/>
	@rm -fr $(BUILD) *.elf
<br/>
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
else
<br/>
<br/>
DEPENDS	:=	$(OFILES:.o=.d)
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# main targets
<br/>
#---------------------------------------------------------------------------------
<br/>
$(OUTPUT).gba	:	$(OUTPUT).elf
<br/>
<br/>
$(OUTPUT).elf	:	$(OFILES)
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
%.gba: %.elf
<br/>
	@echo built ... $(notdir $@)
<br/>
	@$(OBJCOPY) -O binary $&lt; $@
<br/>
	@gbafix -t$(TARGET) $@
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
%_mb.elf:
<br/>
	@echo linking multiboot
<br/>
	@$(LD) -specs=gba_mb.specs $(LDFLAGS) $(OFILES) $(LIBPATHS) $(LIBS) -o $@
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
%.elf:
<br/>
	@echo linking cartridge
<br/>
	@$(LD)  $(LDFLAGS) -specs=gba.specs $(OFILES) $(LIBPATHS) $(LIBS) -o $@
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I dont want the LIBS/LIBDIRS that is defined above
<br/>
I just want it to search in a folder ive named LIBRARIES
<br/>
like this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
BUILD		:=	Build
<br/>
SOURCES		:=	Sources
<br/>
INCLUDES	:=	Includes
<br/>
LIBRARIES	:=	Libraries
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Thanks in advance</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
