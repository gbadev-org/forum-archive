<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Timing in a GBA Game - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > Timing in a GBA Game</h2>
<div id="posts">
<div class="post">
    <h4>#111459 - Diirewolf - Wed Dec 06, 2006 7:30 pm</h4>
    <div class="postbody"><span class="postbody">Ok I understand how to use hardware timers with the GBA but how would I make use of this in my game? I am moving from DirectX Game Programming so usually we would have something called AbsoluteTime which from that we can do all the timing calculations and decide if for example if we have to switch to the next frame of animation depending on its delay. Is the approach the same with the GBA or completely different and how would you go about doing something like that?
<br/>
Thanks</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111461 - kusma - Wed Dec 06, 2006 7:45 pm</h4>
    <div class="postbody"><span class="postbody">in the gba-world you can usually count the vblanks to control animation speed.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111464 - Diirewolf - Wed Dec 06, 2006 7:59 pm</h4>
    <div class="postbody"><span class="postbody">how does that work? how many vblanks every second? and how would i use it?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111465 - kusma - Wed Dec 06, 2006 8:11 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Diirewolf wrote:</b></span></td> </tr> <tr> <td class="quote">how does that work? how many vblanks every second? and how would i use it?</td> </tr></table><span class="postbody">
<br/>
<br/>
59.59, and you just increment a counter in your vblank interrupt.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111477 - poslundc - Wed Dec 06, 2006 10:34 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>kusma wrote:</b></span></td> </tr> <tr> <td class="quote">59.59, and you just increment a counter in your vblank interrupt.</td> </tr></table><span class="postbody">
<br/>
<br/>
And most games consider that to be close enough to 60 for rock and roll.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111482 - Ant6n - Thu Dec 07, 2006 12:33 am</h4>
    <div class="postbody"><span class="postbody">in my game i keep a double precision float that counts up 1/59.727500569605832763727500569606 every frame ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111484 - gmiller - Thu Dec 07, 2006 12:47 am</h4>
    <div class="postbody"><span class="postbody">But counting with a float on a machine that must simulate floating point hardware is slow and the code adds to the program size (all of the floating point simulation library) when you do not need any of it normally.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111510 - tepples - Thu Dec 07, 2006 4:45 am</h4>
    <div class="postbody"><span class="postbody">If you want to be accurate without floating point, you can pretend it's 657/11 = 59.727272... fps, which is probably within tolerances for the GBA crystal. The Bresenham algorithm for the clock divider is thus: Each frame, add 11 to a counter, and whenever it reaches 657, subtract 657 and add a second.
<br/>
<br/>
If you want to be <span style="font-style: italic">really</span> accurate without floating point, you can use what is thought to be the spec (262144/4389 fps): Each frame, add 4389 to a counter, and whenever it reaches 262144, subtract 262144 and add a second.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111522 - Ant6n - Thu Dec 07, 2006 7:19 am</h4>
    <div class="postbody"><span class="postbody">actually i dont count like that, just playing the precision joke further ;).
<br/>
I do have a cycle accurate 64 bit timer though.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111530 - keldon - Thu Dec 07, 2006 10:03 am</h4>
    <div class="postbody"><span class="postbody">No matter what you do the frame rate for the GBA is constant, and no amount of accuracy is going to change that. How do you suppose floating point will increase the accuracy? Reason being is that you will always be synchronized with the GBA frames, and if you are at 0.8 and ready to draw it makes no difference!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111550 - Diirewolf - Thu Dec 07, 2006 5:07 pm</h4>
    <div class="postbody"><span class="postbody">i get the point now that it does 60 vblanks a second but how would i implement that into code and do something like animation with that???
<br/>
thanks</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111553 - kusma - Thu Dec 07, 2006 5:14 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Diirewolf wrote:</b></span></td> </tr> <tr> <td class="quote">i get the point now that it does 60 vblanks a second but how would i implement that into code and do something like animation with that???
<br/>
thanks</td> </tr></table><span class="postbody">
<br/>
<br/>
something like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include &lt;gba_interrupt.h&gt;
<br/>
volatile int blanks = 0;
<br/>
void vblank()
<br/>
{
<br/>
   blanks++;
<br/>
}
<br/>
<br/>
<br/>
int main()
<br/>
{
<br/>
   irqSet(IRQ_VBLANK, vblank);
<br/>
   irqEnable(IRQ_VBLANK);
<br/>
<br/>
   while (1)
<br/>
   {
<br/>
      VBlankIntrWait();
<br/>
      animate_stuff(blanks);
<br/>
   }
<br/>
   return 0;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
now you'll get a stable 60hz timer in on your function animate_stuff(), ready for doing whatever you want.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111568 - Miked0801 - Thu Dec 07, 2006 8:02 pm</h4>
    <div class="postbody"><span class="postbody">Just an aside, the volatile keyword on the blanks var is a must - it prevents the compiler from optimizing code it shouldn't.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
