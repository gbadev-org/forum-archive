<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Setting display modes (REG_DISPCNT (0x4000000)) - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > Setting display modes (REG_DISPCNT (0x4000000))</h2>
<div id="posts">
<div class="post">
    <h4>#9237 - abilyk - Thu Jul 31, 2003 5:53 am</h4>
    <div class="postbody"><span class="postbody">Quick question:
<br/>
<br/>
My current macro for setting the display mode is as follows:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define SetMode(mode) (REG_DISPCNT = (mode))</td> </tr></table><span class="postbody">
<br/>
Through this method, I have to set every option I want each time I call the macro.  If I call
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">SetMode(MODE_0 | BG0_ENABLE);</td> </tr></table><span class="postbody">and then
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">SetMode(BG1_ENABLE);</td> </tr></table><span class="postbody">
<br/>
The MODE_0 option from the first call is overwritten, obviously.
<br/>
<br/>
<br/>
<br/>
Now, in my mind,
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define SetMode(mode) (REG_DISPCNT = (REG_DISPCNT | (mode)))</td> </tr></table><span class="postbody">should do what I want and allow me to add options as shown above.  However, this just gives me a blank screen.
<br/>
<br/>
I could have my SetMode macro update a 16-bit variable and just set REG_DISPCNT to that variable each time, but is there a more efficient way to do it?  Why won't the above macro work?
<br/>
<br/>
<br/>
<br/>
Also, tepples, from some of your code....
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">LCDMODE = 0 | LCDMODE_BG0 | LCDMODE_SPR;</td> </tr></table><span class="postbody">
<br/>
<br/>
Why are you ORing with 0?  Is this just a stylistic habit of yours, or is there a specific reason you're doing that?
<br/>
<br/>
Thanks,
<br/>
Andrew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9247 - tepples - Thu Jul 31, 2003 8:24 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>abilyk wrote:</b></span></td> </tr> <tr> <td class="quote">Now, in my mind,
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define SetMode(mode) (REG_DISPCNT = (REG_DISPCNT | (mode)))</td> </tr></table><span class="postbody">should do what I want and allow me to add options as shown above.  However, this just gives me a blank screen.
<br/>
<br/>
I could have my SetMode macro update a 16-bit variable and just set REG_DISPCNT to that variable each time, but is there a more efficient way to do it?  Why won't the above macro work?</span></td> </tr></table><span class="postbody">
<br/>
Easy: the force-blank bit is set before the GBA jumps to your code. You'll need to add a ClearMode() macro that zeroes out REG_DISPCNT so that you can SetMode() more bits in.</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define ClearMode() (REG_DISPCNT = 0)</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Also, tepples, from some of your code....
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">LCDMODE = 0 | LCDMODE_BG0 | LCDMODE_SPR;</td> </tr></table><span class="postbody">
<br/>
Why are you ORing with 0?  Is this just a stylistic habit of yours, or is there a specific reason you're doing that?</span></td> </tr></table><span class="postbody">
<br/>
(To folks at home: I use different register names that make sense to me. LCDMODE in my header corresponds to REG_DISPCNT in the purported official register list.)
<br/>
<br/>
The 0 represents mode 0. If I were using mode 3 (240x160 pixel high color), it would look like (with my header)</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">LCDMODE = 3 | LCDMODE_BG2 | LCDMODE_SPR;</td> </tr></table><span class="postbody">
<br/>
Notice where the 3 goes.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
