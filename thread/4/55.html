<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Trying to link a binary file to a GCC rom???? Help? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Coding > Trying to link a binary file to a GCC rom???? Help?</h2>
<div id="posts">
<div class="post">
    <h4>#287 - notron - Sun Jan 05, 2003 11:11 pm</h4>
    <div class="postbody"><span class="postbody">I am trying to link a pure binary file to a compiled C image using GCC (G++) and following the instructions from the FAQ at DEVRS/GBA.
<br/>
quoting....................................................................................
<br/>
5) *** Convert your data to .o (gcc object) file #2 ***
<br/>
If you are using DevKitAdv, or crtls v1.2 or later, then you can use the following technique without needing to modify your lnkscript.  Do the following:
<br/>
objcopy -I binary -O elf32-little in_file out_file.all.rodata.ext
<br/>
(Ignore the "architecture UNKNOWN" warning message.)
<br/>
This will force the lnkscript to put all sections in this file into the .rodata (read-only data / ROM) section. To be able to access this data from your C code use the following:
<br/>
typedef unsigned char u8;
<br/>
extern const u8 _binary_outname_all_rodata_ext_start [ ];
<br/>
(The symbols _binary_outname_all_rodata_ext_size &amp; _binary_outname_all_rodata_ext_end are also available. However, the "size" symbol seems to be an address to a value rather than the value itself so you may need to do -&gt; (u32)&amp;_binary..._size )
<br/>
endquoting...................................................................................
<br/>
<br/>
Everything works fine as far as actually causing the binary image to be appended to the rom image. But when I try to access the binary data using the predefined _binary_&lt;outname&gt;_all_rodata_&lt;ext&gt;_start[] construct, the linker always gives me an unresolved external reference.
<br/>
It seems like the objcopy routine does not create the symbol in its symbol table using the method above.
<br/>
<br/>
Any help on resolving this would be much appreciated.<br/>_________________<br/>MysticX is The Defender</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#293 - Touchstone - Mon Jan 06, 2003 1:12 am</h4>
    <div class="postbody"><span class="postbody">Not that this really helps but a generic tip is to open your object file in a binary editor and search for something that looks like your symbol. I'm thinking that maybe there's something like an additional underscore or something in the symbolname that's causing your headache. You could try and remove the reference to your symbol so you can atleast link the executable and generate a mapfile, that way you can have a look in the map file and search for your symbol there. This isn't really recommended because the data might get optimized away so the symbol don't even make it to the mapfile. Uhm.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#295 - notron - Mon Jan 06, 2003 1:39 am</h4>
    <div class="postbody"><span class="postbody">Touch, 
<br/>
thanks again. I searched out the label in the 'o' file for the binary that i was trying to append and found that the label that objcopy is creating for the section of data is entitled:
<br/>
<span style="font-weight: bold">_binary_&lt;infile_name&gt;_&lt;infile_ext&gt;_start</span>
<br/>
<br/>
rather than the 
<br/>
<span style="font-weight: bold">_binary_&lt;outfile_name&gt;_all_roda_&lt;outfile_ext&gt;_start</span>
<br/>
<br/>
construction that is posted in the FAQ on the DEVERS/GBA website.
<br/>
<br/>
I will send Jeff F a note to let him know of the difference.  Once I changed it, Presto! everything linked perfectly!<br/>_________________<br/>MysticX is The Defender</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#299 - MrMr[iCE] - Mon Jan 06, 2003 2:36 am</h4>
    <div class="postbody"><span class="postbody">On gbadev.org, in tools, misc section, theres a file called bin2o, by Anli (Not to be confused with the bin2o that comes with devkit advance, the packaged bin2o is not too useable from what I hear)
<br/>
This program has worked perfectly for me everytime to generate .o files 
<br/>
to link to my projects (for const data at least):
<br/>
<br/>
bin2o /const /interwork infile.bin outfile.o identifier
<br/>
<br/>
for example,  if I had a file of raw pixel data for an image:
<br/>
<br/>
bin2o /const /interwork image.raw image.o imageData
<br/>
<br/>
and in C you would:
<br/>
extern const u16 imageData[];
<br/>
<br/>
if you happen to have lots of little .o files and dont wish to change your 
<br/>
link line everytime you add another .o, you could also do:
<br/>
<br/>
ar rc resource.a file1.o file2.o file3.o....
<br/>
<br/>
That will create the file resource.a, which is an archive of all the .o files
<br/>
you passed in to ar. Link to your project as you would a .o file, and you're
<br/>
set.<br/>_________________<br/>Does the corpse have a familiar face?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#306 - notron - Mon Jan 06, 2003 3:05 am</h4>
    <div class="postbody"><span class="postbody">MrMr,
<br/>
<br/>
Thanks for the tip.  I will check it out as well as the archive creator.<br/>_________________<br/>MysticX is The Defender</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
