<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>OAM - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > OAM</h2>
<div id="posts">
<div class="post">
    <h4>#8808 - whodoo - Sun Jul 20, 2003 5:50 pm</h4>
    <div class="postbody"><span class="postbody">right now Im doing like this
<br/>
<br/>
u16* OAM = (u16*)0x7000000;
<br/>
OAMEntry sprites[128];
<br/>
<br/>
the OAMEntry struct contains 4 u16 variables... then, after VBlank, I just copy the stuff from sprites to OAM..
<br/>
WaitForVsync();
<br/>
Copy everything from sprite to OAM with DMA..
<br/>
everything works..
<br/>
<br/>
but if I do something like
<br/>
<br/>
OAMEntry *sprites = (OAMEntry*)0x7000000, so that when I change a sprite the change will directly go into the memory(so I dont have to copy it), the sprites  are moving faster and the program?s acting grazy..why?s that?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8809 - johnny_north - Sun Jul 20, 2003 6:07 pm</h4>
    <div class="postbody"><span class="postbody">Accoring to the specs and faqs, you can only write to the actual OAM memory in the vblank. This means that if you have a gob of sprites that have to have different attributes chaged every frame, you must do it all in the vblank. I've never actually tried your suggested approach, but it would seem to limit greatly what you can do with sprites.
<br/>
<br/>
If you have a special case thing going, by all means. But if you don't, make it easier on yourself and just use the copy method. If you're running into speed issues, look to optimize where it counts. After all, vblank doesn't last for ever, and other things are more appropriate for it. map changes, updating sound buffers etc...
<br/>
<br/>
BTW using DMA 3 would speed this along if you're not already using it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8811 - whodoo - Sun Jul 20, 2003 6:17 pm</h4>
    <div class="postbody"><span class="postbody">I tried to use the seconds method.. and I changed the sprite-info after VBlank.. still the same result?..why?..cuz
<br/>
watiforvsync();
<br/>
changesprites(); // directly to mem
<br/>
<br/>
would be the same stuff as:
<br/>
changesprites();
<br/>
watiforvsync();
<br/>
copysprites();
<br/>
<br/>
?..but it only works good with the last code</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8813 - johnny_north - Sun Jul 20, 2003 6:27 pm</h4>
    <div class="postbody"><span class="postbody">In both examples you are changing actuall OAM memory "in" the vblank. You have a number of cycles to do this. You don't have to do this right at the begining of the vblank. The key is doing it during the vblank period.
<br/>
<br/>
Make sure you set your pointer correctly.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8814 - whodoo - Sun Jul 20, 2003 6:31 pm</h4>
    <div class="postbody"><span class="postbody">yeah the pointer is set right.. but.. in both cases I do change the OAM-memory in the VBLank..but when I dont "copy" it from sprites the program?s acting crazy</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8815 - whodoo - Sun Jul 20, 2003 6:37 pm</h4>
    <div class="postbody"><span class="postbody">the things is, the program?s running faster or something...the sprites are moving very fast and stuff</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8822 - ampz - Sun Jul 20, 2003 11:58 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>johnny_north wrote:</b></span></td> </tr> <tr> <td class="quote">After all, vblank doesn't last for ever, and other things are more appropriate for it. map changes, updating sound buffers etc...
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
You are absolutely right, vblank does not last forever, so let's not waste it updating sound buffers. It is much more logical to do that directly <span style="font-style: italic">after</span> vblank. Right?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8823 - johnny_north - Mon Jul 21, 2003 1:20 am</h4>
    <div class="postbody"><span class="postbody">I'll grant you that. I suppose there's more than one way to update a sound buffer.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8827 - tepples - Mon Jul 21, 2003 4:01 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ampz wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>johnny_north wrote:</b></span></td> </tr> <tr> <td class="quote">After all, vblank doesn't last for ever, and other things are more appropriate for it. map changes, updating sound buffers etc...
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
You are absolutely right, vblank does not last forever, so let's not waste it updating sound buffers. It is much more logical to do that directly <span style="font-style: italic">after</span> vblank. Right?</span></td> </tr></table><span class="postbody">
<br/>
Sound needs a timer to tell when a given buffer is done playing, and vblank is the easiest timer to base that on (provided your buffer size is four times a factor of 70224). Vcount would work just as well, but it's a bit more complicated to set up a timer that updates sound buffers on vcount if there are different tasks to do at different vcounts.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8897 - ampz - Wed Jul 23, 2003 1:41 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ampz wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>johnny_north wrote:</b></span></td> </tr> <tr> <td class="quote">After all, vblank doesn't last for ever, and other things are more appropriate for it. map changes, updating sound buffers etc...
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
You are absolutely right, vblank does not last forever, so let's not waste it updating sound buffers. It is much more logical to do that directly <span style="font-style: italic">after</span> vblank. Right?</span></td> </tr></table><span class="postbody">
<br/>
Sound needs a timer to tell when a given buffer is done playing, and vblank is the easiest timer to base that on (provided your buffer size is four times a factor of 70224). Vcount would work just as well, but it's a bit more complicated to set up a timer that updates sound buffers on vcount if there are different tasks to do at different vcounts.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Yes, but as I said, a very convenient place to do it is immediately after vblank. The result is the same as if you do it at the beginning of vblank.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
