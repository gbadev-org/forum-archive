<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>sprite initialization - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Coding > sprite initialization</h2>
<div id="posts">
<div class="post">
    <h4>#14133 - plasma - Wed Dec 31, 2003 2:37 am</h4>
    <div class="postbody"><span class="postbody"><span style="color: darkblue">If a game has several levels like Megaman, do all the sprites have to be copied into OAM and set offscreen? If there are, say, 80 sprites in one level and 20 sprites within another, can they be copied separately at different times?</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14135 - XeroxBoy - Wed Dec 31, 2003 3:06 am</h4>
    <div class="postbody"><span class="postbody">Definitely - you can even copy new sprites in <span style="font-style: italic">during</span> a level!
<br/>
<br/>
=D</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14137 - plasma - Wed Dec 31, 2003 3:23 am</h4>
    <div class="postbody"><span class="postbody"><span style="color: darkblue">well then, o great Xerox Boy (no sarcasm), can you tell me how?</span><br/>_________________<br/>ΩΠΣ</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14138 - XeroxBoy - Wed Dec 31, 2003 3:30 am</h4>
    <div class="postbody"><span class="postbody">That depends on the structure of your code/level data, of course, but generally all you need to do is store a list of the enemies in your level, and as you move your character and they become visible, you reserve them a spot in OAM, copy their graphics/palette into VRAM (using DMA, preferably), and then properly set their OAM attributes. Of course, you should generally be using a shadow OAM, but whatever.
<br/>
<br/>
And, uh, thanks for the (undeserved) flattery :P
<br/>
<br/>
If anything above doesn't make sense, check out <a class="postlink" href="http://www.thepernproject.com" target="_blank">The PERN Project</a> tutorials.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14141 - plasma - Wed Dec 31, 2003 3:43 am</h4>
    <div class="postbody"><span class="postbody"><span style="color: darkblue">Thanks a great many stuffed pizzas. I've already been to dovoto's site, but he hasn't updated it in a while so it doesnt help much. All I ask now is how to implement a shadow OAM.</span><br/>_________________<br/>ΩΠΣ</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14142 - XeroxBoy - Wed Dec 31, 2003 4:02 am</h4>
    <div class="postbody"><span class="postbody">This actually <span style="font-style: italic">is</span> in PERN's tutorials, but I could see how you might miss it (especially since he doesn't use the same lingo as I do).
<br/>
<br/>
A shadow OAM is just an alternate version of the OAM, stored in memory. Instead of modifying the actual OAM, you make your modifications to the shadow version, then at the end of your game loop, you DMA it over the real OAM. 
<br/>
<br/>
As dovoto does it:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
u16* OAM = (u16*)0x7000000; //this is actual OAM memory
<br/>
OAMentry sprites[128]; //this is my array of sprites
<br/>
<br/>
//.... you'd modify sprites whenever you want to make changes to OAM
<br/>
<br/>
// At the end of your game loop, you'd then call the following function
<br/>
<br/>
//Copy our sprite array to OAM
<br/>
void CopyOAM(void)
<br/>
{
<br/>
<br/>
        u16 loop;
<br/>
        u16* temp;
<br/>
<br/>
        temp = (u16*)sprites;
<br/>
        for(loop = 0; loop &lt; 128*4; loop++) OAM[loop] = temp[loop];
<br/>
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14144 - crossraleigh - Wed Dec 31, 2003 4:19 am</h4>
    <div class="postbody"><span class="postbody">You should look at Rafael Baptista's <a class="postlink" href="http://www.gamasutra.com/features/20010509/baptista_pfv.htm" target="_blank"><span style="font-style: italic">Gameboy Advance Resource Management</span> (printer friendly version)</a> article for a more indepth explanation. Also, the <a class="postlink" href="http://www.suddenpresence.com/sgade/" target="_blank">SGADE</a> library quite cleanly implements shadow OAM in <span style="font-style: italic">SoSpriteManager.c</span>.
<br/>
<br/>
As a side note, I think it's worth mentioning the benefit of putting shadow OAM in IWRAM. DMA from IWRAM is only 2-3 cycles per word. I actually picked that trick up from dovoto himself one day on <span style="font-style: italic">#gbadev</span>.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14145 - XeroxBoy - Wed Dec 31, 2003 4:27 am</h4>
    <div class="postbody"><span class="postbody">Correct me if I'm wrong, but the given example would but the shadow OAM into IWRAM, wouldn't it? Unless otherwise specified, variables are placed into IWRAM, and constants are placed into ROM.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14147 - crossraleigh - Wed Dec 31, 2003 4:54 am</h4>
    <div class="postbody"><span class="postbody">Well, I don't like getting too conversational on a board used so much as a reference; this information about IWRAM is widely available.
<br/>
<br/>
At any rate, the answer is: No, variables are placed in external work RAM by default. Internal work ram is a 32kb area embedded in the CPU. It has a 32 bit bus while EWRAM and ROM only have a 16 bit bus. To place a variable in IWRAM, declare it something like this:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int foo __attribute__ ((section (".iwram")));</td> </tr></table><span class="postbody">
<br/>
<br/>
Also, the example you gave doesn't use DMA at all. It just loops through and copies each entry.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14148 - XeroxBoy - Wed Dec 31, 2003 5:04 am</h4>
    <div class="postbody"><span class="postbody">In my linkscript, at least, all variables - local and global - are placed in IWRAM. I'm not alone, either, as evidenced in <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=2515&amp;postdays=0&amp;postorder=asc&amp;start=11" target="_blank">this thread</a>.
<br/>
<br/>
Yeah, I probably should've shown an example with DMA. Apologies all around.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14149 - plasma - Wed Dec 31, 2003 5:23 am</h4>
    <div class="postbody"><span class="postbody"><span style="color: darkblue">what version of linkscript do you have?</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14150 - XeroxBoy - Wed Dec 31, 2003 5:38 am</h4>
    <div class="postbody"><span class="postbody">I'm fairly certain it's the one that comes included with DevKitAdvance-r5-beta3.
<br/>
<br/>
I can't verify this, however, as it appears Sourceforge is down. Terribly sorry.
<br/>
<br/>
In any case, it's easy to find out where your compiler is stashing your variables - create a simple program that merely creates two variables (a global and a local), assigns them a value, and then loops infinitely. Without too much difficulty, you should be able to locate the two variables in Visual Boy Advance's memory viewer.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14151 - sajiimori - Wed Dec 31, 2003 5:38 am</h4>
    <div class="postbody"><span class="postbody">The lnkscript included with DevKit Advance puts variables in IWRAM by default.  A few common ways of using EWRAM are:
<br/>
<br/>
1)  Insert a special tag to tell the compiler where to put a particular variable.
<br/>
<br/>
2)  Use malloc.
<br/>
<br/>
3)  Make a struct to contain all the data and recast the base address of EWRAM as an instance of the struct.  Don't combine this method with any other.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14154 - Paul Shirley - Wed Dec 31, 2003 5:52 am</h4>
    <div class="postbody"><span class="postbody">removed</span><span class="gensmall"><br/><br/>Last edited by Paul Shirley on Sun Mar 28, 2004 9:26 pm; edited 2 times in total</span></div>    
</div>
<div class="post">
    <h4>#14157 - crossraleigh - Wed Dec 31, 2003 6:02 am</h4>
    <div class="postbody"><span class="postbody">My sincerest apologies. I feel quite the jerk. An <span style="font-style: italic">nm</span> of my code shows all my non-<span style="font-style: italic">const</span> data in IWRAM, even without the attribute. I will try to be more careful before going headlong in spreading such disinformation.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
