<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Display image in mode3 or mode5 - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > Display image in mode3 or mode5</h2>
<div id="posts">
<div class="post">
    <h4>#4347 - delbogun - Fri Mar 28, 2003 7:14 pm</h4>
    <div class="postbody"><span class="postbody">I have problem displaying an image in mode 3 or 5. I used Kaleid to convert my bmp into a mode3 gba image. Don't know if I understand this mode correctly... but this is how I did it:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
typedef unsigned short u16;
<br/>
typedef unsigned long u32;
<br/>
<br/>
#define REG_DISPCNT  *(u32*) 0x4000000
<br/>
#define MODE_3       0x3
<br/>
#define BG2_ENABLE   0x400
<br/>
<br/>
#include "picture.h"
<br/>
<br/>
u16* videoBuffer = (u16*) 0x6000000;
<br/>
<br/>
int main( void )
<br/>
{
<br/>
    int x, y;
<br/>
<br/>
    // set mode 3
<br/>
    REG_DISPCNT = MODE_3 | BG2_ENABLE;
<br/>
<br/>
    // draw picture
<br/>
    for( y = 0; y &lt; 160; y++ )
<br/>
    {
<br/>
        for( x = 0; x &lt; 240; x++ )
<br/>
            videoBuffer[y*240 + x] = picData[y*240 + x];
<br/>
    }
<br/>
<br/>
    while( 1 )
<br/>
    {
<br/>
<br/>
    }
<br/>
<br/>
    return 0;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Anyone knows what i did wrong?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4354 - Lord Graga - Fri Mar 28, 2003 9:28 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code"> typedef unsigned short u16; 
<br/>
typedef unsigned long u32; 
<br/>
<br/>
#define REG_DISPCNT  *(u32*) 0x4000000 
<br/>
#define MODE_3       0x3 
<br/>
#define BG2_ENABLE   0x400 
<br/>
<br/>
#include "picture.h" 
<br/>
<br/>
u16* videoBuffer = (u16*) 0x6000000; 
<br/>
<br/>
int main( void ) 
<br/>
{ 
<br/>
    int i; 
<br/>
<br/>
    // set mode 3 
<br/>
    REG_DISPCNT = MODE_3 | BG2_ENABLE; 
<br/>
<br/>
    // draw picture 
<br/>
   for( i = 0; i &lt; 240*160; i++ ) 
<br/>
       videoBuffer[i] = picData[i]; 
<br/>
<br/>
    while( 1 ) ;
<br/>
    return 0; 
<br/>
} </td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4356 - Dev - Fri Mar 28, 2003 9:44 pm</h4>
    <div class="postbody"><span class="postbody">Unless I missed something here, the code Graga posted should have the same functionality -- although I might be assuming that your picData is stored as a u16 array 240x160.
<br/>
<br/>
How does Kaleid define picData? -- and what is the default type of picData in your compiler, if none is specified?
<br/>
<br/>
Also, is picData aligned on a u16 boundary?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4358 - Vortex - Fri Mar 28, 2003 10:08 pm</h4>
    <div class="postbody"><span class="postbody">It could be done even faster using DMA:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
typedef unsigned short u16;
<br/>
typedef unsigned long u32;
<br/>
<br/>
#define REG_DISPCNT  *(u32*) 0x4000000
<br/>
#define MODE_3       0x3
<br/>
#define BG2_ENABLE   0x400
<br/>
<br/>
#include "picture.h"
<br/>
<br/>
u16* videoBuffer = (u16*) 0x6000000;
<br/>
<br/>
int main( void )
<br/>
{
<br/>
    int x, y;
<br/>
<br/>
    // set mode 3
<br/>
    REG_DISPCNT = MODE_3 | BG2_ENABLE;
<br/>
<br/>
    // draw picture
<br/>
   (REG_DMA3SAD)     = (u32) picData;
<br/>
   (REG_DMA3DAD)     = videoBuffer;
<br/>
   (REG_DMA3CNT_L)  = (160 * 240 / 2);
<br/>
   (REG_DMA3CNT_H)  = 0x9400;
<br/>
<br/>
    while( 1 )
<br/>
    {
<br/>
<br/>
    }
<br/>
<br/>
    return 0;
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4369 - delbogun - Sat Mar 29, 2003 12:25 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dev wrote:</b></span></td> </tr> <tr> <td class="quote">although I might be assuming that your picData is stored as a u16 array 240x160.</td> </tr></table><span class="postbody">
<br/>
<br/>
Yes, that's correct. the image is 240x160 and 32bit before I converted it with Kaleid. And the picData is u16. This is what is said in the picture.h:
<br/>
unsigned short int picData[38400] = { 0x0000, ... }
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dev wrote:</b></span></td> </tr> <tr> <td class="quote">How does Kaleid define picData? -- and what is the default type of picData in your compiler, if none is specified?</td> </tr></table><span class="postbody">
<br/>
<br/>
I have no idea. I just started programming. I'm using default settings when I use Dev-Kit Advance by Jason Wilkins. 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dev wrote:</b></span></td> </tr> <tr> <td class="quote">Also, is picData aligned on a u16 boundary?</td> </tr></table><span class="postbody">
<br/>
<br/>
Sorry, don't know what you mean with u16 boundary.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Vortex wrote:</b></span></td> </tr> <tr> <td class="quote">It could be done even faster using DMA:</td> </tr></table><span class="postbody">
<br/>
<br/>
How do I define DMA?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4458 - Vortex - Mon Mar 31, 2003 4:34 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">How do I define DMA?</td> </tr></table><span class="postbody">
<br/>
<br/>
As defined in gba.h:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define REG_DMA3SAD     *(vu32*)0x40000D4   //DMA3 Source Address
<br/>
#define REG_DMA3SAD_L   *(vu16*)0x40000D4   //DMA3 Source Address Low Value
<br/>
#define REG_DMA3SAD_H   *(vu16*)0x40000D6   //DMA3 Source Address High Value
<br/>
#define REG_DMA3DAD     *(vu32*)0x40000D8   //DMA3 Destination Address
<br/>
#define REG_DMA3DAD_L   *(vu16*)0x40000D8   //DMA3 Destination Address Low Value
<br/>
#define REG_DMA3DAD_H   *(vu16*)0x40000DA   //DMA3 Destination Address High Value
<br/>
#define REG_DMA3CNT     *(vu32*)0x40000DC   //DMA3 Control (Amount)
<br/>
#define REG_DMA3CNT_L   *(vu16*)0x40000DC   //DMA3 Control Low Value
<br/>
#define REG_DMA3CNT_H   *(vu16*)0x40000DE   //DMA3 Control High Value
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
