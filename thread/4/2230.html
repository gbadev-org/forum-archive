<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>REG_VCOUNT doesnt change - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Coding > REG_VCOUNT doesnt change</h2>
<div id="posts">
<div class="post">
    <h4>#11667 - yanos - Wed Oct 15, 2003 4:50 pm</h4>
    <div class="postbody"><span class="postbody">Im trying a random function founded on this board but im having a small problem with the seed. It is based on the REG_VCOUNT register, but mine seems to be stuck at the same value. My set_random_seed(u8 offset) functions looks like this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
random_seed = REG_VCOUNT + offset;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
where random_seed =&gt; volatile s32 random_seed;
<br/>
and REG_VCOUNT =&gt; #define REG_VCOUNT *(u16*)0x4000006
<br/>
<br/>
I call this function once in a while in my code and random_seed  always ended up to be the same. I first tought that was because I was waiting for vblank before calling it, but commenting that part of the code didnt change anything. Also, before calling this function, there is a title screen displayed, waiting for the user to press 'start' before continuing, so set_random_seed() is always called 'randomly'.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11668 - DekuTree64 - Wed Oct 15, 2003 5:10 pm</h4>
    <div class="postbody"><span class="postbody">You need to define REG_VCOUNT as volatile too. 
<br/>
#define REG_VCOUNT *(volatile u16*)0x4000006<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11669 - niltsair - Wed Oct 15, 2003 5:14 pm</h4>
    <div class="postbody"><span class="postbody">You must declare the register as volatile, else your compiler assume the value never change and does optimisation accordingly.
<br/>
<br/>
#define REG_VCOUNT *(volatile u16*)0x4000006
<br/>
<br/>
(edit)
<br/>
Darn, i was beaten to it ;-)<br/>_________________<br/>-Inside every large program is a small program struggling to get out. (Hoare's Law of Large Programs)
<br/>
-The man who can smile when things go wrong has thought of someone he can blame it on. (Nixon's Theorem)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11671 - yanos - Wed Oct 15, 2003 5:45 pm</h4>
    <div class="postbody"><span class="postbody">I didnt know you also have to define the register as volatile too. But it doesnt seem to solve my problem. REG_VCOUNT is still always the same. Any clue?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11672 - yanos - Wed Oct 15, 2003 6:14 pm</h4>
    <div class="postbody"><span class="postbody">forget it! My REG_VCOUNT is changing. It's just that each time I call my function, it ends up that REG_VCOUNT is always at the same value. Dont really know why thought, maybe it's because the registers for the input is always refreshed at a very precise moment, so no matter how long the user waits before pressing the start button, my program detect it always at the same REG_VCOUNT value... or something like that :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11673 - DekuTree64 - Wed Oct 15, 2003 6:18 pm</h4>
    <div class="postbody"><span class="postbody">Hmm, is it stuck at 0, or some other value? I can't think of any way to make it freeze up.
<br/>
Try doing a while(REG_VCOUNT != 100); (or any number between 0 and 160) just to see if it's moving at all.
<br/>
<br/>
edit: nevermind then^_^<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11674 - niltsair - Wed Oct 15, 2003 6:20 pm</h4>
    <div class="postbody"><span class="postbody">(Edit)
<br/>
Ok, never mind what i just wrote, do this instead:
<br/>
<br/>
Create a timer out of VBlank, use this timer value instead of VCount. There's some posts around about doing a timer out of VBlank. Basis is just enable VBlank interrupt, and in it increase a global variable value everytime. This was the way specified to generate the random number too, in the post about it.<br/>_________________<br/>-Inside every large program is a small program struggling to get out. (Hoare's Law of Large Programs)
<br/>
-The man who can smile when things go wrong has thought of someone he can blame it on. (Nixon's Theorem)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11677 - yanos - Wed Oct 15, 2003 6:51 pm</h4>
    <div class="postbody"><span class="postbody">I started a timer while the user is waiting to press the start button to start the game. So, when it happens, the value in the timer is enough random for me and I set the seed based on that value. In a way, its very close to the solution you proposed, and its working great. The bombs in my minesweeper game are not always at the same place anymore ;)
<br/>
<br/>
thanks for your help!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11678 - niltsair - Wed Oct 15, 2003 7:16 pm</h4>
    <div class="postbody"><span class="postbody">Glad to help.
<br/>
<br/>
I see you're a compatriot from Montreal too. Hope you're car wasn't parked near the yesterday protest ;-)<br/>_________________<br/>-Inside every large program is a small program struggling to get out. (Hoare's Law of Large Programs)
<br/>
-The man who can smile when things go wrong has thought of someone he can blame it on. (Nixon's Theorem)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11680 - yanos - Wed Oct 15, 2003 8:18 pm</h4>
    <div class="postbody"><span class="postbody">no, im just a poor student without a car :)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
