<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Using the Real time clock.... - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > Using the Real time clock....</h2>
<div id="posts">
<div class="post">
    <h4>#67311 - Fenderocker - Mon Jan 16, 2006 10:45 pm</h4>
    <div class="postbody"><span class="postbody">How do I access(did I spell that right?) the real time clock on the EFA linker II I'm ordering. I want to  make a game that plays differently at night time and day time.
<br/>
<br/>
thanks!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#67365 - pure_ev1l - Tue Jan 17, 2006 2:14 pm</h4>
    <div class="postbody"><span class="postbody">good question, I'm kinda up for doing the same thing.
<br/>
<br/>
one thing to note, the code that ppl give you may be wrong as pogoshell doesn't report time correctly.
<br/>
<br/>
but that may be pogoshell bug.<br/>_________________<br/>-Rory
<br/>
<br/>
 "Planning makes for a boring life, but a good game"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#67612 - Fenderocker - Thu Jan 19, 2006 12:59 pm</h4>
    <div class="postbody"><span class="postbody">I didn't say anything about pogoshell................ I don't even know if i'm going to use it.........</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#67627 - pure_ev1l - Thu Jan 19, 2006 4:37 pm</h4>
    <div class="postbody"><span class="postbody">I know.
<br/>
<br/>
what I'm trying to say is it may be different from other flash cards as pogoshell reports incorrect time with EFA Linker cards.
<br/>
<br/>
so all I'm trying to say is if someone gives you code that applies to a different flash card beware.
<br/>
<br/>
tis all :-)<br/>_________________<br/>-Rory
<br/>
<br/>
 "Planning makes for a boring life, but a good game"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#67679 - Fenderocker - Thu Jan 19, 2006 9:48 pm</h4>
    <div class="postbody"><span class="postbody">Thanks I didn't know that. I'm still looking for the code though so if anyone knows please post!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#67721 - CyteX - Fri Jan 20, 2006 1:05 am</h4>
    <div class="postbody"><span class="postbody">Hi !
<br/>
<br/>
Sometimes the search function is very helpful ;)
<br/>
<br/>
AmpZ did a little test program and put it on his site. Have a look at <a href="http://forum.gbadev.org/viewtopic.php?t=2844" target="_blank">http://forum.gbadev.org/viewtopic.php?t=2844</a> there you'll find the link.
<br/>
<br/>
I didn't manage to get the Multiboot image from AmpZ to run with VBA, so I recompiled it with devkitARM as a normal card. It showed that an RTC is detected, but no time is displayed. Afterwards I download it to my EFA-II and it reports that no RTC is detected.
<br/>
<br/>
IMHO games using RTC does not need to be patched for use with EFA-II, but I got none, so I really couldn't verify that. Furthermore I'm quite sure AmpZ code is right, but maybe incomplete ? Or has a MB image to be used, so that no FLASH/ROM is overlaying the RTC address space ? Don't know.
<br/>
<br/>
Have you already asked for RTC information on the <a href="http://www.efa.cc" target="_blank">www.efa.cc</a> forum ?
<br/>
<br/>
I read out the EFA-II and give it to VBA, it does not run using the emulator, it stucks by initializing the RTC, I think, because it is accessing the addresses AmpZ used in his code.
<br/>
<br/>
After patching the EFA-II firmware runs on VBA. Now, its only a question of (spare) time till we might be able to access the U-Disk.
<br/>
<br/>
bye Cy'</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#67892 - Fenderocker - Sat Jan 21, 2006 3:52 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>CyteX wrote:</b></span></td> </tr> <tr> <td class="quote">Sometimes the search function is very helpful ;)</td> </tr></table><span class="postbody">
<br/>
No duh..... I just searched and couldn't find anything recent about my card on the forums so I decided to ask.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>CyteX wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
AmpZ did a little test program and put it on his site. Have a look at <a href="http://forum.gbadev.org/viewtopic.php?t=2844" target="_blank">http://forum.gbadev.org/viewtopic.php?t=2844</a> there you'll find the link.</td> </tr></table><span class="postbody">
<br/>
AmpZ site says nothing about EFA II...........
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>CyteX wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Have you already asked for RTC information on the <a href="http://www.efa.cc" target="_blank">www.efa.cc</a> forum ?</td> </tr></table><span class="postbody">
<br/>
I just looked there after you posted this.... There was only one topic about the RTC and only you had answered it giving the poor person no info.
<br/>
<br/>
If any one knows anything about this type of thing I would still like to know. I still can't find any tutorials about using the RTC.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#68116 - CyteX - Sun Jan 22, 2006 5:34 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Fenderocker wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
No duh..... I just searched and couldn't find anything recent about my card on the forums so I decided to ask.
<br/>
</td> </tr></table><span class="postbody">
<br/>
Hey, calm down, no problem read this =&gt;  ;)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Fenderocker wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
AmpZ site says nothing about EFA II...........
<br/>
</td> </tr></table><span class="postbody">
<br/>
Correct, but there is also nothing said it wouldn't, so isn't it worth a try ? Keep in mind he did it back in 2004 !
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Fenderocker wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
I just looked there after you posted this.... There was only one topic about the RTC and only you had answered it giving the poor person no info.
<br/>
</td> </tr></table><span class="postbody">
<br/>
Yes, afterwards I think my post on efa.cc is useless. The EFA guys wrote in their FAQ that they currently do not support or answer questions from the homebrew scene. So it is up to us.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Fenderocker wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
If any one knows anything about this type of thing I would still like to know. I still can't find any tutorials about using the RTC.</td> </tr></table><span class="postbody">
<br/>
OK, here we go: I figured out, that the EFA Firmware accesses the same addresses as Ampz Code which are $080000c4 c6 and c8. Ampz rtc_detect function writes to $080000c8 and read back the value from the same address. On EFA2 the rtc_detect function returns 0, so it seems that on EFA2 $080000c8 is implemented as write only register. Makes sense when RTC check is used for copy protection of comercial games. So comment the while-loop:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   if(rtc_detect())
<br/>
      typestr("  RTC Detected.");
<br/>
   else{
<br/>
      typestr("  No RTC Detected.");
<br/>
//      while(1);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Does the VCOUNTER has to be enabled in some way ? AFAIK not, but AmpZ RTC test stucks on my System (VBA and Real HW) when it is waiting for VSync. Hmm.. doesn't matter for the test, we do not need a VBL synchronization, so:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   //Main loop
<br/>
   while(1){
<br/>
      charpos=258;
<br/>
   //   scrWaitVSync();
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Now, all is fine and the RTC of my EFA2 is read out and displayed on screen (but with wrong day of week). Currently we haven't figured out how to set the clock, but do we need this ? As a starting point this should be sufficient.
<br/>
<br/>
<br/>
Furthermore, I think the function rtc_detect and rtc_end_transfer are staying in contrast. In rtc_detect writing 1 to $080000c8 is enabling the RTC, whereas in rtc_end_transfer the same thing is done to end the transfer ? Any comments on this ?
<br/>
<br/>
Hope it helps !
<br/>
<br/>
bye Cy'</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#68120 - Fenderocker - Sun Jan 22, 2006 6:36 pm</h4>
    <div class="postbody"><span class="postbody">So you're basicly saying that the code ampz wrote works on the hardware?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#68127 - CyteX - Sun Jan 22, 2006 7:21 pm</h4>
    <div class="postbody"><span class="postbody">Yes, it works, except the rtc_detect function. You must not rely its results on EFA2.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#68130 - kusma - Sun Jan 22, 2006 7:31 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Fenderocker wrote:</b></span></td> </tr> <tr> <td class="quote">So you're basicly saying that the code ampz wrote works on the hardware?</td> </tr></table><span class="postbody">
<br/>
i just tested the code on my efa aswell, and it does indeed work.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#68178 - Fenderocker - Sun Jan 22, 2006 11:48 pm</h4>
    <div class="postbody"><span class="postbody">Awsome that means that I can study up on his code and learn how to use the RTC!!! WAHOO!!!!!</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
