<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Alternate execution of code - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Coding > Alternate execution of code</h2>
<div id="posts">
<div class="post">
    <h4>#26576 - DiscoStew - Mon Sep 20, 2004 4:24 am</h4>
    <div class="postbody"><span class="postbody">I plan to take a bunch of C functions I made, and wrap them together into a library. Some of the functions use DMA3, which isn't so bad except for this instance. In another project, I plan to use this library and AAS together. Now AAS includes a DoDMA3 function that is a bit necessary for people not doing the single stmia instruction. Now, I'd like to link that function into my library so that it uses that if the AAS library is also in the project, or not use it if it isn't.
<br/>
<br/>
My idea was to check for the symbol __AAS__ (since the AAS.h file defines it) to see if the library was also being used, like such...</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#ifdef __AAS__
<br/>
#include "AAS.h"
<br/>
#endif</td> </tr></table><span class="postbody">
<br/>
..and in situations where I would use DMA3, I'd do this...</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#ifdef __AAS__
<br/>
AAS_DoWork(....function parameters....);
<br/>
#else
<br/>
{....whatever I plan to do with DMA3......}
<br/>
#endif</td> </tr></table><span class="postbody">
<br/>
<br/>
Now this was just an idea so that my library could be compatible with AAS, but my method isn't working. Perhaps someone out there knows what I am trying to do, and could help me with this problem. Any help would be appreciated.<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26578 - Krakken - Mon Sep 20, 2004 7:43 am</h4>
    <div class="postbody"><span class="postbody">That's exactly what I did when I used AAS and it seemed to work fine for me. What isn't working? DMA doesn't work when AAS is used? Does it work when it's not?
<br/>
<br/>
Also, make sure you're not including AAS when you're not using it.
<br/>
<br/>
NOTE:
<br/>
I just looked again at your code and you have this:
<br/>
<br/>
#ifdef __AAS__ 
<br/>
#include "AAS.h" 
<br/>
#endif
<br/>
<br/>
If __AAS__ is defined in AAS.h then that will never be true. as your checking before you even define it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26579 - DiscoStew - Mon Sep 20, 2004 8:19 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Krakken wrote:</b></span></td> </tr> <tr> <td class="quote">If __AAS__ is defined in AAS.h then that will never be true. as your checking before you even define it.</td> </tr></table><span class="postbody">
<br/>
<br/>
Hmmmm, why didn't I see of that before? Perhaps instead of trying to include the header over again, I should just use the prototype for AAS_DoDMA3. My code if kinda screwed up at the moment, as I was trying to just get the AAS portion of the code working, and it is late, so I will try sometime during the day tomorrow.<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26580 - MumblyJoe - Mon Sep 20, 2004 8:38 am</h4>
    <div class="postbody"><span class="postbody">Hmmm, I would suggest, although I havent tried this, that if you have the same syntax as another function (such as the bios CPUSet) for your dma3 copy, and you have a general header for your library, and want to include it after the AAS header...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#ifdef __AAS__
<br/>
#define DMA3Copy CPUSet
<br/>
#endif</td> </tr></table><span class="postbody">
<br/>
<br/>
It's a bit of a nasty hack, but it means you wouldn't have to put #ifdef's all through your code. A more elegant way might be with function pointers etc but thats up to you.<br/>_________________<br/><a class="postlink" href="http://www.hungrydeveloper.com" target="_blank">www.hungrydeveloper.com</a>
<br/>
Version 2.0 now up - guaranteed at least 100% more pleasing!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26588 - LOst? - Mon Sep 20, 2004 4:19 pm</h4>
    <div class="postbody"><span class="postbody">I'm using #ifdef too, and I tried something like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#ifdef BLA1 || BLA2
<br/>
</td> </tr></table><span class="postbody">
<br/>
It doesn't work :(
<br/>
How do you do something like this?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26589 - poslundc - Mon Sep 20, 2004 4:37 pm</h4>
    <div class="postbody"><span class="postbody">Try
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#if defined(BLA1) || defined(BLA2)
<br/>
     ...
<br/>
#endif</td> </tr></table><span class="postbody">
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26590 - Lord Graga - Mon Sep 20, 2004 4:37 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>MumblyJoe wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#ifdef __AAS__
<br/>
#define DMA3Copy CPUSet
<br/>
#endif</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
Very nasty because CPUSet doesn't have quite the same functions as DMA.
<br/>
<br/>
Lost(R):
<br/>
<br/>
Just do this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#ifdef BLA1
<br/>
//do it!
<br/>
#endif
<br/>
#ifdef BLA2
<br/>
//do it again! :P
<br/>
#endif</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
:P</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26591 - jd - Mon Sep 20, 2004 4:38 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
I plan to take a bunch of C functions I made, and wrap them together into a library. Some of the functions use DMA3, which isn't so bad except for this instance. In another project, I plan to use this library and AAS together. Now AAS includes a DoDMA3 function that is a bit necessary for people not doing the single stmia instruction. Now, I'd like to link that function into my library so that it uses that if the AAS library is also in the project, or not use it if it isn't.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Perhaps it would be easier to implement your own version of AAS_DoDMA3 and just use that in your code instead? That way it would work whether or not it was linked to AAS. In case it helps, the code for AAS_DoDMA3 is very simple:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
AAS_DoDMA3:
<br/>
   mov r3,#0x04000000
<br/>
   add r3,r3,#0xd4
<br/>
   stmia r3,{r0-r2}
<br/>
   bx lr
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Just change the name to DoDMA3 or something similar and then use that in your code instead.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26593 - LOst? - Mon Sep 20, 2004 6:00 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">Try
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#if defined(BLA1) || defined(BLA2)
<br/>
     ...
<br/>
#endif</td> </tr></table><span class="postbody">
<br/>
<br/>
Dan.</span></td> </tr></table><span class="postbody">
<br/>
Cool!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26594 - DiscoStew - Mon Sep 20, 2004 6:17 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for all the suggestions, but from what I see, I'm going to go with jd's version. Not only will it make my library compatible with AAS, but I could use this for any other DMA3 operations that I plan to do. thx again you all. Now I just need to try that when I get home today.<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
