<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>slow tiles - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > slow tiles</h2>
<div id="posts">
<div class="post">
    <h4>#1478 - whodoo - Sun Jan 19, 2003 2:37 pm</h4>
    <div class="postbody"><span class="postbody">I got a tiny problem..it takes about 5 seconds for the emulator to start a program when using tiles..I got 64x64 tiles and the screen is just black for some seconds for the game starts.. I always got this "delay" when working with tiles but Ive seen lots of other games which start emiedatlly(and they are using tiles too)..I?ve tried to sue DMA copy for the tiles but I still got this problem..whatcoul it depend on?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1480 - tepples - Sun Jan 19, 2003 3:24 pm</h4>
    <div class="postbody"><span class="postbody">Emulators take time to load from disk, and some emulators aren't completely loaded by the time they create the main window.
<br/>
<br/>
1. Does it happen on hardware?
<br/>
<br/>
2. If you don't have hardware, what happens if you set the palette (especially color 0) and turn the screen on before you write the tiles?  Is the delay still there?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1483 - Splam - Sun Jan 19, 2003 3:34 pm</h4>
    <div class="postbody"><span class="postbody">hmmm I noticed that on the test file you sent me to check on hardware ( a couple of seconds pause), I wondered at the time what it was doing.  Even if you copied enough data to fill the whole of vram it shouldn't take more than a frame using dma.  Only thing I could think of looking at it is your code to copy the map to vram but I just checked and it's not that.  Must be something in your setup somewhere. hmmm hard to tell from a debugger with no labels to work from :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1486 - tepples - Sun Jan 19, 2003 3:46 pm</h4>
    <div class="postbody"><span class="postbody">In that case, could you post the minimal source code that displays the problem?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1489 - whodoo - Sun Jan 19, 2003 4:10 pm</h4>
    <div class="postbody"><span class="postbody">this is the code before tha mainloop...(almost all)
<br/>
<br/>
<br/>
<br/>
REG_TM3D = 0;		
<br/>
REG_TM3CNT = TIME_FREQUENCY_1024 | TIME_ENABLE;
<br/>
<br/>
//set mode 1 and enable sprites and 1d mapping
<br/>
SetMode(MODE_1 | OBJ_ENABLE | OBJ_MAP_1D);
<br/>
<br/>
	// Sprites
<br/>
vaInitializeSprites();                       //set all sprites off screen (stops artifact)
<br/>
<br/>
  //pointer to tile where sprite starts
<br/>
for(int loop = 0; loop &lt; 256; loop++)        
<br/>
OBJPaletteMem[loop] = palette[loop];
<br/>
<br/>
for(loop = 0; loop &lt; 768; loop++)            
<br/>
{
<br/>
       	OAMData[loop] = pacanimData[loop];
<br/>
}
<br/>
<br/>
sprites[0].attribute0 = COLOR_256 | SQUARE | pacman.y;	        sprites[0].attribute1 = SIZE_16 | pacman.x;		      
<br/>
sprites[0].attribute2 = 0;              		
<br/>
<br/>
<br/>
<br/>
	//Let us set up the backgroud two structure and enable the background
<br/>
<br/>
	bg2.number = 2;				//background number 0-3
<br/>
	bg2.charBaseBlock = 0;                  //tile data position (right at the start of the available memory on 16Kb boundary)
<br/>
	bg2.screenBaseBlock = 28;		//map data position on 2Kb boundary
<br/>
	bg2.colorMode = BG_COLOR_256;           //256-colour background
<br/>
	bg2.size = ROTBG_SIZE_512x512;          //size of map
<br/>
	bg2.mosaic = 0;                         //not enabled
<br/>
	bg2.x_scroll = 120;			//scrolling variables
<br/>
	bg2.y_scroll = 80;
<br/>
<br/>
	//Point to correct tile
<br/>
	//Point to correct tile and map data, update the Background and Display registers accordingly
<br/>
<br/>
 	EnableBackground(&amp;bg2);
<br/>
<br/>
	for(loop = 0; loop &lt; 256; loop++)
<br/>
		BGPaletteMem[loop] = exptilesPalette[loop];     //load the background palette into memory
<br/>
<br/>
	for(loop = 0; loop &lt; exptiles_WIDTH * exptiles_HEIGHT /2; loop++)  //load tile image data
<br/>
		bg2.tileData[loop] = exptilesData[loop];
<br/>
<br/>
	//load the map image data
<br/>
	REG_DMA3SAD = (u32)map;
<br/>
	REG_DMA3DAD = (u32)bg2.mapData;
<br/>
	REG_DMA3CNT = 64*64/2 |DMA_16NOW;	
<br/>
*/		
<br/>
RotateBackground(&amp;bg2,angle,120,80,zoom); 	
<br/>
	//Main Game loop</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1493 - Kay - Sun Jan 19, 2003 4:43 pm</h4>
    <div class="postbody"><span class="postbody">You may try with FORCED_BLANK bit set (bit 7, 0x04000000) on real hardware during transfer, and clear it after completion.
<br/>
<br/>
Otherwise you may look at your CRT0.S file to remove inner loop and/or network booting/search code.
<br/>
<br/>
<br/>
-- Kay</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1570 - dummer Anf?nger - Mon Jan 20, 2003 10:28 am</h4>
    <div class="postbody"><span class="postbody">Can it be that u use dovotos sample?
<br/>
It is very slow because u calculate all thosse rotation values at the beginning.<br/>_________________<br/>... but im just a <span style="text-decoration: underline">dummy</span> <span style="font-weight: bold">Newbie</span>
<br/>
<br/>
(sorry for my terrible english)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1597 - whodoo - Mon Jan 20, 2003 5:12 pm</h4>
    <div class="postbody"><span class="postbody">yes it was the code to store sin/cos-values for the rotation...
<br/>
but if I disabled the function RotateBackground(bg, angle, scrollx, scrolly, zoom) or something, the "track" didnt show up...why?</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
