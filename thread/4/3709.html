<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>DevKitAdv Division - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Coding > DevKitAdv Division</h2>
<div id="posts">
<div class="post">
    <h4>#23462 - f(DarkAngel) - Tue Jul 13, 2004 3:55 pm</h4>
    <div class="postbody"><span class="postbody">Why doesn't devkitadv uses a swi instead of inserting a custom code? Or at least a command-line option that allows to switch between gcc code and swi. Is it too much work to modify gcc such way?<br/>_________________<br/>death scream...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23464 - poslundc - Tue Jul 13, 2004 4:21 pm</h4>
    <div class="postbody"><span class="postbody">I know that if I had a devkit with that feature, I would be disinclined to use it on account of a lack of portability to other development environments. If I want to use a SWI, I'll state it explicitly in the code.
<br/>
<br/>
That's not to say it might not be a worthwhile feature, but I doubt it's very high on anyone's priority list for that reason. I imagine most devkits already focus the majority of their energy on just being standards compliant, rather than creating new standards.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23474 - tepples - Tue Jul 13, 2004 6:27 pm</h4>
    <div class="postbody"><span class="postbody">When GCC wants to divide ('/') on ARM7, it calls a function in libgcc called __divsi3. That function takes dividend in r0 and divisor in r1 and returns the quotient, rounded toward 0, in r0. Another libgcc function is __modsi3 for '%', which takes dividend and divisor and returns the remainder in r0. The divide function in the GBA BIOS takes dividend in r0 and divisor in r1 and returns the quotient in r0 and the remainder in r1.
<br/>
<br/>
You can easily tell the linker to delegate __divsi3 and __modsi3 to the GBA BIOS rather than to libgcc by making a source code file called divide.s, containing code similar to the following <span style="font-weight: bold">(untested)</span>:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">.THUMB
<br/>
.THUMB_FUNC
<br/>
.ALIGN
<br/>
.GLOBL  __divsi3
<br/>
<br/>
__divsi3:
<br/>
  swi 6
<br/>
  bx lr
<br/>
<br/>
.THUMB
<br/>
.THUMB_FUNC
<br/>
.ALIGN
<br/>
.GLOBL  __modsi3
<br/>
<br/>
__modsi3:
<br/>
  swi 6
<br/>
  mov r0, r1
<br/>
  bx lr
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23484 - Miked0801 - Tue Jul 13, 2004 10:34 pm</h4>
    <div class="postbody"><span class="postbody">Yep - or link it to a custom are divide for even more speed :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23658 - f(DarkAngel) - Sat Jul 17, 2004 1:19 pm</h4>
    <div class="postbody"><span class="postbody">poslundc: this'd be a platform-specific optimization, not a new standard.
<br/>
tepples: i've asked this for speed maximization. a function call is not the best case. what i intended to say was an inline code, i guess that would be possible by modifying the internals of gcc.<br/>_________________<br/>death scream...</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
