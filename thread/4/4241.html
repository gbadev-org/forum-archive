<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>a little oproblem in my makefile - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > a little oproblem in my makefile</h2>
<div id="posts">
<div class="post">
    <h4>#27703 - tomer - Tue Oct 19, 2004 7:26 pm</h4>
    <div class="postbody"><span class="postbody">this is my MakeFile:
<br/>
<br/>
CFLAGS = -c -O2
<br/>
THUMBMODEL = -mthumb -mthumb-interwork
<br/>
LIST = main.o screen.o 
<br/>
CC= D:\GBA\DEVKIT\bin\gcc.exe 
<br/>
<br/>
all: myRom.gba
<br/>
<br/>
myRom.gba: myRom.elf
<br/>
	objcopy -O binary myRom.elf myRom.gba
<br/>
<br/>
<br/>
myRom.elf: $(LIST)$(CC) -o myRom.elf $(LIST) 
<br/>
<br/>
<br/>
$(LIST): %.o: %.c $(CC)$(CFLAGS) $(THUMBMODEL) $&lt; 
<br/>
<br/>
<br/>
and this is the output:
<br/>
-"No rule to make target '-c', needed by main.o. STOP"
<br/>
<br/>
what does it mean? and how is it fixed?
<br/>
<br/>
Plus, does it support IWRAM? and what flags should I use for speed?
<br/>
<br/>
Cheers,Tomer</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27704 - sajiimori - Tue Oct 19, 2004 7:52 pm</h4>
    <div class="postbody"><span class="postbody">Make is line-oriented, so you can't put the body of a make rule on the same line.  Put the prerequisites to the right of the colon and the body on the following line(s).  The error comes from the fact that your list of prerequisites includes "-c", so it's trying to build that file and obviously failing to do so.
<br/>
<br/>
Make doesn't know anything about IWRAM or optimization -- it's just a build automation tool.  Pass -O2 or -O3 to gcc for decent optimization, and search the forum for more info on putting things in different memory areas.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27705 - tomer - Tue Oct 19, 2004 8:07 pm</h4>
    <div class="postbody"><span class="postbody">what?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27706 - sajiimori - Tue Oct 19, 2004 8:25 pm</h4>
    <div class="postbody"><span class="postbody">Read a makefile tutorial to get up-to-speed on the vocabulary.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27707 - poslundc - Tue Oct 19, 2004 8:34 pm</h4>
    <div class="postbody"><span class="postbody">Best thread ever.
<br/>
<br/>
Dan.
<br/>
<br/>
<span style="font-weight: bold">Edit:</span> I had just come from reading bash.org and for a moment wasn't sure if I'd left.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27710 - tomer - Tue Oct 19, 2004 9:03 pm</h4>
    <div class="postbody"><span class="postbody">Look!
<br/>
I know how they work 
<br/>
i'm only trying to compile two fucjing files: main.c  and screen.s
<br/>
and I think that makefiles are complaining too much.
<br/>
I used to use Visual HAM IDE. But, then I relized it uses only a debug
<br/>
library, which probably makes things slower.
<br/>
that's it. two files.
<br/>
so if you wanna answer, then answer well pleaze.
<br/>
<br/>
Cheers, tomer</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27711 - Touchstone - Tue Oct 19, 2004 9:19 pm</h4>
    <div class="postbody"><span class="postbody">You could argue if he answered your question well or not, but he answered it correctly anyways.
<br/>
<br/>
What he meant was that you can't have the commands that should be executed for a target on the same line as the target definition. Your makefile should look like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">myRom.elf: $(LIST)
<br/>
    $(CC) -o myRom.elf $(LIST) 
<br/>
<br/>
%.o: %.c
<br/>
    $(CC) $(CFLAGS) $(THUMBMODEL) $&lt; 
<br/>
</td> </tr></table><span class="postbody">
<br/>
And if the screen source is an assembler file you'd have to add a generic .o from .s target aswell.<br/>_________________<br/>You can't beat our meat</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27713 - tomer - Tue Oct 19, 2004 9:26 pm</h4>
    <div class="postbody"><span class="postbody">ok
<br/>
I am trying this code
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
CFLAGS = -c -O2
<br/>
THUMBMODEL = -mthumb -mthumb-interwork
<br/>
CLIST = main.o 
<br/>
SLIST = crt0.o screen.o
<br/>
CC = D:\GBA\DEVKIT\arm-agb-elf\bin\gcc
<br/>
<br/>
<br/>
all: myRom.gba
<br/>
<br/>
myRom.gba: myRom.elf
<br/>
   objcopy -O binary myRom.elf myRom.gba
<br/>
<br/>
myRom.elf: $(CLIST)
<br/>
   $(CC) -o myRom.elf $(CLIST)
<br/>
<br/>
myRom.elf: $(SLIST)
<br/>
   $(CC) -o myRom.elf $(SLIST)
<br/>
<br/>
$(LIST): %.o: %.c
<br/>
   $(CC) $(CFLAGS) $(THUMBMODEL) $&lt;
<br/>
<br/>
$(SLIST): %.o: %.s
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
the output says:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
makefile:17: warning: overriding commands for target `myRom.elf'
<br/>
makefile:14: warning: ignoring old commands for target `myRom.elf'
<br/>
D:\GBA\DEVKIT\arm-agb-elf\bin\gcc -o myRom.elf crt0.o screen.o
<br/>
ld: cannot open crti.o: No such file or directory
<br/>
make: *** [myRom.elf] Error 1</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27714 - sajiimori - Tue Oct 19, 2004 10:39 pm</h4>
    <div class="postbody"><span class="postbody">Use a batch file.  That way you won't have to learn anything.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27727 - Krakken - Wed Oct 20, 2004 3:36 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">Use a batch file.  That way you won't have to learn anything.</td> </tr></table><span class="postbody">
<br/>
<br/>
And why is not learning anything ever been good? It just makes you more ignorant to the subject.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27728 - yaustar - Wed Oct 20, 2004 3:46 am</h4>
    <div class="postbody"><span class="postbody">Note: Complete beginner at Make files so this post is more of me testing my knowledge then providing a correct anwer. Thanks :)
<br/>
<br/>
I think that the error is caused by this code:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">myRom.elf: $(CLIST)
<br/>
   $(CC) -o myRom.elf $(CLIST)
<br/>
<br/>
myRom.elf: $(SLIST)
<br/>
   $(CC) -o myRom.elf $(SLIST) </td> </tr></table><span class="postbody">
<br/>
Setting two rules for myRom.elf to be dependent on different sets of files so it chooses one over the other...
<br/>
<br/>
It also makes no sense in creating a myRom.elf TWICE by compiling two different sets of files :S
<br/>
<br/>
As for the crti.o error.. er...
<br/>
<br/>
edit: would this be correct?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">CFLAGS = -c -O2
<br/>
THUMBMODEL = -mthumb -mthumb-interwork
<br/>
CLIST = main.o screen.o crt0.o 
<br/>
CC = D:\GBA\DEVKIT\arm-agb-elf\bin\gcc
<br/>
<br/>
all: myRom.gba
<br/>
<br/>
myRom.gba: myRom.elf
<br/>
   objcopy -O binary myRom.elf myRom.gba
<br/>
<br/>
myRom.elf: $(CLIST)
<br/>
   $(CC) -o myRom.elf $(CLIST)
<br/>
<br/>
$(LIST): %.o: %.c
<br/>
   $(CC) $(CFLAGS) $(THUMBMODEL) $&lt;</td> </tr></table><span class="postbody"><br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27729 - sajiimori - Wed Oct 20, 2004 4:58 am</h4>
    <div class="postbody"><span class="postbody">Krakken:  Learning is not for everybody, in particular those who have decided they already know. ;)
<br/>
<br/>
yaustar:  Your solution is a working makefile, but if any of the .o files can only be built from .s files, the built-in make rule for .s files will be applied.  The built-in rule is often sufficient though, especially for assembly files because there aren't a lot of compiler options to tweak.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27730 - yaustar - Wed Oct 20, 2004 5:05 am</h4>
    <div class="postbody"><span class="postbody">Thats a first... I actually got something [half?] right ;)[/i]<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27731 - Abscissa - Wed Oct 20, 2004 5:16 am</h4>
    <div class="postbody"><span class="postbody">In tomer's defense, makefiles *are* rather unintuitive and difficult to learn and work with.  I consider myself knowledgeable about how they work but I still get fed up with them from time to time...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27733 - sajiimori - Wed Oct 20, 2004 5:30 am</h4>
    <div class="postbody"><span class="postbody">Oh I would never blame anybody for not understanding makefiles.  I still don't understand them, when it comes down to it.
<br/>
<br/>
But why would tomer need defending anyway?  He already knows how makefiles work.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27746 - YopYop - Wed Oct 20, 2004 10:15 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
CC=gcc
<br/>
LD=ld
<br/>
AS=as
<br/>
<br/>
CFLAGS  += -I C:\gbadev\devkitadv\arm-agb-elf\include -I C:\gbadev\lib -g -O2 -mthumb-interwork -Wall -fverbose-asm
<br/>
<br/>
LDFLAGS    +=   -L C:\gbadev\devkitadv\arm-agb-elf\lib\interwork -L. -Tlnkscript -Ttext 0x08000000 -Tbss 0x03000000 
<br/>
<br/>
ASFLAGS += -mthumb-interwork
<br/>
<br/>
EXEC = proto.bin
<br/>
<br/>
SHELL = sh.exe
<br/>
<br/>
TARGET_ELF = out.elf
<br/>
.CFILES= $(wildcard *.c)
<br/>
.OFILES= crt0.o $(.CFILES:.c=.o) 
<br/>
<br/>
all: $(EXEC)
<br/>
<br/>
$(EXEC): $(TARGET_ELF)
<br/>
   objcopy -v -O binary $(TARGET_ELF) $(EXEC)
<br/>
<br/>
$(TARGET_ELF): $(.OFILES)
<br/>
   $(LD) $(LDFLAGS) $^ -o $(TARGET_ELF) -lm
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Here is my makefile you can take it as example.
<br/>
You have to change the include dir in CFLAGS  and the lib dir in LDFLAGS.
<br/>
It will take all your c files compile them in o files. Then take all the o files and crt0.o and link them in proto.bin</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27909 - Peter - Sat Oct 23, 2004 4:57 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tomer wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
I used to use Visual HAM IDE. But, then I relized it uses only a debug
<br/>
library, which probably makes things slower.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Here I would like to point to <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?p=27908#27908" target="_blank">this</a> post :)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
