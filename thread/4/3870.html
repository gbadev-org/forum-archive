<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>LZSS compression for GBA - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > LZSS compression for GBA</h2>
<div id="posts">
<div class="post">
    <h4>#24852 - DKL - Thu Aug 12, 2004 2:24 pm</h4>
    <div class="postbody"><span class="postbody">Little update : see below for v1.2.03
<br/>
<br/>
<a class="postlink" href="http://www.geocities.com/dkl_74/" target="_blank">http://www.geocities.com/dkl_74/</a>
<br/>
<br/>
I'm currently working on a big project and since it will be really "RAM intensive", I coded my own LZSS compressor in pure ASM, trying to keep memory usage to a minimum. Maybe somebody will be interested, so... For decompression, simply call the appropriate bios function (0x11 or 0x12).
<br/>
<br/>
There are 2 different implementations. The oldest one is based on hash tables and only need 10240 bytes (or a little less, or a little more) of temporary space. But it can be really slow in worst case scenarios if you are compressing big files (say 64Kbytes). I included it because it can still be used for little files.
<br/>
<br/>
The newest one is based on binary trees and is way faster, but needs 25088 bytes of temporary space.
<br/>
<br/>
You can compress directly in SRAM too.
<br/>
<br/>
I'm using GAS but it wouln't take too long to convert it to another assembler.
<br/>
<br/>
This source code is released in public domain.
<br/>
<br/>
If you find some errors, don't hesitate to contact me. Thanks. 
<br/>
<br/>
The link : dead
<br/>
<br/>
Regards, 
<br/>
DKL</span><span class="gensmall"><br/><br/>Last edited by DKL on Fri Aug 13, 2004 11:58 am; edited 3 times in total</span></div>    
</div>
<div class="post">
    <h4>#24855 - dagamer34 - Thu Aug 12, 2004 5:02 pm</h4>
    <div class="postbody"><span class="postbody">Do you think you could create a small example of how to use these functions, that way you don't get blitzed with lots of questions?<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#24860 - DKL - Thu Aug 12, 2004 6:09 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>dagamer34 wrote:</b></span></td> </tr> <tr> <td class="quote">Do you think you could create a small example of how to use these functions, that way you don't get blitzed with lots of questions?</td> </tr></table><span class="postbody">
<br/>
<br/>
Instructions are in the readme file. This is easy, really. If you intend to call it from C, just declare a function like this :
<br/>
<br/>
extern __attribute__((long_call)) *char LZ77CompWRAM(char*, char*, int, short*, char*);
<br/>
<br/>
or 
<br/>
<br/>
extern *char LZ77CompWRAM(char*, char*, int, short*, char*);
<br/>
<br/>
if you're calling from IWRAM.
<br/>
<br/>
Let's say the data to compress are (just an example) :
<br/>
<br/>
/* 32 bytes of data */
<br/>
char *data_2_compress="01234567890123456789012345678901"; 
<br/>
<br/>
Let's say you have 25088 bytes of free ram in EWRAM starting at address 0x02010000 and that you want to compress to SRAM (0x0E000000) directly, just call the declared function like this :
<br/>
<br/>
char *ret;
<br/>
ret = LZ77CompWRAM(data_2_compress, (char*) 0x0E000000, 32, (short*) 0x02010000, (char*) 0x0E010000);
<br/>
<br/>
The last argument is considered by the compressor as the output limit, he won't write anything starting at this address.
<br/>
<br/>
The return value will be 
<br/>
1) the address of the first free byte after the compressed file, or
<br/>
2) 0 (error) if the limit was reached or if the compressed file is larger than the uncompressed one (compression was so stopped).
<br/>
<br/>
To uncompress the data, just call the bios function 0x11. There's an example in 'readme.txt'.
<br/>
<br/>
Tell me if you need a more complex example (I mean if you really really need it, I'm lazy you know ;) )</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#24861 - dagamer34 - Thu Aug 12, 2004 6:23 pm</h4>
    <div class="postbody"><span class="postbody">For me, I think that'll do quite nicely. :)<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#24901 - DKL - Fri Aug 13, 2004 11:56 am</h4>
    <div class="postbody"><span class="postbody">I made a lame webpage to stop posting for any little update I do. 
<br/>
<br/>
You can find the last version of the LZSS compressor for GBA, here :
<br/>
<br/>
<a class="postlink" href="http://www.geocities.com/dkl_74/" target="_blank">http://www.geocities.com/dkl_74/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25019 - DKL - Sun Aug 15, 2004 1:02 pm</h4>
    <div class="postbody"><span class="postbody">The bios LZSS functions won't allow you to uncompress directly from SRAM. I just uploaded 2 small functions (sisters of bios fct 0x11 &amp; 0x12) to solve the problem. I didn't devote a lot of time on them, so if you see errors, please contact me. Thanks.
<br/>
<br/>
<a class="postlink" href="http://www.geocities.com/dkl_74/" target="_blank">www.geocities.com/dkl_74/</a>
<br/>
<br/>
Regards,
<br/>
DKL</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25028 - DKL - Sun Aug 15, 2004 7:28 pm</h4>
    <div class="postbody"><span class="postbody">Just to warn interested people : there was an error in the uncompressing functions v1.0. Please update &amp; destroy the old version. Thanks. :)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
