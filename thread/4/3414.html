<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>issue with text bg - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Coding > issue with text bg</h2>
<div id="posts">
<div class="post">
    <h4>#20791 - Darmstadium - Mon May 17, 2004 11:34 pm</h4>
    <div class="postbody"><span class="postbody">I'm encountering something that's weird. Ok, I have this 256x256 text bg. Ok, it shows up great, but when I try to move it by changing REG_BG0HOFS, it makes a huge jump and won't move anymore. Here is my code:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include "gba.h"
<br/>
#include "dispcnt.h"
<br/>
#include "keypad.h"
<br/>
#include "bg.h"
<br/>
#include "dma.h"
<br/>
<br/>
#include "tiles.raw.c"
<br/>
#include "tiles.pal.c"
<br/>
<br/>
#define BG_PALETTE(p)         ((u16*)(0x5000000+p))
<br/>
<br/>
int main()
<br/>
{
<br/>
   const int screenblock = 8;
<br/>
   const int charblock = 0;
<br/>
   REG_DISPCNT = MODE_0 | BG0_ENABLE | OBJ_MAP_1D;
<br/>
   REG_BG0CNT = TEXTBG_SIZE_256x256 | (screenblock &lt;&lt; SCREEN_SHIFT) | (charblock &lt;&lt; CHAR_SHIFT) | BG_COLOR_16;
<br/>
   REG_BG0HOFS = 8;
<br/>
   REG_BG0VOFS = 8;
<br/>
   
<br/>
   int loop;
<br/>
   for (loop = 0; loop &lt; 32*32; loop++)
<br/>
      ScreenBaseBlock(screenblock)[loop] = test[loop];
<br/>
   
<br/>
   
<br/>
   REG_DM3DAD = (u32)CharBaseBlock(charblock);
<br/>
   REG_DM3SAD = (u32)tiles_Bitmap;
<br/>
   REG_DM3CNT = 384 | DMA_ENABLE | DMA_TIMEING_IMMEDIATE | DMA_32;
<br/>
   
<br/>
   for (int loop = 0; loop &lt; 16; loop++)
<br/>
      BG_PALETTE(0)[loop] = tiles_Palette[loop];
<br/>
   
<br/>
   while (1)
<br/>
   {
<br/>
      if (KEYDOWN(KEY_LEFT))
<br/>
         REG_BG0HOFS -= 1;
<br/>
      if (KEYDOWN(KEY_RIGHT))
<br/>
         REG_BG0HOFS += 1;
<br/>
   }
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Thanks for your help</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20792 - gadget - Mon May 17, 2004 11:42 pm</h4>
    <div class="postbody"><span class="postbody">I believe at least one of your problems is the code.
<br/>
if (KEYDOWN(KEY_LEFT))
<br/>
   REG_BG0HOFS -= 1;
<br/>
if (KEYDOWN(KEY_RIGHT))
<br/>
   REG_BG0HOFS += 1; 
<br/>
<br/>
The scrolling registers are not able to be read from, only written to so doing a plus/minus 1 won't work. Keep track of the amount of scrolling performed in a variable and increment the value there. Each frame then copy the value in the variable into the background register.
<br/>
<br/>
--Wendy</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20793 - poslundc - Mon May 17, 2004 11:44 pm</h4>
    <div class="postbody"><span class="postbody">Also, your code is going much too fast. In a single second you are checking the buttons and updating the background position about a million times or so.
<br/>
<br/>
Try waiting for VBlank in your while loop. At least that will slow it down to only 60 times per second.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20795 - Darmstadium - Tue May 18, 2004 12:18 am</h4>
    <div class="postbody"><span class="postbody">i had no idea u couldn't do that. Thanks a lot for your help guys!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20798 - dagamer34 - Tue May 18, 2004 1:39 am</h4>
    <div class="postbody"><span class="postbody">Take a look at the CowBite spec. The easily tell you which registers you can read and/or write to.<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
