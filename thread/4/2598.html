<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>working with maps... - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Coding > working with maps...</h2>
<div id="posts">
<div class="post">
    <h4>#14285 - wiz - Sat Jan 03, 2004 10:26 pm</h4>
    <div class="postbody"><span class="postbody">Greetings everyone, and a happy new year!
<br/>
<br/>
Its been a while since I have been doing anything on the GBA.  I'm planning to make an old game 
<br/>
on the GBA that I made a long time ago on the PC.
<br/>
<br/>
So now Im trying to plan it out;  The game worked by having a large 2D array to hold the map.  
<br/>
During the game value changes could be made to that array resulting in changes to the map being 
<br/>
drawn.
<br/>
<br/>
How could this be achieved with such a low amount of RAM?  I have an understanding this map data 
<br/>
would be held in ROM which is read-only.
<br/>
<br/>
I hope I'm clear with everything there, And thank you *very* much for your time and advice.
<br/>
<br/>
All the best.
<br/>
<br/>
PS I have tried to post a few times on the board, if there are multiple messages Im really sorry.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14290 - sajiimori - Sat Jan 03, 2004 10:49 pm</h4>
    <div class="postbody"><span class="postbody">If any area of the map can change at potentially any time, then it's gotta be in RAM.
<br/>
<br/>
How big is the map?  If it's too big to fit in GBA RAM as it is, you can try to make the data representation more efficient.  Perhaps you could use some very mild form of compression, but then you have to think about best- and worst-case performance of random map access.
<br/>
<br/>
After that you're looking at redesigning the game so that less of the map is "active" at a time (so inactive portions can be aggressively compressed or even completely offloaded).
<br/>
<br/>
Also, if any part of the map can potentially be altered, but relatively few actually are altered, you could store the original map in ROM and use a seperate "sparse" overlay map that stores a list of cells that have changed.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14296 - XeroxBoy - Sat Jan 03, 2004 11:34 pm</h4>
    <div class="postbody"><span class="postbody">If you're using single byte entries, you'd be able to fit a 512x512 tile map into EWRAM. Assuming 8 pixels per tile (generally, as small as you'd like to get), that's a 4096x4096 pixel map - absolutely gigantic, in other words, especially considering the pitiful resolution of the GBA.
<br/>
<br/>
If that's simply not big enough, you'd be best off using abstract map representation - in Super Mario World, for instance, levels weren't constructed directly from tile maps, but instead were described by a list of objects. So, instead of using 64 bytes to describe a 64x64 pixel brick (for instance), you'd use around five (ObjectType, XLocation, YLocation, HorizSize, VertSize).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14302 - hnager - Sun Jan 04, 2004 1:46 am</h4>
    <div class="postbody"><span class="postbody">I'm not sure if I follow what you mean in reference to SMW - there was no map in ROM?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14309 - sajiimori - Sun Jan 04, 2004 2:30 am</h4>
    <div class="postbody"><span class="postbody">No, he's saying that maps are effectively compressed by describing "aspects" of maps (a hill, a vine, a wall) instead of storing them as big arrays of tiles.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14310 - XeroxBoy - Sun Jan 04, 2004 2:37 am</h4>
    <div class="postbody"><span class="postbody">All there was were lists of predefined objects. Instead of an array containing all the tiles in a level, it'd just be marked as
<br/>
<br/>
-Ground located at 0,32, 32 pixels tall, 4096 wide
<br/>
-Question block containing Yoshi located at 1024, 128, 16 pixels tall, 16 pixels wide
<br/>
<br/>
etc.
<br/>
<br/>
Then, of course, there's data stored in the header which described which tileset to use, how 'big' the level data was, whether the backgrounds scrolled, etc.
<br/>
<br/>
Backgrounds <span style="font-style: italic">were</span>, however, drawn in traditional tilemap fashion.
<br/>
<br/>
<br/>
<br/>
To be perfectly honest, I, perhaps, shouldn't have such courage in my convictions - this is just what I picked up from messing around with <a class="postlink" href="http://fusoya.cg-games.net/lm/index.html" target="_blank">Lunar Magic</a>, an excellent Mario World level editor. I didn't actually mess around with the ROM itself. So, if anyone knows any better, I would more than appreciate a correction here!
<br/>
<br/>
Edit: sajiimori posted ahead of me - and managed to be much more succinct, too!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14317 - tepples - Sun Jan 04, 2004 3:45 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>XeroxBoy wrote:</b></span></td> </tr> <tr> <td class="quote">If you're using single byte entries, you'd be able to fit a 512x512 tile map into EWRAM. Assuming 8 pixels per tile (generally, as small as you'd like to get), that's a 4096x4096 pixel map - absolutely gigantic, in other words, especially considering the pitiful resolution of the GBA.</td> </tr></table><span class="postbody">
<br/>
For comparison, 4K by 4K pixels is about how big the overworld map is in <span style="font-style: italic">The Legend of Zelda: A Link to the Past</span>. The overworld map in <span style="font-style: italic">Link's Awakening</span> is about 2.5K by 2K pixels.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">If that's simply not big enough, you'd be best off using abstract map representation - in Super Mario World, for instance, levels weren't constructed directly from tile maps</td> </tr></table><span class="postbody">
<br/>
This is the Right Way to do it. Case in point: the maps of the original <span style="font-style: italic">Super Mario Bros.</span> fit into only 8 KB out of the 40 KB binary. In addition, constructing maps from a list of objects makes it easier to switch things from being tiles to being sprites.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14360 - wiz - Mon Jan 05, 2004 8:45 pm</h4>
    <div class="postbody"><span class="postbody">Thank you all for the input!
<br/>
<br/>
some excellent ideas there and its given me a lot to think about.  I hope one day I'll have a demo to show off and thank everyone for their help.  Just reading on this board gives me a great learning experience.
<br/>
<br/>
Thanks a ton guys.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14415 - sgeos - Tue Jan 06, 2004 4:52 am</h4>
    <div class="postbody"><span class="postbody">You'll want to hold your map in a (large) array in ram.  When you change a value in the array, set an update variable.  Every frame check that variable.  If it is set, then call a screen update function and reset your update variable.
<br/>
<br/>
You'll probably call the screen update function the first time the screen is drawn.  It's job is to take your game's internal representation of the map, and turn that into graphics on the screen.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
