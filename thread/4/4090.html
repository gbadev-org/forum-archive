<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Divide and Modulo in an emulator vs hardware? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > Divide and Modulo in an emulator vs hardware?</h2>
<div id="posts">
<div class="post">
    <h4>#26498 - LOst? - Fri Sep 17, 2004 4:08 am</h4>
    <div class="postbody"><span class="postbody">I have this code:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   int mx = x % 96;
<br/>
   int my = y % 96;
<br/>
   int sx = (x - mx) / 96;
<br/>
   int sy = (y - my) / 96;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
And it runs pretty quick.... Well I can't see any differences from not having it and having it in my code when running it in my emulator collection. The question is, will this run as fast on the real hardware?
<br/>
<br/>
Or is my computer too fast? (4*2.2GHz Intel Xeon processors)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26501 - jma - Fri Sep 17, 2004 4:54 am</h4>
    <div class="postbody"><span class="postbody">You are dividing by a constant, which (hopefully) is being optimized into a multiply -- which is probably why is doesn't seem very slow.
<br/>
<br/>
Also, remember that 98% of your program's execution time is spent in 2% of the code (Knuth). Trying to optimize away a single divide, especially if your program only spends a very brief period of time doing it would be waste of effort. 
<br/>
<br/>
Jeff<br/>_________________<br/><a href="mailto:massung@gmail.com">massung@gmail.com</a>
<br/>
<a href="http://www.retrobyte.org" target="_blank">http://www.retrobyte.org</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26505 - LOst? - Fri Sep 17, 2004 5:34 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>jma wrote:</b></span></td> </tr> <tr> <td class="quote">You are dividing by a constant, which (hopefully) is being optimized into a multiply -- which is probably why is doesn't seem very slow.
<br/>
<br/>
Also, remember that 98% of your program's execution time is spent in 2% of the code (Knuth). Trying to optimize away a single divide, especially if your program only spends a very brief period of time doing it would be waste of effort. 
<br/>
<br/>
Jeff</td> </tr></table><span class="postbody">
<br/>
<br/>
This is the worst thing. For some reason this commercial game I'm stealing the map from is using 12x12 blocks (96 pixels), and I have no idea how to scroll the blocks in another way</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26508 - sgeos - Fri Sep 17, 2004 6:06 am</h4>
    <div class="postbody"><span class="postbody">Split them into 4 by 4 blocks?  Reformat them into square 16 or 32 tile blocks?
<br/>
<br/>
At any rate, don't worry about speed until something is slow.  If programmer time is your bottleneck, then it is more important than execution time.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26509 - LOst? - Fri Sep 17, 2004 7:03 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sgeos wrote:</b></span></td> </tr> <tr> <td class="quote">Split them into 4 by 4 blocks?  Reformat them into square 16 or 32 tile blocks?
<br/>
<br/>
At any rate, don't worry about speed until something is slow.  If programmer time is your bottleneck, then it is more important than execution time.
<br/>
<br/>
-Brendan</td> </tr></table><span class="postbody">
<br/>
<br/>
Yea, the speed is not an issue right now. Even when I call this code every frame, it's going smooth.
<br/>
<br/>
And I can't split the blocks into 4 by 4 or 8 by 8. The original block maps are 12 by 12, and it would require too much to split all the blocks (appriximately 400 blocks)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26512 - LOst? - Fri Sep 17, 2004 10:15 am</h4>
    <div class="postbody"><span class="postbody">If someone of you can test this on hardware and tell me if it goes in the same speed as in an emulator:
<br/>
<br/>
<a href="http://www.logotypes.se/tmp/hc_act1.gba" target="_blank">http://www.logotypes.se/tmp/hc_act1.gba</a>
<br/>
<br/>
I have programmed everything myself. I have stolen the art and level design from Sonic Advance 2's Hot Crater level since it was uncompressed in the ROM. I did it mostly to test the raster effects in the background. The foreground uses two background layers, that each call the code above (divide and modulo). Also the bg is scrolled with the (scroll_speed / 13), which would like kill everything called speed on the real hardware.
<br/>
<br/>
Use A button to slow down the scroll speed and B button to increase the scroll speed.
<br/>
<br/>
Copyright (C) Sega/Sonic Team.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26525 - Datch - Fri Sep 17, 2004 7:29 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>LOst? wrote:</b></span></td> </tr> <tr> <td class="quote">The question is, will this run as fast on the real hardware? Or is my computer too fast? (4*2.2GHz Intel Xeon processors)</td> </tr></table><span class="postbody">
<br/>
<br/>
Maybe I don't understand something but I can't see why your computer speed would affect the division speed of the emulator.  Isn't the emulator suppose to be as slow (or as fast) as the real thing to do a divide and all the other operations?<br/>_________________<br/>Visit SR-388 now and get a 40% discount!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26531 - LOst? - Fri Sep 17, 2004 10:12 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Datch wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>LOst? wrote:</b></span></td> </tr> <tr> <td class="quote">The question is, will this run as fast on the real hardware? Or is my computer too fast? (4*2.2GHz Intel Xeon processors)</td> </tr></table><span class="postbody">
<br/>
<br/>
Maybe I don't understand something but I can't see why your computer speed would affect the division speed of the emulator.  Isn't the emulator suppose to be as slow (or as fast) as the real thing to do a divide and all the other operations?</span></td> </tr></table><span class="postbody">
<br/>
<br/>
I hope so.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26538 - tepples - Sat Sep 18, 2004 12:59 am</h4>
    <div class="postbody"><span class="postbody">Emulators that use a BIOS file dumped from your GBA should take roughly as long to divide as the real thing, but some emulators don't use a BIOS file because many users don't have a GBA and a multiboot cable. Instead, those emulators perform "high level emulation" of the BIOS in natively compiled C code, and some don't even bother to estimate the number of CPU cycles that each BIOS routine eats.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26542 - Krakken - Sat Sep 18, 2004 1:33 am</h4>
    <div class="postbody"><span class="postbody">Try it on NO$GBA. That should give you a very accurate result.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26548 - LOst? - Sat Sep 18, 2004 4:04 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Emulators that use a BIOS file dumped from your GBA should take roughly as long to divide as the real thing, but some emulators don't use a BIOS file because many users don't have a GBA and a multiboot cable. Instead, those emulators perform "high level emulation" of the BIOS in natively compiled C code, and some don't even bother to estimate the number of CPU cycles that each BIOS routine eats.</td> </tr></table><span class="postbody">
<br/>
<br/>
But I don't use the divide routine from the BIOS.
<br/>
<br/>
And what is NO$GBA?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26549 - Krakken - Sat Sep 18, 2004 4:29 am</h4>
    <div class="postbody"><span class="postbody"><a href="http://nocash.emubase.de/gba.htm" target="_blank">http://nocash.emubase.de/gba.htm</a>
<br/>
Some official developers use this emulator too.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26550 - LOst? - Sat Sep 18, 2004 5:01 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Krakken wrote:</b></span></td> </tr> <tr> <td class="quote">http://nocash.emubase.de/gba.htm
<br/>
Some official developers use this emulator too.</td> </tr></table><span class="postbody">
<br/>
<br/>
I tried it, and my engine locks up at one place. Does that mean it will lock up on the real hardware too?
<br/>
<br/>
It looks up on a divide. If I change it to &gt;&gt; it will work.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26551 - SmileyDude - Sat Sep 18, 2004 5:06 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>LOst? wrote:</b></span></td> </tr> <tr> <td class="quote">I tried it, and my engine locks up at one place. Does that mean it will lock up on the real hardware too?</td> </tr></table><span class="postbody">
<br/>
<br/>
Well, no emulator is completely perfect -- but, from what I've heard, NO$GBA is about as close to perfection as you can expect.  If it locks up there, there is most likely a bug that will either manifest itself as a lock up on real hardware, or worse, a subtle bug that will cause you endless pain.<br/>_________________<br/>dennis</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26552 - LOst? - Sat Sep 18, 2004 5:41 am</h4>
    <div class="postbody"><span class="postbody">Well, the ROM is updated, so it won't hang in NO$GBA. So if anyone wants to test it on the real hardware for me, then thank you really much!
<br/>
<br/>
<a href="http://www.logotypes.se/tmp/hc_act1.gba" target="_blank">http://www.logotypes.se/tmp/hc_act1.gba</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26553 - Krakken - Sat Sep 18, 2004 8:10 am</h4>
    <div class="postbody"><span class="postbody">It works fine on hardware.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26554 - LOst? - Sat Sep 18, 2004 9:24 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Krakken wrote:</b></span></td> </tr> <tr> <td class="quote">It works fine on hardware.</td> </tr></table><span class="postbody">
<br/>
<br/>
Great to hear! Thank you very much!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26559 - dagamer34 - Sat Sep 18, 2004 4:24 pm</h4>
    <div class="postbody"><span class="postbody">It runs very nicely on real hardware using my EZFA. Especially the raster effects. I like it! :)<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26570 - LOst? - Sun Sep 19, 2004 3:05 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>dagamer34 wrote:</b></span></td> </tr> <tr> <td class="quote">It runs very nicely on real hardware using my EZFA. Especially the raster effects. I like it! :)</td> </tr></table><span class="postbody">
<br/>
<br/>
Yay! Thank you!
<br/>
<br/>
This really helps me to start my game development for sure! And I'm going to invest in a GBA flash cart so I can bug check myself in the future.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
