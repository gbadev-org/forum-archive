<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>sprites on a background - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > sprites on a background</h2>
<div id="posts">
<div class="post">
    <h4>#18795 - s00p - Mon Apr 05, 2004 5:31 pm</h4>
    <div class="postbody"><span class="postbody">edit: I solved my problem. Thanks for the help guys.
<br/>
My sprite isn't showing up. I looked at a lot of tutorials before finally posting here and couldn't get anything to happen.
<br/>
<br/>
Background:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int main()
<br/>
{
<br/>
ham_Init();
<br/>
unsigned short color;
<br/>
Print(1, 0, "   LIVES:3  %:100  STAGE:15", GREEN);
<br/>
color = RGB(0,0,255);
<br/>
DrawBox3(0, 10, 240, 160, color);
<br/>
color = RGB(0,0,0);
<br/>
DrawBox3(1, 11, 239, 159, color);
<br/>
ham_StartIntHandler(INT_TYPE_VBL,(void*)&amp;vbl_func);
<br/>
unsigned short* videoBuffer = (unsigned short*)0x6000000;
<br/>
*(unsigned long*)0x4000000 = (0x3 | 0x400);
<br/>
videoBuffer[posy * 240 + posx] = 0xFFFF;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Sprite:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">SetMode( SCREENMODE4 | OBJENABLE );
<br/>
ham_LoadObjPal((void*)master_Palette, 256);
<br/>
alien[0] = ham_CreateObj((void*)alien_Bitmap,0,2,OBJ_MODE_NORMAL,1,0,0,0,0,0,0,110,50);
<br/>
ham_CopyObjToOAM();</td> </tr></table><span class="postbody"></span><span class="gensmall"><br/><br/>Last edited by s00p on Mon Apr 05, 2004 10:05 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#18796 - Lupin - Mon Apr 05, 2004 5:35 pm</h4>
    <div class="postbody"><span class="postbody">Set the BG priority to 3 when using bitmap modes. Your sprites should work, they are just behind the BG.<br/>_________________<br/><a class="postlink" href="http://pokeme.shizzle.it/" target="_blank">Team Pokeme</a>
<br/>
<a class="postlink" href="http://lupin.shizzle.it/" target="_blank">My blog and PM ASM tutorials</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18797 - s00p - Mon Apr 05, 2004 5:54 pm</h4>
    <div class="postbody"><span class="postbody">Sprite shows up then disappears as soon as the background is drawn. I changed the bg priority attribute to 3:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int main()
<br/>
{
<br/>
ham_Init();
<br/>
ham_SetBgMode(4);
<br/>
ham_LoadObjPal((void*)master_Palette, 256);
<br/>
alien[0] = ham_CreateObj((void*)alien_Bitmap,OBJ_SIZE_8X8,OBJ_MODE_NORMAL,1,0,0,0,0,3,0,110,50);
<br/>
ham_CopyObjToOAM();
<br/>
unsigned short color;
<br/>
Print(1, 0, "   LIVES:3  %:100  STAGE:15", GREEN);
<br/>
color = RGB(0,0,255);
<br/>
DrawBox3(0, 10, 240, 160, color);
<br/>
color = RGB(0,0,0);
<br/>
DrawBox3(1, 11, 239, 159, color);
<br/>
ham_StartIntHandler(INT_TYPE_VBL,(void*)&amp;vbl_func);
<br/>
unsigned short* videoBuffer = (unsigned short*)0x6000000;
<br/>
*(unsigned long*)0x4000000 = (0x3 | 0x400);
<br/>
videoBuffer[posy * 240 + posx] = 0xFFFF;
<br/>
while(1) {}
<br/>
return 0;
<br/>
}</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18799 - batblaster - Mon Apr 05, 2004 6:38 pm</h4>
    <div class="postbody"><span class="postbody">The BG prioprity not the Obj priority...<br/>_________________<br/>Batblaster / 7 Raven Studios Co. Ltd
<br/>
------------------------------------------</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18800 - s00p - Mon Apr 05, 2004 6:42 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>batblaster wrote:</b></span></td> </tr> <tr> <td class="quote">The BG prioprity not the Obj priority...</td> </tr></table><span class="postbody">
<br/>
prioprity? Well if it isn't right then could you tell me which value is the obj priority?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18802 - sajiimori - Mon Apr 05, 2004 7:24 pm</h4>
    <div class="postbody"><span class="postbody">You want to make fun of people and then ask them for help?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18805 - s00p - Mon Apr 05, 2004 7:57 pm</h4>
    <div class="postbody"><span class="postbody">No I was just stating that I didn't know which word that supposed to be, property or priority.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18806 - Lupin - Mon Apr 05, 2004 8:27 pm</h4>
    <div class="postbody"><span class="postbody">Put this somewhere in your code (at startup would be good):
<br/>
REG_BG2CNT = 3;
<br/>
<br/>
This will of course overwrite all other BG settings but you most likely don't need any of the other BG settings in bitmap mode<br/>_________________<br/><a class="postlink" href="http://pokeme.shizzle.it/" target="_blank">Team Pokeme</a>
<br/>
<a class="postlink" href="http://lupin.shizzle.it/" target="_blank">My blog and PM ASM tutorials</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18809 - s00p - Mon Apr 05, 2004 9:17 pm</h4>
    <div class="postbody"><span class="postbody">Putting that in the header caused an error. Putting that in main() did nothing.
<br/>
<br/>
I also tried putting
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define REG_BG2CNT     *(u16*)0x400000C</td> </tr></table><span class="postbody">
<br/>
into the header.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18810 - dagamer34 - Mon Apr 05, 2004 9:33 pm</h4>
    <div class="postbody"><span class="postbody">Try copying the OAM memory every frame. That might be why it flickers for a mement then disappears.
<br/>
<br/>
Is there a particular reason why you are mixing HAM code with your own functions? I just find it odd.<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18811 - s00p - Mon Apr 05, 2004 9:37 pm</h4>
    <div class="postbody"><span class="postbody">It's because I just started doing this yesterday and don't know any better.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18813 - dagamer34 - Mon Apr 05, 2004 9:46 pm</h4>
    <div class="postbody"><span class="postbody">I only started 3 months ago so don't stress out. But you might want to stick with 1 set of functions or the other. Mixing leads to spending more time to solve problems.
<br/>
<br/>
By the way, does anybody know why the time is off by an hour? Are the boards not going by Daylight Savings Time?<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18814 - s00p - Mon Apr 05, 2004 9:58 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">unsigned short* videoBuffer = (unsigned short*)0x6000000;
<br/>
*(unsigned long*)0x4000000 = (0x3 | 0x400);
<br/>
videoBuffer[posy * 240 + posx] = 0xFFFF;</td> </tr></table><span class="postbody">
<br/>
<br/>
= CRAP.
<br/>
<br/>
That's what was causing the problem.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void DrawPixel3(int x, int y, unsigned short color)
<br/>
{
<br/>
videoBuffer[y * 240 + x] = color;
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
= Good. I have the sprite showing up over my other layers easily now. It works <span style="text-decoration: underline">perfectly</span> now.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18834 - dagamer34 - Tue Apr 06, 2004 10:23 pm</h4>
    <div class="postbody"><span class="postbody">You might want to go pick up a gba.h header and use it's macros.
<br/>
<br/>
Setting the display mode like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
*(unsigned long*)0x4000000 = (0x3 | 0x400); 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
is just ASKING for trouble seeing as you might forget what the 0x3 and 0x4000 represents (even I don't know off the top of my head) and you have to look it up. This makes it a pain in the @$$ to find bugs because of human error. You've had first-hand experience and I think everyone here will agree with me, it's something to avoid.<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18917 - Cearn - Thu Apr 08, 2004 8:58 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>dagamer34 wrote:</b></span></td> </tr> <tr> <td class="quote">You might want to go pick up a gba.h header and use it's macros.
<br/>
<br/>
Setting the display mode like this:
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
*(unsigned long*)0x4000000 = (0x3 | 0x400); 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
is just ASKING for trouble seeing as you might forget what the 0x3 and 0x4000 represents (even I don't know off the top of my head) and you have to look it up. This makes it a pain in the @$$ to find bugs because of human error. You've had first-hand experience and I think everyone here will agree with me, it's something to avoid.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Yeah, Using named constants is prefereable to using the actual numbers. It'll also clear up little typos like 0x4000 (3 zeros) when it's 0x400 (2 zeros) than enables BG2 :P (sorry about that, dagamer34, but this is probably your point anyway).
<br/>
<br/>
Do something like
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
typedef unsigned int u32;
<br/>
#define REG_DISPCNT       *(volatile u32*)0x04000000 
<br/>
<br/>
#define BG2_ENABLE   0x0400
<br/>
#define VID_MODE3   0x0003
<br/>
<br/>
// to enable BG2 and video mode 3:
<br/>
REG_DISPCNT = BG2_ENABLE | VID_MODE3;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Just about every demo comes with header files with defines for the registers and flags. Save yourself a lot of grief and get one.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18969 - dagamer34 - Thu Apr 08, 2004 10:03 pm</h4>
    <div class="postbody"><span class="postbody">That accident was on purpose.<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
