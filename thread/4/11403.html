<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Fixed point? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Coding > Fixed point?</h2>
<div id="posts">
<div class="post">
    <h4>#105685 - QuantumDoja - Tue Oct 10, 2006 10:43 pm</h4>
    <div class="postbody"><span class="postbody">Hi, im trying to make my sprite move in a fairly mario style manner, ive been reading all over about the benefits of fixed point and gravity, heres where i currently am......I think I have all the peices but cant bolt them together:
<br/>
<br/>
ScottLininger wrote
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Example: If your world is 100 pixels x 100 pixels wide, you keep track of it internally as if it were 800x800. If you want your character to appear at pixel position (10,20), this value would actually be stored in your character variables as position (80,160). At display time, you divide your coordinates by 8 to determine where to draw the sprite. </td> </tr></table><span class="postbody">
<br/>
<br/>
ok, so if my world is 100 by 100 (800 by 800) and i want to move forward I do this:
<br/>
<br/>
when the "right" button is pressed, the .xacceleration property gets set to a value, then the xvelocity is increased by the acceleration value, if the "right" button is held over x frames the acceleration property is increased (arent acceleration &amp; velocity the same??)
<br/>
<br/>
at a certain frame i then call the following:
<br/>
Player.x = Player.x + Player.xvelocity
<br/>
<br/>
if i let go of the "right" button the acceleration &amp; xvelocity are still positive values, indicating the sprite is still moving, so there needs to be a deceleration function to handle this.
<br/>
<br/>
I think this is where I am with my demo attached.
<br/>
demo: <a class="postlink" href="http://www.quantumlogic.co.uk/GBA/Main.rar" target="_blank">http://www.quantumlogic.co.uk/GBA/Main.rar</a>
<br/>
<br/>
please press and hold a direction, the player should run in that direction and then when you release slide.
<br/>
<br/>
IMPORTANT NOTE:
<br/>
The thing im trying to get at with the fixed point stuff is this:
<br/>
<br/>
when running the demo press jump, the sprite will continue to jump, whilst its doing this press left or right, the angle is sharp its not smooth eg:
<br/>
<br/>
y
<br/>
 |.................../
<br/>
 |................./
<br/>
 |.............../
<br/>
 |............./
<br/>
 |............|
<br/>
 |............|
<br/>
 |............|
<br/>
 |............|______________x
<br/>
<br/>
I was expecting my sprites movement to have a more rounded roll-off
<br/>
<br/>
..and this is where i think the fixed point math comes in if my fixed point level is 800 by 800 do i move my sprite as if it was on the 800 by 800 level, so i could move it 16 pixels for example then at sprite update time get the integer version?? - im getting really confused as I know updating like this:
<br/>
x = 1, y = 1
<br/>
x = 2, y = 2
<br/>
will always give mea straight line, so i need to update like
<br/>
x = 1, y = 0.5
<br/>
x = 2, y = 0.75
<br/>
<br/>
Tepples wrote:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">The way most 2D games seem to do platform physics is to use Euler integration. Do the following in each frame for each sprite:
<br/>
<br/>
   1. Add a constant to Y velocity. (Adjust this constant to reflect gravity and the scale of your game world.)
<br/>
   2. Add X velocity to X displacement and add Y velocity to Y displacement.
<br/>
   3. Perform collision tests and push the character away from walls, floors, and ceilings as appropriate.
<br/>
   4. Draw the sprite at position (X displacement - X camera origin, Y displacement - Y camera origin). 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
and this equation also seems to use floating points??? how do i use this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">s = ut + (1/2)at? ( That is, s=(u*t)+((1/2)*a*t*t) )
<br/>
<br/>
s = distance (from ground, for instance)
<br/>
u = starting speed
<br/>
t = time
<br/>
a = acceleration ( -9.81 for gravity ) </td> </tr></table><span class="postbody">
<br/>
<br/>
Please help!!!!<br/>_________________<br/>Chris Davis</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#105687 - Mucca - Wed Oct 11, 2006 12:54 am</h4>
    <div class="postbody"><span class="postbody">Thats not really fixed point math, and trying to get away without doing proper fixed point math by trying to shoehorn such things as logic positions and level dimensions into a fixed-point friendly format will only create problems.
<br/>
<br/>
I posted some simple fixed point math code in the Kirby revolution thread in Coding on page 3 or 4 I think. It should be useful.
<br/>
<br/>
Apart from that, two things:
<br/>
<br/>
Firstly, its usually good enough to have a non-changing acceleration. If the button is not pressed, change it to a deceleration. Velocity is what changes. 
<br/>
<br/>
Secondly, I really think you would be served well by introducing the concept of time. Those formulas you gave only work with respect to time. It appears your current method involves waiting x number of frames, then performing the integration ( position += velocity; velocity += acceleration ). This has obvious drawbacks - not every frame will be 1/60th of a second, thus you will get slowdown. And it makes it more difficult to come up with consistent and realistic values for velocity and acceleration, as your units will be pixels per n/60 seconds where n is how often you do the update.
<br/>
<br/>
However if you set up a timer, measure the time passed since the last update, and feed this into your equations, things become much more stable.
<br/>
<br/>
My advice - set up two timers, one that overflows every second (Prescalar setting 2), the other to be updated every time the first timer overflows. The timers are 16 bits, so this fits perfectly with a 16.16 fixed point number, representing the time in seconds since your program started.
<br/>
<br/>
Ah what the heck, here's some code...
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
// define timer addresses
<br/>
#define REG_TIMER_2_VAL      0x04000108
<br/>
#define REG_TIMER_2_CNT      0x0400010A
<br/>
#define REG_TIMER_3_VAL      0x0400010C
<br/>
#define REG_TIMER_3_CNT      0x0400010E
<br/>
<br/>
<br/>
// define how many bits are used for fraction 
<br/>
#define FP_FRACTION_BITS    16 
<br/>
<br/>
// for extra readability, make a typedef 
<br/>
typedef s32  FP; 
<br/>
<br/>
// "construct" a fixed point from a normal integer 
<br/>
FP fix( s32 val ) 
<br/>
{ 
<br/>
    FP fp = val &lt;&lt; FP_FRACTION_BITS ; 
<br/>
    return fp; 
<br/>
} 
<br/>
<br/>
// "construct" from a float 
<br/>
FP fix( float f ) 
<br/>
{ 
<br/>
    FP fp = (FP)(f * ( 1 &lt;&lt; FP_FRACTION_BITS)); 
<br/>
    return fp; 
<br/>
} 
<br/>
<br/>
// multiply two fixed point numbers 
<br/>
FP fix_mul( FP fp1, FP fp2 ) 
<br/>
{ 
<br/>
    s64 tmp = (s64)fp1 * (s64)fp2; 
<br/>
    FP prod  = (FP)(tmp &gt;&gt;  FP_FRACTION_BITS); 
<br/>
    return prod; 
<br/>
} 
<br/>
<br/>
// divide one fixed point number by another 
<br/>
FP fix_div( FP dividend, FP divisor ) 
<br/>
{ 
<br/>
    s64 tmp = (s64)(dividend &lt;&lt; 32); 
<br/>
    FP quotient = (FP)(( tmp / divisor ) &gt;&gt; (32 - FP_FRACTION_BITS)); 
<br/>
    return quotient; 
<br/>
}
<br/>
// round fixed point to nearest integer
<br/>
FP fix_rnd( FP fp )
<br/>
{
<br/>
   if( fp &gt;= 0 )
<br/>
   {
<br/>
      if( fp &amp; (1 &lt;&lt; (FP_FRACTION_BITS - 1)) )
<br/>
      {
<br/>
         // if fraction is greater or equal to half
<br/>
         return ((fp &amp; ~((1 &lt;&lt; FP_FRACTION_BITS)-1)) + (1 &lt;&lt; FP_FRACTION_BITS);
<br/>
      }
<br/>
      else
<br/>
      {
<br/>
         return (fp &amp; ~((1 &lt;&lt; FP_FRACTION_BITS)-1));
<br/>
      }
<br/>
   }
<br/>
   else
<br/>
   {
<br/>
      FP pos = -fp;
<br/>
      FP val = fp &amp; ~((1 &lt;&lt; FP_FRACTION_BITS)-1);
<br/>
      
<br/>
      if( pos &amp; (1 &lt;&lt; (FP_FRACTION_BITS - 1)) )
<br/>
      {
<br/>
         return (val - (1&lt;&lt;FP_FRACTION_BITS));
<br/>
      }
<br/>
      else
<br/>
      {
<br/>
         return val;
<br/>
      }
<br/>
   }
<br/>
}
<br/>
// return integer from fixed point
<br/>
s32 fix_to_int( FP fp )
<br/>
{   
<br/>
   return (fp &gt;&gt; FP_FRACTION_BITS);
<br/>
}
<br/>
<br/>
<br/>
// get seconds elapsed since timer started
<br/>
FP getTime()
<br/>
{
<br/>
   // read the values from the timers,
<br/>
   // and combine into a 16:16 fixed point value
<br/>
   return (FP)(*((volatile u16*)REG_TIMER_2_VAL) | ((*((volatile u16*)REG_TIMER_3_VAL))&lt;&lt;16));
<br/>
}
<br/>
<br/>
void setUpTimers()
<br/>
{   
<br/>
   *((volatile u16*)REG_TIMER_2_CNT) = 2 | 0x80;   // set timer 2 pre-scalar
<br/>
                                                   // to 2 so that it is updated 
<br/>
                                                   // every 256 cycles, thus 
<br/>
                                                   // overflows every second
<br/>
                                                   // combine enable flag
<br/>
   *((volatile u16*)REG_TIMER_3_CNT) = 4 | 0x80;   // timer 3, prescalar = 0,
<br/>
                                                   // connect = 1, enable = 1
<br/>
}
<br/>
<br/>
typedef struct
<br/>
{   
<br/>
   FP   x;      // x position
<br/>
   FP   y;      // y position
<br/>
   FP   vx;      // x velocity
<br/>
   FP   vy;      // y velocity
<br/>
   FP   ax;      // x acceleration
<br/>
   FP   ay;      // y acceleration
<br/>
}   Player;
<br/>
<br/>
int main()
<br/>
{
<br/>
   .
<br/>
   setUpTimers();
<br/>
   .
<br/>
   
<br/>
   FP   previousTime = getTime();
<br/>
   FP   frameTime;
<br/>
   
<br/>
   Player player;
<br/>
   
<br/>
   player.x = fix(120);
<br/>
   player.y = fix(80);
<br/>
   player.vx = 0;
<br/>
   player.vy = 0;
<br/>
   player.ax = 0;
<br/>
   player.ay = 0;
<br/>
   
<br/>
   while(true)
<br/>
   {
<br/>
      FP time = getTime();
<br/>
      frameTime = time - previousTime;
<br/>
      previousTime = time;
<br/>
      .
<br/>
      .
<br/>
      .
<br/>
      // Set acceleration according to input
<br/>
                  // eg 
<br/>
                  //    player.ay = fix( 9.8f );
<br/>
                  // actually 9.8 will be a crap value as its meters per second squared
<br/>
                  // but we need pixels per second squared. Just try out some
<br/>
                  // values and see how you get on
<br/>
      ...   
<br/>
      // Update position according to velocity and time - (d = vt)
<br/>
      player.x += fix_mul(player.vx, frameTime);
<br/>
      player.y += fix_mul(player.vx, frameTime);
<br/>
      
<br/>
      // Update velocity according to acceleration and time - (v = u + at)
<br/>
      player.vx += fix_mul(player.ax, frameTime);
<br/>
      player.vy += fix_mul(player.ay, frameTime);
<br/>
         
<br/>
      .
<br/>
      // Wait for vblank
<br/>
      
<br/>
      // Calculate screen position by rounding off fixed point position
<br/>
      // and converting it back to integer
<br/>
      s32 spriteX = fix_to_int( fix_rnd( player.x) );
<br/>
      s32 spriteY = fix_to_int( fix_rnd( player.y) );
<br/>
      
<br/>
      // draw sprite at (spriteX, spriteY)
<br/>
      
<br/>
   }
<br/>
<br/>
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Disclaimer: this code is not tested or compiled.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#105689 - sajiimori - Wed Oct 11, 2006 1:38 am</h4>
    <div class="postbody"><span class="postbody">Mucca, most GBA games do run at a fixed framerate.  On all of my games so far, dropping a frame has caused the game logic to run slower.
<br/>
<br/>
The idea is that low framerate is a bug that needs to be fixed, not accepted behavior that needs to be accounted for.
<br/>
<br/>
It depends on the game, of course.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#105695 - Dwedit - Wed Oct 11, 2006 3:20 am</h4>
    <div class="postbody"><span class="postbody">You can always cheat and use tweening to run the game logic every other frame, yet have smooth 60FPS animation.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#105707 - Mucca - Wed Oct 11, 2006 10:21 am</h4>
    <div class="postbody"><span class="postbody">None of the games Ive written so far have attempted to run at full frame rate. They fluctuate, often in the low fifties or high forties, a lot of the time at 60, but sometimes dropping into the thirties. In my experience, as long as the frame rate stays above 35 or 40, the player wont notice it. The fluctuations do not cause slowdown as everything is time based, and the programmers dont have to worry about cycle counts until the situation affects the user-experience. Heavy frames are often hard to predict, and its mostly only possible to avoid them through lamentable design decisions which limit the player's experience further.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#105734 - Sausage Boy - Wed Oct 11, 2006 3:51 pm</h4>
    <div class="postbody"><span class="postbody">Perhaps it runs slow because you're always mucking around with the time. ;)
<br/>
<br/>
Also, I'd say the fixed point you described in your first post QuantumDoja is enough, no need to over-complicate it. The reason to use fixed point is usually to allow sub-pixel movement, and that's what you do, it's fine.<br/>_________________<br/>"no offense, but this is the gayest game ever"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#105755 - sajiimori - Wed Oct 11, 2006 6:58 pm</h4>
    <div class="postbody"><span class="postbody">All my games have been locked to 30fps.  The two main benefits (off the top of my head) are that the code is simpler and battery usage is lower.  Besides that, it has been argued that changes in framerate are often more noticable than a consistently moderate framerate.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#105756 - QuantumDoja - Wed Oct 11, 2006 7:00 pm</h4>
    <div class="postbody"><span class="postbody">Hi, thanks for the info im using your code to update the position, im finding that i can set a y velocity and the player will fall faster and faster - I hope this is correct??
<br/>
<br/>
what bugs me know is how to slow down! for instance if I move right I have an acceleration of say: 5.0f and in the code to check if im pressing any buttons i can decrease the acceleration...but this makes no effect on the velocity - again is this correct?<br/>_________________<br/>Chris Davis</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#105758 - Sausage Boy - Wed Oct 11, 2006 7:09 pm</h4>
    <div class="postbody"><span class="postbody">If you know about Newton's first law, you'll know that it's just like in <span style="font-style: italic">real life</span> :P. One way of handling it would be to take air resistance into account.<br/>_________________<br/>"no offense, but this is the gayest game ever"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#105760 - sajiimori - Wed Oct 11, 2006 7:27 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">Vector2 applyFriction(const Vector2* v)
<br/>
{
<br/>
  // Choose your own value.
<br/>
  const friction = fix(0.8);
<br/>
<br/>
  Vector2 result;
<br/>
<br/>
  result.x = fix_mul(v-&gt;x, friction);
<br/>
  result.y = fix_mul(v-&gt;y, friction);
<br/>
<br/>
  return result;
<br/>
}</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#105761 - Mucca - Wed Oct 11, 2006 7:35 pm</h4>
    <div class="postbody"><span class="postbody">If your character is moving right (ie the velocity is positive eg +60), to slow down you will need a negative acceleration (eg -80).
<br/>
<br/>
If your character is moving left (ie the velocity is negative), to slow down you will need a positive acceleration.
<br/>
<br/>
If your character needs to jump, this is achieved by applying simply setting the y velocity to some initial jump velocity (eg -100). The y acceleration is then set to a gravity type value (eg 90). Play around with the values until it looks good.
<br/>
<br/>
If you set a y velocity, but y acceleration is zero, the player should fall at a constant rate. If you set a y acceleration, the player will fall faster and faster. Its probably a good idea to cap the y velocity at some point</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#105764 - sajiimori - Wed Oct 11, 2006 7:58 pm</h4>
    <div class="postbody"><span class="postbody">That's a very complicated way of looking at basic game physics.  This is simpler:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void updatePlayerPhysics()
<br/>
{
<br/>
  // Apply gravity.
<br/>
  if(!onGround())
<br/>
    player.vel.y -= fix(0.1);
<br/>
<br/>
  player.pos.x += player.vel.x;
<br/>
  player.pos.y += player.vel.y;
<br/>
<br/>
  // Defined in my last post.
<br/>
  player.vel = applyFriction(&amp;player.vel);
<br/>
}</td> </tr></table><span class="postbody">There's no need to store acceleration values or check signs.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#105768 - keldon - Wed Oct 11, 2006 8:10 pm</h4>
    <div class="postbody"><span class="postbody">If you stick to how physics works then it can be a lot easier to tackle these problems. Acceleration is reset after each frame. When you jump you need only add to the frames acceleration. Gravity is constant acceleration.
<br/>
<br/>
Here is a really good example of physics <a class="postlink" href="http://www.dcs.qmul.ac.uk/sodarace/teaching/projects/sodaflowers/software/SodaLab.zip" target="_blank">(click here)</a>. Download that and run the jar, load up experiment 1 and observe. The red lines are the velocity vectors; notice how the heavier mass falls at the same speed, yet has a higher velocity and has the same amount of acceleration applied. I was just about to say that the source is included in the rar but it isn't; but I'm sure that gravity was achieved by simply providing a constant acceleration to each mass.
<br/>
<br/>
<a class="postlink" href="http://www.dcs.qmul.ac.uk/sodarace/teaching/projects/sodaflowers/physics/index.html" target="_blank">Here</a> is a nice explanation of physics.
<br/>
<br/>
Most of the SodaLab is implemented with about 30 [active] lines of code, doing nothing but implementing the laws of physics.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#105788 - thegamefreak0134 - Wed Oct 11, 2006 10:07 pm</h4>
    <div class="postbody"><span class="postbody">I think I have a quick solution to your buggage.
<br/>
<br/>
Think of acceleration as a velocity modifier. Thus, if you have an acceleration of 5, velocity is increased by 5 every frame. (assuming, for the sake of simplicity, that you have a fixed framerate.) So to controll your character, do something to this effect every frame:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
if button Right = pressed { x accel = 1} ;
<br/>
if button Left = pressed { x accel = -1} ;
<br/>
if button Up = pressed { y accel = -1} ;
<br/>
if button Down = pressed { y accel = 1} ;
<br/>
<br/>
x velocity = x velocity + x accell;
<br/>
y velocity = y velocity + y accell;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
This poses a slight problem, considering that after several frames the velocity would be something like 73, causing the character to fly to the ends of levels. So, you put in a check:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
if x velocity &gt; 5 {x velocity = 5}
<br/>
if x velocity &lt; -5 {x velocity = -5}
<br/>
if y velocity &gt; 5 {y velocity = 5}
<br/>
if y velocity &lt; -5 {y velocity = -5}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Then, every frame you add the x velocity to the characters X position in the level and add the Y velocity to the characters Y position in the level. The important thing to remember here is that, unless you need a sudden stop or start effect, you ignore the velocity and let the acceleration dictate what the velocity does.
<br/>
<br/>
I realise that this example does not account for say bringing the character to a stop on a button release or something like that, but the theorey should still work. Someone correct me if I am wrong... Which is possible knowing me.
<br/>
<br/>
-thegamefreak<br/>_________________<br/>What if the hokey-pokey really is what it's all about?
<br/>
<br/>
[url=http:/www.darknovagames.com/index.php?action=recruit&amp;clanid=1]Support Zeta on DarkNova![/url]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#105797 - keldon - Wed Oct 11, 2006 11:17 pm</h4>
    <div class="postbody"><span class="postbody">thegamefreak, acceleration is reset at the beginning/end of your calculations so if you are jumping you can simply add [for example] 5 to the y axis acceleration and it will be fine. If your model has gravity and friction then it will actually work perfectly fine.
<br/>
<br/>
Sajimori's code is what you will need to get by.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106049 - QuantumDoja - Sat Oct 14, 2006 6:10 pm</h4>
    <div class="postbody"><span class="postbody">Thank you to everyone who has responded to this post...I thought Id share with you what ive got now and where im up to:
<br/>
<br/>
<a class="postlink" href="http://www.quantumlogic.co.uk/GBA/Main2.rar" target="_blank">http://www.quantumlogic.co.uk/GBA/Main2.rar</a> - click to download the *.gba file, my code now looks like this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
while(levelComplete == 0) {
<br/>
         
<br/>
         FP time = getTime();
<br/>
         frameTime = time - previousTime;
<br/>
         previousTime = time; 
<br/>
<br/>
         addFrictionAndGravity();
<br/>
         storeTempPos();
<br/>
         platformDetect();
<br/>
<br/>
         if (keyDown(KEY_B) &amp;&amp; PlayerSprite.jumping != 1) {
<br/>
            dir = 4;
<br/>
            PlayerSprite.jumping == 1;
<br/>
            PlayerSprite.air = 1;
<br/>
            //PlayerSprite.pos.y -= fix_float(12.8f);
<br/>
            PlayerSprite.vel.y = fix_float(-80.8f);
<br/>
            PlayerSprite.acc.y = fix_float(4.8f);
<br/>
            last_key = dir;
<br/>
         }
<br/>
<br/>
         if (keyDown(KEY_LEFT)) {
<br/>
            dir = 0;
<br/>
            PlayerSprite.acc.x = fix_float(-30.75f);
<br/>
            last_key = 0;
<br/>
         }
<br/>
         else if (keyDown(KEY_RIGHT)) 
<br/>
            {
<br/>
               dir = 2;
<br/>
               PlayerSprite.acc.x = fix_float(30.75f);
<br/>
               last_key = 2;
<br/>
            } 
<br/>
         else if (PlayerSprite.air != 1) {
<br/>
<br/>
         }
<br/>
<br/>
<br/>
         PlayerSprite.pos.x += fix_mul(PlayerSprite.vel.x, frameTime); 
<br/>
         PlayerSprite.pos.y += fix_mul(PlayerSprite.vel.y, frameTime); 
<br/>
<br/>
         PlayerSprite.vel.x += fix_mul(PlayerSprite.acc.x, frameTime);
<br/>
         PlayerSprite.vel.y += fix_mul(PlayerSprite.acc.y, frameTime); 
<br/>
<br/>
<br/>
         SpriteAnimation();
<br/>
         WaitForVsync();   
<br/>
<br/>
         s32 spriteX = fix_to_int( fix_rnd( PlayerSprite.pos.x) );
<br/>
         s32 spriteY = fix_to_int( fix_rnd( PlayerSprite.pos.y) ); 
<br/>
         MoveSprite(&amp;sprites[0],spriteX,spriteY);
<br/>
         //PlotPixel(spriteX,spriteY,254);
<br/>
<br/>
         CopyOAM();
<br/>
         UpdateBackground(&amp;bg0);
<br/>
         UpdateBackground(&amp;bg1);
<br/>
         UpdateBackground(&amp;bg2);
<br/>
         UpdateBackground(&amp;bg3);
<br/>
<br/>
<br/>
      }
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Im still struggling with the fixed point math so my numbers may be well out.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void addFrictionAndGravity() {
<br/>
<br/>
   PlayerSprite.vel.y += fix_float(8.4f);</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void storeTempPos() {
<br/>
   PlayerSprite.temppos.x = PlayerSprite.pos.x;
<br/>
   PlayerSprite.temppos.y = PlayerSprite.pos.y;
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
my character still slides and im struggling to get him to stop!!!<br/>_________________<br/>Chris Davis</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106083 - sajiimori - Sun Oct 15, 2006 12:32 am</h4>
    <div class="postbody"><span class="postbody">I'd suggest removing PlayerSprite.acc and PlayerSprite.temppos.  That kind of redundant state just makes things more complicated.
<br/>
<br/>
I'd also suggest removing variable framerate because almost no GBA games use it, and it also overcomplicates things.
<br/>
<br/>
Careful here:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">PlayerSprite.jumping == 1;</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106116 - QuantumDoja - Sun Oct 15, 2006 1:55 pm</h4>
    <div class="postbody"><span class="postbody">thanks for this one </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">PlayerSprite.jumping == 1;</td> </tr></table><span class="postbody">, i didn't spot it, made so much difference to the jumping!<br/>_________________<br/>Chris Davis</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#106117 - QuantumDoja - Sun Oct 15, 2006 2:11 pm</h4>
    <div class="postbody"><span class="postbody">for those interested... heres what I have now....what do you think?
<br/>
<br/>
A Big thank you to everyone who posted on this thread you have all been really helpfull!
<br/>
<br/>
<a class="postlink" href="http://www.quantumlogic.co.uk/GBA/Main3.rar" target="_blank">http://www.quantumlogic.co.uk/GBA/Main3.rar</a> :-)<br/>_________________<br/>Chris Davis</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
