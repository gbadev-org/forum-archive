<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Multiplayer - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > Multiplayer</h2>
<div id="posts">
<div class="post">
    <h4>#23785 - Daniel Andersen - Wed Jul 21, 2004 3:28 pm</h4>
    <div class="postbody"><span class="postbody">I am struggling to get some simple multiplayer code to work, but it seems only to work in no$gba, not on real hardware. On the real thing, it detects who are slave and master, though.
<br/>
<br/>
It seams that after initializing a send, the SIOCNT is always signalizing busy, no matter how long both master and slave waits.
<br/>
<br/>
Here is some code:
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   ;; Setup multiplayer mode
<br/>
<br/>
   ; Address link
<br/>
   MOV   R0, #0x04000000
<br/>
   ADD   R0, R0, #0x120
<br/>
<br/>
   ; Initialize RCNT
<br/>
   MOV   R1, #0
<br/>
   STRH   R1, [R0, #0x14]
<br/>
<br/>
   ; Initialize SIOCNT
<br/>
   MOV   R1, #0x2000
<br/>
   ; ORR   R1, R1, #0x3
<br/>
   STRH   R1, [R0, #0x8]
<br/>
<br/>
   ; Wait for all players to enter multiplayer mode
<br/>
   ; &lt;snap - works fine&gt;
<br/>
<br/>
   ; Just keep looping
<br/>
Loop
<br/>
<br/>
   ;; Wait for inactivity
<br/>
SpaceDust_SendPacket_Wait1
<br/>
<br/>
   ; Get activity
<br/>
   LDRH   R1, [R0, #0x8]
<br/>
   ANDS   R10, R1, #0x80
<br/>
   BNE   SpaceDust_SendPacket_Wait1
<br/>
<br/>
   ;; Start transfer
<br/>
<br/>
   ; Write outgoing data to SIODATA_SEND
<br/>
   LDR   R1, [R12, -4]
<br/>
   STRH   R1, [R0, #0xA]
<br/>
<br/>
   ; Get status
<br/>
   LDRH   R1, [R0, #0x8]
<br/>
<br/>
   ; Check master
<br/>
   ANDS   R10, R1, #0x4
<br/>
   BNE   SpaceDust_SendPacket_Wait2
<br/>
<br/>
   ; Set start bit
<br/>
   ORR   R1, R1, #0x80
<br/>
   STRH   R1, [R0, #0x8]
<br/>
<br/>
   ;; Wait for transfer to start
<br/>
SpaceDust_SendPacket_Wait2
<br/>
<br/>
   ; Get activity
<br/>
   LDRH   R1, [R0, #0x8]
<br/>
   ANDS   R1, R1, #0x80
<br/>
   BEQ   SpaceDust_SendPacket_Wait2
<br/>
<br/>
   ;; Wait for transfer to finish
<br/>
SpaceDust_SendPacket_Wait3
<br/>
<br/>
   ; Get activity
<br/>
   LDRH   R1, [R0, #0x8]
<br/>
   ANDS   R1, R1, #0x80
<br/>
   BNE   SpaceDust_SendPacket_Wait3
<br/>
<br/>
   B   Loop</td> </tr></table><span class="postbody">
<br/>
<br/>
Actually, in my code it loops until indata of master is not equal to 0xFFFF. Master sends #0.
<br/>
<br/>
Hope someone can figure it out! :)<br/>_________________<br/>In a world without fences and walls you will never need gates and windows.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23787 - Daniel Andersen - Wed Jul 21, 2004 3:31 pm</h4>
    <div class="postbody"><span class="postbody">Ah, forgot to tell that in no$gba it doesn't work if selecting "normal (two players)" as link cable type. It only works if selecting "multiplayer (four players)." What's the difference?
<br/>
<br/>
On real hardware I got AGB-005 connected between two GBA's.<br/>_________________<br/>In a world without fences and walls you will never need gates and windows.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23790 - tepples - Wed Jul 21, 2004 5:03 pm</h4>
    <div class="postbody"><span class="postbody">"Normal" is the Game Boy Color link cable.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
