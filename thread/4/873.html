<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Basic Random Number Generation - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Coding > Basic Random Number Generation</h2>
<div id="posts">
<div class="post">
    <h4>#4363 - Archeious - Fri Mar 28, 2003 10:42 pm</h4>
    <div class="postbody"><span class="postbody">How can I generate simple random numbers.  It doesn't have to be very good.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4371 - fezz1k - Sat Mar 29, 2003 1:01 am</h4>
    <div class="postbody"><span class="postbody"><a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=66" target="_blank">RNG</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4372 - darkcloud - Sat Mar 29, 2003 1:25 am</h4>
    <div class="postbody"><span class="postbody">Here's a simple one :
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
unsigned int seed = 289301;
<br/>
<br/>
unsigned int rand()
<br/>
{
<br/>
    seed = 69069 * seed + 1;
<br/>
    return seed &gt;&gt; 16;
<br/>
}
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/>Maybe in order to understand mankind, we have to look at the word itself: "Mankind". Basically, it's made up of two separate words - "mank" and "ind". What do these words mean ? It's a mystery, and that's why so is mankind.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4576 - Indecisive - Thu Apr 03, 2003 7:48 pm</h4>
    <div class="postbody"><span class="postbody">If you just want something really basic. You can just:
<br/>
<br/>
#include "stdlib.h" 
<br/>
<br/>
Then, to generate a value between 0 and X you use:
<br/>
<br/>
rand()%X
<br/>
<br/>
I think I remembered that right. I'm no expert.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4588 - tepples - Thu Apr 03, 2003 9:53 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Indecisive wrote:</b></span></td> </tr> <tr> <td class="quote">rand()%X</td> </tr></table><span class="postbody">
<br/>
BAD BAD BAD.
<br/>
<ul>
<br/>
<li>The % operation is division, which is very slow on the GBA.
<br/>
</li><li>The % operation emphasizes the low-order bits, and the low-order bits of the result of rand() in common implementations of the C standard library tend to be very predictable.
<br/>
</li><li>The rand() of newlib is slow.
<br/>
</li></ul>
<br/>
The fast way to generate small random numbers is to use a linear congruential generator like the one darkcloud gave above, along with a rescaler to provide random numbers in a range. But don't call your function "rand()" because for one thing, there's already a stdlib function by that name and for another, your code does not know the value of RAND_MAX in stdlib.h (is it 2&lt;&lt;15? is it 2&lt;&lt;16? is it 2&lt;&lt;31? is it 2&lt;&lt;32?).
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define AYN_BITS 15
<br/>
#define AYN_MAX (1 &lt;&lt; AYN_BITS)
<br/>
<br/>
static unsigned long seed;
<br/>
<br/>
/* ayn() *****
<br/>
   Random number generator based on one from
<br/>
   http://random.mat.sbg.ac.at/~charly/server/node3.html
<br/>
*/
<br/>
unsigned int ayn(Player *p)
<br/>
{
<br/>
  seed = seed * 2147001325 + 715136305;
<br/>
  return (seed &gt;&gt; 17) &amp; AYN_MAX;
<br/>
}
<br/>
<br/>
/* aynlt() *****
<br/>
   Generate a random whole number less than n.
<br/>
*/
<br/>
unsigned int aynlt(unsigned int n)
<br/>
{
<br/>
  return (ayn() * n) &gt;&gt; AYN_BITS;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
EDIT: Indecisive, apology accepted.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"><br/><br/>Last edited by tepples on Fri Apr 04, 2003 12:53 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#4590 - Indecisive - Thu Apr 03, 2003 11:30 pm</h4>
    <div class="postbody"><span class="postbody">I said it was really basic but apologies for not mentioning the badness, it was meant to be implied.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4608 - Lord Graga - Fri Apr 04, 2003 10:25 am</h4>
    <div class="postbody"><span class="postbody">That method CAN be OK some times...but there is another problems:
<br/>
<br/>
It won't work too well in some cases....I used that method in my GBAX compo entry, Klan Wars. When the AI was gong to set up their troops on the board, I had to do a y = GetRand(10). However, since 10 is a straight number (divideable by 2), then It would never set any characters up at 1, 3, 5, 7 and 9.
<br/>
<br/>
Ways it can be solved, but it still won't be random:
<br/>
<br/>
* In every set up frame do RAND()%13 (13 is a prime number) RAND()%17 times.
<br/>
<br/>
kinda like:
<br/>
for(i=0;i&lt;RAND()%13;i++) misc = RAND()%17;</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4610 - sgeos - Fri Apr 04, 2003 4:16 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lord Graga wrote:</b></span></td> </tr> <tr> <td class="quote">When the AI was gong to set up their troops on the board, I had to do a y = GetRand(10). However, since 10 is a straight number (divideable by 2), then It would never set any characters up at 1, 3, 5, 7 and 9.</td> </tr></table><span class="postbody">
<br/>
<br/>
This is because your seed is odd.  When you multiply an odd number by another odd number, the result is always odd.  If you have an even seed, your results will always be even.  The low order bits are less random, so, try something like this:
<br/>
<br/>
seed *= 69069;
<br/>
return seed ^ (seed &gt;&gt; 16);
<br/>
<br/>
OR
<br/>
<br/>
seed *= 69069;
<br/>
seed += 1;
<br/>
return seed;  /* or add ^ (seed &gt;&gt; 16) */
<br/>
<br/>
I've not tested the period of the later.  In either case, the period will probably be long enough for a game.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4611 - sgeos - Fri Apr 04, 2003 5:03 pm</h4>
    <div class="postbody"><span class="postbody">I just tested this code and it works:
<br/>
<br/>
  unsigned long seed;
<br/>
<br/>
  signed long dice(signed long min, signed long max)
<br/>
  {
<br/>
    seed *= 69069;
<br/>
    return min + ((max - min + 1) * (seed &gt;&gt; 16)) / 0x10000;
<br/>
  }
<br/>
<br/>
If you want a number from -20 to 90, call:
<br/>
  dice(-20, 90);
<br/>
<br/>
Note that (max - min + 1) can be no more than 16 bits or else the code will break.  You can call something like:
<br/>
  dice(16000, 80000);
<br/>
<br/>
Because (max - min + 1) is less than 16 bits (64001), even though max is greater than 16 bits.  As far as big ranges with negative numers go, I don't know what the largest, or smallest depending on how you look at it,
<br/>
value for (max - min + 1).  I imagine that if it fits in 16bits everything should be ok.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
