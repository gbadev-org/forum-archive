<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Background and sprite draw priority - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > Background and sprite draw priority</h2>
<div id="posts">
<div class="post">
    <h4>#1050 - regularkid - Tue Jan 14, 2003 5:19 am</h4>
    <div class="postbody"><span class="postbody">In a bitmap mode (3 - 5) is it possible to draw over a gba hardware sprite? For example, is it possible to draw a line "behind" the sprite and then a line "in front of" the sprite?<br/>_________________<br/>- RegularKid</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1067 - Quirky - Tue Jan 14, 2003 9:47 am</h4>
    <div class="postbody"><span class="postbody">You can do one or the other, but not both to the same sprite. You only have 2 layers: sprite and background. So a sprite can't be both under the background and on top of it at the same time.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1086 - Splam - Tue Jan 14, 2003 2:17 pm</h4>
    <div class="postbody"><span class="postbody">You can set the sprite/background priority to in front/behind on alternate lines by using an hdma or hblank interrupt.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1087 - Splam - Tue Jan 14, 2003 2:21 pm</h4>
    <div class="postbody"><span class="postbody">---ignore this, posted in wrong thread--</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1092 - anli - Tue Jan 14, 2003 2:53 pm</h4>
    <div class="postbody"><span class="postbody">bitmapped backgrounds do not have transparent pixels, so it is probably a bad idea to put sprites behind it. You will not see the sprites.
<br/>
<br/>
But.. if you rotate or scale a bitmapped background, you can see whats behind (in non-covered areas).
<br/>
<br/>
/anli</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1098 - Splam - Tue Jan 14, 2003 4:58 pm</h4>
    <div class="postbody"><span class="postbody">Pretty sure you're wrong..
<br/>
<br/>
As long as the colour is 0 either in 8bpp mode or in the 16bpp modes that pixel is transparent.  This is also the reason for them being BG2 and not BG0  so the're mid point and can have priority on either side of them.
<br/>
<br/>
hence this from the official docs
<br/>
<br/>
<span style="font-weight: bold">Edit: Please do not mention or post information from any official, illegal Nintendo documentation. Thanks.</span>
<br/>
<br/>
<br/>
Just done some test code too and it works..</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1102 - anli - Tue Jan 14, 2003 5:17 pm</h4>
    <div class="postbody"><span class="postbody">The question was about modes 3, 4 and 5, which doesnt have transparent pixels.
<br/>
<br/>
Of course, you can draw pixels over a sprite using another sprite, but I didnt understand the question as whether that is possible or not.
<br/>
<br/>
To clarify the answer I was giving, in screen mode 3, 4 and 5, you only have one bg layer. You can put sprites in front of that layer or behind that layer. (You can choose to put a number of sprites behind it and another
<br/>
set of sprites in front of it).
<br/>
<br/>
If you choose to put a sprite behind it. It will be covered by it unless the bg layer is scrolled a bit or rotated so they become not covered by it.
<br/>
<br/>
Hope I got it right
<br/>
<br/>
/anli</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1106 - Splam - Tue Jan 14, 2003 5:54 pm</h4>
    <div class="postbody"><span class="postbody">Yes, modes 3,4 or 5.  Which as I said above ARE transparent IF the colour register (or 16bit colour value) is 0.
<br/>
<br/>
In my 1st post I explained how to do what was reqired by regularkid, no need to use any other sprites just hblank or hdma.
<br/>
<br/>
Please read my posts again.  It's all explained.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1109 - regularkid - Tue Jan 14, 2003 6:36 pm</h4>
    <div class="postbody"><span class="postbody">Thanks. Your advices were helpful. However, I can't use the hblank to update my sprite data because I want to basically turn off and on each column (vertical strip) as it gets drawn. This is because I am trying to make a raycasting game. The enemies will need to be sprites because they can easily be scaled and they provide transparency. However, I am stuck because I need to clip the sprite if there are walls in front of it. So I decided to make a very small z-buffer (just a distance value) for each vertical strip of the walls. Then, when I go to draw the sprite, I wanted to not draw any strips that were farther away than the current column. Make sense (its early so my explanation my not be too clear :) )? Does anyone know of a good way to do this?<br/>_________________<br/>- RegularKid</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1113 - anli - Tue Jan 14, 2003 7:05 pm</h4>
    <div class="postbody"><span class="postbody">Oh, that seems to be a really difficult task.
<br/>
I think all 3D engines are using bitmapped modes, and leaves sprites aside.
<br/>
<br/>
<br/>
I must also reply on Splams answer:
<br/>
<br/>
My mode3 test on
<br/>
<a class="postlink" href="http://www.anderslinden.net/gba/bitmapped_and_transparent/test.gba" target="_blank">http://www.anderslinden.net/gba/bitmapped_and_transparent/test.gba</a>
<br/>
<br/>
reveals that the black color is not treated differently.
<br/>
<br/>
If it was, the backdrop color and the rightmost sprite would shine through
<br/>
the black area of bg2.
<br/>
<br/>
/anli</span><span class="gensmall"><br/><br/>Last edited by anli on Tue Jan 14, 2003 11:53 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#1114 - Splam - Tue Jan 14, 2003 7:07 pm</h4>
    <div class="postbody"><span class="postbody">Ahh, vertical :)
<br/>
<br/>
Your post makes sense, It was me who said you could do your raycasting thing with sprites if you remember ;)
<br/>
<br/>
One way to do it would be to mask the vertical strip by rewriting the data for that strip (could get kind of slow but it's not that bad).
<br/>
<br/>
Another way would be to use the 2 gba windows (not to be condused with screens).  but there are only 2 of these so you'd be limited to the number of sprites you could mask.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1124 - regularkid - Tue Jan 14, 2003 8:54 pm</h4>
    <div class="postbody"><span class="postbody">What a coincidence :) In another thread I have on this board someone just mentioned windows also. Good idea.<br/>_________________<br/>- RegularKid</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1135 - icon - Tue Jan 14, 2003 10:10 pm</h4>
    <div class="postbody"><span class="postbody">I think both anli and JCB are lamers... ;-) hahaha...<br/>_________________<br/>Icon member of Parallaxsisters (GBA)
<br/>
and Remember (c64)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1139 - Splam - Tue Jan 14, 2003 11:17 pm</h4>
    <div class="postbody"><span class="postbody">icon, get back to lemon, fool :)
<br/>
<br/>
@anli
<br/>
I apologise (always willing to do so when proven wrong), I did my test with a byte per pixel screen and it worked and according to the official Nintendo docs it should work on all modes but obviosuly it doesn't in the 16bpp modes (there are plenty of mistakes in that doc considering its the one developers are given).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1141 - anli - Tue Jan 14, 2003 11:55 pm</h4>
    <div class="postbody"><span class="postbody">Ah, icon has entered the building!
<br/>
<br/>
/anli</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1143 - squeakytoy - Wed Jan 15, 2003 12:09 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>anli wrote:</b></span></td> </tr> <tr> <td class="quote">I think all 3D engines are using bitmapped modes, and leaves sprites aside.</td> </tr></table><span class="postbody">
<br/>
<br/>
V Rally 3 uses a 3D engine for the tracks, but the cars are sprites.  They can get away with this because you will always have a clear view of <span style="font-style: italic">your</span> car - no need for clipping/transparency.
<br/>
<br/>
In the 4 car race mode, however, you can see the other cars through walls etc.  Due to careful level design, this doesn't happen too often and you don't really notice it much.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1144 - Splam - Wed Jan 15, 2003 12:10 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>regularkid wrote:</b></span></td> </tr> <tr> <td class="quote">Official Nintendo GBA Docs? Can you send me a link to them? That would be awsome! Thanks.</td> </tr></table><span class="postbody">
<br/>
<br/>
hehe  you trying to get me killed or something?   I wish I could send you a link but you have to be a registered developer with Nintendo and get a password to downlod them and I'm not taking the chance of giving them out.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1146 - regularkid - Wed Jan 15, 2003 12:14 am</h4>
    <div class="postbody"><span class="postbody">Awww! Its ok, I understand. What company do you work for?<br/>_________________<br/>- RegularKid</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1147 - Splam - Wed Jan 15, 2003 12:39 am</h4>
    <div class="postbody"><span class="postbody">None at the moment.  Waiting for a freelance contract and doing my own stuff.
<br/>
<br/>
There's really not much in them that isn't documented elsewhere and unfortunatly (as seems the case this time) there ARE mistakes in there.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
