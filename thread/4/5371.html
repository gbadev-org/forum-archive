<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>I understand the concept, but fixed point is the problem... - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > I understand the concept, but fixed point is the problem...</h2>
<div id="posts">
<div class="post">
    <h4>#39150 - LOst? - Tue Apr 05, 2005 5:34 am</h4>
    <div class="postbody"><span class="postbody">For you people that underastand Outrun game technology, and how to make it come true by using fixed point math, a little help would be nice.
<br/>
<br/>
It doesn't matter how much I debug the game, there is a pre-calced table with values it seems to use. Now how do I get from here to there?
<br/>
<br/>
Look at this picture I drew so nicely for you:
<br/>
<a href="http://www.logotypes.se/tmp/outr_tech.png">[Images not permitted - Click here to view it]</a>
<br/>
What you see is a map on the left, and the display output on the right.
<br/>
<br/>
p1 and p2 are simply relative coordinates on the map which is used to get the distance in between them. I get it by doing this:
<br/>
<br/>
<span style="font-weight: bold">p2 - p1 = pixel distance</span>
<br/>
<br/>
The result is then divided by the distance I want it to be drawn on the display... right?
<br/>
<br/>
Let's take a sample. Say p1 = 10 and p2 = 80:
<br/>
<br/>
<span style="font-weight: bold">80 - 10 = 70</span>
<br/>
<br/>
And the draw distance is 128:
<br/>
<br/>
<span style="font-weight: bold">70 / 128 = 0.546875</span>
<br/>
<br/>
So the concept is easy, I move the map vertically with the speed of 0.546875 during HBlank. Easy! Well, no. Because how much I try to convert that value into fixed point I fail.
<br/>
<br/>
First off, I usually use 8 bits for the decimal point... But maybe that's the problem? Hell I have no idea how to even convert this thing to fixed point. What's the secret? Just a wild guess here:
<br/>
<br/>
<span style="font-weight: bold">0.546875 * 256 = 140</span>
<br/>
<br/>
<span style="font-weight: bold">140 * 128 = 0x4600</span> which is 70.0
<br/>
<br/>
Why does it work now? Crap &gt;.&lt;;;
<br/>
<br/>
Anyway, I need help. I was just lucky this time. Next time I will get into problems so tell me how this should be done from your point of view.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39151 - tepples - Tue Apr 05, 2005 5:42 am</h4>
    <div class="postbody"><span class="postbody">When you divide in fixed point, you have to multiply by your denominator (which is 256 if you're using .8 binary fixed-point) first.
<br/>
<br/>
So you'd do <span style="font-weight: bold">(70 * 256) / 128</span><br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39152 - LOst? - Tue Apr 05, 2005 5:46 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">When you divide in fixed point, you have to multiply by your denominator (which is 256 if you're using .8 binary fixed-point) first.
<br/>
<br/>
So you'd do <span style="font-weight: bold">(70 * 256) / 128</span></td> </tr></table><span class="postbody">
<br/>
<br/>
So that's the secret. That way I will be able to skip the floating point result?
<br/>
<br/>
I sat down for a few hours trying all kind of stuff like this:
<br/>
<span style="color: brown">70 * 0x100 / 128 * 0x100</span>
<br/>
<br/>
With very odd results. The main thing is to avoid the floating point and only use fixed point, even pre-calced tables. That will be a challenge for me. Thank you for your quick help tepples!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39170 - tepples - Tue Apr 05, 2005 3:03 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>LOst? wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">When you divide in fixed point, you have to multiply by your denominator (which is 256 if you're using .8 binary fixed-point) first.
<br/>
<br/>
So you'd do <span style="font-weight: bold">(70 * 256) / 128</span></td> </tr></table><span class="postbody">
<br/>
<br/>
So that's the secret. That way I will be able to skip the floating point result?</span></td> </tr></table><span class="postbody">
<br/>
Yes.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I sat down for a few hours trying all kind of stuff like this:
<br/>
<span style="color: brown">70 * 0x100 / 128 * 0x100</span></td> </tr></table><span class="postbody">
<br/>
No, <span style="color: brown">70 * 0x100 / 128</span>. You multiply only the numerator.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39175 - poslundc - Tue Apr 05, 2005 4:03 pm</h4>
    <div class="postbody"><span class="postbody">Multiplication: precision of the result is the sum of the precisions of the two operands. eg. 24.8 * 24.8 = 16.16 result
<br/>
<br/>
Division: precision of the result is the difference of the precisions of the two operands. eg. 24.8 / 24.8 = 32.0 result.
<br/>
<br/>
Prescaling/shifting your numerator before dividing lets you maintain precision across the divide.
<br/>
<br/>
(24.8 &lt;&lt; 8) = 16.16
<br/>
16.16 / 24.8 = 24.8
<br/>
<br/>
It's the same as with decimal math. 1/3 = 0 in integer terms. But if you multiply the numerator by 100 to shift it two decimal places, you get 100/3 = 33, or two decimal places worth of precision.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
