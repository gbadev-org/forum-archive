<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Rotation Problem - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Coding > Rotation Problem</h2>
<div id="posts">
<div class="post">
    <h4>#79611 - ProblemBaby - Fri Apr 14, 2006 2:49 pm</h4>
    <div class="postbody"><span class="postbody">Hello
<br/>
<br/>
Iam trying to rotate an object around a point. It works, but its so unsmooth it jumps around the rotcenter.
<br/>
Is it something thats wrong with the code?
<br/>
or any ideas how I can make it more accurate.
<br/>
<br/>
sx, sy: rotation point relative to the center of the object
<br/>
- 32 is because its a 32x32 object Iam drawing
<br/>
my COS and SIN table have the format 1:3:12
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
f16 cos = COS(Angle) &gt;&gt; 4;
<br/>
f16 sin = SIN(Angle) &gt;&gt; 4;
<br/>
<br/>
Object.x = x - 32 + (((cos * sx) - (sin * sy)) &gt;&gt; 8);
<br/>
Object.y = y - 32 - (((sin * sx) + (cos * sy)) &gt;&gt; 8);
<br/>
Object.pa = cos;
<br/>
Object.pb = -sin;
<br/>
Object.pc = sin;
<br/>
Object.pd = cos;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Thanks</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#79624 - Cearn - Fri Apr 14, 2006 5:30 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ProblemBaby wrote:</b></span></td> </tr> <tr> <td class="quote">Hello
<br/>
<br/>
Iam trying to rotate an object around a point. It works, but its so unsmooth it jumps around the rotcenter.
<br/>
Is it something thats wrong with the code?
<br/>
or any ideas how I can make it more accurate.
<br/>
<br/>
sx, sy: rotation point relative to the center of the object
<br/>
- 32 is because its a 32x32 object Iam drawing
<br/>
my COS and SIN table have the format 1:3:12
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
f16 cos = COS(Angle) &gt;&gt; 4;
<br/>
f16 sin = SIN(Angle) &gt;&gt; 4;
<br/>
<br/>
Object.x = x - 32 + (((cos * sx) - (sin * sy)) &gt;&gt; 8);
<br/>
Object.y = y - 32 - (((sin * sx) + (cos * sy)) &gt;&gt; 8);
<br/>
Object.pa = cos;
<br/>
Object.pb = -sin;
<br/>
Object.pc = sin;
<br/>
Object.pd = cos;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Thanks</span></td> </tr></table><span class="postbody">
<br/>
You've seen <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=8992" target="_blank">this thread</a>, right? What you got here is very similar, but not exactly the same. First, try
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">Object.x = x-32 - ( ( cos*sx + sin*sy)&gt;&gt;8);
<br/>
Object.y = y-32 - ( (-sin*sx + cos*sy)&gt;&gt;8);
<br/>
</td> </tr></table><span class="postbody">If you resolve all the parentheses and signs, the cosines should have equal signs and the sines' signs should be each other's opposites.
<br/>
<br/>
The smoothness problem might also be caused by a fixed point mismatch. The way I see it, 
<br/>
x and Object.x should be .0, 
<br/>
cos is .8 as you mentioned, which means that 
<br/>
sx and sy should be .0 as well, not .8. 
<br/>
Or .8 with a &gt;&gt;16 instead of a &gt;&gt;8.
<br/>
<br/>
If that doesn't help, can we see the thing in action for ourselves?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#79717 - ProblemBaby - Sat Apr 15, 2006 4:47 pm</h4>
    <div class="postbody"><span class="postbody">I tried those things, it didn't help. I can't upload it, cause my friends server is down, so Ive nowhere to upload it. I can send it to you (its actually an NDS project).
<br/>
<br/>
But what I want to do is to have a clock with (don't know the word in english), you know the things that shows what time it is.
<br/>
And it works quite good, but in the center it jumps around a bit, can it be because of the actual picture, cause I can't find put how the code could be more accurate.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#79718 - Cearn - Sat Apr 15, 2006 4:54 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ProblemBaby wrote:</b></span></td> </tr> <tr> <td class="quote">I tried those things, it didn't help. I can't upload it, cause my friends server is down, so I've nowhere to upload it. I can send it to you (its actually an NDS project).</td> </tr></table><span class="postbody">
<br/>
Feel free to send it, but it'd have to be able to run on one of the DS emulators as I don't have the right hardware.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#79735 - wintermute - Sat Apr 15, 2006 5:45 pm</h4>
    <div class="postbody"><span class="postbody">Funnily enough a watch demo has been added to the libnds example code recently. It can be found in RealTimeClock/Watch in the latest tarball.
<br/>
<br/>
<a href="http://www.devkitpro.org/?action=fullnews&amp;id=103" target="_blank">http://www.devkitpro.org/?action=fullnews&amp;id=103</a><br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#79737 - ProblemBaby - Sat Apr 15, 2006 6:08 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cearn wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Feel free to send it, but it'd have to be able to run on one of the DS emulators as I don't have the right hardware.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Ive sent it to your mail. Hope you see something missing!
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Funnily enough a watch demo has been added to the libnds example code recently. It can be found in RealTimeClock/Watch in the latest tarball.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I checked it out, but it used the 3d hardware=/</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#79766 - Cearn - Sat Apr 15, 2006 10:04 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ProblemBaby wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cearn wrote:</b></span></td> </tr> <tr> <td class="quote">Feel free to send it, but it'd have to be able to run on one of the DS emulators as I don't have the right hardware.
<br/>
</td> </tr></table><span class="postbody">
<br/>
I've sent it to your mail. Hope you see something missing!</span></td> </tr></table><span class="postbody">
<br/>
Got it and ran it. Don't think you're going to like the answer though.
<br/>
<br/>
The code is fine, the wobble you're seeing is innate to the way sprites are rotated, and there's little you can do about that. As you know, the way affine sprites are rendered is by scanning the 'on-screen space' of the sprite line by line, and using the affine matrix as increments to find the actual color from the object 'texture' that should be used at a given screenpoint. The truncating of coordinates that goes with this means that sometimes it will skip or double a (source)pixel, so you can always expect an inaccuracy of about a pixel. If your sprite is small enough, this makes a big difference.
<br/>
A secondary point is that for sprites, the scanning process starts at the centre of the sprite, always (what you're doing now is placing the sprite in such a way that it <span style="font-style: italic">looks</span> like it's rotating around another point. It doesn't). This will cause uneven conversions away from the center and make circles not so round if they're not directly at the center of the sprite, as you can see. It also makes it impossible to exactly align two affine sprites, as can be seen <a class="postlink" href="http://user.chem.tue.nl/jakvijn/files/affcombo.zip" target="_blank">in this demo</a>.
<br/>
<br/>
You can improve things a little bit by properly rounding your positions by adding o.5 (one half; 256/2=128) before rightshifting, just like you would for floats. This won't make the wobble disappear, but it might make the average position a little better. Another trick you might try is just placing a non-rotated sprite in front of the pivot point, as that's where the onversion errors are most noticeable. But you can never get rid of it completely, though.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#79791 - ProblemBaby - Sun Apr 16, 2006 12:30 am</h4>
    <div class="postbody"><span class="postbody">Thanks for the answer!
<br/>
Yeah I couldn't see anything wrong so I wasn't that suprised. But One interesting thing you said inspired me to a new approach that in fact gaved me really good results... I changed the sprite size to 32x64 and rotated it around its own center.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#114650 - Ant6n - Tue Jan 09, 2007 7:48 pm</h4>
    <div class="postbody"><span class="postbody">sorry for reviving old thread, but i was thinking that it might be possible to get subpixel accuracy on sprites if one changes the sprite attributes during hblank. has anybody ever tried that?</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
