<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>multiple source file, linking err (GCC) - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > multiple source file, linking err (GCC)</h2>
<div id="posts">
<div class="post">
    <h4>#74619 - aik6980 - Mon Mar 06, 2006 1:08 pm</h4>
    <div class="postbody"><span class="postbody">Here is my problem, I want to separate the src file for functions, and they are linking to the same header that contained some global variable.
<br/>
<br/>
here is my error message;
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
mygba.o(.data+0x0): multiple definition of `OAM'
<br/>
main.o(.data+0x0): first defined here
<br/>
mygba.o(.data+0x4): multiple definition of `OBJPalMem'
<br/>
main.o(.data+0x4): first defined here
<br/>
mygba.o(.data+0x8): multiple definition of `FrontBuffer'
<br/>
main.o(.data+0x8): first defined here
<br/>
mygba.o(.data+0xc): multiple definition of `OAMData'
<br/>
main.o(.data+0xc): first defined here
<br/>
mygba.o(.data+0x10): multiple definition of `sprites'
<br/>
main.o(.data+0x10): first defined here
<br/>
collect2: ld returned 1 exit status
<br/>
make: *** [main.elf] Error 1
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
and here is my header code
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#ifndef MYGBA_H
<br/>
#define MYGBA_H
<br/>
<br/>
//include file
<br/>
<br/>
...
<br/>
//***TYPE_COMMON***
<br/>
...
<br/>
//***GLOBAL***
<br/>
extern u16* OAM =      (u16*)0x7000000;
<br/>
extern u16* OBJPalMem =   (u16*)0x5000200;
<br/>
extern u16* FrontBuffer =    (u16*)0x6000000;
<br/>
extern u16* OAMData =      (u16*)0x6010000;
<br/>
//create array of sprites
<br/>
extern OAMEntry sprites[128]={0};
<br/>
<br/>
..
<br/>
#ifndef MYGBA_C
<br/>
<br/>
//***FUNCTION***
<br/>
//function to copy our Sprite --&gt; OAMMemory
<br/>
void CopyOAM(void);
<br/>
//Set sprites off screen
<br/>
void InitSprites(void);
<br/>
//Update during VBlank
<br/>
void WaitForVSync(){
<br/>
   while(REG_VCOUNT != 160);
<br/>
}
<br/>
#endif
<br/>
#endif
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
my functions, struct and #define work, but not for the global var
<br/>
anyidea??
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define MYGBA_C
<br/>
//include
<br/>
#include "mygba.h"
<br/>
<br/>
//function
<br/>
//function to copy our Sprite --&gt; OAMMemory
<br/>
void CopyOAM(void){
<br/>
   u16 loop=0;
<br/>
   u16* temp=(u16*)sprites; //point to sprites
<br/>
   for(loop=0;loop&lt;128*4;loop++)
<br/>
      OAM[loop] = temp[loop];   //need to use temp, because we want to pack each 
<br/>
   //data to 16 bits first before write down to OAMMemory
<br/>
}
<br/>
//Set sprites off screen
<br/>
void InitSprites(){
<br/>
   u16 loop=0;
<br/>
   for(loop=0;loop&lt;128;loop++){
<br/>
      sprites[loop].attribute[0]=SCRWIDTH; //y &gt;159
<br/>
      sprites[loop].attribute[1]=SCRHEIGHT; //x &gt;239
<br/>
   }
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
please help
<br/>
<br/>
thank a lot</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#74622 - gauauu - Mon Mar 06, 2006 2:10 pm</h4>
    <div class="postbody"><span class="postbody">Don't assign the value to the global variables in the .h file.  Move the assignment to one of the .c files.  
<br/>
<br/>
like:
<br/>
<br/>
header:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
extern u16* OAM ; 
<br/>
extern u16* OBJPalMem; 
<br/>
extern u16* FrontBuffer; 
<br/>
extern u16* OAMData; 
<br/>
//create array of sprites 
<br/>
extern OAMEntry sprites[];
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
and in ONE of the source files:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
//***GLOBAL*** 
<br/>
u16* OAM =      (u16*)0x7000000; 
<br/>
u16* OBJPalMem =   (u16*)0x5000200; 
<br/>
u16* FrontBuffer =    (u16*)0x6000000; 
<br/>
u16* OAMData =      (u16*)0x6010000; 
<br/>
//create array of sprites 
<br/>
OAMEntry sprites[128]={0};
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#74631 - aik6980 - Mon Mar 06, 2006 5:21 pm</h4>
    <div class="postbody"><span class="postbody">I try that also. However, do you have another way?
<br/>
<br/>
my Global variables are used in both of them. If they define in any src file, the rest cannot compile.
<br/>
<br/>
:&lt;</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#74633 - poslundc - Mon Mar 06, 2006 5:54 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>aik6980 wrote:</b></span></td> </tr> <tr> <td class="quote">I try that also. However, do you have another way?
<br/>
<br/>
my Global variables are used in both of them. If they define in any src file, the rest cannot compile.</td> </tr></table><span class="postbody">
<br/>
<br/>
Do it the way gauauu showed you.
<br/>
<br/>
Header file contains "extern" declarations. Then #include the header file in any .c file that needs to access the global variables.
<br/>
<br/>
Then define the actual instance of each global variable in one .c file, and one .c file only.
<br/>
<br/>
This is how global variables work. You declare a single instance of them, and then use "extern" to tell the compiler that it exists in some other .c module, and to let the linker sort it out.
<br/>
<br/>
If you don't use the "extern" keyword, the compiler generates an instance in every .c module, and when it comes time to link you get the multiple instance error you've been having.
<br/>
<br/>
If you don't put a single instance into one of your .c files, the code will compile using the "extern" keyword but when it comes time to link, the linker won't be able to find any modules that contain the actual instance.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#74643 - aik6980 - Mon Mar 06, 2006 7:00 pm</h4>
    <div class="postbody"><span class="postbody">sorry gauauu, i miss reading the extern declaration.
<br/>
<br/>
and it work now. 
<br/>
<br/>
thank you you guys very much
<br/>
<br/>
:)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
