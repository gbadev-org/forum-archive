<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Great debugging tip - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > Great debugging tip</h2>
<div id="posts">
<div class="post">
    <h4>#24947 - Gene Ostrowski - Fri Aug 13, 2004 8:03 pm</h4>
    <div class="postbody"><span class="postbody">Not sure where to post this, but I stumbled across something that some of you may not yet know, and it was very helpful.
<br/>
<br/>
I had something happening in my program where it appeared to be locking up, and I could not track down the code where it was occurring.
<br/>
<br/>
Sometimes stepping through the GDB debugger is a slow and painful process, but I figured out a fast way to find out where it was hanging:
<br/>
<br/>
By using VBA in conjunction with the memory map, I was able to determine the exact routine that was causing the problem almost instantly.
<br/>
<br/>
VBA comes with a built-in disassembler that can be accessed through the Tools --&gt; Disassemble menu.  Load up your ROM and open up the Disassemble window while the game is running.  Click on the "Automatic Update" box and you'll see your code executing.  More importantly, it will show you the <span style="font-style: italic">address </span>that is currently executing (the left-most column on the screen).
<br/>
<br/>
You can then use NM to map out your symbols for you, so you can determine the routine that's associated within that address space.  From the command-line, do something like:
<br/>
<br/>
nm -n MyGame.elf &gt; MyGame.txt
<br/>
<br/>
to dump the memory map to a file (MyGame.txt) then open it up in a text editor.  Scroll down for the routine that includes the address in question, and you can pinpoint the location of the problem.  At least you'll know which routine it is.
<br/>
<br/>
Similarly, you can use the Tools -&gt; Memory Viewer menu option to display a memory map.  If you are needing to watch a variable because you think it contains an incorrect value, you can scan for the name in the text file, get its address, and use the memory viewer to watch the variable in real-time.
<br/>
<br/>
I used this method to find the routine that was hanging, and the variable that was being overwriten to a bad value.
<br/>
<br/>
Hope this helps someone!<br/>_________________<br/>------------------
<br/>
Gene Ostrowski</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#24950 - poslundc - Fri Aug 13, 2004 8:24 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Gene Ostrowski wrote:</b></span></td> </tr> <tr> <td class="quote">Similarly, you can use the Tools -&gt; Memory Viewer menu option to display a memory map.  If you are needing to watch a variable because you think it contains an incorrect value, you can scan for the name in the text file, get its address, and use the memory viewer to watch the variable in real-time.</td> </tr></table><span class="postbody">
<br/>
<br/>
I generally use EWRAM for this purpose rather than bothering with the memory map. I just copy the variable I'm interested in to 0x02000000. Real easy to find that way.
<br/>
<br/>
This only works, of course, if you aren't using EWRAM for anything else (ie. your game isn't multiboot and you aren't using malloc/new).
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#24958 - expos1994 - Fri Aug 13, 2004 9:22 pm</h4>
    <div class="postbody"><span class="postbody">Gene, thanks for the tip.  I wasn't aware of the NM command to generate a map. 
<br/>
I was previously tracking my variables using Dan's method/VBA's memory viewer, and that made it hard, because usually the value I was tracking led me to be curious about another value whose address I didn't know.  Then I'd have to change the code to put the address in EWRAM and start over, so this should help.
<br/>
<br/>
When I first started GBA programming, I couldn't find a suitable debugger, so I figured developing anything would be a major pain.  After awhile I discovered that for my purposes, VBA provides all the debugging I need.  Looking at the layout of VRAM, OAM attributes, the background layouts, and the memory viewer has answered most of my questions and helped me solve all of my problems.
<br/>
<br/>
With your tip I can actually start putting the disassembler to use.   This should be a big help.  
<br/>
<br/>
I do have one question though: Does anyone know where the function variables are stored? The variables whose scope is only local to the function.  I would guess they are in IWRAM somewhere, but I don't see any mention of them in the map I generated with NM.    
<br/>
<br/>
btw, what does NM stand for? 
<br/>
<br/>
Thanks,
<br/>
<br/>
Chris</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#24962 - torne - Fri Aug 13, 2004 10:06 pm</h4>
    <div class="postbody"><span class="postbody">nm is 'names'. Local variables are stored on the stack.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
