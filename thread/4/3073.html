<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Help me, please, I beg you - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Coding > Help me, please, I beg you</h2>
<div id="posts">
<div class="post">
    <h4>#17953 - Darmstadium - Wed Mar 17, 2004 10:46 pm</h4>
    <div class="postbody"><span class="postbody">I can not figure out what the heck is wrong with this code to display a sprite:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include "gba.h"
<br/>
#include "dispcnt.h"
<br/>
#include "keypad.h"
<br/>
#include "sprite.h"
<br/>
//#include "bg.h"
<br/>
#include "dma.h"
<br/>
<br/>
#include "box.pal.c"
<br/>
#include "box.raw.c"
<br/>
<br/>
void CopyOAM()
<br/>
{
<br/>
   /*REG_DM3SAD = (u32)sprites;
<br/>
   REG_DM3DAD = (u32)OAM;
<br/>
   REG_DM3CNT = 256 | DMA_ENABLE | DMA_TIMEING_IMMEDIATE | DMA_32;*/
<br/>
   
<br/>
   u16 loop;
<br/>
   u16 * temp = (u16*)sprites;
<br/>
   for(loop = 0; loop &lt; 512; loop++)
<br/>
      OAM[loop] = temp[loop];
<br/>
}
<br/>
<br/>
void WaitForVsync()
<br/>
{
<br/>
   while((volatile u16)REG_VCOUNT != 160){}
<br/>
}
<br/>
<br/>
void InitializeSprites()
<br/>
{
<br/>
   u16 loop;
<br/>
   for(loop = 0; loop &lt; 128; loop++)
<br/>
   {
<br/>
      sprites[loop].attribute0 = 160;
<br/>
      sprites[loop].attribute1 = 240;
<br/>
   }
<br/>
}
<br/>
<br/>
int main()
<br/>
{
<br/>
   u16 loop;
<br/>
   
<br/>
   SetMode(MODE_1 | OBJ_MAP_1D | OBJ_ENABLE);
<br/>
   
<br/>
   for(loop = 0; loop &lt; 256; loop++)
<br/>
      OBJPaletteMem[loop] = box_Palette[loop];
<br/>
   
<br/>
   for(loop = 0; loop &lt; 128; loop++)
<br/>
      OAMData[loop] = box_Bitmap[loop];
<br/>
   
<br/>
   InitializeSprites();
<br/>
   
<br/>
   sprites[0].attribute0 = COLOR_256 | SQUARE | 50;
<br/>
   sprites[0].attribute1 = SIZE_32 | 100;
<br/>
   sprites[0].attribute2 = 0;
<br/>
   
<br/>
   while(1)
<br/>
   {
<br/>
      WaitForVsync();
<br/>
      CopyOAM();
<br/>
   }
<br/>
   return 0;
<br/>
}
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
If you could tell me what is wrong with this code, I will worship you.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17954 - sajiimori - Wed Mar 17, 2004 10:56 pm</h4>
    <div class="postbody"><span class="postbody">I don't see anything wrong with your code.  Use VBA's tools to check if your palette and graphics are being loaded correctly.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17955 - poslundc - Wed Mar 17, 2004 10:57 pm</h4>
    <div class="postbody"><span class="postbody">Well, for one, you're #including C files. You should only ever #include header files (.h), and those files should never contain any variable definitions (unless they are extern variable references) or executable code (unless they are in #define macros or static inline functions).
<br/>
<br/>
Data should be put into C files (or other types of files appropriate for data; not .h!) and then compiled and linked to the rest of your project using gcc.
<br/>
<br/>
Oh, and I'm not looking for worship, but if you're looking for help debugging your program it's a good idea to post what happens when you try to compile or run it.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17992 - Lupin - Thu Mar 18, 2004 4:07 am</h4>
    <div class="postbody"><span class="postbody">i think he just used the file names that his converter gave him, some gfx converters compile images to .c file and not to .h file, i don't think that really matters... I also can't see anything wrong, i am just wondering why you want to display a sprite that's consuming all your OAM entries.<br/>_________________<br/><a class="postlink" href="http://pokeme.shizzle.it/" target="_blank">Team Pokeme</a>
<br/>
<a class="postlink" href="http://lupin.shizzle.it/" target="_blank">My blog and PM ASM tutorials</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17996 - sajiimori - Thu Mar 18, 2004 4:58 am</h4>
    <div class="postbody"><span class="postbody">I don't see anything that suggests that the sprite consumes more than 1 OAM entry.  In fact, that might not be a meaningful statement, since each OAM entry represents exactly 1 sprite (though a conceptual game-object might be represented by multiple sprites).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18000 - yaustar - Thu Mar 18, 2004 6:30 am</h4>
    <div class="postbody"><span class="postbody">doesn't OAM and sprites need to be defined?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">u16* OAM = (u16*)0x7000000;
<br/>
OAMEntry sprites[128];</td> </tr></table><span class="postbody">
<br/>
<br/>
and I think a 32x32x256 sprite is a 512 array<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18012 - XeroxBoy - Thu Mar 18, 2004 5:54 pm</h4>
    <div class="postbody"><span class="postbody">The fact that he never loads his sprite graphics might be the problem.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18015 - sajiimori - Thu Mar 18, 2004 6:27 pm</h4>
    <div class="postbody"><span class="postbody">yaustar, if those things weren't defined, it wouldn't even compile.  Those definitions could be in any one of the included files (though sprites[] shouldn't be in a header, but whatever).
<br/>
<br/>
XeroxBoy, I don't know how you came to your conclusion.  You might avoid throwing around words like "fact".</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18018 - yaustar - Thu Mar 18, 2004 6:53 pm</h4>
    <div class="postbody"><span class="postbody">The guy didn't mention that it compiled...just it didn't work :p
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">for(loop = 0; loop &lt; 128; loop++) 
<br/>
      OAMData[loop] = box_Bitmap[loop]; 
<br/>
    
<br/>
   InitializeSprites(); 
<br/>
    
<br/>
   sprites[0].attribute0 = COLOR_256 | SQUARE | 50; 
<br/>
   sprites[0].attribute1 = SIZE_32 | 100; 
<br/>
   sprites[0].attribute2 = 0; 
<br/>
</td> </tr></table><span class="postbody">
<br/>
If I am assuming that it does compile and the sprite is not displayed properly, then I put it down that only a quarter of the actual tile data is transfered to OAM.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">for(loop = 0; loop &lt; 512; loop++) 
<br/>
      OAMData[loop] = box_Bitmap[loop]; </td> </tr></table><span class="postbody">
<br/>
Until the guy replies again we really cannot do much by assumptions alone ;)<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18020 - XeroxBoy - Thu Mar 18, 2004 7:19 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">XeroxBoy, I don't know how you came to your conclusion.  You might avoid throwing around words like "fact".</td> </tr></table><span class="postbody">
<br/>
<br/>
Sorry if I sounded a bit stuck-up. Yaustar's probably right - when I saw OAMData and 128, my brain automatically assumed that he was copying his OAM data and not the actual tile data.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18022 - sajiimori - Thu Mar 18, 2004 8:50 pm</h4>
    <div class="postbody"><span class="postbody">yaustar, there's still no way to know how much tile data is actually being transferred.  A 32x32 8-bit image is not a specific number of "elements" -- you can divide it into 1024 bytes, 512 shorts, 256 longs, 128 long-longs, or even 4 structs that are 256 bytes each.
<br/>
<br/>
So while it's unlikely that OAMData and box_Bitmap are both of type <span style="font-weight: bold">long long*</span>, it's <span style="font-style: italic">possible</span> to copy a 32x32 8-bit image with a for-loop that does 128 iterations.  ;-)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18024 - yaustar - Thu Mar 18, 2004 9:01 pm</h4>
    <div class="postbody"><span class="postbody">So true.. :)<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
