<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Compiling GBA apps under Linux (knoppix) - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Coding > Compiling GBA apps under Linux (knoppix)</h2>
<div id="posts">
<div class="post">
    <h4>#55367 - enliteneer - Wed Sep 28, 2005 1:58 am</h4>
    <div class="postbody"><span class="postbody">Ive normally used Cygwin to compile under windows, and havent had any problems, but recently, I tried compiling the gba port of Contik (a tiny os and web browser designed for tiny microcontrollers)i:
<br/>
<br/>
<a href="http://www.sics.se/~adam/contiki/ports/index.html" target="_blank">http://www.sics.se/~adam/contiki/ports/index.html</a>
<br/>
<br/>
and while it 'makes' without any errors, no output file is generated.  I figured I should try under a real linux environment, but I rather not do an install at the moment.  Has anyone ever got a working GBA developing environment under the linux live cd knoppix? What do I have to add/modify to the iso to support the devkitarm compiler?
<br/>
<br/>
BTW, this is the GBA makefile:
<br/>
# portlib gba makefile
<br/>
<br/>
include ./../../makefile.config
<br/>
<br/>
all: gba
<br/>
<br/>
ascchar.o: ascchar.raw
<br/>
			bin2o .rodata ascchar.raw ascchar.o
<br/>
<br/>
gba: ascchar.o
<br/>
		# -W -Wall
<br/>
		@$(ARMAS) -I./../ -I. -o crt0.o crt0.s
<br/>
		@$(ARMCC) -W -Wall -O6 -c -I./../ -I. -D__GBA__ \
<br/>
			conio.c \
<br/>
			joystick.c \
<br/>
			./../none/joytokbd.c \
<br/>
			vsprintf.c \
<br/>
			ltostr.c \
<br/>
			_sbrk.c \
<br/>
			_oserror.c \
<br/>
			_exit.c \
<br/>
			_kill.c \
<br/>
			_getpid.c \
<br/>
			clock.c \
<br/>
			waitvblank.c \
<br/>
			gettv.c \
<br/>
			gba.c
<br/>
<br/>
		@$(CP) crt0.o ./../../lib/gbastart.o
<br/>
		@$(ARMAR) -r ./../../lib/gbaport.a \
<br/>
			crt0.o \
<br/>
			gba.o \
<br/>
			conio.o \
<br/>
			joystick.o \
<br/>
			joytokbd.o \
<br/>
			ascchar.o \
<br/>
			vsprintf.o \
<br/>
			ltostr.o \
<br/>
			_sbrk.o \
<br/>
			_oserror.o \
<br/>
			_exit.o \
<br/>
			_kill.o \
<br/>
			clock.o \
<br/>
			waitvblank.o \
<br/>
			gettv.o \
<br/>
			_getpid.o
<br/>
<br/>
clean:
<br/>
	@$(RM) *.o
<br/>
	@$(RM) *.joy
<br/>
	@$(RM) *.lst
<br/>
<br/>
<br/>
---------------------------------------------------------------------------
<br/>
<br/>
makefile.config:
<br/>
<br/>
<br/>
#RM=/usr/bin/rm -f
<br/>
RM=rm -f
<br/>
CP=cp
<br/>
NULL=/dev/null
<br/>
FIND=/usr/bin/find
<br/>
#XARGS=/usr/bin/xargs
<br/>
<br/>
#########################################################################################
<br/>
# 6502/cc65 options
<br/>
##########################################################################################
<br/>
<br/>
PUCRUNCH=pucrunch -fshort
<br/>
EXOMIZER=exomizer
<br/>
<br/>
CC65_ASMINC=/ecos-c/xport/projects/contiki/arch/vic20/c65/asminc
<br/>
export CC65_ASMINC
<br/>
CC65_INCLUDE=/ecos-c/xport/projects/contiki/arch/vic20/c65/include
<br/>
export CC65_INC
<br/>
<br/>
# location of the joystick drivers
<br/>
JOYDRV=/usr/lib/cc65/joy
<br/>
<br/>
CCFLAGS=--asm-include-dir $(CC65_ASMINC)
<br/>
OPTFLAGS=-Osir
<br/>
CCFLAGS+=$(OPTFLAGS)
<br/>
#CCFLAGS=-g --mapfile main.map
<br/>
<br/>
#########################################################################################
<br/>
# Z80 Options
<br/>
##########################################################################################
<br/>
<br/>
export PATH+=:/usr/local/bin
<br/>
<br/>
Z80CC=/usr/local/bin/sdcc
<br/>
Z80AS=/usr/local/bin/as-z80
<br/>
Z80LD=/usr/local/bin/link-z80
<br/>
<br/>
Z80ASFLAGS=-g
<br/>
Z80CFLAGS=-Wall -lang-c++ -DSDCC=1 -DSDCC_PORT=z80 \
<br/>
	-DSDCC_PLAT=z80 -DSDCC_MODEL_SMALL -DINT_16_BITS \
<br/>
	-D__SDCC__ -I./ -I /usr/local/share/sdcc/include -D__SPECTRUM__ \
<br/>
	-mz80 --nostdinc --nostdlib --model-small \
<br/>
	\
<br/>
	-A -A --noinvariant --noinduction --callee-saves --callee-saves-bc \
<br/>
	--nojtbound --noloopreverse --int-long-reent --float-reent --no-peep \
<br/>
	--xram-movc
<br/>
<br/>
Z88DKCC=/usr/local/bin/zcc
<br/>
Z88DKAS=/usr/local/bin/z80asm
<br/>
Z88DKCFLAGS=+zx -vn -Wall -O0 -no-smartpf -D__Z88DK__ -D__SPECTRUM__
<br/>
Z88DKCLIBS=-lmalloc -lndos
<br/>
<br/>
export Z80_OZFILES=/home/groepaz/devarchive/z80/z88dk/cvs/z88dk/lib/
<br/>
export      ZCCCFG=/home/groepaz/devarchive/z80/z88dk/cvs/z88dk/lib/config/
<br/>
export  Z80_STDLIB=/home/groepaz/devarchive/z80/z88dk/cvs/z88dk/lib/clibs/s.lib
<br/>
<br/>
<br/>
GBCC=/usr/local/bin/sdcc
<br/>
GBAS=/usr/local/bin/as-gbz80
<br/>
GBASFLAGS=-g
<br/>
GBCCFLAGS=-Wall -lang-c++ -DSDCC=1 -DSDCC_PORT=gbz80 \
<br/>
	-DSDCC_PLAT=gb -DSDCC_MODEL_SMALL -DGB=1 -DGAMEBOY=1 -DINT_16_BITS \
<br/>
	-D__SDCC__ -I./gb -I./ -I /usr/local/share/sdcc/include -D__GAMEBOY__ \
<br/>
	-mgbz80 --nostdinc --nostdlib --model-small \
<br/>
	\
<br/>
	-A -A --noinvariant --noinduction --callee-saves --callee-saves-bc \
<br/>
	--nojtbound --noloopreverse --int-long-reent --float-reent --no-peep \
<br/>
	--xram-movc
<br/>
<br/>
# --fommit-frame-pointer
<br/>
# -lang-c++ -lang-c
<br/>
# --noinvariant --noinduction
<br/>
# --callee-saves --callee-saves-bc
<br/>
<br/>
GBLD=/usr/local/bin/link-gbz80
<br/>
<br/>
#########################################################################################
<br/>
# Arm/GCC options
<br/>
##########################################################################################
<br/>
<br/>
#	ARMCC=/opt/ham/gcc-arm/bin/arm-elf-gcc
<br/>
#	ARMLD=/opt/ham/gcc-arm/bin/arm-elf-ld
<br/>
#	ARMOBJCOPY=/opt/ham/gcc-arm/bin/arm-elf-objcopy
<br/>
<br/>
ARMAS=/devkitadv/bin/arm-agb-elf-as
<br/>
ARMCC=/devkitadv/bin/arm-agb-elf-gcc
<br/>
ARMLD=/devkitadv/bin/arm-agb-elf-ld
<br/>
ARMAR=/devkitadv/bin/arm-agb-elf-ar
<br/>
ARMOBJCOPY=/devkitadv/bin/arm-agb-elf-objcopy</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#55468 - Quirky - Wed Sep 28, 2005 7:44 pm</h4>
    <div class="postbody"><span class="postbody">I'd change DevkitAdv for DevkitARM. Add the -specs=gba.specs link flag. Don't link with a "project specific" crt0 (unless it is really specific and has extra changes) and it may work. Having hard coded paths to the binary tools is a bit hacky. mv cp rm and friends should be in the PATH already. DevkitArm sticks to the standard naming convention and has arm-elf-gcc, etc instead of arm-elf-agb-gcc. You could add devkitArm/bin to the PATH too. crt0.o will have some kind of interrupt code that you may need to work around (singe_int.s in libgba is usually a direct replacement).
<br/>
<br/>
Failing that, download the Linux devkitAdv build and see if it works. Also, keep in mind that Knoppix is fairly memory intensive, so make sure you've got enough ram to play around with it.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
