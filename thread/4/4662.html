<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>LPT Port programming help needed - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Coding > LPT Port programming help needed</h2>
<div id="posts">
<div class="post">
    <h4>#32243 - ghostils - Mon Dec 20, 2004 12:35 am</h4>
    <div class="postbody"><span class="postbody">I figure most of you folks out there are probably familiar with the Xboo program and xcomms.  I'm using my GBA for a remote control (Well thats the idea if I can get some communication working with it and my pc) 
<br/>
<br/>
What I want to do is control the gba via the xboo cable after my software is loaded either from rom or multi-boot does really matter. I've written a simple test program on the gba to repeatedly send 1 byte of data over the port in polling mode. 
<br/>
<br/>
I wrote another simple program in C to read the LPT1 port. On the data register 0x378+0 I don't get data, which isn't strange after reading the xboo documentation text file showing what pins are used.  (mosly control register pins 0x378 + 2)
<br/>
<br/>
I read the status register 0x378+1 and I show that the gba is sending data because when I unplug it the byte value changes.
<br/>
<br/>
Now here is where I need the help. 
<br/>
<br/>
When I try and do any operation on the Control register read/write whatever my code either throws an exception or something else causes it to crash.  I'm compiling it in Visual C++ 6.0. 
<br/>
<br/>
Both data and status register operations work fine, control register access crashes it..
<br/>
<br/>
I'll post my code below for the windows app. 
<br/>
(OS Specs: Windows XP SP2)
<br/>
(Programming IDE MSVC 6.0) compiled as a win32 console app. (which is probably part of the problem) 
<br/>
<br/>
I may try and work it out in some 16bit asm but that's really rusty hehe.
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
#include &lt;stdio.h&gt;
<br/>
<br/>
<br/>
<br/>
<br/>
//-old dos.h causes compile errors:
<br/>
//-ASM routines:
<br/>
//-Taken from Userport example file for test purposes:
<br/>
void outportb(unsigned int portid, unsigned char value)
<br/>
{
<br/>
  __asm mov edx,portid
<br/>
  __asm mov al,value
<br/>
  __asm out dx,al
<br/>
}
<br/>
<br/>
<br/>
unsigned char inportb(unsigned int portid)
<br/>
{
<br/>
  unsigned char value;
<br/>
  
<br/>
  __asm mov edx,portid
<br/>
  __asm in al,dx
<br/>
  __asm mov value,al
<br/>
  return value;
<br/>
}
<br/>
<br/>
<br/>
//-LPT registers for SPP mode:
<br/>
#define PORTADDR 0x378
<br/>
#define DATA PORTADDR + 0
<br/>
#define STATUS PORTADDR + 1
<br/>
#define CONTROL PORTADDR + 2
<br/>
<br/>
<br/>
<br/>
void main(void)
<br/>
{
<br/>
   unsigned char c = 0x00;               
<br/>
   while(1)
<br/>
   {
<br/>
      inportb(DATA);
<br/>
      printf("DATA = %c\r\n", c);
<br/>
<br/>
      inportb(STATUS);
<br/>
      printf("STATUS = %c\r\n", c);
<br/>
<br/>
<br/>
      //-FIXME: Crashes program!
<br/>
      inportb(CONTROL);
<br/>
      printf("CONTROL = %c\r\n", c);
<br/>
   }
<br/>
<br/>
}
<br/>
<br/>
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
<br/>
What do you all think?
<br/>
<br/>
Thanks, 
<br/>
-ghost[iLs]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#32390 - pan69 - Wed Dec 22, 2004 8:07 am</h4>
    <div class="postbody"><span class="postbody">You can't do this kind of stuff on Windows 'cause Windows runs in protected mode. You should compile your program for DOS where this kind of behaviour is perfectly exceptable. If you still want to read/write IO ports under Windows you will have write a device driver.
<br/>
<br/>
You can get a good, the best actually, DOS compiler overhere: <a href="http://www.openwatcom.org" target="_blank">www.openwatcom.org</a>
<br/>
<br/>
- Pan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#32412 - Lord Graga - Wed Dec 22, 2004 1:44 pm</h4>
    <div class="postbody"><span class="postbody">Or, you could get a program to "open" the ports. By this, I mean programs like <a class="postlink" href="http://www.bottledlight.com/tools/giveio.zip" target="_blank">GiveIO</a>, <a class="postlink" href="http://www.embeddedtronics.com/public/Electronics/minidaq/userport/UserPort.zip" target="_blank">UserPort</a>, and some other ones which ain't quite as popular.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#32426 - ghostils - Wed Dec 22, 2004 7:44 pm</h4>
    <div class="postbody"><span class="postbody">I know these are needed in Windows XP, I have Userport running.  Its something about how windows works with 16bit code. I can write the same software under linux using ioperm() and its works fine.  So I just decided to do that.
<br/>
<br/>
-ghost[iLs]</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
