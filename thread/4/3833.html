<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Interrupts?! - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Coding > Interrupts?!</h2>
<div id="posts">
<div class="post">
    <h4>#24525 - ProblemBaby - Thu Aug 05, 2004 3:03 am</h4>
    <div class="postbody"><span class="postbody">My program runs fine in both VBA and No$GBA
<br/>
and at Hardware if I flash it to my flashcard.
<br/>
But since my program still is small and I need to check a lot of stuff at hardware I want to run it as Multiboot!
<br/>
But It wont work. the Interrupts doesnt work.
<br/>
Ive tried both Jeff Frohweins Interrupt Handler
<br/>
and to write my own in pure ASM (with ARM instructions of course) that just handles the Interrupt iam interested in (for now). Ive no idea of why it is like this.
<br/>
Plz Help
<br/>
<br/>
I am using Flash2Advance and junk on the screen is left from the loader I dont know if this has something to do with my problem.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#24530 - tepples - Thu Aug 05, 2004 6:03 am</h4>
    <div class="postbody"><span class="postbody">Could you post the minimal source code that exhibits the misbehavior (main.c and isr.c)?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#24536 - ProblemBaby - Thu Aug 05, 2004 11:34 am</h4>
    <div class="postbody"><span class="postbody">Yes:
<br/>
<br/>
Main.c:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
int __gba_multiboot;
<br/>
<br/>
// Funktioner
<br/>
void AgbMain()
<br/>
{
<br/>
   REG_INTERRUPT = (u32)&amp;InterruptProcess;
<br/>
   REG_DISPSTAT |= 0x8;
<br/>
   REG_IE = 0x1;
<br/>
   REG_IME = 1;
<br/>
<br/>
<br/>
   while (1)
<br/>
   {
<br/>
      // game stuff
<br/>
      BIOS_VBlankIntrWait();
<br/>
      CopyOAM();
<br/>
   }
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
(InterruptSupport is commented in crt0.s)
<br/>
here is my InterruptProcess:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
.thumb
<br/>
.align 1
<br/>
.text
<br/>
<br/>
some functions in thumb...
<br/>
<br/>
.arm
<br/>
.align 2
<br/>
.section .iwram, "ax", %progbits
<br/>
<br/>
.global InterruptProcess
<br/>
InterruptProcess:
<br/>
   LDR r0, =REG_IME
<br/>
   LDR r1, =0x0
<br/>
   STRH r1, [r0]
<br/>
<br/>
   LDR r0, =REG_IF
<br/>
   LDR r1, =0x1
<br/>
   STRH r1, [r0]
<br/>
<br/>
   LDR r0, =0x3FFFFF8
<br/>
   LDR r1, [r0]
<br/>
   ORR r1, r1, #0x1
<br/>
   STR r1, [r0]
<br/>
<br/>
   LDR r0, =REG_IME
<br/>
   LDR r1, =0x1
<br/>
   STRH r1, [r0]
<br/>
   
<br/>
   BX lr
<br/>
<br/>
.pool
<br/>
.end
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I tried some before with a hblank interrupt to not look up the system as this does if it doesnt work but the multiboot version (on hardware) simply ignored the interrupt.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#24546 - wintermute - Thu Aug 05, 2004 3:52 pm</h4>
    <div class="postbody"><span class="postbody">There is no support for the bios IntrWait functions in the majority of publically available interrupt handler code.
<br/>
<br/>
Have a look at libgba on <a href="http://www.devkit.tk" target="_blank">http://www.devkit.tk</a>
<br/>
<br/>
single_ints.s &amp; interrupt.c are the files of interest</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#24549 - tepples - Thu Aug 05, 2004 3:57 pm</h4>
    <div class="postbody"><span class="postbody">Another thing popped into my head: Are you making sure to name your binary with a .mb (not .gba) suffix when running it in VBA?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#24558 - ProblemBaby - Thu Aug 05, 2004 9:54 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
There is no support for the bios IntrWait functions in the majority of publically available interrupt handler code.
<br/>
<br/>
Have a look at libgba on <a href="http://www.devkit.tk" target="_blank">http://www.devkit.tk</a>
<br/>
<br/>
single_ints.s &amp; interrupt.c are the files of interest</td> </tr></table><span class="postbody">
<br/>
<br/>
I dont understand what you mean...
<br/>
If you saw my code the interrupt handler was programmed special only for this interrupt.
<br/>
Ive tried you interrupt code and tried to run the BGScroll example both with the same results. the interrupts doesnt work if I just have a HBlank interrupt it doesnt work either. so I dont think it has something to do with the code or IntrWait.
<br/>
<br/>
Tepples:
<br/>
i tried .bin suffix I tried .mb and it works also.
<br/>
<br/>
Iam quite sure that it has something to do with Flash2Advance does it exist any freeware alternative so I can use the same cable USB-GBA?
<br/>
<br/>
[/quote]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#24562 - dagamer34 - Thu Aug 05, 2004 11:22 pm</h4>
    <div class="postbody"><span class="postbody">Your code won't work as of now. You are trying to use the BIOS Vblank interrupt without ever telling the BIOS that a VBlank has occured. You have to write to a certain bit during a Vblank to so that the bios knows a vblank has occured and your normal loop can continue execution.
<br/>
<br/>
Here's a link to what I'm talking about: <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=3791" target="_blank">http://forum.gbadev.org/viewtopic.php?t=3791</a>
<br/>
<br/>
I just made up a name for the register, it's nothing official. I think it describes it quite nicely though.<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#24565 - wintermute - Fri Aug 06, 2004 12:07 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>dagamer34 wrote:</b></span></td> </tr> <tr> <td class="quote">Your code won't work as of now. You are trying to use the BIOS Vblank interrupt without ever telling the BIOS that a VBlank has occured. You have to write to a certain bit during a Vblank to so that the bios knows a vblank has occured and your normal loop can continue execution.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Actually he is doing the needfule with the BIOS interrupt flags - I missed it when I was looking through the code too.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
