<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>coding using const structs - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Coding > coding using const structs</h2>
<div id="posts">
<div class="post">
    <h4>#36449 - gbawiz - Sun Feb 20, 2005 8:26 pm</h4>
    <div class="postbody"><span class="postbody">I am a bit stuck with the following messages:
<br/>
when attempting compilation in windows I get:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">warning C4090: 'initializing' : different 'const' qualifiers</td> </tr></table><span class="postbody">
<br/>
When in GCC compiler I get:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">warning: initialization discards qualifiers from pointer target type</td> </tr></table><span class="postbody">[/img]
<br/>
<br/>
I am actually trying to include a file which has something like the following:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">const sampletype sampleinfo[]={
<br/>
{ 5160, 0, 64, 0, 1, sample_0 },
<br/>
{ 3584, 0, 64, 0, 1, sample_1 },
<br/>
etc.................</td> </tr></table><span class="postbody">
<br/>
<br/>
where sampletype is a struct which has been previously defined
<br/>
Anyone help?
<br/>
Thanks</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#36450 - poslundc - Sun Feb 20, 2005 8:42 pm</h4>
    <div class="postbody"><span class="postbody">Odds are you are referencing const data when you refer to sample_0, sample_1, etc. but the data type within your struct is non-const.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#36451 - tepples - Sun Feb 20, 2005 9:02 pm</h4>
    <div class="postbody"><span class="postbody">Show the typedef and or struct statements that define the type <span style="font-weight: bold">sampletype</span> and we'll show you how to fix this the right way.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#36457 - gbawiz - Mon Feb 21, 2005 11:45 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Show the typedef and or struct statements that define the type <span style="font-weight: bold">sampletype</span> and we'll show you how to fix this the right way.</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">typedef struct sample_info_layout
<br/>
{
<br/>
   unsigned int length;
<br/>
   unsigned char finetune;
<br/>
   unsigned char volume;
<br/>
   unsigned int rpt_offset;
<br/>
   unsigned int rpt_length;
<br/>
   unsigned char *sample_data;
<br/>
}sampletype;</td> </tr></table><span class="postbody">
<br/>
<br/>
seems to work when I place 'const' in front of the bottom definition 'unsigned char *sample_data'
<br/>
However this is when creating an output from a mod converter file only.
<br/>
<br/>
If I try adding this when filling the struct initially with the data then there is an error.
<br/>
<br/>
I am attempting a mod file converter based on Deku's method</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#36463 - tepples - Mon Feb 21, 2005 5:29 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>gbawiz wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Show the typedef and or struct statements that define the type <span style="font-weight: bold">sampletype</span> and we'll show you how to fix this the right way.</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">typedef struct sample_info_layout
<br/>
{
<br/>
   unsigned int length;
<br/>
   unsigned char finetune;
<br/>
   unsigned char volume;
<br/>
   unsigned int rpt_offset;
<br/>
   unsigned int rpt_length;
<br/>
   unsigned char *sample_data;
<br/>
}sampletype;</td> </tr></table><span class="postbody">
<br/>
<br/>
seems to work when I place 'const' in front of the bottom definition 'unsigned char *sample_data'</span></td> </tr></table><span class="postbody">
<br/>
That's what I would have suggested.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">However this is when creating an output from a mod converter file only.
<br/>
<br/>
If I try adding this when filling the struct initially with the data then there is an error.</td> </tr></table><span class="postbody">
<br/>
Which error is this? And how have you defined sample_0 and sample_1?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#36465 - gbawiz - Mon Feb 21, 2005 8:46 pm</h4>
    <div class="postbody"><span class="postbody">I create an empty mod file struct and copy the modfile into the appropriate locations.
<br/>
<br/>
The error appears when I state that part of the struct is a const when it has not yet been defined or filled with data.
<br/>
However once I write the struct definitions to the output.h file to include in my GBA programs then thats where the const is needed. Because the data which has now been stored in the structs have all to be stored into the output.h file also (using fprintf).
<br/>
<br/>
This whole subject of saving struct data in this way is new to me and Im having a bit of trouble, im getting the following:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">modconverted.h:9083: warning: initialization makes integer from pointer without a cast</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">const modtype modtable[]= {
<br/>
<br/>
sampleinfo, 
<br/>
31, 
<br/>
127, 
<br/>
pattern_order, 
<br/>
modpatterntable 
<br/>
 };</td> </tr></table><span class="postbody">
<br/>
<br/>
they have all been defined before as:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">const unsigned char *modpatterntable[]={
<br/>
pattern_0, pattern_1, pattern_2, pattern_3, pattern_4, pattern_5, pattern_6, pattern_7, pattern_8, pattern_9, pattern_10, pattern_11, pattern_12, pattern_13, pattern_14, pattern_15, pattern_16, pattern_17, pattern_18, pattern_19, 
<br/>
};</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">const sampletype sampleinfo[]={
<br/>
{ 5160, 0, 64, 0, 1, sample_0 },
<br/>
{ 3584, 0, 64, 0, 1, sample_1 },
<br/>
etc........................
<br/>
};</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">const unsigned char sample_0[]={
<br/>
0,0,0,0,255,255,255,255,255,255,255,255,255,255,255,254,
<br/>
252,249,246,243,240,236,233,232,239,244,241,255,0,248,255,7,
<br/>
etc.............
<br/>
};</td> </tr></table><span class="postbody">
<br/>
same for each of the samples available
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">const unsigned char pattern_order[]={
<br/>
2, 0, 0, 1, 1, 3, 4, 16, 5, 6, 7, 8, 5, 6, 7, 8, 17, 18, 13, 14, 13, 14, 9, 10, 11, 12, 5, 6, 7, 8, 19, 
<br/>
};</td> </tr></table><span class="postbody">
<br/>
<br/>
Sorry for the length
<br/>
Thanks</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#36468 - sajiimori - Mon Feb 21, 2005 10:29 pm</h4>
    <div class="postbody"><span class="postbody">Which initialization is giving the error (at line 9083)?  How is modtype defined?  How are pattern_* defined?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#36470 - gbawiz - Mon Feb 21, 2005 11:28 pm</h4>
    <div class="postbody"><span class="postbody">Found problem, forgot to define types in main mod header :)
<br/>
Thanks</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
