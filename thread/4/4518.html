<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Array in EWRAM increases ROM size - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Coding > Array in EWRAM increases ROM size</h2>
<div id="posts">
<div class="post">
    <h4>#30507 - ScottLininger - Wed Dec 01, 2004 7:12 pm</h4>
    <div class="postbody"><span class="postbody">I have a large array of sprite meta data. I need to put it into EWRAM. 
<br/>
<br/>
The problem is that when I do, the size of my ROM increases (as pointed out by the FAQ, DevKitAdv pads your binary with literal zeroes.) The array is just scratch space to store my sprite attributes during mode changes and such.
<br/>
<br/>
This is the syntax I'm using to post into EWRAM (from the FAQ):
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
typeSpriteMetaData scratchSpace[128] __attribute__ ((section (".ewram")));</td> </tr></table><span class="postbody">
<br/>
<br/>
Is there some other syntax I can use in DevKitAdv to store this in EWRAM without wasting ROM space? 
<br/>
<br/>
If not, can anyone speak to how messy it is to move a project from DevKitAdv to DevKitArm? I've avoided doing this specifically to curtail last-minute bugs in my compo entry from a change in platform... But it's possible that those extra few bytes will make it worth it.
<br/>
<br/>
Thanks,
<br/>
<br/>
Scott</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#30511 - sajiimori - Wed Dec 01, 2004 7:23 pm</h4>
    <div class="postbody"><span class="postbody">The .bss section is for uninitialized data (which doesn't affect ROM size), but I bet it would still go in IWRAM.  If there isn't a corresponding section for EWRAM, you might have to make one...
<br/>
<br/>
Personally, I'd use malloc(). ^_^</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#30512 - ScottLininger - Wed Dec 01, 2004 7:31 pm</h4>
    <div class="postbody"><span class="postbody">Yeah, I just tried the .bss section, and it's not going into EWRAM. Thanks for the suggestion, though.
<br/>
<br/>
I'm installing DevKitArm... we'll see if anything breaks. ;)
<br/>
<br/>
I thought about the malloc() approach... more code but it would certainly work. 
<br/>
<br/>
-Scott</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#30517 - abilyk - Wed Dec 01, 2004 7:58 pm</h4>
    <div class="postbody"><span class="postbody">In general I'd recommend to write a simple EWRAM memory allocator, but that's probably overkill at this point.  Are you using EWRAM for anything else?  If not, this is a dirty hack, but it'll work.  Just declare a pointer to one of your sprite data structures and have it point to the beginning of EWRAM.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">typedef struct SpriteMetaData
<br/>
{
<br/>
   ...   
<br/>
}SpriteMetaData;
<br/>
<br/>
SpriteMetaData *sprite_meta_data = (SpriteMetaData *)0x02000000;</td> </tr></table><span class="postbody">
<br/>
<br/>
If you are using EWRAM elsewhere in your project, you can still use this technique by figuring out where your EWRAM usage ends and using the following address for this pointer.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#30520 - DekuTree64 - Wed Dec 01, 2004 8:14 pm</h4>
    <div class="postbody"><span class="postbody">What I like to do is make a global pointer to the end of EWRAM, and grow it downward like the IWRAM stack. Then you can just grab all your permanent memory chunks at bootup, and then have a nice big scratch pad, useful for various other things. 
<br/>
<br/>
It could cause problems mixing with malloc though, if malloc's managed area gets initialized before taking all your permanent blocks. Even if you do write your own malloc and initialize it with the space leftover after claiming the permanent blocks, you wouldn't have the scratch pad benefit since it would grow down into the managed area. Then it's basically the same as letting the linker do it (except for the ROM soaking problem)
<br/>
<br/>
You can probably relocate the .bss section to EWRAM in your link script, but then you might get some problems with uninitialized globals that were previously in IWRAM getting mvoed into EWRAM. As far as I know, you can't have 2 .bss-like sections, so I'd say go with the stack approach since it sounds like you're not using malloc at all<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#30529 - ScottLininger - Wed Dec 01, 2004 8:54 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>abilyk wrote:</b></span></td> </tr> <tr> <td class="quote">In general I'd recommend to write a simple EWRAM memory allocator, but that's probably overkill at this point.  Are you using EWRAM for anything else?  If not, this is a dirty hack, but it'll work.</td> </tr></table><span class="postbody">
<br/>
<br/>
Awesome. Thanks, everyone. I used abilyk's "dirty hack" and it's good enough for now. 
<br/>
<br/>
-Scott</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#30537 - tepples - Wed Dec 01, 2004 10:38 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ScottLininger wrote:</b></span></td> </tr> <tr> <td class="quote">Yeah, I just tried the .bss section, and it's not going into EWRAM. Thanks for the suggestion, though.
<br/>
<br/>
I'm installing DevKitArm... we'll see if anything breaks. ;)</td> </tr></table><span class="postbody">
<br/>
In devkitARM, the .sbss is like .bss but goes to EWRAM instead of IWRAM. Use it.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
