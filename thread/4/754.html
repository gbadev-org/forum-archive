<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Key Interrupt doesn't work with real GBA! - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Coding > Key Interrupt doesn't work with real GBA!</h2>
<div id="posts">
<div class="post">
    <h4>#3838 - DaveMidknight - Mon Mar 10, 2003 10:23 am</h4>
    <div class="postbody"><span class="postbody">Hi, 
<br/>
<br/>
I have a problem with the following code. It works without problem with all emus, but not with the real GBA. As a workaround I am polling the keys from the VBL-Interrupt, but I would like to use the Key Interrupt. May be someone has an idea.  
<br/>
Thanks anyway! 
<br/>
<br/>
Dave 
<br/>
<br/>
<br/>
//// CODE 
<br/>
<br/>
// one include to rule them all 
<br/>
#include "mygba.h" 
<br/>
<br/>
short key_code; 
<br/>
short key_event; 
<br/>
<br/>
<br/>
MULTIBOOT 
<br/>
<br/>
// this function gets called by the Interrupt handler 
<br/>
<br/>
void keyint() 
<br/>
{ 
<br/>
key_code=0; 
<br/>
if(F_CTRLINPUT_A_PRESSED ) { key_event=1; key_code|=0x001; } 
<br/>
if(F_CTRLINPUT_B_PRESSED ) { key_event=1; key_code|=0x002; } 
<br/>
if(F_CTRLINPUT_R_PRESSED ) { key_event=1; key_code|=0x004; } 
<br/>
if(F_CTRLINPUT_L_PRESSED ) { key_event=1; key_code|=0x008; } 
<br/>
if(F_CTRLINPUT_START_PRESSED ) { key_event=1; key_code|=0x010; } 
<br/>
if(F_CTRLINPUT_SELECT_PRESSED) { key_event=1; key_code|=0x020; } 
<br/>
if(F_CTRLINPUT_UP_PRESSED ) { key_event=1; key_code|=0x040; } 
<br/>
if(F_CTRLINPUT_DOWN_PRESSED ) { key_event=1; key_code|=0x080; } 
<br/>
if(F_CTRLINPUT_LEFT_PRESSED ) { key_event=1; key_code|=0x100; } 
<br/>
if(F_CTRLINPUT_RIGHT_PRESSED ) { key_event=1; key_code|=0x200; } 
<br/>
} 
<br/>
<br/>
int main(void) 
<br/>
{ 
<br/>
// initialize HAMlib 
<br/>
ham_Init(); 
<br/>
<br/>
ham_InitText(0); 
<br/>
// Sets Key Interrupt to react on pressing of all buttons 
<br/>
<br/>
*(volatile u16 *)(MEM_IO + 0x132)=0x43FF; 
<br/>
<br/>
ham_StartIntHandler(INT_TYPE_KEY,&amp;keyint); 
<br/>
<br/>
while(1) 
<br/>
{ 
<br/>
// Keyboard-Event !! 
<br/>
if(key_event) 
<br/>
{ 
<br/>
// Just a quick test! Press each button ones! :-)
<br/>
<br/>
if (key_code&amp;0x1) ham_DrawText(2,1,"A-Button"); 
<br/>
if (key_code&amp;0x2) ham_DrawText(2,2,"B-Button"); 
<br/>
if (key_code&amp;0x4) ham_DrawText(2,3,"R-Button"); 
<br/>
if (key_code&amp;0x8 ) ham_DrawText(2,4,"L-Button"); 
<br/>
if (key_code&amp;0x10) ham_DrawText(2,5,"Start-Button"); 
<br/>
if (key_code&amp;0x20) ham_DrawText(2,6,"Select-Button"); 
<br/>
if (key_code&amp;0x40) ham_DrawText(2,7,"Up-Button"); 
<br/>
if (key_code&amp;0x80) ham_DrawText(2,8,"Down-Button"); 
<br/>
if (key_code&amp;0x100) ham_DrawText(2,9,"Left-Button"); 
<br/>
if (key_code&amp;0x200) ham_DrawText(2,10,"Right-Button"); 
<br/>
key_event = 0; 
<br/>
inventary = 0; 
<br/>
repaint = 1; 
<br/>
} 
<br/>
} 
<br/>
} 
<br/>
<br/>
<br/>
P.S. On the GBA it stops working after you have pressed 5 buttons.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#3841 - ampz - Mon Mar 10, 2003 1:11 pm</h4>
    <div class="postbody"><span class="postbody">Sounds like a stack overflow issue or something?</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
