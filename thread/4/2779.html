<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Calling a function within a function - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > Calling a function within a function</h2>
<div id="posts">
<div class="post">
    <h4>#15787 - slboytoy - Fri Jan 30, 2004 6:24 am</h4>
    <div class="postbody"><span class="postbody">When I call another function within a function it gives me a warning..
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Type mismatch with previous implicit declaration
<br/>
Previous implicit declaration of 'ClearScreen'
<br/>
'ClearScreen' was previously implicitly decalared to return 'int'
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
int MoveMemorySpot(int offset, int MemoryEnd, int Mem_Length)
<br/>
{
<br/>
   if(!(*KEYS &amp; KEY_RIGHT))
<br/>
   {
<br/>
      offset++;
<br/>
      if (offset &gt; (MemoryEnd - Mem_Length + 3))
<br/>
         offset = MemoryEnd - Mem_Length + 3;
<br/>
<br/>
      ClearScreen();
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I know it's just a warning, and it still works fine, but its very annoying...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15788 - tepples - Fri Jan 30, 2004 7:11 am</h4>
    <div class="postbody"><span class="postbody">It means that you need ClearScreen()'s prototype in scope before you call ClearScreen().<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15799 - Paul Shirley - Fri Jan 30, 2004 3:54 pm</h4>
    <div class="postbody"><span class="postbody">removed</span><span class="gensmall"><br/><br/>Last edited by Paul Shirley on Sun Mar 28, 2004 9:15 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#15804 - slboytoy - Fri Jan 30, 2004 6:04 pm</h4>
    <div class="postbody"><span class="postbody">I have this defined in main.c
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void ClearScreen(void); </td> </tr></table><span class="postbody">
<br/>
<br/>
Where the actually function is written is in display.c  (which C includes)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include display.c</td> </tr></table><span class="postbody">
<br/>
<br/>
Most of my functions don't come up with that warning, but then there are a few functions that the warning comes up...  
<br/>
<br/>
So where should I be defining ClearScreen then?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15805 - poslundc - Fri Jan 30, 2004 6:53 pm</h4>
    <div class="postbody"><span class="postbody">1. Never, ever, ever #include a .c file. Only ever include header files (.h). These header files should only have things like #defines, typedefs, struct declarations, and prototypes. <span style="text-decoration: underline"><span style="font-weight: bold">They should never contain any actual, executable C functions or global variables.</span></span>
<br/>
<br/>
2. For every .c file in your project, have a corresponding .h file. In this .h file, put the function prototypes for any functions in its corresponding .c file that you want other .c files to be able to access. (eg. if display.c has the ClearScreen function and you want main.c to be able to call it, you would put the ClearScreen prototype in display.h.)
<br/>
<br/>
3. #include this header file in any .c files that need to call the functions in the header file's corresponding .c file.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15806 - Paul Shirley - Fri Jan 30, 2004 7:01 pm</h4>
    <div class="postbody"><span class="postbody">removed</span><span class="gensmall"><br/><br/>Last edited by Paul Shirley on Sun Mar 28, 2004 9:16 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#15807 - Miked0801 - Fri Jan 30, 2004 7:16 pm</h4>
    <div class="postbody"><span class="postbody">lmao.  But my compiler/linker should be smart enough not to double/triple define things and not setup jumps to NULL and stuff right?  ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15811 - Paul Shirley - Fri Jan 30, 2004 8:13 pm</h4>
    <div class="postbody"><span class="postbody">removed</span><span class="gensmall"><br/><br/>Last edited by Paul Shirley on Sun Mar 28, 2004 9:16 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#15812 - tepples - Fri Jan 30, 2004 8:30 pm</h4>
    <div class="postbody"><span class="postbody">Or you can just use <span style="font-weight: bold">gcc -Wall</span> to make the C compiler check prototypes and handle several other common errors.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15815 - Miked0801 - Fri Jan 30, 2004 10:03 pm</h4>
    <div class="postbody"><span class="postbody">Sorry, my sarcasm was lost on that post.  I'm well aware of what C will allow you to do if you aren't careful as over time I'm sure I've done most of them myself.  Learn to love -Wall.  Here's a snapshot of typical beginner C badness.  See if how it takes you to find Waldo. :)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
int dontTryThisAtHome(int *a, int *b, int count)
<br/>
{
<br/>
    int i;
<br/>
    int equalCount;
<br/>
<br/>
    for(i=0; i&lt;count; i++);
<br/>
    {
<br/>
        if(a[i] = b[i])
<br/>
        {
<br/>
            equalCount++;
<br/>
        } 
<br/>
    }
<br/>
<br/>
    return equalCount;
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15816 - picomontoya - Fri Jan 30, 2004 11:20 pm</h4>
    <div class="postbody"><span class="postbody">I think I found Waldo.  Equal count is not initialized.  And there is no error checking for the two pointer parameters.  And the assignment operator is used not the equality operator.  And there is a semicolon after the for statement's close-paranthesis.  Did I miss something?
<br/>
<br/>
I like little games like this.  Thank you, Miked0801.<br/>_________________<br/><a href="http://www.familyradio.com" target="_blank">www.familyradio.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15819 - dagamer34 - Sat Jan 31, 2004 4:35 am</h4>
    <div class="postbody"><span class="postbody">Waldo(s)...<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15823 - Miked0801 - Sat Jan 31, 2004 6:30 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Did I miss something? 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
One more to find that is the nastiest of all - probably would cause the program to page fault at best and crash a winbox at worst :)
<br/>
<br/>
I'll give you a hint: it's part of something you already mentioned.
<br/>
<br/>
I'll post tomorrow :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15824 - tepples - Sat Jan 31, 2004 6:41 am</h4>
    <div class="postbody"><span class="postbody">It does write to the location right after the end of the given range of a[].<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15826 - jd - Sat Jan 31, 2004 7:22 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">It does write to the location right after the end of the given range of a[].</td> </tr></table><span class="postbody">
<br/>
<br/>
..and an illegal read right after the given range of b[]. (Both due to that pesky semicolon at the end the 'for' statement.)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15827 - picomontoya - Sat Jan 31, 2004 9:57 am</h4>
    <div class="postbody"><span class="postbody">Aw, rats.  I wanted an A+.<br/>_________________<br/><a href="http://www.familyradio.com" target="_blank">www.familyradio.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15832 - Miked0801 - Sat Jan 31, 2004 6:20 pm</h4>
    <div class="postbody"><span class="postbody">:)  They found it.
<br/>
<br/>
And those are the kinds of bugs the -Wall will catch.  I love it when people tell me "It's only a warning."  The worst part is, this little bug would probably go un-noticed for a while on a GBA - causing some other function to act a bit screwy.
<br/>
<br/>
I really wish they'd put a "Warning: For Statement has semi-colon followed by open braces." into GCC to catch this.  I got burned by that for the first time in years last week.  I looked on the GCC site to see if there was a place to give suggestions, but couldn't find one.
<br/>
<br/>
As people seemed to enjoy that bug hunt, I'll make a new thread and post another one later.  The sad part is at one of my job interviews, a similar problem was on the employee test :P</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15833 - Paul Shirley - Sat Jan 31, 2004 7:26 pm</h4>
    <div class="postbody"><span class="postbody">removed</span><span class="gensmall"><br/><br/>Last edited by Paul Shirley on Sun Mar 28, 2004 9:16 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#15837 - tepples - Sun Feb 01, 2004 1:20 am</h4>
    <div class="postbody"><span class="postbody">But -Wall does enable -Wimplicit-function-declaration, which does much the same thing, "[g]iv[ing] a warning (or error) whenever a function is used before being declared."
<br/>
<br/>
(For those playing at home, here's a <a class="postlink" href="http://gcc.gnu.org/onlinedocs/gcc-3.3.2/gcc/Warning-Options.html" target="_blank">list of warnings</a> enabled and not enabled by gcc -Wall.)<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15850 - slboytoy - Sun Feb 01, 2004 6:01 pm</h4>
    <div class="postbody"><span class="postbody">So in my Main.c I should have...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">include "display.h"</td> </tr></table><span class="postbody">
<br/>
<br/>
and in my display.h i should have....
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void clearscreen(void);</td> </tr></table><span class="postbody">
<br/>
<br/>
and in my display.c i should have...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void ClearScreen(void)  // clear screen, and draw a blue back ground
<br/>
{
<br/>
   int x,y;
<br/>
   for(x = 22; x&lt;118;x++)   //loop through all x
<br/>
      for(y = 40; y &lt; 157; y++)  //loop through all y
<br/>
         VideoBuffer[x+y*120] = RGB16(5,10,13);  
<br/>
}
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
What should my make file look like then?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15851 - Paul Shirley - Sun Feb 01, 2004 6:40 pm</h4>
    <div class="postbody"><span class="postbody">removed</span><span class="gensmall"><br/><br/>Last edited by Paul Shirley on Sun Mar 28, 2004 9:17 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#15852 - slboytoy - Sun Feb 01, 2004 6:53 pm</h4>
    <div class="postbody"><span class="postbody">My make file looks like...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
gcc -c -O3 -mthumb -mthumb-interwork main.c
<br/>
gcc -c -O3 -mthumb -mthumb-interwork display.c
<br/>
<br/>
gcc -mthumb -mthumb-interwork -o main.elf main.o display.o 
<br/>
<br/>
objcopy -O binary main.elf main.mb
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
But both main.c and display.c need the GBA.H file in order to compile, and then I get a redefinion error.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15854 - Paul Shirley - Sun Feb 01, 2004 8:22 pm</h4>
    <div class="postbody"><span class="postbody">removed</span><span class="gensmall"><br/><br/>Last edited by Paul Shirley on Sun Mar 28, 2004 9:17 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#15860 - slboytoy - Sun Feb 01, 2004 8:58 pm</h4>
    <div class="postbody"><span class="postbody">Sorry I meant to say, within the header, I define a variable.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#ifndef KEYPAD_H
<br/>
#define KEYPAD_H
<br/>
<br/>
//Key Definitions from Nokturn's key demo
<br/>
#define KEY_A 1
<br/>
#define KEY_B 2
<br/>
#define KEY_SELECT 4
<br/>
#define KEY_START 8
<br/>
#define KEY_RIGHT 16
<br/>
#define KEY_LEFT 32
<br/>
#define KEY_UP 64
<br/>
#define KEY_DOWN 128
<br/>
#define KEY_R 256
<br/>
#define KEY_L 512
<br/>
<br/>
int* KEYS = (int*)0x04000130;
<br/>
<br/>
#endif
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Now if I need this header with two different C files, I get the error about KEYS being redefined.  I tried putting 'static' infront of it, but then my keypad doesn't work at all...
<br/>
<br/>
How can I just call that header once, so the whole program can share it's resources.  Or would I just put "KEYS" as a global variable?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15862 - Paul Shirley - Sun Feb 01, 2004 9:52 pm</h4>
    <div class="postbody"><span class="postbody">removed</span><span class="gensmall"><br/><br/>Last edited by Paul Shirley on Sun Mar 28, 2004 9:17 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#15863 - Miked0801 - Sun Feb 01, 2004 9:52 pm</h4>
    <div class="postbody"><span class="postbody">Your KEYS declaration is creating memory and therefore shouldn't be located in an include file.  Either #Define it, or put it in keypad.c and 'extern' it for use elsewhere.  If you do the extern approach, I'd also declare it 'const' such that if something decides to change it, you'll get a warning. 
<br/>
<br/>
Style-wise, I'd also declare the key definitions in Hex as they are always going to be used in bitwise operator/mask situations, but that's just me :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15870 - slboytoy - Mon Feb 02, 2004 1:20 am</h4>
    <div class="postbody"><span class="postbody">After a lot of playing around, I think i've got it working.  The best way to learn is to do, and try again. (many many times).  ANd now it's time for football. thank guys.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15874 - FluBBa - Mon Feb 02, 2004 9:42 am</h4>
    <div class="postbody"><span class="postbody">And while we are at it, remember to read the Joypad reg only once every frame to get rid of bouncing and put it in a variable that you use later in the program, you can also have 2 or 3 variables so you can have Status/Pushed/Released.<br/>_________________<br/>I probably suck, my not is a programmer.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
