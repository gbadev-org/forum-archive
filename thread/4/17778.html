<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Cheat code system/ Buffer for player input - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Coding > Cheat code system/ Buffer for player input</h2>
<div id="posts">
<div class="post">
    <h4>#177007 - blessingta@hotmail.co.uk - Mon Nov 21, 2011 2:58 pm</h4>
    <div class="postbody"><span class="postbody">hi
<br/>
<br/>
I'm trying to create a system that allows the player to input cheat codes
<br/>
 and so far Im trying the buffer system and I've been having errors (while loop wont terminate) with this visual studio trial I've done:
<br/>
<br/>
Plus whats the most memory safe/easiest way of implementing a player input buffer?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">// linked list gba.cpp : Defines the entry point for the console application.
<br/>
//
<br/>
<br/>
#include "stdafx.h"
<br/>
#include &lt;iostream&gt;
<br/>
enum EKEYSTATE
<br/>
{
<br/>
   a,
<br/>
   b,
<br/>
   c,
<br/>
   d,
<br/>
   e
<br/>
<br/>
};
<br/>
//BUFFER FOR CURRENT KEYS
<br/>
//Purpose: to store information about the keys in the current buffer
<br/>
struct SKey_buffer
<br/>
{
<br/>
   volatile unsigned char vuc_KEYSTATE;
<br/>
   SKey_buffer * next;
<br/>
   bool bHead;
<br/>
};
<br/>
<br/>
    SKey_buffer _buff6;  
<br/>
   SKey_buffer _buff5;  
<br/>
   SKey_buffer _buff4;  
<br/>
   SKey_buffer _buff3;  
<br/>
   SKey_buffer _buff2;  
<br/>
   SKey_buffer _buff1;  
<br/>
<br/>
   SKey_buffer* iter;//iter head
<br/>
   SKey_buffer * iter_Head;//temp storage for iter head
<br/>
   SKey_buffer* iter_newNULL; //initialised to current null   
<br/>
<br/>
   void BUFFER_keysinit();
<br/>
   void  BUFFER_newKeys(volatile unsigned char a);
<br/>
<br/>
<br/>
int _tmain(int argc, _TCHAR* argv[])
<br/>
{
<br/>
   BUFFER_keysinit();
<br/>
<br/>
       //this unsigned char will be replaced with enums after i know that the linked list is working properly
<br/>
   volatile unsigned char a = 'A';
<br/>
   
<br/>
   int i = 0;
<br/>
   while (i &lt; 200)
<br/>
   {
<br/>
      BUFFER_newKeys(a);
<br/>
      a++;
<br/>
<br/>
      std::cout&lt;&lt;iter-&gt;vuc_KEYSTATE&lt;&lt;std::endl;
<br/>
      i++;
<br/>
   }
<br/>
   return 0;
<br/>
}
<br/>
<br/>
//initialise key input buffer
<br/>
void BUFFER_keysinit()
<br/>
{
<br/>
    _buff6.next = NULL;    _buff6.bHead = false; 
<br/>
    _buff5.next = &amp;_buff6; _buff5.bHead = false; 
<br/>
    _buff4.next = &amp;_buff5; _buff4.bHead = false; 
<br/>
    _buff3.next = &amp;_buff4; _buff3.bHead = false; 
<br/>
    _buff2.next = &amp;_buff3; _buff2.bHead = false; 
<br/>
    _buff1.next = &amp;_buff2; _buff1.bHead = true; 
<br/>
<br/>
   
<br/>
   iter_Head = &amp;_buff1;//head at initialisation
<br/>
   iter = iter_Head; //head at start of traversing
<br/>
   iter_newNULL = &amp;_buff6; //initialised to current null
<br/>
<br/>
}
<br/>
<br/>
void BUFFER_newKeys(volatile unsigned char a)
<br/>
{
<br/>
   ///////////////////////////////////////////////////////////////////////////////
<br/>
//section continuously executed
<br/>
   //Locate current NULL
<br/>
   while (iter-&gt;next != NULL)
<br/>
   {
<br/>
      //This will be the last iterrator prior the last,
<br/>
      //NULL with wont be executed
<br/>
      iter_newNULL-&gt;next = iter;
<br/>
      iter = iter-&gt;next;
<br/>
   }
<br/>
<br/>
   //iter == null
<br/>
   if (iter-&gt;next == NULL)
<br/>
   {
<br/>
      //current NULL, = current state
<br/>
      iter-&gt;vuc_KEYSTATE = a;
<br/>
<br/>
      //current NULL iter = New head
<br/>
      //point to old head: set old head to false
<br/>
      iter_Head-&gt;bHead = false;
<br/>
      iter-&gt;next = iter_Head;
<br/>
      iter-&gt;bHead = true;
<br/>
<br/>
      //NEW iter_head = "current NULL"
<br/>
      iter_Head = iter;
<br/>
<br/>
      //active new null to null
<br/>
      iter_newNULL-&gt;next = NULL;
<br/>
   }
<br/>
///////////////////////////////////////////////////////////////////////////////
<br/>
<br/>
}
<br/>
<br/>
<br/>
 </td> </tr></table><span class="postbody">[/code]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177010 - ant512 - Mon Nov 21, 2011 8:58 pm</h4>
    <div class="postbody"><span class="postbody">The simplest way is to store each button press in a char array, which you treat like a queue.  So, you'd have this:
<br/>
<br/>
char cheatcode[4];
<br/>
<br/>
When a player presses UP, you'd have this in your array:
<br/>
<br/>
{ 0, 0, 0, 1}
<br/>
<br/>
If the player then presses DOWN, you'd have this in your array:
<br/>
<br/>
{ 0, 0, 1, 2}
<br/>
<br/>
If the player then presses RIGHT, you'd have this:
<br/>
<br/>
{ 0, 1, 2, 4}
<br/>
<br/>
Each time a new button is pressed, you shift the array up.  Old numbers drop off the front.  This isn't an expensive thing to do and you can add it to your input handler.
<br/>
<br/>
To check for a matching cheat, just compare your array with a valid cheat code.  Here's a non-valid code:
<br/>
<br/>
char valid[] = { 1, 2, 3, 4 }
<br/>
char cheat[] = { 2, 3, 3, 4}
<br/>
<br/>
Here's a valid code:
<br/>
<br/>
char valid[] = { 1, 2, 3, 4 }
<br/>
char cheat[] = { 1, 3, 3, 4}</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177011 - blessingta@hotmail.co.uk - Mon Nov 21, 2011 11:55 pm</h4>
    <div class="postbody"><span class="postbody">how do i add to a que? thats the problem I had been having which lead me to think that a linked list could possibly be the better option</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177012 - sverx - Tue Nov 22, 2011 11:08 am</h4>
    <div class="postbody"><span class="postbody">a small array and an index (say to the last entry) could be enough :)<br/>_________________<br/><a class="postlink" href="http://bit.ly/yiQrz9" target="_blank">libXM7</a>|<a class="postlink" href="http://bit.ly/yJwcOo" target="_blank">NDS programming tutorial (Italiano)</a>|<a class="postlink" href="http://disjointedstudio.blogspot.com/" target="_blank">Waimanu DS / GBA</a>|<a class="postlink" href="http://adshomebrewersdiary.blogspot.com" target="_blank">A DS Homebrewer's Diary</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177013 - blessingta@hotmail.co.uk - Tue Nov 22, 2011 5:01 pm</h4>
    <div class="postbody"><span class="postbody">Whats the "itoa" function equivalent on the GBA? 
<br/>
<br/>
I need to convert the player's score into a char array that can displayed on screen any help?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177014 - Miked0801 - Tue Nov 22, 2011 5:13 pm</h4>
    <div class="postbody"><span class="postbody">please, just google that.  It's a standard function that any experienced coder is expected to know how to do - heck it's been an interview question for me a couple of times now.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177015 - Dwedit - Tue Nov 22, 2011 5:39 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>blessingta@hotmail.co.uk wrote:</b></span></td> </tr> <tr> <td class="quote">Whats the "itoa" function equivalent on the GBA? 
<br/>
<br/>
I need to convert the player's score into a char array that can displayed on screen any help?</td> </tr></table><span class="postbody">
<br/>
<br/>
I already answered this in <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?p=176979" target="_blank">this post</a>.  It's easy to skim over someone else's post, but try to read more carefully.
<br/>
<br/>
	char buffer[12];
<br/>
	sniprintf(buffer,12,"%d",value);<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"><br/><br/>Last edited by Dwedit on Tue Nov 22, 2011 5:42 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#177016 - blessingta@hotmail.co.uk - Tue Nov 22, 2011 5:40 pm</h4>
    <div class="postbody"><span class="postbody">devkitpro wont recognise "itoa" and returns this error message instead:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">g:/YEAR2/Console_Programming_CONPRG/Course_Work/gba/my_gba_sprites/source/main.c:111: undefined reference to `itoa'</td> </tr></table><span class="postbody">
<br/>
<br/>
yet I've included </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include &lt;stdio.h&gt;</td> </tr></table><span class="postbody">
<br/>
<br/>
I'm currently under a lot of stress with the looming deadlines so please mind me if I seem to be posting stupid questions.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177017 - Dwedit - Tue Nov 22, 2011 5:43 pm</h4>
    <div class="postbody"><span class="postbody">"itoa" is not part of the standard C library, even though "atoi" is.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177018 - blessingta@hotmail.co.uk - Tue Nov 22, 2011 5:45 pm</h4>
    <div class="postbody"><span class="postbody">thanks it worked</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177019 - Miked0801 - Tue Nov 22, 2011 6:36 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
void itoaHelper(int i, char *a, unsigned dividend, bool printZeroes)
<br/>
{
<br/>
  if(dividend == 0)
<br/>
  {
<br/>
    *a++ = 0;
<br/>
    return;
<br/>
  }
<br/>
<br/>
  char newVal =  (i / dividend) + '0';
<br/>
  bool isZero = (newVal == '0');
<br/>
<br/>
  if(printZeroes == false)
<br/>
  {
<br/>
      printZeroes = !isZero;
<br/>
  }
<br/>
<br/>
  if((isZero &amp;&amp; printZeroes) || !isZero)
<br/>
  {
<br/>
    *a++ = newVal;
<br/>
  }
<br/>
<br/>
  itoaHelper(i % dividend, a, dividend / 10, printZeroes);
<br/>
}
<br/>
<br/>
void itoa(int i, char *a)
<br/>
{
<br/>
  if(i == 0)
<br/>
  {
<br/>
    *a++ = '0';
<br/>
  }
<br/>
<br/>
  if(i &lt; 0)
<br/>
  {
<br/>
    i = -i;
<br/>
    *a++ = '-';
<br/>
  }
<br/>
<br/>
  itoaHelper(i, a, 1000000000, false);
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
