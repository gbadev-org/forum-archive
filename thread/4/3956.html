<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Almost there with MultiBoot! - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Coding > Almost there with MultiBoot!</h2>
<div id="posts">
<div class="post">
    <h4>#25517 - Krakken - Tue Aug 24, 2004 9:47 am</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
For some very strange reason, which I can't yet pinpoint, my <b style="color:#FFA34F">multiboot</b> sender ROM is not completing the transfer of data to the slave GBA. Everything seems absolutely fine up until it would normally be executed where it just freezes (the Nintendo logo stops flashing).
<br/>
<br/>
It works on no$gba when I take the v-blank wait from inside the send routine (although the ROM prints all the send-recieve to the screen and there doesn't seem to be any difference regardless). It tries to execute too quickly on the GBA so it needs the vblank wait.
<br/>
<br/>
The ROM is aligned to 10h bytes (by extending the length by x bytes). Originally I thought it may have been an alignment problem at the start but it all seems fine. The start starts at ROM + 0xC0 and ends at ROM + 0xC0 + Length.
<br/>
<br/>
I have tested everything and everything seems okay. I just don't understand why it won't work with a vblank wait in the transfer routine seeing as the transfer routine still seems to execute as it should.
<br/>
<br/>
It's the same on hardware. Anyone have any ideas?
<br/>
<br/>
Thanks,
<br/>
Krakken.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25520 - Krakken - Tue Aug 24, 2004 12:05 pm</h4>
    <div class="postbody"><span class="postbody">Haha I got it. It was a silly mistake on my behalf. I was setting the client code AFTER sending the handshake by mistake. This didn't matter when it went fast as the "junk" data sent after the handshake seemed to be the same as the client code but different when a delay was there. (Maybe BIOS didn't have time to set a new value?)
<br/>
<br/>
Anyways, now I have this working I can work on some more multiplayer stuff.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25546 - ProblemBaby - Tue Aug 24, 2004 9:15 pm</h4>
    <div class="postbody"><span class="postbody">Do you want to help me??
<br/>
Ive tried to do <b style="color:#FFA34F">multiboot</b> code but never got it to work in no$gba and on hardware only at hardware with the example from <a href="http://www.devrs.com." target="_blank">www.devrs.com.</a>
<br/>
Ive no idea of what iam doing wrong iam doing exaclty as it stand in the gba spec. and recieve correct data. but when I try to run the BIOS-routine i got ROM-image crashed.
<br/>
<br/>
Do you have any ideas?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25557 - Krakken - Wed Aug 25, 2004 1:39 am</h4>
    <div class="postbody"><span class="postbody">Yup this stumped me for a while. There are two reasons it is doing that. 
<br/>
<br/>
Firstly: The ROM image that is provided does not seem to be a valid one. Don't ask me why maybe something went wrong somewhere along the lines. Just use b2o or b2x to convert any <b style="color:#FFA34F">MULTIBOOT</b> rom to a file that you can include and use. (If you use b2x change the array so it has const at the beginning or it'll go in IWRAM).
<br/>
<br/>
Secondly: I found that I had to download my GBA BIOS to a file so that the emulator would start like a real emulator. You need to call this no$gba.rom or gba.rom and place it in the same folder as your no$gba executable. Then you need to tell the options to use it. (I'm not 100% sure this step is required but i'd recommend it anyway if you are using ANY of the BIOS routines).
<br/>
<br/>
That "should" solve your problems. If you have any other questions i'll be happy to help.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25586 - ProblemBaby - Wed Aug 25, 2004 3:10 pm</h4>
    <div class="postbody"><span class="postbody">It was a problem with the ROM! so now it works in no$gba but not in hardware=/ any ideas?
<br/>
except for that, Thanks a lot for the information.
<br/>
I want to ask two other questions that I don't really understand...
<br/>
<br/>
1.
<br/>
In the demo att devrs he sets a variable named pc: pc = 0xD1
<br/>
what is that it isnt mentioned in the GBA spec. is it important to have it to make it work??
<br/>
<br/>
2.
<br/>
the palette data I dont understand how it is calculated or what it is...
<br/>
they talk about: direction, speed and color???? but seems to work even if I change it (in no$gba)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25587 - Krakken - Wed Aug 25, 2004 4:19 pm</h4>
    <div class="postbody"><span class="postbody">1.
<br/>
The "pc" variable isn't needed. it makes no difference if you use it or not. I think it might be something to do with debug. Also, the header that is provided in that example is a bit of an overkill. You can just use char arrays for the reserved bytes, you don't need seperate variables when reserved bytes are next to each other.
<br/>
<br/>
2.
<br/>
Basically, the values you give the palette variable determines how the palette will display when the ROM image is loading on the slave GBA units. There are 7 colours, 4 speeds and 2 directions that can be used. I haven't actually tested the direction variable yet but I think it's to do with how the colour table is sorted. Each of the colours 0 through 6 represents a different colour on the table. 0 = Pink, 1 = Blue, 2 = Light Blue, 3 = Green and so on (I think that's right). If you want the colour to stay the same while the ROM loads use <span style="font-weight: bold">"0xF1 + COLOUR * 2"</span> if you want the palette to change during load use <span style="font-weight: bold">"0x81 + COLOUR * 0x10 + DIRECTION * 8 + SPEED * 2"</span>. I haven't actually tested direction but to get a nice FAST flashing of blue use <span style="font-weight: bold">"0x81 + 1 * 0x10 + 0 * 8 + 3 * 2"</span> --&gt; <span style="font-weight: bold">"0x81 + 0x10 + 0 + 6"</span> --&gt; <span style="font-weight: bold">"0x97"</span>
<br/>
<br/>
Hope this answers your questions.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25592 - ProblemBaby - Wed Aug 25, 2004 7:07 pm</h4>
    <div class="postbody"><span class="postbody">Yes that was nice to know!
<br/>
anyway I cant get it to work in real hardware...
<br/>
(notice that this works in no$gba)
<br/>
I recieve correct values from the hardware (I think)
<br/>
and Ihave response after all I send and after the BIOS-function I recieve
<br/>
1 from the BIOS function that means that something goes wrong.
<br/>
can it be something wrong in what I send or is it probably something wrong with the MB-structure?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25604 - ProblemBaby - Wed Aug 25, 2004 10:22 pm</h4>
    <div class="postbody"><span class="postbody">I fixed it=)
<br/>
I really dont know what I did but now it works!=)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
