<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>devkitARM template makefile issues - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > devkitARM template makefile issues</h2>
<div id="posts">
<div class="post">
    <h4>#58914 - wintermute - Thu Oct 27, 2005 5:42 am</h4>
    <div class="postbody"><span class="postbody">(Split from <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?p=58887#58887" target="_blank">here</a>.)
<br/>
<br/>
Could you elaborate on "multiple levels of dependencies"?
<br/>
<br/>
The example makefiles and associated rules build everything in a separate build folder which makes dependency generation more reliable since a full path to the prerequsiites is created.
<br/>
<br/>
VPATH is simply a list of paths where prerequisites may be found, in most cases adding folders to the SOURCES variable will do what you need. The .P and .d files are autogenerated and you shouldn't need to do anything with them although enabling gbfs to generate it's own dependency list might be useful. Another handy feature might be to allow gbfs to parse an entire directory and add all the files it finds much like the way conv2AAS ( the Apex Audio converter) works.
<br/>
<br/>
The .d files are a simple format consisting of a standard dependency rule with no commands.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
&lt;output file&gt;: &lt;prerequiste file&gt; \
<br/>
 &lt;prequisite file&gt;
<br/>
 ...
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
all prerequisites should be given as a full path spec.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#58916 - tepples - Thu Oct 27, 2005 6:43 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">Could you elaborate on "multiple levels of dependencies"?</td> </tr></table><span class="postbody">
<br/>
data.gbfs depends on skin2.lz, which depends on skin2.todbg, which depends on skin2.bmp, and the translator from .bmp to .todbg has a limitation that it must place the .todbg file in the same folder as the .bmp file and with the same base name (e.g. ../data/FooBar.bmp always becomes ../data/FooBar.todbg).
<br/>
<br/>
Or the build process depends on copying the whole thing to the CF writer's drive letter. I know how to express a lot of these things in raw Make language, but sometimes I draw a blank when it comes to getting it working within your template.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">The example makefiles and associated rules build everything in a separate build folder which makes dependency generation more reliable since a full path to the prerequsiites is created.</td> </tr></table><span class="postbody">
<br/>
So should every program that performs translation output a .P file?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">VPATH is simply a list of paths where prerequisites may be found, in most cases adding folders to the SOURCES variable will do what you need.</td> </tr></table><span class="postbody">
<br/>
Then what happens when two files in the project have the same name? Using VPATH looks to me like using the old 128K Mac's flat file system, where each file had to have a unique name even if the files were in different folders. Imagine two games in one cart, where both have a file called "skin02.lz".
<br/>
<br/>
And to exclude files that currently are unused from a build, do you have to move them out of the folder?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">The .P and .d files are autogenerated and you shouldn't need to do anything with them although enabling gbfs to generate it's own dependency list might be useful.</td> </tr></table><span class="postbody">
<br/>
As well as all the other programs that write multiple files, such as the luminesweeper skin compiler. And I'm not so sure of myself as to how to write rules for simple "cmdname infile.ext outfile.sfx" type things that update the .d files.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Another handy feature might be to allow gbfs to parse an entire directory and add all the files it finds much like the way conv2AAS ( the Apex Audio converter) works.</td> </tr></table><span class="postbody">
<br/>
You're <span style="font-style: italic">supposed</span> to be able to do <span style="font-weight: bold">gbfs file.gbfs ..\data\*</span> but for some reason the globber in the version of MinGW that I use doesn't work as advertised.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">all prerequisites should be given as a full path spec.</td> </tr></table><span class="postbody">
<br/>
"full path" meaning drive letter and everything? Doesn't this eventually defeat the purpose of being able to compile a project on anyone's computer?
<br/>
<br/>
Another thing that surprised me was deciding whether or not to link a GBA project as cart or multiboot <span style="font-style: italic">depending on the name of the folder that the project was in.</span>
<br/>
<br/>
(Seems like I derailed this topic; I'll split it.)<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#58922 - wintermute - Thu Oct 27, 2005 9:08 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">Could you elaborate on "multiple levels of dependencies"?</td> </tr></table><span class="postbody">
<br/>
data.gbfs depends on skin2.lz, which depends on skin2.todbg, which depends on skin2.bmp, and the translator from .bmp to .todbg has a limitation that it must place the .todbg file in the same folder as the .bmp file and with the same base name (e.g. ../data/FooBar.bmp always becomes ../data/FooBar.todbg).
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Being honest the best way to deal with data is really to have a separate Makefile for your data subdirectories, especially if you have tools which are incapable of writing files in another directory. To do this create a phoney target ( i.e. add the target to the Makefile's .PHONY list) which means the rule will always be executed.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
.PHONY: data
<br/>
#---------------------------------------------------------------------------------
<br/>
data:
<br/>
   @make -C &lt;data dir&gt;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
or alternatively using the name of the folder as the target
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
.PHONY: data 
<br/>
#---------------------------------------------------------------------------------
<br/>
data:
<br/>
   @make -C $@
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
You can repeat a rule like this as many times as necessary for each data folder which contains a Makefile
<br/>
<br/>
One of the reasons that the devkitPro Makefiles have evolved to what you see today is that a *lot* of people are basically too lazy to bother with learning anything about make and want something that will just work for whatever project they're working on. There is a considerable amount of automation in there to allow for just that although I do use them a lot myself now since they've ended up being so convenient.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Or the build process depends on copying the whole thing to the CF writer's drive letter. I know how to express a lot of these things in raw Make language, but sometimes I draw a blank when it comes to getting it working within your template.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Sometimes I draw a blank too :) It can be very hard to work some tools into the templates, especially when they don't allow for files to be output in a separate directory. Using the separate Makefile approach above should help quite a bit.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
So should every program that performs translation output a .P file?
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
No, the .P files are intermediate files used for adjusting the dependencies so that deleted files don't cause the build to fail, the Makefile only includes .d files. Unless the program in question requires more than one file then there's no need to write a .d file and even then it can be just as easy to write explicit dependencies or have the Makefile automate it in some way.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">VPATH is simply a list of paths where prerequisites may be found, in most cases adding folders to the SOURCES variable will do what you need.</td> </tr></table><span class="postbody">
<br/>
Then what happens when two files in the project have the same name? Using VPATH looks to me like using the old 128K Mac's flat file system, where each file had to have a unique name even if the files were in different folders. Imagine two games in one cart, where both have a file called "skin02.lz".
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Yes, that's one limitation of this approach, far outweighed by the convenience of auto dependency generation imo. Again the best solution to this is probably the separate Makefile for data approach in conjunction with gbfs or some similar application.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
And to exclude files that currently are unused from a build, do you have to move them out of the folder?
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
If you want to retain the automation then yes. You can, of course, simply name the object files directly instead of having the functions to search the provided paths for potential source files. You can either list your source files in the CFILES/CPPFILES variables or the object files in the OFILES variable.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">The .P and .d files are autogenerated and you shouldn't need to do anything with them although enabling gbfs to generate it's own dependency list might be useful.</td> </tr></table><span class="postbody">
<br/>
As well as all the other programs that write multiple files, such as the luminesweeper skin compiler. And I'm not so sure of myself as to how to write rules for simple "cmdname infile.ext outfile.sfx" type things that update the .d files.
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Unless the tools work with files that *contain* references to other files which should be treated as prerequisites you don't really need to worry about .d files. For tools which output more than one file then multiple target rules should suffice.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
%.h %.c: %.bmp
<br/>
   &lt;tool to create .h &amp; .c from bmp&gt; $&lt;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
This also takes care of the dependencies since make now knows how to create both .h &amp; .c from a .bmp file. Something to note, you can't always guarantee which target make will attempt to create with these rules, $* refers to the file without the extension. 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
You're <span style="font-style: italic">supposed</span> to be able to do <span style="font-weight: bold">gbfs file.gbfs ..\data\*</span> but for some reason the globber in the version of MinGW that I use doesn't work as advertised.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
<a href="http://www.mingw.org/MinGWiki/index.php/TestForGlobbing?version=1" target="_blank">http://www.mingw.org/MinGWiki/index.php/TestForGlobbing?version=1</a> might help. I can't say I've made use of globbing recently so I haven't really looked at this. One other thing I've noticed a couple of times is that on some systems using * as a wildcard doesn't return files with extensions. You may also need to check if the argument refers to a directory.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">all prerequisites should be given as a full path spec.</td> </tr></table><span class="postbody">
<br/>
"full path" meaning drive letter and everything? Doesn't this eventually defeat the purpose of being able to compile a project on anyone's computer?
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Why would you distribute generated dependency files? This comment was referring only to the generated .d files, not to prerequisites in general.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Another thing that surprised me was deciding whether or not to link a GBA project as cart or multiboot <span style="font-style: italic">depending on the name of the folder that the project was in.</span>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Just name the target directly instead of using the default command that names the target from the folder. That's just another one of those attempts to stop lazy people moaning at me, not that it's worked very well - there are still people who think that I should provide rules to build from every extension known to man so they don't have to specify a rule for whatever bizarre extension they decide to dump in the data directory.
<br/>
<br/>
Something that might help a lot in understanding the devkitPro Makefiles is the documentation found here -&gt; <a href="http://make.paulandlesley.org/" target="_blank">http://make.paulandlesley.org/</a> which was a large influence on them.
<br/>
<br/>
The rules given are very useful,  I happen to agree with all of them.
<br/>
<br/>
<a href="http://make.paulandlesley.org/rules.html" target="_blank">http://make.paulandlesley.org/rules.html</a>
<br/>
<br/>
The dependendency generation is based on <a href="http://make.paulandlesley.org/autodep.html" target="_blank">http://make.paulandlesley.org/autodep.html</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#58983 - tepples - Thu Oct 27, 2005 8:49 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">Being honest the best way to deal with data is really to have a separate Makefile for your data subdirectories</td> </tr></table><span class="postbody">
<br/>
I have my doubts about that after having read things like <a class="postlink" href="http://www.canb.auug.org.au/~millerp/rmch/recu-make-cons-harm.html" target="_blank">Recursive Make Considered Harmful</a>.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">One of the reasons that the devkitPro Makefiles have evolved to what you see today is that a *lot* of people are basically too lazy to bother with learning anything about make and want something that will just work for whatever project they're working on.</td> </tr></table><span class="postbody">
<br/>
But when you get to the point where you need a separate makefile, then you're going to have to learn how to write a makefile anyway. And by that time, it becomes easier to rewrite than to work with/against all the automation, especially when none of it is documented anywhere. For example, how would I learn how to designate a .c file as to be compiled in ARM code and placed in IWRAM?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">The .P and .d files are autogenerated and you shouldn't need to do anything with them although enabling gbfs to generate it's own dependency list might be useful.</td> </tr></table><span class="postbody">
<br/>
As well as all the other programs that write multiple files, such as the luminesweeper skin compiler. And I'm not so sure of myself as to how to write rules for simple "cmdname infile.ext outfile.sfx" type things that update the .d files.</span></td> </tr></table><span class="postbody">
<br/>
Unless the tools work with files that *contain* references to other files which should be treated as prerequisites you don't really need to worry about .d files.</span></td> </tr></table><span class="postbody">
<br/>
The luminesweeper skin compiler is exactly such a tool. It takes .Lspec files that look like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">BG=skins/Shinin-bg.bmp
<br/>
PF=skins/Shinin-pf.bmp
<br/>
Music=Shinin.gsm
<br/>
MusicBPM=133.000
<br/>
MusicLoopStart=8
<br/>
MusicLoopLen=2
<br/>
MoveFreq=1761.99
<br/>
RotateFreq=1174.66
<br/>
BlawkFreq=73.41
<br/>
</td> </tr></table><span class="postbody">
<br/>
In this case, skins/Shinin.Lskin depends on skins/Shinin.Lspec (the file listed above), skins/Shinin-bg.bmp, and skins/Shinin-pf.bmp. (Shinin.gsm is part of gsmsongs.gbfs, handled by its list of prerequisites.) Currently I'm using explicit lists of prerequisites for each .Lskin file for debug builds, and using a crude batch version of the separate makefile method for release builds (because my users don't all have GNU Make installed).
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">You're <span style="font-style: italic">supposed</span> to be able to do <span style="font-weight: bold">gbfs file.gbfs ..\data\*</span> but for some reason the globber in the version of MinGW that I use doesn't work as advertised.</td> </tr></table><span class="postbody">
<br/>
<a href="http://www.mingw.org/MinGWiki/index.php/TestForGlobbing?version=1" target="_blank">http://www.mingw.org/MinGWiki/index.php/TestForGlobbing?version=1</a> might help.</span></td> </tr></table><span class="postbody">
<br/>
I'll look at that.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">One other thing I've noticed a couple of times is that on some systems using * as a wildcard doesn't return files with extensions.</td> </tr></table><span class="postbody">
<br/>
Windows 2000 is not one of them.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Just name the target directly instead of using the default command that names the target from the folder. That's just another one of those attempts to stop lazy people moaning at me</td> </tr></table><span class="postbody">
<br/>
start &gt; programs &gt; devkitPro &gt; documentation &gt; (Empty)
<br/>
<br/>
Document, document, document, please. I tend to use what I can understand, and if I can't understand what is made available to me, I tend to write my own based on what I do understand.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Something that might help a lot in understanding the devkitPro Makefiles is the documentation found here -&gt; <a href="http://make.paulandlesley.org/" target="_blank">http://make.paulandlesley.org/</a> which was a large influence on them.</td> </tr></table><span class="postbody">
<br/>
I could read that, but it would have been nice if that were documented.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
