<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Displaying map using DMA - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > Displaying map using DMA</h2>
<div id="posts">
<div class="post">
    <h4>#9729 - jenswa - Fri Aug 15, 2003 2:21 pm</h4>
    <div class="postbody"><span class="postbody">I am using this code to load a map into a text background, but does not seem to work.
<br/>
The probem has something to do with the declarations of the variables.
<br/>
<br/>
<br/>
	REG_DM3SAD = (u8) l1; 
<br/>
	REG_DM3DAD = (u8) ScreenMem0; 
<br/>
	REG_DM3CNT = (32*32) | DMA_32NOW;
<br/>
<br/>
	DMA_32NOW      (DMA_ENABLE | DMA_TIMING_IMMEDIATE | DMA_32) 
<br/>
	DMA_ENABLE					0x80000000
<br/>
	DMA_TIMING_IMMEDIATE				0x00000000
<br/>
	DMA_32						0x04000000
<br/>
	const u8 l1[ 32 * 32 ] = {contains list of number}
<br/>
	u16* ScreenMem0 = (u16*)0x6000000;
<br/>
<br/>
The problem has something to do with u8, chaning u8 in u32 or u16 doesn't work for me.
<br/>
<br/>
Any suggestions?
<br/>
<br/>
Thanx
<br/>
Jenswa<br/>_________________<br/>It seems this wasn't lost after all.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9732 - antysix - Fri Aug 15, 2003 2:40 pm</h4>
    <div class="postbody"><span class="postbody">The map entry for text backgrounds is sixteen bit: (from the CowBite docs)
<br/>
<br/>
F E D C  B A 9 8  7 6 5 4  3 2 1 0 
<br/>
L L L L  V H T T  T T T T  T T T T 
<br/>
0-9 (T) = The tile number 
<br/>
A   (H) = If this bit is set, the tile is flipped horizontally left to right. 
<br/>
B   (V) = If this bit is set, the tile is flipped vertically upside down. 
<br/>
C-F (L) = Palette number 
<br/>
<br/>
<br/>
But you say converting your u8 array to u16 doesn't work for you, so I actually don't know what you're doing wrong.<br/>_________________<br/>Currently playing: NGC: Metroid Prime
<br/>
GBA: Golden Sun: The Lost Age
<br/>
<br/>
Currently developping: Project ~ [ Phail ]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9734 - niltsair - Fri Aug 15, 2003 3:29 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>jenswa wrote:</b></span></td> </tr> <tr> <td class="quote"> REG_DM3SAD = (u8) l1; 
<br/>
REG_DM3DAD = (u8) ScreenMem0; 
<br/>
REG_DM3CNT = (32*32) | DMA_32NOW;</td> </tr></table><span class="postbody">
<br/>
Dma take the source and destination address, and not the real value directly. This, by chunk of 16 or 32bits. You could try this instead :
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">u32 ToTransfer;
<br/>
ToTransfer = 0x0101; //(will result in a square of vertical lines of color 0 and transparent, given in 256colors palette mode)
<br/>
<br/>
REG_DM3SAD = (u32) &amp;ToTransfer; 
<br/>
REG_DM3DAD = (u32) &amp;ScreenMem0; 
<br/>
REG_DM3CNT = (32*32)/4 | DMA_32NOW; //I'm assuming you want to transfer a 32x32 block. since it's a 32bits transfer, 4pixels get copied at a time, thus the '/4'</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9739 - jenswa - Fri Aug 15, 2003 5:27 pm</h4>
    <div class="postbody"><span class="postbody">Yeah i'll try that with the division by four.<br/>_________________<br/>It seems this wasn't lost after all.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9744 - jenswa - Fri Aug 15, 2003 10:00 pm</h4>
    <div class="postbody"><span class="postbody">fixed the problem,
<br/>
<br/>
code should be 32x32/2 instead of 32x32, even better is a fixed value (no division or muliplying, saves speed :P) 512
<br/>
and the main problem was with const u8 for the map, the map editor i uses does this automatically,
<br/>
so i assumed this was ok, well it's NOT, it should be cons u16, then it all works.
<br/>
<br/>
Thanks for your help.
<br/>
<br/>
Jenswa<br/>_________________<br/>It seems this wasn't lost after all.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9747 - niltsair - Fri Aug 15, 2003 10:33 pm</h4>
    <div class="postbody"><span class="postbody">Small not, "32x32/2" take the same time as "512" because your compiler actually convert it that way itself. No slow down in your gba program.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9757 - antysix - Sat Aug 16, 2003 11:20 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">and the main problem was with const u8 for the map, the map editor i uses does this automatically, 
<br/>
so i assumed this was ok, well it's NOT, it should be cons u16, then it all works. 
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
The map entry for rotational backgrounds IS 8 bit, so the map editor you use is only suitable for rotational backgrounds.<br/>_________________<br/>Currently playing: NGC: Metroid Prime
<br/>
GBA: Golden Sun: The Lost Age
<br/>
<br/>
Currently developping: Project ~ [ Phail ]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9765 - jenswa - Sat Aug 16, 2003 7:48 pm</h4>
    <div class="postbody"><span class="postbody">Yeah well,
<br/>
<br/>
i am glad i figured that out,
<br/>
but ehmm is there any difference between the drawing of a
<br/>
rotational background and a text background?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">"32x32/2" take the same time as "512" </td> </tr></table><span class="postbody">
<br/>
I should have read the article better.<br/>_________________<br/>It seems this wasn't lost after all.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
