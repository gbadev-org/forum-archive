<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>The Kirby Revolution - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Coding > The Kirby Revolution</h2>
<div id="posts">
<div class="post">
    <h4>#102563 - Kirby - Fri Sep 15, 2006 8:32 am</h4>
    <div class="postbody"><span class="postbody">Hi! I'm Kirby! I am making a new platformer game called The Kirby Revolution. I am just making the engine for it right now, and I have to say, it's pretty good. If anybody could tell me how to upload a demo here, I would.
<br/>
<br/>
But the one problem I am having is creating enemies. I want to be able to create a base enemy with the code to randomly walk around and jump (a big problem), and scroll properly (another big problem).
<br/>
<br/>
I'm currently using <span style="font-weight: bold">thegamefreak0134</span>'s state code to put together the character (don't worry, I <span style="text-decoration: underline">did</span> put all of your copyright stuff in), but it's not really working that great. 
<br/>
<br/>
If anybody knows how to add characters in the game in a EASY way, please tell me. (I'll add your name to the credits list!)<br/>_________________<br/>Knock-knock.
<br/>
Whose there?
<br/>
Kirby.
<br/>
Kirby-who?
<br/>
I told you! Kirby!</span><span class="gensmall"><br/><br/>Last edited by Kirby on Thu Sep 28, 2006 6:26 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#102585 - Kirby - Fri Sep 15, 2006 1:39 pm</h4>
    <div class="postbody"><span class="postbody">The error with the character thing is that I have a base character. You asign CharaData to it. See <span style="font-weight: bold">thegamefreak0134</span>'s State code. Download it at <a class="postlink" href="http://thegamefreak0134.googlepages.com/SmashBrosAdvance.zip" target="_blank">http://thegamefreak0134.googlepages.com/SmashBrosAdvance.zip</a>.
<br/>
<br/>
These are the errors:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">1&gt;main.c: In function `stateUpdate':
<br/>
1&gt;main.c(1063):subscripted value is neither array nor pointer
<br/>
1&gt;main.c(1068):subscripted value is neither array nor pointer
<br/>
1&gt;main.c(1069):subscripted value is neither array nor pointer
<br/>
1&gt;main.c(1075):subscripted value is neither array nor pointer
<br/>
1&gt;main.c(1076):subscripted value is neither array nor pointer
<br/>
1&gt;main.c(1078):subscripted value is neither array nor pointer
<br/>
1&gt;main.c(1079):subscripted value is neither array nor pointer
<br/>
1&gt;main.c(1081):subscripted value is neither array nor pointer
<br/>
1&gt;main.c(1082):subscripted value is neither array nor pointer
<br/>
1&gt;main.c(1084):subscripted value is neither array nor pointer
<br/>
1&gt;main.c(1085):subscripted value is neither array nor pointer
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Once again, when someone tells me how to upload a demo to the site, I will post a link to it, then somebody can download it and check my source code. Thanx!<br/>_________________<br/>Knock-knock.
<br/>
Whose there?
<br/>
Kirby.
<br/>
Kirby-who?
<br/>
I told you! Kirby!</span><span class="gensmall"><br/><br/>Last edited by Kirby on Sat Sep 16, 2006 12:20 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#102596 - sgeos - Fri Sep 15, 2006 3:10 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Kirby wrote:</b></span></td> </tr> <tr> <td class="quote">I don't really know whether or not this should go into Beginners or Coding</td> </tr></table><span class="postbody">
<br/>
They blur.  Do you think you are a beginner, or do you feel you can work out "simple" problems on your own?  This is a language syntax problem.  I think that you should probably be posting in beginners.
<br/>
<br/>
At any rate, you should be able to solve you own problem.  Read the error messages.  Figure out what they mean, and then fix the problems.  Here is how:
<br/>
"subscripted value is neither array nor pointer"
<br/>
<br/>
Do you know what a subscripted value is?
<br/>
Do you know what an array is?
<br/>
Do you know what a pointer is?
<br/>
Do you know how/why/when pointers and arrays can be interchanged?
<br/>
Do you know how/when to properly subscript pointers and arrays?
<br/>
<br/>
Go to lines 1063, 1068, etc.  You are dereferencing something the wrong way... 11 times (11 errors).  This is probably the same (human) logic error 11 times over, so if you figure out how to properly subscript your value (or whatever you really want to be do) once, then you can fix this problem everywhere.
<br/>
<br/>
If you want help, post line 1063.  Above it, post the declaration of every variable that appears in in line 1063.  Also mention what you have tried to do to fix the problem, and what you don't understand.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102601 - Kirby - Fri Sep 15, 2006 3:33 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sgeos wrote:</b></span></td> </tr> <tr> <td class="quote">If you want help, post line 1063.  Above it, post the declaration of every variable that appears in in line 1063.  Also mention what you have tried to do to fix the problem, and what you don't understand.</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code"> for (i=0;i&lt;NumCharas;i++) {
<br/>
      Characters[i].laststate = Characters[i].state;
<br/>
      Characters[i].frame = Characters[i].CharaFrames[Characters[i].CharaStateFrames[Characters[i].state] + Characters[i].stateframe]; //This is line 1063
<br/>
      CPUPlayerPhysics(i);
<br/>
      CPUCollideCheck(i,Characters[i].AI);
<br/>
      Characters[i].stateframe = Characters[i].stateframe + 1;
<br/>
      CPURunFunc(i,Characters[i].state,Characters[i].AI);
<br/>
      if (Characters[i].stateframe == Characters[i].CharaStateLength[Characters[i].state]) {
<br/>
         Characters[i].state = Characters[i].CharaStateJumps[Characters[i].state];
<br/>
         Characters[i].stateframe = 0;
<br/>
      }
<br/>
      if (Characters[i].state != Characters[i].laststate)
<br/>
      {
<br/>
         //Update Physics
<br/>
         if (Characters[i].CharaXspeedEnabled[Characters[i].state] == 1) {
<br/>
            Characters[i].xspeed = Characters[i].CharaXspeed[Characters[i].state];
<br/>
         }
<br/>
         if (Characters[i].CharaYspeedEnabled[Characters[i].state] == 1) {
<br/>
            Characters[i].yspeed = Characters[i].CharaYspeed[Characters[i].state];
<br/>
         }
<br/>
         if (Characters[i].CharaXaccelEnabled[Characters[i].state] == 1) {
<br/>
            Characters[i].xaccel = Characters[i].CharaXaccel[Characters[i].state];
<br/>
         }
<br/>
         if (Characters[i].CharaYaccelEnabled[Characters[i].state] == 1) {
<br/>
            Characters[i].yaccel = Characters[i].CharaYaccel[Characters[i].state];
<br/>
         }
<br/>
      }
<br/>
   }
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Characters is an array of character:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define AI_DUMB 0
<br/>
#define AI_BUMP 1
<br/>
#define AI_FOLLOW 2
<br/>
#define AI_AVOID 3
<br/>
#define AI_BOSS 4
<br/>
#define AI_RACE 5
<br/>
<br/>
typedef struct Character
<br/>
{
<br/>
   s32 x;
<br/>
   s32 y;
<br/>
   s32 drawX;
<br/>
   s32 drawY;
<br/>
   u8 state; //Doubt seriously we'll need bigger numbers here than
<br/>
   u8 laststate;
<br/>
   u8 stateframe;
<br/>
   u8 frame; // like, 50 maybe. Course, you never know...
<br/>
   u16 xblock;
<br/>
   u16 yblock;
<br/>
   u8 xblockpos;
<br/>
   u8 yblockpos;
<br/>
   s8 xspeed;
<br/>
   s8 yspeed;
<br/>
   s8 xaccel;
<br/>
   s8 yaccel;
<br/>
   u8 land;
<br/>
   u8 bounce;
<br/>
   u8 CharaData;
<br/>
   u32 CharaFrames;
<br/>
   u32 CharaStateFrames;
<br/>
   u32 CharaStateLength;
<br/>
   u32 CharaStateJumps;
<br/>
   u32 CharaXspeed;
<br/>
   u32 CharaXspeedEnabled;
<br/>
   u32 CharaYspeed;
<br/>
   u32 CharaYspeedEnabled;
<br/>
   u32 CharaXaccel;
<br/>
   u32 CharaXaccelEnabled;
<br/>
   u32 CharaYaccel;
<br/>
   u32 CharaYaccelEnabled;
<br/>
   u8 visible;
<br/>
   u32 memLoc;
<br/>
   u8 teleCheck;
<br/>
   u8 HP;
<br/>
   u8 power;
<br/>
   u16 map;
<br/>
   u16 OAMnum;
<br/>
   u16 attr2;
<br/>
   u16 Anims;
<br/>
   u16 AI;
<br/>
   u8 *charaAnim;
<br/>
}Character;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
i is a number. (This is being done in a for loop, so that editing is done to all of the characters)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">u32 waddledeeFrames[] = { 6 , 6 , 6 , 7 , 7 , 5 , 5 , 4 , 4, 2, 2 , 2, 3, 3, 1, 1, 0, 0, 11, 11, 11, 11, 11, 10, 10, 10, 10, 10, 9, 9, 9, 9, 9, 8, 8, 8 ,8 ,8};
<br/>
u32 waddledeeStateFrames[] = { 0 , 1 , 8 , 9, 17, 21, 25, 29};
<br/>
u32 waddledeeStateLength[] = { 1 , 8 , 1 , 8,  5,  5,  5,  5};
<br/>
u32 waddledeeStateJumps[] = { 0 , 1 , 2 , 3 , 5 , 5 , 7 , 7 };
<br/>
u32 waddledeeXspeed[] = {0,4,0,-4,0,0,0,0};
<br/>
u32 waddledeeXspeedEnabled[] = { 1 , 1 , 1 , 1 , 0 , 0 , 0 , 0 };
<br/>
u32 waddledeeYspeed[] = {4,4,4,4,-16,0,-16,0};
<br/>
u32 waddledeeYspeedEnabled[] = { 1 , 1 , 1 , 1 , 1 , 0 , 1 , 0 };
<br/>
u32 waddledeeXaccel[] = {0,0,0,0,0,0,0,0};
<br/>
u32 waddledeeXaccelEnabled[] = { 1 , 1 , 1 , 1 , 0 , 0 , 0 , 0 };
<br/>
u32 waddledeeYaccel[] = {0,0,0,0,0,1,0,1};
<br/>
u32 waddledeeYaccelEnabled[] = { 1 , 1 , 1 , 1 , 1 , 1 , 0 , 1 };</td> </tr></table><span class="postbody">
<br/>
<br/>
This is the character init code.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void InitCharas() {
<br/>
   InitWaddleDee();
<br/>
<br/>
   //Near Kirby's House
<br/>
   SetUpChara(0,WaddleDee,50 * 32,48 * 32,3,0x06010800,3,64,AI_BUMP);
<br/>
}
<br/>
<br/>
void SetUpChara(u16 edit, Character base, u16 xa, u16 ya, u16 mapa, u16 memLoca, u16 OAMnuma, u16 attr2a, u16 AImode) {
<br/>
   Characters[edit].attr2 = attr2a;
<br/>
   Characters[edit].bounce = base.bounce;
<br/>
   u16 i;
<br/>
   /*for (i=0;i&lt;base.Anims;i++) {
<br/>
      Characters[edit].charaAnim[i] = base.charaAnim[i];
<br/>
   }*/
<br/>
   Characters[edit].charaAnim = base.charaAnim;
<br/>
   Characters[edit].CharaData = base.CharaData;
<br/>
   Characters[edit].CharaFrames = base.CharaFrames;
<br/>
   Characters[edit].CharaStateFrames = base.CharaStateFrames;
<br/>
   Characters[edit].CharaStateJumps = base.CharaStateJumps;
<br/>
   Characters[edit].CharaStateLength = base.CharaStateLength;
<br/>
   Characters[edit].CharaXaccel = base.CharaXaccel;
<br/>
   Characters[edit].CharaXaccelEnabled = base.CharaXaccelEnabled;
<br/>
   Characters[edit].CharaXspeed = base.CharaXspeed;
<br/>
   Characters[edit].CharaXspeedEnabled = base.CharaXspeedEnabled;
<br/>
   Characters[edit].CharaYaccel = base.CharaYaccel;
<br/>
   Characters[edit].CharaYaccelEnabled = base.CharaYaccelEnabled;
<br/>
   Characters[edit].HP = base.HP;
<br/>
   Characters[edit].map = mapa;
<br/>
   Characters[edit].memLoc = memLoca;
<br/>
   Characters[edit].OAMnum = OAMnuma;
<br/>
   Characters[edit].x = xa;
<br/>
   Characters[edit].y = ya;
<br/>
   Characters[edit].AI = AImode;
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
I don't see what is wrong with using an array as a subscript. I've tried adding &amp; or (Character *) in front of Characters[i].????. I've also tried creating local variables with Characters[i].????[?] in it. If there is an easier way of doing this, then please tell me.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sgeos wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Kirby wrote:</b></span></td> </tr> <tr> <td class="quote">I don't know if this belongs in Beginners or Coding</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
<br/>
This is my first platforming game, but I thought it was more advanced to be doing an AI animated character!<br/>_________________<br/>Knock-knock.
<br/>
Whose there?
<br/>
Kirby.
<br/>
Kirby-who?
<br/>
I told you! Kirby!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102604 - Kirby - Fri Sep 15, 2006 3:54 pm</h4>
    <div class="postbody"><span class="postbody">Just to note...
<br/>
<br/>
This thread is for my Kirby game, not the "syntax error". I just added it here because it was convienent. The Kirby game is Coding. The "syntax error" could be Beginner...
<br/>
<br/>
EDIT: Sorry about the double-posting...<br/>_________________<br/>Knock-knock.
<br/>
Whose there?
<br/>
Kirby.
<br/>
Kirby-who?
<br/>
I told you! Kirby!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102614 - poslundc - Fri Sep 15, 2006 5:04 pm</h4>
    <div class="postbody"><span class="postbody">You use the array operator [] on CharaFrames and CharaStateFrames.
<br/>
<br/>
Now look at your definition of a Character struct. Is the data type of CharaFrames or CharaStateFrames an array data type?
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102615 - poslundc - Fri Sep 15, 2006 5:07 pm</h4>
    <div class="postbody"><span class="postbody">And while there are other things in your code that are going to prove difficult down the road, I will point out to you now that unless you put a <span style="font-weight: bold">const</span> qualifier in front of each of those array declarations, they will go into fast RAM (which you only have 32K of) and you will quickly run out of it.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102641 - Kirby - Fri Sep 15, 2006 9:10 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">You use the array operator [] on CharaFrames and CharaStateFrames.
<br/>
<br/>
Now look at your definition of a Character struct. Is the data type of CharaFrames or CharaStateFrames an array data type?
<br/>
<br/>
Dan.</td> </tr></table><span class="postbody">
<br/>
<br/>
That's all very well, except that when I do that, I get about eleven errors saying "Flexible array not at end of structure".
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">And while there are other things in your code that are going to prove difficult down the road, I will point out to you now that unless you put a const qualifier in front of each of those array declarations, they will go into fast RAM (which you only have 32K of) and you will quickly run out of it. 
<br/>
<br/>
Dan.</td> </tr></table><span class="postbody">
<br/>
<br/>
Remember, this is to be a base characacter so that it has to be assigned a maximum, and any value at all.<br/>_________________<br/>Knock-knock.
<br/>
Whose there?
<br/>
Kirby.
<br/>
Kirby-who?
<br/>
I told you! Kirby!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102650 - tepples - Fri Sep 15, 2006 11:00 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Kirby wrote:</b></span></td> </tr> <tr> <td class="quote">That's all very well, except that when I do that, I get about eleven errors saying "Flexible array not at end of structure".</td> </tr></table><span class="postbody">
<br/>
"Flexible array" means one declared [] or [0]. You need a positive number of elements in an array that is a struct member, or you need to use a pointer.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102669 - Kirby - Fri Sep 15, 2006 11:47 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">"Flexible array" means one declared [] or [0]. You need a positive number of elements in an array that is a struct member, or you need to use a pointer.</td> </tr></table><span class="postbody">
<br/>
The reason I'm using "Flexible arrays" is because </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Kirby wrote:</b></span></td> </tr> <tr> <td class="quote">Remember, this is to be a base characacter so that it has to be assigned a maximum, and any value at all.</td> </tr></table><span class="postbody">
<br/>
That means that each item is an array with a number of items that depends on the character!
<br/>
But the pointer thing sounds like a good idea... I might try that... And anyway, I seem to be doing that with charaAnim. Thanx. I'll tell you if it works.<br/>_________________<br/>Knock-knock.
<br/>
Whose there?
<br/>
Kirby.
<br/>
Kirby-who?
<br/>
I told you! Kirby!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102692 - Kirby - Sat Sep 16, 2006 6:40 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Kirby wrote:</b></span></td> </tr> <tr> <td class="quote">That means that each item is an array with a number of items that depends on the character! 
<br/>
But the pointer thing sounds like a good idea... I might try that... And anyway, I seem to be doing that with charaAnim. Thanx. I'll tell you if it works.</td> </tr></table><span class="postbody">
<br/>
Guess what. It works! Tada! But... not entirly.
<br/>
<ul> First of all, the pointer things works!
<br/>
But there are still some errors such as:
<br/>
Waddle Dee loops through his animation faster than light. (This'd work better if I had access to a PROPER State Editor, but now I'm going to make my own)
<br/>
Waddle Dee floats at the top of the screen when he's supposed to be offscreen. But I know the solution to this problem.
<br/>
The base character currently only supports typing out each memcpy for every character to be copied to memory. I have to intergrate support for looping through EVERY character and copying them.</ul>
<br/>
Thank you for everybody who made this possible. But first, a few requests:
<br/>
<br/>
<ul>Does anybody know of a GOOD bmp2gba program? I've tried Img2Gba and Bmp2Spr which both return null data, and I've written my own, which worked once, but then made the second picture look a little off. This is the code for the program, which I call Bmp2Hex: (it's in BASIC)</ul></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">Module Module1
<br/>
<br/>
    Sub Main()
<br/>
        Dim tilesMode As Boolean
<br/>
        Console.WriteLine("Bmp2Hex (c) 2006 by Kirby")
<br/>
        Console.WriteLine("Transforms a bitmap file in a C file ready for programming use")
<br/>
        Console.WriteLine()
<br/>
        Try
<br/>
            Select Case My.Application.CommandLineArgs(0)
<br/>
                Case ""
<br/>
                    ShowHelp()
<br/>
                Case "-?"
<br/>
                    ShowHelp()
<br/>
                Case "-p"
<br/>
                    If My.Application.CommandLineArgs.Count - 1 = 0 Then
<br/>
                        ShowPrefHelp()
<br/>
                    Else
<br/>
                        Select Case My.Application.CommandLineArgs(1)
<br/>
                            Case "-i"
<br/>
                                If My.Application.CommandLineArgs.Count - 1 = 2 Then
<br/>
                                    My.Settings.Input = My.Application.CommandLineArgs(2)
<br/>
                                    End
<br/>
                                Else
<br/>
                                    IncorrectParas()
<br/>
                                End If
<br/>
                            Case "-o"
<br/>
                                If My.Application.CommandLineArgs.Count - 1 = 2 Then
<br/>
                                    My.Settings.Output = My.Application.CommandLineArgs(2)
<br/>
                                    End
<br/>
                                Else
<br/>
                                    IncorrectParas()
<br/>
                                End If
<br/>
                        End Select
<br/>
                    End If
<br/>
                Case Else
<br/>
                    If My.Application.CommandLineArgs.Count - 1 = 2 Then
<br/>
                        If My.Application.CommandLineArgs(2).Trim = "-t" Then
<br/>
                            tilesMode = True
<br/>
                        End If
<br/>
                    End If
<br/>
                    Select Case My.Application.CommandLineArgs.Count - 1
<br/>
                        Case Is &gt;= 1
<br/>
                            Transform(My.Application.CommandLineArgs(0), My.Application.CommandLineArgs(1), tilesMode)
<br/>
                        Case 0
<br/>
                            Transform(My.Application.CommandLineArgs(0), My.Settings.Output, tilesMode)
<br/>
                    End Select
<br/>
                    IncorrectParas()
<br/>
            End Select
<br/>
        Catch
<br/>
            ShowHelp()
<br/>
        End Try
<br/>
    End Sub
<br/>
<br/>
    Public Sub ShowHelp()
<br/>
        Console.WriteLine("Arguments:")
<br/>
        Console.WriteLine("[Input] [Output] -- Creates a .h file from INPUT and saves at OUTPUT")
<br/>
        Console.WriteLine("[Input] -- Creates a .h file from INPUT and saves it in the folder specified by -p")
<br/>
        Console.WriteLine("[Input] [Output] -t -- Compile as a tileset")
<br/>
        Console.WriteLine("-? -- Shows this screen")
<br/>
        Console.WriteLine("-p -- Shows preference help")
<br/>
        End
<br/>
    End Sub
<br/>
<br/>
    Public Sub ShowPrefHelp()
<br/>
        Console.WriteLine("-p [Switches]:")
<br/>
        Console.WriteLine("-i -- Changes the default input folder. Used when no input folder is specified, and the file isn't in the current directory")
<br/>
        Console.WriteLine("-o -- Changes the default output folder. Used when no output folder is specified")
<br/>
        End
<br/>
    End Sub
<br/>
<br/>
    Public Sub IncorrectParas()
<br/>
        Console.WriteLine("Incorrect paramanters")
<br/>
        End
<br/>
    End Sub
<br/>
<br/>
    Public Sub Transform(ByVal input As String, ByVal output As String, ByVal doTiles As Boolean)
<br/>
        If IO.File.Exists(input) = False Then
<br/>
            If IO.File.Exists(".\" &amp; input) = False Then
<br/>
                If IO.File.Exists(My.Settings.Input &amp; input) = False Then
<br/>
                    IncorrectParas()
<br/>
                Else
<br/>
                    input = My.Settings.Input &amp; input
<br/>
                End If
<br/>
            Else
<br/>
                input = ".\" &amp; input
<br/>
            End If
<br/>
        End If
<br/>
        If output.EndsWith("\") Then
<br/>
            output &amp;= input.Remove(0, input.LastIndexOf("\") + 1)
<br/>
        End If
<br/>
        If output.EndsWith(".bmp") Then
<br/>
            output.Replace(".bmp", ".h")
<br/>
        ElseIf Not output.EndsWith(".h") Then
<br/>
            output &amp;= ".h"
<br/>
        End If
<br/>
        Dim result As String
<br/>
        Dim temp As New Bitmap(input)
<br/>
        Dim height As Integer = temp.Height
<br/>
        Dim width As Integer = temp.Width
<br/>
        Dim sprdata(height * width) As Byte
<br/>
        Dim numcolors As Integer = 1
<br/>
        Dim colors(255) As Long
<br/>
        Dim b, c As Integer
<br/>
        Dim x, y As Integer
<br/>
        Dim g As Color
<br/>
        Dim tSq As Integer = 8
<br/>
        Dim tMX, tMY, tX, tY As Integer
<br/>
        If doTiles = False Then tSq = 1
<br/>
        tMX = (width / tSq)
<br/>
        tMY = (height / tSq)
<br/>
        colors(0) = ColorTranslator.ToOle(temp.GetPixel(x, y))
<br/>
        'For y = 0 To tSq - 1
<br/>
        'For x = 0 To tSq - 1
<br/>
        'b = ColorTranslator.ToOle(temp.GetPixel(x, y))
<br/>
        'g = ColorTranslator.FromOle(b)
<br/>
        'For c = 0 To numcolors
<br/>
        'If colors(c) = b Then GoTo inst
<br/>
        'Next
<br/>
        'colors(numcolors) = b
<br/>
        'c = numcolors
<br/>
        'numcolors += 1
<br/>
        'inst:           sprdata(x + (y * width)) = c
<br/>
        'Next
<br/>
        'Next
<br/>
        For tY = 0 To tMY - 1
<br/>
            For tX = 0 To tMX - 1
<br/>
                For y = (tY * tSq) To ((tY * tSq) + tSq) - 1
<br/>
                    For x = (tX * tSq) To ((tX * tSq) + tSq) - 1
<br/>
                        b = ColorTranslator.ToOle(temp.GetPixel(x, y))
<br/>
                        g = ColorTranslator.FromOle(b)
<br/>
                        For c = 0 To numcolors
<br/>
                            If colors(c) = b Then GoTo ins
<br/>
                        Next
<br/>
                        colors(numcolors) = b
<br/>
                        c = numcolors
<br/>
                        numcolors += 1
<br/>
ins:                    sprdata(x + (y * width)) = c
<br/>
                    Next
<br/>
                Next
<br/>
            Next
<br/>
        Next
<br/>
        Dim fn As String
<br/>
        If input.Contains("\") Then
<br/>
            fn = input.Remove(0, input.LastIndexOf("\") + 1).Replace(".bmp", "")
<br/>
        Else
<br/>
            fn = input.Replace(".bmp", "")
<br/>
        End If
<br/>
        result = "//Output from Bmp2Hex for Kirby Platformer Advanced Project" &amp; _
<br/>
        vbCrLf &amp; _
<br/>
        vbCrLf &amp; "#define " &amp; fn &amp; "_WIDTH " &amp; width &amp; _
<br/>
        vbCrLf &amp; "#define " &amp; fn &amp; "_HEIGHT " &amp; height &amp; _
<br/>
        vbCrLf &amp; _
<br/>
        vbCrLf &amp; "const u16 " &amp; fn &amp; "Data[" &amp; width * height &amp; "] = {"
<br/>
        For tY = 0 To tMY - 1
<br/>
            For tX = 0 To tMX - 1
<br/>
                For y = (tY * tSq) To ((tY * tSq) + tSq) - 1
<br/>
                    result &amp;= vbCrLf
<br/>
                    For x = (tX * tSq) To ((tX * tSq) + tSq) - 1 Step 2
<br/>
                        result &amp;= "0x" &amp; IIf(Len(Hex(sprdata(x + (y * width)))) = 1, "0", "") &amp; Hex(sprdata(x + (y * width))) &amp; IIf(Len(Hex(sprdata(x + (y * width) + 1))) = 1, "0", "") &amp; Hex(sprdata(x + (y * width) + 1)) &amp; ", "
<br/>
                    Next
<br/>
                Next
<br/>
                result &amp;= vbCrLf
<br/>
            Next
<br/>
        Next
<br/>
        result = result.Remove(result.LastIndexOf(", "), 2) &amp; _
<br/>
        vbCrLf &amp; "};" &amp; _
<br/>
        vbCrLf &amp; _
<br/>
        vbCrLf &amp; "const u16 " &amp; fn &amp; "Palette[256] = {" &amp; _
<br/>
        vbCrLf
<br/>
        For c = 0 To numcolors - 1
<br/>
            result &amp;= "0x" &amp; Hex(pc2gba(colors(c))) &amp; ", "
<br/>
        Next
<br/>
        For c = numcolors To 255
<br/>
            result &amp;= "0x0" &amp; ", "
<br/>
        Next
<br/>
        result = result.Remove(result.LastIndexOf(", "), 2) &amp; _
<br/>
        vbCrLf &amp; "};" &amp; _
<br/>
        vbCrLf
<br/>
        FileOpen(1, output, OpenMode.Output)
<br/>
        WriteLine(1, result.ToCharArray)
<br/>
        FileClose(1)
<br/>
        Console.WriteLine("File transform complete")
<br/>
        End
<br/>
    End Sub
<br/>
<br/>
    Public Function pc2gba(ByRef color As Long) As Integer
<br/>
        Dim g, r, b As Long
<br/>
        r = color Mod 256
<br/>
        g = (color \ 256) Mod 256
<br/>
        b = (color \ 65536) Mod 256
<br/>
        pc2gba = r \ 8 + (g \ 8) * 32 + (b \ 8) * 32 * 32
<br/>
    End Function
<br/>
<br/>
End Module
<br/>
</td> </tr></table><span class="postbody"> As I said before, I used this program to translate a tileset to hex, and it worked, but the second tileset I tried had the 3'rd and 4'th pixels switched, and 5'th and 6'th pixels switched on every row. Does anybody know why?
<br/>
Second, does anybody know where to get good Kirby tilesets? I'm currently drawing mine, and they look... quite frankly horrible.
<br/>
<br/>_________________<br/>Knock-knock.
<br/>
Whose there?
<br/>
Kirby.
<br/>
Kirby-who?
<br/>
I told you! Kirby!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102713 - sgeos - Sat Sep 16, 2006 11:07 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Kirby wrote:</b></span></td> </tr> <tr> <td class="quote">Does anybody know of a GOOD bmp2gba program?</td> </tr></table><span class="postbody">
<br/>
This question really belongs in another thread.  Probably under "graphics".
<br/>
<br/>
I think the gimp can export to C code.  The gd library is fantastic for graphics manipulation, if you want to write your own tool.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102718 - Kirby - Sat Sep 16, 2006 11:52 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sgeos wrote:</b></span></td> </tr> <tr> <td class="quote">This question really belongs in another thread. Probably under "graphics".</td> </tr></table><span class="postbody">
<br/>
Where should this topic actually be? I want it to be an overall topic of the coding, design, gfx, sfx, and... everything else about The Kirby Revolution, sort of like <span style="font-weight: bold">thegamefreak0134</span>'s Smash Bros Advanced topic.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sgeos wrote:</b></span></td> </tr> <tr> <td class="quote">I think the gimp can export to C code. The gd library is fantastic for graphics manipulation, if you want to write your own tool.</td> </tr></table><span class="postbody">
<br/>
What type of library is this we're talking about? I'm using Visual Studio 2005 Express BASIC to write the conversion program. I think I can use .OCX and .DLL.<br/>_________________<br/>Knock-knock.
<br/>
Whose there?
<br/>
Kirby.
<br/>
Kirby-who?
<br/>
I told you! Kirby!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102721 - Kirby - Sat Sep 16, 2006 12:19 pm</h4>
    <div class="postbody"><span class="postbody">This time I'm doing the right thing and posting stuff in the right place. I have made a new topic about an E-Reader-releated minigame I want to put in my game. You can access it <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?p=102720#102720" target="_blank">here</a>.<br/>_________________<br/>Knock-knock.
<br/>
Whose there?
<br/>
Kirby.
<br/>
Kirby-who?
<br/>
I told you! Kirby!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102811 - Kirby - Sun Sep 17, 2006 4:58 am</h4>
    <div class="postbody"><span class="postbody">OK, I have a problem (like always)...
<br/>
<br/>
So, as I said before, I'm trying to make a BASE character that works for all characters. So I wrote a little function that (is supposed to) update(s) the character's picture:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void frameUpdate() {
<br/>
   u16 i;
<br/>
   for (i=0;i&lt;NumCharas;i++) {
<br/>
      if (Characters[i].map == curmap) {
<br/>
         memcpy( (u16 *)Characters[i].memLoc, &amp;Characters[i].charaAnim[Characters[i].frame], 256 );
<br/>
      }
<br/>
   }
<br/>
}</td> </tr></table><span class="postbody">
<br/>
But, currently, it's not working, so I wrote a little thing to take it's place while I'm testing with Waddle Dee:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void frameUpdate() {
<br/>
   memcpy( (u16 *)0x6010800, waddledeeAnim[Characters[0].frame], 256);
<br/>
}</td> </tr></table><span class="postbody">
<br/>
I don't see why it doesn't work. I have posted the definition of Character above. I've changed Characters.h and waddledeeStates.h:
<br/>
<br/>
<span style="font-weight: bold">Characters.h</span></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include "gba.h"
<br/>
#include "Characters\Kirby.h"
<br/>
#include "Characters\WaddleDee.h"
<br/>
#include "Characters\blankSprite.h"
<br/>
#include "Characters\AI_Bump.h"
<br/>
<br/>
#define NumCharas 1
<br/>
<br/>
void InitCharas() {
<br/>
   InitWaddleDee();
<br/>
<br/>
   //Near Kirby's House
<br/>
   SetUpChara(0,WaddleDee,48*32,46*32,3,0x06010800,3,64,AI_BUMP);
<br/>
}
<br/>
<br/>
void SetUpChara(u16 edit, Character base, u16 xa, u16 ya, u16 mapa, u16 memLoca, u16 OAMnuma, u16 attr2a, u16 AImode) {
<br/>
   Characters[edit].attr2 = attr2a;
<br/>
   Characters[edit].bounce = base.bounce;
<br/>
   u16 i;
<br/>
   /*for (i=0;i&lt;base.Anims;i++) {
<br/>
      Characters[edit].charaAnim[i] = base.charaAnim[i];
<br/>
   }*/
<br/>
   Characters[edit].charaAnim = base.charaAnim;
<br/>
   Characters[edit].CharaData = base.CharaData;
<br/>
   Characters[edit].CharaFrames = base.CharaFrames;
<br/>
   Characters[edit].CharaStateFrames = base.CharaStateFrames;
<br/>
   Characters[edit].CharaStateJumps = base.CharaStateJumps;
<br/>
   Characters[edit].CharaStateLength = base.CharaStateLength;
<br/>
   Characters[edit].CharaXaccel = base.CharaXaccel;
<br/>
   Characters[edit].CharaXaccelEnabled = base.CharaXaccelEnabled;
<br/>
   Characters[edit].CharaXspeed = base.CharaXspeed;
<br/>
   Characters[edit].CharaXspeedEnabled = base.CharaXspeedEnabled;
<br/>
   Characters[edit].CharaYaccel = base.CharaYaccel;
<br/>
   Characters[edit].CharaYaccelEnabled = base.CharaYaccelEnabled;
<br/>
   Characters[edit].HP = base.HP;
<br/>
   Characters[edit].map = mapa;
<br/>
   Characters[edit].memLoc = memLoca;
<br/>
   Characters[edit].OAMnum = OAMnuma;
<br/>
   Characters[edit].x = xa;
<br/>
   Characters[edit].y = ya;
<br/>
   Characters[edit].AI = AImode;
<br/>
   Characters[edit].animSpeed = base.animSpeed;
<br/>
   /*if (AImode == AI_DUMB) {
<br/>
      
<br/>
   }
<br/>
   if (AImode == AI_BUMP) {
<br/>
      Characters[edit].CollideBlock(u16) = AI_BUMP_CollideBlock(u16);
<br/>
      Characters[edit].RunFunc(u16) = AI_BUMP_RunFunc(u16);
<br/>
   }*/
<br/>
}
<br/>
<br/>
void KframeUpdate() {
<br/>
   memcpy( (u16 *)Kirby.memLoc, kirbyAnim[Kirby.frame], 1024 );
<br/>
}
<br/>
<br/>
void frameUpdate() {
<br/>
   memcpy( (u16 *)0x6010800, waddledeeAnim[Characters[0].frame], 256);
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<span style="font-weight: bold">waddledeeStates.h</span></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include "..\..\gba.h"
<br/>
<br/>
u32 waddledeeFrames[] = {4,6,6,6,6,7,7,7,7,8,8,8,8,9,9,9,9,5,10,10,10,10,11,11,11,11,12,12,12,12,13,13,13,13,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,0,1};
<br/>
u32 waddledeeStateFrames[] = {0,1,16,17,32,41,50,51};
<br/>
u32 waddledeeStateLength[] = {1,16,1,16,10,10,1,1};
<br/>
u32 waddledeeStateJumps[] = {0,1,2,3,6,7,6,7};
<br/>
u32 waddledeeXspeed[] = {0,4,0,-4,0,0,0,0};
<br/>
u32 waddledeeXspeedEnabled[] = {1,1,1,1,0,0,0,0};
<br/>
u32 waddledeeYspeed[] = {4,4,4,4,-16,-16,0,0};
<br/>
u32 waddledeeYspeedEnabled[] = {1,1,1,1,1,1,0,0};
<br/>
u32 waddledeeXaccel[] = {0,0,0,0,0,0,0,0};
<br/>
u32 waddledeeXaccelEnabled[] = {1,1,1,1,0,0,1,0};
<br/>
u32 waddledeeYaccel[] = {0,0,0,0,0,0,1,1};
<br/>
u32 waddledeeYaccelEnabled[] = {1,1,1,1,1,0,1,1};
<br/>
<br/>
const unsigned char (*waddledeeAnim[14]) [] = {
<br/>
&amp;waddledeefall00_Bitmap,
<br/>
&amp;waddledeefallright00_Bitmap,
<br/>
&amp;waddledeejump00_Bitmap,
<br/>
&amp;waddledeejumpright00_Bitmap,
<br/>
&amp;waddledeestand00_Bitmap,
<br/>
&amp;waddledeestandright00_Bitmap,
<br/>
&amp;waddledeewalk01_Bitmap,
<br/>
&amp;waddledeewalk02_Bitmap,
<br/>
&amp;waddledeewalk03_Bitmap,
<br/>
&amp;waddledeewalk04_Bitmap,
<br/>
&amp;waddledeewalkright01_Bitmap,
<br/>
&amp;waddledeewalkright02_Bitmap,
<br/>
&amp;waddledeewalkright03_Bitmap,
<br/>
&amp;waddledeewalkright04_Bitmap
<br/>
};</td> </tr></table><span class="postbody">
<br/>
Which, by the way, I made in my HOMEMADE STATE EDITOR!!!!
<br/>
<br/>
So... if anybody know why it won't update (or, actually, spots any other little errors in the code), please tell me.<br/>_________________<br/>Knock-knock.
<br/>
Whose there?
<br/>
Kirby.
<br/>
Kirby-who?
<br/>
I told you! Kirby!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#103304 - ProblemBaby - Wed Sep 20, 2006 9:32 pm</h4>
    <div class="postbody"><span class="postbody">I aint sure but I think...that you cant use memcpy to write to VRAM since it copies one byte a time.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#103324 - Cearn - Wed Sep 20, 2006 11:08 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ProblemBaby wrote:</b></span></td> </tr> <tr> <td class="quote">I aint sure but I think...that you cant use memcpy to write to VRAM since it copies one byte a time.</td> </tr></table><span class="postbody">memcpy will work fine as long as you obey <a class="postlink" href="http://www.coranac.com/tonc/text/bitmaps.htm#ssec-data-memcpy" target="_blank">the rules</a>. 
<br/>
<br/>
I am a little suspicous of this definition:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Kirby wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">const unsigned char (*waddledeeAnim[14]) [] = { ... };</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
If I'm parsing this correctly, This is an array of arrays of pointers. Or an array of pointers to arrays, I'm not sure. What exactly are you after here? And what is the exact error you're getting? Corrupted graphics? An erased frame?
<br/>
<br/>
EDIT:
<br/>
<br/>
One definite problem and one inefficiency here:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void SetUpChara(u16 edit, Character base, u16 xa, u16 ya, u16 mapa, u16 memLoca, u16 OAMnuma, u16 attr2a, u16 AImode)</td> </tr></table><span class="postbody">
<br/>
memLoca is 16bit. Addresses generally aren't. Please limit your use of non-word datatypes to structs or globals, the one place where they don't cost you anything. Also, it's not a good idea to pass whole structs to functions. Use 'Character *base' and change the periods to '-&gt;', or in C++ use references: 'Character &amp;base'.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#103518 - madmax - Fri Sep 22, 2006 4:26 pm</h4>
    <div class="postbody"><span class="postbody">First of Cearn your right to be suspicious about the array with a * before it thats not allowed. An array is just a special way of accessing data that is sequentialy allocated in a block so when you declare an array your really just using a pointer each time you request a new index pointer arithmetic is done in the background to work out where the element you want is. You can actually even use the array [] on pointers that you have not declared as an array (altough they better have been allocated as one or you'll get memory thats either invalid or used for something else).
<br/>
<br/>
However back to talking about designing characters or entitys. I think OOP should be used for all character related coding. I don't know much about the state system your using, but I'd advise you to try creating your own Enemy classes instead of using someone else's code because you will learn more and have greater control over it. Nearly all characters on your system will share lots of similaritys which just make sense to program as objects. 
<br/>
<br/>
In my games I start with a sprite that is an base class for any displayable object in the game. Basic directional movement, sprite animation is all done here and it gives me a usefull abstraction I can use for all other objects. 
<br/>
<br/>
Then I would subclass sprite into the objects I want (I actually don't do it exactly like this because of how my sprite manager system works in that I use composition and a sprite interface) for instance if you have a soldier then you start with sprite then create creature then soldier thats how your inheritance hierarcy goes.  The creature class is more advanced than sprite and knows how to do things like move in a line also it has a live state so we know if it has been killed another thing would be collision handeling creature knows what to do when he collides with basic things, also there is basic map navigation. Soldier is the next specialisation of creature, soldier has a weapon (which is actully another object) that he can fire at other enemys, knows what to do if he's hit by bullets and soldiers also have collision avoidance ai so they don't keep bumping into each other (altough you might argue a basic creature can do that too).
<br/>
<br/>
The diffrence from doing it all in once class is that the behaviour is compartmentalised (I'm sure thats spelt wrong). Also if I needed to make a fox I wouldn't have to just create a specilisation of creature and program the functionality in. Because all my sprite and basic movement stuff is already done :)
<br/>
<br/>
However there is a draw back to all this and that is that the behaviours are coupled to the classes of object that implement them. So if I wanted to give my fox the collision avoidance code from soldier I have to go into soldier and copy it to fox. I it this way only on GBA because C++ is slower than C and lots of objects eat up memory, however on other systems a better way of doing it is compartmentising ever behaviour in it's own class you need to have a common interface for every object the behaviour could be applied to. You could also use a more dynamic system to forward certain calls to other classes that know what to do with them if they exist in the object these special handeler classes get called when soldiers collide for instance to resolve the collision between soldiers without the actual soldier code knowing what to do, but this gets complex. 
<br/>
<br/>
However you do it your aim is to have each diffrent behaviour in a unique class so you can easily add it to new entitys with minimum code repetition. This way you get fewer errors because all the behaviours are in their own class that have all been tested throughly. You can even make new behaviours by combining the base behaviours classes so that you end up with inheritance hierarcy between your behaviours. However there is one problem with this that must be garded agasn't and thats direct coupling between a behaviour and the classes that use it. For instance you want to make behaviours that can work for all entitys not just a few spesific entitys in these cases you should use a abstract handeler class that lays out what sort of actions need to be taken but leaves the implementation to it's sub classes. It's okay for these handlers to be coupled to behaviours and the entitiys because the handeler can always be replaced with new ones yet the entitys and behaviours will not need changing.
<br/>
<br/>
Well thats how I do things anyway<br/>_________________<br/>John Noon</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#103539 - thegamefreak0134 - Fri Sep 22, 2006 6:51 pm</h4>
    <div class="postbody"><span class="postbody">I can probably tell you what you\\\'re doing wrong, if you\\\'re still using my editor. My state system is designed to work (currently) with one character only, namely \\\"Player1\\\". I am actually in the process of allowing it to process multiple characters, but since this has not been done yet by me, you\\\'ll have to do it. 
<br/>
<br/>
I might need to go ahead and give you my state editor (it\\\'s GUI and exports the offensive code you\\\'re having issues with for you). If you have the smallest trinket in the definitions defined wrong, the state engine will have issues. Then, I would recommend re-making the characters and modifying the state process function to take an input known as \\\"Player1\\\". Pass it the info for every character, including the proper pointers to all of the state info and such, and it can be used to process more than one chracter with more than one set of data.
<br/>
<br/>
If you\\\'d like however, I\\\'ll go ahead and mod it this weekend and send you the corrected code as well as the editor and instruction both for using it and for making the editor stay happy. (It was hand tailored ot my useage, and doesn\\\'t expect a lot of wierd user-firendly stuff) I really don\\\'t like the idea of you keeping it in there, but if you want to use it for now that\\\'s fine. It sholdn\\\'t be too hard to make your own once you have the main concept down though.
<br/>
<br/>
Let me know if this interests you.
<br/>
<br/>
-thegamefreak
<br/>
<br/>
PS: PM me, don\\\'t post, as I don\\\'t check this section too often.
<br/>
<br/>
EDIT: OH yeah, my code also includes a frame update function, which will need some explaining, but works for most purposes. I\'ll explain that if you need me to, it should get your pictures working.<br/>_________________<br/>What if the hokey-pokey really is what it's all about?
<br/>
<br/>
[url=http:/www.darknovagames.com/index.php?action=recruit&amp;clanid=1]Support Zeta on DarkNova![/url]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#103872 - Kirby - Mon Sep 25, 2006 2:48 am</h4>
    <div class="postbody"><span class="postbody">I've actually changed around the state system now, so it supports multiple AI characters, but the one problem I'm having is having them scroll correctly around the screen. Kirby moves around fine, but other characters are a few pixels off, and because Kirby moves quickly, the difference is very noticable.
<br/>
<br/>
Second, waddledeeAnim is an array of pointers to arrays. I'm not actually having any problem with it, though. All character physics are working great, the only problem I'm having, is that I can't start Visual C++ 2005 Express Edition any more, and that one of the tilesets look weird. Imagine this:
<br/>
<br/>
Say one tile is supposed to be like this:
<br/>
<br/>
1,2,3,4,5,6,7,8
<br/>
1,2,3,4,5,6,7,8
<br/>
1,2,3,4,5,6,7,8
<br/>
1,2,3,4,5,6,7,8
<br/>
1,2,3,4,5,6,7,8
<br/>
1,2,3,4,5,6,7,8
<br/>
1,2,3,4,5,6,7,8
<br/>
1,2,3,4,5,6,7,8
<br/>
<br/>
But it's coming out like this:
<br/>
<br/>
2,1,4,3,6,5,8,7
<br/>
2,1,4,3,6,5,8,7
<br/>
2,1,4,3,6,5,8,7
<br/>
2,1,4,3,6,5,8,7
<br/>
2,1,4,3,6,5,8,7
<br/>
2,1,4,3,6,5,8,7
<br/>
2,1,4,3,6,5,8,7
<br/>
2,1,4,3,6,5,8,7
<br/>
<br/>
And I tried swapping bits in my code but it makes it even weirder.
<br/>
<br/>
Third, in a makefile (i'm new 2 makefiles), how do you get it to recompile a file when a header file it uses is changed, because I have to run make clean too much. I use DevKitAdv and Visual C++ 2005 Express Edition (which, as I said before, I cannot get to open)<br/>_________________<br/>Knock-knock.
<br/>
Whose there?
<br/>
Kirby.
<br/>
Kirby-who?
<br/>
I told you! Kirby!</span><span class="gensmall"><br/><br/>Last edited by Kirby on Thu Sep 28, 2006 6:34 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#103876 - tepples - Mon Sep 25, 2006 3:18 am</h4>
    <div class="postbody"><span class="postbody">If you're getting pixels ordered 2, 1, 4, 3, 6, 5, 8, 7, within a tile, then you accidentally chose Sega Genesis (4-bit packed pixels, big-endian) mode instead of GBA/DS 16-color (4-bit packed pixels, little-endian) mode.
<br/>
<br/>
Here's how to specify multiple prereqs in a file:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">gimmicks.o: gimmicks.c lj.h
<br/>
&lt;TAB&gt;$(CC) $(CFLAGS) $&lt; -o $@</td> </tr></table><span class="postbody"><br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#103892 - Kirby - Mon Sep 25, 2006 5:41 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">If you're getting pixels ordered 2, 1, 4, 3, 6, 5, 8, 7, within a tile, then you accidentally chose Sega Genesis (4-bit packed pixels, big-endian) mode instead of GBA/DS 16-color (4-bit packed pixels, little-endian) mode.</td> </tr></table><span class="postbody">
<br/>
First, Sega/Gensis mode what? What on EARTH does that mean? I'm using my own tileset compiler here!
<br/>
Second, I'm using one rule to compile all of my .c's (there are alot of them), and I want to know how to get a list of dependencies for that file.<br/>_________________<br/>Knock-knock.
<br/>
Whose there?
<br/>
Kirby.
<br/>
Kirby-who?
<br/>
I told you! Kirby!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#103924 - tepples - Mon Sep 25, 2006 1:55 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Kirby wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">If you're getting pixels ordered 2, 1, 4, 3, 6, 5, 8, 7, within a tile, then you accidentally chose Sega Genesis (4-bit packed pixels, big-endian) mode instead of GBA/DS 16-color (4-bit packed pixels, little-endian) mode.</td> </tr></table><span class="postbody">
<br/>
First, Sega/Gensis mode what? What on EARTH does that mean? I'm using my own tileset compiler here!</span></td> </tr></table><span class="postbody">
<br/>
Then you may have a defect in your own tileset compiler. I must have been thinking of a converter that I wrote that supports NES, Super NES, Game Boy, Virtual Boy, Genesis, GBA 4-bit, and GBA 8-bit, as well as several other formats.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Second, I'm using one rule to compile all of my .c's (there are alot of them), and I want to know how to get a list of dependencies for that file.</td> </tr></table><span class="postbody">
<br/>
The easy way is to switch to wintermute's makefile. If you want to do it yourself for understanding, try <a class="postlink" href="http://make.paulandlesley.org/autodep.html" target="_blank">the same article that wintermute read</a>.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#103993 - Mucca - Mon Sep 25, 2006 9:27 pm</h4>
    <div class="postbody"><span class="postbody"><span style="font-weight: bold">madmax wrote:</span></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Then I would subclass sprite into the objects I want</td> </tr></table><span class="postbody">
<br/>
<br/>
What if your entities require usage of more than one sprite? Compositing entities just to have an extra sprite will duplicate logically singular data and behaviour. Also what if you need objects with no visual representation? Eg a zone in a level that triggers some behaviour when the player enters it. Its better to seperate logical and graphical elements. A sprite is a graphical element, a creature is logical.
<br/>
<br/>
And don't be too quick to dismiss C++ and full usage thereof as slow. My engine, currently being used for its fourth commercial gba game, is fully C++ with some quite deep inheritance trees, lots of virtual functions, templates, the lot. Proper organisation of data is the key. Contextualize and sort where appropriate (quadtrees and binary trees are king in 2D).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104060 - Kirby - Tue Sep 26, 2006 8:02 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Kirby wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">If you're getting pixels ordered 2, 1, 4, 3, 6, 5, 8, 7, within a tile, then you accidentally chose Sega Genesis (4-bit packed pixels, big-endian) mode instead of GBA/DS 16-color (4-bit packed pixels, little-endian) mode.</td> </tr></table><span class="postbody">
<br/>
First, Sega/Gensis mode what? What on EARTH does that mean? I'm using my own tileset compiler here!</span></td> </tr></table><span class="postbody">
<br/>
Then you may have a defect in your own tileset compiler. I must have been thinking of a converter that I wrote that supports NES, Super NES, Game Boy, Virtual Boy, Genesis, GBA 4-bit, and GBA 8-bit, as well as several other formats.</span></td> </tr></table><span class="postbody">
<br/>
You're right on that one. I was converting 8-bit values to 16-bit without reversing them. I found that the other picture did also look weird.
<br/>
<br/>
EDIT: Which means that you were right about it being 2,1,4,3,6,5,8,7, not 1,2,4,3,6,5,7,8. I just thought that becuase the edges of the tiles I was using were pretty much symmetrical.
<br/>
<br/>
Second, VC++2k5EE now works again! *Party noises* Some weird yvbb01.dll was messing it up. Just had to download HaxFix.exe and *poof*! It works again!
<br/>
<br/>
Third, where do I get cp and sed for the autodependcy makefile? I've tried to download it from the site, and it gives me a huge folder of binaries I'm supposted to compile using Linux or something insane like that!<br/>_________________<br/>Knock-knock.
<br/>
Whose there?
<br/>
Kirby.
<br/>
Kirby-who?
<br/>
I told you! Kirby!</span><span class="gensmall"><br/><br/>Last edited by Kirby on Thu Sep 28, 2006 6:36 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#104115 - tepples - Tue Sep 26, 2006 5:58 pm</h4>
    <div class="postbody"><span class="postbody">You get them as part of MSYS, which is bundled with devkitPro Updater. Yes, much of MSYS consists of Windows ports of GNU text tools associated with UNIX (and Linux).<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104168 - Kirby - Tue Sep 26, 2006 9:55 pm</h4>
    <div class="postbody"><span class="postbody">Alrightly then, maybe I won't use cp, sed.
<br/>
<br/>
Second, I don't think I fully explained my scrolling problem before. I have a human-controlled character that stays at the exact same OAM coordinates at all times, (except for in side-scrolling levels, but I havn't implemented that yet). I have a system for animated other AI characters, that works great, with the exception of this:
<br/>
<br/>
<ol type="1">When Kirby is at the exact same X and Y as WaddleDee, WaddleDee looks fine (but is underneath Kirby). When the difference between Kirby's X and his X or Kirby's Y and his Y gets bigger, he may start floating off the ground and all of that whatnot.
<br/>
I have to memcpy each Character in turn, because this for-loop doesn't work:
<br/>
</ol></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">for (i=0;i&lt;NumCharas;i++) {
<br/>
      if (Characters[i].map == curmap) {
<br/>
         memcpy( (u16 *)Characters[i].memLoc, &amp;Characters[i].charaAnim[Characters[i].frame], 256 );
<br/>
      }
<br/>
   }</td> </tr></table><span class="postbody">
<br/>
Lastly, if anyone's noticed that I've havn't answered any posts in about a week, it's because my computer had a virus and Internet Explorer couldn't start. Some stupid yvbb01.dll. If anyone is interested, they should download HaxFix (<a class="postlink" href="http://www.google.com" target="_blank">Google</a> is your friend), because yvbb01 can also ruin half the programs on your computer. Just run the program, type 3, type in yvbb and then type N. Reboot when asked. Voila, computer fixed.<br/>_________________<br/>Knock-knock.
<br/>
Whose there?
<br/>
Kirby.
<br/>
Kirby-who?
<br/>
I told you! Kirby!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104172 - thegamefreak0134 - Tue Sep 26, 2006 10:27 pm</h4>
    <div class="postbody"><span class="postbody">You\'re not using my scaling routine too, are you? I had similar issues with it... This sounds very much like a scaling issue. Is waddledee moving on his own, or is he staying put?<br/>_________________<br/>What if the hokey-pokey really is what it's all about?
<br/>
<br/>
[url=http:/www.darknovagames.com/index.php?action=recruit&amp;clanid=1]Support Zeta on DarkNova![/url]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104180 - Kirby - Tue Sep 26, 2006 11:10 pm</h4>
    <div class="postbody"><span class="postbody">I'm not using any scaling. Kirby doesn't move at all in OAM, the background scrolls behind him, but I use this for WaddleDee:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">u16 h;
<br/>
   u16 top;
<br/>
   u16 left;
<br/>
   left = Kirby.x - (4 * 32);
<br/>
   top = Kirby.y - (2 * 32);
<br/>
   if(foih == 0) {
<br/>
      for (h=0;h&lt;NumCharas;h++) {
<br/>
         if (Characters[h].map == curmap) {
<br/>
            Characters[h].drawX = Characters[h].x - left;
<br/>
            Characters[h].drawY = Characters[h].y - top;
<br/>
            if(Characters[h].x &lt; (0 - 109)) {
<br/>
               Characters[h].drawX = 624;
<br/>
               Characters[h].drawY = 384;
<br/>
            }   
<br/>
            if(Characters[h].y &lt; (0 - 128)) {
<br/>
               Characters[h].drawX = 624;
<br/>
               Characters[h].drawY = 384;
<br/>
            }
<br/>
            if(Characters[h].x &gt; (left + 960)) {
<br/>
               Characters[h].drawX = 624;
<br/>
               Characters[h].drawY = 384;
<br/>
            }   
<br/>
            if(Characters[h].y &gt; (top + 640)) {
<br/>
               Characters[h].drawX = 624;
<br/>
               Characters[h].drawY = 384;
<br/>
            }
<br/>
            sprites[h+3].attribute0 = COLOR_256 | SQUARE | ROTATION_FLAG | SIZE_DOUBLE | ((Characters[h].drawY / 3 + 42) &amp; 0x00FF);
<br/>
            sprites[h+3].attribute1 = SIZE_16 | ROTDATA(0) | ((Characters[h].drawX / 3 + 64) &amp; 0x01FF);
<br/>
         }
<br/>
      }
<br/>
      CopyOAM();
<br/>
      foih = 1;
<br/>
   } else {
<br/>
      if (foih == 1) {
<br/>
         foih = 2;
<br/>
      } else {
<br/>
         foih = 0;
<br/>
      }
<br/>
   }</td> </tr></table><span class="postbody">
<br/>
WaddleDee moves on his own, but doesn't scroll exactly in tune to the background in relation of Kirby's X and Y. I will send a demo to gbadev.org for anybody who wants to see my demo so far.<br/>_________________<br/>Knock-knock.
<br/>
Whose there?
<br/>
Kirby.
<br/>
Kirby-who?
<br/>
I told you! Kirby!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104233 - Cearn - Wed Sep 27, 2006 9:39 am</h4>
    <div class="postbody"><span class="postbody">The division by three could be part of the problem. Integer division rounds towards 0, which may create some friction when the sign becomes negative. In the case of x/3 :
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">  x | x/3
<br/>
----+----
<br/>
 -3 | -1
<br/>
 -2 |  0
<br/>
 -1 |  0
<br/>
  0 |  0
<br/>
  1 |  0
<br/>
  2 |  0
<br/>
  3 |  1
<br/>
  4 |  1
<br/>
  5 |  1
<br/>
  6 |  2
<br/>
</td> </tr></table><span class="postbody">Why <span style="font-style: italic">are</span> dividing by 3 anyway? If it's for sub-pixel accuracy, couldn't you just use standard fixed point numbers here?
<br/>
<br/>
Another potential problem is this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Kirby wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   u16 top;
<br/>
   u16 left;
<br/>
   left = Kirby.x - (4 * 32);
<br/>
   top = Kirby.y - (2 * 32); 
<br/>
   ...
<br/>
   Characters[h].drawX = Characters[h].x - left;
<br/>
   Characters[h].drawY = Characters[h].y - top; 
<br/>
</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
I don't know what Kirby.x is, but if it's, say, 127 (anything below 128 will do) then 'left' is 65535, not -1, and might throw the rest of the calculations off. Once again, the problem is caused by using the u16 datatype. <span style="font-weight: bold">Do NOT use non-word sized datatypes for local variables</span>! It'll produce longer and slower code and be more susceptible to overflow problems. Use 'int' or 'u32', please.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104272 - Kirby - Wed Sep 27, 2006 5:17 pm</h4>
    <div class="postbody"><span class="postbody">Kirby.x is the X coordinate of my Human-controlled Character. Left is supposed to be the coordinate of where the far left of the screen on the map (so where it is scrolling-wise). I'm divinding by 3 because if I don't divide, he scrolls much faster than the map behind him, and if I divide by 4, he scrolls too slowly. I need to know what to do to the number so that it appears correctly on the screen.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code"> u16 top; 
<br/>
   u16 left; 
<br/>
   left = Kirby.x - (4 * 32); 
<br/>
   top = Kirby.y - (2 * 32); 
<br/>
   ... 
<br/>
   Characters[h].drawX = Characters[h].x - left; 
<br/>
   Characters[h].drawY = Characters[h].y - top; 
<br/>
</td> </tr></table><span class="postbody">
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cearn wrote:</b></span></td> </tr> <tr> <td class="quote">I don't know what Kirby.x is, but if it's, say, 127 (anything below 128 will do) then 'left' is 65535, not -1, and might throw the rest of the calculations off. Once again, the problem is caused by using the u16 datatype. </td> </tr></table><span class="postbody">
<br/>
I don't think so. If you didn't notice, left is UNSIGNED!!!!! Meaning that there are negative values!!!!
<br/>
Also, / is the Integer Division?!?!? OOOHHHHH..... Because in VB... never mind... So how do I do regular division?<br/>_________________<br/>Knock-knock.
<br/>
Whose there?
<br/>
Kirby.
<br/>
Kirby-who?
<br/>
I told you! Kirby!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104277 - Cearn - Wed Sep 27, 2006 5:42 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Kirby wrote:</b></span></td> </tr> <tr> <td class="quote">Kirby.x is the X coordinate of my Human-controlled Character. Left is supposed to be the coordinate of where the far left of the screen on the map (so where it is scrolling-wise). I'm divinding by 3 because if I don't divide, he scrolls much faster than the map behind him, and if I divide by 4, he scrolls too slowly. I need to know what to do to the number so that it appears correctly on the screen.</td> </tr></table><span class="postbody">
<br/>
<br/>
This is why we have floating point values. What you need is something that can scroll with a speed of 1/3 = 0.333... . Or, in case of a platform without an FPU, use fixed point math. In .8 <a class="postlink" href="http://en.wikipedia.org/wiki/Fixed-point_arithmetic" target="_blank">fixed point</a>, 1/3 is about 0x56 (i.e., 0x56 256ths); division by 3 then becomes (x*0x56)&gt;&gt;8. Of course there would be a small problem with roundoff again. But the 'right' scrolling speed might not be exactly 1/3 anyway, so the roundoff problem wouldn't matter much.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Kirby wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code"> u16 top; 
<br/>
   u16 left; 
<br/>
   left = Kirby.x - (4 * 32); 
<br/>
   top = Kirby.y - (2 * 32); 
<br/>
   ... 
<br/>
   Characters[h].drawX = Characters[h].x - left; 
<br/>
   Characters[h].drawY = Characters[h].y - top; 
<br/>
</td> </tr></table><span class="postbody">
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cearn wrote:</b></span></td> </tr> <tr> <td class="quote">I don't know what Kirby.x is, but if it's, say, 127 (anything below 128 will do) then 'left' is 65535, not -1, and might throw the rest of the calculations off. Once again, the problem is caused by using the u16 datatype. </td> </tr></table><span class="postbody">
<br/>
I don't think so. If you didn't notice, left is UNSIGNED!!!!! Meaning that there are negative values!!!!
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
<span style="font-style: italic">Signed</span> means there are negative values. Unsigned means there aren't. 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Kirby wrote:</b></span></td> </tr> <tr> <td class="quote">Also, / is the Integer Division?!?!? OOOHHHHH..... Because in VB... never mind... So how do I do regular division?</td> </tr></table><span class="postbody"> Same way, it depends on the types of the operands. If either operand is floating point, then the result will also be floating point; if both are integer, integer division is used. And as floating point arithmetic is hella slow on the GBA and NDS, you'll usually be working with integers.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104300 - thegamefreak0134 - Wed Sep 27, 2006 9:28 pm</h4>
    <div class="postbody"><span class="postbody">I\'m confused as to why you are having to divide one and not the other. Shouldn\'t you have the map and waddledee (I assume that\'s who\'s \"scrolling\" because you said kirby doesn\'t move) be moving at the same speed? If (with no divide) you have a speed difference, something is amiss, it looks like. What is the psuedo-code that causes waddledee to be positioned on-screen? (I\'m having trouble deciphering your C code, sorry)
<br/>
<br/>
The only thing I could figure is that you are using a rotational background for the map, in which case you should be having to divide by 8, not three... But I don\'t see why that would be the case either.
<br/>
<br/>
-gamefreak<br/>_________________<br/>What if the hokey-pokey really is what it's all about?
<br/>
<br/>
[url=http:/www.darknovagames.com/index.php?action=recruit&amp;clanid=1]Support Zeta on DarkNova![/url]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104315 - Kirby - Wed Sep 27, 2006 11:59 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>thegamefreak0134 wrote:</b></span></td> </tr> <tr> <td class="quote">The only thing I could figure is that you are using a rotational background for the map, in which case you should be having to divide by 8, not three... But I don\'t see why that would be the case either.</td> </tr></table><span class="postbody">
<br/>
I AM using an affline map, because I can't seem to get regular ones to work. But dividing by 8 would just make him WAY too slow.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cearn wrote:</b></span></td> </tr> <tr> <td class="quote">Signed means there are negative values. Unsigned means there aren't.</td> </tr></table><span class="postbody">
<br/>
No they're not! I'll prove it! I'll open my C++ book and!... oh... oh my gosh.... That's why WaddleDee appears at the top of the screen some times... oops... poop. Now I've changed lots of my signed numbers to unsigned... Thanx for telling me that.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>thegamefreak0134 wrote:</b></span></td> </tr> <tr> <td class="quote">I\'m confused as to why you are having to divide one and not the other. Shouldn\'t you have the map and waddledee (I assume that\'s who\'s \"scrolling\" because you said kirby doesn\'t move) be moving at the same speed? If (with no divide) you have a speed difference, something is amiss, it looks like. What is the psuedo-code that causes waddledee to be positioned on-screen? (I\'m having trouble deciphering your C code, sorry) </td> </tr></table><span class="postbody">
<br/>
Yes, WaddleDee is supposed to be "scrolling", because for Kirby, the map just scrolls behind him. Yes, when I don't divide I have a speed diference. I'll comment my code to help you understand it more:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">u16 h; //For-variable for looping through all characters
<br/>
   u16 top; //Variable
<br/>
   u16 left; //Variable
<br/>
   left = Kirby.x - (4 * 32); //Represents the left of the screen
<br/>
   top = Kirby.y - (2 * 32); //Represents the top of the screen
<br/>
   if(foih == 0) { 
<br/>
      for (h=0;h&lt;NumCharas;h++) { //For loop
<br/>
         if (Characters[h].map == curmap) { //If character is on current map
<br/>
            Characters[h].drawX = Characters[h].x - left; //Take away the left of the screen from WaddleDee's X value
<br/>
            Characters[h].drawY = Characters[h].y - top; //Take away the top of the screen from WaddleDee's Y value
<br/>
            if(Characters[h].x &lt; (0 - 109)) { //If WaddleDee is too far to the left
<br/>
               Characters[h].drawX = 624; //Hide Waddle Dee
<br/>
               Characters[h].drawY = 384; // ""
<br/>
            }    
<br/>
            if(Characters[h].y &lt; (0 - 128)) { //If WaddleDee is too far to the north
<br/>
               Characters[h].drawX = 624; // Hide
<br/>
               Characters[h].drawY = 384; // ""
<br/>
            } 
<br/>
            if(Characters[h].x &gt; (left + 960)) { //If he is to far to the right 
<br/>
               Characters[h].drawX = 624; 
<br/>
               Characters[h].drawY = 384; 
<br/>
            }    
<br/>
            if(Characters[h].y &gt; (top + 640)) {  //If he is too far to the south
<br/>
               Characters[h].drawX = 624; 
<br/>
               Characters[h].drawY = 384; 
<br/>
            } 
<br/>
            sprites[h+3].attribute0 = COLOR_256 | SQUARE | ROTATION_FLAG | SIZE_DOUBLE | ((Characters[h].drawY / 3 + 42) &amp; 0x00FF); //sprites is an array off OAMEntry. This code moves him
<br/>
            sprites[h+3].attribute1 = SIZE_16 | ROTDATA(0) | ((Characters[h].drawX / 3 + 64) &amp; 0x01FF); //So does this one.
<br/>
         } 
<br/>
      } 
<br/>
      CopyOAM(); //Copy to OAM
<br/>
      foih = 1; 
<br/>
   } else { 
<br/>
      if (foih == 1) { 
<br/>
         foih = 2; 
<br/>
      } else { 
<br/>
         foih = 0; 
<br/>
      } 
<br/>
   }</td> </tr></table><span class="postbody">
<br/>
<br/>
EDIT: For the scrolling, I'm not using speed as such. I'm not adding values to WaddleDee's X and Y, I'm setting them to approximate values.<br/>_________________<br/>Knock-knock.
<br/>
Whose there?
<br/>
Kirby.
<br/>
Kirby-who?
<br/>
I told you! Kirby!</span><span class="gensmall"><br/><br/>Last edited by Kirby on Thu Sep 28, 2006 6:23 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#104342 - Kirby - Thu Sep 28, 2006 5:33 am</h4>
    <div class="postbody"><span class="postbody">The closest I can get to correct scrolling is instead of diving X and Y by 3, to divide X by 3.6, and add 64, and to divide Y by 2.4, and add 37, and even then it's still a little bit off. Also, dividing these numbers are making the game go really slow when you're on the same map as WaddleDee.
<br/>
<br/>
EDIT: Also, I wonder if anyone has notice the HUGE bug in one of the pieces of code I've posted. I have fixed the error, but I want to know if anyone else has noticed it. HINT: It's on the first page. When this topic gets up to the 4'th page, I'll let you all know. (Another Hint: This error was causing WaddleDee move incorrectly)<br/>_________________<br/>Knock-knock.
<br/>
Whose there?
<br/>
Kirby.
<br/>
Kirby-who?
<br/>
I told you! Kirby!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104387 - thegamefreak0134 - Thu Sep 28, 2006 4:24 pm</h4>
    <div class="postbody"><span class="postbody">I have an idea. Why not (instead of worrying about the screen) take waddledee\'s position in the map as a value. (his position on the level, if you will, regardless of screen positioning.) Then, figure out how far the map is scrolled, and scroll waddledee that much as well. (In this case, the mapscrolled / 8 should do the trick) Boom. You have waddledee\'s position. Since the map is scrolled relative to the screen, you shouldnt have to adjust to the screen at all, just check if he is not on the screen and dont draw him in this case. By doing this, you should effectively eliminate all divides, since the compiler optimizes a divide by 8 to a shift anyway, which is much faster.
<br/>
<br/>
Is the map anchored to the top left corner? If not, you will need to account for this as well.
<br/>
<br/>
-gamefreak<br/>_________________<br/>What if the hokey-pokey really is what it's all about?
<br/>
<br/>
[url=http:/www.darknovagames.com/index.php?action=recruit&amp;clanid=1]Support Zeta on DarkNova![/url]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104446 - sgeos - Fri Sep 29, 2006 6:34 am</h4>
    <div class="postbody"><span class="postbody">I agree with thegamefreak0134.  You should be able to position your viewport anywhere you want to- it should not be hard coded to any single critter.  Then, if you want to tie it to a particular critter, you can do something like this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">Point pos = myCritter.getPos();
<br/>
<br/>
setCameraPos(pos);  // screen center
<br/>
// ... later ...
<br/>
redraw();</td> </tr></table><span class="postbody">
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104458 - Kirby - Fri Sep 29, 2006 8:33 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">Characters[h].drawX = (((Characters[h].drawX * 9) &gt;&gt; 5) + 64);
<br/>
Characters[h].drawY = (((Characters[h].drawY * 27) &gt;&gt; 6) + 37);</td> </tr></table><span class="postbody">
<br/>
Until I can find something better, I'm going to use this. I followed what</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cearn wrote:</b></span></td> </tr> <tr> <td class="quote">This is why we have floating point values. What you need is something that can scroll with a speed of 1/3 = 0.333... . Or, in case of a platform without an FPU, use fixed point math. In .8 fixed point, 1/3 is about 0x56 (i.e., 0x56 256ths); division by 3 then becomes (x*0x56)&gt;&gt;8. Of course there would be a small problem with roundoff again. But the 'right' scrolling speed might not be exactly 1/3 anyway, so the roundoff problem wouldn't matter much.</td> </tr></table><span class="postbody">, and used fixed point math. I found that the equivilent(I know that's spelt wrong) of (X / 3.6) + 64 was ((X * 9) &gt;&gt; 5) + 64, and that (Y / 2.4) + 37 was the same as ((Y * 27) &gt;&gt; 6) + 37. Basically, it's the same as before when it was </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">Characters[h].drawY = (((Characters[h].drawY * 1.0) / 2.4) + 37);
<br/>
Characters[h].drawX = (((Characters[h].drawX * 1.0) / 3.6) + 64);</td> </tr></table><span class="postbody">, but that way used floating points, and slowed down the game. It's actually pretty good, the error ratio is 1:32 (1 pixel off for every 32 pixels between you).
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>thegamefreak0134 wrote:</b></span></td> </tr> <tr> <td class="quote">I have an idea. Why not (instead of worrying about the screen) take waddledee\'s position in the map as a value. (his position on the level, if you will, regardless of screen positioning.) Then, figure out how far the map is scrolled, and scroll waddledee that much as well. (In this case, the mapscrolled / 8 should do the trick) Boom. You have waddledee\'s position. Since the map is scrolled relative to the screen, you shouldnt have to adjust to the screen at all, just check if he is not on the screen and dont draw him in this case. By doing this, you should effectively eliminate all divides, since the compiler optimizes a divide by 8 to a shift anyway, which is much faster.</td> </tr></table><span class="postbody">It didn't work. I tried every way I could think of to get this to work, but it didn't.
<br/>
<br/>
I wrote a small program that gets the Fixed Point expression "(x * y) &gt;&gt; z" from a Floating Point division "x / y", so if you have to do a decimal division, you could turn it in to a Fixed Point expression. Do you think I should send it to gbadev.org, or is FPM something easy to work out and nobody would use my program?
<br/>
<br/>
Aside from this post's main topic, I'm having another problem. I'm trying to add a bar at the bottom of the screen with Kirby's HP and lives on it. I'm putting it on BG 1, and I'm using Mode 1. I can get the data onto the map correctly, it's just the tileset I'm having a problem with. I'm trying to add the palette to 0x050001C0, and just add E0 to each of the values in the tile array. But when I test it out, one of two things happens:
<br/>
<br/>
<ul>A. The bar looks very weird (palette errors)
<br/>
B. There are black stripes down every other column (I think the colors are inverted)</ul>This is the code I'm using:
<br/>
<br/>
<span style="font-weight: bold">CharBg.h</span></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include "..\gba.h"
<br/>
#include "CharData.h"
<br/>
#include "CharDataMap.h"
<br/>
#include "..\textsys.h"
<br/>
<br/>
void InitCharData(void);
<br/>
void ShowCharData(u16 hp, u16 lives, u16 points);
<br/>
<br/>
Bg bg1;
<br/>
<br/>
void InitCharData()
<br/>
{
<br/>
   u16 tempg[2560];
<br/>
   u16 tempp[22];
<br/>
   bg1.charBaseBlock = 2;
<br/>
   bg1.colorMode = BG_COLOR_256;
<br/>
   bg1.size = TEXTBG_SIZE_256x256;
<br/>
   u16 i;
<br/>
   for(i=0;i&lt;40*4*8;i++) VRAM[0x4000+i] = CharDataTiles[i] + 0xE0;
<br/>
   for(i=0;i&lt;22;i++) PAL[0xE0+i] = CharDataPalette[i];
<br/>
   //memcpy((u16 *)0x06008000, &amp;tempg, sizeof(CharDataData)); //1125
<br/>
   //memcpy((u16 *)0x050001C0, &amp;CharDataPalette,22);
<br/>
   for(i=0;i&lt;2048;i++) bg1.mapData[i] = CharDataMapMap[i];
<br/>
   bg1.number = 1;
<br/>
}
<br/>
<br/>
void ShowCharData(u16 hp, u16 lives, u16 points)
<br/>
{
<br/>
   InitCharData();
<br/>
   PlotText(Int2Txt(lives),4,8);
<br/>
   PlotText(Int2Txt(points),8,8);
<br/>
   EnableBackground(&amp;bg1);
<br/>
}</td> </tr></table><span class="postbody">If you spot any errors, please tell me.
<br/>
<br/>
EDIT: Above where it says ((X * 9) &gt;&gt; 5) + 64, the + 64 does count, because the FPV is different without it. My program says it's (X * 17) &gt;&gt; 6.<br/>_________________<br/>Knock-knock.
<br/>
Whose there?
<br/>
Kirby.
<br/>
Kirby-who?
<br/>
I told you! Kirby!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104460 - Cearn - Fri Sep 29, 2006 10:43 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Kirby wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">Characters[h].drawX = (((Characters[h].drawX * 9) &gt;&gt; 5) + 64);
<br/>
Characters[h].drawY = (((Characters[h].drawY * 27) &gt;&gt; 6) + 37);</td> </tr></table><span class="postbody">
<br/>
Until I can find something better, I'm going to use this. I followed what</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cearn wrote:</b></span></td> </tr> <tr> <td class="quote">This is why we have floating point values. What you need is something that can scroll with a speed of 1/3 = 0.333... . Or, in case of a platform without an FPU, use fixed point math. In .8 fixed point, 1/3 is about 0x56 (i.e., 0x56 256ths); division by 3 then becomes (x*0x56)&gt;&gt;8. Of course there would be a small problem with roundoff again. But the 'right' scrolling speed might not be exactly 1/3 anyway, so the roundoff problem wouldn't matter much.</td> </tr></table><span class="postbody">, and used fixed point math. I found that the equivilent(I know that's spelt wrong) of (X / 3.6) + 64 was ((X * 9) &gt;&gt; 5) + 64, and that (Y / 2.4) + 37 was the same as ((Y * 27) &gt;&gt; 6) + 37. Basically, it's the same as before when it was </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">Characters[h].drawY = (((Characters[h].drawY * 1.0) / 2.4) + 37);
<br/>
Characters[h].drawX = (((Characters[h].drawX * 1.0) / 3.6) + 64);</td> </tr></table><span class="postbody">, but that way used floating points, and slowed down the game. It's actually pretty good, the error ratio is 1:32 (1 pixel off for every 32 pixels between you).
<br/>
<br/>
I wrote a small program that gets the Fixed Point expression "(x * y) &gt;&gt; z" from a Floating Point division "x / y", so if you have to do a decimal division, you could turn it in to a Fixed Point expression. Do you think I should send it to gbadev.org, or is FPM something easy to work out and nobody would use my program?</span></td> </tr></table><span class="postbody">
<br/>
Depending on the details it might be useful, but really, fixed point math isn't difficult. It's just a scaled form of regular integer math. 
<br/>
Also, don't think in terms of (floating point) divisions for movement, just plain floats or fixeds will do. In the case of your movement scaling, what you want is not so much scaling down the numbers you have by 2.4, but movements in 1/2.4 = 0.41666 = 5/12 increments. Or 27/64th or 107/256th or even 27307/65536th. The point of fixed point math is that you always count in fractions, so that adding fractions simply becomes adding integers:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">// Example of .8 fixed point math:
<br/>
int fa= 0x1234;    // fa= 0x1234/256 ≅ 18.20
<br/>
int fb= 0x4321;    // fb= 0x4321/256 ≅ 67.13
<br/>
int fc;
<br/>
<br/>
fc= fa + fb;    // fc = (0x1234+0x4231)/256 = 0x5555/256 = 85.33
<br/>
<br/>
fc += 107;    // fc = fc + 107/256 = fc + 0.41666
<br/>
<br/>
fc= fc/256;   // Conversion to normal integer (.8 -&gt; .0 fixeds)
<br/>
</td> </tr></table><span class="postbody">More fractional bits means higher accuracy, but also more chance of overflow. It's usually a good idea to use a standard number of fractional bits for you FPM because you can't just add the numerators of fractions that have different denominators (1/3 + 1/4 ≠ 2/4, etc). You're likely to see .8, .12 or .16 fixed point in the GBA/NDS world, though possibly others as well. Fractional arithmetic is covered in primary school, so it should know this stuff already. For a little more on fixed point, especially for divisions, go to <a class="postlink" href="http://www.coranac.com/tonc/text/fixed.htm" target="_blank">tonc:fixed</a>.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Kirby wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>thegamefreak0134 wrote:</b></span></td> </tr> <tr> <td class="quote">I have an idea. Why not (instead of worrying about the screen) take waddledee\'s position in the map as a value. (his position on the level, if you will, regardless of screen positioning.) Then, figure out how far the map is scrolled, and scroll waddledee that much as well. (In this case, the mapscrolled / 8 should do the trick) Boom. You have waddledee\'s position. Since the map is scrolled relative to the screen, you shouldnt have to adjust to the screen at all, just check if he is not on the screen and dont draw him in this case. By doing this, you should effectively eliminate all divides, since the compiler optimizes a divide by 8 to a shift anyway, which is much faster.</td> </tr></table><span class="postbody">
<br/>
It didn't work. I tried every way I could think of to get this to work, but it didn't. </span></td> </tr></table><span class="postbody">Then try again :P. The method thegamefreak0134 and sgeos hint at is probably the best bet.
<br/>
<br/>
Think of it this way. You have the game world, with a given coordinate set. This probably corresponds to the coordinates on the full map. Then you have sprites on the map, each with a pair of world coordinates. Then you have the hardware, which can only show a portion of the world. It can also only hold a small portion of the map (in screenblocks) and the positions of the sprites has to be relative to the screen as well. The <span style="font-style: italic">viewport</span> is the portion of the world you can actually see; it also has a pair of world coordinates. If the world coord-system corresponds to the map coord-system, then the position of the viewport will also be the position you enter into the background offset registers, so that makes that part easier. For the sprites, translate the world positions to screen positions by subtracting by the viewport coords. Then check whether the sprite is in view (check for overlap between sprite rect and viewport). If so, the sprite is visible and you place it accordingly. If not, hide the thing.
<br/>
<br/>
And that's basically it. This should require no division at any time. Scrolling is a matter of repositioning the viewport and translating the world coords to screen coords. If pixel speeds isn't accurate enough, use fixed point math for sub-pixel speeds. For tieing the viewport to a specific sprite, use a function like sgeos mentioned. Make a small, simple demo app to get the basics of a viewport system to work, then carry it over in the game.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Kirby wrote:</b></span></td> </tr> <tr> <td class="quote">Aside from this post's main topic, I'm having another problem. I'm trying to add a bar at the bottom of the screen with Kirby's HP and lives on it. I'm putting it on BG 1, and I'm using Mode 1. I can get the data onto the map correctly, it's just the tileset I'm having a problem with. I'm trying to add the palette to 0x050001C0, and just add E0 to each of the values in the tile array. But when I test it out, one of two things happens:
<br/>
<br/>
<ul>A. The bar looks very weird (palette errors)
<br/>
B. There are black stripes down every other column (I think the colors are inverted)</ul>This is the code I'm using:
<br/>
<br/>
<span style="font-weight: bold">CharBg.h</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include "..\gba.h"
<br/>
#include "CharData.h"
<br/>
#include "CharDataMap.h"
<br/>
#include "..\textsys.h"
<br/>
<br/>
void InitCharData(void);
<br/>
void ShowCharData(u16 hp, u16 lives, u16 points);
<br/>
<br/>
Bg bg1;
<br/>
<br/>
void InitCharData()
<br/>
{
<br/>
   u16 tempg[2560];
<br/>
   u16 tempp[22];
<br/>
   bg1.charBaseBlock = 2;
<br/>
   bg1.colorMode = BG_COLOR_256;
<br/>
   bg1.size = TEXTBG_SIZE_256x256;
<br/>
   u16 i;
<br/>
   for(i=0;i&lt;40*4*8;i++) VRAM[0x4000+i] = CharDataTiles[i] + 0xE0;
<br/>
   for(i=0;i&lt;22;i++) PAL[0xE0+i] = CharDataPalette[i];
<br/>
   //memcpy((u16 *)0x06008000, &amp;tempg, sizeof(CharDataData)); //1125
<br/>
   //memcpy((u16 *)0x050001C0, &amp;CharDataPalette,22);
<br/>
   for(i=0;i&lt;2048;i++) bg1.mapData[i] = CharDataMapMap[i];
<br/>
   bg1.number = 1;
<br/>
}</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
Probably a problem with datatypes. VRAM is in halfwords (u16), that I'm pretty sure of. CharDataTiles is probably either halfwords or bytes. If it is a byte array, you have a mismatch between source and destination types and you're only copying half the data you should. If it's a halfword array, remember you're copying two pixels at once and adding 0xE0 will only work on one of them. Try adding 0xE0E0.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Kirby wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">u16 i</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">For the third time, <span style="font-weight: bold"><span style="font-size: 12px; line-height: normal">INTS</span></span>! I know this sounds annoying and pedantic, but the standard datatype should be int, either signed or unsigned. You're probably only doing it out of habit, but that's why I keep saying this. The ARM cpu is a 32bit processor. The native datatype (the word size) is 32 bits long, and other datatypes such as u16 have to be forced to stay that way. Using non-word datatypes for local variables can makes the code longer, slower and is more prone to <a class="postlink" href="http://www.coranac.com/tonc/text/bitmaps.htm#ssec-data-align" target="_blank">alignment </a> and overflow problems. Doing the Right Thing in the first place is so ridiculously easy that doing otherwise can be considered a form of pessimisation. Unless you actually have a good reason for using non-ints, don't. Break the habit, you'll benefit from it in the long run.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104468 - thegamefreak0134 - Fri Sep 29, 2006 1:49 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Then try again :P. The method thegamefreak0134 and sgeos hint at is probably the best bet. </td> </tr></table><span class="postbody">
<br/>
<br/>
Whoa. I was actually right? Awesomeness! (Sorry, I just had to.)
<br/>
<br/>
I can probably give you some example code, but it will take me a day because I\'m at school and my compiler is at home. Something bothers me though...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I wrote a small program that gets the Fixed Point expression \"(x * y) &gt;&gt; z\" from a Floating Point division \"x / y\", so if you have to do a decimal division, you could turn it in to a Fixed Point expression. Do you think I should send it to gbadev.org, or is FPM something easy to work out and nobody would use my program? </td> </tr></table><span class="postbody">
<br/>
<br/>
??? What kind of equasion are you supposed to be getting? If you are trying to get a non-power of two for division I can see the usefulness here, but for a map this should not be necessary... Oh wait. Ah, I see. Nevermind. Yes, to answer your question.
<br/>
<br/>
-gamefreak
<br/>
<br/>
Will post code tomorrow, if I can. Affine maps, single sprite in middle that doesn\'t move, various enemy sprites that are tied to the map. Should work out alright.<br/>_________________<br/>What if the hokey-pokey really is what it's all about?
<br/>
<br/>
[url=http:/www.darknovagames.com/index.php?action=recruit&amp;clanid=1]Support Zeta on DarkNova![/url]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104513 - Kirby - Fri Sep 29, 2006 11:21 pm</h4>
    <div class="postbody"><span class="postbody">Oh, shoot! My post was deleted! And it was a long one! Great.</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cearn wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Kirby wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>thegamefreak0134 wrote:</b></span></td> </tr> <tr> <td class="quote">I have an idea. Why not (instead of worrying about the screen) take waddledee\'s position in the map as a value. (his position on the level, if you will, regardless of screen positioning.) Then, figure out how far the map is scrolled, and scroll waddledee that much as well. (In this case, the mapscrolled / 8 should do the trick) Boom. You have waddledee\'s position. Since the map is scrolled relative to the screen, you shouldnt have to adjust to the screen at all, just check if he is not on the screen and dont draw him in this case. By doing this, you should effectively eliminate all divides, since the compiler optimizes a divide by 8 to a shift anyway, which is much faster.</td> </tr></table><span class="postbody">It didn't work. I tried every way I could think of to get this to work, but it didn't.</span></td> </tr></table><span class="postbody">Then try again :P. The method thegamefreak0134 and sgeos hint at is probably the best bet. 
<br/>
<br/>
Think of it this way. You have the game world, with a given coordinate set. This probably corresponds to the coordinates on the full map. Then you have sprites on the map, each with a pair of world coordinates. Then you have the hardware, which can only show a portion of the world. It can also only hold a small portion of the map (in screenblocks) and the positions of the sprites has to be relative to the screen as well. The viewport is the portion of the world you can actually see; it also has a pair of world coordinates. If the world coord-system corresponds to the map coord-system, then the position of the viewport will also be the position you enter into the background offset registers, so that makes that part easier. For the sprites, translate the world positions to screen positions by subtracting by the viewport coords. Then check whether the sprite is in view (check for overlap between sprite rect and viewport). If so, the sprite is visible and you place it accordingly. If not, hide the thing. </span></td> </tr></table><span class="postbody">I'll have you know that that was what I was doing the entire time since I started AI characters!!!!!!!! Just taking his X and Y, and subtracting the left and top of the screen (or as you say, viewpoint). IT DOESN'T WORK! There have always been speed problems. The closest I could get it to work is with FPM!!!!!!!</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>thegamefreak0134 wrote:</b></span></td> </tr> <tr> <td class="quote">Whoa. I was actually right? Awesomeness! (Sorry, I just had to.)</td> </tr></table><span class="postbody">It's OK. I know the feeling...</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>thegamefreak0134 wrote:</b></span></td> </tr> <tr> <td class="quote">I can probably give you some example code, but it will take me a day because I\'m at school and my compiler is at home. Something bothers me though...</td> </tr></table><span class="postbody">Thanx! I'd like to see what you are all thinking of, because to me, at least, it doesn't work. Also, thanx for the frame update code, I never did get back to thanking you.</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cearn wrote:</b></span></td> </tr> <tr> <td class="quote">Try adding 0xE0E0.</td> </tr></table><span class="postbody">Thanx for that one, too. It looks great now, but the back is now all blue, and blocking the rest of the backgrounds. Is there either:<ul>A. a way to add priority to the other backgrounds so they appear in front? or
<br/>
B. a way to change the blues so that they are transparent?</ul></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cearn wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Kirby wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">u16 i</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">For the third time, INTS! I know this sounds annoying and pedantic, but the standard datatype should be int, either signed or unsigned. You're probably only doing it out of habit, but that's why I keep saying this. The ARM cpu is a 32bit processor. The native datatype (the word size) is 32 bits long, and other datatypes such as u16 have to be forced to stay that way. Using non-word datatypes for local variables can makes the code longer, slower and is more prone to alignment and overflow problems. Doing the Right Thing in the first place is so ridiculously easy that doing otherwise can be considered a form of pessimisation. Unless you actually have a good reason for using non-ints, don't. Break the habit, you'll benefit from it in the long run.</span></td> </tr></table><span class="postbody">Sorry about the halfwords! It's just, when I was just learning GBA Programming, the two tutorials I used both used u16, and then it grew into a habit.<br/>_________________<br/>Knock-knock.
<br/>
Whose there?
<br/>
Kirby.
<br/>
Kirby-who?
<br/>
I told you! Kirby!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104514 - Kirby - Fri Sep 29, 2006 11:22 pm</h4>
    <div class="postbody"><span class="postbody">OK. More news on my program:<ul>A. It should be able to work out a #'s FP even if it is 5 digits long because I added a function that increases the work done when the number is longer.
<br/>
B. Smaller numbers will be done more quickly, for the reason above.
<br/>
C. The error ratio is about is about x:y. That means that the result of the equation will be y bigger or smaller than x, or equal to x. Y is the number of digits in X - 1. So a one or two digit number will only be 0 or 1 off, but a four digit number could be 3 off. This is because of the rounding errors the GBA has.
<br/>
D. I already have two people (actually, 1 and a half) people telling me to post it. I you think I should, please tell me. If 3 more people vouch for it, I'll post it.</ul>To prove that it works, I'll give a few examples:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code"> x / y | (x * y) &gt;&gt; z
<br/>
-------+---------------
<br/>
 x / 1 | (x * 4) &gt;&gt; 2
<br/>
 x / 2 | (x * 2) &gt;&gt; 2
<br/>
x / 2.4| (x * 13) &gt;&gt; 5</td> </tr></table><span class="postbody">Feel free to try these with a calculator. If your calulator doesn't have a Right-Shift, like mine, use this for the FPM: "((x * y) / 2) / x". After you round them off, and apply C above, you will see that it works good.
<br/>
<br/>
Also, if you are wondering why I a talking about this in this topic, instead of making another one, it is because I found that I had accidentally posted on of my posts twice, so I replaced the double with this.<br/>_________________<br/>Knock-knock.
<br/>
Whose there?
<br/>
Kirby.
<br/>
Kirby-who?
<br/>
I told you! Kirby!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104524 - Cearn - Sat Sep 30, 2006 2:18 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Kirby wrote:</b></span></td> </tr> <tr> <td class="quote">I'll have you know that that was what I was doing the entire time since I started AI characters!! Just taking his X and Y, and subtracting the left and top of the screen (or as you say, viewpoint). IT DOESN'T WORK! There have always been speed problems. The closest I could get it to work is with FPM!!</td> </tr></table><span class="postbody">
<br/>
Ah! I thought you meant  "didn't work" as in the technique didn't function properly. Whether or not it's fast enough is another matter. Well, cutting down on divisions should matter quite a bit. The GCC division routine isn't particularly fast and can cost as much as 100 times more as a multiplication, if I recall correctly (I seem to have misplaced the file here I put those timing tests :( ). Cutting those out should have helped. Seems a little odd that this would be such a bottleneck, though: all it calls for is adds/subtracts and a few checks. Have you tried timing the routines? If not, do so: it will give tell you where all those cycles are going and what you should work on to get them back. for a simple example of setting up something like that, go <a class="postlink" href="http://www.coranac.com/tonc/text/text.htm#ssec-demo-se2" target="_blank">here</a>.
<br/>
Also, how many objects are we talking about here? A dozen? Hundreds? Even at 100 cycles for 100 objects there should be plenty of time left in the VBlank. If there anyway we can play with the code ourselves to find the problem?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Kirby wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cearn wrote:</b></span></td> </tr> <tr> <td class="quote">Try adding 0xE0E0.</td> </tr></table><span class="postbody">Thanx for that one, too. It looks great now, but the back is now all blue, and blocking the rest of the backgrounds. Is there either:<ul>A. a way to add priority to the other backgrounds so they appear in front? or
<br/>
B. a way to change the blues so that they are transparent?</ul></span></td> </tr></table><span class="postbody">
<br/>
The standard order from front to back is objects, bg0, bg1, bg2, bg3. If you've organized the backgrounds in that order, there should be no problem. You can also break the normal order by using bits 0 and 1 of REG_BGxCNT.
<br/>
The blue thing is probably because by adding 0xE0 to all the pixels, there are no pixels with '0' anymore, so nothing will be transparent. Only a pixel value of 0 is transparent. Try this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int ii;
<br/>
u16 *dst= (u16*)&amp;VRAM[0x4000], src= (u16*)CharDataTiles;
<br/>
u32 in, out;
<br/>
<br/>
for(ii=0; ii&lt;40*4*8; ii++)
<br/>
{
<br/>
    out= 0;
<br/>
    in= src[ii];
<br/>
    // Check 2 pixels for 0-ness; only apply the offset if they're not
<br/>
    if( in &amp; 255 )
<br/>
        out = (in&amp;255) + 0xE0;
<br/>
    if( in &amp;~255 )
<br/>
        out += (in&amp;~255)+0xE000;
<br/>
<br/>
    // write 2 pixels to the proper VRAM destination
<br/>
    dst[ii]= out;
<br/>
}</td> </tr></table><span class="postbody">Untested, but should work. Faster version may be possible, but it's getting a little late here, so maybe another time. One thing to look out for here is that the pixel value + 0xE0 should not be over 255, or it'll bleed into the next pixel. Also note the use of pointers instead of VRAM and CharDataTiles directly. The use of pointers and temp variables can keep code cleaner and more maintainable. The code in <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?p=102601#102601" target="_blank">this post</a> would be a lot more readable if you'd use a pointer to keep track of 'Characters[i]' and a temp for the frequently used 'Characters[i].state'.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Kirby wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cearn wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Kirby wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">u16 i</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">For the third time, INTS! I know this sounds annoying and pedantic, but the standard datatype should be int, either signed or unsigned. You're probably only doing it out of habit, but that's why I keep saying this. The ARM cpu is a 32bit processor. The native datatype (the word size) is 32 bits long, and other datatypes such as u16 have to be forced to stay that way. Using non-word datatypes for local variables can makes the code longer, slower and is more prone to alignment and overflow problems. Doing the Right Thing in the first place is so ridiculously easy that doing otherwise can be considered a form of pessimisation. Unless you actually have a good reason for using non-ints, don't. Break the habit, you'll benefit from it in the long run.</span></td> </tr></table><span class="postbody">Sorry about the halfwords! It's just, when I was just learning GBA Programming, the two tutorials I used both used u16, and then it grew into a habit.</span></td> </tr></table><span class="postbody">A lot of the older tutorials teach bad habits, of which this is one. The other major one is putting data (like graphics) in header files and then #including them, instead of compiling them and linking them or using a file system. In fact, if you're doing this as well, it may be the reason why memcpy() fails for graphic transfers. Both source and destination addresses need to be word aligned for memcpy() to work properly, which is likely not the case if you #include the data arrays (unless they happen to be u32 arrays, which are guaranteed word-aligned).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104531 - Kirby - Sat Sep 30, 2006 5:29 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cearn wrote:</b></span></td> </tr> <tr> <td class="quote">The other major one is putting data (like graphics) in header files and then #including them, instead of compiling them and linking them or using a file system. In fact, if you're doing this as well, it may be the reason why memcpy() fails for graphic transfers. Both source and destination addresses need to be word aligned for memcpy() to work properly, which is likely not the case if you #include the data arrays (unless they happen to be u32 arrays, which are guaranteed word-aligned).</td> </tr></table><span class="postbody">Nice try, but that's not what I'm doing. My makefile uses gfx2gba to translate all of the pictures at the same time into .s files, and then I use as to assemble them all into one object file.</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cearn wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int ii; 
<br/>
u16 *dst= (u16*)&amp;VRAM[0x4000], src= (u16*)CharDataTiles; 
<br/>
u32 in, out; 
<br/>
<br/>
for(ii=0; ii&lt;40*4*8; ii++) 
<br/>
{ 
<br/>
    out= 0; 
<br/>
    in= src[ii]; 
<br/>
    // Check 2 pixels for 0-ness; only apply the offset if they're not 
<br/>
    if( in &amp; 255 ) 
<br/>
        out = (in&amp;255) + 0xE0; 
<br/>
    if( in &amp;~255 ) 
<br/>
        out += (in&amp;~255)+0xE000; 
<br/>
<br/>
    // write 2 pixels to the proper VRAM destination 
<br/>
    dst[ii]= out; 
<br/>
}</td> </tr></table><span class="postbody">Untested, but should work.</span></td> </tr></table><span class="postbody">It does. Thanx. But now it's map looks weird. Do you know of any map editors that export u16 values? I was trying your Mirach, but it exports u32's, which don't copy into VRAM correctly using you're code above.</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Kirby wrote:</b></span></td> </tr> <tr> <td class="quote">If your calulator doesn't have a Right-Shift, like mine, use this for the FPM: "((x * y) / 2) / x". After you round them off, and apply C above, you will see that it works good.</td> </tr></table><span class="postbody">Just a quick fix, but "((x * y) / 2) / x" is the incorrect way to be going about this. Instead, go "(x * y) &lt;&lt; -z". Why the calculator has Left Shift and not right, I do not know.</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cearn wrote:</b></span></td> </tr> <tr> <td class="quote">The GCC division routine isn't particularly fast and can cost as much as 100 times more as a multiplication, if I recall correctly (I seem to have misplaced the file here I put those timing tests :( ).</td> </tr></table><span class="postbody">Now do you know why I wrote FPU2FPM?<br/>_________________<br/>Knock-knock.
<br/>
Whose there?
<br/>
Kirby.
<br/>
Kirby-who?
<br/>
I told you! Kirby!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104561 - Cearn - Sat Sep 30, 2006 12:28 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Kirby wrote:</b></span></td> </tr> <tr> <td class="quote">It does. Thanx. But now it's map looks weird. Do you know of any map editors that export u16 values? I was trying your Mirach, but it exports u32's, which don't copy into VRAM correctly using you're code above.</td> </tr></table><span class="postbody">If you temporary pointers like I did here, the datatype of the original addresses becomes irrelevant. And the map looks weird how?
<br/>
<br/>
Oh, since you say the routine works, I take it you noticed that 'src' should have been a pointer too?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Kirby wrote:</b></span></td> </tr> <tr> <td class="quote">If your calulator doesn't have a Right-Shift, like mine, use this for the FPM: "((x * y) / 2) / x". After you round them off, and apply C above, you will see that it works good.</td> </tr></table><span class="postbody">Just a quick fix, but "((x * y) / 2) / x" is the incorrect way to be going about this. Instead, go "(x * y) &lt;&lt; -z". Why the calculator has Left Shift and not right, I do not know.[/quote]
<br/>
Calculator has a left-shift? *checks* Heh, Cool!. Well, the reason for not having a Rsh is probably for button parsimony. There's no Sqrt either, but you can make that with Inv-x^2. Inv-Lsh is Rsh.
<br/>
<br/>
About your program: consider x / 2.4 | (x * 13) &gt;&gt; 5, with x= 12
<br/>
12/2.4 = 5.
<br/>
(12*13)&gt;&gt;5 = 4.875 = 4
<br/>
<br/>
With only 5 bits, the division will degenerate rapidly, which will have a noticeable effect on your scrolling.
<br/>
<br/>
However, with (x*107)&gt;&gt;8 you're safe till 67. More fractional bits mean more higher accuracy, though at some point you'll have to start worrying about overflow again. Take the expected range of <span style="font-style: italic">x</span> into account when finding the number of bits. I did have safety guidelines for guaranteed equality between reciprocal multiplication and division, but it seems they don't work with fractional denominators :( Oh well.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104565 - Mucca - Sat Sep 30, 2006 1:14 pm</h4>
    <div class="postbody"><span class="postbody">Cearn, I commend your patience.
<br/>
<br/>
Kirby, forget everything you think you know about fixed point math as you've patently misunderstood the concept.
<br/>
<br/>
Fixed point is a way of storing a number as a number and a power-of-two friendly fraction. In decimal, we're used to writing fractions in tenths, hundreths, thousands. In fixed point we use eights, sixteenths, 1/256s, 1/65536s. 
<br/>
<br/>
Now, while you may have chanced across a couple of numbers which seem to accurately represent a float, the goal should be to create a system which can handle any number automatically. Its really very simple. Addition and subtraction is the same on a fixed point number as on a normal integer. With division and multiplication an extra step is required.
<br/>
<br/>
For simplicity and clarity, use one type of fixed-point format. Lets use 16-16, ie 1 sign bit, 15 bits for integer, and 16 bits for the fraction. But dont worry, its not that difficult to change.
<br/>
<br/>
In C, where theres no classes and no operator overloading, your best bet is to write a few functions.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
// define how many bits are used for fraction
<br/>
#define FP_FRACTION_BITS    16
<br/>
<br/>
// for extra readability, make a typedef
<br/>
typedef s32  FP;
<br/>
<br/>
// "construct" a fixed point from a normal integer
<br/>
FP fix( s32 val )
<br/>
{
<br/>
    FP fp = val &lt;&lt; FP_FRACTION_BITS ;
<br/>
    return fp;
<br/>
}
<br/>
<br/>
// "construct" from a float
<br/>
FP fix( float f )
<br/>
{
<br/>
    FP fp = (FP)(f * ( 1 &lt;&lt; FP_FRACTION_BITS));
<br/>
    return fp;
<br/>
}
<br/>
<br/>
// multiply two fixed point numbers
<br/>
FP fix_mul( FP fp1, FP fp2 )
<br/>
{
<br/>
    s64 tmp = (s64)fp1 * (s64)fp2;
<br/>
    FP prod  = (FP)(tmp &gt;&gt;  FP_FRACTION_BITS);
<br/>
    return prod;
<br/>
}
<br/>
<br/>
// divide one fixed point number by another
<br/>
FP fix_div( FP dividend, FP divisor )
<br/>
{
<br/>
    s64 tmp = (s64)(dividend &lt;&lt; 32);
<br/>
    FP quotient = (FP)(( tmp / divisor ) &gt;&gt; (32 - FP_FRACTION_BITS));
<br/>
    return quotient;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Usage looks like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
FP a = fix(4);
<br/>
FP b = fix(2.5f);
<br/>
<br/>
FP c = fix_mul( a, b );
<br/>
<br/>
c = fix_div( a, c );
<br/>
a = a - b + c;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
One downfall here is that, despite the typedef, the compiler wont do a good job of enforcing type correctness. You just have to be careful.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104570 - Cearn - Sat Sep 30, 2006 1:42 pm</h4>
    <div class="postbody"><span class="postbody">Two addenda to what Mucca just said:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mucca wrote:</b></span></td> </tr> <tr> <td class="quote">Lets use 16-16, ie 1 sign bit, 15 bits for integer, and 16 bits for the fraction. </td> </tr></table><span class="postbody">
<br/>
Unlike floating point number, <a class="postlink" href="http://en.wikipedia.org/wiki/Signed_number_representations" target="_blank">signed integers</a> (and hence fixed point numbers) never have <span style="font-style: italic">a</span> sign bit, not in the truest sense of the word. For example, The 16bit representation of -1 is 0xFFFF, not 0x8001, which it would be with a real sign bit. Two's complement integers interpret the top half of their range as negative numbers, 'wrapped around' at 0:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">0x8000 ... 0xFFFE 0xFFFF 0x0000 0x0001 0x0002 ... 0x7FFF
<br/>
-2^15  ...   -2     -1     0      1      2    ... +2^15-1
<br/>
</td> </tr></table><span class="postbody">
<br/>
Yes, this does mean that the most significant bit tells you whether the number is negative or not, but that is merely incidental to the whole scheme; for smaller negative numbers, later bits will indicate the sign just as well.
<br/>
<br/>
Also, inlining those functions might be a good idea. OTOH, 64bit math is slow in thumb code, so having fix_mul and fix_div as ARM functions will probably be faster than inlined THUMB versions.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104579 - poslundc - Sat Sep 30, 2006 5:08 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cearn wrote:</b></span></td> </tr> <tr> <td class="quote">OTOH, 64bit math is slow in thumb code, so having fix_mul and fix_div as ARM functions will probably be faster than inlined THUMB versions.</td> </tr></table><span class="postbody">
<br/>
<br/>
I'm pretty sure a 64-bit multiply compiled in Thumb mode will just branch off to extra ARM code anyway, since Thumb doesn't provide a 64-bit multiply instruction.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104580 - gmiller - Sat Sep 30, 2006 5:19 pm</h4>
    <div class="postbody"><span class="postbody">The only format for interger that actually HAD a sign bit was signed magnitude.  For signed magmitude the range for integer was the same for positive and negative, not like the 2's complement system which goes one more negative than positive.
<br/>
<br/>
for example: (for an eight bit system)
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
Type           Max                    Min
<br/>
-----------   -----------------    -----------------------
<br/>
signed        +127                  -127
<br/>
magnitude
<br/>
<br/>
2's comp.    +127                  -128
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
Just for "edification":
<br/>
<br/>
The switch beween signed magnitude and the complement systems (1's and 2's) came about to simplify the math hardware.  The the switch from 1's to 2's complement came about to simplify the hardware even more.  Sorry, I teach Machine Architecture so I can be pretty annal about this some times.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104581 - tepples - Sat Sep 30, 2006 5:28 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">I'm pretty sure a 64-bit multiply compiled in Thumb mode will just branch off to extra ARM code anyway, since Thumb doesn't provide a 64-bit multiply instruction.</td> </tr></table><span class="postbody">
<br/>
But will the automatic support for long long arithmetic be smart enough to put the ARM backends in fast 32-bit RAM (IWRAM on the GBA or ITCM on the DS)?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104589 - Cearn - Sat Sep 30, 2006 6:15 pm</h4>
    <div class="postbody"><span class="postbody">gmiller: good points.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cearn wrote:</b></span></td> </tr> <tr> <td class="quote">OTOH, 64bit math is slow in thumb code, so having fix_mul and fix_div as ARM functions will probably be faster than inlined THUMB versions.</td> </tr></table><span class="postbody">
<br/>
<br/>
I'm pretty sure a 64-bit multiply compiled in Thumb mode will just branch off to extra ARM code anyway, since Thumb doesn't provide a 64-bit multiply instruction.
<br/>
<br/>
Dan.</span></td> </tr></table><span class="postbody">
<br/>
Nope. At least not with standard DKP flags. It uses __aeabi_lmul for the 64bit multiply, which is a THUMB function. A fairly long thumb function to boot. Quick and dirty tests with various versions of fix_mul() doing 123456*123456:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">pure THUMB  | 339 cycles
<br/>
ARM/ROM     | 109 cycles
<br/>
ARM/IWRAM   | 69 cycles
<br/>
</td> </tr></table><span class="postbody">
<br/>
Even the ARM/ROM version is a good deal faster than THUMB with the __aeabi_lmul call. FYI: if the cycle counts for the ARM functions seem high: remember that there's a 30-60 cycle function overhead.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104593 - tepples - Sat Sep 30, 2006 6:50 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cearn wrote:</b></span></td> </tr> <tr> <td class="quote">FYI: if the cycle counts for the ARM functions seem high: remember that there's a 30-60 cycle function overhead.</td> </tr></table><span class="postbody">
<br/>
Where does this overhead come from? Last I checked, a call to a leaf function that doesn't need more than five registers involved loading its code address into a register (3 cycles), a bx into the function (3 cycles), and a bx out of the function (3 cycles).<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104596 - Cearn - Sat Sep 30, 2006 7:07 pm</h4>
    <div class="postbody"><span class="postbody">ROM/EWRAM code waitstates. 1S and 1N take 3 or more cycles so that your numbers need to be multiplied by 3 or so. For each argument and return value, add 1 mov or ldr. Jumping to IWRAM takes one or two ldr's and a bx more, and possible stack work takes up some more instructions as well. All with waitstates. It can add up pretty quickly.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104608 - Mucca - Sat Sep 30, 2006 9:12 pm</h4>
    <div class="postbody"><span class="postbody">Regarding the times posted by Cearn, that's an incredible performance gap on such a fundamental operation such as multiplying a number. Hmm, so far I've never bothered compiling to ARM and loading to IWRAM, its problematic with gcc 2.9.5 involving various shenanigans and I couldn't afford to spend the time getting it to work. Apart from that I've never really had performance problems. But such a yield is definitely tempting.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104635 - Kirby - Sun Oct 01, 2006 12:22 am</h4>
    <div class="postbody"><span class="postbody"><ul>First, maybe I should have put this program into another topic, because of the amount of posts it seems to have accumalated.
<br/>
<br/>
Second, I know what Fixed Point Math is. I know my program doesn't actually do fixed point math, it just converts a division problem into a shift problem. I call it FPU2FPM because the division IS floating-point, and the shift SEEMS like fixed point. I read all about fixed point at TONC. OK?
<br/>
<br/>
Third, Cearn, I tested out the #'s with 64, not 12. As I said before, the margin of error is about the number of digits in x. It does work. In my game, when using the system, you can hardly tell that there is a scrolling problem, and that's in VBA at 4x Video mode!</ul>I'm sorry that I made the mistake of calling it Fixed Point Math, because I can see the huge reaction it created. By calling it Fixed Point, I meant it SEEMED like Fixed Point. If I though that it was possible, I would ask a moderator to move these posts to a new topic called Floating Point to Fixed Point.
<br/>
<br/>
Now, more importantly,</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cearn wrote:</b></span></td> </tr> <tr> <td class="quote">If you temporary pointers like I did here, the datatype of the original addresses becomes irrelevant. And the map looks weird how?</td> </tr></table><span class="postbody">It looks weird, because the first map I made was made incorrectly, then I tried Mirach, which exported u32 data, so I had to change the code to this:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">for(i=0;i&lt;1024;i++) bg1.mapData[i*2] = CharDataMapData[i];</td> </tr></table><span class="postbody">, but then only every other collumn is shown.
<br/>
<br/>
Now, if you all really want me to create a new topic on the FPM, I will, but I see no point. (Haha... fixed point... gettit?)<br/>_________________<br/>Knock-knock.
<br/>
Whose there?
<br/>
Kirby.
<br/>
Kirby-who?
<br/>
I told you! Kirby!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104639 - Kirby - Sun Oct 01, 2006 2:02 am</h4>
    <div class="postbody"><span class="postbody">Never mind about the map thing, I've fixed it. And the error I was talking about on page 3 is...</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">Characters[edit].CharaXaccel = base.CharaXaccel; 
<br/>
   Characters[edit].CharaXaccelEnabled = base.CharaXaccelEnabled; 
<br/>
   Characters[edit].CharaXspeed = base.CharaXspeed; 
<br/>
   Characters[edit].CharaXspeedEnabled = base.CharaXspeedEnabled; 
<br/>
   Characters[edit].CharaYaccel = base.CharaYaccel; 
<br/>
   Characters[edit].CharaYaccelEnabled = base.CharaYaccelEnabled;</td> </tr></table><span class="postbody">Right in the definition of Characters.h, there was an error. If you've peeked at thegamefreak0134's State code before, you'd know what this is. I copied all of the base's data to the character... except for it's Y data. Because of this, WaddleDee could not fall to the ground and start walking, which left him floating in the air. Full points to anyone else who found this out!
<br/>
<br/>
Now, if anyone knows where I can get good Kirby tilesets, or good enemy sprites, please tell me.<br/>_________________<br/>Knock-knock.
<br/>
Whose there?
<br/>
Kirby.
<br/>
Kirby-who?
<br/>
I told you! Kirby!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104642 - tepples - Sun Oct 01, 2006 2:19 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Kirby wrote:</b></span></td> </tr> <tr> <td class="quote">Now, if anyone knows where I can get good Kirby tilesets, or good enemy sprites, please tell me.</td> </tr></table><span class="postbody">
<br/>
From backups of your own Game Paks.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104645 - Kirby - Sun Oct 01, 2006 2:48 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Kirby wrote:</b></span></td> </tr> <tr> <td class="quote">Now, if anyone knows where I can get good Kirby tilesets, or good enemy sprites, please tell me.</td> </tr></table><span class="postbody">
<br/>
From backups of your own Game Paks.</span></td> </tr></table><span class="postbody">Actually, that's not a bad idea! Thanx! I didn't think of that.
<br/>
<br/>
Now I'm up to getting Kirby to collide with WaddleDee. I know this is probably very simple, but I've had problems with it in all of my games. After enemy collision is complete, I'll be able to start working on the real game!<br/>_________________<br/>Knock-knock.
<br/>
Whose there?
<br/>
Kirby.
<br/>
Kirby-who?
<br/>
I told you! Kirby!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104659 - poslundc - Sun Oct 01, 2006 8:20 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cearn wrote:</b></span></td> </tr> <tr> <td class="quote">Nope. At least not with standard DKP flags. It uses __aeabi_lmul for the 64bit multiply, which is a THUMB function. A fairly long thumb function to boot. Quick and dirty tests with various versions of fix_mul() doing 123456*123456:
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">pure THUMB  | 339 cycles
<br/>
ARM/ROM     | 109 cycles
<br/>
ARM/IWRAM   | 69 cycles
<br/>
</td> </tr></table><span class="postbody">
<br/>
Even the ARM/ROM version is a good deal faster than THUMB with the __aeabi_lmul call. FYI: if the cycle counts for the ARM functions seem high: remember that there's a 30-60 cycle function overhead.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
I've not used DKP, but I seem to remember it generating bx instructions into ARM code, back and forth, in DKA. That was a few years ago that I was looking into that stuff, though, so I may be remembering something else. (And no, tepples, it certainly wouldn't give any consideration to what memory section the generated code should be put into.)
<br/>
<br/>
I'm a little shocked by those ARM/IWRAM timings as well. But it's too late at night for me to hunt down my calculator, instruction timing sheet and list of memory region waitstates to try and figure it out for myself. But I instinctively think a good optimizing compiler should be able to do a somewhat better job than that (even having to set up the function call in Thumb), if you are using non-default ROM waitstates.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104674 - Cearn - Sun Oct 01, 2006 12:51 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Kirby wrote:</b></span></td> </tr> <tr> <td class="quote">Second, I know what Fixed Point Math is. I know my program doesn't actually do fixed point math, it just converts a division problem into a shift problem. I call it FPU2FPM because the division IS floating-point, and the shift SEEMS like fixed point. I read all about fixed point at TONC. OK?</td> </tr></table><span class="postbody">Well, yes, it is part of fixed point, but a very small part. When it comes to scrolling, there is no reason to use divisions at all, just use additive speeds. But I think you got that already :P
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Kirby wrote:</b></span></td> </tr> <tr> <td class="quote">Third, Cearn, I tested out the #'s with 64, not 12. As I said before, the margin of error is about the number of digits in x. It does work. In my game, when using the system, you can hardly tell that there is a scrolling problem, and that's in VBA at 4x Video mode!</td> </tr></table><span class="postbody">
<br/>
64 just happens to be one of the numbers in which the results are still exact if you use 13/32. Most of the surrounding numbers aren't. It may be hardly noticeable right now, but it should be easy to find something where it isn't noticeable at all. For things like speeds being off by 1 may not be so significant because the motion blurs it away a little; it's to be expected that there's some variation in the last digit. But division is usually used for, well, dividing things. Like x/60 for a seconds to minute conversion, or number-&gt;decimal string (x/10). In these cases it is very important to get it exactly right. For example, an hour's worth of seconds, you need x*4370&gt;&gt;18, or (x&gt;&gt;2)*4370&gt;&gt;16). For more hours you'd need more bits, but at some point you'll run into multiplication overflow.
<br/>
As an aside from that, because the scrolling speed should be a normal FP number, it is better to have it in the same precision as the rest of your FP numbers; a .5 FP is a little non-conventional.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Kirby wrote:</b></span></td> </tr> <tr> <td class="quote">Now, more importantly,<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cearn wrote:</b></span></td> </tr> <tr> <td class="quote">If you temporary pointers like I did here, the datatype of the original addresses becomes irrelevant. And the map looks weird how?</td> </tr></table><span class="postbody">It looks weird, because the first map I made was made incorrectly, then I tried Mirach, which exported u32 data, so I had to change the code to this:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">for(i=0;i&lt;1024;i++) bg1.mapData[i*2] = CharDataMapData[i];</td> </tr></table><span class="postbody">, but then only every other collumn is shown.
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
Yes, because the types are off and you're copying to every other column by the 2*i. Which is why you need the typecasts. Or just a dedicated copy routine that does the casts internally. That's why memcpy uses void pointers, it doesn't care what datatypes you give it. Two examples:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int ii;
<br/>
u16 *dst= (u16*)bg1.mapData, *src= (u16*)CharDataMapData;
<br/>
int size= size_in_bytes;
<br/>
<br/>
for(ii=0; ii&lt; size/2; ii++)
<br/>
    dst[ii]= src[ii];
<br/>
</td> </tr></table><span class="postbody">
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int ii;
<br/>
u32 *dst= (u32*)bg1.mapData, *src= (u32*)CharDataMapData;
<br/>
int size= size_in_bytes;
<br/>
<br/>
for(ii=0; ii&lt; size/4; ii++)
<br/>
    dst[ii]= src[ii];
<br/>
</td> </tr></table><span class="postbody">
<br/>
If you use the data directly you always have to check what the original types are, which will be different for every converter and an annoyance to check all the time. With temporaries you won't have to and you can generally choose any type you want to. I generally cast to u32 because copying will be twice as fast. Of course, it's still better to use a dedicated copier because they can be a good deal faster than manual loops.
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">I've not used DKP, but I seem to remember it generating bx instructions into ARM code, back and forth, in DKA. That was a few years ago that I was looking into that stuff, though, so I may be remembering something else. (And no, tepples, it certainly wouldn't give any consideration to what memory section the generated code should be put into.)</td> </tr></table><span class="postbody">
<br/>
DKA had four different types of libraries, so it's quite possible that it picked ARM code where applicable. As far as I've been able to make out, DKP's C libraries are thumb only.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">I'm a little shocked by those ARM/IWRAM timings as well. But it's too late at night for me to hunt down my calculator, instruction timing sheet and list of memory region waitstates to try and figure it out for myself. But I instinctively think a good optimizing compiler should be able to do a somewhat better job than that (even having to set up the function call in Thumb), if you are using non-default ROM waitstates. </td> </tr></table><span class="postbody">Remember, guys, I said <span style="font-style: italic">quick and dirty</span>. Those results here were from a very simple test case, a carefully picked minimal test case could stand to lose 20 cycles (clock cycles) or so. But then, in real use you won't have minimal cases as well, so the results should give a decent indication.
<br/>
<br/>
Anyway, it's true that the absolute minimum function overhead is just bl+bx, which is 5S+2N. With default waitstates and ROM code that translates to 25. In EWRAM (multiboot / NDS main ram maybe too) it'd be 21, with 3/1 ROM waitstates it's 18. And in an ideal world (or cache I presume) it's only 7; however, most GBA code is still in ROM. Calling an IWRAM function from ROM and returning adds 1 ldr+1 bx -(iwram diff in bx) for 14 extra cycles. 
<br/>
And then there's setting up registers for the function's arguments, potential stackwork and possibly a reshuffle of registers in both caller and callee. If the function is called inside a loop, calling the function prohibits certain optimisations that would have been possible if the code was inlined. Of course, all of this highly depends on function called, so it's really difficult to give a one-size-fits-all figure. 30-60 will have to do for now.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104723 - Kirby - Sun Oct 01, 2006 10:50 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cearn wrote:</b></span></td> </tr> <tr> <td class="quote">64 just happens to be one of the numbers in which the results are still exact if you use 13/32. Most of the surrounding numbers aren't.</td> </tr></table><span class="postbody">My program tests numbers with 64, and if works, it then checks with every # between 2 and (9 x Len(y))</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cearn wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Kirby wrote:</b></span></td> </tr> <tr> <td class="quote">Now, more importantly,<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cearn wrote:</b></span></td> </tr> <tr> <td class="quote">If you temporary pointers like I did here, the datatype of the original addresses becomes irrelevant. And the map looks weird how?</td> </tr></table><span class="postbody">It looks weird, because the first map I made was made incorrectly, then I tried Mirach, which exported u32 data, so I had to change the code to this:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">for(i=0;i&lt;1024;i++) bg1.mapData[i*2] = CharDataMapData[i];</td> </tr></table><span class="postbody">, but then only every other collumn is shown.</span></td> </tr></table><span class="postbody">Yes, because the types are off and you're copying to every other column by the 2*i. Which is why you need the typecasts. Or just a dedicated copy routine that does the casts internally. That's why memcpy uses void pointers, it doesn't care what datatypes you give it.</span></td> </tr></table><span class="postbody">Yeah, I fixed this by changing to mem cpy: </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">memcpy((u32 *)ScreenBaseBlock(24),&amp;CharDataMapData, 2048);</td> </tr></table><span class="postbody">I also added some nice code that makes an HP bar for Kirby: </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void UpdateHP(u16 hp)
<br/>
{
<br/>
   u16 i;
<br/>
   if (hp != hadHP) {
<br/>
      if (hp &gt; hadHP) {
<br/>
         for (i=1;i&lt;=hp;i++) {AddBar(i);}
<br/>
      } else {
<br/>
         for (i=5;i&gt;hp;i--) {RemoveBar(i);}
<br/>
      }
<br/>
      hadHP = hp;
<br/>
   }
<br/>
}
<br/>
<br/>
void AddBar(u16 bar)
<br/>
{
<br/>
   switch (bar) {
<br/>
      case 1: memcpy((u16 *)hpBars[8],5,1);
<br/>
            memcpy((u16 *)hpBars[9],19,1);
<br/>
            break;
<br/>
      case 2: memcpy((u16 *)hpBars[6],5,1);
<br/>
            memcpy((u16 *)hpBars[7],19,1);
<br/>
            break;
<br/>
      case 3: memcpy((u16 *)hpBars[4],5,1);
<br/>
            memcpy((u16 *)hpBars[5],19,1);
<br/>
            break;
<br/>
      case 4: memcpy((u16 *)hpBars[2],5,1);
<br/>
            memcpy((u16 *)hpBars[3],19,1);
<br/>
            break;
<br/>
      case 5: memcpy((u16 *)hpBars[0],5,1);
<br/>
            memcpy((u16 *)hpBars[1],19,1);
<br/>
   }
<br/>
}
<br/>
<br/>
void RemoveBar(u16 bar)
<br/>
{
<br/>
   switch (bar) {
<br/>
      case 1: memcpy((u16 *)hpBars[8],0,1);
<br/>
            memcpy((u16 *)hpBars[9],0,1);
<br/>
            break;
<br/>
      case 2: memcpy((u16 *)hpBars[6],0,1);
<br/>
            memcpy((u16 *)hpBars[7],0,1);
<br/>
            break;
<br/>
      case 3: memcpy((u16 *)hpBars[4],0,1);
<br/>
            memcpy((u16 *)hpBars[5],0,1);
<br/>
            break;
<br/>
      case 4: memcpy((u16 *)hpBars[2],0,1);
<br/>
            memcpy((u16 *)hpBars[3],0,1);
<br/>
            break;
<br/>
      case 5: memcpy((u16 *)hpBars[0],0,1);
<br/>
            memcpy((u16 *)hpBars[1],0,1);
<br/>
   }
<br/>
}</td> </tr></table><span class="postbody">But, when the bar is removed, there is a little blue mark on the map where the bar was. What should I type in for memcpy to have this blue thing removed. (hpBars is an array of addresses) (Oh yeah, by the way, hpBars is an INT array!!!!!)
<br/>
<br/>
And I don't think I made it clear before what I wanted to do. Character collision, I can do. RPG's are especially easy. But what I want to do is use a more advanced system that collides if the pixels overlap, not just if the bounderies overlap.<br/>_________________<br/>Knock-knock.
<br/>
Whose there?
<br/>
Kirby.
<br/>
Kirby-who?
<br/>
I told you! Kirby!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104737 - tepples - Mon Oct 02, 2006 6:08 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Kirby wrote:</b></span></td> </tr> <tr> <td class="quote">But what I want to do is use a more advanced system that collides if the pixels overlap, not just if the bounderies overlap.</td> </tr></table><span class="postbody">
<br/>
Pixel boundaries are generally considered too rough to be effective collision boxes. They often result in characters getting stuck on walls and each other. This is why most side-scrollers even on GBA, which arguably has enough CPU power for, use separate geometry such as bounding circles or boxes for hit detection.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104743 - Kirby - Mon Oct 02, 2006 7:31 am</h4>
    <div class="postbody"><span class="postbody">Updates:
<br/>
<ul>I've added a pause menu with an inventory list and a nice feature called Kirby's Journal. It's not much, but it will be a thing which Kirby writes in every day, so every once in a while in the game, you can press START, press -&gt;, and you will be in Kirby's Journal. Actually... (see <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?p=104742#104742" target="_blank">Kirby's Journal</a>)
<br/>
<br/>
I've started creating the story (not putting it into the game yet, of course)
<br/>
<br/>
I've collected more SFX.</ul>
<br/>
Also, in my game I will not be using pixel collision for map collision, and when you collide with enemies, you would get hurt and start flashing for a few moments. While you are flashing, you cannot get hurt. (any self-respecting Kirby fan knows that)<br/>_________________<br/>Knock-knock.
<br/>
Whose there?
<br/>
Kirby.
<br/>
Kirby-who?
<br/>
I told you! Kirby!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104748 - Cearn - Mon Oct 02, 2006 9:12 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Kirby wrote:</b></span></td> </tr> <tr> <td class="quote">I also added some nice code that makes an HP bar for Kirby: <table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void UpdateHP(u16 hp)
<br/>
{
<br/>
   u16 i;
<br/>
   if (hp != hadHP) {
<br/>
      if (hp &gt; hadHP) {
<br/>
         for (i=1;i&lt;=hp;i++) {AddBar(i);}
<br/>
      } else {
<br/>
         for (i=5;i&gt;hp;i--) {RemoveBar(i);}
<br/>
      }
<br/>
      hadHP = hp;
<br/>
   }
<br/>
}
<br/>
<br/>
void AddBar(u16 bar)
<br/>
{
<br/>
   switch (bar) {
<br/>
      case 1: memcpy((u16 *)hpBars[8],5,1);
<br/>
            memcpy((u16 *)hpBars[9],19,1);
<br/>
            break;
<br/>
      case 2: memcpy((u16 *)hpBars[6],5,1);
<br/>
            memcpy((u16 *)hpBars[7],19,1);
<br/>
            break;
<br/>
      case 3: memcpy((u16 *)hpBars[4],5,1);
<br/>
            memcpy((u16 *)hpBars[5],19,1);
<br/>
            break;
<br/>
      case 4: memcpy((u16 *)hpBars[2],5,1);
<br/>
            memcpy((u16 *)hpBars[3],19,1);
<br/>
            break;
<br/>
      case 5: memcpy((u16 *)hpBars[0],5,1);
<br/>
            memcpy((u16 *)hpBars[1],19,1);
<br/>
   }
<br/>
}
<br/>
<br/>
void RemoveBar(u16 bar)
<br/>
{
<br/>
   switch (bar) {
<br/>
      case 1: memcpy((u16 *)hpBars[8],0,1);
<br/>
            memcpy((u16 *)hpBars[9],0,1);
<br/>
            break;
<br/>
      case 2: memcpy((u16 *)hpBars[6],0,1);
<br/>
            memcpy((u16 *)hpBars[7],0,1);
<br/>
            break;
<br/>
      case 3: memcpy((u16 *)hpBars[4],0,1);
<br/>
            memcpy((u16 *)hpBars[5],0,1);
<br/>
            break;
<br/>
      case 4: memcpy((u16 *)hpBars[2],0,1);
<br/>
            memcpy((u16 *)hpBars[3],0,1);
<br/>
            break;
<br/>
      case 5: memcpy((u16 *)hpBars[0],0,1);
<br/>
            memcpy((u16 *)hpBars[1],0,1);
<br/>
   }
<br/>
}</td> </tr></table><span class="postbody">But, when the bar is removed, there is a little blue mark on the map where the bar was. What should I type in for memcpy to have this blue thing removed. (hpBars is an array of addresses) (Oh yeah, by the way, hpBars is an INT array!!!!!)</span></td> </tr></table><span class="postbody">
<br/>
You're using memcpy to set a single byte? In an integer array? Cast as a (u16*) ?
<br/>
<br/>
That's ... that's ... <span style="font-weight: bold">NO!!</span> &gt;_&lt;
<br/>
<br/>
You don't use memcpy() for variables, you just use a single assignment ('='). memcpy() is for big blocks of transfers, and only becomes beneficial after 16 bytes or so. For single variables, by the time you reach the inside of the function you could have set the value 10 times already.
<br/>
And, of course, if hpBars is an array of pointers to integers ('int *hpBars[]' ?), you're only setting the lower byte in the integer, not the whole integer. Also, if you find yourself writing the exact same code except for one or two values, you're probably doing something wrong. In this case, you can replace both functions with simple arithmetic.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void UpdateHP(int hp)
<br/>
{
<br/>
    int ii;
<br/>
<br/>
    if(hp == hadHP)
<br/>
        return;
<br/>
    
<br/>
    if(hp&gt;hadHP) {
<br/>
        // Assuming hp has a max of 5?
<br/>
        for(ii=0; ii&lt;hp; ii++) {
<br/>
            hpBars[ 8-2*ii][0]= 5;
<br/>
            hpBars[ 9-2*ii][0]= 19;
<br/>
        }
<br/>
    } else {
<br/>
        for(ii=hp; ii&lt;5; ii++) {
<br/>
            hpBars[ 8-2*ii][0]= 0;
<br/>
            hpBars[ 9-2*ii][0]= 0;
<br/>
        }
<br/>
    }
<br/>
    hadHP= hp;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">Should be possible to clean it up further, but I'm not exactly sure how hpBars fits into all this and why it's an array of pointers rather than an array of integers. Notice that I changed the index from u16 to int and let it start at the usual 0 instead of 1. Any particular reason why you made it start at 1?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104749 - Kirby - Mon Oct 02, 2006 10:03 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cearn wrote:</b></span></td> </tr> <tr> <td class="quote">Notice that I changed the index from u16 to int and let it start at the usual 0 instead of 1. Any particular reason why you made it start at 1?</td> </tr></table><span class="postbody">Particular reason why I made it start at 1:<ul>It's a HP bar! It starts at 1 because 0 represents death! Kirby can have 5 HP (yes, I know that is different than usual), and when it gets to 0, poof. ****....</ul></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cearn wrote:</b></span></td> </tr> <tr> <td class="quote">Should be possible to clean it up further, but I'm not exactly sure how hpBars fits into all this and why it's an array of pointers rather than an array of integers.</td> </tr></table><span class="postbody">Maybe then, you'd like to see what's in hpBars:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">const u32 hpBars[10] = {100713628,100713692, //Last Bar
<br/>
100713626,100713690, //4'th Bar
<br/>
100713624,100713688, //3'rd Bar
<br/>
100713622,100713686, //2'nd Bar
<br/>
100713620,100713684}; //1'st Bar</td> </tr></table><span class="postbody">hpBars is an array of ADDRESSES. Sorry, but I don't think you exactly got what it's doing. It's displaying 5 bars that represents Kirby's HP! When he loses 1 hp, a bar vanishes. When he has an energy drink, two bars appear!<br/>_________________<br/>Knock-knock.
<br/>
Whose there?
<br/>
Kirby.
<br/>
Kirby-who?
<br/>
I told you! Kirby!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#104759 - Cearn - Mon Oct 02, 2006 12:39 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Kirby wrote:</b></span></td> </tr> <tr> <td class="quote">Maybe then, you'd like to see what's in hpBars:<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">const u32 hpBars[10] = {100713628,100713692, //Last Bar
<br/>
100713626,100713690, //4'th Bar
<br/>
100713624,100713688, //3'rd Bar
<br/>
100713622,100713686, //2'nd Bar
<br/>
100713620,100713684}; //1'st Bar</td> </tr></table><span class="postbody">hpBars is an array of ADDRESSES. Sorry, but I don't think you exactly got what it's doing. It's displaying 5 bars that represents Kirby's HP! When he loses 1 hp, a bar vanishes. When he has an energy drink, two bars appear!</span></td> </tr></table><span class="postbody">
<br/>
I see now, it's just 5 hearts or something like that on a background. In that case you don't need the hpBars array at all, just a pointer to the screen entry where the hearts start, in this case 0x0600C494, which is screenblock 24, entry (10, 18) I think. Or better, use an offset from the start of the screenblock, since hardcoded addresses (especially in decimal) are generally a bad idea. 
<br/>
<br/>
Assuming we're talking about a text background:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
// Setup pointer to bar in the screenblock
<br/>
// u16 *hpBar= &amp;se_mem[24][18*32+10];
<br/>
<br/>
void UpdateHP(int hp)
<br/>
{
<br/>
    int ii;
<br/>
<br/>
    if(hp == hadHP)
<br/>
        return;
<br/>
<br/>
    for(ii=0; ii&lt;hp; ii++)
<br/>
    {   hpBar[ii]= 5;   hpBar[ii+32]= 19;   }
<br/>
    
<br/>
    for(ii=hp; ii&lt;5; ii++)
<br/>
    {   hpBar[ii]= 0;   hpBar[ii+32]=  0;   }
<br/>
<br/>
    hadHP= hp;
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#105024 - Kirby - Thu Oct 05, 2006 8:37 am</h4>
    <div class="postbody"><span class="postbody">Thanx for the tip, Cearn. It really does work.
<br/>
<br/>
This post's news: <ul>I've completed Character collision (it works better than I expected it to)
<br/>
<br/>
I've started the Kirby Journal contest. Check out it <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?p=104742#104742" target="_blank">here</a>.
<br/>
<br/>
I'm still having problems with Chara frame update. (see below)</ul>Thanx for the advice, thegamefreak0134, but it doesn't work for me. And anyway, that wasn't even my problem. My problem is that it won't do all of the characters at the same time, it wants me to write out each memcpy... I'm currently using this:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void frameUpdate() {
<br/>
   u16 i;
<br/>
   for (i=0;i&lt;NumCharas;i++) {
<br/>
      if (Characters[i].map == curmap) {
<br/>
         if (Characters[i].base == 1) {
<br/>
            memcpy( (u16 *)Characters[i].memLoc, waddledeeAnim[Characters[i].frame], 256 );
<br/>
         }
<br/>
      }
<br/>
   }
<br/>
   //memcpy( (u16 *)0x6010800, waddledeeAnim[Characters[0].frame], 256);
<br/>
}</td> </tr></table><span class="postbody">, but even then it goes too slow. Base is a system that updates each character of a certain kind. My two characters are waddledees, so they are both base 1. It works great, but as I said before, it makes it seem as if I'm still doing floating-point division. Does anybody know why this is happening or how to fix it, because it is practically the only think blocking me from starting to make the real game!<br/>_________________<br/>Knock-knock.
<br/>
Whose there?
<br/>
Kirby.
<br/>
Kirby-who?
<br/>
I told you! Kirby!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#105026 - Cearn - Thu Oct 05, 2006 9:06 am</h4>
    <div class="postbody"><span class="postbody">GBA-wise, memcpy runs at around 5.8 cycles/byte, so ~1500 for 256 bytes. While there are faster routines (lookup DMA and CpuFastSet), if these are the only two sprites right now, this is nowhere near enough to cause significant slowdown. However, it is possible that everything else is slow and that adding this code is the final straw; the real problem could very well be elsewhere. Set up some timers and check how long various parts take, that should point you to the parts you need to concentrate on. 
<br/>
<br/>
Also, what are your compiler options? Are you using -mthumb and at least -O1?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#105265 - Kirby - Sat Oct 07, 2006 3:13 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cearn wrote:</b></span></td> </tr> <tr> <td class="quote">Are you using -mthumb and at least -O1?</td> </tr></table><span class="postbody">I'm using -mthumb-interwork, not -mthumb. And, I just found out that using -O2 makes it work. I read somewhere that too much optimization will ruin the game. Is -O2 dangerous, or can I use it?</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cearn wrote:</b></span></td> </tr> <tr> <td class="quote">Set up some timers and check how long various parts take, that should point you to the parts you need to concentrate on.</td> </tr></table><span class="postbody">Though I don't like to admit it, I'm not that good with timers. Plus, I can only use 3 now because I'm using AAS, which uses Timer 1.
<br/>
<br/>
EDIT: OK. New problem. With any kind of optimization, I'm getting a problem:
<br/>
<br/>
-O0 (No op)<ul>Map with AI characters goes too slow</ul>-O1<ul>Game sticks on AAS splash screen and music is twice too fast</ul>-O2<ul>SRAM is deleted on reload</ul>-O3<ul>-O2 and BIOS calls freeze game (fixed this one: -O3 optimizeses away null functions, which includes ones with asm in them)</ul><br/>_________________<br/>Knock-knock.
<br/>
Whose there?
<br/>
Kirby.
<br/>
Kirby-who?
<br/>
I told you! Kirby!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#105289 - Cearn - Sat Oct 07, 2006 11:22 am</h4>
    <div class="postbody"><span class="postbody">What optimization mostly does is prune inefficient code; it isn't necessarily dangerous unless you rely on inefficient code. For example:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
... Do stuff
<br/>
<br/>
for(ii=0; ii&lt;40000; ii++)
<br/>
    ;   // wait a while
<br/>
<br/>
... Do more stuff
<br/>
</td> </tr></table><span class="postbody">
<br/>
In -O0 this would wait a while, but the optimizer will remove the loop because it doesn't actually do anything. But if this was how one timed the action, everything would now go too fast. The 'danger' part that is sometimes mentioned probably refers to checking registers like REG_VCOUNT:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
while(REG_VCOUNT&lt;160)
<br/>
    ;   // Wait for the VBlank
<br/>
</td> </tr></table><span class="postbody">
<br/>
because REG_VCOUNT isn't updated inside the loop, the optimizer knows that this would produce an infinite loop and halt. Something similar might be going on with the BIOS calls. The magic word for cases like these is <span style="font-weight: bold">volatile</span>.
<br/>
<br/>
The timer business might not be necessary now; non-optimized code can be really, <span style="font-style: italic">really</span> slow, so that could very well have been the problem all along. If turning on optimizations breaks the code, chances are you were doing a number of things you weren't supposed to.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#105369 - Kirby - Sun Oct 08, 2006 6:10 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cearn wrote:</b></span></td> </tr> <tr> <td class="quote">If turning on optimizations breaks the code, chances are you were doing a number of things you weren't supposed to.</td> </tr></table><span class="postbody">It doesn't "break" the code. I have a function that runs at the start of the program that checks the SRAM for zeros. If it is zero-filled, it will reset the SRAM to 0xFF. I think the optimizer may be skipping the SRAM check, because when I commented out the function call, the save stays.
<br/>
<br/>
Also, I believe I have finally made enough of the game system to start making the game. The system currently includes:<ul><li>Title Screen
<br/>
</li><li>Sound
<br/>
</li><li>One near-fully playable character
<br/>
</li><li>Scrolling maps
<br/>
</li><li>Intro scene
<br/>
</li><li>AI characters
<br/>
</li><li>HP and lives
<br/>
</li><li>HP and lives bar
<br/>
</li><li>Text System
<br/>
</li><li>Pause Menu
<br/>
</li><li>Inventory
<br/>
</li><li>Kirby's Journal
<br/>
</li><li>Kirby's Journal Cover Page</li></ul><br/>_________________<br/>Knock-knock.
<br/>
Whose there?
<br/>
Kirby.
<br/>
Kirby-who?
<br/>
I told you! Kirby!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#105701 - Kirby - Wed Oct 11, 2006 7:50 am</h4>
    <div class="postbody"><span class="postbody">Small Request here: Does anyone know where I can get GOOD Kirby tilesets? It's really the only thing blocking me from making the game. And, no. The tilesets in the GBA roms are messy and impossible to work with.
<br/>
<br/>
Also, please note that I have posted a previous version of the demo to <a class="postlink" href="http://www.gbadev.org" target="_blank">www.gbadev.org</a>. Sometime, I'll post the complete game system, but that'll be all. If you have read the Kirby's Journal topic, you would see that I'll be trying to sell this someday, so posting a full game onto the internet would be... how should I say this... stupid.<br/>_________________<br/>Knock-knock.
<br/>
Whose there?
<br/>
Kirby.
<br/>
Kirby-who?
<br/>
I told you! Kirby!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#105708 - Mucca - Wed Oct 11, 2006 10:24 am</h4>
    <div class="postbody"><span class="postbody">No more stupid than trying to sell a game with stolen tilesets.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#105785 - tepples - Wed Oct 11, 2006 10:01 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Kirby wrote:</b></span></td> </tr> <tr> <td class="quote">Small Request here: Does anyone know where I can get GOOD Kirby tilesets?</td> </tr></table><span class="postbody">
<br/>
Sure. But first I'll have to see your Nintendo license number to make sure that you are authorized to use GOOD Kirby tilesets in a product that you plan to sell.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#105854 - Kirby - Thu Oct 12, 2006 5:31 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">*Snap* *snap*</td> </tr></table><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mucca wrote:</b></span></td> </tr> <tr> <td class="quote">*Snappy* *Snappy* *snap* *snap* *snap*</td> </tr></table><span class="postbody">OK OK! Two things. First of all, I will end up getting a license, because otherwise I can't use Kirby. Second, I've decided to make my own tilesets after the remarks I'm getting.</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Everybody else wrote:</b></span></td> </tr> <tr> <td class="quote">Yes, Kirby must be right, shame on you tepples and Mucca!</td> </tr></table><span class="postbody"><br/>_________________<br/>Knock-knock.
<br/>
Whose there?
<br/>
Kirby.
<br/>
Kirby-who?
<br/>
I told you! Kirby!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#105863 - tepples - Thu Oct 12, 2006 6:51 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Kirby wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Everybody else wrote:</b></span></td> </tr> <tr> <td class="quote">Yes, Kirby must be right, shame on you tepples and Mucca!</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
<a class="postlink" href="http://en.wikipedia.org/wiki/Powergaming" target="_blank">Powergaming</a> today?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#105869 - sgeos - Thu Oct 12, 2006 7:13 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Kirby wrote:</b></span></td> </tr> <tr> <td class="quote">I will end up getting a license, because otherwise I can't use Kirby.</td> </tr></table><span class="postbody">
<br/>
And how much money do you have?  What is up with people cloning HAL's games and expecting to get licenses to do it?  Are you even incorporated yet?  How many people do you have on staff?  What are your office facilities?
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
