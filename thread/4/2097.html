<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Bad Guys with guns - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > Bad Guys with guns</h2>
<div id="posts">
<div class="post">
    <h4>#10852 - paajjrb - Thu Sep 18, 2003 11:15 am</h4>
    <div class="postbody"><span class="postbody">Hello All, 
<br/>
<br/>
What i need to do is fire bullets from my meanie and get them to travel towards the player, i have tried to adapt code that i has seen in other posts but for some reason it isnt working. The following is what im trying so far,
<br/>
<br/>
    int DeltaX = player.image_x - enemy-&gt;image_x;
<br/>
    int DeltaY = player.image_y - enemy-&gt;image_y;
<br/>
    float Angle = atan(DeltaX / DeltaY);
<br/>
    int hyp = SPEED;
<br/>
<br/>
    bullet-&gt;delta_x = cos(Angle) * hyp;
<br/>
    bullet-&gt;delta_y = sin(Angle) * hyp;
<br/>
<br/>
This sends the bullet flying off the screen, in the opposite direction. Can someone please help</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10856 - col - Thu Sep 18, 2003 3:14 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>paajjrb wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
...
<br/>
    float Angle = atan(DeltaX / DeltaY);
<br/>
...    
<br/>
<br/>
This sends the bullet flying off the screen, in the opposite direction. Can someone please help</td> </tr></table><span class="postbody">
<br/>
<br/>
note that  -x / y is equal to x / -y
<br/>
eg.
<br/>
DeltaX of -3 and DeltaY of 3  (downLeft)
<br/>
will give the same Angle as
<br/>
DeltaX of 3 and DeltaY of -3  (upRight)
<br/>
<br/>
you have to figure out which of the two you have and correct the resulting angle accordingly.
<br/>
<br/>
<br/>
not sure what you mean by flying off screen - is the bullet too fast?
<br/>
<br/>
cheers
<br/>
<br/>
Col</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10859 - Paul Shirley - Thu Sep 18, 2003 5:09 pm</h4>
    <div class="postbody"><span class="postbody">removed</span><span class="gensmall"><br/><br/>Last edited by Paul Shirley on Sun Mar 28, 2004 10:10 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#10864 - col - Thu Sep 18, 2003 6:04 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Paul Shirley wrote:</b></span></td> </tr> <tr> <td class="quote">The alternative is to compute the normalised 2D direction vector and scale it.
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int DeltaX = player.image_x - enemy-&gt;image_x;
<br/>
int DeltaY = player.image_y - enemy-&gt;image_y;
<br/>
float scale = SPEED/sqrt(DeltaX*DeltaX + DeltaY*DeltaY);
<br/>
bullet-&gt;delta_x = DeltaX * scale;
<br/>
bullet-&gt;delta_y = DeltaY * scale;
<br/>
</td> </tr></table><span class="postbody">
<br/>
That's pretty easy to convert to fixed point (or even integer) code <span style="font-weight: bold">and</span> the atan is so expensive this should work out faster even if you use table lookup for sin&amp;cos.
<br/>
<br/>
The net has plenty of fast integer sqrt routines to help speed this up.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
the atan is expensive, but not more so than the sqrt.
<br/>
I would say that the two approaches can both be optimised down to about the same speed !
<br/>
There are a number of ways to quickly generate an atan estimation that is plenty good enough for most game code.
<br/>
<br/>
I imagine the same is true for sqrt, although i've not looked into that as i picked up a highly optimised ARM sqrt from somewhere a while back.
<br/>
<br/>
one thing that might be worth a look is to use an inverse sqrt routine.
<br/>
<br/>
so
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
float scale = SPEED/sqrt(DeltaX*DeltaX + DeltaY*DeltaY);
<br/>
</td> </tr></table><span class="postbody">
<br/>
would become
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
fixed scale = SPEED * isqrt(DeltaX*DeltaX + DeltaY*DeltaY);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
check out this link for possibilities
<br/>
<a href="http://www.finesse.demon.co.uk/steven/invsqrt.html" target="_blank">http://www.finesse.demon.co.uk/steven/invsqrt.html</a>
<br/>
go here 
<br/>
<a href="http://www.finesse.demon.co.uk/steven/sqrt.html" target="_blank">http://www.finesse.demon.co.uk/steven/sqrt.html</a>
<br/>
and look down the page, there is an ARM sqrt that takes only 51 cycles!(the one i found a while back :))
<br/>
<br/>
cheers
<br/>
<br/>
Col</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10874 - jenswa - Thu Sep 18, 2003 8:36 pm</h4>
    <div class="postbody"><span class="postbody">You should probably check if the enemie is above or below you, could even be with left and right.
<br/>
<br/>
So you know to what position the bullets need to go, rather than on line you have now. You only know the line the bullet is moving, not if it should move left, right, up, down or any combination of those two.
<br/>
<br/>
Just like col mentionned.<br/>_________________<br/>It seems this wasn't lost after all.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10878 - Geno - Thu Sep 18, 2003 11:35 pm</h4>
    <div class="postbody"><span class="postbody">1st thing: make a lookup table for Cosines, and remember that the cosine of a number is equal to the sine of the same number plus 90. Example:
<br/>
<br/>
cos( angle ) == sin( angle + 90 )
<br/>
<br/>
will always be true. There are many more formulas that you can create lookup tables for.
<br/>
<br/>
Don't use floats if you can avoid it.
<br/>
<br/>
Last, unless they are hero-seeking missiles(therefore alter their path in mid-flight), you could just have a them go along a predetermined line by coming up with  the slope intercept equation of a line. Simply calculate the x and y ratio of a line connecting the target to the origin. That way you can avoid costly atan and cos and sin.<br/>_________________<br/>Out of Order.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10880 - col - Fri Sep 19, 2003 1:20 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Geno wrote:</b></span></td> </tr> <tr> <td class="quote">...
<br/>
Last, unless they are hero-seeking missiles(therefore alter their path in mid-flight), you could just have a them go along a predetermined line by coming up with  the slope intercept equation of a line. Simply calculate the x and y ratio of a line connecting the target to the origin. That way you can avoid costly atan and cos and sin.</td> </tr></table><span class="postbody">
<br/>
<br/>
This would make the bullet speed change depending on the angle.  I guess if angle dependent bullet speed is in the games design specification then cool ;)
<br/>
<br/>
cheers
<br/>
<br/>
Col</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10886 - FluBBa - Fri Sep 19, 2003 10:50 am</h4>
    <div class="postbody"><span class="postbody">ops<br/>_________________<br/>I probably suck, my not is a programmer.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10888 - paajjrb - Fri Sep 19, 2003 11:16 am</h4>
    <div class="postbody"><span class="postbody">thanks alot for all your help, i now have bullets that are actually deadly :) however i now need to get a faster collision detection algo. if the player starts firing then the enemies bullets stop moving :) ohh the joys of game programming. Ohhh Col, or anyone else kind enough to help, i looked at the page you referred me to, but unfortunately while the code looked great, i dont know how to include it into my game. I looked at other posts about it but they were a little vague. Can someone help with a step by step on how to get ARM code into a game. Thank you again to all for helping me.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10894 - tepples - Fri Sep 19, 2003 3:29 pm</h4>
    <div class="postbody"><span class="postbody">Collision detection is a search problem, and search problems can often be sped up by using sorted data.  <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=1488&amp;highlight=collision+detection+search" target="_blank">Please read my other post on this topic</a>.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10917 - paajjrb - Sat Sep 20, 2003 9:45 am</h4>
    <div class="postbody"><span class="postbody">ok its offcial. ive gone nuts! after staying up to 4am trying to get my collision detection running faster, i woke up this morning to find that it wasnt my collision detection at all. i had just assumed it was, when the real problem was a variable that i forgot to reset to 0!!!! The game, (very basic raiden style) is now running perfectly! Thank you all!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10930 - Geno - Sat Sep 20, 2003 8:49 pm</h4>
    <div class="postbody"><span class="postbody">:D
<br/>
<br/>
Don't you love that? XD<br/>_________________<br/>Out of Order.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10946 - tepples - Sat Sep 20, 2003 11:01 pm</h4>
    <div class="postbody"><span class="postbody">When <span style="font-style: italic">Tetanus On Drugs</span> suddenly started skipping frames on hardware, I turned on the "vcount profiler" and spent a couple days optimizing the gameplay code and poring over the already heavily optimized graphics code only to discover that it wasn't the gameplay code or the graphics code at all; it was an upgrade to DevKit Advance R5b2, which refused to put code in IWRAM; the <span style="font-style: italic">sound</span> mixer took more than a frame as a result. This was one of the reasons for the long delay from <span style="font-style: italic">TOD</span> M2 to M3; I had to wait for R5b3 to be released so that .iwram.o would work properly again.
<br/>
<br/>
I did come out with one good result from the whole thing: much more efficient code for some of the more expensive board evaluations such as searching for macroblocks. I'll bet you learned something about efficient searching for collisions from this exercise as well.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
