<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Can not get gcc to warn about implicit un/signed casting - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Coding > Can not get gcc to warn about implicit un/signed casting</h2>
<div id="posts">
<div class="post">
    <h4>#122722 - sgeos - Wed Mar 21, 2007 3:17 pm</h4>
    <div class="postbody"><span class="postbody">Split from <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=12679&amp;start=43" target="_blank">"Is this font readable?"</a>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>HyperHacker wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sgeos wrote:</b></span></td> </tr> <tr> <td class="quote">How do I get it to complain?  It should complain, but this didn't for me:</td> </tr></table><span class="postbody">Maybe it only does that with hex numbers then.</span></td> </tr></table><span class="postbody">
<br/>
This produced no warnings:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int main(void)
<br/>
{
<br/>
        signed int   sh  = 0xffffffff;
<br/>
        signed int   sn  = -1;
<br/>
        unsigned int uh  = 0xffffffff;
<br/>
        unsigned int un  = -1;
<br/>
        return sh + sn + uh + un ;
<br/>
}</td> </tr></table><span class="postbody">
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">USER@Stardust ~/c/test
<br/>
$ gcc -Wall -Wextra -pedantic -Werror -o test test.c
<br/>
<br/>
USER@Stardust ~/c/test
<br/>
$ gcc -Wall -Wextra -ansi -pedantic -Werror -o test test.c
<br/>
<br/>
USER@Stardust ~/c/test
<br/>
$</td> </tr></table><span class="postbody">
<br/>
Other compilers may complain about these implicit casts and gcc should complain about them.
<br/>
If it does, I don't know how to get gcc to complain.  Does this behavior conform to the standard?
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122759 - Quirky - Wed Mar 21, 2007 9:11 pm</h4>
    <div class="postbody"><span class="postbody">-Wconversion should do it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122765 - HyperHacker - Wed Mar 21, 2007 10:44 pm</h4>
    <div class="postbody"><span class="postbody">Try -0x00000001, I've seen that before. (Not in my code, I think in GBA_NDS_FAT.)<br/>_________________<br/>I'm a PSP hacker now, but I still &lt;3 DS.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122768 - tepples - Wed Mar 21, 2007 11:27 pm</h4>
    <div class="postbody"><span class="postbody">The code for an unsigned all-bits-true value is ~0U.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122790 - sgeos - Thu Mar 22, 2007 2:48 am</h4>
    <div class="postbody"><span class="postbody">-Wconversion works.  Funny that this isn't covered in -Wall or -Wextra.  I wonder if there are any other warning that really should be turned on.  Admittedly, that is easy enough to figure out.  (man gcc)
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">USER@Stardust ~/c/test
<br/>
$ gcc -Wall -Wextra -ansi -pedantic -Werror -o test test.c
<br/>
<br/>
USER@Stardust ~/c/test
<br/>
$ gcc -Wall -Wextra -ansi -pedantic -Werror -Wconversion -o test test.c
<br/>
test.c: In function `main':
<br/>
test.c:9: warning: negative integer implicitly converted to unsigned type
<br/>
test.c:12: warning: passing arg 1 of `func' as unsigned due to prototype
<br/>
<br/>
USER@Stardust ~/c/test
<br/>
$ gcc -Wconversion -o test test.c
<br/>
test.c: In function `main':
<br/>
test.c:9: warning: negative integer implicitly converted to unsigned type
<br/>
test.c:12: warning: passing arg 1 of `func' as unsigned due to prototype
<br/>
<br/>
USER@Stardust ~/c/test
<br/>
$</td> </tr></table><span class="postbody">
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">unsigned int func(unsigned int pU, signed int pS)
<br/>
{
<br/>
        return pU + pS;
<br/>
}
<br/>
<br/>
int main(void)
<br/>
{
<br/>
        signed int   a = ~0L;
<br/>
        unsigned int b = -1;                    /* ling 9 warning */
<br/>
        unsigned int c = (unsigned int) -1;     /* fixes the warning */
<br/>
        return
<br/>
                func(a, a) +                    /* ling 12 warning */
<br/>
                func((unsigned)a, a) +          /* fixes the warning */
<br/>
                b + c;
<br/>
}</td> </tr></table><span class="postbody">
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#122815 - kusma - Thu Mar 22, 2007 4:26 pm</h4>
    <div class="postbody"><span class="postbody">yes, but also keep in mind that gcc &lt; 4.3 is kind of broken on float-handling in -Wconversion:
<br/>
<br/>
test.c:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
float func(float f);
<br/>
<br/>
float test(float f)
<br/>
{
<br/>
   return func(f);
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
$ arm-eabi-gcc -c -Wconversion test.c -o test.o
<br/>
test.c: In function 'test':
<br/>
test.c:5: warning: passing argument 1 of 'func' as 'float' rather than 'double' due to prototype
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
There's some kind of reasoning for this here, <a href="http://gcc.gnu.org/wiki/NewWconversion" target="_blank">http://gcc.gnu.org/wiki/NewWconversion</a> but I can't really see that I get why this was done to begin with.
<br/>
<br/>
If anyone knows a workaround, please let me know ;)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
