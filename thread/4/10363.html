<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Keypad IRQ? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Coding > Keypad IRQ?</h2>
<div id="posts">
<div class="post">
    <h4>#92576 - devmelon - Thu Jul 13, 2006 11:41 pm</h4>
    <div class="postbody"><span class="postbody">Hello. I'm in the middle of writing a basic wrapper around some of the functionality in the GBA. Im wondering how the Keypad IRQ works. The GBATEK has little information about this :/
<br/>
<br/>
<a href="http://www.work.de/nocash/gbatek.htm#keypadinput" target="_blank">http://www.work.de/nocash/gbatek.htm#keypadinput</a>
<br/>
<br/>
Do you <span style="font-weight: bold">only</span> get interrupts when a button is pressed? Not released? Is it continous or does it only get interrupted on a state change? 
<br/>
<br/>
Thanks for your interest.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#92929 - poslundc - Sat Jul 15, 2006 6:24 pm</h4>
    <div class="postbody"><span class="postbody">Without having used the key interrupts much, I'm pretty sure the interrupt fires whenever the requested keys are in the down state.
<br/>
<br/>
So if I set it to trigger when A and B are held down together, and the interrupt triggers, if I keep the keys held down they will trigger again the moment I clear the current interrupt.
<br/>
<br/>
For the record, it is a very bad idea to use interrupts for general input polling. Pretty much the only place I would ever recommend using it is for allowing a reset combination (eg. A+B+Start+Select). I've heard the argument for high-velocity DDR games and whatnot to use them as well, but I don't really buy it.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#92936 - tepples - Sat Jul 15, 2006 7:09 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">So if I set it to trigger when A and B are held down together, and the interrupt triggers, if I keep the keys held down they will trigger again the moment I clear the current interrupt.</td> </tr></table><span class="postbody">
<br/>
No they don't, at least not on a Game Boy Advance. They trigger once or a few times (due to key bounce), and then they don't trigger again for a given key until you release it and press it again.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Pretty much the only place I would ever recommend using it is for allowing a reset combination (eg. A+B+Start+Select). I've heard the argument for high-velocity DDR games and whatnot to use them as well, but I don't really buy it.</td> </tr></table><span class="postbody">
<br/>
If you don't use interrupts for a game that needs really precise input timing (e.g. DDR or Street Fighter), you'll need to poll at 180 Hz using vcount ISRs.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93126 - Ant6n - Mon Jul 17, 2006 3:06 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">... you'll need to poll at 180 Hz using vcount ISRs.</td> </tr></table><span class="postbody">
<br/>
<br/>
do games actually read the keys that often? do you have recommendations for how often people should poll for different types of games?
<br/>
anton</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93288 - devmelon - Tue Jul 18, 2006 10:52 am</h4>
    <div class="postbody"><span class="postbody">Heh, our game polls it once a frame. We had a discussion about wether or not to use IRQs, but we thought that if it was to fire IRQs all the time, it wouldn't be worth it. The main reason to why we are interested in IRQs is that they work very well with our OO design. But if they work as tepples mentioned it, we might have to reconsider. Although, we're interested in sensing when a key is lost (released) aswell, so I assume we have to do the standard polling. But tieing it with hblank interrupt (it's not a very fast game) might actually cut what we're trying to achieve. Or a timer irq. What do you guys propose? Should we go on polling the registers each frame or make some sort of interrupt scheme? We're using subscriber patterns for callbacks. And no whine about overhead with C++ please. :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93325 - tepples - Tue Jul 18, 2006 5:41 pm</h4>
    <div class="postbody"><span class="postbody">A relatively slow game should be able to get away with polling. All NES games used polling.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93621 - Ant6n - Thu Jul 20, 2006 4:40 am</h4>
    <div class="postbody"><span class="postbody">i was once thinking it could make sense to enable keypad irq's, but once one fires it should be disabled for the next couple of microseconds (using timer irq) to get rid of the key bounce effect. that way one could have very fast key response. But still, if the keypad doesnt recognize an 'up', then i guess it don't matter...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93624 - tepples - Thu Jul 20, 2006 5:49 am</h4>
    <div class="postbody"><span class="postbody">My anti-bounce solution is to allow the keypad ISR to push a key down (and timestamp it with VCOUNT), but only recognize released keys using polling (which shouldn't be bouncy).<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93639 - keldon - Thu Jul 20, 2006 9:17 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">My anti-bounce solution is to allow the keypad ISR to push a key down (and timestamp it with VCOUNT), but only recognize released keys using polling (which shouldn't be bouncy).</td> </tr></table><span class="postbody">
<br/>
<br/>
i thought of something similar too. will say when i dont have ice cream in one hand</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
