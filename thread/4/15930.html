<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Help!  A little help with the UART - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Coding > Help!  A little help with the UART</h2>
<div id="posts">
<div class="post">
    <h4>#161682 - enliteneer - Sun Aug 10, 2008 7:00 am</h4>
    <div class="postbody"><span class="postbody">I'm trying to get the GBA and PC to talk to each other, but I can only get data into the gba.. nothing ever gets transmitted back out!
<br/>
<br/>
I'm using the application found here:
<br/>
<a href="http://web.archive.org/web/20060603002957/http://www.fivemouse.com/gba/" target="_blank">http://web.archive.org/web/20060603002957/http://www.fivemouse.com/gba/</a> .   The application is supposed to echo any serial data received.
<br/>
<br/>
I've setup hyperterm for hardware handshaking and wired the level shifter according to this:
<br/>
<a href="http://darkfader.net/gba/files/UART.gif" target="_blank">http://darkfader.net/gba/files/UART.gif</a>  (BTW the "GBA UART" cable from <a href="http://one-stop-china.com/" target="_blank">http://one-stop-china.com/</a>  has been discontinued)
<br/>
<br/>
The keys I press on the computer are received and displayed correctly on the GBA, but the echo, and the hello world output from the console never occur.  I also tried shorting the CTS and RTS lines together so that the GBA can send without hardware handshaking, but no luck.  
<br/>
<br/>
I get the same results on two different gameboys, and with two different flash carts, so I'm thinking it has to be the code.  The cable, works in one direction so Im assuming thats ok.  But what could be wrong??
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void InitUART(unsigned short UART)
<br/>
{
<br/>
  // The user should only be choosing the speed
<br/>
  // Stick a character in the data register. This stops the GBA transmitting a
<br/>
  // Character as soon as it goes into UART mode (?!?)
<br/>
  REG_SIODATA8 = 'A';
<br/>
<br/>
  // Now to go into UART mode
<br/>
  REG_RCNT = 0;
<br/>
  REG_SIOCNT = 0;
<br/>
  REG_SIOCNT = UART | SIO_CTS | SIO_LENGTH_8 | SIO_SEND_ENABLE
<br/>
             | SIO_RECV_ENABLE | SIO_USE_UART;
<br/>
}
<br/>
<br/>
<br/>
void sndChar(unsigned char Character)
<br/>
{
<br/>
  // Wait until we have a CTS signal
<br/>
  while(REG_RCNT &amp; 0x0010);
<br/>
  // Bung our byte into the data register
<br/>
  REG_SIODATA8 = Character;
<br/>
}
<br/>
<br/>
void AgbMain(void)
<br/>
{
<br/>
  unsigned char InChar[2];
<br/>
<br/>
  // Set to UART mode
<br/>
  InitUART(SIO_BAUD_115200);
<br/>
<br/>
    sndChar('H');sndChar('e');sndChar('l');sndChar('l');sndChar('o');
<br/>
    sndChar('W');sndChar('o');sndChar('r');sndChar('l');sndChar('d');
<br/>
<br/>
  // Just keep on looping...
<br/>
  while(1) {
<br/>
    // Read in a character
<br/>
    InChar[0] = rcvChar();
<br/>
    InChar[1] = 0;
<br/>
<br/>
    // If it's a CR, shift up the screen
<br/>
    if(InChar[0] == 13) {
<br/>
      ShiftScreen();
<br/>
      ResetCursor();
<br/>
    } else {
<br/>
      // Otherwise, display it on teh screen
<br/>
      Print(InChar);
<br/>
    }
<br/>
<br/>
    // Echo it back as well
<br/>
    sndChar(InChar[0]);
<br/>
  }
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
