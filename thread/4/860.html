<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>attribute0 resets? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Coding > attribute0 resets?</h2>
<div id="posts">
<div class="post">
    <h4>#4281 - fezz1k - Wed Mar 26, 2003 2:10 pm</h4>
    <div class="postbody"><span class="postbody">hey there..
<br/>
<br/>
something weird is happening with my code.  i've programmed in c/c++ for years, but for my first gba attempt, i figured i'd make a tetris clone.  when setting up my sprites (one for each of the types of block types), the attribute0 setting for the fifth sprite always reset itself.  this was driving me crazy, and i couldn't get started with any real progress, because i couldn't figure out why it was doing this.  lo and behold, if at the end of the function where i set all this stuff up, i manually just set it once again, everything works fine.  so i'm continuing my work on this, but i still can't figure out for the life of me what's happening!  perhaps someone else could clue me in?
<br/>
<br/>
thanks
<br/>
<br/>
this is the code that's been ruffling my feathers (you can see at the end where i set the attribute again.. with that line commented, it is like i never set it at all):
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void LoadSprites() { // should probably return a value, but not as concerned the info won't be there w/ roms
<br/>
   char snum; // sprite we are dealing with.  each represents a block type, 0-6
<br/>
   int lcv;
<br/>
   s16 x,y;
<br/>
   //u16* charMem = (u16*)0x6010000;
<br/>
   //u16* objpalMem = (u16*)0x5000200;
<br/>
<br/>
   for (lcv=0;lcv&lt;23;lcv++) {
<br/>
      OBJPaletteMem[lcv]=palette[lcv];
<br/>
   }
<br/>
   y=160; // init offscreen, since all 6 will technically always be there
<br/>
   x=240;
<br/>
<br/>
   for (lcv=0;lcv&lt;128;lcv++) {
<br/>
      OAMdata[lcv]=obj0[lcv];
<br/>
   }
<br/>
   for (lcv=0;lcv&lt;256;lcv++) {
<br/>
      OAMdata[lcv+128]=obj1[lcv];
<br/>
   }
<br/>
   for (lcv=0;lcv&lt;256;lcv++) {
<br/>
      OAMdata[lcv+384]=obj2[lcv];
<br/>
   }
<br/>
   for (lcv=0;lcv&lt;128;lcv++) {
<br/>
      OAMdata[lcv+640]=obj3[lcv];
<br/>
   }
<br/>
   for (lcv=0;lcv&lt;256;lcv++) {
<br/>
      OAMdata[lcv+768]=obj4[lcv];
<br/>
   }
<br/>
   for (lcv=0;lcv&lt;256;lcv++) {
<br/>
      OAMdata[lcv+1024]=obj5[lcv];
<br/>
   }
<br/>
   for (lcv=0;lcv&lt;256;lcv++) {
<br/>
      OAMdata[lcv+1280]=obj6[lcv];
<br/>
   }
<br/>
<br/>
   snum=0; // line block  |
<br/>
   sprites[snum].attribute0 = COLOR_256 | WIDE | y;
<br/>
   sprites[snum].attribute1 = SIZE_16 | x;
<br/>
   sprites[snum].attribute2 = 0;
<br/>
<br/>
   snum=1; // backwards L  |_
<br/>
   sprites[snum].attribute0 = COLOR_256 | WIDE | y;
<br/>
   sprites[snum].attribute1 = SIZE_32 | x;
<br/>
   sprites[snum].attribute2 = 8;
<br/>
<br/>
   snum=2; // forwards L  _|
<br/>
   sprites[snum].attribute0 = COLOR_256 | WIDE | y;
<br/>
   sprites[snum].attribute1 = SIZE_32 | x;
<br/>
   sprites[snum].attribute2 = 24;
<br/>
<br/>
   snum=3; // square piece []
<br/>
   sprites[snum].attribute0 = COLOR_256 | SQUARE | y;
<br/>
   sprites[snum].attribute1 = SIZE_16 | x;
<br/>
   sprites[snum].attribute2 = 40;
<br/>
<br/>
   snum=4; // squiggle left \
<br/>
   sprites[snum].attribute0 = COLOR_256 | WIDE | y;
<br/>
   sprites[snum].attribute1 = SIZE_32 | x;
<br/>
   sprites[snum].attribute2 = 48;
<br/>
<br/>
   snum=5; // squiggle right /
<br/>
   sprites[snum].attribute0 = COLOR_256 | WIDE | y;
<br/>
   sprites[snum].attribute1 = SIZE_32 | x;
<br/>
   sprites[snum].attribute2 = 64;
<br/>
<br/>
   snum=6; // easy fit piece _+_
<br/>
   sprites[snum].attribute0 = COLOR_256 | WIDE | y;
<br/>
   sprites[snum].attribute1 = SIZE_32 | x;
<br/>
   sprites[snum].attribute2 = 80;
<br/>
<br/>
   sprites[4].attribute0 = COLOR_256 | WIDE | y;  // don't ask me why i have to do this (again), but i do.
<br/>
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4282 - peebrain - Wed Mar 26, 2003 3:45 pm</h4>
    <div class="postbody"><span class="postbody">I always have weird shit like that happen to me too.  I think GCC screws it up from fancy optimization or something (I could be wrong though).  I'd be interested in the solution to this problem.
<br/>
<br/>
~Sean<br/>_________________<br/><a href="http://www.pbwhere.com" target="_blank">http://www.pbwhere.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4322 - I.C.E - Thu Mar 27, 2003 11:03 pm</h4>
    <div class="postbody"><span class="postbody">I would suggest checking the following:
<br/>
<br/>
1. If you have multiple object files which you are linking check if all are up do date
<br/>
2. Check if some data structure is exceeding the GBA memory limits (nm)
<br/>
<br/>
By the way how is your sprites structure exactly defined?<br/>_________________<br/>To this day, many C programmers believe that "strong typing" just means pounding extra hard on the keyboard.
<br/>
 -  Peter van der Linden</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4328 - fezz1k - Fri Mar 28, 2003 6:47 am</h4>
    <div class="postbody"><span class="postbody">I'm not linking multiple objects, and (as far as I can tell), nothing is too big for the GBA's memory (as loading the sprites was one of the first things the program was doing, I really hadn't put all that much of anything into memory when this started happening).  Once again, though, admittedly.. this is my first GBA program, so I might be entirely wrong.  The sprites[] structure is defined like the dovoto tutorials:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">typedef struct tagOAMEntry
<br/>
{
<br/>
   u16 attribute0;
<br/>
   u16 attribute1;
<br/>
   u16 attribute2;
<br/>
   u16 attribute3;
<br/>
}OAMEntry,*pOAMEntry;
<br/>
<br/>
OAMEntry sprites[128];
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4329 - Quirky - Fri Mar 28, 2003 8:47 am</h4>
    <div class="postbody"><span class="postbody">Could it be something to do with you using s16s for the x, y coordinate? Shouldn't have an effect as they are all &lt; 255, but you need to be careful not to overwrite bits that you aren't using in OAM. Here's a link to the cowbite spec, which details the sprite entries:
<br/>
<br/>
<a href="http://www.cs.rit.edu/~tjh8300/CowBite/CowBiteSpec.htm#OAM" target="_blank">http://www.cs.rit.edu/~tjh8300/CowBite/CowBiteSpec.htm#OAM</a> (sprites)
<br/>
<br/>
Check your WIDE and SIZE definitions too, that they aren't too big/small and overwriting where they shouldn't. Also, when do you copy your sprites from ram to oam? Could it be that you don't copy this sprite value across when you expect? Have you tried not positioning the sprites when you define their behaviour, then moving them later? Might help narrow down the problem - better to understand why something goes wrong than fudge it and hope it doesn't crop up again![/code]</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
