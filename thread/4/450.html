<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Having trouble scrolling backgrounds - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > Having trouble scrolling backgrounds</h2>
<div id="posts">
<div class="post">
    <h4>#2727 - Nyundi - Tue Feb 11, 2003 4:39 pm</h4>
    <div class="postbody"><span class="postbody">Hi!  I'm new to GBAdev, and I'm having some problems getting my background to scroll.  I don't know that it's necessarily a problem with my background, as it is with input.  Not really sure, anyway, the background displays fine, and (using VisualBoy) I can see that the entire thing is loaded into memory, but no amount of button pushing makes it scroll.  Here's the relevant code, if anyone has any suggestions, let me know!  Thanks alot!
<br/>
-Jesse
<br/>
<br/>
int main(void)
<br/>
{
<br/>
	u16 loop;
<br/>
	u16* temp;
<br/>
<br/>
	SetMode(MODE_2 | OBJ_MAP_1D);
<br/>
<br/>
	sunsetBg.number = 2;
<br/>
	sunsetBg.charBaseBlock = 0;
<br/>
	sunsetBg.screenBaseBlock = 8;
<br/>
	sunsetBg.colorMode = BG_COLOR_256;
<br/>
	sunsetBg.size = ROTBG_SIZE_512x512;
<br/>
	sunsetBg.mosaic = 0;
<br/>
	sunsetBg.x_scroll = 0;
<br/>
	sunsetBg.y_scroll = 0;
<br/>
<br/>
	EnableBackground(&amp;sunsetBg);
<br/>
<br/>
	for(loop = 0; loop &lt; 256; loop++)
<br/>
	{
<br/>
		BGPaletteMem[loop] = TileSetPalette[loop];
<br/>
	}
<br/>
<br/>
	for(loop = 0; loop &lt; TileSet_WIDTH * TileSet_HEIGHT / 2; loop++)
<br/>
	{
<br/>
		sunsetBg.tileData[loop] = TileSetData[loop];
<br/>
	}
<br/>
<br/>
	temp = (u16*)JungleBackground;
<br/>
<br/>
	for(loop = 0; loop &lt; 64 * 64 / 2; loop++)
<br/>
	{
<br/>
		sunsetBg.mapData[loop] = temp[loop];
<br/>
	}
<br/>
<br/>
	WaitForVsync();
<br/>
<br/>
	while(true)
<br/>
	{
<br/>
		UpdateBackground(&amp;sunsetBg);
<br/>
		WaitForVsync();
<br/>
		GetInput();
<br/>
	}
<br/>
<br/>
	return 0;
<br/>
}
<br/>
<br/>
void WaitForVsync()  
<br/>
{
<br/>
	while((volatile u16)REG_VCOUNT != 160){}
<br/>
}
<br/>
<br/>
void GetInput()  
<br/>
{
<br/>
	if(!(*KEYS &amp; KEY_UP))
<br/>
	{
<br/>
		sunsetBg.y_scroll++;
<br/>
	}
<br/>
	if(!(*KEYS &amp; KEY_DOWN))
<br/>
	{
<br/>
		sunsetBg.y_scroll--;
<br/>
	}
<br/>
	if(!(*KEYS &amp; KEY_LEFT))
<br/>
	{
<br/>
		sunsetBg.x_scroll++;
<br/>
	}
<br/>
	if(!(*KEYS &amp; KEY_RIGHT))
<br/>
	{
<br/>
		sunsetBg.x_scroll--;
<br/>
	}
<br/>
}
<br/>
<br/>
void EnableBackground(Bg *bg)
<br/>
{
<br/>
	u16 temp;
<br/>
	bg-&gt;tileData = (u16*)CharBaseBlock(bg-&gt;charBaseBlock);
<br/>
	bg-&gt;mapData = (u16*)ScreenBaseBlock(bg-&gt;screenBaseBlock);
<br/>
	temp = bg-&gt;size | (bg-&gt;charBaseBlock&lt;&lt;CHAR_SHIFT) | 
<br/>
		   (bg-&gt;screenBaseBlock&lt;&lt;SCREEN_SHIFT) | bg-&gt;colorMode |
<br/>
		   bg-&gt;mosaic;
<br/>
<br/>
	switch(bg-&gt;number)
<br/>
	{
<br/>
	case 0:
<br/>
		{
<br/>
			REG_BG0CNT = temp;
<br/>
			REG_DISPCNT |= BG0_ENABLE;
<br/>
		}break;
<br/>
<br/>
	case 1:
<br/>
		{
<br/>
			REG_BG1CNT = temp;
<br/>
			REG_DISPCNT |= BG1_ENABLE;
<br/>
		}break;
<br/>
<br/>
	case 2:
<br/>
		{
<br/>
			REG_BG2CNT = temp;
<br/>
			REG_DISPCNT |= BG2_ENABLE;
<br/>
		}break;
<br/>
<br/>
	case 3:
<br/>
		{
<br/>
			REG_BG3CNT = temp;
<br/>
			REG_DISPCNT |= BG3_ENABLE;
<br/>
		}break;
<br/>
<br/>
	default:break;
<br/>
	}
<br/>
}
<br/>
<br/>
void UpdateBackground(Bg* bg)
<br/>
{
<br/>
	switch(bg-&gt;number)
<br/>
	{
<br/>
	case 0:
<br/>
		REG_BG0HOFS = bg-&gt;x_scroll;
<br/>
		REG_BG0VOFS = bg-&gt;y_scroll;
<br/>
		break;
<br/>
	case 1:
<br/>
		REG_BG1HOFS = bg-&gt;x_scroll;
<br/>
		REG_BG1VOFS = bg-&gt;y_scroll;
<br/>
		break;
<br/>
	case 2:
<br/>
		if(!(REG_DISPCNT &amp; MODE_0))//it is a rot background
<br/>
		{
<br/>
			REG_BG2X = bg-&gt;DX;
<br/>
			REG_BG2Y = bg-&gt;DY;
<br/>
<br/>
			REG_BG2PA = bg-&gt;PA;
<br/>
			REG_BG2PB = bg-&gt;PB;
<br/>
			REG_BG2PC = bg-&gt;PC;
<br/>
			REG_BG2PD = bg-&gt;PD;
<br/>
		}
<br/>
		else  //it is a text background
<br/>
		{
<br/>
			REG_BG2HOFS = bg-&gt;x_scroll;
<br/>
			REG_BG2VOFS = bg-&gt;y_scroll;
<br/>
		}
<br/>
		break;
<br/>
	case 3:
<br/>
		if(!(REG_DISPCNT &amp; MODE_0))//it is a rot background
<br/>
		{
<br/>
			REG_BG3X = bg-&gt;DX;
<br/>
			REG_BG3Y = bg-&gt;DY;
<br/>
<br/>
			REG_BG3PA = bg-&gt;PA;
<br/>
			REG_BG3PB = bg-&gt;PB;
<br/>
			REG_BG3PC = bg-&gt;PC;
<br/>
			REG_BG3PD = bg-&gt;PD;
<br/>
		}
<br/>
		else //it is a text background
<br/>
		{
<br/>
			REG_BG3HOFS = bg-&gt;x_scroll;
<br/>
			REG_BG3VOFS = bg-&gt;y_scroll;
<br/>
		}
<br/>
		break;
<br/>
	default: break;
<br/>
	}
<br/>
}</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
