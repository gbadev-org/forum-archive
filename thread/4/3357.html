<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Weird while loop problem - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > Weird while loop problem</h2>
<div id="posts">
<div class="post">
    <h4>#20258 - kayan - Wed May 05, 2004 7:41 pm</h4>
    <div class="postbody"><span class="postbody">I took this function from dovotos site and the while loops forever if it is empty.  As soon if I put something like sprintf it works.  
<br/>
<br/>
The code how I would like it to be. but doesnt' work
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void sleep(int seconds)
<br/>
{
<br/>
    //Start the timer
<br/>
    REG_TM3CNT = TIMER_FREQUENCY_1024 | TIMER_ENABLE;
<br/>
    //zero the timer
<br/>
    REG_TM3D = 0;
<br/>
<br/>
    while(seconds--)
<br/>
    {
<br/>
        while(REG_TM3D &lt;= 16386){}   //wait
<br/>
        REG_TM3D = 0; //reset the timmer
<br/>
    }
<br/>
    REG_TM3CNT = 0;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
if I add a sprintf like this it works:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
while(REG_TM3D &lt;= 16386)
<br/>
{
<br/>
     sprintf(str,"ab");
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Is anybody had this weird problem?  Is it a compilier bug or something?
<br/>
<br/>
Thank you</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20259 - niltsair - Wed May 05, 2004 7:46 pm</h4>
    <div class="postbody"><span class="postbody">Make sure <span style="font-weight: bold">REG_TM3D</span> is declared as Volatile. All register should be declared as being Volatile.<br/>_________________<br/>-Inside every large program is a small program struggling to get out. (Hoare's Law of Large Programs)
<br/>
-The man who can smile when things go wrong has thought of someone he can blame it on. (Nixon's Theorem)</span><span class="gensmall"><br/><br/>Last edited by niltsair on Wed May 05, 2004 7:47 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#20260 - alek - Wed May 05, 2004 7:46 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>kayan wrote:</b></span></td> </tr> <tr> <td class="quote">I took this function from dovotos site and the while loops forever if it is empty.  As soon if I put something like sprintf it works.  
<br/>
<br/>
The code how I would like it to be. but doesnt' work
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void sleep(int seconds)
<br/>
{
<br/>
    //Start the timer
<br/>
    REG_TM3CNT = TIMER_FREQUENCY_1024 | TIMER_ENABLE;
<br/>
    //zero the timer
<br/>
    REG_TM3D = 0;
<br/>
<br/>
    while(seconds--)
<br/>
    {
<br/>
        while(REG_TM3D &lt;= 16386){}   //wait
<br/>
        REG_TM3D = 0; //reset the timmer
<br/>
    }
<br/>
    REG_TM3CNT = 0;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Don't know if this will make any difference but have you tried replacing the empty {} with ;
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
while(REG_TM3D &lt;= 16386);
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20261 - kayan - Wed May 05, 2004 8:01 pm</h4>
    <div class="postbody"><span class="postbody">alek: no, I tried but it doesn't work
<br/>
<br/>
niltsair: you were right it wasn't declared as volatile. Thanks.
<br/>
<br/>
<br/>
Now it's working.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20266 - niltsair - Wed May 05, 2004 8:34 pm</h4>
    <div class="postbody"><span class="postbody">Just so you know, Volatile means that the variable can be modified outside of your current code (namely by hardware or code inside interrupt). Failing to specify Volatile for register means that the compiler will 'Optimize' in unpleasant ways.<br/>_________________<br/>-Inside every large program is a small program struggling to get out. (Hoare's Law of Large Programs)
<br/>
-The man who can smile when things go wrong has thought of someone he can blame it on. (Nixon's Theorem)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20269 - kayan - Wed May 05, 2004 9:31 pm</h4>
    <div class="postbody"><span class="postbody">Now it make sense why the while loop was doing something weird. 
<br/>
<br/>
Thank you for the explanation.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20309 - sgeos - Thu May 06, 2004 9:23 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>kayan wrote:</b></span></td> </tr> <tr> <td class="quote">Now it make sense why the while loop was doing something weird.</td> </tr></table><span class="postbody">
<br/>
<br/>
The while loop was not really doing anything weird.  The compiler just did something unexpected.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
