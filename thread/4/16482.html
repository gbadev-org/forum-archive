<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>low-level programming in GBA - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > low-level programming in GBA</h2>
<div id="posts">
<div class="post">
    <h4>#166993 - bollkalle - Wed Feb 25, 2009 5:50 pm</h4>
    <div class="postbody"><span class="postbody">Hello!
<br/>
<br/>
I am very interested in low-level programming. I wonder if it's possible to program very low to GBA. For example: I write a register and put a value in it. And for everything in the program I will do this way. Is it easy or at least possible?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#166995 - gauauu - Wed Feb 25, 2009 6:32 pm</h4>
    <div class="postbody"><span class="postbody">Yes, it's not only easy, it's a fairly normal way of doing things.  Look at libgba -- they have most (if not all?) of the hardware registers #define'd to constants.  
<br/>
<br/>
Using C and pointers, (or assembly, if that's your thing), you can easily read/write these registers.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167006 - bollkalle - Thu Feb 26, 2009 7:16 am</h4>
    <div class="postbody"><span class="postbody">OK! Thanks for the reply!
<br/>
<br/>
EDIT: Is it possible to write like this:
<br/>
<br/>
if (0x04000164 == 7)
<br/>
{
<br/>
    0x04000166 = 5;
<br/>
}
<br/>
<br/>
Or do I have to do something more?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167008 - elhobbs - Thu Feb 26, 2009 2:42 pm</h4>
    <div class="postbody"><span class="postbody">no, but close. you need to cast the address to a pointer of the correct size and dereference it. getting the size correct is important as well as marking it as volatile, which is why you are better off using the defines - plus it easier to understand when you come back to the code a week or even a day later.
<br/>
here is an example from video.h in libnds</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define GFX_TEX_FORMAT        (*(vu32*) 0x040004A8)
<br/>
</td> </tr></table><span class="postbody">
<br/>
and it is written t like so</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">GFX_TEX_FORMAT=0;</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167009 - bollkalle - Thu Feb 26, 2009 2:49 pm</h4>
    <div class="postbody"><span class="postbody">But isn't it several bits in an address like this: 0x040004A8?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167010 - elhobbs - Thu Feb 26, 2009 3:27 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>bollkalle wrote:</b></span></td> </tr> <tr> <td class="quote">But isn't it several bits in an address like this: 0x040004A8?</td> </tr></table><span class="postbody">I am not really sure what you are asking. but, 0x040004A8 is a literal or just a number in C. until it is cast to a pointer the compiler can not use it. your statement is equivalent to 8=5.
<br/>
<br/>
the arm processors in the ds are byte addressable. so, each address points to a byte in memory.  the memory regions that you refer to point at hardware registers. some of them are 8bit, 16bit, or 32bit wide. so they need to be cast to the correct pointer types so that they are written to correctly. using the defines shields you from doing this wrong.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167011 - Cearn - Thu Feb 26, 2009 3:43 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>bollkalle wrote:</b></span></td> </tr> <tr> <td class="quote">But isn't it several bits in an address like this: 0x040004A8?</td> </tr></table><span class="postbody">Not bits <span style="font-style: italic">in</span> the address; bits <span style="font-style: italic">at</span> the address. The address points to where you have to set the bits. To write to bits at some address, you have to do what elhobbs mentioned: create a pointer and then dereference it.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>elhobbs wrote:</b></span></td> </tr> <tr> <td class="quote">... hardware registers. some of them are 8bit, 16bit, or 32bit wide. so they need to be cast to the correct pointer types so that they are written to correctly. </td> </tr></table><span class="postbody">This is not entirely true. You can access the hardware registers with any datatype, it's just that some datatypes are more useful than others. 
<br/>
<br/>
For example, take the windowing registers. REG_WININ is defined as a 16-bit register with control bits for both window 0 and window 1. But you can also separate these into, say, byte-sized REG_WIN0CNT and  REG_WIN1CNT, which are probably easier to use.
<br/>
<br/>
A contrasting example is REG_BGnX, which technically 32-bit, but sometimes also split into 16-bit REG_BGnX_L and REG_BGnX_H. In this case the split is rather pointless, but it would work.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167013 - bollkalle - Thu Feb 26, 2009 4:25 pm</h4>
    <div class="postbody"><span class="postbody">So if I have a register and want to put bits in it, I can do like this:
<br/>
<br/>
0100011011000101
<br/>
<br/>
Or what?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167015 - elhobbs - Thu Feb 26, 2009 4:41 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>bollkalle wrote:</b></span></td> </tr> <tr> <td class="quote">So if I have a register and want to put bits in it, I can do like this:
<br/>
<br/>
0100011011000101
<br/>
<br/>
Or what?</td> </tr></table><span class="postbody">I am not sure what you are asking.
<br/>
<br/>
yes, you can use binary values though I think you need to put a b in front (or something like that). however, hexidecimal is more common since it is more compact.
<br/>
<br/>
I am not sure how familiar you are with C programming, but it sounds like you may not be that familiar with it. Trying to learn C with low level register manipulation can be challenging. I think if you are asking this type of question then you should definitely be using the libnds defines or a higher level library.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167016 - bollkalle - Thu Feb 26, 2009 4:48 pm</h4>
    <div class="postbody"><span class="postbody">I do not program in C usual, but I have programmed in C++ pretty much.
<br/>
<br/>
Where can I learn about register manipulation?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167018 - elhobbs - Thu Feb 26, 2009 5:28 pm</h4>
    <div class="postbody"><span class="postbody">I do not think you need to read about register manipulation per say. I think you may want read up on pointers and casting data types. perhaps something on bitmasks as well. you should be able to find a wealth of information using your favorite search engine. you probably could learn quite a bit by looking at the source code for the examples that are provided with lidnds.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167022 - Miked0801 - Thu Feb 26, 2009 6:21 pm</h4>
    <div class="postbody"><span class="postbody">Have you ever worked with the following C/C++ ops?
<br/>
<br/>
|
<br/>
&amp;
<br/>
^
<br/>
~
<br/>
<br/>
As in:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
foo = ((foo2 | foo3) &amp; ~fooMask) ^ 0x01;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
If you cannot explain in plain English what each step in the above is doing, then you need a refresher and the low-level GBA is beyond you for now.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167023 - sgeos - Thu Feb 26, 2009 7:15 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Miked0801 wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">foo = ((foo2 | foo3) &amp; ~fooMask) ^ 0x01;</td> </tr></table><span class="postbody">If you cannot explain in plain English what each step in the above is doing,</span></td> </tr></table><span class="postbody">
<br/>
This strikes me as an amazing interview question.
<br/>
<br/>
Here is the same thing, but it might be a little easier to explain if you are finding all the foos confusing.  What is the final status of the unit?  (flagNonFlyingMask consists of flagLand + flagSea).
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">unitFlags = ((flagAir | flagLand) &amp; ~flagNonFlyingMask) ^ flagHidden;</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167045 - elyk1212 - Fri Feb 27, 2009 6:04 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>bollkalle wrote:</b></span></td> </tr> <tr> <td class="quote">So if I have a register and want to put bits in it, I can do like this:
<br/>
<br/>
0100011011000101
<br/>
<br/>
Or what?</td> </tr></table><span class="postbody">
<br/>
<br/>
In my opinion, representing the value hex is quite a bit more readable and also easier to not make mistakes in bit placement.  But whatever works for you I guess.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
unitFlags = ((flagAir | flagLand) &amp; ~flagNonFlyingMask) ^ flagHidden;
<br/>
</td> </tr></table><span class="postbody">
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
<br/>
I wish my interviews had questions like that :P.  
<br/>
<br/>
My last one, some guy that barely spoke english just started drawing logic gates on the board, in a huge mess, and at the end asked me what it did.  Then I got some kind of weird ones like how to verify a toaster, and this was supposed to be an hour response?!    Then some guy drew a machine that had a magnetic disc in the center, he showed polarity on each part of the disc, stated how fast it was spinning then wanted a description of what kind of circuit it would be equivalent to, given the wave forms that it produces.  That was one weird interview... fun, but strange.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#167069 - Miked0801 - Sat Feb 28, 2009 5:25 am</h4>
    <div class="postbody"><span class="postbody">Sounds like and M$ interview.  Off the wall questions followed by some good ones.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
