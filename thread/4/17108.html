<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>function pointers - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > function pointers</h2>
<div id="posts">
<div class="post">
    <h4>#172515 - mog123 - Wed Feb 10, 2010 4:46 pm</h4>
    <div class="postbody"><span class="postbody">Did anyone try doing any function pointers to get some sort of hermetisation and has some code they could share? Implementing something like this would be a great help in designing games for the GBA. I've never done any function pointers and am also curious can the GBA handle it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172517 - elhobbs - Wed Feb 10, 2010 5:14 pm</h4>
    <div class="postbody"><span class="postbody">can the gba handle function pointers? why do you think it couldn't? maybe I am missing something...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172520 - mog123 - Wed Feb 10, 2010 5:18 pm</h4>
    <div class="postbody"><span class="postbody">In memory terms.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172521 - elhobbs - Wed Feb 10, 2010 5:20 pm</h4>
    <div class="postbody"><span class="postbody">a function pointer is just a memory address - so on the gba it would be 4 bytes.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172522 - mog123 - Wed Feb 10, 2010 5:24 pm</h4>
    <div class="postbody"><span class="postbody">Ok, and the function is stored on the ROM. I get it. Thanks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172526 - gauauu - Wed Feb 10, 2010 9:30 pm</h4>
    <div class="postbody"><span class="postbody">There shouldn't be any issue using function pointers.  A simple example from my game:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
//EnemyUpdateFunction is a pointer to a function that updates an 
<br/>
//enemy.  Each enemy type would have its own update function
<br/>
typedef int(*EnemyUpdateFunction)(Enemy *, int );
<br/>
<br/>
typedef struct
<br/>
{
<br/>
   int startHP;
<br/>
        //...omitting a bunch of other members
<br/>
   EnemyUpdateFunction updateFunction;
<br/>
<br/>
} EnemyType;
<br/>
<br/>
//now define a particular enemy type
<br/>
const EnemyType enemy_bat_def = 
<br/>
{
<br/>
   1,            //hp
<br/>
         //omitting stuff.....
<br/>
   enemyBatFunc   //updateFunction 
<br/>
<br/>
};
<br/>
<br/>
<br/>
int enemyBatFunc(Enemy * enemy, int param)
<br/>
{
<br/>
   //update the bat here
<br/>
}
<br/>
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
//and then to call a particular enemy's update function
<br/>
enemy-&gt;enemyType-&gt;updateFunction(newEnemy, ENEMY_INIT);
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172527 - kusma - Thu Feb 11, 2010 12:30 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>mog123 wrote:</b></span></td> </tr> <tr> <td class="quote">Ok, and the function is stored on the ROM. I get it. Thanks.</td> </tr></table><span class="postbody">
<br/>
No.
<br/>
<br/>
Function pointers works fine on the GBA, just like on any other platform.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172528 - dantheman - Thu Feb 11, 2010 2:25 am</h4>
    <div class="postbody"><span class="postbody">During my "learning C for engineers" class in which we programmed for the GBA, our linked list "library" used a lot of function pointers.  For instance, we had a generic function that would parse the entire list and took in a function pointer deciding what to do with that list (print it to the screen, add items together, remove from the head of the list, etc).  Took a while to wrap my mind around it, but it's certainly doable on the GBA.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172529 - brave_orakio - Thu Feb 11, 2010 4:08 am</h4>
    <div class="postbody"><span class="postbody">I use it extensively in my demo. I use it in both player and AI controlled objects on screen. I put a function pointer in the structure I used for objects and let it point to the proper function depending on the action of the object on screen.<br/>_________________<br/>help me</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172534 - mog123 - Thu Feb 11, 2010 5:38 pm</h4>
    <div class="postbody"><span class="postbody">I've been trying out function pointers and PN seems to giving me errors;
<br/>
<br/>
Here's a code snippet:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
typedef struct _METHODS_{
<br/>
   void (*animate_player);
<br/>
} METHODS;
<br/>
<br/>
typedef struct _PLAYER_{
<br/>
   //variables
<br/>
   METHODS *Methods;
<br/>
   u8 Action;
<br/>
   u8 Frame;
<br/>
} PLAYER;
<br/>
<br/>
<br/>
void animate_player(PLAYER *Player, int x, int y)
<br/>
{
<br/>
//code
<br/>
}
<br/>
PLAYER *Player = (PLAYER*)malloc(sizeof(PLAYER));
<br/>
<br/>
Player-&gt;Methods-&gt;animate_player=animate_player;
<br/>
Player-&gt;Methods-&gt;animate_player(Player,x,y);</td> </tr></table><span class="postbody">
<br/>
<br/>
Can't seem to get this to work. Any ideas?
<br/>
PN error:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">error: called object 'Player-&gt;Methods-&gt;animate_player' is not a function</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172535 - kusma - Thu Feb 11, 2010 6:09 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>mog123 wrote:</b></span></td> </tr> <tr> <td class="quote">I've been trying out function pointers and PN seems to giving me errors;
<br/>
<br/>
Here's a code snippet:
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
typedef struct _METHODS_{
<br/>
   void (*animate_player);
<br/>
} METHODS;
<br/>
<br/>
typedef struct _PLAYER_{
<br/>
   //variables
<br/>
   METHODS *Methods;
<br/>
   u8 Action;
<br/>
   u8 Frame;
<br/>
} PLAYER;
<br/>
<br/>
<br/>
void animate_player(PLAYER *Player, int x, int y)
<br/>
{
<br/>
//code
<br/>
}
<br/>
PLAYER *Player = (PLAYER*)malloc(sizeof(PLAYER));
<br/>
<br/>
Player-&gt;Methods-&gt;animate_player=animate_player;
<br/>
Player-&gt;Methods-&gt;animate_player(Player,x,y);</td> </tr></table><span class="postbody">
<br/>
<br/>
Can't seem to get this to work. Any ideas?
<br/>
PN error:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">error: called object 'Player-&gt;Methods-&gt;animate_player' is not a function</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
The animate_player member in the METHODS-struct must list it's parameters, or the compiler won't be able to generate the function-call. Something like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">typedef struct _METHODS_{
<br/>
   void (*animate_player)(PLAYER *Player, int x, int y);
<br/>
} METHODS;
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172536 - mog123 - Thu Feb 11, 2010 6:24 pm</h4>
    <div class="postbody"><span class="postbody">I actually tried that the first time and got this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
error: expected ')' before '*' token
<br/>
warning: no semicolon at end of struct or union</td> </tr></table><span class="postbody">
<br/>
<br/>
Then I just shortened the parameters to (PLAYER) and it compiled, worked, but PN gave me:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">warning: parameter names (without types) in function declaration</td> </tr></table><span class="postbody"></span><span class="gensmall"><br/><br/>Last edited by mog123 on Thu Feb 11, 2010 6:25 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#172537 - elwing - Thu Feb 11, 2010 6:24 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>mog123 wrote:</b></span></td> </tr> <tr> <td class="quote">I've been trying out function pointers and PN seems to giving me errors;
<br/>
<br/>
Here's a code snippet:
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
typedef struct _METHODS_{
<br/>
   void (*animate_player);
<br/>
} METHODS;
<br/>
<br/>
typedef struct _PLAYER_{
<br/>
   //variables
<br/>
   METHODS *Methods;
<br/>
   u8 Action;
<br/>
   u8 Frame;
<br/>
} PLAYER;
<br/>
<br/>
<br/>
void animate_player(PLAYER *Player, int x, int y)
<br/>
{
<br/>
//code
<br/>
}
<br/>
PLAYER *Player = (PLAYER*)malloc(sizeof(PLAYER));
<br/>
<br/>
Player-&gt;Methods-&gt;animate_player=animate_player;
<br/>
Player-&gt;Methods-&gt;animate_player(Player,x,y);</td> </tr></table><span class="postbody">
<br/>
<br/>
Can't seem to get this to work. Any ideas?
<br/>
PN error:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">error: called object 'Player-&gt;Methods-&gt;animate_player' is not a function</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
<br/>
it seems to me that not only you're trying to access an invalid pointer, but you're also trying to use a pointer of function as a function...
<br/>
<br/>
isn't something like that better?
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
typedef void(*ANIMATE_PLAYER)(PLAYER*, int, int);
<br/>
<br/>
typedef struct _PLAYER_{
<br/>
   //variables
<br/>
   ANIMATE_PLAYER animate_player;
<br/>
   u8 Action;
<br/>
   u8 Frame;
<br/>
} PLAYER;
<br/>
<br/>
void animate_player(PLAYER *Player, int x, int y)
<br/>
{
<br/>
//code
<br/>
}
<br/>
<br/>
PLAYER *Player = (PLAYER*)malloc(sizeof(PLAYER));
<br/>
<br/>
Player-&gt;animate_player=&amp;animate_player;
<br/>
(*Player-&gt;animate_player)(Player,x,y);
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
haven't tested hope i didn't made a pointer error...</span><span class="gensmall"><br/><br/>Last edited by elwing on Thu Feb 11, 2010 6:34 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#172539 - mog123 - Thu Feb 11, 2010 6:32 pm</h4>
    <div class="postbody"><span class="postbody">Ok, fixed it, no warnings:
<br/>
<br/>
struct _PLAYER_;
<br/>
typedef struct _PLAYER_ PLAYER;
<br/>
<br/>
typedef struct _METHODS_{
<br/>
	void (*animate_player)(PLAYER*,int,int);
<br/>
} METHODS;
<br/>
<br/>
struct _PLAYER_{
<br/>
	//variables
<br/>
	METHODS *Methods;
<br/>
	u8 Action;
<br/>
	u8 Frame;
<br/>
};</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172629 - mog123 - Sun Feb 21, 2010 2:40 pm</h4>
    <div class="postbody"><span class="postbody">Another thing that's bugging me. Do I need to assign the function to hte function pointer everytime I need to use it?
<br/>
<br/>
Everything works when I do something like this(in a loop):
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">Player-&gt;Methods-&gt;Animate=Animate;
<br/>
Player-&gt;Methods-&gt;Animate(Player);</td> </tr></table><span class="postbody">
<br/>
<br/>
But when I move the upper line outside the loop, the function doesn't work. Is that how it's supposed to be?
<br/>
<br/>
<br/>
edit: fixed this.<br/>_________________<br/>Check out my GBA game in development : <a class="postlink" href="http://ninjatale.blogspot.com/" target="_blank">忍物語</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
