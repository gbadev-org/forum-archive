<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>memory - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > memory</h2>
<div id="posts">
<div class="post">
    <h4>#1370 - draigan - Fri Jan 17, 2003 8:03 am</h4>
    <div class="postbody"><span class="postbody">I've recently starting programming for the GBA using the DevKitAdvance sdk.  I'm curious as to the memory patterns on the GBA.  From what I've read, the GBA has 96k VRAM, 32K Fast ram (WRAM?) and 256k of External RAM.  That's in addition to the rom.  
<br/>
<br/>
My question is this:  in which memory locations are the following stored:
<br/>
<br/>
1) local variables
<br/>
2) global variables and arrays (for images and tables)
<br/>
3) executable code
<br/>
<br/>
I have a few more questions of course but this is a good beginning.  Thanks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1374 - ampz - Fri Jan 17, 2003 9:34 am</h4>
    <div class="postbody"><span class="postbody">That's up to you really.
<br/>
<br/>
Of course, VRAM is not a good place for code, but I don't think it's impossible to do, if you really want to...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1378 - Touchstone - Fri Jan 17, 2003 11:17 am</h4>
    <div class="postbody"><span class="postbody">I haven't used DevkitAdvance but I assume that this is how it is:
<br/>
- Global variables: BSS segment, located in WRAM (Fast RAM as you called it, this is located in the CPU silicon)
<br/>
- Local variables (local for a function): Stack or registers. Stack is most likely at the end of WRAM.
<br/>
- Initialized variables and arrays: DATA segment, probably in external RAM but possibly in ROM
<br/>
- Constant variables and arrays: Definitely ROM
<br/>
- Executable code: ROM
<br/>
<br/>
When you link you can create a mapfile, just pass the <span style="font-weight: bold">-Map thenameofyourmapfile.map</span> to the linker, that way you can look it up in your mapfile where all the symbols end up.<br/>_________________<br/>You can't beat our meat</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1379 - Quirky - Fri Jan 17, 2003 11:51 am</h4>
    <div class="postbody"><span class="postbody">This is my understanding of it...  
<br/>
<br/>
all non-const variables, certain code that you can define and the "stack" go in IWRAM. Intialised vars and arrays that are non const go here too, plus global variables and local ones. There was a bug I think with earlier releases of DKA where initialised vars were put in ROM, this meant that certain library functions were broken when tested on a Nintendo cart (they work "fine" on the flash advance as you could write to ROM!)
<br/>
<br/>
<br/>
malloc, etc - allocates from EWRAM - 256kb of this - the "heap", because it's big. Apart from explicitly stating the EWRAM section in your code, this is the only way variables go in EWRAM. It isn't too good for commonly used stuff though, because EWRAM is actually slower than ROM under most conditions. This is also where "multiboot" games are stored too. So if you use the multiboot cable for testing games, then you have less ram available to dynamically allocate to your program later.
<br/>
<br/>
As mentioned, the only data that goes in ROM is constant data.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1387 - draigan - Sat Jan 18, 2003 2:05 am</h4>
    <div class="postbody"><span class="postbody">Okay, now another few questions:
<br/>
<br/>
I have my app setup in mode5... I want to paint a fullscreen background image (160x128x16bit).  Obviously I can't store this in wram since it's too big.  Should I store it in rom instead?  If the eram is slower than rom, this seems like the best place right?  
<br/>
<br/>
I'm using the Arm and not Thumb.  Would I benefit in speed from using Thumb?
<br/>
<br/>
How can I put code into the Wram?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1393 - draigan - Sat Jan 18, 2003 3:34 am</h4>
    <div class="postbody"><span class="postbody">okay, I realize now how to put code in IWRAM.... what a speed improvement in Arm mode!  
<br/>
<br/>
My question is... is it okay to store background images in ROM or would I see a speed improvement by moving it to .ewram?  I'm asking this because I redraw this background image every frame.  People say that ewram is slower than ROM but what if I can read 32-bits at a time from ewram and only 16bits to ROM?  WOuld this speed difference still apply?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1395 - Splam - Sat Jan 18, 2003 4:34 am</h4>
    <div class="postbody"><span class="postbody">It's probably best to leave your background in rom (especially if it won't fit in ram ;) ).  I know it was probably just a "what if?" question on your part but I don't see why you would limit yourself to 16bit reads from rom.
<br/>
<br/>
<br/>
btw, just wondering why you draw your background each frame?  You blitting other stuff over it or something?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1397 - tepples - Sat Jan 18, 2003 5:14 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>draigan wrote:</b></span></td> </tr> <tr> <td class="quote">My question is... is it okay to store background images in ROM or would I see a speed improvement by moving it to .ewram?</td> </tr></table><span class="postbody">
<br/>
If you're repeatedly copying an image to VRAM, I'd advise storing it in ROM, enabling prefetch, and using a 16-bit DMA copy. This will give you the fastest copy. The only reason to store large constant data in EWRAM is if A. it's compressed, or B. you're making a multiboot program.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">what if I can read 32-bits at a time from ewram</td> </tr></table><span class="postbody">
<br/>
EWRAM is 16-bit.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1398 - tepples - Sat Jan 18, 2003 5:16 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ampz wrote:</b></span></td> </tr> <tr> <td class="quote">Of course, VRAM is not a good place for code</td> </tr></table><span class="postbody">
<br/>
Really? I'd think that if you're not using all of VRAM, it'd be a nice place to stash a couple Thumb subroutines. From my tests, even when the screen is turned on, reading and writing VRAM introduces fewer wait-states than reading and writing EWRAM or even reading ROM.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1400 - draigan - Sat Jan 18, 2003 5:50 am</h4>
    <div class="postbody"><span class="postbody"><span style="font-weight: bold">splam said</span>
<br/>
<span style="font-style: italic">I know it was probably just a "what if?" question on your part but I don't see why you would limit yourself to 16bit reads from rom.</span>
<br/>
<br/>
Well, I thought that ROM was 16-bit and therefore I could not read more than 16-bits at a time or otherwise introduce wait states... ie, it would be just as slow reading 32-bits at a time because it would have to fetch data in 16-bit chunks anyway.  Please correct me if I'm wrong here.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
