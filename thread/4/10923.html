<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>DevKitPro ARM base_rules - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > DevKitPro ARM base_rules</h2>
<div id="posts">
<div class="post">
    <h4>#99894 - gmiller - Thu Aug 24, 2006 5:01 pm</h4>
    <div class="postbody"><span class="postbody">I noticed a problem with the base rules make file with regard to the ability to build code for IWRAM  and some other related ARM verus THUMB mode lines.  The current order of the makefile will compile using the .o .c rule instead of the .iwram.o .iwram.c because of the order the rules are presented.  I don't think this is on purpose or if this is an appropriate place to note this.  My upper level make file uses these files to automate the make and minimize the customizing.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#---------------------------------------------------------------------------------
<br/>
# Clear the implicit built in rules
<br/>
#---------------------------------------------------------------------------------
<br/>
.SUFFIXES:
<br/>
#---------------------------------------------------------------------------------
<br/>
ifeq ($(strip $(DEVKITARM)),)
<br/>
$(error "Please set DEVKITARM in your environment. export DEVKITARM=&lt;path to&gt;devkitARM)
<br/>
endif
<br/>
<br/>
-include $(DEVKITARM)/gba_rules
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# TARGET is the name of the output, if this ends with _mb a multiboot image is generated
<br/>
# BUILD is the directory where object files &amp; intermediate files will be placed
<br/>
# SOURCES is a list of directories containing source code
<br/>
# DATA is a list of directories containing data files
<br/>
# INCLUDES is a list of directories containing header files
<br/>
#---------------------------------------------------------------------------------
<br/>
# HAM Stuff no longer used ....
<br/>
#
<br/>
#PROGNAME =unused
<br/>
#OFILES+= unused
<br/>
#ADD_LIBS+= unused   
<br/>
<br/>
# .................
<br/>
#
<br/>
<br/>
TARGET      :=   $(shell basename $(CURDIR))
<br/>
BUILD      :=   build
<br/>
SOURCES      :=   source
<br/>
DATA      :=   
<br/>
INCLUDES   :=   $(DEVKITARM)
<br/>
GDB_DIRS   =    $cdir:$cwd:$(ADD_GDB_SOURCE_DIRS)
<br/>
<br/>
ifeq ($(MAKECMDGOALS),gdb)
<br/>
DEBUG_SET   :=   gdb
<br/>
endif
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# options for code generation
<br/>
#---------------------------------------------------------------------------------
<br/>
ARCH   := -mthumb-interwork
<br/>
#ARCH   :=   -marm -mthumb-interwork
<br/>
<br/>
ifneq ($(DEBUG_SET),gdb)
<br/>
THIS_BUILD   :=   "Release Build"
<br/>
CFLAGS   :=   -Wall -O3\
<br/>
         -mcpu=arm7tdmi -mtune=arm7tdmi\
<br/>
          -fomit-frame-pointer\
<br/>
         -ffast-math \
<br/>
         $(ARCH)
<br/>
else
<br/>
THIS_BUILD   :=   "Debug Build"
<br/>
CFLAGS   :=   -g -Wall -O0\
<br/>
         -mcpu=arm7tdmi -mtune=arm7tdmi\
<br/>
         -ffast-math \
<br/>
         $(ARCH)
<br/>
endif
<br/>
CFLAGS   +=   $(INCLUDE)
<br/>
<br/>
ASFLAGS   :=   $(ARCH)
<br/>
<br/>
ifneq ($(DEBUG_SET),gdb)
<br/>
LDFLAGS   =   $(ARCH) -Wl,-Map,$(notdir $@).map
<br/>
else
<br/>
LDFLAGS   =   -g $(ARCH) -Wl,-Map,$(notdir $@).map
<br/>
endif
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# path to tools - this can be deleted if you set the path to the toolchain in windows
<br/>
#---------------------------------------------------------------------------------
<br/>
export PATH      :=   $(DEVKITARM)/bin:$(DEVKITPRO)/msys/bin:$(PATH)
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# any extra libraries we wish to link with the project
<br/>
#---------------------------------------------------------------------------------
<br/>
LIBS   := -ltonc
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# list of directories containing libraries, this must be the top level containing
<br/>
# include and lib
<br/>
#---------------------------------------------------------------------------------
<br/>
LIBDIRS   :=   $(LIBGBA) $(DEVKITPRO)/tonclib
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# no real need to edit anything past this point unless you need to add additional
<br/>
# rules for different file extensions
<br/>
#---------------------------------------------------------------------------------
<br/>
ifneq ($(BUILD),$(notdir $(CURDIR)))
<br/>
#---------------------------------------------------------------------------------
<br/>
<br/>
export OUTPUT   :=   $(CURDIR)/$(TARGET)
<br/>
export VPATH   :=   $(foreach dir,$(SOURCES),$(CURDIR)/$(dir)) \
<br/>
               $(foreach dir,$(DATA),$(CURDIR)/$(dir))
<br/>
<br/>
export DEPSDIR   :=   $(CURDIR)/$(BUILD)
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# automatically build a list of object files for our project
<br/>
#---------------------------------------------------------------------------------
<br/>
CFILES      :=   $(foreach dir,$(SOURCES),$(notdir $(wildcard $(dir)/*.c)))
<br/>
CPPFILES   :=   $(foreach dir,$(SOURCES),$(notdir $(wildcard $(dir)/*.cpp)))
<br/>
SFILES      :=   $(foreach dir,$(SOURCES),$(notdir $(wildcard $(dir)/*.s)))
<br/>
BINFILES   :=   $(foreach dir,$(DATA),$(notdir $(wildcard $(dir)/*.*)))
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# use CXX for linking C++ projects, CC for standard C
<br/>
#---------------------------------------------------------------------------------
<br/>
ifeq ($(strip $(CPPFILES)),)
<br/>
#---------------------------------------------------------------------------------
<br/>
   export LD   :=   $(CC)
<br/>
#---------------------------------------------------------------------------------
<br/>
else
<br/>
#---------------------------------------------------------------------------------
<br/>
   export LD   :=   $(CXX)
<br/>
#---------------------------------------------------------------------------------
<br/>
endif
<br/>
#---------------------------------------------------------------------------------
<br/>
<br/>
export OFILES   := $(addsuffix .o,$(BINFILES)) $(CPPFILES:.cpp=.o) $(CFILES:.c=.o) $(SFILES:.s=.o)
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# build a list of include paths
<br/>
#---------------------------------------------------------------------------------
<br/>
export INCLUDE   :=   $(foreach dir,$(INCLUDES),-I$(dir)/include) \
<br/>
               $(foreach dir,$(LIBDIRS),-I$(dir)/include) \
<br/>
               $(foreach dir,$(CURDIR), -I$(dir)/include) \
<br/>
               -I$(CURDIR)
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# build a list of library paths
<br/>
#---------------------------------------------------------------------------------
<br/>
export LIBPATHS   :=   $(foreach dir,$(LIBDIRS),-L$(dir)/lib)
<br/>
<br/>
.PHONY: $(BUILD) clean
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
$(BUILD):
<br/>
   @[ -d $@ ] || mkdir -p $@
<br/>
   make "DEBUG_SET=$(DEBUG_SET)" --no-print-directory -C $(BUILD) -f $(CURDIR)/Makefile
<br/>
<br/>
all   : buildtype $(BUILD)
<br/>
<br/>
buildtype:
<br/>
   @echo "Build type: " $(THIS_BUILD)
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
clean:
<br/>
   @echo clean ...
<br/>
   rm -fr $(BUILD) $(TARGET).elf $(TARGET).gba
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
vbawin:   clean all
<br/>
   $(DEVKITPRO)/tools/win32/vbawin.exe $(TARGET).gba
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
runvbawin:
<br/>
   $(DEVKITPRO)/tools/win32/vbawin.exe $(TARGET).gba
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
vba:   clean all
<br/>
   $(DEVKITPRO)/tools/win32/vbaSDL/vba.exe -3 $(TARGET).gba
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
runvba:
<br/>
   $(DEVKITPRO)/tools/win32/vbaSDL/vba.exe -3 $(TARGET).gba
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
startsdl:
<br/>
   $(DEVKITPRO)/tools/win32/vbaSDL/vba.exe -3 -Gtcp:44444 &amp;
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
makeini:
<br/>
   echo "File $(TARGET).elf" &gt; insight.ini
<br/>
   echo "target remote 127.0.0.1:44444" &gt;&gt;insight.ini
<br/>
   echo "load $(TARGET).elf" &gt;&gt;insight.ini
<br/>
   echo "b main" &gt;&gt;insight.ini
<br/>
   echo "directory $(GDB_DIRS)"&gt;&gt;insight.ini
<br/>
   echo "c" &gt;&gt;insight.ini
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
startinsight:
<br/>
   $(DEVKITPRO)/insight-6.4.50/bin/arm-elf-insight.exe --command=insight.ini $(TARGET).elf
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
gdb:   clean
<br/>
   @make "DEBUG_SET=$(DEBUG_SET)" all 
<br/>
   make startsdl makeini startinsight
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
rungdb: startsdl makeini startinsight
<br/>
<br/>
testinsight: makeini startinsight
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
else
<br/>
<br/>
DEPENDS   :=   $(OFILES:.o=.d)
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# main targets
<br/>
#---------------------------------------------------------------------------------
<br/>
$(OUTPUT).gba   :   $(OUTPUT).elf
<br/>
<br/>
$(OUTPUT).elf   :   $(OFILES)
<br/>
<br/>
%.o   :   %.pcx
<br/>
   echo $(notdir $&lt;)
<br/>
   $(bin2o)
<br/>
<br/>
-include $(DEPENDS)
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
endif
<br/>
#--------------------------------------------------------------------------------
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Here is my new modified base_rules
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#---------------------------------------------------------------------------------
<br/>
# path to tools - this can be deleted if you set the path in windows
<br/>
#---------------------------------------------------------------------------------
<br/>
export PATH      :=   $(DEVKITARM)/bin:$(PATH)
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# the prefix on the compiler executables
<br/>
#---------------------------------------------------------------------------------
<br/>
PREFIX      :=   arm-eabi-
<br/>
<br/>
export CC   :=   $(PREFIX)gcc
<br/>
export CXX   :=   $(PREFIX)g++
<br/>
export AS   :=   $(PREFIX)as
<br/>
export AR   :=   $(PREFIX)ar
<br/>
export OBJCOPY   :=   $(PREFIX)objcopy
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
%.a:
<br/>
#---------------------------------------------------------------------------------
<br/>
   @echo $(notdir $@)
<br/>
   @echo "'Lib' Rule"
<br/>
   @rm -f $@
<br/>
   $(AR) -rc $@ $^
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
%.iwram.o: %.iwram.cpp
<br/>
   @echo $(notdir $&lt;)
<br/>
   @echo "'CPP' IWRAM Rule"
<br/>
   $(CXX) -MMD -MP -MF $(DEPSDIR)/$*.d $(CXXFLAGS) -marm-c $&lt; -o $@
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
%.iwram.o: %.iwram.c
<br/>
   @echo $(notdir $&lt;)
<br/>
   @echo "'C' IWRAM Rule"
<br/>
   $(CC) -MMD -MP -MF $(DEPSDIR)/$*.d $(CFLAGS) -marm -c $&lt; -o $@
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
%.itcm.o: %.itcm.cpp
<br/>
   @echo $(notdir $&lt;)
<br/>
   @echo "'CPP' ARM Rule"
<br/>
   $(CXX) -MMD -MP -MF $(DEPSDIR)/$*.d $(CXXFLAGS) -marm -c $&lt; -o $@
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
%.itcm.o: %.itcm.c
<br/>
   @echo $(notdir $&lt;)
<br/>
   @echo "'C' ARM Rule"
<br/>
   $(CC) -MMD -MP -MF $(DEPSDIR)/$*.d $(CFLAGS) -marm -c $&lt; -o $@
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
%.o: %.cpp
<br/>
   @echo $(notdir $&lt;)
<br/>
   @echo "'CPP' Rule"
<br/>
   $(CXX) -MMD -MP -MF $(DEPSDIR)/$*.d $(CXXFLAGS) -mthumb -c $&lt; -o $@
<br/>
   
<br/>
#---------------------------------------------------------------------------------
<br/>
%.o: %.c
<br/>
   @echo $(notdir $&lt;)
<br/>
   @echo "'C' Rule"
<br/>
   $(CC) -MMD -MP -MF $(DEPSDIR)/$*.d $(CFLAGS) -mthumb -c $&lt; -o $@
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
%.iwram.o: %.iwram.s
<br/>
   @echo $(notdir $&lt;)
<br/>
   @echo "'ASM' IWRAM Rule"
<br/>
   $(CC) -MMD -MP -MF $(DEPSDIR)/$*.d -x assembler-with-cpp $(ASFLAGS) -marm -c $&lt; -o $@
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
%.iwram.o: %.iwram.S
<br/>
   @echo $(notdir $&lt;)
<br/>
   @echo "'ASM' IWRAM Rule"
<br/>
   $(CC) -MMD -MP -MF $(DEPSDIR)/$*.d -x assembler-with-cpp $(ASFLAGS) -marm -c $&lt; -o $@
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
%.o: %.s
<br/>
   @echo $(notdir $&lt;)
<br/>
   @echo "'ASM' Rule"
<br/>
   $(CC) -MMD -MP -MF $(DEPSDIR)/$*.d -x assembler-with-cpp $(ASFLAGS) -mthumb -c $&lt; -o $@
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
%.o: %.S
<br/>
   @echo $(notdir $&lt;)
<br/>
   @echo "'ASM' Rule"
<br/>
   $(CC) -MMD -MP -MF $(DEPSDIR)/$*.d -x assembler-with-cpp $(ASFLAGS) -mthumb -c $&lt; -o $@
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# canned command sequence for binary data
<br/>
#---------------------------------------------------------------------------------
<br/>
define bin2o
<br/>
   bin2s $&lt; | $(AS) $(ARCH) -o $(@)
<br/>
   echo "extern const u8" `(echo $(&lt;F) | sed -e 's/^\([0-9]\)/_\1/' | tr . _)`"_end[];" &gt; `(echo $(&lt;F) | tr . _)`.h
<br/>
   echo "extern const u8" `(echo $(&lt;F) | sed -e 's/^\([0-9]\)/_\1/' | tr . _)`"[];" &gt;&gt; `(echo $(&lt;F) | tr . _)`.h
<br/>
   echo "extern const u32" `(echo $(&lt;F) | sed -e 's/^\([0-9]\)/_\1/' | tr . _)`_size";" &gt;&gt; `(echo $(&lt;F) | tr . _)`.h
<br/>
endef
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#100441 - gmiller - Sun Aug 27, 2006 11:10 pm</h4>
    <div class="postbody"><span class="postbody">I ran into a problem that my ASM "include" directived would not use the include's that were passed in by the make file.  The problem is that the gcc in the base rules is not passing the include's to the assemble so need to be changed on the base rules to pass them.  Here it is:
<br/>
<br/>
My Makefile:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#---------------------------------------------------------------------------------
<br/>
# Clear the implicit built in rules
<br/>
#---------------------------------------------------------------------------------
<br/>
.SUFFIXES:
<br/>
#---------------------------------------------------------------------------------
<br/>
ifeq ($(strip $(DEVKITARM)),)
<br/>
$(error "Please set DEVKITARM in your environment. export DEVKITARM=&lt;path to&gt;devkitARM)
<br/>
endif
<br/>
<br/>
-include $(DEVKITARM)/gba_rules
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# TARGET is the name of the output, if this ends with _mb a multiboot image is generated
<br/>
# BUILD is the directory where object files &amp; intermediate files will be placed
<br/>
# SOURCES is a list of directories containing source code
<br/>
# DATA is a list of directories containing data files
<br/>
# INCLUDES is a list of directories containing header files
<br/>
#---------------------------------------------------------------------------------
<br/>
# HAM Stuff no longer used ....
<br/>
#
<br/>
#PROGNAME =unused
<br/>
#OFILES+= unused
<br/>
#ADD_LIBS+= unused   
<br/>
<br/>
# .................
<br/>
#
<br/>
<br/>
TARGET      :=   $(shell basename $(CURDIR))
<br/>
BUILD      :=   build
<br/>
SOURCES      :=   source
<br/>
DATA      :=   
<br/>
INCLUDES   :=   $(DEVKITARM)
<br/>
GDB_DIRS   =    $cdir:$cwd:$(ADD_GDB_SOURCE_DIRS)
<br/>
<br/>
ifeq ($(MAKECMDGOALS),gdb)
<br/>
DEBUG_SET   :=   gdb
<br/>
endif
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# options for code generation
<br/>
#---------------------------------------------------------------------------------
<br/>
ARCH   := -mthumb-interwork
<br/>
#ARCH   :=   -marm -mthumb-interwork
<br/>
<br/>
ifneq ($(DEBUG_SET),gdb)
<br/>
THIS_BUILD   :=   "Release Build"
<br/>
CFLAGS   :=   -Wall -O3\
<br/>
         -mcpu=arm7tdmi -mtune=arm7tdmi\
<br/>
          -fomit-frame-pointer\
<br/>
         -ffast-math \
<br/>
         $(ARCH)
<br/>
else
<br/>
THIS_BUILD   :=   "Debug Build"
<br/>
CFLAGS   :=   -g -Wall -O0\
<br/>
         -mcpu=arm7tdmi -mtune=arm7tdmi\
<br/>
         -ffast-math \
<br/>
         $(ARCH)
<br/>
endif
<br/>
CFLAGS   +=   $(INCLUDE)
<br/>
<br/>
ASFLAGS   :=   $(ARCH) $(HINCLUDE)
<br/>
<br/>
ifneq ($(DEBUG_SET),gdb)
<br/>
LDFLAGS   =   $(ARCH) -Wl,-Map,$(notdir $@).map
<br/>
else
<br/>
LDFLAGS   =   -g $(ARCH) -Wl,-Map,$(notdir $@).map
<br/>
endif
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# path to tools - this can be deleted if you set the path to the toolchain in windows
<br/>
#---------------------------------------------------------------------------------
<br/>
export PATH      :=   $(DEVKITARM)/bin:$(DEVKITPRO)/msys/bin:$(PATH)
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# any extra libraries we wish to link with the project
<br/>
#---------------------------------------------------------------------------------
<br/>
LIBS   := -ltonc
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# list of directories containing libraries, this must be the top level containing
<br/>
# include and lib
<br/>
#---------------------------------------------------------------------------------
<br/>
LIBDIRS   :=   $(LIBGBA) $(DEVKITPRO)/tonclib
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# no real need to edit anything past this point unless you need to add additional
<br/>
# rules for different file extensions
<br/>
#---------------------------------------------------------------------------------
<br/>
ifneq ($(BUILD),$(notdir $(CURDIR)))
<br/>
#---------------------------------------------------------------------------------
<br/>
<br/>
export OUTPUT   :=   $(CURDIR)/$(TARGET)
<br/>
export VPATH   :=   $(foreach dir,$(SOURCES),$(CURDIR)/$(dir)) \
<br/>
               $(foreach dir,$(DATA),$(CURDIR)/$(dir))
<br/>
<br/>
export DEPSDIR   :=   $(CURDIR)/$(BUILD)
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# automatically build a list of object files for our project
<br/>
#---------------------------------------------------------------------------------
<br/>
CFILES      :=   $(foreach dir,$(SOURCES),$(notdir $(wildcard $(dir)/*.c)))
<br/>
CPPFILES   :=   $(foreach dir,$(SOURCES),$(notdir $(wildcard $(dir)/*.cpp)))
<br/>
SFILES      :=   $(foreach dir,$(SOURCES),$(notdir $(wildcard $(dir)/*.s)))
<br/>
BINFILES   :=   $(foreach dir,$(DATA),$(notdir $(wildcard $(dir)/*.*)))
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# use CXX for linking C++ projects, CC for standard C
<br/>
#---------------------------------------------------------------------------------
<br/>
ifeq ($(strip $(CPPFILES)),)
<br/>
#---------------------------------------------------------------------------------
<br/>
   export LD   :=   $(CC)
<br/>
#---------------------------------------------------------------------------------
<br/>
else
<br/>
#---------------------------------------------------------------------------------
<br/>
   export LD   :=   $(CXX)
<br/>
#---------------------------------------------------------------------------------
<br/>
endif
<br/>
#---------------------------------------------------------------------------------
<br/>
<br/>
export OFILES   := $(addsuffix .o,$(BINFILES)) $(CPPFILES:.cpp=.o) $(CFILES:.c=.o) $(SFILES:.s=.o)
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# build a list of include paths
<br/>
#---------------------------------------------------------------------------------
<br/>
export INCLUDE   :=   $(foreach dir,$(INCLUDES),-I$(dir)/include) \
<br/>
               $(foreach dir,$(LIBDIRS),-I$(dir)/include) \
<br/>
               $(foreach dir,$(CURDIR), -I$(dir)/include) \
<br/>
               -I$(CURDIR)
<br/>
<br/>
export HINCLUDE   :=   $(foreach dir,$(INCLUDES),-Xassembler -I$(dir)/include) \
<br/>
               $(foreach dir,$(LIBDIRS),-Xassembler -I$(dir)/include) \
<br/>
               $(foreach dir,$(CURDIR), -Xassembler -I$(dir)/include) \
<br/>
               -Xassembler -I$(CURDIR)
<br/>
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# build a list of library paths
<br/>
#---------------------------------------------------------------------------------
<br/>
export LIBPATHS   :=   $(foreach dir,$(LIBDIRS),-L$(dir)/lib)
<br/>
<br/>
.PHONY: $(BUILD) clean
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
$(BUILD):
<br/>
   @[ -d $@ ] || mkdir -p $@
<br/>
   make "DEBUG_SET=$(DEBUG_SET)" --no-print-directory -C $(BUILD) -f $(CURDIR)/Makefile
<br/>
<br/>
all   : buildtype $(BUILD)
<br/>
<br/>
buildtype:
<br/>
   @echo "Build type: " $(THIS_BUILD)
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
clean:
<br/>
   @echo clean ...
<br/>
   rm -fr $(BUILD) $(TARGET).elf $(TARGET).gba
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
vbawin:   clean all
<br/>
   $(DEVKITPRO)/tools/win32/vbawin.exe $(TARGET).gba
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
runvbawin:
<br/>
   $(DEVKITPRO)/tools/win32/vbawin.exe $(TARGET).gba
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
vba:   clean all
<br/>
   $(DEVKITPRO)/tools/win32/vbaSDL/vba.exe -3 $(TARGET).gba
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
runvba:
<br/>
   $(DEVKITPRO)/tools/win32/vbaSDL/vba.exe -3 $(TARGET).gba
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
startsdl:
<br/>
   $(DEVKITPRO)/tools/win32/vbaSDL/vba.exe -3 -Gtcp:44444 &amp;
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
makeini:
<br/>
   echo "File $(TARGET).elf" &gt; insight.ini
<br/>
   echo "target remote 127.0.0.1:44444" &gt;&gt;insight.ini
<br/>
   echo "load $(TARGET).elf" &gt;&gt;insight.ini
<br/>
   echo "b main" &gt;&gt;insight.ini
<br/>
   echo "directory $(GDB_DIRS)"&gt;&gt;insight.ini
<br/>
   echo "c" &gt;&gt;insight.ini
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
startinsight:
<br/>
   $(DEVKITPRO)/insight-6.4.50/bin/arm-elf-insight.exe --command=insight.ini $(TARGET).elf
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
gdb:   clean
<br/>
   @make "DEBUG_SET=$(DEBUG_SET)" all 
<br/>
   make startsdl makeini startinsight
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
rungdb: startsdl makeini startinsight
<br/>
<br/>
testinsight: makeini startinsight
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
else
<br/>
<br/>
DEPENDS   :=   $(OFILES:.o=.d)
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# main targets
<br/>
#---------------------------------------------------------------------------------
<br/>
$(OUTPUT).gba   :   $(OUTPUT).elf
<br/>
<br/>
$(OUTPUT).elf   :   $(OFILES)
<br/>
<br/>
%.o   :   %.pcx
<br/>
   echo $(notdir $&lt;)
<br/>
   $(bin2o)
<br/>
<br/>
-include $(DEPENDS)
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
endif
<br/>
#--------------------------------------------------------------------------------
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
My current base_rules:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#---------------------------------------------------------------------------------
<br/>
# path to tools - this can be deleted if you set the path in windows
<br/>
#---------------------------------------------------------------------------------
<br/>
export PATH      :=   $(DEVKITARM)/bin:$(PATH)
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# the prefix on the compiler executables
<br/>
#---------------------------------------------------------------------------------
<br/>
PREFIX      :=   arm-eabi-
<br/>
<br/>
export CC   :=   $(PREFIX)gcc
<br/>
export CXX   :=   $(PREFIX)g++
<br/>
export AS   :=   $(PREFIX)as
<br/>
export AR   :=   $(PREFIX)ar
<br/>
export OBJCOPY   :=   $(PREFIX)objcopy
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
%.a:
<br/>
#---------------------------------------------------------------------------------
<br/>
   @echo $(notdir $@)
<br/>
   @echo "'Lib' Rule"
<br/>
   @rm -f $@
<br/>
   $(AR) -rc $@ $^
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
%.iwram.o: %.iwram.cpp
<br/>
   @echo $(notdir $&lt;)
<br/>
   @echo "'CPP' IWRAM Rule"
<br/>
   $(CXX) -MMD -MP -MF $(DEPSDIR)/$*.d -marm $(CXXFLAGS) -c $&lt; -o $@
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
%.iwram.o: %.iwram.c
<br/>
   @echo $(notdir $&lt;)
<br/>
   @echo "'C' IWRAM Rule"
<br/>
   $(CC) -MMD -MP -MF $(DEPSDIR)/$*.d -marm $(CFLAGS) -c $&lt; -o $@
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
%.itcm.o: %.itcm.cpp
<br/>
   @echo $(notdir $&lt;)
<br/>
   @echo "'CPP' ARM Rule"
<br/>
   $(CXX) -MMD -MP -MF $(DEPSDIR)/$*.d -marm $(CXXFLAGS) -c $&lt; -o $@
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
%.itcm.o: %.itcm.c
<br/>
   @echo $(notdir $&lt;)
<br/>
   @echo "'C' ARM Rule"
<br/>
   $(CC) -MMD -MP -MF $(DEPSDIR)/$*.d -marm $(CFLAGS) -c $&lt; -o $@
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
%.o: %.cpp
<br/>
   @echo $(notdir $&lt;)
<br/>
   @echo "'CPP' Rule"
<br/>
   $(CXX) -MMD -MP -MF $(DEPSDIR)/$*.d -mthumb $(CXXFLAGS) -c $&lt; -o $@
<br/>
   
<br/>
#---------------------------------------------------------------------------------
<br/>
%.o: %.c
<br/>
   @echo $(notdir $&lt;)
<br/>
   @echo "'C' Rule"
<br/>
   $(CC) -MMD -MP -MF $(DEPSDIR)/$*.d -mthumb $(CFLAGS) -c $&lt; -o $@
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
%.iwram.o: %.iwram.s
<br/>
   @echo $(notdir $&lt;)
<br/>
   @echo "'ASM' ARM IWRAM Rule"
<br/>
   $(CC) -MMD -MP -MF $(DEPSDIR)/$*.d -x assembler-with-cpp -marm $(ASFLAGS) -c $&lt; -o $@
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
%.iwram.o: %.iwram.S
<br/>
   @echo $(notdir $&lt;)
<br/>
   @echo "'ASM' ARM IWRAM Rule"
<br/>
   $(CC) -MMD -MP -MF $(DEPSDIR)/$*.d -x assembler-with-cpp -marm $(ASFLAGS) -c $&lt; -o $@
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
%.o: %.s
<br/>
   @echo $(notdir $&lt;)
<br/>
   @echo "'ASM' THUMB Rule"
<br/>
   $(CC) -MMD -MP -MF $(DEPSDIR)/$*.d -x assembler-with-cpp -mthumb $(ASFLAGS) -c $&lt; -o $@
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
%.o: %.S
<br/>
   @echo $(notdir $&lt;)
<br/>
   @echo "'ASM' THUMB Rule"
<br/>
   $(CC) -MMD -MP -MF $(DEPSDIR)/$*.d -x assembler-with-cpp -mthumb $(ASFLAGS) -c $&lt; -o $@
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# canned command sequence for binary data
<br/>
#---------------------------------------------------------------------------------
<br/>
define bin2o
<br/>
   bin2s $&lt; | $(AS) $(ARCH) -o $(@)
<br/>
   echo "extern const u8" `(echo $(&lt;F) | sed -e 's/^\([0-9]\)/_\1/' | tr . _)`"_end[];" &gt; `(echo $(&lt;F) | tr . _)`.h
<br/>
   echo "extern const u8" `(echo $(&lt;F) | sed -e 's/^\([0-9]\)/_\1/' | tr . _)`"[];" &gt;&gt; `(echo $(&lt;F) | tr . _)`.h
<br/>
   echo "extern const u32" `(echo $(&lt;F) | sed -e 's/^\([0-9]\)/_\1/' | tr . _)`_size";" &gt;&gt; `(echo $(&lt;F) | tr . _)`.h
<br/>
endef
<br/>
<br/>
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
