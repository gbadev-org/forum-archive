<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Not sure about this... - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Coding > Not sure about this...</h2>
<div id="posts">
<div class="post">
    <h4>#9319 - VgSlag - Fri Aug 01, 2003 2:10 pm</h4>
    <div class="postbody"><span class="postbody">I've posted something in beginners forum but am not sure if it's better suited to this one?
<br/>
<br/>
I don't want to start cross-posting but maybe there are more people that can help in this one?
<br/>
<br/>
If you could take a look <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=1823" target="_blank">here</a> it would be much appreciated.
<br/>
<br/>
Sorry if this is considered a cross post, feel free to delete it!
<br/>
<br/>
Thanks,
<br/>
<br/>
G</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9321 - Nessie - Fri Aug 01, 2003 4:11 pm</h4>
    <div class="postbody"><span class="postbody">Hmm, perhaps a bit too early in the morning to risk thinking about something, but...heh..
<br/>
<br/>
Anyway, if you are using signed fixed 16:16 (s32), I'd think that using distanceSquared would overflow the datatype so fast, I'd be surprised it would ever work?  It should be easy enough to check whether this is part of your problem or not...
<br/>
<br/>
So...howz about this assuming your shot is just a pixel:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">s32 distX, distY, distSquared;
<br/>
<br/>
distX = bulletX - asteroidX;  // get x, y difference with our fixed point values
<br/>
distY = bulletY - asteroidY;
<br/>
<br/>
distX &gt;&gt;= 16; // convert from fixed
<br/>
distY &gt;&gt;= 16;
<br/>
<br/>
distSquared = distX * distX + distY * distY;
<br/>
<br/>
if ( distSquared &lt;= ASTEROID_RADIUS_SQUARED )
<br/>
{
<br/>
    // Collision!
<br/>
}</td> </tr></table><span class="postbody">
<br/>
Note that ASTEROID_RADIUS_SQUARED is not a fixed point value..and if your shot is something larger than a pixel, like a roundish sprite or something, you can slightly improve the accuracy of the check by something like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">if ( distSquared &lt;= (ASTEROID_RADIUS_SQUARED + SHOT_RADIUS_SQUARED))
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9322 - VgSlag - Fri Aug 01, 2003 4:37 pm</h4>
    <div class="postbody"><span class="postbody">I'm only checking against a single pixel for the shot as it's small enough not to worry.
<br/>
<br/>
What you suggested has worked but I was trying to avoid doing any math on floats as I'm going to need to check up to 4 bullets on upto 4 asteroids per frame.
<br/>
<br/>
Any idea how I could stop them overflowing?
<br/>
<br/>
Thanks for the help btw</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9327 - tepples - Fri Aug 01, 2003 6:24 pm</h4>
    <div class="postbody"><span class="postbody">Try shifting the value to the right 8 bits (making it 24.8) before squaring it.  Then when you multiply two 24.8s, you get a 16.16.
<br/>
<br/>
There's still a chance of overflow if the radius is large enough, so check the bounding square before you check the bounding circle.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9341 - Nessie - Sat Aug 02, 2003 1:35 am</h4>
    <div class="postbody"><span class="postbody">Actually not--there is no usage of floats anywhere in the math I proposed.   Anyway, if you are worried about speed and aren't into ASM, another solution which may or may not be faster (depending on how fast abs() is and whether the typical bullet will slip past the below test but still fail the full test) could be as simple as a quick early out:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">if ( abs(bulletX - asteroidX) &lt;= ASTEROID_RADIUS_FIXED ) 
<br/>
{ 
<br/>
    // Potential collision!  Do more conclusive testing to make sure
<br/>
    //  ..as in, maybe do the full blown distance squared check
<br/>
}
<br/>
</td> </tr></table><span class="postbody">...I'm sure there are plenty of other ways to do a rough first cut to rule out most of the asteroids.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9350 - VgSlag - Sat Aug 02, 2003 2:26 pm</h4>
    <div class="postbody"><span class="postbody">Cheers Nessie,
<br/>
<br/>
I've stuck with your first answer, it's really fast, when checking 5 asteroids against all the bullets it's still greased fast.
<br/>
<br/>
Thanks for your help you two, I'll put the file up here when it's finished if you wanna play it.
<br/>
<br/>
G</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
