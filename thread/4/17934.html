<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>ADRL restriction in DevKitPRO - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > ADRL restriction in DevKitPRO</h2>
<div id="posts">
<div class="post">
    <h4>#177856 - WriteASM - Tue Apr 09, 2013 2:03 pm</h4>
    <div class="postbody"><span class="postbody">I'm using DevKitPRO for ASM GBA development, but couldn't figure out why the following code wasn't working:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">adrl r0, ARMInter      @ Start the Interpreter over again.
<br/>
</td> </tr></table><span class="postbody">
<br/>
DevKitPRO would always say, "undefined symbol ARMInter used as an immediate value", even though it was defined as GLOBAL in the appropriate code file.  Then I found the following in "as.info":
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">`ADRL'
<br/>
            adrl &lt;register&gt; &lt;label&gt;
<br/>
<br/>
     This instruction will load the address of LABEL into the indicated
<br/>
     register.  The instruction will evaluate to one or two PC relative
<br/>
     ADD or SUB instructions depending upon where the label is located.
<br/>
     If a second instruction is not needed a NOP instruction will be
<br/>
     generated in its place, so that this instruction is always 8 bytes
<br/>
     long.
<br/>
<br/>
     If the label is out of range, <span style="font-weight: bold">or if it is not defined in the same
<br/>
     file (and section) as the ADRL instruction, then an error will be
<br/>
     generated</span>.  This instruction will not make use of the literal pool.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Does anyone know exactly why the restriction is there?  Or a way around it?  (It's also on ADR.)
<br/>
In my opinion, DevKitPRO would be much better off without that restriction.  I'm writing the address to the return stack, and don't want to use "LDR R0, =ARMInter", as then the code isn't relocatable.  
<br/>
<br/>
(I'm using multiple code files so that I don't have one 14,272-line file, which would be a little unmanageable, to say the least.)<br/>_________________<br/>"Finally, brethren, whatever is true, whatever is honorable, whatever is right, whatever is pure, whatever is lovely, whatever is of good repute, if there is any excellence and if anything worthy of praise, dwell on these things." (Philippians 4:8)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#177857 - Dwedit - Tue Apr 09, 2013 2:05 pm</h4>
    <div class="postbody"><span class="postbody">For a while, I was using #include to work around those problems.  One ASM file includes everything else.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
