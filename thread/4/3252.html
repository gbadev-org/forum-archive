<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>color palette question - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > color palette question</h2>
<div id="posts">
<div class="post">
    <h4>#19392 - CyberSlag5k - Mon Apr 19, 2004 2:27 am</h4>
    <div class="postbody"><span class="postbody">I've posted this on the gamedev.net forums, and, getting no response, have posted them here. I hope that's ok.
<br/>
<br/>
Anyway, I am doing my first sprite-animation work for the gba. The sprites show up, but they are severely miscolored (all but one, usually). So, following gbajunkie's tutorial #4, I have combined my four sprites into a single image and then passed that image into OBJPaletteMem:
<br/>
<br/>
for(int i = 0; i &lt; 256; i++)
<br/>
     OBJPaletteMem[ i ] = palettePalette[ i ];
<br/>
<br/>
My combined sprite picture (which is what palettePalette is derivced from) looks like this:
<br/>
<br/>
&lt;img src="http://homepages.udayton.edu/~pateramj/palette.gif"&gt;
<br/>
<br/>
Each one of those faces is a different sprite. Is this not the proper way to do that? It's not exactly working. In fact, the colors are now even farther off than they were previously.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19393 - Miked0801 - Mon Apr 19, 2004 2:36 am</h4>
    <div class="postbody"><span class="postbody">A bit more source may help us decypher what is going on...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19396 - zazery - Mon Apr 19, 2004 3:25 am</h4>
    <div class="postbody"><span class="postbody">I used pcx2sprite.exe what I did to keep my same colours was to load the same pallete for each file in Photoshop. Basically in your case I would have 4 layers, same pallete for the entire project, then save 4 different images. It worked for me I didn't have a problem with it. (my sprites for my game)
<br/>
<br/>
If you could provide the following it might help: 
<br/>
-Generated Pallete code for one of your sprites
<br/>
-Screenshot of your VBA Pallete viewer and Photoshop Pallete depending on if you use Photoshop.
<br/>
-Complete code to how you set up your sprites (just that part, not input routines etc.)
<br/>
-Screenshot of what's happening.
<br/>
<br/>
Or 
<br/>
<br/>
Post everything your using in a zip file including images and source, possibly a binary as well. 
<br/>
<br/>
Best of luck solving your problem, I know palletes can get frusterating when starting out.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19407 - yaustar - Mon Apr 19, 2004 6:19 am</h4>
    <div class="postbody"><span class="postbody">What are the faces suppose to look like.
<br/>
<br/>
pcx2sprites isnt the best tool to do multi tiles... use gif2sprites instead, you can input as many images as you want and it does a combined palette for you.<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19423 - CyberSlag5k - Mon Apr 19, 2004 7:56 pm</h4>
    <div class="postbody"><span class="postbody">Thanks to all who replied. Here are the requested details of what I'm trying to do:
<br/>
<br/>
I have 4 sprites, soldier1.pcx soldier2.pcx soldier3.pcx and soldier4.pcx. They are all 64x64 frames and each one is just a soldier's head, each with his visor in 1 of 4 states of closing (1 is all the way open, 4 is closed). I have converted them all to .h files using pcx2sprite. I also have one large pcx file that is made up of all 4 sprites placed next to each other. It is named palette.pcx and can be seen here:
<br/>
<br/>
<a href="http://homepages.udayton.edu/~pateramj/palette.gif" target="_blank">http://homepages.udayton.edu/~pateramj/palette.gif</a>
<br/>
<br/>
Now, I have run sprite2pcx on this as well but have discarded the data portion of it and saved only its color palette. I have done this to create a color palette that includes all of the colors my sprites are made up of.
<br/>
<br/>
The relevant code is here:
<br/>
<br/>
#include"gba.h"
<br/>
#include"keypad.h"
<br/>
#include"palette.h"
<br/>
#include"FF.h"
<br/>
#include"soldier1.h"
<br/>
#include"soldier2.h"
<br/>
#include"soldier3.h"
<br/>
#include"soldier4.h"
<br/>
#include "dispcnt.h"
<br/>
#include"sprite.h"
<br/>
//#include&lt;winmm&gt;
<br/>
<br/>
using namespace std;
<br/>
<br/>
typedef struct
<br/>
{
<br/>
	int posX, posY;
<br/>
	u16 spriteFrame[4];
<br/>
	int activeFrame;
<br/>
	u16 OAMSpriteNum;
<br/>
}Sprite;
<br/>
<br/>
Sprite soldier;
<br/>
<br/>
u16* videoBuffeer = ((u16*)0x6000000);
<br/>
u16* paletteMem = ((u16*)0x5000000);
<br/>
u16* OAM = ((u16*)0x7000000);
<br/>
<br/>
OAMEntry sprites[128];
<br/>
pRotData rotData = (pRotData)sprites;
<br/>
<br/>
void copyOAM()
<br/>
{
<br/>
	u16* temp;
<br/>
	temp = (u16*)sprites;
<br/>
	for(u16 i = 0; i &lt; 512; i++)
<br/>
		OAM[i] = temp[i];
<br/>
}
<br/>
<br/>
void initializeSprites()
<br/>
{
<br/>
	for(u16 i = 0; i &lt; 128; i++)
<br/>
	{
<br/>
		sprites[i].attribute0 = 160;
<br/>
		sprites[i].attribute1 = 240;
<br/>
	}
<br/>
}
<br/>
<br/>
void VSync()
<br/>
{
<br/>
	while((volatile u16)REG_VCOUNT != 160)
<br/>
	{
<br/>
	}
<br/>
}
<br/>
<br/>
<br/>
void plotPixel(int x, int y, unsigned short int c)
<br/>
{
<br/>
	videoBuffeer[(y) * 120 + (x)] = (c);
<br/>
}
<br/>
<br/>
void setMode(u16 mode)
<br/>
{
<br/>
	REG_DISPCNT = mode;
<br/>
}
<br/>
<br/>
void getInput()
<br/>
{
<br/>
	if(!(*KEYS &amp; KEY_LEFT))
<br/>
	{
<br/>
		soldier.activeFrame = 0;
<br/>
		sprites[soldier.OAMSpriteNum].attribute2 = soldier.spriteFrame[soldier.activeFrame];
<br/>
	}
<br/>
	if(!(*KEYS &amp; KEY_DOWN))
<br/>
	{
<br/>
		soldier.activeFrame = 1;
<br/>
		sprites[soldier.OAMSpriteNum].attribute2 = soldier.spriteFrame[soldier.activeFrame];
<br/>
	}
<br/>
	if(!(*KEYS &amp; KEY_RIGHT))
<br/>
	{
<br/>
		soldier.activeFrame = 2;
<br/>
		sprites[soldier.OAMSpriteNum].attribute2 = soldier.spriteFrame[soldier.activeFrame];
<br/>
	}
<br/>
	if(!(*KEYS &amp; KEY_UP))
<br/>
	{
<br/>
		soldier.activeFrame = 3;
<br/>
		sprites[soldier.OAMSpriteNum].attribute2 = soldier.spriteFrame[soldier.activeFrame];
<br/>
	}
<br/>
}
<br/>
<br/>
int main()
<br/>
{
<br/>
	soldier.posX = 20;
<br/>
	soldier.posY = 40;
<br/>
<br/>
	setMode(MODE_1 | OBJ_ENABLE | OBJ_MAP_1D);
<br/>
<br/>
	for(int i = 0; i &lt; 256; i++)
<br/>
	{
<br/>
		OBJPaletteMem[i] = palettePalette[i];
<br/>
	}
<br/>
<br/>
	initializeSprites();
<br/>
<br/>
	sprites[0].attribute0 = COLOR_256 | SQUARE | soldier.posY;
<br/>
	sprites[0].attribute1 = SIZE_64 | soldier.posX;
<br/>
	sprites[0].attribute2 = 0;
<br/>
<br/>
	for(int i = 0; i &lt; 2048; i++)
<br/>
	{
<br/>
		OAMData[i] = soldier1Data[i];
<br/>
	}
<br/>
	for(int i = 0; i &lt; 2048; i++)
<br/>
	{
<br/>
		OAMData[i + 2048] = soldier2Data[i];
<br/>
	}
<br/>
	for(int i = 0; i &lt; 2048; i++)
<br/>
	{
<br/>
		OAMData[i + 4096] = soldier3Data[i];
<br/>
	}
<br/>
	for(int i = 0; i &lt; 2048; i++)
<br/>
	{
<br/>
		OAMData[i + 6144] = soldier4Data[i];
<br/>
	}
<br/>
<br/>
	soldier.OAMSpriteNum = 0;
<br/>
	soldier.activeFrame = 0;
<br/>
	soldier.spriteFrame[0] = 0;
<br/>
	soldier.spriteFrame[1] = 128;
<br/>
	soldier.spriteFrame[2] = 256;
<br/>
	soldier.spriteFrame[3] = 384;
<br/>
<br/>
	while(1)
<br/>
	{
<br/>
		getInput();
<br/>
		VSync();
<br/>
		copyOAM();
<br/>
	}
<br/>
<br/>
	return 0;
<br/>
}
<br/>
<br/>
When I run the program, the various sprites show up, but their colors are skewed, leading me to believe the color palette is wrong. Usually one of the 4 sprites has correct color and the others are just plan weird. I'm thinking my palette is screwy.
<br/>
<br/>
If further details are needed, I would be happy to supply them.
<br/>
<br/>
In the mean time, I'm going to play with this rather intriguing pcx2gif program.
<br/>
<br/>
Thank you for all your help everyone.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19433 - CyberSlag5k - Tue Apr 20, 2004 1:18 am</h4>
    <div class="postbody"><span class="postbody">UPDATE: gifs2sprites rocks. all problems solved. thanks for everyone'sh elp</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19435 - yaustar - Tue Apr 20, 2004 2:19 am</h4>
    <div class="postbody"><span class="postbody">Use code tags next time will ya? :)
<br/>
<br/>
We had the same problem with pcx2sprites so we found gif2sprites
<br/>
take a look at gfx2sprites as it is more verstile when you get some time :)<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19438 - CyberSlag5k - Tue Apr 20, 2004 2:30 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yaustar wrote:</b></span></td> </tr> <tr> <td class="quote">Use code tags next time will ya? :)
<br/>
<br/>
We had the same problem with pcx2sprites so we found gif2sprites
<br/>
take a look at gfx2sprites as it is more verstile when you get some time :)</td> </tr></table><span class="postbody">
<br/>
<br/>
Yeah, sorry about that.
<br/>
<br/>
Checking on gfx2sprites now. Thanks!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19439 - CyberSlag5k - Tue Apr 20, 2004 2:34 am</h4>
    <div class="postbody"><span class="postbody">Hmm...can't seem to find gfx2sprites in the tools section or on google. Gotta link?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19444 - yaustar - Tue Apr 20, 2004 4:08 am</h4>
    <div class="postbody"><span class="postbody">Gfx2gba not gfx2sprites, my bad... I keep getting it wrong...... :(<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
