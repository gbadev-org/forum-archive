<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Simplest scripting language implementation - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > Simplest scripting language implementation</h2>
<div id="posts">
<div class="post">
    <h4>#145689 - keldon - Tue Nov 20, 2007 2:41 pm</h4>
    <div class="postbody"><span class="postbody">I'm looking for approaches to creating extremely simple scripting languages capable of at least if/else constructs and [maybe] for/while loops.
<br/>
<br/>
On top of this I would like to make it possible to write something of the following nature:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">if (cond)
<br/>
   begin
<br/>
<br/>
   if (cond)
<br/>
      some_instruction ()
<br/>
<br/>
   end
<br/>
<br/>
else if (cond)
<br/>
   begin
<br/>
   some_instruction ()
<br/>
   end
<br/>
else
<br/>
   begin
<br/>
   end</td> </tr></table><span class="postbody">
<br/>
<br/>
I have a [general] approach already written down (as a design, not code), which I started writing at about 6am this morning; but maybe someone has already written relevant accounts of their own findings.
<br/>
<br/>
On another note I just noticed that ...
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">if (cond)
<br/>
   some_instruction ()
<br/>
else if (cond)
<br/>
   some_instruction ()
<br/>
else if (cond)
<br/>
   some_instruction ()
<br/>
else if (cond)
<br/>
   some_instruction ()
<br/>
else if (cond)
<br/>
   some_instruction ()</td> </tr></table><span class="postbody">
<br/>
... is technically treated as ...
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">if (cond)
<br/>
{
<br/>
   some_instruction ()
<br/>
}
<br/>
else
<br/>
{
<br/>
   if (cond)
<br/>
   {
<br/>
      some_instruction ()
<br/>
   }
<br/>
   else
<br/>
   {
<br/>
      if (cond)
<br/>
      {
<br/>
         some_instruction ()
<br/>
      }
<br/>
      else
<br/>
      {
<br/>
         if (cond)
<br/>
         {
<br/>
            some_instruction ()
<br/>
         }
<br/>
         else
<br/>
         {
<br/>
            if (cond)
<br/>
            {
<br/>
               some_instruction ()
<br/>
            }
<br/>
         }
<br/>
      }
<br/>
   }
<br/>
}</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145694 - ps2aich - Tue Nov 20, 2007 5:09 pm</h4>
    <div class="postbody"><span class="postbody">I would recommend the <a class="postlink" href="http://en.wikipedia.org/wiki/Interpreter_pattern" target="_blank">Interpreter pattern</a>, or very similar, the <a class="postlink" href="http://en.wikipedia.org/wiki/Visitor_pattern" target="_blank">Visitor pattern</a> on some own very small syntax tree.
<br/>
<br/>
Main problem will be to create a simple parser for your syntax that creates the Syntax tree, since on larger systems (e.g. PC) you can simply use an parser generator for this purpose (and don't bother about memory and speed requirements).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145709 - sajiimori - Tue Nov 20, 2007 8:15 pm</h4>
    <div class="postbody"><span class="postbody">If you don't need to write code directly on the DS, definitely compile to bytecode on your PC!  It greatly simplifies the interpreter.
<br/>
<br/>
If this is your first language, I'd suggest hand-writing a recursive descent parser.  It's pretty fun, and not too hard.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145724 - keldon - Wed Nov 21, 2007 12:13 am</h4>
    <div class="postbody"><span class="postbody">Thanks, well I've printed out plenty on the topics you've both given and I'll give them a look in the morning.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145876 - keldon - Sat Nov 24, 2007 2:27 pm</h4>
    <div class="postbody"><span class="postbody">Ok, my next main task is garbage collection now that I've cracked lexing as I think it makes scripting 1 000 times easier when you don't have to maintain references - the VM &amp; compiler is not a problem to make.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145883 - Ant6n - Sat Nov 24, 2007 9:09 pm</h4>
    <div class="postbody"><span class="postbody">you should take a compilers course ;)
<br/>
<a href="http://www.sable.mcgill.ca/~cpicke/520/#WEEKBYWEEK" target="_blank">http://www.sable.mcgill.ca/~cpicke/520/#WEEKBYWEEK</a>
<br/>
week11 grabrage collection</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145886 - keldon - Sat Nov 24, 2007 9:33 pm</h4>
    <div class="postbody"><span class="postbody">Ok, I'm downloading every slide! Don't really have time to take a course though (well not any I've seen), but I do have a big 1 000 page book on scripting from work that I am now half way though! I'm quite confident in creating garbage collection as I've read some IBM and Sun information on it, plus my personal need for it is not sophisticated at all. Not even for in game logic!
<br/>
<br/>
Thanks for the link, it will come in handy and give me cues on what books to read. Having said that, I could introduce scripting at quite a late date; or at least the sophisticated parts.
<br/>
<br/>
Well I'll follow that compilers course from week one once my bandwidth gets its act together; keep the help coming ^_^</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145968 - naleksiev - Mon Nov 26, 2007 6:48 pm</h4>
    <div class="postbody"><span class="postbody">I'm aways using LISP like syntax for my scripts. I found it very easy to implement parser for it. 
<br/>
<br/>
With such simple syntax you can easily compile it on the GBA/DS</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145969 - Kyoufu Kawa - Mon Nov 26, 2007 8:20 pm</h4>
    <div class="postbody"><span class="postbody">I like Pok?mon-style sequential scripts. They're comfy and easy to extend.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145971 - keldon - Mon Nov 26, 2007 10:41 pm</h4>
    <div class="postbody"><span class="postbody">Hmm, LISP looks interesting, the way it operates is clever! I'm still thinking about garbage collection, I mean I'm not using it for in game logic, or where speed is important. It's basically for the GUI, I thought it would be fun to treat screens like HTML pages. So I've been experimenting with it - part for R&amp;D at work, part for my web site, and part for fun.
<br/>
<br/>
Well at work I'm working on the PC, so memory is so _not_a_ problem for what I'm doing. I'm still thinking about garbage collection, how much could I script without it? The book I'm reading chooses to have all variables either static or on the stack with no allocation or references, therefore eliminating the need - having obvious limitations.
<br/>
<br/>
And thanks again for that link Ant6n!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#145973 - sajiimori - Mon Nov 26, 2007 11:32 pm</h4>
    <div class="postbody"><span class="postbody">You can do a lot with just statics and locals.  In fact, you can do <span style="font-style: italic">everything</span> with just statics and locals, since dynamic allocation can be implemented in terms of statics!  (Think about how malloc and free must be implemented.)
<br/>
<br/>
You can support references to statics without risking dangling pointers, but references to locals are risky without garbage collection.
<br/>
<br/>
You can even support safe references to locals without garbage collection, although there are caveats.  One method is to use dynamic scoping rather than lexical scoping.
<br/>
<br/>
Dynamic scoping is where there's a master table of all variable names and their associated values.  Defining a local variable named X causes the old value of X to be backed up and the new value to overwrite it temporarily.  When the local variable goes out of scope, the old value is restored.
<br/>
<br/>
(An alternative implementation of the same idea is to put local variables on a stack as usual, but keep auxiliary information on the stack that will allow a runtime algorithm to search it for the innermost variable named X.)
<br/>
<br/>
In this scenario, you can represent a reference as a string containing the name of the referred variable, although this potentially causes bad interaction between separate bodies of code that each create references to unrelated variables named X.
<br/>
<br/>
Much of the problem is resolved if you use unique symbols instead of strings.  There are a finite number of local variable declarations in a program, and each one can be given a unique identifier (such as the in-memory address of the opcode declaring the variable, which is necessarily unique).  There's still a potential problem when there can be more than one instance of a particular lexical variable on the stack at once, e.g. for recursive functions.
<br/>
<br/>
Whether using strings or unique identifiers, you also have to deal with the possibility that dereferencing will fail because there might not be a matching variable in scope.  In these situations, you can either halt with an error, or return a special "null" value.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
