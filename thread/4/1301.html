<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Game is REALLY slow - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > Game is REALLY slow</h2>
<div id="posts">
<div class="post">
    <h4>#6516 - MumblyJoe - Wed May 28, 2003 6:38 am</h4>
    <div class="postbody"><span class="postbody">I have been working on a version of frogger and it runs so slow that it is sad.
<br/>
<br/>
I am using mode 4 and software-based sprites with double buffering and I have seen projects that are alot bigger than mine with the same modes run much faster.
<br/>
<br/>
I recently changed the way I was compiling it to:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">g++ -c -O3 -mthumb -mthumb-interwork Frogger.cpp
<br/>
g++ -mthumb -mthumb-interwork -o Frogger.elf Frogger.o
<br/>
<br/>
objcopy -O binary Frogger.elf Frogger.gba</td> </tr></table><span class="postbody">
<br/>
<br/>
and now it runs about twice as fast but is still very sad to watch.
<br/>
<br/>
Can anyone suggest if I am just compiling it wrong or if there is anything else I should do.
<br/>
<br/>
Note: I am using DevKitAdvance and am not using Jeff F's crt0.s (would that help?).<br/>_________________<br/><a class="postlink" href="http://www.hungrydeveloper.com" target="_blank">www.hungrydeveloper.com</a>
<br/>
Version 2.0 now up - guaranteed at least 100% more pleasing!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6518 - Quirky - Wed May 28, 2003 7:50 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I am using mode 4 and software-based sprites with double buffering</td> </tr></table><span class="postbody">
<br/>
<br/>
Eeek! Why? :)
<br/>
<br/>
Surely the simple tile-based screen of Frogger, coupled with the GBA's hardware sprites makes this an <span style="font-style: italic">unusual</span> approach. 
<br/>
<br/>
Unless it's all in 3D or you are planning on porting it as is to the GP32, by far the best option for speed would be to switch to using mode 0, 1 or 2 and use hardware sprites.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6519 - MumblyJoe - Wed May 28, 2003 8:32 am</h4>
    <div class="postbody"><span class="postbody">I basically made the choice because of the simplicity of writing it, considering I have written games with the similar "everything is in a loop with no interrupts and treats the screen as a bitmap" style.
<br/>
<br/>
Regardless, its too late now, I have virtually finished the game and would like to see it run faster.<br/>_________________<br/><a class="postlink" href="http://www.hungrydeveloper.com" target="_blank">www.hungrydeveloper.com</a>
<br/>
Version 2.0 now up - guaranteed at least 100% more pleasing!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6522 - Sweex - Wed May 28, 2003 9:36 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">"everything is in a loop with no interrupts and treats the screen as a bitmap"</td> </tr></table><span class="postbody">
<br/>
<br/>
Well, that is basically the problem! The GBA isn't really suitable for this approach. It will work, and it is possible to get some speed out of it, but hitting 60fps (or even 30) is not really easy!
<br/>
<br/>
One thing I can think of is doing memcpy's (which you're probably using) with DMA. And you can still use hardware sprites in mode 4!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6533 - niltsair - Wed May 28, 2003 2:55 pm</h4>
    <div class="postbody"><span class="postbody">I only tried to do a transparency effect in mode 3 between 2 bitmaps (one slowly appearing on top of the other) and boy is it slow :) I would get a frame per 1 second. I think i could get it to work to a decent speed by writing it in assembler, something i've yet to try.
<br/>
<br/>
So, i don't know about compiler's options optimisation to speed up your code, but writing your inner loop for drawing in Assembly would greatly help. And also to transfer data with DMA as previously mentionned,</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6535 - Jason Wilkins - Wed May 28, 2003 3:19 pm</h4>
    <div class="postbody"><span class="postbody">Using Jeff's crt0.s and lnkscript will not help at all.  cr0.S and lnkscript affect the initialzation and layout of the rom and have no effect on speed in the slightest (except that Jeff's crt0.S might cut a millisecond or two off of your startup time, get out your stopwatch ^_^).<br/>_________________<br/><a href="http://devkitadv.sourceforge.net" target="_blank">http://devkitadv.sourceforge.net</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6545 - Maddox - Wed May 28, 2003 6:42 pm</h4>
    <div class="postbody"><span class="postbody">Make sure you're not using floating point numbers.  They are just too slow.<br/>_________________<br/>You probably suck.  I hope you're is not a game programmer.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6547 - hzx - Wed May 28, 2003 7:06 pm</h4>
    <div class="postbody"><span class="postbody">Hi. I am quite new in GBA development, but I have already learnt that good performance can be taken by optimizing your code, which doesn't mean you have to code in asm. First of all, set your emulator properly. It took me a week to figure out, that a problem I met was not in my code but in the emulator - it used frame skip 1/3.  
<br/>
<br/>
Use DMA to clear screen or copy sprites. Try to optimize your routines. Don't use x*160+x/2 to calculate the pixel position in mode4 - use ((y&lt;&lt;7) - (y&lt;&lt;3)) + (x&gt;&gt;1) instead. For this mode I wrote 2 routines - a slow but accurate one, with the necessary memory read, and one, with 2 color parameters if the background color is known, etc.<br/>_________________<br/>.hzx</span><span class="gensmall"><br/><br/>Last edited by hzx on Thu May 29, 2003 8:18 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#6549 - jenswa - Wed May 28, 2003 7:29 pm</h4>
    <div class="postbody"><span class="postbody">One little remark, don't trust you emulator,
<br/>
the more the better approach of reality, but even better
<br/>
is to try the rom on the real hardware (gba).
<br/>
I had some stuff running fine on the emu, visualboyadvance,
<br/>
I slowed some things down to get it to the right speed on the emu,
<br/>
than I tried it on hardware and it was slow,
<br/>
so it's not a good approach for comparing speed.
<br/>
<br/>
Also, mode 4 is a little slow, but some hardware sprites over a
<br/>
nice bitmapped background is just nice.
<br/>
If you still want to use mode 4, I would do that.<br/>_________________<br/>It seems this wasn't lost after all.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6552 - Jason Wilkins - Wed May 28, 2003 8:28 pm</h4>
    <div class="postbody"><span class="postbody">Maddox has shown me the light!  Next time I'm late, I will blame floating point!<br/>_________________<br/><a href="http://devkitadv.sourceforge.net" target="_blank">http://devkitadv.sourceforge.net</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6570 - MojoJojo - Thu May 29, 2003 11:35 am</h4>
    <div class="postbody"><span class="postbody">You are using dirty rectangles aren't you? That is, only redrawing the parts of the screen which you've plotted your sprites too? Not clearing the screen every frame and redrawing it all?
<br/>
<br/>
That's the only thing which I can think of which would make a much of a difference to performance, without changing over to using hardware sprites. Which is what you probably should do.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6578 - Maddox - Thu May 29, 2003 6:18 pm</h4>
    <div class="postbody"><span class="postbody">Hallelujah!<br/>_________________<br/>You probably suck.  I hope you're is not a game programmer.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
