<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Animations - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > Animations</h2>
<div id="posts">
<div class="post">
    <h4>#171955 - zodiacdagreat - Mon Jan 04, 2010 10:22 am</h4>
    <div class="postbody"><span class="postbody">I've been coding a titlescreen in asm and wanted to add in some animations. Does anyone know proper ways to do animations? According to Tonc, swi 0x5 is better than WaitForVBlank. So, I did something like this:
<br/>
<br/>
.WaitVBlank:
<br/>
	push {r2-r3, lr}
<br/>
	mov r3, #0x10 @ Amount of calls
<br/>
	mov r2, #0x0
<br/>
.Loop:
<br/>
	swi 0x5
<br/>
	add r2, r2, #0x1
<br/>
	cmp r2, r3
<br/>
	ble .Loop
<br/>
	pop {r2-r3, pc}
<br/>
<br/>
Is that way, correct or preferable? I also found that another method works better:
<br/>
<br/>
	swi 0x5
<br/>
	swi 0x5
<br/>
	swi 0x5
<br/>
        ...
<br/>
<br/>
But according to my friends it's ugly and not good. Anywho, really need some help and guidance here :D</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171968 - Ruben - Tue Jan 05, 2010 8:16 am</h4>
    <div class="postbody"><span class="postbody">Well, calling "swi 5" 3x is a bit untidy but it will be faster and will still get the job done. The other way with the loop would be something similar to this...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">    push {r4}
<br/>
    ldr  r4, =iterations @ if &lt; 0x100 it will compile into a mov
<br/>
1:  swi  5
<br/>
    sub  r4, #1
<br/>
    bne  1b
<br/>
    pop  {r4}
<br/>
    bx   lr</td> </tr></table><span class="postbody">
<br/>
<br/>
Note that I pushed and used r4 rather than r0-r3; r0-r3 are usually destroyed by BIOS calls. Also note that I used 'bx lr' to return rather than 'pop {pc}' as this may return you in the wrong mode (ARM/THUMB).
<br/>
<br/>
(edited thrice for formatting and a small errors)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171969 - zodiacdagreat - Tue Jan 05, 2010 9:12 am</h4>
    <div class="postbody"><span class="postbody">Uh, yes. bx lr returns to the previous call, especially if I'm using a branch link. You know the 'swi 0x5' 3x part wasn't actually 3 :P I meant to say that its repeated until I get the animation in the right speed.
<br/>
<br/>
So, I take it that what I'm doing is correct? :P
<br/>
<br/>
Edit: BTW, I just noticed this now XD My keypress loop that checks for keys becomes a lot slower... I take it as it is because of the wait for vblank, I wonder if it's possible to speed up only my keypress loop :D Here's my code for anyone interested:
<br/>
@ Getting keypress
<br/>
.KeypressLoop:
<br/>
	mov r0, #0xA
<br/>
	bl .WaitVBlank
<br/>
	bl .StartAnimation
<br/>
<br/>
	mov r0, #0x3
<br/>
	bl .WaitVBlank
<br/>
	bl .HoOhAnimation
<br/>
<br/>
	ldr r0, .REG_KEYINPUT
<br/>
	ldrh r2, [r0]
<br/>
	mov r1, #0x1 @ A button
<br/>
	and r2, r2, r1
<br/>
	cmp r2, #0x0
<br/>
	beq .Exit
<br/>
	ldrh r2, [r0]
<br/>
	mov r1, #0x8 @ Start button
<br/>
	and r2, r2, r1
<br/>
	cmp r2, #0x0
<br/>
	beq .Exit
<br/>
	b .KeypressLoop</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171970 - Ruben - Tue Jan 05, 2010 10:11 am</h4>
    <div class="postbody"><span class="postbody">Well, this is how I would do it...
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">.VBlankWait:
<br/>
    push {r4}    @ push register on stack
<br/>
    mov   r4, r0 @ save count
<br/>
1:  swi   5      @ wait for VBlank
<br/>
    sub   r4, #1 @ if(--waitLeft)
<br/>
    bhi   1b     @   continue
<br/>
    pop  {r4}    @ pop register
<br/>
    bx    lr     @ return
<br/>
<br/>
.MainLoop:
<br/>
    mov  r0, #10           @ |
<br/>
    bl  .VBlankWait        @  wait 10 V-Blanks
<br/>
    bl  .StartAnim         @ start animation[s]
<br/>
    
<br/>
    mov  r0, #3            @ |
<br/>
    bl  .VBlankWait        @  wait 3 V-Blanks
<br/>
    bl  .HoOhAnimation     @ ???
<br/>
    
<br/>
    ldr  r0, =REG_KEYINPUT @ |
<br/>
    ldrh r1, [r0]          @  read keys
<br/>
    mov  r2, #0x09         @ |
<br/>
    tst  r1, r2            @  if(!(keys() &amp; KEY_A+KEY_START))
<br/>
    bne .MainLoop          @    continue
<br/>
    beq .Exit              @  else return</td> </tr></table><span class="postbody">
<br/>
<br/>
(edited for VBlankWait function; edited again for mistake)
<br/>
<br/>
EDIT:
<br/>
Oh and yes, your key checking will only be done every 10+3 frames, in other words, every 13/60 frames as opposed to once every 1/60 frames. A way around this would be to use the key reading in an interrupt, save a variable somewhere in RAM and read this all the time.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171971 - elwing - Tue Jan 05, 2010 11:04 am</h4>
    <div class="postbody"><span class="postbody">you could also have your mainloop run every VBlank, and perform your animation every 13 frame while performing your key check at everyframe:
<br/>
without taking care of details (like avoiding the % or managing the framecounter overflow...) that would look like
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
while(1){
<br/>
  wait for VBLANK (swi 5)
<br/>
  framecounter++
<br/>
  if((framecounter % 13)==0){
<br/>
    perform your animation
<br/>
  }
<br/>
  perform your key reading
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
