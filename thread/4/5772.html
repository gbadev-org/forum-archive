<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Memory map - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > Memory map</h2>
<div id="posts">
<div class="post">
    <h4>#43201 - enliteneer - Fri May 20, 2005 6:57 am</h4>
    <div class="postbody"><span class="postbody">Just ran across a very nice overview of programming the GBA
<br/>
( <a href="http://members.iinet.net.au/~freeaxs/gbacomp/" target="_blank">http://members.iinet.net.au/~freeaxs/gbacomp/</a> ) that Im sure everyone here is familiar with.
<br/>
<br/>
However, Ive got a question regarding the memory map.  Is it true that the linker will always put variables into external ram unless you specifically direct it to put it in internal ram?  What about at runtime if you use malloc, where will that memory come from?
<br/>
<br/>
My program needs to save a unknown amount of data coming in from the serial, any suggestions on how best to allocate memory for this???</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#43209 - Cearn - Fri May 20, 2005 11:14 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>enliteneer wrote:</b></span></td> </tr> <tr> <td class="quote">Is it true that the linker will always put variables into external ram unless you specifically direct it to put it in internal ram?</td> </tr></table><span class="postbody">
<br/>
It's the other way around: global variables go into IWRAM, unless explicitly told otherwise.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>enliteneer wrote:</b></span></td> </tr> <tr> <td class="quote">What about at runtime if you use malloc, where will that memory come from?</td> </tr></table><span class="postbody">
<br/>
*tests* Apparently, devkitARM's malloc uses EWRAM.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>enliteneer wrote:</b></span></td> </tr> <tr> <td class="quote">My program needs to save a unknown amount of data coming in from the serial, any suggestions on how best to allocate memory for this???</td> </tr></table><span class="postbody">
<br/>
Just how unknown is the amount of data? If there is a definite (and reasonable) upper limit, you might as well use a static array.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#43227 - tepples - Fri May 20, 2005 5:04 pm</h4>
    <div class="postbody"><span class="postbody">Interrupt service routines should not see dynamically allocated memory because of the danger of race conditions: if they're called while malloc() or free() is running, disaster may ensue. To handle data coming from the serial port, you should statically allocate enough RAM for about 50ms (3 frames) of ring buffer, and have the main game loop copy from there to a larger buffer.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#43304 - enliteneer - Sat May 21, 2005 8:27 pm</h4>
    <div class="postbody"><span class="postbody">The serial traffic will range from a few bytes (commands, etc) to as much as a few MBs (data).   Fortunately, it doesnt need to buffer all of the data, as it will be processing it as it comes in.  
<br/>
<br/>
By the way, anyone tried the MBV2 cable?  
<br/>
<br/>
Originally, I just soldered 3 wires to the di/do/gnd of the link connector to a ttl/rs232 converter, but having wires stick out of the gba looks ugly.  The MBV2 cable comes with the connector, but doesnt seem to be designed to work as just a general purpose uart.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
