<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Do people use polling or interrupts to handle keypad input? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > Do people use polling or interrupts to handle keypad input?</h2>
<div id="posts">
<div class="post">
    <h4>#23797 - benjamin - Wed Jul 21, 2004 10:05 pm</h4>
    <div class="postbody"><span class="postbody">I've seen a lot of examples that use polling (each frame I guess?) to check the bits in the input register in order to determine if input has been triggered by a user pressing any of the 10 buttons.
<br/>
<br/>
However, isn't it also possible to use interrupts to handle input (lower latency and more immediate response?).
<br/>
<br/>
Which is more desirable? I imagine that interrupts would be quicker to respond but use up many cycles to switch between user and interupt cpu modes..
<br/>
<br/>
When do you use on or the other, or do you always use just one of these two techniques?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23799 - Touchstone - Wed Jul 21, 2004 10:14 pm</h4>
    <div class="postbody"><span class="postbody">I think (but I'm not sure, it's been years since i did any gba programming) that you have to register a key that will respond to the interrupt request. For example, you register that when the user press A+B your interrupt is called.
<br/>
<br/>
I'm almost sure it's not like in Java or Windows for instance where you get a callback each time a key is pressed.
<br/>
<br/>
If a game would need more frequence sampling of the keys than per frame I guess they could do it more often, like twice or four times per frame, but I'm not sure how often the hardware is actually updating it's keystate register. Besides, the game probably doesn't do any actual game update more often then per frame so sampling more often would only help catch really fast presses, i.e. quicker than 1/60'th of a second.<br/>_________________<br/>You can't beat our meat</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23800 - poslundc - Wed Jul 21, 2004 10:59 pm</h4>
    <div class="postbody"><span class="postbody">Most games only use the keyboard interrupt for detecting the reset-game key combination (A+B+Start+Select) and waking up from sleep mode.
<br/>
<br/>
An interrupt-driven input model is rather unpractical for most GBA games. Check the state of the keys once per frame and determine a course of action based on the keys every frame - that's the finite state machine way.
<br/>
<br/>
Interrupts don't happen particularly fast, either; you could wind up stealing a lot of processor time from the GBA.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23808 - tepples - Thu Jul 22, 2004 12:08 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Touchstone wrote:</b></span></td> </tr> <tr> <td class="quote">I'm almost sure it's not like in Java or Windows for instance where you get a callback each time a key is pressed.</td> </tr></table><span class="postbody">
<br/>
You can set the joypad interrupt register into OR mode, where you get an interrupt every time any one of the chosen keys goes down. However, you do have to pay attention to debouncing the keys.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I'm not sure how often the hardware is actually updating it's keystate register.</td> </tr></table><span class="postbody">
<br/>
It seems to poll after just about every CPU cycle.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">sampling more often would only help catch really fast presses, i.e. quicker than 1/60'th of a second.</td> </tr></table><span class="postbody">
<br/>
Canonical examples being a music game or a fighting game (Z-motion dragon punch anyone?).<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23873 - sgeos - Fri Jul 23, 2004 9:44 am</h4>
    <div class="postbody"><span class="postbody">One could set up an interrupt driven input list/queue that contains key press/release info and timing information.  This is probably only useful for a fighting game, otherwise polling once a frame is probably more than enough.
<br/>
<br/>
I poll once every frame (if I care about input) and update press/release variables.  The press variable contains the number of frames the key has been down.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23881 - benjamin - Fri Jul 23, 2004 2:08 pm</h4>
    <div class="postbody"><span class="postbody">It seems like for complexity's sake, interrupts don't make any sense.
<br/>
<br/>
However, if you were to count cycles, wouldn't interrupts be more conservative, since you're only using them when the input is actually made, vs. polling every frame?
<br/>
<br/>
Is there a concensus that commercial games mostly use polling?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23884 - torne - Fri Jul 23, 2004 2:26 pm</h4>
    <div class="postbody"><span class="postbody">Every commercial game I've disassembled uses polling (and that's quite a few). Polling once per frame takes a pittance of CPU cycles and is never, ever going to be a performance problem; you don't even have to do it during the vblank, if you are short on vblank cycles. Doing something so simple 60 times per second is hardly a bother at all on any processor made in the last fifteen years. =)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23885 - poslundc - Fri Jul 23, 2004 2:43 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>benjamin wrote:</b></span></td> </tr> <tr> <td class="quote">However, if you were to count cycles, wouldn't interrupts be more conservative, since you're only using them when the input is actually made, vs. polling every frame?</td> </tr></table><span class="postbody">
<br/>
<br/>
In the realm of the theoretical?
<br/>
<br/>
You could theoretically monopolize the CPU by reentering the interrupt handler so long as the necessary keypress is being held down. Think about when you hold down the reset combination on most games: the game freezes up while it's being held, because the interrupt is resetting the game, then as soon as the interrupt exits it detects the keypress and loads back up again. No time for the CPU to do anything else.
<br/>
<br/>
Which means you need to be crafty with interrupts to get them working for generic input in the first place. But this is like using a hammer to pound in a screw when compared to just polling the keystate.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23892 - benjamin - Fri Jul 23, 2004 4:54 pm</h4>
    <div class="postbody"><span class="postbody">Are you saying that holding down a key would fire continuous interrupts if you were handling key input with intterupts and not polling?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23894 - poslundc - Fri Jul 23, 2004 6:04 pm</h4>
    <div class="postbody"><span class="postbody">It depends on whether the interrupt fires only on the key-down or if it continues to trigger while the key is being held, I suppose. I don't know which it is.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23896 - Miked0801 - Fri Jul 23, 2004 6:32 pm</h4>
    <div class="postbody"><span class="postbody">I'm pretty sure keypad int is edge down driver.  Personally, I just poll - much cleaner.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
