<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>optimization... - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Coding > optimization...</h2>
<div id="posts">
<div class="post">
    <h4>#16 - lordmetroid - Wed Jan 01, 2003 1:28 am</h4>
    <div class="postbody"><span class="postbody">I have this array for use as a char cashe of what's in the VRAM... And make heavy use of it in my dynamic tile uploading engine...
<br/>
<br/>
so I wonder I have just recently read a whole book about optimization but didn't find any real help, but I have a feeling there is no optimization for this!
<br/>
<br/>
I wonder is there any sort of optimization for a:
<br/>
<br/>
for(search throught the whole array) routine?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#31 - AnthC - Wed Jan 01, 2003 11:56 am</h4>
    <div class="postbody"><span class="postbody">Hi
<br/>
Yes there's many things you can do for this kind of search.
<br/>
I would suggest reading up on hashing algorithms, and that should get you started.
<br/>
Anth</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#33 - dovoto2 - Wed Jan 01, 2003 1:29 pm</h4>
    <div class="postbody"><span class="postbody">I believe the fastest approach to this is to use a reverse LUT.  You will need a table big enough to have an entry for every actual tile in your tile set.   Then any time you write that tile to the screen you store its location in video memory in the reverse lut.  You also keep a counter that tracks how many of each tile are currently on-screen.  This can be memory intensive but you can usualy spare the 2-10K of eram that it will eat .  Basicaly to use it you would place the new tile into video memory incemement that tiles counter and add the video memory tile location to the reverse LUT.  Before actualy writting the tile check the LUT.  If there is an entry you just write that entry to your map, increment your counter, and you are done.  This does require you to track when tiles go out of scope and decrement the tile counters when they are off-screen so you can free the tile memory.  It also requires the use of some sort of memory management preferably a stack to control vram character usage.
<br/>
I do this in c++ and use all four layers with unlimited tile set...full sprite animation and full music support from krawal libs and I have no problems with speed.   A tile set with 3000 unique tiles uses about 8k of ewram memory for the reverse LUT and the counters.  Drop in the bucket.
<br/>
I will even be covering this technique in a tutorial soon.  
<br/>
Thanks goes to boofly ( <a href="http://www.2headed.com" target="_blank">www.2headed.com</a> ) for this algorithem.
<br/>
Hope this was in some way usefull or even relavant :)
<br/>
-dovoto</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39 - I.C.E - Wed Jan 01, 2003 7:41 pm</h4>
    <div class="postbody"><span class="postbody">I also think that the fastest approach is the one explained by dovoto2. I know this technique from the Gameboy Advanced Resource Management document by Rafael Baptista. I have rewritten his code a lilttle bit :)
<br/>
The only disatvantage is the huge amount ram it is used (at least in my case were i need a lot of tiles). But it can easily be minimzed with costs of CPU usage.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#43 - Nessie - Wed Jan 01, 2003 9:47 pm</h4>
    <div class="postbody"><span class="postbody">I'm not quite sure why you need to search the array...is it to find unused slots for when you want to add a new tile to your array?  If so, why can't you just have a linked list structure?  
<br/>
<br/>
You'd need a "free" list and an "active" list....All you do is put each array element into the free list on program initialization.  Any time you need a free array element, just grab one off the list ( if there is one )...then append that to the active list.  Whenever an active array element is no longer used, push it back onto the free list.
<br/>
<br/>
Of course, I might be completely misunderstanding what you even asking. :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49 - lordmetroid - Wed Jan 01, 2003 11:15 pm</h4>
    <div class="postbody"><span class="postbody">yes indeed I'm searching for unused slots...
<br/>
But wouldn't handleing the linked list take alot of power... more so then handling an array of [1024][3], (the second dimension is for properties of the tile)
<br/>
<br/>
and if I use a linked list and remove a object so the whole list get's smaller I would need to reupdate my whole vram instead of just the part I have changed...
<br/>
<br/>
if anyone are intrested in my not finished dynamic tile engine you can find it on our page...
<br/>
<br/>
and one more thing I have been wondering about... what if I make:
<br/>
u8 *pcx point to REG_BG0HOFS, and the REG_BG0HOFS has a value of 255 and I make pcx++; will REG_BG0HOFS be set to 0 or 256?<br/>_________________<br/>*Spam*
<br/>
Open Solutions for an open mind, <a href="http://www.areta.org" target="_blank">www.areta.org</a>
<br/>
<br/>
Areta is an organization of coders codeing mostly open source project, but there is alot of sections like GBA dev, Language learning communities, RPG communities, etc...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#56 - Splam - Thu Jan 02, 2003 1:21 am</h4>
    <div class="postbody"><span class="postbody">0 because you've defined it as a pointer to a u8 so it'll access the ram as bytes and when u do ++  it'll wrap round to 0.  You really don't want to access it as a u8 because it's not, there are 9 bits accessible not just 8 so it should be a u16 instead.  I'm presuming you've made your define for BG0HOFS  like *(u16 *)0x4000010  else the code you've given would actually incremement the pointer pcx to 0x4000011 and not the memory it points to  (I know you probably already know this but I thought I'd mention in in case you haven't done it like that and get weird errors)..</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#60 - adavie - Thu Jan 02, 2003 1:29 am</h4>
    <div class="postbody"><span class="postbody">Full source code to a dynamic tile-based scrolling engine is freely available at <a href="http://www.2headed.com/bg.zip" target="_blank">www.2headed.com/bg.zip</a> - sample binary using this code, showing a scrolling map using 17,500 characters is viewable at <a href="http://www.2headed.com/earth3.bin" target="_blank">www.2headed.com/earth3.bin</a>
<br/>
Enjoy.
<br/>
Cheers
<br/>
A</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#61 - Costis - Thu Jan 02, 2003 1:45 am</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
You can't assign the address of those variables to point to the BG0 scrolling registers and then use "++" to increase them because they are read-only registers. Using "++" reads the previous value located in that register, increases it by 1, and then writes it back into the register. Instead you should use a method like this:
<br/>
<br/>
void AGBMain (void)
<br/>
{
<br/>
    unsigned short scrollx, scrolly;
<br/>
    ....
<br/>
    BG0XOFS = scrollx = xscroll_init_value;
<br/>
    BG0YOFS = scrolly = yscroll_init_value;
<br/>
    ...
<br/>
    BG0XOFS = ++scrollx; \\ Use this method for updating the scroll
<br/>
    BG0YOFS = ++scrolly; \\ registers without reading them.
<br/>
    ...
<br/>
}
<br/>
<br/>
In this method, variables in RAM (that can be read and written) are used to hold the current horizontal and vertical scroll positions. Because of this, the actual GBA scroll registers just have to be written to instead of read as well. Also, if you want it to overflow to 0 at 8 bits then you would have to change the variable types from "unsigned short" to "unsigned char".
<br/>
<br/>
Costis</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63 - Splam - Thu Jan 02, 2003 2:01 am</h4>
    <div class="postbody"><span class="postbody">hehe  forgot about that register being write only, too busy explaining about u8 being wrong (and the fact that I don't think I've ever directly ++ed a hardware register on any machine I've ever coded for, always have variables and update those) :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#85 - Eloist - Thu Jan 02, 2003 3:20 pm</h4>
    <div class="postbody"><span class="postbody">A linked list is very handy for this. Just let every unused entry of your array point to the next unused entry. This takes some time to set up during initilaization, but you're only going to do that once anyway. Then you need to keep track of the first unused index (0 at first). And whenever you allocate an entry you just let that first unused be you entry and replace the first unused index with the index stored in the entry you just allocated. Upon freeing an entry, you just link it back in by letting it point to the previous first unused and replace the first unused index with the free'd index.
<br/>
Almost no cpu overhead.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#103 - tubooboo - Thu Jan 02, 2003 8:52 pm</h4>
    <div class="postbody"><span class="postbody">a very good, albeit very general coverage of dealing with memory management issues effectively is found at <a href="http://www.memorymanagement.org" target="_blank">http://www.memorymanagement.org</a>
<br/>
<br/>
It helped me write the BG and OBJ allocation systems in HAM
<br/>
<br/>
Emanuel<br/>_________________<br/>HAM author
<br/>
<a href="http://www.ngine.de" target="_blank">http://www.ngine.de</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#36854 - Bojangles - Wed Mar 02, 2005 3:03 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>adavie wrote:</b></span></td> </tr> <tr> <td class="quote">Full source code to a dynamic tile-based scrolling engine is freely available at <a href="http://www.2headed.com/bg.zip" target="_blank">www.2headed.com/bg.zip</a> - sample binary using this code, showing a scrolling map using 17,500 characters is viewable at <a href="http://www.2headed.com/earth3.bin" target="_blank">www.2headed.com/earth3.bin</a>
<br/>
Enjoy.
<br/>
Cheers
<br/>
A</td> </tr></table><span class="postbody">
<br/>
<br/>
Hi there, I realize I'm almost 2 years behind now ;-)  But the link to the Earth3.bin Demo is broken, anyone have it still?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#36863 - Miked0801 - Wed Mar 02, 2005 5:22 pm</h4>
    <div class="postbody"><span class="postbody">We use a stack to hold all the possible free tiles - push them all to start in order, pop them as you need to add/remove chars.  For our search of tiles in use, we use a hash table with a very simple hash function.  I'm sure there are other ways, but this runs plenty fast for us as normal C code in ROM.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#36905 - lordmetroid - Thu Mar 03, 2005 7:28 am</h4>
    <div class="postbody"><span class="postbody">whoa, spoky I get an e-mail noticing me that there has been a reply in a topic I have been watching... This is really old, too old to even remeber I posted it!
<br/>
<br/>
I thought this was some new stuff I posted rescently but it didn't make sense I have no such problems which I describe and people replies to. Then I noticed the dates. Talk about digging up dead topics!<br/>_________________<br/>*Spam*
<br/>
Open Solutions for an open mind, <a href="http://www.areta.org" target="_blank">www.areta.org</a>
<br/>
<br/>
Areta is an organization of coders codeing mostly open source project, but there is alot of sections like GBA dev, Language learning communities, RPG communities, etc...</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
