<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>problem - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > problem</h2>
<div id="posts">
<div class="post">
    <h4>#29994 - ThUg4LiFe - Sat Nov 27, 2004 10:17 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include &lt;stdio.h&gt;
<br/>
#include &lt;stdlib.h&gt;
<br/>
<br/>
void main()
<br/>
{
<br/>
  char* pPermanentMem = (char)malloc(5);
<br/>
<br/>
  *(pPermanentMem+0) = 0xF0;
<br/>
  *(pPermanentMem+1) = 0x00;
<br/>
  *(pPermanentMem+2) = 0x04;
<br/>
  *(pPermanentMem+3) = 0xFF;
<br/>
  *(pPermanentMem+4) = 0x01;
<br/>
<br/>
  printf("\npPermanentMem = %X%X%X%X%X", *(pPermanentMem+0), *(pPermanentMem+1), *(pPermanentMem+2),
<br/>
                                       *(pPermanentMem+3), *(pPermanentMem+4));
<br/>
  printf("\nIt Should Be F00004FF01");
<br/>
<br/>
return;
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
it there a reason that this code (it originally didnt have the printf() statements) crashed the command prompt window? maybe its something obvious and im not seeing it</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#29995 - jma - Sat Nov 27, 2004 10:24 am</h4>
    <div class="postbody"><span class="postbody">This:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">char* pPermanentMem = (char)malloc(5); </td> </tr></table><span class="postbody">
<br/>
Should be:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">char* pPermanentMem = (char*)malloc(5); </td> </tr></table><span class="postbody">
<br/>
Jeff<br/>_________________<br/><a href="mailto:massung@gmail.com">massung@gmail.com</a>
<br/>
<a href="http://www.retrobyte.org" target="_blank">http://www.retrobyte.org</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#29996 - ThUg4LiFe - Sat Nov 27, 2004 10:41 am</h4>
    <div class="postbody"><span class="postbody">ah.. that is one change i made...
<br/>
<br/>
i think it wouldnt compile until i cast the memory to "pointer to char" instead of "char".. but once i changed it and it compiled, and i executed the file - it crashed <span style="font-weight: bold">cmd</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#30025 - sajiimori - Sat Nov 27, 2004 7:36 pm</h4>
    <div class="postbody"><span class="postbody">With that change it should run fine.  However, the output won't be what you expect for 2 reasons.
<br/>
<br/>
The chars are going to become ints when they get passed in to printf due to the way variable-length argument lists work.  After they become ints, chars with a 1 in the high bit (0xFF and 0xF0) will be bit-extended (to 0xFFFFFFFF and 0xFFFFFFF0 respectively).  Declare the buffer as unsigned char* to keep the sign bit from being extended (so you'll get 0x000000FF and 0x000000F0).
<br/>
<br/>
Also, leading zeros will be dropped on values like 0x00, 0x04, and 0x01.  To make printf pad output with leading zeros, use "%0nX", where "n" is how many digits you want to be printed (so you'd want "%02X" instead of just "%X").</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#30084 - ThUg4LiFe - Sun Nov 28, 2004 3:56 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">With that change it should run fine.  However, the output won't be what you expect for 2 reasons.
<br/>
<br/>
The chars are going to become ints when they get passed in to printf due to the way variable-length argument lists work.  After they become ints, chars with a 1 in the high bit (0xFF and 0xF0) will be bit-extended (to 0xFFFFFFFF and 0xFFFFFFF0 respectively).  Declare the buffer as unsigned char* to keep the sign bit from being extended (so you'll get 0x000000FF and 0x000000F0).
<br/>
<br/>
Also, leading zeros will be dropped on values like 0x00, 0x04, and 0x01.  To make printf pad output with leading zeros, use "%0nX", where "n" is how many digits you want to be printed (so you'd want "%02X" instead of just "%X").</td> </tr></table><span class="postbody">
<br/>
<br/>
thanx for the help
<br/>
<br/>
in my code without that; the fact that they would appear with 8 hexadecimal digits with printf() wouldnt actually be the VALUES stored in memory would they? because a char is only 1 bit (2 hex digits), its just the way printf displays it, right?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#30090 - sajiimori - Sun Nov 28, 2004 4:41 am</h4>
    <div class="postbody"><span class="postbody">If you convert a char to an int, the char will have its sign bit extended to fill the new high bits.  That way a negative value will stay negative.  Sign bit extension is the main difference between signed and unsigned types.
<br/>
<br/>
When you call printf, the compiler will upgrade your chars to ints because variable length argument lists require word-sized values.  It's just a quirk of that particular feature.
<br/>
<br/>
So, the actual values that get pushed onto the stack as arguments are 32 bits in size (assuming 32 bit ints), but your original chars remain <span style="font-weight: bold">8 bits</span>.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#30114 - ThUg4LiFe - Sun Nov 28, 2004 1:14 pm</h4>
    <div class="postbody"><span class="postbody">nice one
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">If you convert a char to an int, the char will have its sign bit extended to fill the new high bits.  That way a negative value will stay negative.  Sign bit extension is the main difference between signed and unsigned types.</td> </tr></table><span class="postbody">
<br/>
<br/>
yeah i read reading about that when i was going over bitwise operations in the book im learning from, but i never understood it until your earlier post</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#30165 - ThUg4LiFe - Mon Nov 29, 2004 2:50 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
printf("\nenter a score to start with:\n");
<br/>
scanf("%ld", &amp;Practice1);
<br/>
printf("\nenter number of points to add to it:\n");
<br/>
scanf("%ld", &amp;Practice2);
<br/>
<br/>
*(pPointsAndScore+1) = Practice1;
<br/>
*(pPointsAndScore+0) = Practice2;
<br/>
<br/>
FAKELOOP:
<br/>
///when a player's points are being added to the visual score each game loop///
<br/>
   if ((*(pPointsAndScore+1) + (*(pPointsAndScore+0))) &gt; 999999999)
<br/>
     *(pPointsAndScore+0) = 999999999 - (*(pPointsAndScore+1));
<br/>
<br/>
   if ((*(pPointsAndScore+0) != 0) &amp;&amp; (*(pPointsAndScore+1) != 999999999))
<br/>
     {
<br/>
        for (*pCounters = 8 ; *pCounters &gt; 0 ; *pCounters--)
<br/>
           {
<br/>
             if (*(pPointsAndScore+0) / pow(10, *pCounters) == 0)
<br/>
                continue;
<br/>
             else
<br/>
             {
<br/>
                *(pPointsAndScore+1) += pow(10, *pCounters);
<br/>
                *(pPointsAndScore+0) -= pow(10, *pCounters);
<br/>
                printf("%9d :TOTAL SCORE\r", *(pPointsAndScore+1));
<br/>
             }
<br/>
             break;
<br/>
           }
<br/>
        if (*pCounters &lt; 1)
<br/>
        {
<br/>
          (*(pPointsAndScore+1))++;
<br/>
          (*(pPointsAndScore+0))--;
<br/>
          printf("%9d :TOTAL SCORE\r", *(pPointsAndScore+1));
<br/>
        }
<br/>
     }
<br/>
<br/>
now = clock();
<br/>
for ( ; clock() - now &lt; 100 ; );
<br/>
<br/>
if (*(pPointsAndScore+0) != 0)
<br/>
   goto FAKELOOP;
<br/>
<br/>
return;</td> </tr></table><span class="postbody">
<br/>
<br/>
sorry to have another problem but, im not sure why this isnt giving the result i expect. its just making a continous loop - and the output is not what i wanted at all, at first it was only incrementing the output by 1 each time, and now its just producing crazy results. i know its my fault and ive made a mistake somwhere - it was closer to what i wanted when it incremented 1 at a time - but now it just keeps incrememnting and then going to negative numbers, and not formatted witht the field width i want, and isnt actually using the first number entered as a starting point either now - its simply overwriting what it starts with, with junk numbers</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#30172 - sajiimori - Mon Nov 29, 2004 4:05 am</h4>
    <div class="postbody"><span class="postbody">Sorry, that code is too crazy to read.
<br/>
<br/>
Most importantly, write functions that do one thing, not many things.  Split up your code until you have no more than 2 tabs in a row.  Turn complicated expressions into well-named functions.
<br/>
<br/>
Don't use magic numbers.
<br/>
<br/>
Use a[i] instead of *(a+i).  That operator is provided to make your code easier to read, so you may as well use it.
<br/>
<br/>
Pick a standard indentation style and stick to it.  Line up your braces directly under the keyword (if, for, while, etc).
<br/>
<br/>
Don't use goto unless you have a really really good reason.  Yours could be replaced with do-while.
<br/>
<br/>
pCounters doesn't need to be a pointer.  Pointers are useful tools, but unnecessary use just puts more stress on the reader.  Among other things, it forces the reader to think about how the pointer might move and who else might be sharing the same memory.
<br/>
<br/>
Combining 2 variables with different purposes into an array is pure obfuscation.
<br/>
<br/>
Post whole functions or programs with all the relevant declarations, not just floating function bodies.
<br/>
<br/>
Edit: here, let me get you started.</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int readIntWithPrompt(char* prompt)
<br/>
{
<br/>
  int i;
<br/>
  printf("%s: ", prompt);
<br/>
  scanf("%ld", &amp;i);
<br/>
  return i;
<br/>
}
<br/>
<br/>
int readStartScore()
<br/>
{
<br/>
  return readIntWithPrompt("enter a score to start with");
<br/>
}
<br/>
<br/>
int readScoreIncrement()
<br/>
{
<br/>
  return readIntWithPrompt("enter number of points to add to it");
<br/>
}
<br/>
<br/>
void whatDoesThisThingDoAnyway()
<br/>
{
<br/>
  int score = readStartScore();
<br/>
  int increment = readScoreIncrement();
<br/>
<br/>
  do
<br/>
  {
<br/>
    /* simple body with no more nested braces */
<br/>
  } while(increment &gt; 0);
<br/>
}</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#30197 - ThUg4LiFe - Mon Nov 29, 2004 11:29 am</h4>
    <div class="postbody"><span class="postbody">thanx for all that. it seems im struggling at the minute to get my programming and style right :-[
<br/>
<br/>
the idea was............. i wanted to test a code id written, so i added an ability to scan in two integers (one would be placed where the score from the game would be stored in memory, the second would be stored where points to be added to the score is going to be stored) and use this before the loop starts
<br/>
<br/>
then through each loop it will increment the "score" by the highest power of 10, up to a maximum of 8 (which equates to 100,000,000) but is not higher than the number of points to be added; and it would deduct the same figure from the number of points to be added
<br/>
<br/>
i also wanted to make it wait inbetween each loop for a short time, so i could see if it was working
<br/>
<br/>
<br/>
<br/>
initially, it just incremented the score by 1, until the number of points to be added = 0. which was close to what i wanted but it needed to start with the higher powers of 10 (up to 8 - depending on how high the numbers of points are to be added was)
<br/>
<br/>
<br/>
also, once it found that there was less than 10 points to be added, in other words, ( points to be added / 10 to the power of 1 = 0 (as an integer) ) then it would know to use increments of 1s and use a different piece of code to finish off the rest of the points and get it down to 0 to exit the loop, (because if it used 10 to the power of 0, it would incrementing by 0 (unless my maths is wrong there!))</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#30217 - tepples - Mon Nov 29, 2004 4:47 pm</h4>
    <div class="postbody"><span class="postbody">pow() is floating-point, and floating-point is slow on GBA and on some PC models. If you want to convert an integer to a base 10 string, I'd suggest calling sprintf.
<br/>
<br/>
EDIT: clarify somewhere else FP is slow<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"><br/><br/>Last edited by tepples on Mon Nov 29, 2004 8:12 pm; edited 2 times in total</span></div>    
</div>
<div class="post">
    <h4>#30241 - sajiimori - Mon Nov 29, 2004 7:44 pm</h4>
    <div class="postbody"><span class="postbody">His code isn't meant for GBA, hence the use of scanf.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#30262 - ThUg4LiFe - Mon Nov 29, 2004 10:44 pm</h4>
    <div class="postbody"><span class="postbody">yes my code is for PC - at the moment
<br/>
<br/>
i havent really read much of the GBA specific tutorial yet, so im just practicing with standard C</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#30481 - ThUg4LiFe - Wed Dec 01, 2004 4:56 pm</h4>
    <div class="postbody"><span class="postbody">ive found the best thing to do is plan the entire program out as a flow diagram with only ever specific routes that it can take. its making it a lot easier to remember everything i wanted it to do and everything i already devised would be doing - because its easier to understand and write than unfinished code! and if i can plan the entire thing out like this it should then just be a straightforward conversion from the flow chart system to coding</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#30513 - sajiimori - Wed Dec 01, 2004 7:39 pm</h4>
    <div class="postbody"><span class="postbody">Yeah, diagrams are often easier to understand than finished code, let alone unfinished code.
<br/>
<br/>
With flowchars in particular though, be aware that they will tend to lead you to very procedural solutions, where you solve a problem by making a series of accumulated side-effects.  These sorts of programs are easy to write, so most of my early code looks like that, but over the years I've come to greatly appreciate code that can be decomposed into parts that don't depend on the previous step.  Such code is very easy to reason about, because you don't have to think about the current "state" to understand a piece of the program.
<br/>
<br/>
The most useful kind of diagram I've ever drawn is a dependancy graph, where each module is a node and arrows show what depends on what.  It keeps my mind on the big picture, and tends to lead me toward very modular solutions with minimal interdependancies.  If my graph is hard to draw due to lines crossing each other all over the place, I'm probably doing something wrong -- and not just with layout. ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#30767 - ThUg4LiFe - Sat Dec 04, 2004 1:42 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">pow() is floating-point, and floating-point is slow on GBA and on some PC models. If you want to convert an integer to a base 10 string, I'd suggest calling sprintf.
<br/>
<br/>
EDIT: clarify somewhere else FP is slow</td> </tr></table><span class="postbody">
<br/>
<br/>
to bring this back up, how can i get around the problem with floating-point? i mean i need to use a function to calculate the result of something to the power of something else, how can i do it without using the floating-point pow()? its all integers anyway, i dont think my game would need to use decimal points at all
<br/>
<br/>
basically what i want to do is this:
<br/>
<br/>
if speed is 0, then the delay before increase is 0
<br/>
if speed is 1, then the delay before increase is 1
<br/>
if speed is 2, then the delay before increase is 1
<br/>
if speed is 3, 4, 5, 6 or 7, then the delay before increase is "2 to the power of (speed - 2)"
<br/>
<br/>
simple enough, and things like this would be quicker if i can use a function, than specifying the exact calculation for each possibility - speed will actually be able to go up to 15 later in the game, and this would mean writing a calculation for each example.
<br/>
<br/>
i had the same problem where the earlier code was attempting to find "the highest power of 10, that is less than Points". id have to write a seperate expression for each power of 10
<br/>
<br/>
<br/>
--------
<br/>
<br/>
secondly, im wondering about division because it also says to avoid this in the FAQ, so what is the best way around this when you <span style="font-style: italic">need</span> to divide something?
<br/>
<br/>
i can think of ways around it - but they seem so long-winded....that id imagine them being slower than division</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#30772 - identitycrisisuk - Sat Dec 04, 2004 3:29 pm</h4>
    <div class="postbody"><span class="postbody">If you're dealing with powers of 2 then you can left and right shift things. "2 to the power of (speed - 2)" is the same as 1&lt;&lt;(speed-2);
<br/>
<br/>
Off the top of my head, the simplest general purpose function for getting one number to the power of another would be based around a for loop, where the loop goes around to the power of itself times and each loop you multiply your number by itself.
<br/>
<br/>
Don't know that much about division really, I have a grand total of one in my code so far that I think is called once per frame. I'm guessing that when it's infrequent like that it doesn't cause much of a problem, it's more if you are doing it many times a frame, in a loop say.<br/>_________________<br/></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">CanIKickIt(YES_YOU_CAN);</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#30774 - ThUg4LiFe - Sat Dec 04, 2004 4:22 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>identitycrisisuk wrote:</b></span></td> </tr> <tr> <td class="quote">If you're dealing with powers of 2 then you can left and right shift things. "2 to the power of (speed - 2)" is the same as 1&lt;&lt;(speed-2);
<br/>
<br/>
Off the top of my head, the simplest general purpose function for getting one number to the power of another would be based around a for loop, where the loop goes around to the power of itself times and each loop you multiply your number by itself.
<br/>
<br/>
Don't know that much about division really, I have a grand total of one in my code so far that I think is called once per frame. I'm guessing that when it's infrequent like that it doesn't cause much of a problem, it's more if you are doing it many times a frame, in a loop say.</td> </tr></table><span class="postbody">
<br/>
<br/>
that loop sounds like a good and simple solution (for doing a power operation)
<br/>
<br/>
and i was thinking that maybe there would be an easy way to deal with powers of 2, seeing as each bit is like increasing the power of 2. thanks for the help
<br/>
<br/>
division may not be a problem then if you can use it a small amount, i did have it used somewhere - but removed it because the expression i wrote was incorrect and it wasnt needed at all. however, i know i will need to use division for at least one thing each game loop</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#30793 - sajiimori - Sat Dec 04, 2004 7:25 pm</h4>
    <div class="postbody"><span class="postbody">There are many threads here about fixed-point math and fast divison.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
