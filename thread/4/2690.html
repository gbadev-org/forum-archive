<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Efficiency - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > Efficiency</h2>
<div id="posts">
<div class="post">
    <h4>#15116 - punchy - Sat Jan 17, 2004 3:59 pm</h4>
    <div class="postbody"><span class="postbody">Hi, 
<br/>
     i'm trying to squeeze some more speed out of the GBA and could do with a few pointers. I've already got all the most important code running from IWRAM so i'm looking at using a few lookup tables to replace some calculations i'm doing. I'll be putting these in either EWRAM or ROM so i want to know which will be faster. 
<br/>
<br/>
How do i know if accessing value from a LUT in memory will be faster than using a few shifts and adds in code? I'm a bit flakey on the number of cycles instructions and memory accesses take, and also how to change the waitstates of memory on the GBA.
<br/>
<br/>
Any help would be most appreciated.
<br/>
<br/>
Thanks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15123 - jma - Sat Jan 17, 2004 5:05 pm</h4>
    <div class="postbody"><span class="postbody">If the calculation really only takes a couple shifts and an add, then doing the math will be much faster than loading a lookup table value (provided there are no branches in the calculation). 
<br/>
<br/>
This is because pipelining, etc. will allow the math to occur at (about) 1 cycle per instruction. This is much better provided your expression is about 5 instructions or less.
<br/>
<br/>
On the other hand, using the lookup table you do have to deal with waitstates and the added timing of just loading the value.
<br/>
<br/>
Jeff<br/>_________________<br/><a href="mailto:massung@gmail.com">massung@gmail.com</a>
<br/>
<a href="http://www.retrobyte.org" target="_blank">http://www.retrobyte.org</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15126 - poslundc - Sat Jan 17, 2004 5:28 pm</h4>
    <div class="postbody"><span class="postbody">LUTs should be used for complicated mathematical operations: divison, trigonometric functions, square root, etc. None of these are accoplishable with a few shifts and adds!
<br/>
<br/>
Have you done any profiling on your code to find out where the bottlenecks are? There have been several recent threads on this subject that you can find easily by searching the forum. Most game applications spend 95% of the time in 5% of the code; if you can figure out what that 5% is then you know where to optimize.
<br/>
<br/>
Also, make sure that anything you put into IWRAM is being compiled as ARM code (or better still, written in ARM assembly). This is the most efficient way to use code that's in IWRAM.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15129 - ampz - Sat Jan 17, 2004 5:50 pm</h4>
    <div class="postbody"><span class="postbody">...And make sure the code you put in ROM or EWRAM is THUMB.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15130 - punchy - Sat Jan 17, 2004 5:58 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for the info. 
<br/>
<br/>
I have thumb running from ROM/EWRAM and ARM from IWRAM. How do i change the waitstate of the memory accesses from different areas?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15132 - torne - Sat Jan 17, 2004 6:10 pm</h4>
    <div class="postbody"><span class="postbody">You can *change* the wait states by writing to the system control registers; however not all speeds work on all carts. If you just want to know how long a read will take from a specific area of memory, there is a table at the beginning of the gbatek document.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15296 - iq - Tue Jan 20, 2004 4:34 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">LUTs should be used for complicated mathematical operations: divison, trigonometric functions, square root, etc. None of these are accoplishable with a few shifts and adds!
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Umm...trig and divisions can be done with shifts and adds....look up Cordic...and how do you think hardware does a division anyways?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15298 - tepples - Tue Jan 20, 2004 4:42 pm</h4>
    <div class="postbody"><span class="postbody">I think poslundc was trying to imply that trig functions implemented with linear interpolation on LUTs will run faster than trig functions implemented with CORDIC.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15301 - poslundc - Tue Jan 20, 2004 5:33 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">I think poslundc was trying to imply that trig functions implemented with linear interpolation on LUTs will run faster than trig functions implemented with CORDIC.</td> </tr></table><span class="postbody">
<br/>
<br/>
Yes, he was. :)
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15318 - punchy - Tue Jan 20, 2004 8:32 pm</h4>
    <div class="postbody"><span class="postbody">Thanks to all.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
