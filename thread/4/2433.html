<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Bus errors - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Coding > Bus errors</h2>
<div id="posts">
<div class="post">
    <h4>#13074 - poslundc - Thu Dec 04, 2003 8:32 pm</h4>
    <div class="postbody"><span class="postbody">What exactly causes these?
<br/>
<br/>
I am attempting to link a project that includes a rather large (about 200K) .o file that contains no functions, just data declared as "const" (so it should be put into the ROM section). Everything compiles fine, but when I include the .o file ld chokes and hands me a "bus error".
<br/>
<br/>
I've encountered bus errors before and managed to resolve them without too much difficulty (usually something to do with my symbol referencing), but this one is stumping me.
<br/>
<br/>
Any ideas?
<br/>
<br/>
Thanks,
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#13077 - tepples - Thu Dec 04, 2003 8:59 pm</h4>
    <div class="postbody"><span class="postbody">"Bus error"? Either there's a bug in ld, or you have bad RAM. Please include the entire error message that ld emits.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#13078 - poslundc - Thu Dec 04, 2003 9:17 pm</h4>
    <div class="postbody"><span class="postbody">It's not exactly informative, but here it is:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
make: *** [build/main.elf] Bus error
<br/>
make: *** Deleting file `build/main.elf'
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#13079 - poslundc - Thu Dec 04, 2003 9:33 pm</h4>
    <div class="postbody"><span class="postbody">GRAARRGH I just figured it out.
<br/>
<br/>
I had a small reference table that I stupidly just declared inside a header file instead of putting it into a separate .c file and just putting an extern reference to it in the header file.
<br/>
<br/>
My data file was referencing some structs from that header file, which meant multiple C files were including the same header file... bam, multiple definitions of the same symbol.
<br/>
<br/>
Meanwhile I was combing furiously through this 1 MB C file that defines my 200K of object data, looking for what could be causing the error. Turns out it was simply the #include statement at the top.
<br/>
<br/>
Let this serve as a warning to all newbies: resist the urge to put your const data into .h files! Find a safer way!
<br/>
<br/>
And if you get a bus error while linking, be sure to check to make sure you aren't defining a symbol multiple times.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#13204 - SmileyDude - Mon Dec 08, 2003 3:15 am</h4>
    <div class="postbody"><span class="postbody">You got a Bus Error?  I take it that you aren't using an x86 PC then, right?  Typically, a Bus Error occurs when you try to access data that is misallgined (i.e, a 16-bit int that's not on a 16-bit boundary).  But, the x86 automatically handles misaligned data -- unlike just about every other processor.  When I worked with Sun boxes, it was very easy to get a bus error when dealing with data from PCs.  Since the PC didn't care about alignment, and the SPARC did, if you weren't careful, you'd get Bus Errors.
<br/>
<br/>
Anyway, like Tepples said, bus errors usually indicate errors in the program.  I don't know about the memory problems, but that also seems like a likely culprit (maybe that's the only way you can get a Bus Error on the x86?)  If you are on an x86, you would definetly want to check your memory.  If it is bad, get memory from Crucial -- they guarentee their memory.  And besides, it's not that much more than the cheap stuff.<br/>_________________<br/>dennis</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#13205 - tepples - Mon Dec 08, 2003 4:07 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>SmileyDude wrote:</b></span></td> </tr> <tr> <td class="quote">Typically, a Bus Error occurs when you try to access data that is misallgined (i.e, a 16-bit int that's not on a 16-bit boundary).</td> </tr></table><span class="postbody">
<br/>
That's one sort of bus error (<a class="postlink" href="http://wombat.doc.ic.ac.uk/foldoc/foldoc.cgi?bus+error" target="_blank">FOLDOC definition</a>). But processors used in Macintosh computers (68K and PowerPC) have always distinguished between "bus error" and "address error," and an invalid unaligned access is an "address error." A "bus error" is an access to an address where the chipset's memory controller hasn't mapped anything. But in protected mode operating systems, addresses that would normally cause "bus errors" get mapped as "segmentation violation" errors unless the "bus error" is in fact caused by bad RAM, and even then, some kernels such as Linux can detect bad areas of RAM and mark them as unavailable.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">But, the x86 automatically handles misaligned data -- unlike just about every other processor.</td> </tr></table><span class="postbody">
<br/>
Know why? All the efficient methods of handling unaligned data accesses in software are patented, which is why the <a class="postlink" href="http://www.opencores.org/projects/mips/" target="_blank">free implementation of the MIPS architecture</a> doesn't handle unaligned data accesses.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">When I worked with Sun boxes, it was very easy to get a bus error when dealing with data from PCs.  Since the PC didn't care about alignment, and the SPARC did, if you weren't careful, you'd get Bus Errors.</td> </tr></table><span class="postbody">
<br/>
Teaches the developer to always serialize and deserialize data byte-by-byte, which is a good practice in general.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#13264 - sgeos - Wed Dec 10, 2003 4:08 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">Let this serve as a warning to all newbies: resist the urge to put your const data into .h files! Find a safer way!</td> </tr></table><span class="postbody">
<br/>
<br/>
Code does not belong in header files.
<br/>
<br/>
blah.h
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#ifndef BLAH_H
<br/>
#define BLAH_H
<br/>
<br/>
extern const unsigned long obj_blah[];
<br/>
extern const unsigned short pal_blah[];
<br/>
<br/>
#endif  /* BLAH_H */</td> </tr></table><span class="postbody">
<br/>
<br/>
blah.c
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include "blah.h"
<br/>
<br/>
const unsigned long obj_blah[] = {
<br/>
   0x00111100,
<br/>
   0x01222210,
<br/>
   0x12122121,
<br/>
   0x12222231,
<br/>
   0x12122131,
<br/>
   0x12211231,
<br/>
   0x01233310,
<br/>
   0x00111100,
<br/>
};
<br/>
<br/>
const unsigned short pal_blah[] = {
<br/>
   0x0000, 0x0000, 0x03FF, 0x0210,
<br/>
   0x0000, 0x0000, 0x03FF, 0x0210,
<br/>
   0x0000, 0x0000, 0x03FF, 0x0210,
<br/>
   0x0000, 0x0000, 0x03FF, 0x0210,
<br/>
};
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
The above is not tested.  If the program were compiled with something like this:
<br/>
gcc -Wall -o blah main.c blah.c
<br/>
<br/>
main.h would probably want to #include "blah.h"
<br/>
<br/>
Actually, now that I look at it, blah.c may not want to #include "blah.h".  Will the extern declaration in the header hurt anything?
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#13266 - sajiimori - Wed Dec 10, 2003 6:41 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Will the extern declaration in the header hurt anything?
<br/>
</td> </tr></table><span class="postbody">
<br/>
No, the compiler will consider them the same object, much like having a function prototype before its definition.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#13320 - poslundc - Thu Dec 11, 2003 4:07 am</h4>
    <div class="postbody"><span class="postbody">Just spent about an hour tracking down another bus error... I'll post the details here to hopefully spare someone else the annoyance:
<br/>
<br/>
Bus errors can also be caused by questionable initializations of variables. The particular example that was causing my error was just a quick hash table I created in a function:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">unsigned char   channelHash[8] = {0, 4, 5, 1, 2, 6, 7, 3};</td> </tr></table><span class="postbody">
<br/>
<br/>
This compiled fine with gcc, but generated a bus error on linking. I think it has something to do with trying to address single bytes of IWRAM. I also tried casting each of the elements as unsigned chars and it still didn't work. But when I converted it to an array of unsigned ints instead of unsigned chars, it worked fine.
<br/>
<br/>
Hope this helps someone else out.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
