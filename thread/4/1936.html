<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>mutlifile multiboot image - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > mutlifile multiboot image</h2>
<div id="posts">
<div class="post">
    <h4>#9962 - johnny_north - Sat Aug 23, 2003 4:12 pm</h4>
    <div class="postbody"><span class="postbody">I'm trying to build a multiboot image for the first time. I want to transfer this image from one gba to a second gba that is not using a cart. I've sucessfully managed to compile Jeff F's mbclient demo on dever's and I'd like to do the same with my own multiboot image.
<br/>
<br/>
I've included the following define in my gba.h file:
<br/>
#define MULTIBOOT volatile const int __gba_multiboot = 1; 
<br/>
<br/>
I'm using Jeff's Crt0 file. I've left the following line uncommented:
<br/>
 .equ __MultiBootInclude, 1
<br/>
<br/>
Here are my questions:
<br/>
<br/>
1) Jeff's instructions say to use MULTIBOOT at the top of the main file. This is a mutli file project though containing several .cpp and .h files. Do I need to use MULTIBOOT more that one time? Do I need to use it like this:
<br/>
MULTIBOOT = what ever or just MULTIBOOT.
<br/>
<br/>
2) If creating a multiboot image is sucessful, should all of the code reside in the EWRAM portion when I look at the map file? ie all in the 0x02000000 area? After trying to compile this as a multiboot, the map file still shows code in the 0x08000000 area.
<br/>
<br/>
When I compile using one instace on MULTIBOOT in my main.cpp file, then that the image and transfer it, the stransfer seems to happen normally, but the second gba just displays a blank screen. The mb bin does execute by itself in VBA though, so I know there's nothing wrong with the code itself.
<br/>
<br/>
Can someone help me build this mb image correctly?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9964 - tepples - Sat Aug 23, 2003 5:23 pm</h4>
    <div class="postbody"><span class="postbody">If you want to "replicate" a loaded .mb binary to another GBA, use the standard multiboot procedure to send the currently running binary (starting at 0x02000000, and however long your binary is) to the other GB.
<br/>
<br/>
If you want a replication demo with source code, e-mail me.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9971 - johnny_north - Sat Aug 23, 2003 8:16 pm</h4>
    <div class="postbody"><span class="postbody">Yes, I think I would like to know how to replicate a mb image and send it to another GBA. I'll e-mail you.
<br/>
<br/>
My primary purpose though is to find the correct manner of creating a gba binary that could be transfered from one gba to another and then executed on the 2nd gba. The master gba program is much larger than the 256k limit, so the multiboot version is a stripped down version sent to allow 2 player functionality.
<br/>
<br/>
I'm planning to bin2o the mb version and then include it in the master via make.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10071 - djei-dot - Tue Aug 26, 2003 2:43 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>johnny_north wrote:</b></span></td> </tr> <tr> <td class="quote">1) Jeff's instructions say to use MULTIBOOT at the top of the main file. This is a mutli file project though containing several .cpp and .h files. Do I need to use MULTIBOOT more that one time? Do I need to use it like this:
<br/>
MULTIBOOT = what ever or just MULTIBOOT.</td> </tr></table><span class="postbody">
<br/>
<br/>
Use only MULTIBOOT; .
<br/>
The __gba_multiboot variable is supposed to be a <span style="font-weight: bold">global</span> variable. So just put your multiboot instruction where you put other global variables. I had some troubles with this in the past, the place where the multiboot instruction should be is not very well documented...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10091 - johnny_north - Tue Aug 26, 2003 7:34 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for the help guys. I solved the problem by doing the following:
<br/>
<br/>
Made sure that MULTIBOOT was at the top of the main.cpp file with only #include ?gba.h? appearing before it.
<br/>
<br/>
Made sure that main.o was the very first file to link after crt0.o, crtbegin.o and crtend.o.
<br/>
<br/>
Changed #define MULTIBOOT __gba_multiboot  = 1 to just #define MULTIBOOT __gba_multiboot.
<br/>
<br/>
One or more of these things did the trick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
