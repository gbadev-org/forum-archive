<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>makefile troubles - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Coding > makefile troubles</h2>
<div id="posts">
<div class="post">
    <h4>#23540 - Darmstadium - Wed Jul 14, 2004 9:33 pm</h4>
    <div class="postbody"><span class="postbody">I decided to start using gnu's make, but I'm having trouble getting it to work. First, my makefile:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
CFLAGS = -c -O2
<br/>
ASMFLAGS = -c
<br/>
THUMB = -mthumb
<br/>
ARM = -marm
<br/>
THUMBANDARM = -mthumb-interwork
<br/>
<br/>
THUMBLIST_C: 
<br/>
THUMBLIST_CPP: bg.cpp collision.cpp enemies.cpp gba.cpp level.cpp source.cpp sprite.cpp
<br/>
THUMBLIST_ASM: 
<br/>
ARMLIST_ASM: 
<br/>
BOTHLIST_ASM: 
<br/>
<br/>
all: demo.gba
<br/>
<br/>
demo.gba: demo.elf
<br/>
   objcopy -O binary demo.elf demo.gba
<br/>
<br/>
demo.elf: $(THUMBLIST_C) $(THUMBLIST_CPP) $(THUMBLIST_ASM) $(ARMLIST_ASM) $(BOTHLIST_ASM)
<br/>
   $(CC) -o demo.elf $(THUMBLIST_C) $(THUMBLIST_CPP) $(THUMBLIST_ASM) $(ARMLIST_ASM) $(BOTHLIST_ASM)
<br/>
<br/>
$(THUMBLIST_C): %.o: %.c
<br/>
   $(CC) $(CFLAGS) $(THUMB) $&lt;
<br/>
<br/>
$(THUMBLIST_CPP): %.o: %.cpp
<br/>
   path=c:\devkitadv\bin
<br/>
   g++ $(CFLAGS) $(THUMB) $&lt;
<br/>
<br/>
$(THUMBLIST_ASM): %.o: %.s
<br/>
   $(CC) $(ASMFLAGS) $(THUMB) $&lt;
<br/>
<br/>
$(ARMLIST_ASM): %.o: %.s
<br/>
   $(CC) $(ASMFLAGS) $(ARM) $&lt;
<br/>
<br/>
$(BOTHLIST_ASM): %.o: %.s
<br/>
   $(CC) $(ASMFLAGS) $(THUMBANDARM) $&lt;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
when i try to run the script, make says "make: Nothing to be done for `THUMBLIST_C'." Why does it just stop?
<br/>
<br/>
thanks a lot</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23544 - poslundc - Wed Jul 14, 2004 11:06 pm</h4>
    <div class="postbody"><span class="postbody">Makefiles process the first rule in the file. So "all" should be the first rule to appear.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23547 - col - Wed Jul 14, 2004 11:35 pm</h4>
    <div class="postbody"><span class="postbody">I'm no expert, but it looks like you are telling make to make the .cpp files? and they are already made, so there is nothing to be done. You need to give make a list of object files that you want it to create.
<br/>
<br/>
try changing your list to somthing like:
<br/>
<br/>
THUMBLIST_CPP = bg.o collision.o enemies.o gba.o level.o source.o sprite.o
<br/>
<br/>
then put in rules to tell make how to use .cpp and .c files to make the .o files in the list files 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
%.o: %.c
<br/>
   $(CC) $(CFLAGS) $(THUMB) $&lt; 
<br/>
<br/>
%.o: %.cpp
<br/>
   path=c:\devkitadv\bin
<br/>
        g++ $(CFLAGS) $(THUMB) $&lt; 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
if you want to specify arm or thumb, one way is to add an intermediate suffix to the filename. So for arm you use .arm.cpp, and for thumb .thumb.cpp (i have thumb as default, so only specify arm)
<br/>
<br/>
then you put in some more rules like:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
%.arm.o: %.arm.c
<br/>
   $(CC) $(CFLAGS) $(ARM) $&lt; 
<br/>
<br/>
%.arm.o: %.arm.cpp
<br/>
   path=c:\devkitadv\bin
<br/>
        g++ $(CFLAGS) $(ARM) $&lt; 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I posted my makefile a while back - you should have a look at it, it is pretty much automatic - you just edit the directory list and library list, and a few other bits and pieces when you start a project and it does the rest - no editing required to add a new file to your project.  just save the new file to one of the directories in the makefiles list.  Also, it processes dependencies of headers as well as source files so you only rarely need to re-compile the whole project.
<br/>
<br/>
<a href="http://forum.gbadev.org/viewtopic.php?t=2004&amp;start=12" target="_blank">http://forum.gbadev.org/viewtopic.php?t=2004&amp;start=12</a>
<br/>
<br/>
cheers
<br/>
<br/>
Col</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
