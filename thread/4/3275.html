<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Angles - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > Angles</h2>
<div id="posts">
<div class="post">
    <h4>#19579 - kinski - Thu Apr 22, 2004 9:48 am</h4>
    <div class="postbody"><span class="postbody">Hello everybody, here is my first post.
<br/>
I'd like to know the way to calculate in C the value of an angle between two sprite, as figured below:
<br/>
<a href="http://membres.lycos.fr/kinskinine/saloperie.gif">[Images not permitted - Click here to view it]</a>
<br/>
<br/>
Could someone help me? Thank you.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19585 - Cearn - Thu Apr 22, 2004 1:40 pm</h4>
    <div class="postbody"><span class="postbody">This is basic trigonometry. 
<br/>
<br/>
If we use
<br/>
(<span style="font-style: italic">dx</span>, <span style="font-style: italic">dy</span>) : the differences between the two objects in the x and y directions
<br/>
<span style="font-style: italic">dist</span> : the distance between them <span style="font-style: italic">dist</span>= sqrt(<span style="font-style: italic">dx</span>^2 + <span style="font-style: italic">dy</span>^2)
<br/>
theta : the angle you have in your picture
<br/>
<br/>
then
<br/>
<br/>
cos(theta)= dy/dist
<br/>
sin(theta) = dx/dist
<br/>
tan(theta) = sin(theta)/cos(theta) = dx/dy
<br/>
<br/>
These equations are a little different than the standard trig definitions because you chose the angle based on the y-axis instead of the x-axis. To get the actual angle, you need to use the inverses of these functions, arcsin, arccos and arctan. The C library &lt;math.h&gt; contains functions for these. You will have to be careful with minus signs, though, because the range of arccos, arcsin and arctan will only cover half a circle. You would have to check the signs of dx and dy for the full angle.
<br/>
<br/>
However, using these routines is bad idea on the GBA. As anyone here can tell you, the GBA doesn't have real floating point support so sqrt or any of the trigonometry functions are going to be dead slow. The same goes for division. You will want to put these in look-up tables instead. 
<br/>
<br/>
Are you sure need the full angle by the way? If you just need a direction you can use the definitions for sin(theta) and cos(theta) without any need for the actual angle, which would save a good deal of calculation time. 
<br/>
There are also fast ways of calculating the distance that you need for this, but I can't recall it at this time. I'm sure one of the others can help you with that.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19588 - kinski - Thu Apr 22, 2004 2:45 pm</h4>
    <div class="postbody"><span class="postbody">Thank you a lot, Cearn.
<br/>
In fact, I do not need the exact angle, just a direction... But I dont really understand this, since I have to use square root to calculate sin or cos:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
If you just need a direction you can use the definitions for sin(theta) and cos(theta) without any need for the actual angle, which would save a good deal of calculation time. 
<br/>
</td> </tr></table><span class="postbody">
<br/>
Could you explain?
<br/>
<br/>
Thanks again.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19590 - Cearn - Thu Apr 22, 2004 3:10 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Thank you a lot, Cearn. 
<br/>
In fact, I do not need the exact angle, just a direction... But I dont really understand this, since I have to use square root to calculate sin or cos: 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Yes and no. The direction itself is actually simply given by (dx, dy), so if is really is just that, you're already done. But what you probably want is to shoot something off in that direction, right? In that case, you have to normalize the vector first and then multiply by the speed. Something like
<br/>
<br/>
vx= speed*dx/distance
<br/>
vy= speed*dy/distance
<br/>
<br/>
Then, yes you would need the square root. In fact, you need to divide by the square root, so you have not one but two costly functions. 
<br/>
<br/>
The GBA has BIOS routines that can do division and square roots, which are preferable to the standard C routines. For something on BIOS calls, search on the forum or look at <a class="postlink" href="http://user.chem.tue.nl/jakvijn/tonc/swi.htm" target="_blank">http://user.chem.tue.nl/jakvijn/tonc/swi.htm</a> or, even better, 
<br/>
libgba in the sample code of <a class="postlink" href="http://www.devkit.tk" target="_blank">devkitARM</a>, which has a nice way of dealing with these matters.
<br/>
<br/>
I am almost positive there is fast way of getting an approximation of 1/sqrt(x), but I can remember anymore. Does anyone else know?
<br/>
<br/>
EDIT: this thing's been covered already in <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=2594" target="_blank">http://forum.gbadev.org/viewtopic.php?t=2594</a>. Seems that using arctan2 and a sin/cosine lut is the preferred solution.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19597 - Miked0801 - Thu Apr 22, 2004 5:37 pm</h4>
    <div class="postbody"><span class="postbody">How exactly do you need the direction represented - as a vector I assume?  If so, what are you attempting to do with that angle?  Depending on how you are going to use it, you can probably get away without a ArcTan/Sqrt and perhaps without the Div too. :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19671 - kinski - Fri Apr 23, 2004 8:34 am</h4>
    <div class="postbody"><span class="postbody">In the image above, at the intersection of the two lines is a kind of "shooting tower" (in french, we call it a DCA) that should rotate in the direction of the main sprite (and then shoot at it).
<br/>
Finally, I found a solution that is not based on angles but on the  8 main lines that have the tower as intersection. I just check if my main sprite is on one of these eight lines. It works fine.
<br/>
<br/>
<span style="font-weight: bold">Anyway, thanks a lot to the both of you for you help.</span>
<br/>
-&gt; Cearn : it's quite funny, I was printing the content of your site (TONC) the day before starting this post. Impressive work!</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
