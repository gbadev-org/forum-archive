<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Shouldn't this come out to be around 60 FPS? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Coding > Shouldn't this come out to be around 60 FPS?</h2>
<div id="posts">
<div class="post">
    <h4>#20790 - mr_schmoe - Mon May 17, 2004 10:35 pm</h4>
    <div class="postbody"><span class="postbody">I have an timer interupt that runs at 64 clock pulses. And the overflow calls a function that increments the timer variable.
<br/>
<br/>
so shouldn't I be getting somewhere around 60 FPS?
<br/>
<br/>
int main()
<br/>
{
<br/>
    int time1;
<br/>
    int time2;
<br/>
<br/>
    time1 = 65536 * timer + REG_TM0D
<br/>
    while (REG_VCOUNT &lt; 160);
<br/>
    time2 = 65536 * timer + REG_TM0D
<br/>
<br/>
    FPS = 262182 / (time2 - time1);
<br/>
<br/>
}
<br/>
<br/>
Here's the numbers I get:
<br/>
When I set up my timer rutine at 64 clock pulses then the REG_TM0D register gets incremented every 3.814 nanoseconds. 
<br/>
And when it gets to 65536, my timer variable incresses by one.
<br/>
Therefore, 65536 * timer + REG_TM0D ought to a count of how long sense the timer interupt was started.
<br/>
So the frequency of the count should be (1/3.184) MHz or 0.262191924, or 262191.924 Hz. 
<br/>
So FPS should be 262192 / (time2 - time1)
<br/>
<br/>
But what do I get for FPS? 0. In fact, time2 - time1 equals 1. I don't get it, and I've spent the last 2 hours trying to figure it out. Anyone with a inkling of an idea?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20794 - poslundc - Mon May 17, 2004 11:48 pm</h4>
    <div class="postbody"><span class="postbody">I haven't checked your math, but is this the actual game loop you are using? How are you checking the variable's values? Your program could be resetting while still in VBlank and fudging your numbers.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20815 - Cearn - Tue May 18, 2004 8:29 am</h4>
    <div class="postbody"><span class="postbody">As poslundc mentioned, it's difficult to believe this is really your full main function, as it'd exit after one frame. Don't you mean
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
int main() 
<br/>
{ 
<br/>
    int time1; 
<br/>
    int time2;
<br/>
    while(1)
<br/>
    {
<br/>
        time1 = 65536 * timer + REG_TM0D 
<br/>
        while (REG_VCOUNT &lt; 160); 
<br/>
        time2 = 65536 * timer + REG_TM0D 
<br/>
<br/>
        FPS = 262182 / (time2 - time1); 
<br/>
    }
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
And in that case, note what happens after VCount == 160. The two lines after it are executed, at which time you jump to the start of the loop. With this little to do it is likely that VCount is still 160, or maybe 161, so you blaze through what you thought was a vsync a couple of times before VCount=0 again, etc, etc.
<br/>
<br/>
Try something like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void vid_vsync()
<br/>
{
<br/>
    while(REG_VCOUNT &gt;= 160);   // wait till VDraw
<br/>
    while(REG_VCOUNT &lt; 160);    // wait till VBlank
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
Yes it's a bit wasteful, cyclewise but it works. If you can, try to use a VBlank interrupt, that always works as expected.
<br/>
<br/>
(Oh, and use code tags for code, it looks nicer that way)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20857 - mr_schmoe - Tue May 18, 2004 7:22 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">With this little to do it is likely that VCount is still 160, or maybe 161, so you blaze through what you thought was a vsync a couple of times before VCount=0 again, etc, etc. </td> </tr></table><span class="postbody">
<br/>
<br/>
That makes perfect sense. I'll try that. But the problem is I was just frustrated with the whole thing not working. I was just trying to get a FPS counter so I can work on optimizing my code for speed. I think what I'll try next is a vblank interupt, I'll have to learn more about it though.  Thanks for you help.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20887 - dagamer34 - Wed May 19, 2004 4:45 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>mr_schmoe wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
That makes perfect sense. I'll try that. But the problem is I was just frustrated with the whole thing not working. I was just trying to get a FPS counter so I can work on optimizing my code for speed. I think what I'll try next is a vblank interupt, I'll have to learn more about it though.  Thanks for you help.</td> </tr></table><span class="postbody">
<br/>
<br/>
Don't optimize your code unless you 100% need to. You probably won't use this profiling code for a long time anyway because chances are you aren't doing something time-critical (HBlank tricks, audio mixing, polygon drawing) Like someone's signature on this board(not sure who) says "Premature optimization is the root of all evil".<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20888 - tepples - Wed May 19, 2004 4:56 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Donald Knuth wrote:</b></span></td> </tr> <tr> <td class="quote"><a class="postlink" href="http://quote.wikipedia.org/wiki/Donald_Knuth" target="_blank">Premature optimization is the root of all evil.</a></td> </tr></table><span class="postbody">
<br/>
<br/>
Anyway, my favorite GBA-side profiler is Vcount. Either I read Vcount before and after my loop and subtract, or I change the backdrop color at various stages in a computation to gauge the relative amounts of time that something takes.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20889 - sajiimori - Wed May 19, 2004 4:57 am</h4>
    <div class="postbody"><span class="postbody">Hey, for all you know he 100% needs to.  You say "chances are" this or that, but I think the chances that you've seen his code are 0%. ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20891 - dagamer34 - Wed May 19, 2004 5:02 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">Hey, for all you know he 100% needs to.  You say "chances are" this or that, but I think the chances that you've seen his code are 0%. ;)</td> </tr></table><span class="postbody">
<br/>
<br/>
His profiler code is more than 0%, but it isn't 100%. So you're right in a way.
<br/>
<br/>
If you really want a good profiler, "borrow" ideas from HAM. Since the tools are actually defines, replace the calls by setting the registers yourself.<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20892 - sajiimori - Wed May 19, 2004 7:14 am</h4>
    <div class="postbody"><span class="postbody">I didn't say you've seen 0% of his code, so I'm 100% right. :D
<br/>
<br/>
<span style="font-style: italic">This post was created with 50% recycled bandwidth.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20920 - dagamer34 - Wed May 19, 2004 11:08 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<span style="font-style: italic">This post was created with 50% recycled bandwidth.</span></td> </tr></table><span class="postbody">
<br/>
:)<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#21008 - Lupin - Fri May 21, 2004 3:37 pm</h4>
    <div class="postbody"><span class="postbody">:)
<br/>
<br/>
*postcount++;*<br/>_________________<br/><a class="postlink" href="http://pokeme.shizzle.it/" target="_blank">Team Pokeme</a>
<br/>
<a class="postlink" href="http://lupin.shizzle.it/" target="_blank">My blog and PM ASM tutorials</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#21014 - Lord Graga - Fri May 21, 2004 4:04 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lupin wrote:</b></span></td> </tr> <tr> <td class="quote">:)
<br/>
<br/>
*postcount++;*</td> </tr></table><span class="postbody"> You bastard, stop spamming the board... now look kids, I started too! Lupin, it's all your fault that bad light will be shed on this forum! :P</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#21040 - dagamer34 - Sat May 22, 2004 2:45 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lord Graga wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lupin wrote:</b></span></td> </tr> <tr> <td class="quote">:)
<br/>
<br/>
*postcount++;*</td> </tr></table><span class="postbody"> You bastard, stop spamming the board... now look kids, I started too! Lupin, it's all your fault that bad light will be shed on this forum! :P</span></td> </tr></table><span class="postbody">
<br/>
<br/>
That's a bit over the top. He's helped people a bit too.
<br/>
<br/>
*postcount++;* :)<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#21046 - Lord Graga - Sat May 22, 2004 11:41 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>dagamer34 wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lord Graga wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lupin wrote:</b></span></td> </tr> <tr> <td class="quote">:)
<br/>
<br/>
*postcount++;*</td> </tr></table><span class="postbody"> You bastard, stop spamming the board... now look kids, I started too! Lupin, it's all your fault that bad light will be shed on this forum! :P</span></td> </tr></table><span class="postbody">
<br/>
<br/>
That's a bit over the top. He's helped people a bit too.
<br/>
<br/>
*postcount++;* :)</span></td> </tr></table><span class="postbody">no, neither did you!
<br/>
<br/>
<br/>
I am starting to have a bad feeling about this :P</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#21088 - Lupin - Sun May 23, 2004 8:16 pm</h4>
    <div class="postbody"><span class="postbody">Hey graga, dagamer started first!! I just tried to comment his 2 character-post :P<br/>_________________<br/><a class="postlink" href="http://pokeme.shizzle.it/" target="_blank">Team Pokeme</a>
<br/>
<a class="postlink" href="http://lupin.shizzle.it/" target="_blank">My blog and PM ASM tutorials</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#21101 - sgeos - Sun May 23, 2004 9:59 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">*postcount++;*</td> </tr></table><span class="postbody">
<br/>
<br/>
I can't get it compile.  What compiler are you using?
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
