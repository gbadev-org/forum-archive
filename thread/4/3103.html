<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Sprite velocity and Frame rate - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Coding > Sprite velocity and Frame rate</h2>
<div id="posts">
<div class="post">
    <h4>#18223 - gbawiz - Mon Mar 22, 2004 7:04 pm</h4>
    <div class="postbody"><span class="postbody">Hello all,
<br/>
My subject is one which is still causing me confusion, I have gained a bit more understanding of the subject of Sprite velocity and framerate.
<br/>
My first attempt at incorporating variable speeds into my sprites:
<br/>
<br/>
Normally my sprite positions are INT variables (i.e. int mysprite.x =value) but when I changed my INTs to FLOATs I noticed a huge slowdown in my app, close to no movment at all!
<br/>
 1.) Is this typical of using FLOATs or is there a problem with my app?
<br/>
<br/>
What I was planning was changing my sprite movement routines to look something like this:
<br/>
<br/>
mysprite.x += period * velocity * direction
<br/>
<br/>
Since the GBAs framerate is 60hz then 1/60 is the period since last frame update and the velocity can have any number between 0 and 60. because my sprite should only move a maximum of one pixel at a time.
<br/>
direction is either -1 , 0 , +1 which is LEFT, Still, RIGHT.
<br/>
<br/>
2.) is this a good method of moving sprites?
<br/>
<br/>
Many thanks
<br/>
GbaWIZ</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18227 - poslundc - Mon Mar 22, 2004 8:06 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>gbawiz wrote:</b></span></td> </tr> <tr> <td class="quote">Normally my sprite positions are INT variables (i.e. int mysprite.x =value) but when I changed my INTs to FLOATs I noticed a huge slowdown in my app, close to no movment at all!
<br/>
 1.) Is this typical of using FLOATs or is there a problem with my app?</td> </tr></table><span class="postbody">
<br/>
<br/>
From the <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=418" target="_blank">Beginner's FAQ</a>:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"><span style="font-weight: bold">Avoid floating point.</span> Don't use floating-point arithmetic unless you absolutely have to. The GBA has no dedicated floating-point hardware, and all floating-point operations have to be run in a slow software FPU emulator. Use fixed-point arithmetic instead.</td> </tr></table><span class="postbody">
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18228 - Gopher - Mon Mar 22, 2004 9:03 pm</h4>
    <div class="postbody"><span class="postbody">Fixed-point math seems a little tricky at first; it's actually pretty simple, though. Just divide your x and y positions by some fixed number before drawing them. I'd recomend picking a power of two, like 128 or 256.
<br/>
<br/>
//set pos to ScrPosX, ScrPosY (Screen position)
<br/>
XPos=ScrPosX*256;
<br/>
YPos=ScrPosY*256;
<br/>
<br/>
<br/>
//calc the screen position from the stored position
<br/>
ScrPosX=PosX/256;
<br/>
ScrPosY=PosY/256;
<br/>
<br/>
<br/>
//check bounds
<br/>
if (PosX&lt;0 || PosX&gt;=240*245)
<br/>
    ...
<br/>
if (PosY&lt;0 || PosY&gt;=160*256)
<br/>
    ...
<br/>
<br/>
[/url]<br/>_________________<br/>"Only two things are infinite: the universe, and human stupidity. The first is debatable." -Albert Einstein</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18229 - poslundc - Mon Mar 22, 2004 9:13 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Gopher wrote:</b></span></td> </tr> <tr> <td class="quote">Fixed-point math seems a little tricky at first; it's actually pretty simple, though. Just divide your x and y positions by some fixed number before drawing them. I'd recomend picking a power of two, like 128 or 256.</td> </tr></table><span class="postbody">
<br/>
<br/>
Fixed-point math becomes awfully impractical on a binary machine if you don't use a power of two for your multiplier.
<br/>
<br/>
You are better off using the bitshift operator instead of multiplication/division; this lets you directly keep track of your decimal point (VERY important when you start doing multiplication and division) and doesn't rely on the compiler to optimize your transformations into shifts.
<br/>
<br/>
<a class="postlink" href="http://www.google.com/search?q=fixed+point+math" target="_blank">Google on fixed-point math</a>
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18230 - Gopher - Mon Mar 22, 2004 9:20 pm</h4>
    <div class="postbody"><span class="postbody">I'm aware of that, but I try to explain things in the simplest terms nessicary. If someone asks for a lesson in basic C/C++, it's not always beneficial to give them a lecture on optimization. :)<br/>_________________<br/>"Only two things are infinite: the universe, and human stupidity. The first is debatable." -Albert Einstein</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18234 - poslundc - Mon Mar 22, 2004 10:03 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Gopher wrote:</b></span></td> </tr> <tr> <td class="quote">I'm aware of that, but I try to explain things in the simplest terms nessicary.</td> </tr></table><span class="postbody">
<br/>
<br/>
You find fixed-point math easier with multiplication/division instead of bitshifts?
<br/>
<br/>
I think it would drive me insane.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18235 - Gopher - Mon Mar 22, 2004 10:10 pm</h4>
    <div class="postbody"><span class="postbody">&lt;sigh&gt;
<br/>
<br/>
Explaining the bitshift method requires an understanding of binary numbers. I suppose you could just accept bitshifting as a magical black-box operator that divides/multiplies by powers of two, but even then it's introducing an element beyond the issue itself. I wasn't really explaining fixed-point math in general, just telling him how to apply it to his specific question.<br/>_________________<br/>"Only two things are infinite: the universe, and human stupidity. The first is debatable." -Albert Einstein</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18247 - gbawiz - Tue Mar 23, 2004 1:51 am</h4>
    <div class="postbody"><span class="postbody">Hello and thanks for the response,
<br/>
So to use fix point math then you convert the number into a higher one, do the necessary program logic then when finished you convert the number back again?
<br/>
<br/>
If so then do you need to translate all variables which are used in the process, i.e when moving a sprite on screen:
<br/>
<br/>
sprite_x += velocity*direction
<br/>
<br/>
would you have to convert all three parameters this way, perform the above multiplication then translate back?
<br/>
Also are these INTs ?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18248 - Gopher - Tue Mar 23, 2004 2:02 am</h4>
    <div class="postbody"><span class="postbody">Ok, with fixed-point math, say your numbers have 8 bits of precision.
<br/>
You have one integer Time and two fixed-point integers xpos and xvel.
<br/>
<br/>
xpos+=xvel*time
<br/>
<br/>
time is not a fixed-point number, so no extra conversion would be nessicary. (the usual &gt;&gt;8 applies to get screen coordinates from xpos)
<br/>
However, if you multiply two fixed-points
<br/>
<br/>
xpos*xvel // never mind why, just think about the numbers 
<br/>
<br/>
since each is implicitly multiplied by 256, the result is multiplied by 65536 (256*256) so you must divide by 256 ( &gt;&gt; 8). Careful here of overflows. If your numbers are too large and are overflowing, you can shift each right by 4 first
<br/>
<br/>
(xpos&gt;&gt;4)*(ypos&gt;&gt;4)
<br/>
<br/>
this will prevent overflow, but obviously loses 4 bits of precision from the inputs.<br/>_________________<br/>"Only two things are infinite: the universe, and human stupidity. The first is debatable." -Albert Einstein</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18381 - NoMis - Thu Mar 25, 2004 9:30 am</h4>
    <div class="postbody"><span class="postbody">why not use pixel per frame as ur movement unit. 
<br/>
i suggest saving a fixed point value of the position and giving a fixed point pixel per frame value for velocity in x and y direction. you just have to add the values every frame. so you dont need the multiplication wich is slower than the addition.
<br/>
<br/>
you then just put the integer part into the register by shifting the value.
<br/>
<br/>
if the integerpart gets bigger the sprite moves.
<br/>
<br/>
NoMis</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
