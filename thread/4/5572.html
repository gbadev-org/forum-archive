<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>2D Water Effect (Mario DS Style) - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Coding > 2D Water Effect (Mario DS Style)</h2>
<div id="posts">
<div class="post">
    <h4>#41526 - Celeryface - Fri Apr 29, 2005 2:32 pm</h4>
    <div class="postbody"><span class="postbody">Hi, 
<br/>
<br/>
I know this isn't directly related to GBA coding, but I wanted to get some of your opinions on the subject. I'm starting some research on the 2D water effect found on this site: <a href="http://freespace.virgin.net/hugo.elias/graphics/x_water.htm" target="_blank">http://freespace.virgin.net/hugo.elias/graphics/x_water.htm</a>
<br/>
<br/>
I also noticed a similar technique is found in the Special Effects Game Programming in DX book. Does anyone know where the algorithm originated, or if there are any other resources on it?
<br/>
<br/>
My main goal is to get this algorithm working, and then be able to apply it to a plane in a 3D world, similar to the effect in Mario 64/DS.
<br/>
<br/>
Thanks in advance. :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#41554 - rapso - Fri Apr 29, 2005 4:47 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Celeryface wrote:</b></span></td> </tr> <tr> <td class="quote">Hi, 
<br/>
<br/>
I know this isn't directly related to GBA coding, but I wanted to get some of your opinions on the subject. I'm starting some research on the 2D water effect found on this site: <a href="http://freespace.virgin.net/hugo.elias/graphics/x_water.htm" target="_blank">http://freespace.virgin.net/hugo.elias/graphics/x_water.htm</a>
<br/>
<br/>
I also noticed a similar technique is found in the Special Effects Game Programming in DX book. Does anyone know where the algorithm originated, or if there are any other resources on it?
<br/>
<br/>
My main goal is to get this algorithm working, and then be able to apply it to a plane in a 3D world, similar to the effect in Mario 64/DS.
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
    void ProcessWater(short *source, short *dest)
<br/>
    {
<br/>
        int i;
<br/>
<br/>
        for (i=320; i&lt;64000-320; i++)
<br/>
        {
<br/>
            dest[i] = (
<br/>
                    ((source[i-1]+
<br/>
                          source[i+1]+
<br/>
                          source[i-320]+
<br/>
                          source[i+320])  &gt;&gt;1) )-dest[i];
<br/>
<br/>
            dest[i] -= (dest[i] &gt;&gt; 5);
<br/>
        }
<br/>
    }</td> </tr></table><span class="postbody">
<br/>
that's the source for it (it's on the page), do you need more to get it working? it's quite simple!
<br/>
<br/>
I used it several times and there are lot of games using it (e.g. patrician2, baldurs gate dark alliance (ps2)). 
<br/>
but even with lot of optimisation it's slow 'cause you allways have to prepare a complett 2d array and on an image of 240*120 on the gba it won't run smooth anymore (I did not prove it)
<br/>
<br/>
greets
<br/>
rapso
<br/>
<br/>
<br/>
greets
<br/>
rapso</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#41563 - Celeryface - Fri Apr 29, 2005 6:29 pm</h4>
    <div class="postbody"><span class="postbody">To put the algorithm on a 3D object, would the y component of the vertices be the height values in the array? Or does games like Dark Alliance project a 2D flat plane to a 3D object as a texture?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#41589 - rapso - Sat Apr 30, 2005 12:20 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Celeryface wrote:</b></span></td> </tr> <tr> <td class="quote">To put the algorithm on a 3D object, would the y component of the vertices be the height values in the array? Or does games like Dark Alliance project a 2D flat plane to a 3D object as a texture?</td> </tr></table><span class="postbody">
<br/>
afaik it's right, just the y-component of the position-vectors are modified the change the geometry itself, but if you want to get some lighting and even env-mapping effects, you'd have to recalculate the normal of the vertices or calculate the gradient (as shown on the page, the gradient can be used to fake lighting and envmapping).
<br/>
<br/>
greets
<br/>
rapso</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#42060 - astu - Thu May 05, 2005 7:53 am</h4>
    <div class="postbody"><span class="postbody">nah
<br/>
you could do a loop from 0 to maxY and 0 to maxX 
<br/>
calculate distance to center and do some sin(dist+kakka) and pick pixel there.
<br/>
or use some grid with changing u/v values if you prefer hardware (you should)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
