<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Alpha Blending Issue - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > Alpha Blending Issue</h2>
<div id="posts">
<div class="post">
    <h4>#46362 - AkumaATR - Thu Jun 23, 2005 5:46 pm</h4>
    <div class="postbody"><span class="postbody">Hey guys. I am trying to alpha blend bg2 (common starfield) (target layer) with some sprites (source layer) in Mode 4. Sprites are set up to be transparent. Also, further below I set:
<br/>
<br/>
REG_BLDMOD = 0x450;
<br/>
//10001010000b
<br/>
<br/>
REG_COLEV = 0x808;
<br/>
//100000001000b for 1/2 target color, 1/2 source color
<br/>
<br/>
I end up being able to see the stars throught the sprites (some sort of alpha blending is taking place, just doesn't appear to be right), but the stars are black dots. When they reemerge on the other side they go back to being white.  The majority of the sprite doesn't get darker (as I want it to) as well -- I'm not sure if this is due to the same issue, or because first entry palette colors (black is behind the starfield and it's bg palette entry 0) are ignored in the alpha blend because first entry palette colors are deemded transparent by the hardware (I think this only applies to sprites... not sure yet... can anyone clarify?).
<br/>
<br/>
I am also wondering if alpha blending like that can even be accomplished in palettized modes -- my palettes are quite small -- I don't have palette colors defined for the resulting color that would come from an alpha blend -- is this an issue? I'm guessing it's not an issue since the result color is computed for each relative pixel for each frame... so it prob. doesn't need to have associated colors in the palette...
<br/>
<br/>
Thanks,
<br/>
Jason</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46371 - Quirky - Thu Jun 23, 2005 8:00 pm</h4>
    <div class="postbody"><span class="postbody">I had this problem - it's as if it "masks" rather than "blends" would be my description - and I seem to remember solving it by adding the "BD" background in there. I use transparent sprites over a couple of mode 1 backgrounds and have this as my function:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define MODE_TRANSPARENT        0x400
<br/>
<br/>
#define BLDMOD_FIRST_BG0  BIT00
<br/>
#define BLDMOD_FIRST_BG1  BIT01
<br/>
#define BLDMOD_FIRST_BG2  BIT02
<br/>
#define BLDMOD_FIRST_BG3  BIT03
<br/>
#define BLDMOD_FIRST_OBJ  BIT04
<br/>
#define BLDMOD_FIRST_BD   BIT05
<br/>
#define BLDMOD_MODE(n)    (n&lt;&lt;6)
<br/>
#define BLDMOD_SECOND_BG0 BIT08
<br/>
#define BLDMOD_SECOND_BG1 BIT09
<br/>
#define BLDMOD_SECOND_BG2 BIT10
<br/>
#define BLDMOD_SECOND_BG3 BIT11
<br/>
#define BLDMOD_SECOND_OBJ BIT12
<br/>
#define BLDMOD_SECOND_BD  BIT13
<br/>
<br/>
void fade_bg_sprites(int factor)
<br/>
{
<br/>
  // fade by "factor" the sprites to the bg
<br/>
  // bldmod contains the layers to blend with, blend mode 0 means only
<br/>
  // blend objects that have transparency set.
<br/>
  REG_BLDMOD = BLDMOD_SECOND_BG0 |
<br/>
               BLDMOD_SECOND_BG1 | BLDMOD_SECOND_BG2 | BLDMOD_SECOND_BD |
<br/>
               BLDMOD_MODE(0);
<br/>
  if (factor &gt; 16) {
<br/>
      REG_COLEV = 16;  // all sprites, no background
<br/>
  } else {
<br/>
    REG_COLEV = factor | ((16-factor)&lt;&lt;8); // fade from all sprite (16|0) to all bg (0|16)
<br/>
  }
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I know it has extra bgs, but the idea should help. I set sprites to be blendy individually by setting the MODE_TRANSPARENT flag on sprite attribute0.
<br/>
<br/>
Note:I'm not too sure about mode 4, the principal should be the same as for other modes though.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
