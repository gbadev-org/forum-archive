<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Music in GBA games - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Coding > Music in GBA games</h2>
<div id="posts">
<div class="post">
    <h4>#176701 - absence - Thu Sep 15, 2011 3:14 pm</h4>
    <div class="postbody"><span class="postbody">Does anyone know if Nintendo provided an official music player that developers used, or did each developer invent their own formats and players?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176702 - Dwedit - Thu Sep 15, 2011 5:23 pm</h4>
    <div class="postbody"><span class="postbody">Almost all developers used the sound engine that Nintendo provided.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176705 - Exophase - Thu Sep 15, 2011 8:57 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dwedit wrote:</b></span></td> </tr> <tr> <td class="quote">Almost all developers used the sound engine that Nintendo provided.</td> </tr></table><span class="postbody">
<br/>
<br/>
Interesting - do you have a source for this? Almost none of them used the audio functions available in the BIOS. But this could help explain why most GBA games had pretty lackluster audio coding..
<br/>
<br/>
One company that definitely rolled their own engines was Camelot; their audio engine employs extensive self modifying code in IWRAM (not that this doesn't apply to other parts of their game code too).. Golden Sun 2 actually generated audio at a rate of 64KHz, a good 3-4x higher than most GBA games.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176706 - Miked0801 - Thu Sep 15, 2011 10:20 pm</h4>
    <div class="postbody"><span class="postbody">Nintendo offered a MIDI player based on Musyx (which was a big hit on the GBC).  All in all, it was pretty bleh - high overhead for a MIDI player with nothing really great in terms of its performance.  We rolled our own MOD style player and went with that.  Allowed much more control and better quality than the Nintendo stuff.  Even in later (and later) handhelds, Nintendo still loves MIDI far too much.
<br/>
<br/>
As to the BIOS functions - those were written to conserve space, not to perform well.  In addition, the overhead to get to the BIOS was pretty nasty if calling a quick function.  There's a reason that div, mempy, and other stuff that lives in BIOS was almost universally redone by devs in code.  About the only thing the BIOS was good for was for hackers to get into things they weren't supposed to :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176708 - Dwedit - Thu Sep 15, 2011 10:32 pm</h4>
    <div class="postbody"><span class="postbody">There's a tool out there called SapTapper.  It extracts music from GBA games, and you can play it in Winamp using a plugin.  It only works on games which were built using Nintendo's sound libraries.
<br/>
<br/>
Throw a random game at SapTapper, and chances are it will rip successfully, so that indicates it uses Nintendo's sound library.
<br/>
<br/>
GSF Central's site lists 150 GBA soundtracks, and 75 of them are cited as being ripped with SapTapper.  But that number excludes the rips of game which were done before the tool was finished, so far more than 75 of their listed 150 games were using Nintendo's library.
<br/>
<br/>
I can't confirm Golden Sun, since it failed to play back after I tested it in Saptapper, so Camelot might be using their own sound engine.
<br/>
<br/>
Really strange is that "Castlevania Circle of the Moon" and "Harmony of Dissonance" both use Nintendo's sound engine, but the second game has absolute crap for music.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176713 - absence - Fri Sep 16, 2011 8:47 am</h4>
    <div class="postbody"><span class="postbody">I was toying with the idea of writing a replacement replayer that uses sound data from the game, but with proper resampling and mixing done in native code, rather than emulating the game's replayer and GBA sound hardware. It would increase sound quality a lot. Not having to disassemble the music routine of every game makes it sort of practical at least. ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176724 - Exophase - Tue Sep 20, 2011 8:12 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Dwedit wrote:</b></span></td> </tr> <tr> <td class="quote">GSF Central's site lists 150 GBA soundtracks, and 75 of them are cited as being ripped with SapTapper. But that number excludes the rips of game which were done before the tool was finished, so far more than 75 of their listed 150 games were using Nintendo's library.
<br/>
<br/>
I can't confirm Golden Sun, since it failed to play back after I tested it in Saptapper, so Camelot might be using their own sound engine.
<br/>
<br/>
Really strange is that "Castlevania Circle of the Moon" and "Harmony of Dissonance" both use Nintendo's sound engine, but the second game has absolute crap for music.</td> </tr></table><span class="postbody">
<br/>
<br/>
This certainly shows that it was a common library, but this doesn't necessarily mean that almost all developers were using it. 150 games is a pretty small fraction of the total number of unique GBA games and there's a sampling bias given that games that can be ripped with this tool are more likely to be ripped in general. Probably a moot point if the more popular games tended to use it..
<br/>
<br/>
I'm guessing Konami made compromises with HoD's music in order to save resources - it uses way less CPU time than CotM. But maybe with a more efficient audio engine CotM would have used less time to begin with, not that I'm aware of this being a problem for the game.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>absence wrote:</b></span></td> </tr> <tr> <td class="quote">I was toying with the idea of writing a replacement replayer that uses sound data from the game, but with proper resampling and mixing done in native code, rather than emulating the game's replayer and GBA sound hardware. It would increase sound quality a lot. Not having to disassemble the music routine of every game makes it sort of practical at least. ;)</td> </tr></table><span class="postbody">
<br/>
<br/>
I thought about doing something like that too, before I knew that so many games were using Nintendo's sound engine, now it seems more attractive. Would be especially cool if it could be worked into an emulator via HLE.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176756 - gladius - Wed Oct 05, 2011 12:55 am</h4>
    <div class="postbody"><span class="postbody">I'm not sure about 'vast majority'.  Custom sound libraries were pretty popular.  The games I worked on all used a custom engine.  Honestly can not remember what it was called.  They did all the sfx/music as well for us.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176960 - Bregalad - Mon Nov 07, 2011 11:30 pm</h4>
    <div class="postbody"><span class="postbody">I can confirm many games uses the Nintendo sound engine, which I reverse-engineered its format for my Final Fantasy V and VI sound restauration hacks. I released a document describing some aspects of the engine on romhacking.net
<br/>
<br/>
I can also confirm this engine is probably not very efficient - it uses only a 8-bit sound buffer for mixing all channels so the quality is mediocre. Mixing in 16-bit then convert the result to 8-bit by scrapping the low bits would probably lead to better quality at the price of RAM and CPU time.
<br/>
<br/>
Also the engine becomes ridiculously slow when you use a lot of channels, which is why many games took the path to limit the number of channels and use PSG channels.
<br/>
<br/>
Castlevania : Circle of the Moon uses stereo sound, 10512 Hz sampling rate and 12 channels. I clearly remember the game lagging in an area where there was a lot of boxes by the way.
<br/>
<br/>
Castlevania : Harmony of Dissonance uses mono sound, 15768 Hz sampling rate and 5 channels. It uses mostly PSG channels for music, but the game is quite fast paced.
<br/>
<br/>
Golden Sun does uses the Nintendo engine, but a modified version of it, which is probably why it won't work with saptapper. It uses stereo, 8 channels and 21024 Hz, while Golden Sun : The lost Age uses 10 channels and 31536 Hz, which is has the higher sampling rate I've ever noticed (I haven't investigated the WHOLE collection though).
<br/>
<br/>
Because it uses a modified version Camelot *might* have made something that changes those parameters during gameplay and/or that makes mixing faster to make this "achievement" possible.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
