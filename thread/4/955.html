<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Printing variables at run-time to console.. ? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > Printing variables at run-time to console.. ?</h2>
<div id="posts">
<div class="post">
    <h4>#4714 - cewlout - Mon Apr 07, 2003 9:45 pm</h4>
    <div class="postbody"><span class="postbody">Hi dudes,
<br/>
<br/>
I am coding on the GBA with the freely available Devkit Advance.
<br/>
To quick-test my code I use VisualBoy Advance (don't want to
<br/>
use the flasher everytime).
<br/>
<br/>
But now to my actual question ;) - Is there a way to view values
<br/>
of variables when I run the code in an emulator? I am desperately
<br/>
searching for a method to make variables (variables' values) visible at run-time. A simple 'printf("%d",myvariable)' would be enough. How do you guys do this? And which tools/emus (if available freely) do you use for tracing or printing/viewing variables.. any suggestions?
<br/>
<br/>
thank you!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4717 - tepples - Mon Apr 07, 2003 10:10 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>cewlout wrote:</b></span></td> </tr> <tr> <td class="quote">Is there a way to view values of variables when I run the code in an emulator?</td> </tr></table><span class="postbody">
<br/>
If you're using a BG for the status bar, you can try making the status bar taller and printing the variables you want to display into that.
<br/>
<br/>
I guess you're wondering how to print a number.  Use siprintf() (same as sprintf() but doesn't support floating point so it won't add the whole floating point library to your project) to make a string, then write that string to your status bar.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4719 - DekuTree64 - Mon Apr 07, 2003 10:16 pm</h4>
    <div class="postbody"><span class="postbody">The way I do it is just load in a bitmap font (you can use mine, which I uploaded to <a href="http://www.angelfire.com/wizard/deku/Font.bmp" target="_blank">http://www.angelfire.com/wizard/deku/Font.bmp</a>). Then just have a print function that takes an x, y, and BG screen idx. That font starts with a space, which in ascii is 32, so just subtract 32 from each character of your string, set tile x + (y &lt;&lt; 5) of BGS(screenIdx) to that value, and increment x for the next character. Then you need an int to string conversion function, which is very easy to do in hex, and slightly harder in decimal. For hex, just check the upper 4 bits, set to '0' + val if less than 10, set to 'A' + val otherwise, strPos++, then val &lt;&lt;= 4 (so the next 4 bits are in the same position as the 4 you just did), and repeat 8 times total for a 32 number.
<br/>
For decimal, it's basically the same thing, but since you don't want to print eevry digit possible unless the number is that big, you have to start at the end of the output string and work backwards. Just set str[strPos--] to val % 10, then divide val by 10, and repeat until val == 0. If you use the BIOS division, you can get the div and mod at the same timet o speed it up.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4720 - regularkid - Mon Apr 07, 2003 10:24 pm</h4>
    <div class="postbody"><span class="postbody">Yup. Just use the MappyVM emulator and add this function to your code:
<br/>
<br/>
(from the MappyVM SDK doc):
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void dprint(const char *sz) {
<br/>
  asm volatile("
<br/>
    mov r2, %0
<br/>
    ldr r0, =0xc0ded00d
<br/>
    mov r1, #0
<br/>
    and r0, r0, r0
<br/>
  " :
<br/>
  /* No output */ :
<br/>
  "r" (sz) :
<br/>
  "r0", "r1", "r2");
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
In my library I modified this function to take parameters similar to a printf function so that I could call this function like this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
dprint("My variable = %d\n", myVar);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I can't remember the exact code for this since I'm at work and my library code is at home, but I remember you need to use the va_list functions (i'm sure you can find examples of this somewhere. If not, I can post code later tonight). This is EXTREMELY useful and is my main source of debugging help! Hope this helps.<br/>_________________<br/>- RegularKid</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4737 - Torlus - Tue Apr 08, 2003 10:08 am</h4>
    <div class="postbody"><span class="postbody">There is a similar function with VisualBoyAdvance (i use it on Linux).
<br/>
As far as i remember, you have to do is call "swi 0xFF" with r1 pointing to a C-style string.
<br/>
<br/>
I think you'll be able to find an example for calling it from C somewhere in the forum, as it has been discussed before.
<br/>
<br/>
Hope this helps.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4740 - Drago - Tue Apr 08, 2003 11:19 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include &lt;stdio.h&gt;
<br/>
#include &lt;stdarg.h&gt;
<br/>
<br/>
//////////////////////////////////
<br/>
//  VisualBoy console output
<br/>
//////////////////////////////////
<br/>
static void conprint(const char *a_str)
<br/>
{
<br/>
    asm volatile (
<br/>
    "                       \n\
<br/>
        mov r0, %0          \n\
<br/>
        swi 0xff            \n\
<br/>
    "
<br/>
    :
<br/>
       // no output
<br/>
    :
<br/>
       "r" (a_str)
<br/>
    :
<br/>
       "r0"
<br/>
    );
<br/>
}
<br/>
<br/>
//////////////////////////////////
<br/>
//  Format output
<br/>
//////////////////////////////////
<br/>
void dprint(const char *a_fmtstr, ...)
<br/>
{
<br/>
    va_list argptr;
<br/>
    char buffer[256];
<br/>
<br/>
    va_start(argptr, a_fmtstr);
<br/>
    vsprintf(buffer, a_fmtstr, argptr);
<br/>
    conprint(buffer);
<br/>
    va_end(argptr);
<br/>
}
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Note that the swi 0xff hangs the GBA, so you should disable the console output when testing on the hardware.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4751 - TurboHz - Tue Apr 08, 2003 2:17 pm</h4>
    <div class="postbody"><span class="postbody">// ARM code
<br/>
   void print(char *s)
<br/>
   {
<br/>
     asm volatile("mov r0, %0;"
<br/>
                  "swi 0xff0000;"
<br/>
                  : // no ouput
<br/>
                  : "r" (s)
<br/>
                  : "r0");
<br/>
   }
<br/>
<br/>
<br/>
I found this output code in VBA FAQ... how would that translate to ARM asm?? 
<br/>
<br/>
Something about loading in r0 the starting address of a string of bytes (chars)? 
<br/>
<br/>
How should the string be terminated? with a chr(13)?
<br/>
<br/>
Sorry if this seems obvious to anyone. (I'm not using C for GBA dev, just asm)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4752 - cewlout - Tue Apr 08, 2003 3:44 pm</h4>
    <div class="postbody"><span class="postbody">Thank you very much dudes, you helped me alot!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4758 - tom - Tue Apr 08, 2003 4:55 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Drago wrote:</b></span></td> </tr> <tr> <td class="quote">Note that the swi 0xff hangs the GBA, so you should disable the console output when testing on the hardware.</td> </tr></table><span class="postbody">
<br/>
<br/>
actually visualboy advance supports two methods to print text to the log window. one is swi 0xff, and the other one is similar to mappy'ss method. this method has the advantage that it doesn't crash the hardware. pretty useful, as you don't have to switch between release/debug builds during development.
<br/>
<br/>
i added the following code to the file vba.s that can be downloaded from the visualboy website</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
   .align 2
<br/>
   .global vbalog_hardware_friendly
<br/>
   .thumb_func
<br/>
   .type   vbalog_hardware_friendly,function
<br/>
@ log a message to VBA's output console, don't crash real hardware
<br/>
@ r0 = pointer to log message
<br/>
vbalog_hardware_friendly:
<br/>
                    mov r2,r0
<br/>
                    ldr r0,=0xc0ded00d
<br/>
                    mov r1,#0
<br/>
                    and r0,r0
<br/>
                    bx lr
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
