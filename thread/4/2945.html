<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Calculating sinus & arctan2 - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > Calculating sinus & arctan2</h2>
<div id="posts">
<div class="post">
    <h4>#16992 - Lupin - Sat Feb 28, 2004 2:15 pm</h4>
    <div class="postbody"><span class="postbody">I know about the swi 0xE(0000) function, but it is not precise enough, i need a sinus/cosinus where 960 is a full rotation (4 times the display width) and i need it to be a 16 bit fixed point number, i tried using the swi function but since it can only calculate at 8 bit precision i got some troubles with it :(
<br/>
<br/>
At the moment I am using this line:
<br/>
trigVox[i] = (sin(i * 0.006544984694) * (0x10000));
<br/>
<br/>
It works pretty well, but i don't want to have software floating point calculations in my binary :/
<br/>
Does anyone know a way to calculate sin on hardware without using floating point arithemtic?
<br/>
<br/>
I am also searching for a way to get a fast ArcTan2 function....</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#16993 - Touchstone - Sat Feb 28, 2004 2:25 pm</h4>
    <div class="postbody"><span class="postbody">Have you though of creating a sin look-up table on your PC and use it in your GBA program? Shouldn't use to much ROM space.<br/>_________________<br/>You can't beat our meat</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#16996 - poslundc - Sat Feb 28, 2004 3:46 pm</h4>
    <div class="postbody"><span class="postbody">Do as Touchtone says... create the LUT on your PC (usually 8.24 is plenty of precision), then either access it from ROM or transfer it into EWRAM during your program's initialization phase.
<br/>
<br/>
If it's not too destructive to your mathematics, you should consider making your table 1024 entries instead of 960. Since sin/cos are periodic you can then easily find the correct function value for any number just by AND-ing it with 1023 beforehand.
<br/>
<br/>
And all you need is one LUT for both sine and cosine... if you make a cos table, just add 256 to your value before AND-ing to get the sine.
<br/>
<br/>
A 1024-entry table of 32-bit numbers will take only 4K of ROM, or 4K if you transfer it to EWRAM (out of 256K that you have available).
<br/>
<br/>
ArcTan2 is a bit trickier, since it is a function of two variables... but for a small enough range of inputs it should still be practical to use a LUT. Other than that, I imagine the BIOS function is at least <span style="font-style: italic">decent</span>, although I can't say I've tried it.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17008 - Lupin - Sat Feb 28, 2004 7:37 pm</h4>
    <div class="postbody"><span class="postbody">well, i would like to know how to set up the bios function for using arctan2 :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17009 - Miked0801 - Sat Feb 28, 2004 7:54 pm</h4>
    <div class="postbody"><span class="postbody">You could, but if precision matters that much, LUT it as well.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17014 - poslundc - Sat Feb 28, 2004 9:51 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lupin wrote:</b></span></td> </tr> <tr> <td class="quote">well, i would like to know how to set up the bios function for using arctan2 :)</td> </tr></table><span class="postbody">
<br/>
<br/>
<a class="postlink" href="http://www.work.de/nocash/gbatek.htm#biosarithmeticfunctions" target="_blank">http://www.work.de/nocash/gbatek.htm#biosarithmeticfunctions</a>
<br/>
<br/>
It's the last function in the section.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17019 - Lupin - Sun Feb 29, 2004 12:08 am</h4>
    <div class="postbody"><span class="postbody">thx, do you know what is meant by integral part?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17021 - poslundc - Sun Feb 29, 2004 12:53 am</h4>
    <div class="postbody"><span class="postbody">The integral part of a number is everything left of the decimal place. Likewise, the fractional part is everything to the right of the decimal place.
<br/>
<br/>
Since the atan2 bios function only allows one bit of precision in the integral part, this means it only operates on the range (-2, 2). Which is a little unusual, but I guess you can always shift your inputs down to the correct precision.
<br/>
<br/>
Dan (woo, 500).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17022 - ampz - Sun Feb 29, 2004 2:11 am</h4>
    <div class="postbody"><span class="postbody">Remeber, when doing sine LUTs.. You only need the LUT for a quarter of a sine. Saves memory.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17025 - tepples - Sun Feb 29, 2004 5:45 am</h4>
    <div class="postbody"><span class="postbody">How to do sin:<ol type="1"><li>Reflect theta into [-quarter circle, quarter circle]</li><li>Store whether theta &lt; 0 ("quadrant info")</li><li>Do a table lookup on |theta|</li><li>Combine with quadrant info</li></ol>
<br/>
How to do cos:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">static inline fixed fixcos(fixed theta)
<br/>
{
<br/>
Â  return fixsin(theta + QUARTER_CIRCLE);
<br/>
}</td> </tr></table><span class="postbody">
<br/>
How to do arctan2:<ol type="1"><li>Store whether Y and X are negative ("octant info")</li><li>Store whether |Y| is greater than |X| ("octant info")</li><li>Fix-divide smaller absolute value by larger absolute value</li><li>Do a table lookup on the quotient</li><li>Combine result with octant info</li></ol>
<br/>
You can save even more memory on the lookup tables used by cos and arctan2 by using linear interpolation rather than nearest-neighbor, which gets you the same mean error with shorter tables.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17027 - poslundc - Sun Feb 29, 2004 6:08 am</h4>
    <div class="postbody"><span class="postbody">There is a good argument to be made for the redundant data of a complete sine or cosine table... most applications don't need higher resolution than a kilobyte or two of data anyway. My cosine table has 512 entries (2K) for a complete circle, which is already way more than I need for my raycaster. And even if you need, say, four times that level of detail (which is now quite a lot of resolution), what's the big deal with using 8K of EWRAM?
<br/>
<br/>
Typically where math is involved I am also concerned with speed, and it's nice to be able to pull a result out of EWRAM in less than ten cycles.
<br/>
<br/>
Not that these other techniques aren't valid... but where speed is a factor you can't beat a comfortably redundant LUT. :D
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17034 - Lupin - Sun Feb 29, 2004 10:49 am</h4>
    <div class="postbody"><span class="postbody">Who minds about memory? I have 32kb IWRAM, that's more than i will ever need lol :P</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
