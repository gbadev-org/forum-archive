<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>help get my etch and sketch working. - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Coding > help get my etch and sketch working.</h2>
<div id="posts">
<div class="post">
    <h4>#175791 - deathmetalscott - Mon Feb 07, 2011 9:12 pm</h4>
    <div class="postbody"><span class="postbody">I just started in a GBA programming class to fill a second programming requirement in college studies.  I have not programmed in C in a very long time and am having some difficulty.  My instructor helped me out and I was able to get this far on my own but I can not get the program to compile.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include &lt;mygba.h&gt;
<br/>
#define BUTTONS (volatile unsigned int*)0x04000130;
<br/>
    // Register: Status of button presses
<br/>
unsigned short* videoBuffer=(unsigned short*)0x6000000;
<br/>
    // pointer to video buffer
<br/>
#define SetMode(mode) REG_DISPCNT=(mode)
<br/>
#define buttons
<br/>
#define BUTTON_A 1
<br/>
#define BUTTON_B 2
<br/>
#define BUTTON_SELECT 4
<br/>
#define BUTTON_START 8
<br/>
#define BUTTON_RIGHT 16
<br/>
#define BUTTON_LEFT 32
<br/>
#define BUTTON_UP 64
<br/>
#define BUTTON_DOWN 128
<br/>
#define BUTTON_R 256
<br/>
#define BUTTON_L 512
<br/>
<br/>
<br/>
void drawpixel3(int x, int y, unsigned short c)
<br/>
{
<br/>
   videoBuffer[y*240+x]=c;
<br/>
}
<br/>
<br/>
void CheckButtons()
<br/>
{
<br/>
    buttons[0] = !((*BUTTONS) &amp; BUTTON_A);
<br/>
    buttons[1] = !((*BUTTONS) &amp; BUTTON_B);
<br/>
    buttons[2] = !((*BUTTONS) &amp; BUTTON_LEFT);
<br/>
    buttons[3] = !((*BUTTONS) &amp; BUTTON_RIGHT);
<br/>
    buttons[4] = !((*BUTTONS) &amp; BUTTON_UP);
<br/>
    buttons[5] = !((*BUTTONS) &amp; BUTTON_DOWN);
<br/>
    buttons[6] = !((*BUTTONS) &amp; BUTTON_START);
<br/>
    buttons[7] = !((*BUTTONS) &amp; BUTTON_SELECT);
<br/>
    buttons[8] = !((*BUTTONS) &amp; BUTTON_L);
<br/>
    buttons[9] = !((*BUTTONS) &amp; BUTTON_R);
<br/>
}
<br/>
<br/>
bool Pressed(int button)
<br/>
{
<br/>
    switch(button)
<br/>
    {
<br/>
    case BUTTON_A: return buttons[0];
<br/>
    case BUTTON_B: return buttons[1];
<br/>
    case BUTTON_LEFT: return buttons[2];
<br/>
    case BUTTON_RIGHT: return buttons[3];
<br/>
    case BUTTON_UP: return buttons[4];
<br/>
    case BUTTON_DOWN: return buttons[5];
<br/>
    case BUTTON_START: return buttons[6];
<br/>
    case BUTTON_SELECT: return buttons[7];
<br/>
    case BUTTON_L: return buttons[8];
<br/>
    case BUTTON_R: return buttons[9];
<br/>
    }
<br/>
}
<br/>
<br/>
<br/>
int main(void)
<br/>
{
<br/>
  /*  SetMode(MODE_3 | BG2_ENABLE);
<br/>
<br/>
    drawpixel3(120, 80, 0xFFFF);
<br/>
<br/>
    //continuous loop
<br/>
    while(1)
<br/>
    {
<br/>
      CheckButtons();
<br/>
         if (Pressed(BUTTON_LEFT))
<br/>
         {
<br/>
         for(n=0;n&lt;10000;n--);
<br/>
      }
<br/>
      else if(Pressed(BUTTON_RIGHT))
<br/>
      {
<br/>
          for(n=0;n&lt;10000;n++);
<br/>
        }
<br/>
        else if(Pressed (BUTTON_UP))
<br/>
        {
<br/>
            for(y=0;y&lt;10000;y++);
<br/>
        }
<br/>
        else if(Pressed(BUTTON_DOWN))
<br/>
        {
<br/>
            for(y=0;y&lt;10000;y--);
<br/>
        }
<br/>
   }
<br/>
<br/>
}
<br/>
*/
<br/>
    return 0;
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
The program is a simple etch and sketch and I keep getting these errors:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
main.c: In function `CheckButtons':
<br/>
main.c:27: error: parse error before '[' token
<br/>
main.c: In function `Pressed':
<br/>
main.c:43: error: parse error before '[' token
<br/>
main.c:44: error: parse error before '[' token
<br/>
main.c:45: error: parse error before '[' token
<br/>
main.c:46: error: parse error before '[' token
<br/>
main.c:47: error: parse error before '[' token
<br/>
main.c:48: error: parse error before '[' token
<br/>
main.c:49: error: parse error before '[' token
<br/>
main.c:50: error: parse error before '[' token
<br/>
main.c:51: error: parse error before '[' token
<br/>
main.c:52: error: parse error before '[' token
<br/>
make: *** [main.o] Error 1
<br/>
</td> </tr></table><span class="postbody">[/list]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175792 - elhobbs - Mon Feb 07, 2011 10:31 pm</h4>
    <div class="postbody"><span class="postbody">I think you are supposed to do the assignments yourself...yet, I am amazed your instructor helped you to this result.
<br/>
<br/>
There are many logic flaws here but I will point out one...
<br/>
what do you think this is doing exactly?</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define buttons 
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175793 - deathmetalscott - Mon Feb 07, 2011 11:55 pm</h4>
    <div class="postbody"><span class="postbody">I just need help, I did most of the work myself.  As far as that goes, yeah, I saw that and fixed it.  Below is what I have now.  Everything is compiling except for something in CheckButtons().  I keep getting errors that say: error: parse error before ';' token.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
#include &lt;mygba.h&gt;
<br/>
<br/>
///////////////Register: Status of button presses////////
<br/>
#define BUTTONS (volatile unsigned int*)0x04000130;
<br/>
////////////////////////////////////////////////////////
<br/>
<br/>
// ///////////pointer to video buffer///////////////////
<br/>
unsigned short* videoBuffer=(unsigned short*)0x6000000;
<br/>
///////////////////////////////////////////////////////
<br/>
<br/>
//////////////Sets Video Mode/////////////////////////
<br/>
#define MODE_3 0x3
<br/>
#define BG2_ENABLE 0x400
<br/>
#define SetMode(mode) REG_DISPCNT=(mode)
<br/>
//////////////////////////////////////////////////////
<br/>
<br/>
/////////////Button Definitions//////////////////////
<br/>
#define BUTTON_A 1
<br/>
#define BUTTON_B 2
<br/>
#define BUTTON_SELECT 4
<br/>
#define BUTTON_START 8
<br/>
#define BUTTON_RIGHT 16
<br/>
#define BUTTON_LEFT 32
<br/>
#define BUTTON_UP 64
<br/>
#define BUTTON_DOWN 128
<br/>
#define BUTTON_R 256
<br/>
#define BUTTON_L 512
<br/>
<br/>
#define bool int
<br/>
#define true 1
<br/>
#define false 0
<br/>
bool buttons[10];
<br/>
///////////////////////////////////////////////////
<br/>
<br/>
//////////////Draws the pixel in the center of the screen//
<br/>
void drawpixel3(int x, int y, unsigned short c)
<br/>
{
<br/>
   videoBuffer[y*240+x]=c;
<br/>
}
<br/>
///////////////////////////////////////////////////////////
<br/>
<br/>
/////////Check Buttons///////////////////////////
<br/>
void CheckButtons()
<br/>
{
<br/>
    buttons[0] = !((*BUTTONS) &amp; BUTTON_A);
<br/>
    buttons[1] = !((*BUTTONS) &amp; BUTTON_B);
<br/>
    buttons[2] = !((*BUTTONS) &amp; BUTTON_LEFT);
<br/>
    buttons[3] = !((*BUTTONS) &amp; BUTTON_RIGHT);
<br/>
    buttons[4] = !((*BUTTONS) &amp; BUTTON_UP);
<br/>
    buttons[5] = !((*BUTTONS) &amp; BUTTON_DOWN);
<br/>
    buttons[6] = !((*BUTTONS) &amp; BUTTON_START);
<br/>
    buttons[7] = !((*BUTTONS) &amp; BUTTON_SELECT);
<br/>
    buttons[8] = !((*BUTTONS) &amp; BUTTON_L);
<br/>
    buttons[9] = !((*BUTTONS) &amp; BUTTON_R);
<br/>
}
<br/>
///////////////////////////////////////////////
<br/>
<br/>
bool Pressed(int button)
<br/>
{
<br/>
    switch(button)
<br/>
    {
<br/>
    case BUTTON_A: return buttons[0];
<br/>
    case BUTTON_B: return buttons[1];
<br/>
    case BUTTON_LEFT: return buttons[2];
<br/>
    case BUTTON_RIGHT: return buttons[3];
<br/>
    case BUTTON_UP: return buttons[4];
<br/>
    case BUTTON_DOWN: return buttons[5];
<br/>
    case BUTTON_START: return buttons[6];
<br/>
    case BUTTON_SELECT: return buttons[7];
<br/>
    case BUTTON_L: return buttons[8];
<br/>
    case BUTTON_R: return buttons[9];
<br/>
    }
<br/>
}
<br/>
<br/>
<br/>
int main(void)
<br/>
{
<br/>
    SetMode(MODE_3 | BG2_ENABLE);
<br/>
<br/>
    drawpixel3(120, 80, 0xFFFF);
<br/>
<br/>
    //continuous loop
<br/>
    while(1)
<br/>
    {
<br/>
      CheckButtons();
<br/>
         if (Pressed(BUTTON_LEFT))
<br/>
         {
<br/>
             int n;
<br/>
         for(n=0;n&lt;10000;n--);
<br/>
      }
<br/>
      else if(Pressed(BUTTON_RIGHT))
<br/>
      {
<br/>
          int n;
<br/>
          for(n=0;n&lt;10000;n++);
<br/>
        }
<br/>
        else if(Pressed (BUTTON_UP))
<br/>
        {
<br/>
            int y;
<br/>
            for(y=0;y&lt;10000;y++);
<br/>
        }
<br/>
        else if(Pressed(BUTTON_DOWN))
<br/>
        {
<br/>
            int y;
<br/>
            for(y=0;y&lt;10000;y--);
<br/>
        }
<br/>
   }
<br/>
<br/>
}
<br/>
<br/>
    return 0;
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175796 - sverx - Tue Feb 08, 2011 10:16 am</h4>
    <div class="postbody"><span class="postbody">remember that #defines are just a kind of 'text replacement' in your source so if you're doing this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define BUTTONS (volatile unsigned int*)0x04000130;</td> </tr></table><span class="postbody">
<br/>
<br/>
and later you do this
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">buttons[3] = !((*BUTTONS) &amp; BUTTON_RIGHT);</td> </tr></table><span class="postbody">
<br/>
<br/>
it means you're doing this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">buttons[3] = !((* (volatile unsigned int*)0x04000130; ) &amp; BUTTON_RIGHT); </td> </tr></table><span class="postbody">
<br/>
<br/>
that has at least one mistake in it...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175808 - dantheman - Thu Feb 10, 2011 4:36 am</h4>
    <div class="postbody"><span class="postbody">Hehe, I know exactly which class you're in.  How's Prof Smith doing lately anyway?
<br/>
<br/>
Regardless, like sverx mentioned, #define is like a global find-and-replace that occurs before any compilation actually takes place.  So for starters, the semicolon at the end of the #define BUTTONS line shouldn't be there, and there might be an extra asterisk but I'm not entirely certain, been way too long since I took the class so I don't remember much about pointers.
<br/>
<br/>
Kind of a side note, but in general you want to make sure to put parenthesis around your input parameters to any #define statement, as you've done with SetMode here.  This will be especially important once you add a macro that lets you define colors easier, something like 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define RGB(r,g,b) ((r)+((g)&lt;&lt;5)+((b)&lt;&lt;10)) //generates hex code for given RGB values 0-31</td> </tr></table><span class="postbody">
<br/>
<br/>
Without the parenthesis around R, G, and B, if you tried calling <span style="font-weight: bold">RGB(x+15,20,20)</span> it would screw up due to the x+15 part.
<br/>
<br/>
Also I don't know what dev environment you're using these days (was Visual Studio for my semester but I know they moved to Eclipse later on) but see if you have any temporary compilation files in your working directory.  These would be things like *.i, *.s, possibly *.o files.  I had a couple of odd compilation errors that would only go away once I fixed the code (of course) and then deleted the temporary files so it could re-create them rather than attempting to use incorrect cached copies.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
