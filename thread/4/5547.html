<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>"translate" an equation - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Coding > "translate" an equation</h2>
<div id="posts">
<div class="post">
    <h4>#41280 - nicouiuc - Wed Apr 27, 2005 2:24 am</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
I am using the XPort for the GBA and Im trying to implement a filter on the GBA.  The equations, called every 1ms, for that look like:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
y2 = 0.0009975 * x1 - 0.0009975 * x0 + 1.9975*y1 - 0.9975*y0;
<br/>
<br/>
b2 = 0.0024953 * a1 - 0.0024937 * a0 + 1.9975*b1 - 0.9975*b0;
<br/>
<br/>
<br/>
x0 = x1;
<br/>
y0 = y1:
<br/>
y1 = y2:
<br/>
<br/>
a0 = a1;
<br/>
b0 = b1:
<br/>
b1 = b2;
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
The values of x1 and a1 are 12 bits. I tried to set this filter up on the GBA, but it doesnt work at all. I tried scaling the 0.0009975 by 2^20, and the 1.9975 and .9975 by 4096. So, e.g. the first line looks like:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
y2 = 1046 * x1 - 1046 * x0 + (8182*y1 - 4086*y0)/4096;
<br/>
<br/>
x0 = x1;
<br/>
y0 = y1:
<br/>
y1 = y2:
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
(I now compute 2^20 * the original y2, y1 and y0 should already be scaled by that amount as they are derived from y2)
<br/>
This gives some very strange values after seconds, I think I have a problem of overlowing registers somewhere, also I tried to use signed long long int for all variables. I can only fix it by immidiately making a divison by 2^14, but then I loose already a big amount of precision, which seems to hurt my algorithm...
<br/>
<br/>
Also, it seems that it matters if I divide by the power of 2 or use the shift operator. I guess thats caused by different rounding/truncation, right? And i sometimes get different results for positive than for negative values...
<br/>
<br/>
Does anyone know a way how to implement this stuff best? 
<br/>
<br/>
~Nico</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#41375 - nicouiuc - Wed Apr 27, 2005 11:21 pm</h4>
    <div class="postbody"><span class="postbody">I figured it out after 10 hours, anyone who knows about digital control, make sure your code never truncates a pole from 0.99999998 to a pole a 1 :-)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
