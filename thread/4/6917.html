<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Slow down a sprite question - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Coding > Slow down a sprite question</h2>
<div id="posts">
<div class="post">
    <h4>#54590 - psycorpse - Tue Sep 20, 2005 6:16 pm</h4>
    <div class="postbody"><span class="postbody">I am somewhat new to programming on the gba (Ok. I am new to gba programming). Just a little background, I am making a bejeweled clone. The problem that I am having is that my cursor or pointer so to speak is moving way to fast. I have my functions setup so that when you press right, left, up, or down it moves an x amount of pixels. So it should look like it moves directly to the other image. The problem is when you press the dpad it moves 2 or 3 times more than it should. Is there a way to slow this down? or only move it once per press. Any kind of feedback would be great. I wouldn't even mind if I was pointed in the right direction.
<br/>
<br/>
Thanks in advance. 
<br/>
<br/>
Mike</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#54598 - Miked0801 - Tue Sep 20, 2005 7:07 pm</h4>
    <div class="postbody"><span class="postbody">You need to setup a system whereas you only track when the button is first pressed and translate that to a movement (edge-based) as opposed to just checking to see if the direction is still pressed every tic and reacting off that.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#54601 - Quirky - Tue Sep 20, 2005 7:12 pm</h4>
    <div class="postbody"><span class="postbody">Are you checking the button presses once per frame? Then caching the presses and only reading from that cache? I find that doing something like this works well for the scenario you have, a publock based interface that needs tight response and 'hold down' behaviour:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
poll hardware key register
<br/>
for each button
<br/>
  if  button is pressed
<br/>
    repeats[button] ++
<br/>
  else
<br/>
    repeats[button] = 0
<br/>
  if repeats[button] == 1 or repeats[button] &gt; REPEAT_LIMIT
<br/>
    pressed [button] = true
<br/>
  else
<br/>
     pressed[button] = false
<br/>
end for
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Then check the pressed[] array rather than the hardware register. This means when you press the key it will be pressed, and it will also 'auto repeat' after a few ticks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#54603 - poslundc - Tue Sep 20, 2005 7:18 pm</h4>
    <div class="postbody"><span class="postbody">Also: make sure you are using fixed-point math to keep track of the object's position and velocity. The GBA ticks 60 times per second, so even if you only check input once in your entire game loop before waiting for the next VBlank, it will still move very quickly if it's moving one pixel per tick.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#54608 - Fatnickc - Tue Sep 20, 2005 8:00 pm</h4>
    <div class="postbody"><span class="postbody">Alternatively, and possibly more simply, simply increment a value every tic, and whne it reaches 5 or 10, you then move and reset the value to zero. Or you could not reset it, and use modulus. 
<br/>
Also, with this, it is very easy to change how often it moves (affecting the 'speed' in the players mind) by simply waiting for a different value to come up.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#54615 - tepples - Tue Sep 20, 2005 9:47 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Fatnickc wrote:</b></span></td> </tr> <tr> <td class="quote">possibly more simply, simply increment a value every tic, and whne it reaches 5 or 10, you then move and reset the value to zero. Or you could not reset it, and use modulus.</td> </tr></table><span class="postbody">
<br/>
Of course, the GBA doesn't have support for hardware division, which means the only moduli that work well are powers of 2, and then you're back to fixed-point math.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#54617 - poslundc - Tue Sep 20, 2005 10:06 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Fatnickc wrote:</b></span></td> </tr> <tr> <td class="quote">possibly more simply, simply increment a value every tic, and whne it reaches 5 or 10, you then move and reset the value to zero. Or you could not reset it, and use modulus.</td> </tr></table><span class="postbody">
<br/>
Of course, the GBA doesn't have support for hardware division, which means the only moduli that work well are powers of 2, and then you're back to fixed-point math.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Or ugly/slow if-statements all over the place.
<br/>
<br/>
Learn fixed-point math if you haven't already. There are plenty of times when you'll want to use counters instead, but generally speaking anything involving motion physics (position, velocity, acceleration, etc.) your code will be infinitely easier to write/understand/maintain - not to mention more compact and optimal - if you simply use fixed-point values.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#54620 - psycorpse - Tue Sep 20, 2005 10:47 pm</h4>
    <div class="postbody"><span class="postbody">Ok. I see what you mean. However, I don't know fixed-point math. Well I might a little but I am not 100% sure. I will google it but can anyone offer a site that has good tutorials on fixed-point math?
<br/>
<br/>
Mike</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#54624 - tepples - Wed Sep 21, 2005 12:01 am</h4>
    <div class="postbody"><span class="postbody">I actually learned fixed-point from a Mac programming book, so that might not help much. Google [ fixed-point math tutorial ] gives <a class="postlink" href="http://www.wwnet.net/~stevelim/fixed.html" target="_blank">Fun With Fixed Point Numbers</a>.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#54629 - blacksun - Wed Sep 21, 2005 1:21 am</h4>
    <div class="postbody"><span class="postbody">If you are just trying to increment the cursor one square at a time, I have found a way to do it.  It has to do with checking the key presses and doesn't need to keep a counter of any kind.  It may not be the best, but it seems to work for me.
<br/>
<br/>
Here is my input code to check if a button was pressed
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
if(KEY_PRESSED(KEY_UP))      //if the up key is pressed
<br/>
   {
<br/>
      numY -= 4;
<br/>
      cursorY -= GRID_SQUARE_SIZE;
<br/>
<br/>
      if(cursorY &lt; Y_START_SINGLE)
<br/>
         cursorY += GRID_SQUARE_SIZE;
<br/>
         
<br/>
      while(KEY_PRESSED(KEY_UP));
<br/>
                 }
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Here is my macro for KEY_PRESSED
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define KEYS (*(volatile u16*)0x04000130)
<br/>
<br/>
#define KEY_PRESSED(k)   (!(KEYS &amp; k))
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
The while(KEY_PRESSED(KEY_UP)); will wait until you have let go of the button before moving on.  Inputs are a little off in my opinion, where you have it set to 1 if not using and 0 if it is active.  Hope this helps and I didn't steer you wrong.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#54636 - psycorpse - Wed Sep 21, 2005 2:20 am</h4>
    <div class="postbody"><span class="postbody">I will give that a try. It sounds like what I am wanting to do. I will also be doing more research on the fixed-point math. Thanks and I will post if this works.
<br/>
<br/>
Mike</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#54639 - psycorpse - Wed Sep 21, 2005 3:04 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>blacksun wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
      while(KEY_PRESSED(KEY_UP));
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Wouldn't this make the program hang if someone was holding down the key?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#54652 - poslundc - Wed Sep 21, 2005 7:35 am</h4>
    <div class="postbody"><span class="postbody">Yes, it would. And it's generally an ill-advised way to set up your program, and shouldn't be used except maybe in quick tests of an algorithm or something.
<br/>
<br/>
A much more effective, scalable structure is to have an infinite loop that cycles every VBlank. Read the input once per frame, and make a decision about what to do next once per frame. Then do all of your graphics updates, etc. as normal. Don't hang inside part of your program waiting for input to happen.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
