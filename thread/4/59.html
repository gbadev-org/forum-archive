<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Array compiled to a specific location - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > Array compiled to a specific location</h2>
<div id="posts">
<div class="post">
    <h4>#310 - sgeos - Mon Jan 06, 2003 4:23 am</h4>
    <div class="postbody"><span class="postbody">Let's say I have three tilesets that I want to start at 0801:0000, 0802:0000 and 0803:0000 in the ROM after it is compiled.  How should I go about doing this?  I'd be happy to see solutions for ASM and C if they exist.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#313 - Touchstone - Mon Jan 06, 2003 5:06 am</h4>
    <div class="postbody"><span class="postbody">In asm you have the .ORG directive (origin perhaps?) that let you set the location of whatever comes after the directive. I think this mess up objcopy though so you'll end up with a 92MB bin file. :)
<br/>
<br/>
If you are using a linker script you can create a new section (like text, bss or data) and then assign your variable to that new section.
<br/>
<br/>
Specify a new section in your linkerscript like so:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">.my_section :
<br/>
{
<br/>
   __my_section_start = 0x08010000;
<br/>
   *(.my_section)
<br/>
   *(.my_section.*)
<br/>
} = 0xff
<br/>
__my_section_end  = .;</td> </tr></table><span class="postbody">
<br/>
<br/>
Then in your C code, in order to assign your variable to that specific section you do:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">char MyDeluxeData[0x100] __attribute__ ((section ("my_section"))) = { 0, .. };</td> </tr></table><span class="postbody">
<br/>
The variable have to be initialized for the __attribute__ to take effect.
<br/>
<br/>
To have an assembler symbol in a specific section I think you do:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   .section .my_section
<br/>
MyDeluxeData:
<br/>
   .word   0
<br/>
   ...</td> </tr></table><span class="postbody">
<br/>
<br/>
I'm not sure that my snippet of linker script works but it gives you the general idea anyways.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#315 - sgeos - Mon Jan 06, 2003 5:25 am</h4>
    <div class="postbody"><span class="postbody">Thanks.  I'm sure I'll figure it out.  Just needed to be pointed in the right direction.  I've used C for years and I've never seen anything like that.  Then again I always coding for a PC where nobody (at least me) cares what exact address anything is at.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#318 - Touchstone - Mon Jan 06, 2003 5:47 am</h4>
    <div class="postbody"><span class="postbody">Both the linker script and variable attribute are GNU specific so if you haven't used gcc before then that might be the reason why you haven't seen it. :) And like you say, nowadays it's not that important where things end up.
<br/>
<br/>
To be honest I can't figure out why you would want your data to be in a specific location in the ROM either unless you where to access the data via an absolut adress instead of a symbol. Unless of course you where to enter the source adress of tiledata in a script file for instance but since no data on the agb will change once you've done your build you can have the level designers write little c-files that use the c symbols instead of hardcoded adresses. That's what I do anyways and it works like a charm.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#343 - sgeos - Mon Jan 06, 2003 6:07 pm</h4>
    <div class="postbody"><span class="postbody">I don't recall using anything other than gcc, but I've never needed to use a linker script.  I guess now is the time to learn about them. =)  Where might I find good documentation on them?
<br/>
<br/>
As for why do I want my data to be in a specific location?  I'm designing a combo map/tile/palette/font editor.  The idea is that the stuff you make can be saved to SRAM, binary dumped and converted into c/asm files and then recompiled into the ROM so that the SRAM can be used to make new stuff.  I want the data in ROM to be in easy to remember locations just in case anybody wants to dump it.  It will probably be made in ASM- less programs can mess things up that way.
<br/>
<br/>
I'll start coding after the interface/design is complete and I figure out how I want to slice up SRAM.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#356 - Touchstone - Mon Jan 06, 2003 8:28 pm</h4>
    <div class="postbody"><span class="postbody">Oh, ok. Here you have the complete linker documentation <a class="postlink" href="http://www.gnu.org/manual/ld-2.9.1/" target="_blank">http://www.gnu.org/manual/ld-2.9.1/</a>, I'm sure you can find something usefull on linkerscripts there.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#367 - sgeos - Mon Jan 06, 2003 9:58 pm</h4>
    <div class="postbody"><span class="postbody">Thanks!
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
