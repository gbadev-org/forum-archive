<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Div Reciprocal table - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Coding > Div Reciprocal table</h2>
<div id="posts">
<div class="post">
    <h4>#26343 - funkeejeffou - Mon Sep 13, 2004 2:29 pm</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
I already use div tabs in my project as they are simple to implement, but I've been thinking lately about using reciprocal div tabs.
<br/>
After thinking and googling around, I still can't figure out how to compute it in an array form(the only way I found by myself was using a binary tree).
<br/>
<br/>
The main issue is determining what x value is when I have 1/x value in an FixedPoint format.
<br/>
<br/>
Example :
<br/>
1/x = 106 in FP16
<br/>
is equivalent to 2^16/x  = 106
<br/>
is equivalent to 65536/x  = 106
<br/>
x = 65536/106
<br/>
x = 618
<br/>
<br/>
so I'd like to avoid that division by having an array :
<br/>
reciprocal[106] = 618
<br/>
<br/>
I've seen on the forum some posts concerning reciprocal LUT tables, is it the same thing? How are they precomputed?
<br/>
<br/>
Thanks, Jeff.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26345 - lordmetroid - Mon Sep 13, 2004 3:03 pm</h4>
    <div class="postbody"><span class="postbody">you create your table by dividing with N where N is the range you would like to be able to divide any number with...
<br/>
For example 1 to 255...
<br/>
<br/>
you create the table by dividing 1 as it would be in the fixed point, ie if you use an X.8 fixed point your one would be 256... and so you would need to divide 256 with all N...
<br/>
<br/>
However this isn't enough further more you need to add +1 to every element in the table as it seems it doesn't round the number correctly otherwise...
<br/>
Also as you divide by using a multiplication Y*table(N) you need to shift your result to the left like you would be doing in a FP multiplication.<br/>_________________<br/>*Spam*
<br/>
Open Solutions for an open mind, <a href="http://www.areta.org" target="_blank">www.areta.org</a>
<br/>
<br/>
Areta is an organization of coders codeing mostly open source project, but there is alot of sections like GBA dev, Language learning communities, RPG communities, etc...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26351 - funkeejeffou - Mon Sep 13, 2004 5:37 pm</h4>
    <div class="postbody"><span class="postbody">Thanks lord metroid, but I'm not sure I'm getting what you are telling me.
<br/>
Could you just post an example or some algorithmic so I can figure it out?
<br/>
<br/>
Cheers, Jeff.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26354 - Master S - Mon Sep 13, 2004 6:02 pm</h4>
    <div class="postbody"><span class="postbody">For a tabel in range 1 to 255 you would do
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">static unsigned int Divtab[256];
<br/>
<br/>
void BuildDivTab(void)
<br/>
{
<br/>
  int i;
<br/>
  for(i=1;i&lt;256;i++)
<br/>
    DivTab[i] = 256 / i;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
to divide by 8 you do
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">x = (40 * DivTab[8]) &gt;&gt; 8; // x = 40 / 8</td> </tr></table><span class="postbody">
<br/>
<br/>
Hope that helps :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26356 - lordmetroid - Mon Sep 13, 2004 6:11 pm</h4>
    <div class="postbody"><span class="postbody">actually do:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
 for(i = 1;i&lt;256;i++)
<br/>
<br/>
    gba_fpm_div[i] = (256/i)+1;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
but don't use only X.8 fixed point, the precision will be so awfull it becomes useless to try to calculate anything, rather use a 1.15 format... for your table, however after you used the division table you would need to shift it an additional 7 left in order to get it to become X.8<br/>_________________<br/>*Spam*
<br/>
Open Solutions for an open mind, <a href="http://www.areta.org" target="_blank">www.areta.org</a>
<br/>
<br/>
Areta is an organization of coders codeing mostly open source project, but there is alot of sections like GBA dev, Language learning communities, RPG communities, etc...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26360 - funkeejeffou - Mon Sep 13, 2004 6:26 pm</h4>
    <div class="postbody"><span class="postbody">Erf...
<br/>
<br/>
Looks like there is a quiproco here :)
<br/>
I know how to build div tabs as my first post said, and I wanna reverse the operation, that is why it is a RECIPROCAL div tab.
<br/>
From the result of the division, i'd like to guess the denominator.
<br/>
My example was pretty clear thought, thanks anyway ;)
<br/>
<br/>
So how about the reciprocal stuff?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26361 - DekuTree64 - Mon Sep 13, 2004 6:52 pm</h4>
    <div class="postbody"><span class="postbody">Well, it's the same thing. If you go through doing table[x] = 65536/x, then like in your original post, table[106] = 618, and table[618] = 106. Both are true all the time, because the reciprocal of the reciprocal is the original number.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26365 - funkeejeffou - Mon Sep 13, 2004 7:40 pm</h4>
    <div class="postbody"><span class="postbody">Geez... Thanks DekuTree64, sometimes we try to complicate things as they do not need it.
<br/>
<br/>
I definitely should sleep more :)
<br/>
<br/>
Thanks again !
<br/>
<br/>
Cheers, Jeff.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26488 - keldon - Thu Sep 16, 2004 11:50 pm</h4>
    <div class="postbody"><span class="postbody">So in summary if I wish to build a table it needs <span style="font-weight: bold">bits^2</span> entries, and each entry <span style="font-weight: bold">recTable[f]= bits^2 / f</span>; and to divide by <span style="font-style: italic">f</span>, I would write a = num * recTable [f].
<br/>
<br/>
I tried it with 8; pretty neat, I didn't know that.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
