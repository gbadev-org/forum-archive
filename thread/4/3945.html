<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Loading Attached ROMs - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Coding > Loading Attached ROMs</h2>
<div id="posts">
<div class="post">
    <h4>#25452 - Krakken - Mon Aug 23, 2004 8:37 am</h4>
    <div class="postbody"><span class="postbody">I have a question regarding execution of a GBA game. Say for example, I have a ROM with a list of other roms that are attached to the main ROM (like a flash cart menu), how would I execute one of those attached ROMs from the main ROM and then later get back to the main ROM without reset?
<br/>
<br/>
Thanks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25453 - DKL - Mon Aug 23, 2004 9:24 am</h4>
    <div class="postbody"><span class="postbody">You mean other GBA roms ? Then the "simplest" way would be to link your
<br/>
overlay roms with a modified linker script, where rom base would be 
<br/>
0x8000000+(size_of_previous_roms) and stacks starting a little lower in memory to
<br/>
keep values for your main menu. To call them it would be basically just jumps at
<br/>
the right address, keeping sp at the right place. To come back, you need to jump
<br/>
to a part of the base rom code that will rebuild the menu, rebuild gfx, reset
<br/>
interrupt handler address, etc. based on values in the stack. You need the roms
<br/>
sources to relink them.
<br/>
<br/>
Flash carts are using memory mapping techniques, to make the roms think they are
<br/>
at 0x8000000. So they don't need to relink the roms. But if you intend to use 
<br/>
these techniques, you'll have the same problems as Pogoshell, incompatibilities
<br/>
between carts. Good luck ! :)
<br/>
<br/>
Why do you want to do this ?
<br/>
<br/>
DKL</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25457 - Krakken - Mon Aug 23, 2004 11:33 am</h4>
    <div class="postbody"><span class="postbody">I want to know for a number of reasons. Mainly so I can generally understand how it's done. It sparked my interest when tepples mentioned it for the new compo as a way of arranging the games.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25468 - tepples - Mon Aug 23, 2004 7:00 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>DKL wrote:</b></span></td> </tr> <tr> <td class="quote">You need the roms sources to relink them.</td> </tr></table><span class="postbody">
<br/>
Technically not; you need their object code.
<br/>
<br/>
This distinction matters because a proprietary program's object code may in a few cases be available to the owner of a Game Pak. See <a class="postlink" href="http://www.opensource.org/licenses/lgpl-license.php" target="_blank">LGPL subsection 6c</a>.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25469 - DKL - Mon Aug 23, 2004 7:16 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>DKL wrote:</b></span></td> </tr> <tr> <td class="quote">You need the roms sources to relink them.</td> </tr></table><span class="postbody">
<br/>
Technically not; you need their object code.
<br/>
<br/>
This distinction matters because a proprietary program's object code may in a few cases be available to the owner of a Game Pak. See <a class="postlink" href="http://www.opensource.org/licenses/lgpl-license.php" target="_blank">LGPL subsection 6c</a>.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Well, since anybody with a minimum programming experience know that, I didn't feel the need to make the distinction.
<br/>
<br/>
See <a class="postlink" href="http://www.amazon.com/exec/obidos/tg/detail/-/0764508350/104-9809931-9745510" target="_blank">BPFD</a> subsection 3.9b, third paragraph...  ;)
<br/>
<br/>
I'll choose my words next time... Thanks for your help.
<br/>
<br/>
Regards,
<br/>
DKL</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#67158 - Abscissa - Sun Jan 15, 2006 10:24 pm</h4>
    <div class="postbody"><span class="postbody">I realize I'm bringing this back from the dead, but I'm just starting to do this, and I'm looking for some more clarification and details.
<br/>
<br/>
Does that approach DKL explained above involve:
<br/>
<br/>
A. A separate call to the linker for each ROM (obviously adjusting the start address in the linker script each time), and then some way to combine the resulting ROMs into one? (Possibly with another call to the linker? Or maybe something with objcopy?)
<br/>
<br/>
-or-
<br/>
<br/>
B. Taking the *.o files from each compiled-but-not-linked project and linking them all together (involving fancier adjustments to the linker script)?
<br/>
<br/>
-or-
<br/>
<br/>
C. Something altogether different from A or B.<br/>_________________<br/><a class="postlink" href="http://blog.dev-scene.com/abscissa/" target="_blank">Useless Rants</a> a.k.a. My futile attempts at rationalizing my unreasonable reluctance to call my site a 'blog'.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#67211 - tepples - Mon Jan 16, 2006 6:40 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Abscissa wrote:</b></span></td> </tr> <tr> <td class="quote">I realize I'm bringing this back from the dead</td> </tr></table><span class="postbody">
<br/>
"It is always better to post in an existing topic than to start a new one" (<a class="postlink" href="http://www.albinoblacksheep.com/flash/posting.php" target="_blank"><span style="font-style: italic">Posting and You</span> (SWF)</a>). Full point for Abscissa.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Does that approach DKL explained above involve:
<br/>
<br/>
A. A separate call to the linker for each ROM (obviously adjusting the start address in the linker script each time)</td> </tr></table><span class="postbody">
<br/>
This would be the simplest solution.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">and then some way to combine the resulting ROMs into one?</td> </tr></table><span class="postbody">
<br/>
'padbin' (from GBFS) followed by either 'cat' or 'copy /b' should work nicely.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#67230 - Abscissa - Mon Jan 16, 2006 9:05 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">and then some way to combine the resulting ROMs into one?</td> </tr></table><span class="postbody">
<br/>
'padbin' (from GBFS) followed by either 'cat' or 'copy /b' should work nicely.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
So you're saying basically just append the *.gba files back-to-back with each other, header and all as-is?  And when the menu does a "jump" it should jump to the address just past the end of the desired appended ROM's GBA header?
<br/>
<br/>
Also, with "padbin" am I trying to allow the individual ROMS room to grow, or am I ensuring each ROM starts on a 32-bit boundary (or some other boundary)?<br/>_________________<br/><a class="postlink" href="http://blog.dev-scene.com/abscissa/" target="_blank">Useless Rants</a> a.k.a. My futile attempts at rationalizing my unreasonable reluctance to call my site a 'blog'.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#67279 - tepples - Mon Jan 16, 2006 6:22 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Abscissa wrote:</b></span></td> </tr> <tr> <td class="quote">So you're saying basically just append the *.gba files back-to-back with each other, header and all as-is?</td> </tr></table><span class="postbody">
<br/>
That will work if each .gba file has been properly relocated by its link script.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Also, with "padbin" am I trying to allow the individual ROMS room to grow</td> </tr></table><span class="postbody">
<br/>
Yes, so that you don't have to rewrite your link scripts every time you get a new build from the developers. Remember that physical ROM chips come in power-of-2 sizes, and if you're trying to make a multicart, then you don't have to worry much about wasting space until you're brushing up against a power-of-2 size.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">or am I ensuring each ROM starts on a 32-bit boundary (or some other boundary)?</td> </tr></table><span class="postbody">
<br/>
Some programs need to be aligned to specific boundaries. For instance, a program that uses appended GBFS needs its first GBFS file to be aligned to a 256-byte boundary because of a tradeoff in the linear search algorithm of find_first_gbfs_file().<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#67294 - Abscissa - Mon Jan 16, 2006 7:41 pm</h4>
    <div class="postbody"><span class="postbody">I see, thanks :)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Some programs need to be aligned to specific boundaries. For instance, a program that uses appended GBFS needs its first GBFS file to be aligned to a 256-byte boundary because of a tradeoff in the linear search algorithm of find_first_gbfs_file().</td> </tr></table><span class="postbody"> I'm not working with a ROM that uses GBFS, but out of curiosity: Ignoring the multi-rom menu stuff, does GBFS automatically ensure the start of the first GBFS file is on an appropriate boundary?<br/>_________________<br/><a class="postlink" href="http://blog.dev-scene.com/abscissa/" target="_blank">Useless Rants</a> a.k.a. My futile attempts at rationalizing my unreasonable reluctance to call my site a 'blog'.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#67296 - tepples - Mon Jan 16, 2006 8:00 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Abscissa wrote:</b></span></td> </tr> <tr> <td class="quote">out of curiosity: Ignoring the multi-rom menu stuff, does GBFS automatically ensure the start of the first GBFS file is on an appropriate boundary?</td> </tr></table><span class="postbody">
<br/>
If you include a 'padbin' line like in the GBFS example program's batch file, yes.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#67306 - Abscissa - Mon Jan 16, 2006 10:10 pm</h4>
    <div class="postbody"><span class="postbody">Yay, it's working for me :) ! Thanks again.<br/>_________________<br/><a class="postlink" href="http://blog.dev-scene.com/abscissa/" target="_blank">Useless Rants</a> a.k.a. My futile attempts at rationalizing my unreasonable reluctance to call my site a 'blog'.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
