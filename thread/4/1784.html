<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Coding fireballs - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Coding > Coding fireballs</h2>
<div id="posts">
<div class="post">
    <h4>#9074 - KoaM - Sun Jul 27, 2003 11:47 pm</h4>
    <div class="postbody"><span class="postbody">Hello,
<br/>
<br/>
I'm working on a simple shooter using C for the GBA. At the moment, I have a sprite for the spaceship and one for the fireblast. The fireblast is off the screen so it won't show. My question is, what would be the best way to code the fireblast when the player presses the "B" button for example?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9075 - Daikath - Mon Jul 28, 2003 12:22 am</h4>
    <div class="postbody"><span class="postbody">take a global variable and make it update once per screen by putting this into the wait for vblank function.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
if (globelvar2 = 2)
<br/>
{
<br/>
globelvar++;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Take a second global variable , declare it as 0 and do this.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">if (!(KEYS)&amp;(KEY_B)
<br/>
{
<br/>
     func();
<br/>
     globelvar2 = 1;
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
and then
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void func(void)
<br/>
{
<br/>
if (globalvar2 = 1)
<br/>
{    
<br/>
      blastcoorx = shipcoorx;  /*these are better off as global variables too unless there in the same function block but this is just an example.*/   
<br/>
<br/>
   globalvar = shipcoory + 2; /*or more to make it appear to appear to be shot from the front of the plane instead of the middle/*
<br/>
globalvar2 = 2;
<br/>
}
<br/>
blastcoory = globalvar;
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
untested code by a relative n00b but i dont see any reason why it shouldt work.<br/>_________________<br/>?There are no stupid questions but there are a LOT of inquisitive idiots.?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9078 - KoaM - Mon Jul 28, 2003 1:00 am</h4>
    <div class="postbody"><span class="postbody">Cool thanks, I'll test that out. Love you your sig btw.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9089 - Daikath - Mon Jul 28, 2003 11:45 am</h4>
    <div class="postbody"><span class="postbody">just foudn out it had to be == instead of = in the if parts, doh :).<br/>_________________<br/>?There are no stupid questions but there are a LOT of inquisitive idiots.?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9276 - KoaM - Thu Jul 31, 2003 8:44 pm</h4>
    <div class="postbody"><span class="postbody">Well, i got it to work, but when i try more than one fireball, i gets stuck in an endless loop. Here's what i have, notice anything wrong?
<br/>
<br/>
This is my code for when you shoot:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
if(!(*KEYS &amp; KEY_B))
<br/>
{
<br/>
   u16 loop;
<br/>
   u16 shoot;
<br/>
   shoot = 0;
<br/>
      while (shoot != 1){
<br/>
         for (loop=0; loop &lt; 10; loop++) 
<br/>
         {
<br/>
         if(blast[loop].active == 0) {
<br/>
         blast[loop].active = 1;
<br/>
         blast[loop].x = ship1.x;
<br/>
         if (ship1.y &gt; 16)
<br/>
            blast[loop].y = ship1.y - 16;
<br/>
         shoot == 1;   
<br/>
         }
<br/>
         }
<br/>
      }   
<br/>
   fireBlast();
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Here's the fireBlast code:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void fireBlast()
<br/>
{
<br/>
   u16 z;
<br/>
   for(z = 0; z &lt; 10; z++) {
<br/>
      if(blast[z].active == 1) {
<br/>
         if ((blast[z].y - 8) &gt; 0) {
<br/>
            blast[z].y -=  8;
<br/>
         }
<br/>
         else {
<br/>
            blast[z].y = 0;
<br/>
            blast[z].x = 240;
<br/>
            blast[z].active = 0;
<br/>
         }
<br/>
      MoveSprites(&amp;sprites[z+1],blast[z].x,blast[z].y);
<br/>
      }
<br/>
<br/>
   }
<br/>
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
Here's the struct definition for blast
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
typedef struct
<br/>
{
<br/>
   u16 x;         //x and y position on screen
<br/>
   u16 y;
<br/>
   u16 spriteFrame[1];     //animation frame storage
<br/>
   int activeFrame;        //which frame is active
<br/>
   u16 OAMSpriteNum;       //which sprite referring to
<br/>
   u8 active;
<br/>
}Sprite;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
And here's how it calls the feirBlast() function in my main()
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
while(1)
<br/>
{
<br/>
GetInput();
<br/>
MoveSprites(&amp;sprites[0],ship1.x,ship1.y);
<br/>
fireBlast();
<br/>
WaitForVsync();
<br/>
CopyOAM();
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9278 - mtg101 - Thu Jul 31, 2003 9:04 pm</h4>
    <div class="postbody"><span class="postbody">From a quick glance, I'm guessing the problem is with the first block of code - it's the only one with a while loop that might cause a problem.
<br/>
<br/>
A second glance made me wonder why there's a while loop there at all - why not use:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
if(!(*KEYS &amp; KEY_B))
<br/>
{
<br/>
   for (u16 loop=0; loop &lt; 10; loop++) 
<br/>
   {
<br/>
      if(blast[loop].active == 0)
<br/>
      {
<br/>
         blast[loop].active = 1; 
<br/>
         blast[loop].x = ship1.x; 
<br/>
         if (ship1.y &gt; 16) 
<br/>
            blast[loop].y = ship1.y - 16;
<br/>
         break;
<br/>
      } 
<br/>
   }
<br/>
   fireBlast(); 
<br/>
} 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
This way you can't get stuck in an infinite loop if blast[loop].active is never equal to 0.<br/>_________________<br/>---
<br/>
Speaker for the Dead</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9286 - KoaM - Fri Aug 01, 2003 12:19 am</h4>
    <div class="postbody"><span class="postbody">I guess i should explain this a bit. The way it works is that i have 10 "blasts" that are set off screen. Everytime someone shoots, i want just one of those fireblast to move right in front of the ship and scroll up until they reach the end of screen.
<br/>
<br/>
The problem is, when one shot is fired, the player can shoot again. He can shoot up to 10 shots. The reason the while is there is because i only want one fire blast to go at a time. If i don't have the while, all 10 would go off right away.
<br/>
<br/>
Maybe i'm going at this the wrong way. Is there an easier way to code multiple fire blasts? Can i create instances of "blast" dynamically instead?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9289 - tepples - Fri Aug 01, 2003 12:49 am</h4>
    <div class="postbody"><span class="postbody">Here's what I'd do: Make bullet and blast subtypes of a general type. Then turn a bullet into a blast when it hits something, and destroy it when the blast animation is over.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9297 - KoaM - Fri Aug 01, 2003 4:02 am</h4>
    <div class="postbody"><span class="postbody">See my problem lies in the fact that my ship can blast more than one shot at a time in other words, you'll see something like this:
<br/>
<br/>
<br/>
|  &gt; &gt; &gt; &gt; &gt;
<br/>
<br/>
Where  | is the ship and the &gt; are the blasts. There are more than one blast, i'm trying to figure out how to have more than one blast at a time.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9299 - tepples - Fri Aug 01, 2003 5:04 am</h4>
    <div class="postbody"><span class="postbody">ok, what you called "blasts" I called "bullets", and I assumed "blasts" were explosions when the bullets hit something.  I'll refer to them as "projectiles" to ease confusion.
<br/>
<br/>
Make an array of 10 projectiles, each a struct with live/dead state, animation phase, position, and velocity.  Then when searching for collisions, test each projectile against each enemy that it could hit.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9305 - mtg101 - Fri Aug 01, 2003 10:04 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>KoaM wrote:</b></span></td> </tr> <tr> <td class="quote">If i don't have the while, all 10 would go off right away.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
But using a while loop could cause the lock-up you're seeing.  If you just break from the loop, as my code above shows, you get the same effect but without the possibility of an infinite loop.<br/>_________________<br/>---
<br/>
Speaker for the Dead</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9316 - KoaM - Fri Aug 01, 2003 1:00 pm</h4>
    <div class="postbody"><span class="postbody">"ok, what you called "blasts" I called "bullets", and I assumed "blasts" were explosions when the bullets hit something. I'll refer to them as "projectiles" to ease confusion. 
<br/>
<br/>
Make an array of 10 projectiles, each a struct with live/dead state, animation phase, position, and velocity. Then when searching for collisions, test each projectile against each enemy that it could hit"
<br/>
<br/>
Sorry for the confusion, yes my blasts means your bullets.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9317 - KoaM - Fri Aug 01, 2003 1:03 pm</h4>
    <div class="postbody"><span class="postbody">mtg101: You sir, are the greatest man ever! 
<br/>
<br/>
Thank you all for your help and thanks for accepting my n00b skillz.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9342 - KoaM - Sat Aug 02, 2003 1:50 am</h4>
    <div class="postbody"><span class="postbody"><a href="http://www.iownjoo.com/freeimghost/koam/screenshot-D030801.gif">[Images not permitted - Click here to view it]</a>
<br/>
<br/>
:)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
