<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Pinball bumper help - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > Pinball bumper help</h2>
<div id="posts">
<div class="post">
    <h4>#46297 - LOst? - Wed Jun 22, 2005 8:39 pm</h4>
    <div class="postbody"><span class="postbody">I'm doing a pinball bumper. You know those things that shoot the pinball ball away (accelerating it of course to make it harder to control) and give you some score.
<br/>
<br/>
I have everything set for it. It detects the ball when it is inside the bumper's radius area.
<br/>
<br/>
My GBA game uses a Sine LUT with 256 as the maximum angle.
<br/>
It's really simple. I just thake the angle of the ball and the bumper and and run it through the Sine LUT, multiply it for a speed effect.
<br/>
<br/>
But the main problem is getting the angle between the ball and the bumper.
<br/>
<br/>
<span style="font-weight: bold">I need help understanding how to make up a LUT angle table. Maybe an example formula to puch me into the right direction would be great.</span>
<br/>
<br/>
The only thing I can think of is using <span style="font-weight: bold">ArcTan2</span>. But I think this can be done with only <span style="font-weight: bold">ArcTan</span>, or maybe just <span style="font-weight: bold">Tan</span>?
<br/>
<br/>
What's the difference between ActTan2 and ArcTan?
<br/>
Can you make a macro that converts ArcTan2 into ArcTan?
<br/>
<br/>
My main goal is to send in <span style="font-weight: bold">bumper_x - ball_x</span>, and <span style="font-weight: bold">bumper_y - ball_y</span> as arguments, and the return value will be the angle between <span style="font-weight: bold">0 and 255</span>.
<br/>
<br/>
How do I make a formula that can make up a LUT table with these angles? What will I use when I make up the LUT? ArcTan2, ArcTan, or Tan? And how do I convert the LUT so it uses the angles 0 to 255 instead of 0 to 360 or 0 to 2pi? 
<br/>
<br/>
<br/>
Thank you if you can help me, I would appreciate it :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46311 - MrD - Wed Jun 22, 2005 11:26 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">What's the difference between ActTan2 and ArcTan?
<br/>
Can you make a macro that converts ArcTan2 into ArcTan?</td> </tr></table><span class="postbody">
<br/>
<br/>
ArcTan2 is an inverse tan function which takes an X distance and a Y distance between 1 and -1 and returns the angle counterclockwise from horizontally right. (<a class="postlink" href="http://babbage.clarku.edu/~djoyce/java/trig/tangents.html" target="_blank">This probably makes more sense!</a>)
<br/>
<br/>
ArcTan returns the same angle, except this time the parameter is Y divided by X. (Or in other words, the gradient of the line. ArcTan returns the angle counterclockwise from horizontal to this line)
<br/>
<br/>
Example: ArcTan 1 (Gradient of 1 is a 'diagonal' line) is 45 degrees. (Or pi/4 radians)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">My main goal is to send in bumper_x - ball_x, and bumper_y - ball_y as arguments, and the return value will be the angle between 0 and 255. But the main problem is getting the angle between the ball and the bumper.</td> </tr></table><span class="postbody">
<br/>
<br/>
I'm assuming you mean a circular bumper... so it looks like you need an inverse tan LUT... (To take the angle between bumper and ball to be able to use sin and cos later) but an inverse tan LUT would require the y value divided by the x value, so I'm sure how fast querying an inverse tan LUT would be. The function you could use is BIOS SWI 10 (0Ah) - ArcTan2.
<br/>
<br/>
Here's another note against an inverse tan LUT: Taking the tan of an angle results the gradient, a value between -infinity and +infinity. Therefore the inverse tan LUT would need to cover the same range. I dunno how you'd do that, I'm probably wrong anyway, somebody prove me wrong!
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">The only thing I can think of is using ArcTan2. But I think this can be done with only ArcTan, or maybe just Tan?</td> </tr></table><span class="postbody">
<br/>
<br/>
If you're doing a bumper which deflects the ball away from the bumper at exactly the same angle as it's approached from, consider solutions not involving angles, but instead simply waiting for the ball to come within the bumpers radius and (if your simulation's time-step is small enough) try simply adding a multiple of the X and Y distances away from the bumper to the speed.
<br/>
<br/>
(It's a late night explanation... I apologize if this is incorrect, confusing and doesn't make any sense to anyone... ._.)<br/>_________________<br/>Not active on this forum. For Lemmings DS help see its website.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46314 - Miked0801 - Wed Jun 22, 2005 11:52 pm</h4>
    <div class="postbody"><span class="postbody">You can do it without angles if you wish as well - and it may be faster yet.
<br/>
<br/>
At collision, create a vector from the center of the ball to the center of the bumper.  This is your base acceleration vector.  Turn it into a unit if you want,  or leave it alone and have it push harder as the radius between them decrease (or sq of radius for true gravity) If you want an anti-gravity sort of effect, add this to the ball each tic.  For a bumber that hits and pushes, you need to do a reflection and an acceleration.
<br/>
<br/>
The same accel vector is also the normal vector for a reflection, though I can't recall the equation for actual reflection at the moment.
<br/>
<br/>
Just another idea.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46373 - LOst? - Thu Jun 23, 2005 8:16 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>MrD wrote:</b></span></td> </tr> <tr> <td class="quote">ArcTan returns the same angle, except this time the parameter is Y divided by X. (Or in other words, the gradient of the line. ArcTan returns the angle counterclockwise from horizontal to this line)
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Yes, this is the code I have been wondering about all the time. Look here, the table just have to be ArcTan:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
unsigned char return_angle (short x, short y)
<br/>
{
<br/>
   short tmp_x = x;
<br/>
   short tmp_y = y;
<br/>
   unsigned long divu = 0;
<br/>
   unsigned short angle = 0;
<br/>
<br/>
   if ((tmp_y &amp; tmp_x) == 0)
<br/>
   {
<br/>
      return 0x40;
<br/>
   }
<br/>
<br/>
   if (tmp_x &lt; 0)
<br/>
      tmp_x = -tmp_x;
<br/>
<br/>
   if (tmp_y &lt; 0)
<br/>
      tmp_y = -tmp_y;
<br/>
<br/>
<br/>
<br/>
   if (tmp_x &lt; tmp_y)
<br/>
   {
<br/>
      divu = (tmp_y &lt;&lt; 8);
<br/>
      divu /= (unsigned long) tmp_x;
<br/>
      
<br/>
      angle = (unsigned short) ANGLE_TABLE [divu];
<br/>
   }
<br/>
   else
<br/>
   {
<br/>
      divu = (tmp_x &lt;&lt; 8);
<br/>
      divu /= (unsigned long) tmp_y;
<br/>
      
<br/>
      angle = 0x40;
<br/>
      angle -= (unsigned short) ANGLE_TABLE [divu];
<br/>
   }
<br/>
<br/>
<br/>
   if (x &lt; 0)
<br/>
   {
<br/>
      angle = -angle;
<br/>
      angle += 0x80;
<br/>
   }
<br/>
<br/>
   if (y &lt; 0)
<br/>
   {
<br/>
      angle = -angle;
<br/>
      angle += 0x100;
<br/>
   }
<br/>
<br/>
   return (unsigned char) angle;
<br/>
}
<br/>
<br/>
unsigned char ANGLE_TABLE [258] = 
<br/>
{
<br/>
   0x00, 0x00, 0x00, 0x00, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 
<br/>
   0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x05, 0x05, 0x05, 
<br/>
   0x05, 0x05, 0x05, 0x06, 0x06, 0x06, 0x06, 0x06, 0x06, 0x06, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 
<br/>
   0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x0A, 0x0A, 0x0A, 
<br/>
   0x0A, 0x0A, 0x0A, 0x0A, 0x0B, 0x0B, 0x0B, 0x0B, 0x0B, 0x0B, 0x0B, 0x0C, 0x0C, 0x0C, 0x0C, 0x0C, 
<br/>
   0x0C, 0x0C, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0E, 0x0E, 0x0E, 0x0E, 0x0E, 0x0E, 0x0E, 
<br/>
   0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x11, 0x11, 
<br/>
   0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x13, 0x13, 0x13, 
<br/>
   0x13, 0x13, 0x13, 0x13, 0x13, 0x14, 0x14, 0x14, 0x14, 0x14, 0x14, 0x14, 0x14, 0x15, 0x15, 0x15, 
<br/>
   0x15, 0x15, 0x15, 0x15, 0x15, 0x15, 0x16, 0x16, 0x16, 0x16, 0x16, 0x16, 0x16, 0x16, 0x17, 0x17, 
<br/>
   0x17, 0x17, 0x17, 0x17, 0x17, 0x17, 0x17, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 
<br/>
   0x19, 0x19, 0x19, 0x19, 0x19, 0x19, 0x19, 0x19, 0x19, 0x19, 0x1A, 0x1A, 0x1A, 0x1A, 0x1A, 0x1A, 
<br/>
   0x1A, 0x1A, 0x1A, 0x1B, 0x1B, 0x1B, 0x1B, 0x1B, 0x1B, 0x1B, 0x1B, 0x1B, 0x1B, 0x1C, 0x1C, 0x1C, 
<br/>
   0x1C, 0x1C, 0x1C, 0x1C, 0x1C, 0x1C, 0x1C, 0x1C, 0x1D, 0x1D, 0x1D, 0x1D, 0x1D, 0x1D, 0x1D, 0x1D, 
<br/>
   0x1D, 0x1D, 0x1D, 0x1E, 0x1E, 0x1E, 0x1E, 0x1E, 0x1E, 0x1E, 0x1E, 0x1E, 0x1E, 0x1E, 0x1F, 0x1F, 
<br/>
   0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 
<br/>
   0x20, 0x00
<br/>
};
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
The big question is, how do I make that ANGLE_TABLE up from a formula? It is ArcTan right?
<br/>
Anyone really good at math that can figure out a formula for making up this LUT table? (doesn't need to be completely exact because this was handwritten and that's why I don't know the formula. Someone else did the work a long time ago).
<br/>
I will probably use ArcTan2 with GBA, but I really want to know how to figure out this LUT table and how to make it in realtime. Please anyone?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46438 - LOst? - Fri Jun 24, 2005 7:28 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Miked0801 wrote:</b></span></td> </tr> <tr> <td class="quote">You can do it without angles if you wish as well - and it may be faster yet.</td> </tr></table><span class="postbody">
<br/>
<br/>
Yea I know that, but the effect is will be very bad. If you have a playable ball that you can move with the direction keys, you can't predict where you will land because the collision reaction will not throw you in exact angle.
<br/>
<br/>
I appriciate your help though. I will use this collision methods for breakable bumpers.
<br/>
<br/>
But my method I poster above is the one I want to use. I know the result of it. I just want to know the math for making up the table.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46444 - Miked0801 - Fri Jun 24, 2005 10:18 pm</h4>
    <div class="postbody"><span class="postbody">Huh?  You hit a round bumber that smacks you, it pushes you on the tangent of the collide spot which is the vector connecting the 2 centers.  The velocity itself is the reflection around that collision.  How is that now accurate?  In truth, vectors will be more accurate as you don't need worry about sin/cos atan2  round off issues.  Or am I missing something?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46450 - merodia - Sat Jun 25, 2005 1:11 am</h4>
    <div class="postbody"><span class="postbody">wouldn't it perhaps be alot easier and use good old anayltical geometry and calculus and determine a slope of the ball. You then increment it by a x distance and y distance, which is pre-determined by the slope.
<br/>
This way the only thing you have to do for the ball to bounce the other way is invert the x (multiply by -1) or the invert the y.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46587 - Miked0801 - Mon Jun 27, 2005 6:49 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
This way the only thing you have to do for the ball to bounce the other way is invert the x (multiply by -1) or the invert the y.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
No.  This only works if the surface you care colliding with is axis bound.  For any other collision, you have to do a reflection calculation for it to work correctly.  The negate the correct term method is derived from the reflection code when the surface tangent unit vector is aligned - that is equal it either (1,0), (0,1), (-1,0), or (0,-1).
<br/>
<br/>
Proof:  A ball moving with a velocity of (10, 0) (moving due right) hits a wall that is at an angle of 45 degrees with respect the the moving velocity.  Physics state that for a true reflection, angle of insidence equals angle of reflection along the wall normal (the forward slashes below.)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   \
<br/>
    \
<br/>
-----\
<br/>
    /|\
<br/>
   / | \
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Here the final velocity is (0, 10) which cannot be derived from jsut negating velocity terms.
<br/>
<br/>
The above problem can be solved with geometry/trig (sin/cos/angle work) or linear algerbra (unit vector with a dot-product.)  Computers processors just have an easier time with vectors - no look-ups, no round off, just multiplies, adds, and subtracts (with a divide/sqrt for unit if you don't have it :P)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#47615 - batblaster - Mon Jul 11, 2005 12:44 pm</h4>
    <div class="postbody"><span class="postbody">Hi Miked0801,
<br/>
<br/>
is possible for you to make an example on how to use verctor reflection ??/ i love the pinball game but i never understand how i can try to write 1 for the problem of the rebound... If you have time and can help me i'm happy...
<br/>
<br/>
Thanks a lot...
<br/>
<br/>
Cu...<br/>_________________<br/>Batblaster / 7 Raven Studios Co. Ltd
<br/>
------------------------------------------</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#47663 - Miked0801 - Tue Jul 12, 2005 1:49 am</h4>
    <div class="postbody"><span class="postbody">I'm in the middle of an Alpha Beta Final march this month at work.  As soon as that's complete, I'll go figure out the formula again.  Give me a couple weeks.  Right now, I scan the boards once a day and answer easier problems when possible :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#47730 - Mucca - Tue Jul 12, 2005 9:03 pm</h4>
    <div class="postbody"><span class="postbody">Crunch time eh?
<br/>
<br/>
Not for me :)  I just had my first ever game lot-check approved today. Weeeeee :-)  Only three months to roll out the next one though :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#47732 - Miked0801 - Tue Jul 12, 2005 10:04 pm</h4>
    <div class="postbody"><span class="postbody">Crunching away :)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
