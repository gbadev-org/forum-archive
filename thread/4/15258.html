<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>GC/GBA communication using Joybus. - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Coding > GC/GBA communication using Joybus.</h2>
<div id="posts">
<div class="post">
    <h4>#153046 - thoduv - Mon Mar 24, 2008 4:14 pm</h4>
    <div class="postbody"><span class="postbody">Hello,
<br/>
<br/>
I'm currently trying to make my Wii and my GBA to communicate via GC/GBA link cable.
<br/>
<br/>
On the Wii side, I'm doing simple polls to retrieve the GBA device type:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">SI_GetType(1); // (gba is plugged on port 1, there's no mistake here :D )</td> </tr></table><span class="postbody">
<br/>
<br/>
On the GBA side, I set the GBA in Joybus mode, enable serial interrupt, but nothing happens: I don't receive any reset-command from the GC, and the serial irq never occurs.
<br/>
I've tried other things, such as polling REG_JOYRE, ack'ing bits in REG_JOYCNT, etc.
<br/>
Register JOYSTAT stays set on 0x0008 (bit 4 set: "GBA is sending", though I didn't send anything).
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
REG_RCNT = R_JOYBUS;
<br/>
REG_JOYCNT = (1 &lt;&lt; 6); // enable irq
<br/>
irqSet(IRQ_SERIAL, Serial_Event);
<br/>
irqEnable(IRQ_SERIAL);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Has anyone once managed to get this joybus mode to work ?
<br/>
Thanks !</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153054 - Maximus32 - Mon Mar 24, 2008 4:46 pm</h4>
    <div class="postbody"><span class="postbody">Have you initialized interrupts on the gba?
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">irqInit();</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153056 - thoduv - Mon Mar 24, 2008 5:02 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Maximus32 wrote:</b></span></td> </tr> <tr> <td class="quote">Have you initialized interrupts on the gba?
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">irqInit();</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
Yes, and vblank/timer irq works.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153106 - eKid - Tue Mar 25, 2008 12:50 am</h4>
    <div class="postbody"><span class="postbody">Does SI_GetType(1) send a reset command? Also, gbatek says (for JOYSTAT)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>GBATEK wrote:</b></span></td> </tr> <tr> <td class="quote">Bit 3 is automatically reset when reading from local JOY_RECV.
<br/>
</td> </tr></table><span class="postbody">
<br/>
Bit3 means there's a transfer in progress, or a transfer has finished. Read the data from JOY_RECV. :P
<br/>
<br/>
Notice the keyword in the description for bit3 in JOYSTAT:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">3     Send Status Flag      (1=Remote GBA is/was sending)   (Read Only?)
<br/>
</td> </tr></table><span class="postbody">
<br/>
I guess the "remote gba" is actually the gamecube.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153122 - Maximus32 - Tue Mar 25, 2008 9:07 am</h4>
    <div class="postbody"><span class="postbody">Done some experimenting here with the same results. The flag indicates data is/was received from GameCube/Wii (even if the connector is not plugged in). Reading the data from JOY_RECV has no effect, the data read is always 0, and the flag remains high.
<br/>
<br/>
Perhaps the bits are only valid when both sides have set up joybus mode? What mode is the GameCube/Wii in? And does libogc support joybus? The gba can be set up in 5 different modes but I can't find anything on how to set up the GameCube/Wii?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153129 - eKid - Tue Mar 25, 2008 1:04 pm</h4>
    <div class="postbody"><span class="postbody">There's also bits in JOYCNT that tells you if receiving/sending data was actually completed.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153150 - thoduv - Tue Mar 25, 2008 6:51 pm</h4>
    <div class="postbody"><span class="postbody">Gamecube controller port are joybus-only port, and the SI module of libogc communicate with joybus devices such as gamecube controller.
<br/>
As for SI_GetType(1), I think it send a reset command, because the slave must answer its type to a reset command, but I can't figure it, since I can't understand the SI source from libogc.
<br/>
I'll do experiments with the "raw" SIO mode on GBA, to see if anything comes from the Gamecube.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153173 - tepples - Wed Mar 26, 2008 12:09 am</h4>
    <div class="postbody"><span class="postbody">I tried the raw SIO once. I was able to see requests from the GameCube, but I couldn't figure out the timing for replying. Maybe it's because I have no access to a logic analyzer.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153764 - bluesceada - Sat Apr 05, 2008 6:49 pm</h4>
    <div class="postbody"><span class="postbody">You have to get down to 1us ... quite hard or impossible with 16mhz, programmed in C 
<br/>
<br/>
Do you already know this?:
<br/>
<a href="http://www.int03.co.uk/crema/hardware/gamecube/gc-control.htm" target="_blank">http://www.int03.co.uk/crema/hardware/gamecube/gc-control.htm</a>
<br/>
<br/>
and I would try general purpose mode of the gba link port, I heard that in Joybus mode some things are automatized... and not all is known about it</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#153896 - tepples - Tue Apr 08, 2008 12:49 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>bluesceada wrote:</b></span></td> </tr> <tr> <td class="quote">You have to get down to 1us ... quite hard or impossible with 16mhz, programmed in C</td> </tr></table><span class="postbody">
<br/>
If I had a logic analyzer, I'd be counting cycles in assembly language.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Do you already know this?:
<br/>
<a href="http://www.int03.co.uk/crema/hardware/gamecube/gc-control.htm" target="_blank">http://www.int03.co.uk/crema/hardware/gamecube/gc-control.htm</a></td> </tr></table><span class="postbody">
<br/>
Yes, that's one of the documents I read.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">and I would try general purpose mode of the gba link port</td> </tr></table><span class="postbody">
<br/>
I was using general purpose. That's what I meant by "the raw SIO".<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
