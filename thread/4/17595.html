<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>LZMA vs Apack - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > LZMA vs Apack</h2>
<div id="posts">
<div class="post">
    <h4>#176679 - Dwedit - Wed Sep 14, 2011 1:11 am</h4>
    <div class="postbody"><span class="postbody">So I just built a version of the LZMA decompressor for the GBA.  I did the basic optimizations necessary for the GBA, moved the main decompression loop into IWRAM using ARM code, etc.
<br/>
LZMA decompressed data at 100KB/sec.
<br/>
<br/>
Then I tested it against Apack.  I had already written ASM-optimized code for decompressing it.
<br/>
Apack decompressed data at about 700KB/sec.
<br/>
<br/>
LZMA is the mighty compression system used by 7-zip, it compressed my 128k test file down to 46,869 bytes.
<br/>
Apack got it down to 50,245 bytes.  (For comparison, gzip only got it down to 51,814 bytes)
<br/>
So they both look pretty good here.  LZMA wins the compression challenge, and Apack wins the speed challenge.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176680 - Miked0801 - Wed Sep 14, 2011 4:28 am</h4>
    <div class="postbody"><span class="postbody">Give PUCrunch a try.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176681 - Dwedit - Wed Sep 14, 2011 5:12 am</h4>
    <div class="postbody"><span class="postbody">Pucrunch is very similar to Apack in that it's a LZ compressor with variable-bit-length codes to indicate where the runs are.
<br/>
<br/>
But Apack is better-designed than Pucrunch.  For example, the two algorithms use a different method to read bits and bytes from the input.  In Pucrunch, it always reads a single bit at a time, no matter what.  If it needs 8 bits, it reads 8 bits from the input stream.  But Apack always reads 8-bit literals as aligned bytes.  So it can get bits out of a small one-byte buffer, then read literal bytes from the input stream when it needs them.
<br/>
<br/>
This gives Apack a speed advantage when decompressing.
<br/>
<br/>
I'm a little confused about Apack's license, currently it's "Freeware, even for commercial use", but it used to be something else.
<br/>
<br/>
On my test file, Pucrunch got the size down to 52,409 bytes (vs 50,245 for Apack).
<br/>
<br/>
I think it's possible to improve Pucrunch to use the aligned byte-read convention, that would speed it up a bit.
<br/>
<br/>
But I still think LZMA wins over all.  Except of course for those really really crazy and impractical algorithms, like PAQ8a.
<br/>
<br/>
I also once made a silly LZ compression system based on 32-bit aligned words.  It had a literal count, literals, followed by a backreference and length, then back to literal count, literals...  Everything is 32-bit values, and everything is aligned to 32-bit offsets.  So decompression is almost as fast as memcpy.  Compression rate wasn't that great, but it sure was fast to decompress.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176689 - wintermute - Wed Sep 14, 2011 10:45 am</h4>
    <div class="postbody"><span class="postbody">I've had trouble with PUcrunch not decompressing correctly with some files which might be a bug in the code. I was using Jeff Frohwein's code for that &amp; I'm not sufficiently familiar with pucrunch to fix it.
<br/>
<br/>
I got some reasonably good results with Exomizer from <a href="http://hem.bredband.net/magli143/exo/" target="_blank">http://hem.bredband.net/magli143/exo/</a> but the project I was using it for needed it to be small, not necessarily fast.
<br/>
<br/>
Sadly there's no source or OSX version of the compressor for OSX so I didn't bother looking at Apack further.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176693 - Miked0801 - Wed Sep 14, 2011 4:53 pm</h4>
    <div class="postbody"><span class="postbody">Not denying that PU is slow, but with proper care and feeding (and intelligent conversion to ARM) it runs pretty good.  I think I'll have to check out Apack though.  I haven't played with compression for a bit and that could be something fun to do in my spare time.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#176694 - Dwedit - Wed Sep 14, 2011 6:36 pm</h4>
    <div class="postbody"><span class="postbody">Just tried out Exomizer, Apack beat it by 359 bytes.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
