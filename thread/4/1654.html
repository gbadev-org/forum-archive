<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Implementing a FadeOut/FadeIn - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Coding > Implementing a FadeOut/FadeIn</h2>
<div id="posts">
<div class="post">
    <h4>#8416 - jcpredator - Thu Jul 10, 2003 12:07 am</h4>
    <div class="postbody"><span class="postbody">I am trying to implement a fadeout from my titlescreen to just a black plain.  At the moment nothing happens and the titlescreen is displayed with no fading in or out.  I will include my code below:
<br/>
<br/>
From gamemode.c (the file that is responsible from switching from pregame mode to the real game)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">void gamemode_fadeOut(void)
<br/>
{
<br/>
	SetBlendMode(BD_TARGET | MODE3 | BG3_START);
<br/>
	SetColY(0x10);
<br/>
}
<br/>
<br/>
void gamemode_enter(void)
<br/>
{
<br/>
	gamemode_fadeOut();
<br/>
	while(1);
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
From my fades.c (file that contains register BLDMOD defines)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">#define REG_BLDMOD *(volatile word*)0x04000050
<br/>
#define REG_COLY *(volatile word*)0x04000054
<br/>
<br/>
#define BG0_TARGET 0x1
<br/>
#define BG1_TARGET 0x2
<br/>
#define BG2_TARGET 0x4
<br/>
#define BG3_TARGET 0x8
<br/>
#define OBJ_TARGET 0x10
<br/>
#define BD_TARGET 0x20
<br/>
#define MODE0 0x00
<br/>
#define MODE1 0x40
<br/>
#define MODE2 0x80
<br/>
#define MODE3 0x100
<br/>
#define BG0_START 0x200
<br/>
#define BG1_START 0x400
<br/>
#define BG2_START 0x800
<br/>
#define BG3_START 0x1000
<br/>
#define OBJ_START 0x2000
<br/>
#define BD_START 0x4000
<br/>
<br/>
#define SetBlendMode(mode) REG_BLDMOD = (mode)
<br/>
<br/>
#define SetColY(factor) REG_COLY = (factor)</td> </tr></table><span class="postbody">
<br/>
<br/>
This is my first try at implementing a fade in/out.  Thanks in advance for your help.
<br/>
<br/>
-Jc-<br/>_________________<br/>There is no spoon...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8417 - tepples - Thu Jul 10, 2003 1:03 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>jcpredator wrote:</b></span></td> </tr> <tr> <td class="quote">I am trying to implement a fadeout from my titlescreen to just a black plain.  At the moment nothing happens and the titlescreen is displayed with no fading in or out.
<br/>
<br/>
void gamemode_fadeOut(void)
<br/>
{
<br/>
	SetBlendMode(BD_TARGET | MODE3 | BG3_START);
<br/>
	SetColY(0x10);
<br/>
}</td> </tr></table><span class="postbody">
<br/>
That's your problem. You have to slowly ramp up (or down) the value passed to SetColY().<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8470 - jcpredator - Fri Jul 11, 2003 1:24 pm</h4>
    <div class="postbody"><span class="postbody">How might I slowly ramp down or up the value?  Tried using a for loop but all i got was the same problem of it not showing up at all.<br/>_________________<br/>There is no spoon...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8473 - tepples - Fri Jul 11, 2003 4:06 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>jcpredator wrote:</b></span></td> </tr> <tr> <td class="quote">How might I slowly ramp down or up the value?</td> </tr></table><span class="postbody">
<br/>
You might be ramping it up or down too fast. You have to wait for vblank after each increment.
<br/>
<br/>
Another possibility is that you're not enabling the effect properly.  Try setting it to halfway (0x08) and leaving it there; if it doesn't show up, then either you're not setting the registers properly to enable the effect, or you've turned off transparency effects in your emulator.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8526 - jcpredator - Sun Jul 13, 2003 1:36 am</h4>
    <div class="postbody"><span class="postbody">Thanks again tepples, still not showing the fade out effect after I tried setting it halfway at 0x08.  Im using VisualBoyAdvance, wondering if you or anybody else knows how to make sure you have transparency effects enabled.<br/>_________________<br/>There is no spoon...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8564 - MayFly - Mon Jul 14, 2003 7:31 pm</h4>
    <div class="postbody"><span class="postbody">Hi jcpredator,
<br/>
<br/>
Here is the function I use to create a fade out effect. 
<br/>
<br/>
This function requires that a global variable global_frame_count is accessible. This global_frame_count (cast as a 32-bit integer) counts how many VBLANKs have occurred since the program started execution. 
<br/>
<br/>
The global_frame_count should be incremented in a VBLANK interrupt routine.  Each VBLANK occurs approximately 1/60 seconds.  Using a delta value of 5 should give you a nice result. 
<br/>
<br/>
Using this global_frame_count variable is one way to control the timing of your fading leaving the machine's timers alone.
<br/>
<br/>
Hope this helps.
<br/>
<br/>
Regards,
<br/>
MayFly 
<br/>
<br/>
/********************************************************************/
<br/>
// The background fades to black, the delta parameter specifies 
<br/>
// how many frames the REG_COLY will stay at a constant value 
<br/>
void FadeOut( u16 delta )
<br/>
{
<br/>
	// Setting the Reg for neato fading effect
<br/>
	REG_BLDMOD = 0x1FDF;
<br/>
<br/>
	u16 loop;
<br/>
	u32 fade_out_frame_count = 0;
<br/>
<br/>
		// The GBA has 16 levels of darkness/lightness
<br/>
		for( loop = 0; loop &lt; 17; ++loop )
<br/>
		{
<br/>
			fade_out_frame_count = global_frame_count + delta;
<br/>
<br/>
			REG_COLY = loop;
<br/>
<br/>
			while( fade_out_frame_count &gt; global_frame_count )
<br/>
			{
<br/>
			// wait.
<br/>
			}
<br/>
<br/>
		}
<br/>
}</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8580 - jcpredator - Tue Jul 15, 2003 1:08 pm</h4>
    <div class="postbody"><span class="postbody">Thanks MayFly, I now have a working fadeout/in function.  Looks really cool by the way.  Greatly appreciate the help.<br/>_________________<br/>There is no spoon...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8581 - MayFly - Tue Jul 15, 2003 3:05 pm</h4>
    <div class="postbody"><span class="postbody">My pleasure. 
<br/>
<br/>
I've been down the fade in/out road you're on, I felt your frustration/struggle.
<br/>
<br/>
MayFly</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
