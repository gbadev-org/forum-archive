<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>How to have Many Large Sprites - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > How to have Many Large Sprites</h2>
<div id="posts">
<div class="post">
    <h4>#111384 - KertDawg - Wed Dec 06, 2006 3:16 am</h4>
    <div class="postbody"><span class="postbody">Hello!
<br/>
<br/>
I have a 32x32 sprite for which there are over 32 frames.  They're 256-color sprites.  That makes 512 cells.  From what I understand, I'm out of room if I want to add additional sprites.
<br/>
<br/>
Is there any way to show more than this number of 256-color sprites?
<br/>
<br/>
The options that I can think of are: 1.) convert them to 16-color.  This might not be easy, though.  2.) DMA copy frames in before they're needed.  I can have frames for, say, the sprite to face a certain direction.  I can DMA copy the sprites for a new direction when the sprite turns.  Will DMA be fast enough to copy 8 32x32 frames into place?
<br/>
<br/>
I will experiment.  I'm hoping that somebody will have a clever trick that might make things a little easier.  Thanks for any replies!<br/>_________________<br/>- Kertis</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111386 - tepples - Wed Dec 06, 2006 4:09 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>KertDawg wrote:</b></span></td> </tr> <tr> <td class="quote">The options that I can think of are: 1.) convert them to 16-color.  This might not be easy, though.</td> </tr></table><span class="postbody">
<br/>
Many professional games use 16 color sprites. If they don't look good, hand-retouch them.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">2.) DMA copy frames in before they're needed.  I can have frames for, say, the sprite to face a certain direction.  I can DMA copy the sprites for a new direction when the sprite turns.  Will DMA be fast enough to copy 8 32x32 frames into place?</td> </tr></table><span class="postbody">
<br/>
<a class="postlink" href="http://www.pineight.com/gba/managing-sprite-vram.txt" target="_blank">Of course it's fast enough</a>.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111404 - Dwedit - Wed Dec 06, 2006 8:22 am</h4>
    <div class="postbody"><span class="postbody">I think that Vblank is long enough to overwrite the entirety of vram about 5 times, unless I calculated wrong.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111407 - Ant6n - Wed Dec 06, 2006 8:40 am</h4>
    <div class="postbody"><span class="postbody">vblank: 83776 cycles
<br/>
time to copy 16bit from overclocked ewram to vram: ~2 cycles (time is ~3 cycles for 32bit from iwram).
<br/>
--&gt; makes ~80000 bytes you can copy during vblank.
<br/>
now that is not the entire vram, which is 96 KB, but sprite memory is only 32 KB (or 16 KB in bmp modes), so you can copy more than once, and it is probably save to assume that you could update all sprites even from rom assuming you have fast copy routines.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111441 - Miked0801 - Wed Dec 06, 2006 5:04 pm</h4>
    <div class="postbody"><span class="postbody">With double-buffering, you have enough time to decompress individual sprite frames and load them whenever, then update only the OAM during VBlank.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111450 - gmiller - Wed Dec 06, 2006 5:58 pm</h4>
    <div class="postbody"><span class="postbody">Although this is not hardware double buffering and if you have a lot of active sprite image data then you might still have to copy the data during vblank rather than change an index in OAM.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111520 - Dwedit - Thu Dec 07, 2006 6:03 am</h4>
    <div class="postbody"><span class="postbody">Use a cache for VRAM so you don't always need to recopy.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111524 - Ant6n - Thu Dec 07, 2006 7:58 am</h4>
    <div class="postbody"><span class="postbody">I would advise against caching sprites. There is so little memory on gba, and copying is really fast. Even if one has 32 animated sprites running at 20 fps, one can still safely copy from rom, if a couple of animations are offset from the others by a frame.
<br/>
I am actually in the process of writing a little library that tries to organize sprites and vram and provides functions to handle resources in a more abstract way. not very easy to do, the engineering part is harder than the programming.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111549 - tepples - Thu Dec 07, 2006 5:04 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ant6n wrote:</b></span></td> </tr> <tr> <td class="quote">I would advise against caching sprites. There is so little memory on gba, and copying is really fast.</td> </tr></table><span class="postbody">
<br/>
Is copying still really fast if the sprite cels are compressed in the ROM?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111556 - poslundc - Thu Dec 07, 2006 5:56 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Is copying still really fast if the sprite cels are compressed in the ROM?</td> </tr></table><span class="postbody">
<br/>
<br/>
It's even faster, but the data you copy is a whole lot less visually appealing. ;-)
<br/>
<br/>
If you need to compress your data, I recommend a scheme such as the one Mike was suggesting where you double-buffer in VRAM, and can therefore safely decompress a frame into VRAM during the VDraw period before displaying it in VBlank. Of course, the penalty to this method is you have less active VRAM available, and the GBA's 32K already isn't huge.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111561 - Ant6n - Thu Dec 07, 2006 6:58 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ant6n wrote:</b></span></td> </tr> <tr> <td class="quote">I would advise against caching sprites. There is so little memory on gba, and copying is really fast.</td> </tr></table><span class="postbody">
<br/>
Is copying still really fast if the sprite cels are compressed in the ROM?</span></td> </tr></table><span class="postbody">
<br/>
mmh, not sure. But I wonder which compression one would use.
<br/>
But then again, if one changes the full 32 kB of sprite tile ram 20 times per second, that would be 640 KB of data to cache.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111564 - Dwedit - Thu Dec 07, 2006 7:18 pm</h4>
    <div class="postbody"><span class="postbody">You don't cache all of it, you just refuse to recopy what's already in sprite vram.  If you use the full sprite vram, there would be quite a few updates before the old data gets overwritten.  Not copying tiles is still faster than copying them.<br/>_________________<br/>"We are merely sprites that dance at the beck and call of our button pressing overlord."</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111567 - Miked0801 - Thu Dec 07, 2006 8:00 pm</h4>
    <div class="postbody"><span class="postbody">Many older, lossless compression routines work very well.  LZ77, RLE, and check out PUCrunch (an old C64 compressor) which rivals ZIP on smaller files.  All the above also decompress fairly qucikly as well.  If one needs compression that is.
<br/>
<br/>
If not, you could allocate 1 buffer in VRAM that fits your entire sprite (if it doesn't change in size much) and then just copy from ROM into the same area (and update the OAM if the sprite sizes change).  This works well too.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111897 - KertDawg - Mon Dec 11, 2006 3:45 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for all the replies.  The solution that I used was to DMA copy the sprites that I need every time the animation loop changes.  Since it's a 32x32 sprite with 8 frames in a loop, the amount of data is small.  I'm doing the copy during vblank, and it works very well.
<br/>
<br/>
Thanks again for the replies.<br/>_________________<br/>- Kertis</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#111905 - Ant6n - Mon Dec 11, 2006 5:05 pm</h4>
    <div class="postbody"><span class="postbody">yay for works</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112432 - Ant6n - Sat Dec 16, 2006 9:52 am</h4>
    <div class="postbody"><span class="postbody">back on the compression question. What 'image' compression format would be useful to use? I think jpeg is out because of colors, gif due to licensing (??), png, well, don't know. I wonder whether there is a good image format that compresses well in 1-8 bits paletted color formats and can be output from usual programs. thoughts?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112468 - tepples - Sat Dec 16, 2006 5:36 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Ant6n wrote:</b></span></td> </tr> <tr> <td class="quote">What 'image' compression format would be useful to use? I think jpeg is out because of colors</td> </tr></table><span class="postbody">
<br/>
JPEG has been ported to the GBA by Burton Radons. It's still useful for mode 3 backgrounds.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">gif due to licensing (??)</td> </tr></table><span class="postbody">
<br/>
Unisys's patents expired worldwide before the Nintendo DS came out.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">png, well, don't know.</td> </tr></table><span class="postbody">
<br/>
PNG is a heavyweight codec. It was originally designed for compression efficiency at the expense of code space and CPU time, for use on desktop machines with CPUs clocked 40 times faster than the GBA's.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I wonder whether there is a good image format that compresses well in 1-8 bits paletted color formats and can be output from usual programs. thoughts?</td> </tr></table><span class="postbody">
<br/>
You can use PNG, or you can use what a lot of GBA and DS games use: raw 4-bit or 8-bit tiles in LZSS.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#112478 - sgeos - Sat Dec 16, 2006 7:01 pm</h4>
    <div class="postbody"><span class="postbody">Why not used a compressed version of the native graphics format?  You should be able to convert just about anything using gd.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
