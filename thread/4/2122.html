<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Is it me, or the fscking emulator? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Coding > Is it me, or the fscking emulator?</h2>
<div id="posts">
<div class="post">
    <h4>#11014 - blasty - Tue Sep 23, 2003 2:04 pm</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
Today I just started programming for the GBA (in C)
<br/>
I tried to write a basical program which loads a sprite into video memory (Mode 4)
<br/>
It compiles fine but when I run my rom with VisualBoyadvance it displays two lines of pixels that change constantly and not my cool sprite :(
<br/>
<br/>
spritedata has been generated using an utillitie from gbadev.org
<br/>
my code is:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include"gba_types.h"
<br/>
#include"gba_mem.h"
<br/>
#include"gba_const.h"
<br/>
#include "woei.h"
<br/>
<br/>
#ifdef MULTIBOOT
<br/>
  volatile const u8 __gba_multiboot; // crt0.o const for multiboot mode
<br/>
#endif
<br/>
<br/>
#define VIDC_BASE       0x4000000
<br/>
#define DISPCNT         *(u32*)(VIDC_BASE)
<br/>
<br/>
#define DISP_BG2        0x400
<br/>
<br/>
#define OBJ_MAP_2D      0x0
<br/>
#define OBJ_MAP_1D      0x40
<br/>
<br/>
#define VRAM_BASE       0x6000000 // Hier start et Video RAM :)
<br/>
#define BG_PAL          0x5000000 // BG Palette
<br/>
<br/>
// macro om DISPCNT mee te berekenen
<br/>
#define DISP_MODE(n)    (n &amp; 7)
<br/>
<br/>
u16* VidRam = (u16 *)VRAM_BASE;  
<br/>
u16* Palette = (u16*)BG_PAL;
<br/>
<br/>
void plotpixel(int x, int y, unsigned short int c) {
<br/>
        VidRam[y + 120 + x] = c;  
<br/>
}
<br/>
<br/>
int AgbMain() {  
<br/>
        int y, x, i;
<br/>
<br/>
        DISPCNT = DISP_MODE(4)|DISP_BG2;
<br/>
<br/>
        for (i = 0; i &lt; 256; i++)
<br/>
                Palette[i] = kleurtjes[i];
<br/>
<br/>
<br/>
        for(y = 0; y &lt; 160; y++) {
<br/>
                for (x = 0; x &lt; 120; x++) {
<br/>
                        plotpixel(x,y,Data[y*120+x]);
<br/>
<br/>
                }
<br/>
        }
<br/>
<br/>
        return 0;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
woei.h holds my sprite and palette data.
<br/>
Any suggestions?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11015 - Datch - Tue Sep 23, 2003 2:38 pm</h4>
    <div class="postbody"><span class="postbody">First, I think there's an error in your plotPixel function.  It should be y * 120 instead of y + 120.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void plotpixel(int x, int y, unsigned short int c) { 
<br/>
        VidRam[y * 120 + x] = c;  
<br/>
} 
<br/>
</td> </tr></table><span class="postbody">
<br/>
I'm not very experienced with mode 4, but I think you can't plot only one pixel without a bitshift trick.  Here's what I would try.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
        for(x = 0; x &lt; ((160 * 120) / 2); x++)
<br/>
                        plotpixel(x,0,(Data[x*2] &lt;&lt; 8) + Data[(x*2)+1]); 
<br/>
</td> </tr></table><span class="postbody">
<br/>
It's not tested!  Hope it can helps!  :)<br/>_________________<br/>Visit SR-388 now and get a 40% discount!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11016 - blasty - Tue Sep 23, 2003 2:53 pm</h4>
    <div class="postbody"><span class="postbody">Thx mate!
<br/>
The error was indeed in my plotpixel function, what a dumb fault :(
<br/>
<br/>
And about mode 4, you can directly write to videomem with it, no need for bitshifting and such :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11020 - niltsair - Tue Sep 23, 2003 3:58 pm</h4>
    <div class="postbody"><span class="postbody">The bit shifting previously mentionned was because you can only write 16bits/32bits data to video memory, and not 8bits. Thus, it's not problem if using mode 3 or 5, but for mode 4, where you use 8bits palette entries, then you have to either write 2 pixels at a time, or use bitshifting to retrieve and then copy back the upper or lower part previsouly there.<br/>_________________<br/>-Inside every large program is a small program struggling to get out. (Hoare's Law of Large Programs)
<br/>
-The man who can smile when things go wrong has thought of someone he can blame it on. (Nixon's Theorem)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
