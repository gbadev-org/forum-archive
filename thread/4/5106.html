<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Makefile directory organisation - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Coding > Makefile directory organisation</h2>
<div id="posts">
<div class="post">
    <h4>#36876 - Mucca - Wed Mar 02, 2005 7:34 pm</h4>
    <div class="postbody"><span class="postbody">Im banging my head off the desk trying to get my makefile work as Id like. For various reasons, my source files, makefiles, and vstudio project files are all in different locations. Thats obviously no problem. The problem I have is I cant get the source files to compile to object files in yet another directory.
<br/>
<br/>
I call make as such:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">make -C ../makefiles -f proj1.mak
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Then in the make file I have a list of source files listed like this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">SRCDIR = ../src
<br/>
<br/>
CPPFILES = $(SRCDIR)/gfx/foo.cpp\
<br/>
                   etc.
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
and the correct object files derived like this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">OFILES := $(notdir $(CPPFILES:.cpp=.o))</td> </tr></table><span class="postbody">
<br/>
<br/>
Obviously theres a problem here as the o files have no path, therefore I wanted to move into a build directory and have the o files compile to there.
<br/>
<br/>
The problem is theres seems to be then no link between src/gfx/foo.cpp and bld/foo.o.
<br/>
<br/>
Ive tried many things - eg compiling the files into source directory, then moving them to build directory, however this destroys the usefullness of make, as every time I compile it has to compile every source file again. Also tried to get work-directory switching going but was faced problems (I also need to create the build directory if it does not exist).
<br/>
<br/>
The makefile that comes with devkit advance was similar to what I need, except it works on source directories and not individual source files. Plus it does one or two things that I dont really get and that irks me.
<br/>
<br/>
I guess what I need is a solution for redirecting the object files compiled from source files. 
<br/>
<br/>
Any help welcome :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#36888 - Mucca - Thu Mar 03, 2005 12:20 am</h4>
    <div class="postbody"><span class="postbody">Ok I got it to work. 
<br/>
<br/>
What im doing now is moving into the desired build directory, and creating a list of the desired object files by using a substition on .s and .c files to .o files into an intermediate list, then selecting the notdir from each element in that list. Then I alter the VPATH to include the paths of the source files ie
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">.O_AT_SRC := $(.CPPFILES:.cpp=.o) $(.SFILES:.s=.o)
<br/>
.OFILES       := $(notdir $(.O_AT_SRC))
<br/>
<br/>
VPATH := $(dir $(.O_AT_SRC))</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
Problem I have now is some strange multiple definition stuff at linking which wasnt there before. Im hoping when I wake up tomorrow the problem will have vanished. Oh the struggle goes on.
<br/>
<br/>
Apologies for posting a query then the answer, just got a little desperate I guess, before finding some more clarity.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#36894 - tepples - Thu Mar 03, 2005 3:25 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Mucca wrote:</b></span></td> </tr> <tr> <td class="quote">Apologies for posting a query then the answer, just got a little desperate I guess, before finding some more clarity.</td> </tr></table><span class="postbody">
<br/>
There's nothing wrong with answering your own question, as it lets others with the same problem learn from what you did.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#36906 - wintermute - Thu Mar 03, 2005 8:51 am</h4>
    <div class="postbody"><span class="postbody">you might also care to look at the makefiles provided with the examples in the devkitPro CVS.
<br/>
<br/>
<a href="http://cvs.sourceforge.net/viewcvs.py/" target="_blank">http://cvs.sourceforge.net/viewcvs.py/</a>*checkout*/devkitpro/examples/gba/PCXView/Makefile?rev=1.3
<br/>
<br/>
the makefile for libogc may be a little closer to what you're looking for
<br/>
<br/>
<a href="http://cvs.sourceforge.net/viewcvs.py/" target="_blank">http://cvs.sourceforge.net/viewcvs.py/</a>*checkout*/devkitpro/libogc/Makefile?rev=1.33
<br/>
<br/>
some useful reading material
<br/>
<br/>
<a href="http://make.paulandlesley.org/" target="_blank">http://make.paulandlesley.org/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#36910 - Mucca - Thu Mar 03, 2005 11:08 am</h4>
    <div class="postbody"><span class="postbody">Thanks for the links, consider them bookmarked.
<br/>
<br/>
I have one last query on this topic - Im creating two archives from two different vstudio makefile projects using two different makefiles, which are nigh-on identical apart from the source files and stuff, and both now do what I want them to do, yet one crashes at the end with a make exception 1000 STATUS_ACCESS_VIOLATION, and the other doesnt.
<br/>
<br/>
What are the likely causes for this exception, and what are the recommended fixes? I fear it could be due to the fact that Im using an older version of make and gcc etc. Anyway if anyone's heard of something like this before, information would be appreciated.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
