<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>How to slow down keypresses - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Coding > How to slow down keypresses</h2>
<div id="posts">
<div class="post">
    <h4>#1018 - imikeyi - Mon Jan 13, 2003 1:41 pm</h4>
    <div class="postbody"><span class="postbody">I sample keypresses with the REG_KEY register. I want to be able to select options from a menu, but at the moment the keys get sampled _very fast_. How can I increase the delay between key presses?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1019 - Scritch - Mon Jan 13, 2003 2:25 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>imikeyi wrote:</b></span></td> </tr> <tr> <td class="quote">I sample keypresses with the REG_KEY register. I want to be able to select options from a menu, but at the moment the keys get sampled _very fast_. How can I increase the delay between key presses?</td> </tr></table><span class="postbody">
<br/>
<br/>
I think you should just check this register less often...
<br/>
From GBATEK:
<br/>
<span style="font-style: italic">It'd be usually recommended to read-out this register only once per frame, and to store the current state in memory. As a side effect, this method avoids problems caused by switch bounce when a key is newly released or pressed.</span>
<br/>
<br/>
You can also check it even less often if you want.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1020 - imikeyi - Mon Jan 13, 2003 2:30 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Scritch wrote:</b></span></td> </tr> <tr> <td class="quote">I think you should just check this register less often...
<br/>
From GBATEK:
<br/>
<span style="font-style: italic">It'd be usually recommended to read-out this register only once per frame, and to store the current state in memory. As a side effect, this method avoids problems caused by switch bounce when a key is newly released or pressed.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Ahh switch bounce.. I did a class on boards using stamp cpus and they talked about that, but I would have thought the GBA had its own debouncing mechanisms, because its much more sophisticated.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#1023 - Splam - Mon Jan 13, 2003 4:30 pm</h4>
    <div class="postbody"><span class="postbody">Yep, you can debounce the buttons.  GBA doesn't have its own.
<br/>
<br/>
obviously if you know how debounce works ignore this post :)
<br/>
<br/>
To do it you need to read the register every frame then have a routine that checks it against the previous frames entry.  Only if the state has changed (the button has been pressed) do you then set a bit in the "debounce" variable.  If the current and previous frames are the same the debounce for that button is cleared.
<br/>
<br/>
Your main code then reads the debounce variable to see if anything has been pressed, if you want to know if something is being held down you obviously just check the current frames variable.
<br/>
<br/>
Do this at the start of a frame then make sure to read the debounce and process presses every frame else you'll miss the presses as they only happen once per press and are cleared on the next frame (hence the debounce).
<br/>
<br/>
-edit-
<br/>
If you want a sort of in between method so holding a button down still registers but not as often just add a timer to your debounce routine (or use a main game loop timer) if the desired time has passed clear out the debounce variables (last frame one should do it) then the "button pressed" part of the debounce variable will be set again   and again  etc</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#2386 - Malefactor - Sun Feb 02, 2003 8:56 pm</h4>
    <div class="postbody"><span class="postbody">I'm using this routine right now..  But sometimes it seems like it registers when I press the key AND when I let go of it :(
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">CurrentKey = *KEYS;
<br/>
if(CurrentkKey != LastKey &amp;&amp; !(CurrentKey &amp; KEY_R)) //do stuff
<br/>
LastKey = CurrentKey;</td> </tr></table><span class="postbody">
<br/>
<br/>
am I doing something wrong?<br/>_________________<br/><a class="postlink" href="http://lorrd.fearware.net" target="_blank"></a><a href="http://mysite.verizon.net/vzep3wth/sitebuildercontent/sitebuilderpictures/lorrdbanner.gif">[Images not permitted - Click here to view it]</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#2390 - Lord Graga - Sun Feb 02, 2003 9:59 pm</h4>
    <div class="postbody"><span class="postbody">I just use timers when a key is pressed (wait 0.5 seconds).
<br/>
Sometimes i do this instead:
<br/>
<br/>
if(k = 0)
<br/>
{
<br/>
  if(!(*KEYS &amp; KEY_UP))
<br/>
  {
<br/>
    dir--;
<br/>
    k = 1;
<br/>
  }
<br/>
}
<br/>
<br/>
then i reset "k" if no keys are pressed.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#2392 - FluBBa - Sun Feb 02, 2003 10:27 pm</h4>
    <div class="postbody"><span class="postbody">Splam:
<br/>
Debouncing as talked about in the cowbite spec is when the switches repeatedly switch state even though you just pressed once or released the button. Not about how to tell if button has changed state.
<br/>
But maybe that was what imikeyi wanted.
<br/>
<br/>
All:
<br/>
To get rid of the bounce, just read the hardware register once a frame and store it in a variable. I repeat what Splam has said more or less said over and over again, base your code on the VBlank. ;-)
<br/>
It's probably good for you.
<br/>
Maybe he didn't say that but I hope he agrees with me.<br/>_________________<br/>I probably suck, my not is a programmer.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#2434 - DrakeX - Mon Feb 03, 2003 10:32 pm</h4>
    <div class="postbody"><span class="postbody">i'm not exactly a GBA programmer (yet) but in other platforms (the computer..) it's easy to do something like this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
char upwait=15; // this is at the beginning of the program, you can change this to make the wait longer or shorter
<br/>
<br/>
if(!(UPKEY_PRESSED)) upwait=1; // up is not pressed
<br/>
if(UPKEY_PRESSED) // up IS pressed
<br/>
{
<br/>
   upwait--;
<br/>
   if(upwait==0)
<br/>
   {
<br/>
      upwait=15;
<br/>
      // place upkey code in here
<br/>
   }
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
basically it resets the wait to 1 if it's not pressed so it registers as soo as the up key is pressed, then every loop it decrements a variable until it's 0, where it resets the wait variable to 15 and does the code for when you press the upkey.  :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#2538 - Malefactor - Thu Feb 06, 2003 1:34 am</h4>
    <div class="postbody"><span class="postbody">tried timers - can't get it precise enough, either too fast or too slow.
<br/>
<br/>
Well, all I had to do was make my function wait for the VBlank.  Thanks to Blubba for pointing out the little paragraph in splams post that I missed.<br/>_________________<br/><a class="postlink" href="http://lorrd.fearware.net" target="_blank"></a><a href="http://mysite.verizon.net/vzep3wth/sitebuildercontent/sitebuilderpictures/lorrdbanner.gif">[Images not permitted - Click here to view it]</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
