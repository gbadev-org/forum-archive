<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>sprite velocity and collision question - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > sprite velocity and collision question</h2>
<div id="posts">
<div class="post">
    <h4>#13896 - gbawiz - Wed Dec 24, 2003 6:06 pm</h4>
    <div class="postbody"><span class="postbody">Hi all,
<br/>
<br/>
I have a question regarding the control of the sprite movement in my games.
<br/>
At the moment I can only move my sprites at one pixel at a time in any direction while using my collision testing techniques (bounding box and sprite to BG testing).
<br/>
The problem arises when I want sprites to move faster than this, say 18 pixels at a time. When I attempt a collision with the background, the move is cleared and the sprite is placed at the new location (i.e sprite y + 18).
<br/>
The thing is that there is a wall between the original location and the new location that would have been detected if the player moved one pixel at a time.
<br/>
<br/>
Does this mean that I can only move all my sprites at one pixel at a time or is there a specific method which must  be used.
<br/>
<br/>
I would be grateful for any advice.
<br/>
Thanks
<br/>
GbaWIZ</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#13900 - sajiimori - Wed Dec 24, 2003 6:12 pm</h4>
    <div class="postbody"><span class="postbody">The easiest solution is to move one pixel at a time 18 times in a row, all in one frame, checking for collisions each time.  It will still appear as if the sprite is moving 18 pixels at once, but all the appropriate collisions will happen.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#13901 - Miked0801 - Wed Dec 24, 2003 6:17 pm</h4>
    <div class="postbody"><span class="postbody">Option 2 is to actually do the vector math to figure out if a collision has happened anywhere along the path - of course, checking every possible pixel location between is easier to do, but much slower...
<br/>
<br/>
Mike</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#13921 - gbawiz - Wed Dec 24, 2003 11:51 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for the response guys,
<br/>
<br/>
The thing is, I have about 100 enemy sprites and their moves are calculated and positions are updated every program loop.
<br/>
for each of the 100 enemys they have to check for collision against every other sprite object in the program (including the 99 other enemies).
<br/>
As a result  the program is reeeeeeeeeally slow and as the enemies are destroyed then the program speeds up.
<br/>
I have tried methods such as only moving the enemies which are in range of the player but it only helps a little
<br/>
<br/>
you mentioned frames, would updating the positions at specific frame times help speed up the program?
<br/>
<br/>
thanks
<br/>
GbaWIZ</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#13922 - sajiimori - Thu Dec 25, 2003 12:10 am</h4>
    <div class="postbody"><span class="postbody">This topic has been discussed here before.  In short: try sorting your objects by their locations to eliminate many possibilities at once.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#13937 - Miked0801 - Thu Dec 25, 2003 7:34 am</h4>
    <div class="postbody"><span class="postbody">Yep, a good sort or cull changes the search from O^2 to nearly O.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#13955 - jenswa - Thu Dec 25, 2003 9:16 pm</h4>
    <div class="postbody"><span class="postbody">I don't realy know how to say this in english.
<br/>
<br/>
But if you have 100 sprites and you check every sprite with the 99 others,
<br/>
there are double checks that way.
<br/>
<br/>
you check one sprite for 99 collisions, than sprite no 100 is done, sprite no 99 was already checked with sprite no 100, so only 98 collision checks for sprite no 98 are left, etc etc...
<br/>
<br/>
And indeed, that sorting trick has been discussed before and is a very nice trick to use.<br/>_________________<br/>It seems this wasn't lost after all.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#13961 - gbawiz - Thu Dec 25, 2003 10:33 pm</h4>
    <div class="postbody"><span class="postbody">i see what you mean about only testing each object once.
<br/>
The method that I have used recently is like this
<br/>
<br/>
there are 100 enemies (0 to 99) and the rest upto 121 are collidable objects which the enemies can collide with (including the other enemies)
<br/>
<br/>
in my checks I use a for loop (for scan=0;scan&lt;100;scan++)
<br/>
and within the loop there is another while loop which checks other sprites against the current enemy being checked.
<br/>
<br/>
<br/>
next=scan+1;
<br/>
while(next&lt;121){
<br/>
  do checks between 'scan' and 'next'
<br/>
  next++;
<br/>
  }
<br/>
<br/>
this means that only the current enemy being checked is only checked against the sprites following it up to 121.
<br/>
however this doesnt seem to work properly as some of the enemies (not all) seem to move through others.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#13970 - Miked0801 - Fri Dec 26, 2003 7:00 pm</h4>
    <div class="postbody"><span class="postbody">OK, if you check every sprite against every other on the screen, you get 100 x 100 seaches or 100^2.  This is too slow.
<br/>
<br/>
Now there's a bunch of ways to speed this up.  Here's one way.  Use the X and Y position to create a Hash Table.  For example - lets assume you have a world size of 1024x1024 pixels (fairly small).  Then lets create an array of 1024 sprite pointer linked lists.  We'll use the following for our hash function:
<br/>
<br/>
u32 spriteHashFunc(u32 xPos, u32 yPos)
<br/>
{
<br/>
    ASSERT(xPos &lt; 1024 &amp;&amp; yPos &lt; 1024);
<br/>
    return ((xPos &gt;&gt; 5) + (yPos &amp; 0xFFFFFFE0));
<br/>
}
<br/>
<br/>
This will return a value from 0 to 1023.  Now, run all your actors through this function and add them to the hash table.  The first add will take some time, but not too bad.  Now every tic, take the sprite's hash function value and use it to index into the hash table.  The only sprites you need check against are sprites in the same list as the target sprite.  
<br/>
<br/>
Every tic, you'll need to update all the sprites that have moved to different hash arrays - but this should be much, much quicker than doing a huge number of collision checks.
<br/>
<br/>
Mike</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14026 - gbawiz - Sat Dec 27, 2003 8:29 pm</h4>
    <div class="postbody"><span class="postbody">hello all,
<br/>
thanks for your response to my previous posts,
<br/>
I currently have the problem of collision detection between 100 sprite objects
<br/>
each of the 100 objects is required to test the other 99 objects and this is proving to slow.
<br/>
I need to use some sort of sorting methods to cut down on the amount of collision tests needed.
<br/>
I have heard of the sector method and the axis sorting method but have no idea on how to store and use these methods.
<br/>
Can anyone suggest a good method which can be used in this problem.
<br/>
Also, how do I create and access tables (as in hash tables)?
<br/>
<br/>
many thanks
<br/>
GbaWIZ</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14029 - dagamer34 - Sat Dec 27, 2003 11:04 pm</h4>
    <div class="postbody"><span class="postbody">Do you have to check enemy-enemy collisions? 
<br/>
<br/>
I know for one, that it is better to play a game with good gameplay and ok graphics than good graphics and SLOW gameplay.
<br/>
<br/>
One thing though is to make sure that you always use a systems strengths. It is pointless to make a next generation 3D game on the GBA, it's just not gonna happen (I purposely exaggerated to show my point).<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14058 - jma - Sun Dec 28, 2003 5:47 pm</h4>
    <div class="postbody"><span class="postbody">You could break the collisions up using algorithms designed for raytracing (like quad-trees, etc). A basic idea would be like (untested code used to show <span style="font-style: italic">concept</span>):
<br/>
<br/>
o each sprite is in an "area" of the screen; these are bit-based so they can be combine (0,1,2,4,etc); this is stored in an array somewhere:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int sprite_location[128]; // max 128 sprites</td> </tr></table><span class="postbody">
<br/>
<br/>
o The screen is divided into 4 areas (0,0-120,80), (120,80-240,80), (0,80-120,160), (120,80-240,160). If you need more areas, subdivide even more.
<br/>
<br/>
o At the start of your program, loop through each of your sprites and use x/y and size to determine which areas it is in.
<br/>
<br/>
o Each time a sprite is moved, check to see if the area(s) it is in change and update your sprite_location array accordingly. Offscreen sprites set their sprite_location to 0:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void update_location(int *location,int x,int y) {  
<br/>
  if (x &lt; 120 &amp;&amp; y &lt; 80) *location |= 1;
<br/>
  // TODO: etc.
<br/>
}
<br/>
<br/>
void set_sprite_location(int sprite) {
<br/>
  int x = sprite_x(sprite),y = sprite_y(sprite);
<br/>
  int cx = x + sprite_sizex(sprite), cy = y + sprite_sizey(sprite);
<br/>
<br/>
  sprite_location[sprite] = 0; // reset
<br/>
<br/>
  update_location(&amp;sprite_location[sprite],x,y);
<br/>
  update_location(&amp;sprite_location[sprite],cx,cy);
<br/>
  update_location(&amp;sprite_location[sprite],cx,y);
<br/>
  update_location(&amp;sprite_location[sprite],x,cy);
<br/>
<br/>
  // NOTE: this could be sped up quite a bit by just
<br/>
  // looking at adjustments to the current location
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
o Each collision test, your first test would be like so:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">for(i=0;i&lt;nSprites;i++) {
<br/>
   if (i == thisSprite) continue;
<br/>
   if ((sprite_location[i] &amp; sprite_location[thisSprite]) == 0) continue;
<br/>
   // TODO: check sprite collision between i and thisSprite
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
This should cut down your sprite collision tests by about 75% using 4 areas, and even more if you divide into 8, 16, or more areas.
<br/>
<br/>
Jeff<br/>_________________<br/><a href="mailto:massung@gmail.com">massung@gmail.com</a>
<br/>
<a href="http://www.retrobyte.org" target="_blank">http://www.retrobyte.org</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14061 - col - Sun Dec 28, 2003 7:08 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>jma wrote:</b></span></td> </tr> <tr> <td class="quote">...
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">for(i=0;i&lt;nSprites;i++) {
<br/>
   if (i == thisSprite) continue;
<br/>
   if ((sprite_location[i] &amp; sprite_location[thisSprite]) == 0) continue;
<br/>
   // TODO: check sprite collision between i and thisSprite
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
This should cut down your sprite collision tests by about 75% using 4 areas, and even more if you divide into 8, 16, or more areas.
<br/>
<br/>
Jeff</span></td> </tr></table><span class="postbody">
<br/>
<br/>
doing it that way, you are still doing 128 * 128 tests though - just 'location' tests instead of box overlap tests...
<br/>
<br/>
don't keep the sector info in the sprite objects.
<br/>
keep it seperate.
<br/>
each sector is a linked list of the sprites that are in that sector.
<br/>
to check for collisions, just check each of the sprites in a sector with the other sprites in that sector.
<br/>
<br/>
Of course this approach falls apart if your game objects can potentially congregate in the same sector. You then have all the overhead of managing the lists, and still 128*128 tests to do :( 
<br/>
<br/>
much better to use 'game rules' to reduce the number of collision checks. Then if it suits your game, use x coord (or y) to order the entities for further savings if needed.
<br/>
<br/>
col</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14069 - Miked0801 - Mon Dec 29, 2003 12:02 am</h4>
    <div class="postbody"><span class="postbody">Hehe.  See my example above for sector testing (algorithm uses 32x32 pixel sectors)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14090 - jma - Mon Dec 29, 2003 5:22 pm</h4>
    <div class="postbody"><span class="postbody">Nice, Mike! didn't see that above :)
<br/>
<br/>
Jeff<br/>_________________<br/><a href="mailto:massung@gmail.com">massung@gmail.com</a>
<br/>
<a href="http://www.retrobyte.org" target="_blank">http://www.retrobyte.org</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14093 - gbawiz - Mon Dec 29, 2003 7:55 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for the response to my post,
<br/>
About the sector method. I have looked at the possibility of dividing my gamemap into a grid of sectors, with a list for each, and storing my sprite reference within the list according to which sector it falls within.
<br/>
There are a couple of things which im not sure about.
<br/>
If the sprite should overlap sectors then do I have to store that sprite in all of those sectors? (i.e check all the corners of the bounding box of my sprite and store sprite ref in the sectors which those corners rest).
<br/>
Another way I thought of is to make the sectors smaller and then scan the <span style="font-style: italic">surrounding</span> sectors of that which the sprite is located.
<br/>
also how do I make a list as im not too clued up on linked lists (can these be used?).
<br/>
<br/>
many thanks
<br/>
GbaWIZ</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14132 - Miked0801 - Wed Dec 31, 2003 2:21 am</h4>
    <div class="postbody"><span class="postbody">If checking against a box, then as long as your box is smaller than the sector size, at worst it will fit into 4 sectors (if axis aligned - all bets are off on a rotated collision box.)  So just check the 4 sectors.
<br/>
<br/>
I'm not convinced that checking 100 objects would be too slow myself.  That would be at most 10,000 checks.  If done intelligently, you'd only need about 4950 ((100 * 99) / 2) checks when removing redundancies.  On games I've worked on where hundreds of objects needed to be checked, it wasn't too bad to check them all.
<br/>
<br/>
If you can get away with radius checks, taking X distance squared + Y distance Squared between 2 objects and comparing is very fast (2 muls, 2 subtracts, 2 adds, and a compare.)  Just square the final distance you're checking against to be things work.  
<br/>
<br/>
example:
<br/>
<br/>
I'm at position 2,3.  My radius is 10 (squared to 100).  My collision check point lives at 9, 9 and has a radius of 4 (squared to 16).  
<br/>
<br/>
Collision check:
<br/>
2 - 9 = -7 ^ 2 == 49
<br/>
3 - 9 = -6 ^ 2 == 36
<br/>
Added together this gives a squared distance of 85.
<br/>
<br/>
My square radius plus his is 100 + 16 == 116 
<br/>
<br/>
85 &lt; 116 so we are colliding.  
<br/>
<br/>
Very fast (probably around 15 cycles or so per check.)  an completely accurate for radius.
<br/>
<br/>
As it plays with less numbers, it will also have less memory access than a box check as well.
<br/>
<br/>
Mike</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14171 - col - Wed Dec 31, 2003 5:01 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Miked0801 wrote:</b></span></td> </tr> <tr> <td class="quote">Hehe.  See my example above for sector testing (algorithm uses 32x32 pixel sectors)</td> </tr></table><span class="postbody">
<br/>
<br/>
I saw it :)
<br/>
<br/>
32x32 sectors mean that most sprites will commonly be in multiple sectors
<br/>
<br/>
If you have boxes greater that 32x32 (not unusual), they will often occupy 9 or more sectors - ouch - starts to make the hash table a lot less simple to manage - suddenly you can't just use the corner points to get your hash value... 
<br/>
<br/>
moving your sprites in the hash table will happen often with such a small sector size, and if you have 9 sectors to update, thats a lot of list manipulation to process.
<br/>
<br/>
Could leave you with a crippling worst case !
<br/>
<br/>
as you suggest in a later post - for the sector method, you really need to make sure that the largest collision box is &lt;= the sector size (for some versions of the algorithm, it must be &lt;= half the sector size)
<br/>
<br/>
in the end, if cpu is becoming in issue the best thing is to implement multiple algorithms and profile them - trying to stress their weaknesses...
<br/>
<br/>
cheers
<br/>
<br/>
Col</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14181 - gbawiz - Wed Dec 31, 2003 9:20 pm</h4>
    <div class="postbody"><span class="postbody">I was reading about the sector method where it is described that the screen is divided into sectors and there is a sector array where the sector location for each sprite is stored.
<br/>
But what do I do when the case is that the sprite overlaps onto four sectors? do i have to calculate a sector for each of the corners and then store the spritenumber in each of those sectors?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14183 - Miked0801 - Wed Dec 31, 2003 10:27 pm</h4>
    <div class="postbody"><span class="postbody">yep which is why you want to make sure your sprite box is smaller than the sector size else you might worse case higher than 4 sectors.  It does work though - I used it to speed up detection on a PSX game I worked on a long time ago :)
<br/>
<br/>
Mike</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14283 - gbawiz - Sat Jan 03, 2004 9:35 pm</h4>
    <div class="postbody"><span class="postbody">Well, I have created a sector method for sorting my collision tests and have found that it has made only a little difference in speed, not enough to warrant smooth playability.
<br/>
The enemy sprites are mostly grouped 3x4, 2x3, 7x8, etc. and each group is spread throughout the gamemap.
<br/>
<br/>
What is the best method for collision detection in this case?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14287 - Miked0801 - Sat Jan 03, 2004 10:44 pm</h4>
    <div class="postbody"><span class="postbody">I hate to ask, but are you absolutely sure that collision detection is what is slowing down your app?  Have you done a full profile check to make sure something else isn't eating away at your time?  If collision detection is only 3% of your overall CPU, a 50% speed increase only gets you 1.5% of your overall CPU time back...
<br/>
<br/>
Mike</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14295 - XeroxBoy - Sat Jan 03, 2004 11:21 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Well, I have created a sector method for sorting my collision tests and have found that it has made only a little difference in speed, not enough to warrant smooth playability. 
<br/>
The enemy sprites are mostly grouped 3x4, 2x3, 7x8, etc. and each group is spread throughout the gamemap. 
<br/>
<br/>
What is the best method for collision detection in this case?</td> </tr></table><span class="postbody">
<br/>
<br/>
An easy optimization you can do in this case is to simply check collision on the bounding boxes of the enemy groups - if there's a collision, do further testing to see what collided with what. That, theoretically, could reduce the number of checks you need to do exponentially.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14400 - gbawiz - Tue Jan 06, 2004 12:33 am</h4>
    <div class="postbody"><span class="postbody">I've tried disabling the enemy movement procedure in my app and found that the problem is in large part due to the enemy movement.
<br/>
Could it be the fact that all of my code is in C and none in assembly which is slowing my app down?
<br/>
<br/>
I also have a routine which calculate the relative screen coords of each sprite in the map (the map is larger than the screen and makes use of scrolling and offsets) and updates the screen. This is carried out on every cycle of the program loop as well as the controlling enemy movement.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14404 - sajiimori - Tue Jan 06, 2004 1:25 am</h4>
    <div class="postbody"><span class="postbody">We have no way of knowing where your bottlenecks are.  Yes, you can usually make code faster by using hand-written assembly.  No, we can't tell you if doing this will make your code meet your requirements.
<br/>
<br/>
You need to profile your code to find out where the CPU is spending its time.  Then you can post the critical section (which is usually quite short) and we can probably help you.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14410 - Miked0801 - Tue Jan 06, 2004 2:36 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Could it be the fact that all of my code is in C and none in assembly which is slowing my app down
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
C code is just fine for this sort of thing - we do it all the time w/o issue.  You just need to be careful in what algorithm the code is running per Enemy.  If you've got some ultra complex trig routine running in every enemy to lead a target or something, that'll kill you.  Profile your code, then you'll know where to begin.  Any time spent optimizing w/o profiling is wasted.
<br/>
<br/>
Mike</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14501 - gbawiz - Wed Jan 07, 2004 5:48 pm</h4>
    <div class="postbody"><span class="postbody">Here is my bounding box collision test:
<br/>
<br/>
char bbtest(int ax, int ay, int aw, int ah, int bx, int by, int bw, int bh)
<br/>
{
<br/>
	if(ax+aw&lt;bx)return FALSE;
<br/>
	if(ax&gt;bx+bw)return FALSE;
<br/>
	if(ay+ah&lt;by)return FALSE;
<br/>
	if(ay&gt;by+bh)return FALSE;
<br/>
	return TRUE;
<br/>
}
<br/>
<br/>
Could it be a possibility that the above is slowing down my app?
<br/>
Also a note on linked lists, removing an entry from the llist, is it necessary to scan the until the desired entry is found or is there a more direct method like key in data out in one go without having to scan?
<br/>
<br/>
Thanks</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14504 - Miked0801 - Wed Jan 07, 2004 6:15 pm</h4>
    <div class="postbody"><span class="postbody">You can get rid of the adds if you store the box as 4 coordinates instead of 2 coords and 2 offsets.  Also, passing 8 parameters means 4 are put on the stack.  I'd consider putting the b values in a local struct on the outer-loop of your collisions check - then directly put this test code in the inner loop.  That gets rid of the function calls and stack accesses.  This type of code should also be in fastRAM as ARM code so you have enough registers to do it right.  We store our collision data in u16s - that way when intially reading from ROM, we only need 2 32-bit reads instead of 4.
<br/>
<br/>
That said, I really doubt this is your bottle-neck.  Profile your code and find out what is.
<br/>
<br/>
Mike</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14523 - gbawiz - Wed Jan 07, 2004 11:50 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for response,
<br/>
<br/>
how do I profile code on the GBA? I use the devkit advance compilers(GCC).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14526 - tepples - Thu Jan 08, 2004 12:35 am</h4>
    <div class="postbody"><span class="postbody">Try clicking <a class="postlink" href="http://forum.gbadev.org/search.php" target="_blank">Search</a> above and entering <span style="font-weight: bold">profiling</span> as your keyword.
<br/>
<br/>
It's too bad that phpBB's search uses a POST form; otherwise, I'd have linked a result page the way I do on Slashdot for Google search results. (Or is the CPU cost of search in phpBB so high that the phpBB developers did this on purpose to discourage linking to expensive result pages?)<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14966 - gbawiz - Thu Jan 15, 2004 12:51 pm</h4>
    <div class="postbody"><span class="postbody">Well I have found a method of speeding up my collision detections but im not quite convinced that it is the best way.
<br/>
My gamemap is 512x512 with scroll. I have created an axis sort method where all the sprite's y coords are used as a reference to an array:
<br/>
yaxis[spritey]=spritenumber. (these are initiated at the beginning of the app).
<br/>
I thought about getting rid of the bounding box collision test because i found a faster method but that would only test the whole 16x16 boundings of each sprite.
<br/>
I want to be able to check a 'footprint' within the sprite which is a smaller bounding box within the sprite area, so i have to keep the adds in my bbtest.
<br/>
Is there a limit to the number of sprites which i should have on screen at any one time?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14968 - LOst? - Thu Jan 15, 2004 1:40 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>gbawiz wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Is there a limit to the number of sprites which i should have on screen at any one time?</td> </tr></table><span class="postbody">
<br/>
I believe 128 sprites during a Vblank is the answer</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14987 - animension - Thu Jan 15, 2004 7:30 pm</h4>
    <div class="postbody"><span class="postbody">It is possible to get more than 128 sprites on screen using HBLANK IRQs. Essentially, what you do is change the OAM's properties after a scan line has passed the bottom of the sprite during HBLANK to locate it somewhere else further down the screen from the current scanline.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
  ----------
<br/>
  |        |
<br/>
  |        |  Sprite OAM #0 @ Y position 60
<br/>
  |        |
<br/>
  ----------
<br/>
_____________________________________   Current Scanline @ Y position 70
<br/>
<br/>
                         ----------
<br/>
                         |        | Sprite OAM #0 now @ Y position 80
<br/>
                         |        | moved down here during HBLANK.
<br/>
                         |        | You can even tell it to use a different graphic.
<br/>
                         ----------
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/>"Beer is proof that God loves us and wants us to be happy."
<br/>
-- Benjamin Franklin</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14991 - poslundc - Thu Jan 15, 2004 8:39 pm</h4>
    <div class="postbody"><span class="postbody">The danger with that technique is you only get 950 pixels of processing per scanline, which may seem like a lot, but rot/scale sprites and double-size sprites consume much more than their actual horizontal dimension.
<br/>
<br/>
Furthermore, that technique really should only be necessary in exceptional circumstances. Sprite-based text engines and complicated particle effect games, mostly. 128 sprites is a lot on a screen the size of the GBA's.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15000 - tepples - Thu Jan 15, 2004 11:19 pm</h4>
    <div class="postbody"><span class="postbody">For short:
<br/>
<br/>
Q: How many 8x8 sprites can you display on one scanline?
<br/>
A: Almost all of them.
<br/>
<br/>
Remember that 950 pixels equals about 118 sprites, each of width 8. It seems that T&amp;L processing might dominate in a GBA particle effect demo.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15011 - Miked0801 - Fri Jan 16, 2004 2:32 am</h4>
    <div class="postbody"><span class="postbody">Though T&amp;A would definately garner more attention :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15036 - gbawiz - Fri Jan 16, 2004 11:25 am</h4>
    <div class="postbody"><span class="postbody">I was wondering if having a certain amount of sprites on the screen at one time would slow the program down.
<br/>
Also, what happens if I try to write to sprite attribute memory while the screen is being drawn? (i.e. not during vblank or hblank). Is the attribute memory 'dual access' or can only one device access it at a time.
<br/>
If this is the case then which gets the priority, the cpu or the lcd controller?
<br/>
I have noticed the shearing of the image but i am wondering if the cpu is placed in a wait state if it has attempted to write to attributemem during the lcd controller access.
<br/>
You may have guessed I am still trying to speed up my collision detection and sprite movement processes :)
<br/>
<br/>
Thanks
<br/>
gbaWIZ</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62519 - gbawiz - Thu Dec 01, 2005 8:28 pm</h4>
    <div class="postbody"><span class="postbody">Hello,
<br/>
I have read different documents which talk about the sector method and some ways of implementing them.
<br/>
The main issue with the sector method arises when one sprite object falls within more than one sector.
<br/>
if the sprite centers on the corner of a sector then it occupies 4 sectors at the same time.
<br/>
<br/>
This would mean that I would have to store the sprite number in each of the linked lists representing the sectors, and when the sprite moves, I have to change the entries for all 4 sectors.
<br/>
<br/>
Does this mean that each sprite object will have to memorize which sectors it is CURRENTLY in so that when moving the sprite, these entries can be changed.
<br/>
<br/>
Also, when a sprite is moved from one sector to another, having to traverse each sector's linked list takes time. Is there a better way?
<br/>
<br/>
One which I have also heard of is to use ONLY the top left 'sprite coordinate' to determine the sector which the object is in and then scan through all the surrounding sectors (9 in total).
<br/>
<br/>
Thanks in advance.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62529 - tepples - Thu Dec 01, 2005 9:25 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>gbawiz wrote:</b></span></td> </tr> <tr> <td class="quote">Does this mean that each sprite object will have to memorize which sectors it is CURRENTLY in so that when moving the sprite, these entries can be changed.</td> </tr></table><span class="postbody">
<br/>
That or clear the list in each sector every frame.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62538 - Miked0801 - Thu Dec 01, 2005 11:40 pm</h4>
    <div class="postbody"><span class="postbody">Depends - if you have objects that'll never move, there's an optimization to be had here.  If all your sprites are flying all over the place, then it'll be faster to recontruct your list every tic.  Man this thread came back from the dead :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62541 - gbawiz - Thu Dec 01, 2005 11:59 pm</h4>
    <div class="postbody"><span class="postbody">Yeah, unfinished business to take care of :)
<br/>
<br/>
I was just working out how I might use the sector method.
<br/>
If an object falls within one sector then all of its four corners will fall into the same sector, it would be silly to scan the same sector four times.
<br/>
I would have to memorise the fact that this sector has already been checked.
<br/>
I would have to have another list for each of the objects, which contain the 'different' sectors which the object falls in.
<br/>
i.e instead of having the four corner sectors in 2,3,2,5. Then I would have something like 2,3,5, ?.
<br/>
I may need a list sorter to filter out the duplicates.
<br/>
<br/>
I have come up with this myself but can't help think that there may be a better way of doing this as it seems a bit tedious.
<br/>
Are there any source code or pseudo code listings available which would detail a good sector method technique?
<br/>
<br/>
Thanks again</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62544 - tepples - Fri Dec 02, 2005 1:43 am</h4>
    <div class="postbody"><span class="postbody">Or you could just divide the screen into vertical sectors and use the sorting method horizontally within each sector, using a binary search to find where in the adjacent sectors to start looking.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#62555 - sajiimori - Fri Dec 02, 2005 9:21 am</h4>
    <div class="postbody"><span class="postbody">If you're set on using 2D sectors, here are some things to consider.
<br/>
<br/>
Each sector could have a linked list of objects that are within it.  The linked list can pass through the object structs, like so:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">struct Object
<br/>
{
<br/>
  Object* prevInSector;
<br/>
  Object* nextInSector;
<br/>
};
<br/>
</td> </tr></table><span class="postbody">
<br/>
It's a doubly-linked list so it will be fast to remove an object from a sector, and so you can quickly find all of an object's neighbors by traversing the list in both directions.
<br/>
<br/>
Objects that are at least 2x2 pixels in size can be in up to four sectors at once, so that single pair of pointers isn't enough.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">struct SectorLink
<br/>
{
<br/>
  SectorLink* prev;
<br/>
  SectorLink* next;
<br/>
};
<br/>
<br/>
#define MAX_SECTORS 4
<br/>
<br/>
struct Object
<br/>
{
<br/>
  SectorLink sectorLinks[MAX_SECTORS];
<br/>
};
<br/>
</td> </tr></table><span class="postbody">
<br/>
SectorLink has to have pointers to SectorLinks in each direction instead of objects.  If it had pointers to objects, you wouldn't know which of the object's links to follow to continue along the same list.
<br/>
<br/>
If none of your objects are wider or taller than a sector, then 4 links will always be enough.  If any are larger, you could increase MAX_SECTORS, or you could dynamically allocate an array of links for each object.  Flexible arrays are also an option.
<br/>
<br/>
Given an object, you need to be able to find all all the other objects that are in the occupied sectors.  By following each of the four links to the left and to the right, you will reach the links owned by all the objects in those sectors.  You may have noticed that there's no clear way to reach an object given one of its SectorLinks, but it's easy enough to add a pointer to it:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">struct SectorLink
<br/>
{
<br/>
  Object* parent;
<br/>
  SectorLink* prev;
<br/>
  SectorLink* next;
<br/>
};
<br/>
</td> </tr></table><span class="postbody">
<br/>
'Parent' will point to the object that owns the link.
<br/>
<br/>
If you happen to allocate all your objects from a pool in the form of an array, and they hold their links by value, you can skip the 'parent' pointer and calculate the address of the object based on the address of the link:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">Object objectPool[MAX_OBJECTS];
<br/>
<br/>
Object* objectForLink(SectorLink* link)
<br/>
{
<br/>
  return objectPool + ((int)link - (int)objectPool) / sizeof(Object);
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
The division might hurt, though.  Either way, it's easy to find all the nearby objects:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void findNearbyObjects(Object* obj)
<br/>
{
<br/>
  for(int link = 0; link &lt; MAX_SECTORS; ++link)
<br/>
  {
<br/>
    for(SectorLink* left = obj-&gt;sectorLinks[link].prev;
<br/>
      left-&gt;parent != 0; left = left-&gt;prev)
<br/>
    {
<br/>
      Object* other = left-&gt;parent;
<br/>
      // Do something with the other object.
<br/>
    }
<br/>
<br/>
    for(SectorLink* right = obj-&gt;sectorLinks[link].next;
<br/>
      right != 0; right = right-&gt;next)
<br/>
    {
<br/>
      Object* other = right-&gt;parent;
<br/>
      // Do something with the other object.
<br/>
    }
<br/>
  }
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
A problem with the above code is that you can run into the same object multiple times if it occupies more than one sector that the first object is in.  An easy solution is to use a timestamp.  Stamp objects with the latest 'time' when you encounter them, and ignore objects that already have the latest timestamp.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">struct Object
<br/>
{
<br/>
  ...
<br/>
  int timestamp;
<br/>
};
<br/>
<br/>
int latestTimestamp;
<br/>
<br/>
void findNearbyObjects(Object* obj)
<br/>
{
<br/>
  ++latestTimestamp;
<br/>
<br/>
  for(...)
<br/>
  {
<br/>
    for(...)
<br/>
    {
<br/>
      ...
<br/>
      if(other-&gt;timestamp == latestTimestamp)
<br/>
        continue;
<br/>
<br/>
      other-&gt;timestamp = latestTimestamp;
<br/>
      // Do something with the other object.
<br/>
    }
<br/>
  }
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
When an object changes position, remove it from all its current sectors and add it to the new ones.  In my experience, it's not worthwhile to try to minimize the number of 'remove' and 'add' operations by skipping sectors that the object will be re-added to.  Searching for those sectors takes more work than you save.
<br/>
<br/>
Removing an object from all its sectors is as easy as closing the links:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void removeFromSectors(Object* obj)
<br/>
{
<br/>
  for(int linkIndex = 0; linkIndex &lt; MAX_SECTORS; ++linkIndex)
<br/>
  {
<br/>
    SectorLink* link = &amp;obj-&gt;sectorLinks[linkIndex];
<br/>
<br/>
    if(link-&gt;prev)
<br/>
      link-&gt;prev-&gt;next = link-&gt;next;
<br/>
    if(link-&gt;next)
<br/>
      link-&gt;next-&gt;prev = link-&gt;prev;
<br/>
<br/>
    link-&gt;prev = link-&gt;next = 0;
<br/>
  }
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
Adding objects to the overlapped sectors starts out pretty easy, too:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void addToOverlappedSectors(Object* obj)
<br/>
{
<br/>
  int right = rightwardSectorExtent(obj);
<br/>
  int bottom = downwardSectorExtent(obj);
<br/>
<br/>
  for(int x = leftwardSectorExtent(obj); x &lt;= right; ++x)
<br/>
    for(int y = upwardSectorExtent(obj); y &lt;= bottom; ++y)
<br/>
      addToSector(obj, x, y);
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
The 'extent' functions are based on the object's rectangle and the dimensions of the sectors.  Writing 'addToSector' requires deciding how to represent the sector grid.  One easy representation is a 2D array.  It's late, though, so I'll stop for now.</span><span class="gensmall"><br/><br/>Last edited by sajiimori on Mon Dec 12, 2005 7:46 pm; edited 2 times in total</span></div>    
</div>
<div class="post">
    <h4>#62688 - SittingDuck - Sun Dec 04, 2005 12:33 pm</h4>
    <div class="postbody"><span class="postbody">Yes, this is the snapshot effect, and it's very problematic. Come on, the GBA is 60fps. Be thankful. With flash games, it's usually 24fps and it's much harder!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63132 - gbawiz - Fri Dec 09, 2005 12:20 am</h4>
    <div class="postbody"><span class="postbody">Hello,
<br/>
Thanks sajimori for the code, I am beginning to understand how the code works.
<br/>
<br/>
The main issue with the sector lists is being able to determine object's sector and the sector's objects. And with my sprites falling within upto 4 sectors at a time this makes referencing even more confusing.
<br/>
<br/>
I am curious about adding to overlapped sectors. I assume that you have pre-written procedures (i.e. rightwardsectorextend(obj) ). What does this procedure do?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
void addToOverlappedSectors(Object* obj) 
<br/>
{ 
<br/>
  int right = rightwardSectorExtent(obj); 
<br/>
  int bottom = downwardSectorExtent(obj); 
<br/>
<br/>
  for(int x = leftwardSectorExtent(obj); x &lt;= right; ++x) 
<br/>
    for(int y = upwardSectorExtent(obj); y &lt;= bottom; ++y) 
<br/>
      addToSector(obj, x, y); 
<br/>
} 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I am also curious as to how I would reach the objects parameters from scanning through the current sector list. You mentioned the object *parent pointer . When is this pointer setup to point to the object?
<br/>
<br/>
I assume that *prev and *next are setup when the entry is added to the current sector list.
<br/>
<br/>
Thanks again for the advice given as this stuff is normally quite confusing to me and you have helped me to understand this subject bit better.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63136 - sajiimori - Fri Dec 09, 2005 1:05 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I assume that you have pre-written procedures (i.e. rightwardsectorextend(obj) ). What does this procedure do?</td> </tr></table><span class="postbody">Actually, all that code was from scratch, so I don't have anything "pre-written."  :)  The four functions return the edges of the object on the sector grid so you can iterate from top to bottom and left to right, adding the object to each sector it overlaps.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">You mentioned the object *parent pointer . When is this pointer setup to point to the object?</td> </tr></table><span class="postbody">If objects hold their sector links by value, then the parent of a link will never change, so you can set the pointers when creating objects.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I assume that *prev and *next are setup when the entry is added to the current sector list.</td> </tr></table><span class="postbody">Yup.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63138 - gbawiz - Fri Dec 09, 2005 1:52 am</h4>
    <div class="postbody"><span class="postbody">Hello again, thanks for you reply :)
<br/>
I was looking at the code again and got stuck at the following:
<br/>
I can see that this part is straight forward where you have defined the linked list node-type 'sectorlink' then created an object type which would hold 4 of these links, referring to maximum of 4 sectors. (can i assume that the other object parameters will be defined here also, such as coords, etc...)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
struct SectorLink 
<br/>
{ 
<br/>
  SectorLink* prev; 
<br/>
  SectorLink* next; 
<br/>
}; 
<br/>
<br/>
#define MAX_SECTORS 4 
<br/>
<br/>
struct Object 
<br/>
{ 
<br/>
  SectorLink sectorLinks[MAX_SECTORS]; 
<br/>
}; 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
I have adjusted the code according to your recommendations :)
<br/>
Thanks again</span><span class="gensmall"><br/><br/>Last edited by gbawiz on Fri Dec 09, 2005 12:36 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#63142 - sajiimori - Fri Dec 09, 2005 2:30 am</h4>
    <div class="postbody"><span class="postbody">I've edited my post so that the final SectorLink definition is just like the second one except with the parent pointer (which was my intention).  It doesn't make any sense to have the parent be another SectorLink, though -- what would it point to?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63178 - gbawiz - Fri Dec 09, 2005 12:48 pm</h4>
    <div class="postbody"><span class="postbody">Hello again,
<br/>
I have ammended the code to take into account the changes that you described.
<br/>
The reason that I asked about this is because when I try to define the structs, they each need the other one to be defined before it can be defined.
<br/>
for example:
<br/>
<br/>
Defining object here requires that SectorLink be defined first before the completion of the object type as it makes use of SectorLink.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
#define MAX_SECTORS 4 
<br/>
<br/>
struct Object 
<br/>
{ 
<br/>
  SectorLink sectorLinks[MAX_SECTORS]; 
<br/>
}; 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
But here it requires that the 'Object' type be defined prior to the definition of SectorLink. 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
struct SectorLink 
<br/>
{ 
<br/>
  Object* parent; 
<br/>
  SectorLink* prev; 
<br/>
  SectorLink* next; 
<br/>
}; 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
My compiler says "missing storage-class or type specifiers" when attempting to define each. I have tried swapping the order but still get the same error.
<br/>
<br/>
Thanks</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63180 - keldon - Fri Dec 09, 2005 1:20 pm</h4>
    <div class="postbody"><span class="postbody">I use this format for what you are trying to do
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">typedef struct tagCell {
<br/>
   void *head;
<br/>
   struct tagCell*tail;
<br/>
}Cell;</td> </tr></table><span class="postbody">
<br/>
<br/>
So I would have had something like:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">typedef struct tagSectorLink
<br/>
{
<br/>
   Object* parent;
<br/>
   struct tagSectorLink* prev;
<br/>
   struct tagSectorLink* next;
<br/>
}SectorLink; </td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63203 - sajiimori - Fri Dec 09, 2005 7:13 pm</h4>
    <div class="postbody"><span class="postbody">gbawiz,
<br/>
<br/>
Forward declare Object before defining SectorLink.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">struct Object;
<br/>
<br/>
struct SectorLink 
<br/>
{ 
<br/>
    Object* parent; 
<br/>
    SectorLink* prev; 
<br/>
    SectorLink* next; 
<br/>
};</td> </tr></table><span class="postbody">
<br/>
keldon,
<br/>
<br/>
I'm not sure what tagCell is for.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63277 - gbawiz - Sun Dec 11, 2005 2:34 am</h4>
    <div class="postbody"><span class="postbody">Hello,
<br/>
I am wondering how to start the whole process of sector linked lists.
<br/>
would it be better to start with an array of sectorlinks as the starting point. i.e:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">SectorLink allsectors[16];   // assuming there are 16 sectors in total</td> </tr></table><span class="postbody">
<br/>
I belive this would create an array of 'sector heads' which would then probably each have to be initialised. I could set the individual parameters to NULL.
<br/>
<br/>
Would a good method of adding an object to a sector to do something like.
<br/>
Get the sector number which is being added to.
<br/>
create a new node (SectorLink).
<br/>
Set the parent to point to current object.
<br/>
return the address of this new sectorlink and store it in the object's sectorlink[n]. i.e:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">object[n].sectorlinks[t]=returned_pointer;</td> </tr></table><span class="postbody">
<br/>
(where 'n' is the current sprite and 't' is the current corner of the sprite).
<br/>
<br/>
Another thing which I was wondering is that if I create a new entry into a particular sector then this would mean that I would be attaching it to the head (which was declared earlier). This head is empty and would never be used.
<br/>
<br/>
I'd be grateful for any thoughts and advice on this subject.
<br/>
<br/>
Many Thanks</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63280 - sajiimori - Sun Dec 11, 2005 3:11 am</h4>
    <div class="postbody"><span class="postbody">The "head link" idea is good, but if you're using a 1-dimensional sector "grid," you're better off not using sectors at all, and instead just sorting your objects on that axis.
<br/>
<br/>
You said you were making a 2D sector grid, right?  Then create your sectors as a 2D array, as I suggested in my first post.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">create a new node (SectorLink).
<br/>
Set the parent to point to current object. 
<br/>
return the address of this new sectorlink and store it in the object's sectorlink[n].</td> </tr></table><span class="postbody">
<br/>
The definition of Object I gave stores whole SectorLinks, not pointers to SectorLinks.  By having a fixed-size array of pointers to SectorLinks and dynamically allocating the links, you're getting the worst of all worlds: you have a fixed maximum number of sectors you can be in, you waste cycles on each allocate/free operation, and your code is more complex.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">This head is empty and would never be used.</td> </tr></table><span class="postbody">It's used to point to the first object, and to tell when you've reached the beginning of the list when iterating to the left.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63317 - gbawiz - Sun Dec 11, 2005 11:22 pm</h4>
    <div class="postbody"><span class="postbody">Hello,
<br/>
I noticed that you make use of a procedure called 'addToSector(obj,x,y)' within your 'void addToOverlappedSectors(Object *obj)' procedure
<br/>
How does this addtosector procedure achieve it's task?
<br/>
I would be grateful for any advice.
<br/>
<br/>
Thanks :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63345 - sajiimori - Mon Dec 12, 2005 4:13 am</h4>
    <div class="postbody"><span class="postbody">How do you think it might accomplish its task?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63374 - gbawiz - Mon Dec 12, 2005 3:37 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">How do you think it might accomplish its task?</td> </tr></table><span class="postbody">
<br/>
<br/>
I'm trying to get an idea of how it might be done properly.
<br/>
If I were to guess:
<br/>
<br/>
the x and y coords would have to be translated into an x and y sector.
<br/>
the x and y sectors would be used to access a 2d- array of sector heads, for example 'type' sectors[x][y]; (im not yet decided on whay the type should be 'object' or 'sectorlink').
<br/>
But from here  I'm a bit undecided.
<br/>
<br/>
I assume that the sector heads will be created at the start of the program as a 2D array of heads using the format described above: 
<br/>
'type' sectors[max_x][max_y];
<br/>
But at this point, what do I put in the secor head? as I have not yet defined any sprite locations.
<br/>
<br/>
Im not too sure where to start and I believe that if I can see how the addtosector function works then It may help me to understand how the whole list is constructed.
<br/>
<br/>
Thanks</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63401 - sajiimori - Mon Dec 12, 2005 7:45 pm</h4>
    <div class="postbody"><span class="postbody">Yeah, but this is sort of the last piece of the sector-collision puzzle, so I figured I'd leave it to you as much as possible.  ;)
<br/>
<br/>
Your ideas sound good so far.  I just updated this part of findNearbyObjects:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">    for(SectorLink* left = obj-&gt;sectorLinks[link].prev;
<br/>
      left != 0; left = left-&gt;prev)</td> </tr></table><span class="postbody">When iterating to the left, you eventually hit the head link, and that's how you know it's the beginning of the list.  But the head link is a real link (not null), so the exit condition was wrong:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">    for(SectorLink* left = obj-&gt;sectorLinks[link].prev;
<br/>
      left-&gt;parent != 0; left = left-&gt;prev)</td> </tr></table><span class="postbody">That way we look for a link that doesn't correspond to any object.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63436 - gbawiz - Tue Dec 13, 2005 3:07 am</h4>
    <div class="postbody"><span class="postbody">Back again,
<br/>
I will start the program by creating an array of sectorlinks corresponding to the various sectors available:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">sectorlink sectors[MAX_X][MAX_Y];</td> </tr></table><span class="postbody">
<br/>
The above should create a 2D array of sector 'heads' but Im not too sure whether or not it should create an array of pointers to sectorlinks called sectors i.e:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">sectorlink *sectors[MAX_X][MAX_Y];</td> </tr></table><span class="postbody">
<br/>
<br/>
The problem arises when I have to add a new entry (add a new node) to the sector list, this means that I am leaving out the sector head. Seems like a waste.
<br/>
<br/>
Then create an array of objects:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">object[MAX_OBJECTS];</td> </tr></table><span class="postbody">
<br/>
I have difficulty grasping the concept of the 4 (assuming 4 sectors max at one time) sectorlink links within the object struct.
<br/>
<br/>
Looking at it from the 'struct object' view, it would seem that the 4 sectorlink links are an offshoot from the object in question, how do the other objects link into this objects sector-links and how does the main sectors tie in with these also.
<br/>
<br/>
Thanks</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63437 - sajiimori - Tue Dec 13, 2005 3:42 am</h4>
    <div class="postbody"><span class="postbody">What seems like a waste?  Creating an array of SectorLinks instead of pointers?  Try it with pointers then, and see if you run into any obstacles.  (I have one in mind, but encountering the problem yourself will help you understand it better.)
<br/>
<br/>
Try to actually write addToSector so you can find out which part you're missing.
<br/>
<br/>
Also, if you haven't worked with linked lists before, please practice with those before continuing.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63504 - gbawiz - Tue Dec 13, 2005 8:35 pm</h4>
    <div class="postbody"><span class="postbody">The waste I was referring to was to create and array of sector heads and then not being able to use the head for storing data, instead just adding to it using an addtosector function. Assuming that the add to sector only adds and doesn't check to see if there was anything in the sector head.
<br/>
(the sector head being created as before sectorlink sectors[MAX_X][MAX+Y] )
<br/>
<br/>
Also I was wondering what the sectorlinks stated below are filled with and how.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define MAX_SECTORS 4 
<br/>
<br/>
struct Object 
<br/>
{ 
<br/>
SectorLink sectorLinks[MAX_SECTORS]; 
<br/>
}; </td> </tr></table><span class="postbody">
<br/>
<br/>
Any new info would be helpful.
<br/>
<br/>
Thanks</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63507 - sajiimori - Tue Dec 13, 2005 8:43 pm</h4>
    <div class="postbody"><span class="postbody">They are links in the lists of objects that are in the sectors the object is in.  If you don't understand that, or if you don't know how to add objects to a list, please study linked lists.  ^_^</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63508 - gbawiz - Tue Dec 13, 2005 8:51 pm</h4>
    <div class="postbody"><span class="postbody">I can understand the idea of linked lists.
<br/>
<br/>
What I am uncertain of is what is how to choose the position to enter into these sectorlinks:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define MAX_SECTORS 4 
<br/>
<br/>
struct Object 
<br/>
{ 
<br/>
SectorLink sectorLinks[MAX_SECTORS]; 
<br/>
}; </td> </tr></table><span class="postbody">
<br/>
<br/>
I could guess that the add to sector function will create the entry into the desired sector, return an address (pointer) and then the pointer would be stored at this sectorlinks[n]
<br/>
Is this correct?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63510 - sajiimori - Tue Dec 13, 2005 9:01 pm</h4>
    <div class="postbody"><span class="postbody">I'm not sure which position you're referring to, but the order of the sectorLinks array doesn't matter, and the order of the linked lists doesn't matter, either.
<br/>
<br/>
The only work you need to do in addToSector is a few assignments to link the object into the sector's list.  Nothing is being created or destroyed (memory-wise).
<br/>
<br/>
addToSector adds objects to sectors.  When it completes, the object is added.  If you have to do some additional work afterwards to "really" add the object to the sector, then you haven't finished the implementation of addToSector.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63512 - gbawiz - Tue Dec 13, 2005 9:40 pm</h4>
    <div class="postbody"><span class="postbody">Hello,
<br/>
Thanks for the information.
<br/>
I have been reading more about the linked list.
<br/>
<br/>
Before when I was talking about creating the sector heads, creating a head that would not be used, I get what you mean when you say nothing has been created.
<br/>
For example I will use the following to define my arrays (noting the '*')
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">sectorlink *sectors[MAX_X][MAX_Y];</td> </tr></table><span class="postbody">
<br/>
<br/>
I belive that the above does not actually create anything, i.e there is no memory allocated and there is nothing stored in these arrays yet.
<br/>
I realise that this is basic pointer knowledge which seemed to have slipped my mind briefly.
<br/>
The memory would be allocated just before I add information to the sector.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63665 - gbawiz - Thu Dec 15, 2005 12:38 pm</h4>
    <div class="postbody"><span class="postbody">I tried the following code but I get the error:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">no operator defined which takes a right-hand operand of type 'struct sectorlink *' (or there is no acceptable conversion)</td> </tr></table><span class="postbody">
<br/>
I cannot immediately see what this means, any ideas?
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include&lt;stdio.h&gt;
<br/>
#include&lt;conio.h&gt;
<br/>
#include&lt;malloc.h&gt;
<br/>
#include&lt;dos.h&gt;
<br/>
<br/>
#define MAX_X 16
<br/>
#define MAX_Y 15
<br/>
#define MAX_SECTORS 4
<br/>
<br/>
<br/>
struct obj;
<br/>
<br/>
struct sectorlink{
<br/>
   obj *parent;
<br/>
   sectorlink *prev;
<br/>
   sectorlink *next;
<br/>
};
<br/>
<br/>
struct obj{
<br/>
   sectorlink sectorlinks[MAX_SECTORS];
<br/>
};
<br/>
<br/>
//-----------------------------------------------------------------
<br/>
void main()
<br/>
{
<br/>
   sectorlink sectors[MAX_X][MAX_Y];
<br/>
   printf("Hello World\n");
<br/>
   sectors[10][10]=(sectorlink*)malloc(sizeof(sectorlink));
<br/>
}</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63667 - byg - Thu Dec 15, 2005 1:10 pm</h4>
    <div class="postbody"><span class="postbody">I've just had a quick look at the code and from what I can see sectors is an array of sectorlink <span style="font-weight: bold">objects</span>, yet you are trying to allocate a sectorlink <span style="font-weight: bold">pointer</span> with the following code:
<br/>
<br/>
sectors[10][10]=(sectorlink*)malloc(sizeof(sectorlink));
<br/>
<br/>
Try changing
<br/>
sectorlink sectors[MAX_X][MAX_Y];
<br/>
<br/>
to
<br/>
<br/>
sectorlink* sectors[MAX_X][MAX_Y];<br/>_________________<br/><span style="font-weight: bold">Modasi Games</span>
<br/>
<a class="postlink" href="http://www.modasi.com/" target="_blank">www.modasi.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63713 - sajiimori - Thu Dec 15, 2005 7:40 pm</h4>
    <div class="postbody"><span class="postbody">To be blunt, I think you are not ready for this task yet.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I belive that the above does not actually create anything, i.e there is no memory allocated and there is nothing stored in these arrays yet.</td> </tr></table><span class="postbody">It most certainly does.  It creates a 2D array of pointers, each of which takes up the size of a pointer.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">The memory would be allocated just before I add information to the sector.</td> </tr></table><span class="postbody">The whole point of this scheme is to <span style="font-style: italic">avoid</span> dynamic allocation.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">sectors[10][10]=(sectorlink*)malloc(sizeof(sectorlink));</td> </tr></table><span class="postbody">You're way off base.  Please study arrays, pointers, and malloc/free.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63816 - gbawiz - Fri Dec 16, 2005 3:38 pm</h4>
    <div class="postbody"><span class="postbody">The line which I have written as:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">sectors[10][10]=(sectorlink*)malloc(sizeof(sectorlink));</td> </tr></table><span class="postbody">
<br/>
is just to test the idea of being able to allocate memory for that particular sectorlink head. Of course I will not be allocating memory in this way, I will be using a method which creates a new sectorlink (as an when required) and then assign it to the head, adjusting the necessary parameters. (it is similar to the standard linked-list 'push' function except with some modifications).
<br/>
<br/>
The other line which I mentioned:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I belive that the above does not actually create anything, i.e there is no memory allocated and there is nothing stored in these arrays yet.</td> </tr></table><span class="postbody">
<br/>
I was testing the idea of basic pointer creation. For example if a pointer was created such as int *ptr; I was simply stating that since malloc has not yet been used to allocate a memory location for this pointer, where would the pointer point to? ZERO. And the fact that I have not assigned any data to this pointer either means that nothing has been stored here.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">To be blunt, I think you are not ready for this task yet. </td> </tr></table><span class="postbody">
<br/>
Giving up is not an option. But actually I have seen through a lot of problems and have nearly got my code working now.
<br/>
I learn through the mistakes as well as the achievements.
<br/>
I can see what you mean with regards to the learning the  basic pointer stuff.
<br/>
I have used pointer many times and taken them for granted, kinda like 'they do what they do' I decided now to try and look deeper into them in order to gain solid knowledge of them.
<br/>
Anyway, I am nearly finished my code and may post the finished result.
<br/>
<br/>
Thanks</span><span class="gensmall"><br/><br/>Last edited by gbawiz on Mon Dec 19, 2005 10:46 am; edited 2 times in total</span></div>    
</div>
<div class="post">
    <h4>#63817 - byg - Fri Dec 16, 2005 3:51 pm</h4>
    <div class="postbody"><span class="postbody">I don't think sajiimori was trying to be negative. Merely stating that there is still some learning required before attempting this coding. If you need to test 'being able to allocate memory' and '...testing the idea of basic pointer creation' he is probably right. 
<br/>
<br/>
By all means don't give up! But perhaps start with a simpler problem and topic. Perhaps read through a few tutorials on pointers first.<br/>_________________<br/><span style="font-weight: bold">Modasi Games</span>
<br/>
<a class="postlink" href="http://www.modasi.com/" target="_blank">www.modasi.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63841 - sajiimori - Fri Dec 16, 2005 7:37 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">For example if a pointer was created such as int *ptr; I was simply stating that since malloc has not yet been used to allocate a memory location for this pointer, where would the pointer point to? ZERO.</td> </tr></table><span class="postbody">Not if it's local.  Anyway, the pointer has a memory location whenever it is in scope.  It's just a variable.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">And the fact that I have not assigned any data to this pointer either means that nothing has been stored here.</td> </tr></table><span class="postbody">For statics and globals, the startup code that runs before main() stores 0 in them.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Giving up is not an option.</td> </tr></table><span class="postbody">Did I say give up?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#63893 - gbawiz - Sat Dec 17, 2005 10:15 am</h4>
    <div class="postbody"><span class="postbody">No probs,
<br/>
I'll take time to adjust my code to see how it works in my main prog.
<br/>
thanks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#64062 - gbawiz - Mon Dec 19, 2005 12:54 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">#define MAX_SECTORS 4 
<br/>
<br/>
struct Object 
<br/>
{ 
<br/>
SectorLink sectorLinks[MAX_SECTORS]; 
<br/>
}; </td> </tr></table><span class="postbody">
<br/>
<br/>
Shouldn't the above look like:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">#define MAX_SECTORS 4 
<br/>
<br/>
struct Object 
<br/>
{ 
<br/>
SectorLink *sectorLinks[MAX_SECTORS]; 
<br/>
}; </td> </tr></table><span class="postbody">
<br/>
Changing 'sectorlinks' into 'pointers to sectorlinks'</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#64066 - sajiimori - Mon Dec 19, 2005 1:26 am</h4>
    <div class="postbody"><span class="postbody">Not in the system that I described.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#64097 - gbawiz - Mon Dec 19, 2005 10:45 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">Not in the system that I described.</td> </tr></table><span class="postbody">
<br/>
OK, then this must mean that your system makes use of the fact that the address of (pointer to) the sectorlinks[n] had already been allocated when creating the object types.
<br/>
When adding an object to a particular sector list, you must be using the sectorlink[n] address in that list.
<br/>
<br/>
the other way I was looking at it was when creating the link node, to allocate the memory when creating the node then set the '*sectorlinks[n]' pointer to point to this (using the * in this case).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#64130 - sajiimori - Mon Dec 19, 2005 7:15 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">OK, then this must mean that your system makes use of the fact that the address of (pointer to) the sectorlinks[n] had already been allocated when creating the object types.</td> </tr></table><span class="postbody">No.  SectorLinks are being allocated, not pointers to SectorLinks.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">the other way I was looking at it was when creating the link node, to allocate the memory when creating the node then set the '*sectorlinks[n]' pointer to point to this (using the * in this case).</td> </tr></table><span class="postbody">No.  If sectorLinks is an array of pointers, then sectorLinks[n] is a pointer, and *sectorLinks[n] is a SectorLink.
<br/>
<br/>
You need to study pointers more.  Learn what * and &amp; mean, and how the * in a declaration is totally different than the unary * operator (not to mention the binary * operator).
<br/>
<br/>
(Sometimes I wish people could start with untyped version of C that just uses words.  Then they'd see right away that it's all just numbers, and that types only enforce an interpretation.)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#64131 - sajiimori - Mon Dec 19, 2005 7:18 pm</h4>
    <div class="postbody"><span class="postbody">Also find out why a[n] is a synonym for *(a + n).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#64174 - gbawiz - Tue Dec 20, 2005 12:10 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">Also find out why a[n] is a synonym for *(a + n).</td> </tr></table><span class="postbody">
<br/>
a is the address (or base pointer) and n is the offset, each n occupies the amount of memory of the defining type.
<br/>
i.e:
<br/>
<br/>
char a[n];
<br/>
a is the first address and if n is 10 then the actual location where the info is held is a+(10 x 1byte) since char occupies 1 byte.</span><span class="gensmall"><br/><br/>Last edited by gbawiz on Tue Dec 20, 2005 12:19 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#64177 - gbawiz - Tue Dec 20, 2005 12:16 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">No. SectorLinks are being allocated, not pointers to SectorLinks. </td> </tr></table><span class="postbody">
<br/>
You misunderstood what I meant:
<br/>
<br/>
When sectorlinks are being allocated, they are given a memory location (pointer), true?
<br/>
<br/>
for example if I create:
<br/>
int n;
<br/>
I am creating a variable called n, its memory location (pointer) is automatically allocated by the program, compiler (if not then I would not be able to store anything in n, i.e n=10, it would crash the program).
<br/>
It has to be stored somewhere in memory.
<br/>
The computer will allocate a 16-bit area of memory (which will have a memory location (or pointer if you like)).
<br/>
<br/>
One question, does any part of your code make use of 'malloc' or 'new' or any other type of memory allocation code (Y/N)?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#64185 - keldon - Tue Dec 20, 2005 1:57 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int i;</td> </tr></table><span class="postbody">
<br/>
Memory is allocated on the stack when this statement appears within a function and cannot be used after the function has returned.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#64190 - sajiimori - Tue Dec 20, 2005 2:47 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">When sectorlinks are being allocated, they are given a memory location (pointer), true?</td> </tr></table><span class="postbody">Pointers are variables.  "Allocating a pointer" means allocating enough space to hold a pointer.  Allocating an object does not imply allocating a pointer to that object.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">One question, does any part of your code make use of 'malloc' or 'new' or any other type of memory allocation code (Y/N)?</td> </tr></table><span class="postbody">I've said two or three times that the design is made to avoid dynamic allocation.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#64192 - gbawiz - Tue Dec 20, 2005 2:57 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">I've said two or three times that the design is made to avoid dynamic allocation.</td> </tr></table><span class="postbody">
<br/>
I just wanted to clarify what 'dynamic allocation' meant.
<br/>
The reason I asked is that I have got my code working in one way.
<br/>
<br/>
The other way, which is what I believe the principle behind your method, is:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define MAX_XS 16
<br/>
#define MAX_YS 15
<br/>
#define MAX_SECTORS 4
<br/>
#define MAX_SPRITES 5
<br/>
#define SPR_WIDTH   8
<br/>
#define SPR_HEIGHT   8
<br/>
<br/>
struct obj;
<br/>
<br/>
struct sectorlink{
<br/>
   obj *parent;
<br/>
   sectorlink *prev;
<br/>
   sectorlink *next;
<br/>
};
<br/>
<br/>
struct obj{
<br/>
   sectorlink sectorlinks[MAX_SECTORS]; // creates an allocates sectorlinks
<br/>
   int xcoord;
<br/>
   int ycoord;
<br/>
};
<br/>
<br/>
<br/>
sectorlink *sectors[MAX_XS][MAX_YS];
<br/>
obj myspr[MAX_SPRITES];   //create sprite objects
<br/>
<br/>
<br/>
<br/>
void main()
<br/>
{
<br/>
   
<br/>
   int x,y;
<br/>
<br/>
<br/>
   //setup mysprite 0 to 1 for test purposes only
<br/>
   myspr[0].xcoord=200;
<br/>
   myspr[0].ycoord=156;
<br/>
   myspr[1].xcoord=123;
<br/>
   myspr[1].ycoord=789;
<br/>
   //----------------------------------
<br/>
<br/>
   //add all to sector 0,0 for test purposes only
<br/>
   //all set the first entry 0 as link
<br/>
   
<br/>
   //sprite 0
<br/>
   myspr[0].sectorlinks[0].parent=&amp;myspr[0];   // set the parent to point to myspr[0]
<br/>
   myspr[0].sectorlinks[0].next=sectors[0][0];   // set the next to point to the head of sector 0,0
<br/>
   sectors[0][0]=&amp;myspr[0].sectorlinks[0];      // set the new head equal to the address of sectorlink[0] (within object)
<br/>
<br/>
   //sprite 1
<br/>
   myspr[1].sectorlinks[0].parent=&amp;myspr[1];   // set the parent to point to myspr[0]
<br/>
   myspr[1].sectorlinks[0].next=sectors[0][0];   // set the next to point to the head of sector 0,0
<br/>
   sectors[0][0]=&amp;myspr[1].sectorlinks[0];      // set the new head equal to the address of sectorlink[0] (within object)
<br/>
<br/>
   //-------------------------------------------------------------------------------
<br/>
   
<br/>
   sectorlink *test=sectors[0][0];   //creates a temporary test and points it to sector[0][0] (head of)
<br/>
<br/>
   x=test-&gt;parent-&gt;xcoord;
<br/>
   y=test-&gt;parent-&gt;ycoord;
<br/>
   
<br/>
   printf("\nFirst entry's X,Y = %d,%d",x,y);
<br/>
   
<br/>
   test=test-&gt;next;
<br/>
   x=test-&gt;parent-&gt;xcoord;
<br/>
   y=test-&gt;parent-&gt;ycoord;
<br/>
   printf("\nNext entry's X,Y = %d,%d",x,y);
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#64193 - sajiimori - Tue Dec 20, 2005 3:14 am</h4>
    <div class="postbody"><span class="postbody">I see the data declarations, but I don't see any functions that implement the collision system.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#64195 - gbawiz - Tue Dec 20, 2005 3:33 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">I see the data declarations, but I don't see any functions that implement the collision system.</td> </tr></table><span class="postbody">
<br/>
<br/>
At least let me know if this is the correct method.
<br/>
The whole point of this was to work out how 'addtosector' works.
<br/>
<br/>
The collision system is part of another collection of functions. This one deals with the adding and removing of objects from sectors.
<br/>
Also, the code used to remove an object from a sectorlist has to be modified to take into account the situation where the 'head' of the list is removed.</span><span class="gensmall"><br/><br/>Last edited by gbawiz on Fri Dec 30, 2005 12:38 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#64209 - sajiimori - Tue Dec 20, 2005 6:32 am</h4>
    <div class="postbody"><span class="postbody">It will become more clear as you put more things together.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#65100 - sajiimori - Fri Dec 30, 2005 2:33 am</h4>
    <div class="postbody"><span class="postbody">Instead of having your collide function just return true or false for whether there was a collision, have it return what kind of collision happened.</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">enum CollideResult
<br/>
{
<br/>
  COLLIDE_NONE,
<br/>
  COLLIDE_X,
<br/>
  COLLIDE_Y,
<br/>
  COLLIDE_BOTH
<br/>
};
<br/>
<br/>
CollideResult collide(const Object*, const Vector2* motion);</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#65146 - gbawiz - Fri Dec 30, 2005 5:16 pm</h4>
    <div class="postbody"><span class="postbody">Hello ALL,
<br/>
Take the scenario where I have a sprite which can be controlled to move in all eight directions (up,down,left,right and diagonals).
<br/>
The directions are set as Xdir and Ydir being either -1 or 1 (or 0 if stationary).
<br/>
<br/>
There is a wall to the left of the sprite and the sprite is heading diagonally up/left towards the wall and up at the same time, this means that the direction is set as xdir=-1, ydir=-1.
<br/>
The directions are added to the current x and y coords and then tested for collision.
<br/>
<br/>
If collision then the x and y coords are restored and the direction is set to zero, otherwise the new position is kept.
<br/>
<br/>
The problem is that when the directions of -1,-1 are applied and the sprite collides with the left wall, the sprite is stopped in its tracks, even although upwards movement is available.
<br/>
even although sprite is moving up/left and collides wit the wall on the left, I want sprite to still be able to move upwards while pressing up/left.
<br/>
<br/>
I got around this method by applying and testing the X and Y movements separately like this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">Get X and Y directions (can be -1,0,+1)
<br/>
<br/>
add Xdir to sprites Xcoord
<br/>
test for collision with wall
<br/>
if collide then restore sprite X coord and set Xdirection to 0
<br/>
<br/>
add Ydir to sprites Ycoord
<br/>
test for collision with wall
<br/>
if collide then restore sprite Y coord and set Ydirection to 0</td> </tr></table><span class="postbody">
<br/>
<br/>
Im not too happy with this because there are two collision tests for this one sprite.
<br/>
<br/>
<br/>
Any suggestions from anyone?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#65167 - sajiimori - Fri Dec 30, 2005 9:29 pm</h4>
    <div class="postbody"><span class="postbody">Did you not like my solution, or would you rather play games than make them?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#65173 - gbawiz - Fri Dec 30, 2005 10:25 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">Did you not like my solution, or would you rather play games than make them?</td> </tr></table><span class="postbody">
<br/>
<br/>
I would like someone else's objective on this subject instead of this type of arrogant and abusive nonsense which I have come to expect from you.
<br/>
<br/>
Do not post anymore of this rubbish!!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#65176 - keldon - Fri Dec 30, 2005 10:47 pm</h4>
    <div class="postbody"><span class="postbody">Sajimori's solution is fine whether you like his approach of speech or not. I (in the past) achieved this result by handling movement for left, up, right and down seperate. If the player was holding up and right then first I try to move him up and if it collides I will move him back and so on.
<br/>
<br/>
My solution is not good and Sajimori's idea is much better; but you did ask for another take.
<br/>
<br/>
I am not sure how you are doing collision. If you are doing it with vectors for each edge of the bounding box then returning the CollideResult value is easy right? If you are using a bound box then it is the same case too.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#65180 - poslundc - Fri Dec 30, 2005 11:54 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>gbawiz wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">Did you not like my solution, or would you rather play games than make them?</td> </tr></table><span class="postbody">
<br/>
<br/>
I would like someone else's objective on this subject instead of this type of arrogant and abusive nonsense which I have come to expect from you.
<br/>
<br/>
Do not post anymore of this rubbish!!</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Dude, I'm still trying to figure out how he managed to answer your exact question in the post <span style="font-style: italic">before</span> you asked it. That's not rubbish; that's skill.
<br/>
<br/>
The least you could do is try out the solution he gave you and <span style="font-style: italic">then</span> post either why you couldn't get it to work, or why you don't think it solves your problem effectively, or what you don't understand about it, etc. It doesn't exactly inspire the rest of us to come your aid when you demonstrate an unwillingness to pay attention to the help you're given. For the record, you are swimming in the deep end when you still need more practice in the shallow end, and most of us aren't generous enough to give half the help that sajimori has given you so far when that's the case.
<br/>
<br/>
And sajimori: try to be nice. :D
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#65181 - sajiimori - Sat Dec 31, 2005 12:01 am</h4>
    <div class="postbody"><span class="postbody">As much as I'd like to claim that I have ESP, the simpler explanation is that he erased his post and re-posted it after I answered, possibly to trick people into thinking that the question wasn't answered.
<br/>
<br/>
Incidentally, that explains my snarky wording.  :P</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
