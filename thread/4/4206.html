<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>DevKitAdvance R8 - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > DevKitAdvance R8</h2>
<div id="posts">
<div class="post">
    <h4>#27409 - SmegPlaza - Tue Oct 12, 2004 1:44 pm</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
First of all let me say I am not a noob. I have years of experience of coding on various platforms, including PC and Amiga, and am equally happy using command line driven tools as I am using an IDE like Visual C++.
<br/>
<br/>
But for some reason I am having great difficulty getting DevKitAdvance to do what I want it to do... So much so that I am almost at the point of giving up on it and moving to something else.
<br/>
<br/>
I am, I think, sufficiently modest, to believe that it must be me that's doing something wrong, because plenty of other people seem to have far fewer problems.
<br/>
<br/>
I have a project which I am trying to port to the GBA, written in mixed C and assembly language, so I am trying to get it to build using a makefile rather than the batch file commonly used for simpler projects.
<br/>
<br/>
Compilation and assembly of my source files is no problem - everything compiles and assembles just fine. Linking is where I have all my issues, and they all seem to revolve around symbols and functions from the run-time and support libraries i.e. not my code.
<br/>
<br/>
There seem to be so many different versions of the run-time support libraries crt0.o and libc.a, for example, even given the ARM/THUMB distinctions, that I'm not sure I am linking with the correct version.
<br/>
<br/>
So my question is simple :)
<br/>
<br/>
Can anyone please tell me, for a THUMB-only build, for example, *exactly* which versions of crt0.c, libc.a and libgcc.a I should be linking with ?
<br/>
<br/>
An example makefile for for a non-trivial application would be useful as well ;)
<br/>
<br/>
Thanks in advance,
<br/>
Smeg</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27416 - Abscissa - Tue Oct 12, 2004 3:18 pm</h4>
    <div class="postbody"><span class="postbody">Well, for one thing, you should use DevKitARM instead of DevKitAdvance.  DevKitAdvance hasn't been updated in a long time and seems to be abandoned.  You can find DevKitARM at <a href="http://www.devkit.tk" target="_blank">http://www.devkit.tk</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27417 - tepples - Tue Oct 12, 2004 3:39 pm</h4>
    <div class="postbody"><span class="postbody">The "R8" (rather than "R5 beta 3") seems to make me think that SmegPlaza is talking about devkitARM but saying DevKit Advance.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27468 - SmegPlaza - Wed Oct 13, 2004 4:07 pm</h4>
    <div class="postbody"><span class="postbody">Yes guys, it is DevKitARM R8... my mistake :)
<br/>
<br/>
Smeg</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27471 - DiscoStew - Wed Oct 13, 2004 6:20 pm</h4>
    <div class="postbody"><span class="postbody">What are the libraries compiled with? Just a guess since I don't know how the format goes when code is compiled into OBJ and library files, but I'm thinking that the libraries you have may not be compatible with the ARM7 CPU that the GBA has. Remember, it's just a guess since I saw the word "port" along with "libraries", but I'm probably wrong. Reminds me of using OBJ files made by Borland compilers to use in MS VC++, which doesn't work.
<br/>
<br/>
As for linking files like crt0.o and libc.a, I don't have any of that in my project folders, so I'm assuming that these are added by default from the DevKitARM folder.
<br/>
<br/>
I could show you the makefile that I have if you'd like. It allows for adding libraries, and splitting source files to be put into IWRAM/ARM or ROM/THUMB, and even making a multiboot ROM with a single change. It is a modified version of another makefile that I found, so I can't take all the credit. Ask, and ye shall receive.<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27478 - SmegPlaza - Wed Oct 13, 2004 8:52 pm</h4>
    <div class="postbody"><span class="postbody">Discostew,
<br/>
<br/>
That would be very helpful, thank you !
<br/>
I've been tearing my hair out with this, cos it *should* be easy !!!
<br/>
<br/>
Cheers bud,
<br/>
Smeg
<br/>
<br/>
PS. Should I be using the tools &amp; libs in the 'arm-elf' directory, or the ones in the bin and lib dirs ???</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27481 - DiscoStew - Wed Oct 13, 2004 9:38 pm</h4>
    <div class="postbody"><span class="postbody">The makefile shown here is what I use for my GBA development, which I use VS.net as my IDE.  It also adds the AAS library made by jd for the audio department. I believe you have already looked how to set up DevKitARM from its main <a class="postlink" href="http://www.devkit.tk" target="_blank">website</a>, so I'll skip that. You'll need to change the PATH symbol to whereever you installed DevKitARM, but make sure it has"\bin" because that is where the tools are. Then all you'll need to do is copy this code into a makefile called "Makefile", no extension. In your individual project folder, create "src" and "header" folders, and place all source code (c, cpp, s) into "src", and all headers into "header". If you want to add libraries, follow the examples I placed in here on how to add them. If you are making a C++ project, replace the LD symbol with the other. That should be it. Hopefully you get your stuff working.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#---------------------------------------------------------------------------------
<br/>
.SUFFIXES:
<br/>
#---------------------------------------------------------------------------------
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# TARGET is the name of the output, if this ends with _mb generates a multiboot image
<br/>
# BUILD is the directory where object files &amp; intermediate files will be placed
<br/>
# SOURCES is a list of directories containing source code
<br/>
# INCLUDES is a list of directories containing extra header files
<br/>
#---------------------------------------------------------------------------------
<br/>
TARGET      :=   Test
<br/>
BUILD      :=   build
<br/>
SOURCES      :=   src
<br/>
INCLUDES   :=   header
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# options for code generation
<br/>
#---------------------------------------------------------------------------------
<br/>
<br/>
CFLAGS   :=   -mthumb-interwork -Wall -mcpu=arm7tdmi -mtune=arm7tdmi \
<br/>
         -fomit-frame-pointer -ffast-math -mapcs-32 -fno-exceptions -std=c99
<br/>
         
<br/>
THUMB   :=   -mthumb -O3 -ffixed-r14 -funroll-loops
<br/>
ARM      :=   -marm -O3 -mlong-calls
<br/>
ASFLAGS   :=   -mthumb-interwork
<br/>
<br/>
LDFLAGS   =   -mthumb-interwork
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# place any libraries to be used here, one row per library would be best
<br/>
#---------------------------------------------------------------------------------
<br/>
<br/>
#LIBNAME   :=   ..//LibNAME
<br/>
LIBAAS   :=   ../LibAAS
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# other commands for libraries we wish to link with the project
<br/>
#---------------------------------------------------------------------------------
<br/>
#LIBS   :=   -lNAME -lNAME2 -lNAME3
<br/>
LIBS   :=   -lAAS
<br/>
<br/>
#LIBDIRS   :=   $(LIBNAME) $(LIBNAME2) $(LIBNAME3)
<br/>
LIBDIRS   :=   $(LIBAAS)
<br/>
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# path to tools - this can be deleted if you set the path in windows
<br/>
#---------------------------------------------------------------------------------
<br/>
export PATH      :=   /c/GBA/DevKitARM/bin:/bin:/c/bin
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# the prefix on the compiler executables
<br/>
#---------------------------------------------------------------------------------
<br/>
PREFIX         :=   arm-elf-
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# no real need to edit anything past this point unless you need to add additional
<br/>
# rules for different file extensions
<br/>
#---------------------------------------------------------------------------------
<br/>
ifneq ($(BUILD),$(notdir $(CURDIR)))
<br/>
#---------------------------------------------------------------------------------
<br/>
<br/>
export OUTPUT   :=   $(CURDIR)/$(TARGET)
<br/>
<br/>
export VPATH   :=   $(foreach dir,$(SOURCES),$(CURDIR)/$(dir))
<br/>
<br/>
export CC      :=   $(PREFIX)gcc
<br/>
export CXX      :=   $(PREFIX)g++
<br/>
export AR      :=   $(PREFIX)ar
<br/>
export AS      :=  $(PREFIX)as
<br/>
export OBJCOPY   :=   $(PREFIX)objcopy
<br/>
#---------------------------------------------------------------------------------
<br/>
# use CXX for linking C++ projects, CC for standard C
<br/>
#---------------------------------------------------------------------------------
<br/>
#export LD      :=   $(CXX)
<br/>
export LD      :=   $(CC)
<br/>
<br/>
BINFILES   :=   $(foreach dir,$(SOURCES),$(notdir $(wildcard $(dir)/*.bin)))
<br/>
CFILES      :=   $(foreach dir,$(SOURCES),$(notdir $(wildcard $(dir)/*.c)))
<br/>
CPPFILES   :=   $(foreach dir,$(SOURCES),$(notdir $(wildcard $(dir)/*.cpp)))
<br/>
SFILES      :=   $(foreach dir,$(SOURCES),$(notdir $(wildcard $(dir)/*.s)))
<br/>
<br/>
<br/>
BINOBJS   := $(BINFILES:.bin=.o)
<br/>
COBJS   := $(CFILES:.c=.o)
<br/>
CPPOBJS   := $(CPPFILES:.cpp=.o)
<br/>
SOBJS   := $(SFILES:.s=.o)
<br/>
<br/>
<br/>
export OFILES   :=   $(BINOBJS) $(COBJS) $(CPPOBJS) $(SOBJS)
<br/>
<br/>
export INCLUDE   :=   $(foreach dir,$(INCLUDES),-I$(CURDIR)/$(dir)) \
<br/>
               $(foreach dir,$(LIBDIRS),-I$(dir))   \
<br/>
               -I$(CURDIR)/$(BUILD)
<br/>
<br/>
export LIBPATHS   :=   $(foreach dir,$(LIBDIRS),-L$(dir))
<br/>
<br/>
.PHONY: $(BUILD) clean
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
$(BUILD):
<br/>
   @[ -d $@ ] || mkdir -p $@
<br/>
   @make --no-print-directory -C $(BUILD) -f $(CURDIR)/Makefile
<br/>
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
clean:
<br/>
   @echo clean ...
<br/>
   @rm -fr $(BUILD) *.elf
<br/>
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
else
<br/>
<br/>
DEPENDS   :=   $(OFILES:.o=.d)
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# main targets
<br/>
#---------------------------------------------------------------------------------
<br/>
$(OUTPUT).gba   :   $(OUTPUT).elf
<br/>
<br/>
$(OUTPUT).elf   :   $(OFILES)
<br/>
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
%.gba: %.elf
<br/>
   @echo built ... $(notdir $@)
<br/>
   @$(OBJCOPY) -O binary $&lt; $@
<br/>
   @gbafix $@
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
%_mb.elf:
<br/>
   @echo linking multiboot
<br/>
   @$(LD) -specs=gba_mb.specs $(LDFLAGS) $(OFILES) $(LIBPATHS) $(LIBS) -o $@
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
%.elf:
<br/>
   @echo linking cartridge
<br/>
   @$(LD)  -specs=gba.specs $(LDFLAGS) $(OFILES) $(LIBPATHS) $(LIBS) -o $@
<br/>
<br/>
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# Compile Targets for C/C++/ASM
<br/>
#---------------------------------------------------------------------------------
<br/>
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
%.iwram.o : %.iwram.c
<br/>
   @echo $(notdir $&lt;)
<br/>
   @$(CC) $(ARM) $(CFLAGS) $(INCLUDE) -c $&lt; -o $@
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
%.o : %.c
<br/>
   @echo $(notdir $&lt;)
<br/>
   @$(CC) $(THUMB) $(CFLAGS) $(INCLUDE) -c $&lt; -o $@
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
%.iwram.o : %.iwram.cpp
<br/>
   @echo $(notdir $&lt;)
<br/>
   @$(CC) $(ARM) $(CFLAGS) $(INCLUDE) -c $&lt; -o $@
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
%.o : %.cpp
<br/>
   @echo $(notdir $&lt;)
<br/>
   @$(CC) $(THUMB) $(CFLAGS) $(INCLUDE) -c $&lt; -o $@
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
%.o : %.s
<br/>
   @echo $(notdir $&lt;)
<br/>
   @$(AS) $(ASFLAGS) $&lt; -o $@
<br/>
   
<br/>
<br/>
#---------------------------------------------------------------------------------------
<br/>
define bin2o
<br/>
   cp $(&lt;) $(*).tmp
<br/>
   $(OBJCOPY) -I binary -O elf32-littlearm -B arm \
<br/>
   --rename-section .data=.rodata,readonly,data,contents \
<br/>
   --redefine-sym _binary_$*_tmp_start=$*\
<br/>
   --redefine-sym _binary_$*_tmp_end=$*_end\
<br/>
   --redefine-sym _binary_$*_tmp_size=$*_size\
<br/>
   $(*).tmp $(@)
<br/>
   echo "extern const u8" $(*)"[];" &gt; $(*).h
<br/>
   echo "extern const u32" $(*)_size[]";" &gt;&gt; $(*).h
<br/>
   rm $(*).tmp
<br/>
endef
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
%.o : %.bin
<br/>
#---------------------------------------------------------------------------------
<br/>
   @echo $(notdir $&lt;)
<br/>
   @$(bin2o)
<br/>
<br/>
-include $(DEPENDS)
<br/>
<br/>
#---------------------------------------------------------------------------------------
<br/>
endif
<br/>
#---------------------------------------------------------------------------------------
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27485 - SmegPlaza - Wed Oct 13, 2004 10:22 pm</h4>
    <div class="postbody"><span class="postbody">Thanks DiscoStew.
<br/>
You've been a great help...
<br/>
<br/>
Smeg</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
