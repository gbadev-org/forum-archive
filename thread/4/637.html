<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Sleepmode - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Coding > Sleepmode</h2>
<div id="posts">
<div class="post">
    <h4>#3267 - jenswa - Fri Feb 21, 2003 12:44 pm</h4>
    <div class="postbody"><span class="postbody">How to put the gba into sleepmode ?
<br/>
<br/>
it's with calling a bios function and setting an irq interrupt or something.
<br/>
<br/>
But i don't know how to do that, can somebody help me?
<br/>
<br/>
bye
<br/>
<br/>
tha J<br/>_________________<br/>It seems this wasn't lost after all.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#3839 - Kay - Mon Mar 10, 2003 12:40 pm</h4>
    <div class="postbody"><span class="postbody">To do so you've to set bit 7 ($80) at $4000301.
<br/>
The CPU is then in suspend mode until the next IRQ occurs.
<br/>
WARINING: don't forgett to set interrupts before, otherwise CPU activity will be completely halted.
<br/>
Nintendo recommends to set this byte after all VBL tasks are proceeded, in order too save battery power.
<br/>
<br/>
<br/>
-- Kay.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#3857 - NEiM0D - Mon Mar 10, 2003 10:25 pm</h4>
    <div class="postbody"><span class="postbody">it's swi 2 or 3 can't remember it that quite</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#3887 - jenswa - Tue Mar 11, 2003 8:30 pm</h4>
    <div class="postbody"><span class="postbody">swi 2 = halt
<br/>
swi 3 = stop,
<br/>
<br/>
but the problem actually is that i don't know how to call
<br/>
them from c/c++<br/>_________________<br/>It seems this wasn't lost after all.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#3899 - Quirky - Wed Mar 12, 2003 8:57 am</h4>
    <div class="postbody"><span class="postbody">You can just do this. (Untested, but I use a vblank_wait routine that looks identical except the 2 is a 5)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void halt(void) {
<br/>
  asm volatile("swi 0x20000"); 
<br/>
}</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4198 - tepples - Sun Mar 23, 2003 5:42 am</h4>
    <div class="postbody"><span class="postbody">Currently, here's how I have reasoned how to put the GBA to sleep:
<br/>
<br/>
1. Disable sound.
<br/>
2. Disable all interrupts but the joypad interrupt.
<br/>
3. Wait for vblank.
<br/>
4. Disable video (force blank).
<br/>
5. Wait for 2 vblanks (so as not to produce any fading horizontal line artifacts).
<br/>
6. Call swi 0x03 ("Stop")
<br/>
7. Reinitialize video.
<br/>
8. Reinitialize interrupts.
<br/>
9. Reinitialize sound.
<br/>
10. Resume game engine.
<br/>
<br/>
Will this work as expected? Have I left out a major source of power drain?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4911 - delbogun - Mon Apr 14, 2003 10:36 pm</h4>
    <div class="postbody"><span class="postbody">This is probably a stupid question, but how do I return from sleep mode and how do I turn on/off LCD and Sound?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4922 - tepples - Tue Apr 15, 2003 12:23 am</h4>
    <div class="postbody"><span class="postbody">To get out of sleep mode: Set the joypad interrupt control register to trigger an interrupt on Select+Start, and install an interrupt handler. The sleep SWI will handle everything from there.  And I've found out that you don't need to disable sound; swi 3 takes care of everything for you.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4927 - TooTall - Tue Apr 15, 2003 1:38 am</h4>
    <div class="postbody"><span class="postbody">Is the sleep mode to save computations or for a screen saver type thing when nothing has been pressed for a while.  just wunderin'.
<br/>
<br/>
TT<br/>_________________<br/>Knowledge speaks, wisdom listens.
<br/>
-Jimi Hendrix</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4928 - Daikath - Tue Apr 15, 2003 1:58 am</h4>
    <div class="postbody"><span class="postbody">To save batteries if your not at a savepoint yet. Or where you can't save some stuff.<br/>_________________<br/>?There are no stupid questions but there are a LOT of inquisitive idiots.?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#4936 - delbogun - Tue Apr 15, 2003 11:33 am</h4>
    <div class="postbody"><span class="postbody">I can't seem to make my interrupts work. I saw at dovoto's tutorial that I need to change crt0.s. I downloaded this file and changed it, but how do I use it? Should I copy that file to C:\devkitadv\ or in my project directory? Is there something I must add in my make.bat file?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#13004 - thorgull - Wed Dec 03, 2003 12:48 pm</h4>
    <div class="postbody"><span class="postbody">well, it seems that halt and stop don't work on EZ-Flash Card  (I have EZ-Flash Power Star).
<br/>
<br/>
does someone know why ?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#13007 - torne - Wed Dec 03, 2003 1:25 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>thorgull wrote:</b></span></td> </tr> <tr> <td class="quote">well, it seems that halt and stop don't work on EZ-Flash Card  (I have EZ-Flash Power Star).
<br/>
<br/>
does someone know why ?</td> </tr></table><span class="postbody">
<br/>
<br/>
Halt and stop have nothing to do with the cartridge. If it doesn't work, then the problem is elsewhere.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#13017 - thorgull - Wed Dec 03, 2003 7:06 pm</h4>
    <div class="postbody"><span class="postbody">hum... I don't think so...
<br/>
<br/>
why sleep of backup of an original game (GoldenSun) doesn't work.
<br/>
<br/>
game go to sleepmode (screen turn off) and return imediatly... (no no,... I don't press L &amp; R)
<br/>
<br/>
is it possible that the bootloader of the ezflash generate interrupt that keep CPU awake ? (this is the only idea i have)
<br/>
<br/>
<br/>
<br/>
and the folowing home-made code (using Register instead of interrupt) does't work.... can you say me what is wrong ? 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
...
<br/>
     REG_IME=0;
<br/>
      REG_IE= INT_KEY;
<br/>
      REG_P1CNT= KEY_L|KEY_R|KEY_INT|KEY_INT_ALL;
<br/>
      INT_HANDLER= (u32)&amp;InterruptHandler;
<br/>
      REG_IME=1;
<br/>
      in_vsync();
<br/>
      REG_DISPCNT=FORCE_BLANK;
<br/>
      in_vsync();in_vsync();
<br/>
      REG_HALTCNT_H=0x80;
<br/>
...
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
a last question... is there an emu that handle halt and stop (for testing)</span><span class="gensmall"><br/><br/>Last edited by thorgull on Wed Dec 03, 2003 9:11 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#13023 - torne - Wed Dec 03, 2003 9:11 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>thorgull wrote:</b></span></td> </tr> <tr> <td class="quote">is it possible that the bootloader of the ezflash generate interrupt that keep CPU awake ? (this is the only idea i have)</td> </tr></table><span class="postbody">
<br/>
<br/>
No, the bootloader isn't running once the game is started. All interrupts are reset and controlled by the game.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">and the folowing home-made code (using Register instead of interrupt) does't work.... can you say me what is wrong ?</td> </tr></table><span class="postbody">
<br/>
<br/>
Never tried to do it except with SWI.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">a last question... is there an emu that handler halt and stop (for testing)</td> </tr></table><span class="postbody">
<br/>
<br/>
VBA and No$GBA both handle halt, afaik. (No$ definately does)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
