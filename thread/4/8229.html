<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Script system. - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Coding > Script system.</h2>
<div id="posts">
<div class="post">
    <h4>#68121 - ProblemBaby - Sun Jan 22, 2006 6:52 pm</h4>
    <div class="postbody"><span class="postbody">Hello
<br/>
<br/>
Iam planning to make a small script language I can use for the DS. Because everything have to be put in the bin anyway, I think its best to have pure code instead of an action based script. So my first question is
<br/>
it possible to compile ASM code like:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
LDR r0, [r7]
<br/>
ADD r0, r0, #1
<br/>
STR r0, [r7]
<br/>
POP { r0-r7, pc }
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
and as output just get the opcodes, no ELF, no linking, just pure code.
<br/>
Further I thinked it would be a waste of time to make my own language if it would be possible to compile C-Code in the same way.
<br/>
<br/>
Thanks</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#68128 - sajiimori - Sun Jan 22, 2006 7:22 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Because everything have to be put in the bin anyway, I think its best to have pure code instead of an action based script.</td> </tr></table><span class="postbody">By "pure code" and "action based script," I assume you mean ARM opcodes and interpreted bytecodes.  If so, there are two main benefits of interpreted bytecodes: they can be specialized for a particular purpose which makes them more compact, and they can be made platform-independent.  Whether these benefits are compelling depends on the project.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">So my first question is it possible to compile ASM code ... and as output just get the opcodes, no ELF, no linking, just pure code.</td> </tr></table><span class="postbody">But "pure code" is exactly what you get when you create a .bin the usual way.  The fact that the intermediate stages involve linkers and ELF files doesn't make any difference -- you start with source code and end with a raw binary.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#68146 - ProblemBaby - Sun Jan 22, 2006 8:47 pm</h4>
    <div class="postbody"><span class="postbody">I forgot several things when I wrote the makefile! Now it works for ASM-code how about c-code, when I try to compile I get: crt0.o no such file or directory, why?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#68176 - sajiimori - Sun Jan 22, 2006 11:37 pm</h4>
    <div class="postbody"><span class="postbody">At this point, I don't really know what you're trying to do or how you're trying to do it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#68179 - keldon - Sun Jan 22, 2006 11:49 pm</h4>
    <div class="postbody"><span class="postbody">A scripting language is very easy to implement. Much easier than I am guessing you imagine it is.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#68314 - Miked0801 - Mon Jan 23, 2006 7:49 pm</h4>
    <div class="postbody"><span class="postbody">Scripting system 101 - can also double as a Finite State Machine in a pinch.  Untested, but you get the general idea of how it works.  Easily extensible.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
typedef void (*SCRIPT_FUNCTIONS) (u32 param);
<br/>
<br/>
// Add commands here
<br/>
typedef enum
<br/>
{
<br/>
   COMMAND_ADD_ITEM
<br/>
   COMMAND_FLASH_SPRITE
<br/>
  
<br/>
   COMMAND_MAX
<br/>
} SCRIPT_COMMAND;
<br/>
<br/>
// Prototype script functions here
<br/>
static void ScriptAddItem(u32 param);
<br/>
static void ScriptFlashSprite(u32 param);
<br/>
<br/>
// Add functions to table here
<br/>
static const SCRIPT_FUNCTIONS ScriptCommandTab[COMMAND_MAX] = 
<br/>
{
<br/>
    ScriptAddItem,
<br/>
    ScriptFlashSprite,
<br/>
};
<br/>
<br/>
// Main script run routine
<br/>
void scriptRun(SCRIPT_COMMAND command, u32 param)
<br/>
{
<br/>
    ASSERT(command &lt; COMMAND_MAX);
<br/>
<br/>
    ScriptCommandTab[command](param);
<br/>
}
<br/>
<br/>
// Helper functions start here
<br/>
static void ScriptAddItem(u32 param)
<br/>
{
<br/>
    // Do add item code
<br/>
}
<br/>
<br/>
static void ScriptFlashSprite(u32 param)
<br/>
{
<br/>
    // Do flash sprite code
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#68458 - ProblemBaby - Tue Jan 24, 2006 7:53 pm</h4>
    <div class="postbody"><span class="postbody">Yeah, but I need a 'not just function calling'-script. It turns out to a total mess when you have about 100 source files, I want something external that takes care of characters, dialogues etc.
<br/>
<br/>
I think the already existing game scripts runs to slow. The ultimate solution would be if I could use C as the scripting langauge and compile the file separatly and then send the file as a parameter to my runScript function and then have a buffer where I put the variables/functions, that I can load to the script. Would it be possible to do?
<br/>
<br/>
Its so hard to explain in english!
<br/>
hope the script example makes it a bit clearer.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
// my Script
<br/>
extern s32 xPlayer = LoadVar(0);
<br/>
extern s32 yPlayer = LoadVar(1);
<br/>
extern void SetCameraPos(s32 x, s32 y) = LoadFunc(2);
<br/>
<br/>
void Script()
<br/>
{
<br/>
<br/>
if (xPlayer &lt; 20)
<br/>
    xPlayer++;
<br/>
SetCameraPos(xPlayer, 8);
<br/>
// etc..
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#68462 - sajiimori - Tue Jan 24, 2006 8:16 pm</h4>
    <div class="postbody"><span class="postbody">What's wrong with just writing the code and linking it in normally?  Are you concerned about code size?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#68464 - ProblemBaby - Tue Jan 24, 2006 8:40 pm</h4>
    <div class="postbody"><span class="postbody">1. 1000 source files in the project (a lot of prototypes etc = mess)
<br/>
2. Ive to recompile all files if I do something in a header it uses.
<br/>
3. Its much more clean to refer to scripts as "files" instead of function calls.
<br/>
<br/>
Of course its most to keep it clean! I can't imagine that a large rpg have their scripts as normally linked source files.
<br/>
<br/>
I succeeded to write this kind of code in ASM, just write some instructions and got the opcode output. but not in C, how can I compile something like this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void IDontCareAlwaysInterpretThisAsTheStart(SCRIPT_STRUCT *scrStruct)
<br/>
{
<br/>
scrStruct-&gt;x++;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
and just get the opcode output like:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
LDR r1, [r0]
<br/>
ADD r1, r1, #1
<br/>
STR r1, [r0]
<br/>
POP { pc }
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#68465 - sajiimori - Tue Jan 24, 2006 9:32 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">1. 1000 source files in the project (a lot of prototypes etc = mess)</td> </tr></table><span class="postbody">If I understand your intent correctly, it sounds like you'll have the same number of source files either way.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">2. Ive to recompile all files if I do something in a header it uses.</td> </tr></table><span class="postbody">Don't include the headers globally.  Include them in a single .c file that will serve as the proxy interface to all scripts.  Then if you change a header, only the proxy gets recompiled.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">3. Its much more clean to refer to scripts as "files" instead of function calls.</td> </tr></table><span class="postbody">Not in any objective way.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Of course its most to keep it clean! I can't imagine that a large rpg have their scripts as normally linked source files.</td> </tr></table><span class="postbody">There's no point in being abnormal for its own sake.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#68472 - Miked0801 - Tue Jan 24, 2006 10:11 pm</h4>
    <div class="postbody"><span class="postbody">So take my example 1 step further and have an external program store "byte codes" for the scripts - then pass those byte codes into the function table pointer.  That is basically how the last few RPGs I worked on handled scripting.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#68497 - ProblemBaby - Wed Jan 25, 2006 2:36 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
If I understand your intent correctly, it sounds like you'll have the same number of source files either way
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
No.
<br/>
GreenBlob.c
<br/>
BlueBlob.c
<br/>
CastleOfDawn_BrownSpearKnight.c
<br/>
Forest_BrownSpearKnight.c (this one doesnt act like the one in the castle)
<br/>
etc..
<br/>
Putting all this kind of characters update code in one file is not a good idea and the names will be so complex.
<br/>
Scripting such things makes it so much easier to work with.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
So take my example 1 step further and have an external program store "byte codes" for the scripts - then pass those byte codes into the function table pointer. That is basically how the last few RPGs I worked on handled scripting.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I want something more out of my script or do you have actions like 'if'
<br/>
a such action have to make a lot of if-tests to see what kind of condition, variable/constant etc. thats a real waste.
<br/>
<br/>
isnt it possible to compile C-code like ASM-code and just get the raw output. or do Ive to write my own C-&gt;ASM converter.
<br/>
<br/>
Do you still dont see my aim?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#68504 - ProblemBaby - Wed Jan 25, 2006 4:32 am</h4>
    <div class="postbody"><span class="postbody">Ive find out to do what I want, just passing nostartupfiles to gcc and I got what I wanted.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#68508 - sajiimori - Wed Jan 25, 2006 5:17 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Putting all this kind of characters update code in one file is not a good idea and the names will be so complex.</td> </tr></table><span class="postbody">Nobody suggested that you put them in one file.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#68523 - sgeos - Wed Jan 25, 2006 9:19 am</h4>
    <div class="postbody"><span class="postbody">Why is this bad?
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">typedef void (*SCRIPT_FUNCTION) (u32 pParamCount, u32 * pParamList); </td> </tr></table><span class="postbody">
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#68533 - ProblemBaby - Wed Jan 25, 2006 12:17 pm</h4>
    <div class="postbody"><span class="postbody">sajimori: no but instead ive will have a hell lot of sourcefiles.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Why is this bad? 
<br/>
Code: 
<br/>
typedef void (*SCRIPT_FUNCTION) (u32 pParamCount, u32 * pParamList);  
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
It isnt bad, but I want to do more advanced things than just have a flow of called functions. Of course its possible to put Simple functions like: if, add, etc but that turns out to C-like language that runs about 10 times slower.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#68534 - sgeos - Wed Jan 25, 2006 12:20 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ProblemBaby wrote:</b></span></td> </tr> <tr> <td class="quote">sajimori: no but instead ive will have a hell lot of sourcefiles.</td> </tr></table><span class="postbody">
<br/>
If you make anything big you'll have a lot of source files.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ProblemBaby wrote:</b></span></td> </tr> <tr> <td class="quote">I want to do more advanced things than just have a flow of called functions.</td> </tr></table><span class="postbody">
<br/>
What do you want to do?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ProblemBaby wrote:</b></span></td> </tr> <tr> <td class="quote">that turns out to C-like language that runs about 10 times slower.</td> </tr></table><span class="postbody">
<br/>
You can translate it to C if you want to.  Then it will run just as fast as C.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#68542 - ProblemBaby - Wed Jan 25, 2006 4:32 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
You can translate it to C if you want to. Then it will run just as fast as C. 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Yeah, Ive found out how I can write it in C directly and run it without having to link it to the project, thats really nice. I dont have to mix the engine code with other stuff like dialogues, enemy controlling, forced player actions etc.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#68568 - Miked0801 - Wed Jan 25, 2006 7:29 pm</h4>
    <div class="postbody"><span class="postbody">Ok, I'm fairly confused now.  You don't want a byte-code based scripting system because it doesn't have the power of compiled code and doesn't run as fast.  I guess I am missing the point completely in why you want a scripting system.
<br/>
<br/>
Scripting systems allow non-programmer type people a chance to create a large portion of a game with external tools and very little engine exposure.  They can also be treated like a macro system to allow your engine controller (we call them actors), to do simple tasks very quickly from the code side.  Interpretation/run speed should not be a problem here -  this code is run at a very high level and not very often.
<br/>
<br/>
Can a byte lookup language have conditonals and loops?  Yes!  We have if/else/then, loops via jumps, variable assignments, and just about anything else you could want.  It codes very much like BASIC truth be told.  A scripting language can be whatever you want it to be - from straight C calls to a BASIC interpretor to even LISP if you wish.  I guess I'm confused as to what you mean be a scripting language.  I'll go re-read your original post and ponder...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#68571 - sajiimori - Wed Jan 25, 2006 7:34 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">no but instead ive will have a hell lot of sourcefiles.</td> </tr></table><span class="postbody">I'm confused, too.  First you said you didn't want to put everything in one file, now you're saying you don't want to have a lot of separate files.  What do you want?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#68585 - ProblemBaby - Wed Jan 25, 2006 10:05 pm</h4>
    <div class="postbody"><span class="postbody">Iam confused too...
<br/>
I will try to be as clear as I can.
<br/>
<br/>
Sajimori/Miked: Iam just trying to answer your questions=) Yes, first I said I dont want a hugh file linked to the project with each script as a function neither put each script in a single file and link them to the project. I want something external, something that isnt mixed with my game engine.
<br/>
<br/>
Miked: For me it doesn't care if a non-programmer understands or not  Cause I want it quite complex to make it fast.
<br/>
Maybe iam wrong but ByteCode-script for me means a table of functions and you refer to them as IDn and a parameter list. Thats fine if you dont want complex scripts (I think!). Cause... imagine an if-function
<br/>
you need several if-tests to see what kind of condition it is.
<br/>
=, &lt;, &gt;, &gt;=, &lt;=, !=, &amp;, | etc. Further is it a constant you want to check, what kind of variable, signed, unsigned, bits?
<br/>
Its a lot of code for just a simple if-test, maybe iven't really understood it.
<br/>
<br/>
Further I dont want to make my own language that translates the code to C, cause it would be much like C anyway.
<br/>
<br/>
I just want to be able to compile files outside the project, put them ROM.
<br/>
When I want to Init a Script, I just copy the script to MainRam and jumps to the position, fast, easy and the project is still manageble.
<br/>
<br/>
Iam now able to do what I want so I dont need any help so thats no problem, but it would be nice if someone could understand why I want to this.[/code]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#68601 - sajiimori - Thu Jan 26, 2006 12:20 am</h4>
    <div class="postbody"><span class="postbody">I think you're making an artificial and unnecessary mental distinction between things that are included in the ROM using the linker, and things that are included in the ROM using some other tool.  It's not that there is no difference, but using the linker doesn't cause the problems you seem to be concerned about.
<br/>
<br/>
The linker is just another tool, and not everything it touches has to be considered part of the "engine."  The distinction between "engine code" and "data" is conceptual, and not based on which tool was used to include it in the ROM.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#68609 - ProblemBaby - Thu Jan 26, 2006 1:06 am</h4>
    <div class="postbody"><span class="postbody">But what do you think I should do?
<br/>
A good system for handling all of my npcs, dialogues everything a usual script takes care of? wouldn't an usual game script language, like lua or python be slow in such limited hardware?
<br/>
if you think thats better, why?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#68612 - poslundc - Thu Jan 26, 2006 1:37 am</h4>
    <div class="postbody"><span class="postbody">No one suggested LUA or Python. They are not the same thing as a straightforward bytecode-to-jumptable interpreter (which is what most people have been suggesting you do).
<br/>
<br/>
You don't need anything as heavyweight as LUA (although there are a lot of good ideas you could take from it) and you don't need anything as lightweight as scripts compiled to native ARM code.
<br/>
<br/>
Give a function table a try. I'll wager a steak dinner your scripting barely even registers as a blip on your finished game when you profile it.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#68614 - ProblemBaby - Thu Jan 26, 2006 1:53 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
No one suggested LUA or Python. They are not the same thing as a straightforward bytecode-to-jumptable interpreter (which is what most people have been suggesting you do). 
<br/>
</td> </tr></table><span class="postbody">
<br/>
Yeah I know. But Ive also said that I need something more complex. For example a function like MoveChar isnt enough for me, I would need about 100 kinds of different MoveChar functions, maybe I can get it two 20 if I define everything like, walkability on different surfaces, weight, etc. etc, again it will end up with 2000 lines, of different actions.
<br/>
and iam afraid of things like: oh Ive to change the flyingbanana movement a bit, oh now, the dragon were affected, aargh.
<br/>
<br/>
I want to know how its done in games like Castlevania dawn of sorrow and games like that.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
You don't need anything as heavyweight as LUA (although there are a lot of good ideas you could take from it) and you don't need anything as lightweight as scripts compiled to native ARM code.
<br/>
</td> </tr></table><span class="postbody">
<br/>
No I know Ive played with c-code, and it doesnt feel real good.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#68617 - sajiimori - Thu Jan 26, 2006 2:24 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">But what do you think I should do?</td> </tr></table><span class="postbody">All things being equal, the simplest thing is to write your scripts in C and link them in normally.  To avoid excessive dependencies, access all the scripts through a single proxy module.  To avoid file management headaches, keep your script files in a separate directory.  To avoid build headaches, make your build process automatically compile and link in every file in the script folder.
<br/>
<br/>
For some projects, other approaches are better.  You might need a different approach if:
<br/>
<br/>
- ...your scripters don't know C, and have little programming experience.  A simpler language may be necessary.
<br/>
<br/>
- ...C is too low-level to write your scripts in an elegant manner.  High-level languages like Lua are nice, but C++ might be enough.
<br/>
<br/>
- ...the code uses too much memory.  Scripting languages can solve the problem, but you could also dynamically load native code using overlays or relocatable modules.  It's mostly safe to ignore this issue until it comes up because you can always convert existing code to be dynamically loaded.  It may never be necessary.
<br/>
<br/>
- ...you want to write and test code at run-time.  This is a non-issue for DS-only games, but if you port your engine to the PC, you could have an interpreted scripting language and edit code while the game is running.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#68619 - poslundc - Thu Jan 26, 2006 2:29 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ProblemBaby wrote:</b></span></td> </tr> <tr> <td class="quote">Yeah I know. But Ive also said that I need something more complex. For example a function like MoveChar isnt enough for me, I would need about 100 kinds of different MoveChar functions, maybe I can get it two 20 if I define everything like, walkability on different surfaces, weight, etc. etc, again it will end up with 2000 lines, of different actions.
<br/>
and iam afraid of things like: oh Ive to change the flyingbanana movement a bit, oh now, the dragon were affected, aargh.</td> </tr></table><span class="postbody">
<br/>
<br/>
This is why you supply parameters to your commands.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I want to know how its done in games like Castlevania dawn of sorrow and games like that.</td> </tr></table><span class="postbody">
<br/>
<br/>
On what evidence are you basing the assumption that Castlevania does things any differently from what people in this forum have been describing?
<br/>
<br/>
Why would a function table not good enough for Castlevania?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">No I know Ive played with c-code, and it doesnt feel real good.</td> </tr></table><span class="postbody">
<br/>
<br/>
Can you come up with a more substantive reason than it doesn't feel real good?
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#68628 - ProblemBaby - Thu Jan 26, 2006 2:59 am</h4>
    <div class="postbody"><span class="postbody">Sajimori: yeah, thats probably the best way! But I cant still decide if I should have a function table or code.
<br/>
I really thought my idea would be nice, but it ended up with hugh problems when I wanted to call functions from the engine. 
<br/>
First the parameters and second if I change the functiontable sent to the external code i had to recompile every script anyway!
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
This is why you supply parameters to your commands. 
<br/>
</td> </tr></table><span class="postbody">
<br/>
What I wanted to say was that I would need more complex functions then just a function called Char_Move, Char_Attack etc. cause its so different depening on what it is and I dont want to send a WalkStyle param with 20 different types. I want to have like separate functions/scripts for each kind of character.
<br/>
like this, its too haevy. its almost unnecessary to have a script.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
// script for a kind of enemy
<br/>
<br/>
// not
<br/>
0x12 0xC // Char_Move(12);
<br/>
0x13 0x16 //if (Char_CloseToPlayer())
<br/>
0x15 0xC //Char_Attack(12);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<br/>
hope it was understandable.
<br/>
<br/>
<br/>
On what evidence are you basing the assumption that Castlevania does things any differently from what people in this forum have been describing? 
<br/>
<br/>
Why would a function table not good enough for Castlevania? 
<br/>
</td> </tr></table><span class="postbody">
<br/>
I dont!
<br/>
I was more interested in how you think they had designed it. Cause its so much different kind of AI, movement styles, attacks etc.
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Can you come up with a more substantive reason than it doesn't feel real good? 
<br/>
</td> </tr></table><span class="postbody">
<br/>
I were really unclear, have you read the earlier posts? anyway that idea wasn't as good as I thought that was what I meant.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#68632 - poslundc - Thu Jan 26, 2006 3:24 am</h4>
    <div class="postbody"><span class="postbody">I think perhaps you are confusing AI with scripting. They are similar enough in purpose that it can be difficult to tell where one starts and the other ends.
<br/>
<br/>
Defining different modes and patterns to govern enemy behaviour and logic is tough to do within a script. That's the kind of thing you want to program a specific module for, and have the different states the enemy can be in a rigidly defined set, as well as a system for determining under what circumstances they will go from one state to another.
<br/>
<br/>
A script is something you might use to manually assign one of those states to an enemy, or contain instructions for the actual physical steps an enemy has to execute, once a course of action has been determined.
<br/>
<br/>
Dan.</span><span class="gensmall"><br/><br/>Last edited by poslundc on Thu Jan 26, 2006 3:25 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#68633 - DekuTree64 - Thu Jan 26, 2006 3:25 am</h4>
    <div class="postbody"><span class="postbody">ProblemBaby, I was in the exact same situation as you back when I was working on my old RPG. I didn't know exactly what a scripting system would need to do, or what kind of system to make.
<br/>
<br/>
I ended up doing it in C code. Just a function pointer table for each map, with a function for each "event". They could be triggered by stepping on map tiles, or pressing A while facing a tile or sprite. 
<br/>
<br/>
Basically I wrote a simple set of functions similar to a scripting language. For example, MapEventMoveSprite(u32 spriteID, const char *moveScript). The move script would just be a string, like "ldru" would make him walk in a circle, and the sprite ID was a #define generated by my map editor based on the name you gave the sprite.
<br/>
<br/>
Anyway, it worked, and didn't impose any limits. It saved a lot of time being able to code things in an event where I needed it, and then generalize to engine code if I ever needed the same thing again. And if the only people doing the scripting are programmers, there's really not much disadvantage aside from probably taking more ROM space than a bytecode system.
<br/>
<br/>
EDIT: I started writing this post several hours ago, but went back to working on other things. There's been lots of good discussion since then, but I guess it's still applicable :)<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#68635 - ProblemBaby - Thu Jan 26, 2006 3:46 am</h4>
    <div class="postbody"><span class="postbody">Thanks a lot for the replies!
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Defining different modes and patterns to govern enemy behaviour and logic is tough to do within a script. That's the kind of thing you want to program a specific module for, and have the different states the enemy can be in a rigidly defined set, as well as a system for determining under what circumstances they will go from one state to another. 
<br/>
<br/>
A script is something you might use to manually assign one of those states to an enemy, or contain instructions for the actual physical steps an enemy has to execute, once a course of action has been determined.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
This was really intersting cause that was the biggest thing ive thought of!
<br/>
That was the main thing why I wanted it in C, cause it would be so complicated for different kind of chars, but AI is very "level" independent (its enough with a few variables that tells how it acts) and it isnt that much kind of actions so ive to do it unique to every character.
<br/>
<br/>
DekuTree64: nice to hear some thoughts from one that have been trough the same situation.
<br/>
I think I'll write it entirly in C too. But first Ive to find out what I want to be able to support! Ivent even thinked of map triggers yet=(</span><span class="gensmall"><br/><br/>Last edited by ProblemBaby on Thu Jan 26, 2006 1:37 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#68639 - sajiimori - Thu Jan 26, 2006 5:24 am</h4>
    <div class="postbody"><span class="postbody">Personally, I've often encountered mental blocks when trying to think of every possible thing that I could want, and the best approach to accomplish all of those things, before ever writing a line of code.
<br/>
<br/>
Sometimes it's just too hard to predict everything that will ever be needed, especially if you're in unfamiliar territory.  I'd say just start writing things in the simplest way you can think of, and change it if a better way becomes clear.
<br/>
<br/>
Don't worry about running into a dead end and having to rewrite code.  Some of the worst code I've seen was a result of an unwillingness to throw out old code and start again.  The Quake engine was completely rewritten a dozen times before Quake 1 ever came out, because it was such an experimental project.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#68721 - sgeos - Thu Jan 26, 2006 3:07 pm</h4>
    <div class="postbody"><span class="postbody">[Re: AI]
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ProblemBaby wrote:</b></span></td> </tr> <tr> <td class="quote">This was really intersting cause that was the biggest thing ive thought of!
<br/>
That was the main thing why I wanted it in C, cause it would be so complicated for different kind of chars, but AI is very "level" independent (its enough with a few variables that tells how it acts) and it isnt that much kind of actions so ive to do it unique to every character.</td> </tr></table><span class="postbody">
<br/>
If you are interested in AI, why don't you buy a book on the subject and come back here when you have specific questions?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote"> when trying to think of every possible thing that I could want</td> </tr></table><span class="postbody">
<br/>
Been there, done that.  I think it's better to just make something and see how it turns out.  (Evidently I agree with you...)
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#68726 - ProblemBaby - Thu Jan 26, 2006 3:46 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
If you are interested in AI, why don't you buy a book on the subject and come back here when you have specific questions? 
<br/>
</td> </tr></table><span class="postbody">
<br/>
It was just the different approach that interested me. but you are right a book would be nice!
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
sajiimori wrote: 
<br/>
when trying to think of every possible thing that I could want 
<br/>
<br/>
Been there, done that. I think it's better to just make something and see how it turns out. (Evidently I agree with you...) 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I agree too</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#68787 - sajiimori - Thu Jan 26, 2006 8:00 pm</h4>
    <div class="postbody"><span class="postbody">The only useful piece of information I've ever gotten from an AI book was the A* algorithm, widely available on the internet.  Everything else I've done for AI feels like "normal" code to me.  I just try to say things in the simplest way, and if that's not immediately possible, I make a utility that makes it possible.
<br/>
<br/>
For example, if I want my character to walk right until it hits a wall and then jump, the code should ideally look something like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
while(!hitWall())
<br/>
  walkRight();
<br/>
jump();
<br/>
</td> </tr></table><span class="postbody">
<br/>
Unfortunately, this blocks the rest of the game from running, so time would be frozen while the character walks to the wall.
<br/>
<br/>
The usual solution is a finite state machine.  My preferred solution is asymmetric coroutines, which make the code look like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
while(!hitWall())
<br/>
{
<br/>
  walkRight();
<br/>
  yield();  // Allow 1 game tick to pass.
<br/>
}
<br/>
jump();
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#68986 - Miked0801 - Fri Jan 27, 2006 8:14 pm</h4>
    <div class="postbody"><span class="postbody">Or for FSM driven engines:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void ai_func(void)
<br/>
{
<br/>
    switch(ai.state)
<br/>
    {
<br/>
        case WALK_RIGHT:
<br/>
            if(hitWall())
<br/>
            {
<br/>
                 ai.state = HIT_WALL;
<br/>
                 jump();
<br/>
            }
<br/>
            break;
<br/>
        case HIT_WALL:
<br/>
            // Whatever
<br/>
            break;
<br/>
    }
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Nothing slow or hard to understand there.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#68995 - sajiimori - Fri Jan 27, 2006 8:56 pm</h4>
    <div class="postbody"><span class="postbody">Well, the code is twice as long...  ;)
<br/>
<br/>
Besides that, the code ends up being suspiciously like BASIC.  Assigning state variables is like goto, but with coroutines you get structured control flow.
<br/>
<br/>
I still use hand-written state machines when the current state needs to be accessible and assignable from outside the module.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#69420 - Miked0801 - Mon Jan 30, 2006 6:21 pm</h4>
    <div class="postbody"><span class="postbody">And what's wrong with BASIC?  Besides spaghetti, gotos, hard to debug, ... :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#69444 - tepples - Mon Jan 30, 2006 8:31 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Miked0801 wrote:</b></span></td> </tr> <tr> <td class="quote">And what's wrong with BASIC?  Besides spaghetti, gotos, hard to debug, ... :)</td> </tr></table><span class="postbody">
<br/>
Nothing. Modern BASIC dialects going all the way back to QBasic have done away with spaghetti code, replacing line numbers with typical structured programming constructs (if() then ... else ... end if) (do while() ... loop). In fact, they look a lot like Pascal, C, or any other Algol clone, and VB.NET is just as powerful as C# or Java.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#69469 - sajiimori - Mon Jan 30, 2006 11:32 pm</h4>
    <div class="postbody"><span class="postbody">Right -- Mike and I are thinking of older dialects.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#69545 - sgeos - Tue Jan 31, 2006 12:55 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">Right -- Mike and I are thinking of older dialects.</td> </tr></table><span class="postbody">
<br/>
C64 basic. =)  peek  poke
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#69588 - poslundc - Tue Jan 31, 2006 5:47 pm</h4>
    <div class="postbody"><span class="postbody">You young'uns may giggle, but peek and poke aren't all that different from C pointers, and a lot of what you did on the C64 (or in my case the Apple II) to tweak hardware features with those instructions is exactly what you're doing on the GBA anyway.
<br/>
<br/>
They're all procedural languages, all capable of the same thing. C offers structural features (now considered fundamental) that simplified and automated constructs you could still create in classic line-number BASIC (if you were disciplined enough) in the same way C++ offers structural features that simplify and automate constructs you can still create in C (if you are disciplined enough). Unless you're talking about something fundamentally different (compiled versus assembled, procedural versus functional, etc.) you won't be saying anything meaningful by looking at the whitepapers alone.
<br/>
<br/>
What's relevant is that a language lends itself to a certain style of programming (and here's where I might lose some people), in the context of when and why it was invented in the first place.
<br/>
<br/>
People always associate BASIC with spaghetti-programming, but remember that even line-number BASIC had the GOSUB instruction, and you could write a quicksort engine in C without using a single function-call or native loop structure if you wanted.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#69610 - tepples - Tue Jan 31, 2006 8:09 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">but remember that even line-number BASIC had the GOSUB instruction</td> </tr></table><span class="postbody">
<br/>
Which did not provide for local variables, unlike the later structured BASIC dialects.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#69802 - Miked0801 - Thu Feb 02, 2006 12:29 am</h4>
    <div class="postbody"><span class="postbody">I always hated GOSUB when coding C64 basic.  I was more comfortable with gotos as I knew exactly where the code was returning/jumping.  
<br/>
sys 64320
<br/>
<br/>
Poke 53281,0
<br/>
Poke 53280,0
<br/>
poke 646,1
<br/>
<br/>
or for real fun
<br/>
<br/>
poke 53265, 4 (or was it 16)
<br/>
<br/>
The truely sad part is I didn't have to look these up.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
