<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>weird problem with loop - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Coding > weird problem with loop</h2>
<div id="posts">
<div class="post">
    <h4>#23225 - Darmstadium - Wed Jul 07, 2004 10:19 pm</h4>
    <div class="postbody"><span class="postbody">i'm having a very very weird problem. First I will explain a little about what's going on in my demo. In it you move along the level and there are various objects that your character can collide with, that is he can't walk through them. There is a struct called mobj, which holds information about an object that you can collide with and the sprite that is the object's visual representation. In this struct are the x and y coords of the sprite and the number of the sprite (0-127). Anyway, the collsion system isn't really important in my problem. The point is I need to update the actual sprite's coords with the ones in it's mobj struct. I have an array of 128 mobj structs called mobjs. I try to loop through them all like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
for (int loop = 0; loop &lt; 128; loop++)
<br/>
{
<br/>
     sprites[mobjs[loop].sprite_number].attribute0 &amp;= 0xFE00;
<br/>
     sprites[mobjs[loop].sprite_number].attribute0 |= mobjs[loop].y;
<br/>
     sprites[mobjs[loop].sprite_number].attribute1 &amp;= 0xFF00;
<br/>
     sprites[mobjs[loop].sprite_number].attribute1 |= mobjs[loop].x;
<br/>
}
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
But that doesn't work. In my demo, I have a mobj for testing and a sprite, but the sprite's coords are totally unaffected. The test mobj is mobjs[0]. I tried replacing the loop in my code with this
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
sprites[mobjs[0].sprite_number].attribute0 &amp;= 0xFE00;
<br/>
sprites[mobjs[0].sprite_number].attribute0 |= mobjs[0].y;
<br/>
sprites[mobjs[0].sprite_number].attribute1 &amp;= 0xFF00;
<br/>
sprites[mobjs[0].sprite_number].attribute1 |= mobjs[0].x;
<br/>
</td> </tr></table><span class="postbody">
<br/>
and the coordinates are updated correctly. I have no idea how this could be possible.
<br/>
<br/>
Thanks for helping!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23226 - poslundc - Wed Jul 07, 2004 10:38 pm</h4>
    <div class="postbody"><span class="postbody">Trace your program, and you'll see the problem. Here's a hint:
<br/>
<br/>
<span style="font-weight: bold">Iteration 0:</span>
<br/>
<br/>
loop == 0
<br/>
mobjs[0].sprite_number == 0
<br/>
effective code (sample line):
<br/>
sprites[0].attribute0 |= mobjs[0].y
<br/>
<br/>
<span style="font-weight: bold">Iteration 1:</span>
<br/>
<br/>
loop == 1
<br/>
mobjs[1].sprite_number == 0  (assuming this is an unused sprite)
<br/>
effective code (sample line):
<br/>
sprites[0].attribute0 |= mobjs[1].y
<br/>
<br/>
<br/>
... See the problem?
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23227 - Darmstadium - Wed Jul 07, 2004 10:44 pm</h4>
    <div class="postbody"><span class="postbody">ah, of course! thanks man</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23516 - ProblemBaby - Wed Jul 14, 2004 4:40 pm</h4>
    <div class="postbody"><span class="postbody">another problem I see is if you have big values in y, x you will got problems too. because you AND them wrong
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
     sprites[mobjs[loop].sprite_number].attribute0 &amp;= 0xFE00; 
<br/>
     sprites[mobjs[loop].sprite_number].attribute0 |= mobjs[loop].y; 
<br/>
     sprites[mobjs[loop].sprite_number].attribute1 &amp;= 0xFF00; 
<br/>
     sprites[mobjs[loop].sprite_number].attribute1 |= mobjs[loop].x;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
this should be changed to
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
     sprites[mobjs[loop].sprite_number].attribute0 &amp;= 0xFF00; 
<br/>
     sprites[mobjs[loop].sprite_number].attribute0 |= mobjs[loop].y; 
<br/>
     sprites[mobjs[loop].sprite_number].attribute1 &amp;= 0xFE00; 
<br/>
     sprites[mobjs[loop].sprite_number].attribute1 |= mobjs[loop].x;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
or am I wrong?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23520 - Abscissa - Wed Jul 14, 2004 5:04 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ProblemBaby wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
or am I wrong?</td> </tr></table><span class="postbody">
<br/>
<br/>
You're correct.  The Y coords take 8-bits, but the X coords need 9-bits (since the screen is wider than it is tall).  ANDing with 0xFF00 knocks off the 8 high bits, leaving the low 8 for Y.  ANDing with 0xFE00 only knocks off the high 7 bits, leaving 9 for X.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
