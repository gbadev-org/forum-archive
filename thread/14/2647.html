<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Mode 3 picture problem... - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > Mode 3 picture problem...</h2>
<div id="posts">
<div class="post">
    <h4>#14750 - Dan_attacker - Mon Jan 12, 2004 9:36 am</h4>
    <div class="postbody"><span class="postbody">Hello. I just started trying out GBA programming today. I'm having a problem with displaying an image on the screen using mode 3. The first image is the original test image, and the second is the compiled program running in VisualBoyAdvance...
<br/>
<a class="postlink" href="http://pokemania.outloud.net/pic1.jpg" target="_blank">Image 1 - Original Image</a>
<br/>
<a class="postlink" href="http://pokemania.outloud.net/pic2.jpg" target="_blank">Image 2 - Running in Program</a>
<br/>
<br/>
Here is the code...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include "gba.h"
<br/>
#include "bilde.h"
<br/>
<br/>
int main()
<br/>
<br/>
{
<br/>
            u16 x;
<br/>
            SetMode( MODE_3 | BG2_ENABLE );         
<br/>
            for (x=0; x&lt;(240*160); x++)
<br/>
            {
<br/>
                        FrontBuffer[x] = bildedata[x] ;
<br/>
            }
<br/>
            return 0;
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
I used PCX2GBA to convert the PCX image into a C header file. Is there something wrong with the code, or did PCX2GBA not convert the image correctly?
<br/>
<br/>
Oh, I got my code by slightly modifying this code from a tutorial...
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include "gba.h"
<br/>
#include "bilde.h"
<br/>
<br/>
int main()
<br/>
<br/>
{
<br/>
            u16 loop, x;
<br/>
            SetMode( MODE_4 | BG2_ENABLE );        
<br/>
            for(loop=0;loop&lt;256;loop++)
<br/>
            {
<br/>
                        BG_PaletteMem[loop]=bildePalette[loop];      
<br/>
}
<br/>
            for (x=0; x&lt;(120*160); x++)
<br/>
            {
<br/>
                        FrontBuffer[y] = bildeData[y] ;
<br/>
            }
<br/>
            return 0;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
This guy looks like he was typing too fast or something because I never really programmed in C++ but I can already tell that this program has problems.[/url]</span><span class="gensmall"><br/><br/>Last edited by Dan_attacker on Mon Jan 12, 2004 11:27 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#14753 - Cearn - Mon Jan 12, 2004 12:41 pm</h4>
    <div class="postbody"><span class="postbody">As long as both FrontBuffer and bildedata are u16 arrays the code should work. This looks a lot like an alignment problem somewhere, are you sure the original picture is 240 wide and not 239? If all scanlines are padded to 16bit boundaries you'd end up with something like the right picture.
<br/>
<br/>
You may want to try with something simpler like a hollow rectangle, then you can see where pcx2gba puts the scanline boundaries. Or you could give the original PCX to me and I'll try to figure it out; I've been looking for PCXs that may cause trouble.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14767 - tepples - Mon Jan 12, 2004 5:56 pm</h4>
    <div class="postbody"><span class="postbody">The misalignment looks like it occurs only on a few scanlines, which makes me think it's a compression or decompression problem. In fact, it could be a problem in your graphics program's PCX export filter. Have you tried loading up the PCX files that your graphics program writes in another graphics program such as <a class="postlink" href="http://www2.arnes.si/~sopjsimo/gimp/unstable.html" target="_blank">GIMP 2.0-pre1</a>?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14824 - Dan_attacker - Mon Jan 12, 2004 11:45 pm</h4>
    <div class="postbody"><span class="postbody">I made the pcx file in Photoshop 6, and I tried it in GIMP and I get the same image. I did change one line in the header file but I don't know if it effected anything. 
<br/>
<br/>
const USHORT bildedata[] = {...}
<br/>
<br/>
I changed USHORT to u16 to make the program compile. Does that change anything?
<br/>
<br/>
Here's the pcx file if anyone wants to look at it...
<br/>
<br/>
<a class="postlink" href="http://pokemania.outloud.net/pic.pcx" target="_blank">http://pokemania.outloud.net/pic.pcx</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14828 - dagamer34 - Tue Jan 13, 2004 2:35 am</h4>
    <div class="postbody"><span class="postbody">Well, you are loading data differently that the tutorial does it. That's the only thing i can find. But that really shouldn't be the problem.
<br/>
<br/>
Stick the picture in a tutorial program and see if you get the same problem. If so, then I have no clue. Otherwise, it's probably what i just pointed out to you.<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14836 - yaustar - Tue Jan 13, 2004 3:46 am</h4>
    <div class="postbody"><span class="postbody">I have just tried it and it works fine. There seems to be nothing wrong with your code. Mine looks like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
//////////////////////////////////////////////////////////////////////////
<br/>
// File:    imagedisp.cpp                                           //
<br/>
// Description: A program that displays an image on the GBA      //
<br/>
// Author:   gbajunkie (with lots of code from dovoto)        //
<br/>
// Date:    15th March 2002                                         //
<br/>
//////////////////////////////////////////////////////////////////////////
<br/>
#include "gba.h"        //GBA register definitions
<br/>
#include "dispcnt.h"    //REG_DISPCNT register definitions
<br/>
#include "junkie.h"   //holds the image information in an array
<br/>
<br/>
u16* Video = (u16*)0x6000000;
<br/>
<br/>
int main()
<br/>
<br/>
{
<br/>
            SetMode( MODE_3 | BG2_ENABLE );         
<br/>
            for(int loop=0; loop &lt; 240*160; loop++)
<br/>
            {
<br/>
               Video[loop] = junkiedata[loop];
<br/>
       }
<br/>
            return 0;      
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
Try pcx-&gt;gba by Jesder.
<br/>
<br/>
The only other thing I had done was to save the pcx as a bmp, put it down to 8 bit and back to a pcx again<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
