<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>A NDS newbie programmer needs help[solved] - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Beginners > A NDS newbie programmer needs help[solved]</h2>
<div id="posts">
<div class="post">
    <h4>#175477 - NaclChan - Tue Nov 30, 2010 5:55 pm</h4>
    <div class="postbody"><span class="postbody">Hello everyone:
<br/>
    I am a newbie NDS programmer from China,recently I am working hard on how to display my animate sprites correctly,but I always get a wrong one.When I want to display my sprite at the left-top(0,0), the sprite shows up near (30,30).  The picture below shows what happened.
<br/>
<br/>
[img]
<br/>
<a href="http://photo.renren.com/photo/36105/photo-3742550579?curpage=0&amp;t=" target="_blank">http://photo.renren.com/photo/36105/photo-3742550579?curpage=0&amp;t=</a>
<br/>
[/img]
<br/>
<br/>
    I checked my code,but I found nothing strange.So I come here to see if I can get some help from you. Sorry to bother you guys.
<br/>
<br/>
    The code below is how I set the display mode and things like that
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   //设置图像引擎的工作模式
<br/>
   videoSetMode(MODE_5_2D);
<br/>
   //把精灵的存储空间映射到BankA，根据libnds的说明，只有特定的bank才能映射
<br/>
   vramSetBankA(VRAM_A_MAIN_SPRITE);
<br/>
   
<br/>
   irqInit();
<br/>
   irqEnable(IRQ_VBLANK);
<br/>
   irqSet(IRQ_VBLANK,vBlank);</td> </tr></table><span class="postbody">
<br/>
<br/>
    Here are the code I used to set my sprite
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   //设置精灵的映射方式为1D映射，现在对这个还不是相当的了解
<br/>
   oamInit(&amp;oamMain, SpriteMapping_1D_128, false); 
<br/>
<br/>
   //为精灵的Tile数据申请一个存储的空间，mainSprite.gfx指向新申请的空间的基址
<br/>
   //并设置精灵的显示为256色的tile方式，不是bmp方式
<br/>
   mainSprite.gfx = oamAllocateGfx(&amp;oamMain, SpriteSize_32x32, SpriteColorFormat_256Color);
<br/>
   //在控制精灵动作的时候有一个指向实际要显示tile的基址，初始时为整个tile数据的基址
<br/>
   baseGfx = mainSprite.gfx;
<br/>
   
<br/>
   //将tile数据，调色盘数据载入相应的空间之中
<br/>
   dmaCopyHalfWords(3,test_Char,mainSprite.gfx,sizeof(test_Char));
<br/>
   dmaCopyHalfWords(3,test_Palette,SPRITE_PALETTE,sizeof(test_Palette));</td> </tr></table><span class="postbody">
<br/>
<br/>
    Now I will show the strcture of my sprite
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
typedef struct  
<br/>
{
<br/>
    signed int x;
<br/>
    signed int y;
<br/>
    int speed;
<br/>
    SpriteSize size;
<br/>
    SpriteColorFormat format;
<br/>
    u16* gfx;
<br/>
}MySprite;
<br/>
<br/>
//定义一个精灵的结构体，存放精灵的初始信息
<br/>
MySprite mainSprite = {0,0,10,SpriteSize_32x32,SpriteColorFormat_256Color,0};
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
BTW:I am glad to say hello to everyone,thank you</span><span class="gensmall"><br/><br/>Last edited by NaclChan on Wed Dec 01, 2010 11:36 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#175478 - elhobbs - Tue Nov 30, 2010 6:06 pm</h4>
    <div class="postbody"><span class="postbody">hello NaclChan - after a brief look at your code I can tell you that "irqInit();" should not be called with current versions of libnds. this call has been moved into the asm startup code and does not need to used in your code. Calling it in your code will cause problems.
<br/>
<br/>
there may be other problems though... good luck!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#175483 - NaclChan - Wed Dec 01, 2010 11:35 am</h4>
    <div class="postbody"><span class="postbody">Hello elhobbs:
<br/>
            Thank u 4 your reply,and I have taken your advice.
<br/>
            I have known the reason why my sprite doesn't display at the correct pixel. I found that I had turned on the rotation and the sizeDouble function of the sprite. 
<br/>
            Here is the code before modification. The 10th parameter and the 11th parameter didn't set correctly.The sprite size shows on the screen is twice than I wantted,so the position of the sprite also shifted.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   //设定精灵的各种属性
<br/>
   oamSet
<br/>
   (
<br/>
      &amp;oamMain,
<br/>
      0,
<br/>
      mainSprite.x, 
<br/>
      mainSprite.y,
<br/>
      0,
<br/>
      0,
<br/>
      SpriteSize_32x32, 
<br/>
      SpriteColorFormat_256Color, 
<br/>
      baseGfx + offSet, 
<br/>
      0, 
<br/>
      true,
<br/>
      false,
<br/>
      false, 
<br/>
      false,
<br/>
      false
<br/>
   );
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
              Here is the code after modification.I have tested them, they can work as I wantted.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   //设定精灵的各种属性
<br/>
   oamSet
<br/>
   (
<br/>
      &amp;oamMain,
<br/>
      0,                                 //id
<br/>
      mainSprite.x, 
<br/>
      mainSprite.y,
<br/>
      0,
<br/>
      0,
<br/>
      SpriteSize_32x32, 
<br/>
      SpriteColorFormat_256Color, 
<br/>
      baseGfx + offSet, 
<br/>
      -1,                               //turn off rotation
<br/>
      false,                           //sizeDouble off
<br/>
      false,
<br/>
      false, 
<br/>
      false,
<br/>
      false
<br/>
   );
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
             Anyway,I want to say thank u,for your reply.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
