<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Timer + vBlanks (kind of related to countdown timer thread) - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > Timer + vBlanks (kind of related to countdown timer thread)</h2>
<div id="posts">
<div class="post">
    <h4>#17860 - darknet - Tue Mar 16, 2004 4:20 am</h4>
    <div class="postbody"><span class="postbody">Alright, I have a dilemma (As usual right?), I was weeding through the threads and came to the countdown thread. While the info there really helped me, it also opened up a number of questions. Here goes:
<br/>
<br/>
My project consists of a number of timed mini-games. For example, a person will have 30 seconds to complete a mini-game. If 30 seconds go by, a screen pops up showing that time is up. Think WarioWare MicroGames.
<br/>
<br/>
In any case, if the person does finish the game, I do not want the timer stuff to appear at all obviously. Otherwise, when time runs out, display the message.
<br/>
<br/>
The way I have it set up right now, If i run my timer function, nothing else is allowed to run concurrently, i.e. the system just waits till time is up and displays the message, not allowing for any other interaction.
<br/>
<br/>
How should this kind of thing be structured / accomplished? I read the countdown timer thread and came up with this function, 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void setAndRunFor(int amountOfTime) {
<br/>
<br/>
   //set up a frame variable (=60)
<br/>
   unsigned short frame = 60;
<br/>
   
<br/>
   //Every VBlank, decrement a 'frame' counter.
<br/>
   while(amountOfTime!=0) {
<br/>
<br/>
      for(int i = frame; i&gt;=0; i--) {
<br/>
         vBlank();
<br/>
      }
<br/>
      amountOfTime--;
<br/>
      frame = 60;
<br/>
   }
<br/>
 
<br/>
  //draw the time is up graphic here
<br/>
  setMode(MODE_3 | BG2_ENABLE);
<br/>
  drawMode3Background(videoBuffer, timesUp_Bitmap);
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
where vBlank() is defined as so:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void vBlank() { while(REG_VCOUNT != 160); }
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
For testing purposes, I am just calling that function in random places throughout different mini-games, however nothing allows the game control and the timer to coexist. In addition, how would I give control back to the main program once the timer is up and the screen is displayed?
<br/>
<br/>
Sorry for the long winded post, thanks for reading + any answer is appreciated.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17861 - tepples - Tue Mar 16, 2004 4:53 am</h4>
    <div class="postbody"><span class="postbody">Each minigame will look like the following pseudocode:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void minigame_shoot_the_hamsters(void)
<br/>
{
<br/>
  /* omitted: init minigame state and graphics */
<br/>
  u16 time_left = 1800; /* typical for Mario Party; WarioWare uses 192 */
<br/>
  s8 done = 0;
<br/>
<br/>
  while(!done)
<br/>
  {
<br/>
    vBlank();
<br/>
    /* omitted: display code */
<br/>
    /* omitted: one cycle of the game loop, setting done to FAILURE or
<br/>
       SUCCESS, where FAILURE and SUCCESS are non-zero constants */
<br/>
    time_left--;
<br/>
    if(time_left == 0)
<br/>
      done = FAILURE; /* or SUCCESS if goal is "stay alive for 30 seconds" */
<br/>
  }
<br/>
}</td> </tr></table><span class="postbody">
<br/>
In other words, run one cycle of the game loop after each 'vBlank()' in your code.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17870 - darknet - Tue Mar 16, 2004 7:02 am</h4>
    <div class="postbody"><span class="postbody">you're the best, that works beautifully, and now i can scrap that over complicated timer class!</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
