<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>[solved] help needed on animating a background - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > [solved] help needed on animating a background</h2>
<div id="posts">
<div class="post">
    <h4>#21939 - tornadokick - Wed Jun 09, 2004 10:04 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void AnimateBG(Bg *bg)   // swaps out the tiles to create animation to simulate the waves of water.
<br/>
{
<br/>
   u16 loop;
<br/>
   u16* temp = (u16*)frogmap;  
<br/>
   for(loop = 0; loop &lt; 64*64 ; loop++) 
<br/>
   {
<br/>
      if (bg-&gt;mapData[loop] == 0x00)         // if it's one wave pattern, switch
<br/>
         bg-&gt;mapData[loop] = 0x01;
<br/>
      else if (bg-&gt;mapData[loop] == 0x01)    // if it's the other, switch
<br/>
         bg-&gt;mapData[loop] = 0x00;
<br/>
   }
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
Ok, this should be a somewhat basic approach to swapping out the tiles to create the illusion of motion in a background.  It works, but the only every other tile is being changed.  The remaining (every other) tiles stay static.  To illustrate:
<br/>
101010101010...
<br/>
101010101010...
<br/>
101010101010...
<br/>
101010101010...
<br/>
...
<br/>
1's would signify the tiles that change, and 0's would stay the same.  I know essentially why the tiles aren't changing (the loop is just looking at every other tile), but I don't know how to fix it.  
<br/>
<br/>
Once again.  Any help is appreciated.</span><span class="gensmall"><br/><br/>Last edited by tornadokick on Thu Jun 10, 2004 1:58 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#21943 - Abscissa - Wed Jun 09, 2004 11:05 pm</h4>
    <div class="postbody"><span class="postbody">I don't know how experienced you are, so forgive me if you already know most of this:
<br/>
<br/>
The problem is that the map data is 8-bits per tile, but you are accessing it as if it were 16-bits per tile.  Let's say the first 8 bytes in map memory looked like this:
<br/>
<br/>
00 00 00 00 00 00 00 00
<br/>
<br/>
When you use 16-bit integers (ie u16 for data and u16* for pointers), then this memory gets treated as four 16-bit numbers, instead of eight 8-bit numbers.  It's treated like this:
<br/>
<br/>
0000 0000 0000 0000
<br/>
<br/>
So, if you change the first three of these to 1, it goes and changes the first three numbers to one:
<br/>
<br/>
0001 0001 0001 0000   (Ignoring endian-ness)
<br/>
<br/>
So you get every other byte updated. If you change everything to u8 and u8*, then it correctly looks at the memory as:
<br/>
<br/>
00 00 00 00 00 00 00 00
<br/>
<br/>
And setting the first three to 1 will have the intended result:
<br/>
<br/>
01 01 01 00 00 00 00 00
<br/>
<br/>
So, in short (no pun intended), use u8 instead of u16.  But, there might still be a problem with even that.  I know that there are parts of the GBA that you can only access two-bytes at a time (like the memory for the background in modes 3, 4 and 5), but I don't know whether or not that also applies to the map memory.  If it does require two-bytes at a time(and you can tell just by seeing if u8 fixes everything or not), then you'll have to stick with u16 and do someting else instead:
<br/>
<br/>
Probably the easiest way would be like this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
// Everything is still u16
<br/>
for(loop = 0; loop &lt; 64*64/2 ; loop++) 
<br/>
   { 
<br/>
      if (bg-&gt;mapData[loop] == 0x0000)
<br/>
         bg-&gt;mapData[loop] = 0x0101; 
<br/>
      else if (bg-&gt;mapData[loop] == 0x0101)
<br/>
         bg-&gt;mapData[loop] = 0x0000; 
<br/>
   } 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
That way, you're updating both bytes with 0x01 instead of just one.  By contrast, what your original code was essentially doing is this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
for(loop = 0; loop &lt; 64*64 ; loop++) 
<br/>
   { 
<br/>
      if (bg-&gt;mapData[loop] == 0x0000)
<br/>
         bg-&gt;mapData[loop] = 0x0001; // Sets first tile to 0x00 and second to 0x01
<br/>
      else if (bg-&gt;mapData[loop] == 0x0001)
<br/>
         bg-&gt;mapData[loop] = 0x0000; 
<br/>
   } 
<br/>
// Note that this loop changes 64*64*2 tiles, not 64*64 tiles, since we're using u16*
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"><br/><br/>Last edited by Abscissa on Wed Jun 09, 2004 11:09 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#21944 - sajiimori - Wed Jun 09, 2004 11:08 pm</h4>
    <div class="postbody"><span class="postbody">Just so I'm clear, the 'temp' and 'frogmap' variables aren't supposed to be used in this function, right?
<br/>
<br/>
Is it a rot/scale or text bg?  If it's rot/scale and mapData is a u16*, you're setting 2 tiles at once.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#21945 - sajiimori - Wed Jun 09, 2004 11:11 pm</h4>
    <div class="postbody"><span class="postbody">Careful, Abscissa's solution only works if water tiles always come in pairs.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#21946 - Abscissa - Wed Jun 09, 2004 11:14 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">Careful, Abscissa's solution only works if water tiles always come in pairs.</td> </tr></table><span class="postbody">
<br/>
<br/>
Yes, sorry, I forgot to mention that.  If they don't always come in pairs, you'll have to use some bitmasking to prevent changes to non-water tiles, which takes a little bit more effort.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#21947 - tornadokick - Thu Jun 10, 2004 12:07 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">Just so I'm clear, the 'temp' and 'frogmap' variables aren't supposed to be used in this function, right?
<br/>
<br/>
Is it a rot/scale or text bg?  If it's rot/scale and mapData is a u16*, you're setting 2 tiles at once.</td> </tr></table><span class="postbody">
<br/>
<br/>
Yeah, I edited after I created the post to remove those.  They aren't needed.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Abscissa wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
// Everything is still u16
<br/>
for(loop = 0; loop &lt; 64*64/2 ; loop++) 
<br/>
   { 
<br/>
      if (bg-&gt;mapData[loop] == 0x0000)
<br/>
         bg-&gt;mapData[loop] = 0x0101; 
<br/>
      else if (bg-&gt;mapData[loop] == 0x0101)
<br/>
         bg-&gt;mapData[loop] = 0x0000; 
<br/>
   } 
<br/>
</td> </tr></table><span class="postbody">
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
<br/>
yeah, I knew about it (referring to the post, about reading in the variables which are 2 8-bit vars), but I didn't know how to deal with it.  Thank you so much for this explanation.  
<br/>
<br/>
I need to know about bit masking so if someone would care to explain that to me, thank you.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#21949 - sajiimori - Thu Jun 10, 2004 12:37 am</h4>
    <div class="postbody"><span class="postbody">Use the bitwise-and operator (&amp;) to clear bits, and bitwise-or operator (|) to set bits, the bitwise-xor operator (^) to toggle bits, and the ones-complement operator (~) to flip all the bits in a value.
<br/>
<br/>
If you're using Windows, it comes with a calculator which has bitwise operators in scientific mode.  You can experiment there.  Anyway, get a <a class="postlink" href="http://www.amazon.com/exec/obidos/tg/detail/-/0672322226/" target="_blank">good C book</a> for more details.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#21952 - poslundc - Thu Jun 10, 2004 12:47 am</h4>
    <div class="postbody"><span class="postbody">Also: learn <a class="postlink" href="http://www.google.com/search?q=hexadecimal" target="_blank">hexadecimal</a>.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#21958 - tornadokick - Thu Jun 10, 2004 1:49 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">Use the bitwise-and operator (&amp;) to clear bits, and bitwise-or operator (|) to set bits, the bitwise-xor operator (^) to toggle bits, and the ones-complement operator (~) to flip all the bits in a value.
<br/>
<br/>
If you're using Windows, it comes with a calculator which has bitwise operators in scientific mode.  You can experiment there.  Anyway, get a <a class="postlink" href="http://www.amazon.com/exec/obidos/tg/detail/-/0672322226/" target="_blank">good C book</a> for more details.</td> </tr></table><span class="postbody">
<br/>
<br/>
OK, thanx.  I knew you could view binary and hex as part of the calculator, but I didn't see all of those useful functions.  Thanks for drawing my attention to them.  
<br/>
<br/>
This is a very helpful post, it answers a lot of my questions.  Thanks once again.  (Am I being too humble?)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">Also: learn <a class="postlink" href="http://www.google.com/search?q=hexadecimal" target="_blank">hexadecimal</a>.
<br/>
<br/>
Dan.</td> </tr></table><span class="postbody">
<br/>
<br/>
I'm sorry, I am already familiar with hexadecimal, just not how to use it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#21963 - poslundc - Thu Jun 10, 2004 4:13 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tornadokick wrote:</b></span></td> </tr> <tr> <td class="quote">I'm sorry, I am already familiar with hexadecimal, just not how to use it.</td> </tr></table><span class="postbody">
<br/>
<br/>
You just prefix the number you want to specify with "0x" (that's a zero). So 127 can be written in hex in C as 0x7F, for example.
<br/>
<br/>
You will find that hexadecimal comes into its own when you are doing bit-manipulation, because it gives you a notation that makes it very easy to visually identify which bits are on and which are off. Plus, everyone else uses it heavily, so it's essential when reading other people's code as well.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
