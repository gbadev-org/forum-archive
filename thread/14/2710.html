<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>LZ77 - compression problems - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > LZ77 - compression problems</h2>
<div id="posts">
<div class="post">
    <h4>#15284 - qw3rty - Tue Jan 20, 2004 12:57 pm</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
I tried to compress my graphics with LZ77 - after a couple of attempts I got it working *partly* - some sprites work perfect, but others don`t - it seems like some color indexes got mixed up - I think all the color-indexes were decremented by one(e.g. a pixel with color 1 is now color 0) - however, the palette seems to be intact, only the pixels got another color-index.
<br/>
Color 0-pixels aren`t effected by this (the transparent parts of the image stay transparent)
<br/>
I convert my GFX with gfx2gba, btw, and decompress directly to the sprite-character-memory.
<br/>
<br/>
Any ideas ?
<br/>
(I tend to remove the compressed images, because it didn`t save place, the .bin even got bigger by a few bytes :( )</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15316 - Miked0801 - Tue Jan 20, 2004 8:27 pm</h4>
    <div class="postbody"><span class="postbody">LZ77 compression takes a while to get good compression (usually.)  I'd not expect much compression on files of  less than 100 bytes.
<br/>
<br/>
Don't know on the tool thing though.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15326 - tepples - Tue Jan 20, 2004 9:23 pm</h4>
    <div class="postbody"><span class="postbody">Perhaps gfx2gba is trying to optimize your palettes at the same time. You might want to look for a switch for that.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15358 - qw3rty - Wed Jan 21, 2004 11:42 am</h4>
    <div class="postbody"><span class="postbody">I just got a private message from a guy, asking about the code...
<br/>
This code is for ARM-mode btw, I think the swi"0xnn0000" have to replaced by "0xnn" for THUMB-mode...
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void LZ77UnCompWRAM(u8* inBuffer, u16* outBuffer)
<br/>
{
<br/>
<br/>
    asm volatile("
<br/>
    mov r0, %0
<br/>
    mov r1, %1
<br/>
    swi 0x110000
<br/>
    ":    /* No output */ :
<br/>
    "r" (inBuffer) , "r" (outBuffer) :
<br/>
    "r0", "r1");
<br/>
}
<br/>
<br/>
void LZ77UnCompVRAM(u8* inBuffer, u16* outBuffer)
<br/>
{
<br/>
<br/>
    asm volatile("
<br/>
    mov r0, %0
<br/>
    mov r1, %1
<br/>
    swi 0x120000
<br/>
    ":    /* No output */ :
<br/>
    "r" (inBuffer) , "r" (outBuffer) :
<br/>
    "r0", "r1");
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
This code throws some errors at me , when compiling:
<br/>
"warning: multi-line string literals are deprecated"
<br/>
but I don`t know any assembler, and don`t know how to fix this code...
<br/>
(I copied  this  code from the yahoo-gba-dev-forum)
<br/>
<br/>
Anybody knows how to fix it ?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15365 - NEiM0D - Wed Jan 21, 2004 2:00 pm</h4>
    <div class="postbody"><span class="postbody">It's been a long time since I used GCC, but I believe you needed to add '\n' to each assembler line for use in C.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#15372 - poslundc - Wed Jan 21, 2004 4:08 pm</h4>
    <div class="postbody"><span class="postbody">You're trying to put a quoted string literal on multiple lines. IIRC, you need to put a backslash (\) at the end of each line before going to the next line. ie.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">    asm volatile(" 
<br/>
    mov r0, %0 
<br/>
    mov r1, %1 
<br/>
    swi 0x110000 
<br/>
    ":    /* No output */ : 
<br/>
    "r" (inBuffer) , "r" (outBuffer) : 
<br/>
    "r0", "r1"); 
<br/>
<br/>
becomes:
<br/>
<br/>
    asm volatile(" \
<br/>
    mov r0, %0 \
<br/>
    mov r1, %1 \
<br/>
    swi 0x110000 \
<br/>
    ":    /* No output */ : 
<br/>
    "r" (inBuffer) , "r" (outBuffer) : 
<br/>
    "r0", "r1");</td> </tr></table><span class="postbody">
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
