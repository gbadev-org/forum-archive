<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>I need some help with a Mode 3 issue. - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Beginners > I need some help with a Mode 3 issue.</h2>
<div id="posts">
<div class="post">
    <h4>#31111 - ghostils - Tue Dec 07, 2004 11:52 pm</h4>
    <div class="postbody"><span class="postbody">Ok so here we go....  I wrote some simple code to display a box with configurable border size.. However after I call it... if I exec any other code taht writes to video memory in MODE 3 the pixels blink... this includes single pixels or if I use my write_text function to show some text the text written blinks.. but nothing else... the Box with border and bg is fine......
<br/>
<br/>
The piece of commented code in the fill portion of the draw_box routine, if I set bgcolor == 0, then call draw_box then call othe routines to write vmem its fine..  it only seems if I write to all the video memory something is messed up and it won't let me overwrite other pixels? Do I have to redraw the whole screen each time?
<br/>
<br/>
Any ideas?
<br/>
<br/>
I'll post the code below for the draw_box routine.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void draw_box(int pos_x1, int pos_x2, int pos_y1, int pos_y2, int size_border, u16 fgcolor, u16 bgcolor, int bevel)
<br/>
{
<br/>
<br/>
   int x = 0, y = 0;
<br/>
<br/>
   //-Draw first line:
<br/>
   for (y = pos_y1; y &lt; pos_y1 + size_border; y++)
<br/>
   {
<br/>
      for (x = pos_x1 + size_border; x &lt; pos_x2 - size_border; x++)
<br/>
      {
<br/>
         theVideoBuffer[ x + y * 240 ] = fgcolor;   
<br/>
      }
<br/>
   }
<br/>
<br/>
   //-Draw 2nd line: 
<br/>
   for( y = pos_y1; y &lt; pos_y2 - size_border; y++)
<br/>
   {
<br/>
      for(x = pos_x1; x &lt; pos_x1 + size_border; x++)
<br/>
      {
<br/>
         theVideoBuffer[ x + y * 240 ] = fgcolor;   
<br/>
      }
<br/>
   }
<br/>
<br/>
   //-Draw 3rd line: 
<br/>
   for(y = pos_y2 - size_border; y &lt; pos_y2; y++)
<br/>
   {
<br/>
      for(x = pos_x1; x &lt; pos_x2 - size_border; x++)
<br/>
      {
<br/>
         theVideoBuffer[ x + y * 240 ] = fgcolor;   
<br/>
      }
<br/>
   }
<br/>
   //x2-&gt;x2 * border, y1-&gt;y2
<br/>
   for (y = pos_y1; y &lt; pos_y2; y++)
<br/>
   {
<br/>
      for(x = pos_x2 - size_border; x &lt; pos_x2; x++)
<br/>
      {
<br/>
         theVideoBuffer[ x + y * 240 ] = fgcolor;
<br/>
      }
<br/>
   }
<br/>
<br/>
<br/>
<br/>
   //-Fill with bgcolor: x1 + border to x2 - border y1 + border -&gt; y2 - border
<br/>
         //-Why?
<br/>
         //-if(bgcolor == 0) {return;} 
<br/>
   for(y = pos_y1 + size_border; y &lt; pos_y2 - size_border; y++)
<br/>
   {
<br/>
      for(x = pos_x1 + size_border; x &lt; pos_x2 - size_border; x++)
<br/>
      {
<br/>
         theVideoBuffer[ x + y * 240 ] = bgcolor;
<br/>
      }
<br/>
   }
<br/>
<br/>
<br/>
   //-TODO: add bevel:
<br/>
}
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
<br/>
<br/>
Here are some of my test cases from my "main":
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
u16 fgcolor = RGB(31,31,31);
<br/>
         u16 bgcolor = RGB(10,16,24);
<br/>
<br/>
<br/>
         
<br/>
         draw_box (0, 240, 0, 160, 3, fgcolor, 0, 1);
<br/>
<br/>
         
<br/>
         mx = 10;my = 10;
<br/>
         theVideoBuffer[ mx + my * 240 ] = RGB( 31, 31, 31 );
<br/>
         mx = 11;my = 10;
<br/>
         theVideoBuffer[ mx + my * 240 ] = RGB( 31, 31, 31 );
<br/>
         mx = 12;my = 10;
<br/>
         theVideoBuffer[ mx + my * 240 ] = RGB( 31, 31, 31 );
<br/>
         
<br/>
<br/>
         //WaitForVblank();
<br/>
         write_text("Whoops???\0",11,8,fgcolor, bgcolor);
<br/>
         write_text("Whoops???\0",11,16,fgcolor, bgcolor);
<br/>
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
<br/>
<br/>
Thanks, 
<br/>
-ghost[iLs]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#31118 - ghostils - Wed Dec 08, 2004 1:00 am</h4>
    <div class="postbody"><span class="postbody">I guess if the GBA doesn't have a loop after it executes your code just goes nutz and can't take the pressure of standing still lol...
<br/>
<br/>
<br/>
I put a while(1){} loop after my code instead of returning in main, and now the problem goes away.  Awesome eh?
<br/>
<br/>
<br/>
-ghost[iLs]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#31177 - poslundc - Wed Dec 08, 2004 6:24 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ghostils wrote:</b></span></td> </tr> <tr> <td class="quote">I guess if the GBA doesn't have a loop after it executes your code just goes nutz and can't take the pressure of standing still lol...</td> </tr></table><span class="postbody">
<br/>
<br/>
It's quite sensible, really. Since there is no OS on the GBA to return control to when a process exits, the system simply reboots itself.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#31216 - ghostils - Wed Dec 08, 2004 10:36 pm</h4>
    <div class="postbody"><span class="postbody">after working with boot code on the x86 platform. But two different animals I guess hehe.
<br/>
<br/>
-ghost[iLs]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#31268 - FluBBa - Thu Dec 09, 2004 12:53 pm</h4>
    <div class="postbody"><span class="postbody">But you surely had somekind of DiscOperatingSystem on it?<br/>_________________<br/>I probably suck, my not is a programmer.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#31291 - Fatnickc - Thu Dec 09, 2004 6:15 pm</h4>
    <div class="postbody"><span class="postbody">^
<br/>
|
<br/>
Was that 'DiscOperatingSystem' thing was meant to represent DOS? Because after reading 'Accidental Empires' (old book) I thought it stood for Dirty Operating System, having originally been QDOS, for Quick and Dirty Operating System, and after having been bought by Microsoft, theQ went. Anyhoo..</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
