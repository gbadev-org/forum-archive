<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Map sizing and wrap around problems - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > Map sizing and wrap around problems</h2>
<div id="posts">
<div class="post">
    <h4>#50890 - pizzach - Sun Aug 14, 2005 7:57 am</h4>
    <div class="postbody"><span class="postbody">I'm new to gameboy developement and just about over the beginning learning curve.  I started programming an RPG in Java that was becoming a good FF3 nock-off but decided I would rather get some direct console development experience so I'm starting fresh and getting some good C experience to boot.  I learned some things about Windows gba programmers and how they can be lazy on uppercase lowercase.  (&gt;_&lt;) I started gba development on my Mac in devkitadvance, I'm now on a linux with devkitpro on my laptop and I have been learning by staring at windows user source code.  Agh.  Anyway...
<br/>
<br/>
My largest battle I'm fighting will right now is figuring out what tile maps should be doing.  When I set the rotation map size to 128x128 the map appears to be about one screen in size. 256x256 appears to be two screens in length.  512x512 appears to be the same size as 128x128.  1024x1024 appears to be the same size as 256x256.  The other thing is I can't get wrap around to turn off.
<br/>
<br/>
My code is below that I had used.  I tried to keep it as simple as possible because I'm not trying to build anything yet.  I tried to fix up some of the indent problems and hopefully I didn't screw anything up on the copy over to the forums.
<br/>
<br/>
Any help would be appreciated!  I hope I posted this in the right section.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include &lt;gba.h&gt;
<br/>
<br/>
volatile u16* ScanlineCounter = (volatile u16*)0x4000006;
<br/>
void WaitForVblank(void);
<br/>
u16* ScreenBB = (u16*)SCREEN_BASE_BLOCK(28);
<br/>
u16* CharBB = (u16*) MAP_BASE_BLOCK(0);
<br/>
<br/>
int main() {
<br/>
<br/>
    u8 i, x, y;
<br/>
 
<br/>
    //Background setup
<br/>
    REG_BG0CNT = (BG_COLOR_256 | ROTBG_SIZE_512x512 | (28 &lt;&lt; SCREEN_SHIFT) | (0 &lt;&lt; CHAR_SHIFT));
<br/>
<br/>
    SetMode(MODE_1 | BG0_ENABLE);
<br/>
<br/>
    // input 3 colors into the palette
<br/>
    BGPaletteMem[0] = RGB16(31,31,31);//white
<br/>
    BGPaletteMem[1] = RGB16(0,30,0);//green
<br/>
    BGPaletteMem[2] = RGB16(0,0,25);//blue
<br/>
<br/>
 
<br/>
<br/>
// input tiles(char data)
<br/>
<br/>
    for(i=0; i&lt;32; i++) {
<br/>
        CharBB[i] = 0x0000; // color from palette 0(!! We have to write 2 byte at a time !!)
<br/>
    }
<br/>
    for(i=32; i&lt;64; i++) {
<br/>
        CharBB[i] = 0x0101; // color from palette 1((!! We have to write 2 byte at a time !!)
<br/>
    }
<br/>
    for(i=64; i&lt;96; i++) {
<br/>
        CharBB[i] = 0x0202; // color from palette 2(!! We have to write 2 byte at a time !!)
<br/>
     }
<br/>
<br/>
 
<br/>
<br/>
    //Almost two screens of blue tiles
<br/>
    int testNum;
<br/>
    for (testNum=0; testNum&lt;25*32; testNum++) {
<br/>
        ScreenBB[testNum ] = 2; //tile 2 at location (15, 8);
<br/>
    }
<br/>
    //Some random green tiles
<br/>
    x = 0;
<br/>
    y = 19;
<br/>
    ScreenBB[x+(32*y) ] = 1;//tile 1 at location (5, 3);
<br/>
<br/>
    x = 35;
<br/>
    y = 3;
<br/>
    ScreenBB[x+(32*y) ] = 1; //tile 2 at location (15, 8);
<br/>
       
<br/>
    s16 xscroll = 1;
<br/>
    REG_BG0HOFS=0;
<br/>
    while(1) {
<br/>
            void WaitForVblank(void);   
<br/>
            //buy some time
<br/>
            int x = 0x0002;
<br/>
            while (x &lt; 10000) x++;
<br/>
<br/>
            if (!(KEY_RIGHT &amp; REG_KEYS)) {
<br/>
                xscroll++;
<br/>
                REG_BG0HOFS = xscroll;
<br/>
            }
<br/>
            if (!(KEY_LEFT &amp; REG_KEYS)) {
<br/>
                xscroll--;
<br/>
                REG_BG0HOFS = xscroll;
<br/>
            }
<br/>
        }
<br/>
    }
<br/>
<br/>
void WaitForVblank(void)   // waits for the drawer to get to end before flip
<br/>
{
<br/>
   while(*ScanlineCounter &lt; 160) {   // do nothing
<br/>
   }//now we are in the vblank period
<br/>
}
<br/>
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#50904 - tepples - Sun Aug 14, 2005 12:43 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>pizzach wrote:</b></span></td> </tr> <tr> <td class="quote">My largest battle I'm fighting will right now is figuring out what tile maps should be doing.  When I set the rotation map size to 128x128 the map appears to be about one screen in size. 256x256 appears to be two screens in length.  512x512 appears to be the same size as 128x128.  1024x1024 appears to be the same size as 256x256.  The other thing is I can't get wrap around to turn off.
<br/>
<br/>
[...]
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code"> 
<br/>
    //Background setup
<br/>
    REG_BG0CNT = (BG_COLOR_256 | ROTBG_SIZE_512x512 | (28 &lt;&lt; SCREEN_SHIFT) | (0 &lt;&lt; CHAR_SHIFT));
<br/>
<br/>
    SetMode(MODE_1 | BG0_ENABLE);
<br/>
<br/>
</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
There's your problem. BG0 and BG1 are present in modes 0 and 1. They are <span style="font-style: italic">always</span> "text" maps, not rotation maps. Their size is set differently (256x256, 512x256, 256x512, 512x512), they always use wraparound, and the 512-pixel-wide maps are displayed in 32x32 tile (256x256 pixel) chunks.
<br/>
<br/>
For rotation, use BG2.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#50998 - pizzach - Mon Aug 15, 2005 6:42 am</h4>
    <div class="postbody"><span class="postbody">Thanks tepples! That was a quick and really helpful reply!  I found a guide after you said that and it makes sense to me now.  But then what's the point of ROTBG_SIZE_512x512 etc etc if they are already predetermined by the mode?  
<br/>
<br/>
This is my last question, really.  I changed all the REG_BG0CNT, BG0_ENABLE, REG_BG0HOFS variables to REG_BG2CNT, BG2_ENABLE, and REG_BG2HOFS.  I got the rotation background working.  All of the sizes seem to work.  But uh....I can't get the background to scroll now.  It worked for BG0.  I'm going to keep pondering on this and researching. (?_?)
<br/>
<br/>
From what I've seen, it looks like a text background makes more sense for my yet to be rpg that I may never finish.  But it is really interesting how different rotation backgrounds and text backgrounds are. :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#51006 - Cearn - Mon Aug 15, 2005 8:31 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>pizzach wrote:</b></span></td> </tr> <tr> <td class="quote">Thanks tepples! That was a quick and really helpful reply!  I found a guide after you said that and it makes sense to me now.  But then what's the point of ROTBG_SIZE_512x512 etc etc if they are already predetermined by the mode?
<br/>
</td> </tr></table><span class="postbody">Whether a background is text or rotational is determined by the video mode, not the size. ROTBG_xxx and TEXTBG_xxx actually cover the same range of values, they're just named differently because the possible sizes for text and rot bgs are different.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>pizzach wrote:</b></span></td> </tr> <tr> <td class="quote">This is my last question, really.  I changed all the REG_BG0CNT, BG0_ENABLE, REG_BG0HOFS variables to REG_BG2CNT, BG2_ENABLE, and REG_BG2HOFS.  I got the rotation background working.  All of the sizes seem to work.  But uh....I can't get the background to scroll now.  It worked for BG0.  I'm going to keep pondering on this and researching. (?_?)</td> </tr></table><span class="postbody">Text backgrounds use <a class="postlink" href="http://nocash.emubase.de/gbatek.htm#lcdiobgscrolling" target="_blank">REG_BGxHOFS and REG_BGxVOFS</a> (x=0,1,2,3), while rotational backgrounds use <a class="postlink" href="http://nocash.emubase.de/gbatek.htm#lcdiobgrotationscaling" target="_blank">REG_BGxX and REG_BGxY</a> (x=2,3). Note ..HOFS and ..VOFS are normal integers, and ..X and ..Y are .8 fixed point numbers.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#51052 - pizzach - Mon Aug 15, 2005 10:34 pm</h4>
    <div class="postbody"><span class="postbody">I just looked at the values of ROTBG and TEXTBG and feel a bit like an idiot now.  :)  Thanks eternally for the linke Cearn.  I should actually be able to disiffer what the other register names are with that link.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
