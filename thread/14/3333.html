<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Tiles loading odd - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > Tiles loading odd</h2>
<div id="posts">
<div class="post">
    <h4>#20081 - CyberSlag5k - Sat May 01, 2004 5:21 pm</h4>
    <div class="postbody"><span class="postbody">I'm attempting to load some tiles into vram, only they are not loading correctly. Every other pixel appears white:
<br/>
<br/>
<a href="http://homepages.udayton.edu/~pateramj/tiles.gif">[Images not permitted - Click here to view it]</a>
<br/>
<br/>
I was thinking the problem was that the data is stored in a 0xXX format instead of 0xXXXX but even switching converting the data for the first tile produced the same result for that tile.
<br/>
<br/>
to no avail. So perhaps the problem lies elsewhere? My data file looks like this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
const short towerMap[1024] = {
<br/>
1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 
<br/>
1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1
<br/>
,
<br/>
1, 1, 2, 3, 1, 1, 106, 1, 3, 3, 1, 1, 1, 1, 1, 1, 
<br/>
1, 1, 1, 106, 106, 106, 1, 1, 1, 1, 36, 1, 1, 1, 1, 1
<br/>
,
<br/>
1, 106, 1, 3, 1, 1, 1, 1, 1, 3, 3, 3, 1, 1, 1, 1, 
<br/>
1, 106, 1, 1, 1, 1, 1, 1, 17, 1, 36, 36, 4, 1, 1, 1 ......
<br/>
<br/>
const unsigned short towerPalette[256] = {
<br/>
0x7FFF, 0x67FF, 0x4FFF, 0x33FF, 0x1BFF, 0x03FF, 0x7F3F, 0x673F,
<br/>
0x4F3F, 0x333F, 0x1B3F, 0x033F, 0x7E7F, 0x667F, 0x4E7F, 0x327F,
<br/>
0x1A7F, 0x027F, 0x7D9F, 0x659F, 0x4D9F, 0x319F, 0x199F, 0x019F,.....
<br/>
<br/>
const unsigned char towerTiles[18496] = {
<br/>
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
<br/>
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
<br/>
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
<br/>
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
<br/>
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
<br/>
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
<br/>
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
<br/>
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
<br/>
0xE3, 0xE3, 0xE5, 0xE6, 0xE6, 0xE3, 0xE6, 0xE5, ....
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I load the data in as such:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   for(int i = 0; i &lt; 256; i++)
<br/>
        BGPaletteMem[i] = towerPalette[i];
<br/>
<br/>
   for(int i = 0; i &lt; 9248*2; i++)
<br/>
      tileData[i] = towerTiles[i];
<br/>
<br/>
   for(int i = 0; i &lt; 512; i++)
<br/>
      mapData[i] = (towerMap[i];
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Halving the conditional value in the for loop that loads the tile data has no effect.  I'm kind of at a loss here and don't know what else to try...
<br/>
<br/>
Any help would be appreciated.<br/>_________________<br/><span style="font-style: italic">When you find yourself in the company of a halfling and an ill-tempered Dragon, remember, you do not have to outrun the Dragon... </span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20085 - KRoot - Sat May 01, 2004 6:49 pm</h4>
    <div class="postbody"><span class="postbody">The reason that this happens is because you can only send 16 bits to VRAM at a time.  To send the data to VRAM, you have to do a type conversion to 16 bits like this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   u16* temp;      //temporary storage pointer
<br/>
<br/>
   for(int i = 0; i &lt; 256; i++)
<br/>
        BGPaletteMem[i] = towerPalette[i];
<br/>
<br/>
   temp = (u16*)towerTiles;
<br/>
   for(int i = 0; i &lt; 9248*2; i++)
<br/>
      tileData[i] = temp[i];
<br/>
<br/>
   temp = (u16*)towerMap;
<br/>
   for(int i = 0; i &lt; 512; i++)
<br/>
      mapData[i] = temp[i];</td> </tr></table><span class="postbody">
<br/>
<br/>
That should solve the problem.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20086 - CyberSlag5k - Sat May 01, 2004 6:57 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
The reason that this happens is because you can only send 16 bits to VRAM at a time. 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I was unaware of that.
<br/>
<br/>
That fixed the problem, thank you.<br/>_________________<br/><span style="font-style: italic">When you find yourself in the company of a halfling and an ill-tempered Dragon, remember, you do not have to outrun the Dragon... </span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20087 - sajiimori - Sat May 01, 2004 7:13 pm</h4>
    <div class="postbody"><span class="postbody">The map array is already short[], so no change necessary there.
<br/>
<br/>
Also, if tileData is still u16*, the problem isn't quite as KRoot explained it (though the solution still works, of course).  You're reading a byte at a time from towerTiles, and writing 2 bytes at a time to tileData.  The compiler automatically pads the byte with zeros to extend it to 16 bits, so every other pixel is 0, which is transparent.
<br/>
<br/>
When you have transparent pixels that see through to "nothing", the backdrop's color is the first color of the background palette, which is white in your case.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#20098 - CyberSlag5k - Sun May 02, 2004 12:22 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">You're reading a byte at a time from towerTiles, and writing 2 bytes at a time to tileData.</td> </tr></table><span class="postbody">
<br/>
<br/>
I figured something like that was happening. I tried several solutions. Heh, I even tried adding each tileData element to itself each time I loaded. As I think about it, though, it would have made more sense to copy the element, bit shift it two to the left and then OR the two.
<br/>
<br/>
Ahh well. I'm still having some problems with my map but I'm sorting it out. I"ll probly get frustrated in and post a question on it in about an hour. Just so you guys can look forward to that :)<br/>_________________<br/><span style="font-style: italic">When you find yourself in the company of a halfling and an ill-tempered Dragon, remember, you do not have to outrun the Dragon... </span></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
