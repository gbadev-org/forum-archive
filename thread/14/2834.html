<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Trouble with sprites - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Beginners > Trouble with sprites</h2>
<div id="posts">
<div class="post">
    <h4>#16168 - Darmstadium - Tue Feb 10, 2004 3:18 am</h4>
    <div class="postbody"><span class="postbody">I'm having a lot of trouble getting sprites I make to show up right. I convert my pcx image to a header file using dovoto's pcx2sprite. My sprite shows up as a bunch of garbage. Here's my code and the header that contains my sprite and the palette:
<br/>
<br/>
source.cpp
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include "gba.h"
<br/>
#include "dispcnt.h"
<br/>
#include "spriteMan.h"
<br/>
#include "keypad.h"
<br/>
#include "sprite.h"
<br/>
<br/>
void InitializeSprites()
<br/>
{
<br/>
   u16 loop;
<br/>
   for(loop = 0; loop &lt; 128; loop++)
<br/>
   {
<br/>
      sprites[loop].attribute0 = 160;
<br/>
      sprites[loop].attribute1 = 240;
<br/>
   }
<br/>
}
<br/>
<br/>
void CopyOAM()
<br/>
{
<br/>
   u16 loop;
<br/>
   u16* temp = (u16*)sprites;
<br/>
   for(loop = 0; loop &lt; 512; loop++)
<br/>
      OAM[loop] = temp[loop];
<br/>
}
<br/>
<br/>
void WaitForVsync()
<br/>
{
<br/>
   while((volatile u16)REG_VCOUNT != 160){}
<br/>
}
<br/>
<br/>
int main()
<br/>
{
<br/>
   u16 loop;
<br/>
   SetMode(OBJ_MAP_1D | MODE_1 | OBJ_ENABLE);
<br/>
   for(loop = 0; loop &lt; 256; loop++)
<br/>
      OBJPaletteMem[loop] = spriteManPal[loop];
<br/>
   InitializeSprites();
<br/>
   sprites[0].attribute0 = COLOR_256 | TALL | 60;
<br/>
   sprites[0].attribute1 = SIZE_32 | 60;
<br/>
   sprites[0].attribute2 = 0;
<br/>
   
<br/>
   for(loop = 0; loop &lt; 256; loop++)
<br/>
      OAMData[loop] = spriteManData[loop];
<br/>
   while(1)
<br/>
   {
<br/>
      WaitForVsync();
<br/>
      CopyOAM();
<br/>
   }
<br/>
   return 0;
<br/>
}
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
spriteMan.h
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
const u16 spriteManData[] = {
<br/>
                    0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
<br/>
                    0x0000, 0x0000, 0xFF00, 0xFFFF, 0xFFFF, 0xFFFF, 0xFF00, 0xFFFF, 0xFFFF, 0xFFFF,
<br/>
                    0xFF00, 0xFFFF, 0xFFFF, 0xFFFF, 0xFF00, 0xFFFF, 0xFFFF, 0xFFFF, 0xFF00, 0xFFFF,
<br/>
                    0xFFFF, 0xFFFF, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
<br/>
                    0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF,
<br/>
                    0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF,
<br/>
                    0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFF00, 0xFFFF, 0xFFFF, 0xFFFF, 0xFF00, 0xFFFF,
<br/>
                    0xFFFF, 0xFFFF, 0xFF00, 0xFFFF, 0xFFFF, 0xFFFF, 0xFF00, 0xFFFF, 0xFFFF, 0xFFFF,
<br/>
                    0xFF00, 0xFFFF, 0xFFFF, 0xFFFF, 0xFF00, 0xFF00, 0xFFFF, 0xFFFF, 0xFF00, 0xFF00,
<br/>
                    0xFFFF, 0xFFFF, 0xFF00, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF,
<br/>
                    0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF,
<br/>
                    0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0x00FF, 0xFFFF, 0xFFFF, 0xFFFF,
<br/>
                    0x00FF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFF00, 0xFF00,
<br/>
                    0xFFFF, 0xFFFF, 0xFF00, 0xFF00, 0xFFFF, 0xFFFF, 0xFF00, 0xFFFF, 0xFFFF, 0xFFFF,
<br/>
                    0xFF00, 0xFF00, 0xFFFF, 0xFFFF, 0xFF00, 0xFF00, 0xFFFF, 0xFFFF, 0xFF00, 0xFFFF,
<br/>
                    0xFFFF, 0xFFFF, 0xFF00, 0xFF00, 0xFFFF, 0xFFFF, 0xFF00, 0xFF00, 0xFFFF, 0xFFFF,
<br/>
                    0x00FF, 0xFFFF, 0xFFFF, 0xFFFF, 0x00FF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF,
<br/>
                    0xFFFF, 0xFFFF, 0x00FF, 0xFFFF, 0xFFFF, 0xFFFF, 0x00FF, 0xFFFF, 0xFFFF, 0xFFFF,
<br/>
                    0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0x00FF, 0xFFFF, 0xFF00, 0x0000, 0x00FF, 0xFFFF,
<br/>
                    0xFF00, 0x0000, 0xFF00, 0xFFFF, 0xFFFF, 0xFFFF, 0xFF00, 0xFF00, 0xFFFF, 0xFFFF,
<br/>
                    0xFF00, 0xFF00, 0xFFFF, 0xFFFF, 0xFF00, 0xFFFF, 0xFFFF, 0xFFFF, 0xFF00, 0xFF00,
<br/>
                    0xFFFF, 0xFFFF, 0xFF00, 0xFF00, 0xFFFF, 0xFFFF, 0xFF00, 0xFFFF, 0xFFFF, 0xFFFF,
<br/>
                    0xFF00, 0xFF00, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0x00FF, 0xFFFF,
<br/>
                    0x0000, 0xFFFF, 0x00FF, 0xFFFF, 0x0000, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF,
<br/>
                    0x00FF, 0xFFFF, 0xFF00, 0xFFFF, 0x00FF, 0xFFFF, 0xFF00, 0xFFFF, 0xFFFF, 0xFFFF,
<br/>
                    0xFFFF, 0xFFFF, 0x00FF, 0xFFFF, 0xFF00, 0xFFFF,};
<br/>
<br/>
const u16 spriteManPal[] = {
<br/>
                    0x0802, 0x0802, 0x0802, 0x0802, 0x0802, 0x0802, 0x0802, 0x0802, 0x0802, 0x0000,
<br/>
                    0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
<br/>
                    0x0800, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
<br/>
                    0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0800, 0x0000, 0x0000, 0x0000,
<br/>
                    0x0000, 0x0004, 0x0000, 0x0421, 0x0421, 0x0842, 0x0842, 0x0C63, 0x0C63, 0x1084,
<br/>
                    0x1084, 0x14A5, 0x14A5, 0x18C6, 0x18C6, 0x1CE7, 0x1CE7, 0x2108, 0x2108, 0x2529,
<br/>
                    0x2529, 0x294A, 0x294A, 0x2D6B, 0x2D6B, 0x210C, 0x2108, 0x2529, 0x2529, 0x294A,
<br/>
                    0x294A, 0x2D6B, 0x3DEF, 0x4210, 0x4210, 0x4631, 0x4631, 0x4A52, 0x4A52, 0x4673,
<br/>
                    0x4671, 0x5294, 0x5294, 0x56B5, 0x56B5, 0x5AD6, 0x5AD6, 0x5EF7, 0x5EF7, 0x6318,
<br/>
                    0x6318, 0x6739, 0x6739, 0x6B5A, 0x6B5A, 0x6F7B, 0x6F7B, 0x6318, 0x6318, 0x6739,
<br/>
                    0x6739, 0x6B5A, 0x6B5A, 0x6F7B, 0x6F7B, 0x0004, 0x0000, 0x0421, 0x0421, 0x0842,
<br/>
                    0x0842, 0x0C63, 0x0C63, 0x1084, 0x1084, 0x14A5, 0x14A5, 0x18C6, 0x18C6, 0x1CE7,
<br/>
                    0x1CE7, 0x3188, 0x318C, 0x35AD, 0x35AD, 0x39CE, 0x39CE, 0x3DEF, 0x2D6B, 0x318C,
<br/>
                    0x318C, 0x35AD, 0x35AD, 0x39CE, 0x39CE, 0x3DEF, 0x3DEF, 0x4210, 0x4210, 0x4E31,
<br/>
                    0x4E33, 0x4A52, 0x4A52, 0x4E73, 0x4E73, 0x5294, 0x5294, 0x56B5, 0x56B5, 0x5AD6,
<br/>
                    0x5AD6, 0x5EF7, 0x5EF7, 0x739C, 0x739C, 0x77BD, 0x77BD, 0x7BDE, 0x7BDE, 0x7FFF,
<br/>
                    0x7FFF, 0x739C, 0x739C, 0x77BD, 0x77BD, 0x7BDE, 0x7BDE, 0x7FFF, 0x7FFF, 0x0004,
<br/>
                    0x0000, 0x0421, 0x0421, 0x0842, 0x0842, 0x0C63, 0x0C63, 0x1084, 0x1084, 0x14A5,
<br/>
                    0x14A5, 0x18C6, 0x18C6, 0x1CE7, 0x1CE7, 0x2108, 0x2108, 0x2529, 0x2529, 0x294A,
<br/>
                    0x294A, 0x2D6B, 0x2D6B, 0x318C, 0x318C, 0x35AD, 0x35AD, 0x39CE, 0x39CE, 0x3DEF,
<br/>
                    0x3DEF, 0x4210, 0x4210, 0x4631, 0x4631, 0x4A52, 0x4A52, 0x4E73, 0x4E73, 0x5294,
<br/>
                    0x5294, 0x33F1, 0x0015, 0x0020, 0x3809, 0x7A92, 0x3000, 0x382A, 0x0015, 0x0000,
<br/>
                    0x3001, 0x3000, 0x3809, 0x0008, 0x0000, 0x000A, 0x000A, 0x33F6, 0x7A88, 0x3000,
<br/>
                    0x7A8B, 0x3000, 0x0008, 0x0000, 0x0020, 0x0020, 0x3839, 0x33F8, 0x7E33, 0x3000,
<br/>
                    0x0020, 0x0008, 0x33E7, 0x2122, 0x3000, 0x0001, 0x0020, 0x0000, 0x0002, 0x2800,
<br/>
                    0x20DA, 0x0000, 0x0000, 0x33F3, 0x2072, 0x21C0,};
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#16231 - dagamer34 - Wed Feb 11, 2004 1:12 am</h4>
    <div class="postbody"><span class="postbody">Is your sprite supposed to be 64x32 in dimensions? Because that is what it looks like. But you loop for loading data is off because it is loading for a 16x16 (or 256 like you put) sprite.
<br/>
<br/>
Change one of them and it should work. Also, i never did get pcx2gba to work without using either photoshop or paint shop pro so that could be your problem right there.
<br/>
<br/>
And check to make sure that your picture is a 16 or 256 color image. That will screw it up completely if its not.<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#16320 - Cearn - Thu Feb 12, 2004 11:48 am</h4>
    <div class="postbody"><span class="postbody">spriteManData size= 512 bytes (256 u16s)
<br/>
512/64= 8= 2*4, which is the correct amount for a 256 color 16x32 sprite, so that checks out.
<br/>
<br/>
From the data I gather that the sprite should look like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
-------- -------- 
<br/>
-------- -------- 
<br/>
-------- -------- 
<br/>
-******* ********
<br/>
-******* ********
<br/>
-------- ********
<br/>
-------- ********
<br/>
<br/>
-******* ********
<br/>
-******* ********
<br/>
-******* ********
<br/>
-******* ********
<br/>
-******* ********
<br/>
-*-***** *-******
<br/>
-*-***** *-******
<br/>
-******* ********
<br/>
<br/>
-*-***** *-******
<br/>
-*-***** *-******
<br/>
-******* ********
<br/>
-*-***** *-******
<br/>
-*-***** *-******
<br/>
-******* ********
<br/>
-*-***** *-**-*--
<br/>
-*-***** *-**-*--
<br/>
<br/>
-******* ********
<br/>
-*-***** *-**--**
<br/>
-*-***** *-**--**
<br/>
-******* ********
<br/>
-*-***** *-**-***
<br/>
-*-***** *-**-***
<br/>
-******* ********
<br/>
-*-***** *-**-***
<br/>
</td> </tr></table><span class="postbody">
<br/>
I may have missed a pixel or two; the endian-ness always gives me trouble and the columns-count of 10 doesn't exactly help either. Strange looking sprite, though.
<br/>
If this is what the sprite should look like the problem must be in your code, though I can't really see anything wrong with that atm.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#16323 - yaustar - Thu Feb 12, 2004 2:40 pm</h4>
    <div class="postbody"><span class="postbody">This guy double posted into coding as well. The problem has been fixed, it was due to using a 24 bit palette and the tool just didn't like it.<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
