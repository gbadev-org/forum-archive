<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Sprite Data - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > Sprite Data</h2>
<div id="posts">
<div class="post">
    <h4>#170144 - Azenris - Thu Sep 03, 2009 5:11 pm</h4>
    <div class="postbody"><span class="postbody">Hi I was hoping you could help me with something
<br/>
<br/>
how exactly is the sprite data sorted, stored before being used in the memory.
<br/>
basically this is what I have
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
dmaCopy(g_StandardGamePalette, SPRITE_PALETTE, g_StandardGamePalette_size);
<br/>
dmaCopy(tile_graphic_272_, &amp;SPRITE_GFX[0], 256);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I have tested it with an old bin file of a sprite i used to have
<br/>
and got it to work so im assuming the problem is with how ive stored the
<br/>
data.
<br/>
<br/>
the tile stored as
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
const u8 tile_graphic_272_[] = {
<br/>
   0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
<br/>
   0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
<br/>
   0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
<br/>
   0,  0,  0,  0,  0,  0,134,134,134,134,  0,  0,  0,  0,  0,  0,  
<br/>
   0,  0,  0,  0,  0,134, 81, 81, 81, 81,134,  0,  0,  0,  0,  0, 
<br/>
   0,  0,  0,134, 81, 81, 81, 81, 81, 81,134,  0,  0,  0,  0,  0, 
<br/>
   0,  0,  0,134, 81, 81, 81, 81,  9, 81,134,  0,  0,  0,  0,  0,  
<br/>
   0,  0,  0,134, 81, 81, 81, 81,  9, 81,134,  0,  0,  0,  0,  0, 
<br/>
   0,  0,  0,134, 81, 81, 81,  9, 81, 81,134,  0,  0,  0,  0,  0,
<br/>
   0,  0,  0,  0,134, 81, 81, 81, 81,134,  0,  0,  0,  0,  0,  0, 
<br/>
   0,  0,  0,  0,  0,134,134,134,134,  0,  0,  0,  0,  0,  0,  0, 
<br/>
   0,  0,  0,  0,  0,  0,  0,  0,134,  0,  0,  0,134,  0,  0,  0, 
<br/>
   0,  0,  0,  0,  0,  0,  0,  0,  0,134,134,134,  0,  0,  0,  0, 
<br/>
   0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 
<br/>
   0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
<br/>
   0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
<br/>
}; // end of tile_graphic_272_
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
the palette is stored as
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
const u16 g_StandardGamePalette[] = {
<br/>
0x7C7F,0x1B20,0x3260,0x180,0x26C,0x1A73,0x18D3,0x318C,0x18C6,0x7FFF,0x1B,0x27FD,0x1B60,0x0,0x7FFF,
<br/>
0x4E73,0x3FF,0x5EF7,0x1F,0x3180,0x6666,0x33E6,0x4F26,0x6660,0x7D86,0xDF,0x27F,0x19F,0x193,0x1993,
<br/>
0x279,0x273,0x1B33,0x3F9,0x33E0,0x3F3,0x33F,0x1B26,0x3E6,0xD3,0x339,0x1A7F,0x1BFF,0x1A60,0x332C,0x1BF9,
<br/>
0x67E6,0x658C,0x333,0x30DF,0x1B3F,0x6413,0x4E6C,0x7FE0,0xCC,0x1999,0x18C,0x32C,0xD9,0x13,0x1B39,0x199,
<br/>
0x6,0x30D3,0x199F,0x33F3,0x7F26,0x64D3,0x19,0x3266,0x4D80,0x4CC0,0x327F,0x7CD9,0x7FF9,0x6673,0x13,
<br/>
0x33F,0x1B2E,0x64C0,0x7D93,0x1F,0x3FF,0x2BF3,0x7F26,0x7CCC,0x3193,0x333F,0x7FF3,0x7E60,0x672C,0x67F3,
<br/>
0x4F2C,0x7FE6,0x7E6C,0x4F39,0x67E0,0x666C,0x7FEC,0x7F2C,0x3E0,0x260,0x320,0x4E79,0x4E66,0x4FFF,0x4FEC,
<br/>
0x7F39,0x6720,0x67EC,0x180,0x1A60,0x3000,0x7C00,0x4E73,0x26C,0x7F20,0x19,0x4C19,0x3320,0x3260,0x1A6C,
<br/>
0x672C,0x4FFF,0x18C6,0x4F26,0x7F2C,0x30DF,0x199F,0x6726,0x4FE6,0x7E66,0x6739,0x4FF9,0x14,0x3EC,0x1BF3,
<br/>
0x33E6,0x7FE0,0x333F,0x1A7F,0x7F33,0x4FE0,0x318C,0x67E6,0x4E7F,0x181F,0x327F,0x658C,0x1B20,0x4E6C,0x332C,
<br/>
0x1BEC,0x4F20,0x67F9,0x4FF3,0x6580,0x7FEC,0x7E73,0x33F9,0x6673,0x6733,0x67FF,0x18C0,0x3279,0x180C,0x1B2C,
<br/>
0x1BEC,0x7D80,0x3326,0x326C,0x3273,0x18C,0x3181,0x5EE2,0x6650,0x4260,0x11A0,0x2A62,0x2B40,0x1260,0x7CDF,
<br/>
0x7C1F,0x77AB,0x326C,0x1B2C,0x1819,0x1B26,0x18C0,0x7FF9,0x33FF,0x7FF,0x4E60,0x199,0x32C,0xC,0x7D80,0x673F,
<br/>
0x4D9F,0x6580,0x339,0x667F,0x7D9F,0x19F,0x4F20,0x7F20,0x1B3F,0x3279,0x4CC0,0x27F,0x0,0x0,0x0,0x0,0x0,0x0,
<br/>
0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,
<br/>
0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,
<br/>
}; // end of g_StandardGamePalette[]
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
When i run the code I end up with a weird looking scrible. from the colours I can see it
<br/>
is showing correctly, so I think the palette is ok.
<br/>
<br/>
any ideas what im misunderstanding or doing wrong :( TY in advance<br/>_________________<br/><a class="postlink" href="http://sacredpotion.blogspot.com/" target="_blank"><span style="color: red">My Homebrew Games</span></a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#170145 - Kyoufu Kawa - Thu Sep 03, 2009 5:43 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Azenris wrote:</b></span></td> </tr> <tr> <td class="quote">how exactly is the sprite data sorted, stored before being used in the memory.</td> </tr></table><span class="postbody">Same way in both. Depending on the graphics mode, it's either four bits per pixel reversed (like on the MD/Genesis but in another order) or eight bits per pixel.
<br/>
<br/>
Imagine you have a palette that goes black, red, white in that order. Each byte of tile data is worth two pixels:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
{
<br/>
  0x01, 0x20, 0x02, 0x10,
<br/>
  0x10, 0x20, 0x02, 0x01,
<br/>
  0x00, 0x01, 0x10, 0x00,
<br/>
  0x22, 0x10, 0x01, 0x22,
<br/>
  0x22, 0x10, 0x01, 0x22,
<br/>
  0x00, 0x01, 0x10, 0x00,
<br/>
  0x10, 0x20, 0x02, 0x01,
<br/>
  0x01, 0x20, 0x02, 0x10
<br/>
};</td> </tr></table><span class="postbody">
<br/>
<br/>
That would be a red X mark with white blobs on each side. Replacing each nibble (half of a byte) with characters, you'd get this:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
.#$..$#.
<br/>
#.$..$.#
<br/>
...##...
<br/>
$$#..#$$
<br/>
$$#..#$$
<br/>
...##...
<br/>
#.$..$.#
<br/>
.#$..$#.</td> </tr></table><span class="postbody">
<br/>
<br/>
Reversing the order of each pair of nibbles, you get this recognizable shape, as described:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#..$$..#
<br/>
.#.$$.#.
<br/>
..#..#..
<br/>
$$.##.$$
<br/>
$$.##.$$
<br/>
..#..#..
<br/>
.#.$$.#.
<br/>
#..$$..#</td> </tr></table><span class="postbody">
<br/>
<br/>
Eight bits per pixel has each byte be a color index.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#170146 - Cearn - Thu Sep 03, 2009 5:50 pm</h4>
    <div class="postbody"><span class="postbody">The problem is that tile_graphic_272_ isn't tiled. A GBA/NDS tile always means a 8x8 tile. In tiled format, memory is laid out tile-for-tile, not scanline-for-scanline like regular bitmaps. tile_graphic_272_ is stored as a 16x16 bitmap, which comes out wrong because the hardware will use the data as 8x8 tiles. This mismatch of formats tends to end up messy.
<br/>
<br/>
Most graphics converters can translate from bitmapped to tiled data for you. If you want to translate in-game, you'd have to write your own function for that.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#170147 - Azenris - Thu Sep 03, 2009 6:26 pm</h4>
    <div class="postbody"><span class="postbody">Im not actually trying to do tiles, its a sprite. I know its a weird name.
<br/>
<br/>
yea not using a standard graphics converter, my sprites where being made by my map editor. tile_graphic_272_ is actually a cherry sprite. It starts as a bitmap and I wanted to make it a sprite which could then by written to the sprite graphics memory and pointed to by the sprites.
<br/>
<br/>
the reason it was called tile was actually I was hoping I could store an image once in a const array and use it for both tiles and spites. I thik I understand the tiling problem and how I will have to create the tileset ingame. But i dont understand the sprite problem.
<br/>
<br/>
I thought it would be a byte per pixel (as the palette is 256 in size). My video setup is
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void InitVideo(u8 screen)
<br/>
{
<br/>
   if (screen == GAME_SCREEN)
<br/>
   {
<br/>
      // init the main screen
<br/>
      vramSetBankA(VRAM_A_MAIN_BG_0x06000000);   // bank a: (main)   bg memory
<br/>
      vramSetBankB(VRAM_B_MAIN_BG_0x06020000);   // bank b: (main)   bg memory
<br/>
      vramSetBankE(VRAM_E_MAIN_SPRITE);         // bank e: (main)   sprites
<br/>
<br/>
      videoSetMode(MODE_0_2D |         // use mode 0
<br/>
                DISPLAY_SPR_ACTIVE |   // enable sprites
<br/>
                DISPLAY_BG0_ACTIVE |   // enable BG0 layer 0
<br/>
                DISPLAY_BG1_ACTIVE |   // enable BG1 later 1
<br/>
                DISPLAY_BG2_ACTIVE |   // enable BG2 undefined
<br/>
                DISPLAY_SPR_1D);      // map sprites as 1D
<br/>
<br/>
      REG_BG0CNT = BG_32x32 | BG_COLOR_256 | BG_MAP_BASE(0) | BG_TILE_BASE(1) | BG_PRIORITY(2);   // setup the background 0
<br/>
      REG_BG1CNT = BG_32x32 | BG_COLOR_256 | BG_MAP_BASE(1) | BG_TILE_BASE(2) | BG_PRIORITY(2);   // setup the background 1
<br/>
      REG_BG2CNT = BG_32x32 | BG_COLOR_256 | BG_MAP_BASE(2) | BG_TILE_BASE(3) | BG_PRIORITY(2);   // setup the background 2
<br/>
<br/>
      // init the sub screen
<br/>
      vramSetBankC(VRAM_C_SUB_BG_0x06200000);      // bank c: (sub)   bg memory
<br/>
<br/>
      videoSetModeSub(MODE_0_2D |               // use mode 0
<br/>
                  DISPLAY_BG0_ACTIVE |      // enable BG0
<br/>
                  DISPLAY_BG1_ACTIVE);      // enable BG1
<br/>
<br/>
<br/>
   }
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
EDIT:
<br/>
<br/>
<a href="http://img3.imageshack.us/img3/9521/outputj.jpg">[Images not permitted - Click here to view it]</a><br/>_________________<br/><a class="postlink" href="http://sacredpotion.blogspot.com/" target="_blank"><span style="color: red">My Homebrew Games</span></a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#170149 - Cearn - Thu Sep 03, 2009 8:06 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Azenris wrote:</b></span></td> </tr> <tr> <td class="quote">Im not actually trying to do tiles, its a sprite. I know its a weird name.
<br/>
</td> </tr></table><span class="postbody">
<br/>
Both backgrounds and objects use tiled graphics (well mostly), so you still need the conversion.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#170152 - Azenris - Thu Sep 03, 2009 9:13 pm</h4>
    <div class="postbody"><span class="postbody">ok i understand, gonna try it out, thanks.
<br/>
<br/>
EDIT:
<br/>
<br/>
just came back to say I got it working, i mean all except my image is upside down, but thats how the bitmap is stored, will just have to flip it before writing it to the array. But anyway got it working thanks.<br/>_________________<br/><a class="postlink" href="http://sacredpotion.blogspot.com/" target="_blank"><span style="color: red">My Homebrew Games</span></a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
