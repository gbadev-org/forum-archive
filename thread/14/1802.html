<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Mode4 syntax? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Beginners > Mode4 syntax?</h2>
<div id="posts">
<div class="post">
    <h4>#9193 - jonathan_ingram - Wed Jul 30, 2003 2:34 pm</h4>
    <div class="postbody"><span class="postbody">Hello,
<br/>
        Please can anyone help me out with the method you draw to the screen using mode 4......I'm currently using mode 3 and the syntax goes as such:
<br/>
<br/>
    setMode(SCREENMODE3 | BG@ENABLE);
<br/>
    VideoBuffer( x + y*240) = RGB(31,31,31);
<br/>
<br/>
Would draw a white pixel at x,y.....do you have to load the palette as an array for mode4? Because if i simply switch SCREENMODE3 to SCREENMODE4 nothing is drawn to the screen.
<br/>
<br/>
It's a bit of a trivial problem i know but if someone could help it'd be appreciated. Cheers.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9195 - niltsair - Wed Jul 30, 2003 2:39 pm</h4>
    <div class="postbody"><span class="postbody">Mode4 is paletted which means you have to :
<br/>
-Load 256colors in the palette video memory
<br/>
-Instead of writing colors to the screen, you write index to your palette.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9197 - jonathan_ingram - Wed Jul 30, 2003 2:47 pm</h4>
    <div class="postbody"><span class="postbody">Got it (i think, should 240 be replaced with 120?)
<br/>
<br/>
   Something like this?
<br/>
<br/>
  void plotPixel(int x, int y, int c)
<br/>
  {
<br/>
       setMode(SCREENMODE4 | BG2ENABLE);
<br/>
       VideoBuffer(x + y*240) = c;
<br/>
  }
<br/>
<br/>
  Where c is the the reference to the colour location in the loaded palette?
<br/>
  Also which mode 3, 4 or 5 is best for double buffering? To my knowledge 3 has none, 4 and 5 have, so which is recommended?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9200 - niltsair - Wed Jul 30, 2003 3:06 pm</h4>
    <div class="postbody"><span class="postbody">A little thing to be aware, video memory can only written 16bits at a time. So, if you only want to write 1 pixel in mode 4, then you have to read 2pixels values, replace one, write them back.
<br/>
<br/>
Mode 4 work fullscreen with double-buffering. There's a possibility to do the same in mode 5, but ti will mean to scale the background. You could also create your own double-buffering while still using mode 3. The GBA has 256k of external ram, you could use it to draw your things there, and then send it to the screen on VCount interrupt.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9201 - jonathan_ingram - Wed Jul 30, 2003 3:11 pm</h4>
    <div class="postbody"><span class="postbody">Thanks, especially for the mode 3 double buffering idea.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9202 - niltsair - Wed Jul 30, 2003 3:21 pm</h4>
    <div class="postbody"><span class="postbody">By sending it to the screen, I meant using Dma and not a loop ;-)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9204 - tepples - Wed Jul 30, 2003 5:02 pm</h4>
    <div class="postbody"><span class="postbody">Mode 3 graphics can be double-buffered in either of two ways:<ul><li>through a software page flip, that is, a DMA copy from RAM, or </li><li>through a hardware page flip, which involves stretching the screen by a factor of 2 horizontally (BGAFFINE[2].pa = 0x80) and then scrolling to each of the buffers (BGAFFINE[2].x_origin = 120 &lt;&lt; 8).</li></ul>The second method is similar to the "rotated mode 5" but doesn't involve a rotation.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9217 - Archeious - Wed Jul 30, 2003 9:57 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>jonathan_ingram wrote:</b></span></td> </tr> <tr> <td class="quote">Hello,
<br/>
        Please can anyone help me out with the method you draw to the screen using mode 4......I'm currently using mode 3 and the syntax goes as such:
<br/>
<br/>
    setMode(SCREENMODE3 | BG@ENABLE);
<br/>
    VideoBuffer( x + y*240) = RGB(31,31,31);
<br/>
<br/>
Would draw a white pixel at x,y.....do you have to load the palette as an array for mode4? Because if i simply switch SCREENMODE3 to SCREENMODE4 nothing is drawn to the screen.
<br/>
<br/>
It's a bit of a trivial problem i know but if someone could help it'd be appreciated. Cheers.</td> </tr></table><span class="postbody">
<br/>
<br/>
You just have to remember that the GBA has to transfer 16bit at a time.  So you have to pull the word and mask off the offensive bit and mask in the correct bits.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void plotPixel(u16 x, u16 y, u8 c) 
<br/>
{ 
<br/>
u16 tempPixel;
<br/>
<br/>
setMode(SCREENMODE4 | BG2ENABLE); 
<br/>
    // Mask off lowest bit to assure the value is word aligned
<br/>
    tempPixel =VideoBuffer[(x &amp;&amp; 0xFFFE) + y*240];
<br/>
<br/>
    // If x is odd then the new pixel is the second byte in the word
<br/>
    if (x &amp;&amp; 0x0001)
<br/>
    {
<br/>
        tempPixel = tempPixel &amp; 0xFF00;  // mask off second byte
<br/>
        tempPixel = tempPixel | c;  // OR the color into the temp pixel
<br/>
    } else {
<br/>
        tempPixel = tempPixel &amp; 0x00FF; // mask off the first byte
<br/>
        tempPixel = tempPixel | ( c  &lt;&lt; 8); // shift the color 8 and then OR it.
<br/>
    }
<br/>
    VideoBuffer[(x &amp;&amp; 0xFFFE) + y*240] = tempPixel;  // move the entire word back into the video memory
<br/>
}</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
