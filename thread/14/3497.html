<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Problem with a tutorial modification - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Beginners > Problem with a tutorial modification</h2>
<div id="posts">
<div class="post">
    <h4>#21529 - tornadokick - Mon May 31, 2004 2:06 am</h4>
    <div class="postbody"><span class="postbody">Hey, I'm trying to get into this gba programming (so I'm new), and I was messing around with one of the tutorials.  Alright.  What I was trying to do was create an array which would hold information for the different colors, and then copy that array onto the screen.  The Problem is that the program freezes.  I've tried everything I could think of, but nothing changes.  This is what I have:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
#include &lt;math.h&gt;    //sign and cos stuff
<br/>
#include "gba.h"         //GBA register definitions
<br/>
#include "dispcnt.h"     //REG_DISPCNT register #defines
<br/>
#include "keypad.h"      //button registers
<br/>
//#include "bg.h"          //background definitions
<br/>
//#include "function.h"
<br/>
<br/>
#define RGB(r,g,b) ((r) + ((g)&lt;&lt;5) + ((b)&lt;&lt;10))
<br/>
<br/>
u16* videoBuffer = (u16*) 0x6000000;
<br/>
void PlotPixel(int x, int y, unsigned short int c) { videoBuffer[y*240 + x] = c; }
<br/>
<br/>
int main()      // start of program
<br/>
{
<br/>
   SetMode(MODE_3 | BG2_ENABLE);
<br/>
   
<br/>
   unsigned short int screen [240][160];
<br/>
<br/>
   for (int i = 0; i &lt; 240; i++)
<br/>
   {
<br/>
      for (int j = 0; j &lt; 160; j++)
<br/>
      {
<br/>
         screen[i][j] = RGB(31,31,31);  // most likely freezes here
<br/>
      }
<br/>
   }         
<br/>
<br/>
   for(int x = 0; x &lt; 240; x++) 
<br/>
   {
<br/>
      for(int y = 0; y &lt; 160; y++) 
<br/>
      {
<br/>
         PlotPixel(x, y, RGB(30,0,0));   //screen[x][y]); 
<br/>
      } 
<br/>
   } 
<br/>
<br/>
   return 0;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
It seems that the program freezes in the first for loop.  If I comment that out, the program continues and goes to the second loop
<br/>
Might the gba not be able to handle something like that?  
<br/>
<br/>
Any help is appreciated.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#21531 - wintermute - Mon May 31, 2004 2:38 am</h4>
    <div class="postbody"><span class="postbody">local variables are placed in IWRAM by default in most cases - it's only 32k so your code will instantly die with a local 240x160 array.
<br/>
<br/>
either use a global with __attribute__(section(".ewram")) or with devkitARM and it's built in linkscripts you can use __attribute__(section(".sbss")) or malloc</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#21540 - niltsair - Mon May 31, 2004 2:33 pm</h4>
    <div class="postbody"><span class="postbody">Also, at the end of main procedure, add a <span style="font-weight: bold">while(1);</span> just before the <span style="font-style: italic">return 0;</span>, else the GBA reset.<br/>_________________<br/>-Inside every large program is a small program struggling to get out. (Hoare's Law of Large Programs)
<br/>
-The man who can smile when things go wrong has thought of someone he can blame it on. (Nixon's Theorem)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#21542 - tornadokick - Mon May 31, 2004 3:44 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>niltsair wrote:</b></span></td> </tr> <tr> <td class="quote">Also, at the end of main procedure, add a <span style="font-weight: bold">while(1);</span> just before the <span style="font-style: italic">return 0;</span>, else the GBA reset.</td> </tr></table><span class="postbody">
<br/>
<br/>
Hmm, that doesn't seem to be the case.  If I comment out the line where i fill in the information for the screen to display, the program runs normally and fills the screen.  The screen does not reset, so I doubt that the while(1) statement you suggested would do anything.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#21543 - zazery - Mon May 31, 2004 3:57 pm</h4>
    <div class="postbody"><span class="postbody">From my experience it works fine in Visual Boy Advance without it depending on what you are doing. However on the actual hardware it doesn't work so nicely. You need to either include that or an infinite loop that contains calls to functions to process input and output. Never let your code end, that's pretty much the safest way to go about coding programs for the GBA.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#21545 - tornadokick - Mon May 31, 2004 4:44 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">local variables are placed in IWRAM by default in most cases - it's only 32k so your code will instantly die with a local 240x160 array.
<br/>
<br/>
either use a global with __attribute__(section(".ewram")) or with devkitARM and it's built in linkscripts you can use __attribute__(section(".sbss")) or malloc</td> </tr></table><span class="postbody">
<br/>
<br/>
alright, thanx for the knowledge.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
