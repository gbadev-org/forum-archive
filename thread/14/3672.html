<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Writing a Perl rom trimmer: pbs with seek() and read() - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Beginners > Writing a Perl rom trimmer: pbs with seek() and read()</h2>
<div id="posts">
<div class="post">
    <h4>#23184 - Vince - Tue Jul 06, 2004 7:38 pm</h4>
    <div class="postbody"><span class="postbody">Hiya to you all,
<br/>
<br/>
Since I am not so experienced in GBA devel, I post here despite the fact that my request does not directly address GBA programming but managing ROMS instead.
<br/>
I want to write utilities to be able to manage ROMs under Linux/free OSes. One of them is a ROM trimmer. I use Perl as a language.
<br/>
<br/>
Basically, what I wanted to do is the following :
<br/>
1. Use the seek() function to go to the end of the ROM file.
<br/>
2. Iterate on bytes reading backwards with read() as long as the byte read is a 00 or an FF. Stop when different. I would get a certain location (let's name it $offset) from the end of the ROM
<br/>
3. Now go to the beginning of the ROM
<br/>
4. Copy ROM contents from start to (size-$offset) into new file : ROM_trimmed.gba
<br/>
<br/>
However, I have problems with read() which, along reading a byte, advances the "seek cursor" position by one byte. Instead of having to, before doing a new read, going backwards two bytes, I wanted to know if there is a possibility to read backwards in an easier manner.
<br/>
<br/>
Thank you for your attention, I hope I was clear enough
<br/>
<br/>
Vince</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23188 - tepples - Wed Jul 07, 2004 1:12 am</h4>
    <div class="postbody"><span class="postbody">Try seeking and reading 32 KB at a time.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23200 - Vince - Wed Jul 07, 2004 9:35 am</h4>
    <div class="postbody"><span class="postbody">Hi tepples,
<br/>
<br/>
Thank you for your answer. 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Try seeking and reading 32 KB at a time</td> </tr></table><span class="postbody">
<br/>
While I can understand that GBA code need to be aligned on 32 bits boundaries (thus allowing me to read 4 bytes at a time, an improvement over the 1 byte read), I still not understand your answer.
<br/>
IMHO, 32KB (you were talking about bytes weren't you?) is too much to read at a time.
<br/>
<br/>
Could you elaborate on this?
<br/>
<br/>
Thank you for your time.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23222 - tepples - Wed Jul 07, 2004 8:31 pm</h4>
    <div class="postbody"><span class="postbody">32768 bytes is the granularity of many flash cartridges' bankswitch registers. Therefore, when size-stripping a ROM, it's best to size-strip in 32 KB increments.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#23411 - Vince - Mon Jul 12, 2004 9:24 am</h4>
    <div class="postbody"><span class="postbody">Hi back tepples,
<br/>
<br/>
Thanks for your answer, I got it now. 
<br/>
I will also look deeper into the bankswitching mechanisms involved with flash carts to get a thorough understanding of the underlying principles.
<br/>
<br/>
Thanks again,
<br/>
<br/>
Vince</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
