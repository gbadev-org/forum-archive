<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>About KeyPad,Help! - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Beginners > About KeyPad,Help!</h2>
<div id="posts">
<div class="post">
    <h4>#11963 - valkyrie_pf - Sat Oct 25, 2003 4:35 am</h4>
    <div class="postbody"><span class="postbody">My code: 
<br/>
<span style="color: green">void QueryKey() 
<br/>
{ if(F_CTRLINPUT_A_PRESSED) 
<br/>
{ 
<br/>
......... 
<br/>
} 
<br/>
} 
<br/>
void vblFunc() 
<br/>
{ QueryKey(); 
<br/>
.......... 
<br/>
} </span>
<br/>
when i press A(the KeyPad),it input many A. 
<br/>
I  want only an A when I press A(the KeyPad) once. 
<br/>
How Can I Do ?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11965 - sajiimori - Sat Oct 25, 2003 6:16 am</h4>
    <div class="postbody"><span class="postbody">After processing input, save the keypad state.  On the next frame, respond only to the keys that have changed.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11984 - Gopher - Sat Oct 25, 2003 7:31 pm</h4>
    <div class="postbody"><span class="postbody">IF you're only checking input at one point in your program, you can just create a global u16 PrevKeys. After your code that tests for key events, just set PrevKeys to the current key register values.
<br/>
<br/>
Then you can use the xor operator ( ^ ) to find bits that have just changed.
<br/>
<br/>
Here's some simple code to demonstrate this
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
//define the keystate register
<br/>
#define KEYSTATE (*(volatile unsigned short *)0x04000130) 
<br/>
<br/>
//make a global to hold previous keystate, initialize to no keys pressed
<br/>
unsigned short PrevKeyState=0x3ff;
<br/>
<br/>
//this macro will test if a key is pressed
<br/>
#define KEYDOWN(key) (!(KEYSTATE &amp; (key)))
<br/>
<br/>
//this one will test if a key has CHANGED
<br/>
#define KEYCHANGED(key) (!((KEYSTATE^PrevKeyState)&amp;key)
<br/>
<br/>
int main()
<br/>
{
<br/>
    //initialize anything that needs initing
<br/>
    Init();
<br/>
<br/>
    //main loop  
<br/>
    while(1)
<br/>
    {
<br/>
        //if A is pressed and it just changed
<br/>
         if (KEYCHANGED(KEY_A) &amp;&amp; KEYPRESSED(KEY_A))
<br/>
         {
<br/>
             DoSomething();
<br/>
         }
<br/>
    }
<br/>
<br/>
  //never happens but the compiler insists it be here   
<br/>
   return 0;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Haven't actually tested it but that should work.<br/>_________________<br/>"Only two things are infinite: the universe, and human stupidity. The first is debatable." -Albert Einstein</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11992 - valkyrie_pf - Sun Oct 26, 2003 4:29 am</h4>
    <div class="postbody"><span class="postbody">Thanks</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
