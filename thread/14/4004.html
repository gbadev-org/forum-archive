<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Sprites .. .. .. - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Beginners > Sprites .. .. ..</h2>
<div id="posts">
<div class="post">
    <h4>#25908 - pio_troland@wp.pl - Tue Aug 31, 2004 2:05 pm</h4>
    <div class="postbody"><span class="postbody">How to make a sprite bigger or smaller?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25911 - keldon - Tue Aug 31, 2004 3:03 pm</h4>
    <div class="postbody"><span class="postbody">what you are after is scaling, the link provided should help <a href="http://user.chem.tue.nl/jakvijn/tonc/affine.htm" target="_blank">http://user.chem.tue.nl/jakvijn/tonc/affine.htm</a>
<br/>
<br/>
For other information, the FAQ lists a lot of this (including that link).
<br/>
<br/>
---
<br/>
<br/>
in short, you'll be manipulating the sprites scale attributes.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25919 - zazery - Tue Aug 31, 2004 5:26 pm</h4>
    <div class="postbody"><span class="postbody">One thing I don't think is mentioned is that you can sew sprites together. I've seen it after disecting my dumped commercial games. It turns out to save space one sprite consists of a few 8x8 sprites and a few 16x8 sprites. You can get around the 64x64 limit by making sprites move together in special ways. I haven't bothered with it yet.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25923 - sajiimori - Tue Aug 31, 2004 6:34 pm</h4>
    <div class="postbody"><span class="postbody">Mixing that with scaling is a real pain.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25941 - keldon - Wed Sep 01, 2004 5:57 pm</h4>
    <div class="postbody"><span class="postbody">well why not simply code one, and report back the problems to the community</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25943 - Miked0801 - Wed Sep 01, 2004 6:02 pm</h4>
    <div class="postbody"><span class="postbody">Because we NDA'd him too.  Muhuhahahaha!
<br/>
<br/>
No really, the hard part of doing this is figuring out just how the hardware handles sprite scaling.  We've got a version locally that does this correctly about 99% of the time, though occasionally, we get a 1 line overlap...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25954 - dagamer34 - Wed Sep 01, 2004 8:43 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Miked0801 wrote:</b></span></td> </tr> <tr> <td class="quote">Because we NDA'd him too.  Muhuhahahaha!
<br/>
<br/>
No really, the hard part of doing this is figuring out just how the hardware handles sprite scaling.  We've got a version locally that does this correctly about 99% of the time, though occasionally, we get a 1 line overlap...</td> </tr></table><span class="postbody">
<br/>
<br/>
Pain in the @$$, huh?<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25955 - DiscoStew - Wed Sep 01, 2004 8:55 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">Mixing that with scaling is a real pain</td> </tr></table><span class="postbody">
<br/>
Yes, it is a real pain, but once you've got it working, you fell great knowing that you accomplished it. That is how I felt.
<br/>
I had worked on my Object Handler/Animator for so many months (since last year, but these past few months I've been doing other things), and that one key element alone took a good amount of time to implement. As much as I'd like to show the little demo that I made with it, I can't because it would give away what my major demo is based on. It's hard to not show off the long hours you put into something because in the end, you want people to look at it and think "WOW!"
<br/>
And I'm sorry, I am not giving any source code out of it because something of this magnitude is too precious to give away. I'll probably make a library out of it or something sometime in the future. Please don't ask when.<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25956 - poslundc - Wed Sep 01, 2004 9:08 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>DiscoStew wrote:</b></span></td> </tr> <tr> <td class="quote">It's hard to not show off the long hours you put into something because in the end, you want people to look at it and think "WOW!"
<br/>
And I'm sorry, I am not giving any source code out of it because something of this magnitude is too precious to give away.</td> </tr></table><span class="postbody">
<br/>
<br/>
HAhahaha...
<br/>
<br/>
... "Precious"? Figuring out the scaling adjustments is a pain, sure. But it's a pain that takes like maybe fifteen minutes or so with paper and pencil once you're committed to doing it.
<br/>
<br/>
Not trying to get down on you for your independent work (which is commendable), and not suggesting you distribute your source code or anything (which is perfectly allright as far as I'm concerned... it's not like I'm dishing out all of my source), but... get off your high horse. You ain't that special, kid.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25959 - ecurtz - Wed Sep 01, 2004 10:07 pm</h4>
    <div class="postbody"><span class="postbody">Heh heh...
<br/>
<br/>
I think if you're gonna talk that kind of smack you better make with the code poslundc...
<br/>
<br/>
eli</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25960 - DiscoStew - Wed Sep 01, 2004 10:13 pm</h4>
    <div class="postbody"><span class="postbody">Ok, so maybe I stretched it out a little bit there on the scaling adjustments, but the amount of work I put into my actual Object Handler/Animator, including the tedious pieces associated like sprite memory management, palette/sprite cel sharing, prioritizing, and all that other junk I'm implemented, leaving someone using the library to not have to deal with a single memory-mapped register or VRAM memory completely associated with sprites IS precious to me! THAT is what I meant!
<br/>
<br/>
I may not be as talented as many people here (including yourself), but when does that give you the right to mock people who aren't as talented?<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25961 - poslundc - Wed Sep 01, 2004 10:27 pm</h4>
    <div class="postbody"><span class="postbody">Sorry if I came across as mocking. There's nothing wrong with being proud of what you've done, but seriously, try to keep your passions in check. To my knowledge the forum hasn't been crawling with people begging you to release your precious source code to the public, so what's the point of bringing it up? Your post came across as trying to impress everyone with your uber-coding-skillz. Just so you know, we're not. Maybe try again after you've been published or something.
<br/>
<br/>
ecurtz: You can find some of my older stuff at <a class="postlink" href="http://www.danposluns.com/gbadev" target="_blank">http://www.danposluns.com/gbadev</a>, FWIW.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25963 - sajiimori - Wed Sep 01, 2004 10:52 pm</h4>
    <div class="postbody"><span class="postbody">Sheesh, it was just one little comment. :/  Is it a full moon or something?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25965 - DiscoStew - Wed Sep 01, 2004 11:23 pm</h4>
    <div class="postbody"><span class="postbody">Like I said, I'm not as talented as many people here. Heck, everyone who has released a demo is showing off their skills with the GBA; I just haven't released a demo yet. And ofcourse no one has asked about the source code, because practically nobody knew I was doing this before-hand. Is it so bad to state what I plan to do with it before people ask me questions? I may be stating the obvious, but doesn't everyone now and then?
<br/>
<br/>
Perhaps we should stop this before it gets out of hand. This isn't helping anyone, including ourselves. I'll just keep my mouth shut on the subject.<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25971 - dagamer34 - Thu Sep 02, 2004 4:10 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>DiscoStew wrote:</b></span></td> </tr> <tr> <td class="quote">Like I said, I'm not as talented as many people here. Heck, everyone who has released a demo is showing off their skills with the GBA; I just haven't released a demo yet. And ofcourse no one has asked about the source code, because practically nobody knew I was doing this before-hand. Is it so bad to state what I plan to do with it before people ask me questions? I may be stating the obvious, but doesn't everyone now and then?
<br/>
<br/>
Perhaps we should stop this before it gets out of hand. This isn't helping anyone, including ourselves. I'll just keep my mouth shut on the subject.</td> </tr></table><span class="postbody">
<br/>
<br/>
I've released a demo but it's still pending. I sent it about a week ago but it still hasn't gotten up to the main page. What's the hold-up?<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#26066 - Cearn - Mon Sep 06, 2004 2:56 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>zazery wrote:</b></span></td> </tr> <tr> <td class="quote">One thing I don't think is mentioned is that you can sew sprites together. </td> </tr></table><span class="postbody">It's on the todo list, but here's the general gist of it. (Sorry if this seems a little bit rushed, I'll see if I can write a more proper document later)
<br/>
<br/>
Combining/sewing affine sprites is basically the same as the anchoring I used in the <a class="postlink" href="http://user.chem.tue.nl/jakvijn/tonc/mode7ex.htm#objs" target="_blank">mode 7 tutorial</a>. The basic equation for any type of affine mapping is
<br/>
(1) <span style="font-weight: bold">P</span>*(<span style="font-weight: bold">q-q0</span>) = <span style="font-weight: bold">p-p0</span>, 
<br/>
where
<br/>
<span style="font-weight: bold">P</span> : the familiar P matrix
<br/>
<span style="font-weight: bold">p</span>, <span style="font-weight: bold">q</span> : arbitrary points in texture and screen space, respectively
<br/>
<span style="font-weight: bold">p0</span>, <span style="font-weight: bold">q0</span> : the mapping's origins (again, in texture and screen space, respectively)
<br/>
<br/>
For sprites, the origins are always at the center of the sprites, so
<br/>
(2) <span style="font-weight: bold">P</span>*(<span style="font-weight: bold">q-cq</span>) = <span style="font-weight: bold">p-cp</span>,
<br/>
where <span style="font-weight: bold">cp</span> and <span style="font-weight: bold">cq</span> the sprite's center in texture and screen space. To change this to an arbitrary origin (the aforementioned <span style="font-weight: bold">p0</span> and <span style="font-weight: bold">q0</span>), simply subtract the equations and shuffle:
<br/>
<br/>
<span style="font-weight: bold">P</span>*(<span style="font-weight: bold">q-q0</span>) = <span style="font-weight: bold">p-p0</span>
<br/>
<span style="font-weight: bold">P</span>*(<span style="font-weight: bold">q-cq</span>) = <span style="font-weight: bold">p-cp</span> -
<br/>
----------------------------------------
<br/>
<span style="font-weight: bold">P</span>*(<span style="font-weight: bold">cq-q0</span>) = <span style="font-weight: bold">cp-p0</span>
<br/>
<br/>
(3) <span style="font-weight: bold">cq</span> = <span style="font-weight: bold">q0</span> + <span style="font-weight: bold">P</span>^(-1) * (<span style="font-weight: bold">cp-p0</span>)
<br/>
Or, a little bit shorter, 
<br/>
(3b) <span style="font-weight: bold">cq</span> = <span style="font-weight: bold">q0</span> - <span style="font-weight: bold">P</span>^(-1) * <span style="font-weight: bold">a</span>
<br/>
where <span style="font-weight: bold">a</span> the anchor: the point of the sprite you want as your origin, relative to its center.
<br/>
<br/>
The final step is to calculate the top-left coordinates <span style="font-weight: bold">dx</span> of the sprite to enter into the OAM:
<br/>
(4) <span style="font-weight: bold">dx</span> = <span style="font-weight: bold">cq</span> - <span style="font-style: italic">b</span>*<span style="font-weight: bold">s</span>
<br/>
where <span style="font-weight: bold">s</span> is the size of the sprite ( <span style="font-weight: bold">s</span>=(width,height) ) and <span style="font-style: italic">b</span> is a parameter to account for the influence of the double-size flag. <span style="font-style: italic">b</span>=1 if DS is on and 1/2 if it's off.
<br/>
<br/>
Recapping, you have
<br/>
(3b) <span style="font-weight: bold">cq</span> = <span style="font-weight: bold">q0</span> - <span style="font-weight: bold">P</span>^(-1) * <span style="font-weight: bold">a</span>
<br/>
 (4) <span style="font-weight: bold">dx</span> = <span style="font-weight: bold">cq</span> - <span style="font-style: italic">b</span>*<span style="font-weight: bold">s</span>
<br/>
<br/>
To use this for combined sprites, draw the combined sprite in an image editor, pick an origin, create a list of anchors (and sizes) for each sub-sprite, then apply eq 3b and 4.
<br/>
<br/>
That's the easy part. Putting it into practice brings a number of potential problems.
<br/>
<br/>
Firstly, because you need the inverse of <span style="font-weight: bold">P</span>, there may be roundoff errors in the calculations. while theoretically <span style="font-weight: bold">P*P</span>^(-1) =<span style="font-weight: bold">I</span>, it'll probably be off just a little bit unless you pick your parameters with care.
<br/>
Secondly, and this is probably more important, even though you've moved the origin to <span style="font-weight: bold">p0</span> as far as placement is concerned, the affine mapping itself <span style="font-style: italic">still starts at the center of the sprite</span>! To see why this is important, consider this example: start with a simple width-16 texture line of alternating pixels; something like:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code"> #_#_#_#_x_#_#_#_</td> </tr></table><span class="postbody">
<br/>
Upon scaling it could look like this
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#__#__#__#__x__#__#__#__</td> </tr></table><span class="postbody">
<br/>
regardless of where you place it. Now, if you were to use 2 of these to make a larger sprite, placed 4 pixels apart, you'd get something like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#__#__#__#__x__#__#__#__
<br/>
    #__#__#__#__x__#__#__#__
<br/>
</td> </tr></table><span class="postbody">
<br/>
Note that the hashes aren't aligned anymore. Even worse, if you try to sew together multiple sprites of different dimensions, the pixel-to-pixel transformations will be different even if you use the <span style="font-style: italic">exact same</span> matrix!
<br/>
And then, of course, there's that annoying clipping artifact; even with the DS flag on, you will lose pixels for non-square sprites on rotation. If that happens to a middle sprite of your combination, well ... eeww.
<br/>
<br/>
So yeah, sewing together affine sprites is a real pain. If anyone is interested in a simple demo that shows the theory given above and its inherent problems, take a look at <a class="postlink" href="http://user.chem.tue.nl/jakvijn/files/affcombo.zip" target="_blank">this</a> rather sad excuse of a demo that I threw together a few weeks ago.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
