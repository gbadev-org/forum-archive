<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Sprite Problem - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Beginners > Sprite Problem</h2>
<div id="posts">
<div class="post">
    <h4>#9496 - iuiz - Wed Aug 06, 2003 12:04 pm</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
I got a Problem, by displaying an animated Sprite. My Sprite has 16*32 Pixels and 6 Frames (16*192Pixel). <a class="postlink" href="http://www.halof.com/player2.gif" target="_blank">www.halof.com/player2.gif</a> I converted it, using bmp2gba.exe, without Problems.
<br/>
<br/>
My Sprite Struct looks like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">typedef struct
<br/>
{
<br/>
   u16 x;               //x and y position on screen
<br/>
   u16 y;
<br/>
   u16 spriteFrame[6];     //animation frame storage
<br/>
   int direction;   //0=standing,1=up, 2=right, 3=down, 4=left
<br/>
   int activeFrame;        //which frame is active
<br/>
   u16 OAMSpriteNum;       //which sprite referring to
<br/>
}Sprite;</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
And here I try to initalise my Sprite:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">//Player Sprite -&gt;
<br/>
   player.x = 120;
<br/>
   player.y = 100;
<br/>
   player.activeFrame = 0;
<br/>
   player.spriteFrame[0] = 0;
<br/>
   player.spriteFrame[1] = 16;
<br/>
   player.spriteFrame[2] = 32;
<br/>
   player.spriteFrame[3] = 48;
<br/>
   player.spriteFrame[4] = 64;
<br/>
   player.spriteFrame[5] = 80;
<br/>
   player.direction = 0;
<br/>
   player.OAMSpriteNum = 0;
<br/>
<br/>
   sprites[0].attribute0 = COLOR_256 | WIDE | player.y;
<br/>
   sprites[0].attribute1 = SIZE_32 | player.x;
<br/>
   sprites[0].attribute2 = 0;
<br/>
<br/>
    for(loop = 0; loop &lt; 3072; loop++)
<br/>
   {
<br/>
      OAMData[loop] = playerData[loop];
<br/>
   }</td> </tr></table><span class="postbody">
<br/>
<br/>
I have no Problems, displaying 	player.spriteFrame[0] to [3], but [4] is just 0 again. 
<br/>
<br/>
Can someone help me. Thx</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9497 - mtg101 - Wed Aug 06, 2003 1:36 pm</h4>
    <div class="postbody"><span class="postbody">I'm not sure if this is related, but shouldn't that last for loop be looping to (3072 / 2) not (3072), as you're dealing with 16bit OAMData/playerData?<br/>_________________<br/>---
<br/>
Speaker for the Dead</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9499 - iuiz - Wed Aug 06, 2003 2:41 pm</h4>
    <div class="postbody"><span class="postbody">Ups, you are right. Normaly I user 1536, but as i spend hours in finding the bug i tryed to doubbel this value, so that there is 3072 at this moment. But 3072/2 doesnt help. The Sprite isnt displayed correct.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9500 - iuiz - Wed Aug 06, 2003 2:55 pm</h4>
    <div class="postbody"><span class="postbody">Ok, I found a way to display the Sprite correctly. Somehow it has some Elements of dynamic Memory management, but I dont know if it doesnt takes to much CPU Power on Hardware, because I dont own a ez-f device, yet.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">//Main Loop:
<br/>
   while(1) {
<br/>
      GetInput();
<br/>
<br/>
      // Move the Main Charakter -&gt;
<br/>
      if(player.direction==1 &amp;&amp; gSprite.actualSprite1!=0) {
<br/>
         InitializeSprites();
<br/>
         createSpritePlayerUp();
<br/>
      }
<br/>
      
<br/>
      if(player.direction==3 &amp;&amp; gSprite.actualSprite1!=3) {
<br/>
         InitializeSprites();
<br/>
         createSpritePlayerDown();
<br/>
      }
<br/>
      
<br/>
      if(player.direction!=0)
<br/>
         MoveSprite(&amp;sprites[0], player.x, player.y);
<br/>
      
<br/>
      player.direction=0;
<br/>
      // &lt;- Move Main Charakter   
<br/>
      
<br/>
      
<br/>
      animation++;
<br/>
      if(animation&gt;9)   //Change Movement Animation Speed here
<br/>
         animation=0;</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void createSpritePlayerUp() {
<br/>
   u16 loop=0;
<br/>
<br/>
   player.activeFrame = 0;
<br/>
   player.loopDirectionA = 0;
<br/>
   player.loopDirectionB = 0;
<br/>
   player.OAMSpriteNum = 0;
<br/>
   player.activeFrame = 0;
<br/>
   player.spriteFrame[0] = 0;
<br/>
   player.spriteFrame[1] = 16;
<br/>
   player.spriteFrame[2] = 32;
<br/>
   
<br/>
   sprites[0].attribute0 = COLOR_256 | WIDE | player.y;
<br/>
   sprites[0].attribute1 = SIZE_32 | player.x;
<br/>
   sprites[0].attribute2 = 0;
<br/>
<br/>
   //Player Sprite -&gt;
<br/>
<br/>
    for(loop = 0; loop &lt; 1534; loop++)
<br/>
   {
<br/>
      OAMData[loop] = playerData1[loop];
<br/>
   }
<br/>
<br/>
   gSprite.actualSprite1=0;
<br/>
   gSprite.actualSprite2=1;
<br/>
   gSprite.actualSprite3=2;
<br/>
   //&lt;- Player Sprite
<br/>
}
<br/>
<br/>
void createSpritePlayerDown() {
<br/>
   u16 loop=0;
<br/>
<br/>
   player.activeFrame = 0;
<br/>
   player.loopDirectionA = 0;
<br/>
   player.loopDirectionB = 0;
<br/>
   player.OAMSpriteNum = 0;
<br/>
   player.activeFrame = 0;
<br/>
   player.spriteFrame[0] = 0;
<br/>
   player.spriteFrame[1] = 16;
<br/>
   player.spriteFrame[2] = 32;
<br/>
<br/>
   sprites[0].attribute0 = COLOR_256 | WIDE | player.y;
<br/>
   sprites[0].attribute1 = SIZE_32 | player.x;
<br/>
   sprites[0].attribute2 = 0;
<br/>
<br/>
    for(loop = 0; loop &lt; 1534; loop++)
<br/>
   {
<br/>
      OAMData[loop] = playerData2[loop];
<br/>
   }
<br/>
<br/>
   gSprite.actualSprite1=3;
<br/>
   gSprite.actualSprite2=4;
<br/>
   gSprite.actualSprite3=5;
<br/>
   //&lt;- Player Sprite
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void movementAnimation()
<br/>
{
<br/>
   u16 loop;
<br/>
<br/>
   if(player.activeFrame&gt;2)
<br/>
      player.activeFrame=0;
<br/>
<br/>
   if(animation==0) {
<br/>
      if(player.loopDirectionA==0)
<br/>
         player.activeFrame++;
<br/>
      if(player.loopDirectionA==1)
<br/>
         player.activeFrame--;
<br/>
      if(player.activeFrame == 0)
<br/>
         player.loopDirectionA=0;
<br/>
      if(player.activeFrame == 2)
<br/>
         player.loopDirectionA=1;
<br/>
   }
<br/>
<br/>
   sprites[player.OAMSpriteNum].attribute2 = player.spriteFrame[player.activeFrame];
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
This means, that everytime the walking Direction changes another Sprite will be load into Memory. "if(animation&gt;9)" means, that only every 9th Frame the Sprite Frame will change.
<br/>
<br/>
<br/>
Comments please ;). Remember please, that is it alywase my first Programm on the GBa. It is "fast coded code", I plan to optimize it as good, as I can.
<br/>
<br/>
Here is the .gba. It works quite good on an Emu. But the Header isn't fixed, if you plan to run it on Hardware. 
<br/>
<a class="postlink" href="http://www.halof.com/rpgV2.zip" target="_blank">www.halof.com/rpgV2.zip</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9790 - Chross - Mon Aug 18, 2003 7:43 am</h4>
    <div class="postbody"><span class="postbody">Now I realize that this topic is somewhat old now, but I just recently had this problem and my friend helped me figure it out.  It may not be your code that was the problem but bmp2sprite.  I had used that too and it seemed to repeat the sprite data in the header file.  When I used pcx2sprite (by dovoto) it worked out fine.
<br/>
<br/>
Chross out.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9795 - iuiz - Mon Aug 18, 2003 11:58 am</h4>
    <div class="postbody"><span class="postbody">lol,
<br/>
<br/>
I had similar Problems with pcx2sprite, thats why I am using bmp2sprite now.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
