<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Ham text is messing up my tiles - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > Ham text is messing up my tiles</h2>
<div id="posts">
<div class="post">
    <h4>#63722 - Liquid_Dark - Thu Dec 15, 2005 8:57 pm</h4>
    <div class="postbody"><span class="postbody">When I use Ham's DrawText functions, I'm getting a messed up tile set. 
<br/>
My code is pretty simple:
<br/>
<br/>
IN GAME INITIALIZATION:
<br/>
    // load bg tiles
<br/>
    ham_SetBgMode(0);
<br/>
    ham_LoadBGPal((void *)bg_Palette, 16);
<br/>
    ham_bg[0].ti = ham_InitTileSet((void *)bg_Tiles, SIZEOF_16BIT(bg_Tiles), 1, 1);
<br/>
	ham_InitText(0);
<br/>
<br/>
    //load map
<br/>
    ham_bg[0].mi = ham_InitMapEmptySet(3, 0);
<br/>
    map_fragment_info_ptr bgLevel = ham_InitMapFragment((void *)bg_Map, 30, 20, 0, 0, 30, 20, 0);
<br/>
    ham_InsertMapFragment(bgLevel, 0, 0, 0);
<br/>
<br/>
    // display level
<br/>
    ham_InitBg(0, 1, 0, 0);
<br/>
    ham_SetBgXY(0, 0, 0);
<br/>
<br/>
IN GAME LOOP:
<br/>
	ham_DrawText(1,1,"Score: %d",score);
<br/>
	ham_DrawText(1,16,"High Score: %d",highscore);
<br/>
<br/>
<br/>
What I get is not what I want:
<br/>
<a href="http://img225.imageshack.us/img225/9864/vbbug1ed.png">[Images not permitted - Click here to view it]</a>
<br/>
<br/>
Any idea how to fix this?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#64761 - Peter - Mon Dec 26, 2005 1:26 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Liquid_Dark wrote:</b></span></td> </tr> <tr> <td class="quote">Any idea how to fix this?</td> </tr></table><span class="postbody">
<br/>
<br/>
Use a background-layer for <a class="postlink" href="http://www.ngine.de/hamdoc/group__hamlib__text.html#a2" target="_blank">ham_InitText</a> which is not used by anything else. In your code you use bg 0, it is used for the text and an extra-map. Put ham_InitText before the palette loading function. I'm not 100% certain, but I think ham_InitText overwrites two entries of the palette in Vram.
<br/>
<br/>
Not sure if it is a bug or a feature, you only store 16 colors to Vram for your tileset, but you initialize an 8bit tileset (<a class="postlink" href="http://www.ngine.de/hamdoc/group__hamlib__tile.html#a3" target="_blank">ham_InitTileSet</a>). 
<br/>
<br/>
Hope it helps</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
