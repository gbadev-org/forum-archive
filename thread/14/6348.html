<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>OS X, GBASDK, and Linker errors... - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > OS X, GBASDK, and Linker errors...</h2>
<div id="posts">
<div class="post">
    <h4>#48333 - justinGBA - Tue Jul 19, 2005 8:41 am</h4>
    <div class="postbody"><span class="postbody">Well, first off, i am new to mac and new to Xcode.  I am wanting what GBASDK has to offer, but so far it seems like a dirty hack that could maybe be done better if i knew what i was doing...
<br/>
<br/>
So now the question?  Here is the error i currently get...
<br/>
<br/>
source/helloworld.c:10: warning: implicit declaration of function `rand'
<br/>
source/helloworld.c:10: warning: unused variable `myNumb'
<br/>
Linking object files
<br/>
/usr/local/gbasdk/arm-agb-elf/bin/ld: Dwarf Error: mangled line number section.
<br/>
./build/helloworld.o: In function `AgbMain':
<br/>
./build/helloworld.o(.text+0x28): undefined reference to `rand'
<br/>
<br/>
<br/>
here is my make file...
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
# -----------------------------------------------------------------------------
<br/>
# \file         makefile
<br/>
# \brief      The SGADE template make file
<br/>
# \date         August 23, 2002
<br/>
# 
<br/>
# \author      Jaap Suter, Mark T. Price
<br/>
# 
<br/>
# This file contains the make-instructions for a SGADE project. In
<br/>
# order to use this make file you need to change 
<br/>
#   GCC_DIR, 
<br/>
#   PROJECT_DIR,
<br/>
#   SOCRATES_LIB_DIR and
<br/>
#   SOCRATES_INC_DIR and
<br/>
# to the locations on your own computer.
<br/>
#
<br/>
# -----------------------------------------------------------------------------
<br/>
<br/>
# -----------------------------------------------------------------------------
<br/>
# Project name definition;
<br/>
# -----------------------------------------------------------------------------
<br/>
<br/>
PROJECT      = helloworld
<br/>
<br/>
# -----------------------------------------------------------------------------
<br/>
# Base directory of the project. Replace this with wherever 
<br/>
# you have put the sample application on your computer
<br/>
# -----------------------------------------------------------------------------
<br/>
<br/>
PROJECT_DIR   = .
<br/>
<br/>
# -----------------------------------------------------------------------------
<br/>
# GCC Version you're using. If you're using the latest DevKitAdv this 
<br/>
# should be correct already.
<br/>
# -----------------------------------------------------------------------------
<br/>
GCC_VERSION   = 3.0.4
<br/>
<br/>
# -----------------------------------------------------------------------------
<br/>
# Base directory for GCC Arm-Agb-Elf compiler. Replace with 
<br/>
# wherever you have put it. 
<br/>
# -----------------------------------------------------------------------------
<br/>
<br/>
GCC_DIR  = /usr/local/gbasdk/arm-agb-elf
<br/>
<br/>
# -----------------------------------------------------------------------------
<br/>
# Socrates library and header directories. Replace this with wherever 
<br/>
# you have put the Socrates on your computer
<br/>
# -----------------------------------------------------------------------------
<br/>
<br/>
SOCRATES_LIB_DIR   = /usr/local/gbasdk/lib
<br/>
SOCRATES_INC_DIR   = /usr/local/gbasdk/include/sgade
<br/>
<br/>
# -----------------------------------------------------------------------------
<br/>
# Socrates library itself;
<br/>
# -----------------------------------------------------------------------------
<br/>
SOCRATES_LIB      = $(SOCRATES_LIB_DIR)/libSocrates.a
<br/>
<br/>
# -----------------------------------------------------------------------------
<br/>
# Compiler directories for includes and libs.
<br/>
# Assuming you are using Devkit Advance there should be no need to change
<br/>
# these, since they are derived from the above CMP_DIR directory definition.
<br/>
# -----------------------------------------------------------------------------
<br/>
<br/>
STD_LIB_DIR0 = $(GCC_DIR)/lib/gcc-lib/arm-agb-elf/$(GCC_VERSION)/interwork
<br/>
STD_LIB_DIR1 = $(GCC_DIR)/arm-agb-elf/lib/interwork
<br/>
<br/>
STD_INC_DIR0 = $(GCC_DIR)/lib/gcc-lib/arm-agb-elf/$(GCC_VERSION)/include
<br/>
STD_INC_DIR1 = $(GCC_DIR)/arm-agb-elf/include
<br/>
<br/>
# -----------------------------------------------------------------------------
<br/>
# Project directories.
<br/>
# -----------------------------------------------------------------------------
<br/>
<br/>
INC_DIR      = $(PROJECT_DIR)/include
<br/>
SRC_DIR      = $(PROJECT_DIR)/source
<br/>
CRT0_S_DIR   = $(PROJECT_DIR)
<br/>
LINK_SCRIPT_DIR = $(PROJECT_DIR)
<br/>
OBJ_DIR      = $(PROJECT_DIR)/build
<br/>
ELF_DIR      = $(PROJECT_DIR)/build
<br/>
DAT_DIR      = $(PROJECT_DIR)/data
<br/>
<br/>
# -----------------------------------------------------------------------------
<br/>
# Define the flags for the compiler, the assembler and the linker;
<br/>
# -----------------------------------------------------------------------------
<br/>
C_FLAGS  = -I$(DAT_DIR) -I$(INC_DIR) -I $(SOCRATES_INC_DIR) -I$(STD_INC_DIR0) -I$(STD_INC_DIR1) -I $(SGADE_SRC_DIR) -mthumb -mthumb-interwork -c -g -Wall -fverbose-asm
<br/>
CPP_FLAGS  = -I$(DAT_DIR) -I$(INC_DIR) -I $(SOCRATES_INC_DIR) -I$(STD_INC_DIR0) -I$(STD_INC_DIR1) -I $(SGADE_SRC_DIR) -mthumb -mthumb-interwork -c -g -Wall -fverbose-asm
<br/>
S_FLAGS  = -I$(DAT_DIR) -I$(INC_DIR) -I $(SOCRATES_INC_DIR) -I$(STD_INC_DIR0) -I$(STD_INC_DIR1) -mthumb-interwork 
<br/>
<br/>
L_FLAGS = -lSocrates   -L $(SOCRATES_LIB_DIR) -L$(STD_LIB_DIR0) -L$(STD_LIB_DIR1) -T $(LINK_SCRIPT_DIR)/lnkscript -lgcc
<br/>
<br/>
# -----------------------------------------------------------------------------
<br/>
# Define the list of object files
<br/>
# -----------------------------------------------------------------------------
<br/>
<br/>
O_FILES_FROM_C      = $(PROJECT).o
<br/>
O_FILES_FROM_CPP   = 
<br/>
<br/>
O_FILES_FROM_C_FULL_PATH = $(addprefix $(OBJ_DIR)/, $(O_FILES_FROM_C))
<br/>
<br/>
O_FILES_FROM_CPP_FULL_PATH = $(addprefix $(OBJ_DIR)/, $(O_FILES_FROM_CPP))
<br/>
<br/>
CRT0_O         = $(OBJ_DIR)/crt0.o
<br/>
<br/>
#CRTBEGIN_O      = $(STD_LIB_DIR0)/crtbegin.o
<br/>
#CRTEND_O      = $(STD_LIB_DIR0)/crtend.o
<br/>
<br/>
O_FILES_FULL_PATH   = $(CRT0_O) $(CRTBEGIN_O) $(CRTEND_O) $(O_FILES_FROM_C_FULL_PATH)  $(O_FILES_FROM_CPP_FULL_PATH)
<br/>
                     
<br/>
# -----------------------------------------------------------------------------
<br/>
# Define the final dependecy;
<br/>
# -----------------------------------------------------------------------------
<br/>
all : $(PROJECT_DIR)/$(PROJECT).gba
<br/>
   @echo Done
<br/>
<br/>
# -----------------------------------------------------------------------------
<br/>
# Define the copy from .elf to .gba file
<br/>
# -----------------------------------------------------------------------------
<br/>
$(PROJECT_DIR)/$(PROJECT).gba : $(ELF_DIR)/$(PROJECT).elf
<br/>
   @echo Object copying 
<br/>
   @$(GCC_DIR)/bin/objcopy -v -O binary $&lt; $@
<br/>
      
<br/>
      
<br/>
# -----------------------------------------------------------------------------
<br/>
# Define the linker instruction;
<br/>
# -----------------------------------------------------------------------------
<br/>
$(ELF_DIR)/$(PROJECT).elf : $(O_FILES_FULL_PATH) $(SOCRATES_LIB)
<br/>
   @echo Linking object files
<br/>
   @$(GCC_DIR)/bin/ld  $(O_FILES_FULL_PATH) -o$@ $(L_FLAGS)    
<br/>
   
<br/>
# -----------------------------------------------------------------------------
<br/>
# Define the C compiles;
<br/>
# -----------------------------------------------------------------------------
<br/>
$(O_FILES_FROM_C_FULL_PATH) : $(OBJ_DIR)/%.o : $(SRC_DIR)/%.c
<br/>
   @echo Making $@
<br/>
   @$(GCC_DIR)/bin/gcc  -c $&lt; -o$@ $(C_FLAGS) 
<br/>
   
<br/>
# -----------------------------------------------------------------------------
<br/>
# Define the CPP compiles;
<br/>
# -----------------------------------------------------------------------------
<br/>
$(O_FILES_FROM_CPP_FULL_PATH) : $(OBJ_DIR)/%.o : $(SRC_DIR)/%.cpp
<br/>
   @echo Making $@
<br/>
   @$(GCC_DIR)/bin/gcc  -c $&lt; -o$@ $(CPP_FLAGS) 
<br/>
   
<br/>
$(O_FILES_FROM_CXX_FULL_PATH) : $(OBJ_DIR)/%.o : $(SRC_DIR)/%.cxx
<br/>
   @echo Making $@
<br/>
   @$(GCC_DIR)/bin/gcc  -c $&lt; -o$@ $(CPP_FLAGS) 
<br/>
   
<br/>
$(O_FILES_FROM_CC_FULL_PATH) : $(OBJ_DIR)/%.o : $(SRC_DIR)/%.cc
<br/>
   @echo Making $@
<br/>
   @$(GCC_DIR)/bin/gcc  -c $&lt; -o$@ $(CPP_FLAGS) 
<br/>
   
<br/>
# -----------------------------------------------------------------------------
<br/>
# Define the assembly of the crt0 file;
<br/>
# -----------------------------------------------------------------------------
<br/>
$(CRT0_O) : $(OBJ_DIR)/%.o : $(CRT0_S_DIR)/%.S
<br/>
   @echo Making $@
<br/>
   @$(GCC_DIR)/bin/gcc -c $&lt; -o$@ $(S_FLAGS) 
<br/>
      
<br/>
# -----------------------------------------------------------------------------
<br/>
# Clean definition;
<br/>
# -----------------------------------------------------------------------------
<br/>
.PHONY : clean
<br/>
clean :
<br/>
   @echo Cleaning object, .elf and .gba files.
<br/>
   @/bin/rm -f $(OBJ_DIR)/*.o
<br/>
   @/bin/rm -f $(ELF_DIR)/$(PROJECT).elf
<br/>
   @/bin/rm -f $(PROJECT_DIR)/$(PROJECT).gba
<br/>
   @echo Clean done...
<br/>
<br/>
<br/>
# -----------------------------------------------------------------------------
<br/>
# EOF;
<br/>
# -----------------------------------------------------------------------------
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
here is my header...
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#ifndef GBA_H
<br/>
#define GBA_H
<br/>
<br/>
//Video Mode Defines
<br/>
#define Mode3 0x3
<br/>
<br/>
//Backgrounds To Enable
<br/>
#define Bg2 0x400
<br/>
<br/>
//Video Memory Pointer
<br/>
#define VideoBufferPointer (unsigned short*)0x6000000
<br/>
<br/>
//Initialize Video Mode Macro
<br/>
//Example:   InitVideo( Mode3 | Bg2 );
<br/>
#define InitVideo(mode) *(unsigned long*)0x4000000 = (mode)
<br/>
<br/>
//RGB Macro
<br/>
//Example:   RGB(30,30,30);
<br/>
#define RGB(r,g,b) ((r)+(g&lt;&lt;5)+(b&lt;&lt;10))
<br/>
<br/>
//Pixel plotting Macro
<br/>
//Example:   DrawPixel3(20, 20, videoBuffer) = RGB(30, 30, 30);
<br/>
#define DrawPixel3(x,y,buffer) (buffer)[(y) * 240 + (x)]
<br/>
<br/>
#endif
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
here is my c file...
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include &lt;stdlib.h&gt;
<br/>
#include "gba.h"
<br/>
<br/>
int AgbMain(void)
<br/>
{
<br/>
   
<br/>
   InitVideo( Mode3 | Bg2 );
<br/>
   unsigned short* videoBuffer = VideoBufferPointer;
<br/>
   
<br/>
   int myNumb = rand();
<br/>
   int x = 120;  int y = 80;
<br/>
   DrawPixel3(x, y, videoBuffer) = RGB( 30, 0, 0 );
<br/>
   
<br/>
   while(1)  {
<br/>
      
<br/>
   }
<br/>
   
<br/>
   return 0;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
And well the fun doesnt stop there.  That is the first problem, second is that if i try to do the same thing in a cpp file, it just fails to compile.
<br/>
<br/>
SO thirdly and more advanced, does anyone have some help on just using devkitArm, and setting up Xcode to use with that? As well as makeing a project template?  If we can make a comunity effort here, we could release a better xcode package, that isnt linked to SGADE.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#48381 - poslundc - Tue Jul 19, 2005 6:21 pm</h4>
    <div class="postbody"><span class="postbody">rand() is not a native C operator but is a member of the ANSI standard library, which I suspect is not supported by Devkit Advance. I don't know if Devkit ARM supports it or not, but the standard libraries are ill-suited for GBA development (with some possible exceptions like the memory functions) and generally shouldn't be used anyway.
<br/>
<br/>
You can find many easy and effective random-number algorithms by searching the forum.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#48394 - justinGBA - Tue Jul 19, 2005 7:52 pm</h4>
    <div class="postbody"><span class="postbody">OK, well this same project works just fine in windows under Visual Ham, and i really would like to use sdtlib with my projects, so what do i need to do to use stdlib, or c++ on the gba?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#48395 - tepples - Tue Jul 19, 2005 7:55 pm</h4>
    <div class="postbody"><span class="postbody">DevKit Advance and devkitARM come with Newlib, a permissively licensed implementation of the ANSI C standard library. <ul><li>To get rid of "implicit declaration", use the right header file:
<br/>
<span style="font-weight: bold">#include &lt;stdlib.h&gt;</span> </li><li>To get rid of "undefined reference", you'll need to link in the C standard library, framed on both sides with a -lgcc:
<br/>
L_FLAGS = -lSocrates   -L $(SOCRATES_LIB_DIR) -L$(STD_LIB_DIR0) -L$(STD_LIB_DIR1) -T $(LINK_SCRIPT_DIR)/lnkscript -lgcc <span style="font-weight: bold">-lc -lgcc</span> </li></ul>
<br/>
If you still can't get rand() to work, here's a fast but decent linear congruential generator to replace it. It uses the "BCPL" parameters described <a class="postlink" href="http://random.mat.sbg.ac.at/~charly/server/node3.html" target="_blank">here</a>.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">static unsigned int ayn_seed = 314159265;
<br/>
void ayn_set_seed(unsigned int s)
<br/>
{
<br/>
  ayn_seed = s;
<br/>
}
<br/>
int ayn(void)
<br/>
{
<br/>
  ayn_seed = ayn_seed * 2147001325 + 715136305;
<br/>
  return ayn_seed &gt;&gt; 17;
<br/>
}</td> </tr></table><span class="postbody">
<br/>
Then use ayn() instead of rand() (<a class="postlink" href="http://en.wikipedia.org/wiki/Ayn_Rand" target="_blank">get it?</a>) and ayn_set_seed() instead of srand().<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#48539 - justinGBA - Wed Jul 20, 2005 5:56 pm</h4>
    <div class="postbody"><span class="postbody">WOOHOO! Thank you so much, i still get the implicit warning but it compiles and runs.  is &lt;stdlib.h&gt; not the right include?  Now i just have to stop using the GBASDK for OS X and make my own.  off to learning makefiles.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#51000 - pizzach - Mon Aug 15, 2005 6:58 am</h4>
    <div class="postbody"><span class="postbody">Not exactly what you were asking for, but I used a shell script when I build which should be easily convertible to a makefile.
<br/>
<br/>
It worked a lot better than the included GBASDK script because mode 3 graphics actually get a usable framerate on some of the demos out there like tankgba.  Basically it's more compairable to the .bat make files the windows users tend to use.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
/usr/local/gbasdk/arm-agb-elf/bin/gcc -c -O3 -mthumb -mthumb-interwork test.c
<br/>
/usr/local/gbasdk/arm-agb-elf/bin/gcc -mthumb -mthumb-interwork -o test.elf test.o
<br/>
/usr/local/gbasdk/arm-agb-elf/bin/objcopy -O binary test.elf test.gba
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Hope this helps get you started if you didn't figure it out already.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#51029 - wintermute - Mon Aug 15, 2005 6:44 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>pizzach wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<br/>
It worked a lot better than the included GBASDK script because mode 3 graphics actually get a usable framerate on some of the demos out there like tankgba.  Basically it's more compairable to the .bat make files the windows users tend to use.
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
It got a better framerate because you increased the optimisation level, not because you used a shell script.
<br/>
<br/>
Makefiles *are* scripts and have special features for project building which standard shell scripts lack. Neither shell scripts or bat files should be used for building anything of any complexity (in practice anything more than 1 c/cpp file)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#51050 - pizzach - Mon Aug 15, 2005 10:04 pm</h4>
    <div class="postbody"><span class="postbody">(-_-); Doesn't replace a makefile, but it IS a good place to start to figure out what is going on when you first start compiling stuffs in the terminal.  makefiles can be a bit more difficult to parse in your brain the first time you look at it until you know where it is going.
<br/>
<br/>
The .bat that I had studied:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
path=C:\devkitadv\bin
<br/>
<br/>
rem If you compile using this line and not the next three
<br/>
rem it will run like 5 frames a second
<br/>
rem gcc  -o tank.elf main.c gfx.c
<br/>
<br/>
gcc -c -O3 -mthumb -mthumb-interwork gfx.c
<br/>
gcc -c -O3 -mthumb -mthumb-interwork main.c
<br/>
gcc -mthumb -mthumb-interwork -o tank.elf main.o gfx.o
<br/>
<br/>
objcopy -O binary tank.elf tank.gba
<br/>
<br/>
pause
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I hadn't tinkered or looked at the script in a long time.  the -O3 seem to work for me, I just tried it.  I would think that the author of tankgba must have had a reason though since he made the bat file....no one will ever know.  The information is moot anyway, the thread starter appears to have changed compilers.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#51061 - wintermute - Tue Aug 16, 2005 12:22 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>pizzach wrote:</b></span></td> </tr> <tr> <td class="quote">(-_-); Doesn't replace a makefile, but it IS a good place to start to figure out what is going on when you first start compiling stuffs in the terminal.  makefiles can be a bit more difficult to parse in your brain the first time you look at it until you know where it is going.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
It's not really. Using bat files is an extremely stupid way to compile a project, they're no different from sitting typing the commands.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
I hadn't tinkered or looked at the script in a long time.  the -O3 seem to work for me, I just tried it.  I would think that the author of tankgba must have had a reason though since he made the bat file....no one will ever know
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
He probably used a bat file because that's what the moronic tutorial he followed used.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#51063 - tepples - Tue Aug 16, 2005 12:35 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>wintermute wrote:</b></span></td> </tr> <tr> <td class="quote">Using bat files is an extremely stupid way to compile a project, they're no different from sitting typing the commands.</td> </tr></table><span class="postbody">
<br/>
Actually it is different. Unlike a .bat file or a shell script, a makefile can't be double-clicked in Windows Explorer, and a lot of the more generic programmers' text editors for Windows use similar code to launch programs that Explorer uses. Therefore, some people need a .bat file that does something like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">@echo off
<br/>
set PATH=C:\devkitARM\bin;C:\msys\1.0\bin;%PATH%
<br/>
make %1 %2 %3
<br/>
</td> </tr></table><span class="postbody">
<br/>
But if the .bat file is calling GCC directly in a larger project, I see your point.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
