<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Whats a good way to gain a bit of speed in Mode 3 - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > Whats a good way to gain a bit of speed in Mode 3</h2>
<div id="posts">
<div class="post">
    <h4>#31326 - ghostils - Fri Dec 10, 2004 2:25 am</h4>
    <div class="postbody"><span class="postbody">I don't really need sprites for my app (a car mp3 computer control console), but I would like to get my pixels on the screen a tad faster. Could copying images over DMA while in VSYNC wait mode be an effective way to do it?
<br/>
<br/>
<br/>
Thanks, 
<br/>
<br/>
-ghost[iLs]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#31330 - Miked0801 - Fri Dec 10, 2004 3:27 am</h4>
    <div class="postbody"><span class="postbody">Switch to Mode 4 and blast twice as many pixels at a time :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#31359 - Lupin - Fri Dec 10, 2004 12:25 pm</h4>
    <div class="postbody"><span class="postbody">use 32 bit writes, in mode 4 you can draw 4 pixels at a time by using 32 bit writes
<br/>
<br/>
What exactly are you doing?<br/>_________________<br/><a class="postlink" href="http://pokeme.shizzle.it/" target="_blank">Team Pokeme</a>
<br/>
<a class="postlink" href="http://lupin.shizzle.it/" target="_blank">My blog and PM ASM tutorials</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#31369 - ScottLininger - Fri Dec 10, 2004 4:06 pm</h4>
    <div class="postbody"><span class="postbody">Are you compiling with the "optimize" flags?
<br/>
<br/>
If you call GCC with the -O3 parameter, it will attempt to optimize its output, and it can make a huge difference in performance speed. (At least, I think that's the tag... a quick forum search would find some other examples.)
<br/>
<br/>
Anyway, I had a Mode4 program that was performing poorly. I added that one tag to my compile batch file and Voila! Instant speed inmprovement.
<br/>
<br/>
It's worth a try.
<br/>
<br/>
Also, there's probably just one or two drawing functions that are slowing the whole thing down. I'd post your code from those and let the peanut gallery suggest optimizations. That's been really helpful to me in the past.
<br/>
<br/>
Cheers,
<br/>
<br/>
Scott</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#31434 - ghostils - Fri Dec 10, 2004 11:41 pm</h4>
    <div class="postbody"><span class="postbody">What I need to do is display my main background full screen image faster than it is currently... I'm using the standard nested for/loop method to display it now.... (really slow in mode 3) I've heard you can use DMA to write a full screen to a 2nd buffer in EWRAM... I would like to know how to do this... 
<br/>
<br/>
I don't need to constantly update the screen with this background it just needs to load quicker when the rom boots thats all. The rest of my routines are satisfactory for that I need to do in mode 3. (The area of the screen that will be updated is a solid color so my janky code can just replace the 0 bits of my text and small selector bitmaps with the appropriate bgcolor) to create psuedo transparancy.
<br/>
<br/>
<br/>
But if you really need to see my bg draw routine here we go:
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void draw_bg(u8 *gfx, u16* palette);
<br/>
<br/>
//-Draw a full background with full color:
<br/>
void draw_bg(u8 *gfx, u16* palette)
<br/>
{
<br/>
   int x = 0, y = 0, i = 0;
<br/>
<br/>
<br/>
   for(y = 0; y &lt; 160; y++)
<br/>
   {
<br/>
      for(x = 0; x &lt; 240; x++)
<br/>
      {
<br/>
         theVideoBuffer[x + y * 240] = palette[gfx[i]];
<br/>
         i++;
<br/>
      }
<br/>
   }
<br/>
}
<br/>
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
Thanks, 
<br/>
<br/>
-ghost[iLs]
<br/>
<br/>
[/code]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#31448 - Lupin - Sat Dec 11, 2004 12:33 am</h4>
    <div class="postbody"><span class="postbody">why do you use a palette for a full color background? Then you can also use paletted bitmap mode... but if you need full color mode i would store the image as a full color image and copy it with DMA - if you want to do it really fast you can first copy the image to EWRAM and then copy it over to VRAM (though this is only needed if you need to do it more than once)
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define DMACopyCH3(source,dest,wc,mode)      REG_DMA3SAD = (u32)source; \
<br/>
                                   REG_DMA3DAD = (u32)dest; \
<br/>
                                   REG_DMA3CNT = wc | mode;
<br/>
<br/>
/////COPY IMAGE TO SCREEN
<br/>
DMACopyCH3(imgdata,VideoBuffer32,19200,DMA_32NOW);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I don't know how to declare an array in EWRAM using DKA but I am sure it is possible using DKA, so when you have an array in EWRAM just copy the image there first and then copy it to video Buffer when you need it.<br/>_________________<br/><a class="postlink" href="http://pokeme.shizzle.it/" target="_blank">Team Pokeme</a>
<br/>
<a class="postlink" href="http://lupin.shizzle.it/" target="_blank">My blog and PM ASM tutorials</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#31449 - sajiimori - Sat Dec 11, 2004 12:33 am</h4>
    <div class="postbody"><span class="postbody">There are many things to say about that code, but the bottom line is that your data doesn't match the video mode you're using, and the runtime translation from 8-bit palettized graphics to truecolor prevents you from doing any significant optimizations.
<br/>
<br/>
Well, the compiler may not notice that x+y*240 is always equal to i, so removing x and y might make a dent.  It's insignificant compared to using data that matches the video mode, though.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#31457 - ghostils - Sat Dec 11, 2004 12:51 am</h4>
    <div class="postbody"><span class="postbody">I used the -O3 compiler opts as suggested above and that sped it up almost 2x... But I'm stilll looking for more hehe. As far as palette I was just using the data that gfx2gba1.03 created for me. As far as I know gfx2gba can only do 8bit, however the value it created in the palette array is a 16bit value so the data type should match the mode I"m in, Mode 3 is 16bit color correct? Wordsize shouldn't be an issue there.  The only issue that still remains is how to create an EWRAM pointer that I can use to copy my data to via DMA. I found a good doc on the DMA register values. Now to solve the pesky EWRAM pointer.
<br/>
<br/>
<br/>
Thanks, 
<br/>
<br/>
-ghost[iLs]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#31460 - tepples - Sat Dec 11, 2004 12:58 am</h4>
    <div class="postbody"><span class="postbody">Using devkitARM? Make an array in section ".sbss".<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#31462 - Lupin - Sat Dec 11, 2004 1:12 am</h4>
    <div class="postbody"><span class="postbody">If you don't want to change to 16 bit (it would look better in 16 bit though...) you can just use your old function to copy into EWRAM then copy from EWRAM to VRAM using DMA, this would actually save you ROM size - at the cost of image quality of course...<br/>_________________<br/><a class="postlink" href="http://pokeme.shizzle.it/" target="_blank">Team Pokeme</a>
<br/>
<a class="postlink" href="http://lupin.shizzle.it/" target="_blank">My blog and PM ASM tutorials</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#31470 - ghostils - Sat Dec 11, 2004 2:18 am</h4>
    <div class="postbody"><span class="postbody">The DMA transfer is exactly what  I was look'n for. almost no pause before the image is displayed. Also I got the EWRAM buffer working properly as well:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
u16* Ewram_Ptr = (u16*)0x02000000;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Though I can see this creating issues when I try and boot this on a GBA if I overwrite the program code after multibooting. So its really that base address + my program size + 10K bytes for my app to grow... thats prolly a little overkill but it works for now., I tested it with VBA with pointer starting after the 100KB mark in EWRAM and it loads and dma's the data to video memory perfectly.
<br/>
<br/>
<br/>
Thanks, for all the help and pointers I've recieved so far, 
<br/>
<br/>
-ghost[iLs]</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
