<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Manage timer - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > Manage timer</h2>
<div id="posts">
<div class="post">
    <h4>#21079 - coredump - Sun May 23, 2004 4:19 pm</h4>
    <div class="postbody"><span class="postbody">Hello, 
<br/>
<br/>
I'm new on GBA development and I'd like to manage a timer for
<br/>
buffered all gamepad during a moment in order to check eventual
<br/>
"combos". So, my idea is to put the timer 2 on cascade and check
<br/>
a "combos" during a cycle of 10 * 0.25us. Nothing work :(
<br/>
<br/>
my code:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define TIMER1_CR               *(volatile u16 *)0x4000106 
<br/>
#define TIMER2_CR               *(volatile u16 *)0x400010A 
<br/>
 
<br/>
 
<br/>
#define TIMER1_DATA            *(volatile u16 *)0x4000104 
<br/>
#define TIMER2_DATA            *(volatile u16 *)0x4000108 
<br/>
 
<br/>
#define ENABLE_TIMER           (1 &lt;&lt; 7) 
<br/>
#define IRQ_TIMER              (1 &lt;&lt; 6) 
<br/>
#define CASCADE_TIMER          (1 &lt;&lt; 2) 
<br/>
 
<br/>
#define RATIO_64                 0x1 
<br/>
 
<br/>
int    get_key(void) 
<br/>
{ 
<br/>
   int key; 
<br/>
   u16  cycle; 
<br/>
 
<br/>
   TIMER1_CR = RATIO_64 | ENABLE_TIMER | IRQ_TIMER; 
<br/>
   TIMER2_CR = CASCADE_TIMER | ENABLE_TIMER; 
<br/>
   key = 0; 
<br/>
   while ((cycle = TIMER2_DATA) &lt; 10) 
<br/>
   { 
<br/>
        /* buffered key.*/ 
<br/>
   } 
<br/>
   return (key); 
<br/>
} 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
thx.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#21080 - poslundc - Sun May 23, 2004 5:30 pm</h4>
    <div class="postbody"><span class="postbody"><a class="postlink" href="http://www.google.com/search?q=finite+state+machine" target="_blank">Finite State Machines</a>
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#21083 - dagamer34 - Sun May 23, 2004 6:36 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote"><a class="postlink" href="http://www.google.com/search?q=finite+state+machine" target="_blank">Finite State Machines</a>
<br/>
<br/>
Dan.</td> </tr></table><span class="postbody">
<br/>
<br/>
I think Dan is tired of saying Finite State Machines to answer these kinds of problems. Maybe it's time to put this in the FAQ, don't you think tepples?
<br/>
<br/>
And tepples, you need to update the linker section of the FAQ as Success-HK and MW Electronics no longer sell flash carts.<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#21091 - mr_schmoe - Sun May 23, 2004 8:27 pm</h4>
    <div class="postbody"><span class="postbody">I don't think that answered his question. I'm assuming he's trying to do something like a Mortal Kombat type game (correct me if I'm wrong) where a certain combonation of buttons produces a special attack. Now, if that's the case, what the hell does a finite state machine have to do with that. It's my understanding that a finite state machine in respect to a game, only means that each character has a finite number of states or modes or actions being preformed or whatever and the key input changes that state based on whatever the programmer decides it needs to do. So, again, what does FSM have to do with checking key combos over a period of time. 
<br/>
<br/>
My suggestion is you use a keyboard interrupt. That way, you can store the key data directy into a buffer and check it in you main loop for the correct combonations and reset the buffer accordingly.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#21097 - tepples - Sun May 23, 2004 9:30 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>dagamer34 wrote:</b></span></td> </tr> <tr> <td class="quote">I think Dan is tired of saying Finite State Machines to answer these kinds of problems. Maybe it's time to put this in the FAQ, don't you think tepples?
<br/>
<br/>
And tepples, you need to update the linker section of the FAQ as Success-HK and MW Electronics no longer sell flash carts.</td> </tr></table><span class="postbody">
<br/>
Phicks'd on both accounts.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>mr_schmoe wrote:</b></span></td> </tr> <tr> <td class="quote">I'm assuming he's trying to do something like a Mortal Kombat type game (correct me if I'm wrong) where a certain combonation of buttons produces a special attack. Now, if that's the case, what the hell does a finite state machine have to do with that.</td> </tr></table><span class="postbody">
<br/>
For each one-on-one karate game, there exists an alphabet of button presses such as "up", "forward", and "kick". For each different playable character, there exists a regular language whose strings are the set of moves that result in magic attacks. For example, for some characters in some <span style="font-style: italic">Street Fighter II</span> knockoffs such as Data East's <span style="font-style: italic">Fighter's History</span> and Interplay's <span style="font-style: italic">Clay Fighter</span>, the string "forward down forward punch" produces an upward attack, "down forward punch" produces a fireball, and "down back kick" produces a whirling attack. A finite state machine (also called a finite automaton) "decides" a regular language, that is, it produces a 1 if a string is a move and a 0 if not.
<br/>
<br/>
Many games read symbols from the joypad at 60 Hz, but some fighter players are faster than that. Now it seems coredump is trying to sample the joypad faster than 60 Hz in order to read symbols as fast as players can generate them.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#21107 - poslundc - Sun May 23, 2004 11:04 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>dagamer34 wrote:</b></span></td> </tr> <tr> <td class="quote">I think Dan is tired of saying Finite State Machines to answer these kinds of problems.</td> </tr></table><span class="postbody">
<br/>
<br/>
Yeah, I just had a look at my post and it was pretty glib. It was late and I was tired; sorry about that.
<br/>
<br/>
mr_schmoe: in addition to what tepples has already said I'll summarize by saying FSMs provide a structure with which you can handle a series of decisions from one input to the next. This is precisely the kind of thing people are looking to do in GBA programming, whether it's detecting something as simple as the moment a button is released after being pressed, or detecting a complicated series of inputs in a given timeframe. Let me know if you desire a more specific example.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#21124 - coredump - Mon May 24, 2004 11:24 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
 I'm assuming he's trying to do something like a Mortal Kombat type game (correct me if I'm wrong) where a certain combonation of buttons produces a special attack. 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
You'r right.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
My suggestion is you use a keyboard interrupt. That way, you can store the key data directy into a buffer and check it in you main loop for the correct combonations and reset the buffer accordingly.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
What do you mean by "interrupt keyboard" ? It seemed to be a good way
<br/>
but i "interrupot keyboard" is weird for me.
<br/>
<br/>
Regards.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#21133 - coredump - Mon May 24, 2004 4:56 pm</h4>
    <div class="postbody"><span class="postbody">Ok, after the loop I reset the TIMER2_DATA and it's work but it seems
<br/>
that the "loop time" is too high I changed:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
while ((cycle = TIMER2_DATA) &lt; 10) 
<br/>
</td> </tr></table><span class="postbody">
<br/>
by :
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
while ((cycle = TIMER2_DATA) &lt; 1) 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
with the same frequence "RATIO_64" then I'd like to know why the loop
<br/>
is too low because:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Many games read symbols from the joypad at 60 Hz, but some fighter players are faster than that. Now it seems coredump is trying to sample the joypad faster than 60 Hz in order to read symbols as fast as players can generate them.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Regards.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
