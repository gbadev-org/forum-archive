<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Sprite Help - libnds - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Beginners > Sprite Help - libnds</h2>
<div id="posts">
<div class="post">
    <h4>#143355 - koleslaw54 - Sat Oct 20, 2007 4:26 am</h4>
    <div class="postbody"><span class="postbody">Alright, I just started using libnds last week and I'm making a quick breakout clone to learn about lots of different things.  The only problem is that I can't find any good tutorials on using sprites, and I have a bug that doesn't make sense to me.  I can't get sprites to show up on the screen, here's the relevant sections of my code...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">// Global copy of sprite attribute memory
<br/>
SpriteEntry sprites[128];
<br/>
<br/>
// Copy our sprite to object attribute memory
<br/>
void updateOAM(void)
<br/>
{
<br/>
   DC_FlushRange(sprites, 128 * sizeof(SpriteEntry));
<br/>
   dmaCopy(sprites, OAM, 128 * sizeof(SpriteEntry));
<br/>
}
<br/>
<br/>
// Turn off all 128 sprites the DS uses
<br/>
void initSprites(void)
<br/>
{
<br/>
   int i;
<br/>
   for(i = 0; i &lt; 128; i++)
<br/>
   {
<br/>
      sprites[i].attribute[0] = ATTR0_DISABLED;
<br/>
      sprites[i].attribute[1] = 0;
<br/>
      sprites[i].attribute[2] = 0;
<br/>
      sprites[i].attribute[3] = 0;
<br/>
        }
<br/>
   
<br/>
   // A 16 Color Sprite - Uses Indexed color pallete
<br/>
   SPRITE_PALETTE[17] = RGB15(31,31,25);
<br/>
   SPRITE_PALETTE[18] = RGB15(31,30,12);
<br/>
   SPRITE_PALETTE[19] = RGB15(31,29,3);
<br/>
   SPRITE_PALETTE[20] = RGB15(31,25,0);
<br/>
   
<br/>
   sprites[0].attribute[0] = ATTR0_WIDE | 150;
<br/>
   sprites[0].attribute[1] = ATTR1_SIZE_32 | 112;
<br/>
   sprites[0].attribute[2] = ATTR2_PALETTE(1);
<br/>
   
<br/>
   // Draw the Rectangular Sprite 32x8 - Writing 4 pixels at a time
<br/>
   u16 paddle[64] = {
<br/>
   0x0123, 0x4444, 0x4444, 0x4444, 0x4444, 0x4444, 0x4443, 0x4210,
<br/>
   0x1344, 0x4433, 0x3333, 0x3333, 0x3333, 0x3333, 0x3444, 0x4431,
<br/>
   0x2444, 0x4333, 0x2222, 0x2222, 0x2222, 0x2222, 0x3334, 0x4442,
<br/>
   0x4444, 0x4433, 0x3333, 0x3333, 0x3333, 0x3333, 0x3444, 0x4444,
<br/>
   0x4444, 0x4444, 0x4444, 0x4444, 0x4444, 0x4444, 0x4444, 0x4444,
<br/>
   0x2444, 0x4444, 0x4444, 0x4444, 0x4444, 0x4444, 0x4444, 0x4442,
<br/>
   0x1344, 0x4444, 0x4444, 0x4444, 0x4444, 0x4444, 0x4444, 0x4431,
<br/>
   0x0123, 0x4444, 0x4444, 0x4444, 0x4444, 0x4444, 0x4444, 0x3210
<br/>
   };
<br/>
   
<br/>
   for(i=0;i&lt;64;i++)
<br/>
      SPRITE_GFX[i]=paddle[i];
<br/>
<br/>
   updateOAM();
<br/>
}
<br/>
<br/>
void initVideo() {
<br/>
    vramSetMainBanks(VRAM_A_MAIN_BG, VRAM_B_MAIN_SPRITE,
<br/>
            VRAM_C_SUB_BG);
<br/>
<br/>
    videoSetMode(MODE_0_2D | DISPLAY_SPR_ACTIVE | DISPLAY_BG0_ACTIVE | DISPLAY_SPR_1D | DISPLAY_SPR_1D_BMP | DISPLAY_BG1_ACTIVE);
<br/>
<br/>
     // I'm using BG1 for background and BG0 for the console
<br/>
        BG1_CR = BG_32x32 | BG_COLOR_16 | BG_MAP_BASE(0) | BG_TILE_BASE(1);
<br/>
        BG0_CR = BG_MAP_BASE(31) | BG_TILE_BASE(4);
<br/>
<br/>
}
<br/>
<br/>
int main(void) {
<br/>
   powerSET(POWER_ALL_2D);
<br/>
   lcdMainOnBottom();
<br/>
   irqInit();
<br/>
   irqSet(IRQ_VBLANK, 0);
<br/>
<br/>
   initVideo();
<br/>
        initSprites();
<br/>
   
<br/>
   while(1) {
<br/>
                // Handle Input //
<br/>
<br/>
                swiWaitForVBlank();
<br/>
      updateOAM();
<br/>
   }</td> </tr></table><span class="postbody">
<br/>
<br/>
Can anyone help me understand what's wrong?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143404 - SaruCoder - Sat Oct 20, 2007 8:35 pm</h4>
    <div class="postbody"><span class="postbody">If your sprite is 32x8, then you should be using ATTR1_SIZE_16 (with ATTR0_WIDE).  ATTR1_SIZE_32 (wide) will get you a 32x16 sprite.
<br/>
<br/>
I think you can use DISPLAY_SPR_1D instead of DISPLAY_SPR_1D_BMP
<br/>
<br/>
Also, try VRAM_B_MAIN_SPRITE_0x6400000 instead of VRAM_B_MAIN_SPRITE.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#143405 - SaruCoder - Sat Oct 20, 2007 8:47 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code"> sprites[0].attribute[0] = ATTR0_WIDE | 150;
<br/>
sprites[0].attribute[1] = ATTR1_SIZE_32 | 112; </td> </tr></table><span class="postbody">
<br/>
<br/>
Use OBJ_X and OBJ_Y to set your sprite position.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code"> sprites[0].attribute[0] = ATTR0_WIDE | OBJ_Y(150);
<br/>
sprites[0].attribute[1] = ATTR1_SIZE_32 | OBJ_X(112); </td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
