<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Sprite rotation - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > Sprite rotation</h2>
<div id="posts">
<div class="post">
    <h4>#152391 - Cave Johnson - Fri Mar 14, 2008 9:29 pm</h4>
    <div class="postbody"><span class="postbody">Ive been working on a code for my simple geometry wars clone to rotate a sprite so it is oriented towards the point on the touch screen where is touched. I have very little clue on how to do this, so any help would be great. My code for the touch position is touch-&gt;py and touch-&gt;px, and the sprites position is gunPos-&gt;y and gunPos-&gt;x. Thanks for any help.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152402 - Liazon - Sat Mar 15, 2008 1:41 am</h4>
    <div class="postbody"><span class="postbody">I thought there was hardware to handle rotations on the DS</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152405 - tepples - Sat Mar 15, 2008 1:47 am</h4>
    <div class="postbody"><span class="postbody">The function you're looking for is arctangent. See if <a class="postlink" href="http://en.wikipedia.org/wiki/Trigonometric_functions" target="_blank">Wikipedia's article about trig functions</a> gives you any ideas.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152417 - Cave Johnson - Sat Mar 15, 2008 4:17 pm</h4>
    <div class="postbody"><span class="postbody">After reading that article, it seems like im going to need to use arctangeant. Could i use something like this to find the angle?
<br/>
<br/>
atan((gunPos-&gt;y - touch-&gt;py) / (gunPos-&gt;x - touch-&gt;px))
<br/>
<br/>
Thanks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152428 - Cydrak - Sat Mar 15, 2008 8:08 pm</h4>
    <div class="postbody"><span class="postbody">Almost! But think about your signs. If you have +dy/+dx and -dy/-dx for example (same fraction, diff signs, diff angle), what happens then? And what if dx == 0?
<br/>
<br/>
Anyway, if you try it you'll quickly see the problem. It's not hard to code around--in fact that's already been done. Check out atan2(), which takes dy/dx as separate arguments.</span><span class="gensmall"><br/><br/>Last edited by Cydrak on Sun Mar 16, 2008 6:45 am; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#152444 - Cave Johnson - Sun Mar 16, 2008 3:51 am</h4>
    <div class="postbody"><span class="postbody">I see what your saying Cydrak, but that problem is way ahead of me. After playing around with the code for hours, i cant figure out how to make the angle that the formula is creating become the sprites angle. Regardless of whether or not the formula would even work, what would i do to relate the new angle to the sprites angle? Thanks for all of your help.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152453 - Cydrak - Sun Mar 16, 2008 6:39 am</h4>
    <div class="postbody"><span class="postbody">Okay, what have you got so far? Can you rotate sprites at all, and does the matrix stuff make any sense? There's a few different steps involved, so it would help to know where to start.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cave Johnson wrote:</b></span></td> </tr> <tr> <td class="quote">... how to make the angle that the formula is creating become the sprites angle ...</td> </tr></table><span class="postbody">
<br/>
I'm not sure if you're asking about the math, or how to set up the sprite? The formula is relative to the coordinates used. If the X's and Y's are in screen coordinates, you can use the angle directly. If not, you'd have to convert first (like if you had the view scrolling and rotating, too).
<br/>
<br/>
On the hardware side, you need to set ATTR0_ROTSCALE, and then ATTR1_ROTDATA(n) to choose one of the 32 affine settings. Which then has to be filled with a 2x2 matrix.
<br/>
<br/>
TONC <a class="postlink" href="http://www.coranac.com/tonc/text/affobj.htm" target="_blank">explains all this</a> in quite some detail (although this is for tonclib on the GBA, not libnds, the sprite settings are the same). There's also a chapter on basic <a class="postlink" href="http://www.coranac.com/tonc/text/matrix.htm" target="_blank">vector and matrix math</a>, if you're looking for that.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152467 - Cearn - Sun Mar 16, 2008 2:00 pm</h4>
    <div class="postbody"><span class="postbody">atan2() from libm.a is a floating point routine, which doesn't work well for GBA/NDS purposes. It's result is also a floating point number between 0 and 2π, so you'd have to scale it before you can use it for (co)sine lookup.
<br/>
The <a class="postlink" href="http://nocash.emubase.de/gbatek.htm#biosarithmeticfunctions" target="_blank">GBA BIOS</a> has an integer-based ArcTan2 routine which could help out.
<br/>
<br/>
If you don't really need the angle itself, you can also simply normalize the distance vector. This will give you the cosine and sine that you need for the matrix directly.
<br/>
<br/>
The main code:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
int x0, y0, x1, y1;      // Two coordinate pairs.
<br/>
<br/>
int dx= x1-x0, dy= y1-y0;         // Get distance
<br/>
u32 norm= Sqrt(dx*dx + dy*dy);      // Calculate length
<br/>
dx= Div(dx&lt;&lt;8, norm);               // cosine. &lt;&lt;8 for .8 fixed point.
<br/>
dy= Div(dx&lt;&lt;8, norm);               // sine
<br/>
<br/>
matrix.pa=  dx;      matrix.pb=  dy;
<br/>
matrix.pc= -dy;      matrix.pd=  dx;
<br/>
</td> </tr></table><span class="postbody">
<br/>
Sqrt and Div are GBA BIOS functions. The DS doesn't have those, but it does have hardware sqrt and div that you can use. Just be careful that you use the correct number of fixed points in the numbers.
<br/>
<br/>
<a class="postlink" href="http://www.coranac.com/files/misc/obj_tracker.zip" target="_blank">proof of concept</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152478 - Cave Johnson - Sun Mar 16, 2008 3:37 pm</h4>
    <div class="postbody"><span class="postbody">After reading through your tutorial cearn, ive setup the affine transformation matrix, and the sprite is affine and i can rotate it with button presses. From here, what would be my next step to make the sprite rotate and orient itself towards touch position? Thanks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152479 - eKid - Sun Mar 16, 2008 4:06 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Sqrt and Div are GBA BIOS functions. The DS doesn't have those, but it does have hardware sqrt and div that you can use. Just be careful that you use the correct number of fixed points in the numbers.</td> </tr></table><span class="postbody">
<br/>
It still has Sqrt and Div SWIs, but no ArcTan functions. They're software calculated so they might be safer for when you want to avoid conflicts with the math hardware. (like in an interrupt)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152490 - Cearn - Sun Mar 16, 2008 5:43 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cave Johnson wrote:</b></span></td> </tr> <tr> <td class="quote">After reading through your tutorial cearn, ive setup the affine transformation matrix, and the sprite is affine and i can rotate it with button presses. From here, what would be my next step to make the sprite rotate and orient itself towards touch position? Thanks.</td> </tr></table><span class="postbody">
<br/>
That will depend on which method you want to use: calculate the angles with an arctan variant and look-up the sine/cosine values, or calculate the sine/cosines by normalizing the distance vector. Either way will work, but one may be more useful for your game than the other.
<br/>
<br/>
If you do need the angle, you need an arctangens. With the standard <a class="postlink" href="http://www.cplusplus.com/reference/clibrary/cmath/atan2.html" target="_blank">atan2</a>,  the following should work:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include &lt;math.h&gt;  // for floating point math functions.
<br/>
<br/>
static const float  M_PI=3.14159265f;
<br/>
<br/>
//! Get integer angle ∈ [-256, +256]. Note: very slow.
<br/>
int atan2i(int y, int x)
<br/>
{
<br/>
    float anglef= atan2(y, x);   // anglef in rad
<br/>
    return (int)(anglef*256/M_PI);      // Type and range conversion.
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
Don't forget to link the math library (add <span style="font-style: italic">-lm</span> to LIBS in the makefile). It's probably better to get an pure integer version for atan2. This ancient thread (<a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=3840" target="_blank">forum:3840</a>) has a sweet little assembly version. To use it, remove the ".section .iwram " line (that's mainly for GBA) and copy the code into an .s file in the source directory. The makefile should pick it up and assemble it automatically. To call the function from C, add the appropriate declaration: int atan2asm(int y, int x).
<br/>
<br/>
The code I gave in the other reply already gives you the steps for the normalization method. It provides the correct sine and cosine values you need to use. 
<br/>
<br/>
The exact form of the rotation matrix depends on the orientation of your sprites. The code I gave assumes the graphics point to the right. If this is different, the matrix will need to be changed a little.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152499 - Cave Johnson - Sun Mar 16, 2008 7:45 pm</h4>
    <div class="postbody"><span class="postbody">Cearn, ive been trying to use your second code, but im having several problems. I have no idea where to put the code in, I was thinking of in the void handleInput, but regardless, im getting "a function-definition is not allowed before '{' token" errors. Im also not sure how this code would work, what am i going to have to add or change to make it cause the sprite to point towards the touch position? Thanks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152501 - Cearn - Sun Mar 16, 2008 8:43 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cave Johnson wrote:</b></span></td> </tr> <tr> <td class="quote">Cearn, ive been trying to use your second code, but im having several problems. I have no idea where to put the code in, I was thinking of in the void handleInput, but regardless, im getting "a function-definition is not allowed before '{' token" errors. </td> </tr></table><span class="postbody">
<br/>
This:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int atan2i(int y, int x)
<br/>
{
<br/>
    float anglef= atan2(y, x);
<br/>
    return (int)(anglef*256/M_PI);
<br/>
}</td> </tr></table><span class="postbody">
<br/>
is the definition of a function called <span style="font-style: italic">atan2i</span>. You use it like you would any other function. You can't put the definition inside another function, because C doesn't allow that, so you place it outside them. Then, simply call the function somewhere:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void handleInput()
<br/>
{
<br/>
   // ... stuff ...
<br/>
   
<br/>
   // Get the angle.
<br/>
   // NOTE: make sure the touch and gun positions use the same number
<br/>
   // of fixed point bits.
<br/>
   int angle= atan2i(touchY-gunY, touchX-gunX);
<br/>
<br/>
   // Correct for object orientation angle
<br/>
   angle += ???
<br/>
   
<br/>
   // Look-up (co)sine and convert from .12 to .8 fixed point
<br/>
   int cosa= COS[angle&amp;511]&gt;&gt;4;
<br/>
   int sina= SIN[angle&amp;511]&gt;&gt;4;
<br/>
   
<br/>
   // Set matrix
<br/>
   pa=  cosa;   pb= sina;
<br/>
   pc= -sina;   pd= cosa;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cave Johnson wrote:</b></span></td> </tr> <tr> <td class="quote">Im also not sure how this code would work, what am i going to have to add or change to make it cause the sprite to point towards the touch position? Thanks.</td> </tr></table><span class="postbody">
<br/>
This depends on the details of your situation. I can't tell you what you have to change because you haven't yet mentioned these details. In particular, we need to know the default orientation of your sprites: do they point to the right, up, to the left or down? This determines whether the angle should be offset by 0, 384, 256 or 128, respectively (or was it 0, 128, 256 or 384? I always get minus signs mixed up).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152508 - tepples - Sun Mar 16, 2008 10:36 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cearn wrote:</b></span></td> </tr> <tr> <td class="quote">You can't put the definition inside another function, because C doesn't allow that</td> </tr></table><span class="postbody">
<br/>
True, nested functions aren't in ISO C or C++, but GNU C allows <a class="postlink" href="http://gcc.gnu.org/onlinedocs/gcc/Nested-Functions.html" target="_blank">nested functions</a> as an extension.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152647 - Cave Johnson - Tue Mar 18, 2008 9:47 pm</h4>
    <div class="postbody"><span class="postbody">No dice. Ive finally got everything compiled, but the code is still not working, any ideas? Heres what I have so far:
<br/>
<br/>
if (keysDown() &amp; KEY_TOUCH) {
<br/>
        int angle= atan2asm(touch-&gt;py-gunPos-&gt;y, touch-&gt;px-gunPos-&gt;x); 
<br/>
<br/>
         int cosa= COS[angle&amp;511]&gt;&gt;4; 
<br/>
         int sina= SIN[angle&amp;511]&gt;&gt;4;
<br/>
<br/>
         spriteRotation-&gt;hdx = cosa;
<br/>
         spriteRotation-&gt;hdy = sina;
<br/>
         spriteRotation-&gt;vdx = -sina;
<br/>
         spriteRotation-&gt;vdy = cosa;
<br/>
}
<br/>
<br/>
hdx is the same as pa
<br/>
hdy is the same as pb
<br/>
vdx is the same as pc
<br/>
vdy is the same as pd
<br/>
<br/>
If the code seems fine and you dont see any flagrant errors, I am slightly doughting that i coded the gunposition and touch position x and y's correctly, and am going to have to work on them a bit. Thanks for all of the help so far.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152670 - SiW - Wed Mar 19, 2008 5:07 am</h4>
    <div class="postbody"><span class="postbody">I have some poor code here plucked straight out of an old project, not exactly suited to the DS (because it uses floats for one thing..  IIRC the original usage wasn't even a real-time project) but I did a quick test and it let me rotate a sprite to point at something.  Perhaps you can create an optimized version from it:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
float AngleBetween( float x1, float y1, float x2, float y2 )
<br/>
{
<br/>
    float dx = x2-x1;
<br/>
    float dy = y2-y1;
<br/>
    float angle = 0.0f;
<br/>
<br/>
    // calculate angle
<br/>
    if ( dx == 0.0f )
<br/>
    {
<br/>
        if ( dy == 0.0f )
<br/>
            angle = 0.0f;
<br/>
        else if ( dy &gt; 0.0f )
<br/>
            angle = PI / 2.0f;
<br/>
        else
<br/>
            angle = PI * 3.0f / 2.0f;
<br/>
    }
<br/>
    else if ( dy == 0.0f )
<br/>
    {
<br/>
        if  ( dx &gt; 0.0f )
<br/>
            angle = 0.0f;
<br/>
        else
<br/>
            angle = PI;
<br/>
    }
<br/>
    else
<br/>
    {
<br/>
        if  ( dx &lt; 0.0f )
<br/>
            angle = atan( dy / dx ) + PI;
<br/>
        else if ( dy &lt; 0.0 )
<br/>
            angle = atan( dy / dx ) + ( 2*PI );
<br/>
        else
<br/>
            angle = atan( dy / dx );
<br/>
    }
<br/>
<br/>
    // convert to degrees
<br/>
    angle = angle * 180 / PI;
<br/>
<br/>
    return angle;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
And the usage for setting sprite rotation:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
spriteInfo-&gt;angle = (AngleBetween( x1, y1, x2, y2 ) / 360.0f) * 512 - 128;
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152691 - Cave Johnson - Wed Mar 19, 2008 7:47 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for the code SiW, im deffinently going to play around with it and see if i can make it work for me, but in the mean time, id appreciate any help with my code. Thanks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152698 - Cearn - Wed Mar 19, 2008 8:49 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>SiW wrote:</b></span></td> </tr> <tr> <td class="quote">I have some poor code here plucked straight out of an old project, not exactly suited to the DS (because it uses floats for one thing..  IIRC the original usage wasn't even a real-time project) but I did a quick test and it let me rotate a sprite to point at something.  Perhaps you can create an optimized version from it:
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">float AngleBetween( float x1, float y1, float x2, float y2 )
<br/>
{
<br/>
    ... code ...
<br/>
<br/>
    // convert to degrees
<br/>
    angle = angle * 180 / PI;
<br/>
<br/>
    return angle;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
This is essentially what atan2 does; only the number of inputs and the range of the output is different. The routine by ecurtz I pointed to should be considerably faster. 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cave Johnson wrote:</b></span></td> </tr> <tr> <td class="quote">No dice. Ive finally got everything compiled, but the code is still not working, any ideas? </td> </tr></table><span class="postbody">
<br/>
It would help if you described what you're seeing and (for the third time) what the orientation of your gun-graphics is. Also print the angle (angle&amp;511 to be precise) and make sure that you get the following numbers for the following locations:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">  320    384   448
<br/>
<br/>
  256    gun     0 / 511
<br/>
<br/>
  192    128    64
<br/>
</td> </tr></table><span class="postbody">
<br/>
If you don't, the angle calculation is incorrect. If you do, then you're matrix is off.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152867 - Cave Johnson - Sat Mar 22, 2008 12:11 am</h4>
    <div class="postbody"><span class="postbody">After printing the angle, no matter where i clicked, the read out was 0,0. I have no idea if this could be my problem, or that i may have just programmed the print angle wrong. To answer some of your questions, the sprite is at 0 degrees, facing right. When i touch anywhere on the screen, the sprite does absolutely nothing, so i think that rules out an incorrect angle calculation, and the sprite can be turned with butten presses, so i would think that the matrix is on. Could the problem be that im not handeling the touch screen correctly? Id post some of my code, but i have no idea where the problem area would be. Any ideas or help would be great. Thanks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152870 - silent_code - Sat Mar 22, 2008 1:18 am</h4>
    <div class="postbody"><span class="postbody">i'm going to bed, but this came to my mind: print the sprites coordinates and the touch coordinates... then print any input to the angle calculation function.
<br/>
well, that is just in case you didn't try already. ;^)
<br/>
<br/>
good luck and happy coding!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152872 - Cearn - Sat Mar 22, 2008 1:42 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cave Johnson wrote:</b></span></td> </tr> <tr> <td class="quote">After printing the angle, no matter where i clicked, the read out was 0,0. I have no idea if this could be my problem, or that i may have just programmed the print angle wrong.</td> </tr></table><span class="postbody">That or, as you say later, there's something not right about how you're handling the positions. I checked the atan2asm routine and that seems to work fine, so the problem would have to be somewhere else.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cave Johnson wrote:</b></span></td> </tr> <tr> <td class="quote">To answer some of your questions, the sprite is at 0 degrees, facing right.</td> </tr></table><span class="postbody">Thank you. Then the matrix you're using should work.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cave Johnson wrote:</b></span></td> </tr> <tr> <td class="quote">When i touch anywhere on the screen, the sprite does absolutely nothing, so i think that rules out an incorrect angle calculation, and the sprite can be turned with butten presses, so i would think that the matrix is on. Could the problem be that im not handeling the touch screen correctly? Id post some of my code, but i have no idea where the problem area would be. Any ideas or help would be great. Thanks.</td> </tr></table><span class="postbody">
<br/>
The code you gave earlier is pretty much how it should be. What's missing from it are the types of the positions and how they're initialized. Are you sure you're reading the touch coordinates correctly?
<br/>
<br/>
ninjad:
<br/>
And what silent_code said.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152887 - Cave Johnson - Sat Mar 22, 2008 4:09 am</h4>
    <div class="postbody"><span class="postbody">[quote=Cearn"]]The code you gave earlier is pretty much how it should be. What's missing from it are the types of the positions and how they're initialized. Are you sure you're reading the touch coordinates correctly?[/quote]
<br/>
Im not really sure what you mean by this. I have no idea what the types of the positions and how to initialize them are, so i dont think i coded them in (unless somehow by accident). Could this be my problem? Also what do you mean by me not reading the touch coordinates correctly? Sorry for such a basic question, but being a beginner, i havent picked up all of the lingo yet. Thanks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152904 - Cearn - Sat Mar 22, 2008 12:48 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cave Johnson wrote:</b></span></td> </tr> <tr> <td class="quote">[quote=Cearn"]The code you gave earlier is pretty much how it should be. What's missing from it are the types of the positions and how they're initialized. Are you sure you're reading the touch coordinates correctly?</td> </tr></table><span class="postbody">
<br/>
Im not really sure what you mean by this. I have no idea what the types of the positions and how to initialize them are, so i dont think i coded them in (unless somehow by accident). [/quote] In C, you always have to declare/define the variables that you're using. Things like
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int x, y;
<br/>
touchPosition touch;
<br/>
</td> </tr></table><span class="postbody">
<br/>
are variable definitions. "int" and "touchPosition" are the types in this case. "touchPosition" is a struct defined in one of the libnds headers, and it's members will probably be integers.
<br/>
<br/>
The <span style="font-style: italic">touch</span> variable contains the touch coordinates, <span style="font-weight: bold">but only if you put them in there first</span>! Simply creating a variable doesn't give them the proper values. In fact, they will just contain whatever was in that memory before. To fill the <span style="font-style: italic">touch</span> variable with the actual touchpad data, use 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">touch=touchReadXY();</td> </tr></table><span class="postbody">My guess is that your code doesn't have this inside the main loop.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cave Johnson wrote:</b></span></td> </tr> <tr> <td class="quote">Could this be my problem? </td> </tr></table><span class="postbody"> Yes. Not knowing what your own code does or how the code libraries you're using should be used is <span style="font-weight: bold">always</span> a problem. Such practices lead to <a class="postlink" href="http://www.catb.org/~esr/jargon/html/C/cargo-cult-programming.html" target="_blank">cargo cult</a> or <a class="postlink" href="http://www.catb.org/~esr/jargon/html/V/voodoo-programming.html" target="_blank">voodoo</a> programming, which are bad (mkay). 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Cave Johnson wrote:</b></span></td> </tr> <tr> <td class="quote">Also what do you mean by me not reading the touch coordinates correctly? Sorry for such a basic question, but being a beginner, i havent picked up all of the lingo yet. Thanks.</td> </tr></table><span class="postbody">
<br/>
From what I can see, it seems you're not only new to NDS coding but programming in general and programming in C in particular. It would be best to let the NDS parts lie and focus on learning C first. By immediately diving into NDS programming, you're trying to run before you can walk. Learn to walk first.
<br/>
<br/>
If you have access to C(++) books, get them and read them in full. There are also tutorials on the web, but you have to be careful which ones you use: they may not always be of high quality. Many of the GBA (and perhaps DS too) tutorials are known for their bad coding style, for example. I hear this one is nice: <a class="postlink" href="http://www.cprogramming.com/tutorial/" target="_blank">http://www.cprogramming.com/tutorial/</a>. Also read the <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=418" target="_blank">FAQ</a> and the <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=13662" target="_blank">MUL/B</a>.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152919 - silent_code - Sat Mar 22, 2008 5:12 pm</h4>
    <div class="postbody"><span class="postbody">i didn't read everything, so this may be posted already by someone else.
<br/>
<br/>
remember, that you have to declare a commonly used variable (used in multiple source files [.c, .cpp]) in a header file (as extern, then define it in only ONE source file), that has to be included by all files, that need the variable (or what else is in the header file). if you just declare a variable in each file with the same name, things get messy, because you're effectively using different variables!
<br/>
<br/>
i don't know if that applies to you problem, though. depends on your c/c++ knowledge.
<br/>
<br/>
as always, happy coding! :^)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#152924 - Cave Johnson - Sat Mar 22, 2008 6:37 pm</h4>
    <div class="postbody"><span class="postbody">After clearing that up a bit, i understand what you are saying, and i have (purposely :) filled in the touch variables using touch=touchReadXY();. This seems to have narrowed down my problem quite a bit, and i think it might be that the touch x and y values in:
<br/>
<br/>
int angle= atan2asm(touch-&gt;py-gunPos-&gt;y, touch-&gt;px-gunPos-&gt;x);
<br/>
<br/>
were not coded correctly. Im going to have to fiddle around with them a bit. As for that tutorial, <a href="http://www.cprogramming.com/tutorial/" target="_blank">http://www.cprogramming.com/tutorial/</a> is the tutorial that i have been coding alongside the entire time. Thanks.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
