<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Visual HAM issues regarding brightness and rapid input/flip - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > Visual HAM issues regarding brightness and rapid input/flip</h2>
<div id="posts">
<div class="post">
    <h4>#178239 - NeonHB - Thu Oct 16, 2014 4:23 am</h4>
    <div class="postbody"><span class="postbody">Hi, my name is NeonHB and <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=18016" target="_blank">yesterday I signed up here</a> in an attempt to seek for help with certain issues that I'm going through in Visual HAM. I'm new to making homebrew, and this is my first legit project that I'm trying to finish. What I'm trying to create is a short fiction in homebrew form, so it's not really a game, but rather a story. The story is already written in a text file in my PC, and I already have the main menu and the first few pages done along with the designs, fonts, and some of the code. Since all the text and designs are on the actual images themselves, it's only a matter of displaying images depending on the input received. 
<br/>
<br/>
<br/>
<a href="http://i.imgur.com/80diXAI.png">[Images not permitted - Click here to view it]</a>
<br/>
Home Menu above.
<br/>
<br/>
<a href="http://i.imgur.com/YdQmc2t.png">[Images not permitted - Click here to view it]</a>
<br/>
Page1 above.
<br/>
<br/>
<a href="http://i.imgur.com/Jtkn0JA.png">[Images not permitted - Click here to view it]</a>
<br/>
Page2 above.
<br/>
<br/>
<br/>
As shown on the images above, that's what I've passed over so far from the text file to the homebrew. The issue lies in the input and the brightness. I'm trying to make it so that every time you flip pages on the GBA, it fades from normal to dark and from dark to normal again, revealing the next page during the process. I looked through the Visual HAM samples, ripped out the code that works with the brightness from the brightness sample, and implemented it into my code to figure it out. It does something, but not the way I want it to.
<br/>
<br/>
You can download a ROM showing the brightness issue below. It's programmed to loop the fade in the main menu when you hold the A button. To me it seems like it fades really fast, giving a distorted/static effect. I'm not entirely sure.
<br/>
<br/>
<a class="postlink" href="http://www.mediafire.com/download/qew463rjq61rjb5/Melody_-_Fade.gba" target="_blank">download ROM with brightness issue</a>
<br/>
<br/>
My other issue relates to the input. When you press a button to flip a page, it'll flip more pages than wanted in a rapid speed as if you were holding the button instead of tapping it. I thought of implementing a timer and having it count one second between image flips to prevent it from going so fast but I couldn't figure out the timer sample, nor do I think that it works because it doesn't even compile as-is and instead gives cryptic errors. The fade isn't a big killer for me but I'd at least like to figure out the rapid input/image flip. After I figure that out I can continue to pass over the story, start working on sounds and polish whatever needs to be polished at the time.
<br/>
<br/>
<a class="postlink" href="http://www.mediafire.com/download/oadr4qre59df3xb/Melody_-_Rapid_Input.gba" target="_blank">download ROM with input issue</a>
<br/>
<br/>
Also, I have two separate programs despite them being the same exact homebrew to make it easier to figure out what's wrong. Below I'll leave the code for both programs.
<br/>
<br/>
<span style="font-weight: bold">Program with brightness-fade issue:</span>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
// Includes the main Visual HAM header file.
<br/>
#include &lt;mygba.h&gt;
<br/>
<br/>
// Includes the image and palette of the Home Menu.
<br/>
#include "C:/Users/Neon/Documents/Melody/Home/Home.pal.c"
<br/>
#include "C:/Users/Neon/Documents/Melody/Home/Home.raw.c"
<br/>
<br/>
//Global Variables Below. All three are taken from the Visual Ham brightness sample.
<br/>
<br/>
u32 g_Frames=0;
<br/>
u8  g_NewFrame=1;
<br/>
u8  g_BrightIntensity=16;
<br/>
<br/>
<br/>
int main(){
<br/>
<br/>
bool key_pressed = 0;
<br/>
<br/>
<br/>
    ham_Init();
<br/>
<br/>
// Sets background mode to four.
<br/>
    ham_SetBgMode(4);
<br/>
    
<br/>
// Loads Home Menu image and palette. Also Flips Home Menu Image.
<br/>
    ham_LoadBGPal((void*)Home_Palette,256);
<br/>
    ham_LoadBitmap((void*)Home_Bitmap);
<br/>
    ham_FlipBGBuffer();
<br/>
<br/>
// While A is pressed the fade will start to loop.
<br/>
while(key_pressed == 0){if (F_CTRLINPUT_A_PRESSED){
<br/>
<br/>
// Visual HAM Brightness sample starts here.
<br/>
  // Loop
<br/>
      // Its a new frame?
<br/>
        if(g_NewFrame)
<br/>
        {
<br/>
            // Just to skip some frames
<br/>
            if(!(g_Frames&amp;7))
<br/>
            {
<br/>
                // Fade screen from normal to black
<br/>
                if((g_BrightIntensity &gt;= 32) &amp;&amp; (g_BrightIntensity &lt; 48))
<br/>
                {
<br/>
                    ham_SetFxMode(FX_LAYER_SELECT(1,1,1,1,1,0),         // Source layer
<br/>
                                  FX_LAYER_SELECT(0,0,0,0,0,0),         // Target layer
<br/>
                                  FX_MODE_DARKEN);                      // Effect mode
<br/>
<br/>
                    // Set the intensity of the source and target layer
<br/>
                    ham_SetFxBrightnessLevel(g_BrightIntensity&amp;15);     // intensity
<br/>
                }
<br/>
                else
<br/>
                // Fade screen from black to normal
<br/>
<br/>
<br/>
                    // Set the intensity of the source and target layer
<br/>
                    ham_SetFxBrightnessLevel(64-g_BrightIntensity);     // intensity
<br/>
                }
<br/>
                else
<br/>
                    g_BrightIntensity=0;
<br/>
<br/>
                // Increase bright helper variable
<br/>
                g_BrightIntensity++;
<br/>
}
<br/>
<br/>
<br/>
}
<br/>
<br/>
}
<br/>
    return 0;
<br/>
}
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
<span style="font-weight: bold">Program with rapid input issue:</span>
<br/>
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">//Includes the main Visual HAM header file. 
<br/>
#include &lt;mygba.h&gt;
<br/>
<br/>
// Includes the images and palettes of the Home Menu, Page 1 and Page 2.
<br/>
#include "C:/Users/Neon/Documents/Melody/Home/Home.pal.c"
<br/>
#include "C:/Users/Neon/Documents/Melody/Home/Home.raw.c"
<br/>
#include "C:/Users/Neon/Documents/Melody/Page1/Page1.pal.c"
<br/>
#include "C:/Users/Neon/Documents/Melody/Page1/Page1.raw.c"
<br/>
#include "C:/Users/Neon/Documents/Melody/Page2/Page2.pal.c"
<br/>
#include "C:/Users/Neon/Documents/Melody/Page2/Page2.raw.c"
<br/>
<br/>
int main()
<br/>
<br/>
{
<br/>
<br/>
bool key_pressed = 0;
<br/>
<br/>
    ham_Init();
<br/>
<br/>
// Sets up the background mode to four.
<br/>
    ham_SetBgMode(4);
<br/>
   
<br/>
<br/>
// Loads Home Menu image and palette. Also Flips Home Menu Image. 
<br/>
    ham_LoadBGPal((void*)Home_Palette,256);   
<br/>
    ham_LoadBitmap((void*)Home_Bitmap);   
<br/>
    ham_FlipBGBuffer();
<br/>
<br/>
<br/>
<br/>
while (key_pressed ==0)
<br/>
<br/>
// If any button is pressed in the Home Menu, it will go to page 1.
<br/>
<br/>
{
<br/>
<br/>
if (F_CTRLINPUT_A_PRESSED
<br/>
            || F_CTRLINPUT_B_PRESSED
<br/>
            || F_CTRLINPUT_UP_PRESSED
<br/>
            || F_CTRLINPUT_DOWN_PRESSED
<br/>
            || F_CTRLINPUT_LEFT_PRESSED
<br/>
            || F_CTRLINPUT_RIGHT_PRESSED
<br/>
            || F_CTRLINPUT_START_PRESSED
<br/>
            || F_CTRLINPUT_SELECT_PRESSED
<br/>
            || F_CTRLINPUT_L_PRESSED
<br/>
            || F_CTRLINPUT_R_PRESSED)
<br/>
            
<br/>
{   
<br/>
    
<br/>
// Loads Page1 image and palette. Also Flips Page1 Image, assuming that any button was pressed in the Home Menu. 
<br/>
         ham_LoadBGPal((void*)Page1_Palette,256);
<br/>
         ham_LoadBitmap((void*)Page1_Bitmap);
<br/>
         ham_FlipBGBuffer();
<br/>
          
<br/>
// If R is pressed, it will load Page 2 from within Page 1.
<br/>
                    if (F_CTRLINPUT_R_PRESSED)
<br/>
<br/>
                                              {
<br/>
// Loads Page2 image and palette. Also Flips Page2 Image, assuming that R was pressed in Page 1 
<br/>
                                           ham_LoadBGPal((void*)Page2_Palette,256);
<br/>
                                           ham_LoadBitmap((void*)Page2_Bitmap);
<br/>
                                           ham_FlipBGBuffer();
<br/>
<br/>
}
<br/>
<br/>
}
<br/>
<br/>
}
<br/>
        
<br/>
    return 0;
<br/>
} // End of main()
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Any help is appreciated.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#178240 - elhobbs - Thu Oct 16, 2014 11:33 am</h4>
    <div class="postbody"><span class="postbody">Any particular reason you are using ham instead of libgba and devkitarm? Am I correct that you are targeting the gba? If so then you may want to switch.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#178241 - NeonHB - Thu Oct 16, 2014 3:25 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>elhobbs wrote:</b></span></td> </tr> <tr> <td class="quote">Any particular reason you are using ham instead of libgba and devkitarm? Am I correct that you are targeting the gba? If so then you may want to switch.</td> </tr></table><span class="postbody">
<br/>
<br/>
There is no reason in particular. I started studying GBA programming a few months back and came across Visual HAM first. Everything was going well until now. Yes, I am targeting the GBA. I'll take that suggestion.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#178243 - NeonHB - Fri Oct 17, 2014 6:49 am</h4>
    <div class="postbody"><span class="postbody">I installed devkitARM and looked for tutorials online but not many, if not none of what I've found are noob friendly. It's probably going to take me a long time to fully understand it all and get used to it so I'm going to research while finding workarounds in Visual HAM. 
<br/>
<br/>
Speaking of workarounds, I may have found a way to stop the rapid input. Basically I placed the pages in separate functions and called the functions when an input is received. On the actual homebrew, when a button is pressed the screen goes black for a second and then back to normal, revealing the next page.
<br/>
<br/>
Code example below:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include &lt;mygba.h&gt;
<br/>
<br/>
<br/>
#include "C:/Users/Neon/Documents/Melody/Home/Home.pal.c"
<br/>
#include "C:/Users/Neon/Documents/Melody/Home/Home.raw.c"
<br/>
#include "C:/Users/Neon/Documents/Melody/Page1/Page1.pal.c"
<br/>
#include "C:/Users/Neon/Documents/Melody/Page1/Page1.raw.c"
<br/>
#include "C:/Users/Neon/Documents/Melody/Page2/Page2.pal.c"
<br/>
#include "C:/Users/Neon/Documents/Melody/Page2/Page2.raw.c"
<br/>
#include "C:/Users/Neon/Documents/Melody/Page3/Page3.pal.c"
<br/>
#include "C:/Users/Neon/Documents/Melody/Page3/Page3.raw.c"
<br/>
<br/>
// DECLARATION
<br/>
int Page1(void);
<br/>
int Page2(void);
<br/>
int Page3(void);
<br/>
<br/>
<br/>
// MAIN FUNCTION
<br/>
int main(){
<br/>
    
<br/>
<br/>
    ham_Init();
<br/>
    ham_SetBgMode(4);
<br/>
    ham_LoadBGPal((void*)Home_Palette,256);
<br/>
    ham_LoadBitmap((void*)Home_Bitmap);
<br/>
    ham_FlipBGBuffer();
<br/>
      
<br/>
      while(1){if (F_CTRLINPUT_UP_PRESSED
<br/>
            || F_CTRLINPUT_DOWN_PRESSED
<br/>
            || F_CTRLINPUT_LEFT_PRESSED
<br/>
            || F_CTRLINPUT_RIGHT_PRESSED
<br/>
            || F_CTRLINPUT_R_PRESSED
<br/>
            || F_CTRLINPUT_L_PRESSED
<br/>
            || F_CTRLINPUT_A_PRESSED
<br/>
            || F_CTRLINPUT_B_PRESSED
<br/>
            || F_CTRLINPUT_START_PRESSED
<br/>
            || F_CTRLINPUT_SELECT_PRESSED){break;}}
<br/>
            
<br/>
            Page1();
<br/>
<br/>
    return 0;
<br/>
}
<br/>
<br/>
<br/>
<br/>
// PAGE 1 FUNCTION
<br/>
int Page1() {
<br/>
<br/>
    bool key_pressed = 0;
<br/>
<br/>
    ham_Init();
<br/>
    ham_SetBgMode(4);
<br/>
<br/>
    ham_LoadBGPal((void*)Page1_Palette,256);
<br/>
    ham_LoadBitmap((void*)Page1_Bitmap);
<br/>
    ham_FlipBGBuffer();
<br/>
<br/>
     while(key_pressed == 0){if (F_CTRLINPUT_R_PRESSED){
<br/>
     Page2();}}
<br/>
    return 0;
<br/>
}
<br/>
<br/>
<br/>
<br/>
// PAGE 2 FUNCTION
<br/>
int Page2() {
<br/>
bool key_pressed = 0;
<br/>
    ham_Init();
<br/>
    ham_SetBgMode(4);
<br/>
    ham_LoadBGPal((void*)Page2_Palette,256);
<br/>
    ham_LoadBitmap((void*)Page2_Bitmap);
<br/>
    ham_FlipBGBuffer();
<br/>
    
<br/>
      while(key_pressed == 0){if (F_CTRLINPUT_R_PRESSED){Page3();}
<br/>
                              if (F_CTRLINPUT_L_PRESSED){Page1();}
<br/>
                              }
<br/>
<br/>
<br/>
    return 0;
<br/>
}
<br/>
<br/>
// PAGE 3 FUNCTION
<br/>
int Page3() {
<br/>
    
<br/>
    bool key_pressed = 0;
<br/>
    ham_Init();
<br/>
    ham_SetBgMode(4);
<br/>
    ham_LoadBGPal((void*)Page3_Palette,256);
<br/>
    ham_LoadBitmap((void*)Page3_Bitmap);
<br/>
    ham_FlipBGBuffer();
<br/>
<br/>
      while(key_pressed == 0){if (F_CTRLINPUT_R_PRESSED){Page1();}
<br/>
                              if (F_CTRLINPUT_L_PRESSED){Page2();}
<br/>
                              }
<br/>
<br/>
<br/>
    return 0;
<br/>
}
<br/>
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#178244 - gauauu - Mon Oct 20, 2014 2:55 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>NeonHB wrote:</b></span></td> </tr> <tr> <td class="quote">I installed devkitARM and looked for tutorials online but not many, if not none of what I've found are noob friendly.</td> </tr></table><span class="postbody">
<br/>
<br/>
Your best bet is TONC: <a class="postlink" href="http://www.coranac.com/tonc/text/" target="_blank">http://www.coranac.com/tonc/text/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#178245 - NeonHB - Tue Oct 21, 2014 6:35 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>gauauu wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>NeonHB wrote:</b></span></td> </tr> <tr> <td class="quote">I installed devkitARM and looked for tutorials online but not many, if not none of what I've found are noob friendly.</td> </tr></table><span class="postbody">
<br/>
<br/>
Your best bet is TONC: <a class="postlink" href="http://www.coranac.com/tonc/text/" target="_blank">http://www.coranac.com/tonc/text/</a></span></td> </tr></table><span class="postbody">
<br/>
<br/>
Hm. Lua for the GBA is something I'd like to look at later on. Thanks for the link.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#178246 - sverx - Tue Oct 21, 2014 9:55 am</h4>
    <div class="postbody"><span class="postbody">Lua? Check the link again ;)<br/>_________________<br/><a class="postlink" href="http://bit.ly/yiQrz9" target="_blank">libXM7</a>|<a class="postlink" href="http://bit.ly/yJwcOo" target="_blank">NDS programming tutorial (Italiano)</a>|<a class="postlink" href="http://disjointedstudio.blogspot.com/" target="_blank">Waimanu DS / GBA</a>|<a class="postlink" href="http://adshomebrewersdiary.blogspot.com" target="_blank">A DS Homebrewer's Diary</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#178247 - NeonHB - Wed Oct 22, 2014 4:53 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sverx wrote:</b></span></td> </tr> <tr> <td class="quote">Lua? Check the link again ;)</td> </tr></table><span class="postbody">
<br/>
<br/>
Oh. I was looking at this, I guess it's something else then.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Other Languages wrote:</b></span></td> </tr> <tr> <td class="quote">There is dragonBASIC, which provides a BASIC-like syntax. This should be suitable for small projects, but I'm not sure it can be used for full games like a Mario clone. You can find a FreePascal for GBA/NDS at itaprogaming.free.fr, <span style="font-weight: bold">and instructions for using Forth or Lua at <a href="http://www.torlus.com." target="_blank">www.torlus.com.</a></span> Finally, there is (or at least was) something called Catalpult at <a href="http://www.nocturnal-central.com." target="_blank">www.nocturnal-central.com.</a> This is a very complete environment with an emulator and I think I've seen a debugger there as well. I think this could be compared to GameMaker, but then again I may be wrong. </td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#178578 - theycallmeyoggi - Sat Mar 05, 2016 3:09 pm</h4>
    <div class="postbody"><span class="postbody">Hey, sorry I'm not answering your question but since you've at least got it to output something I figured you'd know the answer to this question. Where did you put your .vhw files. I put mine in a a folder I made called 'vhmworkspace'. However when I try to build the program, nothing happens. I already have it running on windows xp so thats not the problem. If you have any advice please reply, thank you.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
