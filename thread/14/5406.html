<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>A Box-Plane Intersection Test - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Beginners > A Box-Plane Intersection Test</h2>
<div id="posts">
<div class="post">
    <h4>#39530 - Celeryface - Sun Apr 10, 2005 1:03 am</h4>
    <div class="postbody"><span class="postbody">I'm trying to implement this algorithm for testing a box-plane intersection. Has anyone done this before? 
<br/>
<br/>
In the algorithm it states the box and plane are overlapping when:
<br/>
<br/>
|d| &lt;= a1 |n.A1| + a2 |n.A2| + a3 |n.A3|
<br/>
<br/>
<a href="http://www.gamasutra.com/features/19991018/Gomez_7.htm" target="_blank">http://www.gamasutra.com/features/19991018/Gomez_7.htm</a>
<br/>
<br/>
Does anyone know what a1, a2, a3 are? I'm thinking A1, A2, A3 are the axes of the box.
<br/>
<br/>
Thanks in advance. :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39535 - sajiimori - Sun Apr 10, 2005 2:15 am</h4>
    <div class="postbody"><span class="postbody">I don't know what those letters mean, but if you get the pair of box corners that are futhest along and furthest against the plane's normal, and they are on opposite sides of the plane, then there's an intersection
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
enum Axis
<br/>
{
<br/>
   AXIS_X,
<br/>
   AXIS_Y,
<br/>
   AXIS_Z,
<br/>
   AXIS_NUM
<br/>
};
<br/>
<br/>
<br/>
enum Sign
<br/>
{
<br/>
   SIGN_NEG,
<br/>
   SIGN_POS,
<br/>
   SIGN_NUM
<br/>
};
<br/>
<br/>
<br/>
// Six box sides: left, right, bottom, top, back, front
<br/>
typedef float Box[AXIS_NUM][SIGN_NUM];
<br/>
<br/>
<br/>
Sign sign(float val)
<br/>
{
<br/>
   if(val &lt; 0)
<br/>
      return SIGN_NEG;
<br/>
   else
<br/>
      return SIGN_POS;
<br/>
}
<br/>
<br/>
<br/>
// A support point is a point on a convex shape (such as a box)
<br/>
// furthest in the direction of the given vector.
<br/>
Vector3 boxSupportPoint(Box box, Vector3 dir)
<br/>
{
<br/>
   Vector3 supportPoint;
<br/>
<br/>
   for(int axis = 0; axis &lt; AXIS_NUM; ++axis)
<br/>
      supportPoint[axis] = box[axis][sign(dir[axis])];
<br/>
<br/>
   return supportPoint;
<br/>
}
<br/>
<br/>
<br/>
float pointToPlaneDistance(Vector3 point, Plane plane)
<br/>
{
<br/>
   return dot(point, plane.normal) + plane.offset;
<br/>
}
<br/>
<br/>
<br/>
bool collideBoxPlane(Box box, Plane plane)
<br/>
{
<br/>
   return
<br/>
      sign(pointToPlaneDistance(boxSupportPoint(box, plane.normal))) !=
<br/>
      sign(pointToPlaneDistance(boxSupportPoint(box, -plane.normal)));
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39537 - Celeryface - Sun Apr 10, 2005 2:22 am</h4>
    <div class="postbody"><span class="postbody">Is it as simple as checking each corner of the box, similar to how the centre of a sphere is tested for a sphere/plane intersection?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39539 - sajiimori - Sun Apr 10, 2005 2:25 am</h4>
    <div class="postbody"><span class="postbody">Thankfully you don't have to do all 8 dot products for the corners.  The two support points are sufficient.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39551 - tepples - Sun Apr 10, 2005 5:47 am</h4>
    <div class="postbody"><span class="postbody">But given the fast ARM7TDMI multiply, wouldn't determining which points are support points take as much time as checking all 8 dot products?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39579 - Celeryface - Sun Apr 10, 2005 11:36 am</h4>
    <div class="postbody"><span class="postbody">I found in another forum that the A's are the unit-length axes of the OBB. The small 'a's are the extents along those axes.
<br/>
<br/>
Does anyone know what is meant by 'extents'?
<br/>
<br/>
Also, is this test done in local space of the box -- where you'd have to transform the plane into the local space of the box?
<br/>
<br/>
The box has an OBB with its size defined as min(-1,-1,-1) and max(1,1,1). Are the unit-length axes defined by the box's rotation vector ie (0,180,0)?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39587 - Celeryface - Sun Apr 10, 2005 3:47 pm</h4>
    <div class="postbody"><span class="postbody">I believe the collision detection part is working now. Any ideas on how to find the collision point?
<br/>
<br/>
To find the collision point, I think it should be the distance between the centre of the box and the plane multiplied by the normal, but how do I include the orientation to find the collision point?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39606 - sajiimori - Sun Apr 10, 2005 6:45 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">But given the fast ARM7TDMI multiply, wouldn't determining which points are support points take as much time as checking all 8 dot products?</td> </tr></table><span class="postbody">Possibly.  Writing optimized versions of each might make it clearer.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Does anyone know what is meant by 'extents'?</td> </tr></table><span class="postbody">The length, width, and height, each divided by 2.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Also, is this test done in local space of the box -- where you'd have to transform the plane into the local space of the box?</td> </tr></table><span class="postbody">My test is, yes.  I didn't realize you were doing an oriented box.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39682 - Celeryface - Mon Apr 11, 2005 12:10 pm</h4>
    <div class="postbody"><span class="postbody">Would this test be done in degrees, or radians for the orientation of the box? Or would it work with both?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39698 - Miked0801 - Mon Apr 11, 2005 3:15 pm</h4>
    <div class="postbody"><span class="postbody">Neither - you'd use vectors for the edges and dot products for inclusion/exclusion checking.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39704 - Celeryface - Mon Apr 11, 2005 3:35 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Miked0801 wrote:</b></span></td> </tr> <tr> <td class="quote">Neither - you'd use vectors for the edges and dot products for inclusion/exclusion checking.</td> </tr></table><span class="postbody">
<br/>
<br/>
Right, but the vectors themselves would be constructed as unit vectors of their rotations.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#39712 - Miked0801 - Mon Apr 11, 2005 5:24 pm</h4>
    <div class="postbody"><span class="postbody">I guess you could do it that way in which either rads or degs would work.  Rotation/transform matrix doesn't care about units.  Still, I believe that you'd be recontructing the normal vector when it moves/rotates  to preserve accuracy.  As you know, a little round off over a lot of time can kill you.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
