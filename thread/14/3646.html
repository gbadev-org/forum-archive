<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Where does OAM get stored? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Beginners > Where does OAM get stored?</h2>
<div id="posts">
<div class="post">
    <h4>#22927 - Wriggler - Thu Jul 01, 2004 1:09 pm</h4>
    <div class="postbody"><span class="postbody">When doing all of this tutorial stuff, there's something that confuses me a little bit.
<br/>
<br/>
Where does OAM stuff get stored? Is it in EWRAM, or IWRAM, or anywhere else? And where does the actual bitmap data for a sprite go? Video memory?
<br/>
<br/>
It's not really obvious where each bit goes. I know that bitmaps are loaded into EWRAM, and then the front buffer is located in the video memory. Is that right?
<br/>
<br/>
Can anyone summarise for me please? I'm so confused... :)
<br/>
<br/>
Ben</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22928 - poslundc - Thu Jul 01, 2004 1:38 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Wriggler wrote:</b></span></td> </tr> <tr> <td class="quote">When doing all of this tutorial stuff, there's something that confuses me a little bit.
<br/>
<br/>
Where does OAM stuff get stored? Is it in EWRAM, or IWRAM, or anywhere else?</td> </tr></table><span class="postbody">
<br/>
<br/>
OAM is stored in OAM - Object Attribute Memory, that is. It's a 1 KB memory chip specifically tasked with storing and retrieving sprite attributes for the video processor.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">And where does the actual bitmap data for a sprite go? Video memory?</td> </tr></table><span class="postbody">
<br/>
<br/>
Yes. There are two sections of VRAM: one for storing backgrounds/bitmaps and one for storing sprite tile data.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">It's not really obvious where each bit goes. I know that bitmaps are loaded into EWRAM, and then the front buffer is located in the video memory. Is that right?</td> </tr></table><span class="postbody">
<br/>
<br/>
You can load bitmaps/sprites into EWRAM if you really want to, and this is sometimes a useful/necessary step if you've compressed the images before storing them in the ROM. If your data is uncompressed, though, there is nothing stopping you from copying it directly in from the ROM to VRAM. Although it is recommendable that you restrict yourself to doing it:
<br/>
<br/>
- when your game starts up
<br/>
- during the VBlank period (if you only have some changes to make from one frame to the next)
<br/>
- (if you have a lot to change) with the screen faded to a solid colour (eg. when switching from one level/bitmap to the next)
<br/>
<br/>
... so that you don't create screen artifacts.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Can anyone summarise for me please? I'm so confused... :)</td> </tr></table><span class="postbody">
<br/>
<br/>
<a href="http://www.cs.rit.edu/~tjh8300/CowBite/CowBiteSpec.htm#Memory%20Map" target="_blank">http://www.cs.rit.edu/~tjh8300/CowBite/CowBiteSpec.htm#Memory%20Map</a>
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22934 - Wriggler - Thu Jul 01, 2004 4:07 pm</h4>
    <div class="postbody"><span class="postbody">Dan,
<br/>
<br/>
Thanks for the reply. I didn't realise that OAM was actually a separate memory chip, I thought it was just a small piece of working ram that was set aside for holding the sprite stuff.
<br/>
<br/>
Ok, and so now I understand that the bitmaps are loaded straight from ROM memory to video memory. Gotcha.
<br/>
<br/>
Two more quick questions:
<br/>
1. If I just make a normal variable, of whatever type, is that stored by default into IWRAM (the faster of the two rams)?
<br/>
2. It's my understanding that to store something in EWRAM (slower speed, more space), you simply declare it as "const" and the compiler does the rest. Is that right?
<br/>
<br/>
Thanks for the help, I really do appreciate it. It's always best to be 100% sure about these kind of things, and never make assumptions...
<br/>
<br/>
Thanks again,
<br/>
<br/>
Ben</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22935 - alek - Thu Jul 01, 2004 4:28 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Wriggler wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
1. If I just make a normal variable, of whatever type, is that stored by default into IWRAM (the faster of the two rams)?
<br/>
</td> </tr></table><span class="postbody">
<br/>
Yes, that is correct
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
2. It's my understanding that to store something in EWRAM (slower speed, more space), you simply declare it as "const" and the compiler does the rest. Is that right?
<br/>
</td> </tr></table><span class="postbody">
<br/>
I think you have to use malloc or new if you want to store something in EWRAM and if you declare something as const it will be stored into ROM</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22936 - poslundc - Thu Jul 01, 2004 4:33 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Wriggler wrote:</b></span></td> </tr> <tr> <td class="quote">1. If I just make a normal variable, of whatever type, is that stored by default into IWRAM (the faster of the two rams)?</td> </tr></table><span class="postbody">
<br/>
<br/>
Both local and global variables are, by default, stored in IWRAM.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">2. It's my understanding that to store something in EWRAM (slower speed, more space), you simply declare it as "const" and the compiler does the rest. Is that right?</td> </tr></table><span class="postbody">
<br/>
<br/>
All of the data you want loaded into the game must be stored on the physical cartridge, which means storing it in the ROM.
<br/>
<br/>
Declaring a variable as "const" indicates to the compiler to leave it in ROM, versus variables you declare with initial values, which are copied from ROM to IWRAM when the GBA is booted up.
<br/>
<br/>
EWRAM is only used in three situations:
<br/>
<br/>
1. If you have a multiboot game, in which case there is no cartridge and no ROM, so all of the code and data (including const data) is transmitted over the link cable to the GBA's EWRAM. This is why multiboot games are small: they are limited to 256 KB, which is the size of EWRAM.
<br/>
<br/>
2. I think most devkits implement the malloc() function so that it uses EWRAM instead of IWRAM. Some may use IWRAM, though, so you ought to check if you want to use malloc (many people, myself included, do without it, though).
<br/>
<br/>
3. If you manually access EWRAM in your code by declaring a pointer in the EWRAM address space (easiest IMO), or using an attribute tag on your variable declaration (someone else would have to give you the syntax to do this).
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22937 - isildur - Thu Jul 01, 2004 4:40 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
3. If you manually access EWRAM in your code by declaring a pointer in the EWRAM address space (easiest IMO), or using an attribute tag on your variable declaration (someone else would have to give you the syntax to do this).
<br/>
<br/>
Dan.</td> </tr></table><span class="postbody">
<br/>
<br/>
this is how I do it:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
// in an .h file
<br/>
#define CODE_IN_IWRAM __attribute__ ((section (".iwram"), long_call))
<br/>
#define CODE_IN_ROM __attribute__ ((section (".text"), long_call))
<br/>
#define IN_IWRAM __attribute__ ((section (".iwram")))
<br/>
#define IN_EWRAM __attribute__ ((section (".ewram")))
<br/>
<br/>
// in a module
<br/>
IN_IWRAM u32 someData[128];
<br/>
IN_EWRAM u32 someMoreData[128];
<br/>
<br/>
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22939 - poslundc - Thu Jul 01, 2004 4:50 pm</h4>
    <div class="postbody"><span class="postbody">I would think that the IN_IWRAM macro would be unnecessary, since that is where all non-const data defaults to.
<br/>
<br/>
CODE_IN_ROM should also be generally unnecessary, since all code defaults to ROM. The only place it would make sense is in the prototype for a function being called from IWRAM/EWRAM, and IIRC there was a discussion in another thread about how devkitadvance apparently doesn't support that format of long_call yet.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22945 - Wriggler - Thu Jul 01, 2004 6:39 pm</h4>
    <div class="postbody"><span class="postbody">I see. Const leaves it on the cart. That makes sense.
<br/>
<br/>
So EWRAM wasn't nearly as useful as I first thought! Fair enough. Thank you to all those who responded, you really are helping out a novice in the ways of Gameboy!
<br/>
<br/>
Cheers,
<br/>
<br/>
Ben</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
