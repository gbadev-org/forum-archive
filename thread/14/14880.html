<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>grit files - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > grit files</h2>
<div id="posts">
<div class="post">
    <h4>#149445 - Cave Johnson - Sun Jan 20, 2008 3:12 am</h4>
    <div class="postbody"><span class="postbody">How do i convert a .png image into a grit rule file? And before you ask, yes i have googled it, but i just get manicuring tips. Thanks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#149457 - Cearn - Sun Jan 20, 2008 1:38 pm</h4>
    <div class="postbody"><span class="postbody">png files aren't converted <span style="font-style: italic">into</span> grit files; they're converted into GBA/NDS graphics data using the options given in the grit files&lt;/pedant&gt;. The contents of the grit files are just extra options for the conversion process and you'll have to make those yourself.
<br/>
<br/>
There are examples of how to use grit in the nds examples. In particular, look at examples/nds/Graphics/2D/16bit_color_bmp. In its makefile are several lines using the PNGFILES variable and the rule for grit is at the bottom. Note that when creating the OFILES variable, the $(PNGFILES:.png=.o) line must go <span style="font-weight: bold">before</span> the CPP/C/S files lines, because the conversion must happen before compilation/assembling.
<br/>
<br/>
I've also been using a separate makefile for the graphics conversions lately. This way the conversion process won't interfere with the main makefile and it'll be easier to create your own specialized conversions. Details <a class="postlink" href="http://www.coranac.com/2007/12/12/a-grit-demo-part-i/" target="_blank">here</a>.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#149468 - Cave Johnson - Sun Jan 20, 2008 3:31 pm</h4>
    <div class="postbody"><span class="postbody">I tried to follow the exampls as best i could, but i got the error message:
<br/>
<br/>
linking grit.elf
<br/>
c:/devkitpro/devkitarm/bin/../lib/gcc/arm-eabi/4.1.2/../../../../arm-eabi/lib/th
<br/>
umb/ds_arm9_crt0.o: In function `CIDLoop':
<br/>
ds_arm9_crt0.s:(.init+0x2ac): undefined reference to `initSystem'
<br/>
ds_arm9_crt0.s:(.init+0x2b8): undefined reference to `main'
<br/>
collect2: ld returned 1 exit status
<br/>
make[1]: *** [/c/Taylor/grit/grit.elf] Error 1
<br/>
make: *** [build] Error 2
<br/>
<br/>
Were did i go wrong? In my file i had the .png image, the main.cpp file, and the make file, am i missing some other necessary files? Thanks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#149470 - gmiller - Sun Jan 20, 2008 4:18 pm</h4>
    <div class="postbody"><span class="postbody">The error says that the main function and the initSystem functions can not be found.  The project you are building appears to be one for the DS not a GBA, is that what you wanted?  
<br/>
<br/>
Normally you would not link and elf (that being an executable, but not in the correct format for the DS or GBA).  You probably wanted to create an object file with your image in it and then link it into your project.
<br/>
<br/>
With a little more information (from you) as to what you are trying to build (DS/GBA) and maybe a small section of your makefile might help us help you better.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#149471 - Cave Johnson - Sun Jan 20, 2008 4:26 pm</h4>
    <div class="postbody"><span class="postbody">Sorry for being so vague. Im trying to make a very basic ds game with a background and a sprite that can be moved with the dpad. The makfile im using is the same one from the drunkencoders logo example that came with devkit pro. The images im trying to create grit files of are the background .png image and the sprite which is also a .png image. Hope this clears everthing up. Thanks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#149472 - Cearn - Sun Jan 20, 2008 6:13 pm</h4>
    <div class="postbody"><span class="postbody">A missing initSystem() means that your libnds is out of date. As of devkitARM r21, the NDS boot code calls a part of the latest libnds. This means that you can't build a NDS game without it and that older versions will not work because they don't have a function called initSystem(). If you're working with PALib, this couldbe why you're seeing the message: PALib still uses an older libnds version.
<br/>
<br/>
A missing main() means that you don't have a main() function anywhere in the project. Since this is the entry point of any C program, it's rather important that you have one. If you think you <span style="font-style: italic">do</span> have one, it's possible that the directory it's in isn't part of the directory list in the makefile. Check if the directory with the source files is in the SOURCES variable in the makefile. 
<br/>
<br/>
Sometimes it also helps to clean the project; dependencies between files can go wonky if you move stuff around and cleaning it will get rid of these dependencies.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#149477 - Cave Johnson - Sun Jan 20, 2008 8:35 pm</h4>
    <div class="postbody"><span class="postbody">Hmmmm, im pretty sure that i have the latest version of libnds, because i checked, and there are no updates for devkitpro.
<br/>
<br/>
The main() problem is also confusing me because i took the drunken coders logo main.cpp, and changed it slightly to fit my picture. Did i do something wrong during my time changing the code?
<br/>
<br/>
#include &lt;nds.h&gt;
<br/>
#include &lt;stdio.h&gt;
<br/>
<br/>
#include "colors_slot1.h"
<br/>
<br/>
int getSize(uint8 *source, uint16 *dest, uint32 arg) {
<br/>
	return *(uint32*)source;
<br/>
}
<br/>
<br/>
uint8 readByte(uint8 *source) {
<br/>
 	return *source;
<br/>
}
<br/>
TDecompressionStream colors_slot1_decomp = {
<br/>
  getSize,
<br/>
  NULL,
<br/>
  readByte
<br/>
};
<br/>
<br/>
int main(void) {
<br/>
	irqInit();
<br/>
	irqEnable(IRQ_VBLANK);
<br/>
<br/>
	videoSetMode(MODE_5_2D | DISPLAY_BG3_ACTIVE);
<br/>
<br/>
	videoSetModeSub(MODE_0_2D | DISPLAY_BG0_ACTIVE); 
<br/>
<br/>
                vramSetMainBanks(	VRAM_A_MAIN_BG_0x06000000, VRAM_B_LCD,
<br/>
						VRAM_C_SUB_BG , VRAM_D_LCD);
<br/>
<br/>
                SUB_BG0_CR = BG_MAP_BASE(31);
<br/>
<br/>
	BG_PALETTE_SUB[255] = RGB15(31,31,31);
<br/>
<br/>
               consoleInitDefault((u16*)SCREEN_BASE_BLOCK_SUB(31),  (u16*)CHAR_BASE_BLOCK_SUB(0), 16);
<br/>
<br/>
	iprintf("\n\n\tWelcome To\n");
<br/>
	iprintf("\tProject Satan\n");
<br/>
	iprintf("\t(Yes Its a Futurama Reference)");
<br/>
<br/>
	BG3_CR = BG_BMP16_256x256;
<br/>
<br/>
	BG3_XDX = 1 &lt;&lt; 8;
<br/>
	BG3_XDY = 0;
<br/>
	BG3_YDX = 0;
<br/>
	BG3_YDY = 1 &lt;&lt; 8;
<br/>
<br/>
	BG3_CX = 0;
<br/>
	BG3_CY = 0;
<br/>
<br/>
	swiDecompressLZSSVram((void*)colors_slot1Bitmap, BG_GFX, 0, &amp;colors_slot1_decomp);
<br/>
	while(1) swiWaitForVBlank();
<br/>
<br/>
	return 0;
<br/>
}
<br/>
<br/>
My simple project is turning out to be quite a doozey. Thanks.
<br/>
<br/>
EDIT: Upon trying out some other programs, i think my first and major problem is my environment. I know for a fact that i have the latest libnds, but i also have palib, could the problem be that it is trying to run everything through palib and not libnds, if so how do i fix this? Now for the main() problem. Here is a snippet of some code that i wrote to create the troublesome background:
<br/>
<br/>
#include &lt;nds.h&gt;
<br/>
#include "colors_slot1.h"
<br/>
<br/>
init main() {
<br/>
    iriqInit();
<br/>
    iriqSet (IRQ_VBLANK, 0);
<br/>
<br/>
    lcdMainOnBottom();
<br/>
    initVideo();
<br/>
    initBackgrounds();
<br/>
<br/>
    displaycolors_slot1();
<br/>
<br/>
    return 0;
<br/>
} 
<br/>
<br/>
Isn't this what is meant by main() function? Why is it not finding this?Thanks. (and yes i know i wrote the code before getting the grip file of the image, it is just an example of a similar code that is giving me the same error message)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#149487 - Cave Johnson - Sun Jan 20, 2008 11:47 pm</h4>
    <div class="postbody"><span class="postbody">Im getting closer, i fixed the initsystem problem, but the main() error still remains. So is the problem in the makefile, or embedded in the giant mass of code from my last post?</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
