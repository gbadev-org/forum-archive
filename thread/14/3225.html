<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>intro before game... - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Beginners > intro before game...</h2>
<div id="posts">
<div class="post">
    <h4>#19217 - darknet - Wed Apr 14, 2004 4:52 am</h4>
    <div class="postbody"><span class="postbody">A long time ago I posted a question involving button taps versus presses, and since I have used the code given to me to effectively differentiate between the two.
<br/>
<br/>
However, I am having an odd problem that I cannot seem to fix. I have 3 mini-games, each equipped with its own set of introduction screens. To shift through each intro screen, the user presses the 'A' button. However, the last intro screen goes directly into the game without caring about a prompt from the user. In another words, when I press 'A' on the 2nd of three intro screens, the third is quickly shown on the screen and the game is started. Rather, I would like to the game only to begin on the user's input on the third screen. Here the code in question:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void showDefenderIntro() {
<br/>
<br/>
   int previousButton, button, down, up;
<br/>
<br/>
   setMode(MODE_3 | BG2_ENABLE);
<br/>
   drawMode3Background(videoBuffer, defenderIntroOne_Bitmap);
<br/>
   waitForVSync();
<br/>
<br/>
    while(defend_state !=IN_DEFENDER) {
<br/>
<br/>
      button = *BUTTONS ^ 0x03ff;
<br/>
      down = button &amp; ~previousButton;   //pressed since last loop
<br/>
      up = previousButton &amp; ~button;    //released since last loop
<br/>
<br/>
      if( (down &amp; A_BUTTON) !=0) {
<br/>
<br/>
            switch(defend_state) {
<br/>
<br/>
               case SECOND_DEFENDER_INTRO:
<br/>
                  drawMode3Background(videoBuffer, defenderIntroTwo_Bitmap);
<br/>
                  defend_state = FINAL_DEFENDER_INTRO;
<br/>
                  break;
<br/>
<br/>
               case FINAL_DEFENDER_INTRO:
<br/>
                  drawMode3Background(videoBuffer, defenderIntroThree_Bitmap);
<br/>
                  defend_state = IN_DEFENDER;
<br/>
                  break;
<br/>
            }
<br/>
        }
<br/>
         previousButton = button;
<br/>
         waitForVSync();
<br/>
   }
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19219 - sgeos - Wed Apr 14, 2004 5:35 am</h4>
    <div class="postbody"><span class="postbody">First of all, the local variables (previousButton, button, down, up) are never initialized.  Second, it looks like there is a global variable, defend_state.  What is the value of defend_state at the onset of showDefenderIntro()?  When and how is it set to SECOND_DEFENDER_INTRO?
<br/>
<br/>
It seems to me that the above posted code could be a little better organized.  I'd make it look something like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void showDefenderIntro()
<br/>
{ 
<br/>
   // Declare variables here
<br/>
<br/>
   // Draw initial background
<br/>
   // initialize variables
<br/>
<br/>
   while(defend_state !=IN_DEFENDER) { 
<br/>
<br/>
      waitForVSync(); // Only called in one spot
<br/>
<br/>
      // Button updates here
<br/>
      previousButton = button; // This is button update code
<br/>
<br/>
      // Demo change on A_BUTTON here
<br/>
<br/>
   }
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
If it is assumed that the function exits during a vblank, I would keep the waitForVSync() calls as they are.
<br/>
<br/>
I did not step through the button logic, but it seems like different operations would need to be done to test for a press and a release?
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19230 - TheMikaus - Wed Apr 14, 2004 7:22 pm</h4>
    <div class="postbody"><span class="postbody">I'm currently at school, so I'm not entirely sure that the following will even compile but it looks right to me.  Again.  I just started so it might not work at all!  So sorry if I waste your time.  Oh and don't forget to insert the correct value for all ones as mine just has the text all ones.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void showDefenderIntro() { 
<br/>
<br/>
   int previousButton, down, up; 
<br/>
   
<br/>
   previousButton = *BUTTONS; //Get the value of the register (it's all 1's when up)
<br/>
<br/>
   down = 0;
<br/>
   up = 1;
<br/>
<br/>
   /*if it's all one's then it's all up and a ! on all 1's will give zero
<br/>
   which is false.   however a ! on not all ones will produce a value which is greater than zero (true).
<br/>
*/
<br/>
   if(!previousButton)
<br/>
   { 
<br/>
    down = 1;
<br/>
   up = 0;
<br/>
   }
<br/>
<br/>
<br/>
   setMode(MODE_3 | BG2_ENABLE); 
<br/>
   drawMode3Background(videoBuffer, defenderIntroOne_Bitmap); 
<br/>
   waitForVSync(); 
<br/>
<br/>
    while(defend_state !=IN_DEFENDER) { 
<br/>
<br/>
      previousButton = *BUTTONS;
<br/>
<br/>
     //If they are pressing something and they have released the keys
<br/>
      if(!previousButton &amp;&amp; up)
<br/>
   {
<br/>
      down = 1;
<br/>
   }            
<br/>
      //if all keys are up, set no keys pressed and up to true
<br/>
      else if(previousButton == (Whatever value all ones would be))
<br/>
      {
<br/>
         down = 0;
<br/>
         up = 1;
<br/>
      }
<br/>
<br/>
//if it was released and then pressed
<br/>
      if( (down &amp; up)) { 
<br/>
<br/>
            switch(defend_state) { 
<br/>
<br/>
               case SECOND_DEFENDER_INTRO: 
<br/>
                  drawMode3Background(videoBuffer, defenderIntroTwo_Bitmap); 
<br/>
                  defend_state = FINAL_DEFENDER_INTRO; 
<br/>
 
<br/>
//The button hasn't been released so tell the loop that
<br/>
        up = 0;
<br/>
                  break; 
<br/>
<br/>
               case FINAL_DEFENDER_INTRO: 
<br/>
                  drawMode3Background(videoBuffer, defenderIntroThree_Bitmap); 
<br/>
                  defend_state = IN_DEFENDER; 
<br/>
                  break; 
<br/>
            } 
<br/>
        } 
<br/>
<br/>
         waitForVSync(); 
<br/>
   } 
<br/>
} 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Again if it doesn't work.  Sorry.  Looks kinda ok to me.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19238 - MumblyJoe - Thu Apr 15, 2004 1:20 am</h4>
    <div class="postbody"><span class="postbody">Ok, I am going to make a couple of assumptions and give you a class I wrote the other day to solve a similar problem. I am assuming you can use C++ or at least read it well enough to get what it does. Basically you pass the ctor a key (a u16 representing the bit that key uses, should be in everyones shitty gba.h) and two callback functions with the second one (for up) bieng optional. Then go into a loop or whatever which calls the Check() member of the class. I just wrote this to solve a very simple problem where interrupts etc was unneccessary, and have found it pretty reliable. Oh, one other assumption, you have a pressed function (or macro if you wish) to test keys.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
class CallBack
<br/>
{
<br/>
    public:
<br/>
    typedef void(*voidvoid)();
<br/>
    CallBack(const u16 k,voidvoid down, voidvoid up=0)
<br/>
    :keyer(k),downer(down),upper(up),current(false){}
<br/>
    void Check()
<br/>
    {
<br/>
         if((Pressed(keyer)==true)&amp;&amp;(current==false))
<br/>
            {
<br/>
            if(downer)
<br/>
                downer();
<br/>
            current = true;
<br/>
            }
<br/>
         else
<br/>
             if((Pressed(keyer)==false)&amp;&amp;  (current==true))
<br/>
                 {
<br/>
                 if(upper)
<br/>
                     upper();
<br/>
                 current = false;
<br/>
                 }
<br/>
    }
<br/>
    private:
<br/>
    u16 keyer;
<br/>
    voidvoid upper;
<br/>
    voidvoid downer;
<br/>
    bool current;
<br/>
};
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/><a class="postlink" href="http://www.hungrydeveloper.com" target="_blank">www.hungrydeveloper.com</a>
<br/>
Version 2.0 now up - guaranteed at least 100% more pleasing!</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
