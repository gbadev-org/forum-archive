<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Read-In External Data - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Beginners > Read-In External Data</h2>
<div id="posts">
<div class="post">
    <h4>#52024 - Tomik - Thu Aug 25, 2005 4:38 pm</h4>
    <div class="postbody"><span class="postbody">Hello, thanks first for all the help! Everything works fine right now.
<br/>
<br/>
My next wish is ti bring an external SinusSignal into the GBA. Thatfore I use a ADC ! So I need:
<br/>
<br/>
1: A External Clock at my GBA SP (PHIP)
<br/>
2: A Adresse(A[23..16]) for reading in the 16-bits !
<br/>
<br/>
Can someone help me, with tipps or links with help inside ??
<br/>
<br/>
Thanks, Thomas (Hamburg/Germany)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#52027 - Tomik - Thu Aug 25, 2005 4:58 pm</h4>
    <div class="postbody"><span class="postbody">I forget to say I want to work iwith a multiplexed bus. how can i chhose this?
<br/>
<br/>
FG, T</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#52037 - tepples - Thu Aug 25, 2005 7:18 pm</h4>
    <div class="postbody"><span class="postbody">If <a class="postlink" href="http://www.charmedlabs.com/xport.htm" target="_blank">this</a> is still being sold, it's probably pretty close to what you want.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#52083 - Tomik - Fri Aug 26, 2005 7:47 am</h4>
    <div class="postbody"><span class="postbody">yes, i know, but i want to make it by myself.
<br/>
i want to make a non-gaming application.
<br/>
do you know how give a myself-defined Value to the A[16-23] pins, like 0xFF ??
<br/>
<br/>
Thomas</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#52101 - tepples - Fri Aug 26, 2005 6:12 pm</h4>
    <div class="postbody"><span class="postbody">The GBA cart bus protocol divides ROM into 128 KiB banks. Normally this is transparent to the programmer.
<br/>
<br/>
To set the A[16..23] pins to a given value, write to that numbered 128 KiB bank.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define KiB *1024
<br/>
#define READ_A16(x) (*(volatile u16 *)(0x08000000+(x)*(128 KiB)))
<br/>
<br/>
int x = READ_A16(0x23);
<br/>
int y = 0xF001;
<br/>
WRITE_A16(0x45) = y;
<br/>
</td> </tr></table><span class="postbody">
<br/>
It might prove easier to use the SRAM bus protocol, which puts an address on AD[0..15] and 8-bit data on A[16..23].
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define SRAM ((volatile u8 *)0x0E000000)</td> </tr></table><span class="postbody"><br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#52301 - Tomik - Mon Aug 29, 2005 2:33 pm</h4>
    <div class="postbody"><span class="postbody">thanks first, this is just for right understanding:
<br/>
..and yes, I need the 16bits for data, because the ADC is 12 Bit and I need them all !
<br/>
<br/>
#define KiB *1024 
<br/>
#define READ_A16(x) (*(volatile u16 *)(0x08000000+(x)*(128 KiB))) 
<br/>
<br/>
int x = READ_A16(0x23); 
<br/>
int y = 0xF001; 
<br/>
WRITE_A16(0x45) = y; 
<br/>
<br/>
you multiply to a "self-given" value (here: 0x23) the 128KB and add them to them GAME PAK Memory! READ_A16 = 0x08460000 .  the next possible Adress would be 0x08480000! right? 
<br/>
i just ask because i found a source code, where 256KB steps and not 
<br/>
128KB are made. that means half adress combinations !
<br/>
<br/>
for what is this:
<br/>
int y = 0xF001; 
<br/>
WRITE_A16(0x45) = y; 
<br/>
<br/>
thanks a lot for your help tepples !!
<br/>
<br/>
Thomas</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#52312 - Tomik - Mon Aug 29, 2005 4:27 pm</h4>
    <div class="postbody"><span class="postbody">..and the next question is:
<br/>
<br/>
How can I read in the Data from AD[0..15] ?
<br/>
I put this adress on A[16-23] in my MAIN-LOOP and then I want to put this 16Bit value in a register to work with it...but how ??
<br/>
<br/>
Thomas</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#52398 - tepples - Tue Aug 30, 2005 2:11 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Tomik wrote:</b></span></td> </tr> <tr> <td class="quote">thanks first, this is just for right understanding:
<br/>
..and yes, I need the 16bits for data, because the ADC is 12 Bit and I need them all !</td> </tr></table><span class="postbody">
<br/>
Can you put latches around the ADC so that 0x0E000000 gives part of the word and 0x0E000001 gives the other part?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">#define KiB *1024 
<br/>
#define READ_A16(x) (*(volatile u16 *)(0x08000000+(x)*(128 KiB))) 
<br/>
<br/>
int x = READ_A16(0x23); 
<br/>
int y = 0xF001; 
<br/>
WRITE_A16(0x45) = y; 
<br/>
<br/>
you multiply to a "self-given" value (here: 0x23) the 128KB and add them to them GAME PAK Memory! READ_A16 = 0x08460000 .  the next possible Adress would be 0x08480000! right?</td> </tr></table><span class="postbody">
<br/>
Yes.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">i just ask because i found a source code, where 256KB steps and not 
<br/>
128KB are made. that means half adress combinations !</td> </tr></table><span class="postbody">
<br/>
It might have been for controlling some specific on-cart circuitry that doesn't use A16.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">for what is this:
<br/>
int y = 0xF001; 
<br/>
WRITE_A16(0x45) = y; </td> </tr></table><span class="postbody">
<br/>
That writes 0x45 to A16-A23 and 0xF001 to AD0-AD15.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#52521 - Tomik - Wed Aug 31, 2005 2:05 pm</h4>
    <div class="postbody"><span class="postbody">what about question #1 ??
<br/>
how can i put the clock on the PHIP PIN ??
<br/>
<br/>
Thomas</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#52527 - Tomik - Wed Aug 31, 2005 3:35 pm</h4>
    <div class="postbody"><span class="postbody">unbelieveable .. i did find it by myself !!
<br/>
its Address: 0x4000204
<br/>
0123 4567 89AB CDEF
<br/>
<br/>
BC are the intersting ones, right ??
<br/>
what should i do with the rest ??
<br/>
<br/>
Thomas</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#52610 - Tomik - Thu Sep 01, 2005 11:12 am</h4>
    <div class="postbody"><span class="postbody">why does this NOT work ??
<br/>
<br/>
u16 *adresspointer = (u16*)0x4000204;  // 4MHz Output 
<br/>
adresspointer=0x0800;
<br/>
<br/>
Thomas</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#52611 - chishm - Thu Sep 01, 2005 11:46 am</h4>
    <div class="postbody"><span class="postbody">I'm pretty sure you have to dereference the address pointer using </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">*adresspointer=0x0800;</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#52615 - Tomik - Thu Sep 01, 2005 11:55 am</h4>
    <div class="postbody"><span class="postbody">yes that is correct, but do i have to do now ?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#52738 - Tomik - Fri Sep 02, 2005 5:03 pm</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
ok clock is working fine, but I still cannot readout my ADC.
<br/>
Do you know where I made the mistake??
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define KiB *1024
<br/>
#define READ_ADR(x) (*(volatile u16 *)(0x08000000+(x)*(128 KiB))) 
<br/>
<br/>
main{}
<br/>
<br/>
void Pixel(int *yArr)            // Plot current value and scroll
<br/>
{
<br/>
   int i;
<br/>
   int xAXIS=120;
<br/>
   
<br/>
   for(i=120; i&gt;0 ; i--)
<br/>
   {
<br/>
      PlotPixel(xAXIS,yArr[i],0x0000);
<br/>
      yArr[i-1]=yArr[i-2];
<br/>
      xAXIS=xAXIS-1;   
<br/>
   }
<br/>
   if(yArr[0])
<br/>
   {
<br/>
      ADC_CNT(yArr);
<br/>
   }
<br/>
}
<br/>
<br/>
void ADC_CNT(int *yArr)                     // move random value to yArr[0]
<br/>
{
<br/>
   int yValue;
<br/>
   int shiftadc;
<br/>
   int adcvalue = READ_ADR(0x4E);   
<br/>
   
<br/>
   shiftadc= adcvalue &lt;&lt; 5;
<br/>
<br/>
   yValue=(int) ((-0.923*shiftadc+140)+0.5);
<br/>
<br/>
   yArr[0]=yValue;
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#52977 - Tomik - Mon Sep 05, 2005 7:48 am</h4>
    <div class="postbody"><span class="postbody">..nobody can help me ???
<br/>
<br/>
Thomas / Hamburg</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#52982 - Tomik - Mon Sep 05, 2005 8:37 am</h4>
    <div class="postbody"><span class="postbody">this also doesnt work:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">u16* ReadADC =(u16*)0x089C0000;
<br/>
main{}
<br/>
void ADC_CNT(int *yArr)            
<br/>
{
<br/>
int adcvalue = *ReadADC;  
<br/>
......
<br/>
yArr[0]=yValue;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
why?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#53008 - Tomik - Mon Sep 05, 2005 1:43 pm</h4>
    <div class="postbody"><span class="postbody">@tepples:This does NOT work:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define KiB *1024
<br/>
#define READ_A16(x) (*(volatile u16 *)(0x08000000+(x)*(128 KiB)))
<br/>
<br/>
int x = READ_A16(0x23);
<br/>
</td> </tr></table><span class="postbody">
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Do you have another idea, or an idea why it doesn?t work ??
<br/>
<br/>
Thomas</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
