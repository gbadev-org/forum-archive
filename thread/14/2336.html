<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>When to use REG_BG#HOFS and REG_BG#VOFS - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > When to use REG_BG#HOFS and REG_BG#VOFS</h2>
<div id="posts">
<div class="post">
    <h4>#12442 - zdean - Thu Nov 13, 2003 8:07 pm</h4>
    <div class="postbody"><span class="postbody">Hello I am trying my first attempt at programming on the gba. I am confused as to when to use the background offsets such as REG_BG2HOFS. It seems that if I was using a background such as 2 and wanted the scrollable area to be any larger then 240X160 I would need to write functionality to move the new offscreen onto the screen and the old onscreen tiles off of the screen effectively creating a scrolling effect. So when is it usefull to use the bacground offsets for scrolling? Can these to techniques be used together to simplify scrolling? Thanks!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12443 - tepples - Thu Nov 13, 2003 8:23 pm</h4>
    <div class="postbody"><span class="postbody">Background offsets are the only way to scroll a text background by less than eight pixels at a time. Most GBA games that scroll a text background over several screens seem to replace only those tiles that will scroll into view in the next frame, creating a "seam" visible in VBA's Tile Viewer but invisible in the composited screen. You only need one 32x32 tile map per background to make this appear seamless.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12591 - zdean - Tue Nov 18, 2003 10:01 pm</h4>
    <div class="postbody"><span class="postbody">Thanks! That is probably why my scrolling seems choppy since I am moving in 8 pixels at a time instead of 1 or 2, but when I try to use the background offsets to scroll the screen contents down and then write in new tiles the new tiles seem to move down as well and I get a yellow or empty space filling up the screen? Any suggestions. Thanks</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12595 - tepples - Tue Nov 18, 2003 11:29 pm</h4>
    <div class="postbody"><span class="postbody">You have to write the new new tiles below the new tiles, and then the new new new tiles below the new new tiles. Please show a ROM or picture of what you're talking about; otherwise, I can only guess what you mean.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12612 - zdean - Wed Nov 19, 2003 4:38 pm</h4>
    <div class="postbody"><span class="postbody">OK,  It would be very helpful to have someone else take a quick look at this, because I am not sure if I am approaching the problem the correct way. I can send you the ROM and source code. How should I send it? Thanks again.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12616 - tepples - Wed Nov 19, 2003 6:02 pm</h4>
    <div class="postbody"><span class="postbody">Do you have a web site? Many people post things on a geocities (or the like) account for the forum regulars to read.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12624 - zdean - Wed Nov 19, 2003 9:29 pm</h4>
    <div class="postbody"><span class="postbody">It's not much of a website, but I do have a url on geocities that I use to upload files to sometimes. It is <a href="http://www.geocities.com/azdenek." target="_blank">www.geocities.com/azdenek.</a> I uploaded two files test.bin which is the ROM and tutor.c which is the main source code file. The source code file is basically the tile tutorial from the pern project website with some changes to attempt large map scrolling. Most of the changes and functionality for the scrolling are under the GetInput function. Currently only the up key uses my attempt at scrolling so most of the code that I am working on is in that area. If it would help I can upload the other files tiles, levels and sprite data files. If you run the ROM you can see that moving up will scroll through the other maps, but the background is choppy looking and does not scroll as smoothly as the when I use the bg offsets. However, I can not seem to figure out any other way to move new tiles into the screen. It could be that my method of scrolling is way off from how it should be done.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12625 - zdean - Wed Nov 19, 2003 9:31 pm</h4>
    <div class="postbody"><span class="postbody">Correction to above. It seems the period I put at the end of the sentence containing my url page is throwing off the link try this instead <a href="http://www.geocities.com/azdenek" target="_blank">www.geocities.com/azdenek</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12632 - sgeos - Thu Nov 20, 2003 12:25 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Background offsets are the only way to scroll a text background by less than eight pixels at a time. Most GBA games that scroll a text background over several screens seem to replace only those tiles that will scroll into view in the next frame, creating a "seam" visible in VBA's Tile Viewer but invisible in the composited screen. You only need one 32x32 tile map per background to make this appear seamless.</td> </tr></table><span class="postbody">
<br/>
<br/>
I've seen how this works.  Does anyone have or know of a good description of this algorithm?  Psuedocode is helpful.  I am not looking for something aimed at the GBA, a general description is better.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12636 - yaustar - Thu Nov 20, 2003 1:11 am</h4>
    <div class="postbody"><span class="postbody">I am confused a little, do you want to scroll the background layer or do you want to create a world that is larger then the maximum size layer (512x512 pixels)?
<br/>
<br/>
I am assuming the latter in which case the current method (from your bin) is wrong (although a damn good try).
<br/>
<br/>
I am working on thoery here so bare with me.
<br/>
<br/>
Basically when your characters reached the top, start scrolling the actual layer of the background. If you are using text backgrounds then they should wrap around nicely. Every eight pixels that you character moves, a row of tiles offscreen is edited for the contiuation of the map, then the row above it then etc.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
new tiles drawn = @
<br/>
old tiles = 0
<br/>
<br/>
00000000
<br/>
00000000
<br/>
00000000
<br/>
00000000
<br/>
00000000
<br/>
00000000
<br/>
00000000
<br/>
00000000
<br/>
<br/>
character moves up
<br/>
<br/>
00000000
<br/>
00000000
<br/>
00000000
<br/>
00000000
<br/>
00000000
<br/>
00000000
<br/>
00000000
<br/>
@@@@@@@@
<br/>
<br/>
and again
<br/>
<br/>
00000000
<br/>
00000000
<br/>
00000000
<br/>
00000000
<br/>
00000000
<br/>
00000000
<br/>
@@@@@@@@
<br/>
00000000
<br/>
<br/>
and again
<br/>
<br/>
00000000
<br/>
00000000
<br/>
00000000
<br/>
00000000
<br/>
00000000
<br/>
@@@@@@@@
<br/>
00000000
<br/>
00000000
<br/>
<br/>
you get the general idea.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
The best thing to do would be to look at a game that does this effect like Sum of All fears and look at it in the map on auto update whilst moving.<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12638 - sajiimori - Thu Nov 20, 2003 1:34 am</h4>
    <div class="postbody"><span class="postbody">How about this?  (Warning: untested, uncompiled, and possibly unclean)
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define SCREEN_WIDTH        240
<br/>
#define SCREEN_HEIGHT       160
<br/>
<br/>
#define TILE_WIDTH          8
<br/>
#define TILE_HEIGHT         8
<br/>
#define TILE_BORDER_MASK    7
<br/>
<br/>
#define SCREEN_X_TILES      (SCREEN_WIDTH/TILE_WIDTH)
<br/>
#define SCREEN_Y_TILES      (SCREEN_HEIGHT/TILE_HEIGHT)
<br/>
<br/>
// Size of physical tile map located in VRAM
<br/>
#define PMAP_WIDTH      32
<br/>
#define PMAP_HEIGHT     32
<br/>
<br/>
// Size of logical map (i.e. game world)
<br/>
#define LMAP_WIDTH      2048
<br/>
#define LMAP_HEIGHT     1024
<br/>
<br/>
typedef u16 Tile;
<br/>
<br/>
Tile* physical_map = HARDWARE_TILEMAP_ADDRESS;
<br/>
Tile logical_map[LMAP_WIDTH][LMAP_HEIGHT];
<br/>
<br/>
// Physical map offset (in pixels)
<br/>
int phys_x, phys_y;
<br/>
<br/>
// Logical map offset (in tiles)
<br/>
int log_x, log_y;
<br/>
<br/>
scroll_right_one_pixel()
<br/>
{
<br/>
    // If we went off the edge of the physical map,
<br/>
    // start back at the left.
<br/>
    if(++phys_x &gt;= PMAP_WIDTH * TILE_WIDTH)
<br/>
        phys_x = 0;
<br/>
<br/>
    // If we crossed a tile border, copy in a new
<br/>
    // column of tiles.
<br/>
    if(phys_x &amp; TILE_BORDER_MASK == 0)
<br/>
    {
<br/>
        // FIX: Doesn't check for edge of logical map
<br/>
        ++log_x;
<br/>
<br/>
        // Find the top tile in the physical map
<br/>
        int tile_x = phys_x / TILE_WIDTH + SCREEN_X_TILES;
<br/>
        int tile_y = phys_y / TILE_HEIGHT;
<br/>
<br/>
        // Wrap
<br/>
        if(tile_x &gt;= PMAP_WIDTH)
<br/>
            tile_x -= PMAP_WIDTH;
<br/>
<br/>
        // Copy strip of tiles from logical map to physical map
<br/>
        load_tile_column(&amp;logical_map[log_x + SCREEN_X_TILES][log_y],
<br/>
                         &amp;physical_map[tile_y*PMAP_WIDTH + tile_x]);
<br/>
    }
<br/>
}
<br/>
<br/>
load_tile_column(Tile* src, Tile* dst)
<br/>
{
<br/>
    Tile* end = src + LMAP_WIDTH * PMAP_HEIGHT;
<br/>
<br/>
    while(src &lt; end)
<br/>
    {
<br/>
        *src = *dst;
<br/>
        src += LMAP_WIDTH;
<br/>
        dst += PMAP_WIDTH;
<br/>
<br/>
        // This is slow.  There should really be 2 loops
<br/>
        // to avoid doing this check for every tile.
<br/>
        if(src &gt;= END_HW_TILEMAP)
<br/>
            src -= PMAP_WIDTH * PMAP_HEIGHT;
<br/>
    }
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Edit: Hopefully makes more sense now.
<br/>
Edit: Fixed more, shorter var names.
<br/>
Edit: Fixed column loader to not run off end of hw map.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12649 - zdean - Thu Nov 20, 2003 8:49 pm</h4>
    <div class="postbody"><span class="postbody">I think I found part of my problem. I am trying to use background 2 in mode 2 which seems to be a rotation bg. Should I be able to switch now to mode 0 without having to change a lot of the display code?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12650 - yaustar - Thu Nov 20, 2003 9:26 pm</h4>
    <div class="postbody"><span class="postbody">actually you are using mode 1, but yes since it is 256x256, going to mode 0 shouldn't be a problem<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
