<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Why is this a blank screen? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > Why is this a blank screen?</h2>
<div id="posts">
<div class="post">
    <h4>#8960 - yaustar - Fri Jul 25, 2003 12:49 am</h4>
    <div class="postbody"><span class="postbody">I was working on this code today and just get a blank screen.
<br/>
I dont think the sprites are being loaded in properly but I cant see anything wrong...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
// Project:  Lights-out clone
<br/>
// Author:   yaustar
<br/>
// Start:    23/07/2003
<br/>
// Modified: 25/07/2003
<br/>
<br/>
// Standard GBA headers
<br/>
#include "gba.h"
<br/>
#include "dispcnt.h"
<br/>
#include "modes.h"
<br/>
#include "sprites.h"
<br/>
<br/>
// Graphic files
<br/>
#include "g_lights_16.h"
<br/>
<br/>
// OAM variable
<br/>
u16* OAM = (u16*)0x7000000;
<br/>
<br/>
OAMEntry SPRITES[128];
<br/>
<br/>
// Defines for lights
<br/>
#define ON 0
<br/>
#define OFF 1
<br/>
<br/>
// Structure for sprite data
<br/>
typedef struct
<br/>
{
<br/>
    // X and Y is the position of sprite on screen
<br/>
    u16 x, y;
<br/>
    u16 OAMSpriteNum;
<br/>
    u16 spriteFrame[2];
<br/>
    bool activeFrame;
<br/>
}Sprite;
<br/>
<br/>
// 2D array of lights of size 5x5 (25 sprites) 
<br/>
Sprite allLights[5][5];
<br/>
<br/>
/*
<br/>
typedef struct
<br/>
{
<br/>
    // X and Y is current position on the light array
<br/>
    int X, Y;
<br/>
    u16 x, y, OAMSpriteNum, spriteFrame;    
<br/>
}noAniSprite;
<br/>
<br/>
// Sprite used for selecting lights
<br/>
noAniSprite selector;
<br/>
*/
<br/>
<br/>
// Copy sprite array into OAM
<br/>
void CopyOAM(void)
<br/>
{
<br/>
    u16 loop;
<br/>
    u16* temp;
<br/>
    temp = (u16*) SPRITES;
<br/>
    
<br/>
    for(loop = 0; loop &lt; 128*4; loop++)
<br/>
    {
<br/>
        OAM[loop] = temp[loop];
<br/>
    }
<br/>
}
<br/>
<br/>
// Set sprites off screen
<br/>
void initialiseSprites(void)
<br/>
{
<br/>
    u16 loop;
<br/>
    
<br/>
    for(loop = 0; loop &lt; 128; loop++)
<br/>
    {
<br/>
        SPRITES[loop].attribute0 = 160; // the y value
<br/>
        SPRITES[loop].attribute1 = 240; // the x value
<br/>
    }
<br/>
}
<br/>
<br/>
// Wait for the screen to stop drawing
<br/>
void WaitForVSync(void)
<br/>
{
<br/>
    while((volatile u16)REG_VCOUNT != 160)
<br/>
    {/*do nothing*/}
<br/>
}
<br/>
    
<br/>
/*============================================================================*/
<br/>
<br/>
// Start main code
<br/>
int main(void)
<br/>
{
<br/>
    u16 loop;
<br/>
    int temp = 0;
<br/>
    
<br/>
    // Put the lights in the right position on screen
<br/>
    for(int x=0; x&lt;5; x++)
<br/>
    {
<br/>
        for(int y=0; y&lt;5; y++)
<br/>
        {
<br/>
                allLights[x][y].y = y*32;
<br/>
                allLights[x][y].x = x*32;
<br/>
                allLights[x][y].activeFrame = OFF;
<br/>
                allLights[x][y].spriteFrame[0] = 0;
<br/>
                // 32x32 sprite uses 16 8x8 tiles
<br/>
                allLights[x][y].spriteFrame[1] = 16;
<br/>
                allLights[x][y].OAMSpriteNum = temp;
<br/>
                temp++;
<br/>
        }
<br/>
    }
<br/>
    
<br/>
/*    // Have the selector sprite by default on the top left of the 
<br/>
    // light array
<br/>
    selector.X = 0;
<br/>
    selector.Y = 0;
<br/>
    selector.OAMSpriteNum = 25;
<br/>
    selector.spriteFrame = 32;
<br/>
*/    
<br/>
    // Set screen mode to MODE 0, enable sprites using 1D mapping
<br/>
    SetMode(MODE_0 | OBJ_ENABLE | OBJ_MAP_1D);
<br/>
    
<br/>
    **EDIT**
<br/>
    // Loading the palette into memory
<br/>
    for(loop = 0; loop = 16; loop++)
<br/>
    {
<br/>
        OBJPaletteMem[loop] = palette[loop];
<br/>
    }
<br/>
    **END EDIT**    
<br/>
<br/>
    initialiseSprites();
<br/>
    
<br/>
    // Load Sprite data into memory
<br/>
    
<br/>
    // The OFF state of light
<br/>
    for(loop = 0; loop &lt; 256; loop++)
<br/>
    {
<br/>
        OAMData[loop] = g_OFF[loop];
<br/>
    }
<br/>
    // The ON state of light
<br/>
    for(loop = 256; loop &lt; 512; loop++)
<br/>
    {
<br/>
        OAMData[loop] = g_ON[loop - 256];
<br/>
    } 
<br/>
/*    // The SELECTOR sprite
<br/>
    for(loop = 512; loop &lt; 768; loop++)
<br/>
    {
<br/>
        OAMData[loop] = g_SELECT[loop - 512];
<br/>
    }
<br/>
*/   
<br/>
    // Attribute stuff
<br/>
    for(int x = 0; x &lt; 5; x++)
<br/>
    {
<br/>
        for(int y = 0; y &lt; 5; y++)
<br/>
        {
<br/>
            SPRITES[allLights[x][y].OAMSpriteNum].attribute0 = 
<br/>
              COLOR_16 | SQUARE | allLights[x][y].y;
<br/>
                 
<br/>
            SPRITES[allLights[x][y].OAMSpriteNum].attribute1 =
<br/>
              SIZE_32 | allLights[x][y].x;
<br/>
                   
<br/>
            SPRITES[allLights[x][y].OAMSpriteNum].attribute2 = 
<br/>
              allLights[x][y].spriteFrame[allLights[x][y].activeFrame];
<br/>
        }
<br/>
    }
<br/>
                                                                                                                                                   
<br/>
    while(1)
<br/>
    {
<br/>
        WaitForVSync();
<br/>
        CopyOAM();
<br/>
    }
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Thanks for any help
<br/>
<br/>
edit: Still a blank screen but in a colour that should be there<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8968 - yaustar - Fri Jul 25, 2003 2:51 am</h4>
    <div class="postbody"><span class="postbody">Sorry, my bad. A goddamn typo was the problem.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
**EDIT**
<br/>
    // Loading the palette into memory
<br/>
    for(loop = 0; loop = 16; loop++)
<br/>
    {
<br/>
        OBJPaletteMem[loop] = palette[loop];
<br/>
    }
<br/>
**END EDIT**
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
to
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
**EDIT**
<br/>
    // Loading the palette into memory
<br/>
    for(loop = 0; loop &lt; 16; loop++)
<br/>
    {
<br/>
        OBJPaletteMem[loop] = palette[loop];
<br/>
    }
<br/>
**END EDIT**
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
