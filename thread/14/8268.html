<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>New to the Scene - Big map question - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > New to the Scene - Big map question</h2>
<div id="posts">
<div class="post">
    <h4>#68554 - Chaotic Harmony - Wed Jan 25, 2006 5:53 pm</h4>
    <div class="postbody"><span class="postbody">Hi - I'm new to the GBA Dev scene. I've only been coding on it for about a week, so far I've just about managed to get sprites working and 128x128 tiled backgrounds. I've got a question about how to go about making bigger backgrounds than that.
<br/>
<br/>
Some background: I decided to get started by porting a simple game I made years ago to the GBA - a game I originally made in Qbasic, called "The Hunt". 
<br/>
<br/>
<a href="http://www.distractionware.com/wp-content/hunt.gif">[Images not permitted - Click here to view it]</a> &lt;- Screenshot
<br/>
<a class="postlink" href="http://www.distractionware.com/wp-content/hunt.zip" target="_blank">Click here to download (about 100KB, works in DOS and Windows)</a> &lt;- Game
<br/>
<br/>
It's a pretty simple game - nothing more that a few sprites, a scrolling background and some collision detection. Unfortunately, I've run into one technical problem - the game's map size is about 1500x20 (there's no vertical scrolling, just one big horizonal level).
<br/>
<br/>
Anyway, no doubt it's probably really easy to do, but I'm having trouble with making big maps. If I try to make a map buffer of even 32x32 tiles (256x256), I get an error from the comilper, saying something like that it's too big. It seems that I'm restricted to an array of 16x16, so I must be doing something wrong somewhere...
<br/>
<br/>
So basically I just want to know - how do you get really big arrays working? Do I have to split the map up and feed it into the tile memory? Am I doing something wrong? Is there an easier way to do it?
<br/>
<br/>
(I don't have the code on me right now, but I can bring it in tomorrow if nessicary... I'm hoping this is a kinda trivial problem that I can fix with one line...)<br/>_________________<br/><a class="postlink" href="http://www.distractionware.com" target="_blank">http://www.distractionware.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#68565 - poslundc - Wed Jan 25, 2006 6:45 pm</h4>
    <div class="postbody"><span class="postbody">When you say 32x32 tiles, do you mean 32x32 indices (single numbers) or a 32x32 set of 8x8 BGR pixel values?
<br/>
<br/>
If it's the latter, then you're definitely going to run out of memory. You only have 32K of fast (default) RAM, and an array of that size would consume 128K. You need to store your tiles in the ROM as const data, and load them directly into VRAM.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#68572 - Chaotic Harmony - Wed Jan 25, 2006 7:42 pm</h4>
    <div class="postbody"><span class="postbody">It's the former, I'm afraid... Both the map and the tiles are defined as unsigned chars.
<br/>
<br/>
What about this storing tiles in ROM as const data thing though? I haven't come across it before...<br/>_________________<br/><a class="postlink" href="http://www.distractionware.com" target="_blank">http://www.distractionware.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#68774 - Chaotic Harmony - Thu Jan 26, 2006 7:13 pm</h4>
    <div class="postbody"><span class="postbody">I still need a solution, and I've got my code with me today!
<br/>
<br/>
Alright, so stripping it down to what's absolutely essential:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include "gba\gba.h"
<br/>
#include "graphics\cars.h"
<br/>
<br/>
u8 tileSet[8*8*3] = {1,1,1,1,1,1,1,1,
<br/>
                               1,1,1,1,1,1,1,1,
<br/>
                               1,1,1,1,1,1,1,1,
<br/>
                               1,1,1,1,1,1,1,1,
<br/>
                               1,1,1,1,1,1,1,1,
<br/>
                               1,1,1,1,1,1,1,1,
<br/>
                               1,1,1,1,1,1,1,1,
<br/>
                               1,1,1,1,1,1,1,1,
<br/>
<br/>
                               2,2,2,2,2,2,2,2,
<br/>
                               2,2,2,2,2,2,2,2,
<br/>
                               2,2,2,2,2,2,2,2,
<br/>
                               2,2,2,2,2,2,2,2,
<br/>
                               2,2,2,2,2,2,2,2,
<br/>
                               2,2,2,2,2,2,2,2,
<br/>
                               2,2,2,2,2,2,2,2,
<br/>
                               2,2,2,2,2,2,2,2,
<br/>
<br/>
                               3,3,3,3,3,3,3,3,
<br/>
                               3,3,3,3,3,3,3,3,
<br/>
                               3,3,3,3,3,3,3,3,
<br/>
                               3,3,3,3,3,3,3,3,
<br/>
                               3,3,3,3,3,3,3,3,
<br/>
                               3,3,3,3,3,3,3,3,
<br/>
                               3,3,3,3,3,3,3,3,
<br/>
                               3,3,3,3,3,3,3,3};
<br/>
<br/>
u8 map[16*16] = {
<br/>
        1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
<br/>
        1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
<br/>
        1,0,3,0,3,0,3,3,3,0,3,0,0,0,0,1,
<br/>
        1,0,3,0,3,0,3,0,0,0,3,0,0,0,0,1,
<br/>
        1,0,3,3,3,0,3,3,0,0,3,0,0,0,0,1,
<br/>
        1,0,3,0,3,0,3,0,0,0,3,0,0,0,0,1,
<br/>
        1,0,3,0,3,0,3,3,3,0,3,3,3,0,0,1,
<br/>
        1,0,0,0,3,0,0,0,0,3,0,0,0,0,0,1,
<br/>
        1,0,0,0,3,0,0,0,3,0,3,0,0,0,0,1,
<br/>
        1,0,0,0,3,0,0,0,3,0,3,0,0,0,0,1,
<br/>
        1,0,0,0,3,0,0,0,3,0,3,0,0,0,0,1,
<br/>
        1,0,0,0,3,3,3,0,0,3,0,0,0,0,0,1,
<br/>
        1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
<br/>
        1,0,2,2,2,2,2,2,2,2,2,2,2,2,0,1,
<br/>
        1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
<br/>
        1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1};
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
That's how I'm defining my tiles and my 16x16 map. It's just a test until I can get the thing working.
<br/>
<br/>
Now here's how I'm implementing it:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
// ---- In main:
<br/>
        u16* vramMap = (u16*)SCREEN_BASE_BLOCK(31);
<br/>
        u16* vramTiles = (u16*)MAP_BASE_BLOCK(0);
<br/>
        u16* mapP = (u16*)map;
<br/>
        u16* tileSetP = (u16*)tileSet;
<br/>
<br/>
        REG_DISPCNT = MODE_2 | BG2_ENABLE | OBJ_ENABLE | OBJ_MAP_1D;
<br/>
        BGPaletteMem[0] = RGB16(0,0,0);
<br/>
        BGPaletteMem[1] = RGB16(0,8,16);
<br/>
        BGPaletteMem[2] = RGB16(0,16,31);
<br/>
        BGPaletteMem[3] = RGB16(31,0,0);
<br/>
<br/>
        //Initilise the Tiles
<br/>
        for(i=0; i&lt;16*16/2; i++) vramMap[i] = mapP[i];
<br/>
        for(i=0; i&lt;8*8*3/2; i++) vramTiles[i] = tileSetP[i];
<br/>
<br/>
        REG_BG2CNT = BG_COLOR_256 | ROTBG_SIZE_128x128
<br/>
                   | (31 &lt;&lt; SCREEN_SHIFT) | (0 &lt;&lt; CHAR_SHIFT);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Now, all this works perfectly. But say I go back to my "map" array, and change that to map[32*32] (and fill it out appropriatly), I get these error messages from the compiler, even if I leave all the other code untouched.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
arm-elf-gcc -I./ -Igba -mthumb-interwork -mthumb -O2 -Wall -c hunt.c -o hunt.o
<br/>
arm-elf-gcc -specs=gba.specs -mthumb-interwork -mthumb  hunt.o graphics/cars.o
<br/>
-o hunt.elf
<br/>
f:\coding\devkitpro\devkitarm\bin\..\lib\gcc\arm-elf\4.0.2\..\..\..\..\arm-elf\bin\ld.exe:
<br/>
address 0x30082f0 of hunt.elf section .data is not within region iwram
<br/>
f:\coding\devkitpro\devkitarm\bin\..\lib\gcc\arm-elf\4.0.2\..\..\..\..\arm-elf\bin\ld.exe:
<br/>
address 0x30082f0 of hunt.elf section .iwram0 is not within region iwram
<br/>
f:\coding\devkitpro\devkitarm\bin\..\lib\gcc\arm-elf\4.0.2\..\..\..\..\arm-elf\bin\ld.exe:
<br/>
address 0x30082f0 of hunt.elf section .iwram1 is not within region iwram
<br/>
f:\coding\devkitpro\devkitarm\bin\..\lib\gcc\arm-elf\4.0.2\..\..\..\..\arm-elf\bin\ld.exe:
<br/>
address 0x30082f0 of hunt.elf section .iwram2 is not within region iwram
<br/>
f:\coding\devkitpro\devkitarm\bin\..\lib\gcc\arm-elf\4.0.2\..\..\..\..\arm-elf\bin\ld.exe:
<br/>
address 0x30082f0 of hunt.elf section .iwram3 is not within region iwram
<br/>
f:\coding\devkitpro\devkitarm\bin\..\lib\gcc\arm-elf\4.0.2\..\..\..\..\arm-elf\bin\ld.exe:
<br/>
address 0x30082f0 of hunt.elf section .iwram4 is not within region iwram
<br/>
f:\coding\devkitpro\devkitarm\bin\..\lib\gcc\arm-elf\4.0.2\..\..\..\..\arm-elf\bin\ld.exe:
<br/>
address 0x30082f0 of hunt.elf section .iwram5 is not within region iwram
<br/>
f:\coding\devkitpro\devkitarm\bin\..\lib\gcc\arm-elf\4.0.2\..\..\..\..\arm-elf\bin\ld.exe:
<br/>
address 0x30082f0 of hunt.elf section .iwram6 is not within region iwram
<br/>
f:\coding\devkitpro\devkitarm\bin\..\lib\gcc\arm-elf\4.0.2\..\..\..\..\arm-elf\bin\ld.exe:
<br/>
address 0x30082f0 of hunt.elf section .iwram7 is not within region iwram
<br/>
f:\coding\devkitpro\devkitarm\bin\..\lib\gcc\arm-elf\4.0.2\..\..\..\..\arm-elf\bin\ld.exe:
<br/>
address 0x30082f0 of hunt.elf section .iwram8 is not within region iwram
<br/>
f:\coding\devkitpro\devkitarm\bin\..\lib\gcc\arm-elf\4.0.2\..\..\..\..\arm-elf\bin\ld.exe:
<br/>
address 0x30082f0 of hunt.elf section .iwram9 is not within region iwram
<br/>
"make": *** [hunt.elf] Error 1
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
It seems that that array is just too big for the game. Why is this? I'm new to this, so I don't know what I'm doing wrong...
<br/>
<br/>
I suspect I've got a "variable size" problem somewhere with the pointers, but when I fiddle around with them it messes up the display. This is the only way I've managed to get it working.
<br/>
<br/>
Any advice?<br/>_________________<br/><a class="postlink" href="http://www.distractionware.com" target="_blank">http://www.distractionware.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#68776 - poslundc - Thu Jan 26, 2006 7:27 pm</h4>
    <div class="postbody"><span class="postbody">Is the array in cars.h declared as const?
<br/>
<br/>
If not, it's going into IWRAM, and most likely blowing your stack.
<br/>
<br/>
Regardless, there's no reason (at least with your current design) for you to keep your map[] and tileSet[] in RAM, and it's a bad architecture to pursue on the GBA. They should be moved into ROM by declaring them const as well, and then copied directly from there into VRAM.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#68777 - wintermute - Thu Jan 26, 2006 7:29 pm</h4>
    <div class="postbody"><span class="postbody">The GBA has 256K of ewram, 32K of iwram and 32M of ROM.
<br/>
<br/>
With the default crtls initialised data goes into iwram, 
<br/>
<br/>
Data which will not be changed should be placed in ROM by declaring the arrays as const. This will include all your graphics data and probably all your maps.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#68784 - Chaotic Harmony - Thu Jan 26, 2006 7:48 pm</h4>
    <div class="postbody"><span class="postbody">Ah, I see... I didn't know about that, thanks :) I'll give that a try when I get home.<br/>_________________<br/><a class="postlink" href="http://www.distractionware.com" target="_blank">http://www.distractionware.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#68812 - tepples - Thu Jan 26, 2006 10:18 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">there's no reason (at least with your current design) for you to keep your map[] and tileSet[] in RAM, and it's a bad architecture to pursue on the GBA.</td> </tr></table><span class="postbody">
<br/>
Unless you want to make your program compatible with MBV2, XBOO, or GBA Movie Player. For this you use the "multiboot" setup file (-specs=gba_mb.specs), which automatically moves everything that would get put in ROM into EWRAM.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#68937 - Chaotic Harmony - Fri Jan 27, 2006 2:18 pm</h4>
    <div class="postbody"><span class="postbody">This fixed it - thanks a million!
<br/>
<br/>
I'll post more questions here when I inevitably have them.<br/>_________________<br/><a class="postlink" href="http://www.distractionware.com" target="_blank">http://www.distractionware.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#69390 - Chaotic Harmony - Mon Jan 30, 2006 2:33 pm</h4>
    <div class="postbody"><span class="postbody">Work on the game is progressing quite well - I've posted a screenshot and a ROM of what I've got done so far on my website:
<br/>
<br/>
<a class="postlink" href="http://www.distractionware.com/?p=43" target="_blank">http://www.distractionware.com/?p=43</a>
<br/>
<br/>
Still quite a bit to do, but I think it's coming along quite nicely.<br/>_________________<br/><a class="postlink" href="http://www.distractionware.com" target="_blank">http://www.distractionware.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#69748 - Chaotic Harmony - Wed Feb 01, 2006 5:31 pm</h4>
    <div class="postbody"><span class="postbody">I've got another problem - I was wondering if anyone could help.
<br/>
<br/>
Basically, while I managed to get a scrolling background working in ROT mode, I need a few extra tiles, so I've started converting to TEXT mode. The only thing is, I can't get the map to display, and I can't see what I'm doing wrong. I think I might be moving the screen data into vram in the wrong way, but I don't know how.
<br/>
<br/>
Here's the code, stripped down to what's relavent:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include "gba\gba.h"
<br/>
#include "graphics\cars.h"
<br/>
#include "graphics\tiles.h"
<br/>
#include "data\roaddata.h"
<br/>
<br/>
u8 screenmap[32*32];
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Just including all the graphics and defining a buffer to hold the screenblock entries.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void PlotTile(int x, int y, int t){
<br/>
  x = x&lt;&lt;1; y = y&lt;&lt;6; t=t&lt;&lt;2;
<br/>
        screenmap[x+y]=t;
<br/>
        screenmap[x+y+1]=t + 1;
<br/>
        screenmap[x+y+32]=t + 2;
<br/>
        screenmap[x+y+33]=t + 3;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I'm using 16x16 tiles, so I use this function to plot the 8x8 tiles onto the screenmap buffer. There's probably a better way to do it, but it works ok...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
//in main
<br/>
        u16* vramMap = (u16*)SCREEN_BASE_BLOCK(20);
<br/>
        u16* vramTiles = (u16*)MAP_BASE_BLOCK(0);
<br/>
        u16* screenmapP = (u16*)screenmap;
<br/>
<br/>
        REG_DISPCNT = MODE_0 | BG0_ENABLE | OBJ_ENABLE | OBJ_MAP_1D;
<br/>
<br/>
        //Filling Screenmap...
<br/>
        for(j=0; j&lt;10; j++){
<br/>
          for(i=0; i&lt;16; i++){
<br/>
                  PlotTile(i,j, map[xpos+i+(800*j))]); //Where 800 is the width of the map.
<br/>
          }
<br/>
  }
<br/>
<br/>
<br/>
        for(i=0; i&lt;512; i++) vramMap[i] = screenmapP[i]; //32*32/2
<br/>
        for(i=0; i&lt;9600; i++) vramTiles[i] = tilesData[i]; //8*8*256/2
<br/>
        for(i=0; i&lt;256; i++) BGPaletteMem[i] = tilesPalette[i];
<br/>
<br/>
        REG_BG0CNT = BG_COLOR_256 | TEXTBG_SIZE_256x256 |
<br/>
                     (20 &lt;&lt; SCREEN_SHIFT) | (0 &lt;&lt; CHAR_SHIFT);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I just get garbage on the screen when I do this. Any ideas why?<br/>_________________<br/><a class="postlink" href="http://www.distractionware.com" target="_blank">http://www.distractionware.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#69750 - poslundc - Wed Feb 01, 2006 5:54 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Chaotic Harmony wrote:</b></span></td> </tr> <tr> <td class="quote">I just get garbage on the screen when I do this. Any ideas why?</td> </tr></table><span class="postbody">
<br/>
<br/>
Text maps are not the same thing as rotational maps. <a class="postlink" href="http://user.chem.tue.nl/jakvijn/tonc/regbg.htm#sec-map" target="_blank">Read a tutorial</a> or <a class="postlink" href="http://www.cs.rit.edu/~tjh8300/CowBite/CowBiteSpec.htm#Backgrounds" target="_blank">look at the spec</a> to see how text backgrounds are formatted.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#69752 - Chaotic Harmony - Wed Feb 01, 2006 6:06 pm</h4>
    <div class="postbody"><span class="postbody">Oh - so basically text maps take up twice as much memory? 
<br/>
<br/>
I'm not at my home computer right now, so I can't try it out - just to be sure, will this adjustment work? (or have I got the wrong idea?)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
for(i=0; i&lt;512; i++){
<br/>
   vramMap[i*2] = 0;
<br/>
   vramMap[(i*2)+1] = screenmapP[i];
<br/>
}
<br/>
<br/>
//instead of
<br/>
for(i=0; i&lt;512; i++) vramMap[i] = screenmapP[i]; //32*32/2 
<br/>
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/><a class="postlink" href="http://www.distractionware.com" target="_blank">http://www.distractionware.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#69781 - poslundc - Wed Feb 01, 2006 9:01 pm</h4>
    <div class="postbody"><span class="postbody">The short answer is you're still going to have problems because vramMap is a u16 pointer and screenmapP is a u8 pointer, so your code is not correctly copying from one to the other.
<br/>
<br/>
Fix this problem, but a tip when doing so: upgrade both to u16 rather than down to u8, because VRAM has a special hardware quirk that makes 8-bit reads and writes work incorrectly.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#69788 - Chaotic Harmony - Wed Feb 01, 2006 10:18 pm</h4>
    <div class="postbody"><span class="postbody">That makes sense - I'll give it a try later. Thanks!<br/>_________________<br/><a class="postlink" href="http://www.distractionware.com" target="_blank">http://www.distractionware.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#69795 - tepples - Wed Feb 01, 2006 10:59 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Chaotic Harmony wrote:</b></span></td> </tr> <tr> <td class="quote">Oh - so basically text maps take up twice as much memory?</td> </tr></table><span class="postbody">
<br/>
Yes, but the <span style="font-style: italic">tile</span> data for a text background might take <span style="font-style: italic">less</span> memory because it's allowed to be 4 bit per pixel.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#69858 - Cearn - Thu Feb 02, 2006 1:05 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Chaotic Harmony wrote:</b></span></td> </tr> <tr> <td class="quote">Oh - so basically text maps take up twice as much memory?</td> </tr></table><span class="postbody">
<br/>
No .. well yes, but also no. Text maps are formatted differently than affine maps, and one of those differences happens to be that the screen entries are twice as big. 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Chaotic Harmony wrote:</b></span></td> </tr> <tr> <td class="quote">I'm not at my home computer right now, so I can't try it out - just to be sure, will this adjustment work? (or have I got the wrong idea?)
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">for(i=0; i&lt;512; i++){
<br/>
   vramMap[i*2] = 0;
<br/>
   vramMap[(i*2)+1] = screenmapP[i];
<br/>
}
<br/>
<br/>
//instead of
<br/>
for(i=0; i&lt;512; i++) vramMap[i] = screenmapP[i]; //32*32/2 
<br/>
</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
No that won't work, for a number of reasons. Firstly, screenmapP is a (u16*) pointer to a map that has 8bit screen entries. (poslundc, screenmap is (u8*), screenmap<span style="font-weight: bold">P</span> is (u16*)). When you start copying this to vramMap, you'll still compose one text screen entry (u16) out of two affine screen entries (u8), which is exactly why you're getting garbage now. The only difference with what you have now is that you'll also have zeroed out gaps between everything because of "vramMap[i*2]= 0;".
<br/>
<br/>
Text screen entries (SE) are 2 bytes long; their contents are a tile index plus extras. Affine screen entries (ASE) are 1 byte long, and only have a tile index. Which is exactly what you have now. So what you need to do is take that tile index of the ASE and use it to make SEs. You're close to doing that, just not quite there. 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">// u16 *vramMap;
<br/>
// u8  *screenmap;
<br/>
for(i=0; i&lt;32*32; i++)
<br/>
    vramMap[i] = screenmap[i];
<br/>
</td> </tr></table><span class="postbody">
<br/>
The implicit type-conversion between u8 and u16 take care of the format difference. This code gets rid of the garbage, but as the whole point was to be able to use more tiles, you'll have to create maps with more than 8 bits/entry anyway. 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">because VRAM has a special hardware quirk that makes 8-bit reads and writes work incorrectly. </td> </tr></table><span class="postbody">
<br/>
That's only for writes. Byte-reads work fine.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#69862 - Chaotic Harmony - Thu Feb 02, 2006 2:26 pm</h4>
    <div class="postbody"><span class="postbody">Well, I've got it working - thanks for the help everyone. This has been pretty educational!
<br/>
<br/>
I've got the text mode working (once I realised that you need to use 16bits instead of 8 for text mode, it became pretty obvious why what I was doing wouldn't work... doh) - I have more problems, but I've got an idea of how to approach it.
<br/>
<br/>
Incidently, here's what I've managed to accomplish so far:
<br/>
<br/>
<a class="postlink" href="http://www.distractionware.com/wp-content/02feb06/hunt.gba" target="_blank">{Click to download the ROM (68KB)}</a>
<br/>
<br/>
Considering I didn't know the first thing about GBA programming only a fortnight ago, I'm pretty chuffed with it :)<br/>_________________<br/><a class="postlink" href="http://www.distractionware.com" target="_blank">http://www.distractionware.com</a></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
