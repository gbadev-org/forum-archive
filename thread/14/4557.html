<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Small problem with sprite positioning - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > Small problem with sprite positioning</h2>
<div id="posts">
<div class="post">
    <h4>#30944 - identitycrisisuk - Mon Dec 06, 2004 3:16 pm</h4>
    <div class="postbody"><span class="postbody">This is kinda something you have to see so if anyone doesn't mind going <a class="postlink" href="http://www.geocities.com/matthewgriffinx/download.html" target="_blank">here</a> and downloading test.zip it'd be much appreciated. Basically what happens is when you've been walking for a little while and stop or if you turn around and the screen has room to move, the sprite for my guy kinda looks like he's sliding on the floor. It's only a few pixels, it's just about noticable on hardware and easier to see with an emulator, I think it's something to do with me creating the position and it being used on the next frame not that one or vice versa. This is the basics of my main loop:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">Player.Update();
<br/>
Background.Update(Player.Pos(), Player.Dir());
<br/>
Player.Draw(Background.Pos(), &amp;sprites[0], &amp;sprites[1]);
<br/>
<br/>
vsync();
<br/>
<br/>
CopyOAM();         //Copies sprite array into OAM.
<br/>
Player.UpdateFrames();</td> </tr></table><span class="postbody">
<br/>
<br/>
Player Update takes care of the collision detection and works out where the player is in the world at that point in time. The Background Update then takes in the Players position to work out where the top left corner of the screen is, does some things to make it move smoothly and updates any BG tiles that need it. I've called the next function draw but it's really just putting the correct data in to the OAM entries array, it works out the onscreen position of the sprite by doing: Character world position - Top left position of screen in world.
<br/>
<br/>
Then you've got the vsync thing, not a real function, just a macro for while(REG_VCOUNT != 160). Then copying of the OAM data and after that a function to copy the appropriate frames of the character to VRAM if a change in animation has taken place. I put this here as I was having some problems with when the frame would actually be loaded if it was before Vsync. Just reading back through what I've written it's becoming clearer that it must be something to do with the backgrounds being updated instantly but the sprites are done the frame after. I'm just not quite sure of how to rearrange my loop, is there a guide anywhere as to what you should do before and after the vsync check? Sorry if I've already got some things in stupid places, I've just been following the tutorials I looked at.<br/>_________________<br/></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">CanIKickIt(YES_YOU_CAN);</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
