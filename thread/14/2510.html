<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>__gba_multiboot - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > __gba_multiboot</h2>
<div id="posts">
<div class="post">
    <h4>#13649 - sgeos - Fri Dec 19, 2003 6:35 pm</h4>
    <div class="postbody"><span class="postbody">Can I use either of these to have DKA compile a multiboot game?
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int __gba_multiboot = 0;
<br/>
<br/>
void __gba_multiboot(void)
<br/>
{
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#13650 - tepples - Fri Dec 19, 2003 8:20 pm</h4>
    <div class="postbody"><span class="postbody">DKA will compile a multiboot program if you have a global variable called <span style="font-weight: bold">__gba_multiboot</span>. Your program will look like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int __gba_multiboot;
<br/>
<br/>
int main(void)
<br/>
{
<br/>
  /* init */
<br/>
  while(1)
<br/>
  {
<br/>
    /* loop */
<br/>
  }
<br/>
}</td> </tr></table><span class="postbody">
<br/>
I've never heard of anybody having a <span style="font-style: italic">function</span> called <span style="font-weight: bold">__gba_multiboot</span>.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#13673 - sgeos - Sat Dec 20, 2003 7:37 am</h4>
    <div class="postbody"><span class="postbody">I was wondering if <span style="font-weight: bold">__gba_multiboot</span> had to be in the namespace somewhere, or if it had to be a global variable.  Not that it really matters, but is an int's worth of RAM set aside for __gba_multiboot?
<br/>
<br/>
It seems to me that a function would have a higher chance of being optimized out-- not using up any space.  On the otherhand, it may take up more than an int's worth of ROM, which is really RAM in a multiboot program....
<br/>
<br/>
(On second thought, this probably should have been posted to coding...)
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#13674 - sajiimori - Sat Dec 20, 2003 7:48 am</h4>
    <div class="postbody"><span class="postbody">You're spending waaay too much time thinking about %0.001 of available RAM.  :-)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#13675 - sgeos - Sat Dec 20, 2003 9:16 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">You're spending waaay too much time thinking about %0.001 of available RAM.  :-)</td> </tr></table><span class="postbody">
<br/>
<br/>
I realize that. =)  Mutliboot programs only have (288 - program size - stack space) KB available though.  Admittedly, pushing so close to limits that one int will make or break the program is probably a bad thing.  To a certain extent I'm not asking how to get things to work, but rather how things work in general.
<br/>
<br/>
Does it matter where this global variable is listed in the source code?  Can it be the very last line?  (How things work question.)
<br/>
<br/>
It does not have to be an int, just a global variable?  Could it be a struct, a void pointer, or an array?  If so it seems to me that, with the help a macro, this space does not need to be wasted. =)
<br/>
<br/>
For example, it could be used for the state of the (an?) RNG.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#ifdef MULTIBOOT
<br/>
   #define rng_state __gba_multiboot
<br/>
   unsigned long __gba_multiboot = 0xA054FE33;
<br/>
#else
<br/>
   unsigned long rng_state = 0xA054FE33;
<br/>
#endif /* MULTIBOOT */</td> </tr></table><span class="postbody">
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#13679 - poslundc - Sat Dec 20, 2003 3:50 pm</h4>
    <div class="postbody"><span class="postbody">If you are so concerned about 4 bytes of RAM, then just go into the lnkscript and change it to always link for multiboot, regardless of the variable's presence.
<br/>
<br/>
Or, you could always actually use the __gba_multiboot variable to store a value in your program. To my knowledge, lnkscript only checks to see if it's defined, and doesn't care what the value is or what it's used for.
<br/>
<br/>
As was already mentioned, though, if 4 bytes of IWRAM (out of the 32,768 available) are that critical to you, then there is probably something wrong with your program.
<br/>
<br/>
Or how about this: if you can make your program work within 32,772 bytes of memory, then I will be happy to review your code for you and optimize out the four bytes of memory you need to get within the GBA's limits. :P
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#13687 - sgeos - Sat Dec 20, 2003 6:24 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">If you are so concerned about 4 bytes of RAM, then just go into the lnkscript and change it to always link for multiboot, regardless of the variable's presence.</td> </tr></table><span class="postbody">
<br/>
<br/>
Clearly I still don't know enough about link scripts.  I should fix that.  Feel free to just tell me to read up on linkscripts, but could I get it to link for multiboot if something like __GBA_MULTIBOOT is #defined?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">Or, you could always actually use the __gba_multiboot variable to store a value in your program. To my knowledge, lnkscript only checks to see if it's defined, and doesn't care what the value is or what it's used for.</td> </tr></table><span class="postbody">
<br/>
<br/>
See above with the rng_state example.  Thats what I'm doing.  I may go this route.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">Or how about this: if you can make your program work within 32,772 bytes of memory, then I will be happy to review your code for you and optimize out the four bytes of memory you need to get within the GBA's limits. :P</td> </tr></table><span class="postbody">
<br/>
<br/>
Then we might just need you to optimize out a little bit more so we can add a new feature. =P  Of course, all of this would be silly. =)
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#13700 - poslundc - Sun Dec 21, 2003 12:03 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sgeos wrote:</b></span></td> </tr> <tr> <td class="quote">Clearly I still don't know enough about link scripts.</td> </tr></table><span class="postbody">
<br/>
<br/>
Neither do I, but just from glancing through the DKA lnkscript file, it isn't very difficult to read or understand. Just look for sections where it checks to see if __gba_multiboot is defined and alter them to remove the conditional aspects.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#13715 - AcidGame - Sun Dec 21, 2003 7:52 am</h4>
    <div class="postbody"><span class="postbody">I think the HAM uses a simpler method..
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
MULTIBOOT
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
:P - But with DKA? No clue. :X</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#13725 - poslundc - Sun Dec 21, 2003 4:49 pm</h4>
    <div class="postbody"><span class="postbody">I've never looked at HAM, but I reckon MULTIBOOT is just a macro defined for int __gba_multiboot.
<br/>
<br/>
Correct me if I'm wrong.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#13782 - tom - Mon Dec 22, 2003 7:46 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sgeos wrote:</b></span></td> </tr> <tr> <td class="quote">Clearly I still don't know enough about link scripts.  I should fix that.  Feel free to just tell me to read up on linkscripts, but could I get it to link for multiboot if something like __GBA_MULTIBOOT is #defined?</td> </tr></table><span class="postbody">
<br/>
<br/>
no, that __gba_multiboot thing needs to be a symbol (not necessarily a variable, it could aswell be a function. haven't checked that, though) that the linker gets to see.
<br/>
<br/>
just defining a macro, like
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define __gba_multiboot
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
won't work. but as already explained, __gba_multiboot just needs to exist (so the linkscript knows you want to create a multiboot program), but isn't used for anything else, so you can use it for anything you want.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14330 - sgeos - Mon Jan 05, 2004 4:27 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tom wrote:</b></span></td> </tr> <tr> <td class="quote">that __gba_multiboot thing needs to be a symbol (not necessarily a variable, it could aswell be a function. haven't checked that, though) that the linker gets to see.</td> </tr></table><span class="postbody">
<br/>
<br/>
Does a function prototype (without a function to back it) create a symbol?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void __gba_multiboot(void);</td> </tr></table><span class="postbody">
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14331 - sajiimori - Mon Jan 05, 2004 4:40 am</h4>
    <div class="postbody"><span class="postbody">No, the linker never sees that.  It's only information for the compiler.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14334 - dagamer34 - Mon Jan 05, 2004 4:13 pm</h4>
    <div class="postbody"><span class="postbody">I doubt you will get close to the ~256kb mark in a mulitboot program. Its either over it or not.
<br/>
<br/>
Simplest thing to do in your code
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define MULITBOOT int __gba_multiboot = 0;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
And just use it like this
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
// At the top of the file
<br/>
#include "gba.h"
<br/>
MULTIBOOT
<br/>
<br/>
int main (void)
<br/>
{...}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
AND I am 100% sure if you are worrying about this, then you have 100% optimized all your other code. You haven't? ....Get to work!<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14361 - sajiimori - Mon Jan 05, 2004 8:49 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Simplest thing to do in your code 
<br/>
</td> </tr></table><span class="postbody">
<br/>
...would be to leave out your extrenuous line.
<br/>
<br/>
Anyway, as Brendan mentioned earlier, he is not so much interested in saving memory as understanding the way the compiler toolchain works.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14414 - sgeos - Tue Jan 06, 2004 4:45 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">Anyway, as Brendan mentioned earlier, he is not so much interested in saving memory as understanding the way the compiler toolchain works.</td> </tr></table><span class="postbody">
<br/>
<br/>
I am also trying to ask these questions so that another individual doesn't have to.  Thats what forums are all about.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14418 - sajiimori - Tue Jan 06, 2004 6:58 am</h4>
    <div class="postbody"><span class="postbody">Well I hope everybody doesn't start asking every question they think anyone might ever ask -- it could get mighty noisy!
<br/>
<br/>
It makes a bit more sense for people to ask about what they want to know.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#14471 - sgeos - Wed Jan 07, 2004 5:26 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">It makes a bit more sense for people to ask about what they want to know.</td> </tr></table><span class="postbody">
<br/>
<br/>
Of course, and I did want to know what I asked.  I did not have to ask my qustion in public.  The alternatives to asking in public are to ask in private, research or experiment.  Research and experimentation take time, and the results are not helpful to anybody else unless and until they are reported.
<br/>
<br/>
Asking in private is much like asking in public, only fewer people can offer input and the aswer can not be used by anyone else.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
