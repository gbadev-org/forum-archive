<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Using FRAS along with devKitPro (probably simple .lib stuff) - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Beginners > Using FRAS along with devKitPro (probably simple .lib stuff)</h2>
<div id="posts">
<div class="post">
    <h4>#92581 - Spaceface - Fri Jul 14, 2006 12:04 am</h4>
    <div class="postbody"><span class="postbody">At the moment I'm kinda having a problem getting FRAS to run on a devKitPro gba template. 
<br/>
<br/>
<span style="font-weight: bold">Problem:</span> I cannot seem to use lib files in my project. The makefiles in the templated don't seem to work for me.
<br/>
<br/>
<span style="font-weight: bold">Explanation:</span>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">&gt; "make" 
<br/>
linking cartridge
<br/>
audio.o: In function `main':
<br/>
c:/devkitPro/projects/gbarepos/Tests/audio/source/audio.c:25: undefined reference to `FrasInstall'
<br/>
c:/devkitPro/projects/gbarepos/Tests/audio/source/audio.c:26: undefined reference to `FrasPlayMod'
<br/>
collect2: ld returned 1 exit status
<br/>
make[1]: *** [/c/devkitPro/projects/gbarepos/Tests/audio/audio.elf] Error 1
<br/>
"make": *** [build] Error 2
<br/>
<br/>
&gt; Process Exit Code: 2
<br/>
&gt; Time Taken: 00:00
<br/>
</td> </tr></table><span class="postbody">This is what I get when I leave it at the default Makefile. Seems like a missing .lib file seeing there is no other file that refers to the function other than fras.lib.
<br/>
<br/>
Now when I look in the Makefile I see these lines (cutted out of file):
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#---------------------------------------------------------------------------------
<br/>
# any extra libraries we wish to link with the project
<br/>
#---------------------------------------------------------------------------------
<br/>
LIBS   := -lgba
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# list of directories containing libraries, this must be the top level containing
<br/>
# include and lib
<br/>
#---------------------------------------------------------------------------------
<br/>
LIBDIRS   :=   $(LIBGBA)
<br/>
<br/>
#---------------------------------------------------------------------------------
<br/>
# build a list of library paths
<br/>
#---------------------------------------------------------------------------------
<br/>
export LIBPATHS   :=   $(foreach dir,$(LIBDIRS),-L$(dir)/lib)
<br/>
</td> </tr></table><span class="postbody">Now it seems that whatever I put behind <span style="font-weight: bold">LIBGBA :=</span> would be considdered a path to a dir which contains a /lib dir. In my case that would make LIBGBA blank since the /lib dir is in the root of my dir (along with 'source','build' and 'include'). So then it looks like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">TARGET      :=   $(shell basename $(CURDIR))
<br/>
BUILD      :=   build
<br/>
SOURCES      :=   source
<br/>
DATA      :=   
<br/>
INCLUDES   :=   include   
<br/>
LIBGBA      :=
<br/>
</td> </tr></table><span class="postbody">And I change the -lgba to -lfras, I get this errorcode:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">&gt; "make" 
<br/>
linking cartridge
<br/>
c:\devkitpro\devkitarm\arm-eabi\bin\ld.real.exe: cannot find -lfras
<br/>
collect2: ld returned 1 exit status
<br/>
make[1]: *** [/c/devkitPro/projects/gbarepos/Tests/audio/audio.elf] Error 1
<br/>
"make": *** [build] Error 2
<br/>
<br/>
&gt; Process Exit Code: 2
<br/>
&gt; Time Taken: 00:00</td> </tr></table><span class="postbody">
<br/>
<br/>
I cannot seem to understand how this works since I'm not really familiar with Makefiles, though I have looked up stuff in many Makefiles. I hope someone. 
<br/>
<br/>
<span style="font-size: 9px; line-height: normal">The exact same goes for the MASO soundsystem, which uses a maso.a file instead of a .lib.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93042 - Spaceface - Sun Jul 16, 2006 6:43 pm</h4>
    <div class="postbody"><span class="postbody">bump.. anyone? :(
<br/>
I thought it was a rather simple issue.. isn't it?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93419 - wintermute - Wed Jul 19, 2006 1:30 am</h4>
    <div class="postbody"><span class="postbody">the option -lfras expects to find a library calld libfras.a somewhere in the lib paths set with -L.
<br/>
<br/>
The devkitPro makefiles are set up to expect directories specified in LIBDIRS to be absolute paths which is why we use variables there.
<br/>
<br/>
Make a folder in the devkitPro directory called fras, create include and lib folders inside that, copy the fras header(s) to include, fras.lib to lib and rename it to libfras.a. In the LIBDIRS variable add $(DEVKITPRO)/fras and -lfras to lib then your project should link - maybe.
<br/>
<br/>
The latest devkitARM uses the new eabi so it will complain about libraries built with older toolchains. There's a tool to remark the files on the devkitpro site - <a href="http://www.devkitpro.org/index.php?action=fullnews&amp;id=108" target="_blank">http://www.devkitpro.org/index.php?action=fullnews&amp;id=108</a><br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93546 - Spaceface - Wed Jul 19, 2006 8:42 pm</h4>
    <div class="postbody"><span class="postbody">Yay! Finally I got a bit closer.. However, I do get the eabi version error. I downloaded the tool, but it expects the resulting .o files and I only have the .a file as of now, which I can't find to convert. The result is this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">&gt; "make" 
<br/>
Country.c
<br/>
arm-eabi-gcc -MMD -MP -MF /c/devkitPro/projects/gbarepos/Tests/audio/build/Country.d -g -Wall -O3 -mcpu=arm7tdmi -mtune=arm7tdmi -fomit-frame-pointer -ffast-math -mthumb -mthumb-interwork -I/c/devkitPro/projects/gbarepos/Tests/audio/include -I/c/devkitPro/fras/include -I/c/devkitPro/projects/gbarepos/Tests/audio/build -c /c/devkitPro/projects/gbarepos/Tests/audio/source/Country.c -o Country.o
<br/>
audio.c
<br/>
arm-eabi-gcc -MMD -MP -MF /c/devkitPro/projects/gbarepos/Tests/audio/build/audio.d -g -Wall -O3 -mcpu=arm7tdmi -mtune=arm7tdmi -fomit-frame-pointer -ffast-math -mthumb -mthumb-interwork -I/c/devkitPro/projects/gbarepos/Tests/audio/include -I/c/devkitPro/fras/include -I/c/devkitPro/projects/gbarepos/Tests/audio/build -c /c/devkitPro/projects/gbarepos/Tests/audio/source/audio.c -o audio.o
<br/>
linking cartridge
<br/>
c:\devkitpro\devkitarm\arm-eabi\bin\ld.real.exe: ERROR: Source object c:/devkitPro/fras/lib\libfras.a(PlayMod.o) has EABI version 0, but target c:/devkitPro/projects/gbarepos/Tests/audio/audio.elf has EABI version 4
<br/>
c:\devkitpro\devkitarm\arm-eabi\bin\ld.real.exe: failed to merge target specific data of file c:/devkitPro/fras/lib\libfras.a(PlayMod.o)
<br/>
c:\devkitpro\devkitarm\arm-eabi\bin\ld.real.exe: ERROR: Source object c:/devkitPro/fras/lib\libfras.a(SoundVariables.o) has EABI version 0, but target c:/devkitPro/projects/gbarepos/Tests/audio/audio.elf has EABI version 4
<br/>
c:\devkitpro\devkitarm\arm-eabi\bin\ld.real.exe: failed to merge target specific data of file c:/devkitPro/fras/lib\libfras.a(SoundVariables.o)
<br/>
c:\devkitpro\devkitarm\arm-eabi\bin\ld.real.exe: ERROR: Source object c:/devkitPro/fras/lib\libfras.a(UpdateMixer.o) has EABI version 0, but target c:/devkitPro/projects/gbarepos/Tests/audio/audio.elf has EABI version 4
<br/>
c:\devkitpro\devkitarm\arm-eabi\bin\ld.real.exe: failed to merge target specific data of file c:/devkitPro/fras/lib\libfras.a(UpdateMixer.o)
<br/>
c:\devkitpro\devkitarm\arm-eabi\bin\ld.real.exe: ERROR: Source object c:/devkitPro/fras/lib\libfras.a(UpdateTick.o) has EABI version 0, but target c:/devkitPro/projects/gbarepos/Tests/audio/audio.elf has EABI version 4
<br/>
c:\devkitpro\devkitarm\arm-eabi\bin\ld.real.exe: failed to merge target specific data of file c:/devkitPro/fras/lib\libfras.a(UpdateTick.o)
<br/>
c:\devkitpro\devkitarm\arm-eabi\bin\ld.real.exe: ERROR: Source object c:/devkitPro/fras/lib\libfras.a(UpdateEffectTick0.o) has EABI version 0, but target c:/devkitPro/projects/gbarepos/Tests/audio/audio.elf has EABI version 4
<br/>
c:\devkitpro\devkitarm\arm-eabi\bin\ld.real.exe: failed to merge target specific data of file c:/devkitPro/fras/lib\libfras.a(UpdateEffectTick0.o)
<br/>
c:\devkitpro\devkitarm\arm-eabi\bin\ld.real.exe: ERROR: Source object c:/devkitPro/fras/lib\libfras.a(UpdateEffectBetweenTicks.o) has EABI version 0, but target c:/devkitPro/projects/gbarepos/Tests/audio/audio.elf has EABI version 4
<br/>
c:\devkitpro\devkitarm\arm-eabi\bin\ld.real.exe: failed to merge target specific data of file c:/devkitPro/fras/lib\libfras.a(UpdateEffectBetweenTicks.o)
<br/>
c:\devkitpro\devkitarm\arm-eabi\bin\ld.real.exe: ERROR: Source object c:/devkitPro/fras/lib\libfras.a(Install.o) has EABI version 0, but target c:/devkitPro/projects/gbarepos/Tests/audio/audio.elf has EABI version 4
<br/>
c:\devkitpro\devkitarm\arm-eabi\bin\ld.real.exe: failed to merge target specific data of file c:/devkitPro/fras/lib\libfras.a(Install.o)
<br/>
c:\devkitpro\devkitarm\arm-eabi\bin\ld.real.exe: ERROR: Source object c:/devkitPro/fras/lib\libfras.a(StartSound.o) has EABI version 0, but target c:/devkitPro/projects/gbarepos/Tests/audio/audio.elf has EABI version 4
<br/>
c:\devkitpro\devkitarm\arm-eabi\bin\ld.real.exe: failed to merge target specific data of file c:/devkitPro/fras/lib\libfras.a(StartSound.o)
<br/>
collect2: ld returned 1 exit status
<br/>
make[1]: *** [/c/devkitPro/projects/gbarepos/Tests/audio/audio.elf] Error 1
<br/>
"make": *** [build] Error 2
<br/>
<br/>
&gt; Process Exit Code: 2
<br/>
&gt; Time Taken: 00:01</td> </tr></table><span class="postbody">
<br/>
Now I've looked in devKitPro/fras/lib and the /build dir of my project, but I can't seem to find any resulted .o files.
<br/>
<br/>
Where can I find these, or does devKit cleans them?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93556 - wintermute - Wed Jul 19, 2006 9:53 pm</h4>
    <div class="postbody"><span class="postbody">The .o files it's complaining about are found in libfras.a. The change-eabi.sh script included in the change-eabi zip converts archives.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93599 - Spaceface - Thu Jul 20, 2006 1:04 am</h4>
    <div class="postbody"><span class="postbody">Ah that did it. Now where does it expect my newly, created .o files to be? in /build in either my project or fras dir didn't work, and also not in de lib and include dir...
<br/>
<br/>
(good luck this is the beginners forum, sheesh ;))</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93602 - wintermute - Thu Jul 20, 2006 1:24 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Spaceface wrote:</b></span></td> </tr> <tr> <td class="quote">Ah that did it. Now where does it expect my newly, created .o files to be? in /build in either my project or fras dir didn't work, and also not in de lib and include dir...
<br/>
<br/>
(good luck this is the beginners forum, sheesh ;))</td> </tr></table><span class="postbody">
<br/>
<br/>
I'm a bit lost, what isn't working now?<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93638 - Spaceface - Thu Jul 20, 2006 9:10 am</h4>
    <div class="postbody"><span class="postbody">Well I extracted several .o files from the .a file, so I think I can drop the .a file now (not sure though). But what should I do with the .o files? Where should they be place and how should I use them within my project(/makefile?) so that my project will pick up its functions?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93641 - wintermute - Thu Jul 20, 2006 9:41 am</h4>
    <div class="postbody"><span class="postbody">Well, that's what I was saying the change-eabi.sh script extracts the .o files from the archive, changes the eabi version and rebuilds the archive with the remarked object files. If you copy change-eabi.exe and change-eabi.sh somewhere in your path, open an msys shell, cd to the directory containing libfras.a and run change-eabi.sh there then the archive will be converted.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93758 - Spaceface - Fri Jul 21, 2006 1:26 am</h4>
    <div class="postbody"><span class="postbody">Yay! I got it working, finally! However it has some problems with .cpp files, whereas .c files don't have any problems. .cpp files can't seem to find the functions within the .a file. Any idea why this is? 
<br/>
<br/>
Either way, finally! Would've NEVER figured this one out by myself...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93760 - tepples - Fri Jul 21, 2006 1:54 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Spaceface wrote:</b></span></td> </tr> <tr> <td class="quote">.cpp files can't seem to find the functions within the .a file. Any idea why this is?</td> </tr></table><span class="postbody">
<br/>
If it's a name-mangling issue in a C++ program that uses a C library, then try this with the library's header file:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">extern "C" {
<br/>
  #include "someFile.h"
<br/>
}</td> </tr></table><span class="postbody"><br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93791 - Spaceface - Fri Jul 21, 2006 8:17 am</h4>
    <div class="postbody"><span class="postbody">Finally that did the job! Thank you guys so much! I know I asked much but I would've never figured these things out... Thanks again!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93816 - tepples - Fri Jul 21, 2006 1:41 pm</h4>
    <div class="postbody"><span class="postbody">Explanation of why it works:
<br/>
<br/>
C++ uses a different scheme for naming functions in object code files. This scheme, called "name mangling", allows for overloading of functions by argument number and type. Putting function prototypes in an extern "C" block disables name mangling for those prototypes.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93834 - Spaceface - Fri Jul 21, 2006 4:10 pm</h4>
    <div class="postbody"><span class="postbody">Ah, is that the same as how C and C++ differ in the way they define structs ?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#93849 - Cearn - Fri Jul 21, 2006 5:34 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Spaceface wrote:</b></span></td> </tr> <tr> <td class="quote">Ah, is that the same as how C and C++ differ in the way they define structs ?</td> </tr></table><span class="postbody">Nah, that's just C++ doing what everyone wanted C to do in the first place :P
<br/>
<br/>
Name mangling is what makes function overloading possible. For example, you might want func(int x) and and an overloaded version func(int x, int y). This would create problems in the object file because names have to be unique. C++ name mangling changes the names (internally) so that this problem is circumvented. For example, `void func(int x, int y)' will actually be called _Z7funcii. This works fine in C++ because when you call func(x,y), the compiler will know you mean _Z7funcii, based on the number and type of the arguments. This does not work fine when calling functions compiled in C, because those would still be called func in the object files. The `extern "C" ' tells the compiler that that particular function was defined in C, and won't apply the mangling when making the call.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
