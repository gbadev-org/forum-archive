<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>[resolved] memcpy from VRAM to user array crashing GBA - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > [resolved] memcpy from VRAM to user array crashing GBA</h2>
<div id="posts">
<div class="post">
    <h4>#154689 - biolizard89 - Sun Apr 20, 2008 10:36 am</h4>
    <div class="postbody"><span class="postbody">I have some hardware and libraries (Xport Botball Controller by Charmed Labs) which store an image in the GBA's VRAM (in Mode 3).  I'm trying to get that data out of VRAM into an array so that I can process it without leaving it in VRAM and without having to wait for a blank to access it.  Unfortunately, the memcpy is crashing my GBA.
<br/>
<br/>
My relevant code is:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define VideoBuffer    ((unsigned short *)0x6000000)
<br/>
<br/>
#define VCOUNT (*(volatile unsigned short *)0x04000006)
<br/>
#define vsync() while (VCOUNT != 160);
<br/>
<br/>
unsigned short current_frame[160][240];
<br/>
<br/>
draw_camera_frame(0, 0); // Get the video from FPGA into VRAM
<br/>
vsync(); // We can't read VRAM until a VBlank
<br/>
<br/>
// Works up to this point
<br/>
<br/>
// Crashes at this point
<br/>
memcpy(current_frame, VideoBuffer, 160*240*2); // Get the video from VRAM into RAM</td> </tr></table><span class="postbody">
<br/>
<br/>
I'm sure I'm doing something really stupid (I haven't programmed for GBA in several months, and I wasn't any good even then).  If I need to post more code, I'd be happy to; just let me know what you need to see.
<br/>
<br/>
Anyone have a clue what could be wrong?
<br/>
<br/>
Thanks.
<br/>
<br/>
EDIT: Never mind, I seem to have been a total idiot and forgotten about large arrays defaulting to IWRAM.  Disregard this post.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
