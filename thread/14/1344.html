<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>16 color sprites - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > 16 color sprites</h2>
<div id="posts">
<div class="post">
    <h4>#6710 - hnager - Mon Jun 02, 2003 4:25 am</h4>
    <div class="postbody"><span class="postbody">Hey all - I've been working at getting a 16 <b style="color:#FFA34F">color</b> <b style="color:#FFA34F">sprite</b> to simply display onscreen - I've had no problems with 256 <b style="color:#FFA34F">color</b> sprites, but decided to work with 16 colors because I have several variations of the sprites which could be handled with a palette swap.
<br/>
<br/>
So far my best result was a garbled square or red pixels - but at least it was properly positioned :)
<br/>
<br/>
That said - how does the process differ from 256 to 16 <b style="color:#FFA34F">color</b> <b style="color:#FFA34F">sprite</b>? Are there any examples floating around which anybody may point me toward?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6713 - niltsair - Mon Jun 02, 2003 4:58 am</h4>
    <div class="postbody"><span class="postbody">The difference is small.
<br/>
<br/>
Your <b style="color:#FFA34F">sprite</b> object must contains which palette to use.
<br/>
Now, instead of writing 2 pixels at a time, you write 4. -&gt; 3333 2222 1111 0000 Where 0,1,2,3 are the 3 pixel's colors.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6737 - hnager - Mon Jun 02, 2003 1:48 pm</h4>
    <div class="postbody"><span class="postbody">Well - here's what I have for main() -  this works fine with a 256 <b style="color:#FFA34F">color</b> palette (minus the palette in attribute2 and COLOR_256 | SQUARE as opposed to 16), but with 16 all I get is a block of red(ish) pixels at 10,10 - which is defined below in SpriteInit().
<br/>
<br/>
If this all seems correct, maybe the error was in converting the pcx? thanks.
<br/>
<br/>
<br/>
int main(){
<br/>
<br/>
	SetMode(MODE_1 | OBJ_ENABLE | OBJ_MAP_1D);
<br/>
<br/>
<b style="color:#FFA34F">Sprite</b> blob;
<br/>
<br/>
<br/>
	//load the palette/<b style="color:#FFA34F">sprite</b> into memory
<br/>
	DMA_Copy(3,(void*)blobPalette,(void*)OBJPaletteMem,16,DMA_16NOW);	
<br/>
	DMA_Copy(3,(void*)blobData,(void*)OAMData,384,DMA_16NOW);
<br/>
<br/>
	InitializeSprites();
<br/>
<br/>
...etc
<br/>
<br/>
<br/>
	SpriteInit((Sprite_ptr)&amp;blob,0,COLOR_16 | SQUARE,SIZE_16,10,10,0,0,0,0);
<br/>
<br/>
	sprites[0].attribute2 = 0 | PALETTE(0);
<br/>
<br/>
	while(1){
<br/>
<br/>
		WaitForVsync();		//waits for the screen to stop drawing	
<br/>
		CopyOAM();			//Copies <b style="color:#FFA34F">sprite</b> array into OAM.
<br/>
<br/>
	}
<br/>
<br/>
	return 0;
<br/>
}</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6741 - niltsair - Mon Jun 02, 2003 2:27 pm</h4>
    <div class="postbody"><span class="postbody">Did you re-exported your sprites tiles in 16colors?
<br/>
<br/>
Btw, you don't need your :  WaitForVsync();  CopyOAM(); inside your while loop, just put it before.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6742 - hnager - Mon Jun 02, 2003 2:30 pm</h4>
    <div class="postbody"><span class="postbody">I did indeed - I used gfx2gba and then converted those to .cpp with b2x .
<br/>
<br/>
Does the rest of it look right?
<br/>
<br/>
Here's the palette and a snippet of the data:
<br/>
<br/>
const u16 blobData[] = {
<br/>
 0x11,0x11,0x11,0x11,0x11,0x11,0x11,0x11,
<br/>
<br/>
...
<br/>
<br/>
 0x11,0xcf,0xcc,0xcc,0xfe,0xef,0xfa,0x11,
<br/>
 0x11,0xff,0xcc,0xee,0xff,0xcf,0xfa,0x11,
<br/>
 0x11,0xf1,0xef,0xfe,0xff,0xae,0x1d,0x11,
<br/>
 0x11,0xf1,0xff,0xff,0xff,0xdd,0x1f,0x11,
<br/>
 0x11,0x11,0x11,0x11,0x11,0x11,0x11,0x11
<br/>
};
<br/>
<br/>
const u16 blobPalette[] = {
<br/>
 0x00,0x00,0x00,0x00,0x84,0x10,0x08,0x21,
<br/>
 0xff,0x7f,0x8e,0x08,0x46,0x00,0x6a,0x00,
<br/>
 0xbb,0x32,0x7f,0x5b,0x4c,0x7f,0xa6,0x6e,
<br/>
 0x26,0x76,0xc6,0x6d,0x44,0x5d,0x04,0x55
<br/>
};</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6746 - niltsair - Mon Jun 02, 2003 2:44 pm</h4>
    <div class="postbody"><span class="postbody">Mmm, your arrays are declared as const u16 (which is ok) but the content are 8bits value(which is not).
<br/>
<br/>
This value 0xCF will means 0x00CF in 16bits. You'll need to tell gfx2Gba to output 16bits value directly. Or alternatively, declare them as 8bits arrays (aligned on 16bits bondaries) and use them as 16bits arrays (by casting).
<br/>
<br/>
This is your problem, you only get the Red <b style="color:#FFA34F">color</b> part, with part of the Green :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6747 - hnager - Mon Jun 02, 2003 3:04 pm</h4>
    <div class="postbody"><span class="postbody">good eye! I'll mess around will all those techniques...
<br/>
<br/>
Where would I do the casting for the array to u16? Using DMA_Copy I'm casting to void:
<br/>
<br/>
DMA_Copy(3,(void*)blobPalette,(void*)OBJPaletteMem,16,DMA_16NOW);	
<br/>
<br/>
would this take care of it?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6749 - niltsair - Mon Jun 02, 2003 3:22 pm</h4>
    <div class="postbody"><span class="postbody">Yep. (void*) means a pointer, it doesn't care which kind. And when you do DMA_16NOW, it mean to use the data as 16bits chunk. Thus 2 values of 8bits are joined together, forming a 16bits. 
<br/>
<br/>
You know, if the number of 16bits data to transfer is dividable by 2, then you can use DMA_32NOW instead, and have 1/2 the data to transfer. Like in your palette : DMA_Copy(3,(void*)blobPalette,(void*)OBJPaletteMem, 16/2 ,DMA_32NOW);</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6752 - hnager - Mon Jun 02, 2003 3:33 pm</h4>
    <div class="postbody"><span class="postbody">Thanks - it sounds as if that should 'fix' my problem.
<br/>
<br/>
If I wanted to swap palettes for a <b style="color:#FFA34F">sprite</b>, would i just change this ont he fly?
<br/>
<br/>
sprites[0].attribute2 = 0 | PALETTE(0); 
<br/>
<br/>
to on key press for example:
<br/>
<br/>
sprites[0].attribute2 = 0 | PALETTE(1); 
<br/>
<br/>
<br/>
?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6754 - niltsair - Mon Jun 02, 2003 3:42 pm</h4>
    <div class="postbody"><span class="postbody">exactly, and then recall the UpdateOAM() after a WaitVBlank()</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6755 - hnager - Mon Jun 02, 2003 3:49 pm</h4>
    <div class="postbody"><span class="postbody">No need to clear the old palette out of there? if I wanted to do something like:
<br/>
<br/>
<b style="color:#FFA34F">sprite</b>[0].attribute2 = <b style="color:#FFA34F">sprite</b>[0].attribute2 | PALETTE(1) wouldn't I need to clear it our first? If so, how so ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6756 - niltsair - Mon Jun 02, 2003 3:56 pm</h4>
    <div class="postbody"><span class="postbody">No need to clear it out first.
<br/>
<br/>
By using palette 1, it means it's gonna use <b style="color:#FFA34F">color</b> 16-31. Palette 2 = <b style="color:#FFA34F">color</b> 32-47, etc...
<br/>
<br/>
So, you could either load all of your palettes in 1 shot(loading 256 colors) or just when you need it, loading the colors to their proper place.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6801 - hnager - Mon Jun 02, 2003 11:42 pm</h4>
    <div class="postbody"><span class="postbody">I've finally had time to try this out - I'm definately closer, but not totally there. Now I get the correct palette displayed (yay!) - but the <b style="color:#FFA34F">sprite</b> image is all garbled (looks striped horizontally - similar to problems I had in MODE 4 a while back).
<br/>
<br/>
To me it seems as if it's related to my <b style="color:#FFA34F">sprite</b> data and how I'm copying it in to OAM:
<br/>
<br/>
DMA_Copy(3,(void*)blobData,(void*)OAMData,128,DMA_16NOW);
<br/>
<br/>
this is the data - does it seem suspect? the <b style="color:#FFA34F">sprite</b> is 16x16:
<br/>
<br/>
u8 blobData [] = {
<br/>
 0x11,0x11,0x11,0x11,0x11,0x11,0x11,0x11,
<br/>
 0x11,0x11,0x11,0x11,0x11,0x11,0x11,0x11,
<br/>
 0x11,0x11,0x11,0x11,0x16,0x11,0x11,0x11,
<br/>
 0x11,0x51,0x55,0x11,0x16,0x51,0x55,0x11,
<br/>
 0x11,0x31,0x77,0x11,0x16,0x71,0x37,0x11,
<br/>
 0x11,0x51,0x77,0x11,0x16,0x71,0x57,0x11,
<br/>
 0x11,0x31,0x77,0x41,0x46,0x71,0x37,0x11,
<br/>
 0x11,0x51,0x75,0x47,0x46,0x77,0x55,0x11,
<br/>
 0x11,0x31,0x77,0x64,0x66,0x74,0x37,0x11,
<br/>
 0x11,0x51,0x47,0x66,0x22,0x46,0x57,0x11,
<br/>
 0x11,0x31,0x47,0x66,0x22,0x46,0x37,0x11,
<br/>
 0x11,0x51,0x47,0x64,0x66,0x44,0x57,0x11,
<br/>
 0x11,0x31,0x77,0x41,0x44,0x71,0x37,0x11,
<br/>
 0x11,0x51,0x77,0x11,0x11,0x71,0x57,0x11,
<br/>
 0x11,0x11,0x11,0x11,0x11,0x11,0x11,0x11,
<br/>
 0x11,0x11,0x11,0x11,0x11,0x11,0x11,0x11
<br/>
};
<br/>
<br/>
Any help is appreciated - Howard</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6803 - tepples - Tue Jun 03, 2003 1:00 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>hnager wrote:</b></span></td> </tr> <tr> <td class="quote">this is the data - does it seem suspect? the <b style="color:#FFA34F">sprite</b> is 16x16</td> </tr></table><span class="postbody">
<br/>
For a 16x16 <b style="color:#FFA34F">sprite</b> in 1D mapping mode, each separate 8x8 pixel piece of the cel must be stored in one piece, with the tiles following from left to right, top to bottom.
<br/>
<br/>
I assume you're trying to do this:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">u8 blobData [] = {
<br/>
 0x11,0x11,0x11,0x11,  0x11,0x11,0x11,0x11,
<br/>
 0x11,0x11,0x11,0x11,  0x11,0x11,0x11,0x11,
<br/>
 0x11,0x11,0x11,0x11,  0x16,0x11,0x11,0x11,
<br/>
 0x11,0x51,0x55,0x11,  0x16,0x51,0x55,0x11,
<br/>
 0x11,0x31,0x77,0x11,  0x16,0x71,0x37,0x11,
<br/>
 0x11,0x51,0x77,0x11,  0x16,0x71,0x57,0x11,
<br/>
 0x11,0x31,0x77,0x41,  0x46,0x71,0x37,0x11,
<br/>
 0x11,0x51,0x75,0x47,  0x46,0x77,0x55,0x11,
<br/>
<br/>
 0x11,0x31,0x77,0x64,  0x66,0x74,0x37,0x11,
<br/>
 0x11,0x51,0x47,0x66,  0x22,0x46,0x57,0x11,
<br/>
 0x11,0x31,0x47,0x66,  0x22,0x46,0x37,0x11,
<br/>
 0x11,0x51,0x47,0x64,  0x66,0x44,0x57,0x11,
<br/>
 0x11,0x31,0x77,0x41,  0x44,0x71,0x37,0x11,
<br/>
 0x11,0x51,0x77,0x11,  0x11,0x71,0x57,0x11,
<br/>
 0x11,0x11,0x11,0x11,  0x11,0x11,0x11,0x11,
<br/>
 0x11,0x11,0x11,0x11,  0x11,0x11,0x11,0x11
<br/>
};</td> </tr></table><span class="postbody">
<br/>
<br/>
The GBA's actually looking for something like this:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">u8 blobData [] = {
<br/>
 0x11,0x11,0x11,0x11,  /* top left tile */
<br/>
 0x11,0x11,0x11,0x11,
<br/>
 0x11,0x11,0x11,0x11,
<br/>
 0x11,0x51,0x55,0x11,
<br/>
 0x11,0x31,0x77,0x11,
<br/>
 0x11,0x51,0x77,0x11,
<br/>
 0x11,0x31,0x77,0x41,
<br/>
 0x11,0x51,0x75,0x47,
<br/>
                0x11,0x11,0x11,0x11,  /* top right tile */
<br/>
                0x11,0x11,0x11,0x11,
<br/>
                0x16,0x11,0x11,0x11,
<br/>
                0x16,0x51,0x55,0x11,
<br/>
                0x16,0x71,0x37,0x11,
<br/>
                0x16,0x71,0x57,0x11,
<br/>
                0x46,0x71,0x37,0x11,
<br/>
                0x46,0x77,0x55,0x11,
<br/>
<br/>
 0x11,0x31,0x77,0x64,  /* bottom left tile */
<br/>
 0x11,0x51,0x47,0x66,
<br/>
 0x11,0x31,0x47,0x66,
<br/>
 0x11,0x51,0x47,0x64,
<br/>
 0x11,0x31,0x77,0x41,
<br/>
 0x11,0x51,0x77,0x11,
<br/>
 0x11,0x11,0x11,0x11,
<br/>
 0x11,0x11,0x11,0x11,
<br/>
                0x66,0x74,0x37,0x11,  /* bottom right tile */
<br/>
                0x22,0x46,0x57,0x11,
<br/>
                0x22,0x46,0x37,0x11,
<br/>
                0x66,0x44,0x57,0x11,
<br/>
                0x44,0x71,0x37,0x11,
<br/>
                0x11,0x71,0x57,0x11,
<br/>
                0x11,0x11,0x11,0x11,
<br/>
                0x11,0x11,0x11,0x11
<br/>
};</td> </tr></table><span class="postbody">
<br/>
<br/>
In addition, you should usually make your tile data 'const' so that it'll go into ROM.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6805 - hnager - Tue Jun 03, 2003 1:05 am</h4>
    <div class="postbody"><span class="postbody">That did the trick! Which graphics converter do you suggest to output that? What I had was a result of a gfx2gba exporting a raw file and then running that through b2x...Thanks again!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6809 - tepples - Tue Jun 03, 2003 1:49 am</h4>
    <div class="postbody"><span class="postbody">Actually, I wrote my own graphics converter, which you can find in the <a class="postlink" href="http://www.pineight.com/gba/#tod" target="_blank">TOD distribution</a>. It's called 'bmp2bg', but don't be confused by the name; it can also output sprite cel data, provided that the bitmap is as wide as the sprite cels.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6827 - Quirky - Tue Jun 03, 2003 7:45 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>hnager wrote:</b></span></td> </tr> <tr> <td class="quote">That did the trick! Which graphics converter do you suggest to output that? What I had was a result of a gfx2gba exporting a raw file and then running that through b2x...Thanks again!</td> </tr></table><span class="postbody">
<br/>
<br/>
Don't run the output of gfx2gba through a raw-&gt;C converter. It's a needless step, wastes time as each C needs compiling and, as you have seen, is likely to introduce bugs. If you have large sprites or lots of them then this approach will drive you mad.
<br/>
<br/>
A better method is to use objcopy - it creates the "compiled" .o directly from the raw data without doing the parsing checks that gcc would have to do on a .c file. It also gives you symbols to be able to access that data (start, end, size). Just link that .o into your binary instead of the .o produced from the .c file and you're away.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6840 - hnager - Tue Jun 03, 2003 11:58 am</h4>
    <div class="postbody"><span class="postbody">Would this eliminate the problem I was having with how the 16 color sprite was being copied? Now that I have one, I have 15 more in an animation that needs to be copied in...The good news is that my quick test of two palettes worked which is great because I don't need to copy those 16 sprites in more than once.
<br/>
<br/>
I'll do some hunting around for objcopy - anybody have any good examples on hand?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6845 - Quirky - Tue Jun 03, 2003 12:44 pm</h4>
    <div class="postbody"><span class="postbody">objcopy is included in devkit advance. It lives in the /bin directory so you should be able to use it right away.
<br/>
<br/>
What I do is have a line in my makefile that objcopy's raw/map/pal files to .o files:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
# create gcc object from map file
<br/>
%.map.all.rodata.o: %.map
<br/>
   @$(GCCARM)/objcopy -I binary -O elf32-little $&lt; $@
<br/>
      
<br/>
# create gcc object from raw binary file
<br/>
%.all.rodata.o: %.raw
<br/>
   @$(GCCARM)/objcopy -I binary -O elf32-little $&lt; $@
<br/>
<br/>
# create gcc object from palette file
<br/>
%.pal.all.rodata.o: %.pal
<br/>
   @$(GCCARM)/objcopy -I binary -O elf32-little $&lt; $@
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Then objcopy gives me a symbol in the .o that I can access from C like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
extern unsigned char _binary_filename_ext_start[];
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Where "unsigned char" could be replaced by 16 or 32 bit values or even structures, whatever is most suitable depending on the data type. That symbol name would be for a file called filename.ext that has been objcopied. More likely it would be a symbol something like _binary_master_pal_start for the default pallete name that gfx2gba spits out.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6852 - hnager - Tue Jun 03, 2003 2:08 pm</h4>
    <div class="postbody"><span class="postbody">Looks as if I'll have to step up my makefile skillz.
<br/>
<br/>
Currently I'm using the basic :
<br/>
<br/>
path=C:\GBA\bin
<br/>
g++  -o main.elf main.cpp  -lm
<br/>
objcopy -O binary main.elf day3.bin
<br/>
<br/>
pause
<br/>
<br/>
I'll do my best to use objcopy with the raw files - but I may aswell ask: Anybody willing to give up a sample project using objcopy? I'm looking for a 16 color sprite example (best case) - but I'll take any sprite copied in with this method.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
