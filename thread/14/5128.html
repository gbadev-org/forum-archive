<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Compiler not appending all of data file - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Beginners > Compiler not appending all of data file</h2>
<div id="posts">
<div class="post">
    <h4>#37123 - ymalik - Mon Mar 07, 2005 6:14 pm</h4>
    <div class="postbody"><span class="postbody">Hello,
<br/>
The following code appends two data files to the ROM:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   .global tiles
<br/>
   .global maps
<br/>
   .text
<br/>
   .align 4
<br/>
<br/>
maps:
<br/>
   .incbin "maps.dat"
<br/>
   
<br/>
   .align 4
<br/>
<br/>
tiles:
<br/>
   .incbin "tiles.dat"
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
maps.dat holds unsigned shorts, and tiles.dat holds unsigned chars.  The problem is that the compiler always reduces the size of tiles.dat.  For example, when tiles.dat is 4386624 bytes, I get a warning message that 4386623 bytes were read.  Even when tiles.dat is 1614784 bytes, I get a message saying that 1614781 bytes were read.  It never complains about maps.dat.  What's going on here?
<br/>
<br/>
Thanks,
<br/>
Yasir</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#37133 - tepples - Mon Mar 07, 2005 10:30 pm</h4>
    <div class="postbody"><span class="postbody">Does it help if you add another ".align 4" statement at the very end? If you do so, are the last few bytes of the included file corrupt?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#37220 - ymalik - Wed Mar 09, 2005 12:41 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Does it help if you add another ".align 4" statement at the very end?</td> </tr></table><span class="postbody">
<br/>
No.  What does .align 4 do, by the way.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
If you do so, are the last few bytes of the included file corrupt?</td> </tr></table><span class="postbody">
<br/>
I generated the binary files myself, and viewing them in a binary viewer, I see no corruption.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#40156 - ymalik - Fri Apr 15, 2005 2:31 pm</h4>
    <div class="postbody"><span class="postbody">As you know, I would be getting messages like
<br/>
data.s:6: Warning: truncated file `Tgr34031/tiles.dat', 6177050 of 6177052 bytes read
<br/>
<br/>
and I didn't think much of them.  The image data in tiles.dat was being rendered fine.  However, when I used other tiles.dat files, the a similar compiler warning would come up, and the image data would be corrupt.  I didn't pay any attention to the compiler warning and instead frantically tried to find a bug in my code.  Well, it turns out that arm-thumb-elf-as.exe is corrupting the data!  It is not corrupting the data at the end, but data at seemingly random places in the middle of tiles.dat.  This was revealed when we took a dump of memory of where tiles.dat was stored in the ROM and compared it to the actual tiles.dat file; there were differences.  When we filled those gaps with valid data, everything worked fine.
<br/>
<br/>
How can I get around this?  Is there a way to append tiles.dat to the ROM and still be able to point to it within the program?  For example, I have:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   .global tiles
<br/>
   .text
<br/>
   .align 4
<br/>
<br/>
tiles:
<br/>
   .incbin "Tgr34031/tiles.dat"
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
and in my actual code I refer to it as:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
extern const u8 tiles[];
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Much thanks,
<br/>
Yasir</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#40159 - tepples - Fri Apr 15, 2005 4:05 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ymalik wrote:</b></span></td> </tr> <tr> <td class="quote">Well, it turns out that arm-thumb-elf-as.exe is corrupting the data!</td> </tr></table><span class="postbody">
<br/>
Which toolchain distribution are you using? DevKit Advance called it arm-agb-elf-as.exe; the currently recommended devkitARM calls it arm-elf-as.exe.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Is there a way to append tiles.dat to the ROM and still be able to point to it within the program?</td> </tr></table><span class="postbody">
<br/>
Why certainly! Try <a class="postlink" href="http://www.pineight.com/gba/#gbfs" target="_blank">GBFS</a>.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#40163 - ymalik - Fri Apr 15, 2005 4:28 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Which toolchain distribution are you using? DevKit Advance called it arm-agb-elf-as.exe; the currently recommended devkitARM calls it arm-elf-as.exe.</td> </tr></table><span class="postbody">
<br/>
We're using HAM.  We do not want to switch to devkitARM because we are comfortable with HAM.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Why certainly! Try <a class="postlink" href="http://www.pineight.com/gba/#gbfs" target="_blank">GBFS</a>.</td> </tr></table><span class="postbody">
<br/>
Sorry, but we want to be able to do DMA fast copies from the ROM to memory.  We only have two weeks left, and I don't want to change my code to accomodate your file system.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#40166 - tepples - Fri Apr 15, 2005 4:51 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ymalik wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Try <a class="postlink" href="http://www.pineight.com/gba/#gbfs" target="_blank">GBFS</a>.</td> </tr></table><span class="postbody">
<br/>
Sorry, but we want to be able to do DMA fast copies from the ROM to memory.  We only have two weeks left, and I don't want to change my code to accomodate your file system.</span></td> </tr></table><span class="postbody">
<br/>
GBFS simply returns the address and length of data, which you can pass straight to dma_memcpy() or whatever.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#40169 - ymalik - Fri Apr 15, 2005 5:21 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">GBFS simply returns the address and length of data, which you can pass straight to dma_memcpy() or whatever.</td> </tr></table><span class="postbody">
<br/>
<br/>
Ok, maybe I can use it, but I would still prefer a way to add the data without using GBFS.</span><span class="gensmall"><br/><br/>Last edited by ymalik on Fri Apr 15, 2005 5:56 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#40170 - poslundc - Fri Apr 15, 2005 5:28 pm</h4>
    <div class="postbody"><span class="postbody">If the problem you're running into is with the sheer size of the files (as it seems it might be... your sample warning message is for nearly 6 MB of data), try breaking the data into multiple files with multiple symbol names instead of one really huge tiles[] array and see if that fixes your problem.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#40171 - ymalik - Fri Apr 15, 2005 5:54 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">If the problem you're running into is with the sheer size of the files (as it seems it might be... your sample warning message is for nearly 6 MB of data), try breaking the data into multiple files with multiple symbol names instead of one really huge tiles[] array and see if that fixes your problem.
<br/>
<br/>
Dan.</td> </tr></table><span class="postbody">
<br/>
<br/>
I am generating tiles.dat, and it can be of any size; it's simply a stream of chars.  tiles.dat represents the tile data of a county.  If I use a size of 744 KB, from a small county, I still get the same error:
<br/>
data.s:6: Warning: truncated file `Tgr34017/tiles.dat', 761396 of 761400 bytes read
<br/>
<br/>
<br/>
I don't want to split the file up--which may not help because the 744 KB file was still corrupted--because then I won't be able to refer to tiles.dat using one pointer.  It'll just change my code too much.
<br/>
<br/>
Note that in the two examples I gave, four bytes were corrupted.  However, when I used a file of 809 KB, I get the following error:
<br/>
data.s:6: Warning: truncated file `Tgr44001/tiles.dat', 827747 of 827756 bytes read</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#40180 - poslundc - Fri Apr 15, 2005 6:53 pm</h4>
    <div class="postbody"><span class="postbody">I've not used the .incbin directive so I can't say first-hand what could be causing your problem. A couple of ideas, though:
<br/>
<br/>
- If you are using multiple .incbins, make sure you are aligning both before and after each one.
<br/>
<br/>
- Maybe try a different section, like .data or .rodata.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#40189 - DekuTree64 - Fri Apr 15, 2005 7:43 pm</h4>
    <div class="postbody"><span class="postbody">I know I've seen that error before, and if I remember right, I broke up the data and it went away. 
<br/>
Another thing that caused weird problems was using .align 4 in the .rodata section. .align 2 actually aligns to 4 bytes, I think .align 4 is to 16 bytes. Looks like you're using .text though, so I don't think that would be it.
<br/>
<br/>
Have you tried GBFS? I've never used it, but it sounds like just what you need.
<br/>
Or you could use a tool called bin2o (get it from the tools section on the main site), which gives the data a label and section just like your assembly file would, without actually having to compile it.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#40190 - ymalik - Fri Apr 15, 2005 7:46 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">Maybe try a different section, like .data or .rodata.</td> </tr></table><span class="postbody">
<br/>
Where do .rodata and .data go?
<br/>
<br/>
When I think about it, Damian's GBFS looks more and more appealing.  Let me get this straight:
<br/>
- I will be able to point a u8 * object directly to the beginning of tiles.dat
<br/>
- Do DMA copies from the memory at the pointer to RAM
<br/>
??</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#40192 - tepples - Fri Apr 15, 2005 8:11 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>DekuTree64 wrote:</b></span></td> </tr> <tr> <td class="quote">Or you could use a tool called bin2o (get it from the tools section on the main site), which gives the data a label and section just like your assembly file would, without actually having to compile it.</td> </tr></table><span class="postbody">
<br/>
I could never get the "bin2o" wrappers around arm-elf-objcopy (or in HAM's case, arm-thumb-elf-objcopy) to handle alignment correctly. I often use the "bin2s" tool included in the GBFS package, which works as a compromise between converting to C and converting directly to .o. It doesn't take nearly as much time or RAM to compile a huge array from assembly language to .o as it does to compile the same array from C to .o.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ymalik wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">Maybe try a different section, like .data or .rodata.</td> </tr></table><span class="postbody">
<br/>
Where do .rodata and .data go?</span></td> </tr></table><span class="postbody">
<br/>
.data goes to IWRAM by default.
<br/>
.rodata goes to ROM in ROM builds or to EWRAM in multiboot builds.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">When I think about it, Damian's GBFS looks more and more appealing.</td> </tr></table><span class="postbody">
<br/>
Thank you.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Let me get this straight:
<br/>
- I will be able to point a u8 * object directly to the beginning of tiles.dat</td> </tr></table><span class="postbody">
<br/>
Correct. But if you're using 32-bit DMA, a u32 * is slightly safer. Still, GBFS guarantees that files will be at least 16-byte (128-bit) aligned, so you won't get alignment issues provided that you follow the instructions.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">- Do DMA copies from the memory at the pointer to RAM</td> </tr></table><span class="postbody">
<br/>
You can use DMA[3] to copy directly from ROM to IWRAM, EWRAM, VRAM, or the palette.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#40194 - ymalik - Fri Apr 15, 2005 8:22 pm</h4>
    <div class="postbody"><span class="postbody">Now, how big can the data file be?  Passaic County is about 2.5 MB and is 197 mi^2.  The largest county in NJ is Burlington County which is 805 mi^2, so you can figure that to be about 10 MB.  Of course, there are counties in other states that are ten times the size of Burlington County.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#40195 - poslundc - Fri Apr 15, 2005 8:27 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ymalik wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">Maybe try a different section, like .data or .rodata.</td> </tr></table><span class="postbody">
<br/>
Where do .rodata and .data go?</span></td> </tr></table><span class="postbody">
<br/>
.data goes to IWRAM by default.
<br/>
.rodata goes to ROM in ROM builds or to EWRAM in multiboot builds.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Whoops... don't use .data then. :|
<br/>
<br/>
(What can I say... it's been a long time since I've done this.)
<br/>
<br/>
IIRC, the .rodata section gets appended after the .text section. But I'd check for yourself, since clearly my memory is fuzzy.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#40239 - ymalik - Sat Apr 16, 2005 3:43 pm</h4>
    <div class="postbody"><span class="postbody">Here's what I've done
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
static u8 *tiles;
<br/>
<br/>
int main()
<br/>
{
<br/>
...
<br/>
   u32 txt_left;
<br/>
   const GBFS_FILE *dat = find_first_gbfs_file(find_first_gbfs_file);
<br/>
<br/>
   tiles = gbfs_get_obj(dat, "tiles.dat", &amp;txt_left);
<br/>
...
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Originally tiles was declared as
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
extern const u8 tiles[];
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I figured that just adding those three lines would all that I would have to change my code.  libgbfs.o is at the end of the linking order.
<br/>
<br/>
Here's how I ran gbfs:
<br/>
$ gbfs tiles.gbfs tiles.dat
<br/>
$ cat gbagps.gba Tgr44001/tiles.gbfs &gt; gbagps.gba
<br/>
<br/>
When I run gbagps.gba, all I see is a white screen.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#40241 - tepples - Sat Apr 16, 2005 4:00 pm</h4>
    <div class="postbody"><span class="postbody">Are you checking for NULL pointer result? If find_first_gbfs_file() returns NULL, then you have one error. If gbfs_get_obj() returns NULL, then you have a completely different error. You could try clearing the screen and freezing if you get a NULL pointer, using a different color for each type of error.
<br/>
<br/>
And may I see your build script, specifically everything that happens from 'objcopy' onward?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#40263 - ymalik - Sat Apr 16, 2005 9:59 pm</h4>
    <div class="postbody"><span class="postbody">I am using HAM's makefiles, so they are too big to post.  Instead, I have uploaded them here:
<br/>
<a href="http://www.cs.stevens.edu/~ymalik/master.mak" target="_blank">http://www.cs.stevens.edu/~ymalik/master.mak</a>
<br/>
<a href="http://www.cs.stevens.edu/~ymalik/standard-targets.mak" target="_blank">http://www.cs.stevens.edu/~ymalik/standard-targets.mak</a>
<br/>
<a href="http://www.cs.stevens.edu/~ymalik/makefile" target="_blank">http://www.cs.stevens.edu/~ymalik/makefile</a>
<br/>
<br/>
And yes, find_first_gbfs_file() and gbfs_get_obj() return NULL.  What do you mean by "using a different color for each type of error?"</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#40268 - tepples - Sat Apr 16, 2005 11:06 pm</h4>
    <div class="postbody"><span class="postbody">If find_first_gbfs_file() returns NULL, then you have not appended the file correctly. That is why I wanted to see your make file, batch file, or other build process, so I could help you debug why the appended file isn't being found.
<br/>
<br/>
By "use a different color for each type of error", I was referring to clearing the screen to a solid color on a fatal error that occurs before you have a chance to load a font.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#40273 - ymalik - Sat Apr 16, 2005 11:52 pm</h4>
    <div class="postbody"><span class="postbody">The makefile is how I'm building the ROM, and I'm just using these instructions to append the tiles.dat to the ROM.:
<br/>
$ gbfs tiles.gbfs tiles.dat
<br/>
$ cd ..
<br/>
$ cat gbagps.gba Tgr44001/tiles.gbfs &gt; gbagps.gba</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#40274 - tepples - Sun Apr 17, 2005 12:13 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ymalik wrote:</b></span></td> </tr> <tr> <td class="quote">The makefile is how I'm building the ROM, and I'm just using these instructions to append the tiles.dat to the ROM.:
<br/>
$ <span style="font-weight: bold"># No objcopy or padbin line shown</span>
<br/>
$ gbfs tiles.gbfs tiles.dat
<br/>
$ cd ..
<br/>
$ cat <span style="font-weight: bold">gbagps.gba</span> Tgr44001/tiles.gbfs &gt; <span style="font-weight: bold">gbagps.gba</span></td> </tr></table><span class="postbody">
<br/>
I see two problems with this. For one thing, I didn't see a 'padbin' line. GBFS searches for the start of appended data on 256-byte boundaries, and if you simply concatenate your program and the GBFS file, it won't find the GBFS file unless the size of the program is a multiple of 256 bytes. From the manual: </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">const GBFS_FILE *find_first_gbfs_file(const void *start);
<br/>
  Finds the first GBFS file after start.  Note that this does a
<br/>
  slow linear search at 256-byte strides, so make sure that your
<br/>
  files are aligned to 256-byte boundaries and that you pass a start
<br/>
  location close to (but not past) the beginning of the GBFS file.
<br/>
</td> </tr></table><span class="postbody">
<br/>
In addition, I'm not familiar with the semantics of the interaction between the 'cat' command and stdout redirection in UNIX. Are you allowed to redirect standard output to the same name as one of the input files?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#40283 - ymalik - Sun Apr 17, 2005 1:18 am</h4>
    <div class="postbody"><span class="postbody">The call to padbin did it.  Your program has been a life saver.  Much thanks for your contributions to the GBA community; it is very much appreciated.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
In addition, I'm not familiar with the semantics of the interaction between the 'cat' command and stdout redirection in UNIX. Are you allowed to redirect standard output to the same name as one of the input files?</td> </tr></table><span class="postbody">
<br/>
Yes you can.  Unix does not give you a warning.  However, I am using MSYS, and it does give you a warning.  However, cat does not work with binary files.  I had to use copy from the DOS command prompt.
<br/>
<br/>
Regards,
<br/>
Yasir</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#40288 - crossraleigh - Sun Apr 17, 2005 2:09 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Yes you can.</td> </tr></table><span class="postbody">
<br/>
No, you can't. That's why <span style="font-style: italic">wc file</span> reports zero, zero, and zero after <span style="font-style: italic">cat file &gt; file</span>. Try this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">cat gbagps.gba Tgr44001/tiles.gbfs &gt; tmp
<br/>
mv tmp gbagps.gba
<br/>
rm -f tmp
<br/>
</td> </tr></table><span class="postbody">
<br/>
_________________
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">However, cat does not work with binary files.</td> </tr></table><span class="postbody">
<br/>
Yes, it does. Run <span style="font-style: italic">echo -en "\xDE\xAD\xBE\xEF" &gt; file</span> and <span style="font-style: italic">cat file &gt; newfile</span>, then <span style="font-style: italic">hexdump newfile</span>.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#40293 - tepples - Sun Apr 17, 2005 2:54 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>crossraleigh wrote:</b></span></td> </tr> <tr> <td class="quote">Try this:
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">cat gbagps.gba Tgr44001/tiles.gbfs &gt; tmp
<br/>
mv tmp gbagps.gba
<br/>
rm -f tmp
<br/>
</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
Almost. I would have named the original binary "gbagps_naked.gba" and done 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">cat gbagps.gba Tgr44001/tiles.gbfs &gt; tmp</td> </tr></table><span class="postbody">
<br/>
leaving the 'mv' and 'rm' steps as part of 'make clean'. Once you go beyond simple batch files to more complex projects, you'll find that naming the output file of a build step differently from the input file is nicer to automated dependency management tools such as GNU Make.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>crossraleigh wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">However, cat does not work with binary files.</td> </tr></table><span class="postbody">
<br/>
Yes, it does. Run <span style="font-style: italic">echo -en "\xDE\xAD\xBE\xEF" &gt; file</span> and <span style="font-style: italic">cat file &gt; newfile</span>, then <span style="font-style: italic">hexdump newfile</span>.</span></td> </tr></table><span class="postbody">
<br/>
But that's an ISO Latin-1 file, not a binary file. How about doing the same thing, but starting with <span style="font-style: italic">echo -en "\x0D\x0A\x1A\x00\x0A" &gt; file</span>?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#40296 - ymalik - Sun Apr 17, 2005 3:28 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>crossraleigh wrote:</b></span></td> </tr> <tr> <td class="quote">No, you can't.</td> </tr></table><span class="postbody">
<br/>
I have NetBSD, and no error message is generated.  However, the output is not correct, of course.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>crossraleigh wrote:</b></span></td> </tr> <tr> <td class="quote">Yes, it does. Run <span style="font-style: italic">echo -en "\xDE\xAD\xBE\xEF" &gt; file</span> and <span style="font-style: italic">cat file &gt; newfile</span>, then <span style="font-style: italic">hexdump newfile</span>.</td> </tr></table><span class="postbody">
<br/>
Yeah, I was wondering why cat wasn't working with the binary file, because I remeber I had concatenated the files generated from <a class="postlink" href="http://www.dekabyte.com/filesplitter/" target="_blank">The File Splitter</a> before in NetBSD; I was using cat incorrectly.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#40297 - crossraleigh - Sun Apr 17, 2005 3:41 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">But that's an ISO Latin-1 file, not a binary file. How about doing the same thing, but starting with echo -en "\x0D\x0A\x1A\x00\x0A" &gt; file?</td> </tr></table><span class="postbody">
<br/>
OK, bad example. Point is that cat will copy the file to stdout regardless of wether the terminal can display it. Yes, your example works also.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#40952 - ymalik - Sat Apr 23, 2005 10:34 pm</h4>
    <div class="postbody"><span class="postbody">I used the the following commands to create append two GBFS files:
<br/>
copy /b gbagps.gba+map_data.gbfs gbagps.gba
<br/>
copy /b gbagps.gba+gps_images\gps_images.gbfs gbagps.gba
<br/>
<br/>
To access the contents, I did:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   const GBFS_FILE *dat = find_first_gbfs_file(find_first_gbfs_file);
<br/>
<br/>
   ...
<br/>
<br/>
   dat = find_first_gbfs_file(skip_gbfs_file(dat)); // returning NULL
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I am able to access the contents of map_data.gbfs fine, but the second call to find_first_gbfs() returns NULL.  The screen flashes white for half a second before the image is rendered.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#40956 - tepples - Sun Apr 24, 2005 12:19 am</h4>
    <div class="postbody"><span class="postbody">Try this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>In the GBFS manual, tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><span style="font-weight: bold">const void *skip_gbfs_file(const GBFS_FILE *file);</span>
<br/>
Returns the address of the end of the given GBFS file.  This is useful if you want to have more than one GBFS file in a single binary, such as if you have multiple musicians and artists working on their own parts of a project.</td> </tr></table><span class="postbody"><br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#40962 - ymalik - Sun Apr 24, 2005 12:42 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Try this:
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>In the GBFS manual, tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><span style="font-weight: bold">const void *skip_gbfs_file(const GBFS_FILE *file);</span>
<br/>
Returns the address of the end of the given GBFS file.  This is useful if you want to have more than one GBFS file in a single binary, such as if you have multiple musicians and artists working on their own parts of a project.</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
Isn't that what I'm doing in:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
dat = find_first_gbfs_file(skip_gbfs_file(dat)); // returning NULL
<br/>
</td> </tr></table><span class="postbody">
<br/>
?
<br/>
<br/>
And you say that first_first_gbfs_file(start) finds the first GBFS file after start.  Doing only skip_gbfs_file(dat) does not work because the two GBFS files both have a file called master.pal, and I am being redirected to master.pal in map_data.gbfs, not gps_images.gbfs.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#40966 - tepples - Sun Apr 24, 2005 1:22 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ymalik wrote:</b></span></td> </tr> <tr> <td class="quote">And you say that first_first_gbfs_file(start) finds the first GBFS file after start.  Doing only skip_gbfs_file(dat) does not work because the two GBFS files both have a file called master.pal, and I am being redirected to master.pal in map_data.gbfs, not gps_images.gbfs.</td> </tr></table><span class="postbody">
<br/>
Then use more than one <span style="font-weight: bold">GBFS_FILE *</span> variable when reading the linked list of GBFS files:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">const GBFS_FILE *map_data, *gps_images;
<br/>
const void *master_pal_1, *master_pal_2;
<br/>
<br/>
int main(void)
<br/>
{
<br/>
  /* these must match the order of copying */
<br/>
  map_data_gbfs = find_first_gbfs_file(find_first_gbfs_file);
<br/>
  gps_images_gbfs = skip_gbfs_file(map_data_gbfs);
<br/>
<br/>
  master_pal_1 = gbfs_get_obj(map_data, "master.pal", NULL);
<br/>
  master_pal_2 = gbfs_get_obj(gps_images, "master.pal", NULL);
<br/>
<br/>
}</td> </tr></table><span class="postbody">
<br/>
For a more detailed example of the use of more than one GBFS file, see blo.c in <a class="postlink" href="http://www.pineight.com/gba/#tod" target="_blank">Tetanus On Drugs</a>:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
int main(void)
<br/>
{
<br/>
  data_gbfs = find_first_gbfs_file(find_first_gbfs_file);
<br/>
  if(!data_gbfs)
<br/>
  {
<br/>
    LCDMODE = 0;
<br/>
    PALRAM[0] = RGB(31, 0, 0);
<br/>
  }
<br/>
  bkgnds_gbfs = skip_gbfs_file(data_gbfs);
<br/>
  bgm_gbfs = skip_gbfs_file(bkgnds_gbfs);
<br/>
  samples_gbfs = skip_gbfs_file(bgm_gbfs);
<br/>
  /* ... */
<br/>
}</td> </tr></table><span class="postbody"><br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#40970 - ymalik - Sun Apr 24, 2005 2:23 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Then use more than one <span style="font-weight: bold">GBFS_FILE *</span> variable when reading the linked list of GBFS files:
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">const GBFS_FILE *map_data, *gps_images;
<br/>
const void *master_pal_1, *master_pal_2;
<br/>
<br/>
int main(void)
<br/>
{
<br/>
  /* these must match the order of copying */
<br/>
  map_data_gbfs = find_first_gbfs_file(find_first_gbfs_file);
<br/>
  gps_images_gbfs = skip_gbfs_file(map_data_gbfs);
<br/>
<br/>
  master_pal_1 = gbfs_get_obj(map_data, "master.pal", NULL);
<br/>
  master_pal_2 = gbfs_get_obj(gps_images, "master.pal", NULL);
<br/>
<br/>
}</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
<br/>
Why do you have skip_gbfs_file() return const void * when you are assigning it as const GBFS_FILE *?  I know it doesn't make a difference, though.  Also, since map_data is declared to be const GBFS_FILE *, why don't I get a warning after I define the constant after the declaration?
<br/>
<br/>
Thanks,
<br/>
Yasir</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#40972 - tepples - Sun Apr 24, 2005 2:45 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ymalik wrote:</b></span></td> </tr> <tr> <td class="quote">Why do you have skip_gbfs_file() return const void * when you are assigning it as const GBFS_FILE *?</td> </tr></table><span class="postbody">
<br/>
The skip_gbfs_file() function returns the address immediately following a GBFS file, which may or may not be another GBFS file. I envisioned making GBFS compatible with other appended data formats that specify their file length, just in case someone wants to use, say, a GBFS file for core assets and a TAR file for user-supplied assets.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Also, since map_data is declared to be const GBFS_FILE *, why don't I get a warning after I define the constant after the declaration?</td> </tr></table><span class="postbody">
<br/>
"const GBFS_FILE *foo" means a variable holding a pointer to a "const GBFS_FILE". On the other hand, "GBFS_FILE *const foo" means a variable that can't be modified, pointing to a "GBFS_FILE". The qualifier "const" applies only to things on one side of the *.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
