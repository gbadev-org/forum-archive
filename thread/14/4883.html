<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>What parameters to use with GCC - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > What parameters to use with GCC</h2>
<div id="posts">
<div class="post">
    <h4>#34616 - donpeppoe - Sat Jan 22, 2005 4:23 pm</h4>
    <div class="postbody"><span class="postbody">In different tutorials i've seen different ways to compile an binary with <span style="font-weight: bold">devkitadv</span>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
gcc -o main.elf main.c  -lm
<br/>
objcopy -O binary main.elf main.gba
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
and
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
gcc -c -O3 -mthumb -mthumb-interwork main.c -w
<br/>
gcc -mthumb -mthumb-interwork -o main.elf main.o -w
<br/>
objcopy -O binary main.elf main.gba
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
the results of the binaries are not the same.
<br/>
<br/>
What is the correct way (which is compatible with GBA hardware)
<br/>
<br/>
any idea's? Thanks!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#34630 - tepples - Sat Jan 22, 2005 10:54 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">gcc -o main.elf main.c  -lm</td> </tr></table><span class="postbody">
<br/>
This compiles a single file to unoptimized ARM code and links it using the ARM version of the C library. ARM code will run more slowly on the GBA than optimized ARM code, which in turn will run more slowly than optimized Thumb code when run from ROM (the default) or EWRAM (the default for multiboot programs). The -lm is floating point stuff, which you usually don't want on a platform such as the GBA that has no floating point unit.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">gcc -c -O3 -mthumb -mthumb-interwork main.c -w
<br/>
gcc -mthumb -mthumb-interwork -o main.elf main.o -w</td> </tr></table><span class="postbody">
<br/>
I'm not sure what the -w does, but the first line compiles a single file to optimized Thumb code (-c means just compile, don't link), and the second line links it with the Thumb version of the C library.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">gcc -O3 -mthumb -mthumb-interwork -o main.elf main.c</td> </tr></table><span class="postbody">
<br/>
This does the same as the first example, except using optimized (-O3) Thumb code (-mthumb -mthumb-interwork) and the Thumb version of the C library.
<br/>
<br/>
The "objcopy" part, which turns a .elf file (which runs in emulators and can hold debug information but cannot hold appended data nor run on hardware) into a .gba file (which runs in emulators and on hardware and can hold appended data but cannot hold debug information), is identical in all three cases.
<br/>
<br/>
Tip: DevKit Advance is old and deprecated. If you use devkitARM instead of DevKit Advance, then on the command line that calls the linker (the one containing -o main.elf), you must specify -specs=gba.specs (for a ROM) or -specs=gba_mb.specs (for a multiboot).<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#34633 - sajiimori - Sun Jan 23, 2005 12:01 am</h4>
    <div class="postbody"><span class="postbody">-w disables warnings, which I would not recommend for projects large enough to span multiple files.  -Wall enables all warnings, which is generally preferable.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#34656 - donpeppoe - Sun Jan 23, 2005 1:39 pm</h4>
    <div class="postbody"><span class="postbody">ok, i switched to ARM
<br/>
<br/>
i use 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
arm-elf-gcc -mthumb-interwork	-c main.c						-o main.o
<br/>
arm-elf-gcc -mthumb-interwork	-c framework/functions.c				-o functions.o
<br/>
arm-elf-gcc -mthumb-interwork	-specs=gba_mb.specs		main.o functions.o	-o game.elf
<br/>
arm-elf-objcopy -O binary game.elf game.gba
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
and it all seems to work
<br/>
<br/>
Thanks for the help!</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
