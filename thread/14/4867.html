<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Am I overengineering? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > Am I overengineering?</h2>
<div id="posts">
<div class="post">
    <h4>#34449 - Steve++ - Wed Jan 19, 2005 7:50 pm</h4>
    <div class="postbody"><span class="postbody">I'm making a sprite collision messaging system with a client/server architecture. Just wondering if I'm going overboard (especially for a GBA project). Here's a code snippet (only a tiny piece of the system):
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#ifndef SPRITECLIENT_H
<br/>
#define SPRITECLIENT_H
<br/>
<br/>
#include "fixedmath.h"
<br/>
#include "SpriteServer.h"
<br/>
#include "Grid.h"
<br/>
#include "LinkedList.h"
<br/>
<br/>
class cSpriteClient : public cPoolable&lt;cSpriteClient&gt;
<br/>
{
<br/>
    cSpriteServer* m_pServer;
<br/>
   FIXED m_fxdX;
<br/>
   FIXED m_fxdY;
<br/>
   unsigned char m_nCategory;
<br/>
   cLinkedList&lt;cSpriteClient*&gt;* m_plstCollisions;
<br/>
   cLinkedList&lt;cSpriteClient*&gt;::cIterator* m_pitrHostCellList;
<br/>
   cLinkedList&lt;cSpriteClient*&gt;::cIterator* m_pitrServerOffScreenActiveList;
<br/>
   
<br/>
public:
<br/>
   bool m_bVisible;
<br/>
   void (*m_pfncAction)(cSpriteClient*);
<br/>
<br/>
   cSpriteClient();
<br/>
   void init(   cSpriteServer* pServer,
<br/>
              unsigned char nCategory,
<br/>
             cLinkedList&lt;cSpriteClient*&gt;* plstCollisions,
<br/>
            void (*pfncAction)(cSpriteClient*));
<br/>
<br/>
   void setXY(FIXED fxdX, FIXED fxdY);
<br/>
   unsigned char getCategory();
<br/>
   void getCollisionIterator(cLinkedList&lt;cSpriteClient*&gt;::cIterator* pitrCollisions);
<br/>
   
<br/>
   friend class cSpriteServer;
<br/>
   friend class cGrid::cCell;
<br/>
};
<br/>
<br/>
#endif
<br/>
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#34452 - poslundc - Wed Jan 19, 2005 8:35 pm</h4>
    <div class="postbody"><span class="postbody">Not sure what kind of game you're making, but... probably. Don't know why you'd need or want a client-server architecture since most games have just a single collision management routine.
<br/>
<br/>
Other stuff in your code like linked lists (unless they operate from a static pool), accessor methods that aren't inlined, templates (not necessarily bad, but iffy), and friend classes (which often defeat the point of encapsulation) make me wince a little.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#34465 - sajiimori - Wed Jan 19, 2005 11:33 pm</h4>
    <div class="postbody"><span class="postbody">On the other hand, I reserve my wincing until I actually find out if the code is good.  My code is filled with linked lists (generally from STL which use dynamic pools), accessor methods that don't have their bodies declared in the header (but are inlined anyway by including a seperate .inl file), templates (which let me write fast code which is also safe and general), and friend declarations (which allow me to move irrelevant parts of an implementation to internal classes, and let me write manager classes that have special privilages over their managed objects).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#34467 - poslundc - Thu Jan 20, 2005 12:25 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">On the other hand, I reserve my wincing until I actually find out if the code is good.  My code is filled with linked lists (generally from STL which use dynamic pools)</td> </tr></table><span class="postbody">
<br/>
<br/>
Interesting... do you use malloc or your own routine, and does it use EWRAM or IWRAM? Do you have to deal with exceptions and fragmentation? And does it affect matters for you that STL lists are dually-linked at all? Sorry for all the questions, but I don't often hear of people using STL in their GBA programming.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">accessor methods that don't have their bodies declared in the header (but are inlined anyway by including a seperate .inl file)</td> </tr></table><span class="postbody">
<br/>
<br/>
I've not seen that style before. Would you not want to #include the .inl file in the header file, though?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">templates (which let me write fast code which is also safe and general</td> </tr></table><span class="postbody">
<br/>
<br/>
I agree that templates are fine so long as they aren't applied lazily, which can both bloat code and cause the square-peg-round-hole syndrome.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">and friend declarations (which allow me to move irrelevant parts of an implementation to internal classes, and let me write manager classes that have special privilages over their managed objects).</td> </tr></table><span class="postbody">
<br/>
<br/>
Eh, I think there's a time and place for friend declarations, but a server/client architecture doesn't generally behoove this, in my opinion anyway. Especially since the clients are likely to be various subclasses of a base client class, and the server shouldn't have any reason to mess with the clients' private members.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#34476 - tepples - Thu Jan 20, 2005 2:04 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">Don't know why you'd need or want a client-server architecture</td> </tr></table><span class="postbody">
<br/>
Client-server from the start scales up to multiplayer more easily. Q3A for example uses client-server even in single-player mode.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#34479 - sajiimori - Thu Jan 20, 2005 4:00 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Sorry for all the questions, but I don't often hear of people using STL in their GBA programming.</td> </tr></table><span class="postbody">The code in question isn't technically for GBA, but given the chance I would have written things this way even on my previous project (which was for GBA).
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">do you use malloc or your own routine</td> </tr></table><span class="postbody">I would have overloaded the global new/delete (just as I am on my current platform) to use custom routines.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">and does it use EWRAM or IWRAM?</td> </tr></table><span class="postbody">I probably would have used EWRAM for most or all dynamic lists.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Do you have to deal with exceptions</td> </tr></table><span class="postbody">STL doesn't throw exceptions.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">and fragmentation?</td> </tr></table><span class="postbody">The memory waste from oversized static arrays usually outweighs the loss due to fragmentation in my experience.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">And does it affect matters for you that STL lists are dually-linked at all?</td> </tr></table><span class="postbody">Sometimes I use std::list, but more often I use the singly-linked std::slist.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Would you not want to #include the .inl file in the header file, though?</td> </tr></table><span class="postbody">Yes.  The point is to keep the .h file clean because it serves as interface documentation.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I agree that templates are fine so long as they aren't applied lazily, which can both bloat code and cause the square-peg-round-hole syndrome.</td> </tr></table><span class="postbody">a.k.a. the "crappy programmer" syndrome.  We've had an 8 page conversation about this before, though.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#34497 - poslundc - Thu Jan 20, 2005 3:27 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">Don't know why you'd need or want a client-server architecture</td> </tr></table><span class="postbody">
<br/>
Client-server from the start scales up to multiplayer more easily. Q3A for example uses client-server even in single-player mode.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
I suppose that's true, and I can understand doing that for code that is meant to be portable... still seems a bit much considering the fairly narrow limitations on GBA multiplayer.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#34498 - poslundc - Thu Jan 20, 2005 3:41 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sajiimori wrote:</b></span></td> </tr> <tr> <td class="quote">The code in question isn't technically for GBA, but given the chance I would have written things this way even on my previous project (which was for GBA).</td> </tr></table><span class="postbody">
<br/>
<br/>
OK; I'd assumed it was.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Do you have to deal with exceptions</td> </tr></table><span class="postbody">STL doesn't throw exceptions.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
I know... I guess I meant was do you need to build an exceptions model into your code, or do you just rely on engineering constraints into the game as well as patterns in how you allocate/delete to prevent out of memory and fragmentation errors?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I agree that templates are fine so long as they aren't applied lazily, which can both bloat code and cause the square-peg-round-hole syndrome.</td> </tr></table><span class="postbody">a.k.a. the "crappy programmer" syndrome.  We've had an 8 page conversation about this before, though.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Fair enough. And like I said, the original post's use of templates was not necessarily (or even probably) ill-advised, especially since there are only two class instances being generated by it and they seem like they would be very narrow, functionality-oriented library classes. It just makes me wince a little in the midst of everything else going on. :|
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#34501 - Steve++ - Thu Jan 20, 2005 4:29 pm</h4>
    <div class="postbody"><span class="postbody">I'm using my own linked list template. It allocates from a pool. That's what the cPoolable template is all about. For any class/template whose instances I want to be compatible with an object pool, I simply make it inherit from cPoolable&lt;class-name&gt;.
<br/>
<br/>
Each sprite is given a category (1 to 15 (or so)). The server has a table where each row represents which category to test for collision with which other category. Every frame, the server finds all the viewable sprites and those sprites marked as active when off-screen and puts them into active lists. If there are, say, 15 categories, then there will be 15 active lists - each sprite being in the list for its category. The server then works through the category comparison table and tells each sprite which relevant sprite(s) has/have collided with it. Then the server calls the action function of each sprite. The action function has access to its sprite's collision list so it can act accordingly. Then the server clears that sprite's collision list, ready for the next frame. Pretty neat, eh?
<br/>
<br/>
Using this sort of architecture, the sprites don't need collision detection in their behaviour-specific code.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#34522 - sajiimori - Thu Jan 20, 2005 10:14 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">I guess I meant was do you need to build an exceptions model into your code, or do you just rely on engineering constraints into the game as well as patterns in how you allocate/delete to prevent out of memory and fragmentation errors?</td> </tr></table><span class="postbody">If there were an automated (and reasonably efficient) way to prevent out-of-memory errors (whether due to fragmentation or real memory usage), I'd be all over it.  As it is, exceptions don't provide such a solution, so like everybody else, I rely on engineering constraints.
<br/>
<br/>
In particular, large contiguous allocations need special attention, usually in the form of an early allocation (perhaps even before the exact data size is known, which obviously requires overestimation).  Static data is the most extreme form of preallocation.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
