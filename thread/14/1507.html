<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>"Artifact" Problem when trying to display Sprite - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > "Artifact" Problem when trying to display Sprite</h2>
<div id="posts">
<div class="post">
    <h4>#7613 - jcpredator - Sat Jun 21, 2003 3:22 am</h4>
    <div class="postbody"><span class="postbody">I just recently got out of a C programming class and have been trying to learn how to program for the GBA.  This is my first attempt at a GBA program that will display a sprite.  I know there are a lot of tutorials out there for this but I wanted to figure the bulk of this on my own and not from someone else.  Call me a noob if u want, lol.
<br/>
<br/>
I'm probably just making a easy to fix mistake on my part but I would appreciate it if anyone could tell me what I'm doing wrong.  usaflag.h is my sprite header, 256 color palette, 32x32, and I also have all the typedefs above the include statement.  When I compile and then run this program on VisualBoyAdvance all I see on the screen is a little picture in the top left corner that looks like a spaceship, lol, I was told this was called the "artifact".  Sorry for the long and messy code.
<br/>
<br/>
Code Below from SpriteTest.cpp
<br/>
//////////////////////////////////////////////////////////////////////
<br/>
#include &lt;usaflag.h&gt;
<br/>
<br/>
#define REG_DISPLAY (*(volatile u32*)0x04000000)
<br/>
#define SPRITE_PALETTE ((u16*)0x5000200)
<br/>
#define REG_VCOUNT     *(u16*)0x4000006
<br/>
<br/>
u32* OAMmem          =(u32*)0x7000000;
<br/>
u16* OAMData           =(u16*)0x6010000;
<br/>
u16* BGPaletteMem 	=(u16*)0x5000000;
<br/>
u16* OBJPaletteMem 	=(u16*)0x5000200;
<br/>
<br/>
typedef struct
<br/>
{
<br/>
	u16 attribute0;
<br/>
	u16 attribute1;
<br/>
	u16 attribute2;
<br/>
	u16 attribute3;
<br/>
} OAMEntry;
<br/>
<br/>
OAMEntry sprites[128];
<br/>
<br/>
volatile u16* VideoBuffer = (volatile u16*)0x06000000;
<br/>
<br/>
void initGame(void);
<br/>
void initSprites(void);
<br/>
void waitForVSync(void);
<br/>
void copyOAM(void);
<br/>
<br/>
void AgbMain(void)
<br/>
{
<br/>
	u16 loop;
<br/>
	s16 x = 50;
<br/>
	s16 y = 50;
<br/>
	initGame();
<br/>
<br/>
	for(loop=0;loop&lt;256;loop++)
<br/>
		OBJPaletteMem[loop] = palette[loop];
<br/>
<br/>
	initSprites();
<br/>
<br/>
	sprites[0].attribute0 = 0x2000 | 0x0 | y;
<br/>
	sprites[0].attribute1 = 0x4000 | x;
<br/>
	sprites[0].attribute2 = 512;
<br/>
<br/>
	for(loop=0;loop&lt;512;loop++)
<br/>
		OAMData[loop] = obj0[loop];
<br/>
<br/>
	while(1)
<br/>
	{
<br/>
		waitForVSync();
<br/>
		copyOAM();
<br/>
	}
<br/>
}
<br/>
<br/>
void initGame(void)
<br/>
{
<br/>
	REG_DISPLAY = 0x140A;	// Mode 4, BG2, OBJ, OAM,    1D / 5220 / 0001010001100100
<br/>
}
<br/>
<br/>
void initSprites(void)
<br/>
{
<br/>
	u16 loop;
<br/>
	for(loop=0;loop&lt;128;loop++)
<br/>
	{
<br/>
		sprites[loop].attribute0 = 160;
<br/>
		sprites[loop].attribute1 = 240;
<br/>
	}
<br/>
}
<br/>
<br/>
void waitForVSync(void)
<br/>
{
<br/>
	while((volatile u16)REG_VCOUNT != 160){}
<br/>
}
<br/>
<br/>
void copyOAM(void)
<br/>
{
<br/>
	u16 loop;
<br/>
	u16* temp;
<br/>
	temp = (u16*)sprites;
<br/>
	for(loop=0;loop&lt;128*4;loop++)
<br/>
		OAMmem[loop] = temp[loop];
<br/>
}
<br/>
///////////////////////////////////////////////////////////////////<br/>_________________<br/>There is no spoon...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7628 - jcpredator - Sat Jun 21, 2003 5:56 pm</h4>
    <div class="postbody"><span class="postbody">I failed to realize that when using mode 4 you need to set the sprite OAMData address to 0x06014000 instead of 0x6010000.  As I said before it was just probably a simple mistake on my part and I already called myself a dumbarse a couple of times already, hehe.  Thanks anyways,
<br/>
<br/>
-Jcpredator-<br/>_________________<br/>There is no spoon...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8721 - jmp_eax - Fri Jul 18, 2003 5:11 pm</h4>
    <div class="postbody"><span class="postbody">Just thought I'd mention that it'd be a LOT easier if you used a c header file like gba.h to define all the gba registers... and some macros as well...
<br/>
<br/>
You can get this at the pern project or gbajunkie's tutorials... if you can find some staringmonkey tutorials, you can get lots of other header file goodies from there too.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8722 - jcpredator - Fri Jul 18, 2003 5:14 pm</h4>
    <div class="postbody"><span class="postbody">Yeah well that was one of my first projects and a little while ago, Jun. 21st i believe.  I made my own C header file with all the registers in it after fixing this problem.<br/>_________________<br/>There is no spoon...</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
