<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>How do I properly include & access extern const (.h/.c)? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Beginners > How do I properly include & access extern const (.h/.c)?</h2>
<div id="posts">
<div class="post">
    <h4>#21104 - aleister - Sun May 23, 2004 10:17 pm</h4>
    <div class="postbody"><span class="postbody">Searching this forum, I came across several threads explaining that data should be placed in a .c-file, not in a header-file. To my pleasant surprise this approach also provided an answer to the problem of running out of memory since it would not automatically try to put all the data I define into the working RAM...
<br/>
<br/>
What I can't figure out however, is how to address the data when it is included like this. Upon compiling I keep getting the message that the variables are undeclared (first use in this function).
<br/>
<br/>
I used to do it like this: an array containing the different frames of animation for a sprite were located in, for example, gfxsprite0.h, like this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
const u16 gfxsprite0Data[] = {
<br/>
   0xFFFF, 0xFFFD, 0x0000, 0xFFFF, etc...etc... 0x0000, 0x0000,};
<br/>
const u16 gfxsprite0Palette[] = {
<br/>
   0x7FFF, 0x35B8, 0x0850, etc... etc.. 0x67FF, 0x7FFF,};
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
In the main c-source, I would include it using <span style="font-weight: bold">#include gfxsprite0.h</span> and copy the desired part of the array to VRAM using:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
memcpy( (u16 *)0x06014000, &amp;gfxsprite0Data[0], 4096 );
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
(in this example 4096 since I'm working with a 64x64 sprite using 256 colors in mode4)
<br/>
<br/>
The above code compiles and works perfectly, but I run into the undeclared variable problem when I attempt to do it the proper way, and change <span style="font-weight: bold">gfxsprite0.h</span> to:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#ifndef PLAYERGFX
<br/>
#define PLAYERGFX
<br/>
<br/>
extern const u16 gfxsprite0Data[];
<br/>
<br/>
#endif
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
and move the actual data to a file named <span style="font-weight: bold">gfxsprite0.c</span>:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
extern const u16 gfxsprite0Data[] = {
<br/>
   0xFFFF, 0xFFFD, 0x0000, 0xFFFF, etc...etc... 0x0000, 0x0000,};
<br/>
extern const u16 gfxsprite0Palette[] = {
<br/>
   0x7FFF, 0x35B8, 0x0850, etc... etc.. 0x67FF, 0x7FFF,};
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I am slowly getting the idea that this may have something to do with the make.bat-file; my make.bat looks like this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
path=C:\devkitadv\bin
<br/>
gcc -o maingame.elf maingame.c -lm
<br/>
objcopy -O binary maingame.elf maingame.gba
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
For all completeness: I'm compiling this using devkitadvance.
<br/>
<br/>
My sincere apologies if this issue has already been explained, but if it has, I'm afraid I couldn't find it while searching through this forum. Thanks ever so much in advance for any help you can offer.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#21113 - BeeWarloc - Mon May 24, 2004 1:09 am</h4>
    <div class="postbody"><span class="postbody">I think this
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
extern const u16 gfxsprite0Data[] = {
<br/>
   0xFFFF, 0xFFFD, 0x0000, 0xFFFF, etc...etc... 0x0000, 0x0000,};
<br/>
extern const u16 gfxsprite0Palette[] = {
<br/>
   0x7FFF, 0x35B8, 0x0850, etc... etc.. 0x67FF, 0x7FFF,}; 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
should be this
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
const u16 gfxsprite0Data[] = {
<br/>
   0xFFFF, 0xFFFD, 0x0000, 0xFFFF, etc...etc... 0x0000, 0x0000,};
<br/>
const u16 gfxsprite0Palette[] = {
<br/>
   0x7FFF, 0x35B8, 0x0850, etc... etc.. 0x67FF, 0x7FFF,}; 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Because declaring it extern means that it's not in the source file, but somewhere else. You only should use the extern keyword in the header file, and actually you don't really have to use it extern keyword there either..</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#21115 - poslundc - Mon May 24, 2004 1:42 am</h4>
    <div class="postbody"><span class="postbody">You also need to include gfxsprite0.c in the list of files you want gcc to process.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#21284 - aleister - Wed May 26, 2004 5:45 pm</h4>
    <div class="postbody"><span class="postbody">Thanks very much; I guess I'd better start learning a bit more about make-files :) At least I now know that that is indeed where the problem lies. Thanks!</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
