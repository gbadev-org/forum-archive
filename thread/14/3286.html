<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Ahh the dreaded sprite transparency - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Beginners > Ahh the dreaded sprite transparency</h2>
<div id="posts">
<div class="post">
    <h4>#19700 - CyberSlag5k - Fri Apr 23, 2004 6:03 pm</h4>
    <div class="postbody"><span class="postbody">Ok, I know there have been a ton of posts on the subject (and I do believe I've read them all), but something still isn't clicking. Let me lay down what (I think) I know:
<br/>
<br/>
Palette index 0 is always transparent. So, if you want a cetain area of your sprite to be transparent, you set it to palette index 0. Sound good?
<br/>
<br/>
Ok, so my palette looks like this:
<br/>
<br/>
const u16 palettePalette[] = {
<br/>
                    0x0000 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x7FFF, 0x0842, 0x0842,......};
<br/>
<br/>
So index 0 is 0x0000. Now I as I understand it, this does not mean that all instances of the color 0x0000 (black) will be transparent. Good, I wouldn't want them to be.
<br/>
<br/>
Now, I saw this post on gamedev:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
The origin of those color values is this:
<br/>
<br/>
0x1F1F:
<br/>
<br/>
1F is hex for 31. That means that the pixel is palette index #31. The GBA will look through the palette array for index 31, and use whatever color is there. You'll notice that there are two 1Fs, that's because each number stores two pixels. If you ever try to write your own converter, its important to know that they're reversed. If you had the number: 0x1FFF, the FIRST pixel is FF, or color 255. The SECOND is 1F, or 31.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Sounds good to me, although I've never seen anything similar anywhere else. Anyway, if this is the case, all I should have to do is replace all the 0xFFFF's (the color white) in my sprite (not the palette) to 0x0000 (index 0) all the white elements turn transparent. Is this right? Somehow this doesn't seem right to me. I'm quite confused.<br/>_________________<br/><span style="font-style: italic">When you find yourself in the company of a halfling and an ill-tempered Dragon, remember, you do not have to outrun the Dragon... </span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19704 - niltsair - Fri Apr 23, 2004 6:48 pm</h4>
    <div class="postbody"><span class="postbody">Ok, here's a plain explanation.
<br/>
<br/>
You have a 8x8 sprite :</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">Pixels :
<br/>
0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 
<br/>
0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 
<br/>
0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x00, 
<br/>
0x00, 0x00, 0x0A, 0x04, 0x0B, 0x00, 0x00, 0x00, 
<br/>
0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00, 0x00, 
<br/>
0x00, 0x00, 0x00, 0x06, 0x00, 0x00, 0x00, 0x00, 
<br/>
0x00, 0x00, 0x00, 0x07, 0x00, 0x00, 0x00, 0x00, 
<br/>
0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00, 0x00, 
<br/>
<br/>
Palette
<br/>
Pal0 : 0x1235, Pal1 : 0x1111, Pal2 : 0x2222, Pal3 : 0x3333, 
<br/>
Pal4 : 0x4444, Pal5 : 0x5555, Pal6 : 0x6666, Pal7 : 0x7777, 
<br/>
Pal8 : 0x8888, Pal9 : 0x1111, PalA : 0x4444, PalB : 0xFFFF,
<br/>
... </td> </tr></table><span class="postbody"> Now, every pixels that points to Pal0 won't be seen while any other one will just take the colors of it's entry in the palette. (pixel 0x04 would display the color 0x4444).
<br/>
<br/>
I think what got you confused is that fact that the pixels are stored 2 at a time(video memory can only be accessed in 16/32bits) , so they might look like this in a header </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">0x0000, 0x0100, 0x0000, 0x0000, 
<br/>
0x0000, 0x0200, 0x0000, 0x0000, 
<br/>
0x0000, 0x0300, 0x0000, 0x0000, 
<br/>
0x0000, 0x040A, 0x000B, 0x0000, 
<br/>
0x0000, 0x0500, 0x0000, 0x0000, 
<br/>
0x0000, 0x0600, 0x0000, 0x0000, 
<br/>
0x0000, 0x0700, 0x0000, 0x0000, 
<br/>
0x0000, 0x0800, 0x0000, 0x0000, </td> </tr></table><span class="postbody"> But they do not represent the palette color, just which color to pick in the palette.<br/>_________________<br/>-Inside every large program is a small program struggling to get out. (Hoare's Law of Large Programs)
<br/>
-The man who can smile when things go wrong has thought of someone he can blame it on. (Nixon's Theorem)</span><span class="gensmall"><br/><br/>Last edited by niltsair on Fri Apr 23, 2004 6:51 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#19705 - sajiimori - Fri Apr 23, 2004 6:50 pm</h4>
    <div class="postbody"><span class="postbody">There's nothing unusual about the quote you posted.  It fits nicely with your previous description, at least for 8-bit images.  Without context, I would guess that the original poster was talking about pairs of pixels because you can only plot pairs in mode 4.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Anyway, if this is the case, all I should have to do is replace all the 0xFFFF's (the color white) in my sprite (not the palette) to 0x0000 (index 0) all the white elements turn transparent.
<br/>
</td> </tr></table><span class="postbody">
<br/>
Palettized graphics (such as GBA sprite data) have 2 components: the palette and the pixel data.
<br/>
<br/>
The palette is an array of colors encoded in some format, which is 15-bit BGR in the case of GBA.  Colors are rounded up to the nearest byte (to 16 bits), and the highest bit is unused.  Because of that unused bit, the values 0x8FFF and 0xFFFF both represent white.
<br/>
<br/>
The pixel data is an array of indexes into the palette.  Their size depends on how many palette entries there are.  To select one of 16 colors, you need 4 bits per pixel (because there are 16 possible combinations of 4 bits).  For 256 colors, you need 8 bits.
<br/>
<br/>
So, your sprite pixel data does not contain "the color white".  It just contains indexes into the palette.  If your sprite data contains the bytes 0xFFFF somewhere, the meaning depends on whether the sprite is 16 color or 256 color.  If it's 16 color, 0xFFFF is 4 palette indexes, all of which are 15 (because the hex digit F is 15).  If it's 256 color, 0xFFFF is 2 palette indexes, both of which are 255 (because the hex number FF is 255).
<br/>
<br/>
Similarly, 0x0000 is a 16 bit number, and GBA's palette indexes are either 4 bits or 8 bits, so that number couldn't possibly refer to index 0.  (One could argue that 0=0 no matter how many bits are involved, but in terms of sequences of bits in memory, 0x0000 describes a sequence of 16 bits.)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19712 - CyberSlag5k - Fri Apr 23, 2004 7:52 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Similarly, 0x0000 is a 16 bit number, and GBA's palette indexes are either 4 bits or 8 bits, so that number couldn't possibly refer to index 0. (One could argue that 0=0 no matter how many bits are involved, but in terms of sequences of bits in memory, 0x0000 describes a sequence of 16 bits.)
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
So what would I use to represent index 0? Just 0x0?<br/>_________________<br/><span style="font-style: italic">When you find yourself in the company of a halfling and an ill-tempered Dragon, remember, you do not have to outrun the Dragon... </span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19713 - tepples - Fri Apr 23, 2004 8:02 pm</h4>
    <div class="postbody"><span class="postbody">0x0000 means either four pixels in a row with index 0 (in 16-color mode) or two pixels in a row with index 0 (in 256 color mode). If, say, you are in 16-color mode and want to represent three transparent pixels and one opaque pixel of color 7, use 0x7000. (GBA reads pixels from right to left within a word length.)<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19715 - niltsair - Fri Apr 23, 2004 8:05 pm</h4>
    <div class="postbody"><span class="postbody">It depends,
<br/>
<br/>
Suppose you have 4 consecutive pixels having those values:
<br/>
Pixel 0: Color Index 0
<br/>
Pixel 1: Color Index 3
<br/>
Pixel 2: Color Index 8
<br/>
Pixel 3: Color Index 9
<br/>
<br/>
In 256 colors (8 Bits per color), it would be 
<br/>
0x0300, 0x0908
<br/>
<br/>
In 16 colors (4bits per color), it would be 
<br/>
0x9830
<br/>
<br/>
The thing is, you don't have to store those numbers in 16bits value, you just need to Write them in 16bits or 32bits chunk. Meaning that it would be fine to store the array as 8bits values, but you write them by 16bits chunk by casting it :</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
u8 SpriteImg[] ALIGN4 = {0x00, 0x03, 0x07, 0x09, ... };
<br/>
//Only 2 copy needed, since we transfer 2Pixels at a time
<br/>
PtrSpriteMem[0] = (u16*)SpriteImg[0];
<br/>
PtrSpriteMem[1] = (u16*)SpriteImg[1];
<br/>
</td> </tr></table><span class="postbody">Notice the ALIGN4, important. It tells the linker to locate the data at a 32bits bondaries, which is needed if you want to DMA the data in 16/32bits chunk (ALIGN2 for only 16bits).<br/>_________________<br/>-Inside every large program is a small program struggling to get out. (Hoare's Law of Large Programs)
<br/>
-The man who can smile when things go wrong has thought of someone he can blame it on. (Nixon's Theorem)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19719 - CyberSlag5k - Fri Apr 23, 2004 8:33 pm</h4>
    <div class="postbody"><span class="postbody">Alright. I think I'm following.
<br/>
<br/>
I've realized partly what I've been doing wrong is I'm looking at the wrong .h file. I forgot I swtiched from pcx2sprite to gifs2sprites. The file I'm really working with looks like this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
const u16 palette[25]=
<br/>
{
<br/>
RGB( 0, 0, 0),RGB(31,31,31),RGB(31, 2, 2),RGB( 0, 0, 0),RGB(31,30,17),
<br/>
RGB(28,28,28),RGB(24,24,24),RGB( 7,17,25),RGB( 3, 0, 0),RGB( 3, 3, 3),
<br/>
RGB( 4,11,18),RGB( 6, 3, 3),RGB( 7, 0, 0),RGB(31, 3, 3),RGB(13,13,13),
<br/>
RGB(31, 4, 4),RGB( 2, 2, 2),RGB(25,25,25),RGB(27,27,27),RGB(17,17,17),
<br/>
RGB(26,26,26),RGB( 3, 4, 5),RGB( 3, 5, 6),RGB( 4, 5, 7),RGB( 3, 4, 4)
<br/>
};
<br/>
<br/>
/* soldier1.gif (64x64x256) */
<br/>
const u16 obj0[2048]={
<br/>
0x0101,   0x0101,   0x0101,   0x0101,
<br/>
0x0101,   0x0101,   0x0101,   0x0101,
<br/>
0x0101,   0x0101,   0x0101,   0x0101,
<br/>
0x0101,   0x0101,   0x0101,   0x0101,
<br/>
0x0101,   0x0101,   0x0101,   0x0101,
<br/>
0x0101,   0x0101,   0x0101,   0x0101,
<br/>
0x0101,   0x0101,   0x0101,   0x0101,
<br/>
0x0101,   0x0101,   0x0101,   0x0101,
<br/>
0x0101,   0x0101,   0x0101,   0x0301,
<br/>
0x0101,   0x0101,   0x0501,   0x030e,
<br/>
........
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
SO! the 0x0101 in the top left corner says that the obj0[0] will be the color white (as palette[1] is (31, 31, 31) and therefore white). Riiiight?
<br/>
<br/>
So,if I wanted to change everything white on the sprite to be transparent I would search for all the 01's and make them 00's. Riiiiiight?
<br/>
<br/>
I think I'm getting this but I tried doing what I said up there, changed all the 01's to 00's and nothing changed. So, just out of curiosity I changed them all into 0C's (the 12th index, some sort of red as it would seem) and still nothing changed! I've recompiled, of course, each time so you'd think <span style="font-style: italic">something </span> would change. Riiiiight?
<br/>
<br/>
Am I still missing something?<br/>_________________<br/><span style="font-style: italic">When you find yourself in the company of a halfling and an ill-tempered Dragon, remember, you do not have to outrun the Dragon... </span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19720 - niltsair - Fri Apr 23, 2004 8:44 pm</h4>
    <div class="postbody"><span class="postbody">Yes, changing the 0x0101 to 0x0000 would make the sprite transparent for those pixels. For example : 
<br/>
/* soldier1.gif (64x64x256) */
<br/>
const u16 obj0[2048]={
<br/>
0x0001,   0x0001,   0x0001,   0x0001,
<br/>
0x0001,   0x0001,   0x0001,   0x0001, 
<br/>
...
<br/>
<br/>
Would make every 2 pixels transparent for the first2 rows of the first Sprite Tile.<br/>_________________<br/>-Inside every large program is a small program struggling to get out. (Hoare's Law of Large Programs)
<br/>
-The man who can smile when things go wrong has thought of someone he can blame it on. (Nixon's Theorem)</span><span class="gensmall"><br/><br/>Last edited by niltsair on Fri Apr 23, 2004 9:12 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#19721 - sajiimori - Fri Apr 23, 2004 8:44 pm</h4>
    <div class="postbody"><span class="postbody">Did you physically replace them in the header file by hand, or did you try to have your code do it?  The array is const, so you can't modify it at runtime.  Otherwise, try cleaning your project and recompiling, then make sure you're drawing what you think you're drawing, because obviously changing those numbers should change the image.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19722 - CyberSlag5k - Fri Apr 23, 2004 9:03 pm</h4>
    <div class="postbody"><span class="postbody">Ahh, I got it going now. I had a compile error I hadn't noticed and it wasn't rebuilding the file.
<br/>
<br/>
Thanks for everyone's help! I feel I have a complete understanding of how the sprite and palette interact now.<br/>_________________<br/><span style="font-style: italic">When you find yourself in the company of a halfling and an ill-tempered Dragon, remember, you do not have to outrun the Dragon... </span></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
