<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>I must be missing something. - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Beginners > I must be missing something.</h2>
<div id="posts">
<div class="post">
    <h4>#34570 - microlith - Fri Jan 21, 2005 7:57 pm</h4>
    <div class="postbody"><span class="postbody">Well, I got my VS6 problems solved and can now generate binaries problem free.
<br/>
<br/>
The problem now lies in my binaries, as they simply don't work. I'm missing something and don't know what.
<br/>
<br/>
<a class="postlink" href="http://www.side-7.us/misc/test.cpp" target="_blank">http://www.side-7.us/misc/test.cpp</a>
<br/>
<br/>
The code above works for the most part. It copies palette data and sprite data into their appropriate memory spaces without trouble.
<br/>
<br/>
The OAM entries, however, are not getting set and/or copied properly. Despite my settings in the attribute fields I get a blank screen (in both emulators and on actual hardware) and VisualBoyAdvance's OAM viewer shows an alternating mishmash of 256 and 16 color entries, all 8x8.
<br/>
<br/>
My objective first is to simply get 4 red sprites to display in a row, simply getting sprites to display short of copying the tutorials out there one-for-one seems impossible.
<br/>
<br/>
Am I missing something really obvious or missing the mark by a lot.
<br/>
<br/>
Specs:
<br/>
GCC version 3.0.2 DevKit Advance
<br/>
Visual Studio 6
<br/>
Pern Project Headers
<br/>
VisualBoyAdvance 1.7.1
<br/>
EZF Advance cart + USB Link Cable
<br/>
GBA SP with custom paint job.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#34693 - Cearn - Mon Jan 24, 2005 11:16 am</h4>
    <div class="postbody"><span class="postbody">What exactly are the definitions for OBJ_SpriteMem and OAMMem? I can't find OBJ_SpriteMem in any of Pern's files. If you've pointed it to the 0x06014000 then never mind, but if it's pointing to 0x06010000, then you might have a mismatch between your sprite attribute and where your graphics are.
<br/>
In gba.h, OAMMem is defined as 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define OAMMem        ((u32*)0x7000000)
<br/>
</td> </tr></table><span class="postbody">
<br/>
which is a <span style="font-weight: bold">u32</span> pointer, not u16. Meaning that copying the attributes will will be very funky indeed. For example, sprite[0] contains
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">sprite[0]= { 0x2042, 0x4002, 0x0200, 0x0000 };
<br/>
</td> </tr></table><span class="postbody">
<br/>
Copying this to OAMMem (as a u32*) will result in 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">{ 0x2042, 0x0000, 0x4002, 0x0000 }    // OAM[0]
<br/>
{ 0x0200, 0x0000, 0x0000, 0x0000 }    // OAM[1]
<br/>
</td> </tr></table><span class="postbody">
<br/>
When using loops to copy, <span style="font-weight: bold">ALWAYS</span> be sure that the source and destination are of equal types.
<br/>
<br/>
Speaking of types, since the GBA is a 32bit machine, using int/u32 will be faster than short/u16. Compare the following copying routines.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
// copy a data array of N bytes
<br/>
u8 data[N]= { blah, blah, blah };
<br/>
<br/>
int ii;
<br/>
short jj;
<br/>
u16 *dst16, *src16;
<br/>
u32 *dst32, *src32;
<br/>
<br/>
dst16= (u16*)0x06000000;
<br/>
src16= (u16*)data;
<br/>
dst32= (u32*)0x06000000;
<br/>
src32= (u32*)data;
<br/>
<br/>
// u32 data, int loop index
<br/>
for(ii=0; ii &lt; N&gt;&gt;2; ii++)
<br/>
    dst32[ii]= src32[ii];
<br/>
<br/>
// u16 data, int loop index
<br/>
for(ii=0; ii &lt; N&gt;&gt;1; ii++)
<br/>
    dst16[ii]= src16[ii];
<br/>
<br/>
// u16 data, short loop index
<br/>
for(jj=0; jj &lt; N&gt;&gt;1; jj++)
<br/>
    dst16[jj]= src32[jj];
<br/>
</td> </tr></table><span class="postbody">
<br/>
Under normal circumstances, the int/u32[] case will be 80% faster than int/u16[], simply because you have twice as many loop iterations to go through. int/u16[] will be 20% faster than short/u16[] because of the extra instructions needed to make sure the short stays short. So you can pretty much double the speed of your copying routines by changing the type alone. (There are even faster ways, but those are a little more involved.)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
