<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>detecting button presses versus button taps - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > detecting button presses versus button taps</h2>
<div id="posts">
<div class="post">
    <h4>#17383 - darknet - Sun Mar 07, 2004 3:37 am</h4>
    <div class="postbody"><span class="postbody">I remember seeing this question quite  a while ago on the forums, but am unable to find it now..
<br/>
<br/>
Basically, my game obviously includes stuff like "press A' to continue and when the user presses 'A', the GBA + emulator are both very very sensitive and actually skip ahead to other portions of the game.
<br/>
<br/>
I use the more or less standard code for checking for button input like so:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
#define RIGHT_BUTTON 16
<br/>
                     [etc...]
<br/>
 
<br/>
#define pressed(n) (!((*BUTTONS) &amp; n))
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
and for checking if the next screen should be displayed because the user pressed RIGHT, i do the following:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
while(!pressed(RIGHT_BUTTON));
<br/>
//load new graphic
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Which works, but is entirely too too sensitive.
<br/>
<br/>
IN short, how does one detect once the button has been pressed AND released? Only then would I want to act, not just when its been pressed.
<br/>
<br/>
Any help is greatly appreciated,
<br/>
-Mike</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17384 - tepples - Sun Mar 07, 2004 3:49 am</h4>
    <div class="postbody"><span class="postbody">To detect a press or release, you need to store the last state of the buttons.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define JOY (*(volatile unsigned short)0x04000130)
<br/>
<br/>
int last_joy;
<br/>
while(game_loop)
<br/>
{
<br/>
  int j = JOY ^ 0x03ff;  /* keys being held down */
<br/>
  int j_down = j &amp; ~last_joy;  /* keys pressed since last game loop */
<br/>
  int j_up = last_joy &amp; ~j;  /* keys released since last game loop */
<br/>
<br/>
  /* act on j_down and j_up */
<br/>
<br/>
  last_joy = j;
<br/>
}</td> </tr></table><span class="postbody"><br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17386 - dagamer34 - Sun Mar 07, 2004 4:24 am</h4>
    <div class="postbody"><span class="postbody">Just so you know, most games don't check to see if a certain button is pressed at the time of checking, but if it just got pressed compared to last frame.
<br/>
<br/>
One of those things you don't learn in a tutorial.<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17392 - darknet - Sun Mar 07, 2004 6:52 am</h4>
    <div class="postbody"><span class="postbody">Thanks a lot to both of you. 
<br/>
<br/>
In response to daGamer, I understand what you mean, but exactly would your words be implemented?
<br/>
<br/>
If i have a decision that is based upon what button was just pressed, then the button pressing/releasing should be acted upon after a vBlank? I am a little confused.
<br/>
<br/>
In any case, thank you both very much,
<br/>
<br/>
-Mike</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17400 - darknet - Sun Mar 07, 2004 10:36 am</h4>
    <div class="postbody"><span class="postbody">Tepples,
<br/>
<br/>
I read the code you posted and <span style="font-style: italic">think</span> I understand it...however I am unsure as to how to apply it to my problem at hand:
<br/>
<br/>
I have a picture + text based adventure (i.e. a game where you're shown a picture and some text and have to make a decision based on the question at hand---think those old 'choose your own adventure' books).  
<br/>
<br/>
Basically, while I realize it may not be the most efficient way to go about things, I have each screen be a bitmap and I basically want to check button presses at each screen and move to the next screen based upon their decision. For example, each screen gives the user 3 choices, and to get to each choice one has to press a different button. 
<br/>
<br/>
The way i am checking for it now does not work, here's a sample of the code, which shows one screen and 3 decisions...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
    one = true;
<br/>
    drawMode3Background(videoBuffer, stageOne_Bitmap);
<br/>
    
<br/>
    if(one) {
<br/>
           if(pressed(A_BUTTON)) {
<br/>
            while(!pressed(A_BUTTON) &amp;&amp; one);
<br/>
               one = false;
<br/>
               twoA = true;
<br/>
               drawMode3Background(videoBuffer, stageTwoA_Bitmap);
<br/>
         }
<br/>
         
<br/>
         if(pressed(B_BUTTON)) {
<br/>
            while(!pressed(B_BUTTON) &amp;&amp; one);
<br/>
               one = false;
<br/>
               twoB = true;
<br/>
               drawMode3Background(videoBuffer, stageTwoB_Bitmap);
<br/>
         }
<br/>
       }
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
'one' above means they are AT screen one, and so on. The code above does not work at all, and at best will quickly shift through all the screens when a button is pressed.
<br/>
<br/>
So finally, in reference to your suggestion, how would or could that be incorporated?
<br/>
<br/>
Hope this wasn't too long winded,
<br/>
<br/>
Thanks,
<br/>
-Mike[/i]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17404 - yaustar - Sun Mar 07, 2004 2:22 pm</h4>
    <div class="postbody"><span class="postbody">side question: what does the ~ operator do? The articles I have read skipped over it showing it in XOR.
<br/>
<br/>
On the part of the button presses...I do have a extremely poor method that works but will disrupt game flow and tepples method is much better anyway :)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
if(!BUTTON_B)
<br/>
{
<br/>
   while(!BUTTON_B)
<br/>
   {
<br/>
      //do nothing
<br/>
   }
<br/>
}
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17411 - poslundc - Sun Mar 07, 2004 3:54 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yaustar wrote:</b></span></td> </tr> <tr> <td class="quote">side question: what does the ~ operator do? The articles I have read skipped over it showing it in XOR.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
~ is the bit-complement operator in C; it flips the bits of any value/variable.
<br/>
<br/>
Oddly enough, one of the least-documented C operators, considering its importance.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17412 - poslundc - Sun Mar 07, 2004 4:04 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>darknet wrote:</b></span></td> </tr> <tr> <td class="quote">The way i am checking for it now does not work, here's a sample of the code, which shows one screen and 3 decisions...
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
    one = true;
<br/>
    drawMode3Background(videoBuffer, stageOne_Bitmap);
<br/>
    
<br/>
    if(one) {
<br/>
           if(pressed(A_BUTTON)) {
<br/>
            while(!pressed(A_BUTTON) &amp;&amp; one);
<br/>
               one = false;
<br/>
               twoA = true;
<br/>
               drawMode3Background(videoBuffer, stageTwoA_Bitmap);
<br/>
         }
<br/>
         
<br/>
         if(pressed(B_BUTTON)) {
<br/>
            while(!pressed(B_BUTTON) &amp;&amp; one);
<br/>
               one = false;
<br/>
               twoB = true;
<br/>
               drawMode3Background(videoBuffer, stageTwoB_Bitmap);
<br/>
         }
<br/>
       }
<br/>
</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
<br/>
Well, the control system you have set up here is kind of wacky. You have a while loop that will never execute inside a strange choice of control structure.
<br/>
<br/>
Instead of trying to find a way to fix it, I strongly suggest you read up a bit on <a class="postlink" href="http://en.wikipedia.org/wiki/Finite_state_machine" target="_blank">finite state machines</a>. They are an extremely useful concept for setting up game controls for something like the GBA.
<br/>
<br/>
Once you've got that concept down, create the following two states:
<br/>
<br/>
A. Viewing a picture
<br/>
B. Viewing a picture with a button pushed down; waiting for release
<br/>
<br/>
Depending on what state your machine is in, you will want to respond differently to user controls. If you're in state A and the user presses a button, you go to state B. If you're in state B and the user releases the button they were pressing, you swap the picture and go back to state A.
<br/>
<br/>
Finite state machines are probably the most organized and reliable way to design a system like this. Even if you get your current system working it is likely to become unwieldy as you develop further if you don't find a more logical way to organize it.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17415 - Paul Shirley - Sun Mar 07, 2004 5:09 pm</h4>
    <div class="postbody"><span class="postbody">removed</span><span class="gensmall"><br/><br/>Last edited by Paul Shirley on Sun Mar 28, 2004 8:59 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#17446 - Cearn - Mon Mar 08, 2004 9:54 am</h4>
    <div class="postbody"><span class="postbody">Maybe these functions will help
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
u16 key_curr= KEY_ANY, key_prev= KEY_ANY;
<br/>
<br/>
void key_poll()
<br/>
{
<br/>
   key_prev= key_curr;
<br/>
   key_curr= REG_P1;
<br/>
}
<br/>
<br/>
// &lt;EDIT&gt;
<br/>
u16 key_is_down(u16 key)
<br/>
{   return  ~key_curr &amp; key;   }
<br/>
<br/>
u16 key_is_up(u16 key)
<br/>
{   return  key_curr &amp; key;   }
<br/>
// &lt;/EDIT&gt;
<br/>
<br/>
u16 key_transit(u16 key)
<br/>
{   return  (key_curr^key_prev) &amp; key;   }
<br/>
<br/>
u16 key_held(u16 key)
<br/>
{   return ~(key_curr|key_prev) &amp; key;   }
<br/>
<br/>
u16 key_pressed(u16 key)
<br/>
{   return (~key_curr&amp;key_prev) &amp; key;   }
<br/>
<br/>
u16 key_released(u16 key)
<br/>
{   return (key_curr&amp;~key_prev) &amp; key;   }
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
If you call key_poll once a frame, then these functions will tell you
<br/>
EDIT: - if the button is currently down (key_is_down)
<br/>
EDIT: - if the button is currently up (key_is _up)
<br/>
- if the button's state has changed (key_transit)
<br/>
- if it's held down (key_held)
<br/>
- if it's pressed (EDIT: i.e., going down!) this frame (key_pressed)
<br/>
- if it's released (EDIT: i.e., going up!) this frame (key_released)</span><span class="gensmall"><br/><br/>Last edited by Cearn on Wed Mar 10, 2004 1:27 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#17460 - Miked0801 - Mon Mar 08, 2004 8:12 pm</h4>
    <div class="postbody"><span class="postbody">I could see why ~ would be mentioned as xor as it is equivilent to xor'ing a value by 0xFFFFFFFF.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17468 - darknet - Mon Mar 08, 2004 11:54 pm</h4>
    <div class="postbody"><span class="postbody">The FSM structure does sound like the most logical and proper way to structure this portion of my project. I have studied them before, but never in the useful gaming context =) Thanks for that advice..
<br/>
<br/>
<br/>
Thanks too to Cearn for the button pressing/releasing code.  
<br/>
<br/>
My only question so far with it (there may be more unfortunately !) is what key_poll() is setting key_curr to.? What exactly is REG_P1? I am assuming its a register I have defined under a different identifier in my project, but am nonetheless curious. 
<br/>
<br/>
Any help is appreciated,
<br/>
Thanks again,
<br/>
-Mike</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17469 - dagamer34 - Tue Mar 09, 2004 12:11 am</h4>
    <div class="postbody"><span class="postbody">REG_P1 is the key register at 0x04000130. key_poll () is updating the current state of the keys directly from the register.<br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17470 - darknet - Tue Mar 09, 2004 12:34 am</h4>
    <div class="postbody"><span class="postbody">Thats what I thought, just wanted to make sure (i named it something differently).
<br/>
<br/>
Thanks,
<br/>
-Mike</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17473 - darknet - Tue Mar 09, 2004 1:36 am</h4>
    <div class="postbody"><span class="postbody">First of all, I am very sorry for continually asking questions about things I am sure are obvious to most. Hopefully that will soon be the case for me as well =)
<br/>
<br/>
Back to Cearn's code...
<br/>
<br/>
so every VBlank I would call key_poll()....ok
<br/>
<br/>
then when I want to check if a button has been pressed and released would i do the following?
<br/>
<br/>
  if(key_pressed(A_KEY) &amp;&amp; key_released(A_KEY) ) { do something... }
<br/>
<br/>
i notice the functions return unsigned shorts, so i dunno if an 'if' statement can simply check for those two?
<br/>
<br/>
if I am somehow right in that usage, when would the transition functio be used? Why would I ever need to check if the the state has changed?
<br/>
<br/>
OORRR...would I use the code the same way tepples did by basically setting an int to each function AND THEN checking.
<br/>
<br/>
The way I have played around with it has not worked thus far, but I am positive it is my usage of your functions and not the functions themselves.
<br/>
<br/>
Thanks for any feedback,
<br/>
-Mike
<br/>
<br/>
Finally, is the initialization important (the KEY_ANY at the top)?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17477 - DekuTree64 - Tue Mar 09, 2004 3:43 am</h4>
    <div class="postbody"><span class="postbody">My input system works off frame counters for each key. Normally each counter is set to 0xff or any value you want to mean un-pressed. Then if a key is pressed, you set its bit in a var called keyDown, and set its counter to a delay, like 30, which would be half a second. Then each frame, unset its bit in keyPress, and if the key is still down, decrement its counter. If it's not pressed, set it back to 0xff. Then if the counter gets to 0, set its bit in another var called keyHold. 
<br/>
Then you can use keyPress to tell if a key has just been pressed, and keyHold to tell if you've held it down for as long as your delay time. That's good for things like menus where you want to be able to move one space at a time, or move fast if you hold the key down.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17560 - darknet - Wed Mar 10, 2004 6:10 am</h4>
    <div class="postbody"><span class="postbody">Hopefully you guys aren't frustrated with me yet =)...
<br/>
<br/>
For those that are not, I am still having the damndest time trying to implement all of the methods mentioned to me. The closest I've come is with tepples' method, like so:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
  bool onIntros = true;
<br/>
<br/>
 while(onIntros) {
<br/>
<br/>
      int button = *BUTTONS ^ 0x03ff;
<br/>
      int down = button &amp; ~previousButton;   //pressed since last loop
<br/>
      int up = previousButton &amp; ~button;    //released since last loop
<br/>
<br/>
      if(up == A_BUTTON) {
<br/>
         drawMode3Background(videoBuffer, textIntro2_Bitmap);
<br/>
         onIntros = false; 
<br/>
      }
<br/>
}
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
While that doesn't really work, i am assuming there is something wrong with that methodology.
<br/>
<br/>
Alot of people have been saying "each frame do this...," does that specifically mean that you're to check for a button press outside of a method I have defined above? am i to incorporate the waitforVBL function somehow?
<br/>
<br/>
Once again, I apologize to those who do this stuff in their sleep =)
<br/>
Thanks again,
<br/>
-Mike</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17563 - tepples - Wed Mar 10, 2004 7:58 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>darknet wrote:</b></span></td> </tr> <tr> <td class="quote">Alot of people have been saying "each frame do this...," does that specifically mean that you're to check for a button press outside of a method I have defined above? am i to incorporate the waitforVBL function somehow?</td> </tr></table><span class="postbody">
<br/>
Yes. You need a wait4vbl() somewhere in that loop. If you poll too much faster than three times a frame, you'll fall victim to the GBA's bouncy buttons.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17570 - Cearn - Wed Mar 10, 2004 1:23 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>darknet wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
then when I want to check if a button has been pressed and released would i do the following?
<br/>
<br/>
  if(key_pressed(A_KEY) &amp;&amp; key_released(A_KEY) ) { do something... }
<br/>
</td> </tr></table><span class="postbody">
<br/>
Uhm, no this is exactly what you shouldn't do. 
<br/>
key_pressed() gives a non-zero result if the key is going down in that frame, key_released() gives a non-zero result if the key is going up in that frame. Since the two are mutually exclusive it's no surprise nothing happens. Also, for a key to be released it has to be pressed at some point in the past in the first place. There's no need to check for that first. Just using key_released() should work just fine. That's basically what your last code snippet does too, only in a round-about way. If you change the "==" into an "&amp;" that is.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Finally, is the initialization important (the KEY_ANY at the top)?
<br/>
</td> </tr></table><span class="postbody">
<br/>
Only for the first frame. By the way, KEY_ANY is defined as 0x03ff. Basically if you want to see if any key is pressed you'd use 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
if(key_pressed(KEY_ANY) != 0)
<br/>
   blah
<br/>
</td> </tr></table><span class="postbody">
<br/>
Hmmm, now that I think of is, maybe the problem was that key_pressed()doesn't do what you expected it to do. So once again: it does not check whether the key <span style="font-style: italic">is</span> down at that time, only whether it's <span style="font-style: italic">going</span> down. Big difference. To check the current state I use 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
u16 key_is_down(u16 key)
<br/>
{   return ~key_curr &amp; key;   }
<br/>
u16 key_is_up(u16 key)
<br/>
{   return  key_curr &amp; key;    }
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17576 - poslundc - Wed Mar 10, 2004 3:23 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>darknet wrote:</b></span></td> </tr> <tr> <td class="quote">Alot of people have been saying "each frame do this...," does that specifically mean that you're to check for a button press outside of a method I have defined above? am i to incorporate the waitforVBL function somehow?</td> </tr></table><span class="postbody">
<br/>
Yes. You need a wait4vbl() somewhere in that loop. If you poll too much faster than three times a frame, you'll fall victim to the GBA's bouncy buttons.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
More on this subject:
<br/>
<br/>
You know those finite state machines we were talking about? Well this is now how you get around to implementing them.
<br/>
<br/>
Use a global variable to represent the state of your machine. Your machine only ever changes states <span style="font-style: italic">once per frame</span>. This means you should only ever check the status of the <b style="color:#FFA34F">keys</b> once per frame, and you only ever respond to user input once per frame. If you are looking for a sequence of button presses (eg. keydown followed by keyup) then you do it with a sequence of state changes, over as many frames as it takes.
<br/>
<br/>
So your program's main loop will typically look something like:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">while (1)
<br/>
{
<br/>
   HandleInput();   // update state of the FSM ***once only***
<br/>
<br/>
   WaitForVBlank();
<br/>
   DoVBlankStuff();
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
As tepples mentioned, this is also how you debounce the keypad.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17580 - Paul Shirley - Wed Mar 10, 2004 3:56 pm</h4>
    <div class="postbody"><span class="postbody">removed</span><span class="gensmall"><br/><br/>Last edited by Paul Shirley on Sun Mar 28, 2004 8:59 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#17581 - abilyk - Wed Mar 10, 2004 4:31 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Paul Shirley wrote:</b></span></td> </tr> <tr> <td class="quote">Its generally wrong to trigger actions on key releases in most situations, it feels wrong to users. We expect things to happen instantly on the press.</td> </tr></table><span class="postbody">
<br/>
<br/>
In some cases, triggering on a key release is standard and expected.  In most platformers, jump height is dependent on how long the button is held in.  If the button is released before the max. height of the jump, the character will stop moving upward prematurely.
<br/>
<br/>
But in most cases, you're right, don't get me wrong. ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17606 - Paul Shirley - Thu Mar 11, 2004 1:12 am</h4>
    <div class="postbody"><span class="postbody">removed</span><span class="gensmall"><br/><br/>Last edited by Paul Shirley on Sun Mar 28, 2004 8:59 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#17633 - jma - Thu Mar 11, 2004 3:58 pm</h4>
    <div class="postbody"><span class="postbody">The easiest way to do what you want is the way Dragon BASIC does it. A simple function to test if a button was <span style="font-style: italic">just released</span>.
<br/>
<br/>
For example:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define BUTTON_STATE ~(*REG_P1) // 0=released
<br/>
<br/>
u16 KeyUp(u16 *prev,u16 mask)
<br/>
{
<br/>
    u16 now = BUTTON_STATE; // 0=released
<br/>
    u16 released = (*prev) ^ now; // 1=released
<br/>
<br/>
    // update the current state
<br/>
    *prev = now;
<br/>
<br/>
    return (released &amp; mask);
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
What this does is keep polling the player control (assuming you keep calling the function) to check for which buttons have recently been released. The mask is which buttons you care about, OR'd together. Imagine it in a routine:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void DoTitleMenu()
<br/>
{
<br/>
    u16 key_state = BUTTON_STATE; // initialize
<br/>
    u16 released = 0;
<br/>
<br/>
    while((released = KeyUp(&amp;key_state,D_PAD | KEY_A)) != KEY_A) 
<br/>
    {
<br/>
        if (released == KEY_UP) // TODO:
<br/>
        if (released == KEY_DOWN) // TODO:
<br/>
    }
<br/>
<br/>
    // TODO: 'A' was released, menu exited, make choice
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
Bear in mind, I haven't been keeping up with this thread, so if this has already been said, kudos to whoever mentioned it first =). Likewise, as others have probably mentioned, it is best to wait for v-blanks between calls, etc.
<br/>
<br/>
P.S. The above code is untested. I always code in DB or ARM for the GBA, so the above may need some tweaking, but the concept is what is important here...
<br/>
<br/>
Jeff<br/>_________________<br/><a href="mailto:massung@gmail.com">massung@gmail.com</a>
<br/>
<a href="http://www.retrobyte.org" target="_blank">http://www.retrobyte.org</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17747 - delbogun - Sat Mar 13, 2004 8:58 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
int button;
<br/>
<br/>
void ButtonPress( void )
<br/>
{
<br/>
  static int toggle = 0;
<br/>
<br/>
  button = 0;
<br/>
<br/>
  if( toggle &amp;&amp; !( REG_INPUT&amp;KEY ) )
<br/>
  {
<br/>
    button = 1;
<br/>
    toggle = 0;
<br/>
  }
<br/>
<br/>
  if( REG_INPUT&amp;KEY )
<br/>
    toggle = 1;
<br/>
}
<br/>
<br/>
int main( void )
<br/>
{
<br/>
  while( 1 )
<br/>
  {
<br/>
    ButtonPress();
<br/>
<br/>
    if( button )
<br/>
       // do-stuff
<br/>
  }
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Writing from my head, I think this is what I did. Probably clumsy, but it worked.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17857 - darknet - Tue Mar 16, 2004 2:08 am</h4>
    <div class="postbody"><span class="postbody">Well, after tons of trial and error I finally got what I wanted thanks to a mixture of techniques posted in this thread. Thanks for your input everyone (no pun intended!).
<br/>
<br/>
-Mike</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
