<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Sprite is moving by itself on hardware!! argh - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > Sprite is moving by itself on hardware!! argh</h2>
<div id="posts">
<div class="post">
    <h4>#49509 - QuantumDoja - Sat Jul 30, 2005 6:51 pm</h4>
    <div class="postbody"><span class="postbody">Hi, I have a game im writing, I have 2 emulators, NO$GBA and visual boy advance, when I load my game up things appear as expected, the sprite appears on the screen, stationary....when i put the rom onto my gameboy however, it moves off the screen!
<br/>
<br/>
*I have a funny feeling Ive missed something important out of my code.
<br/>
<br/>
here is my game loop
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
//Game Loop
<br/>
DoIntro(); //sets a mode 4 welcome screen
<br/>
DoMenu();
<br/>
while(1) {
<br/>
   SetMode(MODE_0 | OBJ_ENABLE | OBJ_MAP_1D);
<br/>
   LoadAssets(iLevelNumber);
<br/>
   while(1) {
<br/>
      getInput();
<br/>
<br/>
      MoveSprite(&amp;sprites[0],PlayerSprite.x,PlayerSprite.y);
<br/>
      SpriteAnimation();
<br/>
      WaitForVsync();
<br/>
      CopyOAM();
<br/>
      UpdateBackground(&amp;bg0);
<br/>
      UpdateBackground(&amp;bg1);
<br/>
      UpdateBackground(&amp;bg2);
<br/>
      UpdateBackground(&amp;bg3);
<br/>
   }
<br/>
}
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/>Chris Davis</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49511 - tepples - Sat Jul 30, 2005 6:53 pm</h4>
    <div class="postbody"><span class="postbody">What does your WaitForVsync look like? And are you using a BIOS file with the emulators? (A BIOS file improves accuracy, but you have to dump it yourself using a flash card.)<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49512 - QuantumDoja - Sat Jul 30, 2005 6:55 pm</h4>
    <div class="postbody"><span class="postbody">Hi...my vsync looks like this...
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
//VSYNC - wait for screen to stop drawing.
<br/>
void WaitForVsync() {
<br/>
   while((volatile u16)REG_VCOUNT != 160) {}
<br/>
}
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/>Chris Davis</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49514 - tepples - Sat Jul 30, 2005 7:06 pm</h4>
    <div class="postbody"><span class="postbody">This won't fix your main problem, but if you're not yet using the SWI, your WaitForVsync() should look like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
//VSYNC - wait for screen to stop drawing.
<br/>
void WaitForVsync() {
<br/>
   while((volatile u16)REG_VCOUNT == 160) {}
<br/>
   while((volatile u16)REG_VCOUNT != 160) {}
<br/>
}</td> </tr></table><span class="postbody">
<br/>
Otherwise, if one iteration of your game loop executes within 1232 cycles (one scanline), it skips the waiting.
<br/>
<br/>
Now, what do getInput() and SpriteAnimation() do?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49515 - QuantumDoja - Sat Jul 30, 2005 7:12 pm</h4>
    <div class="postbody"><span class="postbody">ok...the other two functions do...
<br/>
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void getInput() {
<br/>
   u16 loop;
<br/>
   
<br/>
   if (keyDown(KEY_LEFT)) {
<br/>
      PlayerSprite.x--;
<br/>
      PlayerSprite.Animation = &amp;Anim0;
<br/>
   }
<br/>
   
<br/>
   if (keyDown(KEY_RIGHT)) {
<br/>
      PlayerSprite.x++;
<br/>
      PlayerSprite.Animation = &amp;Anim1;
<br/>
   }
<br/>
   
<br/>
   if (keyDown(KEY_UP)) {
<br/>
      PlayerSprite.y--;
<br/>
   }
<br/>
   
<br/>
   if (keyDown(KEY_DOWN)) {
<br/>
      PlayerSprite.y++;
<br/>
   }
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void SpriteAnimation(void) {
<br/>
if (framecounter &gt; PlayerSprite.Animation-&gt;times[PlayerSprite.Animation-&gt;Current]) {
<br/>
   memcpy( (u16 *)0x06010000, PlayerSprite.Animation-&gt;sequence[PlayerSprite.Animation-&gt;Current], sizeof(PlayerData4) );
<br/>
   if (PlayerSprite.Animation-&gt;Current == PlayerSprite.Animation-&gt;NumberOfFrames) {
<br/>
      PlayerSprite.Animation-&gt;Current = -1;
<br/>
   }
<br/>
   PlayerSprite.Animation-&gt;Current++;
<br/>
   framecounter = 0;
<br/>
}
<br/>
framecounter++;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
As I have a struct defining a player, the .Animation specifies what animation to play, from a struct.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
Anim0.Current = 0;
<br/>
Anim0.NumberOfFrames = 1;
<br/>
Anim0.sequence[0] = &amp;PlayerData6;
<br/>
Anim0.sequence[1] = &amp;PlayerData3;
<br/>
Anim0.times[0] = 5;
<br/>
Anim0.times[1] = 5;
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/>Chris Davis</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49518 - tepples - Sat Jul 30, 2005 7:57 pm</h4>
    <div class="postbody"><span class="postbody">Are you sure keyDown is doing what you think it's doing?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#49520 - QuantumDoja - Sat Jul 30, 2005 8:45 pm</h4>
    <div class="postbody"><span class="postbody">I think this is where the problem is hiding...as up/down works on the emulator, but not on hardware....i will investigate...thanks for the help.<br/>_________________<br/>Chris Davis</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
