<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Moving lines and circles about and swithcing between both. - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > Moving lines and circles about and swithcing between both.</h2>
<div id="posts">
<div class="post">
    <h4>#146267 - speedemon35 - Sat Dec 01, 2007 7:04 pm</h4>
    <div class="postbody"><span class="postbody">hy to all of you again. I got some quite helpful feedback here last time i think i'll give gba programming a second shot.
<br/>
<br/>
Anyway. My new task consists of a few things: drawing a line(segment to be more precise since it can't take up all the width of height of the screen), drawing a circle, making them move about and have the option of the user pressing 1 key so he can alter between circle and line.
<br/>
<br/>
I've managed to fix up the code for drawing 1 single line. I've also managed in a separate code to draw the circle. But for now my biggest problem is getting them to move around. I figured if i can get the line to move first then it will be almost the same thing to make the circle move so i'll focus only on the line for now. I added in the check buttons thing and all that with the while{1} loop but for some reason its not working properly. Either i'm using the wrong variables inside the loop, or i need to place more variables inside it or my while loop is simply in the wrong place and its doing nothing what so ever:(
<br/>
<br/>
the code is here:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define MULTIBOOT int __gba_multiboot;
<br/>
MULTIBOOT
<br/>
#include &lt;stdlib.h&gt;
<br/>
//declare the function prototype
<br/>
void DrawPixel3(int, int, unsigned short);
<br/>
void DrawLine3(int, int, int, int, unsigned short);
<br/>
//declare some defines for the video mode
<br/>
#define ScreenWidth 240
<br/>
#define ScreenHeight 160
<br/>
#define REG_DISPCNT *(unsigned long*)0x4000000
<br/>
#define MODE_3 0x3
<br/>
#define BG2_ENABLE 0x400
<br/>
//changes the video mode
<br/>
#define SetMode(mode) REG_DISPCNT = (mode)
<br/>
//packs three values into a 15-bit color
<br/>
#define RGB(r,g,b) ((r)+(g&lt;&lt;5)+(b&lt;&lt;10))
<br/>
//Key Definitions from Nokturn's key demo
<br/>
#define KEY_A 1
<br/>
#define KEY_B 2
<br/>
#define KEY_SELECT 4
<br/>
#define KEY_START 8
<br/>
#define KEY_RIGHT 16
<br/>
#define KEY_LEFT 32
<br/>
#define KEY_UP 64
<br/>
#define KEY_DOWN 128
<br/>
#define KEY_R 256
<br/>
#define KEY_L 512
<br/>
//create a pointer to the video buffer
<br/>
unsigned short* videoBuffer = (unsigned short*)0x6000000;
<br/>
volatile int* KEYS = (volatile int*)0x04000130;
<br/>
short col[14];
<br/>
bool buttons[10];
<br/>
// Function: main()
<br/>
int main(void)
<br/>
{
<br/>
int x1,y1,x2,y2;
<br/>
unsigned short color;
<br/>
SetMode(MODE_3 | BG2_ENABLE);
<br/>
while(1)
<br/>
{
<br/>
x1 = 100;
<br/>
y1 = 80;
<br/>
x2 = 140;
<br/>
y2 = 80;
<br/>
color = RGB(31,31,0);
<br/>
DrawLine3(x1,y1,x2,y2,color);
<br/>
}
<br/>
return 0;
<br/>
}
<br/>
void clearscreen()
<br/>
{
<br/>
   int x, y;
<br/>
   unsigned short black= RGB(0,0,0);
<br/>
   
<br/>
   for ( x = 0; x &lt; (ScreenWidth); x+=1)
<br/>
   {
<br/>
      for ( y = 0; y &lt; (ScreenHeight); y+=1)
<br/>
      {DrawPixel3(x,y,black);}
<br/>
   }
<br/>
}
<br/>
void checkbuttons()
<br/>
{
<br/>
   buttons[0] = !((*KEYS) &amp; KEY_A);
<br/>
   buttons[1] = !((*KEYS) &amp; KEY_B);
<br/>
   buttons[2] = !((*KEYS) &amp; KEY_UP);
<br/>
   buttons[3] = !((*KEYS) &amp; KEY_DOWN);
<br/>
   buttons[4] = !((*KEYS) &amp; KEY_LEFT);
<br/>
   buttons[5] = !((*KEYS) &amp; KEY_RIGHT);
<br/>
   buttons[6] = !((*KEYS) &amp; KEY_START);
<br/>
   buttons[7] = !((*KEYS) &amp; KEY_SELECT);
<br/>
   buttons[8] = !((*KEYS) &amp; KEY_L);
<br/>
   buttons[9] = !((*KEYS) &amp; KEY_R);
<br/>
}
<br/>
// Function: DrawPixel3
<br/>
void DrawPixel3(int x, int y, unsigned short color)
<br/>
{
<br/>
videoBuffer[y * 240 + x] = color;
<br/>
}
<br/>
// Function: DrawLine3
<br/>
void DrawLine3(int x1, int y1, int x2, int y2, unsigned short color)
<br/>
{
<br/>
int i, deltax, deltay, numpixels;
<br/>
int d, dinc1, dinc2;
<br/>
int x, xinc1, xinc2;
<br/>
int y, yinc1, yinc2;
<br/>
//calculate deltaX and deltaY
<br/>
deltax = abs(x2 - x1);
<br/>
deltay = abs(y2 - y1);
<br/>
//initialize
<br/>
if(deltax &gt;= deltay)
<br/>
{
<br/>
//If x is independent variable
<br/>
numpixels = deltax + 1;
<br/>
d = (2 * deltay) - deltax;
<br/>
dinc1 = deltay &lt;&lt; 1;
<br/>
dinc2 = (deltay - deltax) &lt;&lt; 1;
<br/>
xinc1 = 1;
<br/>
xinc2 = 1;
<br/>
yinc1 = 0;
<br/>
yinc2 = 1;
<br/>
}
<br/>
else
<br/>
{
<br/>
//if y is independent variable
<br/>
numpixels = deltay + 1;
<br/>
d = (2 * deltax) - deltay;
<br/>
dinc1 = deltax &lt;&lt; 1;
<br/>
dinc2 = (deltax - deltay) &lt;&lt; 1;
<br/>
xinc1 = 0;
<br/>
xinc2 = 1;
<br/>
yinc1 = 1;
<br/>
yinc2 = 1;
<br/>
}
<br/>
//move the right direction
<br/>
if(x1 &gt; x2)
<br/>
{
<br/>
xinc1 = -xinc1;
<br/>
xinc2 = -xinc2;
<br/>
}
<br/>
if(y1 &gt; y2)
<br/>
{
<br/>
yinc1 = -yinc1;
<br/>
yinc2 = -yinc2;
<br/>
}
<br/>
x = x1;
<br/>
y = y1;
<br/>
//draw the pixels
<br/>
for(i = 1; i &lt; numpixels; i++)
<br/>
{
<br/>
DrawPixel3(x, y, color);
<br/>
if(d &lt; 0)
<br/>
{
<br/>
d = d + dinc1;
<br/>
x = x + xinc1;
<br/>
y = y + yinc1;
<br/>
}
<br/>
else
<br/>
{
<br/>
d = d + dinc2;
<br/>
x = x + xinc2;
<br/>
y = y + yinc2;
<br/>
<br/>
while(1)
<br/>
   {
<br/>
      checkbuttons();
<br/>
      
<br/>
      if (buttons[2])
<br/>
      {
<br/>
         if (y &gt; 0)//up
<br/>
         {clearscreen(); y = deltay - 1; DrawLine3(x1,y1,x2,y2,color);}
<br/>
      }
<br/>
      if (buttons[3])//down
<br/>
      {
<br/>
         if (y &lt; (ScreenHeight - 1))
<br/>
         {clearscreen(); y = deltay + 1; DrawLine3(x1,y1,x2,y2,color);}
<br/>
      }
<br/>
      if (buttons[4])
<br/>
      {
<br/>
         if ( x &gt; 0 )//left
<br/>
         {clearscreen(); x = deltax - 1; DrawLine3(x1,y1,x2,y2,color);}
<br/>
      }
<br/>
      if (buttons[5])//right
<br/>
      {
<br/>
         if ( x &lt; (ScreenWidth - 1))
<br/>
         {clearscreen(); x = deltax + 1; DrawLine3(x1,y1,x2,y2,color);}
<br/>
      }
<br/>
    }
<br/>
}
<br/>
}
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
i've tried changing the variables inside the while loop a couple of times already but none of them worked correctly so i just left them at my last attempt to make them work.
<br/>
<br/>
I have a pretty good idea  on how i need to go about letting the user change between circle and line since it should simply follow the same logic as changing a pixels color each time 1 key was pressed. Right now my concern is getting that line to move around.
<br/>
<br/>
Again thank you for your time.
<br/>
<br/>
Sincerely,
<br/>
<br/>
Daniel Mendes.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#146695 - speedemon35 - Fri Dec 07, 2007 8:00 pm</h4>
    <div class="postbody"><span class="postbody">Never mind this thread. i ended up figuring it out and i already submitted my code</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
