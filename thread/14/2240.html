<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>VBlank & HBlank use - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Beginners > VBlank & HBlank use</h2>
<div id="posts">
<div class="post">
    <h4>#11710 - RaBBi - Thu Oct 16, 2003 12:01 pm</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
I would like to know what are the common uses of these two interruptions.
<br/>
<br/>
For the moment, I only use VBLank to copy in OAM.
<br/>
But I read that some effects requires HBlank (like "raster" &gt;&gt; I don't know what it means, or to display more than 128 sprites).
<br/>
<br/>
I'd like to know what is fundamentaly different between them, more than the time execution ^^
<br/>
<br/>
Thanks ^^<br/>_________________<br/>Sorry for my poor english, but it would be worst for you to understand me if I speak in my native language, French ^^</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11715 - niltsair - Thu Oct 16, 2003 4:21 pm</h4>
    <div class="postbody"><span class="postbody">VBlank interupt occurs everytime the screen refresh reach line 160.
<br/>
HBlank interupt occurs everytime the screen refresh reach column 240.
<br/>
The screen refresh itself from left to right then jump one line down. (columns first, then line)
<br/>
<br/>
VBlank is usually used to:
<br/>
1. Keep track of time by creating timers
<br/>
2. Refresh the content of the screen so no flicker occurs(you have 68lines to refresh content)
<br/>
<br/>
HBlank is usually used to:
<br/>
1. Do some visual effects that change various register content so on the next line, the content is different. Example : At the end of every line, you change the value of horizontal scrolling, to create a wave like effect.
<br/>
2. Get more out of the limited video memory. Every 8lines, you could re-use the same sprite by just moving them again. Or you could change the content of tile memory to get more tiles.<br/>_________________<br/>-Inside every large program is a small program struggling to get out. (Hoare's Law of Large Programs)
<br/>
-The man who can smile when things go wrong has thought of someone he can blame it on. (Nixon's Theorem)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11716 - RaBBi - Thu Oct 16, 2003 5:39 pm</h4>
    <div class="postbody"><span class="postbody">Thanks 
<br/>
it's more clear ^^
<br/>
<br/>
But, as frenchy, there are some terms that I don't know :
<br/>
<br/>
- "flicker"
<br/>
<br/>
And why 68 lines?
<br/>
<br/>
And, I think that I'm wrong but, I understood that there are 160 HBlank during one VBlank. 
<br/>
Am I wrong?<br/>_________________<br/>Sorry for my poor english, but it would be worst for you to understand me if I speak in my native language, French ^^</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11717 - niltsair - Thu Oct 16, 2003 6:29 pm</h4>
    <div class="postbody"><span class="postbody">Flicker is a hard to translate, but is roughly equivalent to 'scintillement'. It happens when some part of the screen quickly change to something and then some part of it is wrong.
<br/>
<br/>
The VBlank is use to prevent things like this:
<br/>
Say you're background is a solid black then you decided to change it to blue. But you do so while the screen refresh is in the midle of the screen. For 1 screen, you'll quickly see half of a screen black and the other blue. The next screen refresh, your screen is all blue.
<br/>
<br/>
68 lines is because the GBA goes trhough refreshing 228lines. Only 160 of those are visible, which means that from 160-228 you're free to do what you want without it having any ill effect on the display.
<br/>
<br/>
A HBlank interupt occurs once per line. I'm not certain if they still occurs on the lines that are offscreen. If not, 160 per 1VBlank. If yes, then 228 per 1 VBlank.<br/>_________________<br/>-Inside every large program is a small program struggling to get out. (Hoare's Law of Large Programs)
<br/>
-The man who can smile when things go wrong has thought of someone he can blame it on. (Nixon's Theorem)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11745 - RaBBi - Fri Oct 17, 2003 8:02 pm</h4>
    <div class="postbody"><span class="postbody">Really clear now !
<br/>
I thank you ^^
<br/>
<br/>
But how can I know (detect) that I'm between 160-228 ?<br/>_________________<br/>Sorry for my poor english, but it would be worst for you to understand me if I speak in my native language, French ^^</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11746 - niltsair - Fri Oct 17, 2003 8:13 pm</h4>
    <div class="postbody"><span class="postbody">4 Ways...
<br/>
1- Read the value of the VCount register (VCOUNT )
<br/>
2- Read the value of the Screen status register (DISPSTAT)
<br/>
3- Enable interupt to occurs on a VBlank. The interupt fucntion will get called everytime scanline = 160.
<br/>
4- Enable VCount interupt, you can tell the interupt to happen at a particular scanline.
<br/>
<br/>
Usually, you'll want to do your processing during in a VBlank interupt (3). The WaitForVBlank method you've been using actually just loop untill the DispStat indicate that you've reached scanline 160.
<br/>
<br/>
For more info on the register you'll have to look at the GBATEK document or Cowbyte that are available under the <a href="http://www.gbadev.org" target="_blank">www.gbadev.org</a> --&gt;doc--&gt;general.<br/>_________________<br/>-Inside every large program is a small program struggling to get out. (Hoare's Law of Large Programs)
<br/>
-The man who can smile when things go wrong has thought of someone he can blame it on. (Nixon's Theorem)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11763 - RaBBi - Sat Oct 18, 2003 9:44 am</h4>
    <div class="postbody"><span class="postbody">Oki, I knew VBlank Interrupt (and I used to copy OAM yet), but I think I'll use VCount Interrupt to know how many scanlines are refreshed.
<br/>
<br/>
Can I do some operations like this ? :
<br/>
<br/>
- Enable VBlank Interrupt,
<br/>
- When VBlank is triggered, Enable VCount Interrupt, g_Scanlines = 160,
<br/>
- When VCount is triggered, g_Scanlines++,
<br/>
- When g_Scanlines = 228, reset g_Scanlines to 160, Disable VCount interrupt.
<br/>
<br/>
Is that a good way to do some stuff between 160th and 228th scanlines? ^^<br/>_________________<br/>Sorry for my poor english, but it would be worst for you to understand me if I speak in my native language, French ^^</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11765 - Gopher - Sat Oct 18, 2003 4:37 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
- Enable VBlank Interrupt, 
<br/>
- When VBlank is triggered, Enable VCount Interrupt, g_Scanlines = 160, 
<br/>
- When VCount is triggered, g_Scanlines++, 
<br/>
- When g_Scanlines = 228, reset g_Scanlines to 160, Disable VCount interrupt. 
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
This would work, but is more complicated than needed.
<br/>
<br/>
Triggering the code on the VBlank interrupt is definately the way to go, but then basicly you're making a copy of VCount and incrementing it whenever VCount is incremented. Instead of looping on your own copy, just loop while the actual VCount register is &lt; 228 and it'll work just as well.
<br/>
<br/>
I guess you were trying to avoid waiting on the register, but the comment that you should use interrupts instead of waiting just refered to the empty wait loop you would have in a WaitVBlank() function
<br/>
<br/>
This would be bad
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
while(REG_VCOUNT&lt;228)
<br/>
{
<br/>
  //do nothing
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
but as long as you're doing something inside the loop, it's fine.<br/>_________________<br/>"Only two things are infinite: the universe, and human stupidity. The first is debatable." -Albert Einstein</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11779 - shaktool - Sat Oct 18, 2003 8:34 pm</h4>
    <div class="postbody"><span class="postbody">Hmmm... it seems there are many things you can do with HBlank and VBlank...
<br/>
<br/>
I haven't tested this, but isn't it possible to make a full 15bit color background by changing the color palette between each row?  There are 240 pixels horizontally, and 256 colors, so each pixel could correspond to it's own color in that row, and then in the next row the color palette could be different so each of the pixels in that row could have it's own color too.  In this way, none of the pixels in the background would be forced to share colors with any of the others...(actually, there are 38400 pixels and 32768 possible colors, so a few thousand would kinda have to share, but...)
<br/>
<br/>
The only data that would have to be altered dynamically are the colors in the color palette.  Is there enough time during HBlank to change 240 16-bit values?
<br/>
<br/>
Edit: Yeah, I realize that Modes 3 and 5 are alternative options to full 15-bit color... but they have disadvantages...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11780 - sajiimori - Sat Oct 18, 2003 8:46 pm</h4>
    <div class="postbody"><span class="postbody">No, there is not enough time to modify the entire palette.  There are only 228 cpu cycles per hblank.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#11782 - tepples - Sat Oct 18, 2003 9:33 pm</h4>
    <div class="postbody"><span class="postbody">It takes 4 cycles to copy 2 bytes from EWRAM to VRAM. Therefore, copying 240 colors would take 480 cycles, which would overflow Hblank.
<br/>
<br/>
However, mid-scanline writes to palette memory do in fact work. Thus, by the time the RAMDAC gets to the beginning of the line, the palette copy has reached the middle of the line, and by the time the RAMDAC gets to the middle, the palette copy has reached the end of the line.
<br/>
<br/>
But still, such an Atari 2600 style approach to generating the screen wouldn't have any advantages over mode 3.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12193 - yaustar - Mon Nov 03, 2003 3:37 pm</h4>
    <div class="postbody"><span class="postbody">can someone give me a code snippet to use an interupt for the CopyOAM function as aI dont understand how they are used code wise.<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
