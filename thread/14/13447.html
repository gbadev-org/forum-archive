<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>roll dice code please? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > roll dice code please?</h2>
<div id="posts">
<div class="post">
    <h4>#131498 - ggkfc - Sat Jun 16, 2007 9:05 am</h4>
    <div class="postbody"><span class="postbody">can anyone post up the whole code for making a proggy using palib where it just says "roll dice" on the top and "you rolled" + a rand(1-6) number and refreshes everytime you proess (A) 
<br/>
thnx</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#131500 - felix123 - Sat Jun 16, 2007 10:16 am</h4>
    <div class="postbody"><span class="postbody">What you just described is the perfect first program for a beginner DS programmer. You can probably do it with less than 5 lines.<br/>_________________<br/><a class="postlink" href="http://en.wikipedia.org/wiki/NDSh" target="_blank">Nintendo DS homebrew on Wikipedia</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#131540 - ggkfc - Sun Jun 17, 2007 2:40 am</h4>
    <div class="postbody"><span class="postbody">yea im so noob so don't even know how to do it. mind posting up the code?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#131541 - kusma - Sun Jun 17, 2007 2:51 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include &lt;stdio.h&gt;
<br/>
#include &lt;stdlib.h&gt;
<br/>
<br/>
int main()
<br/>
{
<br/>
   printf("roll dice.");
<br/>
   int value = int(float(rand()) * (6.0 / RAND_MAX));
<br/>
   printf("you rolled: %d\n", value);
<br/>
   return 0;
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
ish.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#131544 - gmiller - Sun Jun 17, 2007 3:43 am</h4>
    <div class="postbody"><span class="postbody">Of course the last code has nothing to do with doing this on a GBA or DS ..</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#131557 - keldon - Sun Jun 17, 2007 8:30 am</h4>
    <div class="postbody"><span class="postbody">What are you trying to achieve? You seem to be starting out at the wrong place - programming is not hard in any way. Anyone can learn to program, it's just like instructing someone to go to the shop.
<br/>
<br/>
Example: I want you to go to the shop and buy me a pack of cigarettes. I want my brand to be Benson and Hedges, <span style="font-weight: bold">if</span> they don't have that brand then buy me <span style="font-weight: bold">Rothman's</span>; and if that fails then buy me some orange juice.
<br/>
<br/>
That is just like a program, you won't get any orange juice unless the shop is out of B&amp;H and Rothman's. All you're doing in programming is writing these instructions.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#131558 - Optihut - Sun Jun 17, 2007 10:52 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>gmiller wrote:</b></span></td> </tr> <tr> <td class="quote">Of course the last code has nothing to do with doing this on a GBA or DS ..</td> </tr></table><span class="postbody">
<br/>
<br/>
Also, 6 divided by RAND_MAX is 0, so value always comes up as zero as well.
<br/>
<br/>
I also would like to know what the aim of the question is. Surely it must be easier to learn by doing than to learn by looking at other people's code (although that can help, of course. Especially when you're stuck.).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#131561 - kusma - Sun Jun 17, 2007 12:18 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Optihut wrote:</b></span></td> </tr> <tr> <td class="quote">Also, 6 divided by RAND_MAX is 0, so value always comes up as zero as well.</td> </tr></table><span class="postbody">
<br/>
Yes, but 6.0 divided by RAND_MAX, like the code I posted uses, isn't 0. It depends on the rand-implementation, and is a small factor that maps random numbers from 0..RAND_MAX to 0..6. There's issues in the code (6 virtually never happens because the int-cast floors - instead the code should use (7.0 - 1e-10) / RAND_MAX or something, and ofcourse, the random seed stays constant, so every time you run the program you get the same pseudo-random number), but your explanation sure does not touch any of them ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#131562 - kusma - Sun Jun 17, 2007 12:22 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>gmiller wrote:</b></span></td> </tr> <tr> <td class="quote">Of course the last code has nothing to do with doing this on a GBA or DS ..</td> </tr></table><span class="postbody">
<br/>
Sure it does, but it can't just be compiled and run on any of them without modifications. You'd have to set up a console etc first. I was trying to show how this usually is done, since he said he had no idea. Sure, it doesn't use PA_lib like he requested, but I can't help him with that, since I'm not a PA_lib-user. Then again, I'm quite sure he can find PA_lib code for setting up whatever is needed for some text-plotting quite easily somewhere else.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#131564 - Optihut - Sun Jun 17, 2007 12:53 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>kusma wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Optihut wrote:</b></span></td> </tr> <tr> <td class="quote">Also, 6 divided by RAND_MAX is 0, so value always comes up as zero as well.</td> </tr></table><span class="postbody">
<br/>
Yes, but 6.0 divided by RAND_MAX, like the code I posted uses, isn't 0. It depends on the rand-implementation, and is a small factor that maps random numbers from 0..RAND_MAX to 0..6. There's issues in the code (6 virtually never happens because the int-cast floors - instead the code should use (7.0 - 1e-10) / RAND_MAX or something, and ofcourse, the random seed stays constant, so every time you run the program you get the same pseudo-random number), but your explanation sure does not touch any of them ;)</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Well, actually it went like this: I compiled your code with dev-cpp and the output was 0. Since I was expecting a number in the range from 1 to 6, I looked at the code and thought "oh, it's because of the division."
<br/>
<br/>
It didn't occur to me that this was actually a random result and that it just happened to be always 0 due to the same seed being used. Thanks for the clarification.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#131567 - chishm - Sun Jun 17, 2007 1:20 pm</h4>
    <div class="postbody"><span class="postbody">I might point out that 0 doesn't appear on a standard die. Use something like:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int value = 1 + int(float(rand()) * (6.0 / (RAND_MAX + 1)));</td> </tr></table><span class="postbody"><br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#131568 - kusma - Sun Jun 17, 2007 1:46 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>chishm wrote:</b></span></td> </tr> <tr> <td class="quote">I might point out that 0 doesn't appear on a standard die. Use something like:
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int value = 1 + int(float(rand()) * (6.0 / (RAND_MAX + 1)));</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
<br/>
Good point. And the "6.0 / (RAND_MAX + 1)"-trick is much neater than the lame epsilon I threw in in my second post. ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#131572 - tepples - Sun Jun 17, 2007 2:45 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>kusma wrote:</b></span></td> </tr> <tr> <td class="quote">And the "6.0 / (RAND_MAX + 1)"-trick is much neater than the lame epsilon I threw in in my second post. ;)</td> </tr></table><span class="postbody">
<br/>
Unless RAND_MAX equals INT_MAX, in which case RAND_MAX + 1 equals -INT_MAX - 1 due to twos complement integer wraparound. Also, use of 'float' or 'double' values isn't the best policy on GBA or DS for reasons that will be explained later.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#131577 - Optihut - Sun Jun 17, 2007 2:54 pm</h4>
    <div class="postbody"><span class="postbody">This is just a general question out of curiosity for kusma and chishm and anyone else who feels like chipping in, really:
<br/>
<br/>
If I understand it correctly, then rand() gives a random number from 0 to RAND_MAX. A printf of RAND_MAX shows that it's 32767 for my program, but for the sake of the argument, let's just take a number from 0 to 9.
<br/>
<br/>
In that case the distribution with kusma's code would be:
<br/>
<br/>
int value = int(float(rand()) * (6.0 / RAND_MAX));
<br/>
0 - 0
<br/>
1 - 0
<br/>
2 - 1
<br/>
3 - 2
<br/>
4 - 2
<br/>
5 - 3
<br/>
6 - 4
<br/>
7 - 4
<br/>
8 - 5
<br/>
9 ? 6
<br/>
<br/>
So the odds for 1, 3, 5 and 6 are 10% each and for 0, 2 and 4 they are 20%.
<br/>
<br/>
With Chishm's code, it would look like this:
<br/>
<br/>
int value = 1 + int(float(rand()) * (6.0 / (RAND_MAX + 1)));
<br/>
<br/>
0-1
<br/>
1-1
<br/>
2-2
<br/>
3-2
<br/>
4-3
<br/>
5-4
<br/>
6-4
<br/>
7-5
<br/>
8-5
<br/>
9-6
<br/>
<br/>
Again the odds for 4 and 6 would be different from the odds for the rest of the numbers.
<br/>
<br/>
The actual distribution would vary with the increase of RAND_MAX, but the problem itself would persist.
<br/>
<br/>
So isn't it better to forget about RAND_MAX and use modulus and truncation ("rerolling" any result that's outside of the dice range of 1-6, while having equal odds for 1 to 6 to occur) in order to get  an equal spread of the numbers?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include &lt;stdio.h&gt;
<br/>
#include &lt;stdlib.h&gt;
<br/>
#include &lt;time.h&gt; 
<br/>
<br/>
int main()
<br/>
{
<br/>
   time_t timer;
<br/>
   time(&amp;timer);
<br/>
   srand((unsigned int)timer);
<br/>
   printf("roll dice.");
<br/>
   int value;
<br/>
do{
<br/>
   value = rand()%10;
<br/>
}while (!(value&gt;0 and value &lt;7));
<br/>
   printf("you rolled: %d\n", value);   
<br/>
   return 0;
<br/>
} 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
EDIT: I've just noticed a limitation of creating a single random number per runtime of the program. Apparently the timer based randomization of the seed seems to change only every second, so if you repeatedly run the program in one second, you get the same number.
<br/>
The obvious solution to this is to have the program run for more than a second, perhaps by creating several pseudo random numbers in one go.
<br/>
<br/>
EDIT Number 2: Ok, so I've just realized that it's only an equal distribution in this case, because RAND_MAX of 32767 ends on a 7. If it were for example 32765, then the 6 would be slightly less likely to come up. Therefore the actual truncation needs to be done beforehand on the random number that is created and needs to be based on the value of RAND_MAX.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#131584 - kusma - Sun Jun 17, 2007 3:21 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Optihut wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
   value = rand()%10;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
This is generally discouraged, because the most significant bits are usually better (ie more random) than the least significant bits in most random algorithms. That's why the float-method are more used.
<br/>
<br/>
Now, the issue you point out is indeed true. Re-rolling is a solution, but with proper rand()-implementations the statistical errors should be neglectable. If you want better randomness, I'd rather use a better random-routine than the one provided by stdlib - it's usually not very good in the first place. The mersianne twister is well known for producing good results, so are other methods. But as always, if you can do without, then don't ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#131585 - Optihut - Sun Jun 17, 2007 3:34 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>kusma wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Optihut wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
   value = rand()%10;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
This is generally discouraged, because the most significant bits are usually better (ie more random) than the least significant bits in most random algorithms. That's why the float-method are more used.</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Ah, I see. I was not aware of that. I thought the aversion to modulus stems from the problem of having an unequal distribution due to the modulus operation. For example, if I just do a 1+(rand()%6) to model a 6 sided die, then the later numbers will be slightly less likely to come up (hence the mod 10 and rerolling).
<br/>
<br/>
Good to know that it's a general issue with the algorithm, though.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#131586 - tepples - Sun Jun 17, 2007 3:40 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>kusma wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Optihut wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
   value = rand()%10;
<br/>
</td> </tr></table><span class="postbody">
<br/>
This is generally discouraged, because the most significant bits are usually better (ie more random) than the least significant bits in most random algorithms.</span></td> </tr></table><span class="postbody">
<br/>
But it's easy to "temper" the distribution by mixing the upper bits into the lower bits. For example:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define RANDMIXING_MAX 32767
<br/>
int randMixing(void) {
<br/>
  int r = rand();
<br/>
  r = r ^ (r &gt;&gt; 16);
<br/>
  return r &amp; 0x7FFF;
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">If you want better randomness, I'd rather use a better random-routine than the one provided by stdlib - it's usually not very good in the first place. The mersianne twister is well known for producing good results, so are other methods.</td> </tr></table><span class="postbody">
<br/>
Mersenne Twister (MT19937) introduces a computation delay after every 624 elements of the sequence. This is OK if you can amortize performance but not if you have a worst-case CPU time ceiling, as many games have.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#131590 - sgeos - Sun Jun 17, 2007 4:39 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Optihut wrote:</b></span></td> </tr> <tr> <td class="quote">   value = rand()%10;
<br/>
</td> </tr></table><span class="postbody">
<br/>
This is LCG (RNG) blasphemy.  Don't do it.  Ever.
<br/>
<br/>
Do something like this instead:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define RNG_M      69069
<br/>
#define RNG_C      1
<br/>
#define RNG_MASK   0x3FFFFFFF
<br/>
#define RNG_SHIFT   15
<br/>
<br/>
typedef unsigned long rng_t;
<br/>
<br/>
rng_t mRngState;
<br/>
<br/>
rng_t rng(void)
<br/>
{
<br/>
   mRngState *= RNG_M;
<br/>
   mRngState += RNG_C;
<br/>
   mRngState &amp;= RNG_MASK;
<br/>
   return mRngState;
<br/>
}
<br/>
<br/>
// return from 0 to (V - 1)
<br/>
int roll(int pRange)
<br/>
{
<br/>
   int result = rng() &gt;&gt; RNG_SHIFT;
<br/>
   result *= pRange;
<br/>
   result = result &gt;&gt; RNG_SHIFT;
<br/>
   return result;
<br/>
}
<br/>
<br/>
rng_t seed(rng_t pSeed)
<br/>
{
<br/>
   int oldSeed = mRngState;
<br/>
   mRngState = pSeed &amp; RNG_MASK;
<br/>
   return oldSeed;
<br/>
}</td> </tr></table><span class="postbody">
<br/>
Note the use of RNG_SHIFT.  That is the important bit.  There are fancier ways to get things done.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Mersenne Twister (MT19937) introduces a computation delay after every 624 elements of the sequence. This is OK if you can amortize performance but not if you have a worst-case CPU time ceiling, as many games have.</td> </tr></table><span class="postbody">
<br/>
Don't worry about it.  Many commercial games use the Mersenne Twister and they probably do a whole lot more than whatever your homebrew app is going to do.
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#131593 - Optihut - Sun Jun 17, 2007 4:54 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">Do something like this instead:</td> </tr></table><span class="postbody">
<br/>
<br/>
You're pulling my leg, right? That looks awfully complicated compared to what people posted on page 1. 
<br/>
<br/>
I'm rather following kusma's advice and am reading up on Mersenne primes and the Mersenne twister (my head hurts) right now.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#131597 - sgeos - Sun Jun 17, 2007 6:53 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Optihut wrote:</b></span></td> </tr> <tr> <td class="quote">You're pulling my leg, right?</td> </tr></table><span class="postbody">
<br/>
Not at all.  That is what a linear congruental generator looks like under the hood.  That is all you should need.  It has been tested and works.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Optihut wrote:</b></span></td> </tr> <tr> <td class="quote">That looks awfully complicated compared to what people posted on page 1.</td> </tr></table><span class="postbody">
<br/>
This is what a range function using rand() looks like.  The code posted on the first page is a version of this with hard coded values.  This function is untested and may require a cast to float somewhere.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int roll(int pMin, int pMax)
<br/>
{
<br/>
   int range = pMax - pMin + 1;
<br/>
   return pMin + (int) (range * (rand() / (RAND_MAX + 1.0)));
<br/>
}</td> </tr></table><span class="postbody">The rand man page is good reading.  <a class="postlink" href="http://www.die.net/doc/linux/man/man3/rand.3.html" target="_blank">man rand</a>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Optihut wrote:</b></span></td> </tr> <tr> <td class="quote">I'm rather following kusma's advice and am reading up on Mersenne primes and the Mersenne twister (my head hurts) right now.</td> </tr></table><span class="postbody">
<br/>
This is a good idea.  The Mersenne Twister is a far better RNG than rand() and the simple LCG I posted above.  (This will not matter for a game.)
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
