<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Need help with simple sprite program - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Beginners > Need help with simple sprite program</h2>
<div id="posts">
<div class="post">
    <h4>#33585 - ymalik - Wed Jan 05, 2005 8:29 pm</h4>
    <div class="postbody"><span class="postbody">The following program displays a messed up sprite (that's the best way I can describe it).  The messed up sprite scrolls fine, though.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include "stuff.h"
<br/>
#include "mario.raw.c"
<br/>
#include "mario.pal.c"
<br/>
<br/>
void wait_vblank();
<br/>
void process_buttons(s16 *, s16 *);
<br/>
<br/>
int main(void)
<br/>
{
<br/>
   s16 x = 10, y = 10;
<br/>
   int i;
<br/>
   u16 char_number = 0;
<br/>
   Sprite sprite[128];
<br/>
<br/>
   SetMode(2 | OBJ_ENABLE | OBJ_MAP_1D);
<br/>
<br/>
   // initialize sprites
<br/>
//   for(i = 0; i &lt; 128; i++)
<br/>
//   {
<br/>
//      sprite[0].attribute0 = 160;
<br/>
//     sprite[0].attribute1 = 240;
<br/>
//   }
<br/>
<br/>
   // copy sprite palette
<br/>
   for(i = 0; i &lt; 256; i++)
<br/>
      SpritePal[i] = mario_Palette[i];
<br/>
      
<br/>
   // copy sprite data
<br/>
   for(i = 0; i &lt; 4096; i++)
<br/>
      SpriteData[i] = mario_Bitmap[i];
<br/>
<br/>
   sprite[0].attribute0 = COLOR_16 | y;
<br/>
   sprite[0].attribute1 = SIZE_64 | x;
<br/>
   sprite[0].attribute2 = char_number;
<br/>
<br/>
   while(1)
<br/>
   {
<br/>
      process_buttons(&amp;x, &amp;y);
<br/>
<br/>
      sprite[0].attribute0 &amp;= 0;
<br/>
      sprite[0].attribute0 = COLOR_16 | y;
<br/>
      sprite[0].attribute1 &amp;= 0;
<br/>
      sprite[0].attribute1 = SIZE_64 | x;
<br/>
<br/>
      wait_vblank();
<br/>
      
<br/>
      SpriteMem[0] = sprite[0].attribute0;
<br/>
      SpriteMem[1] = sprite[0].attribute1;
<br/>
      SpriteMem[2] = sprite[0].attribute2;
<br/>
      SpriteMem[3] = sprite[0].attribute3;
<br/>
   }
<br/>
   
<br/>
   return 0;
<br/>
}
<br/>
<br/>
void process_buttons(s16 *x, s16 *y)
<br/>
{
<br/>
   if(!(*BUTTONS &amp; BUTTON_LEFT))
<br/>
      (*x)--;
<br/>
   if(!(*BUTTONS &amp; BUTTON_RIGHT))
<br/>
      (*x)++;
<br/>
   if(!(*BUTTONS &amp; BUTTON_UP))
<br/>
      (*y)--;
<br/>
   if(!(*BUTTONS &amp; BUTTON_DOWN))
<br/>
      (*y)++;
<br/>
}
<br/>
<br/>
void wait_vblank(void)
<br/>
{
<br/>
   while(!(REG_DISPSTAT &amp; 1));
<br/>
   while(REG_DISPSTAT &amp; 1);
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
The sprite is a 4 bit 64x64.  I created the sprites by using gba2gfx as follows:
<br/>
gfx2gba -t8 -pmario.pal -fsrc mario.bmp
<br/>
<br/>
I can't use pcx2sprite because I don't know how to make PCX files.
<br/>
<br/>
Thanks,
<br/>
Yasir</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#33631 - dj-ceejay - Thu Jan 06, 2005 5:58 am</h4>
    <div class="postbody"><span class="postbody">gfx2gba is used for creating backgrounds I believe.
<br/>
pcx2sprite is used to create a sprite &amp; palette header file.
<br/>
<br/>
You could use a bmp-pcx converter. I did a quick google search but I couldn't find a free one.
<br/>
Here are some that look good:
<br/>
<a class="postlink" href="http://www.convertzone.com/net/cz-abc%20amber%20image%20converter-bmp-pcx.htm" target="_blank">http://www.convertzone.com/net/cz-abc%20amber%20image%20converter-bmp-pcx.htm</a>
<br/>
<a class="postlink" href="http://www.graphic-converter.net/" target="_blank">http://www.graphic-converter.net/</a>
<br/>
<a class="postlink" href="http://www.batchconverter.com/image-converter.html" target="_blank">http://www.batchconverter.com/image-converter.html</a>
<br/>
<br/>
Which graphics program are you using?<br/>_________________<br/>Fruit Machine Games:
<br/>
<a class="postlink" href="http://www.fmsoftware.info/" target="_blank">http://www.fmsoftware.info/</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#33649 - Fatnickc - Thu Jan 06, 2005 11:11 am</h4>
    <div class="postbody"><span class="postbody">I thought the gfx2... came in gfx2gba and gfx2sprite. You'll use sprite. I used to use gfx2gba, but it never worked for me, so now I use PCX2SPRITE and PCX2GBA. Once you've told us which graphics program you are using, I could probably help you to get a PCX image. '
<br/>
On the subject of gfx2gba, someone we all know is going to come round shouting 'frontend, frontend'.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#33660 - ymalik - Thu Jan 06, 2005 4:09 pm</h4>
    <div class="postbody"><span class="postbody">I'm using MS Paint to create my images and saving them as BMP files.  gfx2sprite can create tiles with the -t8 options and a palette as well.  Isn't that all you need to create a sprite?  An image broken up into tiles is an image broken up into tiles whether you are dealing with sprites or backgrounds, right?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#33672 - Fatnickc - Thu Jan 06, 2005 7:05 pm</h4>
    <div class="postbody"><span class="postbody">OK. Well, with MS Paint I suppose you can only use that gfx2gba, as it doesn't like PCX and indexed colours. Yes, there isn't gfx2sprites. I can't really help you with this, but, if ever you get Photoshop Elements, you knwo where I am ;).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#33674 - DekuTree64 - Thu Jan 06, 2005 7:39 pm</h4>
    <div class="postbody"><span class="postbody">You can use the same tile data on backgrounds and sprites, but most programs that convert images for backgrounds also remove any duplicate tiles, or ones that could be H/V flipped or palette swapped (if 4-bit). Since sprites can only use a straight strip of tiles with no per-tile flipping/palette, the data usually can't be used in both.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#33675 - yaustar - Thu Jan 06, 2005 7:54 pm</h4>
    <div class="postbody"><span class="postbody">I found gif2sprite the easiest tool to use for sprite converting.<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#33703 - ymalik - Fri Jan 07, 2005 2:32 am</h4>
    <div class="postbody"><span class="postbody">Thanks, yaustar, gifs2sprites works fine.  But I have some questions about the output and my program:
<br/>
1. If each value in the tiles array is supposed to be an index into the palette array, why do I see values like 0x4444 in the tiles array generated by gifs2sprite?  The palette array only has 8 values.
<br/>
2. Why does the tile array generated by gifs2sprite have 1024 and 2048 values in 16 color and 256 color images, respectively? Shouldn't it be 4096, which is the number of pixel in a 64x64 image?
<br/>
3. When I scroll left to right, the image scrolls fine, i.e. the image wraps around.  But when I go up close to the top of the screen, why does the image disappear?
<br/>
4. In part of my code, I commented out the part that begins with // initialize sprites.  Do I have to initialize all the 126 sprites or just the sprites that I'm going to use use (for example, just one)?
<br/>
<br/>
Thanks,
<br/>
Yasir</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#33709 - ymalik - Fri Jan 07, 2005 4:51 am</h4>
    <div class="postbody"><span class="postbody">Ok, I figured out 1 and 2.  But what about 3 and 4?  Also, gifs2sprites does not support images with frames of animation (two 64x64 images next to each other).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#33711 - ymalik - Fri Jan 07, 2005 5:51 am</h4>
    <div class="postbody"><span class="postbody">Ok, I answered question 3 and 4.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#33714 - tepples - Fri Jan 07, 2005 8:16 am</h4>
    <div class="postbody"><span class="postbody">To convert multiple sprite cels in a 1D mapping mode, just stack the cels vertically.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#33732 - Quirky - Fri Jan 07, 2005 8:17 pm</h4>
    <div class="postbody"><span class="postbody">I use Irfanview to convert between image formats. For my pixel pushing needs I use a combination of MS Paint (.bmp) and Deluxe Paint II (.pcx) 
<br/>
<br/>
I use MS Paint to copy chunks between images, saving as 24-bit bitmaps (otherwise it randomly messes up the colours) then open the image in Irfan, downsample to 256 colour, which causes no quality loss as it already has less than 256 colours, then Save As a PCX file. I can then fix any palette indexing problems in Deluxe Paint, and it has a nicer interface for doodling.
<br/>
<br/>
The cel problem... gfx2gba (v0.13 by Markus, not the other gfx2gba) can generate "meta-tiles" that don't depend on the image's physical cel layout.  I use a flag "-T16" to generate 16x16 cels, -T64 would generate 64x64 cels. This is also handy for avoiding font images that are really tall and skinny, something that other conversion programs force you to do.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
