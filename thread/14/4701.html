<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Plotting Tiles - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > Plotting Tiles</h2>
<div id="posts">
<div class="post">
    <h4>#32755 - QuantumDoja - Sat Dec 25, 2004 10:07 pm</h4>
    <div class="postbody"><span class="postbody">Hi, I have a 1D array that stores all of my tiles, is there a special way i am supposed to draw them to the screen, or can i simply go:
<br/>
<br/>
get map next tile
<br/>
draw tile
<br/>
loop
<br/>
<br/>
?????<br/>_________________<br/>Chris Davis</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#32757 - Lord Graga - Sat Dec 25, 2004 11:25 pm</h4>
    <div class="postbody"><span class="postbody">uhm...
<br/>
<br/>
<br/>
there are several ways to load maps, but it's really just a standard datatransfer to the memory. Let us start off with the slowest, but most "understandable":
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define SCREENBASE    24
<br/>
<br/>
//Insert tile loading routine here
<br/>
<br/>
u16* mapmem = 0x6000000+0x800*SCREENBASE;
<br/>
int x, y;
<br/>
for(x = 0; x &lt; 32; x++)
<br/>
{
<br/>
   for(y = 0; y &lt; 32; y++)
<br/>
   {
<br/>
      mapmem[x+y*32] = map[x+y*32];
<br/>
   }
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
Don't use the code about. It's slow and ugly.
<br/>
<br/>
<br/>
Then we improve it a bit:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define SCREENBASE    24
<br/>
<br/>
u16* mapmem = 0x6000000+0x800*SCREENBASE;
<br/>
int i;
<br/>
for(i=0;i&lt;32*32;i++) mapmem[i] = map[i];</td> </tr></table><span class="postbody">
<br/>
<br/>
Looks a little better.
<br/>
<br/>
<br/>
But, in the end, let us use a BIOS call (grab some headers from libgba):
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define SCREENBASE    24
<br/>
<br/>
CPUFastSet((void*)&amp;map,(void*)0x6000000+0x800*SCREENBASE,512);</td> </tr></table><span class="postbody">
<br/>
<br/>
That is prolly one of the fastest methods that you can do, and it's easy to understand. Use CPUFastSet as much as you can :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#32770 - Cearn - Mon Dec 27, 2004 5:11 pm</h4>
    <div class="postbody"><span class="postbody">errr, yeah, what he said, CpuFastSet is great. Just make sure you understand what the arguments are first. From <a class="postlink" href="http://www.work.de/nocash/gbatek.htm#biosmemorycopy" target="_blank">GBATek, BIOS routines</a>:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Memory copy/fill in units of 32 bytes. Memcopy is implemented as repeated LDMIA/STMIA [Rb]!,r2-r9 instructions. Memfill as single LDR followed by repeated STMIA [Rb]!,r2-r9.
<br/>
The length must be a multiple of 32 bytes. The wordcount in r2 must be length/4, ie. length in word units rather than byte units.
<br/>
  r0    Source address        (must be aligned by 4)
<br/>
  r1    Destination address   (must be aligned by 4)
<br/>
  r2    Length/Mode
<br/>
          Bit 0-15  Wordcount (must be multiple of 8 WORDs, ie. 32 bytes)
<br/>
          Bit 24    Fixed Source Address (0=Copy, 1=Fill by WORD[r0])
<br/>
</td> </tr></table><span class="postbody">
<br/>
I.e., first argument is source address, second arg is destination and third arg is the <span style="font-weight: bold">word-count</span>, not the number of bytes. That's why it's 512 and not 32*32=1024.
<br/>
<br/>
Using DMA will work too, of course, in fact it's probably just a little bit faster. (In case you're interested, I did a little speed test of various copying methods <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?p=32478" target="_blank">here</a>).</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
