<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>speed too fast - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Beginners > speed too fast</h2>
<div id="posts">
<div class="post">
    <h4>#72854 - naleksiev - Wed Feb 22, 2006 4:09 am</h4>
    <div class="postbody"><span class="postbody">What is wrong with my code or my calculation?
<br/>
<br/>
I have this code
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void WaitForVSync() {
<br/>
   while (*(vu16*)&amp; *(u16*)0x4000006 != 160) {   }
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">...
<br/>
int frame = 0;
<br/>
while (1) {
<br/>
      WaitForVSync();
<br/>
      SetPosition(1, 0, frame/60);
<br/>
      frame++;
<br/>
   }
<br/>
...</td> </tr></table><span class="postbody">
<br/>
<br/>
Because I have only ~60 VBlanks per second I think I need to have different value for frame/60 on ~1 second. It's pretty fast about. About 8 times faster. I tried this on real device GB Micro. It's still fast about 6 times faster. 
<br/>
<br/>
<span style="font-weight: bold">First do you have any idea why this is so fast?</span>
<br/>
<span style="font-weight: bold">Second why I have such differense between the real device and the emulator?</span> SetPosition is pretty simple function just one line that is changing the offset ot one of the backgrounds.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#72860 - tepples - Wed Feb 22, 2006 5:09 am</h4>
    <div class="postbody"><span class="postbody">You need to wait for it to not equal 160, and then you need to wait for it to equal 160.
<br/>
<br/>
In addition, the syntax is a bit baroque to say the least. Try this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void WaitForVSync() {
<br/>
   while (*(vu16*)0x4000006 != 160) {   }
<br/>
}</td> </tr></table><span class="postbody"><br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#72871 - poslundc - Wed Feb 22, 2006 5:45 am</h4>
    <div class="postbody"><span class="postbody">To expand on the reason why this is happening: your VBlank routine completes before the GBA's current scanline advances past 160, so when your loop executes a second time the wait-until condition is still false.
<br/>
<br/>
Also: you should refer to registers by meaningful macro names and not by literal address. You are writing code that will wind up being impossible to read or maintain.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#72978 - Ultima2876 - Wed Feb 22, 2006 7:33 pm</h4>
    <div class="postbody"><span class="postbody">&gt;=( now go to bed with no dinner! *shot*
<br/>
<br/>
He's right though, code like that quickly gets out of hand. Use some macros, they can't hurt ^_~</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#72987 - naleksiev - Wed Feb 22, 2006 8:03 pm</h4>
    <div class="postbody"><span class="postbody">Calm down please.
<br/>
<br/>
I'm sorry that I post such code but I made so many changes I take a look at so many versions of the WaitForVSync() that suppose to work but not in my case. I just start testing them one by one to see is there any difference. It's not a code that I wrote. And if you don't see post this in <span style="font-weight: bold">Beginners</span>.
<br/>
<br/>
Ultima2976 if you don't want to help just ignore Beginners forum. OK?
<br/>
<br/>
And btw thanks for the replies I understand my mistake.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
