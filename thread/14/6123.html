<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>trying to teach myself. verbatim demo doesn't work. - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > trying to teach myself. verbatim demo doesn't work.</h2>
<div id="posts">
<div class="post">
    <h4>#46276 - pr0vidence - Wed Jun 22, 2005 6:26 pm</h4>
    <div class="postbody"><span class="postbody">Greetings all. 
<br/>
Been trying to teach myself via all of the tutorials out there to program for the GBA with some success.
<br/>
<br/>
I am currently trying to get a basic picture to display on screen. I have copied the example from the tutorial verbaTim but it does not work.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include "gba.h"
<br/>
#include "background.h"
<br/>
<br/>
int main()
<br/>
{
<br/>
   u8 x,y;
<br/>
   u16 loop;
<br/>
   
<br/>
   SetMode (MODE_4 | BG2_ENABLE );
<br/>
   
<br/>
   for(loop=0;loop&lt;256;loop++)
<br/>
   {BGPaletteMem[loop]=backgroundPalette[loop];}
<br/>
<br/>
   /*for(x=0;x&lt;(120*160);x++)
<br/>
      {
<br/>
<br/>
         FrontBuffer[x]=backgroundData[x];
<br/>
      }*/
<br/>
   for (y=0;y&lt;160;y++)
<br/>
   {
<br/>
      for(x=0;x&lt;120;x++)
<br/>
      {
<br/>
         FrontBuffer[ (y*120)+x] = backgroundData[(y*120)+x];
<br/>
      }
<br/>
   }
<br/>
         
<br/>
   return(0);
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
The tutorial I used offers two examples to perform the same task, as you can see form the commented secion, I have tried both examples. Both give the same result. When I compile (no errors) and run it in VisualBoy Advance, it throws up a solid green screen. What have I dont wrong???
<br/>
<br/>
Thanks all in advance.
<br/>
<br/>
-pr0v</span><span class="gensmall"><br/><br/>Last edited by pr0vidence on Wed Jun 22, 2005 8:48 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#46277 - poslundc - Wed Jun 22, 2005 6:31 pm</h4>
    <div class="postbody"><span class="postbody">Copied it <span style="font-style: italic">verbatim</span>...? Are you sure there wasn't a "while (1)" in there?
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46280 - pr0vidence - Wed Jun 22, 2005 6:42 pm</h4>
    <div class="postbody"><span class="postbody">Positive.
<br/>
<br/>
This is the tutorial I was copying from:
<br/>
<br/>
<a class="postlink" href="http://home.no/neogeo/HOVEDSIDE_INDEX/GBA_HOVEDSIDE_INDEX_ENGELSK/GBA%20HTML%20LEKSJONER%201-5/GBA_Lek3_english.htm" target="_blank">http://home.no/neogeo/HOVEDSIDE_INDEX/GBA_HOVEDSIDE_INDEX_ENGELSK/GBA%20HTML%20LEKSJONER%201-5/GBA_Lek3_english.htm</a>
<br/>
<br/>
all the way at the bottom
<br/>
<br/>
I should say NEARLY verbaTim because I had to chance BG_PaletteMem to BGPaletteMem to coincide with the gba.h that I am using.
<br/>
<br/>
also I added "return(0);" to keep the compiler from complaining.
<br/>
<br/>
Thanks
<br/>
-pr0v
<br/>
<br/>
EDIT: for spelling verbaTIM, I don't know why I kept missing the T.</span><span class="gensmall"><br/><br/>Last edited by pr0vidence on Wed Jun 22, 2005 8:47 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#46281 - yaustar - Wed Jun 22, 2005 6:48 pm</h4>
    <div class="postbody"><span class="postbody">have you checked the VRAM using VBA to see if everything has been loaded properly?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46284 - poslundc - Wed Jun 22, 2005 6:57 pm</h4>
    <div class="postbody"><span class="postbody">Try adding a "while (1);" on the line before "return (0);".
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46286 - strager - Wed Jun 22, 2005 7:05 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include "gba.h"
<br/>
#include "background.h"
<br/>
<br/>
int main()
<br/>
{
<br/>
   int x,y;
<br/>
   int loop;
<br/>
   
<br/>
   SetMode (MODE_4 | BG2_ENABLE );
<br/>
   
<br/>
   for(loop=0;loop&lt;256;loop++)
<br/>
   {BGPaletteMem[loop]=backgroundPalette[loop];}
<br/>
<br/>
   /*for(x=0;x&lt;(120*160);x++)
<br/>
      {
<br/>
<br/>
         FrontBuffer[x]=backgroundData[x];
<br/>
      }*/
<br/>
   for (y=0;y&lt;160;y++)
<br/>
   {
<br/>
      for(x=0;x&lt;120;x++)
<br/>
      {
<br/>
         FrontBuffer[ (y*120)+x] = backgroundData[(y*120)+x];
<br/>
      }
<br/>
   }
<br/>
<br/>
        while(1);
<br/>
   return(0);
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
What are FrontBuffer, backgroundpalette, BGPaletteMem, and backgroundData defined as?  Make sure than in background.h and .c that your arrays are defined as const.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46299 - pr0vidence - Wed Jun 22, 2005 9:04 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yaustar wrote:</b></span></td> </tr> <tr> <td class="quote">have you checked the VRAM using VBA to see if everything has been loaded properly?</td> </tr></table><span class="postbody">
<br/>
<br/>
ok, just did that, the VRAM seems to match the data that's in background.h at least the first dozen or so do.
<br/>
<br/>
background.h was created from a PCX file using PCX2GBA, yes both arrays are const.
<br/>
<br/>
Dan, adding the while(1); produces the same result.
<br/>
<br/>
strager:
<br/>
FrontBuffer = #define FrontBuffer ((u16*)0x6000000)
<br/>
BGPaletteMem = #define GBPaletteMem ((u16*)0x5000000)
<br/>
the gba.h I am using is the one supplied by dovoto in his tutorial set.
<br/>
<br/>
Here is the image I am trying to display, I know it's nothing fancy just something I blotched on with colors as a test pattern:
<br/>
<br/>
<a class="postlink" href="http://www.boomspeed.com/pr0vidence/gba/background.pcx" target="_blank">http://www.boomspeed.com/pr0vidence/gba/background.pcx</a>
<br/>
<br/>
and here is the background.h that PCX2GBA created:
<br/>
<a class="postlink" href="http://www.boomspeed.com/pr0vidence/gba/background.h" target="_blank">http://www.boomspeed.com/pr0vidence/gba/background.h</a>
<br/>
<br/>
Thanks for trying to help me everyone, I do appreciate it
<br/>
<br/>
-pr0v</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46302 - strager - Wed Jun 22, 2005 9:49 pm</h4>
    <div class="postbody"><span class="postbody">Odd.
<br/>
<br/>
Did you try setting the rotation/scaling parameters?  That might be the reason why only green is displayed, because the top-left pixel is green...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46304 - pr0vidence - Wed Jun 22, 2005 10:01 pm</h4>
    <div class="postbody"><span class="postbody">I don't believe I have, how would I go about doing that?
<br/>
<br/>
-pr0v</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46306 - pr0vidence - Wed Jun 22, 2005 10:22 pm</h4>
    <div class="postbody"><span class="postbody">ok... some nosing around with VBA presented some interesting things.
<br/>
<br/>
here is the compiled ROM, if you wish to take a look
<br/>
<br/>
<a class="postlink" href="http://www.boomspeed.com/pr0vidence/gba/imagedisp.gba" target="_blank">http://www.boomspeed.com/pr0vidence/gba/imagedisp.gba</a>
<br/>
<br/>
If you open it in VBA you get the green screen.
<br/>
<br/>
If you open the Palette Viewer, you get the palette as it should be, there's only four colors in the test pattern I threw together.
<br/>
<br/>
If you open Tools -&gt; Map Viewer, my image shows up, so it's IN there as it should be.... yet for some reason is not being displayed properly on screen. Maybe that gives someone a hint?
<br/>
<br/>
-pr0v</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46307 - DekuTree64 - Wed Jun 22, 2005 10:33 pm</h4>
    <div class="postbody"><span class="postbody">Yep, your rotation values are set wrong. Not sure why though, they should start up initialized to display as normal.
<br/>
<br/>
To fix it put this somewhere (anywhere will work, might as well put it by the SetMode for clarity):
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">REG_BG2PA = 256;
<br/>
REG_BG2PB = 0;
<br/>
REG_BG2PC = 0;
<br/>
REG_BG2PD = 256;</td> </tr></table><span class="postbody">
<br/>
<br/>
That will scale to normal size with no rotation.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"><br/><br/>Last edited by DekuTree64 on Wed Jun 22, 2005 10:50 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#46308 - pr0vidence - Wed Jun 22, 2005 10:41 pm</h4>
    <div class="postbody"><span class="postbody">SUCCESS!
<br/>
<br/>
thanks a lot!
<br/>
<br/>
(I had to change a few "P"s to "B"s but it works)
<br/>
<br/>
now can you tell me what, exactly, those mean what what it did to fix it? Will I need to just include those four lines in any program I write?
<br/>
<br/>
-pr0v</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#46310 - DekuTree64 - Wed Jun 22, 2005 11:17 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>pr0vidence wrote:</b></span></td> </tr> <tr> <td class="quote">(I had to change a few "P"s to "B"s but it works)</td> </tr></table><span class="postbody">
<br/>
Oops, sorry about that :)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">now can you tell me what, exactly, those mean what what it did to fix it? Will I need to just include those four lines in any program I write?</td> </tr></table><span class="postbody">
<br/>
It' sort of a rotation matrix. If you've ever written a rotozoomer effect, you've done what the hardware does.
<br/>
<br/>
Basically PA is `x per x', PB is `x per y', PC is `y per x', and PD is `y per y'.
<br/>
Each time the hardware advances one pixel to the right, it adds PA to x and PC to y in its internal accumulators.
<br/>
Each time it advances one row down, it adds PB to x and PD to y.
<br/>
<br/>
The values are 8-bit fixed-point, so 256 is 1.
<br/>
When they're set to 1,0,0,1, that means each time it advances one x pixel, it adds PA (1) to x, and PC (0) to y. That just advances one x pixel per x pixel, so no scaling.
<br/>
Then each y pixel, it adds PB (0) to x, and PD (1) to y, so one y pixel per y pixel, again no scaling.
<br/>
<br/>
For rotation, you set them like
<br/>
PA = cos(angle)
<br/>
PB = sin(angle)
<br/>
PC = -sin(angle)
<br/>
PD = cos(angle)
<br/>
<br/>
Which if you look at, when then angle is 0, cos(0) is 1, and sin(0) is 0, so you get 1,0,0,1, same as we hardcoded to before.
<br/>
At 90 degrees, you get cos(90)=0, sin(90)=1, -sin(90)=-1, cos(90)=0.
<br/>
Then each X pixel you move 0x, -1y. Each y pixel, you move 1x, 0y. Successfully rotated clockwise around the top left corner of the screen.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
