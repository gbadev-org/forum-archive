<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Trying to make a timer interrrupt - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Beginners > Trying to make a timer interrrupt</h2>
<div id="posts">
<div class="post">
    <h4>#102627 - Tails86 - Fri Sep 15, 2006 7:47 pm</h4>
    <div class="postbody"><span class="postbody">I have never worked with interrupts before. I have always been taught the basic concept of an interrupt, but I have no experience of programming one. 
<br/>
<br/>
I decided to take a whack at it and tried programming a counter that went up every 100mS. I wrote this program, but all that shows up on the screen is a 0. This shows that it is going into the interrupt at least once.
<br/>
<br/>
I tried to use a global variable to count how many times the interrupt has been activated instead of using another timer as an overflow, but that still didnt work.
<br/>
<br/>
Am I setting up the interrupt right?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#include &lt;mygba.h&gt;
<br/>
MULTIBOOT
<br/>
 #include "main.h"
<br/>
<br/>
void outlights(void)
<br/>
{
<br/>
  unsigned int interrupts = REG_IF;
<br/>
    char str[20];
<br/>
  if(interrupts &amp; INT_TIMER0)
<br/>
  {
<br/>
       unsigned int count=REG_TM1D;
<br/>
   WaitVBlank();
<br/>
    DrawBox3(140,30,180,38,0x0000);
<br/>
    sprintf(str,"%i",count);
<br/>
    Print(140,30,str,0xFF0);    
<br/>
  }
<br/>
  *(unsigned short *)0x03fffff8 |= interrupts;
<br/>
  REG_IF = interrupts;
<br/>
}
<br/>
<br/>
int main(void)
<br/>
{
<br/>
   ham_Init();
<br/>
<br/>
    REG_IME=0x00;
<br/>
    REG_INTERUPT=(u32)outlights;
<br/>
    REG_IE |= INT_TIMER0;
<br/>
    REG_IME=0x01;
<br/>
    
<br/>
    REG_DISPCNT = (3 | BG2_ENABLE);
<br/>
    
<br/>
    //start timer, overflow every .1 seconds
<br/>
    REG_TM0D=63898;
<br/>
    REG_TM0CNT = TIMER_FREQUENCY_1024 | TIMER_ENABLE;
<br/>
    REG_TM1CNT = TIMER_OVERFLOW | TIMER_ENABLE;   
<br/>
    
<br/>
   while(true)
<br/>
   {
<br/>
      ;
<br/>
   }
<br/>
<br/>
   return 0;
<br/>
}
<br/>
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102642 - Tails86 - Fri Sep 15, 2006 9:14 pm</h4>
    <div class="postbody"><span class="postbody">I figured it out. I forgot to set the timer control to activate the interrupt (TIMER_IRQ_ENABLE).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#102651 - tepples - Fri Sep 15, 2006 11:03 pm</h4>
    <div class="postbody"><span class="postbody">In addition, if you want to make an animation that runs every 100 milliseconds, it's usually easier to make it run once every six vblanks. You have only four timers at once, and you have to use some of them for audio if you're using audio.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
