<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>startup/multiboot - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > startup/multiboot</h2>
<div id="posts">
<div class="post">
    <h4>#120855 - KayH - Tue Mar 06, 2007 8:07 pm</h4>
    <div class="postbody"><span class="postbody">I've tested my chessgame with No$Gba and it reported some strange issues. After hunting these errors (access to invalid memory) I found the suspicious part (stmia/ldmia) inside the startup sequence introduced from the crt...
<br/>
There was written from dark_fader, that emulators seems to have issues on that.
<br/>
My questions:
<br/>
1) can someone please explain or link to a document explaining the startup sequence?
<br/>
2) Who is right: dark_fader or martin korth? or both? :-)
<br/>
<br/>
I could avoid this issue when I compile for "not multiboot". This points me to the next questions ...
<br/>
"Vars" defined as "const" go into the ROM space. If I have multiboot activated, all is placed in WRAM. How is this handled? The "const" is only a hint to the compiler, right?
<br/>
Currently I need to places to define multiboot or not. The first is in the main.c where the multiboot statement is on top of the file. The second is in the makefile to define the needed specs. Is it possible to have only one define to activate/deactivate it on both places?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#120867 - Cearn - Tue Mar 06, 2007 10:19 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>KayH wrote:</b></span></td> </tr> <tr> <td class="quote">I've tested my chessgame with No$Gba and it reported some strange issues. After hunting these errors (access to invalid memory) I found the suspicious part (stmia/ldmia) inside the startup sequence introduced from the crt...
<br/>
There was written from dark_fader, that emulators seems to have issues on that.
<br/>
My questions:
<br/>
1) can someone please explain or link to a document explaining the startup sequence?
<br/>
2) Who is right: dark_fader or martin korth? or both? :-)
<br/>
</td> </tr></table><span class="postbody">
<br/>
The start-up sequence is in a file called crt0.S (in particular gba_crt0.S) and , which can be found in devkitARM/arm-eabi/lib . It contains the GBA header and is responsible for initializing the stack(s) and clearing RAM and filling it with data/code if there's any.
<br/>
If you want any specifics, you'd need to clarify the issue you've been having. In particular "<span style="font-style: italic">the startup sequence introduced from the crt...There was written from dark_fader, that emulators seems to have issues on that.</span>" doesn't parse right.
<br/>
There have been some issues with range-checks of ctr0.S in older devkitARM's, but those have been solved long ago, AFAIK.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>KayH wrote:</b></span></td> </tr> <tr> <td class="quote">I could avoid this issue when I compile for "not multiboot". This points me to the next questions ...
<br/>
"Vars" defined as "const" go into the ROM space. If I have multiboot activated, all is placed in WRAM. How is this handled? The "const" is only a hint to the compiler, right?</td> </tr></table><span class="postbody">
<br/>
Every item you make has a specific section. Normal global variables go into .data, code goes into .text and const data goes into .rodata. A linkscript tells the linker what the addresses of these sections are: .data into IWRAM and .text/.rodata into ROM/EWRAM depending on boot-mode. The start-up sequence in crt0.S can tell whether it should be ROM or multiboot code (by looking at the addresses the linker gives to the sections). If it's the latter, the contents are copied into EWRAM from the binary file.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>KayH wrote:</b></span></td> </tr> <tr> <td class="quote">Currently I need to places to define multiboot or not. The first is in the main.c where the multiboot statement is on top of the file. The second is in the makefile to define the needed specs. Is it possible to have only one define to activate/deactivate it on both places?</td> </tr></table><span class="postbody">
<br/>
Using the 'multiboot' variable was the old way: the linker needed something to show the difference between ROM and multiboot, and the existence of a variable by that name was it. This has been replaced by the specs variable,  which is cleaner as deciding on multibootability is really a linker issue, not a compiler one. TThe older devkits (HAM, devkitAdv) still use the older multiboot method, but under devkitARM it's not necessary.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#121141 - KayH - Fri Mar 09, 2007 12:44 pm</h4>
    <div class="postbody"><span class="postbody">Dear Cearn,
<br/>
thank you very much for your explanation!
<br/>
<br/>
Until now I used the devkitARM r18, but yesterday I changed to r20. After recompiling the game and lib the issues were gone.
<br/>
<br/>
Regarding the multiboot-define I probably mixed old and new things together. Thank you for pointing me in the right direction. Now I only specify this option only within the makefile (spec=...).
<br/>
<br/>
Is there any significant difference between libtonc and libgba? I think the main functionality will be the same, but there could be some special things which one of them handles better than the other one.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
