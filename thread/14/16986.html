<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>moving the centre of a rotation BG - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Beginners > moving the centre of a rotation BG</h2>
<div id="posts">
<div class="post">
    <h4>#171494 - genecyst - Mon Nov 23, 2009 1:46 pm</h4>
    <div class="postbody"><span class="postbody">hi, i'm trying to rotate a background (bg2 - mode 1) having as centre two coordinates x,y; reading tonc I haven't understand how he can place x and y  where he want. there's someone who should explain it in a simpler way? 
<br/>
thanks a lot.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171496 - Cearn - Mon Nov 23, 2009 4:25 pm</h4>
    <div class="postbody"><span class="postbody">It helps if you look at the situation as if there are <span style="font-weight: bold">two</span> centers of rotation, not one. There's one on the map (<span style="font-weight: bold">m0</span>), and one on the screen (<span style="font-weight: bold">s0</span>). The trouble is that the hardware only allows one BG scrolling offset (<span style="font-weight: bold">b</span>), so you have to combine the map/screen points somehow. To do that you use:
<br/>
<br/>
<span style="font-weight: bold">b</span> = <span style="font-weight: bold">m0</span> - <span style="font-weight: bold">P</span>?<span style="font-weight: bold">s0</span>
<br/>
<br/>
The interpretation of this is that you start with the reference point on the map, which is the standard scrolling offset, and then add a correction factor that accounts for where the rotation point should be on the screen.
<br/>
<br/>
In code it would look something like this (just watch your fixed point calculations):
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
P = matrix { pa, pb, pc, pd } = REG_BGnPA - REG_BGnPD
<br/>
m0 = (mapX0, mapY0)
<br/>
s0 = (screenX0, screenY0)
<br/>
b = (scrollX, scrollY) = (REG_BGnX, REG_BGnY)
<br/>
<br/>
scrollX = mapX0 - (pa*screenX0 + pb*screenY0);
<br/>
scrollY = mapY0 - (pc*screenX0 + pd*screenY0);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
<br/>
Side note: this is actually similar to the two different ways of writing down a straight line. You can have
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code"> y     = a* x + b</td> </tr></table><span class="postbody">and</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">(y-y0) = a*(x-x0)</td> </tr></table><span class="postbody">
<br/>
In the first expression, <span style="font-style: italic">b</span> is the intercept at <span style="font-style: italic">x</span>=0. The second expression is written in relative coordinates: you have an arbitrary starting point (x0, y0) that serves as the reference point for the expression. Change <span style="font-style: italic">a</span> and you'll see that the line basically rotates around (x0, y0). 
<br/>
<br/>
What happens in the case of BG rotation is essentially the same thing: you have to translate from the second form to the first.</span><span class="gensmall"><br/><br/>Last edited by Cearn on Mon Nov 23, 2009 5:10 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#171497 - genecyst - Mon Nov 23, 2009 4:36 pm</h4>
    <div class="postbody"><span class="postbody">it makes sense. tonight i'll try it out. 
<br/>
as usually thanks a lot Cearn.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171498 - Cearn - Mon Nov 23, 2009 5:08 pm</h4>
    <div class="postbody"><span class="postbody">&lt;deleted&gt;
<br/>
<br/>
Argh, that was not the 'edit' button. nvm.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172006 - Erik Carrick - Fri Jan 08, 2010 9:23 am</h4>
    <div class="postbody"><span class="postbody">Cearn have you done with it? I am too querying for the same. did you get results?<br/>_________________<br/><a class="postlink" href="http://www.craftsadvisor.com" target="_blank">craft ideas</a> | <a class="postlink" href="http://www.theinfosage.com" target="_blank">india news</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172008 - Ruben - Fri Jan 08, 2010 10:36 am</h4>
    <div class="postbody"><span class="postbody">Cearn knows a LOT about mathematics, and has many demos, so I'm quite sure he's had correct results ;D
<br/>
<br/>
The code above is really as best explained as it can be, IMHO.
<br/>
<br/>
EDIT:
<br/>
Here's a little demo I just pulled together (with source, duh =P), where the image rotates from center of the screen at (120, 80): <a class="postlink" href="http://www.filefactory.com/file/a178590/n/CenterRot_rar" target="_blank">link</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172402 - dovoto - Thu Feb 04, 2010 11:03 pm</h4>
    <div class="postbody"><span class="postbody"><a href="http://libnds.devkitpro.org/a00111.html#g45a4ac9093b1fed3d0d205aac39164d4" target="_blank">http://libnds.devkitpro.org/a00111.html#g45a4ac9093b1fed3d0d205aac39164d4</a>
<br/>
<br/>
doesnt work for you or you simply trying to do it manually for self education?<br/>_________________<br/><a href="http://www.drunkencoders.com" target="_blank">www.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#172420 - genecyst - Fri Feb 05, 2010 9:35 am</h4>
    <div class="postbody"><span class="postbody">your second option is the right one!
<br/>
<br/>
almost right... i code for gba, not nds... :D</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
