<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Question on DMA transfer - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Beginners > Question on DMA transfer</h2>
<div id="posts">
<div class="post">
    <h4>#12143 - yaustar - Fri Oct 31, 2003 8:38 pm</h4>
    <div class="postbody"><span class="postbody">at the moment I have this for loop going on in the main game loop but it slows the game to heck
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
for(var_loop = 1536; var_loop &lt; 3584; var_loop++) //96   = radar
<br/>
   {OAMData[var_loop] = radar[var_loop-1536];}
<br/>
</td> </tr></table><span class="postbody">
<br/>
so I though of using DMA transfer but not sure how to have that I start transfering from OAMData[var_loop]
<br/>
At the moment I have this
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
REG_DM3SAD = (u32)radar;//source of data
<br/>
REG_DM3DAD = (u32)OAMData[1536];//target for data
<br/>
 REG_DM3CNT = (2048 | DMA_16NOW);//start copying NOW, in 16bit values</td> </tr></table><span class="postbody">
<br/>
which I know is wrong.
<br/>
<br/>
Help<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12147 - tepples - Fri Oct 31, 2003 8:46 pm</h4>
    <div class="postbody"><span class="postbody">You need to divide the copy size by the word size, and if you're copying to a specific point in an array, you need to take the address of that array element. Does this work any better?
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">REG_DM3SAD = (u32)radar;//source of data
<br/>
REG_DM3DAD = (u32)&amp;OAMData[1536];//target for data
<br/>
REG_DM3CNT = (2048/2 | DMA_16NOW);//start copying NOW, in 16bit values</td> </tr></table><span class="postbody"><br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12149 - yaustar - Fri Oct 31, 2003 9:06 pm</h4>
    <div class="postbody"><span class="postbody">it works, that's the good news.
<br/>
<br/>
bad news is that the actual function to work out the data is too slow :( (running way too many loops and functions)
<br/>
<br/>
*back to the drawing board*<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12155 - tepples - Sat Nov 01, 2003 1:43 am</h4>
    <div class="postbody"><span class="postbody">GBA has <span style="font-style: italic">lots</span> of sprite blitting power. The 128 OAM entry limit is no real limit; in theory, you could have well over 1000 sprites running around on screen using hblank DMA to OAM. Try making each radar blip a separate sprite.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12159 - yaustar - Sat Nov 01, 2003 6:20 am</h4>
    <div class="postbody"><span class="postbody">I am not sure how to do what you have just said (in truth I have no idea)
<br/>
<br/>
using the reg_ie register, you would want me to use h blank with dma3:
<br/>
0000 1000 0000 0100
<br/>
<br/>
Every time there is a blip, I would use this with each blip?
<br/>
<br/>
The mnimap that i am trying to get working is similar to the one in Metal Gear Solid if it helps.<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12160 - tepples - Sat Nov 01, 2003 8:08 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yaustar wrote:</b></span></td> </tr> <tr> <td class="quote">Every time there is a blip, I would use this with each blip?</td> </tr></table><span class="postbody">
<br/>
You don't need to worry about DMA unless you start running up against the 128 OAM entry barrier.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">The mnimap that i am trying to get working is similar to the one in Metal Gear Solid if it helps.</td> </tr></table><span class="postbody">
<br/>
Are you trying to do it with field of vision cones?  Or would you be happy with just dots (as in <span style="font-style: italic">Goldeneye 007</span> multiplayer)?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12161 - yaustar - Sat Nov 01, 2003 8:19 am</h4>
    <div class="postbody"><span class="postbody">vision cones is not a problem at the moment, it's more to do with the level outline (cross referenced with the collision map). Not sure how many sprites that would take.
<br/>
<br/>
Also I am intrigued with the hardware trick when coming up to the 128 sprite limit if you have time. (a hint will do)<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12162 - tepples - Sat Nov 01, 2003 3:58 pm</h4>
    <div class="postbody"><span class="postbody">The gist of vertical sprite multiplexing has been the same since the Commodore 64. During vblank, sort the sprites by Y coordinate and load the first 128 into OAM. Then on the vcount interrupt, set up hblank triggered DMAs to replace each sprite that has been completely drawn (i.e. VCOUNT &gt;= y + h) with another sprite.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12163 - yaustar - Sat Nov 01, 2003 4:07 pm</h4>
    <div class="postbody"><span class="postbody">Would it be possible to use the same sprite to appear twice on the screen at the same time using this method?<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12164 - tepples - Sat Nov 01, 2003 6:04 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>yaustar wrote:</b></span></td> </tr> <tr> <td class="quote">Would it be possible to use the same sprite to appear twice on the screen at the same time using this method?</td> </tr></table><span class="postbody">
<br/>
This is the essence of the method. You use a sprite, and once the scan has passed below the sprite, you reuse the same HW sprite to display another object.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
