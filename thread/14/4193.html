<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>spritesheet 2 OAM - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Beginners > spritesheet 2 OAM</h2>
<div id="posts">
<div class="post">
    <h4>#27307 - Fluffz - Fri Oct 08, 2004 11:21 pm</h4>
    <div class="postbody"><span class="postbody">hi there, i have a problem :x
<br/>
<br/>
i have a bitmap with sprites. each has 256 colors and a size of 32x32 which results in a bitmap size of 128x128 in total. 4x4 sprites / bitmap. i made a .h file. now i want to load a single sprite from that sheet into OAMData. i came up with following (working) code:
<br/>
<br/>
tempOAMData being the spritesheets.h, inx/iny the spriteline/spriterow
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void LoadOAMData(u16* tempOAMData, int inx, int iny)      //this is to strange for me
<br/>
{
<br/>
   int x,y,i=0;
<br/>
   u16* firstOAMData = ((u16*)0x06014000);
<br/>
        
<br/>
   //iin*=1024;
<br/>
   inx*=4;
<br/>
   iny*=32*4;
<br/>
<br/>
   for(x = inx; x &lt; (inx + 32); x++)      
<br/>
   {   
<br/>
      for(y = iny; y &lt; (iny + 32*4); y++)
<br/>
      {
<br/>
         firstOAMData[i++] = tempOAMData[x*128*4+y];
<br/>
      }
<br/>
   }
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
my problem is, i dont understand why this code works at all. especially why inx has to be *=4 instead of *=32. all the *4 bother me actually. i assume it has to do with the sice of the adresses and stuff? or is it because of these 8x8 titles a 32x32 sprite consists of? sadly i have no clue...
<br/>
<br/>
thanks for any help u could give me</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27308 - sajiimori - Fri Oct 08, 2004 11:52 pm</h4>
    <div class="postbody"><span class="postbody">When people post code that uses magic numbers that have no apparent meaning, it's already hard to understand -- and that's even when the original author knows what the numbers mean.  If the author doesn't even know... well, good luck.
<br/>
<br/>
Use named constants (using #define or otherwise) instead of inserting numbers into your code.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27311 - getch - Sat Oct 09, 2004 1:39 am</h4>
    <div class="postbody"><span class="postbody">First of all I just want to say you chose a bad naming system for variables. A lot of posts I see dont seem to understand what OAM is.
<br/>
It stands for Object Attribute Memory. It has information on the Attributes of the sprites, NOT the graphic data.
<br/>
<br/>
Second, I want to try and help but as the other poster said, your code is really hard to read. So instead of answering your question (why does my code work) I'll just give some info on what you are doing.
<br/>
<br/>
Your 32x32 sprite will be split up into 16 sprite tiles (cos they're 8x8 each).
<br/>
If you are storing this in 1D mode (which I recommend) these 16 tiles will all be contiguous.
<br/>
A 256 color tile takes up 64 bytes so in total a single sprite will be (16*64) 1024 bytes.
<br/>
The VRAM is accessed as a (u16*)  pointer (someone correct me if i'm wrong. I dont know much about thumb/arm modes) 
<br/>
Thats 2 bytes per read/write , so your first sprite should take up SpriteData[0] ar far as SpriteData[511].
<br/>
The next SpriteData[512] ar far as SpriteData[1023] e.t.c.
<br/>
<br/>
Hope that helps somewhat.
<br/>
<br/>
-edit : where did you get this code? did you just try multiplying by different numbers until it worked?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27317 - Fluffz - Sat Oct 09, 2004 10:25 am</h4>
    <div class="postbody"><span class="postbody">hm ok, in my gba.h i have a OAMdata 0x6010000 firstOAMdata adds 512 bytes and therefore points to the first place i can store sprites to. so much for the magic numbers and bad naming, ill change that.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">where did you get this code? did you just try multiplying by different numbers until it worked? </td> </tr></table><span class="postbody">
<br/>
heh, no, i watched the output which always gave me 1/4 of each sprite in the first row. so i multiplicated with 4 and viola. thats for the y value. x is still totaly strange to me.
<br/>
<br/>
let me modify my question, why does the following code not store the first 32x32 pixels from a 128x128 bitmap. spriteData is the .h saved 128x128 bitmap. 256 colors, 4x4 sprites each 32x32 in size.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">for(x = 0; x &lt;  32; x++)       
<br/>
   {    
<br/>
      for(y = 0; y &lt; 32; y++) 
<br/>
      { 
<br/>
         firstMEMData[i++] = spriteData[x*128+y]; 
<br/>
      } 
<br/>
   } 
<br/>
</td> </tr></table><span class="postbody">
<br/>
what this does instead is saving the top 8 pixellines (8x128 ?). can it be that the bitmap is stored in a strange way, i refuse to understand that this is a problem with sizes.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">for(x = 4; x &lt;  4+32; x++)       
<br/>
   {    
<br/>
      for(y = 0; y &lt; 32*4; y++) 
<br/>
      { 
<br/>
         firstMEMData[i++] = spriteData[x*128*4+y]; 
<br/>
      } 
<br/>
   } 
<br/>
</td> </tr></table><span class="postbody">
<br/>
this saves the first 32x32 pixels in spriteline 1 (spriteline1 = pixelline 32-64). where i can accept the lines to be multiplicated with 4, the x=4 is my personal horror. 
<br/>
spriteline 0 (pixelline 0-32) would be x=0; x&lt;32. that doesnt make sense at all?!
<br/>
<br/>
<br/>
edit: i think its because of the 8x8 titles, but i am not clever enough to figure it out. dont bother with it to much, it works and thats what is has to do :p</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27320 - getch - Sat Oct 09, 2004 3:54 pm</h4>
    <div class="postbody"><span class="postbody">I'll try to explain this as clearly as I can. You are right in that it has something to do with the 8x8 pixel tiles.
<br/>
You must put your sprite into memory as a series of 4 tiles in this order:
<br/>
top-left tile, top-right tile, bottom-left tile, bottom-right tile.
<br/>
Inside each tiles the pixels are stored in the order of: entire first line, entire second line, etc.
<br/>
Here's some [bad] psudocode:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
BITMAP_OFFSET is the address of the bitmap in ROM
<br/>
SPRITELINE_OFFSET = BITMAP_OFFSET
<br/>
do this 2 times   //because there's 2 sprites vertically
<br/>
      SPRITE_OFFSET = SPRITELINE_OFFSET
<br/>
      do this 2 times   //because there's 2 sprites horizontally
<br/>
            TILELINE_OFFSET = SPRITE_OFFSET
<br/>
            do this 4 times     //cos theres 4 tiles p/sprite vertically
<br/>
                  TILE_OFFSET = TILELINE_OFFSET
<br/>
                  do this 4 times     //cos theres 4 tiles p/sprite horizontally
<br/>
                        PIXELLINE_OFFSET = TILE_OFFSET
<br/>
                        do this 8 times
<br/>
                              copy 8 pixels from PIXELLINE_OFFSET to VRAM
<br/>
                              PIXELLINE_OFFSET += BITMAP_WIDTH
<br/>
                        TILE_OFFSET += 8
<br/>
                  TILELINE_OFFSET += (8 * BITMAP_WIDTH)
<br/>
            SPRITE_OFFSET += 32   //pixel width of sprite
<br/>
      SPRITELINE_OFFSET += (32 * BITMAP_WIDTH)
<br/>
</td> </tr></table><span class="postbody">
<br/>
Not very readable but thats what I use to convert my sprite and tile bitmaps to .h files. (splitting up the tiles beforehand saves the GBA CPU some processing time)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#27342 - Fluffz - Sun Oct 10, 2004 11:33 pm</h4>
    <div class="postbody"><span class="postbody">it makes a little bit more sense now, thank you :)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
