<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>compilation problem with globals and includes - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > compilation problem with globals and includes</h2>
<div id="posts">
<div class="post">
    <h4>#10141 - RaBBi - Wed Aug 27, 2003 10:21 pm</h4>
    <div class="postbody"><span class="postbody">hi !
<br/>
<br/>
I tried for the first time to clean my code by playing with .h, .c and extern  :P 
<br/>
<br/>
After many bugs, I got a "hopefull" last error message :
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
sprites.h:6: parse error before '*' token
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I pass a pointer on structure as a param to a function.
<br/>
<br/>
When all my code was in main.C, it worked.
<br/>
But now that I use .h includes, it doesn't.
<br/>
<br/>
Here come prototype and function :
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
(in sprites.h)
<br/>
void random_move  (TSprite *T_sprite, u16 direction, unsigned char* bitmap, unsigned char* vitesse);
<br/>
<br/>
(in sprites.c)
<br/>
 typedef struct TSprite
<br/>
{
<br/>
    u8 ObjNo;
<br/>
    s16 X, Y;
<br/>
    s8  SpeedX, SpeedY;
<br/>
    bool inMotion;
<br/>
    u16 direction;
<br/>
    u8 compteur_pas;
<br/>
    u8 limite_pas;
<br/>
    u8 AnimCnt;
<br/>
    u32 frames;
<br/>
}TSprite;
<br/>
<br/>
#define SPRITES_MAX  2
<br/>
<br/>
TSprite g_SprObj[SPRITES_MAX];
<br/>
<br/>
/*********************************************************************************
<br/>
 * random_move(sprite_no, direction, *bitmap, *vitesse)
<br/>
 *
<br/>
 * D?place un sprite de mani?re al&amp;atoire en process parall?le
<br/>
 ********************************************************************************/
<br/>
void random_move(TSprite *T_sprite, u16 direction, unsigned char* bitmap, unsigned char* vitesse)
<br/>
{
<br/>
    u16 sprite_Y = MY_OBJ_GET_Y_VALUE(T_sprite-&gt;ObjNo);
<br/>
    u16 sprite_X = MY_OBJ_GET_X_VALUE(T_sprite-&gt;ObjNo);
<br/>
    u16 rand_direction = 0;
<br/>
    u16 opp_rand_direction = 0;
<br/>
<br/>
    if (T_sprite-&gt;compteur_pas == 0)
<br/>
    {
<br/>
        do {
<br/>
        rand_direction = (int)((double)rand() / ((double)RAND_MAX + 1) * 4);
<br/>
        opp_rand_direction = (rand_direction ^ 2);
<br/>
        if (opp_rand_direction &gt; 3) opp_rand_direction=0;
<br/>
<br/>
        rand_direction = rand_direction*3*1024;
<br/>
        opp_rand_direction = opp_rand_direction*3*1024;
<br/>
        } while ((rand_direction == (T_sprite-&gt;direction)) || (opp_rand_direction == (T_sprite-&gt;direction)));
<br/>
<br/>
        T_sprite-&gt;direction = rand_direction;
<br/>
<br/>
        //ham_DrawText(0, 1, "%4d", rand_direction);
<br/>
<br/>
        //ham_DrawText(0, 2, "%4d", opp_rand_direction);
<br/>
        //T_sprite-&gt;compteur_pas = (int)((double)rand() / ((double)RAND_MAX + 1) * T_sprite-&gt;limite_pas);
<br/>
        T_sprite-&gt;compteur_pas = 50;
<br/>
    }
<br/>
<br/>
    if (T_sprite-&gt;compteur_pas != 0)
<br/>
    {
<br/>
<br/>
        //if(g_NewFrame)
<br/>
        //{
<br/>
<br/>
            // On n'update l'animation que toutes les 5 frames,
<br/>
            if(!(T_sprite-&gt;frames%(vitesse[0])))
<br/>
            {
<br/>
                // charge le nouveau graph du sprite
<br/>
                //ham_UpdateObjGfx(sprite_no,(void*)&amp;eikishi_Bitmap[g_DirectionAnim+1024*(g_AnimCnt%3)]);
<br/>
                ham_UpdateObjGfx(T_sprite-&gt;ObjNo,(void*)&amp;bitmap[T_sprite-&gt;direction+1024*(T_sprite-&gt;AnimCnt%3)]);
<br/>
<br/>
                // mise ? jour de la position du perso
<br/>
                T_sprite-&gt;AnimCnt++;
<br/>
            }
<br/>
<br/>
            if(!(T_sprite-&gt;frames%(vitesse[1])))
<br/>
            {
<br/>
                switch(T_sprite-&gt;direction)
<br/>
                {
<br/>
                    //haut
<br/>
                    case ANIM_HAUT:
<br/>
                    sprite_Y--;
<br/>
                    break;
<br/>
                    //bas
<br/>
                    case ANIM_BAS:
<br/>
                    sprite_Y++;
<br/>
                    break;
<br/>
                    //gauche
<br/>
                    case ANIM_GAUCHE:
<br/>
                    sprite_X--;
<br/>
                    break;
<br/>
                    //droite
<br/>
                    case ANIM_DROITE:
<br/>
                    sprite_X++;
<br/>
                    break;
<br/>
                }
<br/>
<br/>
                redrawHero(T_sprite-&gt;ObjNo,sprite_X,sprite_Y);
<br/>
                T_sprite-&gt;compteur_pas--;
<br/>
<br/>
                //RE-INIT du compteur de pas
<br/>
                if (T_sprite-&gt;compteur_pas==0)
<br/>
                {
<br/>
                    //T_sprite-&gt;compteur_pas=T_sprite-&gt;limite_pas;
<br/>
                }
<br/>
            }
<br/>
                     // Incr?mente le compteur de frames
<br/>
            //g_NewFrame=0;       // Mise ? z?ro du bool?en Nouvelle Frame
<br/>
            T_sprite-&gt;frames++;
<br/>
        //}
<br/>
    }
<br/>
}
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
And of course, I don't know where this error come from.
<br/>
<br/>
So while I'm reading some C books, can someone guide me ? ^^
<br/>
<br/>
Thanks in advance ^^<br/>_________________<br/>Sorry for my poor english, but it would be worst for you to understand me if I speak in my native language, French ^^</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10144 - tepples - Thu Aug 28, 2003 12:48 am</h4>
    <div class="postbody"><span class="postbody">First of all, you should put struct declarations and typedefs into your .h files before the function prototypes.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10145 - RaBBi - Thu Aug 28, 2003 1:03 am</h4>
    <div class="postbody"><span class="postbody">Ok, I do this tepples and it's worst now...
<br/>
<br/>
In fact, first I declared all my variables and my struct/typedef in .h but It doesn't compile, so I put all but not prototypes in .c.
<br/>
<br/>
<br/>
What I have to put in .h files exactly ?
<br/>
<br/>
EDIT:
<br/>
Ok I put off my struct typedef in a .h file that I include when I need, it's ok for that.
<br/>
<br/>
But now when I compile, I get this result :
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
globals.o(.data+0x0): multiple definition of `g_Frames'
<br/>
main.o(.data+0x0): first defined here
<br/>
globals.o(.data+0x4): multiple definition of `g_NewFrame'
<br/>
main.o(.data+0x4): first defined here
<br/>
globals.o(.data+0x5): multiple definition of `fin_intro'
<br/>
main.o(.data+0x5): first defined here
<br/>
globals.o(.data+0x6): multiple definition of `delay'
<br/>
main.o(.data+0x6): first defined here
<br/>
globals.o(.data+0x8): multiple definition of `test'
<br/>
main.o(.data+0x8): first defined here
<br/>
gamestruct.o(.rodata+0xcd00): multiple definition of `eikishi_Palette'
<br/>
sprites.o(.rodata+0x0): first defined here
<br/>
gamestruct.o(.rodata+0xcf00): multiple definition of `eikishi_Bitmap'
<br/>
sprites.o(.rodata+0x200): first defined here
<br/>
gamestruct.o(.rodata+0xff00): multiple definition of `fonts_Palette'
<br/>
main.o(.rodata+0x9800): first defined here
<br/>
gamestruct.o(.rodata+0x10100): multiple definition of `BMP_Font_Tiles'
<br/>
main.o(.rodata+0x9a00): first defined here
<br/>
gamestruct.o(.rodata+0x11780): multiple definition of `lettersData'
<br/>
main.o(.rodata+0xb080): first defined here
<br/>
gamestruct.o(.rodata+0x12d40): multiple definition of `lettersPalette'
<br/>
main.o(.rodata+0xc640): first defined here
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I think I don"t have a GOOD use of the "extern" term and the graphics includes...
<br/>
<br/>
In fact, I need the same gfx includes in several .c files...
<br/>
<br/>
Can someone guide me to find a source of good information about all these points ? (extern, includes, headers...)
<br/>
Thank you<br/>_________________<br/>Sorry for my poor english, but it would be worst for you to understand me if I speak in my native language, French ^^</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10154 - RaBBi - Thu Aug 28, 2003 11:48 am</h4>
    <div class="postbody"><span class="postbody">hmm...
<br/>
<br/>
I'm always in trouble with this...
<br/>
<br/>
I put all my variables/struc/Defines in a single file "typedefs.h" that I included in all my project files.
<br/>
<br/>
And I still have the same result : "multiple definition of ..."
<br/>
<br/>
I add this to the typedefs.h :
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#if defined(TYPEDEFS_H)
<br/>
/* fichier TYPEDEFS.H d?j? inclus */
<br/>
<br/>
#else
<br/>
<br/>
#define TYPEDEFS_H
<br/>
<br/>
.... my declarations ....
<br/>
<br/>
#endif
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
but nothing changes...
<br/>
<br/>
Does someone have a really good structure of a project that use global/extern variables and multiple headers to send me ?
<br/>
<br/>
Thank you<br/>_________________<br/>Sorry for my poor english, but it would be worst for you to understand me if I speak in my native language, French ^^</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10159 - RaBBi - Thu Aug 28, 2003 2:01 pm</h4>
    <div class="postbody"><span class="postbody">hello !
<br/>
<br/>
Moderator can delete this topic &gt;&gt; I solved my problem ^^<br/>_________________<br/>Sorry for my poor english, but it would be worst for you to understand me if I speak in my native language, French ^^</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10164 - iuiz - Thu Aug 28, 2003 7:36 pm</h4>
    <div class="postbody"><span class="postbody">It wouldn't help other Persons with the same Problem, if it it deleted.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10173 - Omega81 - Thu Aug 28, 2003 10:59 pm</h4>
    <div class="postbody"><span class="postbody">I am curious to know how you solved it.<br/>_________________<br/>Keep it real, keep it Free, Keep it GNU</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10174 - tepples - Thu Aug 28, 2003 11:14 pm</h4>
    <div class="postbody"><span class="postbody">Keyword: 'extern'.
<br/>
<br/>
If you want a global variable to be accessible from multiple source files, declare it with 'extern' in the header file and without 'extern' in exactly one source file. Otherwise, if you don't need other source files to see a global variable, make it module-private by declaring it with 'static'.</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">/* Example */
<br/>
<br/>
/* === from music_engine.h === */
<br/>
/* the public interface */
<br/>
extern int music_position;
<br/>
extern int music_volume;
<br/>
<br/>
int init_song(/*...*/);
<br/>
int play_song(/*...*/);
<br/>
int play_sample(/*...*/);
<br/>
int mix_audio(/*...*/);
<br/>
<br/>
/* === from music_engine.c === */
<br/>
int music_position;
<br/>
int music_volume;
<br/>
<br/>
static unsigned char *module_data_ptr[8];
<br/>
static int cur_instrument[8];
<br/>
<br/>
int init_song(/*...*/)
<br/>
{ /*... */ }
<br/>
<br/>
int play_song(/*...*/)
<br/>
{ /*... */ }
<br/>
<br/>
int play_sample(/*...*/)
<br/>
{ /*... */ }
<br/>
<br/>
int mix_audio(/*...*/)
<br/>
{ /*... */ }
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10256 - RaBBi - Sun Aug 31, 2003 9:13 pm</h4>
    <div class="postbody"><span class="postbody">yes tepples it was exatly what I did.
<br/>
<br/>
no "extern" in source file
<br/>
"extern" in other modules that use this variable.
<br/>
<br/>
But at the time I write this post, I have to do this too :
<br/>
<br/>
- globals variables are in a file that is not included in the others modules that could use some of the globals variables
<br/>
<br/>
- Types and Defines are in another file that is included in all the modules which need them.
<br/>
<br/>
Am I right with this way?
<br/>
<br/>
For the moment it works perfectly (even the pointers on structures) and since I can develop my engine with several files included ^^<br/>_________________<br/>Sorry for my poor english, but it would be worst for you to understand me if I speak in my native language, French ^^</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10287 - RaBBi - Mon Sep 01, 2003 5:31 pm</h4>
    <div class="postbody"><span class="postbody">I got new problems about structures.
<br/>
<br/>
In a file called "backgrounds.c" I included a file called "typedefs.h".
<br/>
In this header, there are typedef structs and DEFINES.
<br/>
And one like this :
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
typedef struct TMap
<br/>
{
<br/>
    u16 MapNo;
<br/>
    unsigned short MapPalette;          //palette de la map par d?faut
<br/>
    unsigned char MapTiles;             //raw en tiles de la map
<br/>
    unsigned short MapMap;              //map de la map
<br/>
    s16 tilesX, tilesY;                 //tailles en tiles (1 tiles = 8x8)
<br/>
    map_fragment_info_ptr MapFragment;  //Fragment ? charger de la map
<br/>
    bool inScroll;                      //si en scroll
<br/>
    u16 scroll_direction;               //direction du scroll
<br/>
}TMap;
<br/>
<br/>
#define MAPS_MAX 255;
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
And in "backgrounds.c" I initialize like that :
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
TMap g_Maps[MAPS_MAX];       // tableau des Maps
<br/>
g_Maps[0].MapNo=0;
<br/>
g_Maps[0].MapPalette=ciel2_Palette;
<br/>
g_Maps[0].MapTiles=ciel2_Tiles;
<br/>
g_Maps[0].MapMap=ciel2_Map;
<br/>
g_Maps[0].tilesX=32;
<br/>
g_Maps[0].tilesY=32;
<br/>
g_Maps[0].inScroll=FALSE;
<br/>
g_Maps[0].scroll_direction=0;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
And when I compile, HaM says to me :
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
backgrounds.c:X: parse error before '.' token
<br/>
<br/>
(with X is line number when I taped g_Maps[0].something)
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Anyone has an idea about my mistake?
<br/>
<br/>
Thank you ^^<br/>_________________<br/>Sorry for my poor english, but it would be worst for you to understand me if I speak in my native language, French ^^</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10290 - tepples - Mon Sep 01, 2003 7:28 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>RaBBi wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define MAPS_MAX 255;</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
You usually shouldn't use a ; after a #define'd macro. Instead:</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define MAPS_MAX 255</td> </tr></table><span class="postbody"><br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10297 - RaBBi - Mon Sep 01, 2003 10:01 pm</h4>
    <div class="postbody"><span class="postbody">yes but....i did this mistake only HERE lol
<br/>
<br/>
otherwise it's ok now, i solved my problem in using initialisation in a fonction 
<br/>
In fact, in a fonction, the "." syntax works.
<br/>
<br/>
I learn every day to make clean code and that's another example ^^
<br/>
Anyway, thank you for reading.<br/>_________________<br/>Sorry for my poor english, but it would be worst for you to understand me if I speak in my native language, French ^^</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
