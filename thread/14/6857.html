<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Text backgrounds in Mode 0-1 are not working - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Beginners > Text backgrounds in Mode 0-1 are not working</h2>
<div id="posts">
<div class="post">
    <h4>#54040 - blacksun - Thu Sep 15, 2005 2:47 am</h4>
    <div class="postbody"><span class="postbody">I currently am working on the Tile Bitmap modes.  As of now, I have 2 256x256 256 color backgrounds I am working with.  I can display them perfectly in Mode 2 with them both as Rotational bitmaps.  However, when I try to load in the bitmaps into either 0 or 1 their data becomes messed up.
<br/>
<br/>
The only thing i've read to change is the size of the bitmap between Text and Rotation.  I have also read that Text tile maps comprises 16-bit numbers while the rotational backgrounds store 8-bit numbers.  Don't know how that fits in I'm just scratching my head.
<br/>
<br/>
Well here is the code that will display the backgrounds:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">SetMode(MODE_1 | OBJ_ENABLE | OBJ_MAP_1D);
<br/>
<br/>
   //Let us set up the backgroud two structure and enable the background
<br/>
<br/>
   bg2.number = 0;            //background number 0-3
<br/>
   bg2.charBaseBlock = 0;                  //tile data position (right at the start of the available memory on 16Kb boundary)
<br/>
   bg2.screenBaseBlock = 28;      //map data position on 2Kb boundary
<br/>
   bg2.colorMode = BG_COLOR_256;           //256-colour background
<br/>
   bg2.size = TEXTBG_SIZE_256x256;          //size of map
<br/>
   bg2.mosaic = 0;                         //not enabled
<br/>
   bg2.x_scroll = 120;         //scrolling variables
<br/>
   bg2.y_scroll = 80;
<br/>
<br/>
   bg0.number = 1;
<br/>
   bg0.charBaseBlock = 0;
<br/>
   bg0.screenBaseBlock = 31;
<br/>
   bg0.colorMode = BG_COLOR_256;
<br/>
   bg0.size = TEXTBG_SIZE_256x256;
<br/>
   bg0.mosaic = 0;
<br/>
   bg0.x_scroll = 120;
<br/>
   bg0.y_scroll = 80;
<br/>
   
<br/>
   bg3.number = 2;
<br/>
   bg3.charBaseBlock = 0;
<br/>
   bg3.screenBaseBlock = 20;
<br/>
   bg3.colorMode = BG_COLOR_256;
<br/>
   bg3.size = ROTBG_SIZE_128x128;
<br/>
   bg3.mosaic = 0;
<br/>
   bg3.x_scroll = 120;
<br/>
   bg3.y_scroll = 80;
<br/>
<br/>
   //Point to correct tile and map data, update the Background and Display registers accordingly
<br/>
        EnableBackground(&amp;bg2);
<br/>
      EnableBackground(&amp;bg0);
<br/>
      EnableBackground(&amp;bg3);
<br/>
<br/>
<br/>
   for(loop = 0; loop &lt; 256; loop++)
<br/>
      BGPaletteMem[loop] = tilesetPalette[loop];     //load the background palette into memory
<br/>
<br/>
   for(loop = 0; loop &lt; 32*32/2; loop++)  //load tile image data
<br/>
   {
<br/>
      bg2.tileData[loop] = tilesetData[loop];
<br/>
      bg0.tileData[loop] = tilesetData[loop];
<br/>
      bg3.tileData[loop] = tilesetData[loop];
<br/>
<br/>
   }
<br/>
<br/>
   //load the map image data
<br/>
   temp = (u16*)background1;
<br/>
   temp2 = (u16*)background2;
<br/>
   temp3 = (u16*)test;
<br/>
<br/>
   //load the 2 text backgrounds.  256x256 with 256 color
<br/>
   for(loop = 0; loop &lt; 32*32/2; loop++) //32x32 tiles /2 because 16 bit copy
<br/>
   {
<br/>
      bg2.mapData[loop] = temp2[loop];
<br/>
      bg0.mapData[loop] = temp[loop];
<br/>
   }
<br/>
<br/>
   //Load a 128x128 256 color rotational background
<br/>
   for(loop = 0; loop &lt; 16*16/2; loop++)
<br/>
      bg3.mapData[loop] = temp3[loop];
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
And here is the code for the EnableBackgrounds: 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void EnableBackground(Bg* bg)
<br/>
{
<br/>
   u16 temp;
<br/>
<br/>
   bg-&gt;tileData = (u16*)CharBaseBlock(bg-&gt;charBaseBlock);
<br/>
   bg-&gt;mapData = (u16*)ScreenBaseBlock(bg-&gt;screenBaseBlock);
<br/>
   temp = bg-&gt;size | (bg-&gt;charBaseBlock&lt;&lt;CHAR_SHIFT) | (bg-&gt;screenBaseBlock&lt;&lt;SCREEN_SHIFT)
<br/>
      | bg-&gt;colorMode | bg-&gt;mosaic | bg-&gt;wraparound;
<br/>
<br/>
   switch(bg-&gt;number)
<br/>
   {
<br/>
   case 0:
<br/>
      {
<br/>
         REG_BG0CNT = temp;
<br/>
         REG_DISPCNT |= BG0_ENABLE;
<br/>
      }break;
<br/>
   case 1:
<br/>
      {
<br/>
         REG_BG1CNT = temp;
<br/>
         REG_DISPCNT |= BG1_ENABLE;
<br/>
      }break;
<br/>
   case 2:
<br/>
      {
<br/>
         REG_BG2CNT = temp;
<br/>
         REG_DISPCNT |= BG2_ENABLE;
<br/>
      }break;
<br/>
   case 3:
<br/>
      {
<br/>
         REG_BG3CNT = temp;
<br/>
         REG_DISPCNT |= BG3_ENABLE;
<br/>
      }break;
<br/>
<br/>
   default:break;
<br/>
<br/>
   }
<br/>
}</td> </tr></table><span class="postbody">
<br/>
<br/>
Any help would be appreciated because while Mode 2 works fine, would like to find out how to use all BG in mode 0 and 1.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#54046 - tepples - Thu Sep 15, 2005 4:35 am</h4>
    <div class="postbody"><span class="postbody">First off, mode 1 uses backgrounds 0 (text), 1 (text), and 2 (rotation), not 2, 0, and 3.
<br/>
<br/>
How are you generating/declaring the arrays background1, background2, and test ?
<br/>
<br/>
(EDIT: Mode number corrected. I apologize for the confusion caused by my error. Can anyone give me tips to help me make my brain's operation as repeatable as that of silicon?)<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"><br/><br/>Last edited by tepples on Thu Sep 15, 2005 6:41 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#54066 - Cearn - Thu Sep 15, 2005 8:54 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">First off, mode 0 uses backgrounds 0 (text), 1 (text), and 2 (rotation), not 2, 0, and 3.
<br/>
?</td> </tr></table><span class="postbody">
<br/>
mode <span style="font-weight: bold">1</span> uses backgrounds 0 (text), 1 (text), and 2 (rotation); in mode 0 all bgs are text. Also, why the bg-structs are named bg2, bg0 and bg3 here, their bg numbers are 0, 1 and 2 respectively, so that should be ok. (you might want to make those match, though)
<br/>
<br/>
What's probably not ok is what you do with the background's data. Text backgrounds are indeed 16bit / screen entry, while rotational bgs use 8bit. This means that you <span style="font-weight: bold">cannot</span> simply use data prepared for a rot bg directly for a text bg.
<br/>
<br/>
Text bg's screen entry:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">bit 0-9   : tile index
<br/>
bit 10    : horizontal flip
<br/>
bit 11    : vertical flip
<br/>
bit 12-15 : 16 color palette</td> </tr></table><span class="postbody">
<br/>
Rot bg screen entry:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">bit 0-7   : tile index</td> </tr></table><span class="postbody">
<br/>
Now, if your map data starts with, say, 0x0102, for a rot bg this will be interpreted as <span style="font-weight: bold">two</span> separate screen entries, using tiles 2 and 1. For a text bg, this is just a <span style="font-weight: bold">single</span> screen entry, using tile 0x102.
<br/>
<br/>
It's probably a good idea export your original map to a text bg format and use that, but if you really want to use the existing (rot bg) data, here's a way:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">int ii;      // loop variable. NEVER, EVER, EVER USE u8 OR u16 FOR LOOP VARIABLES.
<br/>
u8 *src= (u8*)background1;    // assuming 256x256 map (32x32 tiles)
<br/>
u16 *dst= (u16*)bg0.mapData;
<br/>
for(ii=0; ii&lt;32*32; ii++)
<br/>
    dst[ii]= src[ii];
<br/>
</td> </tr></table><span class="postbody">
<br/>
A single (8bit) screen entry will be put as a tile index into the (16bit) destination, and you have a text map. Doesn't <span style="font-style: italic">quite</span> work when you go to even larger maps though, because of the screen-block thing for text bgs.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#54097 - blacksun - Thu Sep 15, 2005 5:28 pm</h4>
    <div class="postbody"><span class="postbody">Sorry for the naming confusion, it was easier to just change the value for the background instead of the name.  But I am just using 0, 1 and 2 in mode 1.  
<br/>
<br/>
I think the problem is the way I am making my backgrounds.  I am using GBA Map Editor Beta 4 from Warder 1.  The program only exports in Rotational Background format, meaning each entry is only 8 bits.  
<br/>
<br/>
I guess I need to find a map editor that exports into Text Background Format.  If anyone knows of a good one please let me know.  I used the code from Cearn and it works.  Although will I be losing information by converting from Rot Background data to Text Background data?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#54126 - tepples - Thu Sep 15, 2005 6:43 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>blacksun wrote:</b></span></td> </tr> <tr> <td class="quote">I guess I need to find a map editor that exports into Text Background Format.</td> </tr></table><span class="postbody">
<br/>
While you're waiting for the answer to this question, you can use rotational background map data with a text background. Try accessing it as a u8 instead of a u16. I wanted to see the declarations for the map data arrays so that I could find the best way to explain how to do this in the context of the map data that you are working with.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#54173 - blacksun - Fri Sep 16, 2005 2:07 am</h4>
    <div class="postbody"><span class="postbody">Ya using u8 instead of u16 works fine.
<br/>
<br/>
Here is one of the backgrounds from the map editor.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">const u8 background1[ 32 * 32 ] = {
<br/>
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, ...
<br/>
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, ...
<br/>
.
<br/>
.
<br/>
.
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
That is a 256x256 256 color background.  Each entry is only 8 bits</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
