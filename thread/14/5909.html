<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Graphic problems [starting] - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > Graphic problems [starting]</h2>
<div id="posts">
<div class="post">
    <h4>#44403 - Shade - Wed Jun 01, 2005 11:55 am</h4>
    <div class="postbody"><span class="postbody">Hi, sorry for posting, but I've read through the FAQ and had no luck so far.
<br/>
<br/>
I'm using devkitpro (as per instructions). My make.bat:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">PATH=C:\devkitpro\msys\bin;C:\devkitpro\devkitARM\bin;%PATH%;
<br/>
<br/>
arm-elf-gcc -mthumb -mthumb-interwork -c hello.c
<br/>
arm-elf-gcc -specs=gba_mb.specs -mthumb -mthumb-interwork hello.o -o hello.elf
<br/>
arm-elf-objcopy -O binary hello.elf hello.gba
<br/>
gbafix hello.gba
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
And this is my source file:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
/* hello.c - Gameboy Advance Tutorial - Loirak Development */
<br/>
#define RGB16(r,g,b)  ((r)+(g&lt;&lt;5)+(b&lt;&lt;10)) 
<br/>
<br/>
int main()
<br/>
{
<br/>
   char x,y;  
<br/>
   unsigned short* Screen = (unsigned short*)0x6000000; 
<br/>
   *(unsigned long*)0x4000000 = 0x403; // mode3, bg2 on 
<br/>
<br/>
    while(1){   //loop forever
<br/>
   // clear screen, and draw a magenta back ground
<br/>
   for(x = 0; x&lt;240;x++)   //loop through all x
<br/>
   {
<br/>
      for(y = 0; y&lt;160; y++)  //loop through all y
<br/>
      {
<br/>
         Screen[x+y*240] = RGB16(30,0,31);  
<br/>
      }
<br/>
   }
<br/>
   Screen[0] = 0x7c00; // draw a single blue pixel
<br/>
    }
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Now, it was supposed to clear the screen with magenta and draw a single blue pixel on the corner, repeatedly. However, the "Screen[0]" attribution seems to affect the whole screen -- the effect is, the whole screen blinks magenta/blue/magenta/blue...
<br/>
<br/>
Note that I could only test it in Visual Boy Advance so far.
<br/>
<br/>
What is this? Some weird alignment issue? What am I missing?
<br/>
<br/>
Thanks in advance</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44407 - strager - Wed Jun 01, 2005 2:48 pm</h4>
    <div class="postbody"><span class="postbody">Screen should be a macro, and X and Y should be int's.
<br/>
<br/>
Place your while(1) loop at the bottom of the two for loops (outside), and make sure it doesn't have an code in it.  Make the Screen[0] = ... before the while loop.
<br/>
<br/>
Example:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#define Screen ((u16 *)(0x06000000))
<br/>
#define pixel(x,y) (Screen[(x) + ((y) * 240)])
<br/>
<br/>
int x, y;
<br/>
<br/>
for(y = 0; y &lt; 160; y++)
<br/>
{
<br/>
    for(x = 0; x &lt; 240; x++)
<br/>
    {
<br/>
        pixel(x, y) = RGB16(31, 0, 31);
<br/>
    };
<br/>
};
<br/>
<br/>
pixel(0, 0) = RGB16(0, 0, 31);
<br/>
<br/>
while(1)
<br/>
    /* DO NOTHING */;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
If you haven't noticed, I've switched the X and Y for loops.  Not only will this make it faster, it will appear more natural.  The old loop, X then Y, draws pixels going down.  When it reached the bottom, it is returned to the top and shifted right.  The drawing starts over until the entire screen is filled.  The loop above, Y then X, draws pixels going right and returns at the end, going down one...
<br/>
<br/>
Hope this helps.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44459 - Shade - Thu Jun 02, 2005 12:54 am</h4>
    <div class="postbody"><span class="postbody">Thanks for the assist, but I still have the same problem (even using the exact code you posted). The screen blinks  magenta and then goes all blue, even setting just the (0,0) pixel (Screen[0]).
<br/>
<br/>
I'm thinking it's something emulator-related... I'm using a pretty default VisualBoy Advance, is there a setting I should be concerned about? Without GBAFIX I get the garbled "Nintendo" logo, with it I get this result.
<br/>
<br/>
I tried loading an example that someone else sent to the board and got a solid red screen.
<br/>
<br/>
Thanks again for the help.  And BTW, I agree with your switch of x/y -- it's probably faster, anyway -- but that came from sample code.
<br/>
<br/>
Cheers</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44506 - Shade - Thu Jun 02, 2005 11:58 am</h4>
    <div class="postbody"><span class="postbody">Ok -- I've re-downloaded everything from scratch and followed <a class="postlink" href="http://www.webbesen.dk/gba/default.asp" target="_blank">this excellent tutorial</a> people recommended at another thread...
<br/>
<br/>
...and it works.
<br/>
<br/>
I'm still curious to find out how come it didn't work the first time -- I'll see if I can find the problematic element and post my results later on.
<br/>
<br/>
Actually, I just noticed the working demo uses MODE_4 (palette) instead of direct bitmap drawing... Gotta check mode 3.
<br/>
<br/>
Thanks for the support!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44518 - strager - Thu Jun 02, 2005 2:01 pm</h4>
    <div class="postbody"><span class="postbody">Ah, that's your problem.  If only you had set it to mode 4...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44538 - Shade - Thu Jun 02, 2005 6:18 pm</h4>
    <div class="postbody"><span class="postbody">But why didn't the solution work with mode 3? Isn't it supposed to?
<br/>
<br/>
Thanks</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44541 - strager - Thu Jun 02, 2005 6:37 pm</h4>
    <div class="postbody"><span class="postbody">Wait - I got mode 3 and 4 mixed up.
<br/>
<br/>
Mode 3 has a single buffer and uses 16-bit color (xBBBBBGGGGGRRRRR).
<br/>
Mode 4 has a double buffer and a pallet.
<br/>
<br/>
Mode 0-5: Text, Rotating Text, Rotating, Single Bitmap, Palletted Bitmap, Double Bitmap
<br/>
T, RT, R, SB, PB, DB...
<br/>
<br/>
Sorry if I caused any confusion</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#44579 - Shade - Fri Jun 03, 2005 1:21 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>strager wrote:</b></span></td> </tr> <tr> <td class="quote">Mode 3 has a single buffer and uses 16-bit color (xBBBBBGGGGGRRRRR).
<br/>
Mode 4 has a double buffer and a pallet.</td> </tr></table><span class="postbody">
<br/>
Exactly... The other tutorial uses Mode 4, and it worked. The first example uses mode 3 (no pallete) and it didn't work, still dunno why. I'll try some more stuff tonight and during the weekend, but frankly, I feel better disposed towards simply going for mode 3. It's enough for my toy projects anyway.
<br/>
<br/>
Cheers</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
