<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>vertical interlacing bug - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Beginners > vertical interlacing bug</h2>
<div id="posts">
<div class="post">
    <h4>#12350 - Zicher - Sat Nov 08, 2003 6:00 pm</h4>
    <div class="postbody"><span class="postbody">Hey all,
<br/>
I'm trying to figure out some of the tutorials around here, and I'm having some trouble getting a Mode 4 piece to work. The object of the code is to display an image on the screen.
<br/>
<br/>
The sample code works fine, but unfortunately when I change the image even a little bit, the screen draws as if I'm "skipping" a line per x-coordinate, which makes it look like vertical interlacing lines. Let me give some examples:
<br/>
<br/>
This code works with the ORIGINAL image provided with the tutorial (loaded in from a header file):
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
SetMode(MODE_4 | BG2_ENABLE);
<br/>
<br/>
  for(loop = 0; loop &lt; 256; loop++)  
<br/>
     BGPaletteMem[loop] = master_Palette[loop]; 
<br/>
     while(1)
<br/>
     {
<br/>
        for(y = 0; y &lt; 160; y++)   
<br/>
        {
<br/>
            for(x = 0; x &lt; 120; x++)   
<br/>
            {
<br/>
                  PlotPixel(x,y, mytile_Bitmap[(y*120)+x]);   
<br/>
            }               
<br/>
        }
<br/>
     }
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Tried to clean that up for the post.. hopefully it worked. Anyway, if I use a image converting program (any, I've tried dozens), and just change out the image data in the header file, the above bug happens. Also, strangely enough, even if I change the PlotPixel line to:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
PlotPixel(x,y, 5);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
for example, the bug also happens!
<br/>
<br/>
I do not think this has to do with the 16-bit word problem of Mode 4, as the code works with the original image.
<br/>
<br/>
Here is the PlotPixel function for completeness:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void PlotPixel(int x,int y, unsigned short c)
<br/>
{
<br/>
      VideoBuffer[(y) * 120 + (x)] = (c);
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Oh GBA Gods, can thee help me?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12352 - yaustar - Sat Nov 08, 2003 6:52 pm</h4>
    <div class="postbody"><span class="postbody">Can you post some pictures onto the web. it night help.
<br/>
<br/>
Off hand, the only thing I can think of is that the image is not being converted properly. Try pcx2gba by Jesder<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12353 - Zicher - Sat Nov 08, 2003 7:22 pm</h4>
    <div class="postbody"><span class="postbody">Here are two examples of what I'm seeing (the code that produces the example is in the screenshot):
<br/>
<br/>
First, the working example:
<br/>
<br/>
<a class="postlink" href="http://www.davekahler.com/gba/output_good.jpg" target="_blank">http://www.davekahler.com/gba/output_good.jpg</a>
<br/>
<br/>
Now, the bad example. Note that the image data is being bypassed completely (it's simply drawing one solid color.. or _should_ be).
<br/>
<br/>
<a class="postlink" href="http://www.davekahler.com/gba/output_bad.jpg" target="_blank">http://www.davekahler.com/gba/output_bad.jpg</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12355 - ampz - Sat Nov 08, 2003 8:19 pm</h4>
    <div class="postbody"><span class="postbody">Try this line in the "bad" example:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">Plotpixel( x, y, 0x55);</td> </tr></table><span class="postbody">
<br/>
<br/>
Mode 4 is a 8bit mode, and the plotpixel function writes two pixels, not one.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12356 - tepples - Sat Nov 08, 2003 8:25 pm</h4>
    <div class="postbody"><span class="postbody">It looks like the converter is outputting in a 16bpp format designed for mode 3, not mode 4. Please read your converter's manual to learn how to fix this.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12359 - Zicher - Sat Nov 08, 2003 9:19 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">It looks like the converter is outputting in a 16bpp format designed for mode 3, not mode 4. Please read your converter's manual to learn how to fix this.</td> </tr></table><span class="postbody">
<br/>
<br/>
thanks tepples, you nailed it! ahhh, I almost forgot what it feels like to be a n00b :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12367 - Zicher - Sun Nov 09, 2003 6:21 am</h4>
    <div class="postbody"><span class="postbody">Okay... part 2:
<br/>
<br/>
I can't seem to dig up anything good about the best way to get good performance using Mode 4. My test program is getting awful performance (a few frames a second).
<br/>
<br/>
What I'm trying to do is basically a full screen pixel-by-pixel write (2 pixels at a time of course because of mode 4) that completely refreshes every frame. Is this a no-no? Am I dreaming?
<br/>
<br/>
I swear I've seen mode 4 demos (i.e. 3d engines) that do just this and perform great. What am I missing?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12371 - yaustar - Sun Nov 09, 2003 2:42 pm</h4>
    <div class="postbody"><span class="postbody">Find a way to optimise the program. Consider the loop at the moment, you are doing 9600 operations per cycle of the while loop. Donr forget about the backbuffer that you can use whilst the other one is being shown and swap between the buffers (Mode 4 does have a back buffer right?)<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12381 - sajiimori - Sun Nov 09, 2003 7:41 pm</h4>
    <div class="postbody"><span class="postbody">You're probably not missing anything in particular.  GBA games such as Doom aren't fast because of any single thing -- it takes lots of trickery and sacrifices to get that kind of speed.  Optimization methods depend completely on what you're actually doing.
<br/>
<br/>
Some general tips:
<br/>
<br/>
- Start simple -- get something to run fast, even if it's just filling the screen with a solid color
<br/>
- Take advantage of specialized hardware, such as DMA and the sprite engine
<br/>
- Precalculate as much as possible
<br/>
- Find out which parts of your program take the most time
<br/>
- Optimize your algorithm and general approach before you do low-level optimizations such as assembly rewrites
<br/>
- Make your innermost loops as simple as possible
<br/>
- Sacrifice quality for speed if you have to</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
