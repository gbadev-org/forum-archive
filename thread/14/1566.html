<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Problem displaying tiles - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Beginners > Problem displaying tiles</h2>
<div id="posts">
<div class="post">
    <h4>#7987 - jcpredator - Mon Jun 30, 2003 12:38 am</h4>
    <div class="postbody"><span class="postbody">When I try to load my first attempt at using tile modes into VBA I get the following results:
<br/>
<br/>
<a href="http://www.angelfire.com/ga4/dstarmaster/tilemodeprob.JPG">[Images not permitted - Click here to view it]</a>
<br/>
<br/>
Here is the code:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">// Defines For Constants/Boolean //
<br/>
#define boolean unsigned char
<br/>
#define true 1
<br/>
#define false 0
<br/>
#define SCREEN_MAX_X 240
<br/>
#define SCREEN_MAX_Y 160
<br/>
///////////////////////////////////
<br/>
<br/>
// Required Included Files //
<br/>
#include &lt;predo_start.c&gt;
<br/>
#include &lt;dispcnt.h&gt;
<br/>
#include &lt;gba.h&gt;
<br/>
#include &lt;keypad.h&gt;
<br/>
#include &lt;Bg.h&gt;
<br/>
#include &lt;tile_test.h&gt;
<br/>
#include &lt;test_tile_map.c&gt;
<br/>
/////////////////////////////
<br/>
<br/>
// Structures for Sprites/BGs //
<br/>
typedef struct OAMEntry
<br/>
{
<br/>
	u16 attribute0;
<br/>
	u16 attribute1;
<br/>
	u16 attribute2;
<br/>
	u16 attribute3;
<br/>
} OAMEntry;
<br/>
<br/>
OAMEntry sprites[128];
<br/>
<br/>
void titleScreen(void);
<br/>
void initGameMode(void);
<br/>
void Wait(u16 seconds);
<br/>
void enableBackground(Bg* bg);
<br/>
<br/>
void AgbMain(void)
<br/>
{
<br/>
	titleScreen();
<br/>
	initGameMode();
<br/>
<br/>
<br/>
	while(1);
<br/>
}
<br/>
<br/>
void titleScreen(void)
<br/>
{
<br/>
	u16 loop, x, y;
<br/>
<br/>
	SetMode(MODE_3 | OBJ_MAP_1D | BG2_ENABLE | OBJ_ENABLE);
<br/>
<br/>
	for(y=0;y&lt;SCREEN_MAX_Y; y++)
<br/>
		for(x=0;x&lt;SCREEN_MAX_X; x++)
<br/>
			VideoBuffer[y*SCREEN_MAX_X+x] = predodata[y*SCREEN_MAX_X+x];
<br/>
<br/>
	while(1)
<br/>
	{
<br/>
		if(!(*KEYS &amp; KEY_START)) break;
<br/>
	}
<br/>
<br/>
	for(loop=0; loop&lt;38400; loop++)
<br/>
		VideoBuffer[loop] = 0x0000;
<br/>
}
<br/>
<br/>
void initGameMode(void)
<br/>
{
<br/>
	u16 loop;
<br/>
	u16* temp;
<br/>
	SetMode(MODE_0 | OBJ_MAP_1D | BG0_ENABLE | 
<br/>
		BG1_ENABLE | BG2_ENABLE | BG3_ENABLE | 
<br/>
		OBJ_ENABLE);// Mode 0, OBJ Enabled, All BG's
<br/>
<br/>
	Bg Bg3;
<br/>
	Bg3.number = 3;
<br/>
	Bg3.charBaseBlock = 0;
<br/>
	Bg3.screenBaseBlock = 28;
<br/>
	Bg3.colorMode = BG_COLOR_256;
<br/>
	Bg3.size = TEXTBG_SIZE_256x256;
<br/>
	Bg3.mosaic = 0;
<br/>
	Bg3.x_scroll = 120;
<br/>
	Bg3.y_scroll = 80;
<br/>
<br/>
	enableBackground(&amp;Bg3);
<br/>
<br/>
	for(loop=0;loop&lt;256;loop++)
<br/>
	{
<br/>
		BGPaletteMem[loop] = tile_testPalette[loop];
<br/>
	}
<br/>
	for(loop=0;loop&lt;tile_test_WIDTH * tile_test_HEIGHT /2;loop++)
<br/>
	{
<br/>
		Bg3.tileData[loop] = tile_testData[loop];
<br/>
	}
<br/>
<br/>
	temp = (u16*)test_tile_map;
<br/>
	for(loop=0;loop&lt;16*16/2;loop++)
<br/>
		Bg3.mapData[loop] = temp[loop];
<br/>
}
<br/>
<br/>
void Wait(u16 seconds)
<br/>
{
<br/>
	//Start the timer
<br/>
	REG_TM0CNT = 0x0 | 0x80;
<br/>
	//zero the timer
<br/>
	REG_TM0D = 0;
<br/>
	while(seconds--)
<br/>
	{
<br/>
		while(REG_TM0D &lt;= 16386){} //wait
<br/>
			REG_TM0D = 0; //reset the timmer
<br/>
	}
<br/>
}
<br/>
<br/>
void enableBackground(Bg* bg)
<br/>
{
<br/>
	u16 temp;
<br/>
<br/>
	bg-&gt;tileData = (u16*)CharBaseBlock(bg-&gt;charBaseBlock);
<br/>
	bg-&gt;mapData = (u16*)ScreenBaseBlock(bg-&gt;screenBaseBlock);
<br/>
	temp = bg-&gt;size | (bg-&gt;charBaseBlock&lt;&lt;SCREEN_SHIFT)|
<br/>
		bg-&gt;colorMode | bg-&gt;mosaic;
<br/>
<br/>
	switch(bg-&gt;number)
<br/>
	{
<br/>
	case 0:
<br/>
		{
<br/>
			REG_BG0CNT = temp;
<br/>
			REG_DISPCNT |= BG0_ENABLE;
<br/>
		}break;
<br/>
	case 1:
<br/>
		{
<br/>
			REG_BG1CNT = temp;
<br/>
			REG_DISPCNT |= BG1_ENABLE;
<br/>
		}break;
<br/>
	case 2:
<br/>
		{
<br/>
			REG_BG2CNT = temp;
<br/>
			REG_DISPCNT |= BG2_ENABLE;
<br/>
		}break;
<br/>
	case 3:
<br/>
		{
<br/>
			REG_BG3CNT = temp;
<br/>
			REG_DISPCNT |= BG3_ENABLE;
<br/>
		}break;
<br/>
	default:break;
<br/>
	}
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Any help would be greatly appreciated, thanks...<br/>_________________<br/>There is no spoon...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7992 - Ninja - Mon Jun 30, 2003 4:13 am</h4>
    <div class="postbody"><span class="postbody">This problem drove me nuts for days when I encountered it.  :)
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
for(loop=0; loop &lt; 16*16/2; loop++) 
<br/>
     Bg3.mapData[loop] = temp[loop]; 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
The problem should be that line.  Change it to this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
for(loop=0; loop &lt; 16*16; loop++) 
<br/>
     Bg3.mapData[loop] = temp[loop]; 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
and see if that fixes things.  Let me know if it doesn't, and I will take a closer look at your code.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8023 - jcpredator - Mon Jun 30, 2003 8:56 pm</h4>
    <div class="postbody"><span class="postbody">Yeah well this problem was very irritating to me also but I finally got it working.
<br/>
<br/>
I changed the following code:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">for(loop=0;loop&lt;256;loop++) 
<br/>
{ 
<br/>
BGPaletteMem[loop] = tile_testPalette[loop]; 
<br/>
} 
<br/>
for(loop=0;loop&lt;tile_test_WIDTH * tile_test_HEIGHT /2;loop++) 
<br/>
{ 
<br/>
Bg3.tileData[loop] = tile_testData[loop]; 
<br/>
} 
<br/>
<br/>
temp = (u16*)test_tile_map; 
<br/>
for(loop=0;loop&lt;16*16/2;loop++) 
<br/>
Bg3.mapData[loop] = temp[loop]; 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
To this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">for(loop=0;loop&lt;14;loop++)
<br/>
	{
<br/>
		BGPaletteMem[loop] = tile_testpalette[loop];
<br/>
	}
<br/>
<br/>
<br/>
	for(loop=0; loop&lt;64*2; loop++)
<br/>
		Bg3.tileData[loop] = obj0[loop];
<br/>
<br/>
	temp = (const u16*)map;
<br/>
	for(loop=0;loop&lt;32*32/2;loop++)
<br/>
		Bg3.mapData[loop] = temp[loop];</td> </tr></table><span class="postbody">
<br/>
<br/>
For some reason it works fine now but my tiles where not displaying right still after the above changes.  I went into the tile viewer in VisualBoy Advance and noticed that both of my tiles where not converted right.  I used a diff tool for the conversion and the tiles where displayed correctly.
<br/>
<br/>
Sad thing is I couldn't really tell you why or how the above code fixed it, maybe someone could explain this to me.
<br/>
<br/>
I also changed the SetMode function that instead of enabling all the BGs I only have the BG3 enabled.  Funny thing is that im still getting things displayed in the other 3 BGs, not sure if thats normal or not, but either way its not effecting the BG that is being displayed.
<br/>
<br/>
My brother, sgt_soup is programming a conversion tool for me so I can have a more realiable and more efficient tool.
<br/>
<br/>
Thanks again,<br/>_________________<br/>There is no spoon...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8725 - jmp_eax - Fri Jul 18, 2003 5:29 pm</h4>
    <div class="postbody"><span class="postbody">try it on a cart... that's all that matters.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
