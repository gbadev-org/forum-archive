<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>bg problems switching from mode 0 to mode 4 - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > bg problems switching from mode 0 to mode 4</h2>
<div id="posts">
<div class="post">
    <h4>#22567 - immortalninjak - Thu Jun 24, 2004 11:13 am</h4>
    <div class="postbody"><span class="postbody">hey ho,
<br/>
I'm having trouble switching  from mode 0-4
<br/>
to start I have 3 bgs in mode 0:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">SetMode(MODE_0 | OBJ_ENABLE | OBJ_MAP_1D);
<br/>
     bg0clear.number = 0;
<br/>
     bg0clear.charBaseBlock = 0;                  
<br/>
     bg0clear.screenBaseBlock = 24;      
<br/>
     bg0clear.colorMode = BG_COLOR_256;      
<br/>
     bg0clear.size = TEXTBG_SIZE_256x256;         
<br/>
     bg0clear.mosaic = 0;                       
<br/>
     bg0clear.x_scroll = 0;         
<br/>
     bg0clear.y_scroll = 0;
<br/>
     bg0clear.priority = BG_P2;
<br/>
      
<br/>
     bg1title.number = 1;
<br/>
     bg1title.charBaseBlock = 0;                  
<br/>
     bg1title.screenBaseBlock = 16;      
<br/>
     bg1title.colorMode = BG_COLOR_256;      
<br/>
     bg1title.size = TEXTBG_SIZE_256x256;         
<br/>
     bg1title.mosaic = 0;                       
<br/>
     bg1title.x_scroll = 200;         
<br/>
     bg1title.y_scroll = 247;
<br/>
     bg1title.priority = BG_P1;
<br/>
      
<br/>
     bg2scroll.number = 2;      
<br/>
     bg2scroll.charBaseBlock = 0;                  
<br/>
     bg2scroll.screenBaseBlock = 8;      
<br/>
     bg2scroll.colorMode = BG_COLOR_256;      
<br/>
     bg2scroll.size = TEXTBG_SIZE_256x256;         
<br/>
     bg2scroll.mosaic = 0;
<br/>
     bg2scroll.x_scroll = 0;
<br/>
     bg2scroll.y_scroll = 0;
<br/>
     bg1title.priority = BG_P3;
<br/>
<br/>
     EnableBackground(&amp;bg0clear);
<br/>
     EnableBackground(&amp;bg1title);
<br/>
     EnableBackground(&amp;bg2scroll);
<br/>
<br/>
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I then mess around with the sprites and scroll the bgs so I reset the scrolling regiters:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   REG_BG2HOFS =0;
<br/>
   REG_BG2VOFS =0;
<br/>
   REG_BG0HOFS =0;
<br/>
   REG_BG0VOFS =0;
<br/>
   REG_BG1HOFS =0;
<br/>
   REG_BG1VOFS =0;</td> </tr></table><span class="postbody">
<br/>
<br/>
 before chaging to mode4:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">SetMode(MODE_4 | BG2_ENABLE | OBJ_ENABLE | OBJ_MAP_1D);
<br/>
   
<br/>
   for (int i = 0; i &lt; 256; i++){
<br/>
      BGPaletteMem[i] = into1Palette[i];
<br/>
   }
<br/>
   REG_DMA3SAD = (u32) &amp;(into1Data[0]);
<br/>
   REG_DMA3DAD = 0x6000000;
<br/>
   REG_DMA3CNT = 9600 | DMA_32NOW;
<br/>
   </td> </tr></table><span class="postbody">
<br/>
<br/>
However this does not seem to work. The screen appears blue repeating the first pixel over and over.
<br/>
Using the map viewer in VBA it shows that everything is ok, with the corretly loaded bg and mode set.
<br/>
If the code above is used seperatly everything is ok. 
<br/>
Only when I switch from mode 0 to 4 do I get this problem.
<br/>
Any ideas?
<br/>
thank you</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22572 - tepples - Thu Jun 24, 2004 2:44 pm</h4>
    <div class="postbody"><span class="postbody">When you switch to a linear bitmap mode, especially after having used mode 1 or 2, you have to reset background 2's affine matrix to pa = 256, pb = 0, pc = 0, pd = 256, x = 0, y = 0.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22577 - immortalninjak - Thu Jun 24, 2004 3:34 pm</h4>
    <div class="postbody"><span class="postbody">thank you so very much.
<br/>
that was exactly the problem
<br/>
me happy now.
<br/>
cheers</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
