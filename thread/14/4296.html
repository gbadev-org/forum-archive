<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Is there a better way to cast a float to a integer? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Beginners > Is there a better way to cast a float to a integer?</h2>
<div id="posts">
<div class="post">
    <h4>#28235 - Andor - Thu Oct 28, 2004 7:22 am</h4>
    <div class="postbody"><span class="postbody">I'm programming a traditional (final fantasy-esque) roleplaying game, with a battle interface complete with health bars and whatnot. To get the amount of the health bar that should be filled (the health bar is 47 pixels wide), I simply take the currentValue of the given character's health, divide it by the maxValue, and multiply the result by 47.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">u8 GetBarLength(u16 curValue, u16 maxValue) {
<br/>
   float percentageValue;
<br/>
   u8 retValue;
<br/>
   
<br/>
   percentageValue = 47 * ((float)curValue/(float)maxValue);
<br/>
   retValue = percentageValue;
<br/>
   return retValue;
<br/>
};</td> </tr></table><span class="postbody">
<br/>
<br/>
This works just fine, except that the compiler spits out a pair of warnings because I cast the float percentageValue to an unsigned byte. Is there a better way to do this - perhaps a way that won't peeve the compiler?
<br/>
<br/>
<a href="http://home.comcast.net/~mithrandel/misc/badoutput.gif">[Images not permitted - Click here to view it]</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#28236 - allenu - Thu Oct 28, 2004 7:31 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Andor wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
This works just fine, except that the compiler spits out a pair of warnings because I cast the float percentageValue to an unsigned byte. Is there a better way to do this - perhaps a way that won't peeve the compiler?
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
That works, but you don't need to use floats at all.  Try this instead:
<br/>
<br/>
   u8 percentageValue = (47 * curValue)/maxValue;
<br/>
<br/>
Assigning floats to ints causes the floats to get truncated (not rounded), so that's likely what your compiler was warning you about.  Basically, that means if you ever have something like this:
<br/>
<br/>
   u8 blah = 1.65;
<br/>
<br/>
blah will equal 1, and not 2.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#28237 - Andor - Thu Oct 28, 2004 7:42 am</h4>
    <div class="postbody"><span class="postbody">Awesome, thanks for the quick reply. Even though that particular warning wasn't causing any errors, it still feels better to have silent compiles. =)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#28246 - poslundc - Thu Oct 28, 2004 2:02 pm</h4>
    <div class="postbody"><span class="postbody">You might consider not using floats at all and using fixed-point math everywhere instead. Floats will wreak utter havoc with your game's performance, and you don't need them.
<br/>
<br/>
Watch out for division, too; it is evil (although sometimes more necessary than floats are).
<br/>
<br/>
Check out the <a class="postlink" href="http://forum.gbadev.org/viewtopic.php?t=418" target="_blank">beginner's FAQ</a> for more insight.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#28250 - isildur - Thu Oct 28, 2004 2:48 pm</h4>
    <div class="postbody"><span class="postbody">What I do instead of using floats or even fixed point, I scale everything by 256. So every unit is 256 instead of 1. This gives me 1/256 precision. When I really need to put it back to a 1 unit size, I just shift by 8. On the gba, it is quite enough precision.
<br/>
<br/>
If I need more precision, I use 1/1024 precision instead.
<br/>
<br/>
So basically, all my trig code uses this form along with look up tables, so I rarely ever need a division. And I find it a lot simpler to use than fixed point, though it is much the same. But using this method makes it easier to use shifts instead of multiplies.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#28252 - poslundc - Thu Oct 28, 2004 3:24 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>isildur wrote:</b></span></td> </tr> <tr> <td class="quote">What I do instead of using floats or even fixed point, I scale everything by 256.</td> </tr></table><span class="postbody">
<br/>
<br/>
Dude, that's fixed point. ;)
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#28259 - isildur - Thu Oct 28, 2004 4:01 pm</h4>
    <div class="postbody"><span class="postbody">Maybe it is just like fixed point but I don't see it like that. I don't use a fixed point type. My units are simply scaled by 256. It probably comes to the same thing, yes. :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#28270 - Andor - Thu Oct 28, 2004 7:23 pm</h4>
    <div class="postbody"><span class="postbody">Okay, I'll look into fixed point calculations. I once ran across an axiom that would apply very well to managing the amount of cpu cycles you're taking up: waste not, want not.
<br/>
<br/>
Thanks for the suggestions. =)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#28271 - abilyk - Thu Oct 28, 2004 7:39 pm</h4>
    <div class="postbody"><span class="postbody">Cearn's <a class="postlink" href="http://user.chem.tue.nl/jakvijn/tonc/index.htm" target="_blank">TONC</a> programming guide has a lot of useful information, including a <a class="postlink" href="http://user.chem.tue.nl/jakvijn/tonc/fixed.htm" target="_blank">section on fixed-point math</a>.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#28276 - allenu - Thu Oct 28, 2004 8:12 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Andor wrote:</b></span></td> </tr> <tr> <td class="quote">Okay, I'll look into fixed point calculations. I once ran across an axiom that would apply very well to managing the amount of cpu cycles you're taking up: waste not, want not.
<br/>
<br/>
Thanks for the suggestions. =)</td> </tr></table><span class="postbody">
<br/>
<br/>
Well, don't start worrying about optimizations until you've got everything working and start noticing that it's too slow.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
