<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Mode 0 tilemap problems - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > Mode 0 tilemap problems</h2>
<div id="posts">
<div class="post">
    <h4>#6497 - OrangyTang - Tue May 27, 2003 9:46 pm</h4>
    <div class="postbody"><span class="postbody">If I use TEXTBG_SIZE_256x256 for a mode 0 background, is this 256x256 pixels, or 256x256 tiles?
<br/>
<br/>
Assuming that its pixels, and so i'm using 8x8 tiles, whats wrong with this code snippit?:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   // Load level tile map (256x256 tile, 2 bytes at a time)
<br/>
   count = 0;
<br/>
   for(u16 loop=0; loop &lt; 32*32/2; loop++)
<br/>
   {
<br/>
      u16 mapTile = (count &lt;&lt; 8) + (count+1);
<br/>
      layer0.mapData[loop] = mapTile;// index into 0-255 tile images.x2
<br/>
<br/>
      count += 2;
<br/>
      if (count &gt;= 255)
<br/>
         count = 0;
<br/>
   }
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Where the Bg object is borrowed from GBA Junkies tutorials:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#ifndef BG_H
<br/>
#define BG_H
<br/>
<br/>
<br/>
///BGCNT defines ///
<br/>
#define BG_MOSAIC_ENABLE      0x40
<br/>
#define BG_COLOR_256         0x80
<br/>
#define BG_COLOR_16         0x0
<br/>
<br/>
#define CharBaseBlock(n)      (((n)*0x4000)+0x6000000)
<br/>
#define ScreenBaseBlock(n)      (((n)*0x800)+0x6000000)
<br/>
<br/>
#define CHAR_SHIFT         2
<br/>
#define SCREEN_SHIFT         8
<br/>
#define TEXTBG_SIZE_256x256      0x0
<br/>
#define TEXTBG_SIZE_256x512      0x8000
<br/>
#define TEXTBG_SIZE_512x256      0x4000
<br/>
#define TEXTBG_SIZE_512x512      0xC000
<br/>
<br/>
#define ROTBG_SIZE_128x128      0x0
<br/>
#define ROTBG_SIZE_256x256      0x4000
<br/>
#define ROTBG_SIZE_512x512      0x8000
<br/>
#define ROTBG_SIZE_1024x1024      0xC000
<br/>
<br/>
#define WRAPAROUND                 0x1
<br/>
<br/>
typedef struct Bg
<br/>
{
<br/>
   u16* tileData;
<br/>
   u16* mapData;
<br/>
   u8 mosaic;
<br/>
   u8 colorMode;
<br/>
   u8 number;
<br/>
   u16 size;
<br/>
   u8 charBaseBlock;
<br/>
   u8 screenBaseBlock;
<br/>
   u8 wraparound;
<br/>
   s16 x_scroll,y_scroll;
<br/>
   s32 DX,DY;
<br/>
   s16 PA,PB,PC,PD;
<br/>
}Bg;
<br/>
<br/>
#ifndef BG_C
<br/>
extern void EnableBackground(Bg* bg);
<br/>
extern void RotateBackground(Bg* bg, int angle, int center_x, int center_y, FIXED zoom);
<br/>
extern void UpdateBackground(Bg* bg);
<br/>
#endif
<br/>
<br/>
#endif// BG_H defined
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
The result i'm aiming for is to get all the tiles loaded displayed, so just running though the tile indices and resetting on 255. The actual result is black lines every other collumn (mistake with writing two at the same time?) and the bottom quater of the screen is still showing the 0 tile, as if my loop isn't long enough.
<br/>
<br/>
Any pointers? Thanks.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6499 - niltsair - Tue May 27, 2003 10:01 pm</h4>
    <div class="postbody"><span class="postbody">Each tile's entry in the map, takes 16bits.
<br/>
<br/>
Bit 0-9 : Tile number
<br/>
Bit 10 : Horizaontal Flip
<br/>
Bit 11: Vertical Flip
<br/>
Bit 12-15 : Palette used (in 16colors mode only)
<br/>
<br/>
thus your loop shoulds look more like this : </span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
// Load level tile map (32x32 tiles for a total of 256x256pixels Map)
<br/>
   count = 0;
<br/>
   for(u16 loop=0; loop &lt; 32*32; loop++)
<br/>
   {
<br/>
        layer0.mapData[loop] = loop % 255;// index into 0-255 tile images.x2
<br/>
   } </td> </tr></table><span class="postbody">
<br/>
I simplified your loop. The <span style="font-weight: bold">%</span> makes sure that your number is always running between 0 and 255.
<br/>
<br/>
Because 10bits are used for the tile's number, you actually have access to 0-1024 tiles, this mean you could replace the %255 by %1024.
<br/>
<br/>
Of course, in order to see something, you would had to have loaded the palette's entries and the Tile's entries in video memory, before trying to display a map.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6500 - tepples - Tue May 27, 2003 10:13 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>niltsair wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">layer0.mapData[loop] = loop % 255;// index into 0-255 tile images.x2</td> </tr></table><span class="postbody">
<br/>
[...]
<br/>
I simplified your loop. The <span style="font-weight: bold">%</span> makes sure that your number is always running between 0 and 255.</span></td> </tr></table><span class="postbody">
<br/>
You probably caught this right after you clicked submit, but it's <span style="font-weight: bold">% 256</span>, or <span style="font-weight: bold">&amp; 255</span>.
<br/>
<br/>
Explanation: Taking n % d is a remainder after division. Where d is a power of 2, n % d = n &amp; (d - 1) provided n and d are positive.  But where d is not a power of 2, that's slow.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6502 - niltsair - Tue May 27, 2003 10:30 pm</h4>
    <div class="postbody"><span class="postbody">Oups :-) Yeah, i knew it should have been 0x100 (256).
<br/>
<br/>
What i never realized though, is that <span style="font-weight: bold">&amp; 0xFF</span> was faster, i shall use it from now on. Is it still faster than <span style="font-weight: bold">%</span> on bases 2?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6521 - OrangyTang - Wed May 28, 2003 9:20 am</h4>
    <div class="postbody"><span class="postbody">Thanks, I was following the GbaJunkie tutorials, but while it notes the differences for warping a rotation background, it never mentions that text backgrounds are stored differently in the tile map :( I should have my palette and tile image data loaded correctly, so i'll give this a whirl when i get a chance.
<br/>
<br/>
Anyone know any good mode 0, 16 colour tile tutorials/info? Everything i've come across assumes you'll be using 256 always, or only rotation backgrounds.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#6531 - niltsair - Wed May 28, 2003 2:39 pm</h4>
    <div class="postbody"><span class="postbody">Mmm, no, but there is small difference from a 256colors background.
<br/>
<br/>
Each pixels of Tile's Data now only takes 4bits. This mean that when you write to VideoMemory for it, you need to write 4 pixels at a time.
<br/>
<br/>
In your Map, for each Tile's Number Entry, you also need to specify which palette to use( between 0-15 ) a palette is simply a sub-range of 16 colors inside your 256 colors palette. So, Pal 0 = Color 0-15, Pal 1 = Color 16-31, Pal 6 = 96 - 111... The palette is specified in bits 12-15, so in the preceding example it would looks like</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
// Load level tile map (32x32 tiles for a total of 256x256pixels Map, 16colors Tiles)
<br/>
    u8 iPal = 5;
<br/>
   for(u16 loop=0; loop &lt; 32*32; loop++)
<br/>
   {
<br/>
        layer0.mapData[loop] = (iPal&lt;&lt;12) | (loop % 256);// index into 0-255 tile images.x2
<br/>
   }</td> </tr></table><span class="postbody">
<br/>
<br/>
<span style="font-weight: bold">(iPal&lt;&lt;12)  :</span> Specify which palette to use for this position in the Map. 
<br/>
<span style="font-weight: bold">(loop % 256) :</span> Specify which tile to use for this position in the Map.
<br/>
<span style="font-weight: bold">((loop % 16)&lt;&lt;12) | (loop % 256) :</span>  Assign both Palette and Tile number value to this position in the Map.
<br/>
<br/>
Take not that you can now use 2x Tiles because they each takes 1/2 spaces of 256colors.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
