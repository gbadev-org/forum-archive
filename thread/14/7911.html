<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Problem with sprite in mode 0 - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Beginners > Problem with sprite in mode 0</h2>
<div id="posts">
<div class="post">
    <h4>#64894 - naleksiev - Wed Dec 28, 2005 4:58 am</h4>
    <div class="postbody"><span class="postbody">Hello,
<br/>
This is my first steps in GBA. I'm playing with sprites in mode 0. I have some problems with my test this is what I see <a class="postlink" href="http://alex.logiga.com/error.png" target="_blank">http://alex.logiga.com/error.png</a> in the left top corrner there is some garbage. My sprite is a rectangle with rounded angles. For some reason I can see only the upper half and this garbage. Any ideas?
<br/>
<br/>
This is how I initialize mode 0
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">REG_BG0CNT = BIT2 | BIT7;
<br/>
SetMode(MODE_0 | BG0_ENABLE | OBJ_ENABLE);</td> </tr></table><span class="postbody">
<br/>
This is the code that initialize the position of my sprite
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   sprites[id].oam = &amp;OAMCopy[id];
<br/>
   sprites[id].x = x;
<br/>
   sprites[id].y = y;
<br/>
   sprites[id].gfxID = 0; 
<br/>
<br/>
   sprites[id].oam-&gt;attribute[0] = COLOR_256 | SQUARE | (y &amp; 0x00FF);  
<br/>
   sprites[id].oam-&gt;attribute[1] = SIZE_16 | (x &amp; 0x01FF);
<br/>
   sprites[id].oam-&gt;attribute[2] = sprites[id].gfxID; 
<br/>
<br/>
   for (int i = 0; i &lt; spriteRawLength &gt;&gt; 1; i++) {
<br/>
      OBJ_GFXMem[sprites[id].gfxID * 16 + i] = spriteRaw[i];  
<br/>
   }
<br/>
<br/>
   for (int i = 0; i &lt; spritePalLength &gt;&gt; 1; i++) {
<br/>
      OBJPaletteMem[i] = spritePal[i];
<br/>
   }</td> </tr></table><span class="postbody">
<br/>
where id = 0
<br/>
<br/>
<br/>
What is the problem? Please help.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#64895 - gauauu - Wed Dec 28, 2005 5:35 am</h4>
    <div class="postbody"><span class="postbody">The junk in the upper-left is probably all the other sprites that you didn't hide.  If you didn't specifically hide them,  they will all tend to appear up there with whatever was in that memory (random garbage)
<br/>
<br/>
The reason the rest of the sprite isn't showing up possibly has to do with 1d vs 2d mapping.  The default is 2d, so open up vba's tile viewer, and make sure your sprite didn't get exported in 1d mode.  How can you tell?
<br/>
<br/>
If it's in 1d mode, all the tiles for that sprite will be in a row.  If in 2d, they will (depending on your version of vba) probably have the top half in one place, and the bottom half on the same line, further off to the right.
<br/>
<br/>
edit:  this applies to 256 color sprites which you are using.  if you use 16 color sprites, they will be spaced out to look just like your sprite should look.
<br/>
<br/>
For example:
<br/>
<br/>
Your sprite (each number is a tile):
<br/>
12
<br/>
34
<br/>
<br/>
In 1d mode, it will be like:  1234
<br/>
In 2d (256 color) mode, it will be like:  12xxxxxxxxxxxxxx34xxxxxxxxxxxxxxxx
<br/>
(where x is some other tile)
<br/>
<br/>
In 2d (16 color), it will be like:
<br/>
12xxxxxxxxxxxxxxxxxxxxx
<br/>
34xxxxxxxxxxxxxxxxxxxxx
<br/>
<br/>
If it's exported as 1d, you can either change the mapping method in the display controller (something like REG_DISPCNT |=  DCNT_OBJ_1D), or change your graphic exporter tool to spit it out in 2d mode.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#64896 - naleksiev - Wed Dec 28, 2005 6:55 am</h4>
    <div class="postbody"><span class="postbody">Thanks for your answer.
<br/>
<br/>
You ware right about 1D/2D. Now my sprite is complete. But the issue with garbage in the corner still occure.
<br/>
<br/>
Yhis is the code that I execute before start loading my sprites.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   for (int i = 0; i &lt; 128; i++) {
<br/>
      OAMCopy[i].attribute[0] = SPRITE_OFF;  
<br/>
   }</td> </tr></table><span class="postbody">
<br/>
<br/>
Thanks again</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#64897 - naleksiev - Wed Dec 28, 2005 7:17 am</h4>
    <div class="postbody"><span class="postbody">Sorry for previews question I've just found my mistake. In UpdateOAM I updated only first sprite. Now my code is
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   for (u32 i = 0; i &lt; 128 * sizeof(OAMEntry) / 4; i++) {
<br/>
      ((u32*)OAMMem)[i] = ((u32*)OAMCopy)[i];
<br/>
   }</td> </tr></table><span class="postbody">
<br/>
and everyting is great.
<br/>
Thanks for your fast answer.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
