<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>devkitpro map problem. - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > devkitpro map problem.</h2>
<div id="posts">
<div class="post">
    <h4>#64981 - skycladmonkey - Thu Dec 29, 2005 4:05 am</h4>
    <div class="postbody"><span class="postbody">Hi
<br/>
I am using devkitpro and im trying to make a map using the island 8 example from gbamappy.
<br/>
<br/>
if screenbase is set to 0 i see a corrupt map. 
<br/>
otherwise it doesnt show at all.
<br/>
i believe im missing something with the screenbase and c har base flags.
<br/>
<br/>
can anyone help?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include &lt;gba_base.h&gt;
<br/>
#include &lt;gba_video.h&gt;
<br/>
#include &lt;gba_systemcalls.h&gt;
<br/>
#include &lt;gba_interrupt.h&gt;
<br/>
#include &lt;gba_input.h&gt;
<br/>
#include "island8.TXT"
<br/>
<br/>
<br/>
// --------------------------------------------------------------------
<br/>
<br/>
int main() {
<br/>
   // Set up the interrupt handlers
<br/>
   InitInterrupt();
<br/>
   // Enable Vblank Interrupt to allow VblankIntrWait
<br/>
   EnableInterrupt(IE_VBL);
<br/>
<br/>
   // Allow Interrupts
<br/>
   REG_IME = 1;
<br/>
   
<br/>
   // set screen H and V scroll positions
<br/>
   BG0HOFS = 0; BG0VOFS = 0;
<br/>
<br/>
   // set the screen base to 31 (0x600F800) and char base to 0 (0x6000000)
<br/>
   BGCTRL[0] = SCREEN_BASE(31);
<br/>
   BGCTRL[0] = CHAR_BASE(0);
<br/>
<br/>
   // screen mode &amp; background to display
<br/>
   SetMode( MODE_0 | BG0_ON );
<br/>
   REG_BG0CNT |=BG_256_COLOR;
<br/>
   REG_BG0CNT |=BG_SIZE_0;
<br/>
   //REG_BG0CNT |=CHAR_BASE(0);
<br/>
   //REG_BG0CNT |=SCREEN_BASE(31);
<br/>
   
<br/>
   int i, x, y;
<br/>
   u16 * gfxpt, * gfxpt2;
<br/>
   u16 * mappt;
<br/>
<br/>
/* Copy the tile graphics to vram 16bits at a time (8bit transfers don't work) */
<br/>
   gfxpt = (u16*)VRAM+0x2000;   /* This is actually +0x4000, but 0x2000 because of short ptr */
<br/>
   gfxpt2 = (u16 *) island8_blockgfx;
<br/>
   for (i=0;i&lt;(sizeof(island8_blockgfx)/2);i++) 
<br/>
   {
<br/>
      gfxpt[i] = gfxpt2[i];
<br/>
   }
<br/>
   
<br/>
/* Copy the 256 colour palette*/ 
<br/>
   for (i=0;i&lt;256;i++) 
<br/>
   {
<br/>
      BG_COLORS[i] = island8_cmap[i];
<br/>
   }
<br/>
<br/>
/* Copy the data to the map memory */
<br/>
   mappt = (u16 *) VRAM;//+0x600F800;
<br/>
   for (y=0;y&lt;32;y++) 
<br/>
   {
<br/>
      for (x=0;x&lt;32;x++) 
<br/>
      {
<br/>
         mappt[(y*32)+x] = (u16) island8_map0[y] [x];
<br/>
      }
<br/>
   }
<br/>
   
<br/>
   
<br/>
   while(1) 
<br/>
   {
<br/>
      VBlankIntrWait();
<br/>
      
<br/>
      
<br/>
      if(!(REG_KEYINPUT &amp; KEY_LEFT))
<br/>
            x--;
<br/>
         
<br/>
      if(!(REG_KEYINPUT &amp; KEY_RIGHT))
<br/>
            x++;
<br/>
         
<br/>
      if(!(REG_KEYINPUT &amp; KEY_UP))
<br/>
            y--;
<br/>
         
<br/>
      if(!(REG_KEYINPUT &amp; KEY_DOWN))
<br/>
            y++;
<br/>
<br/>
      BG0HOFS = x;
<br/>
      BG0VOFS = (y)%(32*8);
<br/>
   }
<br/>
<br/>
   return (0);   // we'll never reach here
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#65000 - blindraccoon - Thu Dec 29, 2005 8:31 am</h4>
    <div class="postbody"><span class="postbody">Without looking to hard, this jumped right out at me:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   // set the screen base to 31 (0x600F800) and char base to 0 (0x6000000)
<br/>
   BGCTRL[0] = SCREEN_BASE(31);
<br/>
   BGCTRL[0] = CHAR_BASE(0);
<br/>
</td> </tr></table><span class="postbody">
<br/>
You set the screen base to 31 but then inadvertently reset it to 0 by assigning the char base, not oring it in.  Should be :
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   BGCTRL[0]  = SCREEN_BASE(31);
<br/>
   BGCTRL[0] |= CHAR_BASE(0);
<br/>
</td> </tr></table><span class="postbody">
<br/>
or better still
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   BGCTRL[0]  = SCREEN_BASE(31) | BGCTRL[0] ;
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/><span style="font-style: italic">There are exactly 10 types of people in the world, those that understand binary and those that don't.</span></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#65016 - skycladmonkey - Thu Dec 29, 2005 4:11 pm</h4>
    <div class="postbody"><span class="postbody">Aargh. I should have spotted that.
<br/>
<br/>
It still doesnt work right though. I get blue and black vertical stripes.
<br/>
<br/>
Am I loading the data into the right places?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#65018 - tepples - Thu Dec 29, 2005 4:22 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>skycladmonkey wrote:</b></span></td> </tr> <tr> <td class="quote">It still doesnt work right though. I get blue and black vertical stripes.</td> </tr></table><span class="postbody">
<br/>
Could you take a PNG format screenshot of the screen and the tile viewer?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#65036 - skycladmonkey - Thu Dec 29, 2005 7:34 pm</h4>
    <div class="postbody"><span class="postbody">Got it
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">gfxpt = (u16*)CHAR_BASE_ADR(0);
<br/>
   gfxpt2 = (u16 *) island8_blockgfx;
<br/>
   for (i=0;i&lt;(sizeof(island8_blockgfx)/2);i++) 
<br/>
   {
<br/>
      gfxpt[i] = gfxpt2[i];
<br/>
   }
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
and 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">mappt = (u16 *) MAP_BASE_ADR(31);
<br/>
   for (y=0;y&lt;32;y++) 
<br/>
   {
<br/>
      for (x=0;x&lt;32;x++) 
<br/>
      {
<br/>
         mappt[(y*32)+x] = (u16) island8_map0[y] [x];
<br/>
      }
<br/>
   }
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
were the culprits.
<br/>
<br/>
Thanks for the help folks!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#68192 - rychan - Mon Jan 23, 2006 1:18 am</h4>
    <div class="postbody"><span class="postbody">Any chance of a url for he code of this mapping demo at all anyone?
<br/>
<br/>
Thanks to sgstair in irc last night again got my _SUBS sorted out and now have a lovely rotating sprite mmm shiny!</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
