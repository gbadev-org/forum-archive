<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>crt0.s - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > crt0.s</h2>
<div id="posts">
<div class="post">
    <h4>#18123 - ProblemBaby - Sun Mar 21, 2004 2:11 am</h4>
    <div class="postbody"><span class="postbody">what is crt0.s?
<br/>
why do people use it?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18130 - poslundc - Sun Mar 21, 2004 4:48 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ProblemBaby wrote:</b></span></td> </tr> <tr> <td class="quote">what is crt0.s?
<br/>
why do people use it?</td> </tr></table><span class="postbody">
<br/>
<br/>
Because your game wouldn't get very far without it...
<br/>
<br/>
crt0.S takes care of all of the necessary loading of your game's data, when you load a GBA program, and then starts the program for you. It also includes a free interrupt handler you can enable by going in and uncommenting a line.
<br/>
<br/>
Try looking at the file. You don't need to be an assembly programmer to understand most of it.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18131 - dagamer34 - Sun Mar 21, 2004 5:10 am</h4>
    <div class="postbody"><span class="postbody">Questions like these are easily answered on the #gbadev channel because the response time is a lot quicker. No need to wait.
<br/>
<br/>
<a href="http://www.mirc.com/" target="_blank">www.mirc.com/</a><br/>_________________<br/>Little kids and Playstation 2's don't mix. :(</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18134 - sajiimori - Sun Mar 21, 2004 6:39 am</h4>
    <div class="postbody"><span class="postbody">eeew irc</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18135 - ProblemBaby - Sun Mar 21, 2004 2:21 pm</h4>
    <div class="postbody"><span class="postbody">what do you mean by take care??
<br/>
how do I add it to my project?
<br/>
<br/>
gcc -o test.elf test.c crt0.s -lm 
<br/>
<br/>
this doesn't work</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18136 - poslundc - Sun Mar 21, 2004 2:37 pm</h4>
    <div class="postbody"><span class="postbody">Well, for one...
<br/>
<br/>
... do you have crt0.s or crt0.S? GCC is case-sensitive.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18138 - yaustar - Sun Mar 21, 2004 2:48 pm</h4>
    <div class="postbody"><span class="postbody">I found 3 crt0.s in my DevKitAdvance folder, which on do I edit and which line needs to be commented?
<br/>
<br/>
edit: ignore this, I found crt0.o :/<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18139 - ProblemBaby - Sun Mar 21, 2004 7:33 pm</h4>
    <div class="postbody"><span class="postbody">I dont understand why you use it!
<br/>
and I dont understand how to use it
<br/>
why just dont skip it??
<br/>
can anyone tell me the actual reason to use it or give me a link to a page that describes it!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18143 - yaustar - Sun Mar 21, 2004 8:14 pm</h4>
    <div class="postbody"><span class="postbody">Using batch files, how would you include it?<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18146 - poslundc - Sun Mar 21, 2004 9:05 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ProblemBaby wrote:</b></span></td> </tr> <tr> <td class="quote">I dont understand why you use it!</td> </tr></table><span class="postbody">
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Me, earlier wrote:</b></span></td> </tr> <tr> <td class="quote">crt0.S takes care of all of the necessary loading of your game's data, when you load a GBA program, and then starts the program for you.</td> </tr></table><span class="postbody">
<br/>
<br/>
What part didn't you understand?
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">and I dont understand how to use it
<br/>
why just dont skip it??</td> </tr></table><span class="postbody">
<br/>
<br/>
If you're able to compile and run GBA programs without explicitly mentioning it then you've probably got your devkit environment configured in such a way that it is loaded automatically.
<br/>
<br/>
Without the crt0 output file (or something equivalent to it), your game would not run.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18148 - Lupin - Sun Mar 21, 2004 9:19 pm</h4>
    <div class="postbody"><span class="postbody">it explicitly puts the CPU into a special state (USR mode), i don't really know why it does that, but it seems to be important. It also sets up your stack pointer and it's branching to the actual code. It is managing the nintendo logo data space as well (i think it's kinda hard to put the logo data into your C code).
<br/>
<br/>
Just accept that you have to use it, if you don't use it your DevKit will most likely use a standard one for you.
<br/>
<br/>
I am not sure, but i think that it is also copying the parts of your ROM that should go to IWRAM/EWRAM to their right location.
<br/>
<br/>
I also think that doing this stuff in C is not possible because you would have to use the "Coprocessor" instruction MSR which you can't access from C (i put Coprocessor in " because the GBA doesn't really have a Coprocessor i think...)
<br/>
<br/>
As you might have noticed my knowledge about this stuff is not so clear :)<br/>_________________<br/><a class="postlink" href="http://pokeme.shizzle.it/" target="_blank">Team Pokeme</a>
<br/>
<a class="postlink" href="http://lupin.shizzle.it/" target="_blank">My blog and PM ASM tutorials</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18152 - Lupin - Sun Mar 21, 2004 9:36 pm</h4>
    <div class="postbody"><span class="postbody">I am now cycling through my crt0.s and trying to understand what it does. It seems like depending on the mode the CPU is in the r13 register will have another purpose, this means that if we go to IRQ mode (which is for interrupt handling i would guess) we set up a stack pointer that will only used within or when calling interrupts.
<br/>
<br/>
I was right with the copy from ROM to RAM, it seems like the RAM data is placed right behind the ROM by the linker. But i am still wondering why my crt0.s file is only copying IWRAM data but not EWRAM...
<br/>
<br/>
Well, maybe you now have more information as you want, but it's very interesting for me to actually take a look at the crt0 file :)<br/>_________________<br/><a class="postlink" href="http://pokeme.shizzle.it/" target="_blank">Team Pokeme</a>
<br/>
<a class="postlink" href="http://lupin.shizzle.it/" target="_blank">My blog and PM ASM tutorials</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18153 - poslundc - Sun Mar 21, 2004 10:03 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Lupin wrote:</b></span></td> </tr> <tr> <td class="quote">I am now cycling through my crt0.s and trying to understand what it does.</td> </tr></table><span class="postbody">
<br/>
<br/>
I think that Devkit Advance comes with a crt0.S (that's with a capitalized "S" instead of lowercase "s" at the end). It is very well-commented and explains what almost every line is for.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18154 - ProblemBaby - Sun Mar 21, 2004 10:28 pm</h4>
    <div class="postbody"><span class="postbody">thanks!
<br/>
<br/>
I've seen people who dont use the standard crt0-file that don't follows with devkitadv how do I use my own 
<br/>
how do i add it to the compilation?
<br/>
<br/>
now i've a batch file that look like this:
<br/>
<br/>
path="C:\devkitadv\bin"
<br/>
gcc -o test.elf test.c -lm
<br/>
objcopy -O binary test.elf test.bin</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18156 - DekuTree64 - Sun Mar 21, 2004 10:45 pm</h4>
    <div class="postbody"><span class="postbody">Yeah, it's not so bad when you actually read through it.
<br/>
All that's really necessary is the header data and stack initialization (just for the record, games normally run in system mode, not user, although they do use the same stack register. Also, msr/mrs are for status registers, mrc/mcr are for coprocessors), the rest is just copying in the I/EWRAM section data and interrupt handling. 
<br/>
One of these days I'm going to have some fun and write a pure ASM demo so I can play with cutting down the Crt0 to exactly what I need, and so I can play with those FIQ regs that I'm always jabbering about. Not sure exactly what I'd use them for, but it sure would be fun^_^
<br/>
<br/>
And ProblemBaby, I'm not sure, but I think you'll have to compile your files to .o files and then link them with ld. That's the normal way of doing it anyway, so you might as well learn how. I've always used makefiles with MSVC++'s NMAKE, so I may be wrong on this, but I think all you have to do is like 
<br/>
<br/>
gcc -o Crt0.o Crt0.S
<br/>
gcc -o file.o file.c
<br/>
ld -T lnkscript -o game.elf Crt0.o file.o
<br/>
objcopy -O binary game.elf game.bin
<br/>
<br/>
lnkscript comes with the Crt0 from <a href="http://www.devrs.com," target="_blank">www.devrs.com,</a> if you don't have it already.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18157 - ProblemBaby - Sun Mar 21, 2004 11:12 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote"> I've always used makefiles with MSVC++'s NMAKE</td> </tr></table><span class="postbody">
<br/>
<br/>
how?
<br/>
in VS.NET</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18168 - DekuTree64 - Mon Mar 22, 2004 3:46 am</h4>
    <div class="postbody"><span class="postbody">Nope, mine's MSVC++ 6.0. Basically you create a makefile project, set the command line to 
<br/>
nmake /f "file.mak"
<br/>
And you're done. Of course, you need to have a makefile to do that. Here's what mine is like
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">PATH=c:\devkitadv\bin;%PATH%
<br/>
<br/>
NAME = Rpg
<br/>
CARMFLAGS   = -c -g -O1 -marm -mthumb-interwork -Wall -ffreestanding
<br/>
CTHUMBFLAGS   = -c -g -O1 -mthumb -mthumb-interwork -Wall -ffreestanding
<br/>
ASFLAGS   = -mthumb-interwork
<br/>
LDFLAGS   = -T lnkscript -Map $(NAME).map
<br/>
all : $(NAME).bin
<br/>
<br/>
$(NAME).bin : $(NAME).elf
<br/>
   objcopy -v -O binary $(NAME).elf $(NAME).bin
<br/>
<br/>
$(NAME).elf : crt0.o main.o 
<br/>
   ld $(LDFLAGS) -o $(NAME).elf crt0.o main.o 
<br/>
<br/>
crt0.o : crt0.s
<br/>
   as $(ASFLAGS) crt0.s -o crt0.o
<br/>
<br/>
main.o : main.c
<br/>
   gcc $(CTHUMBFLAGS) main.c
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I'm not sure how correct it is, I haven't messed with making it any different since I first started out in GBA coding. Never had any reason to, since it works perfectly fine.<br/>_________________<br/>___________
<br/>
The best optimization is to do nothing at all.
<br/>
Therefore a fully optimized program doesn't exist.
<br/>
-Deku</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
