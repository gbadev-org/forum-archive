<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Not working on hardware - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > Not working on hardware</h2>
<div id="posts">
<div class="post">
    <h4>#8959 - VgSlag - Thu Jul 24, 2003 11:37 pm</h4>
    <div class="postbody"><span class="postbody">Hi, I'm new to GBA programming but wanted t get a grip of the basics... I was testing this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include &lt;mygba.h&gt;
<br/>
<br/>
// Graphics Includes
<br/>
// Bg
<br/>
#include "gameBg.raw.c"
<br/>
#include "gameBg.pal.c"
<br/>
<br/>
// Player
<br/>
#include "player.raw.c"
<br/>
#include "player.pal.c"
<br/>
<br/>
// Global Variables
<br/>
u8 player; // Sprite index for the player
<br/>
u8 player_x = 10;
<br/>
u8 player_y = 10;
<br/>
u16 player_rot = 0;
<br/>
<br/>
// Function definitions
<br/>
void vblFunc();
<br/>
void drawScreen();
<br/>
void queryKeys();
<br/>
<br/>
int main(void) {
<br/>
<br/>
   ham_Init();
<br/>
<br/>
   // Setup the background mode
<br/>
    ham_SetBgMode(4);
<br/>
<br/>
   // DMA the background picture
<br/>
   TOOL_DMA1_SET(&amp;gameBg_Bitmap,
<br/>
                     MEM_BG_PTR,
<br/>
                     SIZEOF_32BIT(gameBg_Bitmap),
<br/>
                     DMA_TRANSFER_32BIT,
<br/>
                     DMA_STARTAT_NOW)
<br/>
   
<br/>
   // Initialize the background palette
<br/>
   ham_LoadBGPal(&amp;gameBg_Palette,SIZEOF_16BIT(gameBg_Palette));
<br/>
<br/>
   // Initialize the sprite palette
<br/>
   ham_LoadObjPal(&amp;player_Palette, 256);
<br/>
<br/>
   // Setup the sprite
<br/>
   player = ham_CreateObj(&amp;player_Bitmap,0,2,
<br/>
                        OBJ_MODE_NORMAL,1,0,1,0,0,0,0,player_x,player_y);
<br/>
<br/>
   // Set up the sprite for rotation
<br/>
   ham_SetObjRotEnable(player, 1);
<br/>
<br/>
   // Set the rotation set number
<br/>
   ham_SetObjRotSetSelect(player, 0);
<br/>
<br/>
   // Start the VBL interrupt handler
<br/>
   ham_StartIntHandler(INT_TYPE_VBL,&amp;vblFunc);
<br/>
<br/>
   while(TRUE) {
<br/>
<br/>
   }
<br/>
<br/>
   return 0;
<br/>
}
<br/>
<br/>
void vblFunc() {
<br/>
<br/>
   // Copy block sprite to hardware
<br/>
   ham_CopyObjToOAM();
<br/>
<br/>
   // Check which keys are down
<br/>
   queryKeys();
<br/>
<br/>
   // Re-draw the screen
<br/>
   drawScreen();
<br/>
<br/>
   return;
<br/>
}
<br/>
<br/>
// Function to check the player keys
<br/>
void queryKeys () {
<br/>
<br/>
   // Is Left pressed?
<br/>
   if (F_CTRLINPUT_LEFT_PRESSED) {
<br/>
      --player_x;
<br/>
   }
<br/>
<br/>
   // Is Right pressed?
<br/>
   if (F_CTRLINPUT_RIGHT_PRESSED) {
<br/>
      ++player_x;
<br/>
   }
<br/>
<br/>
   // Is Up pressed?
<br/>
   if (F_CTRLINPUT_UP_PRESSED) {
<br/>
      --player_y;
<br/>
   }
<br/>
<br/>
   // Is Down pressed?
<br/>
   if (F_CTRLINPUT_DOWN_PRESSED) {
<br/>
      ++player_y;
<br/>
   }
<br/>
<br/>
   // Is Start pressed?
<br/>
   if (F_CTRLINPUT_START_PRESSED) {
<br/>
      ++player_rot;
<br/>
   }
<br/>
}
<br/>
<br/>
// Function to draw the player movement
<br/>
void drawScreen () {
<br/>
   ham_SetObjXY(player, player_x, player_y);
<br/>
   ham_RotObjDefineSet(0, player_rot % 360, 0x100, 0x100);
<br/>
}
<br/>
<br/>
/* END OF FILE */
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
It works on the emu but not on the actual hardware... the bg doesn't display. Could anyone explain why please?
<br/>
<br/>
Thanks,
<br/>
<br/>
G</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8961 - yaustar - Fri Jul 25, 2003 12:51 am</h4>
    <div class="postbody"><span class="postbody">Are you going through the transfer port or by flash cartridge?<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8965 - funkeejeffou - Fri Jul 25, 2003 2:38 am</h4>
    <div class="postbody"><span class="postbody">Haven't looked at your code, but did you put the "fix data" option in the flash software?
<br/>
The header of your ROM must be valid otherwise it won't work.
<br/>
There are also some hack utilities to fix this.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8966 - yaustar - Fri Jul 25, 2003 2:48 am</h4>
    <div class="postbody"><span class="postbody">If he/she is going through the transfer port via the boot cable (no cart) then the header does not matter but this line of code needs to be placed somewhere.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
int __gba_multiboot = 0;
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
(taken from the faq on this board)
<br/>
<br/>
Just remove it when you are running from cart.<br/>_________________<br/>[<a class="postlink" href="http://parabellumgames.no-ip.org" target="_blank">Blog</a>] [<a class="postlink" href="http://yaustar.no-ip.org" target="_blank">Portfolio</a>]</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8974 - VgSlag - Fri Jul 25, 2003 7:05 am</h4>
    <div class="postbody"><span class="postbody">I'm running it from the flash cart...
<br/>
<br/>
The sprite and control is working, just not the bg display?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8975 - VgSlag - Fri Jul 25, 2003 7:13 am</h4>
    <div class="postbody"><span class="postbody">The rom was working but I've fixed the header... still the same problem :(
<br/>
<br/>
The sprite is displayed and usable, just not the bg.
<br/>
<br/>
I don't really know what I'm talking about but could it be something to do with this:
<br/>
<br/>
"Sprites in display mode 3, 4, or 5 must use cel data from 0x06014000 to 0x06017FFF because the area in 0x06010000 to 0x06013FFF is reserved for the background. This cel data area corresponds to indices 512 to 1023 in sprite attribute 2. 
<br/>
<br/>
In mode 3 and 5, sprites will not show up behind the background. Use mode 4 if you want this effect. "</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#8981 - VgSlag - Fri Jul 25, 2003 2:45 pm</h4>
    <div class="postbody"><span class="postbody">I'm at work now so can't test it but I think it's to do with this line:
<br/>
<br/>
TOOL_DMA1_SET ...
<br/>
<br/>
I think it should be  TOOL_DMA3_SET...
<br/>
<br/>
Can anyone confirm this for me?
<br/>
<br/>
Thanks,
<br/>
<br/>
G</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
