<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Problem with 512x512 background - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > Problem with 512x512 background</h2>
<div id="posts">
<div class="post">
    <h4>#25628 - ChronoDK - Thu Aug 26, 2004 8:22 am</h4>
    <div class="postbody"><span class="postbody">I'm having some trouble getting 512x512 text backgrounds working. I know about the special layout, and have written code that copies a 512x256 map. But somehow my code just won't work with 512x512 backgrounds. 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void DrawMap512x512(const unsigned short* source, unsigned short* dest)
<br/>
{
<br/>
   short row, tile;
<br/>
<br/>
   for(row = 0; row &lt; 32; row++)
<br/>
   {
<br/>
      for(tile = 0; tile &lt; 32; tile++)
<br/>
      {
<br/>
         dest[0 + tile + (row &lt;&lt; 5)] = source[(tile + 0) + (row &lt;&lt; 6)];
<br/>
         dest[1024 + tile + (row &lt;&lt; 5)] = source[(tile + 32) + (row &lt;&lt; 6)];
<br/>
      }
<br/>
   }
<br/>
<br/>
   for(row = 32; row &lt; 64; row++)
<br/>
   {
<br/>
      for(tile = 0; tile &lt; 32; tile++)
<br/>
      {
<br/>
         dest[2048 + tile + (row &lt;&lt; 5)] = source[(tile + 0) + (row &lt;&lt; 6)];
<br/>
         dest[3072 + tile + (row &lt;&lt; 5)] = source[(tile + 32) + (row &lt;&lt; 6)];
<br/>
      }
<br/>
   }
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Without the last loop it can copy 512x256 maps, but I can't get 512x512 maps to work. 
<br/>
<br/>
I just get the first tile of the charbase repeated all over the screen. 
<br/>
<br/>
There is 7552 bytes of 256-color tiles in charbase 3, and the map starts at screenbase 28. So that should not be the problem right?</span><span class="gensmall"><br/><br/>Last edited by ChronoDK on Thu Aug 26, 2004 1:50 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#25635 - FireOut - Thu Aug 26, 2004 12:14 pm</h4>
    <div class="postbody"><span class="postbody">512x512 backgrounds can be confusing :) Like most other technical gba questions, the answer can be found in the <a class="postlink" href="http://www.cs.rit.edu/~tjh8300/CowBite/CowBiteSpec.htm" target="_blank">CowBite Spec</a>:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Quote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
For 256 x 256 and 256 x 512 backgrounds, the formula for calculating a map index is roughly, 
<br/>
<br/>
mapEntry = tileMapAddress[(tileY * 32) + tileX]
<br/>
<br/>
For text mode sizes 512 x 256 and 512 x 512 backgrounds, however, the map is 64 tiles across, and these are stored in blocks of 32 * 32 tiles. This means that to calculate the map entry that would appear 33 tiles or more across the background, the following equation should be used: 
<br/>
<br/>
mapEntry = tileMap[(tileY * 32) + (tileX - 32) + 32*32]
<br/>
<br/>
For entries 33 tiles or more down (in mode 11), use 
<br/>
<br/>
mapEntry = tileMap[( (tileY-32) * 32) + tileX + 2*32*32];
<br/>
<br/>
And for entries 33 tiles or more down and 33 tiles or more across, 
<br/>
<br/>
mapEntry = tileMap[( (tileY-32) * 32) + (tileX-32) + 3*32*32];
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Good luck ;)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25639 - ChronoDK - Thu Aug 26, 2004 1:47 pm</h4>
    <div class="postbody"><span class="postbody">Thanks, but that didn't help - I think I'm doing it exactly as CowBite tells me to, but it just won't work. 
<br/>
<br/>
I might need someone to tell what exactly is wrong with my code :-)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25649 - sajiimori - Thu Aug 26, 2004 5:04 pm</h4>
    <div class="postbody"><span class="postbody">Try putting one tile at the top left corner of each 256x256 area.  Calculate (by hand) the correct source and destination addresses, then use VBA's console print function (see its FAQ) to see if you are getting what you expected.  Alternatively, compile a similar function natively and use printf.
<br/>
<br/>
It's better to learn how to debug these sorts of problems now, because they certainly don't stop appearing when you move to more advanced material.
<br/>
<br/>
Edit:  Char block 3 and screen block 28 overlap, so be careful.  I'd suggest dedicating char block 0 to screen maps, so there's no chance of overlap.  Also make sure you don't have other bg layers enabled that are covering the one you want to see.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#25653 - ChronoDK - Thu Aug 26, 2004 6:18 pm</h4>
    <div class="postbody"><span class="postbody">Yeah, I know they overlap - but with a little care this is the way I get most out of the blocks. 
<br/>
<br/>
I fixed the code - turns out the biggest mistake was somewhere else, but just to get the code on the board, this is working for me now:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void DrawMap512x512(const unsigned short* source, unsigned short* dest)
<br/>
{
<br/>
   short row, tile;
<br/>
<br/>
   for(row = 0; row &lt; 32; row++)
<br/>
   {
<br/>
      for(tile = 0; tile &lt; 32; tile++)
<br/>
      {
<br/>
         dest[0 + tile + (row &lt;&lt; 5)] = source[tile + 0 + (row &lt;&lt; 6)];
<br/>
         dest[1024 + tile + (row &lt;&lt; 5)] = source[tile + 32 + (row &lt;&lt; 6)];
<br/>
      }
<br/>
   }
<br/>
<br/>
   for(row = 0; row &lt; 32; row++)
<br/>
   {
<br/>
      for(tile = 0; tile &lt; 32; tile++)
<br/>
      {
<br/>
         dest[2048 + tile + (row &lt;&lt; 5)] = source[tile + 2048 + (row &lt;&lt; 6)];
<br/>
         dest[3072 + tile + (row &lt;&lt; 5)] = source[tile + 2080 + (row &lt;&lt; 6)];
<br/>
      }
<br/>
   }
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
