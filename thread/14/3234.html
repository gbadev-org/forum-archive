<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Newbie asm question, invalid constant error - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > Newbie asm question, invalid constant error</h2>
<div id="posts">
<div class="post">
    <h4>#19273 - alek - Thu Apr 15, 2004 8:42 pm</h4>
    <div class="postbody"><span class="postbody">I'm trying to get the division algorithm from <a href="http://www.peter-teichmann.de/adiv1e.html" target="_blank">http://www.peter-teichmann.de/adiv1e.html</a> to work in my project.
<br/>
Here is the pice of the original code which I am having problems with:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
|FDIVS|
<br/>
<br/>
  ands r3,r1,#&amp;80000000
<br/>
  rsbmi r1,r1,#0
<br/>
  eor r3,r3,r0,asr#1             ;bit 31 = quotsign, bit 30 = remsign
<br/>
  cmp r0,#0
<br/>
  rsbmi r0,r0,#0
<br/>
  
<br/>
  mov r12,r14
<br/>
  bl |FDIV|
<br/>
  
<br/>
  tst r3,#&amp;80000000
<br/>
  rsbne r0,r0,#0
<br/>
  tst r3,#&amp;40000000
<br/>
  rsbne r1,r1,#0
<br/>
  
<br/>
  movs pc,r12
<br/>
</td> </tr></table><span class="postbody">
<br/>
I got a lot of errors so I changed it to this
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
fixdivs:
<br/>
   ands r3,r1,#80000000
<br/>
   rsbmi r1,r1,#0
<br/>
   eor r3,r3,r0,asr#1             @bit 31 = quotsign, bit 30 = remsign
<br/>
   cmp r0,#0
<br/>
   rsbmi r0,r0,#0
<br/>
<br/>
   mov r12,r14
<br/>
   bl fixdiv
<br/>
<br/>
   tst r3,#80000000
<br/>
   rsbne r0,r0,#0
<br/>
   tst r3,#40000000
<br/>
   rsbne r1,r1,#0
<br/>
<br/>
   movs pc,r12
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I still get the following errors when I try to compile:
<br/>
fixdiv.s:264: Error: invalid constant -- `ands r3,r1,#80000000'
<br/>
fixdiv.s:273: Error: invalid constant -- `tst r3,#80000000'
<br/>
fixdiv.s:275: Error: invalid constant -- `tst r3,#40000000'
<br/>
<br/>
what shoul I do
<br/>
thanks,
<br/>
<br/>
I didn't know whether to put this post in the asm forum or the beginner forum but since this is not a complex problem I decided to put it here</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19274 - poslundc - Thu Apr 15, 2004 9:28 pm</h4>
    <div class="postbody"><span class="postbody">What assembler are you using?
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19275 - alek - Thu Apr 15, 2004 9:31 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>poslundc wrote:</b></span></td> </tr> <tr> <td class="quote">What assembler are you using?
<br/>
<br/>
Dan.</td> </tr></table><span class="postbody">
<br/>
<br/>
I'm using gcc.
<br/>
<br/>
The error I got before I changed it was 
<br/>
fixdiv.s:264: Error: bad expression -- `ands r3,r1,#&amp;80000000'
<br/>
fixdiv.s:273: Error: bad expression -- `tst r3,#&amp;80000000'
<br/>
fixdiv.s:275: Error: bad expression -- `tst r3,#&amp;40000000'</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19277 - tepples - Thu Apr 15, 2004 9:40 pm</h4>
    <div class="postbody"><span class="postbody">Different assemblers seem to want different syntaxes for hexadecimal constants. GAS might be happier with hex constants prefaced by '0x': <span style="font-weight: bold">#0x80000000</span><br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#19278 - alek - Thu Apr 15, 2004 9:54 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>tepples wrote:</b></span></td> </tr> <tr> <td class="quote">Different assemblers seem to want different syntaxes for hexadecimal constants. GAS might be happier with hex constants prefaced by '0x': <span style="font-weight: bold">#0x80000000</span></td> </tr></table><span class="postbody">
<br/>
<br/>
yepp, that did the trick. Thanks for the help.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
