<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Dynamic Map Loading Woes - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Beginners > Dynamic Map Loading Woes</h2>
<div id="posts">
<div class="post">
    <h4>#8938 - XeroxBoy - Thu Jul 24, 2003 11:24 am</h4>
    <div class="postbody"><span class="postbody">OK, basically, I've been trying for quite a good chunk of time getting dynamic map loading (i.e. swapping in rows/columns as you scroll) to work. I perfectly understand the concept, and, from what I can tell, nearly have it working correctly, but I still seem to be having some troubles. The issue is complicated by the fact that, as a method of compressing my maps, I store them in 16x16 tile format. So, I would greatly appreciate it if anyone could take a look at my code and point out exactly what I'm doing wrong. And, yes, I'm well aware that the code is actually rather sloppy and unoptimized - I subscribe to the school that optimizations should be done after the code actually works right. Also note that this comes from my map editor (ideally, I design the map on the GBA and save it to SRAM), so there's no smooth scrolling and things like variable names make more sense coming from that context.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
u16 MapScrollVert = 0; // Keeps track of, in pixels, how far the screen has scrolled
<br/>
u16 MapScrollHoriz = 0;
<br/>
u8 CursorY = 0; // Keeps track of where exactly the cursor is in the world (in 16x16 tile notation)
<br/>
u8 CursorX = 0;
<br/>
u8 TempScrollY; // Used for jamming into the scroll registers
<br/>
u8 TempScrollX;
<br/>
u8 CounterDown=9; // Where the bottom of the screen is (in 16x16 tile notation)
<br/>
u8 CounterUp=0;
<br/>
u8 CounterRight=14;
<br/>
u8 CounterLeft=0;
<br/>
u8 CounterX; // How many times we've scrolled an entire screen
<br/>
u8 CounterY;
<br/>
<br/>
int main()
<br/>
{
<br/>
   // Random Crap
<br/>
   DisplayMap(); //Loads the first section of the map into VRAM (works perfectly)
<br/>
   do
<br/>
   {
<br/>
      if(!( (*KEYS) &amp; KEY_DOWN))
<br/>
      {
<br/>
         if(MapScrollVert == 864) // Cursor is near the end of the screen
<br/>
         {
<br/>
            if(CursorY!=63) // If cursor ISN'T at the end of the screen
<br/>
            {
<br/>
               CursorY++;
<br/>
            }
<br/>
         }
<br/>
         else
<br/>
         {
<br/>
            CursorY++;
<br/>
            LoadRowDown();
<br/>
            TempScrollY+=16;
<br/>
            REG_BG0VOFS = TempScrollY;
<br/>
            MapScrollVert+=16;
<br/>
         }
<br/>
      }
<br/>
<br/>
// more crap, including the other directions, the end of the loop, etc. If no one can find the problem in just this, I'll post the rest
<br/>
<br/>
void LoadRowDown()
<br/>
{
<br/>
   u8 x;
<br/>
   u8 tempx = 0;
<br/>
   u8 tempy;
<br/>
   u8 y;
<br/>
<br/>
   CounterDown++;
<br/>
   CounterUp++;
<br/>
<br/>
   if(CounterDown==16)
<br/>
      CounterDown=0;
<br/>
   if(CounterUp==16)
<br/>
   {   
<br/>
      CounterUp=0;
<br/>
      CounterY++;
<br/>
   }
<br/>
<br/>
<br/>
   tempy = CounterDown*2;
<br/>
<br/>
   y = CursorY;
<br/>
<br/>
   for (x=CounterX*16;x&lt;CounterX*16+16;x++) 
<br/>
   {
<br/>
      m0[tempy*32+tempx]=Map[y*32+x];
<br/>
      m0[tempy*32+tempx+1]=(Map[y*32+x]+1);
<br/>
      m0[tempy*32+tempx+32]=(Map[y*32+x]+2);
<br/>
      m0[tempy*32+tempx+33]=(Map[y*32+x]+3);
<br/>
      tempx += 2;
<br/>
   }
<br/>
}</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
