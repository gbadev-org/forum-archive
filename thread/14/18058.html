<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Help with drawing a simple tiled background - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Beginners > Help with drawing a simple tiled background</h2>
<div id="posts">
<div class="post">
    <h4>#178484 - themanwhoran - Wed Sep 23, 2015 3:38 pm</h4>
    <div class="postbody"><span class="postbody">Hi everyone, I'm new to the GBAdev forums. I know the C programming language fairly well but I am having trouble drawing a background on my GBA game. I am trying to make a football field kicking game where the ball moves back and forth on the screen and you have to press the button at the right time to kick the goal correctly. So far I have drawn a background image in Usenti ( <a href="http://i.imgur.com/VqWPmFT.png" target="_blank">http://i.imgur.com/VqWPmFT.png</a> ) and exported it to a tilemap. I got this as the export ( <a href="https://www.mediafire.com/folder/cm1dfdjq9a4b6/fieldbgexport" target="_blank">https://www.mediafire.com/folder/cm1dfdjq9a4b6/fieldbgexport</a>  ). I have been following TONC's tutorial  to make GBA games but I will admit it's a little technical and confusing for me. Anyway using the tutorial for making backgrounds as a model I tried to display my background using this  ( <a href="http://i.imgur.com/vKS5r6V.png" target="_blank">http://i.imgur.com/vKS5r6V.png</a> ) as my source code and got this outputnin the emulator ( <a href="http://i.imgur.com/V767GzB.png" target="_blank">http://i.imgur.com/V767GzB.png</a> ). If someone could help me through this problem and explain where I went wrong that would be amazing. I have been stuck on this for a while and it would be great if I could understand more what I am coding, I have been copying TONC's code and halfway understanding what I am doing but I guess all the concepts I should have been studying up on have finally caught up to me. Here is a download link for my entire project ( <a href="http://www.mediafire.com/download/gzk4c94997c499l/feildgoalgame_2.0.zip" target="_blank">http://www.mediafire.com/download/gzk4c94997c499l/feildgoalgame_2.0.zip</a> )</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#178485 - sverx - Thu Sep 24, 2015 10:49 am</h4>
    <div class="postbody"><span class="postbody">I wonder if the problem arises from the original image which is true color instead of palettized. Try saving it as a 16-color image...<br/>_________________<br/><a class="postlink" href="http://bit.ly/yiQrz9" target="_blank">libXM7</a>|<a class="postlink" href="http://bit.ly/yJwcOo" target="_blank">NDS programming tutorial (Italiano)</a>|<a class="postlink" href="http://disjointedstudio.blogspot.com/" target="_blank">Waimanu DS / GBA</a>|<a class="postlink" href="http://adshomebrewersdiary.blogspot.com" target="_blank">A DS Homebrewer's Diary</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#178486 - themanwhoran - Fri Sep 25, 2015 3:02 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sverx wrote:</b></span></td> </tr> <tr> <td class="quote"> Try saving it as a 16-color image...</td> </tr></table><span class="postbody">
<br/>
<br/>
Here is the output when I save it as a 16 color image.  ( <a href="http://i.imgur.com/fLaHLlj.png" target="_blank">http://i.imgur.com/fLaHLlj.png</a> )
<br/>
<br/>
I think it is a problem with where I place the tiles. Notice how pieces of the sun are pasted on the other side of the screen and the letters across the field are jumbled. Perhaps a problem with my source code.Thoughts?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#178487 - sverx - Mon Sep 28, 2015 10:24 am</h4>
    <div class="postbody"><span class="postbody">BG0 can't be 'affine', so you probably want to make it 'text'. Not sure if that's the problem anyway...
<br/>
<br/>
also, I meant you could save your image as 16 colors using your own palette, not 'windows' one :)<br/>_________________<br/><a class="postlink" href="http://bit.ly/yiQrz9" target="_blank">libXM7</a>|<a class="postlink" href="http://bit.ly/yJwcOo" target="_blank">NDS programming tutorial (Italiano)</a>|<a class="postlink" href="http://disjointedstudio.blogspot.com/" target="_blank">Waimanu DS / GBA</a>|<a class="postlink" href="http://adshomebrewersdiary.blogspot.com" target="_blank">A DS Homebrewer's Diary</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#178491 - themanwhoran - Fri Oct 02, 2015 3:02 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sverx wrote:</b></span></td> </tr> <tr> <td class="quote">BG0 can't be 'affine', so you probably want to make it 'text'. Not sure if that's the problem anyway...</td> </tr></table><span class="postbody">
<br/>
Ok I'm not quite sure what you mean by change it to 'text' the only other function I have access to is BG_REG. (http://i.imgur.com/dBFYBch.png)  I did this and it didn't change anything. One thing I have noticed is that when I compile I get a warning "incompatible implicit declaration of built-in function memcpy" which should mean that memcpy has not been defined. I looked through my header files and, sure enough, I could not find memcpy. However, when I compiled TONC's background demo ( <a href="http://www.mediafire.com/download/7it8nkf0xf1s4i8/brin_demo.zip" target="_blank">http://www.mediafire.com/download/7it8nkf0xf1s4i8/brin_demo.zip</a> ), which has the same header files as me there is no warning
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>sverx wrote:</b></span></td> </tr> <tr> <td class="quote">also, I meant you could save your image as 16 colors using your own palette, not 'windows' one :)</td> </tr></table><span class="postbody">
<br/>
Forgive my stupidity but I cannot figure out how to do this. I figured that the box on the right was for creating pallattes, and the '16' button changes it to a 16 color image but when I color pick the colors from my image and hit the '16' button I get this as export ( <a href="http://i.imgur.com/pBIbSng.png" target="_blank">http://i.imgur.com/pBIbSng.png</a> ). Thank you so much for your help and sorry for being such a noob. I really appreciate that you are willing to help me.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#178492 - sverx - Tue Oct 06, 2015 9:58 am</h4>
    <div class="postbody"><span class="postbody">BG_REG_32 seems correct. But I really can't get what's wrong. I suspect there could be a bug in usenti (I use 'grit' instead... you might want to try that too...)<br/>_________________<br/><a class="postlink" href="http://bit.ly/yiQrz9" target="_blank">libXM7</a>|<a class="postlink" href="http://bit.ly/yJwcOo" target="_blank">NDS programming tutorial (Italiano)</a>|<a class="postlink" href="http://disjointedstudio.blogspot.com/" target="_blank">Waimanu DS / GBA</a>|<a class="postlink" href="http://adshomebrewersdiary.blogspot.com" target="_blank">A DS Homebrewer's Diary</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#178495 - elhobbs - Tue Oct 06, 2015 6:04 pm</h4>
    <div class="postbody"><span class="postbody">I think tonc provides an arm asm version of memcpy.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#178507 - themanwhoran - Fri Oct 16, 2015 3:29 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>elhobbs wrote:</b></span></td> </tr> <tr> <td class="quote">I think tonc provides an arm asm version of memcpy.</td> </tr></table><span class="postbody">
<br/>
Again, forgive my stupidity, but asm? As in assembly language? I am using C on my project, is it possible to integrate assembly into my code? Thank you for the help.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#178510 - gauauu - Mon Oct 19, 2015 6:48 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>themanwhoran wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
Again, forgive my stupidity, but asm? As in assembly language? I am using C on my project, is it possible to integrate assembly into my code? Thank you for the help.</td> </tr></table><span class="postbody">
<br/>
<br/>
Yeah, it's not complicated to integrate assembly language. I'm not expert on it, but if you are using devkitPro's standard makefiles, adding an assembly language file with a .s file will automatically get compiled properly.  Then you can add a header file that declares the function, and then call it like a regular C function.
<br/>
<br/>
Some examples, thanks to Cearn:
<br/>
<br/>
In ndscpy.s
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
@ ---------------------------------------------------------------------
<br/>
@ EXTERN_C void ndscpy(const void *srcv, void *dstv, uint size);
<br/>
@ ---------------------------------------------------------------------
<br/>
<br/>
   @ .section .iwram, "ax", %progbits
<br/>
   .text
<br/>
   .arm
<br/>
   .balign 32
<br/>
   .global ndscpy
<br/>
ndscpy:
<br/>
   cmp      r2, #0
<br/>
   bxeq   lr
<br/>
   stmfd   sp!, {r4-r9}
<br/>
/*  ....etc, rest of assembly function ommitted */
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Then in ndscpy.h:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void ndscpy  (const void *srcv, void *dstv, unsigned int size);
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Then you can call it like any normal function:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   ndscpy(src, dest, length);
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
