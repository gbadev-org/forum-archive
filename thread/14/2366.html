<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>sprite coordinates problem - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > sprite coordinates problem</h2>
<div id="posts">
<div class="post">
    <h4>#12689 - ken2 - Sat Nov 22, 2003 7:37 pm</h4>
    <div class="postbody"><span class="postbody">I have a problem involving the sprite flipping upside down when it gets to -1 x on the screen. From what I've heard before, this is a probably a problem with the real coordinates of the sprite, but the funny thing is I'm using a function that looks like it should fix that.. could anyone tell me if anything is wrong with this code? I pass it soanso.x and soandso.y once I have an input check which changes them around.
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void MoveSprite(OAMEntry* sp, int x, int y)
<br/>
{
<br/>
   if(x &lt; 0)         
<br/>
      x = 512 + x;
<br/>
   if(y &lt; 0)      
<br/>
      y = 256 + y;
<br/>
<br/>
   sp-&gt;attribute1 = sp-&gt;attribute1 &amp; 0xFE00; 
<br/>
   sp-&gt;attribute1 = sp-&gt;attribute1 | x;
<br/>
<br/>
   sp-&gt;attribute0 = sp-&gt;attribute0 &amp; 0xFF00;  
<br/>
   sp-&gt;attribute0 = sp-&gt;attribute0 | y;
<br/>
}</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12692 - tepples - Sat Nov 22, 2003 10:08 pm</h4>
    <div class="postbody"><span class="postbody">In your code, what happens when x = -513? Then after your if() statements, the sprite X attribute gets OR'd with -1, and its reflection bits get set. Here's corrected code that makes sure that the coordinates do not affect attribute bits:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void MoveSprite(OAMEntry* sp, int x, int y)
<br/>
{
<br/>
  x &amp;= 0x01FF;  /* chop off high bits no matter how far the sprite goes */
<br/>
  y &amp;= 0x00FF;
<br/>
<br/>
  sp-&gt;attribute1 = sp-&gt;attribute1 &amp; 0xFE00; 
<br/>
  sp-&gt;attribute1 = sp-&gt;attribute1 | x;
<br/>
<br/>
  sp-&gt;attribute0 = sp-&gt;attribute0 &amp; 0xFF00;  
<br/>
  sp-&gt;attribute0 = sp-&gt;attribute0 | y;
<br/>
}</td> </tr></table><span class="postbody"><br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12696 - sgeos - Sun Nov 23, 2003 6:44 am</h4>
    <div class="postbody"><span class="postbody">tepples' solution is better, but here is another one.  Replace this code:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   if(x &lt; 0)         
<br/>
      x = 512 + x;
<br/>
   if(y &lt; 0)      
<br/>
      y = 256 + y;</td> </tr></table><span class="postbody">
<br/>
<br/>
With this code:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   while (x &lt; 0)         
<br/>
      x = 512 + x;
<br/>
   while (y &lt; 0)      
<br/>
      y = 256 + y;</td> </tr></table><span class="postbody">
<br/>
<br/>
-Brendan</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#12758 - Mix - Tue Nov 25, 2003 6:50 pm</h4>
    <div class="postbody"><span class="postbody">I noticed this problem in one of the Pern project tutorials, and the way I fixed it was to guarantee that x and y are within the proper range prior to passing them to the MoveSprite function.  For example, if the program is checking for the keypad input and then moving the sprite, instead of having:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">if(x &lt; 0)          
<br/>
      x = 512 + x;</td> </tr></table><span class="postbody">
<br/>
in the MoveSprite function, move it to the place after you check for the left keypad and subtract from x.  That way the x in your main program won't ever get to ridiculously low numbers.
<br/>
<br/>
I don't mean to say that this way is better, because these other folks have much more experience than me.  It just made more sense to me to move the check up front rather than pass "garbage" input to the MoveSprite function.  Maybe instead of trying to correct the input, the MoveSprite function should be flagging an exception if it gets bad input coordinates.  Can you others comment on this approach?</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
