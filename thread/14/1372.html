<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>math class is hard - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Beginners > math class is hard</h2>
<div id="posts">
<div class="post">
    <h4>#6877 - hnager - Wed Jun 04, 2003 2:11 am</h4>
    <div class="postbody"><span class="postbody">This one has been haunting me for a day and a half now - I'm working on some sprite tests inorder to teach myself gba development - below is a snipet of a 'tank game' which I'm making...I'm using 16 pre rotated sprites (one thing at a time...sprite rotation will come later). You can see that the right/left buttons affect the tank's current frame (used as an index in an array and set in attribute2). 
<br/>
<br/>
My problem is with up/down. To start - I've had no luck using a lookup table because the index is cast to a (float) : PI*angle/180 - I went back to using the math functions for now (one thing at a time ;). The other problem I'm having is that the motion just doesn't seem 'right'. It should be like a classic tank game...but it's both too fast (and responsive) and the speed doesnt seem consistent for all the angles.
<br/>
<br/>
In short - help! My math is rusty and I could stare at it all night and miss the obvious - if there is one.
<br/>
<br/>
// DEFINES //////////////////////
<br/>
#define TANK_SPEED		2
<br/>
#define PI			(float)3.14159
<br/>
<br/>
<br/>
etc etc
<br/>
<br/>
main(){
<br/>
<br/>
...
<br/>
<br/>
while(1){
<br/>
<br/>
if(!(KEYS &amp; KEY_UP)){
<br/>
<br/>
	angle = (90+360-22.5*tank1_direction);
<br/>
	dx = TANK_SPEED * cos(PI*angle/180);
<br/>
	dy = TANK_SPEED * sin(PI*angle/180);
<br/>
<br/>
	tank1.x += (int)(dx+.5);
<br/>
	tank1.y -= (int)(dy+.5);
<br/>
<br/>
}
<br/>
if(!(KEYS &amp; KEY_DOWN)){
<br/>
<br/>
	angle = (90+360-22.5*tank1_direction);
<br/>
	dx = TANK_SPEED * cos(PI*angle/180);
<br/>
	dy = TANK_SPEED * sin(PI*angle/180);
<br/>
<br/>
	tank1.x += (int)(dx+.5);
<br/>
	tank1.y -= (int)(dy+.5);
<br/>
	//tank1.y += 1;
<br/>
<br/>
}
<br/>
if(!(KEYS &amp; KEY_LEFT)){
<br/>
	if(--tank1_direction &lt; 0) tank1_direction = 15;
<br/>
<br/>
}
<br/>
if(!(KEYS &amp; KEY_RIGHT)){
<br/>
	if(++tank1_direction &gt; 15) tank1_direction = 0;
<br/>
<br/>
}
<br/>
<br/>
...
<br/>
<br/>
} //end while
<br/>
<br/>
...
<br/>
<br/>
} //end main</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7125 - Ein_Vante - Tue Jun 10, 2003 4:39 am</h4>
    <div class="postbody"><span class="postbody">Perhaps you should use a 2x3 matrix to keep track of rotation and position instead? Speed will vary depending on your direction if you're moving one pixel/point per step, you must use floats or at least fixed point for this(precision vs. speed) since the diagonal is obviosly longer than the height or width of anything cubic.
<br/>
I can't tell if you're using floats or integers in that code segment of your, so I simply have to guess.
<br/>
<br/>
If you want to vary the responsivness of the tank, make it more tanklike, then you might want to vary the ability to turn based on how fast it's moving. Pre-calc a table for this and multiply your ability to turn with whatever number you find that correspond to the speed and also decrease the speed when turning.
<br/>
The table should range between 1-0 where 1 gives absolute ability to turn and 0 won't turn at all, but taking into account that you decrease your speed when turning the turning will just seem "sluggish" at top speed.
<br/>
And that corresponds pretty well to a tank considering that it turns by varying the speeds on its tracks.
<br/>
<br/>
Well, that's just some ideas I come up with, perhaps you'll find something that you can use in them.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7169 - djei-dot - Wed Jun 11, 2003 10:43 am</h4>
    <div class="postbody"><span class="postbody">Maybe it is a dumb answer, but shouldn't you wait for Vblank? I've done some studies with the gbaguy's tutorials and in simple instructions - pixel drawing when key is pressed, etc. - it is really fast (and that surprised me since all the complaints in this forum are about the GBA being slow). I think that if you put the WaitForVBlank instruction it will be significantly slower.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7199 - hnager - Thu Jun 12, 2003 2:53 am</h4>
    <div class="postbody"><span class="postbody">same as WaitForVsync()? That definately helps keep things going at a manageable speed, but it still is pretty quick (at or around 60 times a second - i believe). What kinds of techniques do people use to create slower motion without keypresses being ignored (if you only capture everyother frame for example).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7211 - tepples - Thu Jun 12, 2003 10:18 am</h4>
    <div class="postbody"><span class="postbody">Fixed-point arithmetic to the rescue:  Set up your game coordinate system so that 256 units equal one pixel. Then you can easily represent velocities smaller than one pixel per delta-t.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7221 - hnager - Thu Jun 12, 2003 1:54 pm</h4>
    <div class="postbody"><span class="postbody">Thanks - I'll try that, would shifting dx and dy do the same? It also sounds as if I should take advantage of hardware rotation (sprites) instead of the fixed 15 frames I have now, how else would I slow down the frame increment? Currently I have it ++ and -- based on left and right.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7222 - niltsair - Thu Jun 12, 2003 2:18 pm</h4>
    <div class="postbody"><span class="postbody">I create timers based on VBlank. Then I just check if the amount of ms occur before taking into acount the same keypress again(when it's being holded).
<br/>
<br/>
To do this, just create a global variable (or as many as you want timer) that will hold the count. Create another global variable that will tell the state of the timer (enabled/stoped). Now, on each VBlank interupt, increase the value by 1 if the timer is enabled. 
<br/>
<br/>
In code where you need to use timer, declare those 2 variables as external, and just access them to know time. I used this technique because VBlank has a much more reliable behavior in the different emulators than the hardward timers.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7225 - hnager - Thu Jun 12, 2003 2:24 pm</h4>
    <div class="postbody"><span class="postbody">Out of curiousity - why do you declare as external?
<br/>
<br/>
could I also do something like:
<br/>
<br/>
if(!(KEYS &amp; KEY_RIGHT)){ 
<br/>
      if(!(count%3)){
<br/>
         if(++tank1_direction &gt; 15) tank1_direction = 0; 
<br/>
     }
<br/>
}
<br/>
<br/>
??</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7231 - niltsair - Thu Jun 12, 2003 2:44 pm</h4>
    <div class="postbody"><span class="postbody">You delcare the timer's variables(count, state) in the same source file as where the interupt are declared. Then you redeclare it somewhere else (might be in a header used be every files) the exact same way you did previously, but with an external in front. This tell the compiler that it needs to find an already existing variable somewhere in your source files, at linking stage. 
<br/>
<br/>
It basicly allow you to use global variable that are usually unreacheable because not in the same .cpp file.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
