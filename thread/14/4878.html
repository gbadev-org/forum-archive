<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Priorities using 4 bgs & Sprites in Mode 0 - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Beginners > Priorities using 4 bgs & Sprites in Mode 0</h2>
<div id="posts">
<div class="post">
    <h4>#34586 - arock99 - Sat Jan 22, 2005 12:03 am</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
First of all thanks for the help i had displaying custom bgs...
<br/>
I have another issue and this time around i did more looking around but either i didnt understand what i read (most likely) or i  just didnt find exactly what i was looking for.  I want to display things in the following order:
<br/>
bg0
<br/>
bg1 over bg0
<br/>
bg2 over bg1
<br/>
sprites over bg2
<br/>
bg3 over sprites
<br/>
<br/>
everything works fine except my sprite is showing up over all my backgrounds...
<br/>
here is the source code...keep in mind im not using anything exciting graphic-wise...i figured i'd want to learn the basics before worrying about artsy stuff :) Thanks in advance!
<br/>
<br/>
	u8 i, x, y;
<br/>
	u8 Bg0ScreenBlock = 19, Bg1ScreenBlock = 20, Bg2ScreenBlock = 24, Bg3ScreenBlock = 28;
<br/>
	u16* Bg0Screen = (u16*)ScreenBaseBlock(Bg0ScreenBlock);
<br/>
	u16* Bg1Screen = (u16*)ScreenBaseBlock(Bg1ScreenBlock);
<br/>
	u16* Bg2Screen = (u16*)ScreenBaseBlock(Bg2ScreenBlock);
<br/>
	u16* Bg3Screen = (u16*)ScreenBaseBlock(Bg3ScreenBlock);
<br/>
	u8* CharBB = (u8*) CharBaseBlock(0);
<br/>
	//Priority 0 = Displays on top of all Backgrounds
<br/>
	//Priority 3 = Displays under all Backgrounds
<br/>
	REG_BG0CNT = BG_COLOR256 | TEXTBG_SIZE_256x256 | (Bg0ScreenBlock &lt;&lt; SCREEN_SHIFT) | (0 &lt;&lt; CHAR_SHIFT) | 3;
<br/>
	REG_BG1CNT = BG_COLOR256 | TEXTBG_SIZE_512x512 | (Bg1ScreenBlock &lt;&lt; SCREEN_SHIFT) | (0 &lt;&lt; CHAR_SHIFT) | 2;
<br/>
	REG_BG2CNT = BG_COLOR256 | TEXTBG_SIZE_512x512 | (Bg2ScreenBlock &lt;&lt; SCREEN_SHIFT) | (0 &lt;&lt; CHAR_SHIFT) | 1;
<br/>
	REG_BG3CNT = BG_COLOR256 | TEXTBG_SIZE_512x512 | (Bg3ScreenBlock &lt;&lt; SCREEN_SHIFT) | (0 &lt;&lt; CHAR_SHIFT) | 0;
<br/>
	REG_BLDMOD = BIT1 | BIT6 | BIT0 | BIT12;
<br/>
    SetMode(MODE_0 | BG0_ENABLE | BG1_ENABLE | BG2_ENABLE | BG3_ENABLE | OBJ_ENABLE | OBJ_MAP_1D);
<br/>
<br/>
	//create an array of 128 sprites equal to OAM
<br/>
	Sprite sprites[128];
<br/>
<br/>
	//move all sprites offscreen to hide them
<br/>
	for(i = 0; i &lt; 128; i++) {
<br/>
		sprites[i].attribute0 = 160;
<br/>
		sprites[i].attribute1 = 240;
<br/>
		sprites[i].attribute2 = PRIORITY(1);//Goes in front of backgrounds 0,1, and 2 but behind background 3
<br/>
	}
<br/>
	u8 curr;
<br/>
	u8 sky[2048];//32 8x8 tiles
<br/>
	u8 currTileData;
<br/>
	u8 currTile;
<br/>
<br/>
	//Blue Shade
<br/>
	BGPaletteMem[0] = RGB16(0, 0, 0);
<br/>
	for (curr=1; curr&lt;33; curr++) {
<br/>
		BGPaletteMem[curr] = RGB16(curr, curr, 31);
<br/>
	}
<br/>
	BGPaletteMem[0x33] = RGB16(31, 0, 0);//red
<br/>
	BGPaletteMem[0x34] = RGB16(31, 31, 0);//Yellow
<br/>
<br/>
	//Green Shade
<br/>
	OBJPaletteMem[0] = RGB16(0, 0, 0);
<br/>
	for (curr=1; curr&lt;33; curr++) {
<br/>
		OBJPaletteMem[curr] = RGB16(curr, 31, curr);
<br/>
	}
<br/>
<br/>
	//Create Pac-Man
<br/>
	u8 pacMan[] = {
<br/>
		0x00, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x00,
<br/>
		0x01, 0x01, 0x01, 0x00, 0x01, 0x01, 0x01, 0x01,
<br/>
		0x01, 0x01, 0x00, 0x00, 0x00, 0x01, 0x01, 0x01,
<br/>
		0x01, 0x01, 0x01, 0x00, 0x01, 0x01, 0x00, 0x00,
<br/>
		0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x00, 0x00,
<br/>
		0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
<br/>
		0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
<br/>
		0x00, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x00
<br/>
	};
<br/>
	//OAMMem
<br/>
	DMAFastCopy((void*)pacMan, (void *)OAMData, 64, DMA_16NOW);
<br/>
<br/>
	u8 transparentBlock[] = {
<br/>
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
<br/>
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
<br/>
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
<br/>
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
<br/>
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
<br/>
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
<br/>
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
<br/>
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
<br/>
	};
<br/>
	DMAFastCopy((void*)transparentBlock, (void *)CharBB, 64, DMA_16NOW);
<br/>
<br/>
	for (currTile = 0; currTile&lt;32; currTile++) {
<br/>
		for (currTileData = 0; currTileData&lt;64; currTileData++) {
<br/>
			sky[(currTile*64)+currTileData] = currTile+1;
<br/>
		}
<br/>
	}
<br/>
	DMAFastCopy((void*)sky, (void *)CharBB+64, 2048, DMA_16NOW);
<br/>
<br/>
	u8 triangle[] = {
<br/>
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x31,
<br/>
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x31, 0x31,
<br/>
		0x00, 0x00, 0x00, 0x00, 0x00, 0x31, 0x31, 0x31,
<br/>
		0x00, 0x00, 0x00, 0x00, 0x31, 0x31, 0x31, 0x31,
<br/>
		0x00, 0x00, 0x00, 0x31, 0x31, 0x31, 0x31, 0x31,
<br/>
		0x00, 0x00, 0x31, 0x31, 0x31, 0x31, 0x31, 0x31,
<br/>
		0x00, 0x31, 0x31, 0x31, 0x31, 0x31, 0x31, 0x31,
<br/>
		0x31, 0x31, 0x31, 0x31, 0x31, 0x31, 0x31, 0x31
<br/>
	};
<br/>
	DMAFastCopy((void*)triangle, (void *)CharBB+2112, 64, DMA_16NOW);
<br/>
	u8 square[] = {
<br/>
		0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33,
<br/>
		0x33, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x33,
<br/>
		0x33, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x33,
<br/>
		0x33, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x33,
<br/>
		0x33, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x33,
<br/>
		0x33, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x33,
<br/>
		0x33, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x33,
<br/>
		0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33
<br/>
	};
<br/>
	DMAFastCopy((void*)square, (void *)CharBB+2176, 64, DMA_16NOW);
<br/>
	u8 cross[] = {
<br/>
		0x34, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x34,
<br/>
		0x00, 0x34, 0x00, 0x00, 0x00, 0x00, 0x34, 0x00,
<br/>
		0x00, 0x00, 0x34, 0x00, 0x00, 0x34, 0x00, 0x00,
<br/>
		0x00, 0x00, 0x00, 0x34, 0x34, 0x00, 0x00, 0x00,
<br/>
		0x00, 0x00, 0x00, 0x34, 0x34, 0x00, 0x00, 0x00,
<br/>
		0x00, 0x00, 0x34, 0x00, 0x00, 0x34, 0x00, 0x00,
<br/>
		0x00, 0x34, 0x00, 0x00, 0x00, 0x00, 0x34, 0x00,
<br/>
		0x34, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x34
<br/>
	};
<br/>
	DMAFastCopy((void*)cross, (void *)CharBB+2240, 64, DMA_16NOW);
<br/>
<br/>
	u8 currY;
<br/>
	for (currY=0; currY&lt;32; currY++) {
<br/>
		for (curr=0; curr&lt;32; curr++) {
<br/>
			Bg0Screen[curr+(currY*32)] = currY+1;
<br/>
		}
<br/>
	}
<br/>
	for (currY=0; currY&lt;32; currY++) {
<br/>
		for (curr=0; curr&lt;32; curr++) {
<br/>
			Bg1Screen[curr+(currY*32)] = 33;//triangle
<br/>
		}
<br/>
	}
<br/>
	for (currY=0; currY&lt;32; currY++) {
<br/>
		for (curr=0; curr&lt;32; curr++) {
<br/>
			Bg2Screen[curr+(currY*32)] = 34;//red square
<br/>
		}
<br/>
	}
<br/>
	for (currY=0; currY&lt;32; currY++) {
<br/>
		for (curr=0; curr&lt;32; curr++) {
<br/>
			Bg3Screen[curr+(currY*32)] = 35;//green cross
<br/>
		}
<br/>
	}
<br/>
<br/>
	//setup the first sprite
<br/>
	u8 xSprite1 = 10, ySprite1 = 10;
<br/>
	sprites[0].attribute0 = COLOR_256 | ySprite1;
<br/>
	sprites[0].attribute1 = SIZE_64 | xSprite1;
<br/>
	sprites[0].attribute2 = 0;//first entry in the OAM 256 sprite array
<br/>
<br/>
	u8 xBg0 = 0, yBg0 = 0;//start x,y position of screen in map 0
<br/>
	u8 xBg1 = 0, yBg1 = 0;
<br/>
	u8 xBg2 = 0, yBg2 = 0;
<br/>
	u8 xBg3 = 0, yBg3 = 0;
<br/>
    while(1) {
<br/>
		while(REG_VCOUNT &lt; 160); //wait for the start of VBLANK
<br/>
<br/>
		//D-pad moves background
<br/>
		if(!(BUTTONS &amp; BUTTON_LEFT)) {
<br/>
			if (xBg1&gt;0) {
<br/>
				xBg1--;
<br/>
			}
<br/>
			if (xBg2&gt;1) {
<br/>
				xBg2-=2;
<br/>
			}
<br/>
			if (xBg3&gt;3) {
<br/>
				xBg3-=4;
<br/>
			}
<br/>
		}
<br/>
		if(!(BUTTONS &amp; BUTTON_RIGHT)) {
<br/>
			xBg1++;
<br/>
			xBg2+=2;
<br/>
			xBg3+=4;
<br/>
		}
<br/>
		if(!(BUTTONS &amp; BUTTON_UP)) {
<br/>
			if (yBg1&gt;0) {
<br/>
				yBg1--;
<br/>
			}
<br/>
			if (yBg2&gt;1) {
<br/>
				yBg2-=2;
<br/>
			}
<br/>
			if (yBg3&gt;3) {
<br/>
				yBg3-=4;
<br/>
			}
<br/>
		}
<br/>
		if(!(BUTTONS &amp; BUTTON_DOWN)) {
<br/>
			yBg1++;
<br/>
			yBg2+=2;
<br/>
			yBg3+=4;
<br/>
		}
<br/>
<br/>
		REG_BG0HOFS = xBg0; //x position of start of background 0
<br/>
		REG_BG0VOFS = yBg0; //y position of start of background 0
<br/>
		REG_BG1HOFS = xBg1; //x position of start of background 1
<br/>
		REG_BG1VOFS = yBg1; //y position of start of background 1
<br/>
		REG_BG2HOFS = xBg2; //x position of start of background 2
<br/>
		REG_BG2VOFS = yBg2; //y position of start of background 2
<br/>
		REG_BG3HOFS = xBg3; //x position of start of background 3
<br/>
		REG_BG3VOFS = yBg3; //y position of start of background 3
<br/>
<br/>
		//Update Sprite Memory
<br/>
		//Change it later on so that it i only update the sprite memory when sprites change
<br/>
		//There are up to 128 sprites total
<br/>
		DMAFastCopy((void*)sprites, (void *)OAMMem, 512, DMA_16NOW);//512=128*4
<br/>
<br/>
		while(REG_VCOUNT &gt; 160); //wait for end of VBLANK
<br/>
	}</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#34595 - Celeryface - Sat Jan 22, 2005 1:45 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>arock99 wrote:</b></span></td> </tr> <tr> <td class="quote">Hi,
<br/>
First of all thanks for the help i had displaying custom bgs...
<br/>
I have another issue and this time around i did more looking around but either i didnt understand what i read (most likely) or i  just didnt find exactly what i was looking for.  I want to display things in the following order:
<br/>
bg0
<br/>
bg1 over bg0
<br/>
bg2 over bg1
<br/>
sprites over bg2
<br/>
bg3 over sprites
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I believe your sprite/background priority question is answered on the <a class="postlink" href="http://www.cs.rit.edu/~tjh8300/CowBite/CowBiteSpec.htm#Priority" target="_blank">CowBite Spec</a> :)
<br/>
<br/>
Edit: Also you can set the priority of a sprite by using the following shift in attribute 2:
<br/>
<br/>
priorityNum &lt;&lt; 10</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#34619 - arock99 - Sat Jan 22, 2005 6:38 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Celeryface wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>arock99 wrote:</b></span></td> </tr> <tr> <td class="quote">Hi,
<br/>
First of all thanks for the help i had displaying custom bgs...
<br/>
I have another issue and this time around i did more looking around but either i didnt understand what i read (most likely) or i  just didnt find exactly what i was looking for.  I want to display things in the following order:
<br/>
bg0
<br/>
bg1 over bg0
<br/>
bg2 over bg1
<br/>
sprites over bg2
<br/>
bg3 over sprites
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I believe your sprite/background priority question is answered on the <a class="postlink" href="http://www.cs.rit.edu/~tjh8300/CowBite/CowBiteSpec.htm#Priority" target="_blank">CowBite Spec</a> :)
<br/>
<br/>
Edit: Also you can set the priority of a sprite by using the following shift in attribute 2:
<br/>
<br/>
priorityNum &lt;&lt; 10</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Hi,
<br/>
I tried:
<br/>
sprites[i].attribute2 = 1 &lt;&lt; 10;
<br/>
and it gives me the same result...
<br/>
Which would make sense since PRIORITY(n) is declared as
<br/>
#define PRIORITY(n)			((n) &lt;&lt; 10)
<br/>
Which would do the same thing...
<br/>
im a bit too busy to get into reading the link you gave me from CowBite right at this moment but will look at it later and try to figure out what's going on.  At least I know I was on the right path to begin with which is good to know :) Thanks!</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#34620 - Celeryface - Sat Jan 22, 2005 7:36 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>arock99 wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Celeryface wrote:</b></span></td> </tr> <tr> <td class="quote"><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>arock99 wrote:</b></span></td> </tr> <tr> <td class="quote">Hi,
<br/>
First of all thanks for the help i had displaying custom bgs...
<br/>
I have another issue and this time around i did more looking around but either i didnt understand what i read (most likely) or i  just didnt find exactly what i was looking for.  I want to display things in the following order:
<br/>
bg0
<br/>
bg1 over bg0
<br/>
bg2 over bg1
<br/>
sprites over bg2
<br/>
bg3 over sprites
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I believe your sprite/background priority question is answered on the <a class="postlink" href="http://www.cs.rit.edu/~tjh8300/CowBite/CowBiteSpec.htm#Priority" target="_blank">CowBite Spec</a> :)
<br/>
<br/>
Edit: Also you can set the priority of a sprite by using the following shift in attribute 2:
<br/>
<br/>
priorityNum &lt;&lt; 10</span></td> </tr></table><span class="postbody">
<br/>
<br/>
Hi,
<br/>
I tried:
<br/>
sprites[i].attribute2 = 1 &lt;&lt; 10;
<br/>
and it gives me the same result...
<br/>
Which would make sense since PRIORITY(n) is declared as
<br/>
#define PRIORITY(n)			((n) &lt;&lt; 10)
<br/>
Which would do the same thing...
<br/>
im a bit too busy to get into reading the link you gave me from CowBite right at this moment but will look at it later and try to figure out what's going on.  At least I know I was on the right path to begin with which is good to know :) Thanks!</span></td> </tr></table><span class="postbody">
<br/>
<br/>
It looks like you might be overwriting your priority bit in attribute 2:
<br/>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
for(i = 0; i &lt; 128; i++) {
<br/>
sprites[i].attribute0 = 160;
<br/>
sprites[i].attribute1 = 240;
<br/>
sprites[i].attribute2 = PRIORITY(1);//Goes in front of backgrounds 0,1, and 2 but behind background 3
<br/>
}
<br/>
<br/>
...
<br/>
<br/>
 //setup the first sprite
<br/>
u8 xSprite1 = 10, ySprite1 = 10;
<br/>
sprites[0].attribute0 = COLOR_256 | ySprite1;
<br/>
sprites[0].attribute1 = SIZE_64 | xSprite1;
<br/>
sprites[0].attribute2 = 0;//first entry in the OAM 256 sprite array 
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Try to set the priority again when you setup attribute2 for your first sprite. :)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#34622 - arock99 - Sat Jan 22, 2005 8:53 pm</h4>
    <div class="postbody"><span class="postbody">Thanks again for the help...that was somewhat of a dumb mistake on my part....all these years of programming and suddenly i'm learning a new environment and i make mistakes i used to make long ago ;)  I guess I concentrated so much on the "new" stuff I forgot to check the basis ;)
<br/>
<br/>
Works now!
<br/>
Thanks</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#34636 - Celeryface - Sun Jan 23, 2005 2:29 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>arock99 wrote:</b></span></td> </tr> <tr> <td class="quote">Thanks again for the help...that was somewhat of a dumb mistake on my part....all these years of programming and suddenly i'm learning a new environment and i make mistakes i used to make long ago ;)  I guess I concentrated so much on the "new" stuff I forgot to check the basis ;)
<br/>
<br/>
Works now!
<br/>
Thanks</td> </tr></table><span class="postbody">
<br/>
<br/>
Yeah, the solutions to certain programming bugs -- where you know you're programming it the right way -- are normally the simplest things, like overwriting/not initialising a variable, that get overlooked. 
<br/>
<br/>
Good luck on your project. :)</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
