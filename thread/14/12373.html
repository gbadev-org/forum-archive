<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>trouble compiling - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. </i><br />

        <h2>Beginners > trouble compiling</h2>
<div id="posts">
<div class="post">
    <h4>#117692 - AdolescentFred - Tue Feb 06, 2007 6:21 pm</h4>
    <div class="postbody"><span class="postbody">I'm new to gba development and I've been trying to get some simple code running using devkitARM and libgba, but anything that actually uses libgba.a (rather that just the headers) won't compile. I think it's not linking properly.
<br/>
Here is my Makefile:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">PROJ= test
<br/>
CC= arm-eabi-gcc
<br/>
OBJCOPY= arm-eabi-objcopy
<br/>
<br/>
.PHONY : build
<br/>
build: 
<br/>
   $(CC) -mthumb-interwork -mthumb -I$(DEVKITPRO)/libgba/include  -c $(PROJ).c
<br/>
   $(CC) -specs=gba.specs -mthumb-interwork -mthumb -L$(DEVKITPRO)/libgba/lib/ -lgba $(PROJ).o -o $(PROJ).elf
<br/>
   $(OBJCOPY) -v -O binary $(PROJ).elf $(PROJ).gba
<br/>
   -@gbafix $(PROJ).gba
<br/>
<br/>
.PHONY : clean
<br/>
clean: 
<br/>
   @rm -fv $(PROJ).o
<br/>
   @rm -fv $(PROJ).gba
<br/>
   @rm -fv $(PROJ).elf
<br/>
</td> </tr></table><span class="postbody">
<br/>
Whenever i run make I get the same error from the second build line:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">test.o: In function `main':
<br/>
test.c:(.text+0xae): undefined reference to `irqInit'
<br/>
test.c:(.text+0xb8): undefined reference to `irqSet'
<br/>
test.c:(.text+0xbe): undefined reference to `irqEnable'
<br/>
collect2: ld returned 1 exit status
<br/>
make: *** [build] Error 1
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
What am I missing? Anyone got any ideas?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117694 - wintermute - Tue Feb 06, 2007 6:29 pm</h4>
    <div class="postbody"><span class="postbody">You're probably missing the definition of DEVKITPRO in your environment.
<br/>
<br/>
Details at <a href="http://www.devkitpro.org/setup.shtml" target="_blank">http://www.devkitpro.org/setup.shtml</a><br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117698 - AdolescentFred - Tue Feb 06, 2007 6:50 pm</h4>
    <div class="postbody"><span class="postbody">No thats not it. It manages the compile stage, and fails with that error when its linking (I think).
<br/>
If I don't use and libgba funtions it compiles and runs fine using the same Makefile.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117701 - wintermute - Tue Feb 06, 2007 7:17 pm</h4>
    <div class="postbody"><span class="postbody">Ah, I see it, I've just had too many missing $(DEVKITPRO) variables today and went temporarily blind, sorry. 
<br/>
<br/>
<br/>
Change this line
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   $(CC) -specs=gba.specs -mthumb-interwork -mthumb -L$(DEVKITPRO)/libgba/lib/ -lgba $(PROJ).o -o $(PROJ).elf
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
to this 
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   $(CC) -specs=gba.specs -mthumb-interwork -mthumb $(PROJ).o -L$(DEVKITPRO)/libgba/lib/  -lgba  -o $(PROJ).elf
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Libraries must be specified on the command line after any objects that reference them.
<br/>
<br/>
For what it's worth I always recommend using the devkitPro template projects where possible. While the makefiles are quite complex they're extremely flexible and let you get on with programming without worrying about make.
<br/>
<br/>
This particular makefile is little more than a script for a single source file project. Great for quick tests but not much cop for a larger project.<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117703 - AdolescentFred - Tue Feb 06, 2007 7:21 pm</h4>
    <div class="postbody"><span class="postbody">Thanks that worked a treat. I'd rejected the devkitPro ones because of their complexity, and examples I'd downloaded hadn't compiled, I'll give them another go though.
<br/>
Thanks
<br/>
~Fred</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117739 - Massif - Wed Feb 07, 2007 1:34 am</h4>
    <div class="postbody"><span class="postbody">I'm having a very similar problem with linking. I am using Eclipse as my IDE with the NDS Managedbuilder plugin. I've tried libnds-20060719 and libnds-20070127 so I don't think it's the version. I've also tried just doing the linking in a command prompt but got the same errors. Here is the (very basic) code I'm compiling:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include &lt;stdio.h&gt;
<br/>
#include &lt;nds.h&gt;
<br/>
#include &lt;nds/arm9/console.h&gt;
<br/>
<br/>
int main(int argcs, char* pArgs[]) {
<br/>
   powerON(POWER_ALL);
<br/>
  
<br/>
   // Use the main screen for output
<br/>
   videoSetMode(MODE_0_2D | DISPLAY_BG0_ACTIVE);
<br/>
   vramSetBankA(VRAM_A_MAIN_BG);
<br/>
   BG0_CR = BG_MAP_BASE(31);
<br/>
   // Set the colour of the font to White.
<br/>
   BG_PALETTE[255] = RGB15(31,31,31);
<br/>
   consoleInitDefault((u16*)SCREEN_BASE_BLOCK(31), (u16*)CHAR_BASE_BLOCK(0), 16);
<br/>
   printf("\n\n\tHello World!\n");
<br/>
   
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
and here is the console output:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
<br/>
**** Build of configuration Release for project Test ****
<br/>
<br/>
make -k all 
<br/>
Building file: ../main.cpp
<br/>
Invoking: GCC C++ Compiler
<br/>
arm-eabi-g++ -I"C:\devkitPro\libnds\include" -O2 -g -Wall -c -fmessage-length=0 -ffast-math -fomit-frame-pointer -mthumb-interwork -mthumb -mcpu=arm9tdmi -mtune=arm9tdmi -DARM9 -MMD -MP -MF"main.d" -MT"main.d" -o"main.o" "../main.cpp"
<br/>
Finished building: ../main.cpp
<br/>
 
<br/>
Invoking: GCC C++ Linker
<br/>
arm-eabi-g++ ./main.o    -mno-fpu -L"C:\devkitPro\libnds\lib" -Wl,-Map,arm9.elf.map -mthumb-interwork -specs=ds_arm9.specs -o"arm9.elf"
<br/>
./main.o: In function `main':
<br/>
C:\EclipseWorkspace\Test\Release/../main.cpp:10: undefined reference to `vramSetBankA'
<br/>
C:\EclipseWorkspace\Test\Release/../main.cpp:14: undefined reference to `consoleInitDefault'
<br/>
collect2: ld returned 1 exit status
<br/>
make: *** [arm9.elf] Error 1
<br/>
make: Target `all' not remade because of errors.
<br/>
Build complete for project Test
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
I also tried to switch the options around to match the way you suggested above. It looks like this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
arm-eabi-g++ -specs=ds_arm9.specs -mthumb-interwork -mthumb ./main.o -L"C:\devkitPro\libnds\lib" -Wl,-Map,arm9.elf.map -o"arm9.elf"
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Any suggestions?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117740 - wintermute - Wed Feb 07, 2007 1:51 am</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Massif wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
<br/>
I also tried to switch the options around to match the way you suggested above. It looks like this:
<br/>
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
arm-eabi-g++ -specs=ds_arm9.specs -mthumb-interwork -mthumb ./main.o -L"C:\devkitPro\libnds\lib" -Wl,-Map,arm9.elf.map -o"arm9.elf"
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Any suggestions?</span></td> </tr></table><span class="postbody">
<br/>
<br/>
-lnds9<br/>_________________<br/><a class="postlink" href="http://www.devkitpro.org/" target="_blank">devkitPro - professional toolchains at amateur prices</a>
<br/>
<a class="postlink" href="http://wiki.devkitpro.org/index.php/IRC" target="_blank">devkitPro IRC support</a>
<br/>
<a class="postlink" href="http://davejmurphy.com/" target="_blank">Personal Blog</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#117742 - Massif - Wed Feb 07, 2007 1:58 am</h4>
    <div class="postbody"><span class="postbody">Hooray, it works! Thank you!
<br/>
<br/>
I guess since the managedbuilder didn't include the libnds include and library paths by default, they also wouldn't put in the flags for them. Silly me.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
