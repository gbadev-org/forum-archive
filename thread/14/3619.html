<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>[solved] Sprites in mode 4, why won't they show up? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > [solved] Sprites in mode 4, why won't they show up?</h2>
<div id="posts">
<div class="post">
    <h4>#22660 - Wriggler - Sat Jun 26, 2004 3:20 pm</h4>
    <div class="postbody"><span class="postbody">Hi guys,
<br/>
<br/>
I'm trying to combine a couple of tutorials really. The first showed me how sprites worked, but it used Mode 1. As I haven't really figured out the tile modes yet, I thought it would be cool to use this new fangled sprite stuff in Mode 4. So I grabbed my previous code from the Mode 4 tutorial, and tried combining the two.
<br/>
<br/>
I've gotten as far as the background being shown, but the sprites do not appear. Looking through the debug options in the emulator, the sprites have loaded correctly they are just not actually appearing. I suspect this is a problem with the drawing priority of the background and the sprites.
<br/>
<br/>
Of course, here is the code. I've only included the main() function, but if anything else is needed then please let me know!
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
//Entry point
<br/>
int main() {
<br/>
<br/>
   //Variable declarations
<br/>
   u16 loop;
<br/>
   u16 x = 50;
<br/>
   u16 y = 50;
<br/>
   u16 x2 = 150;
<br/>
   u16 y2 = 50;
<br/>
<br/>
   //set mode 1 and enable sprites and 1d mapping
<br/>
    SetMode(MODE_4 | BG2_ENABLE | OBJ_ENABLE | OBJ_MAP_1D);
<br/>
<br/>
   //Load screen palette and background data
<br/>
   for (loop = 0; loop &lt; 256; loop++) {
<br/>
      BGPaletteMem[loop]=bgPalette[loop];
<br/>
   }
<br/>
<br/>
   for (loop = 0; loop &lt; (120*160); loop++) {
<br/>
      VideoBuffer[loop] = bgData[loop] ;
<br/>
   }
<br/>
<br/>
   //load the sprite palette into memory
<br/>
   for(loop = 0; loop &lt; 256; loop++) {
<br/>
      OBJPaletteMem[loop] = ballPalette[loop];
<br/>
   }
<br/>
<br/>
   InitializeSprites();
<br/>
<br/>
      sprites[0].attribute0 = COLOR_256 | SQUARE | y;   //setup sprite info, 256 colour, shape and y-coord
<br/>
    sprites[0].attribute1 = SIZE_16 | x;            //size 16x16 and x-coord
<br/>
    sprites[0].attribute2 = 0;                      //pointer to tile where sprite starts   
<br/>
    for(loop = 0; loop &lt; 128; loop++) {            //load sprite image data
<br/>
      OAMData[loop] = ballData[loop];
<br/>
   }
<br/>
<br/>
   //2nd sprite
<br/>
   sprites[1].attribute0 = COLOR_256 | SQUARE | y2;
<br/>
    sprites[1].attribute1 = SIZE_16 | x2;
<br/>
    sprites[1].attribute2 = 8;
<br/>
   for(loop=128; loop &lt; 256; loop++) {
<br/>
      OAMData[loop] = ballData[loop-128];
<br/>
   }
<br/>
<br/>
<br/>
   //Game loop
<br/>
   while(1) {
<br/>
      WaitForVsync();
<br/>
      CopyOAM();
<br/>
   }
<br/>
<br/>
   return 0;
<br/>
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Can anyone help me out with this? Thanks in advance, I'm sure it's a simple problem but I'm not sure how to go about fixing it.
<br/>
<br/>
Cheers,
<br/>
<br/>
Ben</span><span class="gensmall"><br/><br/>Last edited by Wriggler on Sat Jun 26, 2004 4:17 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#22662 - johnny_north - Sat Jun 26, 2004 3:41 pm</h4>
    <div class="postbody"><span class="postbody">Ben,
<br/>
<br/>
The following is a section from Korth's gbatek document pertainent to both of your questions:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">OBJ Tile Number
<br/>
There are two situations which may divide the amount of available tiles by two (by four if both situations apply):
<br/>
<br/>
1. When using the 256 Colors/1 Palette mode, only each second tile may be used, the lower bit of the tile number should be zero (in 2-dimensional mapping mode, the bit is completely ignored).
<br/>
<br/>
2. When using BG Mode 3-5 (Bitmap Modes), only tile numbers 512-1023 may be used. That is because lower 16K of OBJ memory are used for BG. Attempts to use tiles 0-511 are ignored (not displayed).
<br/>
<br/>
Priority
<br/>
In case that the 'Priority relative to BG' is the same than the priority of one of the background layers, then the OBJ becomes higher priority and is displayed on top of that BG layer.
<br/>
Caution: Take care not to mess up BG Priority and OBJ priority. For example, the following would cause garbage to be displayed:
<br/>
  OBJ No. 0 with Priority relative to BG=1   ;hi OBJ prio, lo BG prio
<br/>
  OBJ No. 1 with Priority relative to BG=0   ;lo OBJ prio, hi BG prio
<br/>
<br/>
 
<br/>
That is, OBJ0 is always having priority above OBJ1-127, so assigning a lower BG Priority to OBJ0 than for OBJ1-127 would be a bad idea.</td> </tr></table><span class="postbody">
<br/>
<br/>
This wonderful ref can be found at <a class="postlink" href="http://www.work.de/nocash/gbatek.htm" target="_blank">http://www.work.de/nocash/gbatek.htm</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22664 - Wriggler - Sat Jun 26, 2004 4:16 pm</h4>
    <div class="postbody"><span class="postbody">Awesome, thanks johnny_north. After a couple of minutes of fiddling I've got sprites working in bitmap mode! :)
<br/>
<br/>
It was the 2nd point that had me stumped, although I should have really assumed that bitmap modes would have taken up more memory than tile mode. I had the first point nailed though, as the 256 colour sprite frame takes up 16bits and each character tile is only 8bits (therefore taking up 2 char tiles)...
<br/>
<br/>
Simply starting the OAM memory location at 512*16 bits down the line (and updating the sprite attributes) did the trick. This is all starting to make sense in my head, thanks a lot for your help!
<br/>
<br/>
(I'll be sure to check out this reference in the future, it's a good read. Cheers).
<br/>
<br/>
Ben</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#22668 - poslundc - Sat Jun 26, 2004 4:51 pm</h4>
    <div class="postbody"><span class="postbody">You should also bookmark the <a class="postlink" href="http://www.cs.rit.edu/~tjh8300/CowBite/CowBiteSpec.htm" target="_blank">Cowbite Virtual Hardware Spec</a>. It is not quite "the bible" as much as the gbatek document is, but it generally reads a lot easier and is an invaluable tool.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
