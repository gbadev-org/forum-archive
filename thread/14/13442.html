<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Tonc tutorial #define question - why? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > Tonc tutorial #define question - why?</h2>
<div id="posts">
<div class="post">
    <h4>#131403 - ShannonB - Fri Jun 15, 2007 5:03 am</h4>
    <div class="postbody"><span class="postbody">Ok, going through the Tonc tutorials: <a class="postlink" href="http://www.coranac.com/tonc/text/first.htm" target="_blank">http://www.coranac.com/tonc/text/first.htm</a>
<br/>
<br/>
(Brilliant tutorial by the way, just going through the math section and I actually understand stuff I never thought I'd get that quickly)
<br/>
<br/>
Anyway, he makes a #define to point to the Display control register, which I get.
<br/>
<br/>
<br/>
#define REG_DISPCNT *((volatile u32*)(MEM_IO+0x0000)) 
<br/>
<br/>
He previously #define MEM_IO as the address for the display control register.
<br/>
<br/>
#define MEM_IO      0x04000000
<br/>
<br/>
<span style="font-weight: bold">What I DON'T get, is why he adds 0x0000 to the memory address.</span>
<br/>
<br/>
It might be something really simple such as me not having all the math basics of Hexadecimal down, or maybe I don't get pointers properly, but I just can't figure out why and what it does.  Can anyone explain?<br/>_________________<br/>"Do you know what the chain of command is? It's the chain I get and beat you with until you understand who's in rutting command here!" -Jayne Cobb</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#131406 - chishm - Fri Jun 15, 2007 5:11 am</h4>
    <div class="postbody"><span class="postbody">0x04000000 is the base address of the GBA's registers. Adding 0x0000 doesn't accomplish anything when the code is compiled, but it lets the reader/programmer know that the register has an offset of 0 relative to the register base address.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#131408 - ShannonB - Fri Jun 15, 2007 6:14 am</h4>
    <div class="postbody"><span class="postbody">Ok, so it's just Good Programming Practice(tm)?
<br/>
<br/>
When would the number NOT be zero?  Could you give an example with any of the GBA registers?<br/>_________________<br/>"Do you know what the chain of command is? It's the chain I get and beat you with until you understand who's in rutting command here!" -Jayne Cobb</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#131409 - chishm - Fri Jun 15, 2007 6:50 am</h4>
    <div class="postbody"><span class="postbody">REG_DISPSTAT should be *((volatile u16*)MEM_IO + 0x0004), since it is a 16 bit register at 0x04000004 (register base address + 4). You can find all the known registers in the <a class="postlink" href="http://nocash.emubase.de/gbatek.htm#iomap" target="_blank">IO map of GBAtek</a>.<br/>_________________<br/><a class="postlink" href="http://chishm.drunkencoders.com" target="_blank">http://chishm.drunkencoders.com</a>
<br/>
<a class="postlink" href="http://dldi.drunkencoders.com" target="_blank">http://dldi.drunkencoders.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#131410 - ShannonB - Fri Jun 15, 2007 6:57 am</h4>
    <div class="postbody"><span class="postbody">Aah ok, perfect.  I'm used to previous examples bit shifting the values into the correct position.  Looking at it, it seems to have the same effect of bit-shifting the setting into the correct bits in the register.
<br/>
<br/>
This, once you understood it, should be a lot easier to read and to use.
<br/>
<br/>
Thanks muchly for your help.  If I'm off in my understanding though please let me know.<br/>_________________<br/>"Do you know what the chain of command is? It's the chain I get and beat you with until you understand who's in rutting command here!" -Jayne Cobb</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#131421 - Lick - Fri Jun 15, 2007 11:44 am</h4>
    <div class="postbody"><span class="postbody">Sometimes people refer to a specifications document while coding, especially when it's necessary to deal with many registers. It's then easier to "follow the documents notation". 
<br/>
For example, the documented memory is MEM_IO [0x04000000], and its sections are notated by offset [0x????], not by absolute address [0x0400????]. It's then easier to "copy from the document" if you simply use offsets as well.
<br/>
<br/>
I'm not sure if Cearn (TONC) did it because of this reason though.<br/>_________________<br/><a class="postlink" href="http://licklick.wordpress.com" target="_blank">http://licklick.wordpress.com</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#131445 - Cearn - Fri Jun 15, 2007 6:35 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ShannonB wrote:</b></span></td> </tr> <tr> <td class="quote">Anyway, he makes a #define to point to the Display control register, which I get.
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define REG_DISPCNT *((volatile u32*)(MEM_IO+0x0000))</td> </tr></table><span class="postbody">
<br/>
<br/>
He previously #define MEM_IO as the address for the display control register.
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">#define MEM_IO      0x04000000</td> </tr></table><span class="postbody">
<br/>
<span style="font-weight: bold">What I DON'T get, is why he adds 0x0000 to the memory address.</span>
<br/>
</span></td> </tr></table><span class="postbody">
<br/>
Because I can :P
<br/>
<br/>
It's partially what Lick said: all the IO-registers are in the same section of memory; by using a base #define + offset strategy, you can highlight the relations. Also, I find things with many zeros harder to read and easier to mis-type. Compare 0x400004 and 0x4000004. They <span style="font-style: italic">look</span> much the same, but the former has one zero too few. With a base+offset, you can minimize such mistakes. This is also why Tonc uses something like 0400:0000 for addresses: it's easier to read.
<br/>
<br/>
Adding 0x0000 is just for alignment with the rest of the register #defines, really. One of the many optimizations that compilers do is '<a class="postlink" href="http://en.wikipedia.org/wiki/Constant_folding" target="_blank">constant folding</a>', which can take constant expressions ( like "1+2*3/4-5&lt;&lt;6", but also "DCNT_MODE3 | DCNT_BG2" ), calculate them at compile-time and put that in the binary. Constant arithmetic expressions don't cost anything and can make code clearer, which is always nice. It's still mostly just a matter of preference though.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
