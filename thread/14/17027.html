<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>[SOLVED] Unexpected Sprite Rotation - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > [SOLVED] Unexpected Sprite Rotation</h2>
<div id="posts">
<div class="post">
    <h4>#171827 - Drovor - Sun Dec 27, 2009 7:41 pm</h4>
    <div class="postbody"><span class="postbody">I'm trying to use sprites, but they seem to be getting flipped.  I have no idea why, since I'm creating them all in exactly the same way except for a random x/y location.
<br/>
<br/>
It looks like this:
<br/>
<a href="http://www.flickr.com/photos/39069226@N03/4218913811/" target="_blank">http://www.flickr.com/photos/39069226@N03/4218913811/</a>
<br/>
<br/>
The code I use to set the OAM attributes looks like this (spriteEntry is a reference to oam-&gt;oamBuffer[index]):
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
void game_state::initializeSprites()
<br/>
{              
<br/>
  int i;
<br/>
  // Sprite initialisation
<br/>
  for(i = 0; i &lt; 256; i++)
<br/>
    SPRITE_PALETTE[i] = ball.palette[i];
<br/>
  
<br/>
  for(i = 0; i&lt; 32*16; i++)
<br/>
    SPRITE_GFX[i] = ball.image.data16[i];
<br/>
  
<br/>
  for(i = 0; i &lt; SPRITE_COUNT; i++) {
<br/>
    /* Info */
<br/>
    spriteInfo[i].oamId = i;
<br/>
    spriteInfo[i].width = 8;
<br/>
    spriteInfo[i].height = 8;
<br/>
    spriteInfo[i].angle = 0;
<br/>
    spriteInfo[i].entry = spriteEntry[i];
<br/>
  
<br/>
    /* attribute[0] */
<br/>
    spriteEntry[i]-&gt;y = rand() % 192;
<br/>
    spriteEntry[i]-&gt;isRotateScale = false;
<br/>
    spriteEntry[i]-&gt;isSizeDouble = false;
<br/>
    spriteEntry[i]-&gt;blendMode = OBJMODE_NORMAL;
<br/>
    spriteEntry[i]-&gt;isMosaic = false;
<br/>
    spriteEntry[i]-&gt;colorMode = OBJCOLOR_256;
<br/>
    spriteEntry[i]-&gt;shape = OBJSHAPE_SQUARE;
<br/>
<br/>
    /* attribute[1] */
<br/>
    spriteEntry[i]-&gt;x = rand() % 256;
<br/>
    spriteEntry[i]-&gt;rotationIndex = spriteInfo[i].oamId;
<br/>
    spriteEntry[i]-&gt;size = OBJSIZE_8;
<br/>
<br/>
    /* attribute[2] */
<br/>
    spriteEntry[i]-&gt;gfxIndex = 0; // All use the same one.
<br/>
    spriteEntry[i]-&gt;priority = OBJPRIORITY_0;
<br/>
    // spriteEntry[i]-&gt;palette = N/A, only one 256 palette
<br/>
  }
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Afterwards the OAM copy is copied in:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
    DC_FlushAll();
<br/>
    dmaCopyHalfWords(SPRITE_DMA_CHANNEL,
<br/>
                     oam-&gt;oamBuffer,
<br/>
                     OAM,
<br/>
                     SPRITE_COUNT * sizeof(SpriteEntry));
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
Any help would be greatly appreciated, I'm tempted to "fix" this by flipping my "D" and "S" images horizontally and making a new ball sprite (currently borrowed from the examples) which has horizontal and vertical symmetry!</span><span class="gensmall"><br/><br/>Last edited by Drovor on Sun Dec 27, 2009 9:18 pm; edited 1 time in total</span></div>    
</div>
<div class="post">
    <h4>#171828 - DiscoStew - Sun Dec 27, 2009 8:49 pm</h4>
    <div class="postbody"><span class="postbody"><a href="http://nocash.emubase.de/gbatek.htm#lcdobjoverview" target="_blank">http://nocash.emubase.de/gbatek.htm#lcdobjoverview</a>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">OBJ Attribute 1 (R/W)
<br/>
<br/>
  Bit   Expl.
<br/>
  0-8   X-Coordinate           (0-511)
<br/>
  When Rotation/Scaling used (Attribute 0, bit 8 set):
<br/>
    9-13  Rotation/Scaling Parameter Selection (0-31)
<br/>
          (Selects one of the 32 Rotation/Scaling Parameters that
<br/>
          can be defined in OAM, for details read next chapter.)
<br/>
  When Rotation/Scaling not used (Attribute 0, bit 8 cleared):
<br/>
    9-11  Not used
<br/>
    12    Horizontal Flip      (0=Normal, 1=Mirrored)
<br/>
    13    Vertical Flip        (0=Normal, 1=Mirrored)
<br/>
  14-15 OBJ Size               (0..3, depends on OBJ Shape, see Attr 0)
<br/>
          Size  Square   Horizontal  Vertical
<br/>
          0     8x8      16x8        8x16
<br/>
          1     16x16    32x8        8x32
<br/>
          2     32x32    32x16       16x32
<br/>
          3     64x64    64x32       32x64
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
When you set rotationIndex to a value when isRotateScale is set to false, you have the chance to flip your sprite horizontally and/or vertically, because both rotationIndex and vFlip/hFlip partially share the same area in memory, so unless you plan to use flipping, just set rotationIndex to 0.<br/>_________________<br/><span style="font-weight: bold">DS</span> - It's all about <span style="font-weight: bold">D</span>isco<span style="font-weight: bold">S</span>tew</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#171829 - Drovor - Sun Dec 27, 2009 9:18 pm</h4>
    <div class="postbody"><span class="postbody">Thanks, that did it.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
