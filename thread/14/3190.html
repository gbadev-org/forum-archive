<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Line drawer - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > Line drawer</h2>
<div id="posts">
<div class="post">
    <h4>#18874 - anoneem - Wed Apr 07, 2004 5:48 pm</h4>
    <div class="postbody"><span class="postbody">Hi! I'm learning asm from gbaguy's tutorial and finished Day 2. I tried to write a program wich is drawing a line (i don't know is that way of drawing okay, becaouse i had never read how to do it). Here's code:
<br/>
<br/>
;start
<br/>
@include screen.h
<br/>
@textarea
<br/>
<br/>
program					;label
<br/>
<br/>
ldr r4,=2410				;x
<br/>
<br/>
ldr r5,=100				;line 100px
<br/>
<br/>
ldr r3,=0					;counter
<br/>
<br/>
ldr r1,=REG_DISPCNT			;r1=0x04000000
<br/>
<br/>
ldr r2,=(BG2_ENABLE|MODE_3)		                ;r2=0x403
<br/>
<br/>
str r2,[r1]					;Mode3 on
<br/>
<br/>
ldr r1,=0x0FF				;colour in r1
<br/>
<br/>
ldr r2,=vram+r4                    			;pixel position
<br/>
<br/>
str r1,[r2]					;draw point
<br/>
<br/>
ADD r3,r3,1				;add 1 to r3
<br/>
<br/>
CMP r3, r5				                ;cmp r3 with r5
<br/>
<br/>
BLT rysuj					;go to rysuj
<br/>
<br/>
BEQ koniec				;go to koniec
<br/>
<br/>
rysuj					;label draw
<br/>
<br/>
ADD r4,r4,1				;add 1 to r4
<br/>
<br/>
str r1,[r2]					;draw point
<br/>
<br/>
B program				                ;go to program
<br/>
<br/>
koniec					;label koniec
<br/>
<br/>
@pool					;asm shits
<br/>
@endarea				                ;koniec
<br/>
<br/>
Compiler pointed only one error, but I'm sure there are more of them :).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18875 - anoneem - Wed Apr 07, 2004 5:54 pm</h4>
    <div class="postbody"><span class="postbody">Ofcourse i shown that code to hear from You what's bad in it.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18878 - poslundc - Wed Apr 07, 2004 6:46 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>anoneem wrote:</b></span></td> </tr> <tr> <td class="quote">Compiler pointed only one error, but I'm sure there are more of them :).</td> </tr></table><span class="postbody">
<br/>
<br/>
So are you planning on telling us what the compiler pointed out?
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18881 - sajiimori - Wed Apr 07, 2004 7:12 pm</h4>
    <div class="postbody"><span class="postbody">You need to put colons after labels.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18922 - anoneem - Thu Apr 08, 2004 10:13 am</h4>
    <div class="postbody"><span class="postbody">No, problem is elswere...
<br/>
<br/>
<span style="font-weight: bold">ldr r2,=vram+r4 ;pixel position </span>
<br/>
<span style="font-weight: bold">expression not constant</span>
<br/>
<br/>
So such thing as adding register to memory addres is bad? How would I do that to make a working program?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18932 - Lupin - Thu Apr 08, 2004 1:11 pm</h4>
    <div class="postbody"><span class="postbody">you first need to load vram into a register and then index it with r4, i think it is like this:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
ldr r2,=vram
<br/>
ldr r2,[r2,r4]
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
this will load the memory address of vram into r2 and then it will load "vram[r4]". Note: r4 got to be a byte offset!
<br/>
<br/>
This is because the arm instructions are not able to load a 32 bit address and also add a register to it in one instructions because the instructions themself are only 32 bit long.<br/>_________________<br/><a class="postlink" href="http://pokeme.shizzle.it/" target="_blank">Team Pokeme</a>
<br/>
<a class="postlink" href="http://lupin.shizzle.it/" target="_blank">My blog and PM ASM tutorials</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18935 - poslundc - Thu Apr 08, 2004 2:12 pm</h4>
    <div class="postbody"><span class="postbody">You really shouldn't have stopped at day 2 of the tutorial.
<br/>
<br/>
Dan.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18936 - Lupin - Thu Apr 08, 2004 2:18 pm</h4>
    <div class="postbody"><span class="postbody">Oh, i forgot about the fact that ldr or str is always loading/storing a 32 bit value, for vram writes/reads you will most likely want to use ldrh and strh, they only write/read 16 bits (You can write 32 bits into vram though, but that way you'd draw 2 pixels in mode 3/5 and 4 pixels in mode 4). If you use mode4, be aware that you have to write 2 pixels at once (you can't write 8 bit values to vbuffer because the memory only supports 16/32 bit writes).
<br/>
<br/>
I agree with poslundc, you should really read the rest of the tutorial (reading a "day" of the tutorial doesn't mean it should take you a day to read it :P)<br/>_________________<br/><a class="postlink" href="http://pokeme.shizzle.it/" target="_blank">Team Pokeme</a>
<br/>
<a class="postlink" href="http://lupin.shizzle.it/" target="_blank">My blog and PM ASM tutorials</a></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#18952 - anoneem - Thu Apr 08, 2004 4:49 pm</h4>
    <div class="postbody"><span class="postbody">Than You for informations. I will try to understand them, when I get vocabulary (my poor english :P) :).
<br/>
<br/>
"you should really read the rest of the tutorial"
<br/>
<br/>
Ofcourse, that stopping on the beginning of tutorial isn't the way to became a programmer. All I want to do is to check, what I have learned :). Just a test.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
