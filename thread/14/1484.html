<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Sprite Clipping - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/static/pure-min.css" />
        <link rel="stylesheet" href="/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > Sprite Clipping</h2>
<div id="posts">
<div class="post">
    <h4>#7448 - hnager - Wed Jun 18, 2003 3:24 am</h4>
    <div class="postbody"><span class="postbody">Simple question - hopefully with a simple answer - how do you handle sprite clipping on the gba...
<br/>
<br/>
If I move a sprite off screen (to the top or left) I get unpredictable (but expected) results. I'm pretty familiar with techniques to handle this in a mode 13h style, but not sure how to do it when using hardware sprites.
<br/>
<br/>
Oh, this is MODE1 - if that helps.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7449 - hnager - Wed Jun 18, 2003 3:39 am</h4>
    <div class="postbody"><span class="postbody">would this do it? I seem to remember reading about this but didn't understand what it was used for...correct me if I'm wrong:
<br/>
<br/>
void MoveSprites(OAMEntry* sp, int x, int y)
<br/>
{
<br/>
if(x &lt; 0)
<br/>
x = 512 + x;
<br/>
if(y &lt; 0)
<br/>
y = 256 + y;
<br/>
<br/>
sp-&gt;attribute1 = sp-&gt;attribute1 &amp; 0xFE00;
<br/>
sp-&gt;attribute1 = sp-&gt;attribute1 | x;
<br/>
<br/>
sp-&gt;attribute0 = sp-&gt;attribute0 &amp; 0xFF00;
<br/>
sp-&gt;attribute0 = sp-&gt;attribute0 | y;
<br/>
}</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7452 - tepples - Wed Jun 18, 2003 5:28 am</h4>
    <div class="postbody"><span class="postbody">That function will work, as long as you don't try to put a sprite too far offscreen.  I'll comment it so that you can see what it does:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void MoveSprites(OAMEntry* sp, int x, int y)
<br/>
{
<br/>
  if(x &lt; 0)  /* if sprite is to left side of screen, wrap x coordinate */
<br/>
    x = 512 + x;
<br/>
  if(y &lt; 0)  /* if sprite is above screen, wrap x coordinate */
<br/>
    y = 256 + y;
<br/>
<br/>
  sp-&gt;attribute1 = sp-&gt;attribute1 &amp; 0xFE00;  /* preserve old attributes */
<br/>
  sp-&gt;attribute1 = sp-&gt;attribute1 | x;  /* add in x coordinate */
<br/>
<br/>
  sp-&gt;attribute0 = sp-&gt;attribute0 &amp; 0xFF00;  /* preserve old attributes */
<br/>
  sp-&gt;attribute0 = sp-&gt;attribute0 | y;  /* add in y coordinate */
<br/>
}</td> </tr></table><span class="postbody">
<br/>
I'd probably have written it more robustly, with checks for completely offscreen sprites, like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void move_sprite_to(OAMEntry *spr, int x, int y)
<br/>
{
<br/>
  /* if it's out of bounds, then put it at (240, 160) where it won't affect anything */
<br/>
  /* but the out of bounds calculation may fail for the largest double-size sprites */
<br/>
  if(x &lt; -64 || x &gt; 240 || y &lt; -64 || y &gt; 160)
<br/>
  {
<br/>
    x = 240;
<br/>
    y = 160;
<br/>
  }
<br/>
<br/>
  y &amp;= 0x00ff;  /* wrap y coordinate */
<br/>
  spr-&gt;attribute0 = (spr-&gt;attribute0 &amp; 0xff00) | y;  /* change only y bits */
<br/>
  x &amp;= 0x01ff;  /* wrap x coordinate */
<br/>
  spr-&gt;attribute1 = (spr-&gt;attribute1 &amp; 0xfe00) | x;  /* change only x bits */
<br/>
}</td> </tr></table><span class="postbody"><br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7644 - jcpredator - Sun Jun 22, 2003 5:54 am</h4>
    <div class="postbody"><span class="postbody">I tried to resolve my own sprite clipping issue with the above code but some how it still does not work.  
<br/>
<br/>
I'm not sure we are talking about the same clipping but I will try to describe my problem that I'm having.  I'm a newbie at GBA programming so please bear with me, :)
<br/>
<br/>
Every time I move the sprite by pressing up, down, left, or right, the sprite (a picture of the USA flag) flips vertically and cut off midway horizontally with the other half displayed right beside it, hope that made sense.  If I continue pressing the same button the sprite will eventually come back to its original state.
<br/>
<br/>
I used the above MoveSprite function and still recieved the same distortion on my sprite.
<br/>
<br/>
Just wondering if anyone could help a newbie out, I would greatly appreciate it.
<br/>
<br/>
If you would like source code please let me know.<br/>_________________<br/>There is no spoon...</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#7648 - Ninja - Sun Jun 22, 2003 11:43 am</h4>
    <div class="postbody"><span class="postbody">The above ways are the solution.  You are essentially overwriting parts of your sprite control data by feeding it a negative number.  (which overflows to a very high positive number if you are using a u16.)
<br/>
<br/>
Insert the code that the nice fellows above have posted, and it should work just fine.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
