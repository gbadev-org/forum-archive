<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>GCC 3.3.2 Overlaps Section - gbadev.org forum archive</title>
        <link rel="stylesheet" href="/forum-archive/static/pure-min.css" />
        <link rel="stylesheet" href="/forum-archive/static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        <i>This is a read-only mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. A new forum can be found <a href="https://forum.gbadev.net/" target="_blank">here</a>.</i><br />

        <h2>Beginners > GCC 3.3.2 Overlaps Section</h2>
<div id="posts">
<div class="post">
    <h4>#17664 - bogston - Fri Mar 12, 2004 2:24 am</h4>
    <div class="postbody"><span class="postbody">This is from linux.gbadev.org:
<br/>
<br/>
binutils-2.11.2.tar.bz2
<br/>
assembler, linker, objcopy, other goodies...
<br/>
(versions newer than this create overlap errors with crt0.o?)
<br/>
(some of them complain about --mcpu=arm7tdmi with certain versions of gcc! I am experimenting)
<br/>
<br/>
GCC 3.3.2 introduced to sections: .init and .fini.  The source of these sections is gcc.3.3.2/gcc/config/arm/crti.asm and crtn.asm.  Neither section is defined in Jeff Frohwein's lnkscript.  If I define these sections in lnkscript, GCC 3.3.2 compiles and links linux.gbadev.org/test.tar.gz without errors although the binary does not appear to execute properly in VisualBoyAdvanced.  (I don't see the dot.)
<br/>
<br/>
Now, I have no idea how to properly define these sections in lnkscript.  I have made several attempts.   Does anyone have any ideas how to modify lnkscript or if lnkscript is even the source of the overlapping section errors?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#17980 - bogston - Thu Mar 18, 2004 1:22 am</h4>
    <div class="postbody"><span class="postbody">Here's my contribution to anyone wishing to develop for the GameBoy Advance using GCC and Linux.  Thanks to everyone who gave me advice at <a href="http://forum.gbadev.org." target="_blank">http://forum.gbadev.org.</a>  Here's what I learned.  
<br/>
<br/>
I got this configuration to produce a binary that VisualBoyAdvance 1.7 will execute: gcc-core-3.3.2.tar.gz, binutils-2.14.tar.gx, and newlib-1.12.tar.gz.  The OS is Red Hat 8.0 (kernel 2.4.20-28.8).  Believe me, it took a lot of effort.  
<br/>
<br/>
GCC must be built to produce soft float operations by default. Look at this thread:
<br/>
<a href="http://sources.redhat.com/ml/crossgcc/2004-01/msg00173.html" target="_blank">http://sources.redhat.com/ml/crossgcc/2004-01/msg00173.html</a> (thanks Torlus).
<br/>
<br/>
Afer applying the patch above, follow the instructions given at <a href="http://linux.gbadev.org" target="_blank">http://linux.gbadev.org</a> for building a ARM GCC cross compiler.  These instructions are general enough to apply to any GCC version.
<br/>
<br/>
At this point, GCC will not build a binary properly.  The message says something about ".data overlaps section .init" and ".jcr overlaps section .fini" etc.  This message appears because GCC 3.1 and above contains to two new sections .init and .fini.  These sections are for global constructors and destructors in C++.  Here's the two workarounds:
<br/>
<br/>
1.) Add --no-warn-mismatch option to ld.  This is given often by others as a fix.  I don't like fixes that simply turn off warnings.  Your choice.  
<br/>
<br/>
2.) Modify lnkscript from Jeff Frohwein (http://www.devrs.com) to add the new sections.  Below are the changes I made.  I have no idea if this is good or not, but it does work on the examples I have tried.
<br/>
<br/>
SECTIONS
<br/>
<br/>
{
<br/>
<br/>
  .text __text_start :   /* ALIGN (4): */
<br/>
<br/>
  {
<br/>
<br/>
    *(EXCLUDE_FILE (*text.iwram*) .text)
<br/>
<br/>
    *(.text.*)
<br/>
<br/>
    *(.init)
<br/>
<br/>
    *(.fini)
<br/>
<br/>
    *(.stub)
<br/>
<br/>
    /* .gnu.warning sections are handled specially by elf32.em.  */
<br/>
<br/>
    *(.gnu.warning)
<br/>
<br/>
    *(.gnu.linkonce.t*)
<br/>
<br/>
    *(.glue_7)
<br/>
<br/>
    *(.glue_7t)
<br/>
<br/>
    . = ALIGN(4);  /* REQUIRED. LD is flaky without it. */
<br/>
<br/>
  } = 0xff
<br/>
<br/>
<br/>
<br/>
  __text_end = .;
<br/>
<br/>
<br/>
<br/>
  .init	:
<br/>
<br/>
  {
<br/>
<br/>
    KEEP (*(.init))
<br/>
<br/>
  }
<br/>
<br/>
<br/>
<br/>
  .fini	:
<br/>
<br/>
  {
<br/>
<br/>
    KEEP (*(.fini))
<br/>
<br/>
  }
<br/>
<br/>
<br/>
At this point, GCC will produce a binary that will execute in VisualBoyAdvance.
<br/>
<br/>
bogston</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
