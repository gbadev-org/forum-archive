<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Transparent backgrounds above sprites - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > Transparent backgrounds above sprites</h2>
<div id="posts">
<div class="post">
    <h4>#33894 - ymalik - Mon Jan 10, 2005 10:10 pm</h4>
    <div class="postbody"><span class="postbody">In the following code I have a star background and on top of it I have a transparent cloud background.  The star background (background 0) is composed of 4 8x8 8 bit tiles randomly placed.  The cloud background (background 1) is a 240x256 8 bit image.  In between I want to have a sprite that is above the star background but you can see through it through the cloud background.  The sprite is a 32x32 8 bit image.  I can only seem to make the sprite either above the star background or transparent below the clouds, but not both, and the black area around the sprite shows through the clouds.  Also, the cloud image seems to be torn into two pieces down the middle vertically and stretched.  How can I accomplish all of this?
<br/>
<br/>
Thanks,
<br/>
Yasir
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
int main(void)
<br/>
{
<br/>
   int i;
<br/>
   Sprite sprite;
<br/>
   s16 stars_x = 0, clouds_x = 0, ship_x = 104, ship_y = 126;
<br/>
   SetMode(MODE_0 | BG0_ENABLE | BG1_ENABLE | OBJ_ENABLE | OBJ_MAP_1D);
<br/>
<br/>
   // star background
<br/>
   DMA_Copy(3, (void *) palette_Palette, BGPaletteMem, 256, DMA_16NOW);
<br/>
   DMA_Copy(3, (void *) stars_Tiles, (void *) CharBaseBlock(0), 256, DMA_16NOW);
<br/>
   generate_stars();
<br/>
<br/>
   // clouds
<br/>
   DMA_Copy(3, (void *) clouds_Tiles, (void *) CharBaseBlock(1), 12224/2, DMA_16NOW);
<br/>
   DMA_Copy(3, (void *) clouds_Map, (void *) ScreenBaseBlock(30), 960, DMA_16NOW);
<br/>
<br/>
   // ship
<br/>
   DMA_Copy(3, (void *) palette, (void *) OBJPaletteMem, 256, DMA_16NOW);
<br/>
   DMA_Copy(3, (void *) obj0, (void *) OBJ_GFXMem, 512, DMA_16NOW);
<br/>
<br/>
   sprite.attribute0 = COLOR_256 | ship_y | SQUARE;
<br/>
   sprite.attribute1 = SIZE_32 | ship_x;
<br/>
   sprite.attribute2 = 0 | BIT(10);
<br/>
<br/>
   //       where to look for tiles                                  where to look for map
<br/>
   REG_BG0CNT = 0 &lt;&lt; CHAR_SHIFT | BG_COLOR_256 | TEXTBG_SIZE_256x256 | 31 &lt;&lt; SCREEN_SHIFT | 0;
<br/>
   REG_BG1CNT = 1 &lt;&lt; CHAR_SHIFT | BG_COLOR_256 | TEXTBG_SIZE_256x256 | 30 &lt;&lt; SCREEN_SHIFT | 1;
<br/>
   REG_BLDMOD = BIT(0) | BIT(9) | BIT(6) | BIT(12);
<br/>
<br/>
   while(1)
<br/>
   {
<br/>
      process_buttons(&amp;ship_x);
<br/>
<br/>
      stars_x++;
<br/>
      clouds_x--;
<br/>
<br/>
      sprite.attribute1 = SIZE_32 | ship_x;
<br/>
<br/>
      wait_vblank();
<br/>
      OAMMem[0] = sprite.attribute0;
<br/>
      OAMMem[1] = sprite.attribute1;
<br/>
      OAMMem[2] = sprite.attribute2;
<br/>
      REG_BG0VOFS = stars_x &gt;&gt; 4;
<br/>
      REG_BG1VOFS = clouds_x &gt;&gt; 2;
<br/>
   }
<br/>
<br/>
   return 0;
<br/>
}
<br/>
</td> </tr></table><span class="postbody"></span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#33941 - Cearn - Tue Jan 11, 2005 12:33 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ymalik wrote:</b></span></td> </tr> <tr> <td class="quote">
<br/>
   REG_BG0CNT = 0 &lt;&lt; CHAR_SHIFT | BG_COLOR_256 | TEXTBG_SIZE_256x256 | 31 &lt;&lt; SCREEN_SHIFT | <span style="font-weight: bold">0</span>; 
<br/>
   REG_BG1CNT = 1 &lt;&lt; CHAR_SHIFT | BG_COLOR_256 | TEXTBG_SIZE_256x256 | 30 &lt;&lt; SCREEN_SHIFT | <span style="font-weight: bold">1</span>; 
<br/>
</td> </tr></table><span class="postbody">
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ymalik wrote:</b></span></td> </tr> <tr> <td class="quote">In the following code I have a star background and on top of it I have a transparent cloud background. The star background (background <span style="font-weight: bold">0</span>) is composed of 4 8x8 8 bit tiles randomly placed. The cloud background (background <span style="font-weight: bold">1</span>) is a 240x256 8 bit image</td> </tr></table><span class="postbody">
<br/>
Errr, bg0 (stars) has priority 0, bg1 (clouds) has priority 1, that means that the stars are <span style="font-weight: bold">in front</span> of the clouds, not behind. Higher priority means higher drawing priority, i.e, draw first &amp; painted over by the other backgrounds.
<br/>
To make the clouds be over the stars, the stars-bg should have priority 1, and clouds-bg priority 0 (or switch the backgrounds themselves). You will probably have to alter REG_BLDMOD as wel to account for the change. 
<br/>
<br/>
As for the black area around the sprite, are you sure it uses color index 0?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#33957 - ymalik - Tue Jan 11, 2005 5:18 pm</h4>
    <div class="postbody"><span class="postbody">Thanks, Cearn.
<br/>
I have the following now:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
   REG_BG0CNT = 0 &lt;&lt; CHAR_SHIFT | BG_COLOR_256 | TEXTBG_SIZE_256x256 | 31 &lt;&lt; SCREEN_SHIFT | 3;
<br/>
   REG_BG1CNT = 1 &lt;&lt; CHAR_SHIFT | BG_COLOR_256 | TEXTBG_SIZE_256x256 | 30 &lt;&lt; SCREEN_SHIFT | 0;
<br/>
   REG_BLDMOD = BIT(0) | BIT(11) | BIT(4); 
<br/>
</td> </tr></table><span class="postbody">
<br/>
I gave the ship priority 2 in attribute2.  The clouds are above the stars and ship, but I cannot see the ship or stars through the clouds.
<br/>
I used gifs2sprites to create the header files for my sprites, and this is the palette that it creates:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
const unsigned short palette[7]=
<br/>
{
<br/>
RGB( 0, 0, 0),RGB( 0, 0, 0),RGB( 0, 0,31),RGB(31,31, 0),RGB(24,24,24),
<br/>
RGB( 0,31, 0),RGB(31, 0, 0)
<br/>
};
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
and here's part of the ship array:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
/* ship.gif (32x32x16) */
<br/>
const unsigned short obj1[256]={
<br/>
0x1111,   0x1111,
<br/>
0x1111,   0x1111,
<br/>
0x1111,   0x1111,
<br/>
0x1111,   0x1111,
<br/>
0x1111,   0x1111,
<br/>
0x1111,   0x1111,
<br/>
0x1111,   0x1111,
<br/>
0x1111,   0x1111,
<br/>
0x1111,   0x1111,
<br/>
0x1111,   0x1111,
<br/>
0x1111,   0x1111,
<br/>
0x1111,   0x2111,
<br/>
0x1111,   0x2111,
<br/>
0x1111,   0x2211,
<br/>
...
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
So I had to do a find a replace on all 1's with 0's to make the black transparent.
<br/>
<br/>
Much thanks,
<br/>
Yasir</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#33962 - Cearn - Tue Jan 11, 2005 6:24 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>ymalik wrote:</b></span></td> </tr> <tr> <td class="quote">I gave the ship priority 2 in attribute2. The clouds are above the stars and ship, but I cannot see the ship or stars through the clouds. </td> </tr></table><span class="postbody">
<br/>
That's what the transparency is for, isn't it? I have a feeling you might need to read up on that a little bit. (So should I probably, it's been a while). One, euhm, 'interesting' thing about REG_BLDMOD is that lower byte is for the front layers (A) and the upper-byte for the back-layers (B). If you reverse it, it won't work. And there's more to blending than just REG_BLDMOD:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
REG_BLDMOD = 
<br/>
     BIT(1)     // front, bg1 (the clouds)
<br/>
   | BIT(6)     // you must switch blending ON before anything can happen
<br/>
   | BIT(8)     // back, bg0 (stars)
<br/>
   | BIT(12)    // sprites in back too
<br/>
<br/>
// and then the weights in REG_COLEV
<br/>
REG_COLEV = 
<br/>
     (4&lt;&lt;8)      // set front to 1/4 strength
<br/>
   | (12&lt;8)      // set back to 3/4 strength
<br/>
<br/>
// and you probably need to switch on transparency for the sprite too
<br/>
// but I'm not 100% sure here
<br/>
sprite.attribute0 |= BIT(10)
<br/>
</td> </tr></table><span class="postbody">
<br/>
That should do it.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
