<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>move sprite into any degree? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > move sprite into any degree?</h2>
<div id="posts">
<div class="post">
    <h4>#9863 - jenswa - Wed Aug 20, 2003 2:27 pm</h4>
    <div class="postbody"><span class="postbody">I know how to rotate a sprite,
<br/>
<br/>
but i cannot move the sprite into that direction.
<br/>
With the degrees, sine and cosine i can calculate how many pixels it should
<br/>
move in a direction, but i don't get it to work.
<br/>
Sprites 'flies' off screen.
<br/>
Can someone explain me how to do this on the gba.<br/>_________________<br/>It seems this wasn't lost after all.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9866 - iuiz - Wed Aug 20, 2003 4:00 pm</h4>
    <div class="postbody"><span class="postbody">I think there is a bug in your calculating function...
<br/>
<br/>
Can you post it (please with comments in your Code).</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9894 - jenswa - Thu Aug 21, 2003 12:03 pm</h4>
    <div class="postbody"><span class="postbody">Here is the code:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include "gba.h"
<br/>
#include "sprite.h"
<br/>
#include "keypad.h"
<br/>
#include "dispcnt.h"
<br/>
#include "car.h"
<br/>
<br/>
//sine and consine lookup tables
<br/>
#include "sincosrad.h"
<br/>
<br/>
//variables
<br/>
int xpos = 120;
<br/>
int ypos = 60;
<br/>
s32 move = 2;
<br/>
s32 dx = 2;
<br/>
s32 dy = 2;
<br/>
<br/>
<br/>
<br/>
//chaning dx and dy
<br/>
void ChangeAngle()
<br/>
{
<br/>
   //angle+180, because the car faces down in the pic
<br/>
   dx = (s32)(COS[angle + 180] * move);
<br/>
   dy = (s32)(SIN[angle + 180] * move);
<br/>
<br/>
}
<br/>
<br/>
void GetInput()
<br/>
{
<br/>
   if(!(*KEYS &amp; KEY_LEFT))
<br/>
   {
<br/>
       angle--;
<br/>
      if(angle &lt; 0)
<br/>
         angle = 359;
<br/>
   }
<br/>
   if(!(*KEYS &amp; KEY_RIGHT))
<br/>
   {
<br/>
      angle++;
<br/>
      if(angle &gt; 359)
<br/>
         angle = 0;
<br/>
   }
<br/>
   if(!(*KEYS &amp; KEY_A))
<br/>
   {
<br/>
      if(ypos &lt; 160 &amp;&amp; ypos &gt; 0)
<br/>
      {
<br/>
         ypos+=dy;
<br/>
      }
<br/>
      if(xpos &lt; 240 &amp;&amp; xpos &gt; 0)
<br/>
      {
<br/>
         xpos+=dx;
<br/>
      }
<br/>
   }
<br/>
}
<br/>
<br/>
int main()
<br/>
{
<br/>
   int x;
<br/>
<br/>
   //set mode 1 and enable sprites and 1d mapping
<br/>
   SetMode(MODE_1 | OBJ_ENABLE | OBJ_MAP_1D);
<br/>
<br/>
   //load sprite palette
<br/>
   for(x = 0; x &lt; 256; x++)
<br/>
      OBJPaletteMem[x] = carPalette[x];
<br/>
<br/>
   //set sprites to off screen
<br/>
   InitializeSprites();
<br/>
<br/>
   //set car attributes (rotation 16x16 xpos ypos size doulbe rot flag 256 color)
<br/>
   sprites[0].attribute0 = COLOR_256 | SQUARE | ROTATION_FLAG | SIZE_DOUBLE | ypos;
<br/>
   sprites[0].attribute1 = SIZE_16 | ROTDATA(0) | xpos;
<br/>
   sprites[0].attribute2 = 0;
<br/>
<br/>
   //load sprite image data
<br/>
   for(x = 0; x &lt; 128; x++)
<br/>
          {
<br/>
             OAMData[x] = carData[x];
<br/>
          }
<br/>
<br/>
   //the main game loop
<br/>
   while(1)
<br/>
   {
<br/>
      ChangeAngle();         //calculate dx and y
<br/>
      GetInput();         //read the gba keypad
<br/>
      RotateSprite(0, angle, zoom, zoom);   //rotate the sprite
<br/>
      MoveSprite(&amp;sprites[0],xpos,ypos);   //move the car
<br/>
      WaitForVsync();         //waits for the screen to stop drawing
<br/>
      CopyOAM();         //copies sprite array into OAM.
<br/>
<br/>
   }
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
the file: "sincosrad.h" comes from the tutorials from gbajunkie
<br/>
and are the sine, cosine and radian loopup tables.
<br/>
<br/>
And the source can be downloaded here:
<br/>
<a class="postlink" href="http://home.12move.nl/jenswa/car.zip" target="_blank">http://home.12move.nl/jenswa/car.zip</a>
<br/>
<br/>
Thanx for your help in advance.<br/>_________________<br/>It seems this wasn't lost after all.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9899 - Lupin - Thu Aug 21, 2003 1:07 pm</h4>
    <div class="postbody"><span class="postbody">I'm not sure, but isnt the result of SIN[] fixed point? Maybe you should check the fixed point format. What's the value of zoom? Use 1&lt;&lt;8 for zoom to make sure it's original size</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9900 - jenswa - Thu Aug 21, 2003 1:11 pm</h4>
    <div class="postbody"><span class="postbody">I have the same for zoom.
<br/>
<br/>
And FIXED is mostly defined as s32,
<br/>
can u check that for me?<br/>_________________<br/>It seems this wasn't lost after all.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9917 - iuiz - Thu Aug 21, 2003 8:28 pm</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
hmm, if you just move the sprite (wether it is rotated or not) does it work? I thought, that you have saved an angel for your sprite and want to move it into that direction.
<br/>
<br/>
I thought, that you have just calculated the distance false.
<br/>
<br/>
So, if you have a Sprite that is facing north (0?) and you move it (lets say 2 Pixels) it would move 2 Pixels up. If it is facing right (90?) it would move 2 pixels right, and when it has 45? it would move one Pixel up and one Pixel down. 
<br/>
And I thought that this function must contain a failure.
<br/>
<br/>
<br/>
Or did I get you wrong?
<br/>
<br/>
<br/>
Just try to move it one pixel right, and one down. When it worked rotate the Sprite a bit and do the same movement again (the movement is not depending on the rotation off the Sprite in this example). This way you will be able to focus on the failure (because if this works, your move sprite function is correct). 
<br/>
<br/>
<br/>
Cu,
<br/>
iuiz</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9942 - jenswa - Fri Aug 22, 2003 11:39 am</h4>
    <div class="postbody"><span class="postbody">Yes, the calculations where wrong,
<br/>
i now have added *PI/180, now it moves into the directions, but way too fast.
<br/>
<br/>
so code looks like this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
dx= (s32)(COS[angle] * PI/180); 
<br/>
 dy = (s32)(SIN[angle] *PI/180);
<br/>
</td> </tr></table><span class="postbody"><br/>_________________<br/>It seems this wasn't lost after all.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9949 - tepples - Fri Aug 22, 2003 7:39 pm</h4>
    <div class="postbody"><span class="postbody">Hint 1: You'll need to keep track of the position of the sprite with subpixel accuracy, as fixed-point numbers.<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#9952 - jenswa - Fri Aug 22, 2003 7:51 pm</h4>
    <div class="postbody"><span class="postbody">Let's see if i get the point.
<br/>
<br/>
You mean that i should keep track of the numbers behind the komma ( "," or in code the point ".").
<br/>
<br/>
example:
<br/>
<br/>
3.18
<br/>
<br/>
i store the .18 in a variable and then i keep counting untill i reach
<br/>
the 1 and then i can move the sprite 1 pixel. And of course this is done
<br/>
for x and y?
<br/>
<br/>
Nevertheless i still have this problem, i thought that sine returns a value between -1 and 1.
<br/>
But in my function, the highest number is 4.
<br/>
<br/>
Hmm i think i see the problem, the sine and cosine values i have used
<br/>
aren't ment to be used in this way (i think) because they are not between
<br/>
-1 and 1, like i learend at school.
<br/>
<br/>
Thanks for your help.<br/>_________________<br/>It seems this wasn't lost after all.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10122 - iuiz - Wed Aug 27, 2003 6:07 pm</h4>
    <div class="postbody"><span class="postbody">Ok, I am realy bored at this moment, so I took out a Pencil...
<br/>
<br/>
<br/>
<a class="postlink" href="http://www.halof.com/images/sinandcos.jpg" target="_blank">www.halof.com/images/sinandcos.jpg</a>
<br/>
<br/>
Your Sprite is locatet at (2|2), and lets say Alpha has 26.388? and you want to move it 4,5cm (Pic 1).
<br/>
<br/>
(Now I have to google, what "Gegenkathete" and "Hypothenuse" means in English :D - damn, i am not able to find it :()
<br/>
<br/>
<br/>
<br/>
So, lets repeat, what sinus and cosinus are, because I dont know the English words (look at pic 2)
<br/>
<br/>
sin alpha = a / c
<br/>
cos alpha = b / c
<br/>
<br/>
<br/>
<br/>
So, if you want to calculate, how much you have to move your Sprite, you have to use the things, that you already know. These are Alpha and c.
<br/>
<br/>
Alpha = 26.388?
<br/>
c = 4,5cm
<br/>
<br/>
calculate the way on the x-axis --&gt;
<br/>
a = sin alpha * c
<br/>
<br/>
a = sin 26,388? * 4,5
<br/>
a= 0,44 * 4,5
<br/>
a= 1,98cm
<br/>
<br/>
<br/>
calculate the way on the y-axis --&gt;
<br/>
b= cos alpha * 4,5
<br/>
short: b = 4,03cm
<br/>
<br/>
<br/>
Variation: The y-axis could be also done with the Pytagoras.
<br/>
<br/>
<br/>
I hope this helped. Now it should be realy easy to create a "callculate movent" function. If not drop me a line :). You dont need Pi, isn't this great?
<br/>
<br/>
<br/>
<br/>
Cu,
<br/>
iuiz
<br/>
<br/>
ps: To calculate the sin or cos of an var do this:
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">
<br/>
#include &lt;math.h&gt;
<br/>
#include &lt;stdio.h&gt;
<br/>
<br/>
void main() 
<br/>
{
<br/>
   int bla=90;
<br/>
   float SinBla;
<br/>
   
<br/>
   SinBla= (float) (sin(bla));
<br/>
<br/>
   printf("%g", SinBla);
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
<br/>
(Remember that it is in [b]RADIANS[\b])</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#10206 - jenswa - Fri Aug 29, 2003 2:09 pm</h4>
    <div class="postbody"><span class="postbody">Thanks for some 3rd grade math teaching.
<br/>
<br/>
But i found out my sine and cosine tables were wrong.
<br/>
<br/>
Anywayz, i should cast it back to integer and store the subpixel for moving. That was actually whay i was asking for.<br/>_________________<br/>It seems this wasn't lost after all.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
