<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>How to swap screens? - gbadev.org forum archive</title>
        <link rel="stylesheet" href="static/pure-min.css" />
        <link rel="stylesheet" href="static/main.css" />
    </head>
    <body>
        <h1>gbadev.org forum archive</h1>

        This is a mirror of the content originally found on forum.gbadev.org
        (now offline), salvaged from Wayback machine copies. <br />

        <h2>Beginners > How to swap screens?</h2>
<div id="posts">
<div class="post">
    <h4>#156589 - mca - Sun May 11, 2008 9:01 pm</h4>
    <div class="postbody"><span class="postbody">Hi, 
<br/>
<br/>
what's the command to swap screens?
<br/>
By default libnds assigns the lower NDS touchscreen to the MAIN screen, while the upper NDS screen is assigned to the SUB screen.
<br/>
<br/>
How can I change it?
<br/>
<br/>
My goal is to assign 256 Kb of memory to the upper NDS screen. AFAIK I can't do it with the SUB screen (max 128 Kb). Is this correct?
<br/>
<br/>
Thanks...
<br/>
mca</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#156592 - mca - Sun May 11, 2008 9:24 pm</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
at last found it here:
<br/>
<br/>
<a class="postlink" href="http://dev-scene.com/NDS/DOCgraphicmodes" target="_blank">http://dev-scene.com/NDS/DOCgraphicmodes</a>
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">lcdMainOnTop(); //MAIN renders to top screen SUB to bottom
<br/>
lcdMainOnBottom(); //SUB renders to top screen MAIN to bottom
<br/>
lcdSwap(); //swap the screens the egines were rendering to</td> </tr></table><span class="postbody">
<br/>
<br/>
Thanks anyway for this forum and its help...
<br/>
mca</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#156594 - silent_code - Sun May 11, 2008 9:35 pm</h4>
    <div class="postbody"><span class="postbody">one word: exactly. :^)
<br/>
i personally don't use the swap method. it's better to use the explicit "commands", so you make sure your program behaves consistently. the implicid "command" allows programming logic flaws to mess up the screen positioning and makes it harder to find those flaws.
<br/>
<br/>
happy coding! :^)</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#156605 - mca - Sun May 11, 2008 10:05 pm</h4>
    <div class="postbody"><span class="postbody">Hi,
<br/>
<br/>
now I succesfully swapped screens and initialized video as follows:
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">   lcdMainOnTop(); 
<br/>
   vramSetMainBanks(VRAM_A_MAIN_BG_0x06000000,
<br/>
             VRAM_B_MAIN_BG_0x06020000,
<br/>
             VRAM_C_SUB_BG_0x06200000,
<br/>
             VRAM_D_SUB_SPRITE);
<br/>
<br/>
    videoSetMode(MODE_5_2D | // Set the graphics mode to Mode 5
<br/>
                 DISPLAY_BG0_ACTIVE | // Enable text Output      
<br/>
                 DISPLAY_BG2_ACTIVE   // Enable BG2 for display
<br/>
                 );
<br/>
    videoSetModeSub(MODE_5_2D | // Set the graphics mode to Mode 5
<br/>
                 DISPLAY_BG3_ACTIVE | // Enable BG3 for display
<br/>
                 DISPLAY_SPR_ACTIVE | // Enable sprites for display
<br/>
                 DISPLAY_SPR_1D       // Enable 1D tiled sprites
<br/>
             );</td> </tr></table><span class="postbody">
<br/>
<br/>
Now problem is, that no sprite comes up on the SUB screen.
<br/>
When I had the sprites display on the MAIN screen, all worked fine.
<br/>
<br/>
What could be wrong?
<br/>
<br/>
Thanks...
<br/>
mca</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#156608 - tepples - Sun May 11, 2008 10:09 pm</h4>
    <div class="postbody"><span class="postbody">Where in VRAM and in OAM are you loading the sub screen's sprites?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#156615 - mca - Sun May 11, 2008 10:34 pm</h4>
    <div class="postbody"><span class="postbody">I use 
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">dmaCopyHalfWords(3,
<br/>
                   EmptyTiles,
<br/>
                   &amp;SPRITE_GFX[TileIdx * EMPTY * OFFSET_MULTIPLIER],
<br/>
                   EmptyTilesLen);</td> </tr></table><span class="postbody">
<br/>
for copying the sprite data and
<br/>
<br/>
</span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">void updateOAM(tOAM * oam) {
<br/>
    DC_FlushAll();
<br/>
    dmaCopyHalfWords(3,
<br/>
                     oam-&gt;spriteBuffer,
<br/>
                     OAM_SUB,
<br/>
                     SPRITE_COUNT * sizeof(SpriteEntry));
<br/>
}
<br/>
</td> </tr></table><span class="postbody">
<br/>
for updating the OAM_SUB.
<br/>
<br/>
And as I wrote in my previous post, I use VRAM_D_SUB_SPRITE.
<br/>
<br/>
I don't understand exactly, how &amp;SPRITE_GFX knows its destination in VRAM_D. How is it set?</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#156620 - tepples - Sun May 11, 2008 10:48 pm</h4>
    <div class="postbody"><span class="postbody"></span><table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>mca wrote:</b></span></td> </tr> <tr> <td class="quote">I use 
<br/>
<table align="center" border="0" cellpadding="3" cellspacing="1" width="90%"><tr> <td><span class="genmed"><b>Code:</b></span></td> </tr> <tr> <td class="code">dmaCopyHalfWords(3,
<br/>
                   EmptyTiles,
<br/>
                   &amp;SPRITE_GFX[TileIdx * EMPTY * OFFSET_MULTIPLIER],</td> </tr></table><span class="postbody"></span></td> </tr></table><span class="postbody">
<br/>
Why not SPRITE_GFX_SUB?<br/>_________________<br/>-- Where is he?
<br/>
-- Who?
<br/>
-- You know, the human.
<br/>
-- I think he moved to Tilwick.</span><span class="gensmall"></span></div>    
</div>
<div class="post">
    <h4>#156624 - mca - Sun May 11, 2008 10:55 pm</h4>
    <div class="postbody"><span class="postbody">Thanks,
<br/>
<br/>
SPRITE_GFX_SUB and SPRITE_PALETTE_SUB is working.
<br/>
<br/>
It isn't sufficient to just use OAM_SUB instead of OAM.
<br/>
<br/>
Now I can move on...
<br/>
<br/>
<br/>
@silent_code: good suggestion. I use the explicit commands.</span><span class="gensmall"></span></div>    
</div>
</div>

    </body>
</html>
